<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
    <channel>
        <title>HN100 - Readable Contents</title>
        <link>https://hn.algolia.com/api/v1/search_by_date?tags=%28story,poll%29&amp;numericFilters=points%3E100</link>
        <description>Uses Readability to add bodies to the RSS feed</description>
        <lastBuildDate>Thu, 03 Oct 2024 02:30:03 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Filed: WP Engine Inc. v Automattic Inc. and Matthew Charles Mullenweg [pdf] (132 pts)]]></title>
            <link>https://wpengine.com/wp-content/uploads/2024/10/Complaint-WP-Engine-v-Automattic-et-al-with-Exhibit.pdf</link>
            <guid>41726197</guid>
            <pubDate>Thu, 03 Oct 2024 00:29:05 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://wpengine.com/wp-content/uploads/2024/10/Complaint-WP-Engine-v-Automattic-et-al-with-Exhibit.pdf">https://wpengine.com/wp-content/uploads/2024/10/Complaint-WP-Engine-v-Automattic-et-al-with-Exhibit.pdf</a>, See on <a href="https://news.ycombinator.com/item?id=41726197">Hacker News</a></p>
&lt;Not HTML&gt;]]></description>
        </item>
        <item>
            <title><![CDATA[OpenAI completes deal that values company at $157B (189 pts)]]></title>
            <link>https://www.nytimes.com/2024/10/02/technology/openai-valuation-150-billion.html</link>
            <guid>41722742</guid>
            <pubDate>Wed, 02 Oct 2024 17:04:48 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.nytimes.com/2024/10/02/technology/openai-valuation-150-billion.html">https://www.nytimes.com/2024/10/02/technology/openai-valuation-150-billion.html</a>, See on <a href="https://news.ycombinator.com/item?id=41722742">Hacker News</a></p>
Couldn't get https://www.nytimes.com/2024/10/02/technology/openai-valuation-150-billion.html: Error: Request failed with status code 403]]></description>
        </item>
        <item>
            <title><![CDATA[An adult fruit fly brain has been mapped (312 pts)]]></title>
            <link>https://www.economist.com/science-and-technology/2024/10/02/an-adult-fruit-fly-brain-has-been-mapped-human-brains-could-follow</link>
            <guid>41722159</guid>
            <pubDate>Wed, 02 Oct 2024 16:16:03 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.economist.com/science-and-technology/2024/10/02/an-adult-fruit-fly-brain-has-been-mapped-human-brains-could-follow">https://www.economist.com/science-and-technology/2024/10/02/an-adult-fruit-fly-brain-has-been-mapped-human-brains-could-follow</a>, See on <a href="https://news.ycombinator.com/item?id=41722159">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><section><div><p><span><a href="https://www.economist.com/science-and-technology" data-analytics="sidebar:section"><span>Science &amp; technology</span></a></span><span> | <!-- -->On the fly</span></p></div><h2>For now, it is the most sophisticated connectome ever made</h2></section><section><figure><img alt="50 largest neurons of the fly brain connectome." fetchpriority="high" width="1280" height="720" decoding="async" data-nimg="1" sizes="(min-width: 960px) 700px, 95vw" srcset="https://www.economist.com/cdn-cgi/image/width=360,quality=80,format=auto/content-assets/images/20241005_STP001.jpg 360w, https://www.economist.com/cdn-cgi/image/width=384,quality=80,format=auto/content-assets/images/20241005_STP001.jpg 384w, https://www.economist.com/cdn-cgi/image/width=480,quality=80,format=auto/content-assets/images/20241005_STP001.jpg 480w, https://www.economist.com/cdn-cgi/image/width=600,quality=80,format=auto/content-assets/images/20241005_STP001.jpg 600w, https://www.economist.com/cdn-cgi/image/width=834,quality=80,format=auto/content-assets/images/20241005_STP001.jpg 834w, https://www.economist.com/cdn-cgi/image/width=960,quality=80,format=auto/content-assets/images/20241005_STP001.jpg 960w, https://www.economist.com/cdn-cgi/image/width=1096,quality=80,format=auto/content-assets/images/20241005_STP001.jpg 1096w, https://www.economist.com/cdn-cgi/image/width=1280,quality=80,format=auto/content-assets/images/20241005_STP001.jpg 1280w, https://www.economist.com/cdn-cgi/image/width=1424,quality=80,format=auto/content-assets/images/20241005_STP001.jpg 1424w" src="https://www.economist.com/cdn-cgi/image/width=1424,quality=80,format=auto/content-assets/images/20241005_STP001.jpg"><figcaption><span>Photograph: Tyler Sloan &amp; Amy Sterling/ FlyW</span></figcaption></figure></section><div><div><p><time datetime="2024-10-02T15:02:44.481Z"> <!-- -->Oct 2nd 2024</time></p></div><section data-body-id="cp2"><p data-component="paragraph"><span data-caps="initial">F</span><small>RUIT FLIES</small> are smart. For a start—the clue is in the name—they can fly. They can also flirt; fight; form complex, long-term memories of their surroundings; and even warn one another about the presence of unseen dangers, such as parasitic wasps. </p></section><div><p><a href="https://s100.copyright.com/AppDispatchServlet?publisherName=economist&amp;publication=economist&amp;title=An%20adult%20fruit%20fly%20brain%20has%20been%20mapped%E2%80%94human%20brains%20could%20follow&amp;publicationDate=2024-10-02&amp;contentID=%2Fcontent%2Fc2v47l1ps9nddstit39seocd2ecb2k1m&amp;type=A&amp;orderBeanReset=TRUE" target="_blank" rel="noreferrer" data-analytics="end_of_article:reuse_this_content"><span>Reuse this content</span></a></p></div></div><div data-test-id="right-hand-rail-ads"></div></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[The Fastest Mutexes (578 pts)]]></title>
            <link>https://justine.lol/mutex/</link>
            <guid>41721668</guid>
            <pubDate>Wed, 02 Oct 2024 15:31:45 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://justine.lol/mutex/">https://justine.lol/mutex/</a>, See on <a href="https://news.ycombinator.com/item?id=41721668">Hacker News</a></p>
<div id="readability-page-1" class="page">

<p>
Oct 2<sup>nd</sup>, 2024 @ <a href="https://justine.lol/index.html">justine's web page</a>
</p>

<p><img src="https://justine.lol/mutex/honeybadger.png" alt="[cosmpolitan honeybadger logo]" width="334" height="200"><br>
Cosmopolitan Honeybadger
</p>

<p>
<a href="https://justine.lol/cosmo3/">Cosmopolitan Libc</a> is well-known for
its <a href="https://justine.lol/ape.html">polyglot fat binary</a> hack
that lets your executables run on six OSes for AMD64 / ARM64. What may
surprise you is that it could also be the best C library for your
production workloads too. To demonstrate this point, let's compare
Cosmo's mutex library with other platforms.

</p><p>
We'll do this by writing a simple test that spawns <strong>30
threads</strong> which increment the same integer <strong>100,000
times</strong>. This tests how well a mutex implementation performs in
the heavily contended use case. In essence, that means the following
(see the segment at the bottom of the page for the full source code).

</p><pre><span>int</span> g_chores;
<span>pthread_mutex_t</span> g_locker = PTHREAD_MUTEX_INITIALIZER;

<span>void</span> *<span>worker</span>(<span>void</span> *arg) {
  <span>for</span> (<span>int</span> i = 0; i &lt; ITERATIONS; ++i) {
    pthread_mutex_lock(&amp;g_locker);
    ++g_chores;
    pthread_mutex_unlock(&amp;g_locker);
  }
  <span>return</span> 0;
}
</pre>

<p>
Now let's start with the exciting part, which are my benchmark results.

</p><h3>Benchmarks</h3>

<p>
Times will be measured in microseconds. Wall time is how long the test
program takes to run. That includes the overhead of spawning and joining
threads. User time is how much CPU time was spent in userspace, and
system time is how much CPU time was spent in the kernel. System and
user time can exceed the actual wall time because multiple threads are
running in parallel.

</p><p>
The first results I'll show are for Windows because Mark Waterman did an
excellent <a href="https://github.com/markwaterman/MutexShootout">mutex
shootout</a> three months ago, where he said, "in the highly contended
scenario, Windows wins the day with its SRWLOCK". Contention is where
mutex implementations show their inequality. Mark was so impressed by
Microsoft's SRWLOCK that he went on to recommend Linux and FreeBSD users
consider targeting Windows if mutex contention is an issue.

</p><div>
<table>
<tbody><tr>
  <th colspan="4"><p>
      Windows Mutex Implementations<br>
      24-core Threadripper 29070WX

</p></th></tr><tr>
  <th>wall<br>time (µs)
  </th><th>user<br>time (µs)
  </th><th>system<br>time (µs)
  </th><th>implementation

</th></tr><tr>
  <td>148,940
  </td><td>328,125
  </td><td>62,500
  </td><td>Cosmopolitan pthread_mutex_t

</td></tr><tr>
  <td>410,416
  </td><td>5,515,625
  </td><td>1,640,625
  </td><td>Microsoft SRWLOCK

</td></tr><tr>
  <td>949,187
  </td><td>7,937,500
  </td><td>5,078,125
  </td><td>Microsoft CRITICAL_SECTION

</td></tr><tr>
  <td>991,750
  </td><td>12,156,250
  </td><td>4,031,250
  </td><td>MSVC 2022 std::mutex

</td></tr><tr>
  <td>1,165,435
  </td><td>24,515,000
  </td><td>15,000
  </td><td>spin lock

</td></tr><tr>
  <td>9,780,803
  </td><td>1,937,000
  </td><td>6,156,000
  </td><td>Cygwin pthread_mutex_t

</td></tr></tbody></table>
</div>

<p>
As we can see, Cosmopolitan Libc mutexes go 2.75x faster than
Microsoft's SRWLOCK (which was previously believed to be the best of the
best) while consuming 18x fewer CPU resources. Cosmopolitan mutexes were
also 65x faster than Cygwin, which like Cosmopolitan provides a POSIX
implementation on Windows. Cygwin's mutexes are so bad that they would
have been better off for this use case just using a spin lock.

</p><p>
Now onto Linux, the lord of all operating systems.

</p><div>
<table>
<tbody><tr>
  <th colspan="4"><p>
      Linux Mutex Implementations<br>
      96-core Threadripper Pro 7995WX

</p></th></tr><tr>
  <th>wall<br>time (µs)
  </th><th>user<br>time (µs)
  </th><th>system<br>time (µs)
  </th><th>implementation

</th></tr><tr>
  <td>36,905
  </td><td>44,511
  </td><td>23,492
  </td><td>Cosmopolitan pthread_mutex_t

</td></tr><tr>
  <td>101,353
  </td><td>150,706
  </td><td>2,724,851
  </td><td>glibc pthread_mutex_t

</td></tr><tr>
  <td>202,423
  </td><td>4,694,749
  </td><td>2,000
  </td><td>spin lock

</td></tr><tr>
  <td>411,013
  </td><td>2,167,898
  </td><td>9,926,850
  </td><td>Musl libc pthread_mutex_t

</td></tr></tbody></table>
</div>

<p>
  Here we see Cosmopolitan mutexes are:

</p><ul>
<li>3x faster than glibc
</li><li>11x faster than glibc
</li><li>42x less CPU time than glibc
</li><li>178x less CPU time than Musl Libc
</li></ul>

<p>
Here's how things actually work in practice. Imagine you have a workload
where all your threads need to do a serialized operation. With Cosmo, if
you're looking at htop, then it's going to appear like only one core is
active, whereas glibc and musl libc will fill up your entire CPU meter.
That's bad news if you're running a lot of jobs on the same server. If
just one of your servers has a mutex bloodbath, then all your resources
are gone, unless you're using cosmo. It's still a new C library and it's
a little rough around the edges. But it's getting so good, so fast, that
I'm starting to view <em>not</em> using it in production as an
abandonment of professional responsibility. The C library is so deeply
embedded in the software supply chain, and so depended upon, that you
really don't want it to be a planet killer. If essential unquestioned
tools are this wasteful then it's no wonder Amazon Cloud makes such a
fortune.

</p><p>
Last but not least, we have MacOS.

</p><div>
<table>
<tbody><tr>
  <th colspan="4"><p>
      MacOS Mutex Implementations<br>
      M2 Ultra

</p></th></tr><tr>
  <th>wall<br>time (µs)
  </th><th>user<br>time (µs)
  </th><th>system<br>time (µs)
  </th><th>implementation

</th></tr><tr>
  <td>52,263
  </td><td>43,202
  </td><td>911,009
  </td><td>Apple Libc

</td></tr><tr>
  <td>54,700
  </td><td>63,055
  </td><td>1,003,674
  </td><td>Cosmopolitan pthread_mutex_t

</td></tr></tbody></table>
</div>

<p>
On MacOS with an M2 ARM64 microprocessor, Apple's Libc slightly
outperforms Cosmopolitan's mutexes. For reasons I do not yet fully
understand, Cosmopolitan's normal mutex implementation doesn't work well
on this platform. It's possibly because the M2 and XNU are in league. So
on MacOS ARM, Cosmopolitan uses a simpler algorithm based on Ulrich
Drepper's
"<a href="https://dept-info.labri.fr/~denis/Enseignement/2008-IR/Articles/01-futex.pdf">Futexes
Are Tricky</a>" paper that basically just farms out all the heavy
lifting to XNU's ulock system calls. That's why performance is nearly
identical to what Apple does.

</p><p>
So in summary, these benchmark results indicate that Cosmopolitan
mutexes, in the best case, will be overwhelmingly better than
alternatives at the contended + tiny critical section use case, and in
the worst case, Cosmopolitan will be roughly as good.

</p><h3>How I Did It</h3>

<p>
The reason why Cosmopolitan Mutexes are so good is because I used a
library called <a href="https://github.com/google/nsync">nsync</a>. It
only has 371 stars on GitHub, but it was written by a distinguished
engineer at Google named Mike Burrows. If you don't know who he is, he's
the guy who coded Google's fiercest competitor, which was Altavista. If
you're not old enough to remember Altavista, it was the first search
engine that was good, and it ran on a single computer.

</p><p>
I've had a lot of fun integrating nsync into Cosmopolitan. I've even
had the opportunity to make upstream contributions. For example, I found
and fixed a bug in his mutex unlock function that had gone undiscovered
for years. I also managed to make contended nsync mutexes go 30% faster
than nsync upstream on AARCH64, by porting it to use C11 atomics. I
wrote new system integration for things like futexes that enable it do
portability at runtime. Lastly I made it work seamlessly with POSIX
thread cancelations.

</p><p>
So how does nsync do it? What are the tricks that it uses? Here's some
of my takes and analysis:

</p><ul>

<li>
nsync uses an optimistic CAS (compare and swap) immediately, so that
locking happens quickly when there's no contention.

</li><li>
When a lock can't be acquired, nsync adds the calling thread to a
doubly linked list of waiters. Each waiter gets its own semaphore on a
separate independent cacheline. This serves an important purpose. Once a
thread enters the wait state, it's no longer touching the main lock. To
understand why that's important, read Ulrich Drepper's paper
"<a href="https://people.freebsd.org/~lstewart/articles/cpumemory.pdf">What
Every Programmer Should Know About Memory</a>". He goes into great depth
on the coherency protocols used by modern microprocessors, where cores
basically talk to each other under the hood about which cachelines
they're using. When multiple cores touch the same ones, that creates a
lot of communication overhead within the processor.

</li><li>
nsync enlists the help of the operating system by using futexes. This is
a great abstraction invented by Linux some years ago, that quickly found
its way into other OSes. On MacOS, futexes are called ulock. On Windows,
futexes are called <code>WaitOnAddress()</code>. The only OS Cosmo
supports that doesn't have futexes is NetBSD, which implements POSIX
semaphores in kernelspace, and each semaphore sadly requires creating a
new file descriptor. But the important thing about futexes and
semaphores is they allow the OS to put a thread to sleep. That's what
lets nsync avoid consuming CPU time when there's nothing to do.

</li><li>
nsync avoids starvation with this concept of a "long wait". If a waiter
gets woken 30 times and fails to acquire the lock internally every time,
then nsync adds a bit to the lock that prevents threads that haven't
waited yet from acquiring. This means that initial CAS at the beginning
will fail for everyone else until the queue has had some time to clear.

</li><li>
nsync makes the use case we benchmarked go fast (contended lock with a
small critical section) using this concept of a "designated waker". This
bit on the main lock is set when a thread is awake and trying to acquire
the lock. In nsync, the unlock function is what's responsible for waking
the next thread in line waiting for the lock. Having this bit allows the
unlocking thread to know it needn't bother waking a second locker since
one is already awake.

</li></ul>

<p>
To learn more of nsync's secrets, you can read the source code here:
<a href="https://github.com/jart/cosmopolitan/tree/master/third_party/nsync/mu.c"><code>cosmopolitan/third_party/nsync/mu.c</code></a>.
See also
<a href="https://github.com/jart/cosmopolitan/tree/master/libc/intrin/pthread_mutex_lock.c"><code>cosmopolitan/libc/intrin/pthread_mutex_lock.c</code></a>.

</p><h3>Online Proof</h3>

<p>
If you want to see a live demo of a piece of software built with Cosmo
mutexes, then do your worst DDOS to the
<a href="http://ipv4.games/">http://ipv4.games/</a> web server. Now this
is truly a game for hackers, competing to dominate the Internet. You're
already playing this game because your IP was just claimed for jart. The
service runs on a GCE VM with 2 cores and so far it's managed to survive
being DDOS'd by botnets as large as 49,131,669 IPs. A lot of that is
thanks to nsync which allowed me to move SQL queries to background
threads which send messages to each other. There are still improvements
to be made, but overall it's held up well. You can even monitor
its <a href="http://ipv4.games/statusz">/statusz</a> health metrics.

</p><h3>Source Code</h3>

<pre><span>#define ITERATIONS 100000
#define THREADS    30</span>

<span>int</span> g_chores;
<span>pthread_mutex_t</span> g_locker = PTHREAD_MUTEX_INITIALIZER;

<span>void</span> *<span>worker</span>(<span>void</span> *arg) {
  <span>for</span> (<span>int</span> i = 0; i &lt; ITERATIONS; ++i) {
    pthread_mutex_lock(&amp;g_locker);
    ++g_chores;
    pthread_mutex_unlock(&amp;g_locker);
  }
  <span>return</span> 0;
}

<span>struct</span> <span>timeval</span> <span>tub</span>(<span>struct</span> <span>timeval</span> a, <span>struct</span> <span>timeval</span> b) {
  a.tv_sec -= b.tv_sec;
  <span>if</span> (a.tv_usec &lt; b.tv_usec) {
    a.tv_usec += 1000000;
    a.tv_sec--;
  }
  a.tv_usec -= b.tv_usec;
  <span>return</span> a;
}

<span>long</span> <span>tomicros</span>(<span>struct</span> <span>timeval</span> x) {
  <span>return</span> x.tv_sec * 1000000ul + x.tv_usec;
}

<span>int</span> <span>main</span>() {
  <span>struct</span> <span>timeval</span> start;
  gettimeofday(&amp;start, 0);

  <span>pthread_t</span> th[THREADS];
  for (int i = 0; i &lt; THREADS; ++i)
    pthread_create(&amp;th[i], 0, worker, 0);
  for (int i = 0; i &lt; THREADS; ++i)
    pthread_join(th[i], 0);
  assert(g_chores == THREADS * ITERATIONS);

  <span>struct</span> <span>rusage</span> ru;
  <span>struct</span> <span>timeval</span> end;
  gettimeofday(&amp;end, 0);
  getrusage(RUSAGE_SELF, &amp;ru);
  printf(<span>"%16ld us real\n"</span>
         <span>"%16ld us user\n"</span>
         <span>"%16ld us sys\n"</span>,
         tomicros(tub(end, start)),
         tomicros(ru.ru_utime),
         tomicros(ru.ru_stime));
}

</pre>

<p>
The reason we care about the contended case, because that's where mutex
implementations show their inequality. Uncontended mutexes usually
perform the same across implementations, and even then you might be
better off with a spin lock, which only takes a few lines:

</p><pre><span>void</span> <span>spin_lock</span>(<span>atomic_int</span> *lock) {
  if (atomic_exchange_explicit(lock, 1, memory_order_acquire)) {
    <span>for</span> (;;) {
      <span>for</span> (;;)
        <span>if</span> (!atomic_load_explicit(lock, memory_order_relaxed))
          <span>break</span>;
      <span>if</span> (!atomic_exchange_explicit(lock, 1, memory_order_acquire))
        <span>break</span>;
    }
  }
}

<span>void</span> <span>spin_unlock</span>(<span>atomic_int</span> *lock) {
  atomic_store_explicit(lock, 0, memory_order_release);
}
</pre>

<p>
Please note that spin locks should really only be used when you have no
other choice. They're useful in kernels, where extreme low level
constraints disallow anything fancy. Spin locks are also a useful
implementation detail in nsync locks. But overall they're bad. I imagine
many developers believe they're good. If so, it's probably because
they've only benchmarked wall time. With locks, it's important to take
CPU time into consideration too. That's why we use
<code>getrusage()</code>.

</p><h2 class="page" id="funding"><a href="#funding">Funding</a></h2>

<p>
  <a href="https://justine.lol/lemuria.png">
    <picture>
      <source srcset="https://worker.jart.workers.dev/sectorlisp2/lemuria.webp" type="image/webp">
      <img src="https://worker.jart.workers.dev/sectorlisp2/lemuria.png" width="850" height="360" alt="[United States of Lemuria - two dollar bill - all debts public and primate]">
    </picture>
  </a>

</p><p>
Funding for The Fastest Mutex was crowdsourced from Justine
Tunney's <a href="https://github.com/sponsors/jart">GitHub sponsors</a>
and <a href="https://www.patreon.com/jart">Patreon subscribers</a>, the
backing of
<a href="https://future.mozilla.org/mieco/">Mozilla's MIECO program</a>,
and the generous contributions of our
<a href="https://discord.gg/FwAVVu7eJ4">developer community</a> on
Discord. Your support is what makes projects like Cosmopolitan possible.
Thank you!

</p>
<img src="https://ipv4.games/claim?name=jart">
</div>]]></description>
        </item>
        <item>
            <title><![CDATA[American WWII bomb explodes at Japanese airport, causing large crater in taxiway (274 pts)]]></title>
            <link>https://www.cnn.com/2024/10/02/travel/wwii-bomb-miyazaki-airport-japan-scli-intl/index.html</link>
            <guid>41721567</guid>
            <pubDate>Wed, 02 Oct 2024 15:22:11 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.cnn.com/2024/10/02/travel/wwii-bomb-miyazaki-airport-japan-scli-intl/index.html">https://www.cnn.com/2024/10/02/travel/wwii-bomb-miyazaki-airport-japan-scli-intl/index.html</a>, See on <a href="https://news.ycombinator.com/item?id=41721567">Hacker News</a></p>
<div id="readability-page-1" class="page"><section data-editable="main" data-track-zone="main" data-reorderable="main">  <article data-uri="cms.cnn.com/_components/article/instances/cm1rwxx2i000whzqq8c9whnqb@published" role="main" data-drag-disable="true" data-unselectable="true" data-regwall-disabled="false" data-subscription-only="false" data-paywall-disabled="false">
      
  <section data-tabcontent="Content">
    <main>
                <div data-image-variation="image" data-breakpoints="{&quot;image--eq-extra-small&quot;: 115, &quot;image--eq-small&quot;: 300}" data-uri="cms.cnn.com/_components/image/instances/cm1rx7zq6000x356k3dt6urfs@published" data-name="GettyImages-2175357542.jpg" data-component-name="image" data-observe-resizes="" data-original-ratio="0.667" data-original-height="1334" data-original-width="2000" data-url="https://media.cnn.com/api/v1/images/stellar/prod/gettyimages-2175357542.jpg?c=original" data-editable="lede" data-freewheel-lede="true">
       <picture><source height="383" width="680" media="(max-width: 479px)" srcset="https://media.cnn.com/api/v1/images/stellar/prod/gettyimages-2175357542.jpg?c=16x9&amp;q=h_383,w_680,c_fill/f_webp" type="image/webp"><source height="653" width="1160" media="(min-width: 480px)" srcset="https://media.cnn.com/api/v1/images/stellar/prod/gettyimages-2175357542.jpg?c=16x9&amp;q=h_653,w_1160,c_fill/f_webp" type="image/webp"><source height="605" width="1075" media="(min-width: 960px)" srcset="https://media.cnn.com/api/v1/images/stellar/prod/gettyimages-2175357542.jpg?c=16x9&amp;q=h_605,w_1075,c_fill/f_webp" type="image/webp"><source height="833" width="1480" media="(min-width: 1280px)" srcset="https://media.cnn.com/api/v1/images/stellar/prod/gettyimages-2175357542.jpg?c=16x9&amp;q=h_833,w_1480,c_fill/f_webp" type="image/webp"><img src="https://media.cnn.com/api/v1/images/stellar/prod/gettyimages-2175357542.jpg?c=16x9&amp;q=h_833,w_1480,c_fill" alt="A crater from the explosion at Miyazaki Airport" onload="this.classList.remove('image__dam-img--loading')" onerror="imageLoadError(this)" height="1334" width="2000"></picture>
    </div>
        
        
        
          <div data-editable="content" itemprop="articleBody" data-reorderable="content">
                  <p><cite>
      <span data-editable="location">Tokyo</span>
      <span data-editable="source">AP</span>
        &nbsp;—&nbsp;
    </cite>
</p>

    <p data-uri="cms.cnn.com/_components/paragraph/instances/cm1rwxx2i000vhzqqcpal5ftf@published" data-editable="text" data-component-name="paragraph" data-article-gutter="true">
            An unexploded American bomb from World War II that had been buried at a Japanese airport exploded Wednesday, causing a large crater in a taxiway and the cancellation of more than 80 flights but no injuries, Japanese officials said.
    </p>

    <p data-uri="cms.cnn.com/_components/paragraph/instances/cm1rx1ed80007356k3bbqlcj3@published" data-editable="text" data-component-name="paragraph" data-article-gutter="true">
            Land and Transport Ministry officials said there were no aircraft nearby when the bomb exploded at Miyazaki Airport in southwestern Japan.
    </p>

    <p data-uri="cms.cnn.com/_components/paragraph/instances/cm1rx1k3z0009356kvyrq0f7n@published" data-editable="text" data-component-name="paragraph" data-article-gutter="true">
            Officials said an investigation by the Self-Defense Forces and police confirmed that the explosion was caused by a 500-pound US bomb and there was no further danger. They were determining what caused its sudden detonation.
    </p>

  


    <p data-uri="cms.cnn.com/_components/paragraph/instances/cm1rx1lze000b356ktnn3fkos@published" data-editable="text" data-component-name="paragraph" data-article-gutter="true">
            A video recorded by a nearby aviation school showed the blast spewing pieces of asphalt into the air like a fountain.
    </p>

    <p data-uri="cms.cnn.com/_components/paragraph/instances/cm1rx7pbb000v356k5dicgg2t@published" data-editable="text" data-component-name="paragraph" data-article-gutter="true">
            Videos broadcast on Japanese television showed a crater in the taxiway reportedly about 7 meters (23 feet) in diameter and 1 meter (3 feet) deep.
    </p>

    <p data-uri="cms.cnn.com/_components/paragraph/instances/cm1rx1odc000d356kjghq1wup@published" data-editable="text" data-component-name="paragraph" data-article-gutter="true">
            Chief Cabinet Secretary Yoshimasa Hayashi said more than 80 flights had been canceled at the airport, which hopes to resume operations on Thursday morning.
    </p>

    <p data-uri="cms.cnn.com/_components/paragraph/instances/cm1rx1vg4000f356ktk4157xu@published" data-editable="text" data-component-name="paragraph" data-article-gutter="true">
            Miyazaki Airport was built in 1943 as a former Imperial Japanese Navy flight training field from which some kamikaze pilots took off on suicide attack missions.
    </p>

    <p data-uri="cms.cnn.com/_components/paragraph/instances/cm1rx1x2q000h356kw7pc14ig@published" data-editable="text" data-component-name="paragraph" data-article-gutter="true">
            A number of unexploded bombs dropped by the US military during World War II have been unearthed in the area, Defense Ministry officials said.
    </p>

    <p data-uri="cms.cnn.com/_components/paragraph/instances/cm1rx6s1p000s356kaecsj4ec@published" data-editable="text" data-component-name="paragraph" data-article-gutter="true">
            Hundreds of tons of unexploded bombs from the war remain buried around Japan and are sometimes dug up at construction sites.
    </p>

              </div>
    </main>
  </section>
</article>

</section></div>]]></description>
        </item>
        <item>
            <title><![CDATA[VC Fund gives money back, says the market for mature startups is too weak (148 pts)]]></title>
            <link>https://www.nytimes.com/2024/10/02/technology/crv-vc-fund-returning-money.html</link>
            <guid>41721368</guid>
            <pubDate>Wed, 02 Oct 2024 15:04:25 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.nytimes.com/2024/10/02/technology/crv-vc-fund-returning-money.html">https://www.nytimes.com/2024/10/02/technology/crv-vc-fund-returning-money.html</a>, See on <a href="https://news.ycombinator.com/item?id=41721368">Hacker News</a></p>
Couldn't get https://www.nytimes.com/2024/10/02/technology/crv-vc-fund-returning-money.html: Error: Request failed with status code 403]]></description>
        </item>
        <item>
            <title><![CDATA[The bunkbed conjecture is false (129 pts)]]></title>
            <link>https://igorpak.wordpress.com/2024/10/01/the-bunkbed-conjecture-is-false/</link>
            <guid>41721318</guid>
            <pubDate>Wed, 02 Oct 2024 15:01:08 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://igorpak.wordpress.com/2024/10/01/the-bunkbed-conjecture-is-false/">https://igorpak.wordpress.com/2024/10/01/the-bunkbed-conjecture-is-false/</a>, See on <a href="https://news.ycombinator.com/item?id=41721318">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
			
<p>What follows is an unusual story of perseverance. We start with a conjecture and after some plot twists  end up discussing the meaning of truth. While the title is a spoiler, you might not be able to guess how we got there…</p>



<h4>The conjecture</h4>



<p>The <strong><em><a href="https://en.wikipedia.org/wiki/Bunkbed_conjecture">bunkbed conjecture</a></em></strong> (BBC) is a basic claim about random subgraphs. Start with a finite graph <em><strong>G</strong></em><strong>=(<em>V</em>,<em>E</em>)</strong> and consider a product graph <strong><em>G</em> <em>x</em> <em>K</em><sub>2</sub></strong> obtained by connecting the corresponding vertices on levels <strong><em>V</em><sup>(1)</sup></strong> and <strong><em>V</em><sup>(2)</sup></strong>.  Sort of like a <a href="https://i.etsystatic.com/22453533/r/il/81fe4f/3189746867/il_1588xN.3189746867_dodu.jpg">bunkbed</a>.  Now consider random subgraphs of a this product graph.  </p>



<blockquote>
<p><strong><mark>Bunkbed Conjecture:</mark></strong>  The probability that vertices <em><strong>u</strong></em><sup><strong>(1)</strong></sup> and <em><strong>v</strong></em><sup><strong>(1)</strong></sup> are connected is greater or equal than the probability that vertices <em><strong>u</strong></em><sup><strong>(1)</strong></sup> and <strong><em>v</em></strong><sup><strong>(2)</strong></sup> are connected.</p>
</blockquote>



<p>In other words, the probability of connecting two vertices on the same level cannot be smaller than when connect vertices on different levels. This is completely obvious, of course! And yet the conjecture this problem defeated several generations of probabilists and remained open until now. For a good reason, of course. It was <em><a href="https://as1.ftcdn.net/v2/jpg/04/87/13/32/1000_F_487133220_dPDd98wC3pFZcHxs4wfEnZYDAO4wDqLd.jpg">false</a></em>!</p>



<p>The origins of the conjecture are murky, but according to <a href="https://www.jstor.org/stable/2652916">van den Berg and Kahn</a> it was conjectured by <a href="https://en.wikipedia.org/wiki/Pieter_Kasteleyn">Kasteleyn </a>in the early 1980s. There are many versions of this conjecture; notably one can condition on the subset of vertical edges and ask the same question. Many partial results are known, as well as results for other probabilistic models. The conjecture is <em><strong><mark>false</mark></strong></em> nonetheless!</p>



<h4>The direction</h4>



<p>Why look for a counterexample if the conjecture is so obviously true?  Well, because you always should.  For any conjecture.  Especially if everyone else is so <em><strong>sure</strong></em>, as in <em>completely absolutely sure without a doubt</em>, that the conjecture is true.  <strong><em><mark>What if they are all wrong?</mark></em></strong>  I discuss this at length in <a href="https://wp.me/p211iQ-uT">this blog post</a>, so there is no need to rehash this point.  </p>



<h4>The counterexample</h4>



<p>We disprove the conjecture in a<strong> <a href="https://www.math.ucla.edu/~pak/papers/BunkBed4.pdf">joint paper</a></strong> with <a href="https://www.math.ucla.edu/~gladkovna/">Nikita Gladkov</a> (UCLA) and <a href="https://web.mit.edu/azimin/www/">Alexandr Zimin</a> (MIT), both graduate students.  Roughly speaking we take the following 3-hypergraph from a <a href="https://arxiv.org/abs/2406.01790">recent paper</a> by <a href="https://scholar.google.com/citations?user=PabtgaQAAAAJ&amp;hl=en">Hollom</a>.  </p>



<figure><a href="https://igorpak.wordpress.com/wp-content/uploads/2024/10/hollom-graph.png"><img data-attachment-id="3238" data-permalink="https://igorpak.wordpress.com/2024/10/01/the-bunkbed-conjecture-is-false/hollom-graph/" data-orig-file="https://igorpak.wordpress.com/wp-content/uploads/2024/10/hollom-graph.png" data-orig-size="1043,1326" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Hollom-graph" data-image-description="" data-image-caption="" data-medium-file="https://igorpak.wordpress.com/wp-content/uploads/2024/10/hollom-graph.png?w=236" data-large-file="https://igorpak.wordpress.com/wp-content/uploads/2024/10/hollom-graph.png?w=595" tabindex="0" role="button" width="805" height="1023" src="https://igorpak.wordpress.com/wp-content/uploads/2024/10/hollom-graph.png?w=805" alt=""></a></figure>



<p>We then replace each yellow triangle with the following gadget using <em>n</em>=1204, placing <em>a</em> in the shaded vertex, while <em><strong>v</strong></em><sub><strong>1</strong></sub> and <em><strong>v</strong></em><sub><strong>n</strong></sub> are placed in the other vertices of the triangle (so the red path goes into the red path).  For a stronger version of the conjecture that’s all there is.  For a weaker version, some additional tweaks needed to be made (they are not so important).  And we are done!  </p>



<figure><a href="https://igorpak.wordpress.com/wp-content/uploads/2024/10/image.png"><img data-attachment-id="3242" data-permalink="https://igorpak.wordpress.com/2024/10/01/the-bunkbed-conjecture-is-false/image-14/" data-orig-file="https://igorpak.wordpress.com/wp-content/uploads/2024/10/image.png" data-orig-size="799,436" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://igorpak.wordpress.com/wp-content/uploads/2024/10/image.png?w=300" data-large-file="https://igorpak.wordpress.com/wp-content/uploads/2024/10/image.png?w=595" tabindex="0" role="button" width="799" height="436" src="https://igorpak.wordpress.com/wp-content/uploads/2024/10/image.png?w=799" alt=""></a></figure>



<p>The resulting graph is has 7523 vertices and 15654 edges.   The difference between probabilities for paths between <strong><em>u</em><sub>1</sub></strong> and <strong><em>u</em><sub>10</sub></strong> at the same and different levels as in the conjecture is astronomically small, on the order of -10<sup>-6500</sup>.  But it’s negative, which is all we need.  Very very roughly speaking, the red path is the only path which avoids shaded vertices and creates a certain bias which give this probability gap.  Formalizing this is a bit technical.  </p>



<h4>The experiments</h4>



<p>Of course, the obvious way to verify our counterexample computationally would fail miserably — the graph is much too large.  Instead, we give a relatively elementary completely combinatorial disproof of the BBC that is accessible to a wide audience.  I would rather not rehash technical details and ideas in the proof — it’s all in <strong><a href="https://www.math.ucla.edu/~pak/papers/BunkBed4.pdf">our paper</a></strong>, which is only 12 pages!   See also the <a href="https://github.com/Kroneckera/bunkbed-counterexample">GitHub code</a> and some <a href="https://web.mit.edu/azimin/www/notebooks/bunkbed_counterexample.html">explanation</a>. </p>



<p>I do want to mention that giving formal disproof was not our first choice.  It’s what we ended up doing after many failures.  There is always a bit of a stigma people have about publicly discussing their failures.  I know very few examples, only <a href="https://www.scribd.com/document/549797884/How-Not-to-Prove-Poincare-Conjecture">this one</a> famous enough to be mentioned.   So let me mention briefly how we failed.  </p>



<p>Since I was sure the bunkbed conjecture is false (for reasons somewhat different from my contrarian philosophy), we started with a myriad of computer experiments trying all small graphs.  When those failed, we tried to use AI and other computer assisted tools.  We burned many hours on a giant <em><a href="https://www.hoffman2.idre.ucla.edu/">UCLA Hoffman2 Cluster</a></em> getting closer for a while.  In hindsight, we didn’t look in the right place, obviously.  After several months of computer experiments and no clear counterexample, it felt we are wasting time.  We then thought a bit more about philosophy of what we are doing and stopped.  </p>



<p>Before I tell you why we stopped, let me make a <strong>general recommendation</strong>.  Please do try computer experiments for whatever you are working on.  Make an effort to think it through and design a good experiment.  Work hard to test as much as your computer technology allows.  If you need some computing power, ask around.  Your university might just have the resources.  Occasionally, you can even <a href="https://epubs.siam.org/doi/abs/10.1137/120867366">ask a private company</a> to donate theirs.  </p>



<p>If you succeed, write a paper and publish it.  Make your code and work notes publicly available.  If you fail, do exactly the same.  If the journals refuse to publish your paper, just keep it on the arXiv.  Other people in your area would want to know.  And as far as the NSF is concerned, all of this is “work product”.  You can’t change the nature of the problem and the results you are getting, but you deserve the credit regardless.  </p>



<p><strong>Let me repeat:</strong> Do not fear telling other you have not succeeded in your computer testing.  Fear others making the same mistakes or repeating the same work that you did.</p>



<h4>The curse</h4>



<p>One reason we stopped is because in our initial rush to testing we failed to contemplate the implications of Monte Carlo testing of even moderately large graphs.  Here is a quote from the paper:</p>



<blockquote>
<p>Suppose we did find a potential counterexample graph with only <em>m</em>=100 edges and the probability gap was large enough to be statistically detectable. Since analyzing all of 2<sup>m</sup> ≈ 10<sup>30</sup> subgraphs is not feasible, our Monte Carlo simulations could only confirm the desired inequality with high probability. While this probability could be amplified by repeated testing, one could never formally disprove the bunkbed conjecture this way, of course. </p>



<p><br>This raises somewhat uncomfortable questions whether the mathematical community is ready to live with an uncertainty over validity of formal claims that are only known with high probability. It is also unclear whether in this imaginary world the granting agencies would be willing to support costly computational projects to further increase such probabilities (cf. [<a href="https://arxiv.org/abs/1609.03543">Garrabrant+’16</a>], [<a href="https://arxiv.org/abs/math/9301202">Zeilberger’93</a>]). Fortunately, our failed computational effort avoided this dystopian reality, and we were able to disprove the bunkbed conjecture by a formal argument.</p>
</blockquote>



<p>Societal implications aside, it is an interesting question whether a reputable math journal <em>should </em>accept a counterexample that is tested with 99.99% confidence, and the results can be replicated and rechecked by others.  Five sigma may be a <a href="https://home.cern/resources/faqs/five-sigma">gold standard</a> in nuclear physics, but math journals tend to prefer 100% correctness (even though <a href="https://retractionwatch.com/2017/02/13/journal-retracts-paper-state-senator-former-mathematician/">some papers</a> they publish are 100% incorrect).  </p>



<p>What I <em>do know</em>, is that most journals would refuse to even <em>consider</em> a “five sigma counterexample”.  While details of the situations differ quite a bit, I knew <a href="https://sites.math.rutgers.edu/~zeilberg/Opinion121.html">what happened</a> to the (rather interesting) Sills–Zeilberger paper, which was <a href="https://www.tandfonline.com/doi/full/10.1080/10236198.2012.678837">eventually published</a>, but not after several desk rejections.  But PhD students need jobs in reality, not in theory.  That is really why we stopped.  Why persevere and create controversy when you can just try doing something else?  </p>



<p><strong>P.S.</strong> There is yet another layer to all of this. Back in 1999, I asked <a href="https://en.wikipedia.org/wiki/Avi_Wigderson">Avi Wigderson</a> if <strong>P=BPP</strong>? He said “<em>Yes</em>“. Last week I asked him again. This is 25 years later, almost to the day. He said “<em>Yes, I am absolutely sure of that</em>.” It’s one of his <a href="https://www.zdnet.com/article/for-turing-award-winner-everything-is-computation-and-some-problems-are-unsolvable/">favorite conjectures</a>, of course. If he is right, every probabilistic counterexample can be turned into deterministic. In other words, there would be a fully rigorous way to estimate both probabilities and prove on a computer that the conjecture is false. But you must have guessed what I was thinking when I heard what he said — now he used “<em>absolutely sure</em>“…</p>
						
		</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Show HN: I made a game you can play without anyone knowing (No Visuals/Sound) (352 pts)]]></title>
            <link>https://apps.apple.com/us/app/tik/id6720712299</link>
            <guid>41719531</guid>
            <pubDate>Wed, 02 Oct 2024 11:48:29 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://apps.apple.com/us/app/tik/id6720712299">https://apps.apple.com/us/app/tik/id6720712299</a>, See on <a href="https://news.ycombinator.com/item?id=41719531">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
  
<!---->
<!---->
<!---->
    

<!---->
    <section>
      <h2>iPhone Screenshots</h2>
  
</section>


  <div dir="" data-test-bidi=""><p>There are times in life, when we have to be present. We can't be seen looking at our phones, no matter how boring the activity in front of us may be. So we just sit there, losing brain cells by the second. At least, thats how things were BEFORE TIK!</p><p>LIFE AFTER TIK:<br>Boredom is a thing of the past! Tik has no sounds or visuals, meaning you can play it anytime, anywhere! Just hold your phone in your hand, whether it be under a desk or in your pocket, and tap away! Because Tik uses haptic feedback (the thing your phone does when you make a purchase, or hold the send button in iMessages for a couple seconds) in order to provide interactive, immersive gameplay, there's no need to ever look at the screen or hear anything!</p><p>OK. SO HOW DOES TIK WORK?<br>You will feel a series of 5 to 8 “Tiks” (haptic vibrations). Then, try to copy the rhythm of the sequence by tapping it anywhere on the screen. If the timing of your taps is close enough, you win! If not, Tik will replay the sequence so you can try again.</p><p>THIS SEEMS TOO GOOD TO BE TRUE!<br>It Is! Well, almost, because it is true! Download Tik today and say goodbye to mundane meetings and boring presentations forever!</p><p>HAVE A QUESTION?<br>We would love to hear it! Please reach out to us at freestyle.feedback@gmail.com</p><p>(One more thing. We realize that Tik may be accessible to those with certain disabilities since the game relies solely on haptic feedback. We have added accessibility support within the app, but if there is anything else we can add to make the app more accessible please let us know by reaching out at freestyle.feedback@gmail.com or by telling us in a review. Thank you!)</p></div>

<!---->
  <div>
      <h2>What’s New</h2>
        

    </div>

<!---->
<!---->
<!---->
<!---->
  <section>
  <div>
    <h2>
      App Privacy
    </h2>

    


  </div>

  <p>
    The developer, <span>Rohan Sachdeva</span>, indicated that the app’s privacy practices may include handling of data as described below. For more information, see the <a href="https://sites.google.com/view/tik-game/home">developer’s privacy policy</a>.
  </p>

  <div>
        
        <h3>Data Not Collected</h3>
        <p>The developer does not collect any data from this app.</p>
<!---->      </div>

    <p>Privacy practices may vary, for example, based on the features you use or your age. <a href="https://apps.apple.com/story/id1538632801">Learn&nbsp;More</a></p>
</section>


<section>
  <div>
    <h2>Information</h2>
    <dl>
        <p>
          <dt>Seller</dt>
          <dd>
              Rohan Sachdeva
          </dd>
        </p>
        <p>
          <dt>Size</dt>
          <dd aria-label="367.6 kilobytes">367.6 KB</dd>
        </p>
        <p>
          <dt>Category</dt>
          <dd>
              <a href="https://itunes.apple.com/us/genre/id6014" data-metrics-click="{&quot;actionType&quot;:&quot;navigate&quot;,&quot;actionUrl&quot;:&quot;https://itunes.apple.com/us/genre/id6014&quot;,&quot;targetType&quot;:&quot;link&quot;,&quot;targetId&quot;:&quot;GenrePage&quot;}">
                Games
              </a>
          </dd>
        </p>
      <div>
        <dt>Compatibility</dt>
          <dd>
              <dl>
                <dt>
                  iPhone
                </dt>
                <dd>Requires iOS 14.0 or later.
                </dd>
              </dl>
              <dl>
                <dt>
                  iPod&nbsp;touch
                </dt>
                <dd>Requires iOS 14.0 or later.
                </dd>
              </dl>
          </dd>
      </div>
<!---->      
      
<!---->      <p>
        <dt>Copyright</dt>
        <dd>© 2024 Rohan Sachdeva</dd>
      </p>
        <p>
          <dt>Price</dt>
          <dd>$0.95</dd>
        </p>
<!---->
    </dl>
  </div>
  <div>
    <ul>
<!---->        <li>
          <a data-metrics-click="{&quot;actionType&quot;:&quot;navigate&quot;,&quot;targetType&quot;:&quot;link&quot;,&quot;targetId&quot;:&quot;LinkToAppSupport&quot;}" href="https://sites.google.com/view/tik-game/home">
            App Support
          </a>
        </li>
        <li>
          <a data-metrics-click="{&quot;actionType&quot;:&quot;navigate&quot;,&quot;targetType&quot;:&quot;link&quot;,&quot;targetId&quot;:&quot;LinkToPrivacyPolicy&quot;}" href="https://sites.google.com/view/tik-game/home">
            Privacy Policy
          </a>
        </li>
<!----><!---->    </ul>
  </div>
</section>

<section>
  <ul>
<!---->      <li>
        <a data-metrics-click="{&quot;actionType&quot;:&quot;navigate&quot;,&quot;targetType&quot;:&quot;link&quot;,&quot;targetId&quot;:&quot;LinkToAppSupport&quot;}" href="https://sites.google.com/view/tik-game/home">
          App Support
        </a>
      </li>
<!---->      <li>
        <a data-metrics-click="{&quot;actionType&quot;:&quot;navigate&quot;,&quot;targetType&quot;:&quot;link&quot;,&quot;targetId&quot;:&quot;LinkToPrivacyPolicy&quot;}" href="https://sites.google.com/view/tik-game/home">
          Privacy Policy
        </a>
      </li>
  </ul>
</section>

  <section>
    <p>
      <h2>Supports</h2>
    </p>
    <ul>
        <li>
          <img src="https://apps.apple.com/assets/images/supports/supports-FamilySharing@2x-f58f31bc78fe9fe7be3565abccbecb34.png" alt="" role="presentation">
          <div>
              <h3 dir="ltr">
    Family Sharing
</h3>


              <h4 dir="">
        

                    <p data-test-bidi="">Up to six family members can use this app with Family&nbsp;Sharing enabled.</p>

    


<!----></h4>


          </div>
        </li>
    </ul>
  </section>

<!---->
    <section>
      <p>
        <h2>
          More By This Developer
        </h2>
        <!---->
      </p>

      
    </section>

<!---->

<!---->

<!----></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[You Too Could Have Made Curl (131 pts)]]></title>
            <link>https://daniel.haxx.se/blog/2024/02/06/fosdem-2024-you-too-could-have-made-curl/</link>
            <guid>41719031</guid>
            <pubDate>Wed, 02 Oct 2024 10:24:22 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://daniel.haxx.se/blog/2024/02/06/fosdem-2024-you-too-could-have-made-curl/">https://daniel.haxx.se/blog/2024/02/06/fosdem-2024-you-too-could-have-made-curl/</a>, See on <a href="https://news.ycombinator.com/item?id=41719031">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="page">

	<div id="primary" role="main">
			
<article id="post-24163">
	
		<p><img width="672" height="345" src="https://daniel.haxx.se/blog/wp-content/uploads/2020/02/http3-for-everyone-audience.jpg" alt="" decoding="async">		</p>

		
	<!-- .entry-header -->

		<div>
		
<figure><p>
<iframe title="you too could have made curl - Daniel Stenberg at FOSDEM 2024" width="474" height="267" src="https://www.youtube.com/embed/kCJmAyUr1j4?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen=""></iframe>
</p></figure>



<p>This is the video recording of my talk with this title, done at February 4, 2024 10:00 in the K1.105 room at FOSDEM 2024. The room can hold some 800 people but there were a few hundred seats still unoccupied. Several people I met up with later have insisted that 10 am on a Sunday is way too early for attending talks…</p>



<p>When I was about to start my talk, the slides would not show on the projector. Yeah, sigh. Nothing surprising maybe, but you always hope you can avoid these problems – in particular in the last moment with a huge audience waiting.</p>



<p>There was this separate video monitor laptop that clearly showed that my laptop would output the correct thing – in a proper resolution (1280 x 720 as per auto-negotiation), but the projector refused to play ball. The live stream could also see my output, so the problem was somehow from the video box to the projector.</p>



<p>Several people eventually got involved, things were rebooted multiple times, cables were yanked and replugged in again. First after I installed <a href="https://christian.amsuess.com/tools/arandr/">arandr</a> and forced-updated the resolution of my HDMI output to 1920×1080  the projector would suddenly show my presentation. (Later on I was told that people had <em>the same</em> problem in this room the day before…)</p>



<p>That was about nine minutes of technical difficulties that is cut out from the recording. Nine minutes to test my nerves and presentation finesse as I had to adapt.</p>
	</div><!-- .entry-content -->
	
	</article><!-- #post-24163 -->
		<nav>
		<h2>
			Post navigation		</h2>
		<!-- .nav-links -->
		</nav><!-- .navigation -->
		
<!-- #comments -->
		</div><!-- #primary -->

<!-- #content-sidebar -->
<div id="secondary">
		<h2>curl, open source and networking</h2>
	
	
		<!-- #primary-sidebar -->
	</div><!-- #secondary -->

		</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Automattic–WP Engine Term Sheet (112 pts)]]></title>
            <link>https://automattic.com/2024/10/01/wpe-terms/</link>
            <guid>41718485</guid>
            <pubDate>Wed, 02 Oct 2024 08:41:46 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://automattic.com/2024/10/01/wpe-terms/">https://automattic.com/2024/10/01/wpe-terms/</a>, See on <a href="https://news.ycombinator.com/item?id=41718485">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="wrapper">
	<main id="content">
				
		
						
<p>One of the many lies in <a href="https://wpengine.com/wp-content/uploads/2024/09/Cease-and-Desist-Letter-to-Automattic-and-Request-to-Preserve-Documents-Sent.pdf">Silver Lake and WP Engine’s C&amp;D</a> was their claim that Automattic demanded money from them moments before our <a href="https://www.youtube.com/watch?v=fnI-QcVSwMU&amp;t=149s">CEO Matt Mullenweg gave his keynote at WordCamp US</a>. </p>



<p>That is not true. Automattic asked for a verbal agreement that WP Engine would give some percentage of their revenue back into WordPress, either in the form of a trademark agreement or employee hours spent on core WordPress.</p>



<p>For transparency, <a href="https://automattic.com/wp-content/uploads/2024/09/term-sheet-wp-engine-inc.-automattic-trademark-license_09.19.2024-1.pdf">Automattic is publishing the full term sheet</a> WP Engine was offered on September 20<sup>th</sup>. Given WP Engine’s behavior, deception, and incompetence since September 20<sup>th</sup> these terms are no longer sufficient.</p>



<p>Lee Wittlinger and Heather Brunner had ample time to resolve this conflict. In an effort to continue our transparency, here are some of the meetings we’ve had with WP Engine over the past 20 months:</p>



<p><strong>February 2023</strong></p>



<ul>
<li>February 23: Matt Mullenweg (Automattic CEO) and Heather Brunner (WP Engine CEO) meet for lunch at Eunice Restaurant in Houston.</li>
</ul>



<p><strong>March 2023</strong></p>



<ul>
<li>March 21: <a href="https://www.youtube.com/watch?v=kKHY6QPnclQ">Matt and Matías Ventura (WP’s Chief Architect) speak at WP Engine’s DE{CODE} conference</a>.</li>
</ul>



<p><strong>November 2023</strong></p>



<ul>
<li>November 28: Matt and Heather Brunner speak via phone.</li>
</ul>



<p><strong>January 2024</strong></p>



<ul>
<li>January 26: Matt and Heather Brunner meet via Zoom.</li>



<li>January 28: Matt, Toni Schneider, and Heather Brunner meet via Zoom. Matt was <a href="https://ma.tt/2024/02/samattical/">heading out on sabbatical</a> and Toni would be continuing discussions as Automattic’s interim CEO.</li>
</ul>



<p><strong>February 2024</strong></p>



<ul>
<li>February 5: Toni and Heather Brunner discuss trademarks and commercial agreement.</li>
</ul>



<p><strong>March 2024</strong></p>



<ul>
<li>March 22: Toni and Paul Maiorana from Automattic meet with Heather, Ezinne Udezue, and Ramadass Prabhakar from WP Engine.</li>



<li>March 29: Toni and Heather Brunner discuss agreement terms via email.</li>
</ul>



<p><strong>May 2024</strong></p>



<ul>
<li>May 30: Automattic shares first term sheet with WP Engine via email.</li>
</ul>



<p><strong>June 2024</strong></p>



<ul>
<li>June 12: Steve Deckert from Automattic meets with Victor Yuan, Carl Hargraves, Ezinne Udezue, and Ramadass Prabhakar from WP Engine.</li>



<li>June 26: Steve follows up with Victor Yuan. Victor requests a call.</li>
</ul>



<p><strong>July 2024</strong></p>



<ul>
<li>July 3:&nbsp;Steve and Jesse Friedman from Automattic meet via Zoom with Victor Yuan from WP Engine to review the terms a second time.</li>



<li>July 16: Steve follows up with Victor Yuan, expressing concern about the timeline.</li>
</ul>



<p><strong>September 2024</strong> </p>



<ul>
<li>September 17: Mark Davies (Automattic CFO) and Lee Wittlinger (Silver Lake managing director and WP Engine board member) meet via Zoom.</li>



<li>September 19: Mark and Lee Wittlinger meet via Zoom.</li>



<li>September 20: Mark and Lee Wittlinger meet by Zoom.</li>
</ul>



<p>On September 19 and 20, Lee Wittlinger and Heather Brunner did not answer any of Matt’s calls.</p>
					</main><!-- #content  -->
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[AMD Inference (180 pts)]]></title>
            <link>https://github.com/slashml/amd_inference</link>
            <guid>41718030</guid>
            <pubDate>Wed, 02 Oct 2024 07:16:10 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/slashml/amd_inference">https://github.com/slashml/amd_inference</a>, See on <a href="https://news.ycombinator.com/item?id=41718030">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto"><h2 tabindex="-1" dir="auto">⚙️ AMD GPU Inference</h2><a id="user-content-️-amd-gpu-inference" aria-label="Permalink: ⚙️ AMD GPU Inference" href="#️-amd-gpu-inference"></a></p>
<p dir="auto"><a href="https://github.com/bentoml/OpenLLM/blob/main/LICENSE"><img src="https://camo.githubusercontent.com/57be334b2d2a3757c225808c0d6c45a33eae0710590ef1b662efcde77a1da63e/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4c6963656e73652d417061636865253230322d677265656e2e737667" alt="License: Apache-2.0" data-canonical-src="https://img.shields.io/badge/License-Apache%202-green.svg"></a>
<a href="https://twitter.com/slash_ml" rel="nofollow"><img src="https://camo.githubusercontent.com/2c432bee872891c8591000ef640a44e5f231d233d56cfbbe8a226a5c4c228f2c/68747470733a2f2f62616467656e2e6e65742f62616467652f69636f6e2f40736c6173685f6d6c2f3030303030303f69636f6e3d74776974746572266c6162656c3d466f6c6c6f77" alt="X" data-canonical-src="https://badgen.net/badge/icon/@slash_ml/000000?icon=twitter&amp;label=Follow"></a>
<a href="https://discord.gg/KyUYq8uX" rel="nofollow"><img src="https://camo.githubusercontent.com/664c15d4fa2ab074a49f42c215d53b98ac607c63fd9b69c1f3d78f9fb2fc8c3a/68747470733a2f2f696d672e736869656c64732e696f2f646973636f72642f3132333435363738393031323334353637383f6c6f676f3d646973636f7264266c6162656c3d4a6f696e253230446973636f7264" alt="Community" data-canonical-src="https://img.shields.io/discord/123456789012345678?logo=discord&amp;label=Join%20Discord"></a></p>
<p dir="auto">This project provides a Docker-based inference engine for running Large Language Models (LLMs) on AMD GPUs. It's designed to work with models from Hugging Face, with a focus on the LLaMA model family.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Prerequisites</h2><a id="user-content-prerequisites" aria-label="Permalink: Prerequisites" href="#prerequisites"></a></p>
<ul dir="auto">
<li>AMD GPU with ROCm support</li>
<li>Docker installed on your system</li>
<li>ROCm drivers installed on your host system (version 5.4.2 or compatible)</li>
</ul>
<p dir="auto"><h2 tabindex="-1" dir="auto">Project Structure</h2><a id="user-content-project-structure" aria-label="Permalink: Project Structure" href="#project-structure"></a></p>
<div data-snippet-clipboard-copy-content="amd-gpu-inference/
├── src/
│   ├── __init__.py
│   ├── engine.py
│   ├── model.py
│   ├── utils.py
│   └── amd_setup.py
├── Dockerfile
├── requirements.txt
├── run_inference.py
├── run-docker-amd.sh
└── README.md"><pre><code>amd-gpu-inference/
├── src/
│   ├── __init__.py
│   ├── engine.py
│   ├── model.py
│   ├── utils.py
│   └── amd_setup.py
├── Dockerfile
├── requirements.txt
├── run_inference.py
├── run-docker-amd.sh
└── README.md
</code></pre></div>
<p dir="auto"><h2 tabindex="-1" dir="auto">Quick Start</h2><a id="user-content-quick-start" aria-label="Permalink: Quick Start" href="#quick-start"></a></p>
<ol dir="auto">
<li>
<p dir="auto">Clone this repository:</p>
<div data-snippet-clipboard-copy-content="git clone https://github.com/yourusername/amd-gpu-inference.git
cd amd-gpu-inference"><pre><code>git clone https://github.com/yourusername/amd-gpu-inference.git
cd amd-gpu-inference
</code></pre></div>
</li>
<li>
<p dir="auto">Make the run script executable:</p>
<div data-snippet-clipboard-copy-content="chmod +x run-docker-amd.sh"><pre><code>chmod +x run-docker-amd.sh
</code></pre></div>
</li>
<li>
<p dir="auto">Run the inference engine with a specified model and prompt:</p>
<div data-snippet-clipboard-copy-content="./run-docker-amd.sh &quot;meta-llama/Llama-2-7b-chat-hf&quot; &quot;Translate the following English text to French: 'Hello, how are you?'&quot;"><pre><code>./run-docker-amd.sh "meta-llama/Llama-2-7b-chat-hf" "Translate the following English text to French: 'Hello, how are you?'"
</code></pre></div>
<p dir="auto">Replace <code>"meta-llama/Llama-2-7b-chat-hf"</code> with the Hugging Face model you want to use, and provide your own prompt.</p>
</li>
</ol>
<p dir="auto"><h2 tabindex="-1" dir="auto">Detailed Usage</h2><a id="user-content-detailed-usage" aria-label="Permalink: Detailed Usage" href="#detailed-usage"></a></p>
<p dir="auto"><h3 tabindex="-1" dir="auto">Aptfile</h3><a id="user-content-aptfile" aria-label="Permalink: Aptfile" href="#aptfile"></a></p>
<p dir="auto">The project includes an <code>Aptfile</code> that lists the necessary ROCm packages to be installed in the Docker container. This ensures that all required ROCm drivers and libraries are available for the inference engine to utilize the AMD GPU effectively.</p>
<p dir="auto"><h3 tabindex="-1" dir="auto">Building the Docker Image</h3><a id="user-content-building-the-docker-image" aria-label="Permalink: Building the Docker Image" href="#building-the-docker-image"></a></p>
<p dir="auto">The <code>run-docker-amd.sh</code> script builds the Docker image automatically. If you want to build it manually, use:</p>
<div data-snippet-clipboard-copy-content="docker build -t amd-gpu-inference ."><pre><code>docker build -t amd-gpu-inference .
</code></pre></div>
<p dir="auto"><h3 tabindex="-1" dir="auto">Running the Container</h3><a id="user-content-running-the-container" aria-label="Permalink: Running the Container" href="#running-the-container"></a></p>
<p dir="auto">The <code>run-docker-amd.sh</code> script handles running the container with the necessary AMD GPU flags. If you want to run it manually:</p>
<div data-snippet-clipboard-copy-content="docker run --rm -it \
    --device=/dev/kfd \
    --device=/dev/dri \
    --group-add=video \
    --cap-add=SYS_PTRACE \
    --security-opt seccomp=unconfined \
    amd-gpu-inference &quot;model_name&quot; &quot;your prompt here&quot;"><pre><code>docker run --rm -it \
    --device=/dev/kfd \
    --device=/dev/dri \
    --group-add=video \
    --cap-add=SYS_PTRACE \
    --security-opt seccomp=unconfined \
    amd-gpu-inference "model_name" "your prompt here"
</code></pre></div>
<p dir="auto">Replace <code>"model_name"</code> with the Hugging Face model you want to use, and <code>"your prompt here"</code> with your input text.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Customization</h2><a id="user-content-customization" aria-label="Permalink: Customization" href="#customization"></a></p>
<p dir="auto"><h3 tabindex="-1" dir="auto">Changing the Model</h3><a id="user-content-changing-the-model" aria-label="Permalink: Changing the Model" href="#changing-the-model"></a></p>
<p dir="auto">You can use any model available on Hugging Face by specifying its repository name when running the container. For example:</p>
<div data-snippet-clipboard-copy-content="./run-docker-amd.sh &quot;facebook/opt-1.3b&quot; &quot;Your prompt here&quot;"><pre><code>./run-docker-amd.sh "facebook/opt-1.3b" "Your prompt here"
</code></pre></div>
<p dir="auto"><h3 tabindex="-1" dir="auto">Modifying the Inference Logic</h3><a id="user-content-modifying-the-inference-logic" aria-label="Permalink: Modifying the Inference Logic" href="#modifying-the-inference-logic"></a></p>
<p dir="auto">If you need to change how the inference is performed, modify the <code>run_inference.py</code> file. Remember to rebuild the Docker image after making changes.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Troubleshooting</h2><a id="user-content-troubleshooting" aria-label="Permalink: Troubleshooting" href="#troubleshooting"></a></p>
<ul dir="auto">
<li>Ensure that your AMD GPU drivers and ROCm are correctly installed and configured on your host system.</li>
<li>If you encounter "out of memory" errors, try using a smaller model or reducing the input/output length.</li>
<li>For model-specific issues, refer to the model's documentation on Hugging Face.</li>
</ul>
<p dir="auto"><h2 tabindex="-1" dir="auto">Contributing</h2><a id="user-content-contributing" aria-label="Permalink: Contributing" href="#contributing"></a></p>
<p dir="auto">Contributions are welcome! Please feel free to submit a Pull Request.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Acknowledgements</h2><a id="user-content-acknowledgements" aria-label="Permalink: Acknowledgements" href="#acknowledgements"></a></p>
<ul dir="auto">
<li>This project uses the Hugging Face Transformers library.</li>
<li>ROCm is developed by AMD. Licensed under MIT License
See <a href="https://rocm.docs.amd.com/en/latest/about/license.html" rel="nofollow">https://rocm.docs.amd.com/en/latest/about/license.html</a> for details.</li>
</ul>
<p dir="auto">For any questions or issues, please open an issue in the GitHub repository.</p>
</article></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[NixOS is a good server OS, except when it isn't (171 pts)]]></title>
            <link>https://sidhion.com/blog/posts/nixos_server_issues/</link>
            <guid>41717050</guid>
            <pubDate>Wed, 02 Oct 2024 04:06:17 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://sidhion.com/blog/posts/nixos_server_issues/">https://sidhion.com/blog/posts/nixos_server_issues/</a>, See on <a href="https://news.ycombinator.com/item?id=41717050">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
<p>Ever since I built my first NixOS system (I started by building a custom image to upload on DigitalOcean), I’ve been bothered by one thing:
the default installation size is large.
To give you an idea, this simple system (using flakes):</p>
<pre tabindex="0"><code>nixpkgs.lib.nixosSystem {
    system = "x86_64-linux";
    modules = [
        (nixpkgs.outPath + "/nixos/modules/profiles/minimal.nix")
        (nixpkgs.outPath + "/nixos/modules/profiles/headless.nix")
        {
            fileSystems."/".device = "/dev/sda1";
            boot.loader.systemd-boot.enable = true;
        }
    ];
}
</code></pre><p>ends up taking ~900MB of disk size on my system<sup id="fnref:1"><a href="#fn:1" role="doc-noteref">1</a></sup>!
Minimal and headless!</p>
<p>When I started working on improving this, I expected the eventual blog post to be very different than what it became, but you can’t win everything in life.
There’s a bit of pain ahead.</p>
<h2 id="the-context">The context</h2>
<p>I really like Nix and NixOS (I wouldn’t be spending time <a href="https://sidhion.com/blog/posts/joining-nix-documentation/">helping with their documentation</a> otherwise).
After spending some time managing NixOS servers, I really can’t see myself going back to other systems unless required by some external factor.
I’m also working on a system that has worker machines which will spin up a bunch of microVMs.</p>
<p>Naturally, I wanted to use NixOS both for the worker machines and the microVMs themselves.
Currently, the system on the microVMs is taking ~210MB (including kernel) of disk space, but it’s based on <a href="https://alpinelinux.org/">Alpine</a>.
The worker machines are already using NixOS, but I’d like them to be as lean as possible.</p>
<p>NixOS makes it very simple to manage a server from the outside.
You can push an entirely new system configuration without the server changing its behaviour, and then almost atomically switch the server to the new configuration.
You can easily configure the whole thing deterministically, deploy the same configuration to multiple servers, and even deploy the same configuration under a VM so you can locally test things if you wish to.</p>
<p>I envisioned a world where all my worker machines ran the bare minimum software required for things to work, which would be an amazing help to lock the system down, prevent any escalations in case some piece of software was broken into, and would also make deployments and tests faster.</p>
<p>And if I could achieve something like that on those machines, why not extend this to the OS running on the microVMs and keep things really lean?
This would be super helpful to cut boot times as much as possible, short of using a unikernel.</p>
<p>I knew from my previous experience with NixOS that it didn’t generate lean images by default, so a couple days ago I started looking into this to see if I could fix things, or at least significantly improve them.</p>
<p><strong>Important:</strong> what follows is an analysis of NixOS specifically for the purposes stated here.
I don’t really care about having some runtime-flexible server OS which lets me install packages and configure things ad-hoc, I want a thin, locked-down server with the single purpose of running the software I declare, and not a single extra tool in it.
(yes, I know I essentially want containers without containers.
I comment on this at the end.)</p>
<h2 id="figuring-out-package-dependencies-and-their-sizes">Figuring out package dependencies and their sizes</h2>
<p>A curious thing about the Nix ecosystem is that it has some pretty powerful tools, but they’re severely underdocumented, sometimes functionality is hidden by their naming, and/or some tools have some really specific assumptions, which makes it harder to use them more generally.</p>
<p>One such tool is <a href="https://nixos.org/manual/nix/stable/command-ref/nix-store/query"><code>nix-store --query</code></a> (to be honest, it is way more known than some other more “obscure” tools).
More specifically, <code>nix-store --query --tree</code> will give you a tree of packages<sup id="fnref:2"><a href="#fn:2" role="doc-noteref">2</a></sup>, starting from a package you specify, and show you the dependencies of that package, and their dependencies, and so on…
Running it will give you some output like this:</p>
<pre tabindex="0"><code>/nix/store/g4ppw7x76dyykj33x99xzf30zq5ym29z-nixos-system-nixos-24.05.20240323.44d0940
├───/nix/store/09fpwkb108ckhljahy7p84if7m8qh1wh-firmware
├───/nix/store/0v0wrr6ngh9d487lhwicwr5z61kz40zw-kmod-31
│   ├───/nix/store/1rm6sr6ixxzipv5358x0cmaw8rs84g2j-glibc-2.38-44
│   │   ├───/nix/store/3sxwxqzkkrgpgaibkm27ggb9kjbzdy31-xgcc-13.2.0-libgcc
│   │   ├───/nix/store/n9sq1bvghs9z0qg6cmwg27y4jmszwgqi-libidn2-2.3.7
│   │   │   ├───/nix/store/77yhmwrwism02371kzyda4d127kdwdnf-libunistring-1.1
│   │   │   │   └───/nix/store/77yhmwrwism02371kzyda4d127kdwdnf-libunistring-1.1 [...]
│   │   │   └───/nix/store/n9sq1bvghs9z0qg6cmwg27y4jmszwgqi-libidn2-2.3.7 [...]
...
</code></pre><p>To complement that, <code>nix-store --query --size</code> gives you (roughly) the size that a specific package takes on disk.
It’s slightly more complicated than this, but for our purposes it will be enough to understand how much disk is used.</p>
<p>There are some tools which help visualise all this information in cool ways.
Two of my favorites are <a href="https://github.com/utdemir/nix-tree">nix-tree</a> and <a href="https://github.com/craigmbooth/nix-visualize">nix-visualize</a>.
However, ideally I wanted an interactive graph so I could see each node in the graph by their size on disk, and inspect their dependencies, search things, and so on.
nix-visualize was the closest of the tools to give me a graph, but it wasn’t interactive and the node sizes weren’t based on disk usage, so I decided to write my own.</p>
<p>It took me some hours to come up with code that generated a <a href="https://graphviz.org/">graphviz</a> file, with node sizes based on disk usage.
Coupled with <a href="https://github.com/tintinweb/vscode-interactive-graphviz">vscode-interactive-graphviz</a>, I felt like I had a good approach to interactively working with the graph, but the visualisations turned out to be too crowded.
I tried to add some more space into things, but it was kind of a hack because graphviz likes to be the one to position elements.
In the end, I gave up on that idea and decided to just generate a CSV, which worked way better than I expected.
No wonder we still use spreadsheets for a lot of things!</p>
<p>The repository with the code and the final config of the NixOS system from this post is <a href="https://github.com/DanielSidhion/nixos-investigation">here</a>.</p>
<h2 id="an-investigation-of-a-minimal-headless-nixos-system">An investigation of a minimal, headless NixOS system</h2>
<p>With a way to see each package, its disk usage, and all its dependencies, let’s look at the minimal, headless system I mentioned in the beginning of the post.
The one that takes ~900MB.</p>
<figure><img src="https://sidhion.com/nixos_bare_starting.png" alt="A list of the heaviest packages by disk usage, viewed with the Edit csv extension for VSCode"><figcaption>
<p>A list of the heaviest packages by disk usage, viewed with the <a href="https://marketplace.visualstudio.com/items?itemName=janisdd.vscode-edit-csv">Edit csv</a> extension for VSCode</p>
</figcaption>
</figure>
<p>Each subsection below will be a small report of me investigating some items in this CSV<sup id="fnref:3"><a href="#fn:3" role="doc-noteref">3</a></sup>.
It starts “easy” and gets progressively more complicated.
Feel free to skim and skip any part if you don’t feel like it.</p>
<h2 id="getting-rid-of-nix-179mb-reduction">Getting rid of Nix (~179MB reduction)</h2>
<p>The heaviest item in that list is a mysterious “source” package.
A quick look into what the heck could be taking 170MB of disk space shows it’s actually a complete copy of Nixpkgs!</p>
<pre tabindex="0"><code>❯ ls /nix/store/amxd2p02wx78nyaa4bkb0hjvgwhz1dq7-source
CONTRIBUTING.md  README.md    doc        lib          nixos
COPYING          default.nix  flake.nix  maintainers  pkgs
</code></pre><p>Searching for that package’s <code>pos</code> (just an identifier I used in the code that generates the CSV and the graphviz files) shows that it’s only used by this other package:</p>
<p><img src="https://sidhion.com/etc_nix_registry.png" alt="etc-nix-registry.json using that package"></p>
<p>That package is a single file which doesn’t have a lot in it other than a link to the “source” package.
A search through Nixpkgs shows the file coming from <a href="https://github.com/NixOS/nixpkgs/blob/05677341df3102d5387629b7855afeff6069a6f3/nixos/modules/config/nix-flakes.nix#L90">here</a>, the actual content of <code>registry</code> coming from <a href="https://github.com/NixOS/nixpkgs/blob/6f414604e2a627ae3d8bc8f58573d8b50fb16829/nixos/modules/misc/nixpkgs-flake.nix#L91-L94">here</a>, and the <code>source</code> attribute being set <a href="https://github.com/NixOS/nixpkgs/blob/6f414604e2a627ae3d8bc8f58573d8b50fb16829/flake.nix#L39">here</a>.</p>
<p>I’m building this system with flakes and I’m using that <code>nixosSystem</code> function from Nixpkgs’s <code>flake.nix</code>, which means by default I get this extra 170MB in the system.
I <em>think</em> it would’ve been easy to just undo what Nixpkgs’s <code>flake.nix</code> is doing, but if you look at the list of the heaviest packages again, you’ll see that Nix itself is the 10th heaviest package in the system.</p>
<p>Nix also pulls a lot of dependencies, each one taking quite some space as well (for example, <code>aws-sdk-cpp-1.11.207</code> eats another 5.7MB by itself, and is <strong>only</strong> used by Nix).</p>
<p>After some thinking, I realised that I don’t need Nix in any of these systems.
I definitely don’t need it in a microVM, but I also don’t need it in my servers, because I’m building their configurations in an external machine and deploying the built bits directly.
So let’s add this to the system configuration:</p>
<pre tabindex="0"><code>nix.enable = false;
</code></pre><p>After rebuilding the system, we’re at ~733MB.</p>
<h2 id="getting-rid-of-perl-python-242mb-reduction">Getting rid of Perl, Python (~242MB reduction)</h2>
<p>After removing Nix, the 2nd heaviest package is Python3, and 3rd is Perl.</p>
<p>Python only comes in because of <code>install-systemd-boot.sh</code> (truly a shame, why waste so much disk space like this!), and Perl comes in through a bunch of perl-envs (search for <code>perl-5.38.2-env</code> in the CSV and you’ll see them).
Those perl-envs are all used in the top-level package, so let’s figure out where they’re being used there:</p>
<pre tabindex="0"><code>❯ grep -nr 'perl-5.38.2-env' /nix/store/7z0y5sscnpx4hczzkjh3jvjgn2mq3106-nixos-system-nixos-24.05.20240323.44d0940
/nix/store/7z0y5sscnpx4hczzkjh3jvjgn2mq3106-nixos-system-nixos-24.05.20240323.44d0940/dry-activate:23:/nix/store/d3qxgm4ffhi2ixx3n9clwqlr6z21dd8i-perl-5.38.2-env/bin/perl \
/nix/store/7z0y5sscnpx4hczzkjh3jvjgn2mq3106-nixos-system-nixos-24.05.20240323.44d0940/activate:43:/nix/store/d3qxgm4ffhi2ixx3n9clwqlr6z21dd8i-perl-5.38.2-env/bin/perl \
/nix/store/7z0y5sscnpx4hczzkjh3jvjgn2mq3106-nixos-system-nixos-24.05.20240323.44d0940/activate:63:/nix/store/zkmm5iha0rsm4ypwfc67byq52gz0jb8b-perl-5.38.2-env/bin/perl /nix/store/rg5rf512szdxmnj9qal3wfdnpfsx38qi-setup-etc.pl /nix/store/jq5a0yw04ichvggf7dx80xc438z2v1gv-etc/etc
/nix/store/7z0y5sscnpx4hczzkjh3jvjgn2mq3106-nixos-system-nixos-24.05.20240323.44d0940/bin/switch-to-configuration:1:#! /nix/store/8mlvyl3sab5hxpxz2naz5g2sfd42a40q-perl-5.38.2-env/bin/perl
</code></pre><p>To make it easier to parse this bunch of text:
Perl is used in the <code>dry-activate</code>, <code>activate</code>, and <code>bin/switch-to-configuration</code> scripts.
<code>dry-activate</code> only needs Perl to run the <code>update-users-groups.pl</code> script, while the <code>activate</code> script runs the same script and also <code>setup-etc.pl</code>, and <code>bin/switch-to-configuration</code> is a Perl script from the beginning.</p>
<p><strong>Fun fact:</strong> the minimal profile disables man pages and most other documentation bits, but the perl man pages are the only thing that still get included in the system because of the perl-envs!</p>
<p>I thought Perl was going to be hard to remove, but I was determined to at least take a look.
After all, judging only by the naming, <code>update-users-groups.pl</code> doesn’t seem like the kind of thing I need - I don’t expect my servers to create any extra users or groups dynamically, so there’s nothing to update.</p>
<p>(note that I have no idea what <code>update-users-groups.pl</code> actually does, this was just my thinking from reading its name)</p>
<p>I decided to search Nixpkgs for that script name to get an idea of how it was being added to the system.
It was through this search that I stumbled upon a Nixpkgs tracking issue called <a href="https://github.com/NixOS/nixpkgs/issues/267982">Perlless Activation - Tracking Issue</a>.</p>
<p>Someone decided it wasn’t a good idea to have Perl in the base NixOS system for slightly different reasons, and they did a lot of work to get rid of it!
Luckily for me, I could piggyback off their work and include the following module in my system configuration:</p>
<pre tabindex="0"><code>modules = [
    ...
    (nixpkgs.outPath + "/nixos/modules/profiles/perlless.nix")
];
</code></pre><p>After rebuilding the system, we’re at ~491MB.
As a bonus, Python is now gone as well!</p>
<h2 id="deduplicating-systemd-14mb-reduction">Deduplicating systemd (~14MB reduction)</h2>
<p>systemd is now the 2nd heaviest package.
It has some stuff inside that I think could be removed, but since it’s an integral part of the system, let’s overlook it for now.
Going through the list of packages, what’s this in 5th place?</p>
<p><img src="https://sidhion.com/systemd_minimal.png" alt="systemd-minimal is also in the list of packages!"></p>
<p>For some reason, our NixOS system has both systemd <strong>and</strong> systemd-minimal!
A look through which packages use systemd-minimal show that only dbus uses it.
It comes from <a href="https://github.com/NixOS/nixpkgs/blob/71c7097220cf92a2b005d82904afc590e05b3a5a/pkgs/development/libraries/dbus/default.nix#L7">here</a>.</p>
<p>Nixpkgs has a lot of packages, and sometimes due to circular dependencies or to keep the size of dependencies smaller, it introduces variants of packages/functions that have reduced functionality.
If you contribute to Nixpkgs, chances are that at some point, someone will give some feedback on ways you can use variants that have a smaller dependency chain, or smaller size (a common example is using <code>stdenvNoCC</code> instead of <code>stdenv</code>).
systemd-minimal probably exists to avoid certain circular dependencies, but I’m not sure.
It’s defined <a href="https://github.com/NixOS/nixpkgs/blob/2726f127c15a4cc9810843b96cad73c7eb39e443/pkgs/top-level/all-packages.nix#L28207-L28251">here</a>.</p>
<p>In any case, I’d like to get rid of systemd-minimal, since we already have the full systemd in our system anyway.
There is no easy way to override the package used by the NixOS module that brings in dbus, so we’ll have to add a <a href="https://nixos.org/manual/nixpkgs/unstable/#chap-overlays">Nixpkgs overlay</a> to change the dbus package directly:</p>
<pre tabindex="0"><code>nixpkgs.overlays = [
(
    self: super:
    {
        dbus = super.dbus.override {
            systemdMinimal = self.systemd;
        };
    }
)
];
</code></pre><p>After rebuilding the system, we’re now at ~477MB.</p>
<h2 id="removing-udev-lvm-sudo-and-security-wrappers-30mb-reduction">Removing udev, lvm, sudo and security wrappers (~30MB reduction)</h2>
<p>This is where things start to get very messy.
While looking through the list of heaviest packages, I saw an “hwdb.bin” package which seems linked to udev.
I don’t know about udev too much, but it feels like it’s only needed for scenarios that won’t happen on the kind of servers I want to manage.</p>
<p>In case it is actually used for something important and this breaks the system, I have a feeling that a workaround could be hard-coded and wouldn’t require udev anyway.
I’d gladly go into that rabbit hole, but (spoiler alert) you’ll see that I gave up well before that.</p>
<p>There’s an option to disable it:</p>
<pre tabindex="0"><code>services.udev.enable = false;
</code></pre><p>While looking through the stuff adjacent to udev, I noticed that lvm is also enabled by default.
Similar reasoning to udev, I don’t think I’d need lvm for these servers, so I disabled it.</p>
<pre tabindex="0"><code>services.lvm.enable = false;
</code></pre><p>Before proceeding with more of this, I took a break and looked at some more packages in the list.
At that point, it became clear that I’d have to butcher a LOT of NixOS config to remove many packages in there.
I made a decision to continue with this exercise, but make it less about keeping a working system throughout and more about understanding the efforts to just get rid of some of these packages.
To get to a barebones system, I’d need to remove a lot of them.</p>
<p>While looking through the lvm stuff, I noticed fuse2 and fuse3 are hard-coded by default (and changing those gets complicated quickly).
I saw they’re used by some security wrappers, which also set other security wrappers for mount, umount, sudo, and a bunch of other binaries.
This is needed because Nix doesn’t support sid/gid binaries by design, so NixOS has a binary that dynamically sets some capabilities and permissions, and then executes any other binary with the elevated bits.</p>
<p>I don’t like having this functionality.
Instead of a single wrapper binary which receives an argument with the binary to execute with elevated permissions, I’d rather have X wrapper binaries with hardcoded paths and no parametrisation of any kind (one for each of the X things I want to execute), and that’s only IF I actually need this functionality.</p>
<p>For anything I want to run in these servers, I think I can configure the proper permissions through systemd unit configs.</p>
<p>The security wrappers module doesn’t have an <code>enable</code> option to toggle it off, so one way to get rid of it completely is to add it to the <a href="https://nixos.org/manual/nixos/unstable/#sec-replace-modules"><code>disabledModules</code> attribute</a>.
This requires me to provide dummy options that were provided by the security wrappers module earlier, because when building a NixOS system, by default <strong>every module</strong> gets evaluated (most of them just won’t do anything because they’re not enabled).
Some of these modules set additional wrappers, so the dummy options are needed to make the module system happy.</p>
<pre tabindex="0"><code>({ lib, pkgs, ... }: {
    disabledModules = [ "security/wrappers/default.nix" ];

    options.security = {
        wrappers = lib.mkOption {
            type = lib.types.attrs;
            default = { };
        };
        wrapperDir = lib.mkOption {
            type = lib.types.path;
            default = "/run/wrappers/bin";
        };
    };

    config = {
        # ...
    };
})
</code></pre><p>I <em>think</em> doing this could break some script that calls mount or umount or fuse (because those are hardcoded in the security wrappers module), but I also think that most scripts that use those are being run directly as root, so I’m not sure.</p>
<p>To finish this section, let’s also disable sudo completely because it’s useless without its security wrapper.</p>
<pre tabindex="0"><code>security.sudo.enable = false;
</code></pre><p>We’re at ~447MB now.</p>
<h2 id="some-other-minimal-shenanigans">Some other minimal shenanigans</h2>
<p>At this point, the 10th and 11st heaviest packages are util-linux and util-linux-minimal, respectively.
Well, this seems similar to that systemd-minimal thing from a while ago!</p>
<p>Let’s look at where these are being used:</p>
<ul>
<li>util-linux
<ul>
<li>system-path, a bunch of systemd services and a “mount-pstore” shell script.</li>
</ul>
</li>
<li>util-linux-minimal
<ul>
<li>fuse2 and fuse3, and etc-systemd-system.conf</li>
</ul>
</li>
</ul>
<p>Removing fuse is very annoying (although to be honest, with all the mess in the config so far, it wouldn’t even look that bad anymore).
But we can at least try to make them use util-linux instead of util-linux-minimal, right?</p>
<p>To get there, let’s look at how these packages <a href="https://github.com/NixOS/nixpkgs/blob/6504cbb171517dc371c40b502a55fe4a32aad6d1/pkgs/top-level/all-packages.nix#L27345-L27349">are declared in <code>all-packages.nix</code></a>.
We’ll need an overlay, but trying to change <code>fusePackages</code> to use the normal util-linux will hit an infinite recursion error, so I’ll start by overlaying <code>fuse3</code>:</p>
<pre tabindex="0"><code>nixpkgs.overlays = [(
    self: super: {
        fuse3 = (self.lib.dontRecurseIntoAttrs (self.callPackage (nixpkgs.outPath + "/pkgs/os-specific/linux/fuse") { })).fuse_3;
    }
)];
</code></pre><p>This builds nicely, but the moment I try to do this with fuse2, the infinite recursion error is back.
<em>Sigh</em>.
Whatever.</p>
<p>Browsing through the list of packages, I also see systemd-minimal-libs sneaking in there.
It’s being used by a bunch of other packages, and it’s equally difficult to add more overlays to get rid of it.
Infinite recursions all around.</p>
<p>This is where I look at the current system config, look at all the notes I made of things to look into that I haven’t yet (the list is right there in the next section), think about how much worse it’ll get by trying to fix all of this, and give up.</p>
<h2 id="things-i-noted-but-didnt-look-at">Things I noted, but didn’t look at</h2>
<ul>
<li>
<p>With Nix gone, the heaviest package was the linux kernel at ~136MB.
I know I can get it down to ~50MB easily (the kernel used by default on NixOS has a lot of modules and extra things that a server doesn’t need), so I left that for later because it was easy.</p>
</li>
<li>
<p>One disadvantage of a perlless system is that it can’t switch to a different configuration at runtime, because the script that does this is written in Perl.
This isn’t an issue for most of the servers in my scenario.
MicroVMs don’t need that, and I’d be perfectly ok just killing a bunch of other servers and starting new ones with the updated configuration.</p>
<p>However, I made a note to look into that perl script and figure out how much work it would be to build a replacement.
This is something that needs to happen anyway at some point, and would benefit the NixOS community at large.</p>
</li>
<li>
<p>A bunch of packages build with all locales and some internationalisation content.
Those end up taking some good space, so I made a note to look at how to simplify this and get rid of most of the locales and files I wouldn’t need.</p>
</li>
<li>
<p>The system has both libressl and openssl packages.
libressl is only used for netcat, but I don’t really need it in the servers.
In fact, NixOS includes a lot of utilities by default (and marks them as required, making it super annoying to remove them) which aren’t really needed on the servers.</p>
</li>
<li>
<p>A bunch of extra default config files that aren’t needed (such as bashrc) could be removed.
This would also remove some packages that they use, such as bash-completion, which won’t ever be needed in the servers.</p>
</li>
<li>
<p>coreutils and util-linux are both kind of heavy, but it’s very likely that the scripts and things that use them only really need a few binaries from each one.
Perhaps an overlay that filters the binaries only to the list that are used would help free up quite a bunch of disk space.</p>
</li>
<li>
<p><code>nix-store</code> has a command to <a href="https://nixos.org/manual/nix/stable/command-ref/nix-store/optimise">optimise</a> disk space by finding identical files and hard-linking them.
This could be helpful in some cases, but might not be possible in others, depending on how a server is imaged, or how new configuration gets pushed to it.
It could be useful to decrease the disk space used by some of those “-minimal” packages (as long as they share exactly the same file).</p>
</li>
</ul>
<h2 id="leaving-this-to-the-future">Leaving this to the future</h2>
<p>There is a huge audience that uses NixOS as a personal OS, and a lot of the defaults and modules present in NixOS reflect that.
NixOS can still be used as a server OS, but it requires a very different set of configurations, and it still ends up not being adequate in every situation.</p>
<p>I can (and will) still apply many of the configs I used in this post to my existing servers and make them leaner, which will already be useful, because it cuts ~300MB of stuff I don’t need.
I got some experience and figured out some tools to help me investigate these issues more whenever I feel the need to.</p>
<p>But over the 2 days I spent looking at this, I concluded that trying to mold NixOS into the shape I envisioned just isn’t the way to go, but I also don’t like the other option if I want to stick with it, which is creating a “fork” of NixOS that is <strong>very</strong> opinionated and completely focused on server scenarios.</p>
<p>I was trying to bring NixOS to a bare minimum, which is an exercise similar to building containers with the bare minimum required for the software in the container to run.
I think this is a worthy endeavour.
I think we have all the tools in regular non-docker, non-kubernetes linux to get to a similar outcome, except we won’t need docker or kubernetes or whatever in this new land, thus removing quite a bunch of complexity from the systems we build.</p>
<p>But doing it on top of NixOS currently feels like a bad path to take.</p>

</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Nvidia releases NVLM 1.0 72B open weight model (153 pts)]]></title>
            <link>https://huggingface.co/nvidia/NVLM-D-72B</link>
            <guid>41716975</guid>
            <pubDate>Wed, 02 Oct 2024 03:48:53 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://huggingface.co/nvidia/NVLM-D-72B">https://huggingface.co/nvidia/NVLM-D-72B</a>, See on <a href="https://news.ycombinator.com/item?id=41716975">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
	<!-- HTML_TAG_START --><p>
  <img width="300" alt="Image Description" src="https://huggingface.co/nvidia/NVLM-D-72B/resolve/main/nvlm-logo-light.png">
</p>



<h2>
	<a rel="nofollow" href="#model-details" id="model-details">
		
	</a>
	<span>
		Model Details
	</span>
</h2>
<p>Today (September 17th, 2024), we introduce <a rel="nofollow" href="https://arxiv.org/abs/2409.11402">NVLM 1.0</a>, a family of frontier-class multimodal large language models (LLMs) that achieve state-of-the-art results on vision-language tasks, rivaling the leading proprietary models (e.g., GPT-4o) and open-access models (e.g., Llama 3-V 405B and InternVL 2). Remarkably, NVLM 1.0 shows improved text-only performance over its LLM backbone after multimodal training. </p>
<p>In this repo, we are open-sourcing NVLM-1.0-D-72B (decoder-only architecture), the decoder-only model weights and code for the community.</p>
<h2>
	<a rel="nofollow" href="#other-resources" id="other-resources">
		
	</a>
	<span>
		Other Resources
	</span>
</h2>
<p><a rel="nofollow" href="https://huggingface.co/nvidia/NVLM-D-72B/tree/main">Inference Code (HF)</a>   <a rel="nofollow" href="">Training Code (Coming soon)</a>   <a rel="nofollow" href="https://research.nvidia.com/labs/adlr/NVLM-1/">Website</a>   <a rel="nofollow" href="https://arxiv.org/abs/2409.11402">Paper</a></p>
<h2>
	<a rel="nofollow" href="#benchmark-results" id="benchmark-results">
		
	</a>
	<span>
		Benchmark Results
	</span>
</h2>
<p>We train our model with legacy <a rel="nofollow" href="https://github.com/NVIDIA/Megatron-LM/tree/main/megatron/legacy">Megatron-LM</a> and adapt the codebase to Huggingface for model hosting, reproducibility, and inference.
We observe numerical differences between the Megatron and Huggingface codebases, which are within the expected range of variation. 
We provide the results from both the Huggingface codebase and the Megatron codebase for reproducibility and comparison with other models.</p>
<p>Results (as of September 17th, 2024) in the multimodal benchmarks are as follows:</p>
<div>
	<table>
		<thead><tr>
<th>Benchmark</th>
<th>MMMU (val / test)</th>
<th>MathVista</th>
<th>OCRBench</th>
<th>AI2D</th>
<th>ChartQA</th>
<th>DocVQA</th>
<th>TextVQA</th>
<th>RealWorldQA</th>
<th>VQAv2</th>
</tr>

		</thead><tbody><tr>
<td>NVLM-D 1.0 72B (Huggingface)</td>
<td>58.7 / 54.9</td>
<td>65.2</td>
<td>852</td>
<td>94.2</td>
<td>86.0</td>
<td>92.6</td>
<td>82.6</td>
<td>69.5</td>
<td>85.4</td>
</tr>
<tr>
<td>NVLM-D 1.0 72B (Megatron)</td>
<td>59.7 / 54.6</td>
<td>65.2</td>
<td>853</td>
<td>94.2</td>
<td>86.0</td>
<td>92.6</td>
<td>82.1</td>
<td>69.7</td>
<td>85.4</td>
</tr>
<tr>
<td>Llama 3.2 90B</td>
<td>60.3 / -</td>
<td>57.3</td>
<td>-</td>
<td>92.3</td>
<td>85.5</td>
<td>90.1</td>
<td>-</td>
<td>-</td>
<td>78.1</td>
</tr>
<tr>
<td>Llama 3-V 70B</td>
<td>60.6 / -</td>
<td>-</td>
<td>-</td>
<td>93.0</td>
<td>83.2</td>
<td>92.2</td>
<td>83.4</td>
<td>-</td>
<td>79.1</td>
</tr>
<tr>
<td>Llama 3-V 405B</td>
<td>64.5 / -</td>
<td>-</td>
<td>-</td>
<td>94.1</td>
<td>85.8</td>
<td>92.6</td>
<td>84.8</td>
<td>-</td>
<td>80.2</td>
</tr>
<tr>
<td>InternVL2-Llama3-76B</td>
<td>55.2 / -</td>
<td>65.5</td>
<td>839</td>
<td>94.8</td>
<td>88.4</td>
<td>94.1</td>
<td>84.4</td>
<td>72.2</td>
<td>-</td>
</tr>
<tr>
<td>GPT-4V</td>
<td>56.8 / 55.7</td>
<td>49.9</td>
<td>645</td>
<td>78.2</td>
<td>78.5</td>
<td>88.4</td>
<td>78.0</td>
<td>61.4</td>
<td>77.2</td>
</tr>
<tr>
<td>GPT-4o</td>
<td>69.1 / -</td>
<td>63.8</td>
<td>736</td>
<td>94.2</td>
<td>85.7</td>
<td>92.8</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>Claude 3.5 Sonnet</td>
<td>68.3 / -</td>
<td>67.7</td>
<td>788</td>
<td>94.7</td>
<td>90.8</td>
<td>95.2</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>Gemini 1.5 Pro (Aug 2024)</td>
<td>62.2 / -</td>
<td>63.9</td>
<td>754</td>
<td>94.4</td>
<td>87.2</td>
<td>93.1</td>
<td>78.7</td>
<td>70.4</td>
<td>80.2</td>
</tr>
</tbody>
	</table>
</div>
<h2>
	<a rel="nofollow" href="#how-to-use" id="how-to-use">
		
	</a>
	<span>
		How to use
	</span>
</h2>
<p>When converting Megatron checkpoint to Huggingface, we adapt <a rel="nofollow" href="https://huggingface.co/OpenGVLab/InternVL2-Llama3-76B">InternVL codebase</a> to support model loading and multi-GPU inference in HF. For training, please refer to <a rel="nofollow" href="">Megatron-LM (Coming soon)</a>.</p>
<h3>
	<a rel="nofollow" href="#prepare-the-environment" id="prepare-the-environment">
		
	</a>
	<span>
		Prepare the environment
	</span>
</h3>
<p>We provide a docker build file in the <a rel="nofollow" href="https://huggingface.co/nvidia/NVLM-D-72B/blob/main/Dockerfile">Dockerfile</a> for reproduction. </p>
<p>The docker image is based on <code>nvcr.io/nvidia/pytorch:23.09-py3</code>. </p>
<p><em>Note: We observe that different transformer versions / CUDA versions / docker versions can lead to slight benchmark number differences. We recommend using the Dockerfile above for precise reproduction.</em></p>
<h3>
	<a rel="nofollow" href="#model-loading" id="model-loading">
		
	</a>
	<span>
		Model loading
	</span>
</h3>
<pre><code><span>import</span> torch
<span>from</span> transformers <span>import</span> AutoModel

path = <span>"nvidia/NVLM-D-72B"</span>
model = AutoModel.from_pretrained(
    path,
    torch_dtype=torch.bfloat16,
    low_cpu_mem_usage=<span>True</span>,
    use_flash_attn=<span>False</span>,
    trust_remote_code=<span>True</span>).<span>eval</span>()
</code></pre>
<h3>
	<a rel="nofollow" href="#multiple-gpus" id="multiple-gpus">
		
	</a>
	<span>
		Multiple GPUs
	</span>
</h3>
<p>The model can be loaded on multiple GPUs as follows:</p>
<pre><code><span>import</span> torch
<span>import</span> math
<span>from</span> transformers <span>import</span> AutoModel

<span>def</span> <span>split_model</span>():
    device_map = {}
    world_size = torch.cuda.device_count()
    num_layers = <span>80</span>
    <span># Since the first GPU will be used for ViT, treat it as half a GPU.</span>
    num_layers_per_gpu = math.ceil(num_layers / (world_size - <span>0.5</span>))
    num_layers_per_gpu = [num_layers_per_gpu] * world_size
    num_layers_per_gpu[<span>0</span>] = math.ceil(num_layers_per_gpu[<span>0</span>] * <span>0.5</span>)
    layer_cnt = <span>0</span>
    <span>for</span> i, num_layer <span>in</span> <span>enumerate</span>(num_layers_per_gpu):
        <span>for</span> j <span>in</span> <span>range</span>(num_layer):
            device_map[<span>f'language_model.model.layers.<span>{layer_cnt}</span>'</span>] = i
            layer_cnt += <span>1</span>
    device_map[<span>'vision_model'</span>] = <span>0</span>
    device_map[<span>'mlp1'</span>] = <span>0</span>
    device_map[<span>'language_model.model.tok_embeddings'</span>] = <span>0</span>
    device_map[<span>'language_model.model.embed_tokens'</span>] = <span>0</span>
    device_map[<span>'language_model.output'</span>] = <span>0</span>
    device_map[<span>'language_model.model.norm'</span>] = <span>0</span>
    device_map[<span>'language_model.lm_head'</span>] = <span>0</span>
    device_map[<span>f'language_model.model.layers.<span>{num_layers - <span>1</span>}</span>'</span>] = <span>0</span>

    <span>return</span> device_map

path = <span>"nvidia/NVLM-D-72B"</span>
device_map = split_model()
model = AutoModel.from_pretrained(
    path,
    torch_dtype=torch.bfloat16,
    low_cpu_mem_usage=<span>True</span>,
    use_flash_attn=<span>False</span>,
    trust_remote_code=<span>True</span>,
    device_map=device_map).<span>eval</span>()
</code></pre>
<h3>
	<a rel="nofollow" href="#inference" id="inference">
		
	</a>
	<span>
		Inference
	</span>
</h3>
<pre><code><span>import</span> torch
<span>from</span> transformers <span>import</span> AutoTokenizer, AutoModel
<span>import</span> math
<span>from</span> PIL <span>import</span> Image
<span>import</span> torchvision.transforms <span>as</span> T
<span>from</span> torchvision.transforms.functional <span>import</span> InterpolationMode


<span>def</span> <span>split_model</span>():
    device_map = {}
    world_size = torch.cuda.device_count()
    num_layers = <span>80</span>
    <span># Since the first GPU will be used for ViT, treat it as half a GPU.</span>
    num_layers_per_gpu = math.ceil(num_layers / (world_size - <span>0.5</span>))
    num_layers_per_gpu = [num_layers_per_gpu] * world_size
    num_layers_per_gpu[<span>0</span>] = math.ceil(num_layers_per_gpu[<span>0</span>] * <span>0.5</span>)
    layer_cnt = <span>0</span>
    <span>for</span> i, num_layer <span>in</span> <span>enumerate</span>(num_layers_per_gpu):
        <span>for</span> j <span>in</span> <span>range</span>(num_layer):
            device_map[<span>f'language_model.model.layers.<span>{layer_cnt}</span>'</span>] = i
            layer_cnt += <span>1</span>
    device_map[<span>'vision_model'</span>] = <span>0</span>
    device_map[<span>'mlp1'</span>] = <span>0</span>
    device_map[<span>'language_model.model.tok_embeddings'</span>] = <span>0</span>
    device_map[<span>'language_model.model.embed_tokens'</span>] = <span>0</span>
    device_map[<span>'language_model.output'</span>] = <span>0</span>
    device_map[<span>'language_model.model.norm'</span>] = <span>0</span>
    device_map[<span>'language_model.lm_head'</span>] = <span>0</span>
    device_map[<span>f'language_model.model.layers.<span>{num_layers - <span>1</span>}</span>'</span>] = <span>0</span>

    <span>return</span> device_map


IMAGENET_MEAN = (<span>0.485</span>, <span>0.456</span>, <span>0.406</span>)
IMAGENET_STD = (<span>0.229</span>, <span>0.224</span>, <span>0.225</span>)


<span>def</span> <span>build_transform</span>(<span>input_size</span>):
    MEAN, STD = IMAGENET_MEAN, IMAGENET_STD
    transform = T.Compose([
        T.Lambda(<span>lambda</span> img: img.convert(<span>'RGB'</span>) <span>if</span> img.mode != <span>'RGB'</span> <span>else</span> img),
        T.Resize((input_size, input_size), interpolation=InterpolationMode.BICUBIC),
        T.ToTensor(),
        T.Normalize(mean=MEAN, std=STD)
    ])
    <span>return</span> transform


<span>def</span> <span>find_closest_aspect_ratio</span>(<span>aspect_ratio, target_ratios, width, height, image_size</span>):
    best_ratio_diff = <span>float</span>(<span>'inf'</span>)
    best_ratio = (<span>1</span>, <span>1</span>)
    area = width * height
    <span>for</span> ratio <span>in</span> target_ratios:
        target_aspect_ratio = ratio[<span>0</span>] / ratio[<span>1</span>]
        ratio_diff = <span>abs</span>(aspect_ratio - target_aspect_ratio)
        <span>if</span> ratio_diff &lt; best_ratio_diff:
            best_ratio_diff = ratio_diff
            best_ratio = ratio
        <span>elif</span> ratio_diff == best_ratio_diff:
            <span>if</span> area &gt; <span>0.5</span> * image_size * image_size * ratio[<span>0</span>] * ratio[<span>1</span>]:
                best_ratio = ratio
    <span>return</span> best_ratio


<span>def</span> <span>dynamic_preprocess</span>(<span>image, min_num=<span>1</span>, max_num=<span>12</span>, image_size=<span>448</span>, use_thumbnail=<span>False</span></span>):
    orig_width, orig_height = image.size
    aspect_ratio = orig_width / orig_height

    <span># calculate the existing image aspect ratio</span>
    target_ratios = <span>set</span>(
        (i, j) <span>for</span> n <span>in</span> <span>range</span>(min_num, max_num + <span>1</span>) <span>for</span> i <span>in</span> <span>range</span>(<span>1</span>, n + <span>1</span>) <span>for</span> j <span>in</span> <span>range</span>(<span>1</span>, n + <span>1</span>) <span>if</span>
        i * j &lt;= max_num <span>and</span> i * j &gt;= min_num)
    target_ratios = <span>sorted</span>(target_ratios, key=<span>lambda</span> x: x[<span>0</span>] * x[<span>1</span>])

    <span># find the closest aspect ratio to the target</span>
    target_aspect_ratio = find_closest_aspect_ratio(
        aspect_ratio, target_ratios, orig_width, orig_height, image_size)

    <span># calculate the target width and height</span>
    target_width = image_size * target_aspect_ratio[<span>0</span>]
    target_height = image_size * target_aspect_ratio[<span>1</span>]
    blocks = target_aspect_ratio[<span>0</span>] * target_aspect_ratio[<span>1</span>]

    <span># resize the image</span>
    resized_img = image.resize((target_width, target_height))
    processed_images = []
    <span>for</span> i <span>in</span> <span>range</span>(blocks):
        box = (
            (i % (target_width // image_size)) * image_size,
            (i // (target_width // image_size)) * image_size,
            ((i % (target_width // image_size)) + <span>1</span>) * image_size,
            ((i // (target_width // image_size)) + <span>1</span>) * image_size
        )
        <span># split the image</span>
        split_img = resized_img.crop(box)
        processed_images.append(split_img)
    <span>assert</span> <span>len</span>(processed_images) == blocks
    <span>if</span> use_thumbnail <span>and</span> <span>len</span>(processed_images) != <span>1</span>:
        thumbnail_img = image.resize((image_size, image_size))
        processed_images.append(thumbnail_img)
    <span>return</span> processed_images


<span>def</span> <span>load_image</span>(<span>image_file, input_size=<span>448</span>, max_num=<span>12</span></span>):
    image = Image.<span>open</span>(image_file).convert(<span>'RGB'</span>)
    transform = build_transform(input_size=input_size)
    images = dynamic_preprocess(image, image_size=input_size, use_thumbnail=<span>True</span>, max_num=max_num)
    pixel_values = [transform(image) <span>for</span> image <span>in</span> images]
    pixel_values = torch.stack(pixel_values)
    <span>return</span> pixel_values

path = <span>"nvidia/NVLM-D-72B"</span>
device_map = split_model()
model = AutoModel.from_pretrained(
    path,
    torch_dtype=torch.bfloat16,
    low_cpu_mem_usage=<span>True</span>,
    use_flash_attn=<span>False</span>,
    trust_remote_code=<span>True</span>,
    device_map=device_map).<span>eval</span>()

<span>print</span>(model)

tokenizer = AutoTokenizer.from_pretrained(path, trust_remote_code=<span>True</span>, use_fast=<span>False</span>)
generation_config = <span>dict</span>(max_new_tokens=<span>1024</span>, do_sample=<span>False</span>)

<span># pure-text conversation</span>
question = <span>'Hello, who are you?'</span>
response, history = model.chat(tokenizer, <span>None</span>, question, generation_config, history=<span>None</span>, return_history=<span>True</span>)
<span>print</span>(<span>f'User: <span>{question}</span>\nAssistant: <span>{response}</span>'</span>)

<span># single-image single-round conversation</span>
pixel_values = load_image(<span>'path/to/your/example/image.jpg'</span>, max_num=<span>6</span>).to(
    torch.bfloat16)
question = <span>'&lt;image&gt;\nPlease describe the image shortly.'</span>
response = model.chat(tokenizer, pixel_values, question, generation_config)
<span>print</span>(<span>f'User: <span>{question}</span>\nAssistant: <span>{response}</span>'</span>)
</code></pre>
<h2>
	<a rel="nofollow" href="#correspondence-to" id="correspondence-to">
		
	</a>
	<span>
		Correspondence to
	</span>
</h2>
<p>Wenliang Dai* (<a rel="nofollow" href="mailto:wdai@nvidia.com">wdai@nvidia.com</a>), Nayeon Lee* (<a rel="nofollow" href="mailto:nayeonl@nvidia.com">nayeonl@nvidia.com</a>), Boxin Wang* (<a rel="nofollow" href="mailto:boxinw@nvidia.com">boxinw@nvidia.com</a>), Zhuolin Yang* (<a rel="nofollow" href="mailto:zhuoliny@nvidia.com">zhuoliny@nvidia.com</a>), Wei Ping* (<a rel="nofollow" href="mailto:wping@nvidia.com">wping@nvidia.com</a>)</p>
<p>*Equal contribution</p>
<h2>
	<a rel="nofollow" href="#citation" id="citation">
		
	</a>
	<span>
		Citation
	</span>
</h2>
<pre>@article{nvlm2024,
  title={NVLM: Open Frontier-Class Multimodal LLMs},
  author={Dai, Wenliang and Lee, Nayeon and Wang, Boxin and Yang, Zhuolin and Liu, Zihan and Barker, Jon and Rintamaki, Tuomas and Shoeybi, Mohammad and Catanzaro, Bryan and Ping, Wei},
  journal={arXiv preprint},
  year={2024}}
</pre>


<h2>
	<a rel="nofollow" href="#license" id="license">
		
	</a>
	<span>
		License
	</span>
</h2>
<p>The use of this model is governed by the <a rel="nofollow" href="https://spdx.org/licenses/CC-BY-NC-4.0">cc-by-nc-4.0</a></p>
<!-- HTML_TAG_END --></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[A Trail Gone Cold (119 pts)]]></title>
            <link>https://www.damninteresting.com/a-trail-gone-cold/</link>
            <guid>41716963</guid>
            <pubDate>Wed, 02 Oct 2024 03:45:32 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.damninteresting.com/a-trail-gone-cold/">https://www.damninteresting.com/a-trail-gone-cold/</a>, See on <a href="https://news.ycombinator.com/item?id=41716963">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>

                    

                    <p><span>

                                                	<span>Long-Form/Podcast:</span>
                            <span>Against the odds, a tiny Icelandic town speaks of a local Black ancestor. Geneticists and historians combine forces to uncover the man’s eventful life.<br></span>
                            <span>Written by <a href="https://www.damninteresting.com/?page_id=531">Marisa Brook</a></span>
                        
                                                	•
                        	<span>Non-Fiction</span>
                        
		        					        		•
			        		<span>March 2024</span>
		        		                    </span>


                </p></div><div>

		            				<article>
											<p>
			© 2024 All Rights Reserved. Do not distribute or repurpose this work without written permission from the copyright holder(s).
	</p>
<p>
	Printed from https://www.damninteresting.com/a-trail-gone-cold/<br>
</p>
										
				
									
		                
						
						
											
					<p>Iceland is known to the rest of the world as the land of Vikings and volcanos, an island caught between continents at the extremities of the map. Remote and comparatively inhospitable, it was settled only as long ago as the 9th century, and has seen little additional in-migration since. Even today, more than 90 percent of Iceland’s 390,000 residents can trace their ancestry back to the earliest permanent inhabitants, a Nordic-Celtic mix. The tradition of the Norse sagas lives on in the form of careful record-keeping about ancestry⁠⁠—and a national passion for genealogy. In other words, it is not the place to stumble upon old family mysteries.</p>
<p>But growing up in the capital city of Reykjavík in the 1950s, neurologist Dr. Kári Stefánsson heard stories that left him curious. Stefánsson’s father had come from Djúpivogur, an eastern coastal town where everyone still spoke of a Black man who had moved there early in the 19th century. “Hans Jónatan”, they called him⁠⁠—a well-liked shopkeeper who had arrived on a ship, married a spirited woman from a local farm, and became a revered member of the community.</p>
<p>The local census did record a man by the name of Hans Jónatan, born in the Caribbean, who was working at the general store in Djúpivogur in the 19th century⁠⁠—but that was all. No images of the man had survived, and his time in Iceland was well before any other humans with African ancestry are known to have visited the island. If tiny, remote Djúpivogur did have a Black man arrive in the 19th century, the circumstances must have been unusual indeed.</p>
<p>It was an intriguing puzzle⁠⁠—and solid grounds for a scientific investigation. Given the amount of homogeneity in the baseline Icelandic population, the genetic signature of one relative newcomer with distinct ancestry might still stand out across a large sample of his descendants. Geneticists thus joined locals and history scholars, and they pieced together a story that bridged three continents.
</p>
<p>
In 1964, University of Copenhagen law professor Knud Waaben wrote an extensive review of two men born into slavery in the 18th century who ended up fighting for their rights in Danish court. History had lost track of both men, according to Waaben, and only speculation was possible as to any later stages in the life of either.</p>
<figure data-embiggen="true"><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAMAAAAoyzS7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAZQTFRFgYGBAAAAqeg2zgAAAAxJREFUeNpiYAAIMAAAAgABT21Z4QAAAABJRU5ErkJggg==" data-height-ratio="0.56176470588235" data-lazy-load-src="https://damn-8791.kxcdn.com/wp-content/uploads/2024/03/damninteresting-a-trail-gone-cold-2.jpg" alt="Sugar plantation in the Danish West Indies (National Museum of Denmark)" title="Sugar plantation in the Danish West Indies (National Museum of Denmark)"></p><figcaption>Sugar plantation in the Danish West Indies (National Museum of Denmark)</figcaption></figure>
<p>One of the two men had been born on 12 April 1784 in the town of Christiansted on the Caribbean island of St. Croix. This small piece of land⁠⁠—named by the French, intermittently occupied by the British, and technically owned by the Danish⁠⁠—exemplified the European-colonial squabbling that was playing out all over the Caribbean, not to mention the Americas and also the world in general.</p>
<p>The economies of St. Croix and the other Danish West Indies were driven almost exclusively by the Europeans’ relatively new but insatiable need for sugar. Production of the stuff was based on an incomprehensible amount of slave labour. Generations of field-slaves and house-slaves endured brutal conditions across hundreds of sugarcane plantations as European sugar magnates became enormously wealthy. By the late 18th century, St. Croix held around 3,000 white people⁠⁠—almost all men⁠⁠—plus about ten times as many Black slaves. Escape attempts were easily thwarted, since St. Croix afforded very few places to hide. Captured runaways were subjected to vicious beatings, public shaming, or both, even if they were children.</p>
<p>In Danish, he was called Hans Jonathan, as he was born into slavery and thus not entitled to a surname. His mother was a house slave named Regina, who at the time was in her mid-20s; her pregnancy was likely involuntary. Regina’s owner was a wealthy young widow named Henrietta Cathrina Schäffer, who brought with her Regina and several other slaves when she married Ludvig Heinrich Ernst von Schimmelmann, a local judge from a prominent German-Danish family who was rapidly climbing through the political ranks of the Danish West Indies. In 1784, the same year Hans Jonathan was born, Schimmelmann was appointed Governor-General of the territory.</p>
<p>Hans was noticeably lighter-skinned than his mother, which suggested he was the offspring of Regina and a free white man. Exactly which free white man is unknown; historical records are vague, indicating only that the father in question was “said to be the secretary”. In his extensive 2014 biography of Hans Jonathan, Icelandic anthropologist Gísli Pálsson weighs the evidence and considers several possibilities. He points out that if “the secretary” is taken literally, the most logical match is a man named Hans Gram, who was the Schimmelmanns’ scribe at the time (though Gram would later find minor fame in the United States as a composer). That said, “the secretary” is not a reliable clue, as it may have been either someone’s guess or a deliberate cover story. Other candidates for Hans’ paternity cannot be ruled out⁠⁠—including Schimmelmann himself.</p>
<figure data-embiggen="true"><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAMAAAAoyzS7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAZQTFRFgYGBAAAAqeg2zgAAAAxJREFUeNpiYAAIMAAAAgABT21Z4QAAAABJRU5ErkJggg==" data-height-ratio="0.95" data-lazy-load-src="https://damn-8791.kxcdn.com/wp-content/uploads/2024/03/damninteresting-a-trail-gone-cold-1.jpg" alt="A map of the Danish West Indies, 1762 (Library of Congress)" title="A map of the Danish West Indies, 1762 (Library of Congress)"></p><figcaption>A map of the Danish West Indies, 1762 (Library of Congress)</figcaption></figure>
<p>Little Hans spent his early childhood at the Schimmelmanns’ sugar plantation, Constitution Hill, picking up three languages used locally (Danish, English, and the St. Croix creole of the time). In 1788, Schimmelmann left his post in the Danish West Indies, and he and Henrietta made arrangements to return to Copenhagen and settle in an affluent neighbourhood. They selected several adult slaves to take back to the homeland⁠⁠—including Hans’s mother, now called Emilia Regina after a mandatory baptism in 1787, and her brother. The slave children were another matter. They were considered too young to bother with, so four-year-old Hans, along with his younger half-sister and their two cousins, were left behind in Christiansted. Surprisingly, four years later, the Schimmelmanns appear to have changed their minds; they arranged for the two eight-year-olds⁠⁠—Hans and one of his cousins⁠⁠—to travel to Copenhagen and join the household in 1792.</p>
<p>Europe was another world relative to St. Croix, and not just because it was colder. The languages were mostly familiar, but the capital of Denmark was large, bustling, and cosmopolitan⁠⁠—home to almost 100,000 people from a variety of backgrounds. Far removed from the sugar plantation, here all of the slaves were house-slaves; they were responsible for looking after the Schimmelmanns’ children, and cleaning and maintaining the family’s lavish five-storey mansion to the standards of European aristocrats.</p>
<p>Ludvig Schimmelmann died at the end of 1793; most of his surviving children moved out in their young adulthood before the end of the century. Now the head of household, Henrietta Schimmelmann made it very evident that she believed in the traditional definition of slavery, whereby her slaves would do her bidding and that was that. The Copenhagen census of 1801 lists that she had nine “servants” at the time, including Hans, his mother, and his cousin. Hans was given a small amount of schooling⁠⁠—enough to learn to read and write and do arithmetic, which suited Hans’s curiosity and intellect. Alongside this, he received exposure to European music and fell in love with playing the violin. At some point, he was able to acquire an instrument of his own, which he cherished. Once he was a teenager, he was to some extent allowed to roam the city on his own. Still, he and the few other Black house-slaves of Copenhagen did not have true freedom, nor would it have readily occurred to their owners to consider giving it to them.</p>
<p>More broadly, across Europe slavery was becoming a contentious political issue. Abolitionist thought was on the rise, with an increasing number of people scoffing at defenders’ insistence that slaves were happy (or, if unhappy, it was their own fault). Denmark agreed in 1792 that it would soon put a stop to new slave trading; however, this would not end any pre-existing slavery. In order to mitigate the inconvenience to angry wealthy white people, the changes would take effect only in stages over several years. In 1795, it became illegal for Danish slaveholders to transport Caribbean slaves back to Denmark (as the Schimmelmanns had done). In 1803, slave trading beyond the Danish West Indies was outlawed.</p>
<figure data-embiggen="true"><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAMAAAAoyzS7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAZQTFRFgYGBAAAAqeg2zgAAAAxJREFUeNpiYAAIMAAAAgABT21Z4QAAAABJRU5ErkJggg==" data-height-ratio="1.4117647058824" data-lazy-load-src="https://damn-8791.kxcdn.com/wp-content/uploads/2024/03/damninteresting-a-trail-gone-cold-5.jpg" alt="A portrait of Henrietta Cathrina von Schimmelmann" title="A portrait of Henrietta Cathrina von Schimmelmann"></p><figcaption>A portrait of Henrietta Cathrina von Schimmelmann</figcaption></figure>
<p>But none of this freed Hans Jonathan. As the 18th century turned into the 19th, he found himself in a rotten state indeed, and started pushing back against his lot in life. He repeatedly broke his evening curfew, spending time in the city and mingling with locals, visitors, and students studying in Copenhagen. This infuriated Henrietta. She would stay up waiting for him, then lecture him when he finally returned. Henrietta was a well-off, powerful woman with allies throughout the upper ranks of Danish society. She had no trouble putting her foot down to rein in a disobedient teenage slave.</p>
<p>Things reached their breaking-point at the beginning of 1801 when greater hostilities flared and Denmark found itself on the brink of war with the United Kingdom. Normally these two countries got along with each other, but that was mainly because Denmark tended to be wary and deferential. The British as a colonial and trading power were brash, dominant, heavy-handed, and hypercompetitive. They were especially interested in keeping war supplies out of the hands of their most dependable adversaries⁠⁠—the French. So when Denmark sought to enter into an alliance with Russia, Sweden, and Prussia to facilitate trade with France, it flung British hackles into the stratosphere. Enraged, Great Britain intercepted a group of Danish trading ships, setting the scene for direct naval conflict. Up against the most powerful navy on the planet, Denmark put out a call for patriotic men to enlist.</p>
<p>Henrietta Schimmelmann’s 20-year-old son enthusiastically took up the call and went to serve in the Royal Danish Navy. Right behind him was a similarly eager 16-year-old Hans Jonathan⁠⁠—until Henrietta caught him and said absolutely <i>not</i>. Hans argued that he did not have to follow her rules. Appalled, Henrietta reached for a cane and whacked the young man with it several times to show him who was boss. That did it. Later that evening, Hans said a quick goodbye to his mother, then walked off the Schimmelmann property and joined the Navy anyway.</p>
<p>Henrietta went to the police. Her son had spoken to them just two days prior, reporting the disappearance of money from his possession⁠—200 Danish <i>rigsdalers</i> (several thousand dollars in modern USD). There is no evidence that this had anything to do with Hans Jonathan, but Henrietta decided to blame her slave for it anyway⁠⁠—on top of complaining about his running away. This move was a gamble that could soon have turned very dark, as theft in Denmark had frequently been treated as a capital offense. Henrietta emphasised that the punishment she sought was merely to have Hans Jonathan sent back to St. Croix and sold. <i>That</i> would put him in his place⁠⁠—literally and otherwise.</p>
<p>Meanwhile, the newly minted naval recruit was about to help his current country face the British. It was the beginning of April, and Britain was eager to catch Danish ships in port at Copenhagen as early as possible. Any later in the spring, and the ice would melt enough to risk letting the Russians out to assist Denmark. In Copenhagen, the Danes would have the home-field advantage, but that was all that could be said for them, as their fleet was much smaller than the British Royal Navy and not remotely as well-trained.</p>
<figure data-embiggen="true"><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAMAAAAoyzS7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAZQTFRFgYGBAAAAqeg2zgAAAAxJREFUeNpiYAAIMAAAAgABT21Z4QAAAABJRU5ErkJggg==" data-height-ratio="0.70588235294118" data-lazy-load-src="https://damn-8791.kxcdn.com/wp-content/uploads/2024/03/damninteresting-a-trail-gone-cold-3.jpg" alt="The Battle of Copenhagen, the Charlotte Amalie among the vessels on the right" title="The Battle of Copenhagen, the Charlotte Amalie among the vessels on the right"></p><figcaption>The Battle of Copenhagen, the <i>Charlotte Amalie</i> among the vessels on the right</figcaption></figure>
<p>The Danish people tended to be quiet about their devotion to their country, but when the Battle of Copenhagen began on 2 April 1801, Denmark found itself whipped into a fiery patriotic frenzy. Hans Jonathan was assigned to the <i>Charlotte Amalie</i>, a ship named after a queen consort from a century earlier. The ship took the not-quite-17-year-old and his shipmates straight to the heart of the action. Barely 300 metres from two huge British ships, the <i>Charlotte Amalie</i> exchanged fire with the British over the course of a harrowing four hours, as the doctors below the deck of the ship desperately tried to keep up with the number of men being wounded or worse. The Danish navy did get a boost from Copenhagen’s narrow harbour, which was difficult for the large British vessels to navigate; Britain briefly wavered and considered retreating, but then regained the upper hand. With British victory inevitable, British Vice-Admiral Horatio Nelson sent a letter to Danish Crown Prince Frederick proposing a ceasefire⁠⁠—the acceptance of which, he added, would keep him from having to set fire to the captured Danish ships with the crews still inside. Frederick accepted, ending the Battle of Copenhagen and kick-starting negotiations between the two countries.</p>
<p>The <i>Charlotte Amalie</i> was battered and had lost about one-sixth of its men. But Hans Jonathan was uninjured, plus his captain noticed his resolve and praised him specifically in front of others. On top of that, the Navy paid the young man 15 Danish rigsdalers for his service in battle (between $200 and $300 in modern USD).</p>
<p>Hans Jonathan probably thought that in joining the Navy against Henrietta Schimmelmann’s wishes, he had made his point. After all, he had risked his life⁠⁠—and perhaps secured a future for himself as a Danish naval officer instead of a slave. It had been only days since the Battle of Copenhagen, but, assuming that Henrietta had given up, Hans went home to see his mother.</p>
<p>Henrietta had done no such thing. The police had paid little attention to her complaint⁠⁠—the imminent British threat to the city had been somewhat more pressing. Without reinforcement, Henrietta created a makeshift jail by locking Hans inside the Schimmelmanns’ property. But after a couple of days she decided that she’d had enough, and released him back to the Royal Danish Navy.</p>
<p>The Navy briefly assigned Hans to a ship called the <i>Denmark</i>, where he forthrightly shared his unusual story with Captain Steen Andersen Bille. Subsequently, reassigned to the <i>Elephant</i>, Hans met a man much like himself: a slave named Peter Samuel who had also just served in the Battle of Copenhagen. Unlike Hans, Peter was in the Navy at the insistence of his owner. Still, the men had a shared goal in securing their freedom. Fortunately, they had an influential ally in Hans’s previous captain. Bille was a thoughtful man who had spent time in the Danish West Indies and was sympathetic to the two men’s cause. Better yet, he was so well-respected in the Danish government that he could simply take the issue directly to Crown Prince Frederick⁠⁠—which he did.</p>
<figure data-embiggen="true"><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAMAAAAoyzS7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAZQTFRFgYGBAAAAqeg2zgAAAAxJREFUeNpiYAAIMAAAAgABT21Z4QAAAABJRU5ErkJggg==" data-height-ratio="1.2811387900356" data-lazy-load-src="https://damn-8791.kxcdn.com/wp-content/uploads/2024/03/damninteresting-a-trail-gone-cold-4.jpg" alt="A portrait of Danish Crown Prince Frederick" title="A portrait of Danish Crown Prince Frederick"></p><figcaption>A portrait of Danish Crown Prince Frederick</figcaption></figure>
<p>As biographer Pálsson points out, this was a dilemma for Frederick, who knew both Steen Bille and Henrietta Schimmelmann well, and was now caught between them in a dispute. Taking either position on the issue of the promising young naval recruit who was also a runaway slave could have amounted to a betrayal.</p>
<p>Frederick considered. Possibly in the spirit of Europe’s encroaching doubt about slavery, he ended up writing a very cautiously worded, three-page letter to Bille on 12 May 1801, gently arguing that on homeland Danish soil, the only people who could be convincingly argued to be <i>legally</i> slaves were prisoners whose sentences specified servitude. As long as Henrietta Schimmelmann was located within Denmark proper, he continued, no one in her household could qualify as anything lower than a free servant. While the letter did not name Hans Jonathan specifically as the person who “is considered free and enjoys rights”, it <i>did</i> refer to Henrietta Schimmelmann, so the intended referent was unambiguous.</p>
<p>It was more than enough for Captain Steen Bille. On 14 May, Bille officially bestowed freedom on Hans Jonathan. From a different commanding officer, but as the result of the same letter from Crown Prince Frederick, his shipmate Peter Samuel received the same. Finally free at 17, Hans Jonathan rented a room above a tavern, filled it with his possessions including the beloved violin, and began to consider how to pursue the life of his own that he had sought for so long.</p>
<p>The development left Henrietta Schimmelmann newly irate. Only a handful of people had seen Frederick’s letter to Bille, and it is not clear if Henrietta was among them; either way, the consequences would have allowed her to infer a major risk to her ability to maintain her household the way she wanted it. The letter was, from this perspective, a dangerous precedent. On its basis, any of the <i>other</i> eight slaves in her household (including Hans Jonathan’s mother, uncle, and cousin) could simply walk away with the presumed blessing of Denmark’s very ruler. Unacceptable! On 19 May⁠⁠—only a week after the release of Frederick’s letter⁠⁠—Henrietta marched straight back into the same police station as before and submitted a formal written complaint, asking the authorities to arrest and question Hans Jonathan.</p>
<p>This time, the police officers went out looking for Hans. Finding him at the tavern, they explained the issue. Hans told them he wanted to serve the Danish monarch by remaining in the navy⁠⁠—and he told the police that he would provide evidence of having been set free.</p>
<p>The complaint was left to be resolved by the courts, but when the case came up in front of the judges, Henrietta Schimmelmann was not in attendance. She had vowed to send relevant documents via her intermediary⁠⁠—her steward Peder Hansen⁠⁠—but when Hansen arrived, he claimed to have no documents to show. The court threw out the case, and Hans Jonathan was free once again. But Henrietta had not given up. She went to the navy and requested 400 rigsdalers as compensation for losing her slave (somewhere between $5,000 and $7,000 in modern USD). The Navy brushed her off.</p>
<p>A badly timed coincidence gave her a new idea. On 20 July 1801, a slave named David Tams slipped away from his rural Danish household and made a wild dash for Copenhagen. He too was from St. Croix and had been brought back to the homeland by slaveowners. However, his attempt at entering the city got him arrested. Tams’s irritated owner then opened a civil lawsuit hoping to establish a legal claim on the man⁠⁠—and Henrietta Schimmelmann, bringing a whole new meaning to the term “follow suit,” decided to do the same. Legally, this was much less complicated than her earlier accusations of theft and desertion; if she won the civil case, it would simply establish that she owned Hans Jonathan, end of story.</p>
<p>It was not obvious how this new court case would go. On the one hand, bringing slaves from the Danish West Indies to Denmark itself had been technically illegal since 1795. On the other, Hans Jonathan had arrived in Denmark before that point, and his move to Copenhagen had not automatically voided his status as a slave. If Henrietta owned him, she should still have the right to sell him. With that, on the evening of 3 December 1801, four police officers set off for the tavern to arrest Hans Jonathan⁠⁠—who once again explained the existence of the letter from Crown Prince Frederick to Captain Steen Bille ensuring his freedom. The police officers were unmoved. A slave with a personal letter from the <i>Crown Prince of Denmark</i>? Suuuure. Within an hour, Hans was in a cell.</p>
<p>At the time, Danish courtroom processes were conducted slowly and mainly through written statements. However, then, as now, access to skilled legal assistance was not equitable. Henrietta Schimmelmann, wealthy and connected, had a steadfast lawyer named N. C. Bierring, and he did so much of the work that there is no evidence she ever made an appearance in court herself. At the other end of the scale, Hans Jonathan was unable to afford the services of any lawyer, and was assigned an attorney by the court, a man thought to be named ‘Beyer’ (though sources do not agree).</p>
<p>Bierring slammed Hans Jonathan for his (supposed) shameless lying⁠⁠—to think that a slave could have had the backing of the Danish crown prince! Captain Bille still had the copy of the letter from Crown Prince Frederick, and either way could have established the truth if called as a witness. However, for some reason, Beyer did not call Bille, which suggests some incompetence as it left the accusation of lying unchallenged. Beyer also made a few errors in recounting the facts of the case, and at one point lapsed into sarcasm. Bierring leapt at the chance to criticise Beyer’s tone, undercutting the inconvenient fact that some of Beyer’s arguments had merit and strength. For instance, Beyer had been through the Danish legal code and found absolutely no support for slavery in homeland Denmark. Also, had Henrietta Schimmelmann not said in her written statement to police that Hans Jonathan had “left her service”⁠⁠—and thus never been anything less than a <i>servant</i>? </p>
<p>Every single one of the witnesses was from Henrietta Schimmelmann’s household, and meant to support the plaintiff. However, they were less than cooperative. Emilia Regina was understandably unhelpful when it came to answering questions in a case against her own son (especially with her own freedom possibly being at stake as well). Likewise, Henrietta’s steward Peder Hansen stood up for Hans Jonathan and pointed out that Henrietta had physically beaten him “a few times with a Spanish stick” and that Hans had left in order to serve his country. Beyer also asked: who was the young man’s father, anyway? A “free white man” or a slave? Presumably the idea was to explore the possibility that Henrietta Schimmelmann’s claim on Hans Jonathan was far from watertight⁠⁠—but the judges accepted Bierring’s objection of “irrelevant” and refused to let Emilia Regina respond.</p>
<p>Toward the end of May 1802, the analogous case of David Tams wrapped up⁠—Danish judges sided with the man’s owner. For Hans Jonathan only days later, the judges likewise announced on 31 May their decision that Hans Jonathan was Henrietta Schimmelmann’s property and she was legally permitted to send him back to the Danish West Indies to be sold. Four of the judges saw no room for argument. The fifth, a young man not much older than Hans himself, ended up siding with his seniors but also made room in his comments for a dissenting argument that Caribbean slaves arriving on Danish soil could only be servants rather than slaves⁠⁠—precisely the conclusion that Crown Prince Frederick had drawn in his not-at-all-fictional letter.</p>
<p>The courts had not found Hans guilty of any crime, but unless he chose to appeal the verdict, he was required to turn himself in to Henrietta Schimmelmann within 15 days. The court does not seem to have noticed that, as a strategy for containing a runaway, this plan left something to be desired.</p>
<p>In the days following the verdict, a summary of the case and its outcome were published and disseminated as usual to the people of Copenhagen⁠⁠—thus making very public the dispute between the socialite and the escaped slave. One Danish government official even wrote to the Danish West Indies to warn them that an ill-behaved man named Hans Jonathan might soon be sold on the island. For the social elite, the details of the civil lawsuit made for irresistible gossip, to the point that it may have become a problem for Henrietta Schimmelmann in spite of her nominal victory.</p>
<p>Hans Jonathan did not request an appeal. He also did not surrender himself to Henrietta Schimmelmann. He was nowhere to be found. Once the 15-day period had elapsed, Henrietta gained the legal right to have him located and arrested. However, she does not seem to have requested police assistance. Instead, within only a year, she moved her household out of the city altogether.</p>
<p>However one-sided, the case was enough of a landmark that the story of the young biracial Black man up against a crushing system remains fairly well-known in Danish legal circles. But the man himself had apparently walked out of the courtroom and into the streets of Copenhagen and vanished. Even more than 150 years later, a comprehensive 1964 article by Danish law professor Knud Waaben would point out that historians had no idea what had become of David Tams and Hans Jonathan.</p>
<center>•&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;•&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;•</center>
<p>Around 2003, a handful of Icelanders found  the 1964 Knud Waaben article. One of them reached out to Waaben, suggesting the possibility that Hans Jónatan⁠—the Caribbean-born ancestor who had arrived in Djúpivogur with the Danish trading ships⁠—was the same Hans Jonathan who had faced the punitive Danish legal system only very slightly earlier. All of the pieces fit, and Hans Jónatan’s backstory filled in the missing history.</p>
<p>Shortly after the 1802 verdict was read, Hans Jonathan briefly and surreptitiously stopped by Henrietta Schimmelmann’s house to gather his possessions, including the treasured violin, and say goodbye to his mother.</p>
<p>At the time, the Danish empire included both Norway and Iceland. While Norway was a powerhouse on the level of Denmark itself, Iceland was heavily agrarian and deep in the clutches of its colonial overlords. In 1800, the island’s 50,000 people were split between so many individual farms and tiny rural towns that even the largest settlement, Reykjavík, had a population of no more than 300. While Iceland had its own history, its own language, and its own literary tradition, Denmark had it in a stranglehold. The Danish essentially maintained a monopoly on trade with Iceland, forbidding the locals from trading with anyone else, and often treated the island like a pesky dependent child.</p>
<figure data-embiggen="true"><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAMAAAAoyzS7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAZQTFRFgYGBAAAAqeg2zgAAAAxJREFUeNpiYAAIMAAAAgABT21Z4QAAAABJRU5ErkJggg==" data-height-ratio="0.80294117647059" data-lazy-load-src="https://damn-8791.kxcdn.com/wp-content/uploads/2024/03/damninteresting-a-trail-gone-cold-6.jpg" alt="A contemporaneous map of Iceland" title="A contemporaneous map of Iceland"></p><figcaption>A contemporaneous map of Iceland</figcaption></figure>
<p>It was around the end of June 1802⁠⁠—just after the northern ice had melted for the summer⁠⁠—that one of the usual Danish trade-ships docked at the town of Djúpivogur along the eastern fjords of Iceland and Hans Jonathan stepped off. The journey had taken about two weeks. It is not known whether Hans chose this location specifically, or simply decided to leave Copenhagen for any reasonably far-flung destination as soon as he could. It is also unclear whether he intended to stay in Djúpivogur or to keep moving around as needed. Perhaps, in the manner of a talented musician, he played it by ear.</p>
<p>At least he could ask around for opportunities at his destination right away. Djúpivogur, population approximately 100, had sprung up as a trading post, and as a result a number of the locals spoke Danish as well as Icelandic.</p>
<p>None of them would have been at all familiar with the sight of a Black man, even a light-skinned biracial Black man. Fortunately, the locals welcomed him without xenophobia. They likely thought of him as the sort of Danish man they were familiar with: a merchant. Which, in fact, is what he soon became. Almost immediately following his arrival in Djúpivogur, Hans met the manager of the town’s general store, Jón Stefánsson, and was hired as an assistant.</p>
<p>Stefánsson was known for his kindness towards Djúpivogur’s townspeople and its very few visitors. He was a businessman but also a songwriter of local renown, not to mention an enthusiastic collector and lender of books. To Hans, Stefánsson soon proved to be a key mentor and a close friend. Stefánsson was Icelandic, but he spoke Danish as well; his wife was also from Denmark.</p>
<p>Icelandic census records accurately list Hans Jonathan’s name, profession, and birthplace⁠⁠—suggesting that he was honest about his origins and background, perhaps due to having quickly established trust with the people of Djúpivogur. However, he must have weighed the risks while deciding what to tell his new neighbours. With so many Danes around, word could conceivably have reached the relentless Henrietta Schimmelmann. On the other hand, especially once he became a trained businessman, Hans may also have been aware that the costs of retrieving an errant slave from so far away would not have been profitable. Besides, by 1807, Denmark was busy contending with a resurgent United Kingdom, leading to a Second Battle of Copenhagen and its humiliating aftermath (including British occupation of the Danish West Indies). A missing slave was not high on anyone’s priority list.</p>
<p>By 1809, on a sparsely populated island where the Atlantic slave-trade was not likely to be on many people’s radar, Jón Stefánsson translated fiery abolitionist essays from Danish into Icelandic. It is probable that this project sprang from discussions that Stefansson was having with his assistant. </p>
<p>Hans had found a niche for himself in every respect. As a young assistant storekeeper, he gained a reputation as a stellar record-keeper, committed to both accuracy and integrity. Some of his records from the Djúpivogur store survive, in tidy Danish-style handwriting. The local oral history preserved tales of Hans Jonathan’s insistence on rectifying accounting errors regardless of who was in the wrong. He gave generously of his time, sharing practical skills related to everything from mathematics to construction to wayfinding. Another of his routine duties was helping visitors to Djúpivogur navigate the harsh local terrain. A Norwegian surveyor, a Scottish preacher, and a Danish friend of the Stefánssons’ all ended up mentioning Hans Jonathan by name in their memoirs.</p>
<p>He was never a wealthy man in Iceland⁠⁠—never a landowner, in a place where virtually everyone else was. But he had his freedom and enough to live on, and he consistently spoke up for the rights and wellbeing of those less fortunate. It is uncertain whether he learned in 1816 that Henrietta Schimmelmann had died. Back in Denmark, he may have been close enough to her children to infer that they did not share their mother’s keen interest in owning slaves. At any rate, from that point onwards, no one would be chasing Hans Jonathan with a metaphorical net.</p>
<p>A few years later, the storekeeper Jón Stefánsson contracted a serious illness, and died in 1819. A Danish mercantile company bought the store and put 35-year-old Hans Jonathan in charge. Around the same time, romantic sparks developed: he and a 21-year-old woman named Katrín Antoníusdóttir caught each other’s attention. She came from a farming family based near Djúpivogur, and was a hard-working, skilled, well-liked member of the community. On 28 February 1820, they were married in a local church; the catering was provided by Jón Stefánsson’s widow Ellen Katrín. </p>
<figure data-embiggen="true"><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAMAAAAoyzS7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAZQTFRFgYGBAAAAqeg2zgAAAAxJREFUeNpiYAAIMAAAAgABT21Z4QAAAABJRU5ErkJggg==" data-height-ratio="0.61176470588235" data-lazy-load-src="https://damn-8791.kxcdn.com/wp-content/uploads/2024/03/damninteresting-a-trail-gone-cold-8.jpg" alt="Iceland's famous aurora" title="Iceland's famous aurora"></p><figcaption>Iceland's famous aurora</figcaption></figure>
<p>To this day, the general practice in Iceland is for children’s second names to be based on the first name of one of the parents; nearly everyone is ‘son of X’, ‘daughter of Y’, or ‘child of Z’. In other words, it did not matter that Hans Jonathan had never had a mainland-European-style family surname in the first place. However, he and his wife decided to treat Hans’s second name like a surname anyway, and to pass it along to their children. Ludvik Stefan Jonathan was born on 26 May 1821, and Hansina Regina Jonathan followed on 4 August 1824.</p>
<p>In between the arrivals of the children, however, the store at Djúpivogur ran into financial trouble. Hans could not stand the sight of poverty and ended up putting the store in debt in order to assist the locals who were struggling the most. In 1823, he left his job and moved his family to a rental farm. This was a small and undistinguished property, but the couple’s combined skills⁠⁠—Katrín having grown up on a farm twice the size⁠⁠—allowed them to carve out a life there. Records of the family’s possessions attest to music-making, ice-skating, and book-reading alongside everyday farmwork.</p>
<p>But Hans’s former employer remained suspicious of him. In 1827, the new store managers concluded that some grain was missing from storage, and asked whether he knew anything about this. The issue never received a resolution. While out in the fields, 43-year-old Hans Jonathan died suddenly of what was probably a cerebral hemorrhage. Given that his family was only renting the farm at Borgargarður, Katrín had him buried at her own family’s farm in nearby Hals. However, as headstones were very expensive, the exact location of his grave is not known.</p>
<p>Many of Hans’s assets were liquidated to settle the outstanding debts⁠⁠—though his beloved violin went to his son Ludvik. Katrín likely continued running the farm at Borgargarður and raising the children on her own, at least until she remarried in about 1834 and the family moved to the town of Bulandnes several years later. Ludvik and Hansina both married and started families of their own, but then both died in their 30s. Fortunately, Katrín lived until 1869, which was long enough to finish raising her six surviving grandchildren and see them all become locally well-respected young adults.</p>
<p>Slavery was finally abolished in the Danish West Indies in 1848, though the system of bound servitude that replaced it was not much better. Only the decline of the sugarcane industry finally brought it all crashing down. In 1917, with the plantation era behind and the colony becoming a financial burden, Denmark sold the Danish West Indies to the United States, which paid $25 million and renamed the territory the U.S. Virgin Islands. Its capital on the island of St. Thomas is still named Charlotte Amalie. As for Iceland, it finally gained full independence from Denmark in 1944, and Reykjavík has become a city of more than 100,000 people.</p>
<center>•&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;•&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;•</center>
<p>Over a century later, in the 1990s, Dr. Kári Stefánsson did not set out to investigate Hans Jónatan’s genetic history. Instead, he became a neurologist, and moved to the United States to complete his training at the University of Chicago, then on to Harvard University to teach. But Stefánsson found himself repeatedly thinking of the untapped scientific potential of mapping and studying the gene pool in his home country.</p>
<p>Stefánsson realised that Iceland’s genetic homogeneity could make it a spectacular natural laboratory. While the combination of a small founding population and a low number of newcomers would not eliminate random mutations in the genome over time, it would certainly control for genetic variance between humans to an unusual degree. One of Stefánsson’s earliest ideas along these lines, for instance, proposed comparing the genetic material of Icelanders with and without multiple sclerosis (MS). Given extremely similar ancestry, the DNA of these two groups would be overwhelmingly comparable. If such a study identified a tiny number of systematic differences between the individuals with MS and those without, those differences would be candidates for the genetic origins of MS in humans more generally. The study would be all the better for taking place in a country with universal health care and⁠⁠—characteristically⁠⁠—extensive medical record-keeping.</p>
<p>By 1996, the chance to launch an enormous Icelandic genome project was too tempting to pass up. Stefánsson resigned his position as Chief of Neuropathology at Harvard and moved back to Iceland to establish deCODE Genetics. While deCODE was always a private biopharmaceutical company, and there are privacy concerns in the collection of health-related information, many Icelanders have been willing to provide consent. The number represented in the data held by deCODE is now well above two-thirds of the adult population of the country⁠⁠—and the findings have been unlike anything else in the world. Aside from identifying markers of susceptibility to particular genetic diseases, the findings have yielded high-resolution models of the human genome, inspired new drug development, and illuminated several aspects of how genes recombine in human offspring.</p>
<p>In the last decade, with new scholarly attention from multiple angles, the full story of Hans Jonathan finally came together. University of Iceland history professor Gísli Pálsson published a full biography of Hans in Icelandic in 2014, with an English translation by Anna Yates (<i>The Man Who Stole Himself</i>) following in 2016.</p>
<p>Meanwhile, deCODE undertook another milestone. Remembering the stories of his youth about the Black ancestor in his father’s hometown of Djúpivogur, Stefánsson started a project with several colleagues to reassemble the man’s genome from the genetic information in his descendants alone. What made the task straightforward was that the signal of any recent African ancestry would be clear against the backdrop of the limited Nordic/Celtic gene pool that had characterised Iceland for 1,200 years. In their 2018 paper, the researchers verified that the only noticeable source of recent African DNA in the Icelandic gene-pool in the fifty years between 1880 and 1930 had come from only one individual with XY sex chromosomes: Hans Jónatan. His Y chromosome, inherited from his father, was typical of mainland Europe; his X chromosome, from his mother, was clearly African in origin.</p>
<figure data-embiggen="true"><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAMAAAAoyzS7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAZQTFRFgYGBAAAAqeg2zgAAAAxJREFUeNpiYAAIMAAAAgABT21Z4QAAAABJRU5ErkJggg==" data-height-ratio="1.4285714285714" data-lazy-load-src="https://damn-8791.kxcdn.com/wp-content/uploads/2024/03/damninteresting-a-trail-gone-cold-7.jpg" alt="Ludvik Ludviksson, Hans Jonathan's grandson" title="Ludvik Ludviksson, Hans Jonathan's grandson"></p><figcaption>Ludvik Ludviksson, Hans Jonathan's grandson</figcaption></figure>
<p>A number of Hans Jonathan and Katrín Antoníusdóttir’s descendants have been noted musicians, and great-granddaughter Hansína Regína Björnsdóttir was a well-known early photographer in the late 19th century. By the 2010s, the genetic researchers who collaborated on the 2018 paper⁠⁠—17 geneticists including Kári Stefánsson himself⁠⁠—found 788 verified living descendants. They partially sequenced the genomes of 182 of these descendants, then for 20 of those, the researchers sequenced their genomes in their entirety. While no single descendant could have inherited all or even most of Hans Jonathan’s DNA, different descendants got different pieces and combinations, and with the influence of the baseline Icelandic gene-pool (i.e. Katrín) filtered out, Hans’s genes from elsewhere have been revealed. While the identity of Hans Jonathan’s “free white man” father has not yet been determined, the researchers have found considerable insight in an analysis of Hans’s maternal DNA.</p>
<p>We know very little about Emilia Regina’s background from the historical record alone. Emilia Regina appears to have been born around 1760, possibly the daughter of one of three house-slaves at a sugar plantation called “La Reine”, but it is not even clear whether she was born on St. Croix or transported there from Africa at a young age. After Henrietta Schimmelmann’s 1802 civil lawsuit, Emilia Regina disappears from the record entirely.</p>
<p>In 2017, Denmark issued a formal apology for the role it played in the European slave-trade. Modern genetics cannot possibly compensate for the harm done, but it can offer some answers after-the-fact and help descendants and their supporters put some of the pieces back together.</p>
<p>The researchers on the 2018 paper zeroed in on Hans Jonathan’s maternal haploid genome⁠⁠—his DNA from Emilia Regina⁠⁠—and reported having been able to reassemble about 38 percent of it. This is a stunning amount of information gathered from modern descendants alone about the mother of a man who died in 1827. Comparing the DNA to reference populations from different parts of the African continent, the geneticists found that Emilia Regina was clearly linked with present-day populations of Nigeria, Cameroon, and Benin⁠⁠—particularly those of Yoruba descent. In reverse-engineering the DNA of a group of present-day descendants to make new discoveries about ancestors from centuries ago, this case study is the first of its kind.</p>
<p>To be sure, the unusual circumstances of Hans Jonathan’s background, in conjunction with his excellent choice of hiding place and the large number of descendants he has, all ensured that this was a relatively clear-cut demonstration of how the DNA of a single ancestor could be disentangled from everything else going on in a population’s collective genes. Still, it is a leap forward for human understanding. Centuries ago, slaves in the Americas abducted from Africa frequently hoped that they would be able to someday return. On the individual level, extremely few were able to do so; however, genetic genealogy opens up the possibility of making reconnections to bridge the gaping hole.</p>
<p>As the editors of <i>Nature Genetics</i> commented in a short editorial accompanying the release of the 2018 article on the background of Hans Jonathan, the project crucially involves “our interwoven genomic and social histories.” In other words, DNA is something of a time-capsule of all of our biological ancestors. To the extent that we are our genes, we are also the histories of those who came before us – just as our own histories will be interwoven with those to come.</p>
				

										
										
						<p>
			© 2024 All Rights Reserved. Do not distribute or repurpose this work without written permission from the copyright holder(s).
	</p>
<p>
	Printed from https://www.damninteresting.com/a-trail-gone-cold/<br>
</p>
						<p>
							<i>Since you enjoyed our work enough to print it out, and read it clear to the end, would you consider donating a few dollars at https://www.damninteresting.com/donate</i> ?
						</p>
									</article>
			
		            	            		
	            	
		            			

				</div></div>]]></description>
        </item>
    </channel>
</rss>