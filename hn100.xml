<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
    <channel>
        <title>HN100 - Readable Contents</title>
        <link>https://hn.algolia.com/api/v1/search_by_date?tags=%28story,poll%29&amp;numericFilters=points%3E100</link>
        <description>Uses Readability to add bodies to the RSS feed</description>
        <lastBuildDate>Sat, 17 Jan 2026 15:30:05 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[ASCII characters are not pixels: a deep dive into ASCII rendering (280 pts)]]></title>
            <link>https://alexharri.com/blog/ascii-rendering</link>
            <guid>46657122</guid>
            <pubDate>Sat, 17 Jan 2026 11:15:26 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://alexharri.com/blog/ascii-rendering">https://alexharri.com/blog/ascii-rendering</a>, See on <a href="https://news.ycombinator.com/item?id=46657122">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><main>
<p>Recently, I’ve been spending my time building an image-to-ASCII renderer. Below is the result — try dragging it around, the demo is interactive!</p>

<p>One thing I spent a lot of effort on is getting edges looking sharp. Take a look at this rotating cube example:</p>

<p>Try opening the “split” view. Notice how well the characters follow the contour of the square.</p>
<p>This renderer works well for animated scenes, like the ones above, but we can also use it to render static images:</p>

<p>The image of Saturn was <a target="_blank" href="https://chatgpt.com/share/69524279-7564-800f-ae22-a2f433794abe">generated with ChatGPT</a>.</p>
<p>Then, to get better separation between different colored regions, I also implemented a <a target="_blank" href="https://en.wikipedia.org/wiki/Cel_shading">cel shading</a>-like effect to enhance contrast between edges. Try dragging the contrast slider below:</p>

<p>The contrast enhancement makes the separation between different colored regions far clearer. That was key to making the 3D scene above look as good as it does.</p>
<p>I put so much focus on sharp edges because they’re an aspect of ASCII rendering that is often overlooked when programmatically rendering images as ASCII. Consider this animated 3D scene from Cognition’s landing page that is rendered via ASCII characters:</p>

<p>Source: <a target="_blank" href="https://cognition.ai/">cognition.ai</a></p>
<p>It’s a cool effect, especially while in motion, but take a look at those blurry edges! The characters follow the cube contours very poorly, and as a result, the edges look blurry and jagged in places:</p>
<div><p><img src="https://alexharri.com/images/posts/ascii-rendering/cube-logo-zoomed-in.png" width="450"></p></div>
<p>This blurriness happens because the ASCII characters are being treated like pixels — their <em>shape</em> is ignored. It’s disappointing to see because ASCII art looks <em>so much</em> better when shape is utilized. I don’t believe I’ve ever seen shape utilized in generated ASCII art, and I think that’s because it’s not really obvious how to consider shape when building an ASCII renderer.</p>
<p>I started building my ASCII renderer to prove to myself that it’s possible to utilize shape in ASCII rendering. In this post, I’ll cover the techniques and ideas I used to capture shape and build this ASCII renderer in detail.</p>
<p>We’ll start with the basics of image-to-ASCII conversion and see where the common issue of blurry edges comes from. After that, I’ll show you the approach I used to fix that and achieve sharp, high-quality ASCII rendering. At the end, we’ll improve on that by implementing the contrast enhancement effect I showed above.</p>
<p>Let’s get to it!</p>
<h2>Image to ASCII conversion</h2>
<p>ASCII contains <a target="_blank" href="https://www.ascii-code.com/characters/printable-characters">95 printable characters</a> that we can use. Let’s start off by rendering the following image containing a white circle using those ASCII characters:</p>

<p>ASCII art is (almost) always rendered using a <a target="_blank" href="https://en.wikipedia.org/wiki/Monospaced_font">monospace</a> font. Since every character in a monospace font is equally wide and tall, we can split the image into a grid. Each grid cell will contain a single ASCII character.</p>
<p>The image with the circle is <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="9.553ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 4222.4 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-1-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path id="MJX-1-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path id="MJX-1-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-1-TEX-N-D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="33" xlink:href="#MJX-1-TEX-N-33"></use><use data-c="36" xlink:href="#MJX-1-TEX-N-36" transform="translate(500,0)"></use><use data-c="30" xlink:href="#MJX-1-TEX-N-30" transform="translate(1000,0)"></use></g><g data-mml-node="mo" transform="translate(1722.2,0)"><use data-c="D7" xlink:href="#MJX-1-TEX-N-D7"></use></g><g data-mml-node="mn" transform="translate(2722.4,0)"><use data-c="33" xlink:href="#MJX-1-TEX-N-33"></use><use data-c="36" xlink:href="#MJX-1-TEX-N-36" transform="translate(500,0)"></use><use data-c="30" xlink:href="#MJX-1-TEX-N-30" transform="translate(1000,0)"></use></g></g></g></svg></mjx-container> pixels. For the ASCII grid, I’ll pick a row height of <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:0" xmlns="http://www.w3.org/2000/svg" width="2.262ex" height="1.532ex" role="img" focusable="false" viewBox="0 -677 1000 677" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-2-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-2-TEX-N-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="32" xlink:href="#MJX-2-TEX-N-32"></use><use data-c="34" xlink:href="#MJX-2-TEX-N-34" transform="translate(500,0)"></use></g></g></g></svg></mjx-container> pixels and a column width of <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="2.262ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1000 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-3-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-3-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="32" xlink:href="#MJX-3-TEX-N-32"></use><use data-c="30" xlink:href="#MJX-3-TEX-N-30" transform="translate(500,0)"></use></g></g></g></svg></mjx-container> pixels. That splits the canvas into <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="2.262ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1000 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-4-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-4-TEX-N-35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-4-TEX-N-31"></use><use data-c="35" xlink:href="#MJX-4-TEX-N-35" transform="translate(500,0)"></use></g></g></g></svg></mjx-container> rows and <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="2.262ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1000 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-5-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-5-TEX-N-38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-5-TEX-N-31"></use><use data-c="38" xlink:href="#MJX-5-TEX-N-38" transform="translate(500,0)"></use></g></g></g></svg></mjx-container> columns — an <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="7.291ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 3222.4 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-6-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-6-TEX-N-38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path><path id="MJX-6-TEX-N-D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path><path id="MJX-6-TEX-N-35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-6-TEX-N-31"></use><use data-c="38" xlink:href="#MJX-6-TEX-N-38" transform="translate(500,0)"></use></g><g data-mml-node="mo" transform="translate(1222.2,0)"><use data-c="D7" xlink:href="#MJX-6-TEX-N-D7"></use></g><g data-mml-node="mn" transform="translate(2222.4,0)"><use data-c="31" xlink:href="#MJX-6-TEX-N-31"></use><use data-c="35" xlink:href="#MJX-6-TEX-N-35" transform="translate(500,0)"></use></g></g></g></svg></mjx-container> grid:</p>

<p>Monospace characters are typically taller than they are wide, so I made each grid cell a bit taller than it is wide.</p>
<p>Our task is now to pick which character to place in each cell. The simplest approach is to calculate a lightness value for each cell and pick a character based on that.</p>
<p>We can get a lightness value for each cell by sampling the lightness of the pixel at the cell’s center:</p>

<p>We want each pixel’s lightness as a numeric value between <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-7-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-7-TEX-N-30"></use></g></g></g></svg></mjx-container> and <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:0" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.507ex" role="img" focusable="false" viewBox="0 -666 500 666" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-8-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-8-TEX-N-31"></use></g></g></g></svg></mjx-container>, but our image data consists of pixels with <a target="_blank" href="https://en.wikipedia.org/wiki/RGB_color_model">RGB</a> color values.</p>
<p>We can use the following formula to convert an RGB color (with component values between <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-9-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-9-TEX-N-30"></use></g></g></g></svg></mjx-container> and <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="3.394ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-10-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-10-TEX-N-35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="32" xlink:href="#MJX-10-TEX-N-32"></use><use data-c="35" xlink:href="#MJX-10-TEX-N-35" transform="translate(500,0)"></use><use data-c="35" xlink:href="#MJX-10-TEX-N-35" transform="translate(1000,0)"></use></g></g></g></svg></mjx-container>) to a lightness value:</p>

<p>See <a target="_blank" href="https://en.wikipedia.org/wiki/Relative_luminance#Relative_luminance_and_%22gamma_encoded%22_colorspaces">relative luminance</a>.</p>
<h3>Mapping lightness values to ASCII characters</h3>
<p>Now that we have a lightness value for each cell, we want to use those values to pick ASCII characters. As mentioned before, ASCII has 95 printable characters, but let’s start simple with just these characters:</p>

<p>We can sort them in approximate density order like so, with lower-density characters to the left, and high-density characters to the right:</p>

<p>We’ll put these characters in a <code><span>CHARS</span></code> array:</p>
<div><pre><p><span>const</span><span> </span><span>CHARS</span><span> </span><span>=</span><span> </span><span>[</span><span>" "</span><span>,</span><span> </span><span>"."</span><span>,</span><span> </span><span>":"</span><span>,</span><span> </span><span>"-"</span><span>,</span><span> </span><span>"="</span><span>,</span><span> </span><span>"+"</span><span>,</span><span> </span><span>"*"</span><span>,</span><span> </span><span>"#"</span><span>,</span><span> </span><span>"%"</span><span>,</span><span> </span><span>"@"</span><span>]</span><span></span></p></pre></div>
<p>I added space as the first (least dense) character.</p>
<p>We can then map lightness values between <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-12-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-12-TEX-N-30"></use></g></g></g></svg></mjx-container> and <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:0" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.507ex" role="img" focusable="false" viewBox="0 -666 500 666" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-13-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-13-TEX-N-31"></use></g></g></g></svg></mjx-container> to one of those characters like so:</p>
<div><pre><p><span>function</span><span> </span><span>getCharacterFromLightness</span><span>(</span><span>lightness</span><span>:</span><span> </span><span>number</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>  </span><span>const</span><span> index </span><span>=</span><span> Math</span><span>.</span><span>floor</span><span>(</span><span>lightness </span><span>*</span><span> </span><span>(</span><span>CHARS</span><span>.</span><span>length </span><span>-</span><span> </span><span>1</span><span>)</span><span>)</span><span>;</span><span></span></p><p><span>  </span><span>return</span><span> </span><span>CHARS</span><span>[</span><span>index</span><span>]</span><span>;</span><span></span></p><p><span></span><span>}</span><span></span></p></pre></div>
<p>This maps low lightness values to low-density characters and high lightness values to high-density characters.</p>
<p>Rendering the circle from above with this method gives us:</p>

<p>That works... but the result is pretty ugly. We seem to always get <code>@</code> for cells that fall within the circle and a space for cells that fall outside.</p>
<p>That is happening because we’ve pretty much just implemented nearest-neighbor downsampling. Let’s see what that means.</p>
<h2>Nearest neighbor downsampling</h2>
<p>Downsampling, in the context of image processing, is taking a larger image (in our case, the <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="9.553ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 4222.4 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-14-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path id="MJX-14-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path id="MJX-14-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-14-TEX-N-D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="33" xlink:href="#MJX-14-TEX-N-33"></use><use data-c="36" xlink:href="#MJX-14-TEX-N-36" transform="translate(500,0)"></use><use data-c="30" xlink:href="#MJX-14-TEX-N-30" transform="translate(1000,0)"></use></g><g data-mml-node="mo" transform="translate(1722.2,0)"><use data-c="D7" xlink:href="#MJX-14-TEX-N-D7"></use></g><g data-mml-node="mn" transform="translate(2722.4,0)"><use data-c="33" xlink:href="#MJX-14-TEX-N-33"></use><use data-c="36" xlink:href="#MJX-14-TEX-N-36" transform="translate(500,0)"></use><use data-c="30" xlink:href="#MJX-14-TEX-N-30" transform="translate(1000,0)"></use></g></g></g></svg></mjx-container> image with the circle) and using that image’s data to construct a lower resolution image (in our case, the <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="7.291ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 3222.4 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-15-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-15-TEX-N-38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path><path id="MJX-15-TEX-N-D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path><path id="MJX-15-TEX-N-35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-15-TEX-N-31"></use><use data-c="38" xlink:href="#MJX-15-TEX-N-38" transform="translate(500,0)"></use></g><g data-mml-node="mo" transform="translate(1222.2,0)"><use data-c="D7" xlink:href="#MJX-15-TEX-N-D7"></use></g><g data-mml-node="mn" transform="translate(2222.4,0)"><use data-c="31" xlink:href="#MJX-15-TEX-N-31"></use><use data-c="35" xlink:href="#MJX-15-TEX-N-35" transform="translate(500,0)"></use></g></g></g></svg></mjx-container> ASCII grid). The pixel values of the lower resolution image are calculated by sampling values from the higher resolution image.</p>
<p>The simplest and fastest method of sampling is <a target="_blank" href="https://en.wikipedia.org/wiki/Nearest-neighbor_interpolation">nearest-neighbor interpolation</a>, where, for each cell (pixel), we only take a single sample from the higher resolution image.</p>
<p>Consider the circle example again. Using nearest-neighbor interpolation, every sample either falls inside or outside of the shape, resulting in either <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.127ex" xmlns="http://www.w3.org/2000/svg" width="3.016ex" height="1.824ex" role="img" focusable="false" viewBox="0 -750 1333 806" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-16-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-16-TEX-N-25" d="M465 605Q428 605 394 614T340 632T319 641Q332 608 332 548Q332 458 293 403T202 347Q145 347 101 402T56 548Q56 637 101 693T202 750Q241 750 272 719Q359 642 464 642Q580 642 650 732Q662 748 668 749Q670 750 673 750Q682 750 688 743T693 726Q178 -47 170 -52Q166 -56 160 -56Q147 -56 142 -45Q137 -36 142 -27Q143 -24 363 304Q469 462 525 546T581 630Q528 605 465 605ZM207 385Q235 385 263 427T292 548Q292 617 267 664T200 712Q193 712 186 709T167 698T147 668T134 615Q132 595 132 548V527Q132 436 165 403Q183 385 203 385H207ZM500 146Q500 234 544 290T647 347Q699 347 737 292T776 146T737 0T646 -56Q590 -56 545 0T500 146ZM651 -18Q679 -18 707 24T736 146Q736 215 711 262T644 309Q637 309 630 306T611 295T591 265T578 212Q577 200 577 146V124Q577 -18 647 -18H651Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-16-TEX-N-30"></use></g><g data-mml-node="mi" transform="translate(500,0)"><use data-c="25" xlink:href="#MJX-16-TEX-N-25"></use></g></g></g></svg></mjx-container> or <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.127ex" xmlns="http://www.w3.org/2000/svg" width="5.278ex" height="1.824ex" role="img" focusable="false" viewBox="0 -750 2333 806" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-17-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-17-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-17-TEX-N-25" d="M465 605Q428 605 394 614T340 632T319 641Q332 608 332 548Q332 458 293 403T202 347Q145 347 101 402T56 548Q56 637 101 693T202 750Q241 750 272 719Q359 642 464 642Q580 642 650 732Q662 748 668 749Q670 750 673 750Q682 750 688 743T693 726Q178 -47 170 -52Q166 -56 160 -56Q147 -56 142 -45Q137 -36 142 -27Q143 -24 363 304Q469 462 525 546T581 630Q528 605 465 605ZM207 385Q235 385 263 427T292 548Q292 617 267 664T200 712Q193 712 186 709T167 698T147 668T134 615Q132 595 132 548V527Q132 436 165 403Q183 385 203 385H207ZM500 146Q500 234 544 290T647 347Q699 347 737 292T776 146T737 0T646 -56Q590 -56 545 0T500 146ZM651 -18Q679 -18 707 24T736 146Q736 215 711 262T644 309Q637 309 630 306T611 295T591 265T578 212Q577 200 577 146V124Q577 -18 647 -18H651Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-17-TEX-N-31"></use><use data-c="30" xlink:href="#MJX-17-TEX-N-30" transform="translate(500,0)"></use><use data-c="30" xlink:href="#MJX-17-TEX-N-30" transform="translate(1000,0)"></use></g><g data-mml-node="mi" transform="translate(1500,0)"><use data-c="25" xlink:href="#MJX-17-TEX-N-25"></use></g></g></g></svg></mjx-container> lightness:</p>

<p>If, instead of picking an ASCII character for each grid cell, we color each grid cell (pixel) according to the sampled value, we get the following pixelated rendering:</p>

<p>This pixelated rendering is pretty much equivalent to the ASCII rendering from before. The only difference is that instead of <code>@</code>s we have white pixels, and instead of spaces we have black pixels.</p>
<p>These square, jagged looking edges are aliasing artifacts, commonly called <a target="_blank" href="https://en.wikipedia.org/wiki/Jaggies">jaggies</a>. They’re a common result of using nearest-neighbor interpolation.</p>
<h3>Supersampling</h3>
<p>To get rid of jaggies, we can collect more samples for each cell. Consider this line:</p>

<p>The line’s slope on the <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.464ex" xmlns="http://www.w3.org/2000/svg" width="1.109ex" height="1.464ex" role="img" focusable="false" viewBox="0 -442 490 647" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-18-TEX-I-1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D466" xlink:href="#MJX-18-TEX-I-1D466"></use></g></g></g></svg></mjx-container> axis is <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-1.602ex" xmlns="http://www.w3.org/2000/svg" width="3.421ex" height="4.638ex" role="img" focusable="false" viewBox="0 -1342 1512 2050" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-19-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-19-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path id="MJX-19-TEX-I-1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mstyle"><g data-mml-node="mfrac"><g data-mml-node="mn" transform="translate(220,676)"><use data-c="31" xlink:href="#MJX-19-TEX-N-31"></use></g><g data-mml-node="mn" transform="translate(220,-686)"><use data-c="33" xlink:href="#MJX-19-TEX-N-33"></use></g><rect width="700" height="60" x="120" y="220"></rect></g></g><g data-mml-node="mi" transform="translate(940,0)"><use data-c="1D465" xlink:href="#MJX-19-TEX-I-1D465"></use></g></g></g></svg></mjx-container>. When we pixelate it with nearest-neighbor interpolation, we get the following:</p>

<p>Let’s try to get rid of the jagginess by taking multiple samples within each cell and using the average sampled lightness value as the cell’s lightness. The example below lets you vary the number of samples using the slider:</p>

<p>With multiple samples, cells that lie on the edge of a shape will have some of their samples fall within the shape, and some outside of it. Averaging those, we get gray in-between colors that smooth the downsampled image. Below is the same example, but with an overlay showing where the samples are taken:</p>

<p>This method of collecting multiple samples from the larger image is called <a target="_blank" href="https://en.wikipedia.org/wiki/Supersampling">supersampling</a>. It’s a common method of <a target="_blank" href="https://en.wikipedia.org/wiki/Spatial_anti-aliasing">spatial anti-aliasing</a> (avoiding jaggies at edges). Here’s what the rotating square looks like with supersampling (using <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-20-TEX-N-38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="38" xlink:href="#MJX-20-TEX-N-38"></use></g></g></g></svg></mjx-container> samples for each cell):</p>

<p>Let’s look at what supersampling does for the circle example from earlier. Try dragging the sample quality slider:</p>

<p>The circle becomes less jagged, but the edges feel blurry. Why’s that?</p>
<p>Well, they feel blurry because we’re pretty much just rendering a low-resolution, pixelated image of a circle. Take a look at the pixelated view:</p>

<p>The ASCII and pixelated views are mirror images of each other. Both are just low-resolution versions of the original high-resolution image, scaled up to the original’s size — it’s no wonder they both look blurry.</p>
<hr>
<p>Increasing the number of samples is insufficient. No matter how many samples we take per cell, the samples will be averaged into a single lightness value, used to render a single pixel.</p>
<p>And that’s the core problem: treating each grid cell as a pixel in an image. It’s an obvious and simple method, but it disregards that ASCII characters have shape.</p>
<p>We can make our ASCII renderings far more crisp by picking characters based on their shape. Here’s the circle rendered that way:</p>

<p>The characters follow the contour of the circle very well. By picking characters based on shape, we get a far higher <em>effective</em> resolution. The result is also more visually interesting.</p>
<p>Let’s see how we can implement this.</p>
<h2>Shape</h2>
<p>So what do I mean by shape? Well, consider the characters <code>T</code>, <code>L</code>, and <code>O</code> placed within grid cells:</p>

<p>The character <code>T</code> is top-heavy. Its visual density in the upper half of the grid cell is higher than in the lower half. The opposite can be said for <code>L</code> — it’s bottom-heavy. <code>O</code> is pretty much equally dense in the upper and lower halves of the cell.</p>
<p>We might also compare characters like <code>L</code> and <code>J</code>. The character <code>L</code> is heavier within the left half of the cell, while <code>J</code> is heavier in the right half:</p>

<p>We also have more “extreme” characters, such as <code>_</code> and <code>^</code>, that only occupy the lower or upper portion of the cell, respectively:</p>

<p>This is, roughly, what I mean by “shape” in the context of ASCII rendering. Shape refers to which regions of a cell a given character visually occupies.</p>
<h3>Quantifying shape</h3>
<p>To pick characters based on their shape, we’ll somehow need to quantify (put numbers to) the shape of each character.</p>
<p>Let’s start by only considering how much characters occupy the upper and lower regions of our cell. To do that, we’ll define two “sampling circles” for each grid cell — one placed in the upper half and one in the lower half:</p>

<p>It may seem odd or arbitrary to use circles instead of just splitting the cell into two rectangles, but using circles will give us more flexibility later on.</p>
<p>A character placed within a cell will overlap each of the cell’s sampling circles to <em>some</em> extent.</p>

<p>One can compute that overlap by taking a bunch of samples within the circle (for example, at every pixel). The fraction of samples that land inside the character gives us the overlap as a numeric value between <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-21-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-21-TEX-N-30"></use></g></g></g></svg></mjx-container> and <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:0" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.507ex" role="img" focusable="false" viewBox="0 -666 500 666" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-22-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-22-TEX-N-31"></use></g></g></g></svg></mjx-container>:</p>


<p>For T, we get an overlap of approximately <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="5.154ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 2278 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-24-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-24-TEX-N-2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path><path id="MJX-24-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-24-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path id="MJX-24-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-24-TEX-N-30"></use><use data-c="2E" xlink:href="#MJX-24-TEX-N-2E" transform="translate(500,0)"></use><use data-c="32" xlink:href="#MJX-24-TEX-N-32" transform="translate(778,0)"></use><use data-c="36" xlink:href="#MJX-24-TEX-N-36" transform="translate(1278,0)"></use><use data-c="31" xlink:href="#MJX-24-TEX-N-31" transform="translate(1778,0)"></use></g></g></g></svg></mjx-container> for the upper circle and <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="5.154ex" height="1.579ex" role="img" focusable="false" viewBox="0 -676 2278 698" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-25-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-25-TEX-N-2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path><path id="MJX-25-TEX-N-39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z"></path><path id="MJX-25-TEX-N-37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-25-TEX-N-30"></use><use data-c="2E" xlink:href="#MJX-25-TEX-N-2E" transform="translate(500,0)"></use><use data-c="30" xlink:href="#MJX-25-TEX-N-30" transform="translate(778,0)"></use><use data-c="39" xlink:href="#MJX-25-TEX-N-39" transform="translate(1278,0)"></use><use data-c="37" xlink:href="#MJX-25-TEX-N-37" transform="translate(1778,0)"></use></g></g></g></svg></mjx-container> for the lower. Those overlap values form a <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:0" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.507ex" role="img" focusable="false" viewBox="0 -666 500 666" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-26-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="32" xlink:href="#MJX-26-TEX-N-32"></use></g></g></g></svg></mjx-container>-dimensional vector:</p>

<p>We can generate such a <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:0" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.507ex" role="img" focusable="false" viewBox="0 -666 500 666" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-28-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="32" xlink:href="#MJX-28-TEX-N-32"></use></g></g></g></svg></mjx-container>-dimensional vector for each character within the ASCII alphabet. These vectors quantify the shape of each ASCII character along these <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:0" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.507ex" role="img" focusable="false" viewBox="0 -666 500 666" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-29-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="32" xlink:href="#MJX-29-TEX-N-32"></use></g></g></g></svg></mjx-container> dimensions (upper and lower). I’ll call these vectors <em>shape vectors</em>.</p>
<p>Below are some ASCII characters and their shape vectors. I’m coloring the sampling circles using the component values of the shape vectors:</p>

<p>We can use the shape vectors as 2D coordinates — here’s every ASCII character on a 2D plot:</p>
<p><svg viewBox="-0.041760000000000005 0 0.47676 0.47676" preserveAspectRatio="xMidYMid meet"><defs><marker id="arrowhead" markerWidth="8" markerHeight="8" refX="4" refY="4" orient="auto" viewBox="0 0 8 8"><path d="M0,0 L4,4 L0,8" stroke="#399ef4" stroke-width="1.5" fill="none"></path></marker></defs><g><line x1="0" y1="0" x2="0" y2="0.435"></line><line x1="0" y1="0.435" x2="0.435" y2="0.435"></line><line x1="0.05" y1="0" x2="0.05" y2="0.435"></line><line x1="0" y1="0.385" x2="0.435" y2="0.385"></line><line x1="0.1" y1="0" x2="0.1" y2="0.435"></line><line x1="0" y1="0.33499999999999996" x2="0.435" y2="0.33499999999999996"></line><line x1="0.15000000000000002" y1="0" x2="0.15000000000000002" y2="0.435"></line><line x1="0" y1="0.285" x2="0.435" y2="0.285"></line><line x1="0.2" y1="0" x2="0.2" y2="0.435"></line><line x1="0" y1="0.235" x2="0.435" y2="0.235"></line><line x1="0.25" y1="0" x2="0.25" y2="0.435"></line><line x1="0" y1="0.185" x2="0.435" y2="0.185"></line><line x1="0.30000000000000004" y1="0" x2="0.30000000000000004" y2="0.435"></line><line x1="0" y1="0.13499999999999995" x2="0.435" y2="0.13499999999999995"></line><line x1="0.35000000000000003" y1="0" x2="0.35000000000000003" y2="0.435"></line><line x1="0" y1="0.08499999999999996" x2="0.435" y2="0.08499999999999996"></line><line x1="0.4" y1="0" x2="0.4" y2="0.435"></line><line x1="0" y1="0.034999999999999976" x2="0.435" y2="0.034999999999999976"></line></g><g><text x="0" y="0.439176" dy="1.2em" font-size="0.010440000000000001">0</text><text x="-0.017748000000000003" y="0.435" dy="0.3em" text-anchor="end" font-size="0.010440000000000001">0</text><text x="0.05" y="0.439176" dy="1.2em" font-size="0.010440000000000001">0.05</text><text x="-0.017748000000000003" y="0.385" dy="0.3em" text-anchor="end" font-size="0.010440000000000001">0.05</text><text x="0.1" y="0.439176" dy="1.2em" font-size="0.010440000000000001">0.1</text><text x="-0.017748000000000003" y="0.33499999999999996" dy="0.3em" text-anchor="end" font-size="0.010440000000000001">0.1</text><text x="0.15000000000000002" y="0.439176" dy="1.2em" font-size="0.010440000000000001">0.15</text><text x="-0.017748000000000003" y="0.285" dy="0.3em" text-anchor="end" font-size="0.010440000000000001">0.15</text><text x="0.2" y="0.439176" dy="1.2em" font-size="0.010440000000000001">0.2</text><text x="-0.017748000000000003" y="0.235" dy="0.3em" text-anchor="end" font-size="0.010440000000000001">0.2</text><text x="0.25" y="0.439176" dy="1.2em" font-size="0.010440000000000001">0.25</text><text x="-0.017748000000000003" y="0.185" dy="0.3em" text-anchor="end" font-size="0.010440000000000001">0.25</text><text x="0.30000000000000004" y="0.439176" dy="1.2em" font-size="0.010440000000000001">0.3</text><text x="-0.017748000000000003" y="0.13499999999999995" dy="0.3em" text-anchor="end" font-size="0.010440000000000001">0.3</text><text x="0.35000000000000003" y="0.439176" dy="1.2em" font-size="0.010440000000000001">0.35</text><text x="-0.017748000000000003" y="0.08499999999999996" dy="0.3em" text-anchor="end" font-size="0.010440000000000001">0.35</text><text x="0.4" y="0.439176" dy="1.2em" font-size="0.010440000000000001">0.4</text><text x="-0.017748000000000003" y="0.034999999999999976" dy="0.3em" text-anchor="end" font-size="0.010440000000000001">0.4</text></g><text x="0.2175" y="0.470496" text-anchor="middle" font-size="0.011442240000000003">Upper</text><text x="-0.039672000000000006" y="0.2175" text-anchor="middle" dominant-baseline="middle" font-size="0.011442240000000003" transform="rotate(-90, -0.039672000000000006, 0.2175)">Lower</text><rect x="0" y="0" width="0.435" height="0.435"></rect><g><circle cx="0" cy="0.435" r="0.001525632"></circle><circle cx="0.11821758803855989" cy="0.36039838677946096" r="0.001525632"></circle><circle cx="0.1773952390320677" cy="0.435" r="0.001525632"></circle><circle cx="0.25848908125122966" cy="0.21852678864187822" r="0.001525632"></circle><circle cx="0.3255098694996394" cy="0.1731926683716965" r="0.001525632"></circle><circle cx="0.28755328218243836" cy="0.20379139615712508" r="0.001525632"></circle><circle cx="0.21459112072922823" cy="0.2507911994229129" r="0.001525632"></circle><circle cx="0.0885697422781822" cy="0.435" r="0.001525632"></circle><circle cx="0.122224408157912" cy="0.31297232605416747" r="0.001525632"></circle><circle cx="0.06432552954292085" cy="0.3624181913568103" r="0.001525632"></circle><circle cx="0" cy="0.2881969309462915" r="0.001525632"></circle><circle cx="0" cy="0.3419578333005443" r="0.001525632"></circle><circle cx="0.14572758869434063" cy="0.3142248672044068" r="0.001525632"></circle><circle cx="0.18889107482457868" cy="0.26723162174568804" r="0.001525632"></circle><circle cx="0.1893829103547775" cy="0.2670939077972325" r="0.001525632"></circle><circle cx="0.1364941963407436" cy="0.31925470522657223" r="0.001525632"></circle><circle cx="0.15455439700964002" cy="0.3025060659715392" r="0.001525632"></circle><circle cx="0.15566266640435444" cy="0.30124040920716116" r="0.001525632"></circle><circle cx="0.07777559184208799" cy="0.35706702078824837" r="0.001525632"></circle><circle cx="0.07777559184208799" cy="0.28718047085054754" r="0.001525632"></circle><circle cx="0.10804642927405075" cy="0.3261994229129779" r="0.001525632"></circle><circle cx="0.09930487245065252" cy="0.3319571775198374" r="0.001525632"></circle><circle cx="0.10855138041838808" cy="0.3248091678142829" r="0.001525632"></circle><circle cx="0.2037445078365794" cy="0.35984753098563843" r="0.001525632"></circle><circle cx="0.24616040396091562" cy="0.14953210046560428" r="0.001525632"></circle><circle cx="0.14530133123483513" cy="0.3136018755328218" r="0.001525632"></circle><circle cx="0.19216342055216742" cy="0.435" r="0.001525632"></circle><circle cx="0.05790543642206046" cy="0.435" r="0.001525632"></circle><circle cx="0.1776313200865631" cy="0.28479342907731653" r="0.001525632"></circle><circle cx="0.17881828316610926" cy="0.28443930749557345" r="0.001525632"></circle><circle cx="0.027641156797167023" cy="0.4038963210702341" r="0.001525632"></circle><circle cx="0.006675847596563709" cy="0.42262541806020065" r="0.001525632"></circle><circle cx="0" cy="0.298932061118762" r="0.001525632"></circle><circle cx="0.2652698537609022" cy="0.21760869565217386" r="0.001525632"></circle><circle cx="0.16862745098039206" cy="0.2583523509738346" r="0.001525632"></circle><circle cx="0.18839268148731061" cy="0.24143320873499924" r="0.001525632"></circle><circle cx="0.1989114040264935" cy="0.2720057052921503" r="0.001525632"></circle><circle cx="0.12333923535969571" cy="0.26068693029051104" r="0.001525632"></circle><circle cx="0.22670339038625487" cy="0.2819407830021641" r="0.001525632"></circle><circle cx="0.20956784051413202" cy="0.2563391042035543" r="0.001525632"></circle><circle cx="0.19799986884385862" cy="0.33628533018558593" r="0.001525632"></circle><circle cx="0.27226703390386253" cy="0.23941996196471899" r="0.001525632"></circle><circle cx="0.2280411830283954" cy="0.29418420880057705" r="0.001525632"></circle><circle cx="0.19589481277460816" cy="0.20369302905108527" r="0.001525632"></circle><circle cx="0.29015017378188757" cy="0.22776018099547518" r="0.001525632"></circle><circle cx="0.1701488622204735" cy="0.2751141058430061" r="0.001525632"></circle><circle cx="0.2349662272935932" cy="0.23597711325332815" r="0.001525632"></circle><circle cx="0.22486064659977736" cy="0.2638871401403372" r="0.001525632"></circle><circle cx="0.2204406846350583" cy="0.3462663125450849" r="0.001525632"></circle><circle cx="0.17966424027805114" cy="0.23707882484097315" r="0.001525632"></circle><circle cx="0.24468489737031945" cy="0.27933733359564544" r="0.001525632"></circle><circle cx="0.20061643386451578" cy="0.2530864318971735" r="0.001525632"></circle><circle cx="0.15756443045445592" cy="0.27827496885041636" r="0.001525632"></circle><circle cx="0.23382516886353202" cy="0.23113089382910354" r="0.001525632"></circle><circle cx="0.10785625286904064" cy="0.25520460358056274" r="0.001525632"></circle><circle cx="0.3290248540887927" cy="0.2380231490589548" r="0.001525632"></circle><circle cx="0.27671978490392823" cy="0.20783756311889318" r="0.001525632"></circle><circle cx="0.21219096334185844" cy="0.2547258836645026" r="0.001525632"></circle><circle cx="0.24623909764574722" cy="0.32359597350645947" r="0.001525632"></circle><circle cx="0.21066299429470783" cy="0.18520657092268344" r="0.001525632"></circle><circle cx="0.27609023542527383" cy="0.2406462718866811" r="0.001525632"></circle><circle cx="0.24087481146304673" cy="0.25970325923011345" r="0.001525632"></circle><circle cx="0.2383369401272215" cy="0.3359836710603974" r="0.001525632"></circle><circle cx="0.18660240015738727" cy="0.24563020525936127" r="0.001525632"></circle><circle cx="0.2149780313463178" cy="0.2786684372745754" r="0.001525632"></circle><circle cx="0.2771132533280871" cy="0.16859564561610602" r="0.001525632"></circle><circle cx="0.22646730933175951" cy="0.23246868647124402" r="0.001525632"></circle><circle cx="0.2390123942553611" cy="0.33364253393665155" r="0.001525632"></circle><circle cx="0.21674863925503313" cy="0.22838973047412964" r="0.001525632"></circle><circle cx="0.11309594071742411" cy="0.18910190832185725" r="0.001525632"></circle><circle cx="0.2116269919338973" cy="0.22998983539904252" r="0.001525632"></circle><circle cx="0.11532559512099155" cy="0.2847540822349006" r="0.001525632"></circle><circle cx="0.20904321594858669" cy="0.22939307495573485" r="0.001525632"></circle><circle cx="0.11894550462325396" cy="0.23684930159354708" r="0.001525632"></circle><circle cx="0.2533608761230244" cy="0.3412692635582661" r="0.001525632"></circle><circle cx="0.15601023017902813" cy="0.06340186241720747" r="0.001525632"></circle><circle cx="0.2105187225391829" cy="0.27655026559118634" r="0.001525632"></circle><circle cx="0.14461276149255692" cy="0.26013607449668846" r="0.001525632"></circle><circle cx="0.15413469735720384" cy="0.2478729752770673" r="0.001525632"></circle><circle cx="0.1931405338054954" cy="0.2340622335890878" r="0.001525632"></circle><circle cx="0.16915863335300677" cy="0.30026985376090237" r="0.001525632"></circle><circle cx="0.1696570266902748" cy="0.22629123221194838" r="0.001525632"></circle><circle cx="0.1410977769034035" cy="0.27655026559118634" r="0.001525632"></circle><circle cx="0.12373926159092398" cy="0.2493091350252475" r="0.001525632"></circle><circle cx="0.14038953373991736" cy="0.16158534985900724" r="0.001525632"></circle><circle cx="0.13718932389009109" cy="0.15843104465866636" r="0.001525632"></circle><circle cx="0.16752573939274704" cy="0.29740409207161134" r="0.001525632"></circle><circle cx="0.11361400747590003" cy="0.22793724178634653" r="0.001525632"></circle><circle cx="0.1711522067020787" cy="0.29528592038822216" r="0.001525632"></circle><circle cx="0.09076004983933374" cy="0.2272224408157912" r="0.001525632"></circle><circle cx="0.09908190701029577" cy="0.2779601941110893" r="0.001525632"></circle><circle cx="0.09757361138435307" cy="0.17291068266771598" r="0.001525632"></circle><circle cx="0.12972653944520954" cy="0.23848219555380687" r="0.001525632"></circle><circle cx="0.09931798806479115" cy="0.19530559380943008" r="0.001525632"></circle><circle cx="0.1428487113909108" cy="0.24596465341989657" r="0.001525632"></circle></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.18262822055216743" y="0.41020848" width="0.019070399999999998" height="0.019070399999999998" rx="0.0023837999999999997"></rect><text x="0.19216342055216742" y="0.41974368" text-anchor="middle" dominant-baseline="middle" font-size="0.015892">^</text></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.23662520396091563" y="0.1247405804656043" width="0.019070399999999998" height="0.019070399999999998" rx="0.0023837999999999997"></rect><text x="0.24616040396091562" y="0.1342757804656043" text-anchor="middle" dominant-baseline="middle" font-size="0.015892">@</text></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.1276541238900911" y="0.13363952465866638" width="0.019070399999999998" height="0.019070399999999998" rx="0.0023837999999999997"></rect><text x="0.13718932389009109" y="0.14317472465866637" text-anchor="middle" dominant-baseline="middle" font-size="0.015892">q</text></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.22880174012722151" y="0.3111921510603974" width="0.019070399999999998" height="0.019070399999999998" rx="0.0023837999999999997"></rect><text x="0.2383369401272215" y="0.3207273510603974" text-anchor="middle" dominant-baseline="middle" font-size="0.015892">T</text></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.31948965408879265" y="0.21323162905895482" width="0.019070399999999998" height="0.019070399999999998" rx="0.0023837999999999997"></rect><text x="0.3290248540887927" y="0.2227668290589548" text-anchor="middle" dominant-baseline="middle" font-size="0.015892">M</text></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.08122484983933374" y="0.20243092081579123" width="0.019070399999999998" height="0.019070399999999998" rx="0.0023837999999999997"></rect><text x="0.09076004983933374" y="0.21196612081579122" text-anchor="middle" dominant-baseline="middle" font-size="0.015892">u</text></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.21693210933175952" y="0.20767716647124404" width="0.019070399999999998" height="0.019070399999999998" rx="0.0023837999999999997"></rect><text x="0.22646730933175951" y="0.21721236647124403" text-anchor="middle" dominant-baseline="middle" font-size="0.015892">X</text></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.31597466949963937" y="0.14840114837169652" width="0.019070399999999998" height="0.019070399999999998" rx="0.0023837999999999997"></rect><text x="0.3255098694996394" y="0.1579363483716965" text-anchor="middle" dominant-baseline="middle" font-size="0.015892">$</text></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.14647503017902813" y="0.03861034241720746" width="0.019070399999999998" height="0.019070399999999998" rx="0.0023837999999999997"></rect><text x="0.15601023017902813" y="0.04814554241720746" text-anchor="middle" dominant-baseline="middle" font-size="0.015892">g</text></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.08976967245065252" y="0.3071656575198374" width="0.019070399999999998" height="0.019070399999999998" rx="0.0023837999999999997"></rect><text x="0.09930487245065252" y="0.3167008575198374" text-anchor="middle" dominant-baseline="middle" font-size="0.015892">=</text></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.16061366222047352" y="0.2503225858430061" width="0.019070399999999998" height="0.019070399999999998" rx="0.0023837999999999997"></rect><text x="0.1701488622204735" y="0.2598577858430061" text-anchor="middle" dominant-baseline="middle" font-size="0.015892">C</text></g></svg></p>
<h3>Shape-based lookup</h3>
<p>Let’s say that we have our ASCII characters and their associated shape vectors in a <code><span>CHARACTERS</span></code> array:</p>
<div><pre><p><span>const</span><span> </span><span>CHARACTERS</span><span>:</span><span> </span><span>Array</span><span>&lt;</span><span>{</span><span></span></p><p><span>  character</span><span>:</span><span> </span><span>string</span><span>,</span><span></span></p><p><span>  shapeVector</span><span>:</span><span> </span><span>number</span><span>[</span><span>]</span><span>,</span><span></span></p><p><span></span><span>}</span><span>&gt;</span><span> </span><span>=</span><span> </span><span>[</span><span>...</span><span>]</span><span>;</span><span></span></p></pre></div>
<p>We can then perform a nearest neighbor search like so:</p>
<div><pre><p><span>function</span><span> </span><span>findBestCharacter</span><span>(</span><span>inputVector</span><span>:</span><span> </span><span>number</span><span>[</span><span>]</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>  </span><span>let</span><span> bestCharacter </span><span>=</span><span> </span><span>""</span><span>;</span><span></span></p><p><span>  </span><span>let</span><span> bestDistance </span><span>=</span><span> </span><span>Infinity</span><span>;</span><span></span></p><p><span>  </span><span>for</span><span> </span><span>(</span><span>const</span><span> </span><span>{</span><span> character</span><span>,</span><span> shapeVector </span><span>}</span><span> </span><span>of</span><span> </span><span>CHARACTERS</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>    </span><span>const</span><span> dist </span><span>=</span><span> </span><span>getDistance</span><span>(</span><span>shapeVector</span><span>,</span><span> inputVector</span><span>)</span><span>;</span><span></span></p><p><span>    </span><span>if</span><span> </span><span>(</span><span>dist </span><span>&lt;</span><span> bestDistance</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>      bestDistance </span><span>=</span><span> dist</span><span>;</span><span></span></p><p><span>      bestCharacter </span><span>=</span><span> character</span><span>;</span><span></span></p><p><span>    </span><span>}</span><span></span></p><p><span>  </span><span>}</span><span></span></p><p><span>  </span><span>return</span><span> bestCharacter</span><span>;</span><span></span></p><p><span></span><span>}</span><span></span></p></pre></div>
<p>The <code><span>findBestCharacter</span></code> function gives us the ASCII character whose shape best matches the input lookup vector.</p>
<p>Note: this brute force search is not very performant. This becomes a bottleneck when we start rendering thousands of ASCII characters at <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="2.262ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1000 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-30-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path id="MJX-30-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="36" xlink:href="#MJX-30-TEX-N-36"></use><use data-c="30" xlink:href="#MJX-30-TEX-N-30" transform="translate(500,0)"></use></g></g></g></svg></mjx-container> <abbr title="Frames per second">FPS</abbr>. I’ll talk more about this later.</p>
<p>To make use of this in our ASCII renderer, we’ll calculate a lookup vector for each cell in the ASCII grid and pass it to <code><span>findBestCharacter</span></code> to determine the character to display.</p>
<p>Let’s try it out. Consider the following zoomed-in circle as an example. It is split into three grid cells:</p>

<p>Overlaying our sampling circles, we see varying degrees of overlap:</p>

<p>When calculating the shape vector of each ASCII character, we took a huge number of samples. We could afford to do that because we only need to calculate those shape vectors once up front. After they’re calculated, we can use them again and again.</p>
<p>However, if we’re converting an animated image (e.g. canvas or video) to ASCII, we need to be mindful of performance when calculating the lookup vectors. An ASCII rendering might have hundreds or thousands of cells. Multiplying that by tens or hundreds of samples would be incredibly costly in terms of performance.</p>
<p>With that being said, let’s pick a sampling quality of <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.554ex" role="img" focusable="false" viewBox="0 -665 500 687" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-31-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="33" xlink:href="#MJX-31-TEX-N-33"></use></g></g></g></svg></mjx-container> with the samples placed like so:</p>

<p>For the top sampling circle of the leftmost cell, we get one white sample and two black, giving us an average lightness of <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="4.023ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1778 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-32-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-32-TEX-N-2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path><path id="MJX-32-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-32-TEX-N-30"></use><use data-c="2E" xlink:href="#MJX-32-TEX-N-2E" transform="translate(500,0)"></use><use data-c="33" xlink:href="#MJX-32-TEX-N-33" transform="translate(778,0)"></use><use data-c="33" xlink:href="#MJX-32-TEX-N-33" transform="translate(1278,0)"></use></g></g></g></svg></mjx-container>. Doing the same calculation for all of the sampling circles, we get the following 2D vectors:</p>

<p>From now on, instead of using the term “lookup vectors”, I’ll call these vectors, sampled from the image that we’re rendering as ASCII, <em>sampling vectors</em>. One sampling vector is calculated for each cell in the grid.</p>
<p>Anyway, we can use these sampling vectors to find the best-matching ASCII character. Let’s see what that looks like on our 2D plot — I’ll label the sampling vectors (from left to right) C0, C1, and C2:</p>
<p><svg viewBox="-0.096 0 1.096 1.096" preserveAspectRatio="xMidYMid meet"><defs><marker id="arrowhead" markerWidth="8" markerHeight="8" refX="4" refY="4" orient="auto" viewBox="0 0 8 8"><path d="M0,0 L4,4 L0,8" stroke="#399ef4" stroke-width="1.5" fill="none"></path></marker></defs><g><line x1="0" y1="0" x2="0" y2="1"></line><line x1="0" y1="1" x2="1" y2="1"></line><line x1="0.1" y1="0" x2="0.1" y2="1"></line><line x1="0" y1="0.9" x2="1" y2="0.9"></line><line x1="0.2" y1="0" x2="0.2" y2="1"></line><line x1="0" y1="0.8" x2="1" y2="0.8"></line><line x1="0.30000000000000004" y1="0" x2="0.30000000000000004" y2="1"></line><line x1="0" y1="0.7" x2="1" y2="0.7"></line><line x1="0.4" y1="0" x2="0.4" y2="1"></line><line x1="0" y1="0.6" x2="1" y2="0.6"></line><line x1="0.5" y1="0" x2="0.5" y2="1"></line><line x1="0" y1="0.5" x2="1" y2="0.5"></line><line x1="0.6000000000000001" y1="0" x2="0.6000000000000001" y2="1"></line><line x1="0" y1="0.3999999999999999" x2="1" y2="0.3999999999999999"></line><line x1="0.7000000000000001" y1="0" x2="0.7000000000000001" y2="1"></line><line x1="0" y1="0.29999999999999993" x2="1" y2="0.29999999999999993"></line><line x1="0.8" y1="0" x2="0.8" y2="1"></line><line x1="0" y1="0.19999999999999996" x2="1" y2="0.19999999999999996"></line><line x1="0.9" y1="0" x2="0.9" y2="1"></line><line x1="0" y1="0.09999999999999998" x2="1" y2="0.09999999999999998"></line><line x1="1" y1="0" x2="1" y2="1"></line><line x1="0" y1="0" x2="1" y2="0"></line></g><g><text x="0" y="1.0096" dy="1.2em" font-size="0.024">0</text><text x="-0.0408" y="1" dy="0.3em" text-anchor="end" font-size="0.024">0</text><text x="0.1" y="1.0096" dy="1.2em" font-size="0.024">0.1</text><text x="-0.0408" y="0.9" dy="0.3em" text-anchor="end" font-size="0.024">0.1</text><text x="0.2" y="1.0096" dy="1.2em" font-size="0.024">0.2</text><text x="-0.0408" y="0.8" dy="0.3em" text-anchor="end" font-size="0.024">0.2</text><text x="0.30000000000000004" y="1.0096" dy="1.2em" font-size="0.024">0.3</text><text x="-0.0408" y="0.7" dy="0.3em" text-anchor="end" font-size="0.024">0.3</text><text x="0.4" y="1.0096" dy="1.2em" font-size="0.024">0.4</text><text x="-0.0408" y="0.6" dy="0.3em" text-anchor="end" font-size="0.024">0.4</text><text x="0.5" y="1.0096" dy="1.2em" font-size="0.024">0.5</text><text x="-0.0408" y="0.5" dy="0.3em" text-anchor="end" font-size="0.024">0.5</text><text x="0.6000000000000001" y="1.0096" dy="1.2em" font-size="0.024">0.6</text><text x="-0.0408" y="0.3999999999999999" dy="0.3em" text-anchor="end" font-size="0.024">0.6</text><text x="0.7000000000000001" y="1.0096" dy="1.2em" font-size="0.024">0.7</text><text x="-0.0408" y="0.29999999999999993" dy="0.3em" text-anchor="end" font-size="0.024">0.7</text><text x="0.8" y="1.0096" dy="1.2em" font-size="0.024">0.8</text><text x="-0.0408" y="0.19999999999999996" dy="0.3em" text-anchor="end" font-size="0.024">0.8</text><text x="0.9" y="1.0096" dy="1.2em" font-size="0.024">0.9</text><text x="-0.0408" y="0.09999999999999998" dy="0.3em" text-anchor="end" font-size="0.024">0.9</text><text x="1" y="1.0096" dy="1.2em" font-size="0.024">1</text><text x="-0.0408" y="0" dy="0.3em" text-anchor="end" font-size="0.024">1</text></g><text x="0.5" y="1.0816" text-anchor="middle" font-size="0.026304000000000004">Upper</text><text x="-0.0912" y="0.5" text-anchor="middle" dominant-baseline="middle" font-size="0.026304000000000004" transform="rotate(-90, -0.0912, 0.5)">Lower</text><rect x="0" y="0" width="1" height="1"></rect><g><circle cx="0" cy="1" r="0.0035072000000000007"></circle><circle cx="0.11821758803855989" cy="0.925398386779461" r="0.0035072000000000007"></circle><circle cx="0.1773952390320677" cy="1" r="0.0035072000000000007"></circle><circle cx="0.25848908125122966" cy="0.7835267886418782" r="0.0035072000000000007"></circle><circle cx="0.3255098694996394" cy="0.7381926683716965" r="0.0035072000000000007"></circle><circle cx="0.28755328218243836" cy="0.7687913961571251" r="0.0035072000000000007"></circle><circle cx="0.21459112072922823" cy="0.8157911994229129" r="0.0035072000000000007"></circle><circle cx="0.0885697422781822" cy="1" r="0.0035072000000000007"></circle><circle cx="0.122224408157912" cy="0.8779723260541675" r="0.0035072000000000007"></circle><circle cx="0.06432552954292085" cy="0.9274181913568103" r="0.0035072000000000007"></circle><circle cx="0" cy="0.8531969309462915" r="0.0035072000000000007"></circle><circle cx="0" cy="0.9069578333005444" r="0.0035072000000000007"></circle><circle cx="0.14572758869434063" cy="0.8792248672044068" r="0.0035072000000000007"></circle><circle cx="0.18889107482457868" cy="0.8322316217456881" r="0.0035072000000000007"></circle><circle cx="0.1893829103547775" cy="0.8320939077972325" r="0.0035072000000000007"></circle><circle cx="0.1364941963407436" cy="0.8842547052265722" r="0.0035072000000000007"></circle><circle cx="0.15455439700964002" cy="0.8675060659715391" r="0.0035072000000000007"></circle><circle cx="0.15566266640435444" cy="0.8662404092071612" r="0.0035072000000000007"></circle><circle cx="0.07777559184208799" cy="0.9220670207882484" r="0.0035072000000000007"></circle><circle cx="0.07777559184208799" cy="0.8521804708505476" r="0.0035072000000000007"></circle><circle cx="0.10804642927405075" cy="0.8911994229129778" r="0.0035072000000000007"></circle><circle cx="0.09930487245065252" cy="0.8969571775198374" r="0.0035072000000000007"></circle><circle cx="0.10855138041838808" cy="0.8898091678142829" r="0.0035072000000000007"></circle><circle cx="0.2037445078365794" cy="0.9248475309856384" r="0.0035072000000000007"></circle><circle cx="0.24616040396091562" cy="0.7145321004656042" r="0.0035072000000000007"></circle><circle cx="0.14530133123483513" cy="0.8786018755328219" r="0.0035072000000000007"></circle><circle cx="0.19216342055216742" cy="1" r="0.0035072000000000007"></circle><circle cx="0.05790543642206046" cy="1" r="0.0035072000000000007"></circle><circle cx="0.1776313200865631" cy="0.8497934290773165" r="0.0035072000000000007"></circle><circle cx="0.17881828316610926" cy="0.8494393074955735" r="0.0035072000000000007"></circle><circle cx="0.027641156797167023" cy="0.9688963210702342" r="0.0035072000000000007"></circle><circle cx="0.006675847596563709" cy="0.9876254180602007" r="0.0035072000000000007"></circle><circle cx="0" cy="0.863932061118762" r="0.0035072000000000007"></circle><circle cx="0.2652698537609022" cy="0.7826086956521738" r="0.0035072000000000007"></circle><circle cx="0.16862745098039206" cy="0.8233523509738346" r="0.0035072000000000007"></circle><circle cx="0.18839268148731061" cy="0.8064332087349992" r="0.0035072000000000007"></circle><circle cx="0.1989114040264935" cy="0.8370057052921503" r="0.0035072000000000007"></circle><circle cx="0.12333923535969571" cy="0.825686930290511" r="0.0035072000000000007"></circle><circle cx="0.22670339038625487" cy="0.846940783002164" r="0.0035072000000000007"></circle><circle cx="0.20956784051413202" cy="0.8213391042035544" r="0.0035072000000000007"></circle><circle cx="0.19799986884385862" cy="0.9012853301855859" r="0.0035072000000000007"></circle><circle cx="0.27226703390386253" cy="0.804419961964719" r="0.0035072000000000007"></circle><circle cx="0.2280411830283954" cy="0.859184208800577" r="0.0035072000000000007"></circle><circle cx="0.19589481277460816" cy="0.7686930290510853" r="0.0035072000000000007"></circle><circle cx="0.29015017378188757" cy="0.7927601809954752" r="0.0035072000000000007"></circle><circle cx="0.1701488622204735" cy="0.8401141058430062" r="0.0035072000000000007"></circle><circle cx="0.2349662272935932" cy="0.8009771132533281" r="0.0035072000000000007"></circle><circle cx="0.22486064659977736" cy="0.8288871401403373" r="0.0035072000000000007"></circle><circle cx="0.2204406846350583" cy="0.9112663125450849" r="0.0035072000000000007"></circle><circle cx="0.17966424027805114" cy="0.8020788248409731" r="0.0035072000000000007"></circle><circle cx="0.24468489737031945" cy="0.8443373335956454" r="0.0035072000000000007"></circle><circle cx="0.20061643386451578" cy="0.8180864318971734" r="0.0035072000000000007"></circle><circle cx="0.15756443045445592" cy="0.8432749688504164" r="0.0035072000000000007"></circle><circle cx="0.23382516886353202" cy="0.7961308938291035" r="0.0035072000000000007"></circle><circle cx="0.10785625286904064" cy="0.8202046035805628" r="0.0035072000000000007"></circle><circle cx="0.3290248540887927" cy="0.8030231490589548" r="0.0035072000000000007"></circle><circle cx="0.27671978490392823" cy="0.7728375631188932" r="0.0035072000000000007"></circle><circle cx="0.21219096334185844" cy="0.8197258836645026" r="0.0035072000000000007"></circle><circle cx="0.24623909764574722" cy="0.8885959735064595" r="0.0035072000000000007"></circle><circle cx="0.21066299429470783" cy="0.7502065709226835" r="0.0035072000000000007"></circle><circle cx="0.27609023542527383" cy="0.8056462718866811" r="0.0035072000000000007"></circle><circle cx="0.24087481146304673" cy="0.8247032592301135" r="0.0035072000000000007"></circle><circle cx="0.2383369401272215" cy="0.9009836710603973" r="0.0035072000000000007"></circle><circle cx="0.18660240015738727" cy="0.8106302052593612" r="0.0035072000000000007"></circle><circle cx="0.2149780313463178" cy="0.8436684372745754" r="0.0035072000000000007"></circle><circle cx="0.2771132533280871" cy="0.733595645616106" r="0.0035072000000000007"></circle><circle cx="0.22646730933175951" cy="0.797468686471244" r="0.0035072000000000007"></circle><circle cx="0.2390123942553611" cy="0.8986425339366515" r="0.0035072000000000007"></circle><circle cx="0.21674863925503313" cy="0.7933897304741296" r="0.0035072000000000007"></circle><circle cx="0.11309594071742411" cy="0.7541019083218572" r="0.0035072000000000007"></circle><circle cx="0.2116269919338973" cy="0.7949898353990426" r="0.0035072000000000007"></circle><circle cx="0.11532559512099155" cy="0.8497540822349007" r="0.0035072000000000007"></circle><circle cx="0.20904321594858669" cy="0.7943930749557349" r="0.0035072000000000007"></circle><circle cx="0.11894550462325396" cy="0.8018493015935471" r="0.0035072000000000007"></circle><circle cx="0.2533608761230244" cy="0.9062692635582661" r="0.0035072000000000007"></circle><circle cx="0.15601023017902813" cy="0.6284018624172074" r="0.0035072000000000007"></circle><circle cx="0.2105187225391829" cy="0.8415502655911863" r="0.0035072000000000007"></circle><circle cx="0.14461276149255692" cy="0.8251360744966885" r="0.0035072000000000007"></circle><circle cx="0.15413469735720384" cy="0.8128729752770674" r="0.0035072000000000007"></circle><circle cx="0.1931405338054954" cy="0.7990622335890878" r="0.0035072000000000007"></circle><circle cx="0.16915863335300677" cy="0.8652698537609024" r="0.0035072000000000007"></circle><circle cx="0.1696570266902748" cy="0.7912912322119484" r="0.0035072000000000007"></circle><circle cx="0.1410977769034035" cy="0.8415502655911863" r="0.0035072000000000007"></circle><circle cx="0.12373926159092398" cy="0.8143091350252475" r="0.0035072000000000007"></circle><circle cx="0.14038953373991736" cy="0.7265853498590072" r="0.0035072000000000007"></circle><circle cx="0.13718932389009109" cy="0.7234310446586664" r="0.0035072000000000007"></circle><circle cx="0.16752573939274704" cy="0.8624040920716114" r="0.0035072000000000007"></circle><circle cx="0.11361400747590003" cy="0.7929372417863465" r="0.0035072000000000007"></circle><circle cx="0.1711522067020787" cy="0.8602859203882222" r="0.0035072000000000007"></circle><circle cx="0.09076004983933374" cy="0.7922224408157912" r="0.0035072000000000007"></circle><circle cx="0.09908190701029577" cy="0.8429601941110892" r="0.0035072000000000007"></circle><circle cx="0.09757361138435307" cy="0.737910682667716" r="0.0035072000000000007"></circle><circle cx="0.12972653944520954" cy="0.8034821955538068" r="0.0035072000000000007"></circle><circle cx="0.09931798806479115" cy="0.7603055938094301" r="0.0035072000000000007"></circle><circle cx="0.1428487113909108" cy="0.8109646534198965" r="0.0035072000000000007"></circle></g><g><line x1="0.33" y1="1" x2="0.26261100017213196" y2="0.9175822965816084" marker-end="url(#arrowhead)"></line><circle cx="0.33" cy="1" r="0.004384000000000001"></circle><text x="0.33" y="0.9766186666666666" text-anchor="middle" dominant-baseline="auto" font-size="0.023381333333333337">C0</text></g><g><line x1="1" y1="0.6699999999999999" x2="0.3400490838358168" y2="0.7367227168086151" marker-end="url(#arrowhead)"></line><circle cx="1" cy="0.6699999999999999" r="0.004384000000000001"></circle><text x="1" y="0.6466186666666666" text-anchor="end" dominant-baseline="auto" font-size="0.023381333333333337">C1</text></g><g><line x1="1" y1="0.33999999999999997" x2="0.33809389561120473" y2="0.7307635501242493" marker-end="url(#arrowhead)"></line><circle cx="1" cy="0.33999999999999997" r="0.004384000000000001"></circle><text x="1" y="0.3166186666666666" text-anchor="end" dominant-baseline="auto" font-size="0.023381333333333337">C2</text></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.22431909764574723" y="0.8316039735064594" width="0.04384" height="0.04384" rx="0.00548"></rect><text x="0.24623909764574722" y="0.8535239735064595" text-anchor="middle" dominant-baseline="middle" font-size="0.036533333333333334">P</text></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.3035898694996394" y="0.6812006683716965" width="0.04384" height="0.04384" rx="0.00548"></rect><text x="0.3255098694996394" y="0.7031206683716965" text-anchor="middle" dominant-baseline="middle" font-size="0.036533333333333334">$</text></g></svg></p>
<p>Hmm... this is not what we want. Since none of the ASCII shape vector components exceed <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="2.891ex" height="1.581ex" role="img" focusable="false" viewBox="0 -677 1278 699" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-34-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-34-TEX-N-2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path><path id="MJX-34-TEX-N-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-34-TEX-N-30"></use><use data-c="2E" xlink:href="#MJX-34-TEX-N-2E" transform="translate(500,0)"></use><use data-c="34" xlink:href="#MJX-34-TEX-N-34" transform="translate(778,0)"></use></g></g></g></svg></mjx-container>, they’re all clustered towards the bottom-left region of our plot. This makes our sampling vectors map to a few characters on the edge of the cluster.</p>
<p>We can fix this by <em>normalizing</em> the shape vectors. We’ll do that by taking the maximum value of each component across all shape vectors, and dividing the components of each shape vector by the maximum. Expressed in code, that looks like so:</p>
<div><pre><p><span>const</span><span> max </span><span>=</span><span> </span><span>[</span><span>0</span><span>,</span><span> </span><span>0</span><span>]</span><span></span></p><p><span></span><span>for</span><span> </span><span>(</span><span>const</span><span> vector </span><span>of</span><span> characterVectors</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>  </span><span>for</span><span> </span><span>(</span><span>const</span><span> </span><span>[</span><span>i</span><span>,</span><span> value</span><span>]</span><span> </span><span>of</span><span> Object</span><span>.</span><span>entries</span><span>(</span><span>vector</span><span>)</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>    </span><span>if</span><span> </span><span>(</span><span>value </span><span>&gt;</span><span> max</span><span>[</span><span>i</span><span>]</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>      max</span><span>[</span><span>i</span><span>]</span><span> </span><span>=</span><span> value</span><span>;</span><span></span></p><p><span>    </span><span>}</span><span></span></p><p><span>  </span><span>}</span><span></span></p><p><span></span><span>}</span><span></span></p><p><span></span><span>const</span><span> normalizedCharacterVectors </span><span>=</span><span> characterVectors</span><span>.</span><span>map</span><span>(</span><span></span></p><p><span>  vector </span><span>=&gt;</span><span> vector</span><span>.</span><span>map</span><span>(</span><span>(</span><span>value</span><span>,</span><span> i</span><span>)</span><span> </span><span>=&gt;</span><span> value </span><span>/</span><span> max</span><span>[</span><span>i</span><span>]</span><span>)</span><span></span></p><p><span></span><span>)</span><span></span></p></pre></div>
<p>Here’s what the plot looks like with the shape vectors normalized:</p>
<p><svg viewBox="-0.096 0 1.096 1.096" preserveAspectRatio="xMidYMid meet"><defs><marker id="arrowhead" markerWidth="8" markerHeight="8" refX="4" refY="4" orient="auto" viewBox="0 0 8 8"><path d="M0,0 L4,4 L0,8" stroke="#399ef4" stroke-width="1.5" fill="none"></path></marker></defs><g><line x1="0" y1="0" x2="0" y2="1"></line><line x1="0" y1="1" x2="1" y2="1"></line><line x1="0.1" y1="0" x2="0.1" y2="1"></line><line x1="0" y1="0.9" x2="1" y2="0.9"></line><line x1="0.2" y1="0" x2="0.2" y2="1"></line><line x1="0" y1="0.8" x2="1" y2="0.8"></line><line x1="0.30000000000000004" y1="0" x2="0.30000000000000004" y2="1"></line><line x1="0" y1="0.7" x2="1" y2="0.7"></line><line x1="0.4" y1="0" x2="0.4" y2="1"></line><line x1="0" y1="0.6" x2="1" y2="0.6"></line><line x1="0.5" y1="0" x2="0.5" y2="1"></line><line x1="0" y1="0.5" x2="1" y2="0.5"></line><line x1="0.6000000000000001" y1="0" x2="0.6000000000000001" y2="1"></line><line x1="0" y1="0.3999999999999999" x2="1" y2="0.3999999999999999"></line><line x1="0.7000000000000001" y1="0" x2="0.7000000000000001" y2="1"></line><line x1="0" y1="0.29999999999999993" x2="1" y2="0.29999999999999993"></line><line x1="0.8" y1="0" x2="0.8" y2="1"></line><line x1="0" y1="0.19999999999999996" x2="1" y2="0.19999999999999996"></line><line x1="0.9" y1="0" x2="0.9" y2="1"></line><line x1="0" y1="0.09999999999999998" x2="1" y2="0.09999999999999998"></line><line x1="1" y1="0" x2="1" y2="1"></line><line x1="0" y1="0" x2="1" y2="0"></line></g><g><text x="0" y="1.0096" dy="1.2em" font-size="0.024">0</text><text x="-0.0408" y="1" dy="0.3em" text-anchor="end" font-size="0.024">0</text><text x="0.1" y="1.0096" dy="1.2em" font-size="0.024">0.1</text><text x="-0.0408" y="0.9" dy="0.3em" text-anchor="end" font-size="0.024">0.1</text><text x="0.2" y="1.0096" dy="1.2em" font-size="0.024">0.2</text><text x="-0.0408" y="0.8" dy="0.3em" text-anchor="end" font-size="0.024">0.2</text><text x="0.30000000000000004" y="1.0096" dy="1.2em" font-size="0.024">0.3</text><text x="-0.0408" y="0.7" dy="0.3em" text-anchor="end" font-size="0.024">0.3</text><text x="0.4" y="1.0096" dy="1.2em" font-size="0.024">0.4</text><text x="-0.0408" y="0.6" dy="0.3em" text-anchor="end" font-size="0.024">0.4</text><text x="0.5" y="1.0096" dy="1.2em" font-size="0.024">0.5</text><text x="-0.0408" y="0.5" dy="0.3em" text-anchor="end" font-size="0.024">0.5</text><text x="0.6000000000000001" y="1.0096" dy="1.2em" font-size="0.024">0.6</text><text x="-0.0408" y="0.3999999999999999" dy="0.3em" text-anchor="end" font-size="0.024">0.6</text><text x="0.7000000000000001" y="1.0096" dy="1.2em" font-size="0.024">0.7</text><text x="-0.0408" y="0.29999999999999993" dy="0.3em" text-anchor="end" font-size="0.024">0.7</text><text x="0.8" y="1.0096" dy="1.2em" font-size="0.024">0.8</text><text x="-0.0408" y="0.19999999999999996" dy="0.3em" text-anchor="end" font-size="0.024">0.8</text><text x="0.9" y="1.0096" dy="1.2em" font-size="0.024">0.9</text><text x="-0.0408" y="0.09999999999999998" dy="0.3em" text-anchor="end" font-size="0.024">0.9</text><text x="1" y="1.0096" dy="1.2em" font-size="0.024">1</text><text x="-0.0408" y="0" dy="0.3em" text-anchor="end" font-size="0.024">1</text></g><text x="0.5" y="1.0816" text-anchor="middle" font-size="0.026304000000000004">Upper</text><text x="-0.0912" y="0.5" text-anchor="middle" dominant-baseline="middle" font-size="0.026304000000000004" transform="rotate(-90, -0.0912, 0.5)">Lower</text><rect x="0" y="0" width="1" height="1"></rect><g><circle cx="0" cy="1" r="0.0035072000000000007"></circle><circle cx="0.35929683295796544" cy="0.7992411541515928" r="0.0035072000000000007"></circle><circle cx="0.5391545253423157" cy="1" r="0.0035072000000000007"></circle><circle cx="0.7856217487493277" cy="0.41745345451336857" r="0.0035072000000000007"></circle><circle cx="0.9893169633069583" cy="0.29545574869849156" r="0.0035072000000000007"></circle><circle cx="0.8739561118529893" cy="0.37779934703961926" r="0.0035072000000000007"></circle><circle cx="0.6522033763179402" cy="0.5042795376334599" r="0.0035072000000000007"></circle><circle cx="0.26918860741833267" cy="1" r="0.0035072000000000007"></circle><circle cx="0.3714746975464892" cy="0.671613870996206" r="0.0035072000000000007"></circle><circle cx="0.1955035576903913" cy="0.8046766081355335" r="0.0035072000000000007"></circle><circle cx="0" cy="0.6049413218035824" r="0.0035072000000000007"></circle><circle cx="0" cy="0.749616165181329" r="0.0035072000000000007"></circle><circle cx="0.4429075399119049" cy="0.6749845583693639" r="0.0035072000000000007"></circle><circle cx="0.574093636019373" cy="0.5485220153533925" r="0.0035072000000000007"></circle><circle cx="0.5755884639148551" cy="0.5481514162181241" r="0.0035072000000000007"></circle><circle cx="0.41484463755406287" cy="0.688520250595606" r="0.0035072000000000007"></circle><circle cx="0.46973471787614873" cy="0.643448336715786" r="0.0035072000000000007"></circle><circle cx="0.473103063400634" cy="0.6400423541868882" r="0.0035072000000000007"></circle><circle cx="0.2363821178721623" cy="0.7902761845936646" r="0.0035072000000000007"></circle><circle cx="0.2363821178721623" cy="0.6022059472337424" r="0.0035072000000000007"></circle><circle cx="0.32838379207940527" cy="0.7072090355598695" r="0.0035072000000000007"></circle><circle cx="0.3018157176170451" cy="0.7227036089296746" r="0.0035072000000000007"></circle><circle cx="0.3299184820520997" cy="0.7034677490514428" r="0.0035072000000000007"></circle><circle cx="0.6192374384629182" cy="0.7977587576105181" r="0.0035072000000000007"></circle><circle cx="0.748151396169255" cy="0.23178328774375756" r="0.0035072000000000007"></circle><circle cx="0.4416120224024876" cy="0.67330803847172" r="0.0035072000000000007"></circle><circle cx="0.5840392242839777" cy="1" r="0.0035072000000000007"></circle><circle cx="0.17599107089470434" cy="1" r="0.0035072000000000007"></circle><circle cx="0.539872042732147" cy="0.595782228889085" r="0.0035072000000000007"></circle><circle cx="0.5434795607199092" cy="0.5948292596841085" r="0.0035072000000000007"></circle><circle cx="0.0840093277260678" cy="0.9162975381628872" r="0.0035072000000000007"></circle><circle cx="0.020289797301337377" cy="0.9666990205594282" r="0.0035072000000000007"></circle><circle cx="0" cy="0.6338304067766705" r="0.0035072000000000007"></circle><circle cx="0.806230442668367" cy="0.41498279361157697" r="0.0035072000000000007"></circle><circle cx="0.5125067267255294" cy="0.5246271949174985" r="0.0035072000000000007"></circle><circle cx="0.5725788770852849" cy="0.47909644401306006" r="0.0035072000000000007"></circle><circle cx="0.6045482630099853" cy="0.5613694520427075" r="0.0035072000000000007"></circle><circle cx="0.37486297410958086" cy="0.530909732639196" r="0.0035072000000000007"></circle><circle cx="0.6890160046240011" cy="0.5881055325156624" r="0.0035072000000000007"></circle><circle cx="0.6369362007454208" cy="0.5192093885114272" r="0.0035072000000000007"></circle><circle cx="0.6017778486436929" cy="0.7343510103238332" r="0.0035072000000000007"></circle><circle cx="0.8274968608614195" cy="0.4736786376069887" r="0.0035072000000000007"></circle><circle cx="0.6930819364997114" cy="0.6210535603988354" r="0.0035072000000000007"></circle><circle cx="0.5953799852510314" cy="0.37753463337157" r="0.0035072000000000007"></circle><circle cx="0.8818488031411325" cy="0.4423012441542403" r="0.0035072000000000007"></circle><circle cx="0.5171307276822197" cy="0.5697344039530577" r="0.0035072000000000007"></circle><circle cx="0.714129113268093" cy="0.4644136592252718" r="0.0035072000000000007"></circle><circle cx="0.6834153827755975" cy="0.5395217506397254" r="0.0035072000000000007"></circle><circle cx="0.669981862754869" cy="0.7612106238418778" r="0.0035072000000000007"></circle><circle cx="0.546050664700138" cy="0.46737845230742103" r="0.0035072000000000007"></circle><circle cx="0.7436669124828098" cy="0.5810994441012969" r="0.0035072000000000007"></circle><circle cx="0.6097303330476553" cy="0.510456189887938" r="0.0035072000000000007"></circle><circle cx="0.4788830645964958" cy="0.5782405364863674" r="0.0035072000000000007"></circle><circle cx="0.7106611125505751" cy="0.4513720991793879" r="0.0035072000000000007"></circle><circle cx="0.32780579195981924" cy="0.5161563575399282" r="0.0035072000000000007"></circle><circle cx="1" cy="0.46991970352069246" r="0.0035072000000000007"></circle><circle cx="0.8410300360751803" cy="0.3886879025853709" r="0.0035072000000000007"></circle><circle cx="0.6449086161879894" cy="0.5148680843554225" r="0.0035072000000000007"></circle><circle cx="0.7483905686325314" cy="0.7002029471455046" r="0.0035072000000000007"></circle><circle cx="0.6402646841926933" cy="0.3277861113562167" r="0.0035072000000000007"></circle><circle cx="0.8391166563689636" cy="0.47697873466866714" r="0.0035072000000000007"></circle><circle cx="0.7320869790524784" cy="0.528262595958705" r="0.0035072000000000007"></circle><circle cx="0.7243736671117934" cy="0.7335392217418161" r="0.0035072000000000007"></circle><circle cx="0.5671377035457316" cy="0.4903908938498194" r="0.0035072000000000007"></circle><circle cx="0.6533793075957189" cy="0.5792993911585638" r="0.0035072000000000007"></circle><circle cx="0.8422258983915654" cy="0.28308479661166563" r="0.0035072000000000007"></circle><circle cx="0.68829848723417" cy="0.45497220506485514" r="0.0035072000000000007"></circle><circle cx="0.726426564088255" cy="0.7272390364422483" r="0.0035072000000000007"></circle><circle cx="0.6587606880194528" cy="0.44399541162975464" r="0.0035072000000000007"></circle><circle cx="0.34373069180635013" cy="0.3382687726109598" r="0.0035072000000000007"></circle><circle cx="0.6431945468678374" cy="0.44830142063001877" r="0.0035072000000000007"></circle><circle cx="0.3505072449325335" cy="0.5956763434218656" r="0.0035072000000000007"></circle><circle cx="0.6353417176569068" cy="0.44669549104385475" r="0.0035072000000000007"></circle><circle cx="0.3615091782432782" cy="0.4667607870819732" r="0.0035072000000000007"></circle><circle cx="0.7700356765591053" cy="0.7477631695049856" r="0.0035072000000000007"></circle><circle cx="0.4741594084467742" cy="0" r="0.0035072000000000007"></circle><circle cx="0.6398262013433521" cy="0.573599223506574" r="0.0035072000000000007"></circle><circle cx="0.43951926334881325" cy="0.5294273360981212" r="0.0035072000000000007"></circle><circle cx="0.46845913140533785" cy="0.4964263654813379" r="0.0035072000000000007"></circle><circle cx="0.5870089490363342" cy="0.4592605664872499" r="0.0035072000000000007"></circle><circle cx="0.5141211408526499" cy="0.6374305126621373" r="0.0035072000000000007"></circle><circle cx="0.5156358997867381" cy="0.4383481867113743" r="0.0035072000000000007"></circle><circle cx="0.4288362266557711" cy="0.573599223506574" r="0.0035072000000000007"></circle><circle cx="0.3760787674645726" cy="0.5002911850348541" r="0.0035072000000000007"></circle><circle cx="0.4266836744862775" cy="0.2642195358687027" r="0.0035072000000000007"></circle><circle cx="0.41695732764634347" cy="0.2557310509132632" r="0.0035072000000000007"></circle><circle cx="0.5091583122396508" cy="0.629718521132975" r="0.0035072000000000007"></circle><circle cx="0.3453052438562573" cy="0.44277772875672816" r="0.0035072000000000007"></circle><circle cx="0.5201801765890017" cy="0.6240183534809849" r="0.0035072000000000007"></circle><circle cx="0.2758455743128775" cy="0.44085414276890533" r="0.0035072000000000007"></circle><circle cx="0.30113806230442675" cy="0.5773934527486105" r="0.0035072000000000007"></circle><circle cx="0.2965539234249497" cy="0.29469690285008443" r="0.0035072000000000007"></circle><circle cx="0.39427580571223575" cy="0.47115503397158787" r="0.0035072000000000007"></circle><circle cx="0.30185557969425797" cy="0.3549633812759201" r="0.0035072000000000007"></circle><circle cx="0.4341578139636854" cy="0.4912909203211867" r="0.0035072000000000007"></circle></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.5621192242839776" y="0.943008" width="0.04384" height="0.04384" rx="0.00548"></rect><text x="0.5840392242839777" y="0.964928" text-anchor="middle" dominant-baseline="middle" font-size="0.036533333333333334">^</text></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.7262313961692549" y="0.17479128774375757" width="0.04384" height="0.04384" rx="0.00548"></rect><text x="0.748151396169255" y="0.19671128774375757" text-anchor="middle" dominant-baseline="middle" font-size="0.036533333333333334">@</text></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.3950373276463435" y="0.19873905091326322" width="0.04384" height="0.04384" rx="0.00548"></rect><text x="0.41695732764634347" y="0.2206590509132632" text-anchor="middle" dominant-baseline="middle" font-size="0.036533333333333334">q</text></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.7024536671117934" y="0.676547221741816" width="0.04384" height="0.04384" rx="0.00548"></rect><text x="0.7243736671117934" y="0.6984672217418161" text-anchor="middle" dominant-baseline="middle" font-size="0.036533333333333334">T</text></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.97808" y="0.41292770352069247" width="0.04384" height="0.04384" rx="0.00548"></rect><text x="1" y="0.43484770352069246" text-anchor="middle" dominant-baseline="middle" font-size="0.036533333333333334">M</text></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.2539255743128775" y="0.38386214276890535" width="0.04384" height="0.04384" rx="0.00548"></rect><text x="0.2758455743128775" y="0.40578214276890534" text-anchor="middle" dominant-baseline="middle" font-size="0.036533333333333334">u</text></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.6663784872341699" y="0.39798020506485515" width="0.04384" height="0.04384" rx="0.00548"></rect><text x="0.68829848723417" y="0.41990020506485515" text-anchor="middle" dominant-baseline="middle" font-size="0.036533333333333334">X</text></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.9673969633069582" y="0.23846374869849157" width="0.04384" height="0.04384" rx="0.00548"></rect><text x="0.9893169633069583" y="0.26038374869849157" text-anchor="middle" dominant-baseline="middle" font-size="0.036533333333333334">$</text></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.4522394084467742" y="-0.056992" width="0.04384" height="0.04384" rx="0.00548"></rect><text x="0.4741594084467742" y="-0.035072000000000006" text-anchor="middle" dominant-baseline="middle" font-size="0.036533333333333334">g</text></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.2798957176170451" y="0.6657116089296745" width="0.04384" height="0.04384" rx="0.00548"></rect><text x="0.3018157176170451" y="0.6876316089296746" text-anchor="middle" dominant-baseline="middle" font-size="0.036533333333333334">=</text></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.4952107276822197" y="0.5127424039530577" width="0.04384" height="0.04384" rx="0.00548"></rect><text x="0.5171307276822197" y="0.5346624039530578" text-anchor="middle" dominant-baseline="middle" font-size="0.036533333333333334">C</text></g></svg></p>
<p>If we now map the sampling vectors to their nearest neighbors, we get a much more sensible result:</p>
<p><svg viewBox="-0.096 0 1.096 1.096" preserveAspectRatio="xMidYMid meet"><defs><marker id="arrowhead" markerWidth="8" markerHeight="8" refX="4" refY="4" orient="auto" viewBox="0 0 8 8"><path d="M0,0 L4,4 L0,8" stroke="#399ef4" stroke-width="1.5" fill="none"></path></marker></defs><g><line x1="0" y1="0" x2="0" y2="1"></line><line x1="0" y1="1" x2="1" y2="1"></line><line x1="0.1" y1="0" x2="0.1" y2="1"></line><line x1="0" y1="0.9" x2="1" y2="0.9"></line><line x1="0.2" y1="0" x2="0.2" y2="1"></line><line x1="0" y1="0.8" x2="1" y2="0.8"></line><line x1="0.30000000000000004" y1="0" x2="0.30000000000000004" y2="1"></line><line x1="0" y1="0.7" x2="1" y2="0.7"></line><line x1="0.4" y1="0" x2="0.4" y2="1"></line><line x1="0" y1="0.6" x2="1" y2="0.6"></line><line x1="0.5" y1="0" x2="0.5" y2="1"></line><line x1="0" y1="0.5" x2="1" y2="0.5"></line><line x1="0.6000000000000001" y1="0" x2="0.6000000000000001" y2="1"></line><line x1="0" y1="0.3999999999999999" x2="1" y2="0.3999999999999999"></line><line x1="0.7000000000000001" y1="0" x2="0.7000000000000001" y2="1"></line><line x1="0" y1="0.29999999999999993" x2="1" y2="0.29999999999999993"></line><line x1="0.8" y1="0" x2="0.8" y2="1"></line><line x1="0" y1="0.19999999999999996" x2="1" y2="0.19999999999999996"></line><line x1="0.9" y1="0" x2="0.9" y2="1"></line><line x1="0" y1="0.09999999999999998" x2="1" y2="0.09999999999999998"></line><line x1="1" y1="0" x2="1" y2="1"></line><line x1="0" y1="0" x2="1" y2="0"></line></g><g><text x="0" y="1.0096" dy="1.2em" font-size="0.024">0</text><text x="-0.0408" y="1" dy="0.3em" text-anchor="end" font-size="0.024">0</text><text x="0.1" y="1.0096" dy="1.2em" font-size="0.024">0.1</text><text x="-0.0408" y="0.9" dy="0.3em" text-anchor="end" font-size="0.024">0.1</text><text x="0.2" y="1.0096" dy="1.2em" font-size="0.024">0.2</text><text x="-0.0408" y="0.8" dy="0.3em" text-anchor="end" font-size="0.024">0.2</text><text x="0.30000000000000004" y="1.0096" dy="1.2em" font-size="0.024">0.3</text><text x="-0.0408" y="0.7" dy="0.3em" text-anchor="end" font-size="0.024">0.3</text><text x="0.4" y="1.0096" dy="1.2em" font-size="0.024">0.4</text><text x="-0.0408" y="0.6" dy="0.3em" text-anchor="end" font-size="0.024">0.4</text><text x="0.5" y="1.0096" dy="1.2em" font-size="0.024">0.5</text><text x="-0.0408" y="0.5" dy="0.3em" text-anchor="end" font-size="0.024">0.5</text><text x="0.6000000000000001" y="1.0096" dy="1.2em" font-size="0.024">0.6</text><text x="-0.0408" y="0.3999999999999999" dy="0.3em" text-anchor="end" font-size="0.024">0.6</text><text x="0.7000000000000001" y="1.0096" dy="1.2em" font-size="0.024">0.7</text><text x="-0.0408" y="0.29999999999999993" dy="0.3em" text-anchor="end" font-size="0.024">0.7</text><text x="0.8" y="1.0096" dy="1.2em" font-size="0.024">0.8</text><text x="-0.0408" y="0.19999999999999996" dy="0.3em" text-anchor="end" font-size="0.024">0.8</text><text x="0.9" y="1.0096" dy="1.2em" font-size="0.024">0.9</text><text x="-0.0408" y="0.09999999999999998" dy="0.3em" text-anchor="end" font-size="0.024">0.9</text><text x="1" y="1.0096" dy="1.2em" font-size="0.024">1</text><text x="-0.0408" y="0" dy="0.3em" text-anchor="end" font-size="0.024">1</text></g><text x="0.5" y="1.0816" text-anchor="middle" font-size="0.026304000000000004">Upper</text><text x="-0.0912" y="0.5" text-anchor="middle" dominant-baseline="middle" font-size="0.026304000000000004" transform="rotate(-90, -0.0912, 0.5)">Lower</text><rect x="0" y="0" width="1" height="1"></rect><g><circle cx="0" cy="1" r="0.0035072000000000007"></circle><circle cx="0.35929683295796544" cy="0.7992411541515928" r="0.0035072000000000007"></circle><circle cx="0.5391545253423157" cy="1" r="0.0035072000000000007"></circle><circle cx="0.7856217487493277" cy="0.41745345451336857" r="0.0035072000000000007"></circle><circle cx="0.9893169633069583" cy="0.29545574869849156" r="0.0035072000000000007"></circle><circle cx="0.8739561118529893" cy="0.37779934703961926" r="0.0035072000000000007"></circle><circle cx="0.6522033763179402" cy="0.5042795376334599" r="0.0035072000000000007"></circle><circle cx="0.26918860741833267" cy="1" r="0.0035072000000000007"></circle><circle cx="0.3714746975464892" cy="0.671613870996206" r="0.0035072000000000007"></circle><circle cx="0.1955035576903913" cy="0.8046766081355335" r="0.0035072000000000007"></circle><circle cx="0" cy="0.6049413218035824" r="0.0035072000000000007"></circle><circle cx="0" cy="0.749616165181329" r="0.0035072000000000007"></circle><circle cx="0.4429075399119049" cy="0.6749845583693639" r="0.0035072000000000007"></circle><circle cx="0.574093636019373" cy="0.5485220153533925" r="0.0035072000000000007"></circle><circle cx="0.5755884639148551" cy="0.5481514162181241" r="0.0035072000000000007"></circle><circle cx="0.41484463755406287" cy="0.688520250595606" r="0.0035072000000000007"></circle><circle cx="0.46973471787614873" cy="0.643448336715786" r="0.0035072000000000007"></circle><circle cx="0.473103063400634" cy="0.6400423541868882" r="0.0035072000000000007"></circle><circle cx="0.2363821178721623" cy="0.7902761845936646" r="0.0035072000000000007"></circle><circle cx="0.2363821178721623" cy="0.6022059472337424" r="0.0035072000000000007"></circle><circle cx="0.32838379207940527" cy="0.7072090355598695" r="0.0035072000000000007"></circle><circle cx="0.3018157176170451" cy="0.7227036089296746" r="0.0035072000000000007"></circle><circle cx="0.3299184820520997" cy="0.7034677490514428" r="0.0035072000000000007"></circle><circle cx="0.6192374384629182" cy="0.7977587576105181" r="0.0035072000000000007"></circle><circle cx="0.748151396169255" cy="0.23178328774375756" r="0.0035072000000000007"></circle><circle cx="0.4416120224024876" cy="0.67330803847172" r="0.0035072000000000007"></circle><circle cx="0.5840392242839777" cy="1" r="0.0035072000000000007"></circle><circle cx="0.17599107089470434" cy="1" r="0.0035072000000000007"></circle><circle cx="0.539872042732147" cy="0.595782228889085" r="0.0035072000000000007"></circle><circle cx="0.5434795607199092" cy="0.5948292596841085" r="0.0035072000000000007"></circle><circle cx="0.0840093277260678" cy="0.9162975381628872" r="0.0035072000000000007"></circle><circle cx="0.020289797301337377" cy="0.9666990205594282" r="0.0035072000000000007"></circle><circle cx="0" cy="0.6338304067766705" r="0.0035072000000000007"></circle><circle cx="0.806230442668367" cy="0.41498279361157697" r="0.0035072000000000007"></circle><circle cx="0.5125067267255294" cy="0.5246271949174985" r="0.0035072000000000007"></circle><circle cx="0.5725788770852849" cy="0.47909644401306006" r="0.0035072000000000007"></circle><circle cx="0.6045482630099853" cy="0.5613694520427075" r="0.0035072000000000007"></circle><circle cx="0.37486297410958086" cy="0.530909732639196" r="0.0035072000000000007"></circle><circle cx="0.6890160046240011" cy="0.5881055325156624" r="0.0035072000000000007"></circle><circle cx="0.6369362007454208" cy="0.5192093885114272" r="0.0035072000000000007"></circle><circle cx="0.6017778486436929" cy="0.7343510103238332" r="0.0035072000000000007"></circle><circle cx="0.8274968608614195" cy="0.4736786376069887" r="0.0035072000000000007"></circle><circle cx="0.6930819364997114" cy="0.6210535603988354" r="0.0035072000000000007"></circle><circle cx="0.5953799852510314" cy="0.37753463337157" r="0.0035072000000000007"></circle><circle cx="0.8818488031411325" cy="0.4423012441542403" r="0.0035072000000000007"></circle><circle cx="0.5171307276822197" cy="0.5697344039530577" r="0.0035072000000000007"></circle><circle cx="0.714129113268093" cy="0.4644136592252718" r="0.0035072000000000007"></circle><circle cx="0.6834153827755975" cy="0.5395217506397254" r="0.0035072000000000007"></circle><circle cx="0.669981862754869" cy="0.7612106238418778" r="0.0035072000000000007"></circle><circle cx="0.546050664700138" cy="0.46737845230742103" r="0.0035072000000000007"></circle><circle cx="0.7436669124828098" cy="0.5810994441012969" r="0.0035072000000000007"></circle><circle cx="0.6097303330476553" cy="0.510456189887938" r="0.0035072000000000007"></circle><circle cx="0.4788830645964958" cy="0.5782405364863674" r="0.0035072000000000007"></circle><circle cx="0.7106611125505751" cy="0.4513720991793879" r="0.0035072000000000007"></circle><circle cx="0.32780579195981924" cy="0.5161563575399282" r="0.0035072000000000007"></circle><circle cx="1" cy="0.46991970352069246" r="0.0035072000000000007"></circle><circle cx="0.8410300360751803" cy="0.3886879025853709" r="0.0035072000000000007"></circle><circle cx="0.6449086161879894" cy="0.5148680843554225" r="0.0035072000000000007"></circle><circle cx="0.7483905686325314" cy="0.7002029471455046" r="0.0035072000000000007"></circle><circle cx="0.6402646841926933" cy="0.3277861113562167" r="0.0035072000000000007"></circle><circle cx="0.8391166563689636" cy="0.47697873466866714" r="0.0035072000000000007"></circle><circle cx="0.7320869790524784" cy="0.528262595958705" r="0.0035072000000000007"></circle><circle cx="0.7243736671117934" cy="0.7335392217418161" r="0.0035072000000000007"></circle><circle cx="0.5671377035457316" cy="0.4903908938498194" r="0.0035072000000000007"></circle><circle cx="0.6533793075957189" cy="0.5792993911585638" r="0.0035072000000000007"></circle><circle cx="0.8422258983915654" cy="0.28308479661166563" r="0.0035072000000000007"></circle><circle cx="0.68829848723417" cy="0.45497220506485514" r="0.0035072000000000007"></circle><circle cx="0.726426564088255" cy="0.7272390364422483" r="0.0035072000000000007"></circle><circle cx="0.6587606880194528" cy="0.44399541162975464" r="0.0035072000000000007"></circle><circle cx="0.34373069180635013" cy="0.3382687726109598" r="0.0035072000000000007"></circle><circle cx="0.6431945468678374" cy="0.44830142063001877" r="0.0035072000000000007"></circle><circle cx="0.3505072449325335" cy="0.5956763434218656" r="0.0035072000000000007"></circle><circle cx="0.6353417176569068" cy="0.44669549104385475" r="0.0035072000000000007"></circle><circle cx="0.3615091782432782" cy="0.4667607870819732" r="0.0035072000000000007"></circle><circle cx="0.7700356765591053" cy="0.7477631695049856" r="0.0035072000000000007"></circle><circle cx="0.4741594084467742" cy="0" r="0.0035072000000000007"></circle><circle cx="0.6398262013433521" cy="0.573599223506574" r="0.0035072000000000007"></circle><circle cx="0.43951926334881325" cy="0.5294273360981212" r="0.0035072000000000007"></circle><circle cx="0.46845913140533785" cy="0.4964263654813379" r="0.0035072000000000007"></circle><circle cx="0.5870089490363342" cy="0.4592605664872499" r="0.0035072000000000007"></circle><circle cx="0.5141211408526499" cy="0.6374305126621373" r="0.0035072000000000007"></circle><circle cx="0.5156358997867381" cy="0.4383481867113743" r="0.0035072000000000007"></circle><circle cx="0.4288362266557711" cy="0.573599223506574" r="0.0035072000000000007"></circle><circle cx="0.3760787674645726" cy="0.5002911850348541" r="0.0035072000000000007"></circle><circle cx="0.4266836744862775" cy="0.2642195358687027" r="0.0035072000000000007"></circle><circle cx="0.41695732764634347" cy="0.2557310509132632" r="0.0035072000000000007"></circle><circle cx="0.5091583122396508" cy="0.629718521132975" r="0.0035072000000000007"></circle><circle cx="0.3453052438562573" cy="0.44277772875672816" r="0.0035072000000000007"></circle><circle cx="0.5201801765890017" cy="0.6240183534809849" r="0.0035072000000000007"></circle><circle cx="0.2758455743128775" cy="0.44085414276890533" r="0.0035072000000000007"></circle><circle cx="0.30113806230442675" cy="0.5773934527486105" r="0.0035072000000000007"></circle><circle cx="0.2965539234249497" cy="0.29469690285008443" r="0.0035072000000000007"></circle><circle cx="0.39427580571223575" cy="0.47115503397158787" r="0.0035072000000000007"></circle><circle cx="0.30185557969425797" cy="0.3549633812759201" r="0.0035072000000000007"></circle><circle cx="0.4341578139636854" cy="0.4912909203211867" r="0.0035072000000000007"></circle></g><g><line x1="0.33" y1="1" x2="0.283801940751666" y2="1" marker-end="url(#arrowhead)"></line><circle cx="0.33" cy="1" r="0.004384000000000001"></circle><text x="0.33" y="0.9766186666666666" text-anchor="middle" dominant-baseline="auto" font-size="0.023381333333333337">C0</text></g><g><line x1="1" y1="0.6699999999999999" x2="1" y2="0.4845330368540258" marker-end="url(#arrowhead)"></line><circle cx="1" cy="0.6699999999999999" r="0.004384000000000001"></circle><text x="0.9795413333333334" y="0.6699999999999999" text-anchor="end" dominant-baseline="middle" font-size="0.023381333333333337">C1</text></g><g><line x1="1" y1="0.33999999999999997" x2="0.9927250324679331" y2="0.3096661172969877" marker-end="url(#arrowhead)"></line><circle cx="1" cy="0.33999999999999997" r="0.004384000000000001"></circle><text x="0.9795413333333334" y="0.33999999999999997" text-anchor="end" dominant-baseline="middle" font-size="0.023381333333333337">C2</text></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.97808" y="0.41292770352069247" width="0.04384" height="0.04384" rx="0.00548"></rect><text x="1" y="0.43484770352069246" text-anchor="middle" dominant-baseline="middle" font-size="0.036533333333333334">M</text></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.9673969633069582" y="0.23846374869849157" width="0.04384" height="0.04384" rx="0.00548"></rect><text x="0.9893169633069583" y="0.26038374869849157" text-anchor="middle" dominant-baseline="middle" font-size="0.036533333333333334">$</text></g><g opacity="1" style="transition:opacity 0.2s ease"><rect x="0.24726860741833268" y="0.943008" width="0.04384" height="0.04384" rx="0.00548"></rect><text x="0.26918860741833267" y="0.964928" text-anchor="middle" dominant-baseline="middle" font-size="0.036533333333333334">'</text></g></svg></p>
<p>We get <code>'</code>, <code>M</code> and <code>$</code>.  Let’s see how well those characters match the circle:</p>

<p>Nice! They match very well.</p>
<p>Let’s try rendering the full circle from before with the same method:</p>

<p>Much better than before! The picked characters follow the contour of the circle very well.</p>
<h2>Limits of a 2D shape vector</h2>
<p>Using two sampling circles — one upper and one lower — produces a much better result than the <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:0" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.507ex" role="img" focusable="false" viewBox="0 -666 500 666" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-35-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-35-TEX-N-31"></use></g></g></g></svg></mjx-container>-dimensional (pixelated) approach. However, it still falls short when trying to capture other aspects of a character’s shape.</p>
<p>For example, two circles don’t capture the shape of characters that fall in the middle of the cell. Consider <code>-</code>:</p>

<p>For <code>-</code>, we get a shape vector of <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-2.149ex" xmlns="http://www.w3.org/2000/svg" width="7.543ex" height="5.43ex" role="img" focusable="false" viewBox="0 -1450 3334 2400" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-36-TEX-S3-5B" d="M247 -949V1450H516V1388H309V-887H516V-949H247Z"></path><path id="MJX-36-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-36-TEX-N-2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path><path id="MJX-36-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-36-TEX-N-39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z"></path><path id="MJX-36-TEX-S3-5D" d="M11 1388V1450H280V-949H11V-887H218V1388H11Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mo" transform="translate(0 -0.5)"><use data-c="5B" xlink:href="#MJX-36-TEX-S3-5B"></use></g><g data-mml-node="mtable" transform="translate(528,0)"><g data-mml-node="mtr" transform="translate(0,700)"><g data-mml-node="mtd"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-36-TEX-N-30"></use><use data-c="2E" xlink:href="#MJX-36-TEX-N-2E" transform="translate(500,0)"></use><use data-c="30" xlink:href="#MJX-36-TEX-N-30" transform="translate(778,0)"></use><use data-c="32" xlink:href="#MJX-36-TEX-N-32" transform="translate(1278,0)"></use><use data-c="39" xlink:href="#MJX-36-TEX-N-39" transform="translate(1778,0)"></use></g></g></g><g data-mml-node="mtr" transform="translate(0,-700)"><g data-mml-node="mtd"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-36-TEX-N-30"></use><use data-c="2E" xlink:href="#MJX-36-TEX-N-2E" transform="translate(500,0)"></use><use data-c="30" xlink:href="#MJX-36-TEX-N-30" transform="translate(778,0)"></use><use data-c="30" xlink:href="#MJX-36-TEX-N-30" transform="translate(1278,0)"></use><use data-c="32" xlink:href="#MJX-36-TEX-N-32" transform="translate(1778,0)"></use></g></g></g></g><g data-mml-node="mo" transform="translate(2806,0) translate(0 -0.5)"><use data-c="5D" xlink:href="#MJX-36-TEX-S3-5D"></use></g></g></g></g></svg></mjx-container>. That doesn’t represent the character very well at all.</p>
<p>The two upper-lower sampling circles also don’t capture left-right differences, such as the difference between <code>p</code> and <code>q</code>:</p>

<p>We could use such differences to get better character picks, but our two sampling circles don’t capture them. Let’s add more dimensions to our shape to fix that.</p>
<h2>Increasing to 6 dimensions</h2>
<p>Since cells are taller than they are wide (at least with the monospace font I’m using), we can use <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-37-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="36" xlink:href="#MJX-37-TEX-N-36"></use></g></g></g></svg></mjx-container> sampling circles to cover the area of each cell quite well:</p>

<p><mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-38-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="36" xlink:href="#MJX-38-TEX-N-36"></use></g></g></g></svg></mjx-container> sampling circles capture left-right differences, such as between <code>p</code> and <code>q</code>, while also capturing differences across the top, bottom, and middle regions of the cell, differentiating <code>^</code>, <code>-</code>, and <code>_</code>. They also capture the shape of “diagonal” characters like <code>/</code> to a reasonable degree.</p>

<p>One problem with this grid-like configuration for the sampling circles is that there are gaps. For example, <code>.</code> falls between the sampling circles:</p>

<p>To compensate for this, we can stagger the sampling circles vertically (e.g. lowering the left sampling circles and raising the right ones) and make them a bit larger. This causes the cell to be almost fully covered while not causing excessive overlap across the sampling circles:</p>

<p>We can use the same procedure as before to generate character vectors using these sampling circles, this time yielding a <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-39-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="36" xlink:href="#MJX-39-TEX-N-36"></use></g></g></g></svg></mjx-container>-dimensional vector. Consider the character <code>L</code>:</p>

<p>For <code>L</code>, we get the vector:</p>

<p>I’m presenting <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-41-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="36" xlink:href="#MJX-41-TEX-N-36"></use></g></g></g></svg></mjx-container>-dimensional shape vectors in a <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="5.028ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 2222.4 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-42-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path id="MJX-42-TEX-N-D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path><path id="MJX-42-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="33" xlink:href="#MJX-42-TEX-N-33"></use></g><g data-mml-node="mo" transform="translate(722.2,0)"><use data-c="D7" xlink:href="#MJX-42-TEX-N-D7"></use></g><g data-mml-node="mn" transform="translate(1722.4,0)"><use data-c="32" xlink:href="#MJX-42-TEX-N-32"></use></g></g></g></svg></mjx-container> matrix form because it’s easier to grok geometrically, but the actual vector is a flat list of numbers.</p>
<p>The lightness values certainly look L-shaped! The 6D shape vector captures <code>L</code>’s shape very well.</p>
<h3>Nearest neighbor lookups in a 6D space</h3>
<p>Now we have a 6D shape vector for every ASCII character. Does that affect character lookups (how we find the best matching character)?</p>
<p>Earlier, in the <code><span>findBestCharacter</span></code> function, I referenced a <code><span>getDistance</span></code> function. That function returns the <a target="_blank" href="https://en.wikipedia.org/wiki/Euclidean_distance">Euclidean distance</a> between the input points. Given two 2D points <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.023ex" xmlns="http://www.w3.org/2000/svg" width="1.197ex" height="1.02ex" role="img" focusable="false" viewBox="0 -441 529 451" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-43-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D44E" xlink:href="#MJX-43-TEX-I-1D44E"></use></g></g></g></svg></mjx-container> and <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.025ex" xmlns="http://www.w3.org/2000/svg" width="0.971ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 429 705" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-44-TEX-I-1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D44F" xlink:href="#MJX-44-TEX-I-1D44F"></use></g></g></g></svg></mjx-container>, the formula to calculate their Euclidean distance looks like so:</p>

<p>This generalizes to higher dimensions:</p>

<p>Put into code, this looks like so:</p>
<div><pre><p><span>function</span><span> </span><span>getDistance</span><span>(</span><span>a</span><span>:</span><span> </span><span>number</span><span>[</span><span>]</span><span>,</span><span> b</span><span>:</span><span> </span><span>number</span><span>[</span><span>]</span><span>)</span><span>:</span><span> </span><span>number</span><span> </span><span>{</span><span></span></p><p><span>  </span><span>let</span><span> sum </span><span>=</span><span> </span><span>0</span><span>;</span><span></span></p><p><span>  </span><span>for</span><span> </span><span>(</span><span>let</span><span> i </span><span>=</span><span> </span><span>0</span><span>;</span><span> i </span><span>&lt;</span><span> a</span><span>.</span><span>length</span><span>;</span><span> i</span><span>++</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>    sum </span><span>+=</span><span> </span><span>(</span><span>a</span><span>[</span><span>i</span><span>]</span><span> </span><span>-</span><span> b</span><span>[</span><span>i</span><span>]</span><span>)</span><span> </span><span>**</span><span> </span><span>2</span><span>;</span><span></span></p><p><span>  </span><span>}</span><span></span></p><p><span>  </span><span>return</span><span> Math</span><span>.</span><span>sqrt</span><span>(</span><span>sum</span><span>)</span><span>;</span><span></span></p><p><span></span><span>}</span><span></span></p></pre></div>
<p>Note: since we’re just using this for the purposes of finding the closest point, we can skip the expensive <code><span>Math</span><span>.</span><span>sqrt</span><span>(</span><span>)</span></code> call and just return the squared distance. It does not affect the result.</p>
<p>So, no, the dimensionality of our shape vector does not change lookups at all. We can use the same <code><span>getDistance</span></code> function for both 2D and 6D.</p>
<p>With that out of the way, let’s see what the 6D approach yields!</p>
<h3>Trying out the 6D approach</h3>
<p>Our new 6D approach works really well for flat shapes, like the circle example we’ve been using:</p>

<p>Now let’s see how this approach works when we render a 3D scene with more shades of gray:</p>

<p>Firstly, the outer contours look nice and sharp. I also like how well the gradients across the sphere and cone look.</p>
<p>However, internally, the objects all kind of blend together. The edges <em>between</em> surfaces with different lightnesses aren’t sharp enough. For example, the lighter faces of the cubes all kind of blend into one solid color. When there is a change in color — like when two faces of a cube meet — I’d like to see more sharpness in the ASCII rendering.</p>
<p>To demonstrate what I mean, consider the following split:</p>

<p>It’s currently rendered like so:</p>

<p>The different shades result in <code>i</code>s on the left and <code>B</code>s on the right, but the boundary is not very sharp.</p>
<p>By applying some effects to the sampling vector, we can enhance the contrast at the boundary so that it appears sharper:</p>

<p>The added contrast makes a <em>big</em> difference in readability for the 3D scene. Let’s look at how we can implement this contrast enhancement effect.</p>
<h2>Contrast enhancement</h2>
<p>Consider cells overlapping a color boundary like so:</p>

<p>For the cells on the boundary, we get a 6D sampling vector that looks like so:</p>

<p>To make future examples easier to visualize, I’ll start drawing the sampling vector using <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-48-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="36" xlink:href="#MJX-48-TEX-N-36"></use></g></g></g></svg></mjx-container> circles like so:</p>

<p>Currently, this sampling vector resolves to the character <code>T</code>:</p>

<p>That’s a sensible choice. The character <code>T</code> is visually dense in the top half and less so in the bottom half, so it matches the image fairly well.</p>

<p>Still, I want the picked character to emphasize the shape of the boundary better. We can achieve that by enhancing the contrast of the sampling vector.</p>
<p>To increase the contrast of our sampling vector, we might raise each component of the vector to the power of some exponent.</p>
<p>Consider how an exponent affects values between <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-49-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-49-TEX-N-30"></use></g></g></g></svg></mjx-container> and <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:0" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.507ex" role="img" focusable="false" viewBox="0 -666 500 666" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-50-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-50-TEX-N-31"></use></g></g></g></svg></mjx-container>. Numbers close to <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-51-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-51-TEX-N-30"></use></g></g></g></svg></mjx-container> experience a strong pull towards <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-52-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-52-TEX-N-30"></use></g></g></g></svg></mjx-container> while larger numbers experience less pull. For example, <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.186ex" xmlns="http://www.w3.org/2000/svg" width="10.919ex" height="2.14ex" role="img" focusable="false" viewBox="0 -864 4826.1 946" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-53-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-53-TEX-N-2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path><path id="MJX-53-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-53-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-53-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-53-TEX-N-30"></use><use data-c="2E" xlink:href="#MJX-53-TEX-N-2E" transform="translate(500,0)"></use><use data-c="31" xlink:href="#MJX-53-TEX-N-31" transform="translate(778,0)"></use></g><g data-mml-node="mn" transform="translate(1311,393.1) scale(0.707)"><use data-c="32" xlink:href="#MJX-53-TEX-N-32"></use></g></g><g data-mml-node="mo" transform="translate(1992.3,0)"><use data-c="3D" xlink:href="#MJX-53-TEX-N-3D"></use></g><g data-mml-node="mn" transform="translate(3048.1,0)"><use data-c="30" xlink:href="#MJX-53-TEX-N-30"></use><use data-c="2E" xlink:href="#MJX-53-TEX-N-2E" transform="translate(500,0)"></use><use data-c="30" xlink:href="#MJX-53-TEX-N-30" transform="translate(778,0)"></use><use data-c="31" xlink:href="#MJX-53-TEX-N-31" transform="translate(1278,0)"></use></g></g></g></svg></mjx-container>, a 90% reduction, while <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.186ex" xmlns="http://www.w3.org/2000/svg" width="10.919ex" height="2.14ex" role="img" focusable="false" viewBox="0 -864 4826.1 946" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-54-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-54-TEX-N-2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path><path id="MJX-54-TEX-N-39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z"></path><path id="MJX-54-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-54-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-54-TEX-N-38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path><path id="MJX-54-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-54-TEX-N-30"></use><use data-c="2E" xlink:href="#MJX-54-TEX-N-2E" transform="translate(500,0)"></use><use data-c="39" xlink:href="#MJX-54-TEX-N-39" transform="translate(778,0)"></use></g><g data-mml-node="mn" transform="translate(1311,393.1) scale(0.707)"><use data-c="32" xlink:href="#MJX-54-TEX-N-32"></use></g></g><g data-mml-node="mo" transform="translate(1992.3,0)"><use data-c="3D" xlink:href="#MJX-54-TEX-N-3D"></use></g><g data-mml-node="mn" transform="translate(3048.1,0)"><use data-c="30" xlink:href="#MJX-54-TEX-N-30"></use><use data-c="2E" xlink:href="#MJX-54-TEX-N-2E" transform="translate(500,0)"></use><use data-c="38" xlink:href="#MJX-54-TEX-N-38" transform="translate(778,0)"></use><use data-c="31" xlink:href="#MJX-54-TEX-N-31" transform="translate(1278,0)"></use></g></g></g></svg></mjx-container>, only a reduction of 10%.</p>
<p>The level of pull depends on the exponent. Here’s a chart of <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.025ex" xmlns="http://www.w3.org/2000/svg" width="2.282ex" height="1.912ex" role="img" focusable="false" viewBox="0 -833.9 1008.6 844.9" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-55-TEX-I-1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path><path id="MJX-55-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mi"><use data-c="1D465" xlink:href="#MJX-55-TEX-I-1D465"></use></g><g data-mml-node="mn" transform="translate(605,363) scale(0.707)"><use data-c="32" xlink:href="#MJX-55-TEX-N-32"></use></g></g></g></g></svg></mjx-container> for values of <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.025ex" xmlns="http://www.w3.org/2000/svg" width="1.294ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 572 453" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-56-TEX-I-1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D465" xlink:href="#MJX-56-TEX-I-1D465"></use></g></g></g></svg></mjx-container> between <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-57-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-57-TEX-N-30"></use></g></g></g></svg></mjx-container> and <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:0" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.507ex" role="img" focusable="false" viewBox="0 -666 500 666" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-58-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-58-TEX-N-31"></use></g></g></g></svg></mjx-container>:</p>
<div><p><img src="https://alexharri.com/images/posts/ascii-rendering/x-pow-2-chart.png" width="500"></p></div>
<p>This effect becomes more pronounced with higher exponents:</p>
<div><p><img src="https://alexharri.com/images/posts/ascii-rendering/x-pow-n-chart.png" width="500"></p></div>
<p>A higher exponent translates to a stronger pull towards zero.</p>
<p>Applying an exponent should make dark values darker more quickly than light ones. The example below allows you to vary the exponent applied to the sampling vector:</p>

<p>As the exponent is increased to <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:0" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.507ex" role="img" focusable="false" viewBox="0 -666 500 666" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-59-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="32" xlink:href="#MJX-59-TEX-N-32"></use></g></g></g></svg></mjx-container>, the darker components of the sampling vector quickly become <em>much</em> darker, just like we wanted. However, the lighter components also get pulled towards zero by a significant amount.</p>
<p>I don’t want that. I want to increase the contrast <em>between</em> the lighter and darker components of the sampling vector, not the vector in its entirety.</p>
<p>To achieve that, we can normalize the sampling vector to the range <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.566ex" xmlns="http://www.w3.org/2000/svg" width="4.526ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 2000.7 1000" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-60-TEX-N-5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path><path id="MJX-60-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-60-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path id="MJX-60-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-60-TEX-N-5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><use data-c="5B" xlink:href="#MJX-60-TEX-N-5B"></use></g><g data-mml-node="mn" transform="translate(278,0)"><use data-c="30" xlink:href="#MJX-60-TEX-N-30"></use></g><g data-mml-node="mo" transform="translate(778,0)"><use data-c="2C" xlink:href="#MJX-60-TEX-N-2C"></use></g><g data-mml-node="mn" transform="translate(1222.7,0)"><use data-c="31" xlink:href="#MJX-60-TEX-N-31"></use></g><g data-mml-node="mo" transform="translate(1722.7,0)"><use data-c="5D" xlink:href="#MJX-60-TEX-N-5D"></use></g></g></g></svg></mjx-container> prior to applying the exponent, and then “denormalize” the vector back to the original range afterwards.</p>
<p>The normalization to <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.566ex" xmlns="http://www.w3.org/2000/svg" width="4.526ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 2000.7 1000" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-61-TEX-N-5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path><path id="MJX-61-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-61-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path id="MJX-61-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-61-TEX-N-5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><use data-c="5B" xlink:href="#MJX-61-TEX-N-5B"></use></g><g data-mml-node="mn" transform="translate(278,0)"><use data-c="30" xlink:href="#MJX-61-TEX-N-30"></use></g><g data-mml-node="mo" transform="translate(778,0)"><use data-c="2C" xlink:href="#MJX-61-TEX-N-2C"></use></g><g data-mml-node="mn" transform="translate(1222.7,0)"><use data-c="31" xlink:href="#MJX-61-TEX-N-31"></use></g><g data-mml-node="mo" transform="translate(1722.7,0)"><use data-c="5D" xlink:href="#MJX-61-TEX-N-5D"></use></g></g></g></svg></mjx-container> can be done by dividing each component by the maximum component value. After applying the exponent, mapping back to the original range is done by multiplying each component by the same max value:</p>
<div><pre><p><span>const</span><span> maxValue </span><span>=</span><span> Math</span><span>.</span><span>max</span><span>(</span><span>...</span><span>samplingVector</span><span>)</span><span></span></p><p><span>samplingVector </span><span>=</span><span> samplingVector</span><span>.</span><span>map</span><span>(</span><span>(</span><span>value</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>{</span><span></span></p><p><span>  value </span><span>=</span><span> x </span><span>/</span><span> maxValue</span><span>;</span><span> </span><span></span></p><p><span>  value </span><span>=</span><span> Math</span><span>.</span><span>pow</span><span>(</span><span>x</span><span>,</span><span> exponent</span><span>)</span><span>;</span><span></span></p><p><span>  value </span><span>=</span><span> x </span><span>*</span><span> maxValue</span><span>;</span><span> </span><span></span></p><p><span>  </span><span>return</span><span> value</span><span>;</span><span></span></p><p><span></span><span>}</span><span>)</span><span></span></p></pre></div>
<p>Here’s the same example, but with this normalization applied:</p>

<p>Very nice! The lightest component values are retained, and the contrast between the lighter and darker components is increased by “crunching” the lower values.</p>
<p>This affects which character is picked. The following example shows how the selected character changes as the contrast is increased:</p>

<p>Awesome! The pick of <code>"</code> over <code>T</code> emphasizes the separation between the lighter region above and the darker region below!</p>

<p>By enhancing the contrast of the sampling vector, we exaggerate its shape. This gives us a character that less faithfully represents the underlying image, but improves readability as a whole by enhancing the separation between different colored regions.</p>
<p>Let’s look at another example. Observe how the L-shape of the sampling vector below becomes more pronounced as the exponent increases, and how that affects the picked character:</p>

<p>Works really nicely! I <em>love</em> the transition from <code>&amp; -&gt; b -&gt; L</code> as the L-shape of the vector becomes clearer.</p>
<p>What’s nice about applying exponents to normalized sampling vectors is that it barely affects vectors that are uniform in value. If all component values are similar, applying an exponent has a minimal effect:</p>

<p>Because the vector is fairly uniform, the exponent only has a slight effect and doesn’t change the picked character.</p>
<p>This is a good thing! If we have a smooth gradient in our image, we want to retain it. We very much do <em>not</em> want to introduce unnecessary choppiness.</p>
<p>Compare the 3D scene ASCII rendering with and without this contrast enhancement:</p>

<p>We do see more contrast at boundaries, but this is not quite there yet. Some edges are still not sharp enough, and we also observe a “staircasing” effect happening at some boundaries.</p>
<p>Let’s look at the staircasing effect first. We can reproduce it with a boundary like so:</p>

<p>Below is the ASCII rendering of that boundary. Notice how the lower edge (the <code>!</code>s) becomes “staircase-y” as you increase the exponent:</p>

<p>We see a staircase pattern like so:</p>
<div><pre><p><span>               !!!!!</span></p><p><span>          !!!!!!!!!!</span></p><p><span>     !!!!!!!!!!!!!!!</span></p><p><span>!!!!!!!!!!!!!!!!!!!!</span></p></pre></div>
<p>To understand why that’s happening, let’s consider the row in the middle of the canvas, progressing from left to right. As we start off, every sample is equally light, giving us <code>U</code>s:</p>

<p>As we reach the boundary, the lower right samples become a bit darker. Those darker components are crunched by contrast enhancement, giving us some <code>Y</code>s:</p>

<p>So we get:</p>

<p>As we progress further right, the middle and lower samples get darker, so we get some <code>f</code>s:</p>

<p>This trend continues towards <code>"</code>, <code>'</code>, and finally, <code>`</code>:</p>

<p>Giving us a sequence like so:</p>

<p>That looks good, but at some point we get <em>no</em> light samples. Once we get no light samples, our contrast enhancement has no effect because every component is equally light. This causes us to always get <code>!</code>s:</p>

<p>Making our sequence look like so:</p>
<div><pre><p><span>UUUUUUUUYYf""''`!!!!!!!!!! -&gt;</span></p></pre></div>
<p>This sudden stop in contrast enhancement having an effect is what causes the staircasing effect:</p>
<div><pre><p><span>               !!!!!</span></p><p><span>          !!!!!!!!!!</span></p><p><span>     !!!!!!!!!!!!!!!</span></p><p><span>!!!!!!!!!!!!!!!!!!!!</span></p></pre></div>
<p>Let’s see how we can counteract this staircasing effect with <em>another</em> layer of contrast enhancement, this time looking outside of the boundary of each cell.</p>
<h3>Directional contrast enhancement</h3>
<p>We currently have sampling circles arranged like so:</p>

<p>For each of those sampling circles, we’ll specify an “external sampling circle”, placed outside of the cell’s boundary, like so:</p>

<p>Each of those external sampling circles is “reaching” into the region of a neighboring cell. Together, the samples that are collected by the external sampling circles constitute an “external sampling vector”.</p>
<p>Let’s simplify the visualization and consider a single example. Imagine that we collected a sampling vector and an external sampling vector that look like so:</p>

<p>The circles colored red are the external sampling vector components. Currently, they have no effect.</p>
<p>The “internal” sampling vector itself is fairly uniform, with values ranging from <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="4.023ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1778 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-62-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-62-TEX-N-2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path><path id="MJX-62-TEX-N-35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path><path id="MJX-62-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-62-TEX-N-30"></use><use data-c="2E" xlink:href="#MJX-62-TEX-N-2E" transform="translate(500,0)"></use><use data-c="35" xlink:href="#MJX-62-TEX-N-35" transform="translate(778,0)"></use><use data-c="31" xlink:href="#MJX-62-TEX-N-31" transform="translate(1278,0)"></use></g></g></g></svg></mjx-container> to <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="4.023ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1778 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-63-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-63-TEX-N-2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path><path id="MJX-63-TEX-N-35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path><path id="MJX-63-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-63-TEX-N-30"></use><use data-c="2E" xlink:href="#MJX-63-TEX-N-2E" transform="translate(500,0)"></use><use data-c="35" xlink:href="#MJX-63-TEX-N-35" transform="translate(778,0)"></use><use data-c="33" xlink:href="#MJX-63-TEX-N-33" transform="translate(1278,0)"></use></g></g></g></svg></mjx-container>. The external vector’s values are similar, except in the upper left region where the values are significantly lighter (<mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="2.891ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1278 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-64-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-64-TEX-N-2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path><path id="MJX-64-TEX-N-38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-64-TEX-N-30"></use><use data-c="2E" xlink:href="#MJX-64-TEX-N-2E" transform="translate(500,0)"></use><use data-c="38" xlink:href="#MJX-64-TEX-N-38" transform="translate(778,0)"></use></g></g></g></svg></mjx-container> and <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="4.023ex" height="1.579ex" role="img" focusable="false" viewBox="0 -676 1778 698" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-65-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-65-TEX-N-2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path><path id="MJX-65-TEX-N-35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path><path id="MJX-65-TEX-N-37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-65-TEX-N-30"></use><use data-c="2E" xlink:href="#MJX-65-TEX-N-2E" transform="translate(500,0)"></use><use data-c="35" xlink:href="#MJX-65-TEX-N-35" transform="translate(778,0)"></use><use data-c="37" xlink:href="#MJX-65-TEX-N-37" transform="translate(1278,0)"></use></g></g></g></svg></mjx-container>). This indicates a color boundary above and to the left of the cell.</p>
<p>To enhance this apparent boundary, we’ll darken the top-left and middle-left components of the sampling vector. We can do that by applying <em>component-wise</em> contrast enhancement using the values from the external vector.</p>
<p>In the previous contrast enhancement, we calculated the maximum component value across the sampling vector and normalized the vector using that value:</p>
<div><pre><p><span>const</span><span> maxValue </span><span>=</span><span> Math</span><span>.</span><span>max</span><span>(</span><span>...</span><span>samplingVector</span><span>)</span><span></span></p><p><span>samplingVector </span><span>=</span><span> samplingVector</span><span>.</span><span>map</span><span>(</span><span>(</span><span>value</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>{</span><span></span></p><p><span>  value </span><span>=</span><span> x </span><span>/</span><span> maxValue</span><span>;</span><span> </span><span></span></p><p><span>  value </span><span>=</span><span> Math</span><span>.</span><span>pow</span><span>(</span><span>x</span><span>,</span><span> exponent</span><span>)</span><span>;</span><span></span></p><p><span>  value </span><span>=</span><span> x </span><span>*</span><span> maxValue</span><span>;</span><span> </span><span></span></p><p><span>  </span><span>return</span><span> value</span><span>;</span><span></span></p><p><span></span><span>}</span><span>)</span><span></span></p></pre></div>
<p>But the new component-wise contrast enhancement will take the maximum value between each component of the sampling vector and the corresponding component in the external sampling vector:</p>
<div><pre><p><span>samplingVector </span><span>=</span><span> samplingVector</span><span>.</span><span>map</span><span>(</span><span>(</span><span>value</span><span>,</span><span> i</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>{</span><span></span></p><p><span>  </span><span>const</span><span> maxValue </span><span>=</span><span> Math</span><span>.</span><span>max</span><span>(</span><span>value</span><span>,</span><span> externalSamplingVector</span><span>[</span><span>i</span><span>]</span><span>)</span><span></span></p><p><span></span><span>}</span><span>)</span><span>;</span><span></span></p></pre></div>
<p>Aside from that, the contrast enhancement is performed in the same way:</p>
<div><pre><p><span>samplingVector </span><span>=</span><span> samplingVector</span><span>.</span><span>map</span><span>(</span><span>(</span><span>value</span><span>,</span><span> i</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>{</span><span></span></p><p><span>  </span><span>const</span><span> maxValue </span><span>=</span><span> Math</span><span>.</span><span>max</span><span>(</span><span>value</span><span>,</span><span> externalSamplingVector</span><span>[</span><span>i</span><span>]</span><span>)</span><span>;</span><span></span></p><p><span>  value </span><span>=</span><span> value </span><span>/</span><span> maxValue</span><span>;</span><span></span></p><p><span>  value </span><span>=</span><span> Math</span><span>.</span><span>pow</span><span>(</span><span>value</span><span>,</span><span> exponent</span><span>)</span><span>;</span><span></span></p><p><span>  value </span><span>=</span><span> value </span><span>*</span><span> maxValue</span><span>;</span><span></span></p><p><span>  </span><span>return</span><span> value</span><span>;</span><span></span></p><p><span></span><span>}</span><span>)</span><span>;</span><span></span></p></pre></div>
<p>The example below shows how light values in the external sampling vector push values in the sampling vector down:</p>

<p>I call this “directional contrast enhancement”, since each of the external sampling circles reaches outside of the cell in the <em>direction</em> of the sampling vector component that it is enhancing the contrast of. I describe the other effect as “global contrast enhancement” since it acts on all of the sampling vector’s components together.</p>
<p>Let’s see what this directional contrast enhancement does to get rid of the staircasing effect:</p>

<p>Hmm, that’s not doing what I wanted. I wanted to see a sequence like so:</p>
<div><pre><p><span>            ..::!!</span></p><p><span>      ..::!!!!!!!!</span></p><p><span>..::!!!!!!!!!!!!!!</span></p></pre></div>
<p>But we just see <code>!</code> changing to <code>:</code></p>

<p>This happens because the directional contrast enhancement doesn’t reach far enough into our sampling vector. The light upper values in the external vector <em>do</em> push the upper values of the sampling vector down, but because the lightness of the four bottom components is retained, we don’t get to <code>.</code>, just <code>:</code>.</p>
<h3>Widening the directional contrast enhancement</h3>
<p>I’d like to “widen” the directional contrast enhancement so that, for example, light external values at the top spread to the middle components of the sampling vector.</p>
<p>To do that, I’ll introduce a few more external sampling circles, arranged like so:</p>

<p>These are a total of <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="2.262ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1000 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-66-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-66-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-66-TEX-N-31"></use><use data-c="30" xlink:href="#MJX-66-TEX-N-30" transform="translate(500,0)"></use></g></g></g></svg></mjx-container> external sampling circles. Each of the external sampling circles will affect one or more of the internal sampling circles. Here’s an illustration showing which internal circles each external circle affects:</p>

<p>For each component of the internal sampling vector, we’ll calculate the maximum value across the external sampling vector components that affect it, and use that maximum to perform the contrast enhancement.</p>
<p>Let’s implement that. I’ll order the internal and external sampling circles like so:</p>

<p>We can then define a mapping from the internal circles to the external sampling circles that affect them:</p>
<div><pre><p><span>const</span><span> </span><span>AFFECTING_EXTERNAL_INDICES</span><span> </span><span>=</span><span> </span><span>[</span><span></span></p><p><span>  </span><span>[</span><span>0</span><span>,</span><span> </span><span>1</span><span>,</span><span> </span><span>2</span><span>,</span><span> </span><span>4</span><span>]</span><span>,</span><span></span></p><p><span>  </span><span>[</span><span>0</span><span>,</span><span> </span><span>1</span><span>,</span><span> </span><span>3</span><span>,</span><span> </span><span>5</span><span>]</span><span>,</span><span></span></p><p><span>  </span><span>[</span><span>2</span><span>,</span><span> </span><span>4</span><span>,</span><span> </span><span>6</span><span>]</span><span>,</span><span></span></p><p><span>  </span><span>[</span><span>3</span><span>,</span><span> </span><span>5</span><span>,</span><span> </span><span>7</span><span>]</span><span>,</span><span></span></p><p><span>  </span><span>[</span><span>4</span><span>,</span><span> </span><span>6</span><span>,</span><span> </span><span>8</span><span>,</span><span> </span><span>9</span><span>]</span><span>,</span><span></span></p><p><span>  </span><span>[</span><span>5</span><span>,</span><span> </span><span>7</span><span>,</span><span> </span><span>8</span><span>,</span><span> </span><span>9</span><span>]</span><span>,</span><span></span></p><p><span></span><span>]</span><span>;</span><span></span></p></pre></div>
<p>With this, we can change the calculation of <code><span>maxValue</span></code> to take the maximum affecting external value:</p>
<div><pre><p><span></span><span>const</span><span> maxValue </span><span>=</span><span> Math</span><span>.</span><span>max</span><span>(</span><span>value</span><span>,</span><span> externalSamplingVector</span><span>[</span><span>i</span><span>]</span><span>)</span><span>;</span><span></span></p><p><span></span><span>let</span><span> maxValue </span><span>=</span><span> value</span><span>;</span><span></span></p><p><span></span><span>for</span><span> </span><span>(</span><span>const</span><span> externalIndex </span><span>of</span><span> </span><span>AFFECTING_EXTERNAL_INDICES</span><span>[</span><span>i</span><span>]</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>  maxValue </span><span>=</span><span> Math</span><span>.</span><span>max</span><span>(</span><span>value</span><span>,</span><span> externalSamplingVector</span><span>[</span><span>externalIndex</span><span>]</span><span>)</span><span>;</span><span></span></p><p><span></span><span>}</span><span></span></p></pre></div>
<p>Now look what happens if the top four external sampling circles are light: it causes the contrast enhancement to reach into the middle of the sampling vector, giving us the desired effect:</p>

<p>We now smoothly transition from <code>! -&gt; : -&gt; .</code> — beautiful stuff!</p>
<p>Let’s see if this change resolves the staircasing effect:</p>

<p>Oh yeah, looks awesome! We get the desired effect. The boundary is nice and sharp while not being too jagged.</p>
<p>Here’s the 3D scene again. The contrast slider now applies both types of contrast enhancement at the same time — try it out:</p>

<p>This really enhances the contrast at boundaries, making the image far more readable!</p>
<p>Together, the 6D shape vector approach and contrast enhancement techniques have given us a really nice final ASCII rendering.</p>
<h2>Final words</h2>
<p>This post was really fun to build and write! I hope you enjoyed reading it.</p>
<p>ASCII rendering is perhaps not the most useful topic to write about, but I think the idea of using a high-dimensional vector to capture shape is interesting and could easily be applied to many other problems. There are parallels to be drawn to <a target="_blank" href="https://en.wikipedia.org/wiki/Word_embedding">word embeddings</a>.</p>
<p>I started writing this ASCII renderer to see if the idea of using a vector to capture the shape of characters would work at all. That approach turned out to work very well, but the initial prototype was terribly slow — I only got single-digit FPS on my iPhone. To get the ASCII renderer running at a smooth <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="2.262ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1000 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-67-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path id="MJX-67-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="36" xlink:href="#MJX-67-TEX-N-36"></use><use data-c="30" xlink:href="#MJX-67-TEX-N-30" transform="translate(500,0)"></use></g></g></g></svg></mjx-container> FPS on mobile required a lot of optimization work. I describe some of that optimization work in the appendices on <a target="" href="https://alexharri.com/blog/ascii-rendering#character-lookup-performance">character lookup performance</a> and <a target="" href="https://alexharri.com/blog/ascii-rendering#appendix-gpu-acceleration">GPU acceleration</a> below.</p>
<p>My colleagues, after reading a draft of this post, suggested <em>many</em> alternatives to the approaches I described in this post. For example, why not make the sampling vector <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="5.028ex" height="1.554ex" role="img" focusable="false" viewBox="0 -665 2222.4 687" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-68-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path id="MJX-68-TEX-N-D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="33" xlink:href="#MJX-68-TEX-N-33"></use></g><g data-mml-node="mo" transform="translate(722.2,0)"><use data-c="D7" xlink:href="#MJX-68-TEX-N-D7"></use></g><g data-mml-node="mn" transform="translate(1722.4,0)"><use data-c="33" xlink:href="#MJX-68-TEX-N-33"></use></g></g></g></svg></mjx-container>? That would capture the shape of <code>T</code> far better — just look how <code>T</code>’s stem falls between the two sampling circles in each row:</p>

<p>And yeah, he’s right! A <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="5.028ex" height="1.554ex" role="img" focusable="false" viewBox="0 -665 2222.4 687" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-69-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path id="MJX-69-TEX-N-D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="33" xlink:href="#MJX-69-TEX-N-33"></use></g><g data-mml-node="mo" transform="translate(722.2,0)"><use data-c="D7" xlink:href="#MJX-69-TEX-N-D7"></use></g><g data-mml-node="mn" transform="translate(1722.4,0)"><use data-c="33" xlink:href="#MJX-69-TEX-N-33"></use></g></g></g></svg></mjx-container> layout would certainly capture it better. They also suggested many alternative approaches to the contrast enhancement methods I described, but I won’t explore those in this post.</p>
<p>It’s really fun how large the solution space to the problem of ASCII rendering is. There are so, so many approaches and trade-offs to explore. I imagine you probably thought of a few yourself while reading this post!</p>
<p>One dimension I intentionally did not explore was using different colors or lightnesses for the ASCII characters themselves. This is for many reasons, but the two primary ones are that 1) it would have expanded the scope of this post too much, and 2) it’s just a different effect, and I personally don’t like the look.<br></p>
<p>At the time of writing these final words, around <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-70-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="36" xlink:href="#MJX-70-TEX-N-36"></use></g></g></g></svg></mjx-container> months have elapsed since I started working on this post. This has been my longest writing process to date. Much of that can be explained by the birth of my now <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:0" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.532ex" role="img" focusable="false" viewBox="0 -677 500 677" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-71-TEX-N-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="34" xlink:href="#MJX-71-TEX-N-34"></use></g></g></g></svg></mjx-container>-month-old daughter. I’ve needed to be a lot more intentional about finding time to write — and disciplined when spending it. I intend to write some smaller posts next. Let’s see if I manage to stick to that promise.</p>
<p>Thanks for reading! And huge thanks to <a target="_blank" href="https://www.linkedin.com/in/gunnlaugur-briem/">Gunnlaugur Þór Briem</a> and <a target="_blank" href="https://eirikur.dev/">Eiríkur Fannar Torfason</a> for reading and providing feedback on a draft of this post.</p>
<p>— Alex Harri</p>
<div><p>Mailing list</p><div><p>To be notified of new posts, subscribe to my mailing list.</p></div></div>
<div><h2>Appendix I: Character lookup performance</h2></div>
<p>Earlier in this post, I showed how can find the best character by finding the character with the shortest Euclidean distance to our sampling vector.</p>
<div><pre><p><span>function</span><span> </span><span>findBestCharacter</span><span>(</span><span>inputVector</span><span>:</span><span> </span><span>number</span><span>[</span><span>]</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>  </span><span>let</span><span> bestCharacter </span><span>=</span><span> </span><span>""</span><span>;</span><span></span></p><p><span>  </span><span>let</span><span> bestDistance </span><span>=</span><span> </span><span>Infinity</span><span>;</span><span></span></p><p><span>  </span><span>for</span><span> </span><span>(</span><span>const</span><span> </span><span>{</span><span> character</span><span>,</span><span> shapeVector </span><span>}</span><span> </span><span>of</span><span> </span><span>CHARACTERS</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>    </span><span>const</span><span> dist </span><span>=</span><span> </span><span>getDistance</span><span>(</span><span>shapeVector</span><span>,</span><span> inputVector</span><span>)</span><span>;</span><span></span></p><p><span>    </span><span>if</span><span> </span><span>(</span><span>dist </span><span>&lt;</span><span> bestDistance</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>      bestDistance </span><span>=</span><span> dist</span><span>;</span><span></span></p><p><span>      bestCharacter </span><span>=</span><span> character</span><span>;</span><span></span></p><p><span>    </span><span>}</span><span></span></p><p><span>  </span><span>}</span><span></span></p><p><span>  </span><span>return</span><span> bestCharacter</span><span>;</span><span></span></p><p><span></span><span>}</span><span></span></p></pre></div>
<p>I tried benchmarking this for <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.439ex" xmlns="http://www.w3.org/2000/svg" width="7.416ex" height="1.946ex" role="img" focusable="false" viewBox="0 -666 3278 860" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-72-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-72-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-72-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-72-TEX-N-31"></use><use data-c="30" xlink:href="#MJX-72-TEX-N-30" transform="translate(500,0)"></use><use data-c="30" xlink:href="#MJX-72-TEX-N-30" transform="translate(1000,0)"></use><use data-c="2C" xlink:href="#MJX-72-TEX-N-2C" transform="translate(1500,0)"></use><use data-c="30" xlink:href="#MJX-72-TEX-N-30" transform="translate(1778,0)"></use><use data-c="30" xlink:href="#MJX-72-TEX-N-30" transform="translate(2278,0)"></use><use data-c="30" xlink:href="#MJX-72-TEX-N-30" transform="translate(2778,0)"></use></g></g></g></svg></mjx-container> input sampling vectors on my MacBook — <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="3.394ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-73-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-73-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-73-TEX-N-31"></use><use data-c="30" xlink:href="#MJX-73-TEX-N-30" transform="translate(500,0)"></use><use data-c="30" xlink:href="#MJX-73-TEX-N-30" transform="translate(1000,0)"></use></g></g></g></svg></mjx-container>K invocations of this function consistently take about <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="3.394ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-74-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-74-TEX-N-39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z"></path><path id="MJX-74-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-74-TEX-N-31"></use><use data-c="39" xlink:href="#MJX-74-TEX-N-39" transform="translate(500,0)"></use><use data-c="30" xlink:href="#MJX-74-TEX-N-30" transform="translate(1000,0)"></use></g></g></g></svg></mjx-container>ms. If we want to be able to use this for an animated canvas at <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="2.262ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1000 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-75-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path id="MJX-75-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="36" xlink:href="#MJX-75-TEX-N-36"></use><use data-c="30" xlink:href="#MJX-75-TEX-N-30" transform="translate(500,0)"></use></g></g></g></svg></mjx-container> FPS, we only have <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="5.154ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 2278 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-76-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-76-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path id="MJX-76-TEX-N-2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-76-TEX-N-31"></use><use data-c="36" xlink:href="#MJX-76-TEX-N-36" transform="translate(500,0)"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1000,0)"><g data-mml-node="mo"><use data-c="2E" xlink:href="#MJX-76-TEX-N-2E"></use></g></g><g data-mml-node="mn" transform="translate(1278,0)"><use data-c="36" xlink:href="#MJX-76-TEX-N-36"></use><use data-c="36" xlink:href="#MJX-76-TEX-N-36" transform="translate(500,0)"></use></g></g></g></svg></mjx-container>ms to render each frame. We can use this to get a rough budget for how many lookups we can perform each frame:</p>

<p>If we allow ourselves <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.127ex" xmlns="http://www.w3.org/2000/svg" width="4.147ex" height="1.824ex" role="img" focusable="false" viewBox="0 -750 1833 806" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-78-TEX-N-35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path><path id="MJX-78-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-78-TEX-N-25" d="M465 605Q428 605 394 614T340 632T319 641Q332 608 332 548Q332 458 293 403T202 347Q145 347 101 402T56 548Q56 637 101 693T202 750Q241 750 272 719Q359 642 464 642Q580 642 650 732Q662 748 668 749Q670 750 673 750Q682 750 688 743T693 726Q178 -47 170 -52Q166 -56 160 -56Q147 -56 142 -45Q137 -36 142 -27Q143 -24 363 304Q469 462 525 546T581 630Q528 605 465 605ZM207 385Q235 385 263 427T292 548Q292 617 267 664T200 712Q193 712 186 709T167 698T147 668T134 615Q132 595 132 548V527Q132 436 165 403Q183 385 203 385H207ZM500 146Q500 234 544 290T647 347Q699 347 737 292T776 146T737 0T646 -56Q590 -56 545 0T500 146ZM651 -18Q679 -18 707 24T736 146Q736 215 711 262T644 309Q637 309 630 306T611 295T591 265T578 212Q577 200 577 146V124Q577 -18 647 -18H651Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="35" xlink:href="#MJX-78-TEX-N-35"></use><use data-c="30" xlink:href="#MJX-78-TEX-N-30" transform="translate(500,0)"></use></g><g data-mml-node="mi" transform="translate(1000,0)"><use data-c="25" xlink:href="#MJX-78-TEX-N-25"></use></g></g></g></svg></mjx-container> of the performance budget for just lookups, this gives us a budget of about <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:0" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.532ex" role="img" focusable="false" viewBox="0 -677 500 677" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-79-TEX-N-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="34" xlink:href="#MJX-79-TEX-N-34"></use></g></g></g></svg></mjx-container>K characters. Not terrible, but far from great, especially considering that we’re using numbers from a powerful laptop. A mobile device might have a <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="2.262ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1000 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-80-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-80-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-80-TEX-N-31"></use><use data-c="30" xlink:href="#MJX-80-TEX-N-30" transform="translate(500,0)"></use></g></g></g></svg></mjx-container> times lower budget. Let’s see how we can improve this.</p>
<h3>k-d trees</h3>
<p><mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.025ex" xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 521 705" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-81-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-81-TEX-I-1D458"></use></g></g></g></svg></mjx-container>-d trees are a data structure that enables nearest-neighbor lookups in multi-dimensional (<mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.025ex" xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 521 705" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-82-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-82-TEX-I-1D458"></use></g></g></g></svg></mjx-container>-dimensional) space. Their performance <a target="_blank" href="https://graphics.stanford.edu/~tpurcell/pubs/search.pdf">degrades in higher dimensions</a> (e.g. <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.09ex" xmlns="http://www.w3.org/2000/svg" width="4.651ex" height="1.597ex" role="img" focusable="false" viewBox="0 -666 2055.8 706" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-83-TEX-N-3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path><path id="MJX-83-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-83-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><use data-c="3E" xlink:href="#MJX-83-TEX-N-3E"></use></g><g data-mml-node="mn" transform="translate(1055.8,0)"><use data-c="32" xlink:href="#MJX-83-TEX-N-32"></use><use data-c="30" xlink:href="#MJX-83-TEX-N-30" transform="translate(500,0)"></use></g></g></g></svg></mjx-container>), but they perform well in <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-84-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="36" xlink:href="#MJX-84-TEX-N-36"></use></g></g></g></svg></mjx-container> dimensions — perfect for our purpose.</p>
<p>Internally, <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.025ex" xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 521 705" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-85-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-85-TEX-I-1D458"></use></g></g></g></svg></mjx-container>-d trees are a binary tree where each node is a <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.025ex" xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 521 705" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-86-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-86-TEX-I-1D458"></use></g></g></g></svg></mjx-container>-dimensional point. Each node can be thought to split the <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.025ex" xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 521 705" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-87-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-87-TEX-I-1D458"></use></g></g></g></svg></mjx-container>-dimensional space in half with a hyperplane, with the left subtree on one side of the hyperplane and the right subtree on the other.</p>
<div><p>I won’t go into much detail on <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.025ex" xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 521 705" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-88-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-88-TEX-I-1D458"></use></g></g></g></svg></mjx-container>-d trees here. You’ll have to look at other resources if you’re interested in learning more.</p><p>One could also look at the <a target="_blank" href="https://en.wikipedia.org/wiki/Hierarchical_navigable_small_world">hierarchical navigable small worlds</a> (HNSW) algorithm, which <a target="_blank" href="https://eirikur.dev/">Eiríkur</a> pointed me to. It is used for approximate nearest neighbor lookups in vector databases, so definitely relevant.</p></div>
<p>Let’s see how it performs! We’ll construct a <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.025ex" xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 521 705" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-89-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-89-TEX-I-1D458"></use></g></g></g></svg></mjx-container>-d tree with our characters and their associated vectors:</p>
<div><pre><p><span>const</span><span> kdTree </span><span>=</span><span> </span><span>new</span><span> </span><span>KdTree</span><span>(</span><span></span></p><p><span>  </span><span>CHARACTERS</span><span>.</span><span>map</span><span>(</span><span>(</span><span>{</span><span> character</span><span>,</span><span> shapeVector </span><span>}</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>(</span><span>{</span><span></span></p><p><span>    point</span><span>:</span><span> shapeVector</span><span>,</span><span></span></p><p><span>    data</span><span>:</span><span> character</span><span>,</span><span></span></p><p><span>  </span><span>}</span><span>)</span><span>)</span><span></span></p><p><span></span><span>)</span><span>;</span><span></span></p></pre></div>
<p>We can now perform nearest-neighbor lookups on the <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.025ex" xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 521 705" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-90-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-90-TEX-I-1D458"></use></g></g></g></svg></mjx-container>-d tree:</p>
<div><pre><p><span>const</span><span> result </span><span>=</span><span> kdTree</span><span>.</span><span>findNearest</span><span>(</span><span>samplingVector</span><span>)</span><span>;</span><span></span></p></pre></div>
<p>Running <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="3.394ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-91-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-91-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-91-TEX-N-31"></use><use data-c="30" xlink:href="#MJX-91-TEX-N-30" transform="translate(500,0)"></use><use data-c="30" xlink:href="#MJX-91-TEX-N-30" transform="translate(1000,0)"></use></g></g></g></svg></mjx-container>K such lookups takes about <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="2.262ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1000 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-92-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="36" xlink:href="#MJX-92-TEX-N-36"></use><use data-c="36" xlink:href="#MJX-92-TEX-N-36" transform="translate(500,0)"></use></g></g></g></svg></mjx-container>ms on my MacBook. That’s about <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.554ex" role="img" focusable="false" viewBox="0 -665 500 687" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-93-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="33" xlink:href="#MJX-93-TEX-N-33"></use></g></g></g></svg></mjx-container>x faster than the brute-force approach. We can use this to calculate, roughly, the number of lookups we can perform per frame:</p>

<p>That’s a lot of lookups per frame, but again, we’re benchmarking on a powerful machine. This is still not good enough.</p>
<p>Let’s see how we can eke out even more performance.</p>
<h3>Caching</h3>
<p>An obvious avenue for speeding up lookups is to cache the result:</p>
<div><pre><p><span>function</span><span> </span><span>searchCached</span><span>(</span><span>samplingVector</span><span>:</span><span> </span><span>number</span><span>[</span><span>]</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>  </span><span>const</span><span> key </span><span>=</span><span> </span><span>generateCacheKey</span><span>(</span><span>samplingVector</span><span>)</span><span></span></p><p><span>  </span><span>if</span><span> </span><span>(</span><span>cache</span><span>.</span><span>has</span><span>(</span><span>key</span><span>)</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>    </span><span>return</span><span> cache</span><span>.</span><span>get</span><span>(</span><span>key</span><span>)</span><span>!</span><span>;</span><span></span></p><p><span>  </span><span>}</span><span></span></p><p><span>  </span><span>const</span><span> result </span><span>=</span><span> </span><span>search</span><span>(</span><span>samplingVector</span><span>)</span><span>;</span><span></span></p><p><span>  cache</span><span>.</span><span>set</span><span>(</span><span>key</span><span>,</span><span> result</span><span>)</span><span>;</span><span></span></p><p><span>  </span><span>return</span><span> result</span><span>;</span><span></span></p><p><span></span><span>}</span><span></span></p></pre></div>
<p>But how does one generate a cache key for a <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-95-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="36" xlink:href="#MJX-95-TEX-N-36"></use></g></g></g></svg></mjx-container>-dimensional vector?</p>
<p>Well, one way is to quantize each vector component so that it fits into a set number of bits and packing those bits into a single number. JavaScript numbers give us <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="2.262ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1000 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-96-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path id="MJX-96-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="33" xlink:href="#MJX-96-TEX-N-33"></use><use data-c="32" xlink:href="#MJX-96-TEX-N-32" transform="translate(500,0)"></use></g></g></g></svg></mjx-container> bits to work with, so each vector component gets <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-97-TEX-N-35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="35" xlink:href="#MJX-97-TEX-N-35"></use></g></g></g></svg></mjx-container> bits.</p>
<p>We can quantize a numeric value between <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-98-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-98-TEX-N-30"></use></g></g></g></svg></mjx-container> and <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:0" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.507ex" role="img" focusable="false" viewBox="0 -666 500 666" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-99-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-99-TEX-N-31"></use></g></g></g></svg></mjx-container> to the range <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-100-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-100-TEX-N-30"></use></g></g></g></svg></mjx-container> to <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="2.262ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1000 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-101-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path id="MJX-101-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="33" xlink:href="#MJX-101-TEX-N-33"></use><use data-c="31" xlink:href="#MJX-101-TEX-N-31" transform="translate(500,0)"></use></g></g></g></svg></mjx-container> (the most that <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-102-TEX-N-35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="35" xlink:href="#MJX-102-TEX-N-35"></use></g></g></g></svg></mjx-container> bits can store) like so:</p>
<div><pre><p><span>const</span><span> </span><span>BITS</span><span> </span><span>=</span><span> </span><span>5</span><span>;</span><span></span></p><p><span></span><span>const</span><span> </span><span>RANGE</span><span> </span><span>=</span><span> </span><span>2</span><span> </span><span>**</span><span> </span><span>BITS</span><span>;</span><span></span></p><p><span></span><span>function</span><span> </span><span>quantizeTo5Bits</span><span>(</span><span>value</span><span>:</span><span> </span><span>number</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>  </span><span>return</span><span> Math</span><span>.</span><span>min</span><span>(</span><span>RANGE</span><span> </span><span>-</span><span> </span><span>1</span><span>,</span><span> Math</span><span>.</span><span>floor</span><span>(</span><span>value </span><span>*</span><span> </span><span>RANGE</span><span>)</span><span>)</span><span>;</span><span></span></p><p><span></span><span>}</span><span></span></p></pre></div>
<p>Applying a max of <code><span>RANGE</span><span> </span><span>-</span><span> </span><span>1</span></code> is done so that a <code><span>value</span></code> of exactly <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:0" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.507ex" role="img" focusable="false" viewBox="0 -666 500 666" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-103-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-103-TEX-N-31"></use></g></g></g></svg></mjx-container> is mapped to <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="2.262ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1000 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-104-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path id="MJX-104-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="33" xlink:href="#MJX-104-TEX-N-33"></use><use data-c="31" xlink:href="#MJX-104-TEX-N-31" transform="translate(500,0)"></use></g></g></g></svg></mjx-container> instead of <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="2.262ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1000 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-105-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path id="MJX-105-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="33" xlink:href="#MJX-105-TEX-N-33"></use><use data-c="32" xlink:href="#MJX-105-TEX-N-32" transform="translate(500,0)"></use></g></g></g></svg></mjx-container>.</p>
<p>We can quantize each of the sampling vector components in this manner and use bit shifting to pack all of the quantized values into a single number like so:</p>
<div><pre><p><span>const</span><span> </span><span>BITS</span><span> </span><span>=</span><span> </span><span>5</span><span>;</span><span></span></p><p><span></span><span>const</span><span> </span><span>RANGE</span><span> </span><span>=</span><span> </span><span>2</span><span> </span><span>**</span><span> </span><span>BITS</span><span>;</span><span></span></p><p><span></span><span>function</span><span> </span><span>generateCacheKey</span><span>(</span><span>vector</span><span>:</span><span> </span><span>number</span><span>[</span><span>]</span><span>)</span><span>:</span><span> </span><span>number</span><span> </span><span>{</span><span></span></p><p><span>  </span><span>let</span><span> key </span><span>=</span><span> </span><span>0</span><span>;</span><span></span></p><p><span>  </span><span>for</span><span> </span><span>(</span><span>let</span><span> i </span><span>=</span><span> </span><span>0</span><span>;</span><span> i </span><span>&lt;</span><span> vector</span><span>.</span><span>length</span><span>;</span><span> i</span><span>++</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>    </span><span>const</span><span> quantized </span><span>=</span><span> Math</span><span>.</span><span>min</span><span>(</span><span>RANGE</span><span> </span><span>-</span><span> </span><span>1</span><span>,</span><span> Math</span><span>.</span><span>floor</span><span>(</span><span>vector</span><span>[</span><span>i</span><span>]</span><span> </span><span>*</span><span> </span><span>RANGE</span><span>)</span><span>)</span><span>;</span><span></span></p><p><span>    key </span><span>=</span><span> </span><span>(</span><span>key </span><span>&lt;&lt;</span><span> </span><span>BITS</span><span>)</span><span> </span><span>|</span><span> quantized</span><span>;</span><span></span></p><p><span>  </span><span>}</span><span></span></p><p><span>  </span><span>return</span><span> key</span><span>;</span><span></span></p><p><span></span><span>}</span><span></span></p></pre></div>
<p>The <code><span>RANGE</span></code> is current set to <code><span>2</span><span> </span><span>**</span><span> </span><span>5</span></code>, but consider how large that makes our key space. Each vector component is one of <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="2.262ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1000 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-106-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path id="MJX-106-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="33" xlink:href="#MJX-106-TEX-N-33"></use><use data-c="32" xlink:href="#MJX-106-TEX-N-32" transform="translate(500,0)"></use></g></g></g></svg></mjx-container> possible values. With <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-107-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="36" xlink:href="#MJX-107-TEX-N-36"></use></g></g></g></svg></mjx-container> vector components, that makes the total number of possible keys <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="3.25ex" height="2.005ex" role="img" focusable="false" viewBox="0 -864 1436.6 886" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-108-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path id="MJX-108-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-108-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><use data-c="33" xlink:href="#MJX-108-TEX-N-33"></use><use data-c="32" xlink:href="#MJX-108-TEX-N-32" transform="translate(500,0)"></use></g><g data-mml-node="mn" transform="translate(1033,393.1) scale(0.707)"><use data-c="36" xlink:href="#MJX-108-TEX-N-36"></use></g></g></g></g></svg></mjx-container>, which equals <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.439ex" xmlns="http://www.w3.org/2000/svg" width="13.199ex" height="1.971ex" role="img" focusable="false" viewBox="0 -677 5834 871" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-109-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-109-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path id="MJX-109-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-109-TEX-N-37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path><path id="MJX-109-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path id="MJX-109-TEX-N-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path id="MJX-109-TEX-N-38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path><path id="MJX-109-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-109-TEX-N-31"></use><use data-c="2C" xlink:href="#MJX-109-TEX-N-2C" transform="translate(500,0)"></use><use data-c="30" xlink:href="#MJX-109-TEX-N-30" transform="translate(778,0)"></use><use data-c="37" xlink:href="#MJX-109-TEX-N-37" transform="translate(1278,0)"></use><use data-c="33" xlink:href="#MJX-109-TEX-N-33" transform="translate(1778,0)"></use><use data-c="2C" xlink:href="#MJX-109-TEX-N-2C" transform="translate(2278,0)"></use><use data-c="37" xlink:href="#MJX-109-TEX-N-37" transform="translate(2556,0)"></use><use data-c="34" xlink:href="#MJX-109-TEX-N-34" transform="translate(3056,0)"></use><use data-c="31" xlink:href="#MJX-109-TEX-N-31" transform="translate(3556,0)"></use><use data-c="2C" xlink:href="#MJX-109-TEX-N-2C" transform="translate(4056,0)"></use><use data-c="38" xlink:href="#MJX-109-TEX-N-38" transform="translate(4334,0)"></use><use data-c="32" xlink:href="#MJX-109-TEX-N-32" transform="translate(4834,0)"></use><use data-c="34" xlink:href="#MJX-109-TEX-N-34" transform="translate(5334,0)"></use></g></g></g></svg></mjx-container>. If the cache were to be fully saturated, just storing the keys would take <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-110-TEX-N-38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="38" xlink:href="#MJX-110-TEX-N-38"></use></g></g></g></svg></mjx-container>GB of memory! I’d also expect the cache hit rate to be incredibly low if we were to lazily fill the cache.</p>
<p>Alright, <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="2.262ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1000 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-111-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path id="MJX-111-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="33" xlink:href="#MJX-111-TEX-N-33"></use><use data-c="32" xlink:href="#MJX-111-TEX-N-32" transform="translate(500,0)"></use></g></g></g></svg></mjx-container> is too high, but what value should we pick? We can pick any number under <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="2.262ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1000 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-112-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path id="MJX-112-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="33" xlink:href="#MJX-112-TEX-N-33"></use><use data-c="32" xlink:href="#MJX-112-TEX-N-32" transform="translate(500,0)"></use></g></g></g></svg></mjx-container> for our range. To help, here’s a table showing the number of possible keys (and the memory needed to store them) for range values between <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-113-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="36" xlink:href="#MJX-113-TEX-N-36"></use></g></g></g></svg></mjx-container> and <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:0" xmlns="http://www.w3.org/2000/svg" width="2.262ex" height="1.507ex" role="img" focusable="false" viewBox="0 -666 1000 666" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-114-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-114-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-114-TEX-N-31"></use><use data-c="32" xlink:href="#MJX-114-TEX-N-32" transform="translate(500,0)"></use></g></g></g></svg></mjx-container>:</p>
<table><tbody><tr><th>Range</th><th>Number of keys</th><th>Memory needed to store keys</th></tr><tr><td>6</td><td>46,656</td><td>364 KB</td></tr><tr><td>7</td><td>117,649</td><td>919 KB</td></tr><tr><td>8</td><td>262,144</td><td>2.00 MB</td></tr><tr><td>9</td><td>531,441</td><td>4.05 MB</td></tr><tr><td>10</td><td>1,000,000</td><td>7.63 MB</td></tr><tr><td>11</td><td>1,771,561</td><td>13.52 MB</td></tr><tr><td>12</td><td>2,985,984</td><td>22.78 MB</td></tr></tbody></table>
<p>There are trade-offs to consider here. As the range gets smaller, the quality of the results drops. If we pick a range of <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-115-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="36" xlink:href="#MJX-115-TEX-N-36"></use></g></g></g></svg></mjx-container>, for example, the only possible lightness values are <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-116-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-116-TEX-N-30"></use></g></g></g></svg></mjx-container>, <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="2.891ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1278 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-117-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-117-TEX-N-2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path><path id="MJX-117-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-117-TEX-N-30"></use><use data-c="2E" xlink:href="#MJX-117-TEX-N-2E" transform="translate(500,0)"></use><use data-c="32" xlink:href="#MJX-117-TEX-N-32" transform="translate(778,0)"></use></g></g></g></svg></mjx-container>, <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="2.891ex" height="1.581ex" role="img" focusable="false" viewBox="0 -677 1278 699" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-118-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-118-TEX-N-2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path><path id="MJX-118-TEX-N-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-118-TEX-N-30"></use><use data-c="2E" xlink:href="#MJX-118-TEX-N-2E" transform="translate(500,0)"></use><use data-c="34" xlink:href="#MJX-118-TEX-N-34" transform="translate(778,0)"></use></g></g></g></svg></mjx-container>, <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="2.891ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1278 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-119-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-119-TEX-N-2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path><path id="MJX-119-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-119-TEX-N-30"></use><use data-c="2E" xlink:href="#MJX-119-TEX-N-2E" transform="translate(500,0)"></use><use data-c="36" xlink:href="#MJX-119-TEX-N-36" transform="translate(778,0)"></use></g></g></g></svg></mjx-container>, <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="2.891ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1278 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-120-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-120-TEX-N-2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path><path id="MJX-120-TEX-N-38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-120-TEX-N-30"></use><use data-c="2E" xlink:href="#MJX-120-TEX-N-2E" transform="translate(500,0)"></use><use data-c="38" xlink:href="#MJX-120-TEX-N-38" transform="translate(778,0)"></use></g></g></g></svg></mjx-container> and <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:0" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.507ex" role="img" focusable="false" viewBox="0 -666 500 666" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-121-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-121-TEX-N-31"></use></g></g></g></svg></mjx-container>. That noticeably affects the quality of character picks.</p>
<p>At the same time, if we increase the possible number of keys, we need more memory to store them. Additionally, the cache hit rate might be very low, especially when the cache is relatively empty.</p>
<p>I ended up picking a range of <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-122-TEX-N-38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="38" xlink:href="#MJX-122-TEX-N-38"></use></g></g></g></svg></mjx-container>. It’s a large enough range that quality doesn’t suffer too much while keeping the cache size reasonably low.</p>
<p>Cached lookups are incredibly fast — fast enough that lookup performance just isn’t a concern anymore (<mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="3.394ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-123-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-123-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-123-TEX-N-31"></use><use data-c="30" xlink:href="#MJX-123-TEX-N-30" transform="translate(500,0)"></use><use data-c="30" xlink:href="#MJX-123-TEX-N-30" transform="translate(1000,0)"></use></g></g></g></svg></mjx-container>K lookups take a few ms on my MacBook). And if we prepopulate the cache, we can expect consistently fast performance, though I encountered no problems just lazily populating the cache.</p>
<div><h2>Appendix II: GPU acceleration</h2></div>
<p>Lookups were not the only performance concern. Just collecting the sampling vectors (internal and external) turned out to be terribly expensive.</p>
<p>Just consider the sheer amount of samples that need to be collected. The 3D scene I’ve been using as an example uses a <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="8.422ex" height="1.581ex" role="img" focusable="false" viewBox="0 -677 3722.4 699" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-124-TEX-N-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path id="MJX-124-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-124-TEX-N-D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path><path id="MJX-124-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-124-TEX-N-37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="34" xlink:href="#MJX-124-TEX-N-34"></use><use data-c="31" xlink:href="#MJX-124-TEX-N-31" transform="translate(500,0)"></use></g><g data-mml-node="mo" transform="translate(1222.2,0)"><use data-c="D7" xlink:href="#MJX-124-TEX-N-D7"></use></g><g data-mml-node="mn" transform="translate(2222.4,0)"><use data-c="31" xlink:href="#MJX-124-TEX-N-31"></use><use data-c="30" xlink:href="#MJX-124-TEX-N-30" transform="translate(500,0)"></use><use data-c="37" xlink:href="#MJX-124-TEX-N-37" transform="translate(1000,0)"></use></g></g></g></svg></mjx-container> grid, which equals <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.439ex" xmlns="http://www.w3.org/2000/svg" width="5.154ex" height="1.971ex" role="img" focusable="false" viewBox="0 -677 2278 871" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-125-TEX-N-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path id="MJX-125-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path id="MJX-125-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path id="MJX-125-TEX-N-38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path><path id="MJX-125-TEX-N-37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="34" xlink:href="#MJX-125-TEX-N-34"></use><use data-c="2C" xlink:href="#MJX-125-TEX-N-2C" transform="translate(500,0)"></use><use data-c="33" xlink:href="#MJX-125-TEX-N-33" transform="translate(778,0)"></use><use data-c="38" xlink:href="#MJX-125-TEX-N-38" transform="translate(1278,0)"></use><use data-c="37" xlink:href="#MJX-125-TEX-N-37" transform="translate(1778,0)"></use></g></g></g></svg></mjx-container> cells. For each of those cells, we compute a <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-126-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="36" xlink:href="#MJX-126-TEX-N-36"></use></g></g></g></svg></mjx-container>-dimensional sampling vector and a <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="2.262ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1000 688" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-127-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-127-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-127-TEX-N-31"></use><use data-c="30" xlink:href="#MJX-127-TEX-N-30" transform="translate(500,0)"></use></g></g></g></svg></mjx-container>-dimensional external sampling vector. That is more than <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.05ex" xmlns="http://www.w3.org/2000/svg" width="2.262ex" height="1.579ex" role="img" focusable="false" viewBox="0 -676 1000 698" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-128-TEX-N-37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path><path id="MJX-128-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="37" xlink:href="#MJX-128-TEX-N-37"></use><use data-c="30" xlink:href="#MJX-128-TEX-N-30" transform="translate(500,0)"></use></g></g></g></svg></mjx-container>K vector components to compute on every frame!</p>

<p>And that’s if we use a sampling quality of <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:0" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.507ex" role="img" focusable="false" viewBox="0 -666 500 666" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-130-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-130-TEX-N-31"></use></g></g></g></svg></mjx-container>. If we increase the sampling quality, this number just gets bigger.</p>
<p>Collecting these samples absolutely <em>crushed</em> performance on my iPhone, so I needed to either collect fewer samples or speed up the collection of samples. Collecting fewer samples would have meant rendering fewer ASCII characters or removing the directional contrast enhancement, neither of which was an appealing solution.</p>
<p>My initial implementation ran on the CPU, which could only collect one sample at a time. To speed this up, I moved the work of sampling collection and applying the contrast enhancement to the GPU. The pipeline for that looks like so (each of the steps listed is a single shader pass):</p>
<ol>
<li>Collect the raw internal sampling vectors into a <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.025ex" xmlns="http://www.w3.org/2000/svg" width="24.746ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 10937.9 705" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-131-TEX-N-63" d="M370 305T349 305T313 320T297 358Q297 381 312 396Q317 401 317 402T307 404Q281 408 258 408Q209 408 178 376Q131 329 131 219Q131 137 162 90Q203 29 272 29Q313 29 338 55T374 117Q376 125 379 127T395 129H409Q415 123 415 120Q415 116 411 104T395 71T366 33T318 2T249 -11Q163 -11 99 53T34 214Q34 318 99 383T250 448T370 421T404 357Q404 334 387 320Z"></path><path id="MJX-131-TEX-N-6F" d="M28 214Q28 309 93 378T250 448Q340 448 405 380T471 215Q471 120 407 55T250 -10Q153 -10 91 57T28 214ZM250 30Q372 30 372 193V225V250Q372 272 371 288T364 326T348 362T317 390T268 410Q263 411 252 411Q222 411 195 399Q152 377 139 338T126 246V226Q126 130 145 91Q177 30 250 30Z"></path><path id="MJX-131-TEX-N-6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path><path id="MJX-131-TEX-N-73" d="M295 316Q295 356 268 385T190 414Q154 414 128 401Q98 382 98 349Q97 344 98 336T114 312T157 287Q175 282 201 278T245 269T277 256Q294 248 310 236T342 195T359 133Q359 71 321 31T198 -10H190Q138 -10 94 26L86 19L77 10Q71 4 65 -1L54 -11H46H42Q39 -11 33 -5V74V132Q33 153 35 157T45 162H54Q66 162 70 158T75 146T82 119T101 77Q136 26 198 26Q295 26 295 104Q295 133 277 151Q257 175 194 187T111 210Q75 227 54 256T33 318Q33 357 50 384T93 424T143 442T187 447H198Q238 447 268 432L283 424L292 431Q302 440 314 448H322H326Q329 448 335 442V310L329 304H301Q295 310 295 316Z"></path><path id="MJX-131-TEX-N-D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path><path id="MJX-131-TEX-N-72" d="M36 46H50Q89 46 97 60V68Q97 77 97 91T98 122T98 161T98 203Q98 234 98 269T98 328L97 351Q94 370 83 376T38 385H20V408Q20 431 22 431L32 432Q42 433 60 434T96 436Q112 437 131 438T160 441T171 442H174V373Q213 441 271 441H277Q322 441 343 419T364 373Q364 352 351 337T313 322Q288 322 276 338T263 372Q263 381 265 388T270 400T273 405Q271 407 250 401Q234 393 226 386Q179 341 179 207V154Q179 141 179 127T179 101T180 81T180 66V61Q181 59 183 57T188 54T193 51T200 49T207 48T216 47T225 47T235 46T245 46H276V0H267Q249 3 140 3Q37 3 28 0H20V46H36Z"></path><path id="MJX-131-TEX-N-77" d="M90 368Q84 378 76 380T40 385H18V431H24L43 430Q62 430 84 429T116 428Q206 428 221 431H229V385H215Q177 383 177 368Q177 367 221 239L265 113L339 328L333 345Q323 374 316 379Q308 384 278 385H258V431H264Q270 428 348 428Q439 428 454 431H461V385H452Q404 385 404 369Q404 366 418 324T449 234T481 143L496 100L537 219Q579 341 579 347Q579 363 564 373T530 385H522V431H529Q541 428 624 428Q692 428 698 431H703V385H697Q696 385 691 385T682 384Q635 377 619 334L559 161Q546 124 528 71Q508 12 503 1T487 -11H479Q460 -11 456 -4Q455 -3 407 133L361 267Q359 263 266 -4Q261 -11 243 -11H238Q225 -11 220 -3L90 368Z"></path><path id="MJX-131-TEX-N-6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z"></path><path id="MJX-131-TEX-N-75" d="M383 58Q327 -10 256 -10H249Q124 -10 105 89Q104 96 103 226Q102 335 102 348T96 369Q86 385 36 385H25V408Q25 431 27 431L38 432Q48 433 67 434T105 436Q122 437 142 438T172 441T184 442H187V261Q188 77 190 64Q193 49 204 40Q224 26 264 26Q290 26 311 35T343 58T363 90T375 120T379 144Q379 145 379 161T380 201T380 248V315Q380 361 370 372T320 385H302V431Q304 431 378 436T457 442H464V264Q464 84 465 81Q468 61 479 55T524 46H542V0Q540 0 467 -5T390 -11H383V58Z"></path><path id="MJX-131-TEX-N-6D" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q351 442 364 440T387 434T406 426T421 417T432 406T441 395T448 384T452 374T455 366L457 361L460 365Q463 369 466 373T475 384T488 397T503 410T523 422T546 432T572 439T603 442Q729 442 740 329Q741 322 741 190V104Q741 66 743 59T754 49Q775 46 803 46H819V0H811L788 1Q764 2 737 2T699 3Q596 3 587 0H579V46H595Q656 46 656 62Q657 64 657 200Q656 335 655 343Q649 371 635 385T611 402T585 404Q540 404 506 370Q479 343 472 315T464 232V168V108Q464 78 465 68T468 55T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z"></path><path id="MJX-131-TEX-N-20" d=""></path><path id="MJX-131-TEX-N-69" d="M69 609Q69 637 87 653T131 669Q154 667 171 652T188 609Q188 579 171 564T129 549Q104 549 87 564T69 609ZM247 0Q232 3 143 3Q132 3 106 3T56 1L34 0H26V46H42Q70 46 91 49Q100 53 102 60T104 102V205V293Q104 345 102 359T88 378Q74 385 41 385H30V408Q30 431 32 431L42 432Q52 433 70 434T106 436Q123 437 142 438T171 441T182 442H185V62Q190 52 197 50T232 46H255V0H247Z"></path><path id="MJX-131-TEX-N-65" d="M28 218Q28 273 48 318T98 391T163 433T229 448Q282 448 320 430T378 380T406 316T415 245Q415 238 408 231H126V216Q126 68 226 36Q246 30 270 30Q312 30 342 62Q359 79 369 104L379 128Q382 131 395 131H398Q415 131 415 121Q415 117 412 108Q393 53 349 21T250 -11Q155 -11 92 58T28 218ZM333 275Q322 403 238 411H236Q228 411 220 410T195 402T166 381T143 340T127 274V267H333V275Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mtext"><use data-c="63" xlink:href="#MJX-131-TEX-N-63"></use><use data-c="6F" xlink:href="#MJX-131-TEX-N-6F" transform="translate(444,0)"></use><use data-c="6C" xlink:href="#MJX-131-TEX-N-6C" transform="translate(944,0)"></use><use data-c="73" xlink:href="#MJX-131-TEX-N-73" transform="translate(1222,0)"></use></g><g data-mml-node="mo" transform="translate(1838.2,0)"><use data-c="D7" xlink:href="#MJX-131-TEX-N-D7"></use></g><g data-mml-node="mtext" transform="translate(2838.4,0)"><use data-c="72" xlink:href="#MJX-131-TEX-N-72"></use><use data-c="6F" xlink:href="#MJX-131-TEX-N-6F" transform="translate(392,0)"></use><use data-c="77" xlink:href="#MJX-131-TEX-N-77" transform="translate(892,0)"></use><use data-c="73" xlink:href="#MJX-131-TEX-N-73" transform="translate(1614,0)"></use></g><g data-mml-node="mo" transform="translate(5068.7,0)"><use data-c="D7" xlink:href="#MJX-131-TEX-N-D7"></use></g><g data-mml-node="mtext" transform="translate(6068.9,0)"><use data-c="6E" xlink:href="#MJX-131-TEX-N-6E"></use><use data-c="75" xlink:href="#MJX-131-TEX-N-75" transform="translate(556,0)"></use><use data-c="6D" xlink:href="#MJX-131-TEX-N-6D" transform="translate(1112,0)"></use><use data-c="20" xlink:href="#MJX-131-TEX-N-20" transform="translate(1945,0)"></use><use data-c="63" xlink:href="#MJX-131-TEX-N-63" transform="translate(2195,0)"></use><use data-c="69" xlink:href="#MJX-131-TEX-N-69" transform="translate(2639,0)"></use><use data-c="72" xlink:href="#MJX-131-TEX-N-72" transform="translate(2917,0)"></use><use data-c="63" xlink:href="#MJX-131-TEX-N-63" transform="translate(3309,0)"></use><use data-c="6C" xlink:href="#MJX-131-TEX-N-6C" transform="translate(3753,0)"></use><use data-c="65" xlink:href="#MJX-131-TEX-N-65" transform="translate(4031,0)"></use><use data-c="73" xlink:href="#MJX-131-TEX-N-73" transform="translate(4475,0)"></use></g></g></g></svg></mjx-container> texture, using the canvas (image) as the input texture.</li>
<li>Do the same for the external sampling vectors.</li>
<li>Calculate the maximum external value affecting each internal vector component into a <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.025ex" xmlns="http://www.w3.org/2000/svg" width="24.746ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 10937.9 705" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-132-TEX-N-63" d="M370 305T349 305T313 320T297 358Q297 381 312 396Q317 401 317 402T307 404Q281 408 258 408Q209 408 178 376Q131 329 131 219Q131 137 162 90Q203 29 272 29Q313 29 338 55T374 117Q376 125 379 127T395 129H409Q415 123 415 120Q415 116 411 104T395 71T366 33T318 2T249 -11Q163 -11 99 53T34 214Q34 318 99 383T250 448T370 421T404 357Q404 334 387 320Z"></path><path id="MJX-132-TEX-N-6F" d="M28 214Q28 309 93 378T250 448Q340 448 405 380T471 215Q471 120 407 55T250 -10Q153 -10 91 57T28 214ZM250 30Q372 30 372 193V225V250Q372 272 371 288T364 326T348 362T317 390T268 410Q263 411 252 411Q222 411 195 399Q152 377 139 338T126 246V226Q126 130 145 91Q177 30 250 30Z"></path><path id="MJX-132-TEX-N-6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path><path id="MJX-132-TEX-N-73" d="M295 316Q295 356 268 385T190 414Q154 414 128 401Q98 382 98 349Q97 344 98 336T114 312T157 287Q175 282 201 278T245 269T277 256Q294 248 310 236T342 195T359 133Q359 71 321 31T198 -10H190Q138 -10 94 26L86 19L77 10Q71 4 65 -1L54 -11H46H42Q39 -11 33 -5V74V132Q33 153 35 157T45 162H54Q66 162 70 158T75 146T82 119T101 77Q136 26 198 26Q295 26 295 104Q295 133 277 151Q257 175 194 187T111 210Q75 227 54 256T33 318Q33 357 50 384T93 424T143 442T187 447H198Q238 447 268 432L283 424L292 431Q302 440 314 448H322H326Q329 448 335 442V310L329 304H301Q295 310 295 316Z"></path><path id="MJX-132-TEX-N-D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path><path id="MJX-132-TEX-N-72" d="M36 46H50Q89 46 97 60V68Q97 77 97 91T98 122T98 161T98 203Q98 234 98 269T98 328L97 351Q94 370 83 376T38 385H20V408Q20 431 22 431L32 432Q42 433 60 434T96 436Q112 437 131 438T160 441T171 442H174V373Q213 441 271 441H277Q322 441 343 419T364 373Q364 352 351 337T313 322Q288 322 276 338T263 372Q263 381 265 388T270 400T273 405Q271 407 250 401Q234 393 226 386Q179 341 179 207V154Q179 141 179 127T179 101T180 81T180 66V61Q181 59 183 57T188 54T193 51T200 49T207 48T216 47T225 47T235 46T245 46H276V0H267Q249 3 140 3Q37 3 28 0H20V46H36Z"></path><path id="MJX-132-TEX-N-77" d="M90 368Q84 378 76 380T40 385H18V431H24L43 430Q62 430 84 429T116 428Q206 428 221 431H229V385H215Q177 383 177 368Q177 367 221 239L265 113L339 328L333 345Q323 374 316 379Q308 384 278 385H258V431H264Q270 428 348 428Q439 428 454 431H461V385H452Q404 385 404 369Q404 366 418 324T449 234T481 143L496 100L537 219Q579 341 579 347Q579 363 564 373T530 385H522V431H529Q541 428 624 428Q692 428 698 431H703V385H697Q696 385 691 385T682 384Q635 377 619 334L559 161Q546 124 528 71Q508 12 503 1T487 -11H479Q460 -11 456 -4Q455 -3 407 133L361 267Q359 263 266 -4Q261 -11 243 -11H238Q225 -11 220 -3L90 368Z"></path><path id="MJX-132-TEX-N-6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z"></path><path id="MJX-132-TEX-N-75" d="M383 58Q327 -10 256 -10H249Q124 -10 105 89Q104 96 103 226Q102 335 102 348T96 369Q86 385 36 385H25V408Q25 431 27 431L38 432Q48 433 67 434T105 436Q122 437 142 438T172 441T184 442H187V261Q188 77 190 64Q193 49 204 40Q224 26 264 26Q290 26 311 35T343 58T363 90T375 120T379 144Q379 145 379 161T380 201T380 248V315Q380 361 370 372T320 385H302V431Q304 431 378 436T457 442H464V264Q464 84 465 81Q468 61 479 55T524 46H542V0Q540 0 467 -5T390 -11H383V58Z"></path><path id="MJX-132-TEX-N-6D" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q351 442 364 440T387 434T406 426T421 417T432 406T441 395T448 384T452 374T455 366L457 361L460 365Q463 369 466 373T475 384T488 397T503 410T523 422T546 432T572 439T603 442Q729 442 740 329Q741 322 741 190V104Q741 66 743 59T754 49Q775 46 803 46H819V0H811L788 1Q764 2 737 2T699 3Q596 3 587 0H579V46H595Q656 46 656 62Q657 64 657 200Q656 335 655 343Q649 371 635 385T611 402T585 404Q540 404 506 370Q479 343 472 315T464 232V168V108Q464 78 465 68T468 55T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z"></path><path id="MJX-132-TEX-N-20" d=""></path><path id="MJX-132-TEX-N-69" d="M69 609Q69 637 87 653T131 669Q154 667 171 652T188 609Q188 579 171 564T129 549Q104 549 87 564T69 609ZM247 0Q232 3 143 3Q132 3 106 3T56 1L34 0H26V46H42Q70 46 91 49Q100 53 102 60T104 102V205V293Q104 345 102 359T88 378Q74 385 41 385H30V408Q30 431 32 431L42 432Q52 433 70 434T106 436Q123 437 142 438T171 441T182 442H185V62Q190 52 197 50T232 46H255V0H247Z"></path><path id="MJX-132-TEX-N-65" d="M28 218Q28 273 48 318T98 391T163 433T229 448Q282 448 320 430T378 380T406 316T415 245Q415 238 408 231H126V216Q126 68 226 36Q246 30 270 30Q312 30 342 62Q359 79 369 104L379 128Q382 131 395 131H398Q415 131 415 121Q415 117 412 108Q393 53 349 21T250 -11Q155 -11 92 58T28 218ZM333 275Q322 403 238 411H236Q228 411 220 410T195 402T166 381T143 340T127 274V267H333V275Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mtext"><use data-c="63" xlink:href="#MJX-132-TEX-N-63"></use><use data-c="6F" xlink:href="#MJX-132-TEX-N-6F" transform="translate(444,0)"></use><use data-c="6C" xlink:href="#MJX-132-TEX-N-6C" transform="translate(944,0)"></use><use data-c="73" xlink:href="#MJX-132-TEX-N-73" transform="translate(1222,0)"></use></g><g data-mml-node="mo" transform="translate(1838.2,0)"><use data-c="D7" xlink:href="#MJX-132-TEX-N-D7"></use></g><g data-mml-node="mtext" transform="translate(2838.4,0)"><use data-c="72" xlink:href="#MJX-132-TEX-N-72"></use><use data-c="6F" xlink:href="#MJX-132-TEX-N-6F" transform="translate(392,0)"></use><use data-c="77" xlink:href="#MJX-132-TEX-N-77" transform="translate(892,0)"></use><use data-c="73" xlink:href="#MJX-132-TEX-N-73" transform="translate(1614,0)"></use></g><g data-mml-node="mo" transform="translate(5068.7,0)"><use data-c="D7" xlink:href="#MJX-132-TEX-N-D7"></use></g><g data-mml-node="mtext" transform="translate(6068.9,0)"><use data-c="6E" xlink:href="#MJX-132-TEX-N-6E"></use><use data-c="75" xlink:href="#MJX-132-TEX-N-75" transform="translate(556,0)"></use><use data-c="6D" xlink:href="#MJX-132-TEX-N-6D" transform="translate(1112,0)"></use><use data-c="20" xlink:href="#MJX-132-TEX-N-20" transform="translate(1945,0)"></use><use data-c="63" xlink:href="#MJX-132-TEX-N-63" transform="translate(2195,0)"></use><use data-c="69" xlink:href="#MJX-132-TEX-N-69" transform="translate(2639,0)"></use><use data-c="72" xlink:href="#MJX-132-TEX-N-72" transform="translate(2917,0)"></use><use data-c="63" xlink:href="#MJX-132-TEX-N-63" transform="translate(3309,0)"></use><use data-c="6C" xlink:href="#MJX-132-TEX-N-6C" transform="translate(3753,0)"></use><use data-c="65" xlink:href="#MJX-132-TEX-N-65" transform="translate(4031,0)"></use><use data-c="73" xlink:href="#MJX-132-TEX-N-73" transform="translate(4475,0)"></use></g></g></g></svg></mjx-container> texture.</li>
<li>Apply directional contrast enhancement to each sampling vector component, using the maximum external values texture.</li>
<li>Calculate the maximum value for each internal sampling vector into a <mjx-container classname="MathJax" jax="SVG"><svg style="vertical-align:-0.025ex" xmlns="http://www.w3.org/2000/svg" width="10.965ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 4846.4 705" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-133-TEX-N-63" d="M370 305T349 305T313 320T297 358Q297 381 312 396Q317 401 317 402T307 404Q281 408 258 408Q209 408 178 376Q131 329 131 219Q131 137 162 90Q203 29 272 29Q313 29 338 55T374 117Q376 125 379 127T395 129H409Q415 123 415 120Q415 116 411 104T395 71T366 33T318 2T249 -11Q163 -11 99 53T34 214Q34 318 99 383T250 448T370 421T404 357Q404 334 387 320Z"></path><path id="MJX-133-TEX-N-6F" d="M28 214Q28 309 93 378T250 448Q340 448 405 380T471 215Q471 120 407 55T250 -10Q153 -10 91 57T28 214ZM250 30Q372 30 372 193V225V250Q372 272 371 288T364 326T348 362T317 390T268 410Q263 411 252 411Q222 411 195 399Q152 377 139 338T126 246V226Q126 130 145 91Q177 30 250 30Z"></path><path id="MJX-133-TEX-N-6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path><path id="MJX-133-TEX-N-73" d="M295 316Q295 356 268 385T190 414Q154 414 128 401Q98 382 98 349Q97 344 98 336T114 312T157 287Q175 282 201 278T245 269T277 256Q294 248 310 236T342 195T359 133Q359 71 321 31T198 -10H190Q138 -10 94 26L86 19L77 10Q71 4 65 -1L54 -11H46H42Q39 -11 33 -5V74V132Q33 153 35 157T45 162H54Q66 162 70 158T75 146T82 119T101 77Q136 26 198 26Q295 26 295 104Q295 133 277 151Q257 175 194 187T111 210Q75 227 54 256T33 318Q33 357 50 384T93 424T143 442T187 447H198Q238 447 268 432L283 424L292 431Q302 440 314 448H322H326Q329 448 335 442V310L329 304H301Q295 310 295 316Z"></path><path id="MJX-133-TEX-N-D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path><path id="MJX-133-TEX-N-72" d="M36 46H50Q89 46 97 60V68Q97 77 97 91T98 122T98 161T98 203Q98 234 98 269T98 328L97 351Q94 370 83 376T38 385H20V408Q20 431 22 431L32 432Q42 433 60 434T96 436Q112 437 131 438T160 441T171 442H174V373Q213 441 271 441H277Q322 441 343 419T364 373Q364 352 351 337T313 322Q288 322 276 338T263 372Q263 381 265 388T270 400T273 405Q271 407 250 401Q234 393 226 386Q179 341 179 207V154Q179 141 179 127T179 101T180 81T180 66V61Q181 59 183 57T188 54T193 51T200 49T207 48T216 47T225 47T235 46T245 46H276V0H267Q249 3 140 3Q37 3 28 0H20V46H36Z"></path><path id="MJX-133-TEX-N-77" d="M90 368Q84 378 76 380T40 385H18V431H24L43 430Q62 430 84 429T116 428Q206 428 221 431H229V385H215Q177 383 177 368Q177 367 221 239L265 113L339 328L333 345Q323 374 316 379Q308 384 278 385H258V431H264Q270 428 348 428Q439 428 454 431H461V385H452Q404 385 404 369Q404 366 418 324T449 234T481 143L496 100L537 219Q579 341 579 347Q579 363 564 373T530 385H522V431H529Q541 428 624 428Q692 428 698 431H703V385H697Q696 385 691 385T682 384Q635 377 619 334L559 161Q546 124 528 71Q508 12 503 1T487 -11H479Q460 -11 456 -4Q455 -3 407 133L361 267Q359 263 266 -4Q261 -11 243 -11H238Q225 -11 220 -3L90 368Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mtext"><use data-c="63" xlink:href="#MJX-133-TEX-N-63"></use><use data-c="6F" xlink:href="#MJX-133-TEX-N-6F" transform="translate(444,0)"></use><use data-c="6C" xlink:href="#MJX-133-TEX-N-6C" transform="translate(944,0)"></use><use data-c="73" xlink:href="#MJX-133-TEX-N-73" transform="translate(1222,0)"></use></g><g data-mml-node="mo" transform="translate(1838.2,0)"><use data-c="D7" xlink:href="#MJX-133-TEX-N-D7"></use></g><g data-mml-node="mtext" transform="translate(2838.4,0)"><use data-c="72" xlink:href="#MJX-133-TEX-N-72"></use><use data-c="6F" xlink:href="#MJX-133-TEX-N-6F" transform="translate(392,0)"></use><use data-c="77" xlink:href="#MJX-133-TEX-N-77" transform="translate(892,0)"></use><use data-c="73" xlink:href="#MJX-133-TEX-N-73" transform="translate(1614,0)"></use></g></g></g></svg></mjx-container> texture.</li>
<li>Apply global contrast enhancement to each sampling vector component, using the maximum internal values texture.</li>
</ol>
<p>I’m glossing over the details because I could spend a whole other post covering them, but moving work to the GPU made the renderer many times more performant than it was when everything ran on the CPU.</p><div><p>Mailing list</p><div><p>To be notified of new posts, subscribe to my mailing list.</p></div></div></main></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[After 25 years, Wikipedia has proved that news doesn't need to look like news (133 pts)]]></title>
            <link>https://www.niemanlab.org/2026/01/after-25-years-wikipedia-has-proved-that-news-doesnt-need-to-look-like-news/</link>
            <guid>46656911</guid>
            <pubDate>Sat, 17 Jan 2026 10:29:35 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.niemanlab.org/2026/01/after-25-years-wikipedia-has-proved-that-news-doesnt-need-to-look-like-news/">https://www.niemanlab.org/2026/01/after-25-years-wikipedia-has-proved-that-news-doesnt-need-to-look-like-news/</a>, See on <a href="https://news.ycombinator.com/item?id=46656911">Hacker News</a></p>
<div id="readability-page-1" class="page"><p>Jan.  15, 2026, 3:32 p.m.</p><p>It’s not a news site. But there’s a lot to learn from how Wikipedia constructs shared knowledge about what’s happening in the world.</p><div id="content_div-247215">


<p>One of my favorite weekly newsletters is called the <a href="https://weekly.hatnote.com/">Weeklypedia</a>; here’s <a href="https://weekly.hatnote.com/archive/en/20260109/weeklypedia_20260109.html">last Friday’s edition</a>. Each email contains two lists: The 20 Wikipedia articles that have been edited the most times in the past week, and the 10 most-edited articles created <em>within</em> the past week. If you read it long enough, you’ll start to see the subcategories most of these articles fall into — and the amount of volunteer labor that goes into them. </p>
<p>There are the <em>very specific</em> lists that some completist has taken on as a challenge. (Last week, “<a href="https://en.wikipedia.org/wiki/List_of_Phi_Alpha_Honor_Society_chapters">List of Phi Alpha Honor Society chapters</a>” was edited <a href="https://en.wikipedia.org/w/index.php?title=List_of_Phi_Alpha_Honor_Society_chapters&amp;diff=1331898940&amp;oldid=1331125653">257 times</a> — by only two authors. Or “<a href="https://en.wikipedia.org/wiki/Deaths_in_March_1982">Deaths in March 1982</a>,” edited <a href="https://en.wikipedia.org/w/index.php?title=Deaths_in_March_1982&amp;diff=1331968359&amp;oldid=1330649145">398 times</a> by five authors.)</p>
<p>There are the sports tournaments and reality TV shows that demand moment-to-moment updates. (Last week, there were <a href="https://en.wikipedia.org/w/index.php?title=2026_Malaysia_Open_(badminton)&amp;diff=1331987873&amp;oldid=1330250626">268 edits</a> on “<a href="https://en.wikipedia.org/wiki/2026_Malaysia_Open_(badminton)">2026 Malaysia Open (badminton)</a>” and <a href="https://en.wikipedia.org/w/index.php?title=Bigg_Boss_(Tamil_TV_series)_season_9&amp;diff=1331986258&amp;oldid=1330748976">605</a> on “<a href="https://en.wikipedia.org/wiki/Bigg_Boss_(Tamil_TV_series)_season_9"><em>Bigg Boss</em> (Tamil TV series) season 9</a>.”)</p>
<p>There are the biographies of people whom someone has decided deserve memorializing. (Last week, user <a href="https://en.wikipedia.org/wiki/User:Mary_Mark_Ockerbloom">Mary Mark Ockerbloom</a> created the article on Quaker abolitionist <a href="https://en.wikipedia.org/wiki/John_Vickers_(abolitionist)">John Vickers</a> and edited it 161 times. User <a href="https://en.wikipedia.org/wiki/User:Pigsonthewing">pigsonthewing</a> did the same for the artist <a href="https://en.wikipedia.org/wiki/Charles_Shepard_(artist)">Charles Shepard</a> — best known for making posters for the British travel industry — but edited it <em>only</em> 90 times.)</p>
<p>But the most common Wikipedia genre represented each week is news. When something big happens in the world, some Wikipedian will start an article — and within minutes, editors will descend on it, using news articles as raw material to construct something encyclopedic. Here’s last week’s top 10 — it’s awfully close to a summary of the week’s front pages:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/2026_United_States_strikes_in_Venezuela">2026 United States strikes in Venezuela</a> (3,057 changes by 575 authors)</li>
<li><a href="https://en.wikipedia.org/wiki/2026_ICE_Minneapolis_shooting_of_protestor">2026 ICE Minneapolis shooting of protestor</a> (1,068 changes by 220 authors)</li>
<li><a href="https://en.wikipedia.org/wiki/Killing_of_Renee_Good">Killing of Renee Good</a> (1,067 changes by 220 authors)</li>
<li><a href="https://en.wikipedia.org/wiki/2025%E2%80%932026_Iranian_protests">2025–2026 Iranian protests</a> (762 changes by 155 authors)</li>
<li><a href="https://en.wikipedia.org/wiki/Nicol%C3%A1s_Maduro">Nicolás Maduro</a> (647 changes by 242 authors)</li>
<li><a href="https://en.wikipedia.org/wiki/2026_Crans-Montana_bar_fire">2026 Crans-Montana bar fire</a> (597 changes by 167 authors)</li>
<li><a href="https://en.wikipedia.org/wiki/2026_Caracas_airstrikes">2026 Caracas airstrikes</a> (3,058 changes by 575 authors)</li>
<li><a href="https://en.wikipedia.org/wiki/Deaths_in_2026">Deaths in 2026</a> (574 changes by 108 authors)</li>
<li><a href="https://en.wikipedia.org/wiki/Delcy_Rodr%C3%ADguez">Delcy Rodríguez</a> (548 changes by 207 authors)</li>
<li><a href="https://en.wikipedia.org/wiki/International_reactions_to_the_2026_United_States_strikes_in_Venezuela">International reactions to the 2026 United States strikes in Venezuela</a> (530 changes by 149 authors)</li>
</ul>
<p>Wikipedia <a href="https://wikimediafoundation.org/wikipedia25/">turns 25 years old today</a>. On January 15, 2001, at 2:27 p.m. EST, Jimmy Wales made <a href="https://en.wikipedia.org/wiki/First_Wikipedia_edit">the first edit</a>: “This is the new WikiPedia!” (They’ve gotten better since then.)</p>
<p>To celebrate, you can take a “<a href="https://wikipedia25.org/en/which-wikipedia-of-the-future-are-you/">What Wikipedia of the future are you?</a>” quiz. Without even taking the quiz, though, I know which one I am: the Wikipedia That Gets Respect As a Source of News.</p>
<p>The site’s early years were filled with media outrage about a source of “truth” that anyone could edit. And yes, you could right now go edit in a claim that <a href="https://en.wikipedia.org/wiki/Happy_Chandler">Happy Chandler</a> was a <a href="https://en.wikipedia.org/wiki/Reptilian_conspiracy_theory">lizard person</a>. But the layers of accountability the site has built up over the years would likely reverse your edit within minutes. If those minutes are the cost of creating perhaps humanity’s single greatest source of information, I’m willing to pay it — with apologies to Happy’s descendants. Here are a few things news organizations could learn from it.</p>
<ul>
<li><strong>News isn’t always what just happened.</strong> A few decades into the web, this might seem obvious today. But in 2001, news organizations were still very much constructed around producing daily newspapers and nightly newscasts. The rhythms of production drove everything from story selection to writing style to revenue models. Wikipedia was the first site that gave most journalists a vision of an “article” that is constantly <em>updated</em>, not rewritten with a new lede the next day. If there’s an important new detail in that Swiss bar fire investigation, it’ll be used to make the current Wikipedia article a little bit better — not to have a new unique URL to push out on social. Whatever questions your journalism answers, people will probably still be asking them tomorrow, and next week, and next year. Wikipedia is optimized for catching people up on news stories they missed the first time around.</li>
<li><strong>Building processes means building culture.</strong> Wikipedia succeeds because it has a <a href="https://en.wikipedia.org/wiki/Wikipedia:Policies_and_guidelines">core set of standards and practices</a> that its editors treat as holy writ. <a href="https://en.wikipedia.org/wiki/Wikipedia:No_original_research">No original research</a>. <a href="https://en.wikipedia.org/wiki/Wikipedia:Neutral_point_of_view">Neutral point of view</a>. <a href="https://en.wikipedia.org/wiki/Wikipedia:Reliable_sources">Not every source is equally reliable</a>. <a href="https://en.wikipedia.org/wiki/Wikipedia:Sockpuppetry">No sockpuppetry</a>. <a href="https://en.wikipedia.org/wiki/Wikipedia:Do_not_disrupt_Wikipedia_to_illustrate_a_point">Do not disrupt Wikipedia to make a point</a> — but <a href="https://en.wikipedia.org/wiki/Wikipedia:Assume_good_faith">assume good faith</a>. Most (though not all) align perfectly well with the principles of journalism. But they’ve been <em>constructed</em>, a codified set of editorial standards, a collective ethos that guides the whole operation. For Wikipedia to work, there has to be consensus about how things are done, and that requires building a culture among editors. Why have so many other wiki-driven sites failed? They never build the culture that undergirds the processes.</li>
<li><strong>Don’t break links.</strong> Unless an article has been taken down entirely, just about every link to a Wikipedia page created in the past quarter-century still works. Its article on <a href="https://en.wikipedia.org/wiki/Nicol%C3%A1s_Maduro">Nicolás Maduro</a> is still in the same place it was when first <a href="https://en.wikipedia.org/w/index.php?title=Nicol%C3%A1s_Maduro&amp;oldid=77891767">created in 2006</a>, <a href="https://xtools.wmcloud.org/articleinfo/en.wikipedia.org/Nicol%C3%A1s_Maduro">4,493 edits ago</a>. How many news articles published online in 2006 still live at the same address? Vanishingly few. When you start to think of articles as something with <em>permanence</em>, you realize the high cost of breaking a perfectly good URL.</li>
<li><strong>Document your work.</strong> Check out one of those newsy Wikipedia articles, like <a href="https://en.wikipedia.org/wiki/Killing_of_Renee_Good">this one on the killing of Renee Good</a>. It’s currently <a href="https://xtools.wmcloud.org/articleinfo/en.wikipedia.org/Killing_of_Renee_Good">4,559 words</a>. It’s been read <a href="https://pageviews.wmcloud.org/?project=en.wikipedia.org&amp;platform=all-access&amp;agent=user&amp;redirects=0&amp;range=latest-20&amp;pages=Killing_of_Renee_Good">nearly 1.4 million times</a>. A total of 331 people have made 2,204 edits to it. Its <a href="https://en.wikipedia.org/wiki/Talk:Killing_of_Renee_Good">talk page</a> includes more than 1,000 signed comments from Wikipedia users arguing for something’s inclusion or exclusion. (Should the page’s title refer to Renee Good <a href="https://en.wikipedia.org/wiki/Talk:Killing_of_Renee_Good#Requested_move_10_January_2026">or Renée Good, with an accent</a>? Should we note <a href="https://en.wikipedia.org/wiki/Talk:Killing_of_Renee_Good/Archive_1#Date_of_shooter_identification">the date the shooter was first publicly identified</a>? Should this article include <a href="https://en.wikipedia.org/wiki/Talk:Killing_of_Renee_Good/Archive_1#Protests_against_the_killing_of_Renee_Good">details about anti-ICE protests after the killing</a>, or should that be in a separate article?) It backs up its claims with 169 footnotes linking to news sources and official statements. And all of this work is available for anyone to see. The back-and-forths on the talk page let the reader see that points of view are being heard and debated. And anyone can click a link to confirm if a source is being accurately reflected. All that transparency won’t be practical for all journalistic work — but there’s no denying the trust that is built by operating in public.</li>
</ul>
<p>Photo via Adobe Stock.</p>







<p><a href="https://www.niemanlab.org/author/jbenton">Joshua Benton</a> is the senior writer and former director of Nieman Lab, which he founded in 2008. You can reach him via <a href="https://www.niemanlab.org/cdn-cgi/l/email-protection#c3a9acb0abb6a29ca1a6adb7acad83aba2b1b5a2b1a7eda6a7b6">email</a>, <a href="https://twitter.com/jbenton">Twitter</a> (@jbenton), or <a href="https://bsky.app/profile/joshuabenton.com">Bluesky</a>.</p>





















</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[US electricity demand surged in 2025 – solar handled 61% of it (165 pts)]]></title>
            <link>https://electrek.co/2026/01/16/us-electricity-demand-surged-in-2025-solar-handled-61-percent/</link>
            <guid>46656903</guid>
            <pubDate>Sat, 17 Jan 2026 10:28:06 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://electrek.co/2026/01/16/us-electricity-demand-surged-in-2025-solar-handled-61-percent/">https://electrek.co/2026/01/16/us-electricity-demand-surged-in-2025-solar-handled-61-percent/</a>, See on <a href="https://news.ycombinator.com/item?id=46656903">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
					
<figure>

	<img width="1600" height="800" src="https://electrek.co/wp-content/uploads/sites/3/2025/10/Baltimore-County-landfill-solar.jpg?quality=82&amp;strip=all&amp;w=1600" alt="US electricity demand solar 2025" srcset="https://i0.wp.com/electrek.co/wp-content/uploads/sites/3/2025/10/Baltimore-County-landfill-solar.jpg?w=320&amp;quality=82&amp;strip=all&amp;ssl=1 320w, https://i0.wp.com/electrek.co/wp-content/uploads/sites/3/2025/10/Baltimore-County-landfill-solar.jpg?w=640&amp;quality=82&amp;strip=all&amp;ssl=1 640w, https://i0.wp.com/electrek.co/wp-content/uploads/sites/3/2025/10/Baltimore-County-landfill-solar.jpg?w=1024&amp;quality=82&amp;strip=all&amp;ssl=1 1024w, https://i0.wp.com/electrek.co/wp-content/uploads/sites/3/2025/10/Baltimore-County-landfill-solar.jpg?w=1500&amp;quality=82&amp;strip=all&amp;ssl=1 1500w" decoding="async" fetchpriority="high">			<figcaption>
				Photo: Baltimore County			</figcaption>
			
	</figure>

<p>Solar didn’t just show up in 2025 – it carried the grid.&nbsp;A new analysis from global energy think tank Ember shows that solar power accounted for 61% of the growth in US electricity demand last year, highlighting how central solar has become as power demand accelerates.</p>



<p>US electricity demand jumped by 135 terawatt-hours (TWh) in 2025, a 3.1% increase, the fourth‑largest annual rise of the past decade. Over that same period, solar generation grew by a record 83 TWh – a 27% increase from 2024 and the biggest absolute gain of any power source. That single jump in solar output covered 61% of all new electricity demand nationwide.</p>



<p>“Solar growth was essential in helping to meet fast‑rising US electricity demand in 2025,” said Dave Jones, chief analyst at Ember. “It generated where it was needed, and – with the surge in batteries – increasingly when it was needed.”</p>



<p>Texas, the Midwest, and the Mid‑Atlantic saw the largest increases in solar generation last year, and they were also the regions where electricity demand rose the fastest. Solar met 81% of demand growth in both Texas and the Midwest, and 33% in the Mid‑Atlantic.</p>	
	



<p>Timing mattered, too. In aggregate, the increase in solar generation met the entire rise in US electricity demand during daytime hours between 10 am and 6 pm Eastern. And as a result of the rapid buildout of battery storage, solar also helped cover some of the demand growth during the evening hours, from 6 pm to 2 am.</p>



<figure><img decoding="async" height="738" width="1024" src="https://electrek.co/wp-content/uploads/sites/3/2026/01/Chart-4.png?w=1024" alt="" srcset="https://electrek.co/wp-content/uploads/sites/3/2026/01/Chart-4.png 1700w, https://electrek.co/wp-content/uploads/sites/3/2026/01/Chart-4.png?resize=150,108 150w, https://electrek.co/wp-content/uploads/sites/3/2026/01/Chart-4.png?resize=300,216 300w, https://electrek.co/wp-content/uploads/sites/3/2026/01/Chart-4.png?resize=768,554 768w, https://electrek.co/wp-content/uploads/sites/3/2026/01/Chart-4.png?resize=1024,738 1024w, https://electrek.co/wp-content/uploads/sites/3/2026/01/Chart-4.png?resize=1536,1108 1536w, https://electrek.co/wp-content/uploads/sites/3/2026/01/Chart-4.png?resize=350,252 350w, https://electrek.co/wp-content/uploads/sites/3/2026/01/Chart-4.png?resize=140,101 140w, https://electrek.co/wp-content/uploads/sites/3/2026/01/Chart-4.png?resize=1387,1000 1387w" sizes="(max-width: 1024px) 100vw, 1024px"></figure>



<p>The adoption of battery storage is turning solar from cheap daytime power into something far more flexible. Over the past six years, California’s utility‑scale solar and battery generation has climbed 58%. Yet, output at the sunniest hour of the day has increased by just 8%, a sign that more energy is being stored and used later, rather than dumped onto the grid all at once.</p>



<p>Most of the new solar generation in 2025 was absorbed by rising electricity demand, allowing solar to scale alongside overall grid growth.</p>



<p>“Solar has the potential to meet all the rise in electricity demand and much more. With electricity demand surging, the case to build solar has never been stronger,” said Jones.</p>



<p><strong>Read more:</strong> <a href="https://electrek.co/2025/12/29/eia-all-net-new-generating-capacity-in-2026-may-be-renewables/">EIA: All net new generating capacity in 2026 may be renewables</a></p>



<figure><a href="https://www.energysage.com/landing/home-solar/p/electrek-rsm-ml/" target="_blank" rel=" noreferrer noopener"><img loading="lazy" decoding="async" width="750" height="150" src="https://electrek.co/wp-content/uploads/sites/3/2026/01/DES-1038_Electrek-Banners_Resiliency-1-5.png" alt="" srcset="https://electrek.co/wp-content/uploads/sites/3/2026/01/DES-1038_Electrek-Banners_Resiliency-1-5.png 750w, https://electrek.co/wp-content/uploads/sites/3/2026/01/DES-1038_Electrek-Banners_Resiliency-1-5.png?resize=150,30 150w, https://electrek.co/wp-content/uploads/sites/3/2026/01/DES-1038_Electrek-Banners_Resiliency-1-5.png?resize=300,60 300w, https://electrek.co/wp-content/uploads/sites/3/2026/01/DES-1038_Electrek-Banners_Resiliency-1-5.png?resize=350,70 350w, https://electrek.co/wp-content/uploads/sites/3/2026/01/DES-1038_Electrek-Banners_Resiliency-1-5.png?resize=140,28 140w" sizes="auto, (max-width: 750px) 100vw, 750px"></a></figure>



<hr>



<p><strong><em>If you’re looking to replace your old HVAC equipment, it’s always a good idea to get quotes from a few installers. To make sure you’re finding a trusted, reliable HVAC installer near you that offers competitive pricing on heat pumps, check out </em></strong><a href="https://info.energysage.com/e3t/Ctc/P+23284/c32B704/JkM2-6qcW6N1vHY6lZ3nbW7LNddd6g7rC6W2_YPFW3hK3pQW76k6KF2FYkctW147FkR4R7z4QVmbwBr13ZMqmW4jKwRn6QxprbVR29c_3ys-vnW7lNNpQ5CtF14W1Dr8-Y2Q-f1-W3m8M6C5XxDqgW8RJh1j9h2p_QVhYpSp1N7MmVN7SVQJPZK4m-W8wSS9H2HTkw1W1mpB0L5C2RDhV8wb2h9bpTWTW653HS93WXMfyN604x9YVs-3vW7p9v435BLbgpW3mPZTG5r2jn5W3qTb0h6C5x_sW7j04z98xzKt1f6C0kDK04"><em>EnergySage</em></a><strong><em>. EnergySage is a free service that makes it easy for you to get a heat pump. They have pre-vetted heat pump installers competing for your business, ensuring you get high quality solutions. Plus, it’s free to use!</em></strong></p>



<p><strong><em>Your personalized heat pump quotes are easy to compare online and you’ll get access to unbiased Energy Advisors to help you every step of the way. Get started </em></strong><a href="https://info.energysage.com/e3t/Ctc/P+23284/c32B704/JkM2-6qcW6N1vHY6lZ3nbW7LNddd6g7rC6W2_YPFW3hK3pQW76k6KF2FYkctW147FkR4R7z4QVmbwBr13ZMqmW4jKwRn6QxprbVR29c_3ys-vnW7lNNpQ5CtF14W1Dr8-Y2Q-f1-W3m8M6C5XxDqgW8RJh1j9h2p_QVhYpSp1N7MmVN7SVQJPZK4m-W8wSS9H2HTkw1W1mpB0L5C2RDhV8wb2h9bpTWTW653HS93WXMfyN604x9YVs-3vW7p9v435BLbgpW3mPZTG5r2jn5W3qTb0h6C5x_sW7j04z98xzKt1f6C0kDK04"><em>here</em></a><strong><em>. – *ad</em></strong></p>
	<p><a target="_blank" rel="nofollow" href="https://google.com/preferences/source?q=https://electrek.co" aria-label="Add Electrek as a preferred source on Google">
			<img decoding="async" src="https://electrek.co/wp-content/themes/ninetofive/dist/images/google-preferred-source-badge-dark.png" alt="Add Electrek as a preferred source on Google">
			<img decoding="async" src="https://electrek.co/wp-content/themes/ninetofive/dist/images/google-preferred-source-badge-light.png" alt="Add Electrek as a preferred source on Google">
		</a>
	</p>
	<p><em>FTC: We use income earning auto affiliate links.</em> <a href="https://electrek.co/about/#affiliate">More.</a></p>				</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[ClickHouse acquires Langfuse (126 pts)]]></title>
            <link>https://langfuse.com/blog/joining-clickhouse</link>
            <guid>46656552</guid>
            <pubDate>Sat, 17 Jan 2026 09:15:45 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://langfuse.com/blog/joining-clickhouse">https://langfuse.com/blog/joining-clickhouse</a>, See on <a href="https://news.ycombinator.com/item?id=46656552">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><article><main><div><p><span>2026/01/16</span></p><p>Our goal continues to be building the best LLM engineering platform</p></div>

<p>ClickHouse has acquired Langfuse.</p>
<p>If you’re reading this as a Langfuse user, your first question is probably: <span>What does this mean for me?</span></p>
<p>Our roadmap stays the same, our goal continues to be building the best LLM engineering platform, and we remain committed to open source and self-hosting. There are no immediate changes to how you use Langfuse and how you can reach out to us.</p>
<p>What <em>does</em> change is our ability to move faster. With ClickHouse behind us, we can invest more deeply into performance, reliability, and our roadmap that helps teams build and improve AI applications in production.</p>
<h2 id="what-stays-the-same">What stays the same<a href="#what-stays-the-same" aria-label="Permalink for this section"></a></h2>
<p>This is the section we would want to read first, too.</p>
<ul>
<li><strong>Langfuse stays open source and self‑hostable.</strong> There are no planned changes to licensing. As you know, we leaned heavily into OSS over the last years.</li>
<li><strong>Langfuse Cloud keeps running as‑is.</strong> Same product, same endpoints, same experience.</li>
<li><strong>Support stays the same.</strong> Same channels, same SLAs for existing customers.</li>
</ul>
<h2 id="what-gets-better-now">What gets better now<a href="#what-gets-better-now" aria-label="Permalink for this section"></a></h2>
<p>Joining Clickhouse compresses years of operational learning into immediate, real customer benefits.</p>
<ul>
<li><strong>More engineering leverage on the hardest parts</strong>. Langfuse is a data‑intensive product. Working closely with the ClickHouse engineering team helps us push performance and reliability.</li>
<li><strong>Faster progress on enhanced enterprise-grade compliance and security</strong>, with the help of Clickhouse’s resources.</li>
<li><strong>Learning from Clickhouse’s customer success and support playbook</strong>. This puts us years ahead and allows us to spend more time on what we really care about: our users.</li>
</ul>
<h2 id="a-quick-look-back">A quick look back<a href="#a-quick-look-back" aria-label="Permalink for this section"></a></h2>

<p>Langfuse started the same way many LLM products start: we were building agents ourselves. And we constantly ran into the same problems.</p>
<p>Building LLM apps is easy to demo and hard to run in production. Debugging is different, quality is non‑deterministic, and the iteration loop is messy. When we did Y Combinator in early 2023, we saw this every week, both in our own projects and in what other founders in our cohort were working on.</p>
<p>So we built a duct tape version of what we wished existed: tracing and evaluation primitives that are <strong>easy to add, easy to self‑host, and actually useful for iterating</strong>.</p>
<p>The very first version was intentionally simple. It ran on <strong>Postgres</strong>, because speed of shipping mattered more than theoretical scaling. That got us to a real product and a real community fast.</p>
<p>Then people actually started to use the product more than we could have imagined.</p>

<p>As adoption grew, Postgres became the bottleneck for the workloads Langfuse needed to support (high‑throughput ingestion + fast analytical reads). With <strong>Langfuse v3</strong>, we switched the core data layer to <strong>ClickHouse</strong> to make Langfuse scale for production workloads, both in Cloud and self‑hosted deployments.</p>

<p><em>And if you like infrastructure deep dives, here’s the <a href="https://langfuse.com/blog/2024-12-langfuse-v3-infrastructure-evolution" target="_blank" rel="noreferrer">v3 migration write‑up</a>.</em></p>
<h2 id="why-join-clickhouse">Why join ClickHouse<a href="#why-join-clickhouse" aria-label="Permalink for this section"></a></h2>
<p>There are a lot of ways this could have gone. We didn’t plan to sell the company. Actually, we had Term Sheets for a great Series A and were looking forward to some days off over Christmas after an intense year.</p>
<p>What changed wasn’t our conviction in Langfuse, it was realizing how much faster we can go together with ClickHouse, while staying true to what makes Langfuse work: open source, self-hosting, and a product that’s built for real production workloads.</p>
<h3 id="a-shared-history-before-the-acquisition">A shared history (before the acquisition)<a href="#a-shared-history-before-the-acquisition" aria-label="Permalink for this section"></a></h3>
<p>This dialogue didn’t start with a term sheet. Because Langfuse runs on ClickHouse, we naturally ended up collaborating early and often.</p>
<ul>
<li>We’ve always been closely in touch with many teams at ClickHouse: sharing feedback with the database team, and using new features to make Langfuse more reliable. For example, compute-compute separation helps us to reduce the risk of noisy-neighbours on Langfuse Cloud.</li>
<li>Langfuse Cloud is a large customer of ClickHouse Cloud.</li>
<li>Teams at ClickHouse use Langfuse to improve their agentic applications.</li>
<li>We invested heavily in ClickHouse-backed self-hosting: documentation, templates, and deployment patterns, and collaborated closely with ClickHouse on improving that experience.</li>
<li>As a result, Langfuse introduced thousands of teams to ClickHouse when upgrading from Langfuse v2 to v3.</li>
<li>We’ve done community meetups together: a ClickHouse meetup at our Berlin office, another one in San Francisco, and an OpenHouse talk in Amsterdam.</li>
</ul>
<p>Langfuse runs on ClickHouse, ClickHouse uses Langfuse to optimize its agentic products, we share lots of customers and OSS deployments; <strong>that gives ClickHouse every incentive to keep Langfuse fast, reliable, and boringly dependable at scale.</strong></p>
<p>So in many ways, we operated like long-term partners. This acquisition is a way to make that partnership permanent — and invest aggressively together.</p>
<p><em>Max shared on how we use ClickHouse to keep product performance ahead of demand at ClickHouse Open House (<a href="https://www.youtube.com/watch?v=NXYQ5odATrM" target="_blank" rel="noreferrer">recording</a>) in Amsterdam.</em></p>

<h3 id="culture-and-engineering-fit">Culture and engineering fit<a href="#culture-and-engineering-fit" aria-label="Permalink for this section"></a></h3>
<p>The first time we met Aaron, Yury, Alexey, Tanya, Ryadh, and Pete in-person ended up in a long lunch in Amsterdam. It became obvious we share a similar view on building great developer tooling, how that drives everything within our companies, and how fast analytics is increasingly foundational for building and optimizing agentic products.</p>
<p>We already knew that ClickHouse is one of the best infrastructure engineering teams in the world. More importantly, the engineering culture feels like an instant match:</p>
<ul>
<li>open-source identity and stewardship</li>
<li>developer-first product instincts</li>
<li>performance and reliability as product features (not afterthoughts)</li>
</ul>
<p>The whole Langfuse team will join ClickHouse to continue building Langfuse. All of these aspects were important to us and we couldn’t be more excited.</p>
<h2 id="what-were-focused-on-next">What we’re focused on next<a href="#what-were-focused-on-next" aria-label="Permalink for this section"></a></h2>
<p>Our north star doesn’t change: <strong>help teams ship useful, reliable agents by closing the loop from production data to better prompts, evaluations, and product decisions.</strong></p>
<p>Concretely, we’re investing in:</p>
<ul>
<li><strong>Production monitoring and analytics</strong> for real agent systems (not just offline evals).</li>
<li><strong>Workflows across tracing, labeling, and experiments</strong> so iteration loops get shorter.</li>
<li><strong>More performance and scale</strong>—especially for large self‑hosted and enterprise deployments.</li>
<li><strong>More polish</strong> (UI/UX, developer experience, and docs) so the product stays simple even as the space gets more complex.</li>
</ul>

<h2 id="thank-you">Thank you<a href="#thank-you" aria-label="Permalink for this section"></a></h2>
<p>Langfuse exists because the community pushed it forward, through GitHub issues, PRs, feedback, and lots of Slack messages and spontaneous calls to dig into a product feature together.</p>
<p>We’re grateful for the trust you’ve put in us. Joining ClickHouse is our way of honoring that trust by putting more resources behind the thing we care about most: building a product you can rely on.</p>
<p>We’re excited for what’s next!<br>
<!-- -->Max, Clemens, and Marc</p>
<hr>
<h2 id="faq">FAQ<a href="#faq" aria-label="Permalink for this section"></a></h2>
<p><strong>Is Langfuse still open source?</strong><br>Yes. No licensing changes planned.</p>
<p><strong>Can I still self‑host Langfuse?</strong><br>Yes. Self‑hosting is a first‑class path.</p>
<p><strong>Does anything change for Langfuse Cloud customers today?</strong><br>No. Same product, same endpoints, same contracts.</p>
<p><strong>Where do I go for support?</strong><br>No changes: <a href="https://langfuse.com/support" target="_blank" rel="noreferrer">https://langfuse.com/support</a></p>
<p><strong>Will the Langfuse team stay on Langfuse?</strong><br>Yes. The team is joining ClickHouse and will keep building Langfuse. Also, we continue <a href="https://langfuse.com/careers">hiring</a> in Berlin and SF.</p>
<h2 id="join-the-discussion">Join the discussion<a href="#join-the-discussion" aria-label="Permalink for this section"></a></h2>
<p>If you have any other questions, let’s discuss together on <a href="https://github.com/orgs/langfuse/discussions/11593" target="_blank" rel="noreferrer">GitHub Discussions</a>.</p>
<p>If you’re an enterprise customer and have additional questions, feel free to reach out to <a href="mailto:enterprise@langfuse.com">enterprise@langfuse.com</a></p></main></article></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[You have three minutes to escape the perpetual underclass – geohot (118 pts)]]></title>
            <link>https://geohot.github.io//blog/jekyll/update/2026/01/17/three-minutes.html</link>
            <guid>46656256</guid>
            <pubDate>Sat, 17 Jan 2026 08:23:44 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://geohot.github.io//blog/jekyll/update/2026/01/17/three-minutes.html">https://geohot.github.io//blog/jekyll/update/2026/01/17/three-minutes.html</a>, See on <a href="https://news.ycombinator.com/item?id=46656256">Hacker News</a></p>
<div id="readability-page-1" class="page"><div aria-label="Content">
        <article itemscope="" itemtype="http://schema.org/BlogPosting">

  

  <div itemprop="articleBody">
    <p>I had a dream last night I went to work at Amazon. Joining the Bezos neofeudal empire. This post is directed at anyone with talent who works at a tech company ushering in this future.</p>

<hr>


<p>Have you thought about how this is going to play out? I understand you may be at a place where you are insecure about money, and that insecurity is what drives you. But why do you think having more money will fix that insecurity?</p>

<p>In the future, when labor is fully marginalized and capital is the only force, you will not be able to afford GPT$$$ (it’s $1B per month), only the billionaires will. GPT$$$ is surely smart enough to separate you from whatever you have, be that with targeting advertising, a scam you fall for, or lobbying your government to take it from you.</p>

<p>A pile of money will buy you nothing in the neofeudal world.</p>

<hr>


<p>Historically, there has been some loyalty to the subjects of a feudal empire because labor had some value. You needed the peasants to grow the grain so you could tax it and take it and have leverage over others by having grain to offer them. When the grain is produced by machines, the peasants are cut out of the loop.</p>

<p>The solution to this is not to accumulate grain, buy shares in a granary, or anything else like that. They will find a way to make whatever you have worthless. Because the feudal world didn’t operate on capitalist principles, and neither will the neofeudal world.</p>

<hr>


<p>If you work at a large company, if you work according to the principles of modern capitalism, where all the fish will be eaten by the bigger fish, and all will be eaten by the sharks, and all the sharks will be eaten by bigger sharks, you are actively bringing about the system that will kill you.</p>

<p><b>Have you considered not participating?</b> If you participate, we all lose. We will either all be in the underclass together or not.</p>

  </div>
</article>

      </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Drone Hacking Part 1: Dumping Firmware and Bruteforcing ECC (103 pts)]]></title>
            <link>https://neodyme.io/en/blog/drone_hacking_part_1/</link>
            <guid>46654749</guid>
            <pubDate>Sat, 17 Jan 2026 02:35:28 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://neodyme.io/en/blog/drone_hacking_part_1/">https://neodyme.io/en/blog/drone_hacking_part_1/</a>, See on <a href="https://news.ycombinator.com/item?id=46654749">Hacker News</a></p>
<div id="readability-page-1" class="page"><div> <h2 id="intro">Intro</h2>
<p>In July 2025, we from Neodyme got together in Munich and did security research on a bunch of IoT devices, ranging from bluetooth headsets, to door locks, to drones. One of these was the Potensic Atom 2. It’s a photo and video drone with a gimbal-stabilized 4K camera and a remote control that you hook up to your own smartphone and the proprietary app. If you’ve ever flown a DJI Mini 4K, this drone will look very familiar to you.</p>
<center><figure>
						<img src="https://neodyme.io/blog/drone_hacking_part_1/atom2.png" alt="Potensic Atom 2">
						<figcaption>
							<p>
								Potensic Atom 2
							</p>
						</figcaption>
					</figure>
					</center>
<p>This post is part of a <strong>two-part series</strong> that will cover how we disassembled the drone and dumped the firmware from the NAND chip and how we analyzed the drone’s firmware, app, and remote control to find some backdoors and vulnerabilities.</p>
<h3 id="goal-dumping-the-firmware">Goal: Dumping the Firmware</h3>
<p>One of the most important pieces of information you can acquire when setting up to hack a device is its firmware. If you want to reverse engineer the software that’s running on the drone and find vulnerabilities in that, then you need a copy of it in the first place.</p>
<p>Now there are a couple of ways to go about that, some are less intrusive and some are more effective.</p>
<p>You might get lucky and be able to just <strong>download the firmware</strong> as a firmware update from the manufacturer’s website. However, those update sites are often not publicly documented and can be locked behind authorization checks or encrypted. Encrypted firmwares can still be useful - you “just” need to reverse engineer the on-device decryption process. For the Atom 2, downloading the firmware updates required having a valid drone and remote control serial number <em>and</em> the firmware update was also encrypted. Without having the decryption logic, we put this approach on ice during our initial research.</p>
<p>Another really comfortable approach is to use exposed <strong>debug interfaces</strong> like JTAG or UART. However, those are often undocumented, unlabeled, or entirely removed for public versions. We didn’t find any on the Atom 2.</p>
<p>What we can always do, though not necessarily always successful, is solder off the entire NAND chip and <strong>dump the firmware</strong> byte by byte. This has the risk of breaking the NAND chip and/or the rest of the board if you’re not careful. Also, some devices, like modern smart phones, encrypt their persistent storage with key material stored in, e.g., the TPM. If that is the case, then simply soldering off the NAND chip will leave you with unusable encrypted data. Fortunately, the Atom 2’s NAND contents are not encrypted, as we find out later.</p>
<h2 id="dumping-the-nand-chip">Dumping the NAND Chip</h2>
<p>Dumping a NAND chip generally always follows the same pattern:</p>
<ol>
<li>Identifying the NAND Chip</li>
<li>Removing it from the board</li>
<li>Identifying the data pins and communication protocol of the NAND chip</li>
<li>Connecting the NAND chip to some kind of reading device</li>
<li>Reading the NAND content</li>
<li>Reassembling the read contents into a working firmware - usually containing one or more file systems</li>
</ol>
<h3 id="identifying-the-nand-chip">Identifying the NAND Chip</h3>
<p>The Atom 2 has multiple boards:</p>
<center><figure>
						<img src="https://neodyme.io/blog/drone_hacking_part_1/drone-top-side.png" alt="Top side of the drone">
						<figcaption>
							<p>
								Top side of the drone
							</p>
						</figcaption>
					</figure>
					<figure>
						<img src="https://neodyme.io/blog/drone_hacking_part_1/drone-bottom-side.png" alt="Bottom side of the drone, with the mainboard and some of its RF shields already removed">
						<figcaption>
							<p>
								Bottom side of the drone, with the mainboard and some of its RF shields already removed
							</p>
						</figcaption>
					</figure>
					</center>
<p>We are mainly interested in the <strong>main board</strong> because that’s where the NAND flash is going to be. The main board had several metal RF shields that we have already pried off or cut through on the photos.</p>
<p>We can identify most of these chips through their markings. Note that while we’re mainly interested in the NAND chip, knowing the others can help with recognizing things during reversing later on. Roughly knowing which SoC we were working with was crucial, as you will see in later sections of this blog post.</p>
<p><em>(Note that the markings below might not match the photos completely. We had multiple drones. The markings are mostly from the first drone and the photos are mostly of the second drone.)</em></p>
<h4 id="top-side">Top-side</h4>
<center><figure>
						<img src="https://neodyme.io/blog/drone_hacking_part_1/mainboard-top-side.png" alt="Top side of the mainboard, with all RF shields removed">
						<figcaption>
							<p>
								Top side of the mainboard, with all RF shields removed
							</p>
						</figcaption>
					</figure>
					</center>
<p><strong>SoC (System on a Chip, aka “the main thingy”)</strong></p>
<ul>
<li>Markings: 23AP10 VTQMSQKJYJ 4978-CN B3</li>
<li>We didn’t find an exact match, but <a href="https://blog.csdn.net/szhorsway/article/details/144353108">this site</a> references the 21AP10.
<ul>
<li>The page title is <code>21AP10 SS928 平替SD3403V100 海思 SOC芯片</code></li>
<li><code>21AP10 SS928 平替</code> =&gt; <code>21AP10 SS928 Drop-In Replacement</code></li>
<li><code>SD3403V100 海思 SOC芯片</code> =&gt; <code>HiSilicon SD3403V100 SOC Chip</code></li>
<li>That is a mobile camera SoC.</li>
</ul>
</li>
<li>It makes sense that this is the SoC because it is close to both external RAM chips and the NAND flash.</li>
<li>In <a href="https://www.reddit.com/r/Potensic/comments/1diwuxo/potensic_atom_se_teardown_and_discussion/">this teardown of a previous Atom model</a>, the device had a <code>HiSilicon Hi 3559 camera MCU</code></li>
<li>We found a data sheet for the HiSilicon Hi3519 V100.
<ul>
<li>Close enough for now.</li>
</ul>
</li>
</ul>
<p><strong>RAM</strong></p>
<ul>
<li>Markings: SEC340 K4A8G16 5WC BCTD G2F9190AC</li>
<li>Data sheet can be found on the internet.</li>
</ul>
<p><strong>ARM Cortex-M4</strong></p>
<ul>
<li>Markings: GD32F470 VGH6 BUMK618 AL2451 GigaDevice ARM</li>
<li>Data sheet can be found on the internet.</li>
<li>Might be SD-card related since the SD card slot is on the other side.</li>
</ul>
<p><strong>Unknown Chips</strong></p>
<ul>
<li>Markings: V2 2441TM4N190.00
<ul>
<li>The name <code>2441TM</code> appears in some WizSense surveillance cameras</li>
<li>Not sure if related</li>
</ul>
</li>
<li>2 chips with markings: 8285HE 426656 CS2441</li>
</ul>
<h4 id="bottom-side">Bottom Side</h4>
<center><figure>
						<img src="https://neodyme.io/blog/drone_hacking_part_1/mainboard-bottom-side.png" alt="Bottom side of the mainboard, with all RF shields removed">
						<figcaption>
							<p>
								Bottom side of the mainboard, with all RF shields removed
							</p>
						</figcaption>
					</figure>
					</center>
<p><strong>NAND flash</strong></p>
<ul>
<li>Markings: MXIC X243662 MX35UF4GE4AD-241 5P231800A1</li>
<li>Data sheet can be found on the internet.</li>
</ul>
<p><strong>RAM</strong></p>
<ul>
<li>Markings: SEC407 K4A8G16 5WC BCTD G2K43304C</li>
<li>Same as on top side</li>
</ul>
<p><strong>ARM Cortex-M4</strong></p>
<ul>
<li>Markings: F460JEUA P8VR4400 2416021</li>
<li>Not sure what it’s used for.</li>
<li>A data sheet for the HC32<strong>F460JEUA</strong>-QFN48TR (looks close enough?) can be found on the internet.</li>
</ul>
<p><strong>WLAN + Bluetooth</strong></p>
<ul>
<li>RTL8821CS</li>
<li>Data sheet can be found on the internet.</li>
</ul>
<h3 id="removing-the-nand-chip-from-the-board">Removing the NAND Chip from the board</h3>
<p>Now that we have identified the NAND chip, we fasten the board and tape off the remaining components with heat-shielding tape.</p>
<center><figure>
						<img src="https://neodyme.io/blog/drone_hacking_part_1/drone-and-mainboard.png" alt="Drone and mainboard, partially taped off with heat-shielding tape. The mainboard was still connected via the flex cable while we were searching for debug pins.">
						<figcaption>
							<p>
								Drone and mainboard, partially taped off with heat-shielding tape. The mainboard was still connected via the flex cable while we were searching for debug pins.
							</p>
						</figcaption>
					</figure>
					</center>
<p>Usually getting the chip off of the board is just a matter of using hot air station and flux. However, you can see on the photos that the chip is actually glued to the main board with what is probably epoxy. That’s a thing you can do if you want to secure the chips more securely and not depend on the solder joints to hold your chip in place (and risk breaking them). Or you can do that <em>just</em> to the NAND chip to make it harder for researcher to pry off your NAND chip and dump your firmware.</p>
<p>Anyway, a few cuts with a sharp knife, some heat and a <em>generous</em> amount of flux later, the little bugger came off in one piece.</p>
<p><em>(And with it, a couple of extremely tiny resistors that I knocked off with my pliers and promptly lost. This main board is now broken. But don’t worry, <a href="https://youtu.be/D_qFWoa_HR4&amp;t=293">through the magic of buying <del>two</del> three of them</a>, we can still fly the drone.)</em></p>
<center><figure>
						<img src="https://neodyme.io/blog/drone_hacking_part_1/nand-chip.png" alt="As you can see, this chip has a large ground pad in the middle. This allows the chip to transfer a lot of heat to the ground plane in the mainboard, which makes soldering it off a little harder.">
						<figcaption>
							<p>
								As you can see, this chip has a large ground pad in the middle. This allows the chip to transfer a lot of heat to the ground plane in the mainboard, which makes soldering it off a little harder.
							</p>
						</figcaption>
					</figure>
					</center>
<h3 id="identifying-the-data-pins-and-communication-protocol-of-the-nand-chip">Identifying the data pins and communication protocol of the NAND chip</h3>
<p>According to the data sheet of the MX35UF4GE4AD NAND chip, the flash chip can either come in a 24-pin BGA package or an 8-pin WSON package, which we have here. A quick look at the pin descriptions tell us that the NAND chip is communicating via SPI.</p>













































<table><thead><tr><th>Pin Symbol</th><th>Pin Description</th></tr></thead><tbody><tr><td>CS#</td><td>Chip Select</td></tr><tr><td>SI</td><td>Serial Data Input</td></tr><tr><td>SO</td><td>Serial Data Output</td></tr><tr><td>SCLK</td><td>Clock Input</td></tr><tr><td>WP#</td><td>Write protection</td></tr><tr><td>HOLD#</td><td>Hold</td></tr><tr><td>VCC</td><td>Power Supply (1.8 V)</td></tr><tr><td>GND</td><td>Ground</td></tr><tr><td>DNU</td><td>Do Not Use</td></tr></tbody></table>
<p>Well, let’s solder tiny copper cables to all of those pins and drown them in a bit of hot glue to stop them from breaking off.</p>
<center><p><img src="https://neodyme.io/blog/drone_hacking_part_1/nand-chip-wires.jpg" alt="nand chip with wires"></p></center>
<p>Note that you <em>can</em> get a proper socket for 8-WSON chips into which you simply clamp the chip and which exposes easy-to-work-with breakout pins. None of our sockets we brought fit though, so we just did it the old-school way.</p>
<h3 id="connecting-the-nand-chip-to-some-kind-of-reading-device">Connecting the NAND chip to some kind of reading device</h3>
<p>SPI is pretty easy to work with. We have two main data lines called <strong>SI</strong> and <strong>SO</strong> (Serial In/Out). You will also find them under the names “MOSI” and “MISO” (Master Out Slave In / Master In Slave Out). As the names of these suggest, SPI follows a master-slave architecture. The microcontroller drives the communication and the peripheral device reacts.</p>
<p>Fortunately, we are simulating the microcontroller-side of the communication, which means that we have a large amount of control. Specifically, we control the clock (<strong>SCLK</strong>). Sometimes it is hard to talk to embedded hardware because of the speed at which they operate. With SPI, however, we can slow down the clock to however fast we want the devices to talk.</p>
<p>Since SPI is a bus protocol, more than one slave device can be hooked up to a master device on the same data lines. To avoid collisions, each device is also assigned its own “Chip Select” line (<strong>CS</strong>). When the master device wants to talk to a specific slave device, it pulls the corresponding CS line <em>low</em>. Devices that have their CS line <em>high</em> won’t react at all.</p>
<p>Obviously there are fancy devices on the market that will make dumping a NAND chip via SPI pretty easy and straightforward. Problem is, we couldn’t get <em>any</em> of them to work. They either didn’t fit (physically), were too fast or failed for some other strange reason we didn’t understand. So we wrote <strong>our own dump script onto an ESP32</strong> using the SPI commands in the data sheet and let it forward the data to our computer via the USB console.</p>
<p>Doing that, we ended up with a 544 MiB dump, containing 131,072 pages of 4096+256 bytes. <em>(We will come back to that “+256” later on.)</em></p>
<p>Let’s dig into what this the flash dump contains with <code>binwalk</code>:</p>
<center><figure>
						<img src="https://neodyme.io/blog/drone_hacking_part_1/dump-01-01.png" alt="Binwalk output of the raw NAND dump">
						<figcaption>
							<p>
								Binwalk output of the raw NAND dump
							</p>
						</figcaption>
					</figure>
					</center>
<p>Sweet! We get a working ASCII copyright string, so <em>something</em> must have worked. And at the end of the image we have a bunch of UBIFS images. That’s probably where all the juicy files are!</p>
<p>Let’s extract them with <code>dd</code> and take a look inside with <a href="https://github.com/onekey-sec/ubi_reader">ubi_reader</a>:</p>
<center><figure>
						<img src="https://neodyme.io/blog/drone_hacking_part_1/dump-01-02.png" alt="Extracting the the first UBI image from the NAND flash dump via dd. Note that the offsets don’t match the binwalk output directly because we are using a bigger blocksize to speed this up (bs=1024).">
						<figcaption>
							<p>
								Extracting the the first UBI image from the NAND flash dump via dd. Note that the offsets don’t match the binwalk output directly because we are using a bigger blocksize to speed this up (bs=1024).
							</p>
						</figcaption>
					</figure>
					<figure>
						<img src="https://neodyme.io/blog/drone_hacking_part_1/dump-01-03.png" alt="ubi_reader finds three file systems but fails to extract any files from them before crashing">
						<figcaption>
							<p>
								ubi_reader finds three file systems but fails to extract any files from them before crashing
							</p>
						</figcaption>
					</figure>
					</center>
<p>Hmm. That doesn’t work. Spoiler: The extracted image is broken.</p>
<p>Now if you’ve ever done something as hacky as this, you will know about a pesky little phenomenon that happens when you just solder copper wires onto a chip, stick that onto the ports of an ESP32 and do SPI communication - which has <strong>no built-in integrity checks</strong>.</p>
<h4 id="random-bit-flips">Random Bit Flips</h4>
<p>These are three dumps taken from the same NAND chip:</p>
<center><figure>
						<img src="https://neodyme.io/blog/drone_hacking_part_1/md5sums.png" alt="The MD5 hashes of the three separate dumps from the same NAND chip are different, indicating that our reading process introduces bit errors.">
						<figcaption>
							<p>
								The MD5 hashes of the three separate dumps from the same NAND chip are different, indicating that our reading process introduces bit errors.
							</p>
						</figcaption>
					</figure>
					</center>
<p>If you read 4 MiB of data from the chip, not all of the bits you receive are correct. And without any additional data, you have little way of knowing which ones are correct and which are not. If you are lucky, then the dumped data will still “work”, i.e., the contained file system will mount and you can browse files, but futher down the line you will have no way of knowing whether that weird function you’re reversing is actually weird or just the product of random bit flips messing up the CPU instructions.</p>
<p>A relatively simple yet time-consuming way to get around this: Read the flash <em>often</em> (at least three times) and hold a majority vote for every bit. Since the bit flips are random and not too prevalent, they are less likely to hit the same bit twice.</p>
<p>Hot tip: If you’re gonna work with python, use numpy and work on arrays and  memory-mapped files. Otherwise this can take a lot of time and a lot of RAM - even for a 512 MiB flash dump.</p>
<div><figure><pre data-language="python"><code><div><p><span>import</span><span> numpy </span><span>as</span><span> np</span></p></div><div><p><span>import</span><span> sys</span></p></div><div><p><span>if</span><span> </span><span>len</span><span>(sys.argv) </span><span>!=</span><span> </span><span>4</span><span>:</span></p></div><div><p><span>    </span><span>print</span><span>(</span><span>f</span><span>"Usage: </span><span>{</span><span>sys.argv[</span><span>0</span><span>]</span><span>}</span><span> dump1 dump2 dump3"</span><span>, </span><span>file</span><span>=</span><span>sys.stderr)</span></p></div><div><p><span><span>    </span></span><span>sys.exit(</span><span>1</span><span>)</span></p></div><div><p><span>dump_filenames </span><span>=</span><span> sys.argv[</span><span>1</span><span>:]</span></p></div><div><p><span>a, b, c </span><span>=</span><span> [np.memmap(f, </span><span>dtype</span><span>=</span><span>np.uint8, </span><span>mode</span><span>=</span><span>"r"</span><span>) </span><span>for</span><span> f </span><span>in</span><span> dump_filenames]</span></p></div><div><p><span>majority </span><span>=</span><span> np.memmap(</span></p></div><div><p><span>    </span><span>"dump-majority-voting.bin"</span><span>,</span></p></div><div><p><span>    </span><span>dtype</span><span>=</span><span>np.uint8,</span></p></div><div><p><span>    </span><span>mode</span><span>=</span><span>"write"</span><span>,</span></p></div><div><p><span>    </span><span>shape</span><span>=</span><span>(a.size,),</span></p></div><div><p><span>)</span></p></div><div><p><span># quick three-way majority voting</span></p></div><div><p><span>majority[:] </span><span>=</span><span> np.where(</span></p></div><div><p><span><span>    </span></span><span>(a </span><span>==</span><span> b) </span><span>|</span><span> (a </span><span>==</span><span> c) </span><span>|</span><span> (b </span><span>!=</span><span> c),</span></p></div><div><p><span><span>    </span></span><span>a,</span></p></div><div><p><span><span>    </span></span><span>b,</span></p></div><div><p><span>)</span></p></div></code></pre></figure></div>
<center><figure>
						<img src="https://neodyme.io/blog/drone_hacking_part_1/majority-voting.png" alt="After majority-voting, we get a different MD5 sum. This one remains stable even when pulling more samples.">
						<figcaption>
							<p>
								After majority-voting, we get a different MD5 sum. This one remains stable even when pulling more samples.
							</p>
						</figcaption>
					</figure>
					</center>
<p>But isn’t there a better way? Yes, there is. And - btw - even with completely correct majority voting, the flash content is still broken. But we’ll get to that.</p>
<p>Trying to work with the majority-voted dump:</p>
<center><figure>
						<img src="https://neodyme.io/blog/drone_hacking_part_1/dump-02-01.png" alt="Binwalk output on the majority-voted NAND dump">
						<figcaption>
							<p>
								Binwalk output on the majority-voted NAND dump
							</p>
						</figcaption>
					</figure>
					<figure>
						<img src="https://neodyme.io/blog/drone_hacking_part_1/dump-02-02.png" alt="Trying to parse the UBI image with ubi_reader still fails - this time even before finding any file systems (wtf?)">
						<figcaption>
							<p>
								Trying to parse the UBI image with ubi_reader still fails - this time even before finding any file systems (wtf?)
							</p>
						</figcaption>
					</figure>
					</center>
<h2 id="out-of-band-bytes-and-ecc-troubles">Out-of-band bytes and ECC troubles</h2>
<p>One thing we have have silently brushed aside for now: The NAND chip distinguishes between “user data” and “extra data”. In our dump above, we have naively concatenated it all together and assumed that a page size of 4096+256 bytes somehow makes sense. Of course, it doesn’t.</p>
<p>Also, this majority voting hack is obviously not the “correct” way to work with a NAND chip. And even the proper SoC mounted on the proper mainboard can’t run a system off of a flash chip that gives it random bit flips that it can’t detect or recover from. The problem is that NAND is just inherently imperfect storage. Majority voting only corrects for transmission errors during dumping, but does nothing to bit errors that are stored on the device! Bits on the storage might decay over time, or the CPU might also have some transmission errors during writing.</p>
<p>Of course this problem has been very well known for a long time, so manufacturers always include some extra space next to user data for “error correction”. These extra bytes are called “out-of-band” bytes. And they are used to implement <strong>Error Correction Codes</strong> (ECC).</p>
<h3 id="ecc-according-to-the-nand-chip-data-sheet">ECC according to the NAND chip data sheet</h3>
<p>The flash chip implements its own error correction algorithm by reserving some of the space for ECC. It is split into</p>
<ul>
<li>2048 blocks of</li>
<li>64 pages of</li>
<li>4096 user data bytes + 256 “extra” bytes (aka out-of-band bytes)</li>
<li>=&gt; 512 MiB of user data (the chip is 4 Gb, not 4 GB)</li>
<li>=&gt; 32 MiB of extra data</li>
</ul>
<p>If the chip-internal ECC is enabled, some of those extra bytes are used for ECC.</p>
<p>At this point, we naively assumed that each page would be</p>
<ul>
<li>4096 bytes of user data followed by</li>
<li>256 (or less?) bytes of ECC covering the previous 4096 bytes.</li>
</ul>
<p>However, we quickly found out that the sequences classified as “extra data” contain readable strings! That definitely suggests that this isn’t ECC data.</p>
<center><figure>
						<img src="https://neodyme.io/blog/drone_hacking_part_1/hexdump-01.png" alt="In-page addresses at and above 0x1000 (= 4096) are extra data">
						<figcaption>
							<p>
								In-page addresses at and above 0x1000 (= 4096) are extra data
							</p>
						</figcaption>
					</figure>
					</center>
<p>You can also see that there are parts within the user data where strings are suddenly cut off. This suggests that the ECC layout we assumed was wrong. It took us quite a while to figure out what exactly we missed.</p>
<center><figure>
						<img src="https://neodyme.io/blog/drone_hacking_part_1/hexdump-02.png" alt="Text “ignoring the CPU number” cut off at 0x824">
						<figcaption>
							<p>
								Text “ignoring the CPU number” cut off at 0x824
							</p>
						</figcaption>
					</figure>
					<figure>
						<img src="https://neodyme.io/blog/drone_hacking_part_1/hexdump-03.png" alt="Text “IRQ_WAKE_THREAD” cut off at 0x824">
						<figcaption>
							<p>
								Text “IRQ_WAKE_THREAD” cut off at 0x824
							</p>
						</figcaption>
					</figure>
					</center>
<h4 id="entropy-analysis">Entropy Analysis</h4>
<p>Turns out, the ECC layout is not just 4096 bytes of user data followed by 256 bytes of ECC. If we put all pages next to each other and then calculate the entropy over each n-th byte of a page, we will find that there are multiple sections with high entropy:</p>
<center><p><img src="https://neodyme.io/blog/drone_hacking_part_1/entropy.png" alt=""></p></center>
<p>Why are we looking at entropy? Well, because we expect the user data to have  ASCII text (low entropy) every now and then and the ECC data to be mostly random-looking byte values (high entropy).</p>
<p>The graph we’re seeing up here suggests that there are sections of <em>roughly</em> 1 KiB of user data, followed by 28 bytes of ECC data. Specifically,</p>
<ul>
<li>1028 B user data + 28 B ECC</li>
<li>1028 B user data + 28 B ECC</li>
<li>1028 B user data + 28 B ECC</li>
<li>1014 B user data + 28 B ECC</li>
<li>142 B unused</li>
</ul>
<p>Why these stranges values? And which ECC algorithm is that? We <em>can</em> choose to ignore that and just extract the user data sections and stitch them together. I won’t spam you with more <code>binwalk</code> and <code>dd</code> screenshots and just <em>tell</em> you that that also won’t result in a readable UBIFS image. Fortunately, we find an explanation for these values in the next section!</p>
<h3 id="ecc-according-to-the-soc-data-sheet">ECC according to the SoC data sheet</h3>
<p>At this point, we had already spent a lot of time fiddling with unstable reading setups and ECC layouts. And then we found that some further digging into the <em>right</em> documentation could have saved us a lot of time during our research. Because the SoC <em>also</em> does ECC. Not just the NAND chip. In fact, we can ignore the NAND chips ECC feature completely.</p>
<p>The SoC’s data sheet lists several possible ECC layouts. One of them is the following:</p>
<center><p><img src="https://neodyme.io/blog/drone_hacking_part_1/layout-01.png" alt=""></p></center>
<p>Well, that fits our findings perfectly, plus a BB (“bad blocks”) and CTRL (some kind of control bytes?) area that we didn’t identify before.</p>
<p>Using this diagram, we can cut out all the ECC, BB and CTRL sections and reconstruct the pure 512 MiB user data flash content.</p>
<div><figure><pre data-language="python"><code><div><p><span>import</span><span> sys</span></p></div><div><p><span>import</span><span> numpy </span><span>as</span><span> np</span></p></div><div><p><span>if</span><span> </span><span>len</span><span>(sys.argv) </span><span>!=</span><span> </span><span>2</span><span>:</span></p></div><div><p><span>    </span><span>print</span><span>(</span><span>f</span><span>"Usage: </span><span>{</span><span>sys.argv[</span><span>0</span><span>]</span><span>}</span><span> dump"</span><span>, </span><span>file</span><span>=</span><span>sys.stderr)</span></p></div><div><p><span><span>    </span></span><span>sys.exit(</span><span>1</span><span>)</span></p></div><div><p><span>dump_filename </span><span>=</span><span> sys.argv[</span><span>1</span><span>]</span></p></div><div><p><span>PAGE_SIZE_WITH_EXTRA</span><span> </span><span>=</span><span> </span><span>4352</span></p></div><div><p><span>PAGE_SIZE_USER_DATA</span><span> </span><span>=</span><span> </span><span>4096</span></p></div><div><p><span>user_data_slices </span><span>=</span><span> [</span></p></div><div><p><span>    </span><span>slice</span><span>(</span><span>0</span><span>, </span><span>1028</span><span>),</span></p></div><div><p><span>    </span><span>slice</span><span>(</span><span>1056</span><span>, </span><span>2084</span><span>),</span></p></div><div><p><span>    </span><span>slice</span><span>(</span><span>2112</span><span>, </span><span>3140</span><span>),</span></p></div><div><p><span>    </span><span>slice</span><span>(</span><span>3168</span><span>, </span><span>4096</span><span>),</span></p></div><div><p><span>    </span><span>slice</span><span>(</span><span>4098</span><span>, </span><span>4182</span><span>),</span></p></div><div><p><span>]</span></p></div><div><p><span>dump </span><span>=</span><span> np.memmap(dump_filename, </span><span>dtype</span><span>=</span><span>np.uint8, </span><span>mode</span><span>=</span><span>"r"</span><span>)</span></p></div><div><p><span>num_pages </span><span>=</span><span> dump.size </span><span>//</span><span> </span><span>PAGE_SIZE_WITH_EXTRA</span></p></div><div><p><span>dump_pages </span><span>=</span><span> dump.reshape(num_pages, </span><span>PAGE_SIZE_WITH_EXTRA</span><span>)</span></p></div><div><p><span>out </span><span>=</span><span> np.memmap(</span></p></div><div><p><span>    </span><span>"dump-user-data.bin"</span><span>,</span></p></div><div><p><span>    </span><span>dtype</span><span>=</span><span>np.uint8,</span></p></div><div><p><span>    </span><span>mode</span><span>=</span><span>"write"</span><span>,</span></p></div><div><p><span>    </span><span>shape</span><span>=</span><span>(num_pages, </span><span>PAGE_SIZE_USER_DATA</span><span>),</span></p></div><div><p><span>)</span></p></div><div><p><span>out_pages </span><span>=</span><span> out.reshape(num_pages, </span><span>PAGE_SIZE_USER_DATA</span><span>)</span></p></div><div><p><span>offset </span><span>=</span><span> </span><span>0</span></p></div><div><p><span>for</span><span> s </span><span>in</span><span> user_data_slices:</span></p></div><div><p><span><span>    </span></span><span>s_len </span><span>=</span><span> s.stop </span><span>-</span><span> s.start</span></p></div><div><p><span>    </span><span># note: this is an array operation,</span></p></div><div><p><span>    </span><span># so we only need to do this once per slice</span></p></div><div><p><span><span>    </span></span><span>out_pages[:, offset : offset </span><span>+</span><span> s_len] </span><span>=</span><span> dump_pages[:, s]</span></p></div><div><p><span><span>    </span></span><span>offset </span><span>+=</span><span> s_len</span></p></div></code></pre></figure></div>
<center><figure>
						<img src="https://neodyme.io/blog/drone_hacking_part_1/dump-03-01.png" alt="Binwalk output of the correctly defragmented user data section">
						<figcaption>
							<p>
								Binwalk output of the correctly defragmented user data section
							</p>
						</figcaption>
					</figure>
					<figure>
						<img src="https://neodyme.io/blog/drone_hacking_part_1/dump-03-02.png" alt="ubi_reader still fails to extract any files - but at least we are seeing one of the file systems again">
						<figcaption>
							<p>
								ubi_reader still fails to extract any files - but at least we are seeing one of the file systems again
							</p>
						</figcaption>
					</figure>
					</center>
<p>Heyyy, look at that! We managed to extract a file system again - albeit with some error remaining. Let’s see what’s on it:</p>
<center><figure>
						<img src="https://neodyme.io/blog/drone_hacking_part_1/dump-03-03.png" alt="Empty extracted filesystem…">
						<figcaption>
							<p>
								Empty extracted filesystem…
							</p>
						</figcaption>
					</figure>
					</center>
<p>Hmm. Damn. The UBIFS image is now at least <em>somewhat</em> syntactically correct. But it is still broken enough to not have any files. Why could that be?
Well, we are looking at <em>exactly</em> what the SoC would see after reading the data from the NAND chip. <em>Plus</em> that we have done majority voting on the bytes - so our version is even better than what the SoC would see.</p>
<p><strong>But</strong>, there is no guarantee that there aren’t any random bit flips <em>on the NAND chip</em>, i.e., that random bit flipping happened during <em>writing</em>, desoldering or anytime between that!
So, there seems to no way around actually implementing the ECC algorithm and correcting the bit flips on the flash dump. Problem is: <strong>What kind of ECC algorithm is the SoC running?</strong> Unfortunately, the datasheet is silent here, so we had to find out on our own.</p>
<h3 id="a-short-primer-on-reverse-engineering-ecc-algorithms">A short primer on reverse engineering ECC algorithms</h3>
<p>Typical ECC algorithms on NAND chips use <a href="https://en.wikipedia.org/wiki/BCH_code">BCH codes</a>, which are parametrized by the following properties:</p>
<ol>
<li>The amount of parity bits.</li>
<li>The correction capacity <code>t</code>, i.e., how many simultaneous bit flips may appear in the same data block before the block is “too broken” and the ECC algorithm fails.</li>
<li>The primitive polynomial used in the equation. If you don’t know what this is, just think of it as an integer parameter for now.</li>
<li>Whether and how the data is transformed <em>before</em> the parity bits are calculated.</li>
<li>Whether and how the parity bits are transformed <em>after</em> they are calculated.</li>
</ol>
<p>We can deduce (1) and (2) from our flash dump. For (3), (4), and (5) we have to either find the code of the SoC (if it is implement in software at all) and reverse engineer the ECC algorithm - or just bruteforce them.</p>
<h4 id="amount-of-parity-bits">Amount of parity bits</h4>
<p>As we have seen in the SoC’s data sheet, we have 112 byte of ECC / parity bits. However, the fragmented layout on the flash suggests that we actually have 4 ECC groups of 28 byte, each covering a different part of the user data. Note that this is an educated guess and does not have to be true. If we’re not getting anywhere, we should consider dropping this assumption later on. But spoiler: We’re right about this.</p>
<p>This means that we have <strong>224 parity bits</strong> (= 28 bytes).</p>
<h4 id="correction-capacity">Correction capacity</h4>
<p>This part we can just calculate if we make one very realistic assumption. We have 1028 bytes of user data, which is 8224 bits. If we want to represent these 8224 bits as a binary polynomial, we need at least degree 14:</p>
<p><code>2^13 =  8192</code> &lt; - Too small
<code>2^14 = 16384</code> &lt; - Fits!</p>
<p>This means our primitive polynomial needs to be at least degree 14 (<code>m &gt;= 14</code>).</p>
<p>The correction capacity is determined by the degree <code>m</code> and the amount of parity bits. The more parity bits we have in relation to <code>m</code>, the higher our correction capacity <code>t</code>:</p>
<p><code>t = parity_bits / m</code></p>
<p>Now given that <code>parity_bits</code> is fixed at 224 and assuming that the engineers chose <code>t</code> to be maximal, we conclude that <code>m = 14</code> and</p>
<p><code>t = 224 / 14 = 16</code></p>
<p>meaning that we can correct for up to 16 bit flips in the covered user data chunk. Anything more than that and the chunk is lost.</p>
<p><code>t = 16</code> also fits the description of the ECC section in the SoC’s data sheet: “16-Bit/1KB Error Correction Performance” (see our diagram above). So we are pretty certain that this assumption is correct.</p>
<h4 id="primitive-polynomial">Primitive polynomial</h4>
<p>We don’t know that and we will have to bruteforce it. Given that it is a <em>binary</em> polynomial, it is usually represented as a bit vector or simply as an integer. Given that <code>m = 14</code> we already know that our polynomial must have its 14th bit set and that the 14th bit is the highest bit that is set:</p>
<p><code>2^14 &lt;= prim_poly &lt; 2^15</code></p>
<p>which is well within bruteforcing range.</p>
<h4 id="pre-encode-and-post-encode-transformations">Pre-encode and post-encode transformations</h4>
<p>There are a few transformations that are commonly applied to either the user data <em>before</em> calculating the parity bits (“encoding”) or applied to the parity bits <em>after</em> calculating them. Examples include</p>
<ul>
<li>reverse bit order</li>
<li>reverse byte order</li>
<li>swap nibbles</li>
<li>invert</li>
</ul>
<p>Why you ask? Well, one of these combinations for example is very useful for NAND storage devices. You see, when NAND pages are erased and then read, their values are all <code>0xFF</code>. Problem is, a page full of <code>0xFF</code> will have</p>
<ul>
<li>user data = <code>0xFFFF...</code></li>
<li>ECC = <code>0xFFFF...</code></li>
</ul>
<p>and that is <em>not</em> a valid parity, meaning a cleanly erased page will be read as containing a lot of errors. That is because</p>
<p><code>parity(0xFF...) != 0xFF...</code></p>
<p>But we can pull a trick to make this work: Before encoding, invert the user data. And after encoding, invert the parity bits:</p>
<div><figure><pre data-language="plaintext"><code><div><p><span>user_data            = 0xFF...</span></p></div><div><p><span>inverted_user_data   = 0x00...</span></p></div><div><p><span>parity_bits          = parity(inverted_user_data)</span></p></div><div><p><span><span>                     </span></span><span>= parity(0x00...)</span></p></div><div><p><span><span>                     </span></span><span>= 0x00...</span></p></div><div><p><span>inverted_parity_bits = 0xFF...</span></p></div></code></pre></figure></div>
<p>Notice that the parity of an all-zero page <em>is</em> all-zero:</p>
<p><code>parity(0x00...) != 0x00...</code></p>
<p>So by implementing our ECC algorithm with these two inversions, we make a freshly erased page (<code>0xFF...</code>) have a valid parity (<code>0xFF...</code>) and the SoC’s error correction won’t need special handling for erased NAND pages.</p>
<p>Okay, back to the actual algorithm at hand here. How do we know that these two inversions are what the engineers actually chose? We don’t! We just try all these different transformations and see if one of them works. The amount of possible combinations of these 4 transformations is quite low and easily bruteforcable.</p>
<h3 id="brute-forcing-ecc-parameters">Brute-forcing ECC parameters</h3>
<p>In summary, to test our guessed parameters, we need a user data section without errors, generate its ECC and check if it matches the ECC that we read off of the NAND chip. Our bruteforce script thus has to do the following:</p>
<ol>
<li>Find a “good” user data section with no bit flips and the corresponding ECC section.</li>
<li>Iterate through all possible transformations.</li>
<li>Iterate through all possible primitive polynomials of degree 14</li>
<li>For each iteration, generate the ECC of the userdata section. If it matches the existing ECC, we have found the parameters.</li>
</ol>
<h4 id="picking-a-good-user-data-section">Picking a “good” user data section</h4>
<p>We need a user data section and its corresponding ECC section without bit flips. But how do we know that a section does not have bit flips? We don’t! We <em>could</em> try to be clever here. One possible approach would be to pick a section with a lot of text and check if the text makes sense. But the lazy approach works just as well: Just try a lot of sections and hope that one of them is correct. <em>More bruteforce. Yeah.</em></p>
<div><figure><pre data-language="python"><code><div><p><span>PAGE_SIZE</span><span> </span><span>=</span><span> </span><span>4096</span><span> </span><span>+</span><span> </span><span>256</span></p></div><div><p><span>SLICE_DATA_0</span><span> </span><span>=</span><span> </span><span>slice</span><span>(</span><span>0</span><span>, </span><span>1028</span><span>)</span></p></div><div><p><span>SLICE_ECC_0</span><span> </span><span>=</span><span> </span><span>slice</span><span>(</span><span>1028</span><span>, </span><span>1056</span><span>)</span></p></div><div><p><span>def</span><span> </span><span>main</span><span>():</span></p></div><div><p><span>    </span><span>if</span><span> </span><span>len</span><span>(sys.argv) </span><span>!=</span><span> </span><span>2</span><span>:</span></p></div><div><p><span>        </span><span>print</span><span>(</span></p></div><div><p><span>            </span><span>f</span><span>"Usage: </span><span>{</span><span>sys.argv[</span><span>0</span><span>]</span><span>}</span><span> full_flash_dump.bin "</span></p></div><div><p><span>            </span><span>f</span><span>"(with </span><span>{PAGE_SIZE}</span><span> byte pages)"</span><span>,</span></p></div><div><p><span>            </span><span>file</span><span>=</span><span>sys.stderr,</span></p></div><div><p><span><span>        </span></span><span>)</span></p></div><div><p><span><span>        </span></span><span>sys.exit(</span><span>1</span><span>)</span></p></div><div><p><span><span>    </span></span><span>f </span><span>=</span><span> </span><span>open</span><span>(sys.argv[</span><span>1</span><span>], </span><span>"rb"</span><span>)</span></p></div><div><p><span>    </span><span>while</span><span> (page </span><span>:=</span><span> f.read(</span><span>PAGE_SIZE</span><span>)) </span><span>!=</span><span> </span><span>b</span><span>""</span><span>:</span></p></div><div><p><span><span>        </span></span><span>user_data </span><span>=</span><span> page[</span><span>SLICE_DATA_0</span><span>]</span></p></div><div><p><span><span>        </span></span><span>known_ecc </span><span>=</span><span> page[</span><span>SLICE_ECC_0</span><span>]</span></p></div><div><p><span>        </span><span># ...</span></p></div></code></pre></figure></div>
<p>As you can see in the script above, we only look at the first section of every page and then move on to the next page entirely. We’re not completely sure yet which ECC bytes cover which user data sections - especially since the 4th section looks fragmented. But we will stick to our assumption that the first 1028 bytes of user data are covered by the first 28 bytes of ECC. Spoiler: We’re right about this. Another Spoiler: The first 3 pages have bit-flips in their first section. The 4th one is good.</p>
<h4 id="iterate-through-all-possible-transformations">Iterate through all possible transformations</h4>
<p>We will try out 4 different transformations:</p>
<ul>
<li>reverse bit order</li>
<li>reverse byte order</li>
<li>swap nibbles</li>
<li>invert</li>
</ul>
<div><figure><pre data-language="python"><code><div><p><span>def</span><span> </span><span>reverse_bit_order</span><span>(b: </span><span>bytes</span><span>) -&gt; </span><span>bytes</span><span>:</span></p></div><div><p><span>    </span><span># credit to this hack at</span></p></div><div><p><span>    </span><span># https://graphics.stanford.edu/~seander/bithacks.html#ReverseByteWith64BitsDiv</span></p></div><div><p><span>    </span><span>return</span><span> </span><span>bytes</span><span>((x </span><span>*</span><span> </span><span>0x</span><span>0202020202</span><span> </span><span>&amp;</span><span> </span><span>0x</span><span>010884422010</span><span>) </span><span>%</span><span> </span><span>1023</span><span> </span><span>for</span><span> x </span><span>in</span><span> b)</span></p></div><div><p><span>def</span><span> </span><span>reverse_byte_order</span><span>(b: </span><span>bytes</span><span>) -&gt; </span><span>bytes</span><span>:</span></p></div><div><p><span>    </span><span>return</span><span> b[::</span><span>-</span><span>1</span><span>]</span></p></div><div><p><span>def</span><span> </span><span>swap_nibbles</span><span>(b: </span><span>bytes</span><span>) -&gt; </span><span>bytes</span><span>:</span></p></div><div><p><span>    </span><span>return</span><span> </span><span>bytes</span><span>((x </span><span>&gt;&gt;</span><span> </span><span>4</span><span> </span><span>|</span><span> x </span><span>&lt;&lt;</span><span> </span><span>4</span><span>) </span><span>&amp;</span><span> </span><span>0x</span><span>FF</span><span> </span><span>for</span><span> x </span><span>in</span><span> b)</span></p></div><div><p><span>def</span><span> </span><span>invert</span><span>(b: </span><span>bytes</span><span>) -&gt; </span><span>bytes</span><span>:</span></p></div><div><p><span>    </span><span>return</span><span> </span><span>bytes</span><span>(x </span><span>^</span><span> </span><span>0x</span><span>FF</span><span> </span><span>for</span><span> x </span><span>in</span><span> b)</span></p></div></code></pre></figure></div>
<p>For these transformation we want all possible subsets and orderings, but without using the same transformation twice in one run.</p>
<div><figure><pre data-language="python"><code><div><p><span>TRANSFORMATIONS</span><span> </span><span>=</span><span> [reverse_bit_order, reverse_byte_order, swap_nibbles, invert]</span></p></div><div><p><span>def</span><span> </span><span>all_transformation_sequences</span><span>():</span></p></div><div><p><span>    </span><span>"""</span></p></div><div><p><span><span>    </span></span><span>:return:  Iterator over all possible subsets and</span></p></div><div><p><span><span>              </span></span><span>orderings of transformations</span></p></div><div><p><span><span>              </span></span><span>(without duplicate transformations).</span></p></div><div><p><span><span>    </span></span><span>"""</span></p></div><div><p><span>    </span><span>for</span><span> transformation_count </span><span>in</span><span> </span><span>range</span><span>(</span><span>0</span><span>, </span><span>len</span><span>(</span><span>TRANSFORMATIONS</span><span>)):</span></p></div><div><p><span>        </span><span>for</span><span> subset </span><span>in</span><span> itertools.combinations(</span><span>TRANSFORMATIONS</span><span>, transformation_count):</span></p></div><div><p><span>            </span><span>for</span><span> permutation </span><span>in</span><span> itertools.permutations(subset):</span></p></div><div><p><span>                </span><span>yield</span><span> permutation</span></p></div></code></pre></figure></div>
<p>Then we can run through all these combinations as both pre-transformations as well as post-transformations:</p>
<div><figure><pre data-language="python"><code><div><p><span># try all combinations of pre-transformations</span></p></div><div><p><span>for</span><span> pre_transform_seq </span><span>in</span><span> all_transformation_sequences():</span></p></div><div><p><span><span>    </span></span><span>user_data_transformed </span><span>=</span><span> user_data</span></p></div><div><p><span>    </span><span>for</span><span> pre_transform </span><span>in</span><span> pre_transform_seq:</span></p></div><div><p><span><span>        </span></span><span>user_data_transformed </span><span>=</span><span> pre_transform(user_data_transformed)</span></p></div><div><p><span><span>    </span></span><span>ecc </span><span>=</span><span> bch.encode(user_data_transformed)</span></p></div><div><p><span>    </span><span># try all combinations of post-transformations</span></p></div><div><p><span>    </span><span>for</span><span> post_transform_seq </span><span>in</span><span> all_transformation_sequences():</span></p></div><div><p><span><span>        </span></span><span>ecc_transformed </span><span>=</span><span> ecc</span></p></div><div><p><span>        </span><span>for</span><span> post_transform </span><span>in</span><span> post_transform_seq:</span></p></div><div><p><span><span>            </span></span><span>ecc_transformed </span><span>=</span><span> post_transform(ecc_transformed)</span></p></div><div><p><span>        </span><span>if</span><span> ecc_transformed </span><span>==</span><span> known_ecc:</span></p></div><div><p><span>            </span><span># success</span></p></div><div><p><span>            </span><span>...</span></p></div></code></pre></figure></div>
<p>Note that some combinations are equivalent:</p>
<div><figure><pre data-language="plaintext"><code><div><p><span>reverse_bit_order(invert(data)) == invert(reverse_bit_order(data))</span></p></div></code></pre></figure></div>
<p>We don’t optimize for that though.</p>
<h4 id="iterate-through-all-possible-primitive-polynomials-of-degree-14">Iterate through all possible primitive polynomials of degree 14</h4>
<p>There are three ways to do this:</p>
<ol>
<li>A simple and slow way</li>
<li>A math-heavy and fast way</li>
<li>A much better way that is about as simple as (1) and as fast as (2)</li>
</ol>
<p>Of course, we went with (1) during our initial research because sometimes thinking just takes longer than computing inefficiently. Afterwards, I spent hours digging into polynomial algebra to come up with (2) and was very happy about it - only to also find (3) right afterwards which was a lot simpler and equally as good… Oh well, at least I got to freshen up on first- and second-semester linear algebra.</p>
<p><strong>(1) Simple and slow</strong>
The simple way would be to just try all polynomials of degree 14. In their integer representation, that’s all integers in
<code>range(2**14, 2**15)</code>
While this <em>will</em> eventually cover the correct primitive polynomial, it will also make bchlib crash the entire script with a SIGSEGV for a lot of non-primitive polynomials.</p>
<p>A quick-and-dirty workaround is to just spawn a new process for every candidate polynomial so your main script doesn’t die. And that’s what we did during initial research. It works - but the creation of over 16,000 processes makes this a bit slow. Not <em>too</em> slow to work with though. This approach works in practice.</p>
<p><strong>(2) Math-heavy and fast</strong>
The <em>proper</em> way to do this is to only pass primitive polynomials into BCH’s constructor. But how do we know if the polynomial that is represented by our integer is primitive? By doing lots of math. If you’re not familiar with polynomial algebra (like I was) but really want to know how this works, read the section <strong>A brief detour into polynomial algebra</strong> in the addendum.</p>
<p>Spoiler: It is a lot of thinking work and only about 5% faster than (3) in my tests.</p>
<p><strong>(3) Simple and fast</strong>
Turns out, bchlib only crashes for polynomials with a constant term of 0, i.e., even integers. So if we use <code>range(2**14 + 1, 2**15, 2)</code>, then it just works without having to fiddle with multiprocessing or math.</p>
<p>This will still throw a runtime error for a lot of non-primitive polynomials but we can catch that via try-except:</p>
<div><figure><pre data-language="python"><code><div><p><span>for</span><span> prim_poly </span><span>in</span><span> </span><span>range</span><span>(</span><span>2</span><span>**</span><span>14</span><span> </span><span>+</span><span> </span><span>1</span><span>, </span><span>2</span><span>**</span><span>15</span><span>, </span><span>2</span><span>):</span></p></div><div><p><span>    </span><span>try</span><span>:</span></p></div><div><p><span><span>        </span></span><span>bch </span><span>=</span><span> bchlib.BCH(</span><span>t</span><span>=</span><span>16</span><span>, </span><span>prim_poly</span><span>=</span><span>prim_poly)</span></p></div><div><p><span>    </span><span>except</span><span> </span><span>RuntimeError</span><span>:</span></p></div><div><p><span>        </span><span>continue</span></p></div></code></pre></figure></div>
<h4 id="checking-the-generated-ecc">Checking the generated ECC</h4>
<p>This is straight-forward and self-explanatory.</p>
<p>You can find the full <strong>ECC Bruteforce Script</strong> in the addendum.</p>
<div><figure><pre data-language="plaintext"><code><div><p><span>Trying page 0, userdata segment 0</span></p></div><div><p><span>Trying page 1, userdata segment 0</span></p></div><div><p><span>Trying page 2, userdata segment 0</span></p></div><div><p><span>Trying page 3, userdata segment 0</span></p></div><div><p><span>========== ECC parameters found!</span></p></div><div><p><span>- prim_poly = 17475</span></p></div><div><p><span>- pre_transform_seq = (&lt;function reverse_bit_order at 0x7f7ff1f8f560&gt;, &lt;function invert at 0x7f7ff1f8fd80&gt;)</span></p></div><div><p><span>- post_transform_seq = (&lt;function reverse_bit_order at 0x7f7ff1f8f560&gt;, &lt;function invert at 0x7f7ff1f8fd80&gt;)</span></p></div><div><p><span>- time to brute force: 0:00:22.094555</span></p></div></code></pre></figure></div>
<h3 id="restoring-the-full-firmware">Restoring the full firmware</h3>
<p>Now that we have a working ECC setup, let’s reassemble the entire firmware! There is just one little detail that we still need to find out:</p>
<p>Which parts of user data are covered by which parts of ECC? We already confirmed that the first user data section is covered by the first 28 bytes of ECC. And the same turns out to be true for the second and third user data section. The fourth section is a bit tricky: It is 928+84 bytes of user data long, with additional BB and CTRL bytes around. What is that about? Turns out, a bit of trial-and-error and looking at the SoC’s data sheet revealed how ECC works for that section.</p>
<center><figure>
						<img src="https://neodyme.io/blog/drone_hacking_part_1/layout-02.png" alt="Mapping of ECC bytes to ECC-covered bytes. The fourth section is fragmented and out of order.">
						<figcaption>
							<p>
								Mapping of ECC bytes to ECC-covered bytes. The fourth section is fragmented and out of order.
							</p>
						</figcaption>
					</figure>
					</center>
<p>Now we just need to apply that to every page and - voilà - full firmware dump. :tada:</p>
<p>The <strong>Final Restore Script</strong> can be found in the addendum.</p>
<div><figure><pre data-language="plaintext"><code><div><p><span>&gt; python restore_from_flash_dump.py ../majority-voting/dump-majority-voting.bin</span></p></div><div><p><span>[   0 % ] Extracted page        1 /   131072 (no errors)</span></p></div><div><p><span>[   0 % ] Extracted page        2 /   131072 (errors in page: 5)</span></p></div><div><p><span>[   0 % ] Extracted page        3 /   131072 (errors in page: 6)</span></p></div><div><p><span>...</span></p></div><div><p><span>[ 100 % ] Extracted page   131070 /   131072 (no errors)</span></p></div><div><p><span>[ 100 % ] Extracted page   131071 /   131072 (no errors)</span></p></div><div><p><span>[ 100 % ] Extracted page   131072 /   131072 (no errors)</span></p></div><div><p><span>======== DONE EXTRACTING</span></p></div><div><p><span>- Total pages: 131072</span></p></div><div><p><span>- Pages with errors: 61387 (46.83 %)</span></p></div><div><p><span>- Total bit errors: 247134 (0.0054 %)</span></p></div><div><p><span>- ECC polynomial: 17475</span></p></div><div><p><span>- Correction capacity per chunk: 16</span></p></div><div><p><span>- Highest error count in a single chunk: 9 (56.25 %)</span></p></div></code></pre></figure></div>
<p>If we look at the binwalk output for that file, it is <em>much</em> better and looks like it is actually free of errors:</p>
<center><figure>
						<img src="https://neodyme.io/blog/drone_hacking_part_1/dump-04-01.png" alt="Binwalk output of the corrected page. Note that binwalk is now much more confident in its findings (green text).">
						<figcaption>
							<p>
								Binwalk output of the corrected page. Note that binwalk is now much more confident in its findings (green text).
							</p>
						</figcaption>
					</figure>
					</center>
<p>When trying to extract the first ubifs image with ubi_reader, we actually get a working file system!</p>
<center><figure>
						<img src="https://neodyme.io/blog/drone_hacking_part_1/dump-04-02.png" alt="ubi_reader finally extracts two of the three file systems including files!">
						<figcaption>
							<p>
								ubi_reader finally extracts two of the three file systems including files!
							</p>
						</figcaption>
					</figure>
					</center>
<p>ubi_reader still throws an error in the later segments of UBIFS image but this extraction is good enough to start reverse engineering the successfully extracted files. Notably, it is enough to reverse engineer the firmware decryption!</p>
<p>Stay tuned for <strong>Part 2</strong> of our drone hacking blogpost where we dive into the reverse engineering and vulnerability analysis of the Potensic Atom 2!</p>
<hr>
<h2 id="addendum">Addendum</h2>
<h3 id="final-restore-script">Final Restore Script</h3>
<div><figure><pre data-language="python"><code><div><p><span>import</span><span> os.path</span></p></div><div><p><span>import</span><span> sys</span></p></div><div><p><span>import</span><span> bchlib</span></p></div><div><p><span>ECC_POLYNOMIAL</span><span> </span><span>=</span><span> </span><span>17475</span></p></div><div><p><span>CORRECTION_CAPACITY</span><span> </span><span>=</span><span> </span><span>16</span></p></div><div><p><span>USER_DATA_SIZE</span><span> </span><span>=</span><span> </span><span>4096</span></p></div><div><p><span>PAGE_SIZE</span><span> </span><span>=</span><span> </span><span>USER_DATA_SIZE</span><span> </span><span>+</span><span> </span><span>256</span></p></div><div><p><span>SLICE_DATA_0</span><span> </span><span>=</span><span> </span><span>slice</span><span>(</span><span>0</span><span>, </span><span>1028</span><span>)</span></p></div><div><p><span>SLICE_ECC_0</span><span> </span><span>=</span><span> </span><span>slice</span><span>(</span><span>1028</span><span>, </span><span>1056</span><span>)</span></p></div><div><p><span>SLICE_DATA_1</span><span> </span><span>=</span><span> </span><span>slice</span><span>(</span><span>1056</span><span>, </span><span>2084</span><span>)</span></p></div><div><p><span>SLICE_ECC_1</span><span> </span><span>=</span><span> </span><span>slice</span><span>(</span><span>2084</span><span>, </span><span>2112</span><span>)</span></p></div><div><p><span>SLICE_DATA_2</span><span> </span><span>=</span><span> </span><span>slice</span><span>(</span><span>2112</span><span>, </span><span>3140</span><span>)</span></p></div><div><p><span>SLICE_ECC_2</span><span> </span><span>=</span><span> </span><span>slice</span><span>(</span><span>3140</span><span>, </span><span>3168</span><span>)</span></p></div><div><p><span>SLICE_DATA_3</span><span> </span><span>=</span><span> </span><span>slice</span><span>(</span><span>3168</span><span>, </span><span>4096</span><span>)</span></p></div><div><p><span>SLICE_BB</span><span> </span><span>=</span><span> </span><span>slice</span><span>(</span><span>4096</span><span>, </span><span>4098</span><span>)</span></p></div><div><p><span>SLICE_DATA_4</span><span> </span><span>=</span><span> </span><span>slice</span><span>(</span><span>4098</span><span>, </span><span>4182</span><span>)</span></p></div><div><p><span>SLICE_ECC_3</span><span> </span><span>=</span><span> </span><span>slice</span><span>(</span><span>4182</span><span>, </span><span>4210</span><span>)</span></p></div><div><p><span>SLICE_CTRL</span><span> </span><span>=</span><span> </span><span>slice</span><span>(</span><span>4210</span><span>, </span><span>4224</span><span>)</span></p></div><div><p><span>def</span><span> </span><span>parse_flash_page</span><span>(flash_page: </span><span>bytes</span><span>) -&gt; list[tuple[</span><span>bytearray</span><span>, </span><span>bytearray</span><span>]]:</span></p></div><div><p><span>    </span><span>"""</span></p></div><div><p><span><span>    </span></span><span>Transforms a flash-layout page into a userdata-layout page according to SoC datasheet,</span></p></div><div><p><span><span>    </span></span><span>chunked according to ECC coverage.</span></p></div><div><p><span><span>    </span></span><span>Flash layout:</span></p></div><div><p><span><span>    </span></span><span>data + ecc + data + ecc + data + ecc + data + bb + data + ecc + ctrl</span></p></div><div><p><span><span>    </span></span><span>Userdata layout:</span></p></div><div><p><span><span>    </span></span><span>data + bb + ctrl</span></p></div><div><p><span><span>    </span></span><span>ECC coverage:</span></p></div><div><p><span><span>    </span></span><span>data0 &lt;- ECC0</span></p></div><div><p><span><span>    </span></span><span>data1 &lt;- ECC1</span></p></div><div><p><span><span>    </span></span><span>data2 &lt;- ECC2</span></p></div><div><p><span><span>    </span></span><span>data3+data4+bb+ctrl &lt;- ECC3</span></p></div><div><p><span><span>    </span></span><span>:param flash_page: The 4224 or 4352 byte flash-layout page</span></p></div><div><p><span><span>    </span></span><span>"""</span></p></div><div><p><span><span>    </span></span><span>chunks </span><span>=</span><span> []</span></p></div><div><p><span>    </span><span># three simple chunks of full-sized data + ecc</span></p></div><div><p><span><span>    </span></span><span>chunks.append((flash_page[</span><span>SLICE_DATA_0</span><span>], flash_page[</span><span>SLICE_ECC_0</span><span>]))</span></p></div><div><p><span><span>    </span></span><span>chunks.append((flash_page[</span><span>SLICE_DATA_1</span><span>], flash_page[</span><span>SLICE_ECC_1</span><span>]))</span></p></div><div><p><span><span>    </span></span><span>chunks.append((flash_page[</span><span>SLICE_DATA_2</span><span>], flash_page[</span><span>SLICE_ECC_2</span><span>]))</span></p></div><div><p><span>    </span><span># last chunk is fragmented a bit</span></p></div><div><p><span><span>    </span></span><span>userdata_chunk </span><span>=</span><span> </span><span>bytearray</span><span>()</span></p></div><div><p><span><span>    </span></span><span>userdata_chunk.extend(flash_page[</span><span>SLICE_DATA_3</span><span>])</span></p></div><div><p><span><span>    </span></span><span>userdata_chunk.extend(flash_page[</span><span>SLICE_DATA_4</span><span>])</span></p></div><div><p><span><span>    </span></span><span>userdata_chunk.extend(flash_page[</span><span>SLICE_BB</span><span>])</span></p></div><div><p><span><span>    </span></span><span>userdata_chunk.extend(flash_page[</span><span>SLICE_CTRL</span><span>])</span></p></div><div><p><span><span>    </span></span><span>chunks.append((userdata_chunk, flash_page[</span><span>SLICE_ECC_3</span><span>]))</span></p></div><div><p><span>    </span><span>return</span><span> chunks</span></p></div><div><p><span>def</span><span> </span><span>invert</span><span>(b: </span><span>bytearray</span><span>) -&gt; </span><span>bytearray</span><span>:</span></p></div><div><p><span>    </span><span>return</span><span> </span><span>bytearray</span><span>(x </span><span>^</span><span> </span><span>0x</span><span>FF</span><span> </span><span>for</span><span> x </span><span>in</span><span> b)</span></p></div><div><p><span>def</span><span> </span><span>fix_chunk_inplace</span><span>(data: </span><span>bytearray</span><span>, ecc: </span><span>bytearray</span><span>) -&gt; tuple[</span><span>int</span><span>, </span><span>bytearray</span><span>]:</span></p></div><div><p><span><span>    </span></span><span>data_transformed </span><span>=</span><span> invert(data)</span></p></div><div><p><span><span>    </span></span><span>ecc_transformed </span><span>=</span><span> invert(ecc)</span></p></div><div><p><span><span>    </span></span><span>bch </span><span>=</span><span> bchlib.BCH(</span><span>t</span><span>=</span><span>CORRECTION_CAPACITY</span><span>, </span><span>prim_poly</span><span>=</span><span>ECC_POLYNOMIAL</span><span>, </span><span>swap_bits</span><span>=</span><span>True</span><span>)</span></p></div><div><p><span><span>    </span></span><span>err_count </span><span>=</span><span> bch.decode(data_transformed, ecc_transformed)</span></p></div><div><p><span><span>    </span></span><span>bch.correct(data_transformed, ecc_transformed)</span></p></div><div><p><span>    </span><span>return</span><span> err_count, invert(data_transformed)</span></p></div><div><p><span>def</span><span> </span><span>main</span><span>():</span></p></div><div><p><span>    </span><span>if</span><span> </span><span>len</span><span>(sys.argv) </span><span>!=</span><span> </span><span>2</span><span>:</span></p></div><div><p><span>        </span><span>print</span><span>(</span></p></div><div><p><span>            </span><span>f</span><span>"Usage: </span><span>{</span><span>sys.argv[</span><span>0</span><span>]</span><span>}</span><span> full_flash_dump.bin "</span></p></div><div><p><span>            </span><span>f</span><span>"(with </span><span>{PAGE_SIZE}</span><span> byte pages)"</span><span>,</span></p></div><div><p><span>            </span><span>file</span><span>=</span><span>sys.stderr,</span></p></div><div><p><span><span>        </span></span><span>)</span></p></div><div><p><span><span>        </span></span><span>sys.exit(</span><span>1</span><span>)</span></p></div><div><p><span><span>    </span></span><span>total_page_count </span><span>=</span><span> os.path.getsize(sys.argv[</span><span>1</span><span>]) </span><span>//</span><span> </span><span>PAGE_SIZE</span></p></div><div><p><span><span>    </span></span><span>f_in </span><span>=</span><span> </span><span>open</span><span>(sys.argv[</span><span>1</span><span>], </span><span>"rb"</span><span>)</span></p></div><div><p><span><span>    </span></span><span>f_out </span><span>=</span><span> </span><span>open</span><span>(</span><span>"firmware-corrected.bin"</span><span>, </span><span>"wb"</span><span>)</span></p></div><div><p><span><span>    </span></span><span>page_index </span><span>=</span><span> </span><span>0</span></p></div><div><p><span><span>    </span></span><span>total_errors </span><span>=</span><span> </span><span>0</span></p></div><div><p><span><span>    </span></span><span>pages_with_errors </span><span>=</span><span> </span><span>0</span></p></div><div><p><span><span>    </span></span><span>highest_chunk_error_count </span><span>=</span><span> </span><span>0</span></p></div><div><p><span>    </span><span>while</span><span> (page </span><span>:=</span><span> f_in.read(</span><span>PAGE_SIZE</span><span>)) </span><span>!=</span><span> </span><span>b</span><span>""</span><span>:</span></p></div><div><p><span><span>        </span></span><span>page_index </span><span>+=</span><span> </span><span>1</span></p></div><div><p><span><span>        </span></span><span>chunks </span><span>=</span><span> parse_flash_page(page)</span></p></div><div><p><span><span>        </span></span><span>errors_in_page </span><span>=</span><span> </span><span>0</span></p></div><div><p><span><span>        </span></span><span>page_corrected </span><span>=</span><span> </span><span>bytearray</span><span>()</span></p></div><div><p><span>        </span><span>for</span><span> i, (data, ecc) </span><span>in</span><span> </span><span>enumerate</span><span>(chunks):</span></p></div><div><p><span><span>            </span></span><span>err_count, data </span><span>=</span><span> fix_chunk_inplace(data, ecc)</span></p></div><div><p><span><span>            </span></span><span>page_corrected.extend(data)</span></p></div><div><p><span><span>            </span></span><span>errors_in_page </span><span>+=</span><span> err_count</span></p></div><div><p><span><span>            </span></span><span>highest_chunk_error_count </span><span>=</span><span> </span><span>max</span><span>(highest_chunk_error_count, err_count)</span></p></div><div><p><span>        </span><span># cut off BB and CTRL</span></p></div><div><p><span><span>        </span></span><span>f_out.write(page_corrected[:</span><span>USER_DATA_SIZE</span><span>])</span></p></div><div><p><span>        </span><span>print</span><span>(</span></p></div><div><p><span>            </span><span>f</span><span>"[</span><span>{</span><span>page_index</span><span>/</span><span>total_page_count</span><span>*</span><span>100</span><span>: 4.0f</span><span>}</span><span> % ] Extracted page </span><span>{</span><span>page_index</span><span>: 8d</span><span>}</span><span> / </span><span>{</span><span>total_page_count</span><span>: 8d</span><span>}</span><span> "</span></p></div><div><p><span>            </span><span>+</span><span> (</span></p></div><div><p><span>                </span><span>f</span><span>"(errors in page: </span><span>{</span><span>errors_in_page</span><span>}</span><span>)"</span></p></div><div><p><span>                </span><span>if</span><span> errors_in_page </span><span>&gt;</span><span> </span><span>0</span></p></div><div><p><span>                </span><span>else</span><span> </span><span>f</span><span>"(no errors)"</span></p></div><div><p><span><span>            </span></span><span>)</span></p></div><div><p><span><span>        </span></span><span>)</span></p></div><div><p><span><span>        </span></span><span>total_errors </span><span>+=</span><span> errors_in_page</span></p></div><div><p><span>        </span><span>if</span><span> errors_in_page </span><span>&gt;</span><span> </span><span>0</span><span>:</span></p></div><div><p><span><span>            </span></span><span>pages_with_errors </span><span>+=</span><span> </span><span>1</span></p></div><div><p><span>    </span><span>print</span><span>()</span></p></div><div><p><span>    </span><span>print</span><span>(</span><span>f</span><span>"======== DONE EXTRACTING"</span><span>)</span></p></div><div><p><span>    </span><span>print</span><span>(</span><span>f</span><span>"- Total pages: </span><span>{</span><span>total_page_count</span><span>}</span><span>"</span><span>)</span></p></div><div><p><span>    </span><span>print</span><span>(</span></p></div><div><p><span>        </span><span>f</span><span>"- Pages with errors: </span><span>{</span><span>pages_with_errors</span><span>}</span><span> (</span><span>{</span><span>pages_with_errors</span><span>/</span><span>total_page_count</span><span>*</span><span>100</span><span>:.02f</span><span>}</span><span> %)"</span></p></div><div><p><span><span>    </span></span><span>)</span></p></div><div><p><span>    </span><span>print</span><span>(</span></p></div><div><p><span>        </span><span>f</span><span>"- Total bit errors: </span><span>{</span><span>total_errors</span><span>}</span><span> (</span><span>{</span><span>total_errors </span><span>/</span><span> (total_page_count</span><span>*</span><span>PAGE_SIZE</span><span>*</span><span>8</span><span>)</span><span>*</span><span>100</span><span>:.04f</span><span>}</span><span> %)"</span></p></div><div><p><span><span>    </span></span><span>)</span></p></div><div><p><span>    </span><span>print</span><span>(</span><span>f</span><span>"- ECC polynomial: </span><span>{ECC_POLYNOMIAL}</span><span>"</span><span>)</span></p></div><div><p><span>    </span><span>print</span><span>(</span><span>f</span><span>"- Correction capacity per chunk: </span><span>{CORRECTION_CAPACITY}</span><span>"</span><span>)</span></p></div><div><p><span>    </span><span>print</span><span>(</span></p></div><div><p><span>        </span><span>f</span><span>"- Highest error count in a single chunk: </span><span>{</span><span>highest_chunk_error_count</span><span>}</span><span> "</span></p></div><div><p><span>        </span><span>f</span><span>"(</span><span>{</span><span>highest_chunk_error_count</span><span>/</span><span>CORRECTION_CAPACITY</span><span>*</span><span>100</span><span>:.02f</span><span>}</span><span> %)"</span></p></div><div><p><span><span>    </span></span><span>)</span></p></div><div><p><span>if</span><span> </span><span>__name__</span><span> </span><span>==</span><span> </span><span>"__main__"</span><span>:</span></p></div><div><p><span><span>    </span></span><span>main()</span></p></div></code></pre></figure></div>
<h3 id="ecc-bruteforce-script">ECC Bruteforce Script</h3>
<div><figure><pre data-language="python"><code><div><p><span>import</span><span> datetime</span></p></div><div><p><span>import</span><span> itertools</span></p></div><div><p><span>import</span><span> sys</span></p></div><div><p><span>import</span><span> bchlib</span></p></div><div><p><span>PAGE_SIZE</span><span> </span><span>=</span><span> </span><span>4096</span><span> </span><span>+</span><span> </span><span>256</span></p></div><div><p><span>SLICE_DATA_0</span><span> </span><span>=</span><span> </span><span>slice</span><span>(</span><span>0</span><span>, </span><span>1028</span><span>)</span></p></div><div><p><span>SLICE_ECC_0</span><span> </span><span>=</span><span> </span><span>slice</span><span>(</span><span>1028</span><span>, </span><span>1056</span><span>)</span></p></div><div><p><span>def</span><span> </span><span>reverse_bit_order</span><span>(b: </span><span>bytes</span><span>) -&gt; </span><span>bytes</span><span>:</span></p></div><div><p><span>    </span><span># credit to this hack at</span></p></div><div><p><span>    </span><span># https://graphics.stanford.edu/~seander/bithacks.html#ReverseByteWith64BitsDiv</span></p></div><div><p><span>    </span><span>return</span><span> </span><span>bytes</span><span>((x </span><span>*</span><span> </span><span>0x</span><span>0202020202</span><span> </span><span>&amp;</span><span> </span><span>0x</span><span>010884422010</span><span>) </span><span>%</span><span> </span><span>1023</span><span> </span><span>for</span><span> x </span><span>in</span><span> b)</span></p></div><div><p><span>def</span><span> </span><span>reverse_byte_order</span><span>(b: </span><span>bytes</span><span>) -&gt; </span><span>bytes</span><span>:</span></p></div><div><p><span>    </span><span>return</span><span> b[::</span><span>-</span><span>1</span><span>]</span></p></div><div><p><span>def</span><span> </span><span>swap_nibbles</span><span>(b: </span><span>bytes</span><span>) -&gt; </span><span>bytes</span><span>:</span></p></div><div><p><span>    </span><span>return</span><span> </span><span>bytes</span><span>((x </span><span>&gt;&gt;</span><span> </span><span>4</span><span> </span><span>|</span><span> x </span><span>&lt;&lt;</span><span> </span><span>4</span><span>) </span><span>&amp;</span><span> </span><span>0x</span><span>FF</span><span> </span><span>for</span><span> x </span><span>in</span><span> b)</span></p></div><div><p><span>def</span><span> </span><span>invert</span><span>(b: </span><span>bytes</span><span>) -&gt; </span><span>bytes</span><span>:</span></p></div><div><p><span>    </span><span>return</span><span> </span><span>bytes</span><span>(x </span><span>^</span><span> </span><span>0x</span><span>FF</span><span> </span><span>for</span><span> x </span><span>in</span><span> b)</span></p></div><div><p><span>TRANSFORMATIONS</span><span> </span><span>=</span><span> [reverse_bit_order, reverse_byte_order, swap_nibbles, invert]</span></p></div><div><p><span>def</span><span> </span><span>all_transformation_sequences</span><span>():</span></p></div><div><p><span>    </span><span>"""</span></p></div><div><p><span><span>    </span></span><span>:return:  Iterator over all possible subsets and</span></p></div><div><p><span><span>              </span></span><span>orderings of transformations</span></p></div><div><p><span><span>              </span></span><span>(without duplicate transformations).</span></p></div><div><p><span><span>    </span></span><span>"""</span></p></div><div><p><span>    </span><span>for</span><span> transformation_count </span><span>in</span><span> </span><span>range</span><span>(</span><span>0</span><span>, </span><span>len</span><span>(</span><span>TRANSFORMATIONS</span><span>)):</span></p></div><div><p><span>        </span><span>for</span><span> subset </span><span>in</span><span> itertools.combinations(</span><span>TRANSFORMATIONS</span><span>, transformation_count):</span></p></div><div><p><span>            </span><span>for</span><span> permutation </span><span>in</span><span> itertools.permutations(subset):</span></p></div><div><p><span>                </span><span>yield</span><span> permutation</span></p></div><div><p><span>def</span><span> </span><span>main</span><span>():</span></p></div><div><p><span>    </span><span>if</span><span> </span><span>len</span><span>(sys.argv) </span><span>!=</span><span> </span><span>2</span><span>:</span></p></div><div><p><span>        </span><span>print</span><span>(</span></p></div><div><p><span>            </span><span>f</span><span>"Usage: </span><span>{</span><span>sys.argv[</span><span>0</span><span>]</span><span>}</span><span> full_flash_dump.bin "</span></p></div><div><p><span>            </span><span>f</span><span>"(with </span><span>{PAGE_SIZE}</span><span> byte pages)"</span><span>,</span></p></div><div><p><span>            </span><span>file</span><span>=</span><span>sys.stderr,</span></p></div><div><p><span><span>        </span></span><span>)</span></p></div><div><p><span><span>        </span></span><span>sys.exit(</span><span>1</span><span>)</span></p></div><div><p><span><span>    </span></span><span>f </span><span>=</span><span> </span><span>open</span><span>(sys.argv[</span><span>1</span><span>], </span><span>"rb"</span><span>)</span></p></div><div><p><span>    </span><span># Both of these work about equally fast</span></p></div><div><p><span>    </span><span># primitive_polynomials = list(primitive_binary_polynomials(14))</span></p></div><div><p><span><span>    </span></span><span>primitive_polynomials </span><span>=</span><span> </span><span>list</span><span>(</span><span>range</span><span>(</span><span>2</span><span>**</span><span>14</span><span> </span><span>+</span><span> </span><span>1</span><span>, </span><span>2</span><span>**</span><span>15</span><span>, </span><span>2</span><span>))</span></p></div><div><p><span>    </span><span># try all pages</span></p></div><div><p><span><span>    </span></span><span>t0 </span><span>=</span><span> datetime.datetime.now()</span></p></div><div><p><span><span>    </span></span><span>page_index </span><span>=</span><span> </span><span>0</span></p></div><div><p><span>    </span><span>while</span><span> (page </span><span>:=</span><span> f.read(</span><span>PAGE_SIZE</span><span>)) </span><span>!=</span><span> </span><span>b</span><span>""</span><span>:</span></p></div><div><p><span>        </span><span>print</span><span>(</span><span>f</span><span>"Trying page </span><span>{</span><span>page_index</span><span>}</span><span>, userdata segment 0"</span><span>)</span></p></div><div><p><span><span>        </span></span><span>page_index </span><span>+=</span><span> </span><span>1</span></p></div><div><p><span><span>        </span></span><span>user_data </span><span>=</span><span> page[</span><span>SLICE_DATA_0</span><span>]</span></p></div><div><p><span><span>        </span></span><span>known_ecc </span><span>=</span><span> page[</span><span>SLICE_ECC_0</span><span>]</span></p></div><div><p><span>        </span><span># try all primitive polynomials of the correct degree</span></p></div><div><p><span>        </span><span>for</span><span> prim_poly </span><span>in</span><span> primitive_polynomials:</span></p></div><div><p><span>            </span><span>try</span><span>:</span></p></div><div><p><span><span>                </span></span><span>bch </span><span>=</span><span> bchlib.BCH(</span><span>t</span><span>=</span><span>16</span><span>, </span><span>prim_poly</span><span>=</span><span>prim_poly)</span></p></div><div><p><span>            </span><span>except</span><span> </span><span>RuntimeError</span><span>:</span></p></div><div><p><span>                </span><span>continue</span></p></div><div><p><span>            </span><span># try all combinations of pre-transformations</span></p></div><div><p><span>            </span><span>for</span><span> pre_transform_seq </span><span>in</span><span> all_transformation_sequences():</span></p></div><div><p><span><span>                </span></span><span>user_data_transformed </span><span>=</span><span> user_data</span></p></div><div><p><span>                </span><span>for</span><span> pre_transform </span><span>in</span><span> pre_transform_seq:</span></p></div><div><p><span><span>                    </span></span><span>user_data_transformed </span><span>=</span><span> pre_transform(user_data_transformed)</span></p></div><div><p><span><span>                </span></span><span>ecc </span><span>=</span><span> bch.encode(user_data_transformed)</span></p></div><div><p><span>                </span><span># try all combinations of post-transformations</span></p></div><div><p><span>                </span><span>for</span><span> post_transform_seq </span><span>in</span><span> all_transformation_sequences():</span></p></div><div><p><span><span>                    </span></span><span>ecc_transformed </span><span>=</span><span> ecc</span></p></div><div><p><span>                    </span><span>for</span><span> post_transform </span><span>in</span><span> post_transform_seq:</span></p></div><div><p><span><span>                        </span></span><span>ecc_transformed </span><span>=</span><span> post_transform(ecc_transformed)</span></p></div><div><p><span>                    </span><span>if</span><span> ecc_transformed </span><span>==</span><span> known_ecc:</span></p></div><div><p><span>                        </span><span>print</span><span>(</span><span>f</span><span>"========== ECC parameters found!"</span><span>)</span></p></div><div><p><span>                        </span><span>print</span><span>(</span><span>f</span><span>"- prim_poly = </span><span>{</span><span>prim_poly</span><span>}</span><span>"</span><span>)</span></p></div><div><p><span>                        </span><span>print</span><span>(</span><span>f</span><span>"- pre_transform_seq = </span><span>{</span><span>pre_transform_seq</span><span>}</span><span>"</span><span>)</span></p></div><div><p><span>                        </span><span>print</span><span>(</span><span>f</span><span>"- post_transform_seq = </span><span>{</span><span>post_transform_seq</span><span>}</span><span>"</span><span>)</span></p></div><div><p><span><span>                        </span></span><span>t1 </span><span>=</span><span> datetime.datetime.now()</span></p></div><div><p><span>                        </span><span>print</span><span>(</span><span>f</span><span>"- time to brute force: </span><span>{</span><span>t1 </span><span>-</span><span> t0</span><span>}</span><span>"</span><span>)</span></p></div><div><p><span>                        </span><span>return</span></p></div><div><p><span>if</span><span> </span><span>__name__</span><span> </span><span>==</span><span> </span><span>"__main__"</span><span>:</span></p></div><div><p><span><span>    </span></span><span>main()</span></p></div></code></pre></figure></div>
<h3 id="primitive-binary-polynomial-generator">Primitive Binary Polynomial Generator</h3>
<div><figure><pre data-language="python"><code><div><p><span>def</span><span> </span><span>prime_factorization</span><span>(n):</span></p></div><div><p><span><span>    </span></span><span>fac </span><span>=</span><span> []</span></p></div><div><p><span><span>    </span></span><span>p </span><span>=</span><span> </span><span>2</span></p></div><div><p><span>    </span><span>while</span><span> p </span><span>*</span><span> p </span><span>&lt;=</span><span> n:</span></p></div><div><p><span>        </span><span>if</span><span> n </span><span>%</span><span> p </span><span>==</span><span> </span><span>0</span><span>:</span></p></div><div><p><span><span>            </span></span><span>fac.append(p)</span></p></div><div><p><span>            </span><span>while</span><span> n </span><span>%</span><span> p </span><span>==</span><span> </span><span>0</span><span>:</span></p></div><div><p><span><span>                </span></span><span>n </span><span>//=</span><span> p</span></p></div><div><p><span><span>        </span></span><span>p </span><span>+=</span><span> </span><span>1</span></p></div><div><p><span>    </span><span>if</span><span> n </span><span>&gt;</span><span> </span><span>1</span><span>:</span></p></div><div><p><span><span>        </span></span><span>fac.append(n)</span></p></div><div><p><span>    </span><span>return</span><span> fac</span></p></div><div><p><span>def</span><span> </span><span>poly_mod</span><span>(a, mod):</span></p></div><div><p><span><span>    </span></span><span>d_a </span><span>=</span><span> a.bit_length() </span><span>-</span><span> </span><span>1</span></p></div><div><p><span><span>    </span></span><span>d_m </span><span>=</span><span> mod.bit_length() </span><span>-</span><span> </span><span>1</span></p></div><div><p><span>    </span><span>while</span><span> a </span><span>and</span><span> d_a </span><span>&gt;=</span><span> d_m:</span></p></div><div><p><span><span>        </span></span><span>a </span><span>^=</span><span> mod </span><span>&lt;&lt;</span><span> (d_a </span><span>-</span><span> d_m)</span></p></div><div><p><span><span>        </span></span><span>d_a </span><span>=</span><span> a.bit_length() </span><span>-</span><span> </span><span>1</span></p></div><div><p><span>    </span><span>return</span><span> a</span></p></div><div><p><span>def</span><span> </span><span>poly_mul</span><span>(a, b):</span></p></div><div><p><span><span>    </span></span><span>result </span><span>=</span><span> </span><span>0</span></p></div><div><p><span>    </span><span>while</span><span> b:</span></p></div><div><p><span>        </span><span>if</span><span> b </span><span>&amp;</span><span> </span><span>1</span><span>:</span></p></div><div><p><span><span>            </span></span><span>result </span><span>^=</span><span> a</span></p></div><div><p><span><span>        </span></span><span>b </span><span>&gt;&gt;=</span><span> </span><span>1</span></p></div><div><p><span><span>        </span></span><span>a </span><span>&lt;&lt;=</span><span> </span><span>1</span></p></div><div><p><span>    </span><span>return</span><span> result</span></p></div><div><p><span>def</span><span> </span><span>poly_gcd</span><span>(a, b):</span></p></div><div><p><span>    </span><span>while</span><span> b:</span></p></div><div><p><span><span>        </span></span><span>a, b </span><span>=</span><span> b, poly_mod(a, b)</span></p></div><div><p><span>    </span><span>return</span><span> a</span></p></div><div><p><span>def</span><span> </span><span>poly_pow_mod</span><span>(x, e, mod):</span></p></div><div><p><span><span>    </span></span><span>res </span><span>=</span><span> </span><span>1</span></p></div><div><p><span>    </span><span>while</span><span> e:</span></p></div><div><p><span>        </span><span>if</span><span> e </span><span>&amp;</span><span> </span><span>1</span><span>:</span></p></div><div><p><span><span>            </span></span><span>res </span><span>=</span><span> poly_mod(poly_mul(res, x), mod)</span></p></div><div><p><span><span>        </span></span><span>x </span><span>=</span><span> poly_mod(poly_mul(x, x), mod)</span></p></div><div><p><span><span>        </span></span><span>e </span><span>&gt;&gt;=</span><span> </span><span>1</span></p></div><div><p><span>    </span><span>return</span><span> res</span></p></div><div><p><span>def</span><span> </span><span>is_reducible</span><span>(fx):</span></p></div><div><p><span><span>    </span></span><span>degree </span><span>=</span><span> fx.bit_length() </span><span>-</span><span> </span><span>1</span></p></div><div><p><span><span>    </span></span><span>x </span><span>=</span><span> </span><span>2</span></p></div><div><p><span><span>    </span></span><span>y </span><span>=</span><span> x</span></p></div><div><p><span>    </span><span>for</span><span> _ </span><span>in</span><span> </span><span>range</span><span>(degree </span><span>//</span><span> </span><span>2</span><span> </span><span>+</span><span> </span><span>1</span><span>):</span></p></div><div><p><span><span>        </span></span><span>y </span><span>=</span><span> poly_mod(poly_mul(y, y), fx)</span></p></div><div><p><span><span>        </span></span><span>y_minus_x </span><span>=</span><span> y </span><span>^</span><span> x</span></p></div><div><p><span>        </span><span>if</span><span> poly_gcd(y_minus_x, fx) </span><span>!=</span><span> </span><span>1</span><span>:</span></p></div><div><p><span>            </span><span>return</span><span> </span><span>False</span></p></div><div><p><span>    </span><span>for</span><span> _ </span><span>in</span><span> </span><span>range</span><span>(degree </span><span>//</span><span> </span><span>2</span><span> </span><span>+</span><span> </span><span>1</span><span>, degree):</span></p></div><div><p><span><span>        </span></span><span>y </span><span>=</span><span> poly_mod(poly_mul(y, y), fx)</span></p></div><div><p><span>    </span><span>return</span><span> y </span><span>==</span><span> x</span></p></div><div><p><span>def</span><span> </span><span>primitive_binary_polynomials</span><span>(degree):</span></p></div><div><p><span><span>    </span></span><span>n </span><span>=</span><span> </span><span>2</span><span>**</span><span>degree </span><span>-</span><span> </span><span>1</span></p></div><div><p><span><span>    </span></span><span>prime_factors </span><span>=</span><span> </span><span>set</span><span>(prime_factorization(n))</span></p></div><div><p><span><span>    </span></span><span>x </span><span>=</span><span> </span><span>2</span></p></div><div><p><span>    </span><span>for</span><span> fx </span><span>in</span><span> </span><span>range</span><span>(</span><span>2</span><span>**</span><span>degree </span><span>+</span><span> </span><span>1</span><span>, </span><span>2</span><span> </span><span>**</span><span> (degree </span><span>+</span><span> </span><span>1</span><span>), </span><span>2</span><span>):</span></p></div><div><p><span>        </span><span># check irreducible</span></p></div><div><p><span>        </span><span>if</span><span> </span><span>not</span><span> is_reducible(fx):</span></p></div><div><p><span>            </span><span>continue</span></p></div><div><p><span>        </span><span># check primitive</span></p></div><div><p><span>        </span><span>for</span><span> q </span><span>in</span><span> prime_factors:</span></p></div><div><p><span>            </span><span>if</span><span> poly_pow_mod(x, n </span><span>//</span><span> q, fx) </span><span>==</span><span> </span><span>1</span><span>:</span></p></div><div><p><span>                </span><span>break</span></p></div><div><p><span>        </span><span>else</span><span>:</span></p></div><div><p><span>            </span><span>yield</span><span> fx</span></p></div><div><p><span>if</span><span> </span><span>__name__</span><span> </span><span>==</span><span> </span><span>"__main__"</span><span>:</span></p></div><div><p><span><span>    </span></span><span>m </span><span>=</span><span> </span><span>14</span></p></div><div><p><span>    </span><span>print</span><span>(</span><span>f</span><span>"All primitive polynomials of degree </span><span>{</span><span>m</span><span>}</span><span>:"</span><span>)</span></p></div><div><p><span><span>    </span></span><span>i </span><span>=</span><span> </span><span>0</span></p></div><div><p><span>    </span><span>for</span><span> px </span><span>in</span><span> primitive_binary_polynomials(m):</span></p></div><div><p><span><span>        </span></span><span>i </span><span>+=</span><span> </span><span>1</span></p></div><div><p><span>        </span><span>print</span><span>(</span><span>f</span><span>"</span><span>{</span><span>px</span><span>}</span><span> = </span><span>{bin</span><span>(px)</span><span>}</span><span>"</span><span>)</span></p></div><div><p><span>    </span><span>print</span><span>(</span><span>f</span><span>"Total primitive polynomials of degree </span><span>{</span><span>m</span><span>}</span><span>: </span><span>{</span><span>i</span><span>}</span><span>"</span><span>)</span></p></div></code></pre></figure></div>
<h3 id="fun-fuckups">Fun Fuckups</h3>
<center><figure>
						<img src="https://neodyme.io/blog/drone_hacking_part_1/fuckup-01.png" alt="Forgot to order a battery, had to power with a lab supply…">
						<figcaption>
							<p>
								Forgot to order a battery, had to power with a lab supply…
							</p>
						</figcaption>
					</figure>
					</center>
<h2 id="a-brief-detour-into-polynomial-algebra">A brief detour into polynomial algebra</h2>
<p>If you are like me and you’re not really familiar with polynomial algebra, it makes sense to talk about related concepts in the integer world first and then move on to their counterparts in the polynomial world. This helps to get an intuition of what we are actually dealing with.</p>
<p>I assume that you are generally familiar with modular arithmetic and prime numbers.</p>
<h3 id="integers-and-modulo-rings">Integers and Modulo Rings</h3>
<p>For now, we are working on the field of integers, i.e., <span></span>, mathematically denoted <span></span>.</p>
<p>When we introduce a modulus, we get <span></span>. Explanation for the notation:</p>
<p><span></span> is some modulus. Not necessary prime at this point. Just an integer - a member of <span></span>.</p>
<p><span></span> is all multiples of <span></span>. So <span></span>.
If <span></span> were <span></span>, this would be <span></span>.</p>
<p>Now <span></span> means:
The field <span></span> but treat all elements as equivalent if they are a multiple of <span></span> apart - meaning their difference is in <span></span>.
If <span></span> were <span></span>, then <span></span> and <span></span> would be equivalent, because their difference is <span></span>, which is a multiple of <span></span> and thus in <span></span>.</p>
<p>This is exactly what “mod 7” is: <span></span></p>
<p>So <span></span> is just all of <span></span>.</p>
<p>Note that this collapses the infinite field of all possible integers <span></span> down to a finite set of equivalence classes. In <span></span>, all numbers are either in <span></span> or are equivalents of one of those. So for practical purposes, there are only <span></span> possible values in <span></span>.</p>
<p>What do we need primes for?
Well, <span></span> has a practical problem: Sometimes multiplying two things results in a zero. Example for <span></span>:</p>
<div><figure><pre data-language="plaintext"><code><div><p><span>4  * 2 = 0 mod 8</span></p></div><div><p><span>8  * 2 = 0 mod 8</span></p></div><div><p><span>12 * 2 = 0 mod 8</span></p></div></code></pre></figure></div>
<p>That is bad if we want to do a lot of multiplication within our modulo ring. Because if we ever accidentally hit a multiple of <span></span>, we will get <span></span> and that point it doesn’t matter what we multiply onto that - it will stay <span></span>. So there are a lot of possible values that all collapse into the same <span></span> when multiplied with certain numbers.</p>
<p>In the field of all integers, <span></span>, we don’t have that problem. As long as we don’t multiply with <span></span> itself, the results of a multiplication will never be <span></span>. Good thing there is a solution for that: Using a <strong>prime modulus</strong>.</p>
<h3 id="prime-numbers-finite-fields-and-cycles">Prime Numbers, Finite Fields, and Cycles</h3>
<p>Prime numbers <span></span> have the nice feature that the modulo rings they induce, <span></span>, are <em>fields</em> and not just <em>rings</em>, meaning addition and multiplication work just as well as they do in <span></span>. In <span></span>, multiplying by something other than <span></span> will <em>never</em> result in a multiple of <span></span> - because <span></span> is prime and you can’t reach a prime from another number through multiplication. (Multiplying by <span></span> itself doesn’t count, because <span></span>.)</p>
<p>Because <span></span> is a <em>field</em> and it has a finite amount of elements <span></span>, it is called a “finite field” or a “Galois field” and sometimes denoted <span></span> instead of <span></span>. To be super precise, <span></span> is a generalization and means “any finite field with <span></span> elements”. <span></span> just happens to be one of those - and is the most popular one.</p>
<p>Now we go a step further and look at a concept called <strong>primitive root</strong>. Before explaining that, let’s take a look at a use case for them first.</p>
<p>Imagine you want a pseudorandom permutation of <span></span>, i.e., you don’t want the sequence <span></span> but a more random-looking sequence tha still hits all of these numbers. It doesn’t have to be cryptographically random or unpredictable. It just needs to look at bit random - perhaps to de-cluster memory writes for better wear-leveling. Primitive roots give us a nice implementation for that.</p>
<p>In <span></span>, multiplication never yields <span></span> unless you multiply by <span></span>. That means you can, e.g., keep doubling a number and will never accidentally hit <span></span>:</p>
<div><figure><pre data-language="plaintext"><code><div><p><span>1       = 1 mod 7</span></p></div><div><p><span>1 * 2   = 2 mod 7</span></p></div><div><p><span>1 * 2^2 = 4 mod 7</span></p></div><div><p><span>1 * 2^3 = 1 mod 7</span></p></div><div><p><span>1 * 2^4 = 2 mod 7</span></p></div><div><p><span>1 * 2^5 = 4 mod 7</span></p></div><div><p><span>1 * 2^6 = 1 mod 7</span></p></div><div><p><span>...</span></p></div></code></pre></figure></div>
<p>Oh look at that, a <em>cycle</em>! This is what will <em>always</em> happen in a finite field. When you keep multiplying by the same number, you will eventually reach the number you started with. And at that point, you are in a cycle.</p>
<p><span></span> is a bit impractical though because its induced cycle only ever hits the numbers <span></span> and never hits <span></span>. Note that <em>no</em> cycle will ever hit <span></span>, so the maximum cycle we can possible get with a modulus of <span></span> is cycle length <span></span>.</p>
<h3 id="primitive-roots-and-prime-factors">Primitive Roots and Prime Factors</h3>
<p>And there are indeed numbers that generate a full cycle!</p>
<div><figure><pre data-language="plaintext"><code><div><p><span># 3</span></p></div><div><p><span>1 * 3^0 = 1 mod 7</span></p></div><div><p><span>1 * 3^1 = 3 mod 7</span></p></div><div><p><span>1 * 3^2 = 2 mod 7</span></p></div><div><p><span>1 * 3^3 = 6 mod 7</span></p></div><div><p><span>1 * 3^4 = 4 mod 7</span></p></div><div><p><span>1 * 3^5 = 5 mod 7</span></p></div><div><p><span>1 * 3^6 = 1 mod 7</span></p></div><div><p><span>1 * 3^7 = 3 mod 7</span></p></div><div><p><span>...</span></p></div><div><p><span># 5</span></p></div><div><p><span>1 * 5^0 = 1 mod 7</span></p></div><div><p><span>1 * 5^1 = 5 mod 7</span></p></div><div><p><span>1 * 5^2 = 4 mod 7</span></p></div><div><p><span>1 * 5^3 = 6 mod 7</span></p></div><div><p><span>1 * 5^4 = 2 mod 7</span></p></div><div><p><span>1 * 5^5 = 3 mod 7</span></p></div><div><p><span>1 * 5^6 = 1 mod 7</span></p></div><div><p><span>1 * 5^7 = 5 mod 7</span></p></div><div><p><span>...</span></p></div></code></pre></figure></div>
<p>These numbers, numbers that induce a full cycle in a finite field, are called <em>primitive roots</em>. <span></span> and <span></span> are each primitive roots modulo <span></span>. Since their induced cycle has a length of <span></span>, the so-called <em>order</em> of <span></span> and <span></span> is <span></span>.</p>
<p>More generally, a primitive root <span></span> modulo some prime <span></span> is a number whose order is <span></span>, i.e., whose induced cycle has a length of <span></span>. In that case <span></span>. Expressed more formally: <span></span> is a primitive root modulo <span></span> if and only if the <em>smallest</em> <span></span> for which <span></span> is true, is <span></span></p>
<p>Now then how would you best check if a number <span></span> is a primitive root modulo <span></span>? The obvious solution is to just count <span></span> upwards from 1 through <span></span> and check <span></span> each time. That <em>works</em> but it can take a long time for big numbers. Turns out, we don’t have to check every possible <span></span> from <span></span> through <span></span>. To understand that, take a look at <span></span> from before:</p>
<div><figure><pre data-language="plaintext"><code><div><p><span>1       = 1 mod 7</span></p></div><div><p><span>1 * 2   = 2 mod 7</span></p></div><div><p><span>1 * 2^2 = 4 mod 7</span></p></div><div><p><span>...repeat</span></p></div></code></pre></figure></div>
<p>We can see that the cycle has length <span></span> and contains the numbers <span></span>. We <em>don’t</em> see the numbers <span></span>. But what happens when we use <span></span> but we <em>start</em> at <span></span>?</p>
<div><figure><pre data-language="plaintext"><code><div><p><span>3       = 3 mod 7</span></p></div><div><p><span>3 * 2^1 = 6 mod 7</span></p></div><div><p><span>3 * 2^2 = 5 mod 7</span></p></div><div><p><span>...repeat</span></p></div></code></pre></figure></div>
<p>Again, a cycle of <span></span>! And this time we’ve seen all the remaining numbers <span></span>. If we instead start at <span></span> or <span></span>, we will get the same cycle over <span></span>. So <span></span> splits the entire finite field excluding 0 into two subsets: <span></span> and <span></span>.</p>
<p>Let’s look at another example: <span></span> and try to find all cycles.</p>
<div><figure><pre data-language="plaintext"><code><div><p><span># start at 1</span></p></div><div><p><span>1 * 6^0 = 1 mod 7</span></p></div><div><p><span>1 * 6^1 = 6 mod 7</span></p></div><div><p><span>...repeat</span></p></div><div><p><span># start at 2</span></p></div><div><p><span>2 * 6^0 = 2 mod 7</span></p></div><div><p><span>2 * 6^1 = 5 mod 7</span></p></div><div><p><span>...repeat</span></p></div><div><p><span># start at 3</span></p></div><div><p><span>3 * 6^0 = 3 mod 7</span></p></div><div><p><span>3 * 6^1 = 4 mod 7</span></p></div><div><p><span>...repeat</span></p></div></code></pre></figure></div>
<p>So <span></span> partitions the non-zero elements into <span></span>`.</p>
<p>Notice how all those cycles induced by the same number always have the same size? If you think about it, then that makes perfect sense. When you have <span></span> but you “start at <span></span>”, you’re basically just taking the regular <span></span> cycle and multiply its elements by <span></span>. So the resulting cycle must have the same length: <span></span>.</p>
<p>And this isn’t a coincidence. In fact, all cycles induced by the same number <em>always</em> have the same length. And that number always partitions the entire finite field without <span></span> into disjoint sets of the same size.</p>
<p>How does that help us? Well, for <span></span> it makes the cycle lengths <span></span> and <span></span> impossible! Because you can’t cover all <span></span> non-zero elements <span></span> by splitting them into sets of size <span></span> or <span></span>. More generally, cycles lengths (and thus orders) must always be a divisor of <span></span>, i.e., the amount of all non-zero elements.</p>
<p>This is called <a href="https://en.wikipedia.org/wiki/Lagrange%27s_theorem_(group_theory)">Lagrange’s theorem</a>: The order of the subgroup divides the order of the whole group.</p>
<p>So to check if <span></span> is a primitive root, we don’t have to check all <span></span> from <span></span> through <span></span>. We only have to check all divisors of <span></span>! Also, we obviously don’t have to check <span></span>. The only number for which <span></span> is <span></span> itself, which <em>always</em> induces a cycle of <span></span> and is thus never a primitive root for <span></span>.</p>
<p>So we’re down to only having to check all divisors of <span></span> that are larger than <span></span>. That already eliminates most of the candidates.</p>
<p>But we can go <em>even further</em>!</p>
<h3 id="fast-primitivity-check">Fast Primitivity Check</h3>
<p>We only need to check <em>some</em> of the divisors. This is where prime factorization comes into play. Let’s say that we have the prime factors of <span></span>. We will call these prime factors <span></span>. Note that <span></span> itself does not have any prime factors because - well - it is a <em>prime number</em>. But <span></span> <em>does</em> have prime factors. In fact, <span></span> will always be one of those prime factors because <span></span> must be odd to be a prime and <span></span> must therefore be even.</p>
<p>Now what if I told you that we only need to check the divisors of <span></span> that we can obtain by dividing through a prime factor. Specifically, we only need to check</p>
<div><figure><pre data-language="plaintext"><code><div><p><span>(p-1) / q_1</span></p></div><div><p><span>(p-1) / q_2</span></p></div><div><p><span>...</span></p></div></code></pre></figure></div>
<p>Example:</p>
<div><figure><pre data-language="plaintext"><code><div><p><span>p   = 37</span></p></div><div><p><span>p-1 = 36</span></p></div><div><p><span><span>    </span></span><span>= 2 * 2 * 3 * 3</span></p></div><div><p><span>set of non-trivial divisors = {2, 3, 4, 6, 9, 12, 18}</span></p></div><div><p><span>set of prime factors        = {2, 3}</span></p></div><div><p><span>We only have to check</span></p></div><div><p><span><span>  </span></span><span>36 / 2 = 18</span></p></div><div><p><span><span>    </span></span><span>and</span></p></div><div><p><span><span>  </span></span><span>36 / 3 = 12</span></p></div><div><p><span>We don't have to check the other divisors</span></p></div><div><p><span>{2, 3, 4, 6, 9}</span></p></div></code></pre></figure></div>
<p>Why is that? Well, first of all, notice that the “other divisors” <span></span> are themselves divisors of either <span></span> or <span></span>:</p>
<div><figure><pre data-language="plaintext"><code><div><p><span>12 = 2 * 6</span></p></div><div><p><span><span>   </span></span><span>= 3 * 4</span></p></div><div><p><span><span>   </span></span><span>= 4 * 3</span></p></div><div><p><span><span>   </span></span><span>= 6 * 2</span></p></div><div><p><span>18 = 2 * 9</span></p></div><div><p><span><span>   </span></span><span>= 3 * 6</span></p></div><div><p><span><span>   </span></span><span>= 6 * 3</span></p></div><div><p><span><span>   </span></span><span>= 9 * 2</span></p></div></code></pre></figure></div>
<p>And if <span></span>, then that implies that</p>
<div><figure><pre data-language="plaintext"><code><div><p><span>g^2 != 1 mod 37</span></p></div><div><p><span>g^3 != 1 mod 37</span></p></div><div><p><span>g^4 != 1 mod 37</span></p></div><div><p><span>g^6 != 1 mod 37</span></p></div></code></pre></figure></div>
<p>and so on.</p>
<p>Why? Well, because <em>if</em> <span></span> <em>were</em> equal to one, then</p>
<div><figure><pre data-language="plaintext"><code><div><p><span><span> </span></span><span>g^6    = 1   mod 37</span></p></div><div><p><span>(g^6)^2 = 1^2 mod 37</span></p></div><div><p><span><span> </span></span><span>g^12   = 1   mod 37</span></p></div></code></pre></figure></div>
<p>and that is a contradiction! You can prove the same for any <span></span> in general if you want. The general proof works just like this example.</p>
<p>Alright, so we only have to check all possible <span></span> with <span></span> being a prime factor of <span></span>.</p>
<p>Here is a generator function that will return all primitive roots for a given prime modulus <span></span>:</p>
<div><figure><pre data-language="python"><code><div><p><span>def</span><span> </span><span>primitive_roots</span><span>(p):</span></p></div><div><p><span><span>    </span></span><span>N </span><span>=</span><span> p </span><span>-</span><span> </span><span>1</span></p></div><div><p><span><span>    </span></span><span>prime_factors </span><span>=</span><span> </span><span>set</span><span>(prime_factorization(N))</span></p></div><div><p><span>    </span><span>for</span><span> g </span><span>in</span><span> </span><span>range</span><span>(</span><span>2</span><span>, N </span><span>+</span><span> </span><span>1</span><span>):</span></p></div><div><p><span>        </span><span>for</span><span> q </span><span>in</span><span> prime_factors:</span></p></div><div><p><span>            </span><span>if</span><span> </span><span>pow</span><span>(g, N </span><span>//</span><span> q, p) </span><span>==</span><span> </span><span>1</span><span>:</span></p></div><div><p><span>                </span><span>break</span></p></div><div><p><span>        </span><span>else</span><span>:</span></p></div><div><p><span>            </span><span>yield</span><span> g</span></p></div></code></pre></figure></div>
<p>And you know what? Armed with this, we can not just find <strong>primitive roots</strong> but also <strong>primitive polynomials</strong>! We <em>just</em> need to translate this concept to polynomials!</p>
<p>… which is a bit tricky.</p>
<h3 id="binary-polynomials-irreducibility-and-primitive-elements">Binary Polynomials, Irreducibility and Primitive Elements</h3>
<p>Alright, first things first: Polynomials. They can look something like this:</p>

<p>And through the black magic of math, we can treat these polynomials as multidimensional numbers:</p>
<div><figure><pre data-language="plaintext"><code><div><p><span>Polynomial:   f(x) = 14x^4 + 2x^3 + 0x^2 + 53x + 42</span></p></div><div><p><span>Coefficients:       [14,     2,     0,     53,   42]</span></p></div></code></pre></figure></div>
<p>And on these, we can perform the same kind of arithmetic as on integers: Addition, Multiplication, Subtraction, Division - and thus Modulo. Dividing one polynomial by another sounds odd? It is. We’ll skip the details here since we’ve already derailed enough. Just know that the intuition from integer arithmetic carries over to polynomials.</p>
<p>Now keep in mind that we are working with <em>binary</em> polynomials, i.e., polynomials whose coefficients are either <span></span> or <span></span>. And we can represent those as integers. For example, <span></span> represents the polynomial</p>
<div><figure><pre data-language="plaintext"><code><div><p><span>Polynomial:             f(x) = 1x^5 + 1x^4 + 0x^3 + 0x^2 + 1x + 1</span></p></div><div><p><span>Binary coefficients:           1      1      0      0      1    1</span></p></div><div><p><span>Decimal representation:        51</span></p></div></code></pre></figure></div>
<p>We use these binary polynomials because they have a numbers of nice properties that things like BCH error correction codes rely on. For example, we can represent all binary strings of length <span></span> as a <span></span>-degree polynomial with binary coefficients. For integers, we’d represent those strings as integers from <span></span> to <span></span>. But we would have problems doing modular arithmetic on those strings because <span></span> isn’t necessarily prime and then <span></span> isn’t a field. For polynomials, there are nice and efficient ways to build a field over <span></span>-degree binary polynomials.</p>
<p>Throughout this section we have to keep in mind that the integer representation (<span></span> in the example above) is just a <em>representation of the polynomial in memory</em>. The polynomial is <em>not</em> an integer and we can’t just do regular <em>integer</em> arithmetic like addition and multiplication with Python’s <code>+</code> and <code>*</code> with it. Polynomials have their own arithmetic and they work differently.</p>
<p>Since we are dealing with binary polynomials, the coefficients of the polynomials are all either <span></span> or <span></span>. More formally, the coefficients are elements of <span></span>, which is basically the same as <span></span> or “mod 2”.</p>
<p>The set of all binary polynomials is called <span></span>. In CompSci terms, these are all possible bit arrays.</p>
<p>So since we’re moving from working on integers to working on binary polynomials, <span></span> is our binary polynomial-equivalent of <span></span>, with <span></span> being all integers and <span></span> being all binary polynomials.</p>
<p>While we used <span></span> to represent a single integer in <span></span>, we will use <span></span> to represent a single polynomial in <span></span>.</p>
<p>Similar to how <span></span> is the set of all multiples of n, <span></span> is the set of all multiples of <span></span> - <em>notice the double-paranthesis</em>.</p>
<p>And similar to how <span></span> is <span></span> but treating two integers as equivalent if their difference is a multiple of <span></span>, <span></span> is <span></span> but treating two polynomials as equivalent if their difference is a multiple of <span></span>. It is essentially “mod <span></span>” in polynomial world.</p>
<p>If we have an integer <span></span> and <span></span> can’t be divided by another integer, then <span></span> is <em>prime</em>. Analogously, if we have a polynomial <span></span> and <span></span> can’t be reduced by another polynomial, then <span></span> is <strong>irreducible</strong>.</p>
<p>If <span></span> is prime, then there is at least one <em>primitive root</em> <span></span> in <span></span>, so that <span></span> spans the entire <span></span>. If <span></span> is irreducible, then there is at least one <strong>primitive element</strong> <span></span> in <span></span> so that <span></span> spans the entire <span></span>.</p>
<p>(Side note: “primitive root” is a legacy term only used for <span></span>. “primitive element” is the general term. They mean the same thing.)</p>
<p>Also, while the order of <span></span> is just <span></span>, the order of <span></span> is <span></span>, which is the amount of all possible <span></span>-bit arrays.</p>
<p>Now we are almost there! We have already come far enough where we can recognize that an irreducible polynomial <span></span> is analogous to a prime integer <span></span>.</p>
<p>Now, what is a <strong><em>primitive</em> polynomial</strong> then?</p>
<h3 id="primitive-polynomials">Primitive Polynomials</h3>
<p>Well, that’s simple! A <em>primitive</em> polynomial is an irreducible polynomial with one additional requirement:</p>
<p>The super simple polynomial
<span></span>
must be a primitive element, i.e., <span></span> must span the entire <span></span>.</p>
<p>Why is that useful? Well, because that means that every non-zero polynomial in <span></span> can be represented as <span></span> for some integer <span></span>. So every non-zero polynomial can be represented as an integer and we have a random-looking permutation of all non-zero binary polynomials in <span></span>.</p>
<p>And <em>that</em> is what BCH codes use and why we require a primitive polynomial.</p>
<p>Now, how do we calculate all primitive polynomials then? We don’t. There are infinitely many. But we can calculate all primitive polynomials of some specific degree <span></span>! And how do we do that? Well, using what we have already built for finding primitive roots for integers:</p>
<ul>
<li>Iterate through all possible polynomials of degree <span></span>. For each candidate <span></span>, <strong>(step 1)</strong>
<ul>
<li>check if <span></span> irreducible. Discard if not. <strong>(step 2)</strong></li>
<li>check if <span></span> (the simple polynomial with integer representation 2) is a primitive element in the finite field induced by <span></span>. <strong>(step 3)</strong>
<ul>
<li>the wanted cycle length <span></span> is the amount of all possible polynomials of degree <span></span>:
<span></span></li>
<li>get all prime factors <span></span> of <span></span></li>
<li>check if <span></span> for all prime factors <span></span></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>For (step 1)</strong>, we want a primitive polynomial with degree <span></span>, so we only consider polynomials where their m-th coefficient is 1 and all higher-order coefficients are 0. This means that their integer representations are in</p>
<p><code>range(2^m, 2^(m+1))</code>.</p>
<p>To speed it up by factor 2: We can’t have any polynomials where the constant term, i.e., the lowest-order coefficient is zero. Example:</p>
<p><span></span> (note that there is no <span></span> at the end)</p>
<p>That’s because every polynomial with a zero constant term is divisible by the polynomial <span></span> and is thus not irreducible and thus not primitive. So we only iterate over polynomials with a constant term of <span></span>. In the integer representation, those are the odd integers, so we use</p>
<p><code>range(2^m + 1, 2^(m-1), 2)</code></p>
<p><strong>For (step 2)</strong>, checking whether a polynomial is irreducible is the analogue to checking whether an integer is prime.</p>
<p>Ruling out even integer representations of polynomials in (1) skips half the possible candidates because those are all reducible. Unfortunately, there will still be plenty of reducible polynomials left. Just like there are a lot of non-prime numbers among the odd integers.</p>
<p>For a full irreducibility test, we use <a href="https://en.wikipedia.org/wiki/Factorization_of_polynomials_over_finite_fields#Rabin's_test_of_irreducibility">Rabin’s Test</a>. The implementation has a similar structure as the <a href="https://en.wikipedia.org/wiki/Miller%E2%80%93Rabin_primality_test">Rabin-Miller Test</a> for integers. We won’t cover either here because this section is long enough already.</p>
<div><figure><pre data-language="python"><code><div><p><span>def</span><span> </span><span>is_reducible</span><span>(fx):</span></p></div><div><p><span>    </span><span># check irreducible with rabin's irreducibility test</span></p></div><div><p><span>    </span><span>#   for all k &lt;= n//2, check that</span></p></div><div><p><span>    </span><span>#   x^(2^k) - x does not divide fx</span></p></div><div><p><span><span>    </span></span><span>degree </span><span>=</span><span> fx.bit_length() </span><span>-</span><span> </span><span>1</span></p></div><div><p><span><span>    </span></span><span>x </span><span>=</span><span> </span><span>2</span></p></div><div><p><span><span>    </span></span><span>y </span><span>=</span><span> x</span></p></div><div><p><span>    </span><span>for</span><span> _ </span><span>in</span><span> </span><span>range</span><span>(degree </span><span>//</span><span> </span><span>2</span><span> </span><span>+</span><span> </span><span>1</span><span>):</span></p></div><div><p><span>        </span><span># y = y^2 mod fx</span></p></div><div><p><span><span>        </span></span><span>y </span><span>=</span><span> poly_mod(poly_mul(y, y), fx)</span></p></div><div><p><span><span>        </span></span><span>y_minus_x </span><span>=</span><span> y </span><span>^</span><span> x</span></p></div><div><p><span>        </span><span>if</span><span> poly_gcd(y_minus_x, fx) </span><span>!=</span><span> </span><span>1</span><span>:</span></p></div><div><p><span>            </span><span>return</span><span> </span><span>False</span></p></div><div><p><span>    </span><span>#   check that fx divides</span></p></div><div><p><span>    </span><span>#   x^(2^n) - x</span></p></div><div><p><span>    </span><span>for</span><span> _ </span><span>in</span><span> </span><span>range</span><span>(degree </span><span>//</span><span> </span><span>2</span><span> </span><span>+</span><span> </span><span>1</span><span>, degree):</span></p></div><div><p><span><span>        </span></span><span>y </span><span>=</span><span> poly_mod(poly_mul(y, y), fx)</span></p></div><div><p><span>    </span><span>return</span><span> y </span><span>==</span><span> x</span></p></div></code></pre></figure></div>
<p><strong>For (step 3)</strong>, we do the same as for primitive roots in integer-world, except we use a polynomial-compatible <code>pow</code> function:</p>
<div><figure><pre data-language="python"><code><div><p><span>def</span><span> </span><span>primitive_binary_polynomials</span><span>(degree):</span></p></div><div><p><span><span>    </span></span><span>n </span><span>=</span><span> </span><span>2</span><span>**</span><span>degree </span><span>-</span><span> </span><span>1</span></p></div><div><p><span><span>    </span></span><span>prime_factors </span><span>=</span><span> </span><span>set</span><span>(prime_factorization(n))</span></p></div><div><p><span><span>    </span></span><span>x </span><span>=</span><span> </span><span>2</span></p></div><div><p><span>    </span><span>for</span><span> fx </span><span>in</span><span> </span><span>range</span><span>(</span><span>2</span><span>**</span><span>degree </span><span>+</span><span> </span><span>1</span><span>, </span><span>2</span><span> </span><span>**</span><span> (degree </span><span>+</span><span> </span><span>1</span><span>), </span><span>2</span><span>):</span></p></div><div><p><span>        </span><span># check irreducible</span></p></div><div><p><span>        </span><span>if</span><span> </span><span>not</span><span> is_reducible(fx):</span></p></div><div><p><span>            </span><span>continue</span></p></div><div><p><span>        </span><span># check primitive</span></p></div><div><p><span>        </span><span>for</span><span> q </span><span>in</span><span> prime_factors:</span></p></div><div><p><span>            </span><span>if</span><span> poly_pow_mod(x, n </span><span>//</span><span> q, fx) </span><span>==</span><span> </span><span>1</span><span>:</span></p></div><div><p><span>                </span><span>break</span></p></div><div><p><span>        </span><span>else</span><span>:</span></p></div><div><p><span>            </span><span>yield</span><span> fx</span></p></div></code></pre></figure></div>
<h3 id="finding-all-primitive-polynomials">Finding all Primitive Polynomials</h3>
<p>And now we can <em>finally</em> compute all the primitive polynomials with degree 14. The full script is attached in the addendum. It takes about 1 second (single-threaded, on my laptop) to list all 756 primitive polynomials for degree 14. Yes - there are only 756!</p>
<div><figure><pre data-language="plaintext"><code><div><p><span>All primitive polynomials of degree 14:</span></p></div><div><p><span>16427 = 0b100000000101011</span></p></div><div><p><span>16441 = 0b100000000111001</span></p></div><div><p><span>16467 = 0b100000001010011</span></p></div><div><p><span>16479 = 0b100000001011111</span></p></div><div><p><span>16507 = 0b100000001111011</span></p></div><div><p><span>16553 = 0b100000010101001</span></p></div><div><p><span>...</span></p></div><div><p><span>32653 = 0b111111110001101</span></p></div><div><p><span>32671 = 0b111111110011111</span></p></div><div><p><span>32709 = 0b111111111000101</span></p></div><div><p><span>32721 = 0b111111111010001</span></p></div><div><p><span>32743 = 0b111111111100111</span></p></div><div><p><span>Total primitive polynomials of degree 14: 756</span></p></div></code></pre></figure></div>
<p>And how much faster does this make our script compared to the naive
<code>range(2**14 + 1, 2**15, 2)</code>
that lists half of all possible binary polynomials of degree 14?</p>
<p>About 1 second on a single-threaded run on my laptop…</p>
<p>Turns out just throwing a bunch of mostly non-primitive polynomials against bchlib and catching the exception is just as fast as doing it properly…</p>
<p>Oh, and you know what? You could have also just pulled a list of all primitive polynomials of degree 14 from the internet. Because, well, we aren’t the first to generate that list.</p>
<p>But hey, we learned some math.</p> </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[HNInternal: Ask HN: Is it still worth pursuing a software startup? (104 pts)]]></title>
            <link>https://news.ycombinator.com/item?id=46654726</link>
            <guid>46654726</guid>
            <pubDate>Sat, 17 Jan 2026 02:29:07 GMT</pubDate>
            <description><![CDATA[<p>See on <a href="https://news.ycombinator.com/item?id=46654726">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><tbody><tr id="46658745"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46658745" href="https://news.ycombinator.com/vote?id=46658745&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Is “software startup” the right term? I understand that you might want to “use software” in the startup but surely, in the most successful startups, the thing that makes them successful is that they solve a real problem, that real people/businesses have, and are prepared to “pay” [1] you to solve for them.</p><p>If the startup is just “software for the sake of software” then I think that’s a different thing entirely. And to be fair, sometimes software for the sake of it is more like art or fun. And it’s true, sometimes something wonderful comes out of that. Sometimes. :)</p><p>[1]: Obviously “pay” can mean _very_ different things in different contexts.</p></div></td></tr></tbody></table></td></tr><tr id="46658747"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46658747" href="https://news.ycombinator.com/vote?id=46658747&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Big companies are not your worry in most cases. They have so much bureaucracy and internal politics that it's often cheaper for them to buy out the up-and-coming startups than it is to build in-house.</p><p>Instead, if you achieve success without much of a moat, you will be cloned by one of the "App Store mills". These are companies who employ multiple small teams (think 3-4 people), and each team is charged with cloning one of the most popular apps - they have really abbreviated development cycles, on the order of 6 weeks, and they just keep churning till they've drowned every app on the leaderboard in clones. And because they are astroturfing the whole space, they don't actually need most of these clones to be individually profitable.</p></div></td></tr></tbody></table></td></tr><tr id="46657949"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46657949" href="https://news.ycombinator.com/vote?id=46657949&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>&gt; Big companies can copy your product in no time</p><p>Your advantage in this case, now or 10 years ago, is that this is simply not true.</p><p>If your business is "a flashlight app", yeah, eventually they'll copy it (as it happened). However they'll take an unusual long time to do that simple thing (as it also happened).</p><p>Why? Because everything at big companies is a political game, full of internal conflicts, multiple priorities, non-collaborative teams, self-interest, promotion games, and a bunch of other things not really related to build the thing in question. It <i>very rarely</i> has anything to do with how fast the code can be written.</p><p>If your business is good enough and becomes something more than "a piece of software", and solves a problem, becomes a brand, has great user feedback... that's not something you can "copy in no time".</p></div></td></tr></tbody></table></td></tr><tr id="46658431"><td><table><tbody><tr><td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td><center><a id="up_46658431" href="https://news.ycombinator.com/vote?id=46658431&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Don’t worry big companies still can’t copy anything quickly, even with AI. Why? Because before they can ship a single feature, they’ll need to schedule 42 alignment meetings, debate AI-generated slide decks, and log their “strategic pivots” into an AI-curated Jira board.</p><p>The real moat isn’t just code it’s speed, focus, user trust, and the ability to actually ship. Those are things bloated orgs struggle with, with or without AI. If you’re solving a real problem and building a real brand, you’re already ahead.</p></div></td></tr></tbody></table></td></tr><tr id="46658560"><td></td></tr><tr id="46658651"><td></td></tr><tr id="46658156"><td><table><tbody><tr><td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td><center><a id="up_46658156" href="https://news.ycombinator.com/vote?id=46658156&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>While I agree with sone of your points, there are many evidences that this happened in the past.</p><p>One example is Microsoft creating teams to take on Slack.</p></div></td></tr></tbody></table></td></tr><tr id="46658357"><td></td></tr><tr id="46658416"><td><table><tbody><tr><td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td><center><a id="up_46658416" href="https://news.ycombinator.com/vote?id=46658416&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Teams is still nowhere near Slack's features and usefulness. I wouldn't say it's a direct competitor, it's like store brand vs a mid-luxury item</p></div></td></tr></tbody></table></td></tr><tr id="46658758"><td><table><tbody><tr><td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td><center><a id="up_46658758" href="https://news.ycombinator.com/vote?id=46658758&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>If, knowing what you know now, you could go back and time and be the one to create Slack would you not do it? Even if everyone is using Teams now (they're not), it took a really long time to show up.</p><p>The only thing that has changed in the software landscape today is the apparent ability to develop a competitor faster thanks to LLMs. <i>But</i> as the parent points out, the bottleneck was never code writing. It was waiting on the people involved to get past their egos. LLMs have done nothing to resolve the latter.</p></div></td></tr></tbody></table></td></tr><tr id="46658671"><td><table><tbody><tr><td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td><center><a id="up_46658671" href="https://news.ycombinator.com/vote?id=46658671&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>I couldn’t agree more. In fact I think the exact opposite of the original statement might be true: Find a product made by a big corporation that is a great concept but has clearly suffered from an internal shitshow of a team for some time, and copy it. If other corporations are sloppily copying it - even better. That just means the product has actual market fit.</p></div></td></tr></tbody></table></td></tr><tr id="46658147"><td></td></tr><tr id="46658229"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46658229" href="https://news.ycombinator.com/vote?id=46658229&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Yes, big companies can copy your product. But at what cost, especially when including opportunity cost and the levels of bureaucracy in larger companies? I have heard your question many times during the last 20 years, and still there are more software startups.</p><p>In many cases it would cost them less to buy your company than to create it from scratch. Which is why so many small companies are acquired instead of copied. The question should be more what do you want to do and are you able to follow up on creating a startup? Writing the code is a small part of creating a successful startup</p></div></td></tr></tbody></table></td></tr><tr id="46658047"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46658047" href="https://news.ycombinator.com/vote?id=46658047&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>It’s still hard to create something successful.</p><p>Remember that Mark Zuckerberg has had “AGI” for over a decade in the form of tens of thousands of human software engineers and Facebook still has barely been able to create a new successful product on their own without acquiring it from a smaller company.</p></div></td></tr></tbody></table></td></tr><tr id="46658228"><td><table><tbody><tr><td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td><center><a id="up_46658228" href="https://news.ycombinator.com/vote?id=46658228&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>&gt; Mark Zuckerberg has had “AGI” for over a decade in the form of tens of thousands of human software engineers</p><p>This makes me think that companies like Open AI, Anthropic etc are simply new types of body shoppers. body shoppers don’t have their own products they just supply talent to help other companies make products and services.</p></div></td></tr></tbody></table></td></tr><tr id="46658602"><td></td></tr><tr id="46658094"><td></td></tr><tr id="46658118"><td></td></tr><tr id="46658487"><td><table><tbody><tr><td indent="3"><img src="https://news.ycombinator.com/s.gif" height="1" width="120"></td><td><center><a id="up_46658487" href="https://news.ycombinator.com/vote?id=46658487&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>I worked for oculus, well reality labs.</p><p>Lots of talented people, and decent hardware, once the stupid politics was overcome.</p><p>But.</p><p>In all the time I worked there, we never managed to get "join my friends" feature get made. Trying to join your friends in a game was so fucking hard. You'd think being a social company, who's whole point is connecting people, this would be the first feature.</p><p>But no.</p><p>Threads is the only product they have launched in the last 5 years that anything close to successful. Even then it only launched because management ignored it, let them get an MVP out the door before swelling the size of the team from ~8(?) to &gt;&gt;2k
The time to fun was also waaay too high. it got better towards the end, but in 2020-2023 it would take ages to log in, update, load, get kicked out, reboot and then join.</p></div></td></tr></tbody></table></td></tr><tr id="46658777"><td><table><tbody><tr><td indent="3"><img src="https://news.ycombinator.com/s.gif" height="1" width="120"></td><td><center><a id="up_46658777" href="https://news.ycombinator.com/vote?id=46658777&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Oculus was shipping hardware/software before the Facebook acquisition, and proceeded to slowly bleed out post-acquisition. We shipped a few decent VR headsets in the middle there (Quest 1, 2 and 2s/3), but most of the other initiatives within Meta's reality labs withered on the corporate vine...</p></div></td></tr></tbody></table></td></tr><tr id="46658609"><td></td></tr><tr id="46658149"><td></td></tr><tr id="46658290"><td></td></tr><tr id="46658666"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46658666" href="https://news.ycombinator.com/vote?id=46658666&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>&gt; Considering there is very little moat left in software and big companies can copy your product in no time?</p><p>Your task in a software startup (or any startup) is to produce the moat.  If you can create something with little effort in a few weeks or months then so can anyone else.</p><p>If your product does something hard or useful that you know how to do because you understand the audience or business, or includes data or knowledge that others may not know about or have, or just you can put the effort in to great service to build a large customer base it becomes harder to be copied.</p></div></td></tr></tbody></table></td></tr><tr id="46658685"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46658685" href="https://news.ycombinator.com/vote?id=46658685&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>A software startup has always, always been a longshot.  This is still true.  Also, vanishingly few companies of any kind, including software, ever get a "moat".  Small companies survive, when they do, by being fast moving enough to keep making new things.</p><p>You certainly should not start a software startup to get rich, as that was never the most likely outcome.  You should start one if you have an idea for software that isn't out there, which you think people would find useful, and you want to see what it's like to do a startup (enough to give it several years of your life).</p><p>I have, btw, never founded a software startup, though I have worked at some.  I got paid in salary, not equity.  It is now, always was, and probably always will be a longshot.</p></div></td></tr></tbody></table></td></tr><tr id="46658754"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46658754" href="https://news.ycombinator.com/vote?id=46658754&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>&gt; Considering there is very little moat left in software and big companies can copy your product in no time?</p><p>Whenever you have doubts about your ability to do something enough to ask for advice from random people you don’t know, and if that thing is unnecessary and will be significantly difficult, like a startup that is just some option for you to work on, the answer is probably no.</p><p>You have to feel the true desire to make something happen because you must. Anything other than that is probably a bad idea.</p></div></td></tr></tbody></table></td></tr><tr id="46658684"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46658684" href="https://news.ycombinator.com/vote?id=46658684&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>The opposite is increasingly true…</p><p>I spent the past 6 months rebuilding a medium-size company’s CRM.</p><p>They were on Salesforce for a decade, and now they’ll own their data based on the work of a single engineer.</p><p>For Salesforce, the moat is increasingly the inertia that comes from big-company contracts and the perceived safety of buying Salesforce.</p><p>Society is experiencing the first wave of the true Cambrian explosion of software and there’s never been a better time to be an indie maker. Never. This is like the iOS App Store moment, but multiplied by 100 and expected to last 10x longer.</p></div></td></tr></tbody></table></td></tr><tr id="46658198"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46658198" href="https://news.ycombinator.com/vote?id=46658198&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Yes, otherwise there wouldn't be billions of dollars flowing into seed rounds every year to make novel products.</p><p>Not sure why you think a large company can copy a product in no time, they have to steer a cargo ship, you have a speed boat.</p></div></td></tr></tbody></table></td></tr><tr id="46654899"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46654899" href="https://news.ycombinator.com/vote?id=46654899&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Yes! All startups are created to solve a problem, regardless of the tools used. Apps are simply tools to solve human problems. Because humans will always have challenges to address, software will remain a vital tool. While AI makes writing software much easier. It's likely to lead to an explosion of new apps. Only those that fill a genuine need will survive. Your job is to identify these new problems and determine which apps to build.</p><p>Simple apps are a thing of the past. If an LLM can generate an app in a few sittings, it isn't a saleable product. However, people will still pay for a fully engineered application that solves a complex problem that AI cannot easily replicate.</p><p>Regarding copies, there is always room for more than one solution to the same need. Your challenge is to figure out how to stand out. A fundamental business hurdle, that has existed since the beginning.</p><p>Here's an idea that always bear's fruit. We humans love to do things as easy as possible. Write something that saves energy, time and is simple then people will pay for it.</p></div></td></tr></tbody></table></td></tr><tr id="46657858"><td><table><tbody><tr><td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td><center><a id="up_46657858" href="https://news.ycombinator.com/vote?id=46657858&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>&gt; All startups are created to solve a problem</p><p>And most of the time that problem is “the founders don’t have as much money as they want”.</p><p>&gt; Apps are simply tools to solve human problems. Because humans will always have challenges to address, software will remain a vital tool.</p><p>You make it sound like it’s something noble, but let’s not pretend most software companies these days don’t have “make me rich” as the top goal. Effectively everything VC backed (yes, including by Y Combinator) falls in that category. That’s why pivots are a thing. Most founders these days don’t give a shit about what they’re building or customers, they only care about the payoff.</p></div></td></tr></tbody></table></td></tr><tr id="46657921"><td><table><tbody><tr><td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td><center><a id="up_46657921" href="https://news.ycombinator.com/vote?id=46657921&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>That's a cynical take, but a more positive interpretation is that pivots are needed if your company isn't actually solving a problem. Otherwise people would pay for it, and the founders would be getting rich. So you need to pivot until you actually create a solution to a problem that people will pay for.</p></div></td></tr></tbody></table></td></tr><tr id="46657997"><td><table><tbody><tr><td indent="3"><img src="https://news.ycombinator.com/s.gif" height="1" width="120"></td><td><center><a id="up_46657997" href="https://news.ycombinator.com/vote?id=46657997&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>&gt; That's a cynical take</p><p>One that you apparently agree with, given the rest of your comment.</p><p>&gt; you need to pivot until you actually create a solution to a problem that people will pay for.</p><p>In other words: You don’t care about the problem, you care about the profit from selling <i>a</i> solution.</p><p>If a startup is “created to solve a problem” and then pivots to solve a <i>different</i> problem because the first one wasn’t profitable, that means profit was the priority, not solving the problem.</p></div></td></tr></tbody></table></td></tr><tr id="46658186"><td></td></tr><tr id="46658324"><td><table><tbody><tr><td indent="5"><img src="https://news.ycombinator.com/s.gif" height="1" width="200"></td><td><center><a id="up_46658324" href="https://news.ycombinator.com/vote?id=46658324&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>“The”, not “a”.</p><p>There is a chasm of difference between “I care about this problem and want to solve it, but I also need to think how to make it sustainable” and “I don’t really care what I’m tackling, as long as I make bank”.</p><p>Both exist. The second one is ever more the norm.</p></div></td></tr></tbody></table></td></tr><tr id="46658503"><td></td></tr><tr id="46658735"><td><table><tbody><tr><td indent="7"><img src="https://news.ycombinator.com/s.gif" height="1" width="280"></td><td><center><a id="up_46658735" href="https://news.ycombinator.com/vote?id=46658735&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>I would expect it to be obvious that caring about making money <i>above</i> fixing a problem means the problem won’t be solved that well compared to the alternative.</p><p>Are you really going to claim you never encountered a startup that is obviously shitting on customers and degrading the experience to make a buck? If that is the case, search the term “enshittification”. Surely you’ll have encountered it by now. Pick whatever example helps you understand the point.</p></div></td></tr></tbody></table></td></tr><tr id="46655142"><td></td></tr><tr id="46655437"><td><table><tbody><tr><td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td><center><a id="up_46655437" href="https://news.ycombinator.com/vote?id=46655437&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>This is why I like using mathematical or algorithmic approaches to solve difficult problems. Writing programs that use statistics, mathematics, optimization, analytical geometry, etc guarantee a certain level of security from the swarms of CRUD merchants flooding the market.</p></div></td></tr></tbody></table></td></tr><tr id="46655206"><td></td></tr><tr id="46658136"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46658136" href="https://news.ycombinator.com/vote?id=46658136&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>There was never a statistical “advantage”, you just never heard about the 9/10 outright failures or even the parts of the 1/10 where people are toiling in obscurity and would have been better off financially “grinding leetcode and working for a FAANG” ((c) r/cscareerquestions) or even being an enterprise dev in a tier 2 city.</p></div></td></tr></tbody></table></td></tr><tr id="46658592"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46658592" href="https://news.ycombinator.com/vote?id=46658592&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>That's always been the case, in software and elsewhere.</p><p>Yet, Ford didn't copy Tesla, why not?</p><p>Checkout <a href="https://en.wikipedia.org/wiki/The_Innovator%27s_Dilemma" rel="nofollow">https://en.wikipedia.org/wiki/The_Innovator%27s_Dilemma</a> but overall the idea is that large corporations have totally different goals and incentive than startups. Also check <a href="https://steveblank.com/" rel="nofollow">https://steveblank.com</a> and his startup owner manual trying to clarify that a startup is NOT a small company, rather it's searching for a product/market fit.</p><p>So is it worth pursuing a (software) startup?</p><p>Honestly if you want to make money, no. It's much easier to work for a large corporation (big economical benefits) or a public institution (work safety). You might not get ridiculously rich either way but you will be safer than most.</p><p>If you want to make a ridiculous amount of money though, well you might have to make sacrifices you are underestimating. I don't want to promote the grind culture but checkout Silicon Valley, the TV show, in particular when they discuss VC and promises done. Basically if you ask for a very high valuation you have to deliver on those claims and obviously they investors are going to keep you accountable on that. You might have to work more than you wanted (which might make the whole process a nightmare more than a joy) but more dangerously you might lose the very raison d'etre of the company you founded. If it's "just" about making money, you won't care, if you have a genuine mission, those compromises are going to eat you alive.</p><p>So... is it "worth it" very much depend on who you are, who you want to be and how saturated the market is.</p><p>I wouldn't worry about the big corporations, I would worry about what you can actually deliver and how not being able to do so will change you along the way.</p></div></td></tr></tbody></table></td></tr><tr id="46655096"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46655096" href="https://news.ycombinator.com/vote?id=46655096&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Maybe. great businesses don't need moats. They just need sonething people buy from them. Maybe venture capital needs moats - but you can get rich without that. (If rich is even the goal - a nice life is a better goal)</p><p>beware of any business where there is no competition - there is generally good reason nobody else is making money there.</p></div></td></tr></tbody></table></td></tr><tr id="46655090"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46655090" href="https://news.ycombinator.com/vote?id=46655090&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>In my experience (enterprise software), customers buy our products not because we have a moat or some hard-to-achieve technical advantage but because they can speak to us in their words, they know we care, and we try solve their problems quickly.</p><p>Just yesterday I was speaking with the COO of a $200M/yr revenue company in the supply chain space. He'd learned Claude Code and built a couple apps to solve internal problems but reached out to talk to us. I asked him "you've been able to build some really impressive tools, clearly you can solve your own problems, why are you talking to me?" And he said "I have a business to run. I shouldn't be coding. I need somebody who understands my business &amp; can solve my problems without taking a lot of my time."</p><p>Is there a cheaper way for him to solve his problems? Absolutely. But he wants to put the key in the ignition and know the car will turn on every time without thinking about it. There is an endless list of problems to solve; I don't think software businesses are going anywhere anytime soon.</p></div></td></tr></tbody></table></td></tr><tr id="46655394"><td><table><tbody><tr><td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td><center><a id="up_46655394" href="https://news.ycombinator.com/vote?id=46655394&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>This should be the top comment. The thing about growth of businesses overall, is that they want outsourced capacity (that’s what employees or contractors are) and that dynamic doesn’t go away because of AI, because like the comment mentioned, it’s not reliable enough in the sense that it can accept high-context vague instructions and ‘figure it out’ like an enterprise developer can.</p></div></td></tr></tbody></table></td></tr><tr id="46655226"><td></td></tr><tr id="46655283"><td></td></tr><tr id="46655404"><td><table><tbody><tr><td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td><center><a id="up_46655404" href="https://news.ycombinator.com/vote?id=46655404&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Yeah, this is how we survive.</p><p>I even dream of build tools for business to make apps (like Air table, but better) and even if you can do anything that do, perfectly, the software they need not means they <i>want</i> to babysit it all the time.</p><p>Is like the person that knows how cook, amazingly, yet hire a chef for take care of it most days.</p></div></td></tr></tbody></table></td></tr><tr id="46655936"><td><table><tbody><tr><td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td><center><a id="up_46655936" href="https://news.ycombinator.com/vote?id=46655936&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Obviously a COO shouldnt be prompting Claude Code but your competition is someone in their team doing the same. The person in their team is trusted and knows the business.</p></div></td></tr></tbody></table></td></tr><tr id="46656033"><td></td></tr><tr id="46658429"><td></td></tr><tr id="46655798"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46655798" href="https://news.ycombinator.com/vote?id=46655798&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>&gt; Considering there is very little moat left in software and big companies can copy your product in no time?</p><p>Having worked in the corporate world all my working life I can safely say with confidence that big companies absolutely DO NOT move fast. Do not underestimate the power of middle-management to destroy momentum!</p><p>Solve a problem for someone and if it was a painful one, they'll pay you for it.</p></div></td></tr></tbody></table></td></tr><tr id="46658013"><td><table><tbody><tr><td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td><center><a id="up_46658013" href="https://news.ycombinator.com/vote?id=46658013&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>An interesting paper in this context is "Structural Inertia and Organizational Change" by Hannan and Freeman, 1984 [1].  A quote from the introduction: <i>"...selection processes tend to favor organizations whose structures are difficult to change."</i>.</p><p>In other words, it's typically a <i>good</i> thing that larger companies are slow to adapt.  That's something that startups can make use of.</p><p>[1] <a href="https://www.jstor.org/stable/2095567" rel="nofollow">https://www.jstor.org/stable/2095567</a></p></div></td></tr></tbody></table></td></tr><tr id="46655168"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46655168" href="https://news.ycombinator.com/vote?id=46655168&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>It is. Big companies (or really anyone) usually don't have the time to copy an idea unless it becomes too big already. And if your idea becomes too big, it was worth pursuing it.</p></div></td></tr></tbody></table></td></tr><tr id="46655266"><td><table><tbody><tr><td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td><center><a id="up_46655266" href="https://news.ycombinator.com/vote?id=46655266&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Or worth buying up. Which in many cases was the "purpose" of doing the startup in the first place.</p><p>Sure, we'd all like to think that the goal was an idealistic "startup does things for bettering humankind".</p><p>But let's face it: A large amount of startups are literally founded as an "easier" alternative of building a "more agile" sub-organization within an established and more process driven org and then just get bought out by some of those larger orgs.</p><p>Whether or not those large orgs are then actually successful in integration and actually properly leveraging what they bought vs. just "crushing competition", is not necessarily the concern of the founders, depending on how ruthless vs. idealistic they are.</p></div></td></tr></tbody></table></td></tr><tr id="46657910"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46657910" href="https://news.ycombinator.com/vote?id=46657910&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>if you have to ask the answer is no.</p><p>if you are young there’s still hope that you can change your mindset and approach though.</p><p>if software can save time and make money than human capital then there will be demand.</p></div></td></tr></tbody></table></td></tr><tr id="46657958"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46657958" href="https://news.ycombinator.com/vote?id=46657958&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Since the majority of our industry is still in a combination denial/disbelief and bureaucratic incompatibility with AI workflows, startups are increasingly well positioned to reap the rewards.</p><p>The way I think about it is, everyone is struggling to make AI tools work well, so if you can be in the top 50% of people trying, you're actually in the top 10% in terms of positioning for future growth.</p></div></td></tr></tbody></table></td></tr><tr id="46656398"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46656398" href="https://news.ycombinator.com/vote?id=46656398&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Yes! Coding is just one of the tasks you've got to do when building a software business. You also have to find a good value preposition, identify a good channel to your customers, manage your resources etc.</p><p>Channels are becoming even more important as software has become easy to copy. But copycats always existed. When it wasn't created by AI, it was created in low wage countries.</p></div></td></tr></tbody></table></td></tr><tr id="46658639"><td><table><tbody><tr><td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td><center><a id="up_46658639" href="https://news.ycombinator.com/vote?id=46658639&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>I’ve recently realized that behind each copycat, there is an entrepreneur. It’s not a big factory with written “Leading #1 in piracy” at the front. It’s someone with almost as many skills as the original entrepreneurs, trying to copy a few of them to see where there is traction, with hopes and dreams similar to the original, but too far away from the world’s center of activity to propose something relevant. Some of them probably do it with the “I can do it better than them” mindset.</p></div></td></tr></tbody></table></td></tr><tr id="46655302"><td></td></tr><tr id="46655141"><td></td></tr><tr id="46655369"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46655369" href="https://news.ycombinator.com/vote?id=46655369&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>You're asking what's a defensible value-add, but without really framing current business conditions or issues.</p><p>Time - opportunity - matters a lot, perhaps more than anything.  And to face that, one needs to ask better questions (even if you're just polling).</p></div></td></tr></tbody></table></td></tr><tr id="46655406"><td><table><tbody><tr><td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td><center><a id="up_46655406" href="https://news.ycombinator.com/vote?id=46655406&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>"Current business conditions or issues" -- I think that's because OP wants you to fill that in yourself, so that you might explain your assumptions or the market potential that you see, which might be wildly different from his (i.e. software having little to no moat)</p></div></td></tr></tbody></table></td></tr><tr id="46655180"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46655180" href="https://news.ycombinator.com/vote?id=46655180&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Thought this would be a thread about the crazy offers being handed out to join AI teams at Amazon, Meta, Google, OpenAI, Anthropic, Apple, or any of the massively capitalized 'neolabs'.</p></div></td></tr></tbody></table></td></tr><tr id="46655169"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46655169" href="https://news.ycombinator.com/vote?id=46655169&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>in the valley at least its difficult to pursue that unless you’re in a “hot” field. A few years ago, it was cloud, then big data, then crypto and now AI. When startups in those fields can raise hundreds of millions, they can lure away a lot of talent (both tech and non tech).</p></div></td></tr></tbody></table></td></tr><tr id="46655229"><td><table><tbody><tr><td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td><center><a id="up_46655229" href="https://news.ycombinator.com/vote?id=46655229&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Nah. Regardless of where the company is nominally headquartered there are always an effectively infinite number of employees who can be hired to work remotely or out of satellite offices.</p></div></td></tr></tbody></table></td></tr><tr id="46655639"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46655639" href="https://news.ycombinator.com/vote?id=46655639&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>The real question to ask is;</p><p><i>Is it still worth pursuing a software startup ... using the same strategies/approach/mindset/tools/means/methods of yesteryears</i>?</p><p>Answer is Yes for the first part and No for the second part.</p><p>Problems which need software solutions and/or have a software component (at this point, practically everything) still exist in plenty. AI/ML has only changed the playing field drastically. It cannot understand the <i>intent behind the problem</i> which is a uniquely Human Dilemma. This is where the opportunities lie; understanding different Problem/Business Domains by studying and closely interacting with possible clients and coming up with tailored solutions whether domain-specific or client-specific.</p><p>The emphasis now is on better problem understanding/specification/verification  (DSLs/notations/diagrams etc.) and faster iteration to a MVP. AI/ML is a great help here but the cycle is initiated by a Human who is always in the loop and steers it on the right trajectory in the state space of possible solutions.</p></div></td></tr></tbody></table></td></tr><tr id="46655212"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46655212" href="https://news.ycombinator.com/vote?id=46655212&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>The fact that people look to start a business based on searching foe a moat shows they don't believe in free markets. As well as shows what's wrong with Silicon Valley.</p></div></td></tr></tbody></table></td></tr><tr id="46655249"><td></td></tr><tr id="46655113"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46655113" href="https://news.ycombinator.com/vote?id=46655113&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>You could probably become rich wholesaling gravel in your city. There are plenty of opportunities all around. Execution is key.</p></div></td></tr></tbody></table></td></tr><tr id="46655262"><td></td></tr><tr id="46655320"><td><table><tbody><tr><td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td><center><a id="up_46655320" href="https://news.ycombinator.com/vote?id=46655320&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>I'd argue the question was wrong, it's not that big companies can copy you easier now. They could have always invaded your space and destroyed your business. As other pointed out it was always picking up the pennies that they didn't want until those pennies became dollars.</p><p>The concern now is that other small team or solo developers can rebuild what you have very quickly. This happened in the mobile space with all the decompiled and repacked (with min changes) apps that showed up in the stores.</p><p>The moat for SaaS startups was that the code is hidden. Now that matters less because people use AI to try and reverse engineer your backend from the API or even UI screenshots.</p><p>You have to pick up the pace to keep ahead of them and make sure you don't cause problems for customers while doing it.</p></div></td></tr></tbody></table></td></tr><tr id="46655375"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46655375" href="https://news.ycombinator.com/vote?id=46655375&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>The serious answer:</p><p>The value cannot be just the software. E.g. some workflow tool (Salesforce). These tools will continue to exist for awhile but any customer capable of moving off of it to a startup version, can probably make their own startup version, tailored to them.</p><p>Now, if you offer something besides the software — logistics, networks, financial instruments, regulatory compliance, physical goods, compute, etc — that has value besides the software.</p><p>But the five billionth workflow automation tool has fast diminishing value in 2026.</p></div></td></tr></tbody></table></td></tr><tr id="46655329"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46655329" href="https://news.ycombinator.com/vote?id=46655329&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>This is the problem with big concentration of wealth and power. The big tech mega corps can copy your idea easily because they don’t have any budget, they can undercut you or sell at a loss, and they can distribute it to all their current customers with anti competitive bundling.</p><p>It has happened over and over many times and American antitrust law is useless. The largest corporations must be broken up, taxed heavily, and regulated in new ways. Otherwise there is no fair competition or level playing field for startups.</p></div></td></tr></tbody></table></td></tr><tr id="46655424"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46655424" href="https://news.ycombinator.com/vote?id=46655424&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>I would strongly recommend staying away from software startups unless:</p><p>- The CEO of some major corporation or a big VC is a close friend or friend of your family.</p><p>- You are rich and have a lot of friends who will buy your product.</p><p>- You already finished the MVP; which you started building 12 years ago... Might as well try to complete.</p><p>- You're a criminal.</p><p>The market is insanely saturated and people already have more stuff than they need. Capitalism has been over since 2008. Now it's just feudalism. Product is irrelevant; it's all a social game of selection. You have to be selected. You just need to know someone and have a product with a semi-reasonable narrative that your CEO buddy can use as a justification to give you company money. That's it.</p></div></td></tr></tbody></table></td></tr><tr id="46658697"><td><table><tbody><tr><td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td><center><a id="up_46658697" href="https://news.ycombinator.com/vote?id=46658697&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>You’re talking about VC startups.</p><p>I disagree with the sour mindset, as I don’t feel those games were necessary for my startup, although I admit mine was bootstrapped (0$), and didn’t grow as far as the others, it still made me millionaire, has paid my employees a high-than-average salary and has the potential of adding them a few hundred thousands each.</p><p>I admit the old market (do web apps to manage records! or notes!) is saturated but the IA market is brand new and fresh open.</p></div></td></tr></tbody></table></td></tr><tr id="46658788"><td></td></tr><tr id="46655276"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46655276" href="https://news.ycombinator.com/vote?id=46655276&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Isn't it the opposite? E.g. there is very little moat left and small companies or individuals can copy any product big or small in no time?</p></div></td></tr></tbody></table></td></tr><tr id="46655178"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46655178" href="https://news.ycombinator.com/vote?id=46655178&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Depends on your goal - do you have an idea you care about and want to solve?  Probably a good idea.  If you "want to be your own boss" or looking for something just to be acquired, hard to say, depends on who you know, etc.</p></div></td></tr></tbody></table></td></tr><tr id="46655046"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46655046" href="https://news.ycombinator.com/vote?id=46655046&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>You're gonna get a lot of positive responses here, but frankly only do it if you think you can make meaningful money within a month or two.</p><p>Everything is going off the rails this year.  You only have to use Claude Code for 10 minutes to realize every job involving a computer is going to get flipped upside down within a year.</p></div></td></tr></tbody></table></td></tr><tr id="46655243"><td><table><tbody><tr><td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td><center><a id="up_46655243" href="https://news.ycombinator.com/vote?id=46655243&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Lol that's what they told us last year. And they'll say the same thing next year. It's obviously useful for certain tasks but the number of errors and hallucinations are still quite bad for anything large or complex or really novel. That part is improving very slowly and some fundamental theoretical breakthroughs will be needed.</p></div></td></tr></tbody></table></td></tr><tr id="46655296"><td><table><tbody><tr><td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td><center><a id="up_46655296" href="https://news.ycombinator.com/vote?id=46655296&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>I don't care what <i>they</i> told you last year, I didn't say jack shit.  I'm saying it now.</p><p>Cope or pretend it's not happening, I don't care, this is the year.</p></div></td></tr></tbody></table></td></tr><tr id="46655326"><td><table><tbody><tr><td indent="3"><img src="https://news.ycombinator.com/s.gif" height="1" width="120"></td><td><center><a id="up_46655326" href="https://news.ycombinator.com/vote?id=46655326&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Have you actually had it do anything substantial and then tried to work with the code it produces afterwards? It may "work" but it's a horrific mess. Good luck bug fixing that.</p></div></td></tr></tbody></table></td></tr><tr id="46655396"><td><table><tbody><tr><td indent="4"><img src="https://news.ycombinator.com/s.gif" height="1" width="160"></td><td><center><a id="up_46655396" href="https://news.ycombinator.com/vote?id=46655396&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Yes, with GPT 5.2 Codex and 5.2 Pro specifically. It’s not a mess because of the context I provide and the guidance and reattempts I apply. It’s working great, the resulting code is good when I accept it, and I’m getting much more done than in the before times.</p></div></td></tr></tbody></table></td></tr><tr id="46655447"><td><table><tbody><tr><td indent="4"><img src="https://news.ycombinator.com/s.gif" height="1" width="160"></td><td><center><a id="up_46655447" href="https://news.ycombinator.com/vote?id=46655447&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Yes, Opus 4.5 is not business as normal.  If you haven't tried it, you really need to, to update your opinion.</p></div></td></tr></tbody></table></td></tr><tr id="46658556"><td></td></tr><tr id="46658679"><td></td></tr><tr id="46655162"><td><table><tbody><tr><td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td><center><a id="up_46655162" href="https://news.ycombinator.com/vote?id=46655162&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>I am just as bullish as you on the potential. AI is going to change the world all right. Much bigger than the internet.</p><p>I an far, far less bullish than you on the timeframe. The vast amount of work is not even optimised for computers without AI. Much if not most bureaucratic process has stayed mostly the same for the best part of a hundred years.</p><p>It will change everything, but not in a single year!</p></div></td></tr></tbody></table></td></tr><tr id="46655203"><td></td></tr><tr id="46655233"><td><table><tbody><tr><td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td><center><a id="up_46655233" href="https://news.ycombinator.com/vote?id=46655233&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>+1. Claude is actually really good at all kinds of development but Claude will still make plenty of mistakes and occasionally go so far in the wrong direction that it still needs someone with experience to steer it.</p></div></td></tr></tbody></table></td></tr><tr id="46657902"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46657902" href="https://news.ycombinator.com/vote?id=46657902&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Got to get more creative and less funding dependent. People still seem caught up in the old process of ideation, static creation, pitch decks. Ack! Garbage now! I only ever took funding to scale to 3-5 heads, well I have 20 heads for nearly nothing now... Ive created more "startup" ideas in the last 3 years then the last 20 of my career. I just keep cranking out anything remotely interesting, launch, and if it don't "work", move on. I just launched another one this week, feels most promising, but we'll see... I didn't go quitting my day job just yet.</p><p>Also, GTFO! My ideas are not just slop from sitting around day dreaming. Every one is from observations made from talking or watching people struggle... cant replace that with AI yet.</p></div></td></tr></tbody></table></td></tr><tr id="46655159"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46655159" href="https://news.ycombinator.com/vote?id=46655159&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>You mean the big companies who still haven't moved away from abominations like SAP and Oracle? The ones where you require twenty approvals to get a small pilot done? Instead of moving to saner and cheaper alternatives, they would just say, "hey, why don't we just start making our own software?" Every effort like this—if it had any takers—will fail spectacularly.</p><p>I get it people are skeptical about the future. But I can't imagine any scenario where people would like taking responsibility of building and mantaining their own software for everything vs. paying marginal amount of money (relatively speaking) to let someone else take the headache.</p></div></td></tr></tbody></table></td></tr><tr id="46655220"><td><table><tbody><tr><td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td><center><a id="up_46655220" href="https://news.ycombinator.com/vote?id=46655220&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>I can imagine a future where it will be possible for a family to host their own essential services ... There got to be something between homelabs and cloud services bc the gap is too big.</p></div></td></tr></tbody></table></td></tr><tr id="46655530"><td><table><tbody><tr><td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td><center><a id="up_46655530" href="https://news.ycombinator.com/vote?id=46655530&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Not quite there yet but Yunohost is a fantastic attempt to get closer to this ideal. Install the OS - and the basic self-hostic-use-case apps are all just there to click and install. From Immich to Kodi to Wordpress and what not.</p><p><a href="https://yunohost.org/" rel="nofollow">https://yunohost.org/</a></p></div></td></tr></tbody></table></td></tr><tr id="46655475"><td><table><tbody><tr><td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td><center><a id="up_46655475" href="https://news.ycombinator.com/vote?id=46655475&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>&gt; I can imagine a future where it will be possible for a family to host their own essential services</p><p>Exactly. Even something as seemingly mundane as hosting your own email is a major challenge.</p></div></td></tr></tbody></table></td></tr><tr id="46655653"><td><table><tbody><tr><td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td><center><a id="up_46655653" href="https://news.ycombinator.com/vote?id=46655653&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>With IPv6 (and/or NAT-forwarding) it was already possible to host stuff.</p><p>However, E-mail's horrible protocols and spam-blocking security monopolies mean you're stuck with one of the big cloud providers, even if you could automate/solve e-mail server complications.</p></div></td></tr></tbody></table></td></tr><tr id="46658554"><td><table><tbody><tr><td indent="3"><img src="https://news.ycombinator.com/s.gif" height="1" width="120"></td><td><center><a id="up_46658554" href="https://news.ycombinator.com/vote?id=46658554&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Not true. Been hosting my own email for years and only prblem is delivery to some MS hosted services (usually hotmail)</p></div></td></tr></tbody></table></td></tr><tr id="46655496"><td><table><tbody><tr><td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td><center><a id="up_46655496" href="https://news.ycombinator.com/vote?id=46655496&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Good luck. To have something that a regular family could use would require remote access from the company for troubleshooting, updates, maintenance.</p><p>So you get all of the downsides of cloud hosting (company employees can still remote in), with none of the upsides (all the hardware is now geographically distributed, instead of one big building) with the privilege of <i>paying</i> for it instead of being "free" like facebook/google.</p></div></td></tr></tbody></table></td></tr><tr id="46655282"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46655282" href="https://news.ycombinator.com/vote?id=46655282&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>There's still plenty of moats frankly, same moats as before. What isn't the moat is the software development time.</p><p>In our case, we're building a tool that has a moat from: integrations, multiple parties connecting, and others</p><p>It's very sticky once we get in, and has nothing to do with the software so much as legal, company policy and inter party communication</p></div></td></tr></tbody></table></td></tr><tr id="46655314"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46655314" href="https://news.ycombinator.com/vote?id=46655314&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>You can get the same output as $500k/year of software engineers for $2.4k/year now. Never been better if you ask me!</p></div></td></tr></tbody></table></td></tr><tr id="46657843"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46657843" href="https://news.ycombinator.com/vote?id=46657843&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Could it be that it's just a wrapper for APIs like OpenAI/Anthropic? I've been thinking about this for a long time, and I'm surprised to find someone else with the same view.</p></div></td></tr></tbody></table></td></tr><tr id="46657995"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46657995" href="https://news.ycombinator.com/vote?id=46657995&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>The only software worth writing is tools for agents that contain something hard for them to vibe code in a couple of sessions.</p><p>Making someone’s agents 20% better, cheaper or faster will be a measurable and easy sales goal.</p></div></td></tr></tbody></table></td></tr><tr id="46658417"><td><table><tbody><tr><td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td><center><a id="up_46658417" href="https://news.ycombinator.com/vote?id=46658417&amp;how=up&amp;goto=item%3Fid%3D46654726"></a></center></td><td><br>
<div><p>Unfortunately any pro-AI viewpoint, no matter how uncontroversial, will be immediately dismissed and down voted here. Doesn't make it not true.</p></div></td></tr></tbody></table></td></tr><tr id="46658151"><td></td></tr></tbody></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[FLUX.2 [Klein]: Towards Interactive Visual Intelligence (177 pts)]]></title>
            <link>https://bfl.ai/blog/flux2-klein-towards-interactive-visual-intelligence</link>
            <guid>46653721</guid>
            <pubDate>Fri, 16 Jan 2026 23:46:17 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://bfl.ai/blog/flux2-klein-towards-interactive-visual-intelligence">https://bfl.ai/blog/flux2-klein-towards-interactive-visual-intelligence</a>, See on <a href="https://news.ycombinator.com/item?id=46653721">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><h2><strong>FLUX.2 [klein]: Towards Interactive Visual Intelligence</strong></h2><p>Today, we release the FLUX.2 [klein] model family, our fastest image models to date. FLUX.2 [klein] unifies generation and editing in a single compact architecture, delivering state-of-the-art quality with end-to-end inference as low as under a second. Built for applications that require real-time image generation without sacrificing quality, and runs on consumer hardware with as little as 13GB VRAM.</p><p><a target="_blank" rel="noindex nofollow" href="https://bfl.ai/models/flux-2-klein#try-demo"><strong><span>Try it now for free here</span></strong></a></p><p><img alt="" draggable="false" loading="lazy" width="1280" height="720" decoding="async" data-nimg="1" srcset="https://bfl.ai/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F2gpum2i6%2Fproduction%2F2bd2ec8704480a772cf35f1017ffb8488aab630c-1280x720.gif&amp;w=1920&amp;q=75 1x, https://bfl.ai/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F2gpum2i6%2Fproduction%2F2bd2ec8704480a772cf35f1017ffb8488aab630c-1280x720.gif&amp;w=3840&amp;q=75 2x" src="https://bfl.ai/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F2gpum2i6%2Fproduction%2F2bd2ec8704480a772cf35f1017ffb8488aab630c-1280x720.gif&amp;w=3840&amp;q=75"></p><p><em>Demo showing editing with FLUX.2 [klein]</em></p><h3><strong>Why go [klein]?</strong></h3><p>Visual Intelligence is entering a new era. As AI agents become more capable, they need visual generation that can keep up; models that respond in real-time, iterate quickly, and run efficiently on accessible hardware.</p><p>The <em>klein</em> name comes from the German word for "small", reflecting both the compact model size and the minimal latency. But FLUX.2 [klein] is anything but limited. These models deliver exceptional performance in text-to-image generation, image editing and multi-reference generation, typically reserved for much larger models.</p><h3><strong>What's New</strong></h3><ul><li><span>Sub-second inference. Generate or edit images in under 0.5s on modern hardware.</span></li><li><span>Photorealistic outputs and high diversity, especially in the base variants.</span></li><li><span>Unified generation and editing. Text-to-image, image editing, and multi-reference support in a single model while delivering frontier performance.</span></li><li><span>Runs on consumer GPUs. The 4B model fits in ~13GB VRAM (RTX 3090/4070 and above).</span></li><li><span>Developer-friendly &amp; Accessible: Apache 2.0 on 4B models, open weights for 9B models. Full open weights for customization and fine-tuning.</span></li><li><span>API and open weights. Production-ready API or run locally with full weights.</span></li></ul><p><em>Note: The “FLUX [dev] Non-Commercial License” has been renamed to “FLUX Non-Commercial License” and will apply to the 9B Klein models. No material changes have been made to the license.</em></p><p><img alt="" draggable="false" loading="lazy" width="2127" height="1400" decoding="async" data-nimg="1" srcset="https://bfl.ai/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F2gpum2i6%2Fproduction%2F41055678178f6fe75ca618b854b195e48dfc55ed-2127x1400.jpg&amp;w=3840&amp;q=75 1x" src="https://bfl.ai/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F2gpum2i6%2Fproduction%2F41055678178f6fe75ca618b854b195e48dfc55ed-2127x1400.jpg&amp;w=3840&amp;q=75"></p><p><em>Text to Image collage using FLUX.2 [klein]</em></p><h3><strong>The FLUX.2 [klein] Model Family</strong></h3><h4><strong>FLUX.2 [klein] 9B</strong></h4><p>Our flagship small model. Defines the Pareto frontier for quality vs. latency across text-to-image, single-reference editing, and multi-reference generation. Matches or exceeds models 5x its size - in under half a second. Built on a 9B flow model with 8B Qwen3 text embedder, step-distilled to 4 inference steps.</p><p>Combine multiple input images, blend concepts, and iterate on complex compositions - all at sub-second speed with frontier-level quality. No model this fast has ever done this well.</p><p><strong>License</strong>: FLUX NCL</p><p><img alt="" draggable="false" loading="lazy" width="4544" height="2805" decoding="async" data-nimg="1" srcset="https://bfl.ai/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F2gpum2i6%2Fproduction%2F86adb8bf9ea077f3aebe392af1077f0337ed9c48-4544x2805.jpg&amp;w=3840&amp;q=75 1x" src="https://bfl.ai/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F2gpum2i6%2Fproduction%2F86adb8bf9ea077f3aebe392af1077f0337ed9c48-4544x2805.jpg&amp;w=3840&amp;q=75"></p><p><em>Imagine editing collage using FLUX.2 [klein]</em></p><h4><strong><br>FLUX.2 [klein] 4B:</strong></h4><p>Fully open under Apache 2.0. Our most accessible model, it runs on consumer GPUs like the RTX 3090/4070. Compact but capable: supports T2I, I2I, and multi-reference at quality that punches above its size. Built for local development and edge deployment.</p><p><strong>License</strong>: Apache 2.0<br></p><h4><strong>FLUX.2 [klein] Base 9B / 4B:</strong></h4><p>The full-capacity foundation models. Undistilled, preserving complete training signal for maximum flexibility. Ideal for fine-tuning, LoRA training, research, and custom pipelines where control matters more than speed. Higher output diversity than the distilled models.</p><p><strong>License</strong>: 4B Base under Apache 2.0, 9B Base under FLUX NCL</p><p><img alt="" draggable="false" loading="lazy" width="2127" height="1400" decoding="async" data-nimg="1" srcset="https://bfl.ai/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F2gpum2i6%2Fproduction%2F900de0722995119df9f27d799bdfed194d2112ac-2127x1400.jpg&amp;w=3840&amp;q=75 1x" src="https://bfl.ai/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F2gpum2i6%2Fproduction%2F900de0722995119df9f27d799bdfed194d2112ac-2127x1400.jpg&amp;w=3840&amp;q=75"></p><p><em>Output Diversity using FLUX.2 [klein]<br></em></p><h4><strong>Quantized versions</strong></h4><p>We are also releasing FP8 and NVFP4 versions of all [klein] variants, developed in collaboration with NVIDIA for optimized inference on RTX GPUs. Same capabilities, smaller footprint - compatible with even more hardware.</p><ul><li><span><strong>FP8:</strong> Up to 1.6x faster, up to 40% less VRAM</span></li><li><span><strong>NVFP4:</strong> Up to 2.7x faster, up to 55% less VRAM</span></li></ul><p><em>Benchmarks on RTX 5080/5090, T2I at 1024×1024<br></em>Same licenses apply: Apache 2.0 for 4B variants, FLUX NCL for 9B.</p><h4><strong><br>Performance Analysis</strong></h4><p><img alt="" draggable="false" loading="lazy" width="3548" height="1173" decoding="async" data-nimg="1" srcset="https://bfl.ai/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F2gpum2i6%2Fproduction%2F8ece18115cc75a4d34c42eda81a68bbd78048666-3548x1173.jpg&amp;w=3840&amp;q=75 1x" src="https://bfl.ai/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F2gpum2i6%2Fproduction%2F8ece18115cc75a4d34c42eda81a68bbd78048666-3548x1173.jpg&amp;w=3840&amp;q=75"></p><p><img alt="" draggable="false" loading="lazy" width="3541" height="1173" decoding="async" data-nimg="1" srcset="https://bfl.ai/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F2gpum2i6%2Fproduction%2Fc29dea8ec862d79ecdc82e8013f37ee22a148cb8-3541x1173.jpg&amp;w=3840&amp;q=75 1x" src="https://bfl.ai/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F2gpum2i6%2Fproduction%2Fc29dea8ec862d79ecdc82e8013f37ee22a148cb8-3541x1173.jpg&amp;w=3840&amp;q=75"></p><p><strong><em>FLUX.2 [klein] Elo vs Latency (top) and VRAM (bottom) across Text-to-Image, Image-to-Image Single Reference, and Multi-Reference tasks.</em></strong>&nbsp;<em>FLUX.2 [klein] matches or exceeds Qwen's quality at a fraction of the latency and VRAM, and outperforms Z-Image while supporting both text-to-image generation and (multi-reference) image editing in a unified model. The base variants trade some speed for full customizability and fine-tuning, making them better suited for research and adaptation to specific use cases. Speed is measured on a GB200 in bf16.</em></p><h3><strong>Into the New</strong></h3><p>FLUX.2 [klein] is more than a faster model. It's a step toward our vision of interactive visual intelligence. We believe the future belongs to creators and developers with AI that can see, create, and iterate in real-time. Systems that enable new categories of applications: real-time design tools, agentic visual reasoning, interactive content creation.</p><h3><strong>Resources</strong></h3><p><strong>Try it</strong></p><ul><li><span><a target="_blank" rel="noindex nofollow" href="https://bfl.ai/models/flux-2-klein#try-demo">Demo</a></span></li><li><span><a target="_blank" rel="noindex nofollow" href="https://bfl.ai/play">Playground</a></span></li><li><span><a target="_blank" rel="noindex nofollow" href="https://huggingface.co/spaces/black-forest-labs/FLUX.2-klein-9B">HF Space for [klein] 9B</a>, <a target="_blank" rel="noindex nofollow" href="https://huggingface.co/spaces/black-forest-labs/FLUX.2-klein-4B">HF Space for [klein] 4B</a></span></li></ul><p><strong>Build with it</strong></p><ul><li><span><a target="_blank" rel="noindex nofollow" href="https://docs.bfl.ai/flux_2/flux2_overview#flux-2-%5Bklein%5D-models">Documentation</a></span></li><li><span><a target="_blank" rel="noindex nofollow" href="https://github.com/black-forest-labs/flux2">GitHub</a></span></li><li><span><a target="_blank" rel="noindex nofollow" href="https://huggingface.co/collections/black-forest-labs/flux2">Model Weights</a></span></li></ul><p><strong>Learn more</strong></p><ul><li><span><a target="_blank" rel="noindex nofollow" href="https://bfl.ai/models/flux-2-klein">https://bfl.ai/models/flux-2-klein</a></span></li></ul></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Releasing rainbow tables to accelerate Net-NTLMv1 protocol deprecation (135 pts)]]></title>
            <link>https://cloud.google.com/blog/topics/threat-intelligence/net-ntlmv1-deprecation-rainbow-tables</link>
            <guid>46652617</guid>
            <pubDate>Fri, 16 Jan 2026 21:42:24 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://cloud.google.com/blog/topics/threat-intelligence/net-ntlmv1-deprecation-rainbow-tables">https://cloud.google.com/blog/topics/threat-intelligence/net-ntlmv1-deprecation-rainbow-tables</a>, See on <a href="https://news.ycombinator.com/item?id=46652617">Hacker News</a></p>
<div id="readability-page-1" class="page"><div jsname="tx2NYc"><div jsaction="rcuQ6b:npT2md" jscontroller="M0Q3Qb" data-is-cws-richtext="true"><h3><span>Introduction</span></h3>
<p><span>Mandiant is </span><a href="https://research.google/resources/datasets/?dataset_types=other&amp;search=Net-NTLMv1&amp;" rel="noopener" target="_blank"><span>publicly releasing</span></a><span> a comprehensive dataset of Net-NTLMv1 rainbow tables to underscore the urgency of migrating away from this outdated protocol. Despite Net-NTLMv1 being deprecated and known to be insecure for over two decades—with cryptanalysis dating back to 1999—Mandiant consultants continue to identify its use in active environments. This legacy protocol leaves organizations vulnerable to trivial credential theft, yet it remains prevalent due to inertia and a lack of demonstrated immediate risk.</span></p>
<p><span>By releasing these tables, Mandiant aims to lower the barrier for security professionals to demonstrate the insecurity of Net-NTLMv1. While tools to exploit this protocol have existed for years, they often required uploading sensitive data to third-party services or expensive hardware to brute-force keys. The release of this dataset allows defenders and researchers to recover keys in under 12 hours using consumer hardware costing less than $600 USD. This initiative highlights the amplified impact of combining Mandiant's frontline expertise with Google Cloud's resources to eliminate entire classes of attacks.</span></p>
<p><span>This post details the generation of the tables, provides access to the dataset for community use, and outlines critical remediation steps to disable Net-NTLMv1 and prevent authentication coercion attacks.</span></p>
<h3><span>Background</span></h3>
<p><span>Net-NTLMv1 has been widely known to be insecure since at least 2012, following presentations at DEFCON 20, with cryptanalysis of the underlying protocol </span><a href="https://www.schneier.com/academic/archives/1999/09/cryptanalysis_of_mic_1.html" rel="noopener" target="_blank"><span>dating back to at least 1999</span></a><span>. On Aug. 30, 2016, Hashcat </span><a href="https://github.com/hashcat/hashcat/commit/71a8459d851d246945343ea59effa1d46b965bf8" rel="noopener" target="_blank"><span>added support</span></a><span> for cracking Data Encryption Standard (DES) keys using known plaintext, further democratizing the ability to attack this protocol. Rainbow tables are almost as old, with the initial paper on rainbow tables published in </span><a href="https://infoscience.epfl.ch/record/99512/files/Oech03.pdf" rel="noopener" target="_blank"><span>2003 by Philippe Oechslin</span></a><span>, citing an earlier iteration of a time-memory trade-off from </span><a href="http://www-ee.stanford.edu/~hellman/publications/36.pdf" rel="noopener" target="_blank"><span>1980 by Martin Hellman</span></a><span>.</span></p>
<p><span>Essentially, if an attacker can obtain a Net-NTLMv1 hash without Extended Session Security (ESS) for the known plaintext of </span><code>1122334455667788</code><span>, a cryptographic attack, referred to as a known plaintext attack (KPA), can be applied. This guarantees recovery of the key material used. Since the key material is the password hash of the authenticating Active Directory (AD) object—user or computer—the attack results can quickly be used to compromise the object, often leading to privilege escalation.</span></p>
<p><span>A common chain attackers use is authentication coercion from a highly privileged object, such as a domain controller (DC). Recovering the password hash of the DC machine account allows for DCSync privileges to compromise any other account in AD.</span></p>
<h3><span>Dataset Release</span></h3>
<p><span>The unsorted dataset can be downloaded using <code>gsutil -m cp -r gs://net-ntlmv1-tables/tables .</code>&nbsp;or through the </span><a href="https://research.google/resources/datasets/?dataset_types=other&amp;search=Net-NTLMv1&amp;" rel="noopener" target="_blank"><span>Google Cloud Research Dataset portal</span></a><span>.&nbsp;</span></p>
<p><span>The SHA512 hashes of the tables can be checked by first downloading the checksums <code>gsutil -m cp gs://net-ntlmv1-tables/tables.sha512 .</code> then checked by <code>sha512sum -c tables.sha512</code>. </span><span>The password cracking community has already created derivative work and is also hosting the ready to use tables.</span></p>
<h3><span>Use of the Tables</span></h3>
<p><span>Once a Net-NTLMv1 hash has been obtained, the tables can be used with historical or modern reinventions of rainbow table searching software such as </span><a href="https://www.kali.org/tools/rainbowcrack/" rel="noopener" target="_blank"><span>rainbowcrack (rcrack)</span></a><span>, or </span><a href="https://github.com/inAudible-NG/RainbowCrack-NG" rel="noopener" target="_blank"><span>RainbowCrack-NG</span></a><span> on central processing units (CPUs) or a </span><a href="https://github.com/blurbdust/rainbowcrackalack" rel="noopener" target="_blank"><span>fork</span></a><span> of </span><a href="https://github.com/jtesta/rainbowcrackalack" rel="noopener" target="_blank"><span>rainbowcrackalack</span></a><span> on graphics processing units (GPUs). The Net-NTLMv1 hash needs to be preprocessed to the DES components using </span><a href="https://github.com/evilmog/ntlmv1-multi" rel="noopener" target="_blank"><span>ntlmv1-multi</span></a><span> as shown in the next section</span><span>.</span></p>
<h3><span>Obtaining a Net-NTLMv1 Hash</span></h3>
<p><span>Most attackers will use </span><a href="https://github.com/lgandx/Responder" rel="noopener" target="_blank"><span>Responder</span></a><span> with the <code>--lm</code> and <code>--disable-ess</code>&nbsp;flags and set the authentication to a static value of <code>1122334455667788</code> to only allow for connections with Net-NTLMv1 as a possibility. Attackers can then wait for incoming connections or coerce authentication using a tool such as </span><a href="https://github.com/topotam/PetitPotam" rel="noopener" target="_blank"><span>PetitPotam</span></a><span> or </span><a href="https://github.com/Wh04m1001/DFSCoerce" rel="noopener" target="_blank"><span>DFSCoerce</span></a><span> to generate incoming connections from DCs or lower privilege hosts that are useful for objective completion. Responses can be cracked to retrieve password hashes of either users or computer machine accounts. A sample workflow for an attacker is shown below in Figure 1, Figure 2, and Figure 3.</span></p></div><section><figure><section jscontroller="SCGBie" jsaction="rcuQ6b:npT2md"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig1.max-800x800.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig1.max-800x800.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"></section></figure><div><p>Figure 1: DFSCoerce against a DC</p></div></section><section><figure><section jscontroller="SCGBie" jsaction="rcuQ6b:npT2md"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig2.max-600x600.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig2.max-600x600.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"></section></figure><div><p>Figure 2: Net-NTLMv1 hash obtained for DC machine account</p></div></section><section><figure><section jscontroller="SCGBie" jsaction="rcuQ6b:npT2md"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig3.max-800x800.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig3.max-800x800.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"></section></figure><div><p>Figure 3: Parse Net-NTLMv1 hash to DES parts</p></div></section><section><p><span>Figure 4 illustrates the processing of the Net-NTLMv1 hash to the DES ciphertexts.</span></p></section><section><figure><section jscontroller="SCGBie" jsaction="rcuQ6b:npT2md"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig4.max-2100x2100.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig4.max-2100x2100.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"></section></figure><div><p>Figure 4: Net-NTLMv1 hash to DES ciphertexts</p></div></section><section><p><span>An attacker then takes the split-out ciphertexts to crack the keys used based on the known plaintext of <code>1122334455667788</code> with the steps of loading the tables shown in Figure 5 and cracking results in Figure 6 and Figure 7.</span></p></section><section><figure><section jscontroller="SCGBie" jsaction="rcuQ6b:npT2md"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig5.max-1100x1100.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig5.max-1100x1100.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"></section></figure><div><p>Figure 5: Loading DES components for cracking</p></div></section><section><figure><section jscontroller="SCGBie" jsaction="rcuQ6b:npT2md"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig6.max-500x500.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig6.max-500x500.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"></section></figure><div><p>Figure 6: First hash cracked</p></div></section><section><figure><section jscontroller="SCGBie" jsaction="rcuQ6b:npT2md"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig7.max-1400x1400.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig7.max-1400x1400.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"></section></figure><div><p>Figure 7: Second hash cracked and run statistics</p></div></section><section><p><span>An attacker can then calculate the last remaining key with ntlmv1-multi once again, or look it up with </span><a href="https://github.com/sensepost/assless-chaps" rel="noopener" target="_blank"><span>twobytes</span></a><span>, to recreate the full NT hash for the DC account with the last key part shown in Figure 8.</span></p></section><section><figure><section jscontroller="SCGBie" jsaction="rcuQ6b:npT2md"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig8.max-600x600.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig8.max-600x600.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"></section></figure><div><p>Figure 8: Calculate remaining key</p></div></section><section><p><span>The result can be checked with hashcat's </span><a href="https://github.com/hashcat/hashcat/pull/2607" rel="noopener" target="_blank"><span>NT hash shucking mode</span></a><span>, <code>-m 27000</code>, as shown in Figure 9.</span></p></section><section><figure><section jscontroller="SCGBie" jsaction="rcuQ6b:npT2md"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig9.max-800x800.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig9.max-800x800.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"></section></figure><div><p>Figure 9: Keys checked with hash shucking</p></div></section><section><p><span>An attacker can then use the hash to perform a </span><a href="http://attack.mitre.org/techniques/T1003/006/" rel="noopener" target="_blank"><span>DCSync attack</span></a><span> targeting a DC and authenticating as the now compromised machine account. The attack flow uses </span><a href="https://github.com/fortra/impacket/blob/master/examples/secretsdump.py" rel="noopener" target="_blank"><span>secretsdump.py</span></a><span> from the </span><a href="https://github.com/fortra/impacket" rel="noopener" target="_blank"><span>Impacket</span></a><span> toolsuite and is shown in Figure 10.</span></p></section><section><figure><section jscontroller="SCGBie" jsaction="rcuQ6b:npT2md"><img src="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig10.max-1100x1100.png" alt="https://storage.googleapis.com/gweb-cloudblog-publish/images/net-ntlmv1-fig10.max-1100x1100.png" jsname="P3Vluc" jsaction="click:HTIlC" loading="lazy"></section></figure><div><p>Figure 10: DCSync attack performed</p></div></section><section><span>Posted in</span><ul><li><a href="https://cloud.google.com/blog/topics/threat-intelligence" track-metadata-position="body" track-metadata-eventdetail="cloud.google.com/blog/topics/threat-intelligence" track-metadata-module="tag list" track-metadata-module_headline="posted in">Threat Intelligence</a></li></ul></section></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[LWN is currently under the heaviest scraper attack seen yet (186 pts)]]></title>
            <link>https://social.kernel.org/notice/B2JlhcxNTfI8oDVoyO</link>
            <guid>46651887</guid>
            <pubDate>Fri, 16 Jan 2026 20:37:31 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://social.kernel.org/notice/B2JlhcxNTfI8oDVoyO">https://social.kernel.org/notice/B2JlhcxNTfI8oDVoyO</a>, See on <a href="https://news.ycombinator.com/item?id=46651887">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
  <p>
Conversation
  </p>

<div id="selected">
  <div>
    <a href="https://social.kernel.org/users/corbet" rel="author noopener">
      <p><img width="48" height="48" src="https://social.kernel.org/media/a0f71e0fdbdc366c471a559808722f7a26efbc44f8ee40047d004619e50e636d.jpg" title="corbet" alt="corbet">
      </p>
    </a>
  </div>
  <div><p>
So <span><a data-user="AtYuB7yJ6QP99m4p2u" href="https://fedi.lwn.net/@lwn" rel="ugc">@<span>lwn</span></a></span> is currently under the heaviest scraper attack seen yet.  It is a DDOS attack involving tens of thousands of addresses, and that is affecting the responsiveness of the site, unfortunately.</p><p>There are many things I would like to do with my time.  Defending LWN from AI shitheads is rather far from the top of that list.  I *really* don't want to put obstacles between LWN and its readers, but it may come to that.</p><p>(Another grumpy day, sorry)


        </p></div>
</div>


<div>
  <div>
    <a href="https://toot.community/@tmcfarlane" rel="author noopener">
      <p><img width="48" height="48" src="https://static.toot.community/accounts/avatars/109/304/599/835/735/989/original/adadebc48e5f4ade.jpg" title="tmcfarlane@toot.community" alt="tmcfarlane@toot.community">
      </p>
    </a>
  </div>
  <div>

        <p><span><a href="https://social.kernel.org/users/corbet">@<span>corbet</span></a></span> <span><a href="https://fedi.lwn.net/@lwn">@<span>lwn</span></a></span> this, combined with search engines prioritising the stolen content!<br>  This is why I think the web is genuinely doomed. It's not enough to steal the content, for search engines to kill click thtoughs and ad revenues, they are literally killing the ability of original authors to serve the traffic to the few real users that might want to see it.<br>  Devastating.</p>

    </div>
</div>


<div>
  <div>
    <a href="https://discuss.systems/@allan_christoffersen" rel="author noopener">
      <p><img width="48" height="48" src="https://fd.discuss.systems/accounts/avatars/112/252/599/873/823/251/original/322aac261aac9ad7.png" title="allan_christoffersen@discuss.systems" alt="allan_christoffersen@discuss.systems">
      </p>
    </a>
  </div>
  <div>

        <p><span><a href="https://social.kernel.org/users/corbet">@<span>corbet</span></a></span> <span><a href="https://fedi.lwn.net/@lwn">@<span>lwn</span></a></span> <br>As a avid longtime subscriber and reader, I can only give thanks and hope you will survive also this blast of willfully wrong behaviour. Thank you for your openness.</p>

    </div>
</div>


<div>
    <a href="https://fosstodon.org/@nirik" rel="author noopener">
      <p><img width="48" height="48" src="https://cdn.fosstodon.org/accounts/avatars/000/291/057/original/a54ec97321f8a7e8.jpg" title="nirik@fosstodon.org" alt="nirik@fosstodon.org">
      </p>
    </a>
  </div>


<div>
  <div>
    <a href="https://mastodon.nz/@foxylad" rel="author noopener">
      <p><img width="48" height="48" src="https://o.mastodon.nz/accounts/avatars/109/243/033/803/743/777/original/37f897a22740874f.jpg" title="foxylad@mastodon.nz" alt="foxylad@mastodon.nz">
      </p>
    </a>
  </div>
  <div>

        <p><span><a href="https://social.kernel.org/users/corbet">@<span>corbet</span></a></span> <span><a href="https://fedi.lwn.net/@lwn">@<span>lwn</span></a></span> Any inkling which AI (Arsehole Incorporated) it is? The crash can't come soon enough.</p>

    </div>
</div>


<div>
  <div>
    <a href="https://social.kernel.org/users/corbet" rel="author noopener">
      <p><img width="48" height="48" src="https://social.kernel.org/media/a0f71e0fdbdc366c471a559808722f7a26efbc44f8ee40047d004619e50e636d.jpg" title="corbet" alt="corbet">
      </p>
    </a>
  </div>
  <div>

        <p><span><a data-user="AQ4eVxiZShOc1eVrLk" href="https://mastodon.nz/@foxylad" rel="ugc">@<span>foxylad</span></a></span> <span><a data-user="AtYuB7yJ6QP99m4p2u" href="https://fedi.lwn.net/@lwn" rel="ugc">@<span>lwn</span></a></span> There is no way to know who is after the data.  The actual attack is likely perpetrated by Bright Data or one of its equally vile competitors.


        </p>

    </div>
</div>


<div>
  <div>
    <a href="https://metroholografix.ca/@sb" rel="author noopener">
      <p><img width="48" height="48" src="https://metroholografix.ca/system/accounts/avatars/113/693/497/687/169/085/original/1c93c78540d71a29.png" title="sb@metroholografix.ca" alt="sb@metroholografix.ca">
      </p>
    </a>
  </div>
  <div>

        <p><span><a href="https://social.kernel.org/users/corbet">@<span>corbet</span></a></span> <span><a href="https://fedi.lwn.net/@lwn">@<span>lwn</span></a></span> <br>Just speaking with my user hat on here, but given the circumstances I don't mind the ever-so-slight inconvenience of an <a href="https://metroholografix.ca/tags/anubus" rel="tag">#<span>anubus</span></a> challenge.</p>

    </div>
</div>


<div>
  <div>
    <a href="https://pony.social/@cadey" rel="author noopener">
      <p><img width="48" height="48" src="https://cdn.pony.social/accounts/avatars/106/500/315/995/032/015/original/c44f58f46bbe9097.jpg" title="cadey@pony.social" alt="cadey@pony.social">
      </p>
    </a>
  </div>
  <div>

        <p><span><a href="https://social.kernel.org/users/corbet">@<span>corbet</span></a></span> <span><a href="https://fedi.lwn.net/@lwn">@<span>lwn</span></a></span> If you need help, email me. I can work with you in case there's low hanging fruit that you missed.</p>

    </div>
</div>


<div>
    <a href="https://social.tchncs.de/@wuffel" rel="author noopener">
      <p><img width="48" height="48" src="https://f2.tchncs.de/accounts/avatars/000/155/160/original/2c9818a8cb01e936.png" title="wuffel@social.tchncs.de" alt="wuffel@social.tchncs.de">
      </p>
    </a>
  </div>


<div>
  <div>
    <a href="https://mstdn.party/@sheep" rel="author noopener">
      <p><img width="48" height="48" src="https://social.kernel.org/media/a9fd291a909d161561d7e31470fbdd45ca9c30d040507611013af367d8da0686.png" title="sheep@mstdn.party" alt="sheep@mstdn.party">
      </p>
    </a>
  </div>
  <div>

        <p><span><a href="https://social.kernel.org/users/corbet">@<span>corbet</span></a></span> <span><a href="https://fedi.lwn.net/@lwn">@<span>lwn</span></a></span> Obviously that sucks, but I am super happy with the RSS integration that I get with my lwn subscription. People who are affected by the outage should check that out. Not really a solution, but maybe part of one.</p>

    </div>
</div>


<div>
  <div>
    <a href="https://social.ayushnix.com/@ayushnix" rel="author noopener">
      <p><img width="48" height="48" src="https://social.ayushnix.com/fileserver/01WH8ESJVCBZV23NQP6JV947XQ/attachment/original/01JZM8JR5JVXPZEP8P43ZBCESK.jpeg" title="ayushnix@social.ayushnix.com" alt="ayushnix@social.ayushnix.com">
      </p>
    </a>
  </div>
  <div>

        <p><span><a href="https://social.kernel.org/users/corbet">@<span>corbet</span></a></span> <span><a href="https://fedi.lwn.net/@lwn">@<span>lwn</span></a></span> I'm not sure how people in the kernel community reconcile using LLMs with the effect these LLMs have on small businesses and individuals hosting their websites for fun and it's not as if the kernel community itself isn't affected by these incessant DDoS attacks.</p>

    </div>
</div>


<div>
  <div>
    <a href="https://society.oftrolls.com/@suihkulokki" rel="author noopener">
      <p><img width="48" height="48" src="https://society.oftrolls.com/system/accounts/avatars/000/017/391/original/8844460ac49b95ba.jpg" title="suihkulokki@society.oftrolls.com" alt="suihkulokki@society.oftrolls.com">
      </p>
    </a>
  </div>
  <div>
<p><span><a href="https://social.kernel.org/users/corbet">@<span>corbet</span></a></span> <span><a href="https://fedi.lwn.net/@lwn">@<span>lwn</span></a></span> subscriber.lwn.net that is only available for subscribers. One can either join the que with AI bots for lwn.net or subscribe and enjoy the snappy subscriber server.</p><p>I mean that's not a great solution, but it's the only one that works.</p>


        </div>
</div>


<div>
    <a href="https://mastodon.social/@1div0" rel="author noopener">
      <p><img width="48" height="48" src="https://files.mastodon.social/accounts/avatars/000/598/376/original/8fab022a3689800d.png" title="1div0@mastodon.social" alt="1div0@mastodon.social">
      </p>
    </a>
  </div>


<div>
  <div>
    <a href="https://mastodon.social/@Alonely0" rel="author noopener">
      <p><img width="48" height="48" src="https://files.mastodon.social/accounts/avatars/110/681/847/424/236/626/original/a96103531485c6b0.jpeg" title="Alonely0@mastodon.social" alt="Alonely0@mastodon.social">
      </p>
    </a>
  </div>
  <div>

        <p><span><a href="https://social.kernel.org/users/corbet">@<span>corbet</span></a></span> <span><a href="https://fedi.lwn.net/@lwn">@<span>lwn</span></a></span> at this point we might as well be offensive. If the client seems even slightly sus, just send them gibberish data talking about how good Chihuahua muffins are. Ideally LLM-generated (yes, gross) because this doesn't add new information (linear algebra yay) and makes models collapse (aka AI inbreeding).</p>

    </div>
</div>


<div>
  <div>
    <a href="https://chaos.social/@eazy" rel="author noopener">
      <p><img width="48" height="48" src="https://assets.chaos.social/accounts/avatars/000/080/887/original/ec17aae91074229b.jpg" title="eazy@chaos.social" alt="eazy@chaos.social">
      </p>
    </a>
  </div>
  <div>

        <p><span><a href="https://social.kernel.org/users/corbet">@<span>corbet</span></a></span> feel you. Same with my Podcast Directory</p>

    </div>
</div>


<div>
  <div>
    <a href="https://mastodon.ie/@dec23k" rel="author noopener">
      <p><img width="48" height="48" src="https://cdn.masto.host/mastodonie/accounts/avatars/109/294/420/470/083/565/original/e4aa324b482bd55c.png" title="dec23k@mastodon.ie" alt="dec23k@mastodon.ie">
      </p>
    </a>
  </div>
  <div>

        <p><span><a href="https://pony.social/@cadey">@<span>cadey</span></a></span> <span><a href="https://social.kernel.org/users/corbet">@<span>corbet</span></a></span> <span><a href="https://fedi.lwn.net/@lwn">@<span>lwn</span></a></span> <br>I recently saw a traffic spike to a small HTML-only website that never had WP on it, but was suddenly getting failed wp-admin logins and hundreds of PHP vuln scans, non stop. All from MSFT IP addresses. Abuse reports were sent, but there was no response, and the abuse kept happening.<br>So now I'm blocking every MSFT CIDR block that I can find, server-wide.</p>

    </div>
</div>


<div>
  <div>
    <a href="https://c.im/@sbb" rel="author noopener">
      <p><img width="48" height="48" src="https://s3.c.im/accounts/avatars/111/129/674/717/500/119/original/314a224dd5980b68.jpg" title="sbb@c.im" alt="sbb@c.im">
      </p>
    </a>
  </div>
  <div>

        <p><span><a href="https://social.kernel.org/users/corbet">@<span>corbet</span></a></span> <span><a href="https://fedi.lwn.net/@lwn">@<span>lwn</span></a></span> I've been experiencing about 20x more website traffic than normal, myself. It's very likely this scraper bot traffic as well. Things are holding, but only because I took pains to use static site generation (absolutely minimal Javascript, designed to be lightweight).</p>

    </div>
</div>


<div>
  <div>
    <a href="https://social.kernel.org/users/corbet" rel="author noopener">
      <p><img width="48" height="48" src="https://social.kernel.org/media/a0f71e0fdbdc366c471a559808722f7a26efbc44f8ee40047d004619e50e636d.jpg" title="corbet" alt="corbet">
      </p>
    </a>
  </div>
  <div>
<p><span><a data-user="AQ8XbCUm1bVwG4RwZs" href="https://society.oftrolls.com/@suihkulokki" rel="ugc">@<span>suihkulokki</span></a></span> <span><a data-user="AtYuB7yJ6QP99m4p2u" href="https://fedi.lwn.net/@lwn" rel="ugc">@<span>lwn</span></a></span> The problem with that solution is that it may well make it harder for us to bring in new subscribers, which is something we definitely want to do.  First impressions matter, so giving new folks a poor experience seems ... not great.</p><p>It may yet come to that, though.


        </p></div>
</div>


<div>
  <div>
    <a href="https://floss.social/@jani" rel="author noopener">
      <p><img width="48" height="48" src="https://cdn.masto.host/floss/accounts/avatars/114/414/267/336/681/853/original/2d6785bd4aafc2c8.png" title="jani@floss.social" alt="jani@floss.social">
      </p>
    </a>
  </div>
  <div>
<p><span><a href="https://social.kernel.org/users/corbet">@<span>corbet</span></a></span> <span><a href="https://fedi.lwn.net/@lwn">@<span>lwn</span></a></span> <span><a href="https://society.oftrolls.com/@suihkulokki">@<span>suihkulokki</span></a></span> </p><p>Maybe it doesn't need to be subscriber only, just registered users only? Which can also be a PITA, but if there's no enshittification for non-registered users other than the bandwidth being shared with bots, maybe it's tolerable? Could even have a banner about this explaining the benefits of registering, and how LWN won't sell your data.</p>


        </div>
</div>


<div>
  <div>
    <a href="https://social.kernel.org/users/corbet" rel="author noopener">
      <p><img width="48" height="48" src="https://social.kernel.org/media/a0f71e0fdbdc366c471a559808722f7a26efbc44f8ee40047d004619e50e636d.jpg" title="corbet" alt="corbet">
      </p>
    </a>
  </div>
  <div>
<p><span><a data-user="AtYFKz4ovs7aLQhkbg" href="https://floss.social/@jani" rel="ugc">@<span>jani</span></a></span> <span><a data-user="AtYuB7yJ6QP99m4p2u" href="https://fedi.lwn.net/@lwn" rel="ugc">@<span>lwn</span></a></span> <span><a data-user="AQ8XbCUm1bVwG4RwZs" href="https://society.oftrolls.com/@suihkulokki" rel="ugc">@<span>suihkulokki</span></a></span> Such things have crossed our minds, certainly.  The gotcha there is that we've already had troubles with bots creating accounts; I don't think they would hesitate to do more of that if that would improve their access.</p><p>That and, of course, the fact that everybody starts as an unregistered user.  As long as we can avoid making the experience worse for them, I think we should.


        </p></div>
</div>


<div>
  <div>
    <a href="https://floss.social/@jani" rel="author noopener">
      <p><img width="48" height="48" src="https://cdn.masto.host/floss/accounts/avatars/114/414/267/336/681/853/original/2d6785bd4aafc2c8.png" title="jani@floss.social" alt="jani@floss.social">
      </p>
    </a>
  </div>
  <div>
<p><span><a href="https://social.kernel.org/users/corbet">@<span>corbet</span></a></span> <span><a href="https://fedi.lwn.net/@lwn">@<span>lwn</span></a></span> <span><a href="https://society.oftrolls.com/@suihkulokki">@<span>suihkulokki</span></a></span> </p><p>Yeah, it's hard to argue against that.</p><p>And maybe you weren't seeking for "helpful" advice anyway, but, uh, you know your audience. :)</p>


        </div>
</div>


<div>
  <div>
    <a href="https://social.kernel.org/users/corbet" rel="author noopener">
      <p><img width="48" height="48" src="https://social.kernel.org/media/a0f71e0fdbdc366c471a559808722f7a26efbc44f8ee40047d004619e50e636d.jpg" title="corbet" alt="corbet">
      </p>
    </a>
  </div>
  <div>

        <p><span><a data-user="AtYFKz4ovs7aLQhkbg" href="https://floss.social/@jani" rel="ugc">@<span>jani</span></a></span> <span><a data-user="AtYuB7yJ6QP99m4p2u" href="https://fedi.lwn.net/@lwn" rel="ugc">@<span>lwn</span></a></span> <span><a data-user="AQ8XbCUm1bVwG4RwZs" href="https://society.oftrolls.com/@suihkulokki" rel="ugc">@<span>suihkulokki</span></a></span> Suggestions are much appreciated!  It's not as if we've figured all this stuff out...


        </p>

    </div>
</div>


<div>
  <div>
    <a href="https://society.oftrolls.com/@suihkulokki" rel="author noopener">
      <p><img width="48" height="48" src="https://society.oftrolls.com/system/accounts/avatars/000/017/391/original/8844460ac49b95ba.jpg" title="suihkulokki@society.oftrolls.com" alt="suihkulokki@society.oftrolls.com">
      </p>
    </a>
  </div>
  <div>
<p><span><a href="https://social.kernel.org/users/corbet">@<span>corbet</span></a></span> <span><a href="https://fedi.lwn.net/@lwn">@<span>lwn</span></a></span> The "harder to onboard new users" part is certainly one reason why that solution isn't great </p><p>I just don't really see anything else working long term. Everything else is just kind whack-a-mole where the mole keeps getting more clever.</p>


        </div>
</div>


<div>
    <a href="https://social.treehouse.systems/@mupuf" rel="author noopener">
      <p><img width="48" height="48" src="https://cache.treehouse.systems/accounts/avatars/114/404/123/165/197/547/original/bcec43caeff8ce6f.png" title="mupuf@social.treehouse.systems" alt="mupuf@social.treehouse.systems">
      </p>
    </a>
  </div>


<div>
    <a href="https://floss.social/@jani" rel="author noopener">
      <p><img width="48" height="48" src="https://cdn.masto.host/floss/accounts/avatars/114/414/267/336/681/853/original/2d6785bd4aafc2c8.png" title="jani@floss.social" alt="jani@floss.social">
      </p>
    </a>
  </div>


<div>
  <div>
    <a href="https://social.treehouse.systems/@mupuf" rel="author noopener">
      <p><img width="48" height="48" src="https://cache.treehouse.systems/accounts/avatars/114/404/123/165/197/547/original/bcec43caeff8ce6f.png" title="mupuf@social.treehouse.systems" alt="mupuf@social.treehouse.systems">
      </p>
    </a>
  </div>
  <div>

        <p><span><a href="https://floss.social/@jani">@<span>jani</span></a></span> <span><a href="https://social.kernel.org/users/corbet">@<span>corbet</span></a></span> <span><a href="https://fedi.lwn.net/@lwn">@<span>lwn</span></a></span> <span><a href="https://society.oftrolls.com/@suihkulokki">@<span>suihkulokki</span></a></span> Sorry, I was being too optimistic... I was thinking they wanted sources with high SNR... But you are probably right...</p>

    </div>
</div>


<div>
  <div>
    <a href="https://metalhead.club/@lkundrak" rel="author noopener">
      <p><img width="48" height="48" src="https://media.metalhead.club/accounts/avatars/111/414/337/428/922/859/original/f446360b650617aa.png" title="lkundrak@metalhead.club" alt="lkundrak@metalhead.club">
      </p>
    </a>
  </div>
  <div>

        <p><span><a href="https://social.kernel.org/users/corbet">@<span>corbet</span></a></span> <span><a href="https://fedi.lwn.net/@lwn">@<span>lwn</span></a></span> <span><a href="https://floss.social/@jani">@<span>jani</span></a></span> <span><a href="https://society.oftrolls.com/@suihkulokki">@<span>suihkulokki</span></a></span> one day the photocopiers will get busy after the office hours again, but this time it's going to be linux weekly news instead of the punk fanzines</p>

    </div>
</div>


</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Slop is everywhere for those with eyes to see (287 pts)]]></title>
            <link>https://www.fromjason.xyz/p/notebook/slop-is-everywhere-for-those-with-eyes-to-see/</link>
            <guid>46651443</guid>
            <pubDate>Fri, 16 Jan 2026 20:03:10 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.fromjason.xyz/p/notebook/slop-is-everywhere-for-those-with-eyes-to-see/">https://www.fromjason.xyz/p/notebook/slop-is-everywhere-for-those-with-eyes-to-see/</a>, See on <a href="https://news.ycombinator.com/item?id=46651443">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>   

<p>The size of your plate can influence how much food you eat. The absence of a clock on a casino wall can keep you gambling through the early morning. On social media, our For You Pages give us the illusion of infinite content. How our environments are designed influences how we consume. And wouldn't you know it, everything around us is designed for maximum consumption.</p>
<p>Open TikTok, and you can easily burn through a hundred videos or more before you glance at the time. It doesn't help that the For You Page <a href="https://www.wired.com/story/tiktok-time/">hides the time</a> on our phones.</p>
<p>We are over consuming content on the FYP. The sudden surge of low-quality, AI-generated content, i.e. “AI slop,” is a byproduct of that overconsumption. We don't see it because, well, we're conditioned not to, but slop always arrives on time. Slop is inevitable. Slop is quintessential. Slop is everywhere for those with eyes to see.</p>
<p>Olive oil, wasabi, saffron, vanilla, Wagyu, honey, champagne, and truffle,...reality TV, all hold examples of what happens when <em>demand</em> exceeds <em>supply</em>— companies fill the gap with slop. The free market loves a good filler. So, why should the digital realm be any different?</p>
<p>The For You page is designed to keep us playing the dopamine slot machine for as long as possible. The Average Time on Site metric is still the goose that lays the golden eggs, and both TikTok and Meta are reporting that their egg baskets have never been fuller.</p>
<p>But, there's a problem. On any given platform, only 1-3% of users publish content. It's called the <a href="https://www.nngroup.com/articles/participation-inequality/">90-9-1 rule</a>, and platforms that rely on free user generated content have been trying to solve this problem since the beginning of the commercialized web. The introduction of the For You Page, and the illusion of endless content, has only exasperated the inequity.</p>
<p>Curation used to be part of our media consumption process. We would hop from website to website looking for a laugh. We used to <em>click on hyperlinks</em> for Christ's sake. Now, all we must do is sit at the trough￼ and let daddy Zuck feed us.</p>
<p>In a <a href="https://www.joanwestenberg.com/how-convenience-kills-curiosity/">recent essay</a>, Joan Westenberg makes a complementary argument that the algorithm has “flattened” curiosity by eliminating the need to “hunt” for our content. They go on to say:</p>
<blockquote>
<p>There’s a concept in behavioral science called the “effort heuristic.” It’s the idea that we tend to value information more if we worked for it. The more effort something requires, the more meaning we assign to the result. When all knowledge is made effortless, it’s treated as disposable. There’s no awe, no investment, no delight in the unexpected—only consumption.</p>
</blockquote>
<p>(I'm reminded of the scene in Jurassic Park when the tour Jeep pulls up to the Tyrannosaurus rex exhibit. Doctor Grant says￼ <em>“The T-Rex doesn't want to be fed. It wants to hunt.”</em>)</p>
<p>￼This type of mindless consumption is not only harming our curiosity, it's helping to cheapen creativity for the people who produce what we consume.</p>
<p>Creativity isn't scalable. Content creation has a hard productivity ceiling. Every human-created video on our feeds require some level of writing, production, and editing. Yet the For You Page has made the content consumption so efficient, that perhaps demand has exceeded supply.</p>
<p>If you're a product manager for a social media platform, you can reduce the friction of publishing content to the app, or ship better editing tools, but you can't optimize creative spark. You can't treat humans like content-generating machines (as much as they have tried). Despite the illusion of infinite scrolling thanks to the FYP, art remains a finite resource bound to the whims of human creativity.</p>
<p>You see their problem.</p>
<p>Mark Zuckerberg wants us on his platforms, flicking our thumbs, for as long as possible. But the more we open Instagram, the more creators he needs posting multiple times each day. Mark has very little control over this variable. Creators could suddenly post less, or simply stop posting all together, and there's nothing he could do about it. What's worse, creators could demand Meta pay them for their art.</p>
<p><em>Could you imagine?</em></p>
<p>Actually, yes. And it turns out, you could rather effectively kill a platform if you got a small group of top creators organized and angry.</p>
<h2 id="twenty-on-the-vine" tabindex="-1">Twenty on the Vine <a href="#twenty-on-the-vine">#</a></h2>
<p>In the summer of 2016, twenty social media personalities took down one of the largest mobile video apps on the internet. They wanted money for their labor. The executives at Vine said no. The gang of twenty, who were the highest performing creators on the app, walked away. They stopped posting entertaining content to Vine, and instead repeatedly implored their followers to find them on competing apps.</p>
<p>Vine shut down for good just months later.</p>
<p>From <em><a href="https://archive.ph/eNqBI">Inside the secret meeting of Vine stars that ushered in the app’s demise</a></em>:</p>
<blockquote>
<p>Vine’s spectacular rise and fall showed the power of online creators. Its demise offers crucial lessons for platforms trying to engage with power users — and a deeper understanding of who ultimately controls a social product.</p>
</blockquote>
<p>Vine creators exposed and exploited a weakness in Vine's conventional approach to social media. Follower count had power. Old-style discovery algorithms could be easily manipulated. Vine creators used that power to take over the app, and convinced users to migrate to other platforms.</p>
<p>You see why follower counts are less important today, and why black-box algorithms have full control over who goes viral and who gets “shadow banned.” TikTok saw the mistakes of its predecessor, and made it so content creators could never exercise collective influence again.</p>
<p>Because virality now feels more like gambling, I suspect people post more content today than a decade ago. But it's not enough. Our insatiable appetites for content is pushing for corporations to meet that demand with slop. ￼</p>
<p>If it were up to TikTok and Meta, our feeds would be exclusively robot-made. Humans are a variable they cannot control, and I think they despise us for it.</p>
<p>Anyway, I have good news. Outside of our FYPs you'll find a surplus of art, essays, articles, and videos just waiting to be discovered. And best of all, these artists and writers are making things on their own terms. We, too, can enjoy the products of their labor on our terms, while not giving a dime of our attention to big tech.</p>
<p>This is the open web. Or the social web. Or the open social web. Or the-- you get the point. To find it, you must reacquaint yourself with the lost art of surfing the web.</p>
<p>Surfing the web is very different than scrolling the FYP. You don't often hear the words ”mindful” and “internet” together but, surfing the web was an art of mindful consumption that doesn't much exist today. Not to get all <em>old man yells at cloud</em> at you, but maybe we should bring it back?</p>
<p>Up next: <em>The Lost Art of Surfing The Web</em> (coming soon)</p>

 </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Reading across books with Claude Code (119 pts)]]></title>
            <link>https://pieterma.es/syntopic-reading-claude/</link>
            <guid>46650347</guid>
            <pubDate>Fri, 16 Jan 2026 18:49:29 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://pieterma.es/syntopic-reading-claude/">https://pieterma.es/syntopic-reading-claude/</a>, See on <a href="https://news.ycombinator.com/item?id=46650347">Hacker News</a></p>
<div id="readability-page-1" class="page"><div> <p>LLMs are overused to summarise and underused to help us read deeper.</p>
<p>To explore how they can enrich rather than reduce, I set Claude Code up with tools to mine a library of 100 non-fiction books.
It found sequences of excerpts connected by an interesting idea, or <em>trails</em>.</p>

<p>Here’s a part of one such trail, linking deception in the startup world to the social psychology of mass movements (I’m especially pleased by the jump from Jobs to Theranos):</p>

<h2 id="how-it-works">How it works</h2>
<p><img src="https://pieterma.es/_astro/pipeline.Bl0o8nI__2728Xv.webp" alt="Pipeline diagram" loading="lazy" decoding="async" fetchpriority="auto" width="3396" height="1194"> </p>
<p>The books were selected from Hacker News’ favourites, which I previously <a href="https://hnbooks.pieterma.es/" rel="nofollow" target="_blank">scraped and visualized</a>.</p>
<p>Claude browses the books a chunk at a time. A chunk is a segment of roughly 500 words that aligns with paragraphs when possible.
This length is a good balance between saving tokens and providing enough context for ideas to breathe.</p>
<p>Chunks are indexed by topic, and topics are themselves indexed for search. This makes it easy to look up all passages in the corpus that relate to, say, <em>deception</em>.</p>
<p>This works well when you know what to look for, but search alone can’t tell you which topics are present to begin with.
There are over 100,000 extracted topics, far too many to be browsed directly. To support exploration, they are grouped into a hierarchical tree structure.</p>
<p>This yields around 1,000 top-level topics. They emerge from combining lower-level topics, and not all of them are equally useful:</p>
<ul>
<li><em>Incidents that frustrated Ev Williams</em></li>
<li><em>Names beginning with “Da”</em></li>
<li><em>Events between 1971 &amp; 1974</em></li>
</ul>
<p>However, this <a href="https://en.wikipedia.org/wiki/The_Analytical_Language_of_John_Wilkins" rel="nofollow" target="_blank">Borgesian</a> taxonomy is good enough for Claude to piece together what the books are about.</p>
<p>Claude uses the topic tree and the search via a few CLI tools.<br>
They allow it to:</p>
<ul>
<li>Find all chunks associated with a topic similar to a query.</li>
<li>Find topics which occur in a window of chunks around a given topic.</li>
<li>Find topics that co-occur in multiple books.</li>
<li>Browse topics and chunks that are siblings in the topic tree.</li>
</ul>
<p>To generate the trails, the agent works in stages.</p>
<p><img src="https://pieterma.es/_astro/agent_steps.CPyESBEq_Z2rjTaW.webp" alt="Generate ideas, research a trail, connect the highlights" loading="lazy" decoding="async" fetchpriority="auto" width="1553" height="228"></p>
<ol>
<li>First, it scans the library and the existing trails, and proposes novel trail ideas. It mainly browses the topic tree to find unexplored areas and rarely reads full chunks in depth.</li>
<li>Then, it takes a specific idea and turns it into a trail. It receives seed topics from the previous stage and browses many chunks.
It extracts excerpts, specific sequences of sentences, and decides on how best to order them to support an insight.</li>
<li>Finally, it adds highlights and edges between consecutive excerpts.</li>
</ol>
<h2 id="what-i-learned">What I learned</h2>
<h3 id="claude-code-is-great-for-non-coding-tasks">Claude Code is great for non-coding tasks</h3>
<p>Even though I’ve been using Claude Code to develop for months, my first instinct for this project was to consider it as a traditional pipeline of several discrete stages.
My initial attempt at this system consisted of multiple LLM modules with carefully hand-assembled contexts.</p>
<p>On a whim, I ran Claude with access to the debugging tools I’d been using and a minimal prompt: <em>“find something interesting.”</em>
It immediately did a better job at pulling in what it needed than the pipeline I was trying to tune by hand, while requiring much less orchestration.
It was a clear improvement to push as much of the work into the agent’s loop as possible.</p>
<p>I ended up using Claude as my main interface to the project.<br>
Initially I did so because it inferred the sequence of CLI calls I wanted to run faster than I could recall them.
Then, I used it to automate tasks which weren’t rigid enough to be scripted traditionally.</p>
<p>The latter opened up options that I wouldn’t have considered before.
For example, I changed my mind on how short I wanted excerpts to be.
I communicated my new preference to Claude, which then looked through all the existing trails and edited them as necessary, balancing the way the overall meaning of the trail changed.
Previously, I would’ve likely considered all previous trails to be outdated and generated new ones, because the required edits would’ve been too nuanced to specify.</p>
<p>In general, agents have widened my ambitions.<br>
By taking care of the boilerplate, I no longer shy away from the tedious parts.
Revision is cheap, so I don’t need to plow ahead with suboptimal choices just because it’d be too costly to undo them.
This, in turn, keeps up the momentum and lets me focus on the joyful, creative aspects of the work.</p>
<h3 id="ask-the-agent-what-it-needs">Ask the agent what it needs</h3>
<p>My focus went from optimising prompts to implementing better tools for Claude to use, moving up a rung on the abstraction ladder.</p>
<p>My mental model of the AI component changed: from a function mapping input to output, to a coworker I was assisting.
I spent my time thinking about the affordances that would make the workflow better, as if I were designing them for myself.
That they were to be used by an agent was a mere detail.</p>
<p>This worked because the agent is now intelligent enough that the way it uses these tools overlaps with my own mental model.
It is generally easy to empathise with it and predict what it will do.</p>
<p>Initially I watched Claude’s logs closely and tried to guess where it was lacking a certain ability.
Then I realised I could simply ask it to provide feedback at the end and list the functionality it wished it had.
Claude was excellent at proposing new commands and capabilities that would make the work more efficient.</p>
<p>Claude suggested improvements, which Claude implemented, so Claude could do the work better.
At least I’m still needed to pay for the tokens — for now.</p>
<h3 id="novelty-is-a-useful-guide">Novelty is a useful guide</h3>
<p>It’s hard to quantify <em>interestingness</em> as an objective to optimise for.<br>
<a href="https://trails.pieterma.es/book/13/" rel="nofollow" target="_blank">Why Greatness Cannot Be Planned</a> makes the case that chasing <em>novelty</em> is often a more fruitful approach.
While its conclusions are debated, I’ve found this idea to be a good fit for this project.</p>
<p>As a sign of the times, this novelty search was implemented in two ways:</p>
<ol>
<li>By biasing the search algorithm towards under-explored topics and books.</li>
<li>By asking Claude nicely.</li>
</ol>
<p>A topic’s novelty score was calculated as the mean distance from its embedding’s <em>k</em> nearest neighbors. A book’s novelty score is the average novelty of the unique topics that it contains.
This value was used to rank search results, so that those which were both relevant and novel were more likely to be seen.</p>
<p>On a prompting level, Claude starts the ideation phase by looking at all the existing trails and is asked to avoid any conceptual overlap.
This works fairly well, though it is often distracted by any topics related to secrecy, systems theory, or tacit knowledge.</p>
<p>It’s as if the very act of finding connections in a corpus summons the spirit of Umberto Eco and amps up the conspiratorial thinking.</p>
<h2 id="how-its-implemented">How it’s implemented</h2>
<p><img src="https://pieterma.es/_astro/implementation.CNN37YWY_Z1HGHsR.webp" alt="Implementation diagram" loading="lazy" decoding="async" fetchpriority="auto" width="1591" height="1959"></p>
<ul>
<li>EPUBs are parsed using <a href="https://github.com/rushter/selectolax" rel="nofollow" target="_blank"><code>selectolax</code></a>, which I picked over BeautifulSoup for its speed and simpler API.</li>
<li>Everything from the plain text to the topic tree is stored in SQLite. Embeddings are stored using <a href="https://github.com/asg017/sqlite-vec" rel="nofollow" target="_blank"><code>sqlite-vec</code></a>.</li>
<li>The text is split into sentences using <a href="https://github.com/superlinear-ai/wtpsplit-lite" rel="nofollow" target="_blank"><code>wtpsplit</code></a> (the <code>sat-6l-sm</code> model).
Those sentences are then grouped into chunks, trying to get up to 500 words without breaking up paragraphs.</li>
<li>I used <a href="https://dspy.ai/" rel="nofollow" target="_blank"><code>DSPy</code></a> to call LLMs. It worked well for the structured data extraction and it was easy to switch out different models to experiment.
I tried its prompt optimizers before I went full agentic, and their results were very promising.</li>
<li>I settled on Gemini 2.5 Flash Lite for topic extraction.
The model gets passed a chunk and is asked to return 3-5 topics. It is also asked whether the chunk is <em>useful</em>, in order to filter out index entries, acknowledgements, orphan headers, etc.
I was surprised at how stable these extracted topics were: similar chunks often shared some of the exact same topic labels.
Processing 100 books used about 60M input tokens and ~£10 in total.</li>
<li>After a couple books got indexed, I shared the results with Claude Opus along with the original prompt and asked it to improve it.
This is a half-baked single iteration of the type of prompt optimisation DSPy implements, and it worked rather well.</li>
<li>Topic pairs with a distance below a threshold get merged together. This takes care of near-duplicates such as <em>“Startup founder”</em>, <em>“Startup founders”</em>, and <em>“Founder of startups”</em>.</li>
<li>The CLI output uses a semi-XML format. In order to stimulate navigating, most output is nested with related content. For example, when searching for a topic, chunks are shown with the other topics they contain.
This allows us to get a sense of what the chunk is about, as well as which other topics might be interesting.
There’s probably more token-efficient formats, but I never hit the limit of the context window.</li>
</ul>
<pre tabindex="0" data-language="xml"><code><span><span>&lt;</span><span>topics</span><span> query</span><span>=</span><span>"</span><span>deception</span><span>"</span><span> count</span><span>=</span><span>"</span><span>1</span><span>"</span><span>&gt;</span></span>
<span><span>  &lt;</span><span>topic</span><span> id</span><span>=</span><span>"</span><span>47193</span><span>"</span><span> books</span><span>=</span><span>"</span><span>7</span><span>"</span><span> score</span><span>=</span><span>"</span><span>0.0173</span><span>"</span><span> label</span><span>=</span><span>"</span><span>Deception</span><span>"</span><span>&gt;</span></span>
<span><span>    &lt;</span><span>chunk</span><span> id</span><span>=</span><span>"</span><span>186</span><span>"</span><span> book</span><span>=</span><span>"</span><span>1</span><span>"</span><span>&gt;</span></span>
<span><span>      &lt;</span><span>topic</span><span> id</span><span>=</span><span>"</span><span>47192</span><span>"</span><span> label</span><span>=</span><span>"</span><span>Business deal</span><span>"</span><span>/&gt;</span></span>
<span><span>      &lt;</span><span>topic</span><span> id</span><span>=</span><span>"</span><span>47108</span><span>"</span><span> label</span><span>=</span><span>"</span><span>Internal conflict</span><span>"</span><span>/&gt;</span></span>
<span><span>      &lt;</span><span>topic</span><span> id</span><span>=</span><span>"</span><span>46623</span><span>"</span><span> label</span><span>=</span><span>"</span><span>Startup founders</span><span>"</span><span>/&gt;</span></span>
<span><span>    &lt;/</span><span>chunk</span><span>&gt;</span></span>
<span><span>    &lt;</span><span>chunk</span><span> id</span><span>=</span><span>"</span><span>1484</span><span>"</span><span> book</span><span>=</span><span>"</span><span>4</span><span>"</span><span>&gt;</span></span>
<span><span>      &lt;</span><span>topic</span><span> id</span><span>=</span><span>"</span><span>51835</span><span>"</span><span> label</span><span>=</span><span>"</span><span>Gawker Media</span><span>"</span><span>/&gt;</span></span>
<span><span>      &lt;</span><span>topic</span><span> id</span><span>=</span><span>"</span><span>53006</span><span>"</span><span> label</span><span>=</span><span>"</span><span>Legal Action</span><span>"</span><span>/&gt;</span></span>
<span><span>      &lt;</span><span>topic</span><span> id</span><span>=</span><span>"</span><span>52934</span><span>"</span><span> label</span><span>=</span><span>"</span><span>Maskirovka</span><span>"</span><span>/&gt;</span></span>
<span><span>      &lt;</span><span>topic</span><span> id</span><span>=</span><span>"</span><span>52181</span><span>"</span><span> label</span><span>=</span><span>"</span><span>Strategy</span><span>"</span><span>/&gt;</span></span>
<span><span>    &lt;/</span><span>chunk</span><span>&gt;</span></span>
<span><span>    &lt;</span><span>chunk</span><span> id</span><span>=</span><span>"</span><span>2913</span><span>"</span><span> book</span><span>=</span><span>"</span><span>9</span><span>"</span><span>&gt;</span></span>
<span><span>      &lt;</span><span>topic</span><span> id</span><span>=</span><span>"</span><span>59348</span><span>"</span><span> label</span><span>=</span><span>"</span><span>Blood testing system</span><span>"</span><span>/&gt;</span></span>
<span><span>      &lt;</span><span>topic</span><span> id</span><span>=</span><span>"</span><span>59329</span><span>"</span><span> label</span><span>=</span><span>"</span><span>Elizabeth Holmes</span><span>"</span><span>/&gt;</span></span>
<span><span>      &lt;</span><span>topic</span><span> id</span><span>=</span><span>"</span><span>59352</span><span>"</span><span> label</span><span>=</span><span>"</span><span>Investor demo</span><span>"</span><span>/&gt;</span></span>
<span><span>      &lt;</span><span>topic</span><span> id</span><span>=</span><span>"</span><span>59349</span><span>"</span><span> label</span><span>=</span><span>"</span><span>Theranos</span><span>"</span><span>/&gt;</span></span>
<span><span>    &lt;/</span><span>chunk</span><span>&gt;</span></span>
<span><span>  &lt;/</span><span>topic</span><span>&gt;</span></span>
<span><span>&lt;/</span><span>topics</span><span>&gt;</span></span></code></pre>
<ul>
<li>
<p>Topics are embedded using <code>google/embeddinggemma-300m</code> and reranked using <code>BAAI/bge-reranker-v2-m3</code>.</p>
</li>
<li>
<p>Many CLI tools require loading the embedding model and other expensive state. The first call transparently starts a separate server process which loads all these resources once and holds onto them for a while.
Subsequent CLI calls use this server through Python’s <code>multiprocessing.connection</code>.</p>
</li>
<li>
<p>The topic collection is turned into a graph (backed by <code>igraph</code>) by adding edges based on the similarity of their embeddings and the point-wise mutual information of their co-occurrences.</p>
</li>
<li>
<p>The graph is turned into a tree by applying <a href="https://leidenalg.readthedocs.io/en/stable/" rel="nofollow" target="_blank">Leiden</a> partitioning recursively until a minimum size is reached.
I tried the Surprise quality function because it had no parameters to tweak, and found it to be good enough. Each group is labelled by Gemini based on all the topics that it contains.</p>
</li>
<li>
<p>Excerpts are cleaned by Gemini to remove EPUB artifacts, parsing errors, headers, footnotes, etc.
Doing this only for excerpts that are actually shown, instead of during pre-processing, saved a lot of tokens.</p>
</li>
</ul> </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Our approach to advertising and expanding access to ChatGPT (254 pts)]]></title>
            <link>https://openai.com/index/our-approach-to-advertising-and-expanding-access/</link>
            <guid>46649577</guid>
            <pubDate>Fri, 16 Jan 2026 18:02:19 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://openai.com/index/our-approach-to-advertising-and-expanding-access/">https://openai.com/index/our-approach-to-advertising-and-expanding-access/</a>, See on <a href="https://news.ycombinator.com/item?id=46649577">Hacker News</a></p>
Couldn't get https://openai.com/index/our-approach-to-advertising-and-expanding-access/: Error: Request failed with status code 403]]></description>
        </item>
        <item>
            <title><![CDATA[STFU (918 pts)]]></title>
            <link>https://github.com/Pankajtanwarbanna/stfu</link>
            <guid>46649142</guid>
            <pubDate>Fri, 16 Jan 2026 17:32:40 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/Pankajtanwarbanna/stfu">https://github.com/Pankajtanwarbanna/stfu</a>, See on <a href="https://news.ycombinator.com/item?id=46649142">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto"><h2 tabindex="-1" dir="auto">STFU 🤫</h2><a id="user-content-stfu-" aria-label="Permalink: STFU 🤫" href="#stfu-"></a></p>
<p dir="auto">i was at bombay airport. some dude was watching reels on full volume and laughing loudly. asking nicely doesn't work anymore. me being me, didn't have the courage to speak up.</p>
<p dir="auto">so i built a tiny app that plays back the same audio it hears, delayed by ~2 seconds. asked claude, it spat out a working version in one prompt. surprisingly WORKS.</p>
<p dir="auto">discussion - <a href="https://x.com/the2ndfloorguy/status/2011734249871954188" rel="nofollow">https://x.com/the2ndfloorguy/status/2011734249871954188</a></p>
<p dir="auto"><h2 tabindex="-1" dir="auto">the science (probably)</h2><a id="user-content-the-science-probably" aria-label="Permalink: the science (probably)" href="#the-science-probably"></a></p>
<p dir="auto">something something auditory feedback loop something something cognitive dissonance. idk i'm not a neuroscientist. all i know is it makes people shut up and that's good enough for me.</p>
<blockquote>
<p dir="auto">straight up honest - originally called this "make-it-stop" but then saw <a href="https://x.com/TimDarcet" rel="nofollow">@TimDarcet</a> also built <a href="https://tim.darcet.fr/shutthefuckup/" rel="nofollow">similar</a> and named it STFU. wayyyyy better name. so stole it. sorry not sorry.</p>
</blockquote>
<hr>
<p dir="auto">made with spite and web audio api. do whatever you want with it.</p>
</article></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[East Germany balloon escape (584 pts)]]></title>
            <link>https://en.wikipedia.org/wiki/East_Germany_balloon_escape</link>
            <guid>46648916</guid>
            <pubDate>Fri, 16 Jan 2026 17:16:33 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://en.wikipedia.org/wiki/East_Germany_balloon_escape">https://en.wikipedia.org/wiki/East_Germany_balloon_escape</a>, See on <a href="https://news.ycombinator.com/item?id=46648916">Hacker News</a></p>
Couldn't get https://en.wikipedia.org/wiki/East_Germany_balloon_escape: Error: Request failed with status code 403]]></description>
        </item>
        <item>
            <title><![CDATA[Dell UltraSharp 52 Thunderbolt Hub Monitor (252 pts)]]></title>
            <link>https://www.dell.com/en-us/shop/dell-ultrasharp-52-thunderbolt-hub-monitor-u5226kw/apd/210-bthw/monitors-monitor-accessories</link>
            <guid>46648885</guid>
            <pubDate>Fri, 16 Jan 2026 17:14:15 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.dell.com/en-us/shop/dell-ultrasharp-52-thunderbolt-hub-monitor-u5226kw/apd/210-bthw/monitors-monitor-accessories">https://www.dell.com/en-us/shop/dell-ultrasharp-52-thunderbolt-hub-monitor-u5226kw/apd/210-bthw/monitors-monitor-accessories</a>, See on <a href="https://news.ycombinator.com/item?id=46648885">Hacker News</a></p>
Couldn't get https://www.dell.com/en-us/shop/dell-ultrasharp-52-thunderbolt-hub-monitor-u5226kw/apd/210-bthw/monitors-monitor-accessories: Error: Request failed with status code 403]]></description>
        </item>
        <item>
            <title><![CDATA[Canada slashes 100% tariffs on Chinese EVs to 6% (422 pts)]]></title>
            <link>https://electrek.co/2026/01/16/canada-breaks-with-us-slashes-100-tariffs-chinese-evs/</link>
            <guid>46648778</guid>
            <pubDate>Fri, 16 Jan 2026 17:05:28 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://electrek.co/2026/01/16/canada-breaks-with-us-slashes-100-tariffs-chinese-evs/">https://electrek.co/2026/01/16/canada-breaks-with-us-slashes-100-tariffs-chinese-evs/</a>, See on <a href="https://news.ycombinator.com/item?id=46648778">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
					
<figure>

	<img width="1600" height="777" src="https://electrek.co/wp-content/uploads/sites/3/2026/01/Canada-China-trade-deal.png?w=1600" alt="Canada China trade deal" srcset="https://i0.wp.com/electrek.co/wp-content/uploads/sites/3/2026/01/Canada-China-trade-deal.png?w=320&amp;quality=82&amp;strip=all&amp;ssl=1 320w, https://i0.wp.com/electrek.co/wp-content/uploads/sites/3/2026/01/Canada-China-trade-deal.png?w=640&amp;quality=82&amp;strip=all&amp;ssl=1 640w, https://i0.wp.com/electrek.co/wp-content/uploads/sites/3/2026/01/Canada-China-trade-deal.png?w=1024&amp;quality=82&amp;strip=all&amp;ssl=1 1024w, https://i0.wp.com/electrek.co/wp-content/uploads/sites/3/2026/01/Canada-China-trade-deal.png?w=1500&amp;quality=82&amp;strip=all&amp;ssl=1 1500w" decoding="async" fetchpriority="high">
	</figure>

<p>In a massive shift in North American trade policy, Prime Minister Mark Carney announced today a new “strategic partnership” with China that effectively reopens the Canadian border to Chinese electric vehicles.</p>



<p>The move marks a significant departure from the United States’ hardline protectionist stance and could bring affordable EV options like the BYD Seagull to Canadian roads as early as this year.</p>



<p>For the last two years, Canada has largely walked in lockstep with the US regarding Chinese EV tariffs. Following the Biden administration’s move to impose 100% tariffs on Chinese EVs, Canada implemented similar surtaxes, effectively freezing companies like BYD, Nio, and Zeekr out of the market.</p>



<p>Today, that ice is breaking.</p>	
	



<p>As part of a broader trade agreement secured by Prime Minister Carney in Beijing this week, Canada has agreed to allow an annual quota of <strong>49,000 Chinese electric vehicles</strong> into the country at the tariff rate of just <strong>6.1%</strong>.</p>



<p>According to the <a target="_blank" rel="noreferrer noopener" href="https://www.pm.gc.ca/en/news/news-releases/2026/01/16/prime-minister-carney-forges-new-strategic-partnership-peoples">Prime Minister’s office</a>, this volume represents less than 3% of the Canadian new vehicle market. However, the deal explicitly targets the low end of the market, with the government anticipating that within five years, “more than 50% of these vehicles will be affordable EVs with an import price of less than $35,000.”</p>



<p>In exchange for opening the EV floodgates (or at least starting to break the dam), China has agreed to lower tariffs on Canadian canola seed from roughly 85% to 15% and to lift restrictions on Canadian lobster and crab.</p>



<p>The Canadian government claims this isn’t just about imports. The text of the agreement states that the deal is expected to “drive considerable new Chinese joint-venture investment in Canada” to build out the domestic EV supply chain.</p>



<h2 id="h-electrek-s-take">Electrek’s Take</h2>



<p>While 49,000 vehicles might sound like a small number compared to the total market, it’s a specific, targeted wedge that changes the entire dynamic of the North American EV market.</p>



<p>For years, we at <em>Electrek</em> have argued that protectionism, while perhaps protecting legacy automaker jobs in the short term, ultimately hurts consumers and slows down the transition to sustainable transport.</p>




	<p>Meanwhile, protecting domestic automakers from Chinese competition in their home market makes them less competitive on the global stage, virtually giving the global market to China.</p>



<p>The reality is that Chinese automakers are currently building some of the best, most affordable EVs in the world. Keeping them out entirely not only hurts consumers but also hurts innovation.</p>



<p>Of course, this is going to make Washington furious. The US has been trying to build a “Fortress North America” against Chinese EVs. By letting 49,000 units in tariff-free (or near tariff-free), Canada is effectively saying it values affordable climate solutions (and canola exports) more than complete alignment with US industrial policy, which is understandable since the US was the one to go hostile on trade with Canada.</p>



<p>The interesting detail here is the “Joint Venture” language. It looks like Carney is taking a page out of China’s own playbook. Canada seems to be using this quota as a carrot to get companies like BYD or CATL to set up shop in Canada and maybe help Canadian companies learn from those giants.</p>
	<p><a target="_blank" rel="nofollow" href="https://google.com/preferences/source?q=https://electrek.co" aria-label="Add Electrek as a preferred source on Google">
			<img decoding="async" src="https://electrek.co/wp-content/themes/ninetofive/dist/images/google-preferred-source-badge-dark.png" alt="Add Electrek as a preferred source on Google">
			<img decoding="async" src="https://electrek.co/wp-content/themes/ninetofive/dist/images/google-preferred-source-badge-light.png" alt="Add Electrek as a preferred source on Google">
		</a>
	</p>
	<p><em>FTC: We use income earning auto affiliate links.</em> <a href="https://electrek.co/about/#affiliate">More.</a></p>				</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[6-Day and IP Address Certificates Are Generally Available (437 pts)]]></title>
            <link>https://letsencrypt.org/2026/01/15/6day-and-ip-general-availability</link>
            <guid>46647491</guid>
            <pubDate>Fri, 16 Jan 2026 15:37:19 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://letsencrypt.org/2026/01/15/6day-and-ip-general-availability">https://letsencrypt.org/2026/01/15/6day-and-ip-general-availability</a>, See on <a href="https://news.ycombinator.com/item?id=46647491">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
      
        
      
      
      
        <p>
          By Matthew McPherrin · 
          
            
            
            <time datetime="2026-01-15T00:00:00+00:00">January 15, 2026</time>
          
        </p>
      
      
    </div><div>
      <p>Short-lived and IP address certificates are now generally available from Let’s Encrypt. These certificates are valid for 160 hours, just over six days. In order to get a short-lived certificate subscribers simply need to select the ‘shortlived’ <a href="https://letsencrypt.org/docs/profiles/">certificate profile</a> in their ACME client.</p>
<p>Short-lived certificates improve security by requiring more frequent validation and reducing reliance on unreliable revocation mechanisms. If a certificate’s private key is exposed or compromised, revocation has historically been the way to mitigate damage prior to the certificate’s expiration. Unfortunately, revocation is an unreliable system so many relying parties continue to be vulnerable until the certificate expires, a period as long as 90 days. With short-lived certificates that vulnerability window is greatly reduced.</p>
<p>Short-lived certificates are opt-in and we have no plan to make them the default at this time. Subscribers that have fully automated their renewal process should be able to switch to short-lived certificates easily if they wish, but we understand that not everyone is in that position and generally comfortable with this significantly shorter lifetime. We hope that over time everyone moves to automated solutions and we can demonstrate that short-lived certificates work well.</p>
<p>Our default certificate lifetimes will be going from 90 days down to 45 days over the next few years, <a href="https://letsencrypt.org/2025/12/02/from-90-to-45">as previously announced</a>.</p>
<p>IP address certificates allow server operators to authenticate TLS connections to IP addresses rather than domain names. Let’s Encrypt supports both IPv4 and IPv6. IP address certificates must be short-lived certificates, a decision we made because IP addresses are more transient than domain names, so validating more frequently is important. You can learn more about our IP address certificates and the use cases for them from our <a href="https://letsencrypt.org/2025/07/01/issuing-our-first-ip-address-certificate">post announcing our first IP Certificate</a>.</p>
<p>We’d like to thank the Open Technology Fund and Sovereign Tech Agency, along with our <a href="https://www.abetterinternet.org/sponsors/">Sponsors</a> and Donors, for supporting the development of this work.</p>

      

    </div></div>]]></description>
        </item>
    </channel>
</rss>