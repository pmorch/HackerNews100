<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
    <channel>
        <title>HN100 - Readable Contents</title>
        <link>https://hn.algolia.com/api/v1/search_by_date?tags=%28story,poll%29&amp;numericFilters=points%3E100</link>
        <description>Uses Readability to add bodies to the RSS feed</description>
        <lastBuildDate>Sun, 02 Jul 2023 21:00:04 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[AMD CPU Use Among Linux Gamers Approaching 70% Marketshare (109 pts)]]></title>
            <link>https://www.phoronix.com/news/AMD-CPU-Linux-Gaming-67p</link>
            <guid>36563979</guid>
            <pubDate>Sun, 02 Jul 2023 18:09:29 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.phoronix.com/news/AMD-CPU-Linux-Gaming-67p">https://www.phoronix.com/news/AMD-CPU-Linux-Gaming-67p</a>, See on <a href="https://news.ycombinator.com/item?id=36563979">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
<p><img alt="AMD" src="https://www.phoronix.com/assets/categories/amd.webp" width="100" height="100"></p><p>
Besides being curious about the Steam Survey results for indicating the size of the Linux gaming marketshare as an overall percentage, one of the interesting metrics we are curious about each month is the AMD vs. Intel CPU marketshare for Linux gaming. AMD has been on quite an upward trajectory among Linux gamers/enthusiasts in recent years not only for their Radeon graphics cards with their popular open-source driver stack but their Ryzen CPUs have become extremely popular with Linux users. With <a href="https://www.phoronix.com/news/Steam-June-2023-Statistics">the new Steam Survey results for June</a>, AMD CPUs are found on nearly 70% of Linux gaming systems polled by Steam.
</p><p>
The June results put the AMD CPU marketshare for Linux users at 67%, a remarkable 7% increase month-over-month. In part that's due to the Steam Deck being powered by an AMD SoC but it's been a trend building for some time of AMD's increasing Ryzen CPU popularity among Linux users to their open-source driver work and continuing to build more good will with the community.
</p><p><img src="https://www.phoronix.net/image.php?id=2023&amp;image=steam_june_4"></p>
<p>In comparison, last June the AMD CPU Linux gaming marketshare <a href="https://www.phoronix.com/news/Steam-Linux-June-2022">came in at 45%</a> while Intel was at 54%. Or at the start of 2023, <a href="https://www.phoronix.com/news/Steam-Survey-January-2023">AMD CPUs were at a 55% marketshare</a> among Linux gamers. Or if going back six years, <a href="https://www.phoronix.com/news/Steam-Survey-July-2017">AMD CPU use among Linux gamers was a mere 18%</a> during the early Ryzen days.
</p><p><img src="https://www.phoronix.net/image.php?id=2023&amp;image=windows_cpu_gamers_june" alt="Windows CPU stats for June"></p>
<p>It's also the direct opposite on the Windows side. When looking at the Steam Survey results for June limited to Windows, there Intel has a 68% marketshare to AMD at 32%.
</p><p><a href="https://www.phoronix.com/image-viewer.php?id=2023&amp;image=amd_gaming_cpus_june_lrg" target="_blank"><img src="https://www.phoronix.net/image.php?id=2023&amp;image=amd_gaming_cpus_june_med" alt="AMD Ryzen boxes, cheers"></a></p>
<p>Beyond the Steam Deck, it's looking like AMD's efforts around open-source drivers, <a href="https://www.phoronix.com/news/Dell-Mario-On-AMD-Linux-Team">AMD expanding their Linux client (Ryzen) development efforts</a> over the past two years, promises around <a href="https://www.phoronix.com/search/OpenSIL">OpenSIL</a>, and other efforts commonly covered on Phoronix are paying off for AMD in wooing over their Linux gaming customer base.</p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[First 'tooth regrowth' medicine moves toward clinical trials in Japan (301 pts)]]></title>
            <link>https://mainichi.jp/english/articles/20230609/p2a/00m/0sc/026000c</link>
            <guid>36563590</guid>
            <pubDate>Sun, 02 Jul 2023 17:33:17 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://mainichi.jp/english/articles/20230609/p2a/00m/0sc/026000c">https://mainichi.jp/english/articles/20230609/p2a/00m/0sc/026000c</a>, See on <a href="https://news.ycombinator.com/item?id=36563590">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
<!-- cxenseparse_start -->

<div>
<figure>
<div>
<a data-href="https://cdn.mainichi.jp/vol1/2023/06/09/20230609p2a00m0na021000p/9.jpg?1" data-lightbox="photos" data-title="(Getty)">
<span>
<img src="https://cdn.mainichi.jp/vol1/2023/06/09/20230609p2a00m0na021000p/6.jpg?1" alt="">

</span>

</a>
</div>
<figcaption>(Getty)</figcaption>
</figure>
</div>

<div>
<figure>
<div>
<a data-href="https://cdn.mainichi.jp/vol1/2023/06/09/20230609p2a00m0na022000p/9.jpg?1" data-lightbox="photos" data-title="Katsu Takahashi, head of the dentistry and oral surgery department at the Medical Research Institute Kitano Hospital, is seen in the city of Osaka's Kita Ward on May 16, 2023. (Mainichi/Mirai Nagira)">
<span>
<img src="https://cdn.mainichi.jp/vol1/2023/06/09/20230609p2a00m0na022000p/7.jpg?1" alt="">

</span>

</a>
</div>
<figcaption>Katsu Takahashi, head of the dentistry and oral surgery department at the Medical Research Institute Kitano Hospital, is seen in the city of Osaka's Kita Ward on May 16, 2023. (Mainichi/Mirai Nagira)</figcaption>
</figure>
</div>
<p>
    TOKYO -- A Japanese research team is making progress on the development of a groundbreaking medication that may allow people to grow new teeth, with clinical trials set to begin in July 2024.
</p>
<!-- cxenseparse_end -->

<!-- cxenseparse_start -->
<p>
    The tooth regrowth medicine is intended for people who lack a full set of adult teeth due to congenital factors. The team is aiming to have it ready for general use in 2030.
</p>
<p>
    In prior animal experiments, the medicine prompted the growth of "third-generation" teeth following baby teeth and then permanent adult teeth.
</p>
<p>
    "The idea of growing new teeth is every dentist's dream. I've been working on this since I was a graduate student. I was confident I'd be able to make it happen," said Katsu Takahashi, lead researcher and head of the dentistry and oral surgery department at the Medical Research Institute Kitano Hospital in the city of Osaka.
</p>

<div>
<figure>
<div>
<a data-href="https://cdn.mainichi.jp/vol1/2023/06/09/20230609p2a00m0na023000p/7.jpg?1" data-lightbox="photos" data-title="A new tooth is seen growing in a mouse treated with the tooth regrowth medicine. (Photo provided by Katsu Takahashi, head of the dentistry and oral surgery department at the Medical Research Institute Kitano Hospital)">
<span>
<img src="https://cdn.mainichi.jp/vol1/2023/06/09/20230609p2a00m0na023000p/6.jpg?1" alt="">

</span>

</a>
</div>
<figcaption>A new tooth is seen growing in a mouse treated with the tooth regrowth medicine. (Photo provided by Katsu Takahashi, head of the dentistry and oral surgery department at the Medical Research Institute Kitano Hospital)</figcaption>
</figure>
</div>
<p>
    Anodontia is a congenital condition that causes the growth of fewer than a full set of teeth, present in around 1% of the population. Genetic factors are thought to be the major cause for the one-tenth of anodontia patients who lack six or more teeth, a condition categorized as oligodontia. These conditions are also known as tooth agenesis. People who grow up with tooth agenesis struggle with basic abilities like chewing, swallowing and speaking from a young age, which can negatively impact their development.
</p>
<p>
    After completing a dentistry degree, Takahashi went on to graduate studies in molecular biology at Kyoto University in 1991. Afterwards, he studied in the U.S.
</p>
<p>
    Around that time, research around the world had begun to pinpoint genes that, when deleted, would cause genetically modified mice to grow fewer teeth. "The number of teeth varied through the mutation of just one gene. If we make that the target of our research, there should be a way to change the number of teeth (people have)," Takahashi said of his thoughts at the time.
</p>
<p>
    <b>Global attention</b>
</p>

<div>
<figure>
<div>
<a data-href="https://cdn.mainichi.jp/vol1/2023/06/09/20230609p2a00m0na024000p/6.jpg?1" data-lightbox="photos" data-title="The front teeth of a ferret treated with tooth regrowth medicine are seen in a photo provided by Katsu Takahashi, head of the dentistry and oral surgery department at the Medical Research Institute Kitano Hospital. The medicine induced the growth of an additional seventh tooth (center).">
<span>
<img src="https://cdn.mainichi.jp/vol1/2023/06/09/20230609p2a00m0na024000p/6.jpg?1" alt="">

</span>

</a>
</div>
<figcaption>The front teeth of a ferret treated with tooth regrowth medicine are seen in a photo provided by Katsu Takahashi, head of the dentistry and oral surgery department at the Medical Research Institute Kitano Hospital. The medicine induced the growth of an additional seventh tooth (center).</figcaption>
</figure>
</div>
<p>
    It was around 2005, when he delved further into the subject at Kyoto University after returning to Japan, that he began to see a bright path for his continued research. The researchers found that mice lacking a certain gene had an increased number of teeth. A protein called USAG-1, synthesized by the gene, was found to limit the growth of teeth. In other words, blocking the action of that protein could allow more teeth to grow.
</p>
<p>
    Takahashi's research team narrowed their focus onto USAG-1, and developed a neutralizing antibody medicine able to block the protein's function. In experiments in 2018, mice with a congenitally low number of teeth were given medicine that resulted in new teeth coming through. The research results were published in a U.S. scientific paper in 2021, and gained much attention as the beginnings of the world's first tooth regeneration medicine.
</p>
<p>
    Work is now underway to get the drug ready for human use. Once confirmed to have no ill effects on the human body, it will be aimed at treating children aged 2 to 6 who exhibit anodontia. "We hope to pave the way for the medicine's clinical use," Takahashi said.
</p>
<p>
    <b> Medicine could be game-changer</b>
</p>
<p>
    If successful, a drug to regenerate teeth may be a game-changer for the entire field of dentistry.
</p>
<p>
    Animals including sharks and some reptile species can continuously regrow teeth. It's been assumed that humans only grow two sets of teeth in their lifetime, but in fact, there is evidence that we also have the "buds" for a third set.
</p>
<p>
    Around 1% of the population exhibits the converse of anodontia: hyperdontia, a congenital condition causing a higher-than-normal number of teeth. According to research by Takahashi's team, one in three such cases manifests as the growth of a third set of teeth. Takahashi believes that in most cases, humans' ability to grow a third set was lost over time.
</p>
<p>
    When the researchers applied the drug to ferrets, they grew an additional seventh front tooth. As the new teeth grew in between the existing front teeth and were of the same shape, the medicine is thought to have induced the generation of third-set teeth in the animals.
</p>
<p>
    When treatment of teeth is no longer possible due to severe cavities or erosion of the dental sockets, known as pyorrhea, people lose them and need to rely on dental appliances such as dentures. The ability to grow third-generation teeth could change that. "In any case, we're hoping to see a time when tooth-regrowth medicine is a third choice alongside dentures and implants," Takahashi said.
</p>
<p>
    For further information or inquiries about Takahashi's research, please visit https://www.kitano-hp.or.jp/toothreg/ (in Japanese).
</p>
<p>
    (Japanese original by Mirai Nagira, Science &amp; Environment News Department)
</p>
<!-- cxenseparse_end -->

<!--| tools BGN |-->

<!--| tools END |-->
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Make Your Renders Unnecessarily Complicated by Modeling a Film Camera in Blender [video] (173 pts)]]></title>
            <link>https://www.youtube.com/watch?v=YE9rEQAGpLw</link>
            <guid>36562757</guid>
            <pubDate>Sun, 02 Jul 2023 16:03:59 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.youtube.com/watch?v=YE9rEQAGpLw">https://www.youtube.com/watch?v=YE9rEQAGpLw</a>, See on <a href="https://news.ycombinator.com/item?id=36562757">Hacker News</a></p>
&lt;Unparsable&gt;]]></description>
        </item>
        <item>
            <title><![CDATA[Aspartame: Once More Unto the Breach (149 pts)]]></title>
            <link>https://dynomight.net/aspartame/</link>
            <guid>36562739</guid>
            <pubDate>Sun, 02 Jul 2023 16:02:36 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://dynomight.net/aspartame/">https://dynomight.net/aspartame/</a>, See on <a href="https://news.ycombinator.com/item?id=36562739">Hacker News</a></p>
<div id="readability-page-1" class="page"><section>
    <p>Look, I get it. Diet Coke tastes sweet because it has aspartame in it. Aspartame is a weird synthetic molecule that’s 200 times sweeter than sucrose. Half of the world’s aspartame is made by Ajinomoto of Tokyo—the same company that first brought us MSG back in 1909.</p>

<p><img src="https://dynomight.net/img/aspartame/ajinomoto-headquarters.jpg" alt="ajinomoto headquarters"></p>

<p>If you look on <a href="https://en.wikipedia.org/wiki/Aspartame">Wikipedia</a>, you’ll see that aspartame is a <em>methyl ester of the aspartic acid phenylalanine dipeptide</em>, which isn’t, like, comforting.</p>

<p>It’s normal to have a prior that aspartame might be bad for you. Certainly, that was <em>my</em> prior. Without looking at any evidence, any reasonable person would think like this:</p>

<table>
  <thead>
    <tr>
      <th>aspartame is…</th>
      <th>odds</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>…good for you</td>
      <td>very unlikely</td>
    </tr>
    <tr>
      <td>…harmless</td>
      <td>plausible</td>
    </tr>
    <tr>
      <td>…bad for you</td>
      <td>plausible</td>
    </tr>
  </tbody>
</table>

<p>This makes the decision theory pretty simple: Consuming aspartame has little upside, but substantial downside.</p>

<p>The thing is, we do have evidence. We have a lot of evidence. The FDA calls aspartame “one of the most exhaustively studied substances in the human food supply”.</p>

<p>The other thing is, the alternative to aspartame often isn’t <em>no aspartame</em> but rather <em>sugar</em> or <a href="https://dynomight.net/cola/#mexican-coke"><em>corn syrup</em></a> or even perhaps even <a href="https://dynomight.net/alcohol/"><em>alcohol</em></a>.</p>

<p>I don’t want to convince anyone to consume aspartame. But if we’re choosing between aspartame and other risky things, we should evaluate the relative risks.</p>

<h2 id="what-happens-to-aspartame-after-it-goes-into-your-body">What happens to aspartame after it goes into your body</h2>

<p>Let’s forget about safety for a second, and just look at the causal chain. Say you drink a Diet Coke. What happens next?</p>

<h3 id="fact-1-aspartame-is-quickly-broken-down-in-the-gut">Fact 1: Aspartame is quickly broken down in the gut.</h3>

<p>After you drink a Diet Coke, the aspartame goes to your guts. After that, it’s very quickly broken down into 50% phenylalanine, 40% aspartic acid, and 10% methanol. For example, a can of Diet Coke contains 184 mg of aspartame. This becomes:</p>

<ul>
  <li>92 mg of phenylalanine</li>
  <li>73.6 mg aspartic acid</li>
  <li>18.4 mg methanol</li>
</ul>

<details>
  <summary>This happens quickly and completely. No aspartame ever enters your bloodstream. The rest of your body only ever sees these three other chemicals. (<u>click here or on any paragraph with a triangle for more details</u>)</summary>

  <p>The European Food Safety Authority Report (EFSA) report: <a href="https://www.efsa.europa.eu/en/efsajournal/pub/3496">Scientific Opinion on the re-evaluation of aspartame as a food additive</a> gives this figure (slightly modified):</p>

  <p><img src="https://dynomight.net/img/aspartame/metabolism-bigger2.svg" alt="metabolism"></p>

  <p>The same report gives this discussion:</p>

  <p><img src="https://dynomight.net/img/aspartame/EFSA-breakdown.svg" alt="EFSA breakdown"></p>

</details>

<h3 id="fact-2-phenylalanine-is-a-standard-amino-acid-you-consume-all-the-time">Fact 2: Phenylalanine is a standard amino acid you consume all the time.</h3>

<p>We recently talked about <a href="https://dynomight.net/diet-coke-nootropic/">phenylalanine</a>. It is an essential amino acid. If you didn’t consume any of it then when your body tried to make certain proteins those proteins would get truncated, and then they wouldn’t do what they are supposed to do, and then you would die.</p>

<p>Fortunately, that’s almost impossible. From 2% to 5% of all protein in food is phenylalanine. The recommended dietary allowance for a 70 kg (154 lb) person is at least 2130 mg. Meat-eating men in the UK average 3500 mg per day, while vegetarians and vegans get slightly less.</p>

<p>Here are the amounts of phenylalanine in a few foods:</p>

<table>
  <tbody>
    <tr>
      <td>potato</td>
      <td>170 mg</td>
    </tr>
    <tr>
      <td>large egg</td>
      <td>340 mg</td>
    </tr>
    <tr>
      <td>8 oz (235 ml) glass of milk</td>
      <td>430 mg</td>
    </tr>
    <tr>
      <td>400g box of tofu</td>
      <td>3300 mg</td>
    </tr>
  </tbody>
</table>

<details>
  <summary>The 92 mg of phenylalanine you get from a Diet Coke is much less than what virtually everyone already gets from other sources.</summary>

  <p><a href="https://doi.org/10.1186/s13023-020-01391-y">MacDonald et al. (2020)</a>:</p>

  <p><img src="https://dynomight.net/img/aspartame/macdonald.svg" alt="macdonald"></p>

  <p>RDA guidelines are <a href="https://globalrph.com/rda-and-ear-recommendations-for-essential-amino-acids/">here</a>. For adults, the recommendation is at least 33 m/kg of phenylalanine (or tyrosine, a metabolite of phenylalanine). For a 70 kg (154 lb) person, that would be 2130 mg.</p>

  <p><a href="https://doi.org/10.1038/ejcn.2015.144">Schmidt et al. (2015)</a>:</p>

  <p><img src="https://dynomight.net/img/aspartame/schmidt.svg" alt="schmidt"></p>

</details>

<p>Around 1 in 12,000 babies is born with <a href="https://www.nichd.nih.gov/health/topics/factsheets/pku">phenylketonuria</a>, a serious genetic disorder that results in low levels of <a href="https://en.wikipedia.org/wiki/Phenylalanine_hydroxylase">phenylalanine hydroxylase</a>, making it difficult to metabolize phenylalanine. People with phenylketonuria need to carefully monitor their consumption of phenylalanine (from all sources). This is why there’s this scary <strong>ALL-BOLD WARNING</strong>.</p>

<!-- ![phenylketonurics warning](/img/aspartame/phenylketonurics.jpg) -->

<p><img alt="phenylketonurics warning" src="https://dynomight.net/img/aspartame/phenylketonurics.jpg"></p>

<p>If you had phenylketonuria you would know it already.</p>

<h3 id="fact-3-aspartic-acid-is-a-standard-amino-acid-you-consume-all-the-time">Fact 3: Aspartic acid is a standard amino acid you consume all the time.</h3>

<p>Here’s <a href="https://commons.wikimedia.org/wiki/File:ProteinogenicAminoAcids.svg">a chart from Wikimedia</a> with our friends circled:</p>

<!-- ![amino-acids](/img/aspartame/amino-acids.png) -->

<p><img alt="amino acids" src="https://dynomight.net/img/aspartame/amino-acids.png"></p>

<p>Aspartic acid is not essential in humans, meaning that if you don’t eat it, your body can make it (usually from <a href="https://en.wikipedia.org/wiki/Oxaloacetic_acid">oxaloacetic acid</a>). But that’s not likely, since almost everything with protein has aspartic acid including meat, grains, dairy, vegetables, and eggs. Men in the UK average 6600 mg of aspartic acid per day.</p>

<details>
  <summary>The 74 mg of aspartic acid you get from a Diet Coke is two orders of magnitude less than what most people get already.</summary>

  <p>Here’s <a href="https://doi.org/10.1038/ejcn.2015.144">Schmidt et al. (2015)</a> again:</p>

  <p><img src="https://dynomight.net/img/aspartame/schmidt.svg" alt="schmidt"></p>

</details>

<h3 id="fact-4-methanol-is-a-simple-alcohol-you-consume-all-the-time">Fact 4: Methanol is a simple alcohol you consume all the time.</h3>

<p>Methanol (CH₃OH) is the simplest alcohol molecule. It’s in lots of food. Here are some foods with larger average amounts.</p>

<table>
  <thead>
    <tr>
      <th>food</th>
      <th>mg/kg methanol</th>
      <th>typical serving</th>
      <th>methanol</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>wine</td>
      <td>115.0</td>
      <td>150 ml glass</td>
      <td>17 mg</td>
    </tr>
    <tr>
      <td>tomatoes</td>
      <td>281.4</td>
      <td>medium 125g tomato</td>
      <td>35 mg</td>
    </tr>
    <tr>
      <td>citrus fruit</td>
      <td>106.5</td>
      <td>medium 140g orange</td>
      <td>15 mg</td>
    </tr>
  </tbody>
</table>

<p>This vastly underestimates how much methanol you get. In land plants, the primary component of cells walls is <a href="https://en.wikipedia.org/wiki/Pectin">pectin</a>. Once in the body, pectin degrades into methanol. Here are some estimates of the <em>indirect</em> increase in methanol various fruits and vegetables cause in this way.</p>

<table>
  <thead>
    <tr>
      <th>food</th>
      <th>mg/kg methanol</th>
      <th>typical serving</th>
      <th>methanol</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>root vegetables</td>
      <td>774</td>
      <td>medium 200 g potato</td>
      <td>155 mg</td>
    </tr>
    <tr>
      <td>apples</td>
      <td>508.5</td>
      <td>medium 170 g apple</td>
      <td>132 mg</td>
    </tr>
    <tr>
      <td>oranges</td>
      <td>531</td>
      <td>medium 140g orange</td>
      <td>74 mg</td>
    </tr>
    <tr>
      <td>bananas</td>
      <td>657</td>
      <td>120g without skin</td>
      <td>79 mg</td>
    </tr>
    <tr>
      <td>avocados</td>
      <td>486</td>
      <td>100g (flesh only)</td>
      <td>59 mg</td>
    </tr>
  </tbody>
</table>

<p>You get the idea. We eat things that contain methanol or metabolize into methanol all the time. It’s estimated that most people get between 130 and 1030 mg of methanol from food per day, much more than the 18 mg in a Diet Coke.</p>

<p>Now isn’t methanol toxic? Sure, if you consume enough of it. The <a href="https://en.wikipedia.org/wiki/Median_lethal_dose">LD₅₀</a> in rats is around 5600 mg/kg, as compared to 7300 mg/kg for <a href="https://dynomight.net/alcohol-trial/">good-old ethanol</a>.</p>

<details>
  <summary>One "conspiracy theory" you hear about aspartame is that it becomes formaldehyde once it's in the body. This is <em>absolutely true</em>: When metabolizing methanol, formaldehyde is created. But small amounts of formaldehyde are <em>completely normal</em>. The half-life of formaldehyde in human blood is around 1 minute, meaning it disappears almost immediately. You get more formaldehyde (via methanol) by eating an apple than by drinking a Diet Coke. Formaldehyde itself is also present in lots of foods, like meat, seafood, fruits, vegetables, and coffee.</summary>

  <p>The EFSA report:</p>

  <p><img src="https://dynomight.net/img/aspartame/EFSA-methanol.svg" alt="ESFA methanol"></p>

  <p>Also the ESFA report:</p>

  <p><img src="https://dynomight.net/img/aspartame/EFSA-methanol-2.svg" alt="ESFA methanol"></p>

  <p><a href="https://doi.org/10.1002/jps.21319">Dhareshwar and Stella (2008)</a></p>

  <p><img src="https://dynomight.net/img/aspartame/dhareshwar-1.svg" alt="dhareshwar 1"></p>

  <p>Also <a href="https://doi.org/10.1002/jps.21319">Dhareshwar and Stella (2008)</a>:</p>

  <p><img src="https://dynomight.net/img/aspartame/dhareshwar-2.svg" alt="dhareshwar 1"></p>

  <p>The EFSA report again:</p>

  <p><img src="https://dynomight.net/img/aspartame/EFSA-formaldehyde.svg" alt="ESFA formaldehyde"></p>

</details>

<h3 id="fact-5-this-doesnt-prove-aspartame-is-safe">Fact 5: This doesn’t prove aspartame is safe.</h3>

<p>To summarize the above:</p>

<ol>
  <li>Aspartame is quickly broken down in the gut into phenylalanine, aspartic acid, and methanol. Aspartame itself never enters your bloodstream or touches any other part of your body.</li>
  <li>Phenylalanine is normal.</li>
  <li>Aspartic acid is normal.</li>
  <li>Methanol is normal.</li>
</ol>

<p>(Incidentally, this same logic does not apply to other artificial sweeteners which mostly aren’t broken down at all.)</p>

<p>While <em>informative</em>, this does not <em>prove</em> aspartame is safe. Biology is crazy. But it should inform our priors. Speaking for myself, my previous model was that consuming aspartame would result in a crazy unknown synthetic chemical circulating around my body and doing god-knows-what. My updated model is that consuming aspartame results in slightly larger amounts of some totally normal chemicals.</p>

<p>This is reassuring. But even if they’re normal, could these chemicals still cause harm? Sure. Fortunately for us, aspartame was invented a long time ago, so we have lots of evidence.</p>

<h2 id="the-scientific-consensus">The scientific consensus</h2>

<h3 id="how-to-think-about-this-situation">How to think about this situation</h3>

<p>Aspartame was first made in 1965 and was approved by the FDA in 1981. In the decades since, there have been hundreds of studies.</p>

<p>Given so many studies, focusing on individual papers is a mistake. With enough <strike>monkeys pounding away at enough typewriters</strike> scientists pounding away at enough science, lots of weirdness is expected.</p>

<p>The right strategy is to look at the entire pool of evidence. Some tiny number of people have the time and expertise to comb through the entire literature and synthesize everything. For the rest of us, the only sane thing is to read other people who have done that synthesis.</p>

<h3 id="the-us-food-and-drug-administration-fda">The US Food and Drug Administration (FDA)</h3>

<p>In typical US government fashion, the FDA doesn’t go to great lengths to explain its reasoning to the public. The best you can find is this <a href="https://www.fda.gov/food/food-additives-petitions/additional-information-about-high-intensity-sweeteners-permitted-use-food-united-states">rather lame page</a>:</p>

<p><img src="https://dynomight.net/img/aspartame/FDA.svg" alt="FDA info"></p>

<p>The history of aspartame and the FDA is contentious and sort of infuriating. For the scientific question of “is aspartame safe?” the main thing to know is that the FDA approved it a long time ago, and continues to stand by those decisions.</p>

<details>
  <summary>
But it must be said that the history and public communication of the FDA on this issue is kind of a train wreck, and if I wanted to optimize it to serve as conspiracy theory fuel, I could scarcely do any better. The FDA says it continues to monitor new studies and remains confident aspartame is safe. So why doesn't it explain its reasoning to a skeptical public? The newest document the FDA can point people to is from 26 years ago. When a concerned citizen writes in, the FDA does things like respond 12 years later, while acting like that's perfectly normal.
</summary>

  <p>The FDA first approved aspartame for dry foods in 1974. However, there was a lot of controversy about the studies performed by <a href="https://en.wikipedia.org/wiki/G.D._Searle,_LLC">G.D. Searle</a>, the company that discovered aspartame in 1965 (and that Donald Rumsfeld would become CEO of in 1977). The FDA commissioner agreed with these criticisms and placed a stay on aspartame’s approval.</p>

  <p>After more debate, the FDA finally approved aspartame in 1981 in a <a href="https://www.fda.gov/media/89219/download">26-page report</a> with this summary:</p>

  <p><img src="https://dynomight.net/img/aspartame/FDA-1981.svg" alt="FDA 1981 report"></p>

  <p>In 1983 the FDA added approval for carbonated beverages. <a href="https://www.fda.gov/media/89189/download">The report</a> is mostly boring but this part is fun:</p>

  <p><img src="https://dynomight.net/img/aspartame/FDA-1983.svg" alt="FDA 1983 report"></p>

  <p>There was controversy about US Attorney General <a href="https://en.wikipedia.org/wiki/Samuel_K._Skinner">Samuel Skinner</a> who was involved in the case and then went on to take a job at a law firm that Searle used. This led <a href="https://en.wikipedia.org/wiki/Howard_Metzenbaum">Senator Metzenbaum</a> to request an investigation by the Government Accountability Office (GAO). They reported in 1987 that the process had been followed correctly. They also got responses from 69 researchers, 43 of whom worked in aspartame research.</p>

  <p><img src="https://dynomight.net/img/aspartame/image-20220614162208248.png" alt="image-20220614162208248"></p>

  <p>Finally in 1996, the FDA <a href="http://www.gpo.gov/fdsys/pkg/FR-1996-06-28/pdf/96-16522.pdf">approved</a> aspartame as a “general sweetener”.</p>

  <p><img src="https://dynomight.net/img/aspartame/FDA-1996.svg" alt="FDA 1996 report"></p>

  <p>Also in 1996, Roger Walton, a psychiatrist at Northeastern Ohio Universities College of Medicine, wrote a <a href="https://www.lightenyourtoxicload.com/wp-content/uploads/2014/07/Dr-Walton-survey-of-aspartame-studies.pdf">survey</a> that claimed that 74 out of 74 industry-funded studies confirmed aspartame’s safety whereas 84 out of 91 independent studies identified health concerns. Walton went appeared in a <a href="https://www.youtube.com/watch?v=BK_u7DG9DY8"><em>60 Minutes</em> special</a> on aspartame. It later turned out that Walton had missed at least 50 peer-reviewed studies  and most of the independent “studies” he did cite were really just letters to the editor or similar, many weren’t negative, and some didn’t involve aspartame at all.</p>

  <p>For example, Walton cites <a href="https://doi.org/10.1016/S0140-6736(85)90920-1">Wurtman (1985)</a>. This appeared in the Lancet, which is a very good journal. But it’s just a 5-paragraph letter to the editor that points out that aspartame creates phenylalanine without other amino acids, which might do something in the brain—an idea we’ve <a href="https://dynomight.net/diet-coke-nootropic">looked at recently</a>—and gives some anecdotes about people getting seizures. Real studies do not confirm these anecdotes. <a href="https://doi.org/10.1093/ajcn/68.3.531">Wurtman himself</a> did a real study in 1998 that found “Large daily doses of aspartame had no effect on neuropsychologic, neurophysiologic, or behavioral functioning in healthy young adults”. But the Walton report remains discussed to this day. Just a few months ago, Walton published a book called “Double Blind”. I’ll let you judge the credibility for yourself:</p>

  <p><img src="https://dynomight.net/img/aspartame/double-blind.png" alt="Double Blind"></p>

  <p>Since 1996, the FDA doesn’t appear to have published any systematic argument that the current science supports the idea that aspartame is safe. If you look <em>really</em> hard, you can find a few places where the FDA has recently been forced to justify the idea that aspartame is safe. For example, a concerned citizen wrote to the FDA in 2002 and sent this <a href="https://www.regulations.gov/document/FDA-2002-P-0247-0023">response</a> in 2014:</p>

  <p><img src="https://dynomight.net/img/aspartame/FDA-2014-response.svg" alt="FDA 2014 response"></p>

  

</details>



<p>Fortunately, other countries exist. The EFSA has a nice <a href="https://www.efsa.europa.eu/en/topics/topic/aspartame">page</a> that summarizes things this way:</p>

<p><img src="https://dynomight.net/img/aspartame/EFSA-webpage.svg" alt="EFSA webpage"></p>

<p>The bottom of the page has a timeline that clearly presents all past activities, and clearly links to all ongoing studies and reports. (The fact that I’m impressed by such basic things drives home just how low the FDA sets the bar.)</p>

<p>There’s also an <em>extremely</em> nice-263 page <a href="https://www.efsa.europa.eu/en/press/news/131210">risk assessment</a>. This document is the single best (most clear, credible, thorough, and up-to-date) source of information I could find on the safety of aspartame. Here are some quotes from the summary:</p>

<blockquote>
  <p>there was no epidemiological evidence for possible associations of aspartame with various cancers in the human population.</p>
</blockquote>

<blockquote>
  <p>The Panel considered the database on the genotoxicity of methanol and concluded that the data set was limited but that the available reliable <em>in vitro</em> and <em>in vivo</em> data did not indicate a genotoxic potential for methanol.</p>
</blockquote>

<blockquote>
  <p>the calculated [No Observed Adverse Effect Level]s for methanol by oral exposure are 140 and 515-fold higher than the maximum amount of methanol that could be released when aspartame is consumed at the [Acceptable Daily Intake].</p>
</blockquote>

<blockquote>
  <p>the data on reproductive and developmental toxicity did not suggest that there was a risk from methanol derived from aspartame at the current exposure estimates or at the [Acceptable Daily Intake] of 40 mg/kg bw/day.</p>
</blockquote>

<blockquote>
  <p>based on recent measurements of basal levels of formaldehyde in blood and on the modelling of its biological turnover and steady state concentration in cells, formaldehyde formed from aspartame-derived methanol was not of safety concern at the current exposure estimates or at the ADI of 40 mg/kg bw/day.</p>
</blockquote>

<p>It ends this way:</p>

<p><img src="https://dynomight.net/img/aspartame/EFSA-report.svg" alt="EFSA report"></p>

<h3 id="health-canada">Health Canada</h3>

<p>Canada is one of the <a href="https://www.canada.ca/en/health-canada/services/food-nutrition/food-safety/food-additives/sugar-substitutes/aspartame-artificial-sweeteners.html">clearer communicators</a>:</p>

<p><img src="https://dynomight.net/img/aspartame/canada.svg" alt="canada"></p>

<p>Here are their conclusions in a handy table:</p>

<table>
  <thead>
    <tr>
      <th>Allegation</th>
      <th>Conclusion</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>The methanol in aspartame is toxic and is linked to numerous health  problems including lupus and blindness, and also mimics multiple  sclerosis</td>
      <td>Not supported</td>
    </tr>
    <tr>
      <td>Aspartame is especially dangerous for person with diabetes</td>
      <td>Not supported</td>
    </tr>
    <tr>
      <td>Aspartame causes cancer and brain tumours</td>
      <td>Not supported</td>
    </tr>
    <tr>
      <td>Aspartame causes seizures</td>
      <td>Not supported</td>
    </tr>
    <tr>
      <td>Aspartame causes allergic reactions</td>
      <td>Not supported</td>
    </tr>
  </tbody>
</table>

<h3 id="new-zealand-food-safety-authority">New Zealand Food Safety Authority</h3>

<p>From an <a href="https://web.archive.org/web/20081216093929/http://www.nzfsa.govt.nz/consumers/chemicals-nutrients-additives-and-toxins/aspartame/">archived page</a>:</p>

<p><img src="https://dynomight.net/img/aspartame/nz.svg" alt="new zealand"></p>

<h3 id="joint-expert-committee-on-food-additives-jecfa">Joint Expert Committee on Food Additives (JECFA)</h3>

<p>The UN and WHO “jointly” run the JECFA. The only public reports I can find from them are really old, like <a href="https://inchem.org/documents/jecfa/jecmono/v15je03.htm">1980</a>. For what it’s worth, this was the conclusion:</p>

<p><img src="https://dynomight.net/img/aspartame/JECFA.svg" alt="JECFA"></p>

<p>As far as I can tell, this <a href="https://inchem.org/documents/jecfa/jecmono/v16je01.htm">1981</a> update is the last word on aspartame from the JECFA. However, the JECFA currently has aspartame on the <a href="https://www.fao.org/fao-who-codexalimentarius/sh-proxy/fr/?lnk=1&amp;url=https%253A%252F%252Fworkspace.fao.org%252Fsites%252Fcodex%252FCircular%252520Letters%252FCL%2525202021-81%252Fcl21_81e.pdf">priority list of substances proposed for evaluation</a>, as requested by Columbia, Costa Rica, and—somehow—the United States of America. (<em>Update</em>: This report is due to finally come out July 14, 2023. I’ll write about it when it does.)</p>

<h3 id="the-academy-of-nutrition-and-dietetics">The Academy of Nutrition and Dietetics</h3>

<p>This is a <a href="https://en.wikipedia.org/wiki/Academy_of_Nutrition_and_Dietetics">seemingly respectable</a> organization of more than 100 thousand food and nutrition professionals, albeit one funded by food industry lobbying groups. Their <a href="https://doi.org/10.1016/j.jand.2012.03.009">position report</a> states:</p>

<p><img src="https://dynomight.net/img/aspartame/academy.svg" alt="academy"></p>

<h2 id="literature-reviews">Literature reviews</h2>

<p>Again, I don’t think it’s productive to look at individual papers. But we can look at <em>reviews</em> of all the evidence.</p>

<p>Here, some judgment is required. If I type “review aspartame safety” into Google scholar, many of the papers that come up have several of the following features:</p>

<ol>
  <li>Paper is published in an obscure journal</li>
  <li>Authors are from obscure institutions</li>
  <li>Paper only engages with a tiny slice of the literature</li>
  <li>Paper just “doesn’t look right” (e.g. has a serious grammatical error in the title)</li>
</ol>

<p>For full transparency, here are the papers I found less credible for the above reasons, given as hopefully-offense-minimizing numbers: <a href="https://doi.org/10.1007/s10616-013-9681-0">1</a> <a href="https://doi.org/10.3923/pjbs.2018.127.134">2</a> <a href="https://doi.org/10.4103%2F0976-500X.85936">3</a> <a href="https://doi.org/10.1080/1028415X.2017.1288340">4</a> <a href="https://pubmed.ncbi.nlm.nih.gov/29038387/">5</a> <a href="https://www.researchgate.net/profile/Ab-Naik/publication/360642412_Aspartame_Effects_and_Awareness/links/62949ea76886635d5cae8511/Aspartame-Effects-and-Awareness.pdf">6</a> <a href="https://doi.org/10.3390/nu13061957">7</a> <a href="https://doi.org/10.1093/nutrit/nux035">8</a>. Note that many of these <em>do</em> suggest health concerns with aspartame, but I am discounting their conclusions because I don’t think they are credible. If <em>you</em> don’t trust <em>me</em>, you should look at those papers yourself. I have linked (here or below) everything I found that was published after the year 2000 and claimed to be a review of aspartame.</p>

<p><strong>Butchko et al. <a href="https://doi.org/10.1006/rtph.2002.1542"><em>Aspartame: Review of Safety</em></a>. Regulatory Toxicology and Pharmacology, 2002.</strong></p>

<p>Our first is a 93-page monster from a team of 24 scientists (three of whom, note, are employed by The NutraSweet Company). As I write this, it’s been cited 344 times. In their summary, you can feel the frustration:</p>

<p><img src="https://dynomight.net/img/aspartame/butchko-1.svg" alt="butchko 1"></p>

<p>Here’s a table from this paper:</p>

<p><img src="https://dynomight.net/img/aspartame/butchko-2.svg" alt="butchko 2"></p>

<p>This is helpful to put things in perspective. If you drink a Diet Coke, you get 2.6 mg/kg of aspartame, assuming you weight 70 kg. That’s around 20 times less than the government recommended limits. It’s also around <em>1000 times</em> less than doses that do not show harms in animals.</p>

<p><strong>Magnuson et al. <a href="https://doi.org/10.1080/10408440701516184"><em>Aspartame: A Safety Evaluation Based on Current Use Levels, Regulations, and Toxicological and Epidemiological Studies</em></a>. Critical Reviews in Toxicology, 2007.</strong></p>

<p>This is a 99-page paper that’s been cited 430 times so far. The conclusions are kind of feisty.</p>

<p><img src="https://dynomight.net/img/aspartame/magnuson.svg" alt="magnuson"></p>

<details>
  <summary>Note that this study was funded by Ajinomoto via some kind of blind-trust arrangement.</summary>

  <p>The paper describes it this way:</p>

  <p><img src="https://dynomight.net/img/aspartame/magnuson-sponsor.svg" alt="magnuson sponsor"></p>

  <p>I still mostly trust this paper, but <a href="https://dynomight.net/alcohol-trial/">we all know how these things can go</a>.</p>

</details>

<p><strong>Rogers et al. <a href="https://doi.org/10.1038/ijo.2015.177"><em>Does low-energy  sweetener consumption affect energy intake and body weight? A systematic review, including meta-analyses, of the evidence from human and animal studies</em></a>. International Journal of Obesity, 2016.</strong></p>

<p>This paper has 320 citations and 11 authors (four of whom—sigh—have gotten grants from or worked at sweetener companies). It focuses on metabolism and weight. Here is their conclusion, where LES = Low-Energy Sweeteners, EI = Energy Intake, and BW = Body Weight.</p>

<p><img src="https://dynomight.net/img/aspartame/rogers-1.svg" alt="rogers 1"></p>

<p><img src="https://dynomight.net/img/aspartame/rogers-2.svg" alt="rogers 2"></p>

<h3 id="other-reviews">Other reviews</h3>

<p>There are many other reviews that seem scientifically solid, but aren’t as comprehensive as those above. Here’s a representative snippet from each:</p>

<table>
  <thead>
    <tr>
      <th>paper</th>
      <th>snippet</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="https://doi.org/10.1111/j.1541-4337.2006.tb00081.x">Kroger et al. (2006)</a></td>
      <td>“within the range of variation caused by day-to-day differences in food intake and are clearly not harmful”</td>
    </tr>
    <tr>
      <td><a href="https://doi.org/10.1016/j.fct.2013.07.040">Marinovich et al. (2009)</a></td>
      <td>“not consistently related to vascular events and preterm deliveries.”</td>
    </tr>
    <tr>
      <td><a href="https://doi.org/10.1080/19338244.2013.828674">Mallikarjun and Sieburth (2013)</a></td>
      <td>“suggest that [aspartame] consumption has no significant carcinogenic effect in rodents.”</td>
    </tr>
    <tr>
      <td><a href="https://doi.org/10.1080/10408398.2017.1304358">Santos et al. (2018)</a></td>
      <td>“no found deleterious effects associated with aspartame consumption on variables studied”</td>
    </tr>
    <tr>
      <td><a href="https://doi.org/10.1016/j.yrtph.2018.01.009">Haighton et al. (2018)</a></td>
      <td>“a conclusion that aspartame is not carcinogenic is supported”</td>
    </tr>
    <tr>
      <td><a href="https://doi.org/10.1016/j.yrtph.2019.01.033">Haighton et al. (2019)</a></td>
      <td>“do not support that [low calories sweeteners and] aspartame, are associated with an increased risk of cancer in humans.”</td>
    </tr>
    <tr>
      <td><a href="https://doi.org/10.1001/jamanetworkopen.2022.2092">McGlynn et al. (2022)</a></td>
      <td>“small improvements in body weight and cardiometabolic risk factors without evidence of harm”</td>
    </tr>
  </tbody>
</table>

<h2 id="why-write-this">Why write this?</h2>

<p>I write all this with some trepidation, as my <a href="https://dynomight.net/cola/#ps">previous</a> <a href="https://dynomight.net/thanks/">mentions</a> of aspartame caused a surprising amount of rancor.</p>

<p>But whatever, I’ll die on this hill: After aspartame is consumed, it immediately breaks down into three naturally occurring chemicals. Even large amounts of aspartame cause smaller fluctuations in those chemicals than normal food. The current science says that the health impact of aspartame is essentially zero. Every credible body that has studied this question has reached the same conclusion.</p>

<p>Is it possible that some harms have been missed? Of course! That’s how science works: Evidence accumulates slowly. It never becomes a <em>sure thing</em>, we just eventually decide it’s sure <em>enough</em> and move on with our lives.</p>

<p>So why are we still talking about aspartame? Why worry about it rather than, say, <em>sugar</em> or <em>alcohol</em>? I know many people who avoid diet soda but drink sugar-sweetened soda or large amounts of alcohol. That’s choosing a known harm over something that appears harmless.</p>

<p>Or, why not worry about:</p>

<ul>
  <li><a href="https://www.weather.gov/safety/lightning-odds">Lightning</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Cotton_swab#Medical_risks">Q-tips</a></li>
  <li><a href="https://dynomight.net/air/#things-that-create-particles-indoors">Fireplaces</a></li>
  <li><a href="https://doi.org/10.1097/PAF.0b013e31828d68c7">Bathtubs</a></li>
  <li><a href="https://www.cdc.gov/pictureofamerica/pdfs/Picture_of_America_Poisoning.pdf">Generators</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Lawn_mower#Safety_issues">Lawn mowers</a></li>
  <li><a href="https://www.bbc.com/news/world-us-canada-48360832">Umbrellas</a></li>
  <li><a href="https://wwwnc.cdc.gov/travel/yellowbook/2020/travel-by-air-land-sea/cruise-ship-travel">Cruise ships</a></li>
  <li><a href="https://dynomight.net/air/#particles-while-commuting">Air in subways</a></li>
  <li><a href="https://doi.org/10.1371/journal.pmed.0040290">Blood clots in planes</a></li>
  <li><a href="https://www.cdc.gov/nceh/radiation/air_travel.html">Cosmic rays in planes</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Heterocyclic_amine_formation_in_meat">Charred meat</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Anticholinergic#Side_effects">Anticholinergics</a></li>
  <li><a href="https://doi.org/10.1093/fqsafe/fyy025">Cocoa</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Perfluorooctanoic_acid#Health_concerns">Perfluorooctanoic acid</a></li>
  <li><a href="https://doi.org/10.1128/CMR.00011-10">Helicobacter pylori</a></li>
</ul>

<p>All of these present some real danger but mostly no one cares.</p>

<p>To me, most skepticism of aspartame looks like an <a href="https://slatestarcodex.com/2014/08/14/beware-isolated-demands-for-rigor/">isolated demand for rigor</a>—an impossibly high standard of evidence that isn’t applied to other things. We all have finite bandwidth for things to worry about, and the evidence places aspartame very low on the list of sensible worries.</p>

<p>Many of the same people who claim aspartame is risky exhort to Follow the Science in other domains. I wonder: What evidence would be convincing proof of aspartame’s safety, but doesn’t already exist? Is it even possible? If not, then OK! But if you only follow the science when the conclusions are intuitive, it’s not science that chooses your destination.</p>

  


  

  

  
  
  
  

</section></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Stanford A.I. Courses (274 pts)]]></title>
            <link>https://ai.stanford.edu/courses/</link>
            <guid>36562502</guid>
            <pubDate>Sun, 02 Jul 2023 15:40:53 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://ai.stanford.edu/courses/">https://ai.stanford.edu/courses/</a>, See on <a href="https://news.ycombinator.com/item?id=36562502">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
							
							<p><label>Sort by: </label>
							</p>
							
						</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Parsing time stamps faster with SIMD instructions (158 pts)]]></title>
            <link>https://lemire.me/blog/2023/07/01/parsing-time-stamps-faster-with-simd-instructions/</link>
            <guid>36561974</guid>
            <pubDate>Sun, 02 Jul 2023 14:50:46 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://lemire.me/blog/2023/07/01/parsing-time-stamps-faster-with-simd-instructions/">https://lemire.me/blog/2023/07/01/parsing-time-stamps-faster-with-simd-instructions/</a>, See on <a href="https://news.ycombinator.com/item?id=36561974">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
<p>In software, it is common to represent time as a time-stamp string. It is usually specified by a time format string. <a href="https://datatracker.ietf.org/doc/html/rfc4034#section-3.2">Some standards</a> use the format <tt>%Y%m%d%H%M%S</tt> meaning that we print the year, the month, the day, the hours, the minutes and the seconds. The current time as I write this blog post would be <tt>20230701205436</tt> as a time stamp in this format. It is convenient because it is short, easy to read and if you sort the strings lexicographically, you also sort them chronologically.</p>
<p>You can generate time stamps using any programming language. In C, the following program will print the current time (universal, not local time):</p>
<pre><span>#</span><span>include </span><span>&lt;</span><span>time.h</span><span>&gt;</span>
<span>#</span><span>include </span><span>&lt;</span><span>stdio.h</span><span>&gt;</span>
<span>int</span> <span>main</span><span>(</span><span>)</span> <span>{</span>
<span>  char</span> buffer<span>[</span><span>15</span><span>]</span><span>;</span>
<span>  struct</span> <span>tm</span> timeinfo<span>;</span>
<span>  time_t</span> rawtime<span>;</span>
<span>  time</span><span>(</span><span>&amp;</span>rawtime<span>)</span><span>;</span>
  gmtime_r<span>(</span><span>&amp;</span>rawtime<span>,</span> <span>&amp;</span>timeinfo<span>)</span><span>;</span>
<span>  size_t</span> len <span>=</span> <span>strftime</span><span>(</span>buffer<span>,</span> <span>15</span><span>,</span> <span>"</span><span>%Y%m</span><span>%d</span><span>%H%M</span><span>%S</span><span>"</span><span>,</span> <span>&amp;</span>timeinfo<span>)</span><span>;</span>
  buffer<span>[</span><span>14</span><span>]</span> <span>=</span> <span>'\0'</span><span>;</span>
<span>  puts</span><span>(</span>buffer<span>)</span><span>;</span>
<span>}</span>
</pre>
<p>We are interested in the problem of parsing these strings. In practice, this means that we want to convert them to an integer presenting the number of seconds since the Unix epoch. The Unix epoch is January 1st 1970. For my purposes, I will consider the time to be an unsigned 32-bit integer so we can represent time between 1970 and 2106. It is not difficult to switch over to a 64-bit integer or to signed integers.</p>
<p>The way you typically solve this problem is to use something like the C function <tt>strptime</tt>. Can we do better?</p>
<p>Modern processors have fast instructions that operate on several words at once, called SIMD instructions. We have a block of 14 characters. Let us assume that we can read 16 characters safely, ignoring the content of the leftover characters.</p>
<p>We load the block of digits in a SIMD register. We subtract 0x30 (the code point value of the character ‘0’), and all bytes values should be between 0 and 9, inclusively. We know that some character must be smaller than 9, for example, we cannot have more than 59 seconds and never 60 seconds, in the time stamp string. So one character must be between 0 and 5. Similarly, we start the hours at 00 and end at 23, so one character must be between 0 and 2. We do a saturating subtraction of the maximum: the result of such a subtraction should be zero if the value is no larger. We then use a special instruction to multiply one byte by 10, and sum it up with the next byte, getting a 16-bit value. We then repeat the same approach as before, checking that the result is not too large.</p>
<p>The code might look as follow using Intel intrinsic functions:</p>
<pre> __m128i v <span>=</span> _mm_loadu_si128<span>(</span><span>(</span><span>const</span> __m128i <span>*</span><span>)</span>date_string<span>)</span><span>;</span>
v <span>=</span> _mm_sub_epi8<span>(</span>v<span>,</span> _mm_set1_epi8<span>(</span><span>0x30</span><span>)</span><span>)</span><span>;</span>
__m128i limit <span>=</span>
_mm_setr_epi8<span>(</span><span>9</span><span>,</span> <span>9</span><span>,</span> <span>9</span><span>,</span> <span>9</span><span>,</span> <span>1</span><span>,</span> <span>9</span><span>,</span> <span>3</span><span>,</span> <span>9</span><span>,</span> <span>2</span><span>,</span> <span>9</span><span>,</span> <span>5</span><span>,</span> <span>9</span><span>,</span> <span>5</span><span>,</span> <span>9</span><span>,</span> <span>-</span><span>1</span><span>,</span> <span>-</span><span>1</span><span>)</span><span>;</span>
__m128i abide_by_limits <span>=</span> _mm_subs_epu8<span>(</span>v<span>,</span> limit<span>)</span><span>;</span> <span>// must be all zero</span>
<span>const</span> __m128i weights <span>=</span> _mm_setr_epi8<span>(</span>
<span>10</span><span>,</span> <span>1</span><span>,</span> <span>10</span><span>,</span> <span>1</span><span>,</span> <span>10</span><span>,</span> <span>1</span><span>,</span> <span>10</span><span>,</span> <span>1</span><span>,</span> <span>10</span><span>,</span> <span>1</span><span>,</span> <span>10</span><span>,</span> <span>1</span><span>,</span> <span>10</span><span>,</span> <span>1</span><span>,</span> <span>0</span><span>,</span> <span>0</span><span>)</span><span>;</span>
v <span>=</span> _mm_maddubs_epi16<span>(</span>v<span>,</span> weights<span>)</span><span>;</span>
__m128i limit16 <span>=</span>
_mm_setr_epi16<span>(</span><span>99</span><span>,</span><span>99</span><span>,</span> <span>12</span><span>,</span> <span>31</span><span>,</span> <span>23</span><span>,</span> <span>59</span><span>,</span> <span>59</span><span>,</span> <span>-</span><span>1</span><span>)</span><span>;</span>
__m128i abide_by_limits16 <span>=</span> _mm_subs_epu16<span>(</span>v<span>,</span> limit16<span>)</span><span>;</span>
__m128i limits <span>=</span> _mm_or_si128<span>(</span>abide_by_limits16<span>,</span>abide_by_limits<span>)</span><span>;</span>
<span>if</span> <span>(</span><span>!</span>_mm_test_all_zeros<span>(</span>limits<span>,</span> limits<span>)</span><span>)</span> <span>{</span>
<span>  return</span> false<span>;</span>
<span>}</span>

</pre>
<p>It does not get all the parsing done, but at this point, you have the months, days, hours, minutes and seconds as valid binary integer values. The year is parsed in two components (the first two digits, and the next two digits).</p>
<p>We can just use standard C code for the result.</p>
<p>Is it fast? I wrote a benchmark that I compile using GCC 12 on an Intel Ice Lake Linux server.</p>
<table>
<tbody>
<tr>
<th></th>
<th>instructions per stamp</th>
<th>time per stamp</th>
</tr>
<tr>
<td>standard C with <tt>strptime</tt></td>
<td>700</td>
<td>46</td>
</tr>
<tr>
<td>SIMD approach</td>
<td>65</td>
<td>7.9</td>
</tr>
</tbody>
</table>
<p>We use about 10 times fewer instructions, and we go 6 times faster. That is not bad, but I suspect it is not nearly optimal.</p>
<p><a href="https://github.com/lemire/Code-used-on-Daniel-Lemire-s-blog/tree/master/2023/07/01">The source code is available</a>.</p>
<p><strong>Credit</strong>: Thanks to Jeroen Koekkoek from NLnetLabs for initial work and for proposing the problem, and to @aqrit for sketching the current code.</p>

</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Alt-F4 #65 – Factorio visualizer in Unreal Engine 5 (233 pts)]]></title>
            <link>https://alt-f4.blog/ALTF4-65/</link>
            <guid>36561847</guid>
            <pubDate>Sun, 02 Jul 2023 14:34:58 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://alt-f4.blog/ALTF4-65/">https://alt-f4.blog/ALTF4-65/</a>, See on <a href="https://news.ycombinator.com/item?id=36561847">Hacker News</a></p>
<div id="readability-page-1" class="page"><p>
Written by <em>Hurricane</em>,
edited by <em>Nanogamer7, stringweasel, Conor_, Therenas, MyNameIsTrez, Firerazer</em>
</p><div>

<p>Today we’ve got a very fun project to talk about: The FUE5 project, explained in this article by <em>Hurricane</em>. It’s Factorio, but <em>3D</em>! Dreams do come true sometimes. It’s not quite a game, but more of a stunning re-imagining of its visuals. There’s lots of technical details on how this was achieved, so let’s jump in.</p>
<h2 id="what-is-fue5">
<a href="#what-is-fue5">What is FUE5?</a>
</h2>
<p>FUE5 (short for <strong>F</strong>actorio in <strong>U</strong>nreal <strong>E</strong>ngine <strong>5</strong>) is an experimental project with a simple goal: to visualize the 2D world of Factorio in 3D space. It was created by 3D artist Hurricane and Factorio modder Nuke during a five month period, starting on January 10th 2023.
While many creative people in the Factorio modding community create awesome large-scale mods like Space Exploration, Bob’s mods or Angel’s, we decided to take a slightly different approach. To put it simply, this project is a 3D visualization environment which can import bases from the Factorio game and visually replicate their behavior. It contains no gameplay, however you can fly around and visit your base in 3D.</p>
<p>
<iframe src="https://www.youtube.com/embed/01qux-5Qx_Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
</p>


<div>
<figure>
<img src="https://media.alt-f4.blog/ALTF4/65/snap.jpg" alt="3D view of large scale factory with a variety of machines and structures.">
<figcaption>Example of a large-scale factory in the trailer. Don’t mind the missing power poles.</figcaption>
</figure>
</div>


<h2 id="how-was-it-done">
<a href="#how-was-it-done">How was it done?</a>
</h2>
<p>To even start thinking about a project such as this, it was necessary to model and animate each Factorio asset, be it assembling machine or inserter, from scratch based on the sprites from the game. We’ve used Cinema4D for 3D modelling and Adobe Photoshop for creating the textures. Once the model and textures are done, the entire structure is exported from Cinema4D to FBX format, which is then imported into Unreal Engine 5, where proper shaders are applied - such shaders are usually materials like glass, metal, or even smoke from a chimney.</p>


<div>
<figure>
<img src="https://media.alt-f4.blog/ALTF4/65/structures.jpg" alt="3 Way split depicting chemical plant. Left: Factorio Sprite. Middle: Wireframe remodel. Right: Textured remodel.">
<figcaption>The remodelling process was a lot of fun, but next time we should really ask for the original Factorio models to preserve what’s left of our sanity.</figcaption>
</figure>
</div>


<p>It was also necessary to replicate several key systems like belts, trains, and the logistic system. These were created via the native UE5 blueprint node system. We decided to create all the logic for these system after the 3D modelling was mostly finished, since it was necessary to have the correctly sized 3D models placed in 3D space for proper alignment of moving elements such as trains and items on belts. One major step which helped push the project forward was the ingenious idea to export Factorio bases from the game directly, and to then import them into the Unreal Engine environment. This solution saved a lot of time on base building, which would be tedious and wouldn’t look correct if done in Unreal Engine alone.</p>


<div>
<figure>
<img src="https://media.alt-f4.blog/ALTF4/65/nodes.jpg" alt="Node graph within Unity.">
<figcaption>When you don’t know how to code, you just put these nodes together, and if it doesn’t work you just keep adding more and more and become increasingly confused. Suspiciously similar to this factory game I’ve been playing recently.</figcaption>
</figure>
</div>


<h3 id="1-structure-system">
<a href="#1-structure-system">1. Structure System</a>
</h3>
<p>The first major component of FUE5 is the ability to spawn structures in an identical manner to how you’d find them in Factorio. By reading in-game data, we can get building types, their orientation and cable connections. This information is exported as a JSON file via a FUE5 exporter mod directly from inside the game. This file is then read by the FUE5 project, which is enough to visually replicate all structural and vehicular behavior of the actual base.</p>
<h3 id="2-transport-belt-system">
<a href="#2-transport-belt-system">2. Transport Belt System</a>
</h3>
<p>Apart from spawning the actual 3D models of individual transport belts, we had to figure out the item movement mechanic. This was achieved by representing transport belts as splines. When exporting a Factorio base via the FUE5 exporter, each continuous transport belt segment (a segment of transport belts which are connected and end in a tunnel, end on their own, or are looped) is treated as its own individual system. Once FUE5 reads this data, it constructs a spline for each of these individual systems. These splines then guide the items through the same path they follow in the actual game.</p>
<h3 id="3-train-system">
<a href="#3-train-system">3. Train System</a>
</h3>
<p>The train system is quite different to the transport belt system, since replicating train scheduling, signals and locomotive pathing would be very hard to do. Instead, we opted to use the native Factorio system for finding routes the trains should take. For a train to spawn and drive in FUE5, one has to set its destination and give it the green light prior to exporting the base. At this point we can read the train’s pre-calculated path and use it to construct a spline which then dictates the train’s movement in FUE5.</p>
<h3 id="4-logistic-system">
<a href="#4-logistic-system">4. Logistic System</a>
</h3>
<p>Right off the bat we skipped construction robots, since we’re currently spawning buildings via the native UE5 Construction Script system, and that’s the way it’s gonna stay for a while. What we focused on instead was getting logistic robots to work properly, since they’re the lifeline of any semi-advanced Factorio base and they add a lot of visual interest to the whole picture. Each roboport has a chance to randomly spawn a cluster of logistic robots, where each robot has its own simple brain to search for logistic chests in the vicinity and fly between them to visually replicate resource transportation. After this task of resource transportation is done, the robot will determine the location of the closest roboport and head to it to despawn.</p>
<h2 id="problems-and-optimization">
<a href="#problems-and-optimization">Problems and Optimization</a>
</h2>
<p>The first major issues became apparent once bigger bases were imported into FUE5 in the early days of the project. The FPS would drop significantly and blueprint events started to produce unreliable results, which is why a lot of optimization work was necessary to even run the project at 30 to 60 FPS.</p>
<p>Key optimization decisions revolved around poly count, texture resolution, particles, and the amount of on-tick updates. These had to be drastically reduced by optimizing the transport belt system, which caused a lot of stuttering in the early days of the project. We’ve also gained a lot of FPS by tweaking and optimizing the level of detail (LOD) of the animated parts of structures - such parts include things like the spinning cylinders on centrifuges, or all the gears and pistons on the roof of the assembling machines.</p>


<div>
<figure>
<img src="https://media.alt-f4.blog/ALTF4/65/array.jpg" alt="Array of 3D texture electric furnaces.">
<figcaption>You can never have enough iron plates.</figcaption>
</figure>
</div>


<p>There was also the need for approval from the Factorio developer Wube Software. When asked about the legality of this whole endeavour, they showed great understanding and allowed the project to be released, provided it won’t be used for commercial purposes.</p>
<h2 id="the-fun-part">
<a href="#the-fun-part">The Fun Part</a>
</h2>
<p>Once the general idea and most of the prototyping was figured out during the first two months of production, it became quite easy to replicate various Factorio assets and systems. That’s when the time came to really focus on the beauty of the whole thing and creation of the <a href="https://www.youtube.com/watch?v=01qux-5Qx_Y&amp;feature=youtu.be&amp;ab_channel=Hurricane">main release trailer</a>, which showcases large-scale bases built using the FUE5 exporter, and a lot of other cool stuff one can do within the FUE5 environment.</p>
<p>It was necessary to build a lot of custom stuff for the large-scale factories showcased in the trailer. Just the ability to export Factorio in-game bases doesn’t result in very clean and cinematic results, so there were a lot of tweaks done by hand to make it nice for the camera! It also turned out that spaghetti bases are much more fun visually than the long strips of single buildings optimized for high science per minute (SPM).</p>


<div>
<figure>
<img src="https://media.alt-f4.blog/ALTF4/65/fun.jpg" alt="Cube with machines and structures on all sides.">
<figcaption>Is this the Skyblock I’ve been hearing so much about?</figcaption>
</figure>
</div>


<h2 id="how-to-use-fue5">
<a href="#how-to-use-fue5">How to use FUE5</a>
</h2>
<p>This project is not a game, doesn’t have any user interface, and requires basic knowledge of UE5 to use. That being said, you can find a full description of the process on our <a href="https://github.com/FUE5BASE/FUE5">GitHub page</a>. Apart from installing UE5 and running the downloaded project, the process really comes down to simply selecting the chunk of your base you wish to export, and exporting it to FUE5 as described in the detailed <a href="https://github.com/FUE5BASE/FUE5/blob/main/BaseImportGuide.md">how-to guide</a>. Once you go through the process once, it becomes really easy to repeat.</p>
<h2 id="the-future">
<a href="#the-future">The Future</a>
</h2>
<p>We wanted to share this project as open source via GitHub, because the Factorio community is an extremely dedicated group of very creative people, and having access to such a project might allow some of them to experience the world they love in a new dimension. Plus, it might give the more creative ones the ability to create things which were not possible before.</p>
<p>Myself and Nuke are currently working on polishing the existing systems so they’re easy to use and perform well even with larger bases. We also started toying around with the idea of adding modded content in the future.</p>
<p>The factory must grow!</p>


<div>
<figure>
<img src="https://media.alt-f4.blog/ALTF4/65/se.jpg" alt="3D space elevator base surrounded by belts and machines.">
<figcaption>No joke here. Go play Space Exploration.</figcaption>
</figure>
</div>


<h2 id="contributing">
<a href="#contributing">Contributing</a>
</h2>
<p>As always, we’re looking for people that want to contribute to Alt-F4, be it by submitting an article or by helping with translation. If you have something interesting in mind that you want to share with the community in a polished way, this is the place to do it. If you’re not too sure about it we’ll gladly help by discussing content ideas and structure questions. If that sounds like something that’s up your alley, join the <a href="https://alt-f4.blog/discord">Discord</a> to get started!</p>


</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[/u/spez is right about feudalism and that's why Reddit is doomed (134 pts)]]></title>
            <link>https://maya.land/monologues/2023/07/01/spez-feudalism-reddit.html</link>
            <guid>36561166</guid>
            <pubDate>Sun, 02 Jul 2023 13:11:26 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://maya.land/monologues/2023/07/01/spez-feudalism-reddit.html">https://maya.land/monologues/2023/07/01/spez-feudalism-reddit.html</a>, See on <a href="https://news.ycombinator.com/item?id=36561166">Hacker News</a></p>
<div id="readability-page-1" class="page"><div itemprop="articleBody">
    <p>Since Elon Musk bought Twitter, people have been making a lot of comparisons between internet institutions – particularly various social media things – and premodern political forms and figures.</p>

<p>These comparisons typically rely on the level of understanding of antiquity or of medieval life you’d expect to get from <a href="https://www.dk.com/us/book/9781465481542-dkfindout-castles/">DKfindout! Castles</a>. I am not a historian, but I know, like, just about enough to be embarrassed for the speakers.</p>

<p>So in this post, I want to talk a bit about how the relevant historical phenomena worked, a bit about why feudalism tends to be a pretty bad comparison to internet stuff, and a bit about why Reddit CEO Steve Huffman is – still! – maybe more correct than he knows when he compares moderators to landed gentry… in a way that suggests the end coming for Reddit as-we-know-it<sup id="fnref:medieval" role="doc-noteref"><a href="#fn:medieval">1</a></sup>.</p>

<h2 id="medieval-sociopolitics-in-my-blog-its-more-likely-than-you-think">Medieval sociopolitics? In <em>my</em> blog? It’s more likely than you think</h2>

<p>Feudalism is such a shit concept to work with that if you look it up in the Encyclopedia Britannica, instead of getting a history of feudalism, you get <a href="https://www.britannica.com/topic/feudalism">a history of the term’s use in history, how it has always been an awkward oversimplification, and how it only got muddier over time</a>. Everything I can find goes to great pains to explain that any summary you can give will erase a lot of very important variance over time and place, and that even within one state at one time <a href="https://en.wikipedia.org/wiki/Feudalism_in_the_Holy_Roman_Empire#Types">shit could get stupid complicated</a>.</p>

<p>However! If I am to claim that internet comparisons to feudalism are bad, then I need to evaluate charitably what they might best mean, squinted at under flattering light.</p>

<p>To that end, let’s try and disentangle two parts. <a href="https://acoup.blog/2022/09/23/collections-teaching-paradox-crusader-kings-iii-part-iia-rascally-vassals/">Bret Devereaux, actual historian</a><sup id="fnref:bret" role="doc-noteref"><a href="#fn:bret">2</a></sup>:</p>

<blockquote>
  <p>Veteran readers of the blog will already know that I generally avoid the terms ‘feudal’ and ‘feudalism,’ as do many medievalists these days. The problem is that ‘feudalism’ comes to conflate two very different systems: manorialism, the economic system which structured the relations between peasant farmers (mostly serfs) and their elite landlords, and vassalage, the political system which structured relations between elites. But these systems and the relationships they structured were very different and their conflation together as a single system is a modern, not medieval, construction.</p>
</blockquote>

<p>Okay. Manorialism and vassalage. This sounds doable, right?</p>

<p>Here follows sketched-out summary.</p>

<h2 id="manorialism">Manorialism</h2>

<ul>
  <li><a href="https://acoup.blog/2020/07/24/collections-bread-how-did-they-make-it-part-i-farmers/">Premodern subsistence farmers, on their own, don’t optimize for producing a surplus, but instead on increasing their resiliency.</a><sup id="fnref:europe" role="doc-noteref"><a href="#fn:europe">3</a></sup> This is because having a surplus – whether in goods or money – is, in their context, both more difficult and less useful than you might expect. To increase resiliency, they can employ less facially efficient farming methods that will diversify their risks, and when times are good, they can invest any small surplus in social relations.</li>
  <li><a href="https://acoup.blog/2020/07/31/collections-bread-how-did-they-make-it-part-ii-big-farms/">Large landholders rely on the desperation of the little people to make it possible for them to secure enough borrowed/bought/forced labor to make those larger holdings produce</a>.</li>
  <li>The relationship between the small farmers and the elites is the exchange of “labor, deference and some support” for “[military or political] protection […], some access to farming capital and most importantly the implied promise that in a catastrophe the big landholder would come to the ‘rescue’.”-</li>
  <li>This relationship is largely exploitative. In many places and times, it relies on a lot of “non-free labor”. The non-free-ness of it all is enforced with violence or the threat of violence, whether state violence or not.</li>
  <li>The manorial relationship also “[serves] to reorient production away from subsistence and towards surplus” to support elite lifestyles. “[Doing] anything that isn’t farming means somehow forcing subsistence farmers to work more and harder in order to generate the surplus to provide for those people who do the activities which in turn the subsistence farmers might benefit from not at all.”</li>
</ul>

<h2 id="vassalage">Vassalage</h2>

<p>It is with some trepidation that I will point to non-popular-history<sup id="fnref:pop" role="doc-noteref"><a href="#fn:pop">4</a></sup>, “Fiefs and vassals : the medieval evidence reinterpreted”, by Susan Reynolds<sup id="fnref:admit" role="doc-noteref"><a href="#fn:admit">5</a></sup>. If anyone with a relevant degree wants to tell me I’m wrong in my summary or choice of source, they are welcome<sup id="fnref:google" role="doc-noteref"><a href="#fn:google">6</a></sup>.</p>

<p>She reiterates the thing about feudalism being a blob of concept that confuses more than it elucidates. She extends that to vassalage and fiefs, saying that, well, we might have hoped they would be more dependable concepts since they’re smaller in scope, but that was wrong. To the extent that we can pin down little bits of them with adequate definition, she says they aren’t as generally useful as they’ve been made out to be.</p>

<p>So in as far as we are here to make a comparison between vassalage and anything internet, it is probably fair to say that we are making it to a kind of 16th-century historical myth-narrative rather than a usefully abstracted description of real social relations.</p>

<p>Of this vassalage narrative, then:</p>

<ul>
  <li>Vassalage denotes the relation between a lord and his free or noble follower. This was undertaken with oath and ceremony. It obligated the lord to “protect and maintain his vassal”, and obligated the vassal to provide military aid and attend at the lord’s court. (The latter obligations were also sort of implied outside of vassalage relationships if you were otherwise propertied enough to be <em>able</em> to provide demanded knights, for instance.)</li>
  <li>It hacked a state structure into existence through personal relations when “there was [supposedly] no idea of the state and very little idea of impersonal, public obligations at all”<sup id="fnref:publica" role="doc-noteref"><a href="#fn:publica">7</a></sup>.</li>
  <li>In the modern mind, there are nice crisp distinctions between “rent” and “tax”. This is because we like to imagine we have a crisp concept of “ownership” of land distinct from jurisdiction. In fief-holding Europe, it’s more accurate to say that the <em>classic</em> ideological structure dictates that the land belongs to God, and God says kings have charge of bits of it, and the kings say lords have charge of bits of those bits, and the lords may say various non-lords have charge of bits… Rent-y-tax-y obligations are owed back up chain, and rights-like obligations exist along it. However, this <em>idea</em> obscures that folks down the chain may often feel that their land is more meaningfully theirs by <em>custom</em> than by the higher layers’ authority, and the language in primary sources doesn’t dictate clean lines.</li>
  <li>“[In] an age of low literacy, few records, and poor communications, great men needed to use personal loyalties, ceremonies, and <em>ad hominem</em> rewards to maintain and extend their power over the land; and that, since rulers, nobles, and most free men lived off the work of a dependent peasantry, rulers could maintain, control, and reward their followers by delegating control over land and peasants to them. It also seems clear that, as collective activity became more organized, as bureaucracy developed, and as literacy increased the range and power of propaganda, so government relied less on direct interpersonal relations.”</li>
</ul>

<h2 id="one-more-thing-state-capacity">One more thing: state capacity</h2>

<p>There’s this book called <a href="https://en.wikipedia.org/wiki/Seeing_Like_a_State">Seeing Like A State</a> by James C. Scott. If you’re not in the mood to read it, read <a href="https://www.ribbonfarm.com/2010/07/26/a-big-little-idea-called-legibility/">the first chunk of this blog post</a>, but mentally credit it with a bunch of examples Rao doesn’t include in the summary. This section is kind of cribbed from parts of it.</p>

<p>So – why did our mythically-feudal king need vassals, if other states didn’t always have them?</p>

<p>A state needs revenue, and in the premodern era, that’s got to come “mainly from levies on commerce and land, the major sources of wealth.” This turns out to be at least as complicated as taxes today, if for very different reasons. Knowing <em>from a distance</em> what taxes you should demand is hard. Take too little, and your state is feeble. Take too much, and you’ll have a whole new set of problems: flight, resistance, etc.</p>

<p>The local systems of measurement may vary from tiny place to tiny place – and even if you have more abstract ones to hand, local practices and land quality may mean that “two acres” in one place might acceptably be taxed far more highly than in another. So you can see why there was so much pressure to standardize the measures in the early modern era, right?</p>

<p>But it wasn’t <em>just</em> the measures getting standardized – it was also the rights people had.</p>

<p>Scott gives an example amalgamated from Southeast Asian practices. You might have land that’s parceled out among families during the main growing season, but reparceled out every seven years. After the main-season crop is harvested, then everything is common land, so anybody in the village gets to graze their animals and plant dry-season crops. But you might only be allowed to graze a certain number of animals, and that right might be transferable among the villagers, but not to outsiders. You might get to gather firewood for your own use but not for commercial sale – customs where fruit belongs to the family who planted a tree, even if not on their current parcel, but <em>fallen</em> fruit is fair game for anyone – rules about who gets branches that broke off of trees in storms… Rules “riven with inequalities based on gender, status, and lineage.”…</p>

<p>And <em>all</em> of this varying wildly from place to place.</p>

<p>Now: how could you as the king figure out how much rent-tax to demand directly from each of these people? Maybe you can figure out to some approximation the overall productivity of the overall land associated with the community, but actually extracting resources has to come from these households, right? And none of the inequalities are clear to you as an outsider – and <em>everyone will lie to you</em> and to your representatives because <em><a href="https://www.youtube.com/watch?v=ICUwC-f8iYg">fuck tha rent</a></em>.</p>

<p>And do you have the <em>capacity</em> to go around enforcing all this? To send people from your royal court out to each little hamlet, figure out how much to demand, and punish those who don’t meet the demand?</p>

<p>This points to an important function of the local feudal hierarchy, looked at from the perspective of <a href="https://en.wikipedia.org/wiki/State_capacity">state capacity</a>. If the vassal is around in the community to be able to figure out the local practices and maximize the rent-tax he can extract from the little people, then the king can extract value from the vassal and thus indirectly the region, even without having a bureaucracy under his own control that knows every town’s Local Fruit-Gathering Rules.</p>

<p>One of the main themes of Scott’s book is that throughout history, it is infeasible for states to build the Local Fruit-Gathering Rulebook at scale if they want to increase their centralized power and do Bigger Things. So what they actually do is come through and force people to stop measuring things the ways they have and to use standard measures, to stop thinking about property rights the ways they have and to use standard property rights, to stop using names the ways they have and to use patronyms… and while everyone hitting the pointy end of it <em>hates</em> this stuff, it makes it so much easier for the top-level state to do its state business that it can expand its state aspirations and be Bigger<sup id="fnref:scott" role="doc-noteref"><a href="#fn:scott">8</a></sup>. The capacity of the state isn’t just a function of the kind of bureaucracy you can build if you can force people to become more governable.</p>

<h2 id="why-this-stuff-doesnt-map-well-onto-the-internet">Why this stuff doesn’t map well onto the internet</h2>

<p>I would hope that everything I’m about to write is self-evident – so self-evident that you might as well skip this section. However, I would also have hoped that “people who want to sign up for an account on a new web service instead of using an old web service they don’t like as much anymore” would not consider it appropriate to term themselves “refugees”, so forgive me some obvious points.</p>

<ul>
  <li>The business at scale in social media is advertising. I haven’t given up hope on <a href="https://en.wikipedia.org/wiki/The_Long_Tail_(book)">the long tail</a>, <a href="https://www.honest-broker.com/p/where-did-the-long-tail-go">Gioiaian jeremiads notwithstanding</a>, but at scale, today, direct monetization pales in comparison to advertising’s revenues. This means that the economic productivity of social media use is indirect and highly mediated. Also, the business models are often opaque. This is a lot harder to track than wheat farms in medieval France somewhere. <strong>Comparisons risk implying we understand more than we accurately do</strong> about just who’s generating value and just how. (…more on this.)</li>
  <li>In the settled medieval context, there are subsistence farmers, and there are people eating surplus that subsistence farmers were squeezed into producing. Other food sources do not exist at the scale needed for the population. Reliable sources assure me the eventual consequence of going without food is death. Social media – the whole user-content internet – is only one of a whole host of entertainments, information sources, and communication options available to the kind of person who has internet access. Breaking one’s e.g. YouTube habit may be unpleasant or difficult, but it is not inherently life-or-death. <strong>When we make comparisons between our info-luxuries and survival necessities, we ratchet up the stakes in these conversations way too high</strong>, way too fast… and we also distract from <a href="https://apnews.com/article/technology-health-eating-disorders-center-government-and-politics-0c8ae73f44926fa3daf66bd7caf3ad43">actual life-or-death issues at play</a>.</li>
  <li>Over my lifetime, there have been a number of attempts at manufacturing digital scarcity. They have been pretty embarrassing and not made too much of a dent. That doesn’t mean that there are <em>no</em> relevant scarcities to bear in mind – money on offer for advertising, eyeball-hours monetizable on the other end – but <strong>naive analogies between, like, namespaces and <em>arable land holdings</em> often get pretty silly</strong>.</li>
  <li>I am not in debt bondage to Instagram. You are not a LinkedIn serf. Yes, there are relevant “<a href="https://doctorow.medium.com/facebooks-war-on-switching-costs-27fa4aeb7978">switching costs</a>” to this stuff. Those are notable because they operate in contrast to the general idea of businesses offering freely substitutable goods and services, not because <em>someone will come recapture you if you try to leave</em>. When someone writes a “Why I’m Leaving Twitter” post, they do not then have to go defend their violation of an oath of homage on the battlefield! <strong>If we pretend that we’re less free to leave than we are, we distort reality in ways that only benefit the big platforms.</strong></li>
  <li>If you are a premodern small farmer, you are subject to the varying jurisdictions that cover the land you live on and farm<sup id="fnref:transhumance" role="doc-noteref"><a href="#fn:transhumance">9</a></sup>. The social ties associated with your local community are essential to your survival. If you are an internet user today, you <a href="https://xkcd.com/1810/">have clicked through more terms of service than you can count</a>, migrated through more dead sites than you remember, and your ability to feed yourself is extraordinarily unlikely to be truly predicated on the particular group of otherwise-strangers with whom you interact on any given app<sup id="fnref:networking" role="doc-noteref"><a href="#fn:networking">10</a></sup>. <strong>There are a lot more options to the modern internet user than acquiescence or revolt-in-place.</strong></li>
  <li>The jurisdiction associated with lords’ enfiefed land is a burden, not a perk. <strong>Having to deal with little people problems is not a longed-for opportunity to get to tell people what to do – it is part of the trade-off necessary to get to extract rents/taxes from them.</strong> Remember: these are <em>actually</em> inherited positions, not first-mover-benefits-maintained-over-time. I am sure you can find an example of some medieval baron getting petty about dumb shit (send it to me!), but for the most part, everything I’ve read suggests they are trying to further delegate this work to <em>their</em> retainers so they have more time for… you know, falconry. Fulfilling their other obligations. Flexing on other rich people. 1% problems.</li>
</ul>

<h2 id="so-if-its-that-bad-why-do-people-keep-making-the-comparison">So if it’s that bad, why do people keep making the comparison?</h2>

<p>Reynolds’ book begins:</p>

<blockquote>
  <p>Feudalism, to any members of the general public who ever refer to it, stands for any hierarchical and oppressive system. Bosses or landlords who bully their employees or tenants are being feudal. If they bully them fiercely they are worse: they are positively medieval.</p>
</blockquote>

<p>To some extent, that’s the long and the short of it. The kind of person who imagines that the Dark Ages are called that because they weren’t yet Enlightened is not trying to make a historically-grounded point about political theory. They’re trying to say that something <em>sucks</em>. Anyone who grew up in a liberal democracy absorbed quite a lot of civic ideology about what makes governments legitimate; therefore, any authority that the speaker had no hand in appointing is a likely target of this condemnation. “Someone who isn’t me has power and control and I don’t like it”. That’s a fair thing to want to express, even if I’m salty about inaccuracy of comparison.</p>

<p>So… okay, so what? I didn’t get thousands of words into this just because <a href="https://xkcd.com/386/">someone said something obviously wrong about a medieval thing on the internet</a>.</p>

<p>Can we redeem this desire to compare the two?</p>

<p>How far can we get with a comparison if we try to say <code>/u/spez</code> is right?</p>

<h2 id="steve-my-liege-a-word">Steve, my liege, a word</h2>

<p>Steve Huffman (<a href="https://old.reddit.com/user/spez"><code>/u/spez</code></a>) is the CEO of Reddit. Reddit is a social media site that is somewhat unlike its competitor social media sites in form, but which is trying to have its business become publicly traded. It therefore needs to become more like those other sites – at least in profitability narrative. Reddit makes <a href="https://www.theverge.com/2021/8/12/22621445/reddit-valuation-revenue-funding-round">most of its revenue from advertising</a>. It relies on a vast amount of unpaid volunteer moderation labor – <a href="https://clivethompson.medium.com/reddit-moderators-do-over-3-4-million-in-free-labor-every-year-d3571235c32c">$3.4 million’s worth a year</a>, by one estimate. Some of Huffman’s IPO-minded moves have proven <a href="https://health.wusf.usf.edu/npr-health/2023-07-01/reddit-says-new-accessibility-tools-for-moderators-are-coming-mods-are-skeptical">very hostile</a> to the moderators, who have been protesting by taking subreddits dark – restricting access or posting or otherwise <a href="https://www.cnn.com/2023/06/23/tech/reddit-john-oliver-protest/index.html">creatively disrupting their function</a>.</p>

<p>And then Steve forces my hand, <em>makes</em> me write all this, by <a href="https://www.nbcnews.com/tech/tech-news/reddit-protest-blackout-ceo-steve-huffman-moderators-rcna89544">saying the following</a>:</p>

<blockquote>
  <p>If you’re a politician or a business owner, you are accountable to your constituents. So a politician needs to be elected, and a business owner can be fired by its shareholders.</p>
</blockquote>

<blockquote>
  <p>And I think, on Reddit, the analogy is closer to the landed gentry: The people who get there first get to stay there and pass it down to their descendants, and that is not democratic.</p>
</blockquote>

<p>There is obviously a lot about this that immediately sounds alarms, right?</p>

<ul>
  <li>Look, I’m even less of a lawyer than I am a historian, but if “a business owner can be fired by its shareholders” then they weren’t actually the <em>owner</em> of the business, no? They were, like, a CEO or something?</li>
  <li>Conflating citizens and shareholders is a classic American thought disease. Polysyllabic cringe.</li>
  <li>It sounds like Steve thinks that “gentry” operated on <a href="https://www.history.com/this-day-in-history/settlers-race-to-claim-land">Oklahoma land grab rules</a>.</li>
  <li>While <em>I</em> am willing to get hype about the general idea of property inheritance being so anti-democratic in nature that a democratic society must expropriate that property to function, I am guessing Steve Huffman, <a href="https://duckduckgo.com/?t=ffab&amp;q=steve+huffman+net+worth&amp;ia=web">estimated net worth in the millions</a> Steve Huffman, is not too married to what that implies, and really intends only to speak of inherited <em>authority</em>.</li>
</ul>

<p>But… fine. Come at me, Huffman.</p>

<h3 id="what-can-we-get-from-comparing-moderators-to-feudal-lords">What can we get from comparing moderators to feudal lords?</h3>

<h4 id="you-need-manorialism-to-make-little-farmers-produce-surplus-and-you-need-moderation-to-make-openly-hosted-user-generated-content-ad-monetizable">You need manorialism to make little farmers produce surplus, and you need moderation to make openly hosted user-generated content ad-monetizable</h4>

<p>Our subsistence farming household does not really want to produce the kind of surplus that can then be rent-taxed away, so the feudal structure has to force that to happen to exist. There’s real production, valuable activity, going on no matter what – but to make your state a Thing you need to beat that production into a useful shape.</p>

<p>Small, closed groups of internet users often function on top of internet infrastructure without explicit internal moderation. You, the reader, are probably in a number of group texts from which you have never formally banned a member for spam.</p>

<p>The openness of a platform can create a lot <em>more</em> monetizable engagement than the group chats. There are many of you who will never get to snigger at the jokes in my group chats, and <a href="https://en.wikipedia.org/wiki/Homo_economicus">Homo economicus</a> might see that as lost opportunity to engage-and-advertise-and-monetize, if he squints. A missed opportunity for extractable surplus – because, like the subsistence farmers trying to maximize resilience instead of production, my friends are not sharing bad puns with an eye toward anyone’s ad revenue.</p>

<p>However, open, public internet infrastructure has its own downward tendencies. Whenever a truly unmoderated hosting service opens on the internet, there is a clock ticking down until that service is first used to host <a href="https://www.techdirt.com/2022/11/02/hey-elon-let-me-help-you-speed-run-the-content-moderation-learning-curve/">content related to child sexual abuse.</a> The openness can create an economic opportunity, but you need moderation to make that hold together – even just on the legal front.</p>

<p>Or just imagine an ad equilibrium. You, a user, are probably willing to tolerate a certain amount of promotional stuff in a Web Thing before you go off and find another Web Thing; call it an ad-viewing threshold. Variable by individual, but probably measurable in aggregate. Promotional material that is posted by a user and shown to you counts against your threshold, and any ad space bought with the platform on your feed also counts against your threshold, but only the latter makes the platform money. If the platform has enough would-be paid-advertisers to max out whatever it estimates its users’ ad-viewing threshold to be, then it has a strong incentive to go and hunt down any user content on its platform that has even a hint of promotion and hide it from sight. Maybe it’ll get those users to give up and pay them, but even if it doesn’t, it stops them from displacing monetizable ads under your threshold<sup id="fnref:unicode" role="doc-noteref"><a href="#fn:unicode">11</a></sup>.</p>

<p>So even if a moderator isn’t engaging with the ad infrastructure of a site, and <em>even if they’re not explicitly dealing with maintaining a high bar of “advertiser-friendliness”</em>, their role functions to make the thing stick together in the open way that produces the engagement-surplus that attracts ad money.</p>

<h4 id="local-variance-in-custom-makes-it-really-hard-to-moderate-from-outside-the-community">Local variance in custom makes it really hard to moderate from outside the community…</h4>

<p>If you ask heavy-use Redditors about their use of the site, many will, unprompted, bring up that the main big subreddits are trash and, while they might <em>also</em> subscribe to <code>/r/gifs</code> or whatever, they’re really <em>there</em> for the niche communities that are quite different – in both tone and content. Yes, it’s impressive that the recommendation algorithms on short-form video platforms can deduce my susceptibility to <a href="https://www.instagram.com/nicole_coenen/">thirst-trappy woodcutter lady content</a>, but the level of specificity in which such content is arranged on Reddit is far more impressive (sometimes horrifying in its specificity, if we’re being honest). These are far more diverse in intent and effect than the “communities” of shared engagement that arise around algorithmically recommended topics.</p>

<p>Maintaining engagement on <code>/r/AskHistorians</code> requires a very different standard of post and comment moderation than e.g. <code>/r/circlejerkaustralia</code>; they are trying to be different things, people <em>go</em> to them for different things, and the rules that will best encourage posters to post and consumers to consume are different.</p>

<p>How would you do that in a scalable way from the outside? Hell, set aside trying to keep things on-topic – from the outside, how can you keep up with the ever-shifting dog whistles and coded signifiers of bigotry that accompany the first encroachments of <a href="https://en.wiktionary.org/wiki/Nazi_bar">Nazis into your bar</a>? Maybe advertisers won’t understand either to care about the first wave, but you better believe they won’t like the media coverage of the later ones…</p>

<p>In an environment as heterogeneous and nichey as Reddit has been: you can’t. It works about as well as compiling the Local Fruit-Gathering Rules with the Firewood Addenda for every village in your nation. So if you’re going to have heterogeneous and nichey social media, you need moderation to be heterogeneous and nichey, enacted by the kind of person Scott calls a “local tracker”. <strong>Reddit as it has existed does not have the “state capacity” to do this any other way.</strong> Maybe, at least for the high-engagement subreddits that it considers most important, it can <em>replace</em> the local trackers with more compliant ones – but it can’t go without them. The king of Reddit, today, needs somebody to go be baron. If he couldn’t get them for free, he’d have to pay them.</p>

<h4 id="but-if-you-can-rent-tax-from-outside-the-community-you-can-shift-the-balance-of-power">…but if you can rent-tax from outside the community, you can shift the balance of power</h4>

<p>Reddit does not pay its moderators. It is not fully accurate to say that Reddit even confers the status and control that moderators possess, because that status and control is scoped to their moderated communities, and thus principally a function of community prominence. Anyone can be <em>a</em> mod; being a moderator of something that <em>matters</em> is something different entirely, and it’s Reddit’s userbase that makes <em>that</em> happen. On Reddit, many communities are extremely fungible; use the site long enough and you’ll observe schisms and migrations to new bits of namespace. We can argue that there is <em>some</em> extent to which community prominence is driven by the desirability of the community name, which is a bit conferred by Reddit – if I’m looking for an X subreddit, I’m going to look for <code>/r/X</code> before <code>/r/originalX</code>, <code>/r/seriousX</code>, <code>/r/XUncensored</code> etc., so there’s <em>something</em> meaningful to who gets to keep running <code>/r/X</code> – but in practice this is moderately fluid, as genres of content merge and divide even without explicit mod drama.</p>

<p>So if I were going to pin down what Reddit “gives” its mods, I would probably put it something like this: The ability to create and grow an online community with a bunch of useful (and not free-to-operate!) infrastructure and with intercommunity discovery among a large existing userbase.</p>

<p>What Reddit <em>gets</em> from its mods is – following the above – the ability to make the money that it makes from ads.</p>

<p>So how do you know whether that’s a fair trade?</p>

<p>It isn’t disqualifying to our comparison that the mods/lords don’t get paid in the same kind of thing that the company/king gets. For example, it was fairly common for the king to principally extract <em>military</em> support from the lords, rather than the same kind of rent-taxes the lords extracted from the commoners. However, this dynamic was always a bit in flux; making your vassals mad by giving them a shitty trade-off posed risks the king had to deal with in much the same way that the lords had to contend with the risk of overtaxing the populace. No one involved was <em>stupid</em>, and all the weird ideological language about divine right of kings shouldn’t make you think that people weren’t looking out for their own interests.</p>

<p>But crucially – the lords knew what kind of revenues they were getting from their lands, and they knew what the king was getting from them in turn. Maybe they’d lie to the king about the exact surpluses they’d extracted, just like the farmers would lie as much as possible about how much surplus there <em>was</em> – but their local control meant they had the local knowledge necessary to piece together the situation themselves.</p>

<p>So you can <em>imagine</em> that maybe the status quo <em>is</em> a fair trade – maybe the costs of running Reddit (data centers, engineers, lawyers), minus the ad revenue pretty much balance what Reddit gets from the mods in return for the chance to run their little communities. But how do you <em>know</em>?</p>

<p>A mod might be able to estimate how replaceable the job they do is, how replaceable their <em>community</em> is, and start trying to figure out what their leverage is…</p>

<p>But how do they estimate Reddit’s end of the deal?</p>

<p>Let’s talk about online advertising platforms for a second. (Sorry.)</p>

<p>YouTube does some revenue-sharing with video creators, so the amount of information exposed illustrates some interesting dynamics. First, remember: <em>many videos lose YouTube money, possibly even most.</em> They don’t ever get enough monetizable engagement to pay for their own (secret) marginal contributions to operating costs. Video hosting is expensive! But where there <em>is</em> monetizable engagement, the fact that we have <em>some</em> numbers doesn’t clear as much up as you might think.</p>

<p>Let’s say there’s some genre of enterprise software that’s hugely profitable to sell, but niche in potential customers; to advertise products of this kind, you need to reach people who work at companies who have jobs where they can influence buying decisions. Let’s say you are trying to sell one of these products. You know that the kind of person with the kind of job that makes them useful to influence likely uses some <em>other</em> kind of software – <a href="https://en.wikipedia.org/wiki/Tableau_Software">Tableau</a>, maybe. Now let’s say that <em>I</em> run a YouTube channel with Tableau tutorials. You and your competitors want to advertise on my channel <em>so bad</em>. Maybe you don’t specifically know about my channel, and you’re letting YouTube figure out the eligibility of where to put your ads – but that’s the advertising opportunity that might <em>work</em> for your business, so if YouTube is willing to offer you that specificity, it’s gonna be valuable to you, and that means it’s gonna be <em>pricey</em>. If YouTube is revenue-sharing <em>honestly</em>, then <em>that</em> means that <em>I</em> am gonna get a way bigger cut per video than the creator of a <em>equally watched</em> channel that doesn’t imply some super-valuable advertising opportunity. And indeed, we see some amount of that: “best short term insurance plans” as keywords gets a <a href="https://en.wikipedia.org/wiki/Cost_per_impression">CPM</a> about <a href="https://vloggerpro.com/youtube-niches-with-high-cpm/">50 times higher than “best USB mic”</a>, and some of that trickles down to the actual video creators.</p>

<p>But this can be alienated in ways that give the advertising platform a leg up. Let’s say that there’s a Norwegian law news channel that, like, <em>every</em> Norwegian lawyer watches religiously. It doesn’t post much, maybe, so it doesn’t get a ton of traffic, but the correlation is flawless. Norway has a high CPM, law has a high CPM, so let’s just say that intersection is a super valuable advertising target. Furthermore, though, this channel is so <em>boring</em> and <em>specific</em> that probably anyone who watches it much <em>is</em> a Norwegian lawyer. YouTube keeps track of those accounts. Let’s say there’s a <em>second</em> channel that’s all about… I dunno, drama commentary about the <a href="https://en.wikipedia.org/wiki/Norwegian_National_Opera_and_Ballet">Norwegian National Opera and Ballet</a>, and it just so happens that – unbeknownst to either the law news channel or the opera drama channel – Norwegian lawyers eat this opera drama shit up. This second channel might not have any high-CPM topics associated with it – but <em>if</em> YouTube lets advertisers target by “likely to be a Norwegian lawyer” rather than keywords associated with the actual opera video, then the <em>signal</em> about target demographics gathered from the law news channel combined with the <em>engagement</em> generated by the opera drama channel creates very profitable advertising opportunities for YouTube. Should the law news channel get a cut of the law-targeted ads on the opera drama channel because its content provided the signal that let that targeting happen<sup id="fnref:targeting" role="doc-noteref"><a href="#fn:targeting">12</a></sup>? Should the opera drama channel be paid better for desirability of the eyeball-hours it attracts, independently of opera drama keyword CPM? Does either channel have accurate information on how competitive its market is? If neither channel knows about the correlation, how incentivized is YouTube to remunerate them for the profitability of the intersection?</p>

<p>Maybe YouTube has the data it could crunch to figure out the marginal contributions there, but this begins to <em>sound</em> a bit like… parcels of land that maybe you can farm on <em>some</em> of the year, but during the <em>dry</em> season your <em>neighbors</em> can graze their <em>animals</em> on, but then with <em>trees</em> that the <em>old</em> tenants get to harvest… Right?</p>

<p>Substitute “subreddit” for “YouTube channel” and mix in that Reddit doesn’t have to share its detailed ad numbers, and you start to see how <strong>any given moderator of any given community can’t know whether they’re being exploited or how badly</strong>, even if as a whole it seems like mods produce way more value for Reddit than they benefit from. <em>Your</em> subreddit might marginally make Reddit a ton of money or might <em>lose</em> Reddit money, and you have no visibility into which.</p>

<p>The real dynamics of online advertising are fundamentally hidden from the creators of content and from volunteer moderators, and this means that no one can negotiate from their own actual value in the market. The illegibility of local variation may have meant that feudal lords were necessary to the feudal state, and the illegibility of local custom may similarly have meant that community-embedded moderators are necessary to Reddit as it exists today, but <strong>these platforms have information asymmetry</strong> that weights the balance of power heavily toward them. That’s kinda wild, and I can’t think of a parallel that real landed gentry had to put up with.</p>

<h4 id="the-tension-between-custom-and-putative-authority-seems-important-for-understanding-feudalism-and-moderator-revolt">The tension between custom and putative authority seems important for understanding feudalism and moderator revolt</h4>

<p>Let’s say the king comes to you, a feudal lord, and tells you that <a href="https://daily.jstor.org/peter-the-greats-beard-tax/">you’ve got to shave your beard</a>. Maybe he bothers justifying it, whatever. You don’t <em>want</em> to shave your beard. “You know, your Majesty,” you say, “this new law seems pretty risky. Obviously <em>I</em> would never, but, uh, what if the rest of the lords tell you to, you know. Fuck off?”</p>

<p>One thing the king <em>might</em> say is “Well, my good man, who would <em>definitely</em> never say such a thing himself, they only matter because <em>I</em> say they do. Because God says <em>I</em> matter, and <em>I</em> delegated authority <em>to</em> them. And they know that, so they know that it would be both inherently ridiculous and self-defeating to go against me. Like, what would they be without me? Nothing. Peasants in violation of <a href="https://en.wikipedia.org/wiki/Sumptuary_law#Scotland">sumptuary law</a>.”</p>

<p>You are not totally confident in this description of affairs. It sort of seems to you that the tenant farmers under you are mostly under your control because everyone’s used to it and because you pay men with pointy metal things to tidy up the exceptions, not because you have a royal stamp of officialdom. Sure, <em>technically</em> you are <em>under</em> this king, but is that really relevant to how the yearly harvest gets brought in and taxed? If that royal stamp were revoked, wouldn’t you still be able to exploit the local farmers all the same?</p>

<p>But it’s a little ambiguous. Even if the king’s authority seems like a fiction, if he has the military power to come in, squash you, and give your fief to the neighboring Baron Dogface, then… well, the little people would probably shrug and pay rent-tax to Dogface and try to get on with their own lives.</p>

<p>So who does a subreddit belong to?</p>

<p>Imagine starting one, hyping it up, patiently providing four-fifths of the content until people show up, moderating spam, moderating jerks, growing it gradually over time. Setting rules, establishing tone, running the weekly topical threads. Would you feel like that <code>/r/whateverItWas</code> existed because of <em>Reddit the company</em>? Would you feel like it fundamentally belonged to his Royal Highness Steve, and Steve was just delegating it to you to run? No! You started it! You shaped it! You collaborated with the people it attracted to make it what it is! Even those users – they could switch <em>tomorrow</em> to <code>/r/whateverItWasTwo</code> and you couldn’t do a thing about it – if they decided they didn’t like your vision for <code>/r/whateverItWas</code>, they <em>would</em>, so the fact that they’re still here is a kind of voting with your feet, it <em>validates</em> what you’re doing… To the extent that <code>/r/whateverItWas</code> exists as a <em>thing</em> within Reddit as a whole, to be run or misrun, managed or mismanaged? It feels like <em>yours</em>.</p>

<p>But at the same time, to an external observer – you can see how they would feel that this is pretty silly, right? The thing that’s “yours” is nothing but rows and columns in Reddit’s databases<sup id="fnref:rdbms" role="doc-noteref"><a href="#fn:rdbms">13</a></sup>, a series of flags giving you the power to moderate. The only thing you have is set in Reddit’s systems, a permission to edit stuff under a certain scope a bit differently than other users, wo<em>wee</em> aren’t you important. It’s not you who has a license to the user posts, it’s not you who controls anything but a tiny little square of grass Reddit let you mow. You’re gonna <em>protest</em> over that? The world at large already doesn’t understand why you might volunteer for this work, why you might care enough to do it unpaid – you seem like a schmuck to them, a victim.</p>

<p><strong>But not to Steve.</strong></p>

<p>Steve is calling you landed gentry not because he’s <em>really</em> proposing to make things more <em>democratic.</em> Plenty of the protesting subreddits <em>voted</em> to protest – and even if Reddit vomits some PR about how that only reflects, like, <a href="https://en.wikipedia.org/wiki/1%25_rule">the 9% rather than the 90%</a> that never vote, it’s not really a convincing argument, is it? Steve is calling you landed gentry because <strong>he knows you work for him, making him money, and he wishes that you understood your authority to be delegated from him as your liege lord</strong>. Steve is annoyed that you feel like you have your own thing by local custom when what he sees is a bunch of flags in tables that are getting in the way of his business decisions<sup id="fnref:annoyed" role="doc-noteref"><a href="#fn:annoyed">14</a></sup>.</p>

<p>And I’m pretty sure Steve would like to modernize this whole feudal mess and remove the locality of your control.</p>

<h3 id="the-early-modern-state-comes-to-reddit">The early modern state comes to Reddit</h3>

<p>If we go back to Seeing Like A State for a minute… Technologies and practices that enabled central control were critical in the progression of the early modern state. Get rid of all that local variation in law and standardize it. Get rid of all those confusing local measurements. Bulldoze weird little windy streets and create boulevards that will make it easier to subdue local resistance. Propagandize to center your own importance. Use new media to extend your influence and control. Now you don’t need those local trackers like you once did, now you can administer your state more effectively centrally.</p>

<p>You know who’s managed this beautifully?</p>

<p>TikTok.</p>

<p>TikTok is really good at making people <em>feel</em> like they are seeing hyper-individualized content, but never allowing any explicit division of spaces within it. Without that division, no local norms can be established, no real preference expressed, and thus the tone of content is often uncannily homogeneous across wildly variant topics. This is what you’d expect: the unsteerable algorithmic recommendation feed feels like the final form of <a href="https://www.roughtype.com/?p=8724">content collapse</a>.</p>

<p>If I were a profit-maximizing social media company trying to expand my “state capacity”, I would be throwing money at every feature I could that took explicit navigation away from users, instead offering them frictionless spoon-feeding. Why? Social media that is homogenized (standard language!) is easier to moderate at scale. Moderation that is opaque (downweighting within hidden rankings) is easier to enact without objection, and tunably toward my engagement goals. Without even a sense of search keywords, I would increase the opacity of my advertising even further, obscuring from content creators the value I extract from them. These moves parallel the ones that Scott outlines early modern states taking to pull themselves out of dependency on local trackers. Remember: you don’t have to come up with a bureaucracy that can better handle the nation you have <em>if you can change the nation itself</em> to make it more governable.</p>

<p>And don’t you see those moves coming to Reddit?</p>

<p>I mean, maybe you <em>don’t</em> – Reddit has been pretty clever in allowing power users to maintain the old view characterized by explicit control even while it funnels new eyeballs toward recsys pablum. Part of Reddit’s whole IPO story <em>has</em> to be proving that it can provide a beautifully monetizable spoon-fed Infinite Recommended Content Feed just like Instagram or TikTok or Twitter or whatever – that’s just how social media companies are structured now. But especially if you’re used to using <code>https://old.reddit.com/</code> or one of the very good third party apps that has existed – pop open a private window and navigate to the normal home page. Doesn’t that look a <em>bit</em> like they’re trying to navigate away from how Reddit has always been and towards e.g. Twitter?</p>

<p>So maybe Reddit moderators <em>are</em> like feudal lords in that they have been the necessary structure that allowed Reddit communities to be so <em>wildly</em> different all this time.</p>

<p>And maybe we need to lean into those metaphorical comparisons to imagine what’s coming next. Bloggers invoking the high-level “enclosure of the commons” are phoning it in. Let’s talk <a href="https://en.wikipedia.org/wiki/Enclosure#The_end_of_the_Open_Field_system">conversion of copyholders into leaseholders to remove customary rights</a>.</p>

<p>And maybe we need to look at the ways those metaphorical comparisons <em>don’t</em> hold to imagine our ways <em>out</em>. Premodern subsistence farmers and early modern state subjects didn’t have all the options we do. You can’t bootstrap an alternate state by, like, automating crossposting, but on the internet all <em>kinds</em> of things are possible. (Hell, reminds one a bit of <a href="https://www.vice.com/en/article/z4444w/how-reddit-got-huge-tons-of-fake-accounts--2">Reddit’s own fakery</a>, dunnit?)</p>

<p>So as a non-moderator, as a <em>peasant</em>, as an <em>un-titled pleb</em>, I’d like to thank Steve for issuing the most CEO-flavored version of the age-old phpBB “the mods are mad with power!” complaint I’ve ever heard in my goddamn life.</p>

<p>Long live the King.</p>

<hr>


  </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Google Sidewiki (116 pts)]]></title>
            <link>https://en.wikipedia.org/wiki/Google_Sidewiki</link>
            <guid>36560937</guid>
            <pubDate>Sun, 02 Jul 2023 12:41:27 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://en.wikipedia.org/wiki/Google_Sidewiki">https://en.wikipedia.org/wiki/Google_Sidewiki</a>, See on <a href="https://news.ycombinator.com/item?id=36560937">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
							

						<p>From Wikipedia, the free encyclopedia</p>
					</div><div id="mw-content-text" lang="en" dir="ltr">

<table><caption>Google Sidewiki</caption><tbody><tr><td colspan="2"><a href="https://en.wikipedia.org/wiki/File:Sidewiki_logo.png"><img alt="Sidewiki logo.png" src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/54/Sidewiki_logo.png/120px-Sidewiki_logo.png" decoding="async" width="120" height="24" srcset="https://upload.wikimedia.org/wikipedia/commons/thumb/5/54/Sidewiki_logo.png/180px-Sidewiki_logo.png 1.5x, https://upload.wikimedia.org/wikipedia/commons/5/54/Sidewiki_logo.png 2x" data-file-width="200" data-file-height="40"></a></td></tr><tr><td colspan="2"><a href="https://en.wikipedia.org/wiki/File:Google_Sidewiki_Screenshot.png"><img alt="Google Sidewiki Screenshot.png" src="https://upload.wikimedia.org/wikipedia/en/thumb/0/03/Google_Sidewiki_Screenshot.png/100px-Google_Sidewiki_Screenshot.png" decoding="async" width="100" height="192" srcset="https://upload.wikimedia.org/wikipedia/en/thumb/0/03/Google_Sidewiki_Screenshot.png/150px-Google_Sidewiki_Screenshot.png 1.5x, https://upload.wikimedia.org/wikipedia/en/thumb/0/03/Google_Sidewiki_Screenshot.png/200px-Google_Sidewiki_Screenshot.png 2x" data-file-width="228" data-file-height="437"></a><p>Screenshot of the entries for the Wikipedia portal page.</p></td></tr><tr><th scope="row"><a href="https://en.wikipedia.org/wiki/Programmer" title="Programmer">Original author(s)</a></th><td><a href="https://en.wikipedia.org/wiki/Google" title="Google">Google</a></td></tr><tr><th scope="row"><a href="https://en.wikipedia.org/wiki/Programmer" title="Programmer">Developer(s)</a></th><td><a href="https://en.wikipedia.org/wiki/Google" title="Google">Google</a></td></tr><tr><th scope="row">Initial release</th><td>September&nbsp;23,&nbsp;2009<sup id="cite_ref-1"><a href="#cite_note-1">[1]</a></sup></td></tr><tr><th scope="row"><a href="https://en.wikipedia.org/wiki/Operating_system" title="Operating system">Operating system</a></th><td><a href="https://en.wikipedia.org/wiki/Windows_XP" title="Windows XP">Windows XP</a>, <a href="https://en.wikipedia.org/wiki/Windows_Vista" title="Windows Vista">Windows Vista</a>, <a href="https://en.wikipedia.org/wiki/Windows_7" title="Windows 7">Windows 7</a>, <a href="https://en.wikipedia.org/wiki/Linux" title="Linux">Linux</a>, <a href="https://en.wikipedia.org/wiki/Mac_OS_X" title="Mac OS X">Mac OS X</a></td></tr><tr><th scope="row"><a href="https://en.wikipedia.org/wiki/Computing_platform" title="Computing platform">Platform</a></th><td><a href="https://en.wikipedia.org/wiki/Google_Chrome_Extensions_Gallery" title="Google Chrome Extensions Gallery">Google Chrome Extension</a>, <a href="https://en.wikipedia.org/wiki/Google_Toolbar" title="Google Toolbar">Google Toolbar</a>, <a href="https://en.wikipedia.org/wiki/Bookmarklet" title="Bookmarklet">bookmarklet</a> (<a href="https://en.wikipedia.org/wiki/Firefox" title="Firefox">Firefox</a>, <a href="https://en.wikipedia.org/wiki/Internet_Explorer" title="Internet Explorer">Internet Explorer</a>, <a href="https://en.wikipedia.org/wiki/Opera_(web_browser)" title="Opera (web browser)">Opera</a>, <a href="https://en.wikipedia.org/wiki/Apple_Safari" title="Apple Safari">Safari</a>)</td></tr><tr><th scope="row">Available in</th><td>English</td></tr><tr><th scope="row"><a href="https://en.wikipedia.org/wiki/Software_categories#Categorization_approaches" title="Software categories">Type</a></th><td><a href="https://en.wikipedia.org/wiki/Web_annotation" title="Web annotation">Web annotation</a></td></tr><tr><th scope="row">Website</th><td><a rel="nofollow" href="http://www.google.com/sidewiki/">google.com/sidewiki</a></td></tr></tbody></table>
<p><b>Google Sidewiki</b> was a <a href="https://en.wikipedia.org/wiki/Web_annotation" title="Web annotation">web annotation</a> tool from <a href="https://en.wikipedia.org/wiki/Google" title="Google">Google</a>, launched in September 2009 and discontinued in December 2011. Sidewiki was a <a href="https://en.wikipedia.org/wiki/Browser_extension" title="Browser extension">browser extension</a> that allowed anyone logged into a <a href="https://en.wikipedia.org/wiki/Google_Account" title="Google Account">Google Account</a> to make and view comments about a given website in a <a href="https://en.wikipedia.org/wiki/Sidebar_(computing)" title="Sidebar (computing)">sidebar</a>. Despite the name, the tool was not a collaborative <a href="https://en.wikipedia.org/wiki/Wiki" title="Wiki">wiki</a>, though the comments were editable by the author.<sup id="cite_ref-3"><a href="#cite_note-3">[3]</a></sup><sup id="cite_ref-arstech_4-0"><a href="#cite_note-arstech-4">[4]</a></sup>
</p>
<meta property="mw:PageProp/toc">
<h2><span id="Function">Function</span><span><span>[</span><a href="https://en.wikipedia.org/w/index.php?title=Google_Sidewiki&amp;action=edit&amp;section=1" title="Edit section: Function">edit</a><span>]</span></span></h2>
<p>Google used ranking algorithms to determine comment <a href="https://en.wikipedia.org/wiki/Relevancy" title="Relevancy">relevancy</a> and usefulness, using criteria such as users voting up and down a comment and past user contributions. Anyone could look up a contributor's <a href="https://en.wikipedia.org/wiki/Google_profile" title="Google profile">Google profile</a> and assess their credibility. Caesar Sengupta of Google argued that the link to Google Profiles would help increase comment quality, because "People stop making trivial comments when it ties back to them."<sup id="cite_ref-paid_5-0"><a href="#cite_note-paid-5">[5]</a></sup> Website owners could "claim" their site, giving them the right to the first comment on the Sidewiki for that site.<sup id="cite_ref-6"><a href="#cite_note-6">[6]</a></sup> Sidewiki also linked to "relevant posts from blogs and other sources", a feature that was potentially gameable.<sup id="cite_ref-7"><a href="#cite_note-7">[7]</a></sup> Sidewiki was available for <a href="https://en.wikipedia.org/wiki/Internet_Explorer" title="Internet Explorer">Internet Explorer</a> and <a href="https://en.wikipedia.org/wiki/Firefox" title="Firefox">Firefox</a> through <a href="https://en.wikipedia.org/wiki/Google_Toolbar" title="Google Toolbar">Google Toolbar</a>, and on the <a href="https://en.wikipedia.org/wiki/Google_Chrome" title="Google Chrome">Google Chrome</a> browser through an add-on.<sup id="cite_ref-pcmag_8-0"><a href="#cite_note-pcmag-8">[8]</a></sup> For other browsers like <a href="https://en.wikipedia.org/wiki/Safari_(web_browser)" title="Safari (web browser)">Safari</a>, it was available as a third-party <a href="https://en.wikipedia.org/wiki/Bookmarklet" title="Bookmarklet">bookmarklet</a>.<sup id="cite_ref-9"><a href="#cite_note-9">[9]</a></sup><sup id="cite_ref-10"><a href="#cite_note-10">[10]</a></sup> Comments could be shared via a link, email, Twitter, or Facebook,<sup id="cite_ref-pcmag_8-1"><a href="#cite_note-pcmag-8">[8]</a></sup> and an <a href="https://en.wikipedia.org/wiki/API" title="API">API</a> was available for developers.<sup id="cite_ref-11"><a href="#cite_note-11">[11]</a></sup>
</p>
<h2><span id="Shutdown">Shutdown</span><span><span>[</span><a href="https://en.wikipedia.org/w/index.php?title=Google_Sidewiki&amp;action=edit&amp;section=2" title="Edit section: Shutdown">edit</a><span>]</span></span></h2>
<p>In September 2011, Google announced it would discontinue a number of its products, including Google Sidewiki.<sup id="cite_ref-12"><a href="#cite_note-12">[12]</a></sup>
</p>
<h2><span id="Reception">Reception</span><span><span>[</span><a href="https://en.wikipedia.org/w/index.php?title=Google_Sidewiki&amp;action=edit&amp;section=3" title="Edit section: Reception">edit</a><span>]</span></span></h2>
<p>Sidewiki allowed users to interact with a website in ways that the site owner could not control, which upset some website owners. <a href="https://en.wikipedia.org/wiki/Jeff_Jarvis" title="Jeff Jarvis">Jeff Jarvis</a> complained that Sidewiki "takes comments away from my blog and puts them on Google. That sets up Google in channel conflict vs me. It robs my site of much of its value",<sup id="cite_ref-13"><a href="#cite_note-13">[13]</a></sup> and PaidContent noted that "Google is walking a fine line in its efforts to innovate in some areas that have long been the domain of traditional publishers, while not alienating them."<sup id="cite_ref-paid_5-1"><a href="#cite_note-paid-5">[5]</a></sup> PC Magazine commented that Sidewiki could "push site owners to make their forums more appealing on their own, and to enhance sites with no comment area with a space for reader participation."<sup id="cite_ref-pcmag_8-2"><a href="#cite_note-pcmag-8">[8]</a></sup> <a href="https://en.wikipedia.org/wiki/Public_relations" title="Public relations">Public relations</a> professionals saw Sidewiki as another venue that will need managing, but which offered an opportunity to engage with complaints and spot 'hot issues'.<sup id="cite_ref-14"><a href="#cite_note-14">[14]</a></sup> <a href="https://en.wikipedia.org/wiki/Mark_Borkowski" title="Mark Borkowski">Mark Borkowski</a> predicted that "SideWiki is going to challenge PR by providing the masses with the tool for the ultimate expression of people power, something uncontainable that will need constant monitoring... SideWiki will make it impossible to promote one message and not be held to account."<sup id="cite_ref-15"><a href="#cite_note-15">[15]</a></sup> ArsTechnica argued that the comments were of similar value to those on existing sites such as <a href="https://en.wikipedia.org/wiki/Digg" title="Digg">Digg</a> and <a href="https://en.wikipedia.org/wiki/Reddit" title="Reddit">Reddit</a>, and suggested that without the ability found in Wikipedia to delete and restructure material, it was a "glorified comment system".<sup id="cite_ref-arstech_4-1"><a href="#cite_note-arstech-4">[4]</a></sup>
</p>
<h2><span id="See_also">See also</span><span><span>[</span><a href="https://en.wikipedia.org/w/index.php?title=Google_Sidewiki&amp;action=edit&amp;section=4" title="Edit section: See also">edit</a><span>]</span></span></h2>
<ul><li><a href="https://en.wikipedia.org/wiki/Google_SearchWiki" title="Google SearchWiki">Google SearchWiki</a></li></ul>
<h2><span id="References">References</span><span><span>[</span><a href="https://en.wikipedia.org/w/index.php?title=Google_Sidewiki&amp;action=edit&amp;section=5" title="Edit section: References">edit</a><span>]</span></span></h2>
<div>
<ol>
<li id="cite_note-1"><span><b><a href="#cite_ref-1">^</a></b></span> <span><cite id="CITEREFMalik2009">Malik, Om (September 23, 2009). <a rel="nofollow" href="https://gigaom.com/2009/09/23/google-launches-sidewiki-more-like-universal-commenting-system/">"Google Launches Sidewiki — More Like a Universal Commenting System"</a>. <i>gigaom.com</i><span>. Retrieved <span>March 3,</span> 2019</span>.</cite><span title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=unknown&amp;rft.jtitle=gigaom.com&amp;rft.atitle=Google+Launches+Sidewiki+%E2%80%94+More+Like+a+Universal+Commenting+System&amp;rft.date=2009-09-23&amp;rft.aulast=Malik&amp;rft.aufirst=Om&amp;rft_id=https%3A%2F%2Fgigaom.com%2F2009%2F09%2F23%2Fgoogle-launches-sidewiki-more-like-universal-commenting-system%2F&amp;rfr_id=info%3Asid%2Fen.wikipedia.org%3AGoogle+Sidewiki"></span></span>
</li>
<li id="cite_note-2"><span><b><a href="#cite_ref-2">^</a></b></span> <span>Eustace, Alan. (2011-09-02) <a rel="nofollow" href="http://googleblog.blogspot.com/2011/09/fall-spring-clean.html">Official Blog: A fall spring-clean</a>. Googleblog.blogspot.com. Retrieved on 2013-09-04.</span>
</li>
<li id="cite_note-3"><span><b><a href="#cite_ref-3">^</a></b></span> <span><cite><a rel="nofollow" href="http://googleblog.blogspot.com/2009/09/help-and-learn-from-others-as-you.html">"Help and learn from others as you browse the web: Google Sidewiki"</a>. September 23, 2009<span>. Retrieved <span>September 23,</span> 2009</span>.</cite><span title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.atitle=Help+and+learn+from+others+as+you+browse+the+web%3A+Google+Sidewiki&amp;rft.date=2009-09-23&amp;rft_id=http%3A%2F%2Fgoogleblog.blogspot.com%2F2009%2F09%2Fhelp-and-learn-from-others-as-you.html&amp;rfr_id=info%3Asid%2Fen.wikipedia.org%3AGoogle+Sidewiki"></span></span>
</li>
<li id="cite_note-arstech-4"><span>^ <a href="#cite_ref-arstech_4-0"><sup><i><b>a</b></i></sup></a> <a href="#cite_ref-arstech_4-1"><sup><i><b>b</b></i></sup></a></span> <span><cite id="CITEREFPaul2009">Paul, Ryan (September 23, 2009). <a rel="nofollow" href="https://arstechnica.com/web/news/2009/09/google-introduces-sidewiki-invites-users-to-annotate-web.ars">"Google Sidewiki interesting, but real utility unclear"</a>. <i>ArsTechnica</i><span>. Retrieved <span>September 9,</span> 2010</span>.</cite><span title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.jtitle=ArsTechnica&amp;rft.atitle=Google+Sidewiki+interesting%2C+but+real+utility+unclear&amp;rft.date=2009-09-23&amp;rft.aulast=Paul&amp;rft.aufirst=Ryan&amp;rft_id=https%3A%2F%2Farstechnica.com%2Fweb%2Fnews%2F2009%2F09%2Fgoogle-introduces-sidewiki-invites-users-to-annotate-web.ars&amp;rfr_id=info%3Asid%2Fen.wikipedia.org%3AGoogle+Sidewiki"></span></span>
</li>
<li id="cite_note-paid-5"><span>^ <a href="#cite_ref-paid_5-0"><sup><i><b>a</b></i></sup></a> <a href="#cite_ref-paid_5-1"><sup><i><b>b</b></i></sup></a></span> <span><cite id="CITEREFTartakoff2009">Tartakoff, Joseph (September 23, 2009). <a rel="nofollow" href="https://web.archive.org/web/20120325201729/http://paidcontent.org/article/419-googles-latest-ambition-a-universal-commenting-system-for-the-web/">"Google's Latest Ambition: A Universal Commenting System For The Web"</a>. <i>PaidContent</i>. Archived from <a rel="nofollow" href="http://paidcontent.org/article/419-googles-latest-ambition-a-universal-commenting-system-for-the-web/">the original</a> on March 25, 2012<span>. Retrieved <span>September 9,</span> 2010</span>.</cite><span title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.jtitle=PaidContent&amp;rft.atitle=Google%27s+Latest+Ambition%3A+A+Universal+Commenting+System+For+The+Web&amp;rft.date=2009-09-23&amp;rft.aulast=Tartakoff&amp;rft.aufirst=Joseph&amp;rft_id=http%3A%2F%2Fpaidcontent.org%2Farticle%2F419-googles-latest-ambition-a-universal-commenting-system-for-the-web%2F&amp;rfr_id=info%3Asid%2Fen.wikipedia.org%3AGoogle+Sidewiki"></span></span>
</li>
<li id="cite_note-6"><span><b><a href="#cite_ref-6">^</a></b></span> <span><cite id="CITEREFArrington2009">Arrington, Michael (September 23, 2009). <a rel="nofollow" href="https://techcrunch.com/2009/09/23/google-steps-where-many-have-stumbled-sidewiki/">"Google Steps Where Many Have Stumbled: Sidewiki"</a>. <i>TechCrunch</i><span>. Retrieved <span>September 9,</span> 2010</span>.</cite><span title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.jtitle=TechCrunch&amp;rft.atitle=Google+Steps+Where+Many+Have+Stumbled%3A+Sidewiki&amp;rft.date=2009-09-23&amp;rft.aulast=Arrington&amp;rft.aufirst=Michael&amp;rft_id=https%3A%2F%2Ftechcrunch.com%2F2009%2F09%2F23%2Fgoogle-steps-where-many-have-stumbled-sidewiki%2F&amp;rfr_id=info%3Asid%2Fen.wikipedia.org%3AGoogle+Sidewiki"></span></span>
</li>
<li id="cite_note-7"><span><b><a href="#cite_ref-7">^</a></b></span> <span><cite id="CITEREFTurner2009">Turner, Adam (October 2, 2009). <a rel="nofollow" href="http://www.itwire.com/opinion-and-analysis/seeking-nerdvana/28166-wave-hello-to-google-sidewiki-bombing">"Wave hello to Google Sidewiki bombing"</a>. <i>iTWire</i><span>. Retrieved <span>September 9,</span> 2010</span>.</cite><span title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.jtitle=iTWire&amp;rft.atitle=Wave+hello+to+Google+Sidewiki+bombing&amp;rft.date=2009-10-02&amp;rft.aulast=Turner&amp;rft.aufirst=Adam&amp;rft_id=http%3A%2F%2Fwww.itwire.com%2Fopinion-and-analysis%2Fseeking-nerdvana%2F28166-wave-hello-to-google-sidewiki-bombing&amp;rfr_id=info%3Asid%2Fen.wikipedia.org%3AGoogle+Sidewiki"></span></span>
</li>
<li id="cite_note-pcmag-8"><span>^ <a href="#cite_ref-pcmag_8-0"><sup><i><b>a</b></i></sup></a> <a href="#cite_ref-pcmag_8-1"><sup><i><b>b</b></i></sup></a> <a href="#cite_ref-pcmag_8-2"><sup><i><b>c</b></i></sup></a></span> <span><cite id="CITEREFMuchmore2009">Muchmore, Michael (September 25, 2009). <a rel="nofollow" href="https://www.pcmag.com/article2/0,2817,2353282,00.asp">"Hands On with Google Sidewiki: Comments for All"</a>. <i>PC Magazine</i><span>. Retrieved <span>September 9,</span> 2010</span>.</cite><span title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.jtitle=PC+Magazine&amp;rft.atitle=Hands+On+with+Google+Sidewiki%3A+Comments+for+All&amp;rft.date=2009-09-25&amp;rft.aulast=Muchmore&amp;rft.aufirst=Michael&amp;rft_id=https%3A%2F%2Fwww.pcmag.com%2Farticle2%2F0%2C2817%2C2353282%2C00.asp&amp;rfr_id=info%3Asid%2Fen.wikipedia.org%3AGoogle+Sidewiki"></span></span>
</li>
<li id="cite_note-9"><span><b><a href="#cite_ref-9">^</a></b></span> <span><cite id="CITEREFAgarwal2009">Agarwal, Amit (September 24, 2009). <a rel="nofollow" href="http://www.labnol.org/internet/google-sidewiki-without-google-toolbar/9959/">"Use Google Sidewiki without the Google Toolbar"</a>. <i>Digital Inspiration</i>. Labnol<span>. Retrieved <span>September 9,</span> 2010</span>.</cite><span title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=unknown&amp;rft.jtitle=Digital+Inspiration&amp;rft.atitle=Use+Google+Sidewiki+without+the+Google+Toolbar&amp;rft.date=2009-09-24&amp;rft.aulast=Agarwal&amp;rft.aufirst=Amit&amp;rft_id=http%3A%2F%2Fwww.labnol.org%2Finternet%2Fgoogle-sidewiki-without-google-toolbar%2F9959%2F&amp;rfr_id=info%3Asid%2Fen.wikipedia.org%3AGoogle+Sidewiki"></span></span>
</li>
<li id="cite_note-10"><span><b><a href="#cite_ref-10">^</a></b></span> <span><cite id="CITEREFAdaikin2009">Adaikin, Andrey (October 29, 2009). <a rel="nofollow" href="http://chrome.blogspot.com/2009/10/bringing-google-sidewiki-goodness-to.html">"Bringing Google Sidewiki goodness to Google Chrome, Part I"</a>. <i>Google Chrome Blog</i><span>. Retrieved <span>September 9,</span> 2010</span>.</cite><span title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=unknown&amp;rft.jtitle=Google+Chrome+Blog&amp;rft.atitle=Bringing+Google+Sidewiki+goodness+to+Google+Chrome%2C+Part+I&amp;rft.date=2009-10-29&amp;rft.aulast=Adaikin&amp;rft.aufirst=Andrey&amp;rft_id=http%3A%2F%2Fchrome.blogspot.com%2F2009%2F10%2Fbringing-google-sidewiki-goodness-to.html&amp;rfr_id=info%3Asid%2Fen.wikipedia.org%3AGoogle+Sidewiki"></span></span>
</li>
<li id="cite_note-11"><span><b><a href="#cite_ref-11">^</a></b></span> <span><cite id="CITEREFLardinois2009">Lardinois, Frederic (September 23, 2009). <a rel="nofollow" href="https://web.archive.org/web/20100828045821/http://www.readwriteweb.com/archives/google_launches_sidewiki_lets_you_annotate_the_web.php">"Annotate the Web: Google Launches Sidewiki"</a>. <i>ReadWriteWeb</i>. Archived from <a rel="nofollow" href="http://www.readwriteweb.com/archives/google_launches_sidewiki_lets_you_annotate_the_web.php">the original</a> on August 28, 2010<span>. Retrieved <span>September 9,</span> 2010</span>.</cite><span title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.jtitle=ReadWriteWeb&amp;rft.atitle=Annotate+the+Web%3A+Google+Launches+Sidewiki&amp;rft.date=2009-09-23&amp;rft.aulast=Lardinois&amp;rft.aufirst=Frederic&amp;rft_id=http%3A%2F%2Fwww.readwriteweb.com%2Farchives%2Fgoogle_launches_sidewiki_lets_you_annotate_the_web.php&amp;rfr_id=info%3Asid%2Fen.wikipedia.org%3AGoogle+Sidewiki"></span></span>
</li>
<li id="cite_note-12"><span><b><a href="#cite_ref-12">^</a></b></span> <span>
<cite id="CITEREFAlan_Eustace2011">Alan Eustace (September 2, 2011). <a rel="nofollow" href="http://googleblog.blogspot.com/2011/09/fall-spring-clean.html">"A fall spring-clean"</a><span>. Retrieved <span>September 2,</span> 2011</span>.</cite><span title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Abook&amp;rft.genre=unknown&amp;rft.btitle=A+fall+spring-clean&amp;rft.date=2011-09-02&amp;rft.au=Alan+Eustace&amp;rft_id=http%3A%2F%2Fgoogleblog.blogspot.com%2F2011%2F09%2Ffall-spring-clean.html&amp;rfr_id=info%3Asid%2Fen.wikipedia.org%3AGoogle+Sidewiki"></span></span>
</li>
<li id="cite_note-13"><span><b><a href="#cite_ref-13">^</a></b></span> <span><cite id="CITEREFIrvine2009">Irvine, Chris (September 24, 2009). <a rel="nofollow" href="https://www.telegraph.co.uk/technology/google/6224801/Google-Sidewiki-new-tool-lets-anyone-comment-on-webpages.html">"Google Sidewiki: new tool lets anyone comment on webpages"</a>. <i>Daily Telegraph</i><span>. Retrieved <span>September 9,</span> 2010</span>.</cite><span title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.jtitle=Daily+Telegraph&amp;rft.atitle=Google+Sidewiki%3A+new+tool+lets+anyone+comment+on+webpages&amp;rft.date=2009-09-24&amp;rft.aulast=Irvine&amp;rft.aufirst=Chris&amp;rft_id=https%3A%2F%2Fwww.telegraph.co.uk%2Ftechnology%2Fgoogle%2F6224801%2FGoogle-Sidewiki-new-tool-lets-anyone-comment-on-webpages.html&amp;rfr_id=info%3Asid%2Fen.wikipedia.org%3AGoogle+Sidewiki"></span></span>
</li>
<li id="cite_note-14"><span><b><a href="#cite_ref-14">^</a></b></span> <span><cite id="CITEREFLee2009">Lee, Julian (November 13, 2009). <a rel="nofollow" href="http://www.smh.com.au/technology/biz-tech/sidewiki-causes-a-pr-headache-20091113-idlp.html">"Sidewiki causes a PR headache"</a>. <i>Sydney Morning Herald</i><span>. Retrieved <span>September 9,</span> 2010</span>.</cite><span title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.jtitle=Sydney+Morning+Herald&amp;rft.atitle=Sidewiki+causes+a+PR+headache&amp;rft.date=2009-11-13&amp;rft.aulast=Lee&amp;rft.aufirst=Julian&amp;rft_id=http%3A%2F%2Fwww.smh.com.au%2Ftechnology%2Fbiz-tech%2Fsidewiki-causes-a-pr-headache-20091113-idlp.html&amp;rfr_id=info%3Asid%2Fen.wikipedia.org%3AGoogle+Sidewiki"></span></span>
</li>
<li id="cite_note-15"><span><b><a href="#cite_ref-15">^</a></b></span> <span><cite id="CITEREFBorkowski2009">Borkowski, Mark (November 9, 2009). <a rel="nofollow" href="https://www.theguardian.com/media/2009/nov/09/sidewiki-danger-to-pr">"SideWiki changes everything"</a>. <i>The Guardian</i>. PDA – The Digital Content Blog<span>. Retrieved <span>September 9,</span> 2010</span>.</cite><span title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=article&amp;rft.jtitle=The+Guardian&amp;rft.atitle=SideWiki+changes+everything&amp;rft.date=2009-11-09&amp;rft.aulast=Borkowski&amp;rft.aufirst=Mark&amp;rft_id=https%3A%2F%2Fwww.theguardian.com%2Fmedia%2F2009%2Fnov%2F09%2Fsidewiki-danger-to-pr&amp;rfr_id=info%3Asid%2Fen.wikipedia.org%3AGoogle+Sidewiki"></span></span>
</li>
</ol></div>
<h2><span id="External_links">External links</span><span><span>[</span><a href="https://en.wikipedia.org/w/index.php?title=Google_Sidewiki&amp;action=edit&amp;section=6" title="Edit section: External links">edit</a><span>]</span></span></h2>
<ul><li><cite><a rel="nofollow" href="https://www.youtube.com/watch?v=Dgl6k_k5uwg">"Google Sidewiki for Google Toolbar"</a>. <i>Google Toolbar Help</i>. YouTube. September 22, 2009. <a rel="nofollow" href="https://ghostarchive.org/varchive/youtube/20211221/Dgl6k_k5uwg">Archived</a> from the original on December 21, 2021<span>. Retrieved <span>September 9,</span> 2010</span>.</cite><span title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Ajournal&amp;rft.genre=unknown&amp;rft.jtitle=Google+Toolbar+Help&amp;rft.atitle=Google+Sidewiki+for+Google+Toolbar&amp;rft.date=2009-09-22&amp;rft_id=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DDgl6k_k5uwg&amp;rfr_id=info%3Asid%2Fen.wikipedia.org%3AGoogle+Sidewiki"></span></li></ul>

<!-- 
NewPP limit report
Parsed by mw1380
Cached time: 20230625173037
Cache expiry: 1814400
Reduced expiry: false
Complications: [vary‐revision‐sha1, show‐toc]
CPU time usage: 0.689 seconds
Real time usage: 0.820 seconds
Preprocessor visited node count: 2125/1000000
Post‐expand include size: 158770/2097152 bytes
Template argument size: 1806/2097152 bytes
Highest expansion depth: 19/100
Expensive parser function count: 3/500
Unstrip recursion depth: 1/20
Unstrip post‐expand size: 53716/5000000 bytes
Lua time usage: 0.329/10.000 seconds
Lua memory usage: 6920016/52428800 bytes
Number of Wikibase entities loaded: 1/400
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%  540.342      1 -total
 38.93%  210.380      1 Template:Reflist
 26.66%  144.082      1 Template:Google_Inc.
 21.09%  113.966      5 Template:Cite_web
 15.09%   81.519      1 Template:Infobox_software
 13.20%   71.346      1 Template:Infobox
 13.03%   70.416      1 Template:Short_description
 12.71%   68.689     10 Template:Cite_news
  7.27%   39.291      2 Template:Pagetype
  7.01%   37.880      1 Template:Hlist
-->

<!-- Saved in parser cache with key enwiki:pcache:idhash:24447456-0!canonical and timestamp 20230625173036 and revision id 1151201688. Rendering was triggered because: api-parse
 -->
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Writing as a form of thinking (139 pts)]]></title>
            <link>https://lopespm.com/notes/2023/07/02/writing-as-a-form-of-thinking.html</link>
            <guid>36560254</guid>
            <pubDate>Sun, 02 Jul 2023 10:56:43 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://lopespm.com/notes/2023/07/02/writing-as-a-form-of-thinking.html">https://lopespm.com/notes/2023/07/02/writing-as-a-form-of-thinking.html</a>, See on <a href="https://news.ycombinator.com/item?id=36560254">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><p>Large language models (LLM) like ChatGPT triggered a remarkable societal and computational shift that feels comparable to the impact from the initial internet era with its first impressive search engines like Google. LLMs are the toast of the town.</p>

<p>Writing emails, reports, school homework, analysis, code, summaries. The list goes on.</p>

<p>Save from when you would delegate this task to another fellow human, long hours would be passed in the past trying to conjure a piece of text that could communicate something to another entity. Now this can be made at scale, at low cost, with low effort.</p>

<p>Since we are still liable for the results of this tool, i.e. it’s still our name on the email sender, so instead of just sending that email, we might first read that LLM output, interpret it, understand it, and then send it.</p>

<h2 id="more-than-just-text">More than just text</h2>

<p>Text is a form of communication. If something, or someone wrote it for us, certain decisions were made along the way to convey the goal that we gave. Out of the many paths possible to crystallize that piece of knowledge into a piece text, one of them was chosen.</p>

<p>I would claim that something gets lost on that delegation.</p>

<p>The writing process is more than just the production of text. Many time it requires the exploration of different perspectives, thinking deeply and coming to terms that we don’t know enough about a subject and need to learn more about it.</p>

<p>For example, it’s essential for me to have a notebook at hand to take notes during meetings and formal discussions. I write phrases, loose words, make small diagrams, jot down some reminders. Some of them are never to be re-read again, others I revisit to structure them down into a concise structure. Most of all, they help me think about a problem.</p>

<p>Same holds for notes and articles. I start with a cloud of loosely held ideas that are related, which I attempt to refine into a structured form. Similar to the <a href="https://en.wikipedia.org/wiki/Double_Diamond_(design_process_model)">double diamond</a> process.</p>

<p>Same for books. Several times I’ve come to terms that I learned close to nothing about a book read one month before. Or conversations. Or movies. Or experiences.</p>

<p>This is, <a href="https://www.youtube.com/watch?v=otazg3TuPWM">except</a> if I reflected or acted about them. Except if I wrote down my conclusions about them.</p>

<blockquote>
  <p>For me, taking notes helps make sure that I’m really thinking hard about what’s in there. If I disagree with the book, sometimes it takes a long time to read the books because I’m writing so much in the margin</p>

  <p><em>― <a href="https://youtu.be/eTFy8RnUkoU?t=11">Bill Gates</a></em></p>
</blockquote>
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[64bit computing on a budget (152 pts)]]></title>
            <link>https://virtuallyfun.com/2023/07/01/64bit-computing-on-a-budget/</link>
            <guid>36560242</guid>
            <pubDate>Sun, 02 Jul 2023 10:54:46 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://virtuallyfun.com/2023/07/01/64bit-computing-on-a-budget/">https://virtuallyfun.com/2023/07/01/64bit-computing-on-a-budget/</a>, See on <a href="https://news.ycombinator.com/item?id=36560242">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
<p>With all that <a href="https://virtuallyfun.com/2023/05/15/windows-2000-64-bit-for-alpha-axp/">Dec Alpha talk</a>, and how hard it is to get hardware, and how seemingly exclusionary it is, I thought I would try to touch on a more available 64bit ‘risc’ platform, for the masses!</p>
<p>While a couple years ago I had touched on running <a rel="noreferrer noopener" href="https://virtuallyfun.com/2020/07/24/windows-10-on-the-raspberry-pi-4/" data-type="URL" data-id="/2020/07/24/windows-10-on-the-raspberry-pi-4/" target="_blank">Windows 10 on the Raspberry Pi 4</a>, in the brave new world of 2023 getting ahold of a pi4 is expensive, hard to find, and kind of depressive, which lead me to this (old) but exciting project, the <a href="https://renegade-project.tech/en/home" target="_blank" rel="noreferrer noopener">Renegade Project</a>!</p>
<p>Long story short, there exists enough drivers &amp; information to facilitate a port to the Snapdragon 845, a 64bit System On a Chip( SOAC!), meaning that if you have a device with this chip it *can* be slightly possible to install Windows 10 onto it.</p>
<figure><a href="https://renegade-project.tech/en/state"><img decoding="async" width="921" height="428" src="https://virtuallyfun.com/wp-content/uploads/2023/07/renegade-system-matrix.png" alt="" srcset="http://virtuallyfun.com/wp-content/uploads/2023/07/renegade-system-matrix.png 921w, http://virtuallyfun.com/wp-content/uploads/2023/07/renegade-system-matrix-300x139.png 300w, http://virtuallyfun.com/wp-content/uploads/2023/07/renegade-system-matrix-768x357.png 768w, http://virtuallyfun.com/wp-content/uploads/2023/07/renegade-system-matrix-500x232.png 500w" sizes="(max-width: 921px) 100vw, 921px"></a><figcaption>system compatibility matrix, for ants.</figcaption></figure>
<p>Glancing at the system matrix, to me the glaring hole is Charging. 3 systems outright support it, all of them from Xiaomi, the <a href="https://renegade-project.tech/en/devices/xiaomi/polaris">Xiaomi Mix 2s</a>, Xiaomi Mix 3 &amp; the <a href="https://renegade-project.tech/en/devices/xiaomi/beryllium">Xiaomi PocoPhone F1</a>. Looking around eBay to start this adventure I found a PocoPhone F1!</p>
<h2>Getting the Phone</h2>
<figure><a href="https://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-f1-ebay-listing.png"><img decoding="async" loading="lazy" width="901" height="431" src="https://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-f1-ebay-listing.png" alt="" srcset="http://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-f1-ebay-listing.png 901w, http://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-f1-ebay-listing-300x144.png 300w, http://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-f1-ebay-listing-768x367.png 768w, http://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-f1-ebay-listing-500x239.png 500w" sizes="(max-width: 901px) 100vw, 901px"></a></figure>
<p>This seemed like a good start, 29.99, 128GB of flash storage, and I’d later learn 6GB of RAM. The first problem came from Xiaomi. Turns out that the phone was still locked, the seller had neglected to logout from his Xiaomi account. Even worse though he had forgotten his login and password. Calling Xiaomi support was basically worthless. Without unlocking the phone on a reset to root the phone lead me to this:</p>
<div>
<figure><a href="https://virtuallyfun.com/wp-content/uploads/2023/07/locked-pocophone2.jpg"><img decoding="async" loading="lazy" width="384" height="512" src="https://virtuallyfun.com/wp-content/uploads/2023/07/locked-pocophone2.jpg" alt="" srcset="http://virtuallyfun.com/wp-content/uploads/2023/07/locked-pocophone2.jpg 384w, http://virtuallyfun.com/wp-content/uploads/2023/07/locked-pocophone2-225x300.jpg 225w" sizes="(max-width: 384px) 100vw, 384px"></a><figcaption>Locked!</figcaption></figure></div>
<p>I got lucky however after talking to the seller, he agreed to go above and beyond and we were able to unlock the phone together. So everything went well. If you do buy one of these phones used, MAKE SURE TO CHECK THE XIOAMI login id! It has to be unlocked and blank so you can register it and get the unlock. It will require a valid email &amp; phone number + sim for it to send/receive SMS codes.</p>
<p>Access to the site is very up &amp; down, so I archived what <a rel="noreferrer noopener" href="https://archive.org/details/miflash_unlock_en_7.6.602.42" target="_blank">I had downloaded to unlock the phone here</a>. <a href="https://archive.org/details/miflash_unlock_en_7.6.602.42" target="_blank" rel="noreferrer noopener">miflash_unlock_en_7.6.602.42.7z</a></p>
<p>I should add that we’ve cleared the first few hurdles of precuring the device and unlocking it. And I’m glossing over stuff. Getting to this point was not easy and took a week. The unlock process is not intuitive, and I’m sure many phones are sold out there that have their google access wiped, but have not been logged out all the way, or the flash erased. I can’t show you mine as I ended up erasing Android but be aware of this!</p>
<h2>Getting ready for Windows</h2>
<p>Basically on the Android side there is three main modes, the boot, the recovery and the ‘fastboot’ mode. Holding power &amp; down brings you to fastboot, where using the fastboot tool you can load an image from your PC into ram and execute it. <a href="https://github.com/edk2-porting/edk2-msm" target="_blank" rel="noreferrer noopener">EDK2 UEFI firmware</a>, is the first part or the renegade project you’ll encouter. It’s really powerful, allowing you to not only boot into Windows, but it also supports a linux disk target mode, allowing you to partition and access the flash directly from a PC. Naturally this is SUPER dangerous, and <a href="https://archive.org/details/pocophone-f1-modem-files" target="_blank" rel="noreferrer noopener">backup your modem files</a>!</p>
<p>With the phone unlocked softbooting E2DK you can put it into a target disk mode, connect it to a pc and partition away!</p>
<div>
<figure><a href="https://virtuallyfun.com/wp-content/uploads/2023/07/disk-host-mode-reduced.jpg"><img decoding="async" loading="lazy" width="467" height="865" src="https://virtuallyfun.com/wp-content/uploads/2023/07/disk-host-mode-reduced.jpg" alt="" srcset="http://virtuallyfun.com/wp-content/uploads/2023/07/disk-host-mode-reduced.jpg 467w, http://virtuallyfun.com/wp-content/uploads/2023/07/disk-host-mode-reduced-162x300.jpg 162w" sizes="(max-width: 467px) 100vw, 467px"></a><figcaption>disk mode… for ants!</figcaption></figure></div>
<p><a rel="noreferrer noopener" href="https://renegade-project.tech/en/install" target="_blank">The guide</a> (section 1.2) advices pushing the disk tools to the phone booted up in <a rel="noreferrer noopener" href="https://archive.org/download/miflash_unlock_en_7.6.602.42/twrp-3.7.0_9-0-beryllium.img" target="_blank">twrp-3.7.0_9-0-beryllium.img</a>. Honestly its easier to just partition it on your computer. HOWEVER if you were to use Windows, there is a slight issue:</p>
<p><strong><span>The device may no longer be able to boot into fastboot mode</span></strong></p>
<p>I ran into this issue and thought I had bricked my phone. I was actually in the middle of researching how to do a physical hard reset, <a href="https://www.youtube.com/watch?v=IlAaRQBtHKw" target="_blank" rel="noreferrer noopener">and place it into EDL mode</a> (taking it apart and finding which pads to short, when I found this section of the troubleshooting guide, where it’s the partition names. So instead, I ended up doing the partitioning on a Virtual Machine using VMware and Ubuntu.</p>
<pre><code>(parted) print
print
Model: SAMSUNG KLUDG4U1EA-B0C1 (scsi)
Disk /dev/block/sda: 123GB
Sector size (logical/physical): 4096B/4096B
Partition Table: gpt
Disk Flags:

Number  Start   End     Size    File system  Name        Flags
 1      24.6kB  41.0kB  16.4kB               switch
 2      41.0kB  73.7kB  32.8kB               ssd
 3      73.7kB  524kB   451kB                bk01
 4      524kB   786kB   262kB                bk02
 5      786kB   1049kB  262kB                bk03
 6      1049kB  1573kB  524kB                keystore
 7      1573kB  2097kB  524kB                frp
 8      2097kB  4194kB  2097kB               bk04
 9      4194kB  8389kB  4194kB               misc
10      8389kB  16.8MB  8389kB               logfs
11      16.8MB  33.6MB  16.8MB               oops
12      33.6MB  50.3MB  16.8MB               devinfo
13      50.3MB  67.1MB  16.8MB               bk05
14      67.1MB  134MB   67.1MB  ext4         persist
15      134MB   201MB   67.1MB  ext4         persistbak
16      201MB   268MB   67.1MB               logdump
17      268MB   403MB   134MB                minidump
18      403MB   1275MB  872MB   ext4         cust
19      1275MB  1342MB  67.1MB               recovery
20      1342MB  1611MB  268MB   ext4         cache
21      1611MB  123GB   121GB                userdata</code></pre>
<p>Before I did anything, this is what the phone partition table looked like. It’s an exceptional amount. The new parted v 3.0 that is recommended to use, doesn’t support the resize command so I had to manually do the numbers after destroying partition 21.</p>
<p>Originally, I had made a 32Gb partition to keep some Android functionality but somewhere it just stopped booting. But I didn’t care.</p>
<pre><code>rm 21
mkpart userdata ext4 1611MB 32G
mkpart esp fat32 32G 32.5G
set 22 esp on
mkpart win ntfs 32.5GB 123G

21      1611MB  32.0GB  30.4GB  ext4         userdata
22      32.0GB  32.5GB  499MB   fat32        esp         boot, esp
23      32.5GB  123GB   90.5GB  ntfs         win         msftdata</code></pre>
<p>Obviously dont follow this. I’m only providing output as an example.</p>
<p>If I were more patient, I guess I would have dd’d the entire phone to get a full entire backup. But I didn’t get this phone to run Android, so I really don’t care.</p>
<p>There is a LOT of disks being presented to Windows, in case you ever wondered how those 128GB flash devices get sold with only 114GB of user space. </p>
<figure><a href="https://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-f1-disk-partitions.png"><img decoding="async" loading="lazy" width="887" height="108" src="https://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-f1-disk-partitions.png" alt="" srcset="http://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-f1-disk-partitions.png 887w, http://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-f1-disk-partitions-300x37.png 300w, http://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-f1-disk-partitions-768x94.png 768w, http://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-f1-disk-partitions-500x61.png 500w" sizes="(max-width: 887px) 100vw, 887px"></a><figcaption>So many partitions!</figcaption></figure>
<p>And even that 112GB is actually usable!</p>
<p>Remember the system partition needs the boot,esp flags, and the windows partition is msftdata. Also make sure the partition names are either single words, or NO words. Spaces will kill the fastboot mode.</p>
<p>I put all the disks that are presented in offline mode, so I don’t get confused. Make sure you are going to mess with the right volumes when formatting after the partitioning. This is NOT for the novice, it would be easy to not only brick the phone but screw up your existing install. If you have physical disks attached you don’t absolutely need, remove them or put them offline to make sure you don’t screw up.</p>
<p>I used diskpart to select the appropriate volumes and format them.</p>
<pre><code>select disk 8
select volume 5
format quick fs=fat32 label="System"
assign letter="S"
select volume 6
format quick fs=ntfs label="Windows"
assign letter="W"</code></pre>
<p>This isn’t a guide, just a reflection of what I went through.</p>
<p>With the disk now formatted, it’s a matter of selecting an OS to install.</p>
<p>I had really bad luck picking random versions of Windows, so I looked until I could find a confirmed working version in this video, <a rel="noreferrer noopener" href="https://www.youtube.com/watch?v=t81-Ji17fGM" target="_blank">Rodando o Windows 10 ARM nativamente em um Dispositivo Android (Pocophone F1 + UEFI)</a>. Long story short, it’s Windows build 210521-1658 with version <a rel="noreferrer noopener" href="https://github.com/edk2-porting/edk2-msm/releases/tag/v0.4" target="_blank">0.4 of the bootloader</a>. Long story short I messed with LOTS of Windows on ARM driver sets, before I finally had the brave idea to just load it with no drivers:</p>
<div>
<figure><a href="https://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-booted-to-windows.jpg"><img decoding="async" loading="lazy" width="491" height="945" src="https://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-booted-to-windows.jpg" alt="" srcset="http://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-booted-to-windows.jpg 491w, http://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-booted-to-windows-156x300.jpg 156w" sizes="(max-width: 491px) 100vw, 491px"></a><figcaption>booted</figcaption></figure></div>
<p>But that image is far too stale, and expires out very quickly, reducing any useful functionality once it’s connected to the internet. So it’s something that probably could be fixed, but it’s far easier to just grab an image that’s newer.</p>
<p>The x86_64 image I’m using now is 19045.3031, so I guessed to pick something comparable on ARM64. I used something called <a href="https://archive.org/details/19045.3031_arm64_en-us_professional" target="_blank" rel="noreferrer noopener">19045.3031_arm64_en-us_professional</a>, although it too was out of date, but Windows update brought it up to 22H2 19045.3086 . I had tried the downloader tool and apply all the updates offline, but I had issues. I suspect now in retrospect it was drivers.</p>
<p>Another thing I learned the hard way is that some of these images have multiple OS images installed. I guess it’s de-duplication, along with compression, but be sure to index the image first! I accidentally installed a Home version. Yuck.</p>
<pre><code>dism /Get-ImageInfo /imagefile:install.wim

Index : 1
Name : Windows 10 Home
Description : Windows 10 Home
Size : 17,706,743,995 bytes

Index : 4
Name : Windows 10 Pro
Description : Windows 10 Pro
Size : 17,836,320,420 bytes</code></pre>
<p>So just don’t go wildly apply image #1. I wasted too much time on that one.</p>
<p>But in the release I’m using it’s image #1. I checked. Trust me.</p>
<pre><code>dism /apply-image /ImageFile:10.0.21390.1.co_release.210521-1658_arm64fre\install.wim /index:4 /ApplyDir:W:\</code></pre>
<p>The S volume needs to be populated with the UEFI boot files. I had foolishly thought the boot.wim file would include the boot files, but instead bcdboot can set it up based on the location of a Windows install.</p>
<pre><code>bcdboot W:\Windows /s S: /f UEFI</code></pre>
<p>The next thing to do is install the drivers.</p>
<p>I was lucky enough to get some insight into some driver combination to work, and I came up with this much:</p>
<pre>minimal 2210.1-fix
USB beryllium v2.0rc2
FG beryllium v2.0rc2</pre>
<p>The key of course is that there is a minimal set in 2210.1-fix that will bring the system up with working USB. The FG package brings in enough of the power management to know the battery status.</p>
<pre><code>dism /Image:W: /Add-Driver /Driver:drivers /Recurse</code></pre>
<p>The drivers are not signed, so that means we need to change a bunch of boot flags. I also turned on debugging so have Windows dump core files, so you can run analysts on them with <a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/debugger-download-tools" target="_blank" rel="noreferrer noopener">Windgb</a>.</p>
<pre><code>S:
cd S:\EFI\Microsoft\Boot
bcdedit /store BCD /set "{default}" testsigning on
bcdedit /store BCD /set "{default}" nointegritychecks on
bcdedit /store BCD /set "{default}" recoveryenabled no
bcdedit /store BCD /set "{default}" debug on</code></pre>
<p>Of course the catch being that with no drivers loaded it’s in a super basic mode, with no USB, no touch screen, no power management, no wifi no nothing. So it’s a brick. But at least we’ve reproduced enough to show that you can boot Windows.</p>
<p>Sadly, loading all the drives from <a href="https://github.com/edk2-porting/WOA-Drivers/releases/tag/2210.1-fix" target="_blank" rel="noreferrer noopener">2210.1-fix</a> or beryllium <a href="https://github.com/edk2-porting/WOA-Drivers/releases/tag/v2.0rc2" target="_blank" rel="noreferrer noopener">v2.0rc2</a> lead to this:</p>
<figure><a href="https://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-crashed.jpg"><img decoding="async" loading="lazy" width="567" height="408" src="https://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-crashed.jpg" alt="" srcset="http://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-crashed.jpg 567w, http://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-crashed-300x216.jpg 300w, http://virtuallyfun.com/wp-content/uploads/2023/07/pocophone-crashed-417x300.jpg 417w" sizes="(max-width: 567px) 100vw, 567px"></a><figcaption>the cracked glass adds to the feeling.</figcaption></figure>
<p>Add in a much needed OTG adapter and a mouse or keyboard, and you can complete the installation. </p>
<figure><a href="https://virtuallyfun.com/wp-content/uploads/2023/07/Windows-10-on-Surface-scaled-1.jpg"><img decoding="async" loading="lazy" width="592" height="546" src="https://virtuallyfun.com/wp-content/uploads/2023/07/Windows-10-on-Surface-scaled-1.jpg" alt="" srcset="http://virtuallyfun.com/wp-content/uploads/2023/07/Windows-10-on-Surface-scaled-1.jpg 592w, http://virtuallyfun.com/wp-content/uploads/2023/07/Windows-10-on-Surface-scaled-1-300x277.jpg 300w, http://virtuallyfun.com/wp-content/uploads/2023/07/Windows-10-on-Surface-scaled-1-325x300.jpg 325w" sizes="(max-width: 592px) 100vw, 592px"></a></figure>
<p>However, since I left off the majority of the device drivers as I didn’t want to spend forever trying to track it down, I used a random USB to Ethernet adapter and thankfully It just worked!</p>
<figure><a href="https://virtuallyfun.com/wp-content/uploads/2023/07/Windows-10-on-pocophone.png"><img decoding="async" loading="lazy" width="1024" height="597" src="https://virtuallyfun.com/wp-content/uploads/2023/07/Windows-10-on-pocophone-1024x597.png" alt="" srcset="http://virtuallyfun.com/wp-content/uploads/2023/07/Windows-10-on-pocophone-1024x597.png 1024w, http://virtuallyfun.com/wp-content/uploads/2023/07/Windows-10-on-pocophone-300x175.png 300w, http://virtuallyfun.com/wp-content/uploads/2023/07/Windows-10-on-pocophone-768x448.png 768w, http://virtuallyfun.com/wp-content/uploads/2023/07/Windows-10-on-pocophone-500x292.png 500w, http://virtuallyfun.com/wp-content/uploads/2023/07/Windows-10-on-pocophone.png 1282w" sizes="(max-width: 1024px) 100vw, 1024px"></a><figcaption>Accessing the phone over RDP.</figcaption></figure>
<p>I added a fancy USB 3.0 ‘dock’ with USB-C connector that you can plug a charger into, so that not only can the phone stay connected to power, but there is room for the Ethernet. It also has HDMI, perhaps is the drivers were more stable, it could be a viable desktop? And I have what I wanted, which was a non Intel/AMD 64bit platform that is hopefully more reliable than the Alpha64 platform, and maybe something to do some kind of contrast of the past vs future</p>
<p>This was NOT a simple thing to go through. I would be extremely hesitant to advise other people to follow suit. But in the off chance anyone who wants to do it, might have a better idea of what is involved.</p>
<p>Read the <a rel="noreferrer noopener" href="https://renegade-project.tech/en/Troubleshooting" target="_blank">Troubleshooting guide</a> &amp; the <a rel="noreferrer noopener" href="https://renegade-project.tech/en/install" target="_blank">Installation guide</a>. Keep notes! I would have absolutely given up, without keeping notes.</p>
<p>Even simple tracking of disasters like this at least helped me along:</p>
<pre><code>210521-1658<br>10.0.21390.1.co_release.210521-1658_arm64fre</code></pre>
<div>
<div>
<pre><code>boot-beryllium Version 0.4.1.img</code></pre>
<pre><code>boot-beryllium-ebbg Release - 2210.1.img</code></pre>
<pre><code>boot-beryllium-ebbg Release - 2210.1.img

boot-beryllium-ebbg Release - 2210.1.img

boot-beryllium-ebbg Release - 2210.1.img

boot-beryllium-ebbg Release - 2210.1.img</code></pre>
</div>
<div>
<pre><code>no drivers</code></pre>
<pre><code>
no drivers</code></pre>
<pre><code>
v1.1.1


v1.1


FocalTechTouch v2.0rc1


v2.0rc1</code></pre>
</div>
<div>
<pre><code>INTERNAL_POWER_ERROR</code></pre>
<pre><code>
installer


SYSTEM THREAD EXCEPTION NOT HANDLED


SYSTEM THREAD EXCEPTION NOT HANDLED

installer


SYSTEM THREAD EXCEPTION NOT HANDLED</code></pre>
</div>
</div>
<p>Sorry the table doesn’t format well.</p>
<p>TL;DR don’t do it, unless you don’t mind spending too much time on this. Get a used Surface X instead.</p>
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Drastic increase in Tor clients from Germany (237 pts)]]></title>
            <link>https://metrics.torproject.org/userstats-relay-country.html?start=2019-01-01&amp;end=2023-07-02&amp;country=de&amp;events=off</link>
            <guid>36560136</guid>
            <pubDate>Sun, 02 Jul 2023 10:29:55 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://metrics.torproject.org/userstats-relay-country.html?start=2019-01-01&#x26;end=2023-07-02&#x26;country=de&#x26;events=off">https://metrics.torproject.org/userstats-relay-country.html?start=2019-01-01&#x26;end=2023-07-02&#x26;country=de&#x26;events=off</a>, See on <a href="https://news.ycombinator.com/item?id=36560136">Hacker News</a></p>
&lt;Unparsable&gt;]]></description>
        </item>
        <item>
            <title><![CDATA[Entropy: A little understood concept in physics [video] (163 pts)]]></title>
            <link>https://www.youtube.com/watch?v=DxL2HoqLbyA</link>
            <guid>36560104</guid>
            <pubDate>Sun, 02 Jul 2023 10:23:50 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.youtube.com/watch?v=DxL2HoqLbyA">https://www.youtube.com/watch?v=DxL2HoqLbyA</a>, See on <a href="https://news.ycombinator.com/item?id=36560104">Hacker News</a></p>
&lt;Unparsable&gt;]]></description>
        </item>
        <item>
            <title><![CDATA[Flattening ASTs (and Other Compiler Data Structures) (241 pts)]]></title>
            <link>https://www.cs.cornell.edu/~asampson/blog/flattening.html</link>
            <guid>36559346</guid>
            <pubDate>Sun, 02 Jul 2023 08:03:13 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.cs.cornell.edu/~asampson/blog/flattening.html">https://www.cs.cornell.edu/~asampson/blog/flattening.html</a>, See on <a href="https://news.ycombinator.com/item?id=36559346">Hacker News</a></p>
<div id="readability-page-1" class="page"><article>
<figure>
<img src="https://www.cs.cornell.edu/~asampson/media/flattening/normal.png" alt="a normal AST">
<img src="https://www.cs.cornell.edu/~asampson/media/flattening/flat.png" alt="a flat AST">
<figcaption>Normal and flattened ASTs for the expression <code>a * b + c</code>.</figcaption>
</figure>

<p><a href="https://en.wikipedia.org/wiki/Region-based_memory_management">Arenas, a.k.a. regions,</a> are everywhere in modern language implementations.
One form of arenas is both super simple and surprisingly effective for compilers and compiler-like things.
Maybe because of its simplicity, I haven’t seen the basic technique in many compiler courses—or anywhere else in a CS curriculum for that matter.
This post is an introduction to the idea and its many virtues.</p>

<p><em>Arenas</em> or <em>regions</em> mean many different things to different people, so I’m going to call the specific flavor I’m interested in here <em>data structure flattening</em>.
Flattening uses an arena that only holds one type, so it’s actually just a plain array, and you can use array indices where you would otherwise need pointers.
We’ll focus here on flattening abstract syntax trees (ASTs), but the idea applies to any pointer-laden data structure.</p>

<p>To learn about flattening, we’ll build a basic interpreter twice:
first the normal way and then the flat way.
Follow along with the code in <a href="https://github.com/sampsyo/flatcalc">this repository</a>, where you can <a href="https://github.com/sampsyo/flatcalc/compare/main...flat#diff-42cb6807ad74b3e201c5a7ca98b911c5fa08380e942be6e4ac5807f8377f87fc">compare and contrast the two branches</a>.
The key thing to notice is that the changes are pretty small,
but we’ll see that they make a microbenchmark go 2.4× faster.
Besides performance, flattening also brings some ergonomics advantages that I’ll outline.</p>

<h2 id="a-normal-ast">A Normal AST</h2>

<p>Let’s start with the textbook way to represent an AST. Imagine the world’s simplest language of arithmetic expressions, where all you can do is apply the four basic binary arithmetic operators to literal integers. Some “programs” you can write in this language include <code>42</code>, <code>0 + 14 * 3</code>, and <code>(100 - 16) / 2</code>.</p>

<p>Maybe the clearest way to write the AST for this language would be as an ML type declaration:</p>

<div><pre><code><span>type</span> <span>binop</span> <span>=</span> <span>Add</span> <span>|</span> <span>Sub</span> <span>|</span> <span>Mul</span> <span>|</span> <span>Div</span>
<span>type</span> <span>expr</span> <span>=</span> <span>Binary</span> <span>of</span> <span>binop</span> <span>*</span> <span>expr</span> <span>*</span> <span>expr</span>
          <span>|</span> <span>Literal</span> <span>of</span> <span>int</span>
</code></pre></div>

<p>But for this post, we’ll use Rust instead. Here are <a href="https://github.com/sampsyo/flatcalc/blob/c5bbe7bd79f98a3b857f0432d4739a3f4f6241bd/src/main.rs#L10-L24">the equivalent types in Rust</a>:</p>

<div><pre><code><span>enum</span> <span>BinOp</span> <span>{</span> <span>Add</span><span>,</span> <span>Sub</span><span>,</span> <span>Mul</span><span>,</span> <span>Div</span> <span>}</span>
<span>enum</span> <span>Expr</span> <span>{</span>
    <span>Binary</span><span>(</span><span>BinOp</span><span>,</span> <span>Box</span><span>&lt;</span><span>Expr</span><span>&gt;</span><span>,</span> <span>Box</span><span>&lt;</span><span>Expr</span><span>&gt;</span><span>),</span>
    <span>Literal</span><span>(</span><span>i64</span><span>),</span>
<span>}</span>
</code></pre></div>

<p>If you’re not a committed Rustacean, <code>Box&lt;Expr&gt;</code> may look a little weird, but that’s just Rust for “a plain ol’ pointer to an <code>Expr</code>.” In C, we’d write <code>Expr*</code> to mean morally the same thing; in Java or Python or OCaml, it would just be <code>Expr</code> because everything is a reference by default.<sup id="fnref:inline" role="doc-noteref"><a href="#fn:inline" rel="footnote">1</a></sup></p>

<p>With the AST in hand, we can write all the textbook parts of a language implementation, like a <a href="https://github.com/sampsyo/flatcalc/blob/c5bbe7bd79f98a3b857f0432d4739a3f4f6241bd/src/main.rs#L28-L50">parser</a>, a <a href="https://github.com/sampsyo/flatcalc/blob/c5bbe7bd79f98a3b857f0432d4739a3f4f6241bd/src/main.rs#L139-L155">pretty-printer</a>, and an <a href="https://github.com/sampsyo/flatcalc/blob/c5bbe7bd79f98a3b857f0432d4739a3f4f6241bd/src/main.rs#L52-L67">interpreter</a>.
All of them are thoroughly unremarkable.
The whole interpreter is just one method on <code>Expr</code>:</p>

<div><pre><code><span>fn</span> <span>interp</span><span>(</span><span>&amp;</span><span>self</span><span>)</span> <span>-&gt;</span> <span>i64</span> <span>{</span>
    <span>match</span> <span>self</span> <span>{</span>
        <span>Expr</span><span>::</span><span>Binary</span><span>(</span><span>op</span><span>,</span> <span>lhs</span><span>,</span> <span>rhs</span><span>)</span> <span>=&gt;</span> <span>{</span>
            <span>let</span> <span>lhs</span> <span>=</span> <span>lhs</span><span>.interp</span><span>();</span>
            <span>let</span> <span>rhs</span> <span>=</span> <span>rhs</span><span>.interp</span><span>();</span>
            <span>match</span> <span>op</span> <span>{</span>
                <span>BinOp</span><span>::</span><span>Add</span> <span>=&gt;</span> <span>lhs</span><span>.wrapping_add</span><span>(</span><span>rhs</span><span>),</span>
                <span>BinOp</span><span>::</span><span>Sub</span> <span>=&gt;</span> <span>lhs</span><span>.wrapping_sub</span><span>(</span><span>rhs</span><span>),</span>
                <span>BinOp</span><span>::</span><span>Mul</span> <span>=&gt;</span> <span>lhs</span><span>.wrapping_mul</span><span>(</span><span>rhs</span><span>),</span>
                <span>BinOp</span><span>::</span><span>Div</span> <span>=&gt;</span> <span>lhs</span><span>.checked_div</span><span>(</span><span>rhs</span><span>)</span><span>.unwrap_or</span><span>(</span><span>0</span><span>),</span>
            <span>}</span>
        <span>}</span>
        <span>Expr</span><span>::</span><span>Literal</span><span>(</span><span>num</span><span>)</span> <span>=&gt;</span> <span>*</span><span>num</span><span>,</span>
    <span>}</span>
<span>}</span>
</code></pre></div>

<p>My language has keep-on-truckin’ semantics; every expression eventually evaluates to an <code>i64</code>, even if it’s not the number you wanted.<sup id="fnref:arith" role="doc-noteref"><a href="#fn:arith" rel="footnote">2</a></sup></p>

<p>For extra credit, I also wrote a little <a href="https://github.com/sampsyo/flatcalc/blob/c5bbe7bd79f98a3b857f0432d4739a3f4f6241bd/src/main.rs#L118-L136">random program generator</a>. It’s also not all that interesting to look at; it just uses a recursively-increasing probability of generating a literal so it eventually terminates. Using fixed PRNG seeds, the random generator enables some easy <a href="https://github.com/sampsyo/flatcalc/blob/c5bbe7bd79f98a3b857f0432d4739a3f4f6241bd/Makefile#L4">microbenchmarking</a>. By generating and then immediately evaluating an expression, we can measure the performance of AST manipulation without the I/O costs of parsing and pretty-printing.</p>

<p>You can check out <a href="https://github.com/sampsyo/flatcalc">the relevant repo</a> and try it out:</p>

<div><pre><code><span>$ </span><span>echo</span> <span>'(29 * 3) - 9 * 5'</span> | cargo run
<span>$ </span>cargo run gen_interp  <span># Generate and immediately evaluate a random program.</span>
</code></pre></div>

<h2 id="flattening-the-ast">Flattening the AST</h2>

<p>The <em>flattening</em> idea has two pieces:</p>

<ul>
  <li>Instead of allocating <code>Expr</code> objects willy-nilly on the heap, we’ll pack them into a single, contiguous array.</li>
  <li>Instead of referring to children via pointers, <code>Exprs</code> will refer to their children using their indices in that array.</li>
</ul>

<figure>
<img src="https://www.cs.cornell.edu/~asampson/media/flattening/flat.png" alt="the same flat AST from earlier">
</figure>

<p>Let’s look back at the doodle from the top of the post.
We want to use a single <code>Expr</code> array to hold all our AST nodes.
These nodes still need to point to each other; they’ll now do that by referring to “earlier” slots in that array.
Plain old integers will take the place of pointers.</p>

<p>If that plan sounds simple, it is—it’s probably even simpler than you’re thinking.
The main thing we need is an array of <code>Expr</code>s.
I’ll use Rust’s <a href="https://doc.rust-lang.org/rust-by-example/generics/new_types.html">newtype idiom</a> to declare our arena type, <a href="https://github.com/sampsyo/flatcalc/blob/25f10b44252a2191ba6d0b5445f929096ad59361/src/main.rs#L37"><code>ExprPool</code></a>, as a shorthand for an <code>Expr</code> vector:</p>

<div><pre><code><span>struct</span> <span>ExprPool</span><span>(</span><span>Vec</span><span>&lt;</span><span>Expr</span><span>&gt;</span><span>);</span>
</code></pre></div>

<p>To keep things fancy, we’ll also give a <a href="https://github.com/sampsyo/flatcalc/blob/25f10b44252a2191ba6d0b5445f929096ad59361/src/main.rs#L32">name</a> to the plain old integers we’ll use to index into an <code>ExprPool</code>:</p>



<p>The idea is that, everywhere we previously used a pointer to an <code>Expr</code> (i.e., <code>Box&lt;Expr&gt;</code> or sometimes <code>&amp;Expr</code>), we’ll use an <code>ExprRef</code> instead.
<code>ExprRef</code>s are just 32-bit unsigned integers, but by giving them this special name, we’ll avoid confusing them with other <code>u32</code>s.
Most importantly, we need to change the definition of <code>Expr</code> itself:</p>

<div><pre><code> enum Expr {
<span>-    Binary(BinOp, Box&lt;Expr&gt;, Box&lt;Expr&gt;),
</span><span>+    Binary(BinOp, ExprRef, ExprRef),
</span>     Literal(i64),
 }
</code></pre></div>

<p>Next, we need to add utilities to <code>ExprPool</code> to create <code>Expr</code>s (allocation) and look them up (dereferencing).
In my implementation, these little functions are called <code>add</code> and <code>get</code>, and <a href="https://github.com/sampsyo/flatcalc/blob/25f10b44252a2191ba6d0b5445f929096ad59361/src/main.rs#L45-L55">their implementations</a> are extremely boring.
To use them, we need to look over our code and find every place where we create new <code>Expr</code>s or follow a pointer to an <code>Expr</code>.
For example, our <code>parse</code> function <a href="https://github.com/sampsyo/flatcalc/blob/c5bbe7bd79f98a3b857f0432d4739a3f4f6241bd/src/main.rs#L28-L50">used to be a method on <code>Expr</code></a>, but we’ll make it <a href="https://github.com/sampsyo/flatcalc/blob/25f10b44252a2191ba6d0b5445f929096ad59361/src/main.rs#L57-L81">a method on <code>ExprPool</code> instead</a>:</p>

<div><pre><code><span>-fn parse(tree: Pair&lt;Rule&gt;) -&gt; Self {
</span><span>+fn parse(&amp;mut self, tree: Pair&lt;Rule&gt;) -&gt; ExprRef {
</span></code></pre></div>

<p>And where we used to return a newly allocated <code>Expr</code> directly, we’ll now wrap that in <code>self.add()</code> to return an <code>ExprRef</code> instead.
Here’s the <code>match</code> case for constructing a literal expression:</p>

<div><pre><code> Rule::number =&gt; {
     let num = tree.as_str().parse().unwrap();
<span>-    Expr::Literal(num)
</span><span>+    self.add(Expr::Literal(num))
</span> }
</code></pre></div>

<p>Our interpreter <a href="https://github.com/sampsyo/flatcalc/blob/25f10b44252a2191ba6d0b5445f929096ad59361/src/main.rs#L83-L98">gets the same treatment</a>.
It also becomes an <code>ExprPool</code> method, and we have to add <code>self.get()</code> to go from an <code>ExprRef</code> to an <code>Expr</code> we can pattern-match on:</p>

<div><pre><code><span>-fn interp(&amp;self) -&gt; i64 {
</span><span>+fn interp(&amp;self, expr: ExprRef) -&gt; i64 {
</span><span>-    match self {
</span><span>+    match self.get(expr) {
</span></code></pre></div>

<p>That’s about it.
I think it’s pretty cool how few changes are required—see for yourself in <a href="https://github.com/sampsyo/flatcalc/compare/main...flat#diff-42cb6807ad74b3e201c5a7ca98b911c5fa08380e942be6e4ac5807f8377f87fc">the complete diff</a>.
You replace <code>Box&lt;Expr&gt;</code> with <code>ExprRef</code>, insert <code>add</code> and <code>get</code> calls in the obvious places, and you’ve got a flattened version of your code.
Neat!</p>

<h2 id="but-why">But Why?</h2>

<p>Flattened ASTs come with a bunch of benefits.
The classic ones most people cite are all about performance:</p>

<ol>
  <li><strong>Locality.</strong>
Allocating normal pointer-based <code>Expr</code>s runs the risk of <a href="https://en.wikipedia.org/wiki/Fragmentation_(computing)">fragmentation</a>.
Flattened <code>Expr</code>s are packed together in a contiguous region of memory, which is good for <a href="https://en.wikipedia.org/wiki/Locality_of_reference#Types_of_locality">spatial locality</a>.
Your data caches will work better because <code>Expr</code>s are more likely to share a cache line,
and even simple <a href="https://en.wikipedia.org/wiki/Prefetching">prefetchers</a> will do a better job of predicting which <code>Expr</code>s to load before you need them.
<a href="https://dl.acm.org/doi/10.1145/582419.582421">A sufficiently smart memory allocator might achieve the same thing</a>, especially if you allocate the whole AST up front and never add to it, but using a dense array removes all uncertainty.</li>
  <li><strong>Smaller references.</strong>
Normal data structures use pointers for references; on modern architectures, those are always 64 bits.
After flattening, you can use smaller integers—if you’re pretty sure you’ll never need more than 4,294,967,295 AST nodes,
you can get by with 32-bit references, like we did in our example.
That’s a 50% space savings for all your references, which could amount to a substantial overall memory reduction in pointer-heavy data structures like ASTs.
Smaller memory footprints mean less bandwidth pressure and even better spatial locality.
And you might save even more if you can get away with 16- or even 8-bit references for especially small data structures.</li>
  <li><strong>Cheap allocation.</strong>
In flatland, there is no need for a call to <code>malloc</code> every time you create a new AST node.
Instead, provided you pre-allocate enough memory to hold everything, allocation can entail just <a href="https://docs.rs/bumpalo/latest/bumpalo/">bumping the tail pointer</a> to make room for one more <code>Expr</code>.
Again, <a href="https://dl.acm.org/doi/10.1145/582419.582421">a really fast <code>malloc</code> might be hard to compete with</a>—but you basically can’t beat bump allocation on sheer simplicity.</li>
  <li><strong>Cheap deallocation.</strong>
Our flattening setup assumes you never need to free individual <code>Expr</code>s.
That’s probably true for many, although not all, language implementations:
you might build up new subtrees all the time, but you don’t need to reclaim space from many old ones.
ASTs tend to “die together,” i.e., it suffices to deallocate the entire AST all at once.
While freeing a normal AST entails traversing all the pointers to free each <code>Expr</code> individually, you can deallocate a flattened AST in one fell swoop by just freeing the whole <code>ExprPool</code>.</li>
</ol>

<p>I think it’s interesting that many introductions to arena allocation tend to focus on cheap deallocation (#4) as the main reason to do it.
<a href="https://en.wikipedia.org/wiki/Region-based_memory_management">The Wikipedia page</a>, for example, doesn’t (yet!) mention locality (#1 or #2) at all.
You can make an argument that #4 might be the <em>least</em> important for a compiler setting—since ASTs tend to persist all the way to the end of compilation, you might not need to free them at all.</p>

<p>Beyond performance, there are also ergonomic advantages:</p>

<ol>
  <li><strong>Easier lifetimes.</strong>
In the same way that it’s easier for your computer to free a flattened AST all at once, it’s also easier for <em>humans</em> to think about memory management at the granularity of an entire AST.
An AST with <em>n</em> nodes has just one lifetime instead of <em>n</em> for the programmer to think about.
This simplification is quadruply true in Rust, where lifetimes are not just in the programmer’s head but in the code itself.
Passing around a <code>u32</code> is way less fiddly than carefully managing lifetimes for all your <code>&amp;Expr</code>s: your code can rely instead on the much simpler lifetime of the <code>ExprPool</code>.
I suspect this is why the technique is so popular in Rust projects.
As a Rust partisan, however, I’ll argue that the same simplicity advantage applies in C++ or any other language with manual memory management—it’s just latent instead of explicit.</li>
  <li><strong>Convenient deduplication.</strong>
A flat array of <code>Expr</code>s can make it fun and easy to implement <a href="https://en.wikipedia.org/wiki/Hash_consing">hash consing</a> or even simpler techniques to avoid duplicating identical expressions.
For example, if we notice that we are using <code>Literal</code> expressions for the first 128 nonnegative integers a lot, we could reserve the first 128 slots in our <code>ExprPool</code> just for those.
Then, when someone needs the integer literal expression <code>42</code>, our <code>ExprPool</code> don’t need to construct a new <code>Expr</code> at all—we can just produce <code>ExprRef(42)</code> instead.
This kind of game is possible with a normal pointer-based representation too, but it probably requires some kind of auxiliary data structure.</li>
</ol>

<h2 id="performance-results">Performance Results</h2>

<p>Since we have two implementations of the same language, let’s measure those performance advantages.
For a microbenchmark, I randomly generated a program with about 100 million AST nodes and fed it directly into the interpreter (the parser and pretty printer are not involved).
This benchmark is not very realistic: <em>all it does</em> is generate and then immediately run one enormous program.
Some caveats include:</p>

<ul>
  <li>I <a href="https://github.com/sampsyo/flatcalc/blob/2703833615dec76cec4e71419e4073e5bc69dcb0/src/main.rs#L42">reserved enough space</a> in the <code>Vec&lt;Expr&gt;</code> to hold the whole program; in the real world, sizing your arena requires more guesswork.</li>
  <li>I expect this microbenchmark to over-emphasize the performance advantages of cheap allocation and deallocation, because it does very little other work.</li>
  <li>I expect it to under-emphasize the impact of locality, because the program is so big that only a tiny fraction of it will fit the CPU cache at a time.</li>
</ul>

<p>Still, maybe we can learn something.</p>

<figure>
<img src="https://www.cs.cornell.edu/~asampson/media/flattening/standard.png" alt="bar chart comparing the execution time of our normal and flat (and extra-flat) interpreters">
</figure>

<p>I used <a href="https://github.com/sharkdp/hyperfine">Hyperfine</a> to compare the average running time over 10 executions on my laptop.<sup id="fnref:setup" role="doc-noteref"><a href="#fn:setup" rel="footnote">3</a></sup>
Here’s a graph of the running times (please ignore the “extra-flat” bar; we’ll cover that next).
The plot’s error bars show the standard deviation over the 10 runs.
In this experiment, the normal version took 3.1 seconds and the flattened version took 1.3 seconds—a 2.4× speedup.
Not bad for such a straightforward code change!</p>

<p>Of that 2.4× performance advantage, I was curious to know how much comes from each of the four potential advantages I mentioned above.
Unfortunately, I don’t know how to isolate most of these effects—but #4, cheaper deallocation, is especially enticing to isolate.
Since our interpreter is so simple, it seems silly that we’re spending <em>any</em> time on freeing our <code>Expr</code>s after execution finishes—the program is about to shut down anyway, so leaking that memory is completely harmless.</p>

<figure>
<img src="https://www.cs.cornell.edu/~asampson/media/flattening/nofree.png" alt="bar chart comparing versions of our interpreters with and without deallocation">
</figure>

<p>So let’s build versions of both of our interpreters that skip deallocation altogether<sup id="fnref:forget" role="doc-noteref"><a href="#fn:forget" rel="footnote">4</a></sup> and see how much time they save.
Unsurprisingly, the “no-free” version of the flattened interpreter takes about the same amount of time as the standard version, suggesting that it doesn’t spend much time on deallocation anyway.
For the normal interpreter, however, skipping deallocation takes the running time from 3.1 to 1.9 seconds—it was spending around 38% of its time just on freeing memory!</p>

<p>Even comparing the “no-free” versions head-to-head, however, the flattened interpreter is still 1.5× faster than the normal one.
So even if you don’t care about deallocation, the other performance ingredients, like locality and cheap allocation, still have measurable effects.</p>

<h2 id="bonus-exploiting-the-flat-representation">Bonus: Exploiting the Flat Representation</h2>

<p>So far, flattening has happened entirely “under the hood”:
arenas and integer offsets serve as drop-in replacements for normal allocation and pointers.
What could we do if we broke this abstraction layer—if we exploited stuff about the flattened representation that <em>isn’t</em> true about normal AST style?</p>

<figure>
<img src="https://www.cs.cornell.edu/~asampson/media/flattening/flat.png" alt="that same flat AST, yet again">
</figure>

<p>The idea is to build a third kind of interpreter that exploits an extra fact about <code>ExprPool</code>s that arises from the way we built it up.
Because <code>Expr</code>s are immutable, we have to construct trees of them “bottom-up”:
we have to create all child <code>Expr</code>s before we can construct their parent.
If we build the expression <code>a * b</code>, <code>a</code> and <code>b</code> must appear earlier in their <code>ExprPool</code> than the <code>*</code> that refers to them.
Let’s bring that doodle back again: visually, you can imagine that reference arrows always go <em>backward</em> in the array, and data always flows <em>forward</em>.</p>

<p>Let’s write <a href="https://github.com/sampsyo/flatcalc/blob/2703833615dec76cec4e71419e4073e5bc69dcb0/src/main.rs#L100-L124">a new interpreter</a> that exploits this invariant.
Instead of starting at the root of the tree and recursively evaluating each child, we can start at the beginning of the <code>ExprPool</code> and scan from left to right.
This iteration is guaranteed to visit parents after children, so we can be sure that the results for subexpressions will be ready when we need them.
Here’s <a href="https://github.com/sampsyo/flatcalc/blob/2703833615dec76cec4e71419e4073e5bc69dcb0/src/main.rs#L100-L124">the whole thing</a>:</p>

<div><pre><code><span>fn</span> <span>flat_interp</span><span>(</span><span>self</span><span>,</span> <span>root</span><span>:</span> <span>ExprRef</span><span>)</span> <span>-&gt;</span> <span>i64</span> <span>{</span>
    <span>let</span> <span>mut</span> <span>state</span><span>:</span> <span>Vec</span><span>&lt;</span><span>i64</span><span>&gt;</span> <span>=</span> <span>vec!</span><span>[</span><span>0</span><span>;</span> <span>self</span><span>.0</span><span>.len</span><span>()];</span>
    <span>for</span> <span>(</span><span>i</span><span>,</span> <span>expr</span><span>)</span> <span>in</span> <span>self</span><span>.0</span><span>.into_iter</span><span>()</span><span>.enumerate</span><span>()</span> <span>{</span>
        <span>let</span> <span>res</span> <span>=</span> <span>match</span> <span>expr</span> <span>{</span>
            <span>Expr</span><span>::</span><span>Binary</span><span>(</span><span>op</span><span>,</span> <span>lhs</span><span>,</span> <span>rhs</span><span>)</span> <span>=&gt;</span> <span>{</span>
                <span>let</span> <span>lhs</span> <span>=</span> <span>state</span><span>[</span><span>lhs</span><span>.0</span> <span>as</span> <span>usize</span><span>];</span>
                <span>let</span> <span>rhs</span> <span>=</span> <span>state</span><span>[</span><span>rhs</span><span>.0</span> <span>as</span> <span>usize</span><span>];</span>
                <span>match</span> <span>op</span> <span>{</span>
                    <span>BinOp</span><span>::</span><span>Add</span> <span>=&gt;</span> <span>lhs</span><span>.wrapping_add</span><span>(</span><span>rhs</span><span>),</span>
                    <span>BinOp</span><span>::</span><span>Sub</span> <span>=&gt;</span> <span>lhs</span><span>.wrapping_sub</span><span>(</span><span>rhs</span><span>),</span>
                    <span>BinOp</span><span>::</span><span>Mul</span> <span>=&gt;</span> <span>lhs</span><span>.wrapping_mul</span><span>(</span><span>rhs</span><span>),</span>
                    <span>BinOp</span><span>::</span><span>Div</span> <span>=&gt;</span> <span>lhs</span><span>.checked_div</span><span>(</span><span>rhs</span><span>)</span><span>.unwrap_or</span><span>(</span><span>0</span><span>),</span>
                <span>}</span>
            <span>}</span>
            <span>Expr</span><span>::</span><span>Literal</span><span>(</span><span>num</span><span>)</span> <span>=&gt;</span> <span>num</span><span>,</span>
        <span>};</span>
        <span>state</span><span>[</span><span>i</span><span>]</span> <span>=</span> <span>res</span><span>;</span>
    <span>}</span>
    <span>state</span><span>[</span><span>root</span><span>.0</span> <span>as</span> <span>usize</span><span>]</span>
<span>}</span>
</code></pre></div>

<p>We use a dense <code>state</code> table to hold one result value per <code>Expr</code>.
The <code>state[i] = res</code> line fills this vector up whenever we finish an expression.
Critically, there’s no recursion—binary expressions can get the value of their subexpressions by looking them up directly in <code>state</code>.
At the end, when <code>state</code> is completely full of results, all we need to do is return the one corresponding to the requested expression, <code>root</code>.</p>

<p>This “extra-flat” interpreter has two potential performance advantages over the recursive interpreter:
there’s no stack bookkeeping for the recursive calls,
and the linear traversal of the <code>ExprPool</code> could be good for locality.
On the other hand, it has to randomly access a really big <code>state</code> vector, which could be bad for locality.</p>

<figure>
<img src="https://www.cs.cornell.edu/~asampson/media/flattening/standard.png" alt="the same bar chart comparing the execution time for normal, flat, and extra-flat interpreters">
</figure>

<p>To see if it wins overall, let’s return to our bar chart from earlier.
The extra-flat interpreter takes 1.2 seconds, compared to 1.3 seconds for the recursive interpreter for the flat AST.
That’s marginal compared to how much better flattening does on its own than the pointer-based version,
but an 8.2% performance improvement ain’t nothing.</p>

<p>My favorite observation about this technique, due to <a href="https://old.reddit.com/r/ProgrammingLanguages/comments/mrifdr/treewalking_interpreters_and_cachelocality/gumsi2v/">a Reddit comment</a> by <a href="https://craftinginterpreters.com/">Bob Nystrom</a>, is that it essentially reinvents the idea of a <a href="https://en.wikipedia.org/wiki/Bytecode">bytecode</a> interpreter.
The <code>Expr</code> structs are bytecode instructions, and they contain variable references encoded as <code>u32</code>s.
You could make this interpreter even better by swapping out our simple <code>state</code> table for some kind of stack, and then it would <em>really</em> be no different from a bytecode interpreter you might design from first principles.
I just think it’s pretty nifty that “merely” changing our AST data structure led us directly from the land of tree walking to the land of bytecode.</p>

<h2 id="further-reading">Further Reading</h2>

<p>I <a href="https://discuss.systems/@adrian/109990979464062464">asked on Mastodon</a> a while back for pointers to other writing about data structure flattening,
and folks really came through (thanks, everybody!).
Here are some other places it came up in a compilers context:</p>

<ul>
  <li>Mike Pall <a href="http://lua-users.org/lists/lua-l/2009-11/msg00089.html">attributes some of LuaJIT’s performance</a> to its “linear, pointer-free IR.” It’s pointer-free because it’s flattened.</li>
  <li>Concordantly, <a href="https://blog.nelhage.com/post/why-sorbet-is-fast/">a blog post explaining the performance of the Sorbet type-checker for Ruby</a> extols the virtues of using packed arrays and replacing 64-bit pointers with 32-bit indices.</li>
  <li>The Oil shell project has a <a href="https://github.com/oilshell/oil/wiki/Compact-AST-Representation">big collection of links</a> all about “compact AST representation,” much of which boils down to flattening.</li>
</ul>

<p>Beyond just language implementation, similar concepts show up in other performance-oriented domains.
I admit that I understand this stuff less, especially the things from the world of video games:</p>

<ul>
  <li><a href="http://iu-parfunc.github.io/gibbon/">A line of work</a> from Purdue and Indiana is about compiling programs to operate directly on serialized data. <a href="https://drops.dagstuhl.de/opus/volltexte/2017/7273/pdf/LIPIcs-ECOOP-2017-26.pdf">Gibbon</a> in particular is pretty much a translator from “normal”-looking code to flattened implementations.</li>
  <li>Flattening-like ideas appear a lot in <em>data-oriented design</em>, a broadly defined concept that I only partially understand. For example, <a href="https://andrewkelley.me/">Andrew Kelley</a> argues in <a href="https://vimeo.com/649009599#t=850s">a talk on the topic</a> for using indices in place of pointers.</li>
  <li>Check out this <a href="https://manishearth.github.io/blog/2021/03/15/arenas-in-rust/">overview of arena libraries in Rust</a> and its discussion of the ergonomics of arena-related lifetimes.</li>
  <li>Here’s <a href="https://floooh.github.io/2018/06/17/handles-vs-pointers.html">a post comparing handles vs. pointers in game development</a> that advocates for packing homogeneously typed objects into arrays and using indices to refer to them.</li>
  <li>Similar ideas show up in <a href="https://en.wikipedia.org/wiki/Entity_component_system"><em>entity-component systems</em> (ECS)</a>, a big idea from game development that I also don’t completely understand. <a href="https://ajmmertens.medium.com/building-an-ecs-2-archetypes-and-vectorization-fe21690805f9">This post</a> covers many of the same locality-related themes as we did above.</li>
</ul>

<p>After I published this post, many people pointed me toward <a href="https://recursion.wtf/posts/rust_schemes/">a post from last year by Inanna Malick</a> that shows the same technique applied to same kind of toy “calculator” language implemented in Rust.
That post also uses <em>recursion schemes</em>, an elegant idea from the Haskell world that helps abstract over different concrete representations.
I highly recommend checking that post out.</p>



</article></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Tree-Structured Concurrency (119 pts)]]></title>
            <link>https://blog.yoshuawuyts.com/tree-structured-concurrency/</link>
            <guid>36559030</guid>
            <pubDate>Sun, 02 Jul 2023 07:04:25 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://blog.yoshuawuyts.com/tree-structured-concurrency/">https://blog.yoshuawuyts.com/tree-structured-concurrency/</a>, See on <a href="https://news.ycombinator.com/item?id=36559030">Hacker News</a></p>
<div id="readability-page-1" class="page"><article>
    <div itemprop="articleBody" id="markdown">
      <h2 itemprop="headline">
        Tree-Structured Concurrency<br>— 2023-07-01
      </h2>
     
          <ol>
          
              <li>
                  <a href="https://blog.yoshuawuyts.com/tree-structured-concurrency/#what-is-structured-concurrency">what is structured concurrency?</a>
                  
              </li>
          
              <li>
                  <a href="https://blog.yoshuawuyts.com/tree-structured-concurrency/#unstructured-concurrency-an-example">unstructured concurrency: an example</a>
                  
              </li>
          
              <li>
                  <a href="https://blog.yoshuawuyts.com/tree-structured-concurrency/#structured-concurrency-an-example">structured concurrency: an example</a>
                  
              </li>
          
              <li>
                  <a href="https://blog.yoshuawuyts.com/tree-structured-concurrency/#what-s-the-worst-that-can-happen">what's the worst that can happen?</a>
                  
              </li>
          
              <li>
                  <a href="https://blog.yoshuawuyts.com/tree-structured-concurrency/#applying-structured-concurrency-to-your-programs">applying structured concurrency to your programs</a>
                  
              </li>
          
              <li>
                  <a href="https://blog.yoshuawuyts.com/tree-structured-concurrency/#pattern-managed-background-tasks">pattern: managed background tasks</a>
                  
              </li>
          
              <li>
                  <a href="https://blog.yoshuawuyts.com/tree-structured-concurrency/#guaranteeing-structure">guaranteeing structure</a>
                  
              </li>
          
              <li>
                  <a href="https://blog.yoshuawuyts.com/tree-structured-concurrency/#conclusion">conclusion</a>
                  
              </li>
          
          </ol>
      
      <p>For a while now I've been trying to find a good way to explain what structured
concurrency is, and how it applies to Rust. I've come up with zingers such as:
<em>"Structured concurrency is structured programming as applied to concurrent
control-flow primitives"</em>. But that requires me to start explaining what
structured programming is, and suddenly I find myself 2000 words deep into a
concept which seems natural to most people writing programs today <sup><a href="#dijkstra">1</a></sup>.</p>
<p>Instead I want to try something different. In this post I want to provide you
with a practical introduction to structured concurrency. I will do my best to
explain what it is, why it's relevant, and how you can start applying it to your
rust projects today. Structured concurrency is a lens I use in almost all of my
reasoning about async Rust, and I think it might help others too. So let's dive in.</p>
<p><em>This post assumes some familiarity with <a href="https://blog.yoshuawuyts.com/why-async-rust/">async Rust</a> and <a href="https://blog.yoshuawuyts.com/async-cancellation-1/">async cancellation</a>.
If you aren't already, it might be helpful to skim through the earlier posts on
the topic.</em></p>


<p>Structured concurrency is a property of your program. It's not just any
structure, the structure of the program is guaranteed to be a <a href="https://blog.yoshuawuyts.com/graphs/#trees">tree</a> regardless
of how much concurrency is going on internally <sup><a href="#academia">2</a></sup>. A good way to think
about it is that if you could plot the live call-graph of your program as a
series of relationships it would neatly form a tree. No cycles <sup><a href="#recursion">3</a></sup>. No
dangling nodes. Just a single tree.</p>


<figure>
    <img src="https://blog.yoshuawuyts.com/tree-structured-concurrency/tree_plain.jpg" alt="tree">
    <figcaption>
        Fig 1. The arrows point from parent nodes to
        child nodes. It has no cycles. A parent can have multiple children. But
        a child always has a single parent - except for the root node.
    </figcaption>
</figure>
<p>And this structure, at least in async Rust, provides three key properties:</p>
<ul>
<li><strong>Cancellation propagation:</strong> When you drop a future to cancel it, it's
guaranteed that all futures underneath it are also cancelled.</li>
<li><strong>Error propagation:</strong> When an error is created somewhere down in the
call-graph, it can always be propagated up to the callers until there is a
caller who is ready to handle it.</li>
<li><strong>Ordering of operations:</strong> When a function returns, you know it is done doing
work. No surprises that things are still happening long after you thought the
function had completed.</li>
</ul>
<p>These properties put together lead to something called a <strong>"black box model of
execution"</strong>: under a structured model of computing you don't need to know
anything about the inner workings of the functions you're calling, because their
behavior is guaranteed. A function will return when it's done, will cancel all
work when you ask it to, and you'll always receive an error if there is something
which needs handling. And as a result code under this model is <strong>composable</strong>.</p>
<figure>
    <img src="https://blog.yoshuawuyts.com/tree-structured-concurrency/tree_flow.jpg" title="figure 2" alt="tree">
    <figcaption>
        Fig 2. Under structured concurrency every future has a parent,
        cancellation flows downward, and errors flow upward. When a future
        returns, you can be sure it's done doing work. 
    </figcaption>
</figure>
<p>If your model of concurrency is <em>unstructured</em>, then you don't have these
guarantees. So in order to guarantee that say, cancellation is correctly
propagated, you'll need to inspect the inner workings of every function you're
calling. Code under this model is not composable, and requires manual checks and
bespoke solutions. This is both labor-intensive and prone to errors.</p>
<h2 id="unstructured-concurrency-an-example">Unstructured concurrency: an example</h2>
<p>Let's start by implementing a classic concurrency pattern: "race". But rather
than using <em>structured</em> primitives, we can use the staples of unstructured
programming: the venerable <code>task::spawn</code> and <code>channel</code>. The way "race" works is
it takes two futures, and we try and get the output of whichever one completes
first is whose message we read. We could write it something like this:</p>
<pre data-lang="rust"><code data-lang="rust"><span>use </span><span>async_std::{channel, task};
</span><span>
</span><span>let </span><span>(sender0, receiver) = channel::bounded(</span><span>1</span><span>);
</span><span>
</span><span>let</span><span> sender1 = sender0.</span><span>clone</span><span>();
</span><span>task::spawn(async </span><span>move </span><span>{         </span><span>// 👈 Task "C"
</span><span>    task::sleep(Duration::from_millis(</span><span>100</span><span>));
</span><span>    sender1.</span><span>send</span><span>("</span><span>first</span><span>").await;
</span><span>});
</span><span>
</span><span>task::spawn(async </span><span>move </span><span>{         </span><span>// 👈 Task "B"
</span><span>    task::sleep(Duration::from_millis(</span><span>100</span><span>));
</span><span>    sender0.</span><span>send</span><span>("</span><span>second</span><span>").await;
</span><span>});
</span><span>
</span><span>let</span><span> msg = receiver.</span><span>recv</span><span>().await; </span><span>// 👈 Future "A"
</span><span>println!("</span><span>{msg}</span><span>");
</span></code></pre>
<p>While this implements "race" semantics correctly, it doesn't handle
cancellation. If one of the branches completes, we'd ideally like to cancel the
other. And if the containing function is cancelled, both computations should be
cancelled. Because of how we've structured the program neither task is anchored
to a parent future, and so we can't cancel either computation directly. Instead
the solution would be to come up with some design using more channels, anchor
the handles - or we could instead rewrite this using structured primitives.</p>
<figure>
    <img src="https://blog.yoshuawuyts.com/tree-structured-concurrency/race_tasks.jpg" title="figure 3" alt="tree">
    <figcaption>
        Fig 3. You can create a "race" operation by combining tasks and channels. Data
        can flow out of the tasks to the caller. But because the tasks aren't rooted
        in a parent task, cancellation doesn't propagate.
    </figcaption>
</figure>
<h2 id="structured-concurrency-an-example">Structured concurrency: an example</h2>
<p>We can rewrite the example above using structured primitives instead. Rather
than DIY-ing our own "race" implementation using tasks and channels, we should
instead be using a "race" primitive which implements those semantics for us -
and correctly handles cancellation. Using the <a href="http://docs.rs/futures-concurrency">futures-concurrency</a> library we
could do that as follows:</p>
<pre data-lang="rust"><code data-lang="rust"><span>use </span><span>futures_concurrency::prelude::*;
</span><span>use </span><span>async_std::task;
</span><span>
</span><span>let</span><span> c = async {                   </span><span>// 👈 Future "C"
</span><span>    task::sleep(Duration::from_millis(</span><span>100</span><span>));
</span><span>    "</span><span>first</span><span>"
</span><span>};
</span><span>
</span><span>let</span><span> b = async {                   </span><span>// 👈 Future "B"
</span><span>    task::sleep(Duration::from_millis(</span><span>100</span><span>));
</span><span>    "</span><span>second</span><span>"
</span><span>};
</span><span>
</span><span>let</span><span> msg = (c, b).</span><span>race</span><span>().await;    </span><span>// 👈 Future "A"
</span><span>println!("</span><span>{msg}</span><span>");
</span></code></pre>
<p>When one future completes here, the other future is cancelled. And should the
<code>Race</code> future be dropped, then both futures are cancelled. Both futures have a
parent future when executing. Cancellation propagates downwards. And while there
are no errors in this example, if we were working with fallible operations then
early returns would cause the future to complete early - and errors would be
handled as expected.</p>
<figure>
    <img src="https://blog.yoshuawuyts.com/tree-structured-concurrency/race_futures.jpg" title="figure 4" alt="tree">
    <figcaption>
        Fig 4. By using a structured "race" primitive all child futures are rooted in
        a parent future. Which allows both cancellation and errors to propagate. And
        the operation won't return until all child futures have dropped.
    </figcaption>
</figure>
<p>So far we've looked at just the "race" operation, which encodes: <em>"Wait for the
first future to complete, then cancel the other"</em>. But other async concurrency
operations exist as well, such as:</p>
<ul>
<li><strong>join</strong>: wait for all futures to complete.</li>
<li><strong>race_ok</strong>: wait for the first future to complete which returns <code>Ok</code>.</li>
<li><strong>try_join</strong>: wait for all futures to complete, or return early if there is an error.</li>
<li><strong>merge</strong>: wait for all futures to complete, and yield items from a stream as
soon as they're ready.</li>
</ul>
<p>There are a few more such as "zip", "unzip", and "chain" - as well as dynamic
concurrency primitives such as "task group", "fallible task group", and more.
The point is that the set of concurrency <em>primitives</em> is bounded. But they can
be recombined in ways that makes it possible express any form of concurrency you
want. Not unlike how if a programming language supports branching, loops, and
function calls you can encode just about any control-flow logic you want,-
without ever needing to use "goto".</p>
<h2 id="what-s-the-worst-that-can-happen">What's the worst that can happen?</h2>
<p>People sometimes ask: What's the worst that can happen when you don't have
structured concurrency? There are a number of bad outcomes possible, including
but not limited to: data loss, data corruption, and memory leaks.</p>
<p>While Rust guards against <em>data races</em> which fall under the category of "memory
safety", Rust can't protect you from logic bugs. For example: if you execute a
<code>write</code> operation inside of a task whose handle isn't joined, then you'll need
to find some alternate mechanism to guarantee the ordering of that operation in
relation to the rest of the program. If you get that wrong you might
accidentally write to a closed resource and lose data. Or perform an
out-of-order write, and accidentally corrupt a resource <sup><a href="#sql">4</a></sup>. These kinds of bugs
are not in the same class as memory safety bugs. But they are nonetheless
serious, and they can be mitigated through principled API design.</p>

<h2 id="applying-structured-concurrency-to-your-programs">Applying structured concurrency to your programs</h2>
<p><strong>task::spawn</strong></p>
<p>When using or authoring async APIs in Rust, you should ask yourself the following questions to ensure structured concurrency:</p>
<ol>
<li><strong>Cancellation propagation</strong>: If this future or function is dropped, will cancellation propagate to all child futures?</li>
<li><strong>Error propagation</strong>: If an error happens anywhere in this future, can we either handle it directly or surface it to the caller?</li>
<li><strong>Ordering of operations</strong>: When this function returns, will any more work continue to happen in the background?</li>
</ol>
<p>If all of these properties are true, then once the function exits it's done
executing and you're good. This however leads us to a major issue in today's
async ecosystem: neither async-std nor tokio provide a <code>spawn</code> function which is
structured.  If you drop a task handle the task isn't cancelled, but instead it's
detached and will continue to run in the background. This means that
cancellation doesn't automatically propagate across task boundaries, causing it
to be unstructured.</p>
<p>The <a href="https://docs.rs/smol/latest/smol/struct.Task.html">smol</a> library gets closer
though. It has a task implementation which gets us closer to "cancel on
drop"-semantics out of the box. Though it doesn't get us all the way yet because
it doesn't guarantee an ordering of operations. When a smol <code>Task</code> is dropped
the task isn't guaranteed to have been cancelled, all it guarantees is that the
task will be cancelled at some point in the future.</p>
<p><strong>async drop</strong></p>
<p>Which brings us to the biggest piece missing from async Rust's structured
concurrency story: the lack of async Drop in the language. Smol's
tasks have an async
<a href="https://docs.rs/smol/latest/smol/struct.Task.html#method.cancel">cancel</a> method
which only resolves once the task has successfully been cancelled. Ideally we
could call this method in the destructor and wait for it. But in order to do
that today we'd need to block the thread, and that can lead to throughput
issues. No, in practice what we really need for this to work well is async
destructors <sup><a href="#flush">5</a></sup>.</p>

<p><strong>what can you do today?</strong></p>
<p>But while we can't yet trivially fulfill all requirements for async structured
concurrency for async tasks, not all hope is lost. Without async Drop we can
already achieve 2/3 of the requirements for task spawning today. And if you're
using a runtime other than smol, <a href="https://github.com/yoshuawuyts/tasky/blob/fb8a8e7040c7cd68a5e38b895bbd032ded578a3f/src/lib.rs#L41-L75">adapting the spawn method</a> to work like
smol's does is not too much work. But most concurrency doesn't need tasks
because it isn't dynamic. For that you can take a look at the
<a href="http://docs.rs/futures-concurrency">futures-concurrency</a> library which implements composable primitives for
structured concurrency.</p>
<p>If you want to adopt structured concurrency in your codebase today, you can
start by adopting it for non-task-based concurrency. And for task-based
concurrency you can adopt the smol model of task spawning to benefit from most
of the benefits of structured concurrency today. And eventually the hope is we
can add some form of async Drop to the language to close out the remaining
holes.</p>
<h2 id="pattern-managed-background-tasks">Pattern: managed background tasks</h2>
<p>People frequently ask how they can implement "background tasks" under structured
concurrency. This is used in scenarios such as an HTTP request handler which
also wants to submit a piece of telemetry. Rather than blocking sending the
response on the telemetry, it spawns a "background task" to submit the telemetry
in the background, and immediately returns from the request. This can look
something like this:</p>
<pre data-lang="rust"><code data-lang="rust"><span>let mut</span><span> app = tide::new();
</span><span>app.</span><span>at</span><span>("</span><span>/</span><span>").</span><span>post</span><span>(|_| async </span><span>move </span><span>{
</span><span>    task::spawn(async {  </span><span>// 👈 Spawns a background task…
</span><span>        </span><span>let</span><span> _res = </span><span>send_telemetry</span><span>(data, more_data).await;
</span><span>        </span><span>// … what if `res` is an `Err`? How should we handle errors here?
</span><span>    });
</span><span>    Ok("</span><span>hello world</span><span>")   </span><span>// 👈 …and returns immediately after.
</span><span>});
</span><span>app.</span><span>listen</span><span>("</span><span>127.0.0.1:8080</span><span>").await?;
</span></code></pre>
<p>The phrase "background task" seems polite and unobtrusive. But from a structured
perspective it represents a computation without a parent - it is a <em>dangling
task</em>. The core of the pattern we're dealing with is that we want to create a
computation which outlives the lifetime of the request handler. We can resolve
this by rather than creating a dangling task to submit it to a task queue or
task group which outlives the request handler. 
Unlike a dangling task, a <em>task queue</em> or <em>task group</em> preserves structured
concurrency. Where a dangling task doesn't have a parent future and becomes
unreachable, using a task queue we transmit the ownership of a future to a
different object which outlives the current more ephemeral scope.</p>
<p>I've heard people make the argument before that <code>task::spawn</code> is perfectly
structured, as long as you think of it as spawning on some sort of unreachable,
global task pool. But the question shouldn't be whether tasks are spawned on a task
pool, but what the relationship is of those tasks to the rest of the program.
Because we cannot cancel and recreate an unreachable task pool. Nor can we
receive errors from this pool, or wait for all tasks in it to complete. It
doesn't provide the properties we want from structured concurrency - so we
shouldn't consider it structured.</p>
<p>I don't feel like the ecosystem has any great solutions to this yet - in part
limited because we want <a href="https://tmandry.gitlab.io/blog/posts/2023-03-01-scoped-tasks/">"scoped
tasks"</a> which
basically require <a href="https://blog.yoshuawuyts.com/linearity-and-control/">linear
destructors</a> to function.
But <a href="https://docs.rs/async-task-group/latest/async_task_group/">other experiments
exist</a> so we can use
that plus channels to put something together which gives us what we want:</p>
<p><em>⚠️ Note: This code is not considered "good" by the author, and is merely used as an
example to show that this is possible to write today. More design work is
necessary to make this ergonomic ⚠️</em></p>
<pre data-lang="rust"><code data-lang="rust"><span>// Create a channel to send and receive futures over.
</span><span>let </span><span>(sender, receiver) = async_channel::unbounded();
</span><span>
</span><span>// Create a structured task group at the top-level, next to the HTTP server
</span><span>//
</span><span>// If any errors are returned by the spawned tasks, all active tasks are cancelled
</span><span>// and the error is returned by the handle.
</span><span>let</span><span> telemetry_handle = async_task_group::group(|</span><span>group</span><span>| async </span><span>move </span><span>{
</span><span>    </span><span>while let </span><span>Some(telemetry_future) = receiver.</span><span>next</span><span>().await {
</span><span>        group.</span><span>spawn</span><span>(async </span><span>move </span><span>{
</span><span>            telemetry_future.await?;  </span><span>// 👈 Propagate errors upwards
</span><span>            Ok(())
</span><span>        });
</span><span>    }
</span><span>    Ok(group)
</span><span>});
</span><span>
</span><span>// Create an application state for our HTTP server
</span><span>#[</span><span>derive</span><span>(Clone)]
</span><span>struct </span><span>State {
</span><span>    </span><span>sender</span><span>: async_channel::Sender&lt;impl Future&lt;Result&lt;_&gt;&gt;&gt;,
</span><span>}
</span><span>
</span><span>// Create the HTTP server
</span><span>let mut</span><span> app = tide::new();
</span><span>app.</span><span>at</span><span>("</span><span>/</span><span>").</span><span>post</span><span>(|</span><span>req</span><span>: Request&lt;State&gt;| async </span><span>move </span><span>{
</span><span>    state.sender.</span><span>send</span><span>(async {   </span><span>// 👈 Sends a future to the handler loop…
</span><span>        </span><span>send_telemetry</span><span>(data, more_data).await?;
</span><span>        Ok(())
</span><span>    }).await;
</span><span>    Ok("</span><span>hello world</span><span>")           </span><span>// 👈 …and returns immediately after.
</span><span>});
</span><span>
</span><span>// Concurrently execute both the HTTP server and the telemetry handler,
</span><span>// and if either one stops working the other stops too.
</span><span>(app.</span><span>listen</span><span>("</span><span>127.0.0.1:8080</span><span>"), telemetry_handle).</span><span>race</span><span>().await?;
</span></code></pre>
<p>Like I said: we need to do a lot more API work to be able to rival the
convenience of just firing off a dangling task. But what we lack for in API
convenience, we make up for in semantics. Unlike our earlier example this will
correctly propagates cancellation and errors, and every executing future is
owned by a parent future. We could even take things a step further and implement
things like retry-handlers with error quotas on top of this to create a more
resilient system. But hopefully this is enough already to get the idea across of
what we could be doing with this.</p>
<h2 id="guaranteeing-structure">Guaranteeing Structure</h2>
<p>I've been asking myself for a while now: <em>"Would it be possible for Rust to
enforce structured concurrency in the language and libraries?"</em> I don't believe
this is something we guarantee from the language. But it is something <em>can</em>
guarantee for Rust's library code, and make it so most async code is structured
by default.</p>
<p>The reason why I don't believe it's fundamentally possible to guarantee
structure at the language level is because it's possible to express any kind of
program in Rust, which includes unstructured programs. Futures, channels, and
tasks as they exist today are all just regular library types. If we wanted to
enforce structure from the language, we would need to find a way to disallow the
creation of these libraries - and that seems impossible for a general-purpose
language <sup><a href="#structured-state-machine">6</a></sup>.</p>

<p>Instead it seems more practical to me to adopt tree-structured concurrency as
the model we follow for async Rust. Not as a memory-safety guarantee, but as a
design discipline we apply across all of async Rust. APIs which are unstructured
should not be added to the stdlib. And our tooling should be aware that
unstructured code may exist, so it can flag it when it encounters it.</p>
<h2 id="conclusion">Conclusion</h2>
<p>In this post I've shown what (tree-)structured concurrency is, why it's
important for correctness, and how you can apply it in your programs. I hope
that by defining structured concurrency in terms of guarantees about propagation
of errors and cancellation, we can create a practical model for people to
reason about async Rust with.</p>
<p>As <a href="https://opensource.googleblog.com/2023/06/rust-fact-vs-fiction-5-insights-from-googles-rust-journey-2022.html">recently reported by
Google</a>,
async Rust is one of the most difficult aspects of Rust to learn. It seems
likely that the lack of structure in async Rust code today did not help. In
async code today neither cancellation nor errors are guaranteed to propagate.
This means that if you want to reliably compose code, you need to have knowledge
of the inner workings of the code you're using. By adopting a (tree-)structured
model of concurrency these properties can instead be guaranteed from the outset,
which in turn would make Async Rust easier to reason about and teach. Because
<em>"If it compiles it works"</em> should apply to async Rust too.</p>
<p><em>Thanks to Iryna Shestak for illustrating and proof-reading this post.</em></p>

    </div>
  </article></div>]]></description>
        </item>
        <item>
            <title><![CDATA[A Functional Introduction To Computer Science (155 pts)]]></title>
            <link>https://cs.uwaterloo.ca/~plragde/flaneries/FICS/</link>
            <guid>36558759</guid>
            <pubDate>Sun, 02 Jul 2023 06:14:31 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/">https://cs.uwaterloo.ca/~plragde/flaneries/FICS/</a>, See on <a href="https://news.ycombinator.com/item?id=36558759">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><p><span>8.1</span></p><div><p><span>&nbsp;&nbsp;</span><span>&nbsp;&nbsp;<span>← prev</span>&nbsp;&nbsp;<span>up</span>&nbsp;&nbsp;<a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Introduction.html" title="forward to &quot;1 Introduction&quot;" data-pltdoc="x">next →</a></span>&nbsp;</p></div><p>(a flânerie by Prabhakar Ragde)</p><p>This work is licensed under a <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
Please do not post exercise solutions to any public forum
or publicly-accessible software repository.</p><p>This is a complete draft of Part I. For Part II, look <a href="https://cs.uwaterloo.ca/~plragde/flane/FICS2">here</a>.</p><table><tbody><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Introduction.html" data-pltdoc="x">1<span>&nbsp;</span>Introduction</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Introduction.html#%28part._.Required_background%29" data-pltdoc="x">1.1<span>&nbsp;</span>Required background</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Introduction.html#%28part._.Design_philosophy%29" data-pltdoc="x">1.2<span>&nbsp;</span>Design philosophy</a></p></td></tr><tr><td></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Starting_out_with_Racket.html" data-pltdoc="x">2<span>&nbsp;</span>Starting out with Racket</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Starting_out_with_Racket.html#%28part._.Functions_in_mathematics%29" data-pltdoc="x">2.1<span>&nbsp;</span>Functions in mathematics</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Starting_out_with_Racket.html#%28part._.Function_application_in_.Racket%29" data-pltdoc="x">2.2<span>&nbsp;</span>Function application in Racket</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Starting_out_with_Racket.html#%28part._.Dr.Racket_s_.Interactions_window%29" data-pltdoc="x">2.3<span>&nbsp;</span>DrRacket’s Interactions window</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Starting_out_with_Racket.html#%28part._.Function_definitions_in_.Racket%29" data-pltdoc="x">2.4<span>&nbsp;</span>Function definitions in Racket</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Starting_out_with_Racket.html#%28part._.Dr.Racket_s_.Definitions_window%29" data-pltdoc="x">2.5<span>&nbsp;</span>DrRacket’s Definitions window</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Starting_out_with_Racket.html#%28part._.More_types_of_data%29" data-pltdoc="x">2.6<span>&nbsp;</span>More types of data</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Starting_out_with_Racket.html#%28part._.Conditional_expressions%29" data-pltdoc="x">2.7<span>&nbsp;</span>Conditional expressions</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Starting_out_with_Racket.html#%28part._.The_design_recipe%29" data-pltdoc="x">2.8<span>&nbsp;</span>The design recipe</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Starting_out_with_Racket.html#%28part._.An_extended_example%29" data-pltdoc="x">2.9<span>&nbsp;</span>An extended example</a></p></td></tr><tr><td></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Syntax_and_semantics.html" data-pltdoc="x">3<span>&nbsp;</span>Syntax and semantics</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Syntax_and_semantics.html#%28part._.Syntax_and_grammar%29" data-pltdoc="x">3.1<span>&nbsp;</span>Syntax and grammar</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Syntax_and_semantics.html#%28part._.A_semantic_model%29" data-pltdoc="x">3.2<span>&nbsp;</span>A semantic model</a></p></td></tr><tr><td></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Structures.html" data-pltdoc="x">4<span>&nbsp;</span>Structures</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Structures.html#%28part._.Struct.Syn.Sem%29" data-pltdoc="x">4.1<span>&nbsp;</span>Syntax and semantics</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Structures.html#%28part._.Simulating_natural_numbers%29" data-pltdoc="x">4.2<span>&nbsp;</span>Simulating natural numbers</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Structures.html#%28part._.Correctness%29" data-pltdoc="x">4.3<span>&nbsp;</span>Correctness</a></p></td></tr><tr><td></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Lists.html" data-pltdoc="x">5<span>&nbsp;</span>Lists</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Lists.html#%28part._.Sequences%29" data-pltdoc="x">5.1<span>&nbsp;</span>Sequences</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Lists.html#%28part._.Lists_in_.Racket%29" data-pltdoc="x">5.2<span>&nbsp;</span>Lists in Racket</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Lists.html#%28part._.Sets%29" data-pltdoc="x">5.3<span>&nbsp;</span>Sets</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Lists.html#%28part._.Representing_sets_using_ordered_lists%29" data-pltdoc="x">5.4<span>&nbsp;</span>Representing sets using ordered lists</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Lists.html#%28part._.List_abbreviations%29" data-pltdoc="x">5.5<span>&nbsp;</span>List abbreviations</a></p></td></tr><tr><td></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Functional_Abstraction.html" data-pltdoc="x">6<span>&nbsp;</span>Functional Abstraction</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Functional_Abstraction.html#%28part._.A_first_example%29" data-pltdoc="x">6.1<span>&nbsp;</span>A first example</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Functional_Abstraction.html#%28part._.More_functional_abstraction%29" data-pltdoc="x">6.2<span>&nbsp;</span>More functional abstraction</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Functional_Abstraction.html#%28part._.Functions_are_values%29" data-pltdoc="x">6.3<span>&nbsp;</span>Functions are values</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Functional_Abstraction.html#%28part._.Syntax_and_semantics_of_.I.S.L_%29" data-pltdoc="x">6.4<span>&nbsp;</span>Syntax and semantics of ISL+</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Functional_Abstraction.html#%28part._.Local_bindings_and_scope%29" data-pltdoc="x">6.5<span>&nbsp;</span>Local bindings and scope</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Functional_Abstraction.html#%28part._.Still_more_functional_abstraction%29" data-pltdoc="x">6.6<span>&nbsp;</span>Still more functional abstraction</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Functional_Abstraction.html#%28part._.Simplifying_.Racket%29" data-pltdoc="x">6.7<span>&nbsp;</span>Simplifying Racket</a></p></td></tr><tr><td></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Efficient_Representations.html" data-pltdoc="x">7<span>&nbsp;</span>Efficient Representations</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Efficient_Representations.html#%28part._.Unary_representation_reviewed%29" data-pltdoc="x">7.1<span>&nbsp;</span>Unary representation reviewed</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Efficient_Representations.html#%28part._.Binary_representation_introduced%29" data-pltdoc="x">7.2<span>&nbsp;</span>Binary representation introduced</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Efficient_Representations.html#%28part._.Implementing_addition%29" data-pltdoc="x">7.3<span>&nbsp;</span>Implementing addition</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Efficient_Representations.html#%28part._.Space_and_time_analysis%29" data-pltdoc="x">7.4<span>&nbsp;</span>Space and time analysis</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Efficient_Representations.html#%28part._.Representing_integers%29" data-pltdoc="x">7.5<span>&nbsp;</span>Representing integers</a></p></td></tr><tr><td></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Trees.html" data-pltdoc="x">8<span>&nbsp;</span>Trees</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Trees.html#%28part._.From_lists_to_trees%29" data-pltdoc="x">8.1<span>&nbsp;</span>From lists to trees</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Trees.html#%28part._.Braun_trees%29" data-pltdoc="x">8.2<span>&nbsp;</span>Braun trees</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Trees.html#%28part._.Tree-structured_data%29" data-pltdoc="x">8.3<span>&nbsp;</span>Tree-structured data</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Trees.html#%28part._.Binary_search_trees%29" data-pltdoc="x">8.4<span>&nbsp;</span>Binary search trees</a></p></td></tr><tr><td></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Generative_Recursion.html" data-pltdoc="x">9<span>&nbsp;</span>Generative Recursion</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Generative_Recursion.html#%28part._.Greatest_common_divisor%29" data-pltdoc="x">9.1<span>&nbsp;</span>Greatest common divisor</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Generative_Recursion.html#%28part._.Sorting%29" data-pltdoc="x">9.2<span>&nbsp;</span>Sorting</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Generative_Recursion.html#%28part._.Insertion_and_selection_sort%29" data-pltdoc="x">9.2.1<span>&nbsp;</span>Insertion and selection sort</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Generative_Recursion.html#%28part._.Treesort%29" data-pltdoc="x">9.2.2<span>&nbsp;</span>Treesort</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Generative_Recursion.html#%28part._.Quicksort%29" data-pltdoc="x">9.2.3<span>&nbsp;</span>Quicksort</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Generative_Recursion.html#%28part._.Bottom-up_mergesort%29" data-pltdoc="x">9.2.4<span>&nbsp;</span>Bottom-up mergesort</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Generative_Recursion.html#%28part._.Top-down_mergesort%29" data-pltdoc="x">9.2.5<span>&nbsp;</span>Top-down mergesort</a></p></td></tr><tr><td></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Interpreters.html" data-pltdoc="x">10<span>&nbsp;</span>Interpreters</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Interpreters.html#%28part._.Evaluating_arithmetic_expressions%29" data-pltdoc="x">10.1<span>&nbsp;</span>Evaluating arithmetic expressions</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Interpreters.html#%28part._.Adding_local_names%29" data-pltdoc="x">10.2<span>&nbsp;</span>Adding local names</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Interpreters.html#%28part._.Adding_second-class_functions%29" data-pltdoc="x">10.3<span>&nbsp;</span>Adding second-class functions</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Interpreters.html#%28part._.Adding_first-class_functions%29" data-pltdoc="x">10.4<span>&nbsp;</span>Adding first-class functions</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Interpreters.html#%28part._.Interlude__programs_that_don_t_terminate%29" data-pltdoc="x">10.5<span>&nbsp;</span>Interlude: programs that don’t terminate</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Interpreters.html#%28part._.Deferring_substitution%29" data-pltdoc="x">10.6<span>&nbsp;</span>Deferring substitution</a></p></td></tr><tr><td><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Interpreters.html#%28part._.What_s_next_%29" data-pltdoc="x">10.7<span>&nbsp;</span>What’s next?</a></p></td></tr></tbody></table><div><p><span>&nbsp;&nbsp;</span><span>&nbsp;&nbsp;<span>← prev</span>&nbsp;&nbsp;<span>up</span>&nbsp;&nbsp;<a href="https://cs.uwaterloo.ca/~plragde/flaneries/FICS/Introduction.html" title="forward to &quot;1 Introduction&quot;" data-pltdoc="x">next →</a></span>&nbsp;</p></div></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[GPT-Migrate converts repos from one lang/framework to another (195 pts)]]></title>
            <link>https://github.com/0xpayne/gpt-migrate</link>
            <guid>36558032</guid>
            <pubDate>Sun, 02 Jul 2023 03:46:33 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/0xpayne/gpt-migrate">https://github.com/0xpayne/gpt-migrate</a>, See on <a href="https://news.ycombinator.com/item?id=36558032">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text"><h2 tabindex="-1" dir="auto">GPT-Migrate</h2>
<h3 tabindex="-1" dir="auto">◐ &nbsp; Easily migrate your codebase from one framework or language to another. &nbsp; ◑</h3>
<p dir="auto">If you've ever faced the pain of migrating a codebase to a new framework or language, this project is for you.</p>
<details open="">
  <summary>
    
    <span aria-label="Video description GPT-Migrate.mp4">GPT-Migrate.mp4</span>
    <span></span>
  </summary>

  <video src="https://user-images.githubusercontent.com/25165841/250232917-bcc99ce8-99b7-4e3d-a653-f89e163ed825.mp4" data-canonical-src="https://user-images.githubusercontent.com/25165841/250232917-bcc99ce8-99b7-4e3d-a653-f89e163ed825.mp4" controls="controls" muted="muted">

  </video>
</details>

<p dir="auto">Migration is a costly, tedious, and non-trivial problem. Do not trust the current version blindly and please use responsibly. Please also be aware that costs can add up quickly as GPT-Migrate is designed to write (and potentially re-write) the entirety of a codebase.</p>
<p dir="auto">However, with the collective brilliance of the OSS community and the current state of LLMs, it is also a very tractable problem.</p>
<h2 tabindex="-1" dir="auto"><g-emoji alias="zap" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/26a1.png">⚡️</g-emoji> Usage</h2>
<ol dir="auto">
<li>
<p dir="auto">Install Docker and ensure that it's running. It's also recommended that you use at least GPT-4, preferably GPT-4-32k.</p>
</li>
<li>
<p dir="auto">Set your <a href="https://platform.openai.com/account/api-keys" rel="nofollow">OpenAI API key</a> and install the python requirements:</p>
</li>
</ol>
<p dir="auto"><code>export OPENAI_API_KEY=&lt;your key&gt;</code></p>
<p dir="auto"><code>pip install -r requirements.txt</code></p>
<ol start="3" dir="auto">
<li>Run the main script with the target language you want to migrate to:</li>
</ol>
<p dir="auto"><code>python main.py --targetlang nodejs</code></p>
<ol start="4" dir="auto">
<li>(Optional) If you'd like GPT-Migrate to validate the unit tests it creates against your app before it tests the migrated app with them, please have your existing app exposed and use the <code>--sourceport</code> flag.</li>
</ol>
<p dir="auto">By default, this script will execute the flask-nodejs benchmark. You can specify the language, source directory, and many other things using the options guide below.</p>
<h2 tabindex="-1" dir="auto"><g-emoji alias="bulb" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f4a1.png">💡</g-emoji> Options</h2>
<p dir="auto">You can customize the behavior of GPT-Migrate by passing the following options to the <code>main.py</code> script:</p>
<ul dir="auto">
<li>
<p dir="auto"><code>--model</code>: The Large Language Model to be used. Default is <code>"gpt-4-32k"</code>.</p>
</li>
<li>
<p dir="auto"><code>--temperature</code>: Temperature setting for the AI model. Default is <code>0</code>.</p>
</li>
<li>
<p dir="auto"><code>--sourcedir</code>: Source directory containing the code to be migrated. Default is <code>"../benchmarks/flask-nodejs/source"</code>.</p>
</li>
<li>
<p dir="auto"><code>--sourcelang</code>: Source language or framework of the code to be migrated. No default value.</p>
</li>
<li>
<p dir="auto"><code>--sourceentry</code>: Entrypoint filename relative to the source directory. For instance, this could be an <code>app.py</code> or <code>main.py</code> file for Python. Default is <code>"app.py"</code>.</p>
</li>
<li>
<p dir="auto"><code>--targetdir</code>: Directory where the migrated code will live. Default is <code>"../benchmarks/flask-nodejs/target"</code>.</p>
</li>
<li>
<p dir="auto"><code>--targetlang</code>: Target language or framework for migration. Default is <code>"nodejs"</code>.</p>
</li>
<li>
<p dir="auto"><code>--operating_system</code>: Operating system for the Dockerfile. Common options are <code>'linux'</code> or <code>'windows'</code>. Default is <code>'linux'</code>.</p>
</li>
<li>
<p dir="auto"><code>--testfiles</code>: Comma-separated list of files that have functions to be tested. For instance, this could be an <code>app.py</code> or <code>main.py</code> file for a Python app where your REST endpoints are. Include the full relative path. Default is <code>"app.py"</code>.</p>
</li>
<li>
<p dir="auto"><code>--sourceport</code>: (Optional) Port for testing the unit tests file against the original app. No default value.</p>
</li>
<li>
<p dir="auto"><code>--targetport</code>: Port for testing the unit tests file against the migrated app. Default is <code>8080</code>.</p>
</li>
<li>
<p dir="auto"><code>--step</code>: Step to run. Options are <code>'setup'</code>, <code>'migrate'</code>, <code>'test'</code>, <code>'all'</code>. Default is <code>'all'</code>.</p>
</li>
</ul>
<p dir="auto">For example, to migrate a Python codebase to Node.js, you might run:</p>
<div dir="auto" data-snippet-clipboard-copy-content="python main.py --sourcedir /path/to/my-python-app --sourceentry app.py --targetdir /path/to/my-nodejs-app --targetlang nodejs"><pre>python main.py --sourcedir /path/to/my-python-app --sourceentry app.py --targetdir /path/to/my-nodejs-app --targetlang nodejs</pre></div>
<p dir="auto">This will take the Python code in <code>./my-python-app</code>, migrate it to Node.js, and write the resulting code to <code>./my-nodejs-app</code>.</p>
<h4 tabindex="-1" dir="auto">GPT-assisted debugging</h4>
<details open="">
  <summary>
    
    <span aria-label="Video description GPT-Migrate-debugging.mp4">GPT-Migrate-debugging.mp4</span>
    <span></span>
  </summary>

  <video src="https://user-images.githubusercontent.com/25165841/250233075-eff1a535-f40e-42e4-914c-042c69ba9195.mp4" data-canonical-src="https://user-images.githubusercontent.com/25165841/250233075-eff1a535-f40e-42e4-914c-042c69ba9195.mp4" controls="controls" muted="muted">

  </video>
</details>

<h2 tabindex="-1" dir="auto">🤖 How it Works</h2>
<p dir="auto">For migrating a repo from <code>--sourcelang</code> to <code>--targetlang</code>...</p>
<ol dir="auto">
<li>GPT-Migrate first creates a Docker environment for <code>--targetlang</code>, which is either passed in or assessed automatically by GPT-Migrate.</li>
<li>It evaluates your existing code recursively to identify 3rd-party <code>--sourcelang</code> dependencies and selects corresponding <code>--targetlang</code> dependencies.</li>
<li>It recursively rebuilds new <code>--targetlang</code> code from your existing code starting from your designated <code>--sourceentry</code> file. This step can be started from with the <code>--step migrate</code> option.</li>
<li>It spins up the Docker environment with the new codebase, exposing it on <code>--targetport</code> and iteratively debugging as needed.</li>
<li>It develops unit tests using Python's unittest framework, and optionally tests these against your existing app if it's running and exposed on <code>--sourceport</code>, iteratively debugging as needed. This step can be started from with the <code>--step test</code> option.</li>
<li>It tests the new code on <code>--targetport</code> against these unit tests.</li>
<li>It iteratively debugs the code for for you with context from logs, error messages, relevant files, and directory structure. It does so by choosing one or more actions (move, create, or edit files) then executing them. If it wants to execute any sort of shell script (moving files around), it will first ask for clearance. Finally, if at any point it gets stuck or the user ends the debugging loop, it will output directions for the user to follow to move to the next step of the migration.</li>
<li>The new codebase is completed and exists in <code>--targetdir</code>.</li>
</ol>
<h3 tabindex="-1" dir="auto"><g-emoji alias="memo" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f4dd.png">📝</g-emoji> Prompt Design</h3>
<p dir="auto">Subprompts are organized in the following fashion:</p>
<ul dir="auto">
<li><code>HIERARCHY</code>: this defines the notion of preferences. There are 4 levels of preference, and each level prioritized more highly than the previous one.</li>
<li><code>p1</code>: Preference Level 1. These are the most general prompts, and consist of broad guidelines.</li>
<li><code>p2</code>: Preference Level 2. These are more specific prompts, and consist of guidelines for certain types of actions (e.g., best practices and philosophies for writing code).</li>
<li><code>p3</code>: Preference Level 3. These are even more specific prompts, and consist of directions for specific actions (e.g., creating a certain file, debugging, writing tests).</li>
<li><code>p4</code>: Preference Level 4. These are the most specific prompts, and consist of formatting for output.</li>
</ul>
<p dir="auto">Prompts are a combination of subprompts. This concept of tagging and composability can be extended to other properties as well to make prompts even more robust. This is an area we're highly interested in actively exploring.</p>
<h2 tabindex="-1" dir="auto">📈 Performance</h2>
<p dir="auto">GPT-Migrate is currently in development alpha and is not yet ready for production use. For instance, on the relatively simple benchmarks, it gets through "easy" languages like python or javascript without a hitch ~50% of the time, and cannot get through more complex languages like C++ or Rust without some human assistance.</p>
<h2 tabindex="-1" dir="auto">✅ Benchmarks</h2>
<p dir="auto">We're actively looking to build up a robust benchmark repository. If you have a codebase that you'd like to contribute, please open a PR! The current benchmarks were built from scratch: REST API apps which have a few endpoints and dependency files.</p>
<h2 tabindex="-1" dir="auto">📣 Call to Action</h2>
<p dir="auto">We're looking for talented contributors. Whether you have a particular passion about a specific language or framework, want to help in creating a more robust test suite, or generally have interesting ideas on how to make this better, we'd love to have you!</p>
<h2 tabindex="-1" dir="auto">Join the conversation on <a href="https://twitter.com/joshpxyne/status/1675254164165910528" rel="nofollow">Twitter</a>!</h2>
</article>
          </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Salary Negotiation: Make More Money, Be More Valued (104 pts)]]></title>
            <link>https://www.kalzumeus.com/2012/01/23/salary-negotiation/</link>
            <guid>36557679</guid>
            <pubDate>Sun, 02 Jul 2023 02:44:18 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.kalzumeus.com/2012/01/23/salary-negotiation/">https://www.kalzumeus.com/2012/01/23/salary-negotiation/</a>, See on <a href="https://news.ycombinator.com/item?id=36557679">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
    <p>[<strong>Editor’s note</strong>: At nearly 7,000 words, you probably don’t want to try reading this on an iDevice. &nbsp;Bookmark it and come back later.]</p>

<p>Imagine something a wee bit outside your comfort zone. &nbsp;Nothing scandalous: just something you don’t do often, don’t particularly enjoy, and slightly more challenging than “totally trivial.” &nbsp;Maybe reciting poetry while simultaneously standing on one foot.</p>

<p>If I told you I would pay you a hundred thousand dollars if you did five minutes of poetry recital while standing on one foot, would you do it? &nbsp;It’s an absurd image, but play it straight. &nbsp;There is no hidden gotcha here. &nbsp;You won’t be videotaped. &nbsp;Your friends will never see you make a fool of yourself. &nbsp;The revolution will not be YouTubed. &nbsp;The offer is exactly as simple as you think it is: poetry, foot, $100,000.</p>

<p>Would you read poetry for me?</p>

<p><strong>Of course you would.</strong> &nbsp;You’d be screamingly stupid not to. &nbsp;In fact, not only would you read poetry, you’d probably take a poetry class to make sure you did it right, or go to the gym to verify “Yep, sure enough, I can stand on one foot. &nbsp;Phew. &nbsp;Pass me the Shakespeare.” &nbsp;If you couldn’t stand on one foot, you’d fix that, because you know that is much easier than other things you routinely accomplish and you suddenly have a hundred thousand wonderful reasons to learn it, too.</p>

<p>What if you were talking about this at dinner with your friends, and one of them said “Oh, no, I’d never do that. &nbsp;I just don’t do poetry. &nbsp;I’m an engineer. &nbsp;And besides, my father told me that people who stand on one foot look silly. &nbsp;And what do I need $100,000 for anyhow?” &nbsp;You would not clap them on the back and say “Damn straight! &nbsp;Man, poets, always trying to tempt virtuous engineers into their weird poetry-spouting flamingo-standing ways.” &nbsp;You’d say “Dude, it’s five minutes. &nbsp;Heck, I’ll help you practice.”</p>

<p>This is pretty much how I feel every time I talk to my engineering friends about salary negotiation. &nbsp;We overwhelmingly suck at it. &nbsp;We have turned sucking at it into a <em>perverse badge of virtue</em>. &nbsp;We make no affirmative efforts to un-suck ourselves and, to the extent we read about it at all, we read bad advice and repeat it, pretending that this makes us wise.</p>

<p>Dude, it’s five minutes. &nbsp;Let’s un-suck your negotiation.</p>

<p>(New to the blog? &nbsp;Hiya. &nbsp;I generally write as an engineer for engineers. &nbsp;Non-engineers can benefit from many of the same techniques, though the hiring market isn’t nearly as in your favor at the moment as it is for engineers in most major US metro areas.)</p>

<h2 id="why-negotiation-matters">Why Negotiation Matters</h2>

<p>Your salary negotiation — which routinely takes less than 5 minutes to conclude — has an outsized influence on what your compensation is. &nbsp;Compensation can include money or things which are more-or-less fungible replacements for money, but it can also include interesting things which you value from “more time with your family” to “opportunities to do tasks which you find fulfilling” to “perks which make a meaningful difference in your day-to-day quality of life.” &nbsp;That makes your negotiation <strong>five very important minutes</strong>. &nbsp;You generally can’t do a totally bang up job on any five minutes of work this year and have your boss give you an extra $5,000. &nbsp;<strong>You can trivially pick up $5,000 in salary negotiations just by sucking <em>less</em>.</strong></p>

<p>Since salaries are shockingly durable over time, particularly if one is not good at negotiating, you can expect a $5,000 increase in salary to compound with your standard annual read-the-HR-chart-percent raise, cause a similar increase in your 401k contribution (which also compounds), and establish a higher peg for any further jobs you take (if you’re unsavvy and allow these other jobs access to your prior salary history, at any rate). &nbsp;Accordingly, over the next ten years, the value of $5,000 a year extra salary is close to $100k gross, and the value of $15,000 a year extra (very achievable if you’re e.g. a young engineer who doesn’t realize that the hiring market is <em><strong>on fire</strong></em> right now, even outside of tech epicenters like Silicon Valley) is over $100k even net of taxes.</p>

<h2 id="shifting-your-mindset-to-embrace-negotiation">Shifting Your Mindset To Embrace Negotiation</h2>

<p>We’ll discuss tactical advice in a moment, but let’s talk about the psychology of negotiation first. &nbsp;I think that middle class Americans are socialized from a very young age to view negotiation as something that is vaguely disreputable and engaged in only by poor people. &nbsp;Think of the associations you have with the word “haggling”: do you think of a successful young professional talking about thousands of dollars in a brightly lit office? &nbsp;No, you probably think of an old woman arguing over a trivial sum of money in a dirty flea market.</p>

<p>If I were a little more paranoid and a little more Marxist, I’d honestly think that you’re so misinformed about reality that that is almost prima facie evidence of a conspiracy to keep you in the dark about this, to the advantage of people who a) you won’t negotiate with and b) who will feel absolutely no compunctions about negotiating with you. &nbsp;Principally, this will be your employers. &nbsp;People say that your house is the biggest purchase you’ll ever make, but it won’t be the most consequential negotiation. &nbsp;If you’re sane only about 25% or so of your gross income is subject to the results of real estate negotiations. &nbsp;Close to 100% is subject to the results of salary negotiations. &nbsp;Thus, your salary negotiations are probably going to be the most important financial decisions you will ever make. &nbsp;We socialize middle class Americans to go into them unprepared, demotivated, and fearful of success.</p>

<p>The reality is that <strong>rich, successful people negotiate</strong>. &nbsp;(This is one important way in which they get — and stay — rich.) &nbsp;It is an all-day-every-day thing in much of the business world, which is where most rich people get their money.</p>



<p>Salary negotiations are very&nbsp;asymmetrical. &nbsp;&nbsp;Companies know this and routinely exploit it. &nbsp;Job seekers don’t, perhaps because they think doing so would be unfair and the word “exploit” makes them acutely uncomfortable. &nbsp;So we often default by pretending that the employer is evaluating the negotiation like we would. &nbsp;This is not true, and acting like it is true will harm both your interests and the interests of your future employer.</p>

<p>For example, many people’s mental model of employment is that an employee with a $60,000 a year salary costs about $60,000 a year to hire. &nbsp;If they negotiate $65,000 instead, that’s $5,000 extra which has to come from… somewhere. &nbsp;If the negotiation breaks down, then that is $60,000 saved. &nbsp;<strong>This mental model is broken</strong>.</p>

<p>First, get into the habit of seeing employees like employers see them: in terms of fully-loaded costs. &nbsp;To hire someone you need to pay for their salary, true, but you also have taxes, a benefits package, employer contributions to retirement, healthcare, that free soda your HR department loves mentioning in the job ads, and what have you. &nbsp;(Trivia: for a US employer of professionals, the largest component after salary is usually healthcare, followed by payroll taxes.) &nbsp;The fully-loaded costs of employees are much higher than their salary: exactly how much higher depends on your locality’s laws, your benefits package, and a bunch of other HR administrivia, but a reasonable guesstimate is between 150% and 200% of their salary.</p>

<p>The fully loaded cost of an engineer receiving market salaries these days in California or New York is close to $20,000 a month. &nbsp;It is “only” $10,000 a month if they’re receiving a heavily below-market salary, such as if they’re working for a startup. &nbsp;If you have a kid brother who majored in Flemish Dance and got a modest full-time job at a non-profit, his fully-loaded cost is still probably $4,000 a month or more.</p>

<p>This is a roundabout way of telling you that companies are not sensitive to small differences in employee wages because employees are so darned expensive anyhow. &nbsp;You see $5,000 and think “Holy cow, even after taxes that’s a whole new vacation. &nbsp;Five thousand dollars. &nbsp;Five thousand dollars. &nbsp;It would be so very, very greedy of me to ask for five thousand whole dollars.” &nbsp;The HR department sees $5,000 and thinks “Meh, even after we kick in the extra taxes, that is only about 3% of their fully-loaded cost for this year anyhow, or seven hundredths of one percent of that team’s hiring budget. &nbsp;I wonder if the cafeteria has carrot cake today?”</p>

<p><strong>Virtually any amount of money available to you personally is mouse droppings to your prospective employer</strong>. &nbsp;They will not feel offended if you ask for it. &nbsp;(I received a comment that this is untrue for startups by someone today. &nbsp;For a funded startup which has enough engineers to warrant a foosball table, the company payroll is well north of $100,000 a month. &nbsp;Making a new hire is a big commitment, but they still have a lot of flexibility on the &nbsp;details because the details do not shave months off of their runway.)</p>

<p>We’ve been talking about your employer as an abstraction, but in the instant case you’re talking to an actual person. &nbsp;Let’s call him Bob. &nbsp;It is Bob’s job to get you signed with the company as cheaply as possible, but Bob is not super motivated to do so, because <strong>Bob is not spending Bob’s money to hire you</strong>. &nbsp;Bob is spending Bob’s <em>budget</em>. &nbsp;Bob generally does not get large performance incentives for shaving money off of his hiring budget: you get a new Macbook if you convince Bob to give you $5k extra, but Bob gets (if he is anomalously lucky) a dinner at TGIFridays if he convinces you to take $5k less. &nbsp;In fact, there are many organizations (and Bobs) for whom power, status, and money come from asking for <em>more</em> budget every year. &nbsp;If you turn out to be on the expensive side, that is great for Bob, because a) he manages a high-powered peon so he must be a high-powered manager and b) this will help Bob get more budget next quarter. &nbsp;So if you’re worried about what Bob will think of your moral character, or you want to compensate Bob because you feel you owe him for this job opportunity, do Bob a solid and negotiate in a spirited fashion with him.</p>

<p>You don’t owe Bob for giving you this job opportunity, by the way. &nbsp;Internalize this: everyone in this discussion is a businessman. &nbsp;(Some might call themselves “regular employees,” which just means they’re businessmen with self-confidence issues and poor business skills.) &nbsp;If the deal makes economic sense, it will happen. &nbsp;If it doesn’t, firm handshakes will be exchanged, non-specific promises will be uttered, and everyone will forget about this discussion in a matter of hours. &nbsp;You will not be blackballed for negotiating. &nbsp;Bob couldn’t care less and, even if he did care, he has better things to do with his time than worry about a candidate he didn’t hire. &nbsp;Bob is working through a list of a dozen people right now, and his manager Dave is being such a hard case about that project’s schedule, and he’s not sure he can make his daughter’s piano recital, and the cafeteria’s carrot cake was a little dry. &nbsp;Bob is <strong>far, far less invested in this negotiation than you are</strong>.</p>

<h2 id="your-negotiation-started-before-you-applied-to-this-job">Your Negotiation Started Before You Applied To This Job</h2>

<p>Your negotiation doesn’t happen in a vacuum. &nbsp;Generic career advice is a little outside the scope of this post (though I’ve previously written <a href="https://www.kalzumeus.com/2011/10/28/dont-call-yourself-a-programmer/">a bit with engineers in mind</a> that folks from many walks of life tell me was useful), but to make a long story short, many people think job searches go something like this:</p>

<ol>
  <li>See ad for job on Monster.com</li>
  <li>Send in a resume.</li>
  <li>Get an interview.</li>
  <li>Get asked for salary requirements.</li>
  <li>Get offered your salary requirement plus 5%.</li>
  <li>Try to negotiate that offer, if you can bring yourself to.</li>
</ol>

<p>This is an effective strategy for job searching if you enjoy alternating bouts of being unemployed, being poorly compensated, and then treated like a disposable peon. &nbsp;(I served three years as a disposable peon in a Japanese megacorp and might be projecting a tad bit here. &nbsp;Regardless, my loss is your gain.)</p>

<p>You will have much, much better results if your job search looks something more like:</p>

<ol>
  <li>(Optional but recommended) Establish a reputation in your field as someone who delivers measurable results vis-a-vis improving revenue or reducing costs.</li>
  <li>Have a hiring manager talk with you, specifically, about an opening that they want you, specifically, to fill.</li>
  <li>Talk informally (and then possibly formally) and come to the conclusion that this would be a great thing if both sides could come to a mutually fulfilling offer.</li>
  <li>Let them take a stab at what that mutually fulfilling offer would look like.</li>
  <li>Suggest ways that they could improve it such that the path is cleared for you doing that voodoo that you do so well to improve their revenue and/or reduce their costs.</li>
  <li>(Optional) Give the guy hiring you a resume to send to HR, for their records. &nbsp;Nobody will read it, because <strong>resumes are an institution created to mean that no one has to read resumes</strong>. &nbsp;Since no one will read it, we put it in the process where it literally doesn’t matter whether it happens or not, because if you had your job offer contingent on a document that everyone knows no one reads, that would be pretty effing stupid now wouldn’t it.</li>
</ol>

<p>You might think that desirable jobs at well-managed companies (Google, Microsoft, hot startup FooWithTheWhat.ly, etc) have layers and layers of bureaucratic scar tissue (a <a href="http://37signals.com/svn/archives2/dont_scar_on_the_first_cut.php" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://37signals.com']);">great image from 37Signals</a>) to ensure that their hiring will conform to established processes and that offers will not be given to candidates sourced by using informal networks and interpersonal connections. &nbsp;If you believe this, you have a dangerously incomplete mental model of how the world operates. &nbsp;I have a specific recommendation for you to make that model more complete: start talking to people who actually work for those companies and who have hiring authority. &nbsp;Virtually no company has a hiring process which is accurately explained by blog posts about the company. &nbsp;No company anywhere has a hiring process which is accurately explained by their own documents about how the hiring process works.</p>

<p>I won’t give names, but all of the following are companies you’ve heard of:</p>

<ul>
  <li>Ironclad non-compete with an IP assignment provision of major multinational… struck from the contract with four sentences of discussion.</li>
  <li>Major popular tech employer offered desirable employee $X as a salary because “it was the max the HR department allows for that position.” &nbsp;He got hired that week at $2X. &nbsp;All parties — hiring organization, HR, and employee — think they pulled one over on the other participants.</li>
  <li><del>Funny story goes here</del>. I now can’t tell you the funny story, because literally two hours before publication someone emailed me for advice about a situation that he believes is incredibly unjust at his company, and it is exactly the funny story to the letter. &nbsp;Now if I tell you the funny story he might think “Dang, I write Patrick in confidence and it ends up on the blog.” &nbsp;So, no funny story today. &nbsp;Suffice it to say that in my old age I treat Dilbert less as farce and more as documentary.</li>
  <li>“We can’t hire engineers fast enough through our standard processes so, meh, I guess we’ll circumvent them by just tossing $1 million per employee at whomever they currently work for. &nbsp;Who cares, it isn’t <em>my</em> million.”</li>
</ul>

<h2 id="when-does-a-salary-negotiation-happen">When Does A Salary Negotiation Happen?</h2>

<p>Only negotiate salary after you have agreement in principle from someone with hiring authority that, if a mutually acceptable compensation can be agreed upon, you will be hired.</p>

<p>This is really, really important because it has direct implications for your negotiating strategy. &nbsp;First, the company is going to spend a lot of time and effort on getting you to the point of agreement-in-principle. &nbsp;Pretend you’ve gone through six rounds of interviews. &nbsp;(You probably won’t if you get hired on informal networks, because all barriers vanish when important people want a deal to get done, but let me give some advice to someone a little less well-situated.) &nbsp;Do some quick mental math on what that actually cost the company, with reference to “one man-month of an engineer’s time costs $20k” like we discussed earlier. &nbsp;You’ll quickly reach the conclusion that the company has spent thousands of dollars <em>just talking to you</em>, and that doesn’t even count the thousands they spent deciding to talk to you instead of whoever isn’t in the room right now. &nbsp;Walking away from the negotiation means that they lose all that investment. &nbsp;(Yeah, sunk cost fallacy and all, but since people predictably act in this fashion you should, well, predict that they will act in this fashion.) &nbsp;They really <strong>want</strong>&nbsp;to reach an agreement with you.</p>

<p>The second implication is that the inner serf worrying “If I even attempt to negotiate this, the deal will fall through” is worrying for nothing. &nbsp;They’ve got thousands invested in this discussion by this point. &nbsp;They <strong>want</strong> you. &nbsp;The absolute worst outcome of negotiating an offer in good faith is that you will get exactly the contents of that offer. &nbsp;Let me say that again for emphasis: <strong>negotiating never makes (worthwhile) offers worse</strong>. &nbsp;This means you need what political scientists call a commitment strategy: you always, as a matter of policy, negotiate all offers. &nbsp;(In this wide world I’m sure you can find a company who still makes exploding offers, where you get one yay-or-nay and then the offer is gone. &nbsp;You have a simple recourse to them: refuse them and deal with people who are willing to be professionals. &nbsp;You’re not a peasant. &nbsp;Don’t act like one.)</p>

<p>This also means <strong>you do not start negotiating until you already have a Yes-If</strong>. &nbsp;(Yes-If we agree on terms.) &nbsp;Do not start negotiating from No-But. &nbsp;(No-But we might hire you anyway if you’re really, really effing cheap.) &nbsp;You don’t want to work for a No-But for the same reasons that <a href="http://www.joelonsoftware.com/articles/GuerrillaInterviewing3.html" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.joelonsoftware.com']);">smart employers hate hiring candidates who are a No-But</a> (No-But maybe if not on my team, etc). &nbsp;If they’re leaning to not hiring you, you will compromise excessively on negotiation to get them to hire you. &nbsp;Compromising excessively is not the point of the exercise. &nbsp;It is a seller’s market for talent right now: sell to someone who is happy to buy.</p>

<p>This means that <strong>any discussion of compensation prior to hearing Yes-If is premature</strong>. &nbsp;If you’re still at the job interview and you’re talking price&nbsp;<strong>you are doing something wrong</strong>. &nbsp;(Read the room: it is entirely possible that you came for a job interview, finished it, and proceeded directly to a salary negotiation. &nbsp;That’s probably suboptimal, but it is OK. &nbsp;Just don’t give the employer the option of having the schedule be job interview, salary negotiation, and back to job interview if they discover that you have a spine.) &nbsp;The ideal resolution to the job interview is for both sides to be optimistic about the arrangement, and then you close with a warm handshake and “I look forward to receiving your offer by, oh, would tomorrow be enough time for you to run the numbers?”</p>

<p>You then have a high likelihood of doing your salary negotiation over email, which is likely to your advantage versus doing it in real time. &nbsp;Email gives you arbitrary time to prepare your responses. &nbsp;Especially for engineers, you are likely less disadvantaged by email than you are by having an experienced negotiator talking to you.</p>

<h2 id="the-first-rule-is-what-everyone-tells-you-it-is-never-give-a-number-first">The First Rule Is What Everyone Tells You It Is: Never Give A Number First</h2>

<p>Every handbook on negotiation and every blog post will tell you not to give a number first. &nbsp;This advice is almost always right. &nbsp;It is so right, you have to construct crazy hypotheticals to find edge cases where it would not be right.</p>

<p>For example, if your previous salary was set during the dot-com bubble and you are negotiating after the bubble popped, you might mention it to anchor your price higher such that the step down will be less severe than it would be if you engaged in free negotiations unencumbered by the bubbilicious history. &nbsp;Does this sound vaguely disreputable to you? &nbsp;Good. &nbsp;This vaguely disreputable abuse of history is what every employer asking for salary history, salary range, or desired salary is doing. &nbsp;They are all using your previous anomalously low salary — a salary which did not reflect your true market worth, because you were young or inexperienced or unskilled at negotiation or working at a different firm or in another line of work entirely — to justify paying you an anomalously low salary in the future.</p>

<p><strong>Never give a number.</strong></p>

<p>“But Patrick,” you cry. &nbsp;“I don’t want to be <em>difficult</em>.” &nbsp;You’re not being difficult. &nbsp;You’re not doing anything immoral. &nbsp;You’re not being unprofessional. &nbsp;They’re businessmen, sometimes they don’t have all the information they would love to have prior to making a decision. &nbsp;They’ll deal.</p>

<p>They <em>already</em> deal with every employee that they’ve ever had who was not a doormat at negotiations, <strong>which includes essentially all of the employees they really value</strong>. &nbsp;Ramit Sethi (more on him later) introduced me to a concept that he calls Competence Triggers: basically, if you have to judge someone’s skill based on a series of brief interactions, you’re going to pattern match their behavior against other people who you like. &nbsp;When people with hiring authority think of winners, they think of <em>people like them</em> who live and breathe this business thing. &nbsp;They negotiate things as a matter of course: that is a major portion of the value they bring to the company. &nbsp;Volunteering a number when asked says the same thing to people with hiring authority that flunking FizzBuzz says to an engineer: this person may be a wonderful snowflake in other regards, but on the thing I care about, they’re catastrophically incompetent. &nbsp;It will also cause them to retroactively question competencies they’d previously credited you with.</p>

<p>I have literally heard that feedback, in so many words, from folks with whom I’ve had successful business dealings. &nbsp;(A funny in hindsight story: I cost myself five figures with a single email. &nbsp;The particulars are boring, but suffice it to say I fairly recently made a wet-behind-the-ears-engineer error in quoting a client. &nbsp;He noticed. &nbsp;So did my bank statement. &nbsp;My bank statement kept quiet, but the client opined that it made him think less of me until we actually got to work together.)</p>

<p>So anyhow, you may well hear reasons why you should give a number.</p>

<p><strong>Objection</strong>: “I really need a number to move the process forward.”</p>

<p><strong>What you should think</strong>: “You’re lying to me to attempt to get me to compromise my negotiating position.”</p>

<p><strong>What you should say</strong>: “I’m more concerned at the moment with talking to you about discovering whether we’re a mutual fit. &nbsp;If we’re a great fit, then I can be flexible on the numbers with you and you can be flexible on the numbers with me. &nbsp;If we’re not a great fit, then the numbers are ultimately irrelevant, because your company only hires A players and I only work at roles I would be an A player at.”</p>

<p>(Don’t talk like that normally? &nbsp;Fine then, talk like yourself, but say substantially the same things. &nbsp;Engineers overestimate how different we really are from business people: we say “10x engineer,” they say “A player,” but at the end of the day we believe that there are vast differences in productivity between workers. &nbsp;OK, gut check: is this something we actually believe to be true or just something we wish for? &nbsp;If it is actually your best guess about the state of reality, that has immediate news-you-can-use implications about how you should conduct your life.)</p>



<p><strong>Objection</strong>: “This form needs a number.”</p>

<p><strong>What you should think</strong>: “You’re lying to me to attempt to get me to compromise my negotiating position.”</p>

<p><strong>What you should say</strong>: “Give me git access and I’ll fix it in a jiffy! &nbsp;<em>both people laugh</em> No, seriously, speaking, I’m more concerned at the moment with discovering whether we’re a mutual fit… &nbsp;Oh, it’s physically impossible? &nbsp;Put in $1 then to get the ball rolling, and we’ll circle back to this later.”</p>



<p><strong>Objection</strong>: “We want to figure out whether you’re an appropriate candidate for the position.”</p>

<p><strong>What you should think</strong>: “You’re lying to me to attempt to get me to compromise my negotiating position.”</p>

<p><strong>What you should say</strong>: “It’s so important to me that this is a good mutual fit for us. &nbsp;Let’s talk about why I’m a great fit for this position: I know you’re concerned about $FILL_IN_THE_BLANK. &nbsp;In addition to my previous successes doing it, I have some great ideas for what I’d do about that if I was working at your company. &nbsp;Would you like to drill into those or is there another job area you’re more concerned about to start with?”</p>



<p><strong>Objection</strong>: “I’m sorry, great try at a dodge there, but I just can’t go forward without a number.”</p>

<p><strong>What you should think</strong>: “You’re lying to me to attempt to get me to compromise my negotiating position.”</p>

<p><strong>What you should say (if you’re an engineer): “</strong>Well, you know, I would hate to have to walk away from the negotiation over this. &nbsp;Working with your company looked like it would have been such a wonderful opportunity. &nbsp;I hear the hiring market is super-tight right now, would you like me to introduce you to other candidates? &nbsp;Maybe we can shave a couple of months off of you filling this position.”</p>

<p><strong>What you should say (if you’re not an engineer)</strong>: “Damn, I guess I should have studied engineering.”</p>

<p><strong>What you should say (if you’re a little put out by that comment)</strong>: “Well, you know, salary is only one component of the total compensation package. &nbsp;In terms of total compensation, we’re probably looking at something like $FILL_IN_NUMBER_HERE.” &nbsp;(Suggested calculation: take the package value from your last company and add 5~10%. &nbsp;If you don’t know how to calculate the value of your compensation package, <em>learn that</em>, but as a rough guesstimate salary + 30 ~ 50% for full-time employees in professional roles and the multiplier tends to scale up as your base salary scales up.)</p>

<p>P.S. I double majored in making things and making things up. &nbsp;The joking comes from a place of love. &nbsp;OK, love and&nbsp;schadenfreude, in solution with each other.</p>

<h2 id="listen-to-what-people-tell-you-repeat-it-back-to-them">Listen To What People Tell You. &nbsp;Repeat It Back To Them.</h2>

<p>Properly run negotiations are not jockeying contests, they’re persuasive&nbsp;exercises. &nbsp;(We’ll give the company a pass on the “what’s your number?” question because it is an established social ritual that they get one free pass at screwing you. &nbsp;You still don’t have to cooperate with it, though.) &nbsp;You know what people find persuasive? &nbsp;Their own words. &nbsp;People love their own words. &nbsp;When you talk to them, you should use their own words. &nbsp;Seriously, watch the eyes light up.</p>

<p>Did the solicitation for the job say “We are seeking someone with strong skills at scaling traffic in a fast-moving environment”? &nbsp;Pick out the key words. &nbsp;Scaling traffic. &nbsp;Fast-moving environment. &nbsp;“Scaling traffic” doesn’t sound like how I’d phrase it if I were writing or speaking for myself, but if you’ve just described your need to me as scaling traffic, by golly I will tell you how great I am at scaling traffic. &nbsp;Reinterpret or rephrase the (true!) bits of your own story such that it fits the narrative framework which they have conveniently told you that they are going to respond to. &nbsp;Did you previously work at a small business which was unencumbered by lots of process? &nbsp;Sounds like a fast-moving environment, right? &nbsp;Call it <em>exactly</em> that, then.</p>

<p><strong>Micro-tip</strong>: Take notes during job interviews and salary negotiations. &nbsp;It’s easy: go to the convenience store before the job interview, buy a writing instrument and a $1 notebook, jot down occasional notes when appropriate.</p>

<p><em>Can I do that?!</em>&nbsp; Of course you can. &nbsp;Do you know anyone who you’ve ever thought “Man, I thought they were competent, but then it turned out they had a notebook so I had to write them off?” &nbsp;No. &nbsp;Taking notes says “I’m attentive and detail-oriented and I care about what you say.” &nbsp;(Make sure you can take notes without playing with your pen or otherwise appearing to fidget.) &nbsp;In terms of specific things that should get your pen moving, among others, I would focus on specific words they use and concerns they have so that you can come back to them later in the conversation. &nbsp;Numbers are another good thing to hit the notebook, because numbers should only ever trend in a direction of “Better to you,” so you don’t want to do something stupid like saying “So how many days of vacation was that again?” and let a 24 suddenly become a 20. &nbsp;(You might think “I’m going to write down the offer so I have proof of it for later.” &nbsp;Get offers written, that goes hopefully without saying, but get it written&nbsp;<em>by them</em>&nbsp;and/or follow-up the discussion with an email recapping the important points and asking if you understood them correctly. &nbsp;Your notes will not convince their HR&nbsp;apparatus&nbsp;to honor the agreement in event of a retroactive miscommunication, but an email from their decisionmaker likely will.)</p>

<p>People say the&nbsp;damnedest&nbsp;things. &nbsp;For example, someone might spontaneously volunteer during a job interview that they’ve been interviewing for the position for six months. &nbsp;(None of my clients would ever say that, of course, but then again one would hope none of their consultants would chop five figures off their own invoice with an email.) &nbsp;If they say the position has been open for six months, take a note of that. &nbsp;During the salary negotiation, if they have a pricing objection, one of your first responses should be “I appreciate that this is a little more money than you might have been thinking about, but this is an opportunity to get this position filled without <em>delaying your business by another six months</em>. &nbsp;What is the value of that six months of execution to you?” &nbsp;(Conversely, don’t say stupid things during job interviews such as “I need this job because…” &nbsp;You never need a job. &nbsp;Being needy means that the party who is not needy has automatic leverage over you: your <a href="http://en.wikipedia.org/wiki/Best_alternative_to_a_negotiated_agreement" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://en.wikipedia.org']);">BATNA</a> to the negotiation is very poor. &nbsp;Instead of being needy, aim for “I’m enthusiastic about the opportunity with working with you, assuming we can come to mutually satisfactory terms.”)</p>

<p><strong>Micro-tip</strong>: Notice how often I say “We” and variations on “mutual win.” &nbsp;Those work pretty well. &nbsp;The only thing better than “We” is “You” (and variants), because people care a heck of a lot more about their problems than about your problems. &nbsp;(This advice is stolen shamelessly from <a href="http://www.amazon.com/How-Win-Friends-Influence-People/dp/1439167346" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.amazon.com']);">Dale Carnegie</a>.) &nbsp;This means that a) you should talk about their problems, concerns, and wishes and b) you should guard against your own natural tendency to bring up irrelevant things like your own problems, which typically will not help you sell the decisionmaker on adopting the mutual win you’re proposing. &nbsp;Similarly, I generally try to phrase things positively rather than score debating points. &nbsp;(“You just said X, but that was contradicted by your earlier statement Y, which means…” wins debating points but does not win friends and influence people. &nbsp;You might try something like “Good good, but taking into account your earlier concerns about Y…”)</p>

<h2 id="research-research-research">Research, Research, Research</h2>

<p>Many people will tell you that you should familiarize yourself with the approximate salary range for the position in your region. &nbsp;This advice is easy to act on (go to a salary aggregation site, guess what “the position” is, pray that this gives you a better number than rand(40000,120000)), but it leaves a lot to be desired. &nbsp;It is 2012. &nbsp;Facebook and LinkedIn exist. &nbsp;You should, before any job interview, have intimate knowledge of the target company. &nbsp;Prospective peers within the company are one obvious way to get it. &nbsp;So are ex-employees, folks who’ve had dealings with them professionally, etc. &nbsp;Key things you want to learn:</p>

<ul>
  <li>What do they value?</li>
  <li>Who do they value within the company? &nbsp;(Roles? &nbsp;Titles? &nbsp;Groups?)</li>
  <li>What does the career path look like for successful people within the company?</li>
  <li>Roughly speaking, how generous are they with regard to axes that you care about?</li>
  <li>Do they have any compensation levers which are anomalously easy to operate? &nbsp;(For example, if you asked around, you might hear a few people say that a particular firm pushes back modestly on out-of-band increases in salary but they’ll give in-the-money option grants like candy.)</li>
  <li>All the fuzzy stuff: what’s the corporate culture like? &nbsp;Yadda yadda.</li>
</ul>

<p>You can even bring a lot of these questions to the job interview, which is (again) prior to the negotiation. &nbsp;(Maybe not “So are you guys tightwads?” but culture-esque questions like “What are the projects this company thinks are really key to its future and how would a motivated person go about getting on them?” are both a) totally fair game and b) will win you brownie points just for asking. &nbsp;Similarly, a lot of employees will, out of company loyalty, attempt to sell you on taking the job with the company by trading you very useful information.)</p>

<p>The more you know, the more options you have when doing negotiation, because you’ll have more things and more motivational things which you can offer in exchange for things you want. &nbsp;It will also help you avoid making mistakes like e.g. getting into a rigid classification system where the classification you’re aiming at will make forward advancement towards your goals very difficult. &nbsp;(Example: there are some companies where Product and QA are run like separate fiefdoms which haven’t forgotten the most recent war, and in those companies getting hired as an engineer may not be a career enhancing move if you like making things for a living. &nbsp;There are other companies where people cross-function in those responsibilities all the time and applying for a job advertising as “Support Engineer” makes lateral moves onto customer-facing projects trivial. &nbsp;You can find which one you’re applying to by taking any engineer out for coffee.)</p>

<h2 id="new-information-is-valuable-and-can-be-traded-for-things-you-want">New Information Is Valuable And Can Be Traded For Things You Want</h2>

<p>There was a <a href="http://rachelbythebay.com/w/2012/01/21/notfree/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://rachelbythebay.com']);">post</a> recently on Hacker News about someone’s experience with a job offer from Google. &nbsp;They wanted more money. &nbsp;The recruiters offered to think it over, and came back with the reply that Google’s food benefit was worth a significant amount of money, with a calculation to back it up. &nbsp;That is a pretty brilliant reply. &nbsp;Google’s food benefit is about as old as the company. &nbsp;Approximately all people wanting to work at Google are aware of its existence. &nbsp;However, the explicit calculation of what it is worth is new, so if you bring up that calculation, by implication you’re offering newly found value to the negotiation. &nbsp;This successfully convinces people that they didn’t really need that extra money. &nbsp;It is so successful at this that Google recruiters apparently have this entire interaction scripted, since multiple people report having the exact same experience.</p>

<p>You should steal this tactic. &nbsp;You are an expert in your own skill set, life story, and (ideally) value you can create for the company. &nbsp;However, the person you are talking to is not. &nbsp;If they ever resist about something which you want, consider reaching into the treasure chest that they are buying mostly blind and revealing one of the many glittering jewels inside. &nbsp;They are going to get them all anyhow if they buy the chest, but each one you bring out decreases the perceived risk of buying it and therefor increases its perceived value.</p>

<p><strong>Company</strong>: We can’t see our way to $88,000.</p>

<p><strong>Applicant</strong>: Well, I know you do a significant amount of business with your online store. &nbsp;At my last company, I increased sales by 3% by $YADDA_YADDA. &nbsp;What would a 1% increase in sales be worth to you?</p>

<p><strong>Company</strong>: Well, I don’t have that figure in front of me, but…</p>

<p><strong>Applicant</strong>: Would it be safe to say “millions of dollars”?</p>

<p><strong>Company</strong>: That sounds about right, yeah.</p>

<p><strong>Applicant</strong>: Great, I can’t wait to get started. &nbsp;Getting me that extra $4,000 would make this a much easier decision. &nbsp;Considering that this is conceivably worth millions to you, we’d be silly not to do business with each other.</p>

<p><strong>Company</strong>: I’ll see what I can do.</p>

<p><strong>Applicant</strong>: Let me help give you some options! &nbsp;[See below.]</p>

<p>(This hypothetical applicant is doing well on the negotiation but apparently needs to do more research on what conversion optimization specialists can get away with charging these days. &nbsp;Here, let me help: six figure salary with all the usual perks as an employee, “senior engineer project rates” through “you might not believe me if I told you” as a consultant.)</p>

<p>Anyhow, simply by bringing attention to something which was hopefully already in bold print on their resume, they just increased their perceived value to the company, thus justifying the company moving a lever which (again) the company isn’t really sensitive to at the end of the day.</p>

<h2 id="you-have-a-multi-dimensional-preference-set-use-it">You Have A Multi-Dimensional Preference Set. &nbsp;Use It.</h2>

<p>Don’t overly focus on your salary number. &nbsp;It is important (of course), but there are many parts of your compensation package, and many more things that you value. &nbsp;Should you and the other party reach an impasse on any part of it, offer to table that part of the discussion (to be returned to later) and bring up a different topic. &nbsp;You can then trade improvements for concessions (or apparent concessions) on the earlier topic.</p>

<p><strong>Employer</strong>: “We were thinking $80,000.”</p>

<p><strong>Applicant</strong>: “$80,000 is interesting (*) but not quite where we need to be to get this done. &nbsp;Do you have any flexibility on that number?”</p>

<p><strong>Employer</strong>: “I think I can convince HR to approve $84,000 but that is the best I can do.”</p>

<p><strong>Applicant</strong>: “I appreciate that. &nbsp;$84,000, huh. &nbsp;Well, it isn’t quite what I had in mind, but the right package offer could make that attractive. &nbsp;How much vacation comes with the package?”</p>

<p><strong>Employer</strong>: “20 days a year.”</p>

<p><strong>Applicant</strong>: “If you could do 24 days a year, I could compromise on $84,000.”</p>

<p><strong>Employer</strong>: “I think I can do that.”</p>

<p>For those keeping score at home: the applicant never gives up anything but the employer will walk away feeling he got a good deal.</p>

<p><strong>* Micro-tip</strong>: “Interesting” is a wonderful word: it is positive and non-commital at the same time. &nbsp;If they tell you a number, tell them it is an “interesting” number, not a “wonderful” number.</p>

<p>Hopping around the offer also helps you defuse common negotiating tactics like “I have to go to $EXTERNAL_AUTHORITY to get approval of that.” &nbsp;(This is in the negotiation playbook, because it works well: it injects an automatic delay in the process, and gives you a scapegoat for refusing a request while not being guilty of the refusal yourself. &nbsp;You should strongly consider having an $EXTERNAL_AUTHORITY of your own. &nbsp;Significant others work well. &nbsp;Note that in the US your would-be employer is legally prohibited from breathing about the subject of your marital status, so something like “We’ll have to talk that over” or “That sounds reasonable, but I’ll have to run it by the family” has the dual virtues of being a socially acceptable reason to delay any major decision while also being equally available to unattached young’uns. &nbsp;I talk shop with my family all the time. &nbsp;I’ll certainly continue discussing employment with my family after it includes my&nbsp;fiancee, too.)</p>

<p>Anyhow, say your decisionmaker says that approving deviations from the company’s salary structure is outside of his discretion and those evil ogres in HR will likely deny his request. &nbsp;That’s fine. &nbsp;Express sympathy with him, because he just said he wants to give you more but can’t, then refocus the discussion on things which are within his personal authority. &nbsp;(Vacation days, work hours, project assignments, travel opportunities, professional development opportunities, and the like are good areas to probe at.) &nbsp;You can then use the unspent “You wanted to do something nice for me” obligation which he just acknowledged on one of the things which he has authority to grant you.</p>

<h2 id="for-your-further-perusal">For Your Further Perusal</h2>

<p>I’m deeply indebted to a few buddies of mine, principally Thomas at <a href="http://www.matasano.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.matasano.com']);">Matasano</a> and <a href="http://www.iwillteachyoutoberich.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.iwillteachyoutoberich.com']);">Ramit Sethi</a>, for teaching me to be less of a doormat in terms of negotiation. &nbsp;Thomas has forgotten more than I’ll ever know about doing negotiations with clients. &nbsp;Check out <a href="https://hn.algolia.com/">Hacker News search</a> with [tptacek negotiation] for some good advice, or (if you’re in Chicago) take him out to coffee.</p>

<p>Some years after I wrote this article, Josh Doody, one of my buddies, wrote <a href="https://www.amazon.com/Fearless-Salary-Negotiation-step-step/dp/0692568689">the literal book</a> on salary negotiation. If you learn best from books, I recommend it. If you’d prefer more personalized advice, <a href="https://fearlesssalarynegotiation.com/salary-negotiation-guide/">he has that available</a>, too.</p>

  </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[A Look at Bluesky (149 pts)]]></title>
            <link>https://juliette.page/blog/bluesky.html</link>
            <guid>36557378</guid>
            <pubDate>Sun, 02 Jul 2023 01:50:34 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://juliette.page/blog/bluesky.html">https://juliette.page/blog/bluesky.html</a>, See on <a href="https://news.ycombinator.com/item?id=36557378">Hacker News</a></p>
<div id="readability-page-1" class="page">
<header>
<a href="https://juliette.page/">Home</a>
</header>

<p id="tagline">An overly complicated social networking platform</p>
<p>Bluesky is a platform that competes with Mastodon. It runs the Authenticated Transfer Protocol, atproto. Atproto is a new protocol like ActivityPub for federated, decentralized, social networking. In atproto, usernames are domains which lead to cryptographic urls called DID. DID which stands for Decentralized Identifier is another specification. That all just means that my username would be @juliette.page and my DID would be something like at://did:plc:1231. A benefit of atproto users is that they are transferable without needing an active server, so for example if your server goes down thats not a problem you can just migrate to a different one and you’re all good! All of the user data is stored in data repositories.</p>
<p>A problem with the system of having a domain as a username is that people can claim it who don’t have access to that username. For example, someone was able to get the AWS S3 domain as their handle!</p> 
<p>Data repositories are signed, “git like”, public databases. Everything in them can be verified by other sources. However, that means interactions, such as user likes, blocks, follows, etc are all public. With no means to make them private. Which could lead to harassment! </p>
<p>Atproto also has the ability to create custom algorithms for timeline sorting! Which is a neat feature. But runs into the problem of algorithms being hijacked to show inappropriate/offensive/bigoted content.</p>
<p>Overall, Bluesky has some features that make it better than Mastodon, for example the algorithms and the ability to migrate servers while the server being done. But also it’s a group of overly complicated specifications that could’ve just been extensions to the ActivityPub protocol rather than a whole new protocol! </p>



</div>]]></description>
        </item>
        <item>
            <title><![CDATA[After September 1, 2023, all Gfycat content and data will be deleted (261 pts)]]></title>
            <link>https://gfycat.com/</link>
            <guid>36557287</guid>
            <pubDate>Sun, 02 Jul 2023 01:34:55 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://gfycat.com/">https://gfycat.com/</a>, See on <a href="https://news.ycombinator.com/item?id=36557287">Hacker News</a></p>
<div id="readability-page-1" class="page"><div role="main"><section><p><h2>Service Notice</h2></p><p><h2>The Gfycat service is being discontinued. Please save or delete your Gfycat content by visiting https://www.gfycat.com and logging in to your account. After September 1, 2023, all Gfycat content and data will be deleted from gfycat.com</h2></p></section><section><p><a href="https://gfycat.com/discover/trending-gifs"><h2>Featured Trending GIFs</h2></a></p><div><p><a href="https://gfycat.com/discover/trending-gifs">See more trending GIFs<span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 34" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M2.092.364L.37 2.074a.948.948 0 0 0-.37.733c0 .304.123.612.37.794L13.845 17.03.37 30.4c-.247.241-.37.486-.37.79 0 .308.123.55.37.795l1.722 1.648a.97.97 0 0 0 .74.367c.307 0 .554-.123.798-.367l16-15.872a.946.946 0 0 0 .37-.731c0-.305-.123-.61-.37-.795L3.63.364C3.386.123 3.139 0 2.832 0a.976.976 0 0 0-.74.364z" fill-rule="nonzero"></path></svg></span></a></p></div></section><div><section><div><a href="https://gfycat.com/popular-gifs"><h2>Popular GIFs</h2></a></div><div><p><a href="https://gfycat.com/popular-gifs">See more popular GIFs<span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 34" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M2.092.364L.37 2.074a.948.948 0 0 0-.37.733c0 .304.123.612.37.794L13.845 17.03.37 30.4c-.247.241-.37.486-.37.79 0 .308.123.55.37.795l1.722 1.648a.97.97 0 0 0 .74.367c.307 0 .554-.123.798-.367l16-15.872a.946.946 0 0 0 .37-.731c0-.305-.123-.61-.37-.795L3.63.364C3.386.123 3.139 0 2.832 0a.976.976 0 0 0-.74.364z" fill-rule="nonzero"></path></svg></span></a></p></div></section><section><div><a href="https://gfycat.com/gaming"><h2>Gaming GIFs</h2></a></div><div><p><a href="https://gfycat.com/gaming">See more gaming GIFs<span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 34" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M2.092.364L.37 2.074a.948.948 0 0 0-.37.733c0 .304.123.612.37.794L13.845 17.03.37 30.4c-.247.241-.37.486-.37.79 0 .308.123.55.37.795l1.722 1.648a.97.97 0 0 0 .74.367c.307 0 .554-.123.798-.367l16-15.872a.946.946 0 0 0 .37-.731c0-.305-.123-.61-.37-.795L3.63.364C3.386.123 3.139 0 2.832 0a.976.976 0 0 0-.74.364z" fill-rule="nonzero"></path></svg></span></a></p></div></section><section><p><a href="https://gfycat.com/featured/reactions"><h2>Reaction GIFs</h2></a></p><div><p><a href="https://gfycat.com/featured/reactions">See more reaction GIFs<span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 34" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M2.092.364L.37 2.074a.948.948 0 0 0-.37.733c0 .304.123.612.37.794L13.845 17.03.37 30.4c-.247.241-.37.486-.37.79 0 .308.123.55.37.795l1.722 1.648a.97.97 0 0 0 .74.367c.307 0 .554-.123.798-.367l16-15.872a.946.946 0 0 0 .37-.731c0-.305-.123-.61-.37-.795L3.63.364C3.386.123 3.139 0 2.832 0a.976.976 0 0 0-.74.364z" fill-rule="nonzero"></path></svg></span></a></p></div></section><section><div><a href="https://gfycat.com/stickers"><h2>Sticker GIFs</h2></a></div><div><p><a href="https://gfycat.com/stickers">See more sticker GIFs<span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 34" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M2.092.364L.37 2.074a.948.948 0 0 0-.37.733c0 .304.123.612.37.794L13.845 17.03.37 30.4c-.247.241-.37.486-.37.79 0 .308.123.55.37.795l1.722 1.648a.97.97 0 0 0 .74.367c.307 0 .554-.123.798-.367l16-15.872a.946.946 0 0 0 .37-.731c0-.305-.123-.61-.37-.795L3.63.364C3.386.123 3.139 0 2.832 0a.976.976 0 0 0-.74.364z" fill-rule="nonzero"></path></svg></span></a></p></div></section></div><div><p><h2>Current trending tags</h2></p><div><h2>Gfycat Pro</h2><p>No ads, always HD experience with Gfycat Pro.</p><p><a href="https://gfycat.com/pro">Get Pro now</a></p></div></div></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[China Has $3T of ‘Hidden’ Currency Reserves, Setser Says (115 pts)]]></title>
            <link>https://www.bloomberg.com/news/articles/2023-06-30/china-has-3-trillion-of-hidden-currency-reserves-setser-says</link>
            <guid>36557122</guid>
            <pubDate>Sun, 02 Jul 2023 01:07:32 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.bloomberg.com/news/articles/2023-06-30/china-has-3-trillion-of-hidden-currency-reserves-setser-says">https://www.bloomberg.com/news/articles/2023-06-30/china-has-3-trillion-of-hidden-currency-reserves-setser-says</a>, See on <a href="https://news.ycombinator.com/item?id=36557122">Hacker News</a></p>
<div id="readability-page-1" class="page"><section>
    <section>
        <h3>Why did this happen?</h3>
        <p>Please make sure your browser supports JavaScript and cookies and that you are not
            blocking them from loading.
            For more information you can review our <a href="https://www.bloomberg.com/notices/tos">Terms of
                Service</a> and <a href="https://www.bloomberg.com/notices/tos">Cookie Policy</a>.</p>
    </section>
    <section>
        <h3>Need Help?</h3>
        <p>For inquiries related to this message please <a href="https://www.bloomberg.com/feedback">contact
            our support team</a> and provide the reference ID below.</p>
        <p>Block reference ID:</p>
    </section>
</section></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Intro to Cryptography [pdf] (2011) (160 pts)]]></title>
            <link>https://www.cs.umd.edu/~waa/414-F11/IntroToCrypto.pdf</link>
            <guid>36557077</guid>
            <pubDate>Sun, 02 Jul 2023 01:02:00 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.cs.umd.edu/~waa/414-F11/IntroToCrypto.pdf">https://www.cs.umd.edu/~waa/414-F11/IntroToCrypto.pdf</a>, See on <a href="https://news.ycombinator.com/item?id=36557077">Hacker News</a></p>
&lt;Not HTML&gt;]]></description>
        </item>
        <item>
            <title><![CDATA[Oregon County Sues BP, Chevron, Shell, Exxon for $51B Climate Damages (195 pts)]]></title>
            <link>https://carboncredits.com/oregon-county-sues-oil-companies-shell-bp-exxon-chevron-for-51b-climate-damages/</link>
            <guid>36556844</guid>
            <pubDate>Sun, 02 Jul 2023 00:28:03 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://carboncredits.com/oregon-county-sues-oil-companies-shell-bp-exxon-chevron-for-51b-climate-damages/">https://carboncredits.com/oregon-county-sues-oil-companies-shell-bp-exxon-chevron-for-51b-climate-damages/</a>, See on <a href="https://news.ycombinator.com/item?id=36556844">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-td-block-uid="tdi_94"><p><span>An Oregon county filed a lawsuit against oil and gas companies and industry, blaming them and seeking $51 billion in damages for the deadly 2021 Pacific Northwest heat wave that killed about 800 people.</span></p>
<p><span>Multnomah County, which includes Portland, sued 17 companies, including Shell, Exxon Mobil, Chevron, BP, among others. The county said these fossil fuel companies and other entities in the industry are the ones to blame for the deadly heat dome.</span></p>
<p><span>A heat dome event happens when a high-pressure system prevents cooler winds from blowing and also prevents clouds from forming.&nbsp;</span></p>
<h2><span>The $51 Billion Heat Dome Damages</span></h2>
<p><span>Multnomah County is seeking<strong> $50 million</strong> from the defendants for actual damages from the <a href="https://eos.org/articles/in-the-pacific-northwest-2021-was-the-hottest-year-in-a-millennium#:~:text=A%201%2C000%2Dyear%20temperature%20record,in%20the%20decades%20to%20come." target="_blank" rel="noopener">2021 record-breaking heat wave</a>. Temperatures in the region reached 116°F, killing 69 people in the county. This is the hottest temperature ever recorded in the county’s history.&nbsp;</span></p>
<p><span>The plaintiff also asked for <strong>$1.5 billion</strong> in future damages and <strong>$50 billion</strong> abatement fund to “weatherproof” the county. The fund will also be for public health services needed for future extreme weather events resulting from fossil fuel use.&nbsp;</span></p>
<p><span>Emergency departments in the county were flooded with patients suffering from heat-related illness.&nbsp;</span></p>
<p><span>Apart from Oregon, hundreds of people also died because of the event in </span><a href="https://www.washington.edu/news/2023/04/06/washington-states-2021-heat-wave-contributed-to-159-excess-injury-deaths-over-three-weeks/" target="_blank" rel="noopener"><span>Washington</span></a><span> and </span><a href="https://science.gc.ca/site/science/en/blogs/science-health/surviving-heat-impacts-2021-western-heat-dome-canadahttps://science.gc.ca/site/science/en/blogs/science-health/surviving-heat-impacts-2021-western-heat-dome-canada" target="_blank" rel="noopener"><span>British Columbia</span></a><span>.&nbsp;</span></p>
<p><span>Researchers composed of climate scientists said that the heat wave was due to excessive carbon emissions from burning fossil fuels.&nbsp;</span></p>
<p><span>According to these climate experts, the 2021 heat dome was “virtually impossible” if not because of global warming. Their <a href="https://www.nature.com/articles/s41558-022-01520-4" target="_blank" rel="noopener">study</a> showed that the heat wave was at least 150x less likely to occur if temperatures hadn’t heated that much caused by human-related carbon emissions.&nbsp;&nbsp;</span></p>
<p><span>After the 2021 heat dome, the county has spent more to prepare for similar events in the future – expanding shelter, increasing supplies, and staffing up.&nbsp;</span></p>
<h2><span>Climate Lawsuits Against Big Oil&nbsp;</span></h2>
<p><span>The Oregon county accused the big oil companies, and other entities including McKinsey &amp; Company, for committing negligence and fraud. They said the companies knew that their fossil fuel products will cause warming and will have a negative impact. Yet, they continue to deceive the public about it.&nbsp;&nbsp;</span></p>
<p><span>As per their </span><a href="https://www.multco.us/multnomah-county/news/multnomah-county-sues-oil-companies-over-2021-heat-dome-disaster" target="_blank" rel="noopener"><span>statement</span></a><span>:</span></p>
<p><i><span>“We are confident that, once we show what the fossil fuel companies knew about global warming and when, and what they did to deny, delay and deceive the public, the jury will not let the fossil fuel companies get away with their reckless misconduct.”&nbsp;</span></i></p>
<p><span>Oregon taxpayers paid for all the heat-related emergencies and expenses during the event, including air conditioning and cooling centers.</span></p>
<p><img decoding="async" src="https://firstdraftnews.org/wp-content/uploads/2021/07/2021-06-30T234741Z_1492449881_RC2W8O9E6RNZ_RTRMADP_3_CANADA-USA-WEATHER-900x505.jpg?x21167" alt="Record-breaking heat wave in North Pacific " width="900" height="505" data-old-src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20900%20505'%3E%3C/svg%3E" data-lazy-src="https://firstdraftnews.org/wp-content/uploads/2021/07/2021-06-30T234741Z_1492449881_RC2W8O9E6RNZ_RTRMADP_3_CANADA-USA-WEATHER-900x505.jpg?x21167"></p>
<p><span>The Oregon lawsuit is similar to climate litigations filed by other local and state governments since 2017. It’s the 36th time a municipality has sued oil and gas companies for alleged damages caused by global warming.&nbsp;</span></p>
<p><span>It comes after the US </span><a href="https://carboncredits.com/will-big-oil-pay-climate-damages/"><span>Supreme Court sided with Colorado’s governments</span></a><span> demanding oil giants to pay for their climate damages.</span></p>
<p>Last year at climate summit, <a href="https://carboncredits.com/4-key-takeaways-from-cop27-summit/">COP27</a>, Climate TRACE, an NGO tracking emissions, analyzed 72,612 individual sources of CO2.&nbsp;Their study revealed that fossil fuel emissions could be up to <strong>3x higher</strong> than what oil and gas companies claim. They found that <strong>50%</strong> of the largest emitters are oil and gas fields.</p>
<p>According to an <a href="https://www.carbonbrief.org/analysis-global-co2-emissions-from-fossil-fuels-hit-record-high-in-2022/" target="_blank" rel="noopener">analysis</a>, global carbon emissions from fossil fuels hit record high in 2022 as shown below, at 40.5 gigatons of CO2.</p>
<figure id="attachment_12742" aria-describedby="caption-attachment-12742"><picture decoding="async">
<source type="image/webp" data-lazy-srcset="https://carboncredits.b-cdn.net/wp-content/uploads/2023/06/global-carbon-emissions-from-fossi-lfuels-2022.jpg.webp 747w, https://carboncredits.b-cdn.net/wp-content/uploads/2023/06/global-carbon-emissions-from-fossi-lfuels-2022-300x241.jpg.webp 300w, https://carboncredits.b-cdn.net/wp-content/uploads/2023/06/global-carbon-emissions-from-fossi-lfuels-2022-696x559.jpg.webp 696w" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20747%20600'%3E%3C/svg%3E" data-lazy-sizes="(max-width: 747px) 100vw, 747px">
<img decoding="async" src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20747%20600'%3E%3C/svg%3E" alt="global carbon emissions from fossi lfuels 2022" width="747" height="600" data-lazy-srcset="https://carboncredits.b-cdn.net/wp-content/uploads/2023/06/global-carbon-emissions-from-fossi-lfuels-2022.jpg 747w, https://carboncredits.b-cdn.net/wp-content/uploads/2023/06/global-carbon-emissions-from-fossi-lfuels-2022-300x241.jpg 300w, https://carboncredits.b-cdn.net/wp-content/uploads/2023/06/global-carbon-emissions-from-fossi-lfuels-2022-696x559.jpg 696w" data-lazy-sizes="(max-width: 747px) 100vw, 747px" data-lazy-src="https://carboncredits.b-cdn.net/wp-content/uploads/2023/06/global-carbon-emissions-from-fossi-lfuels-2022.jpg">
</picture>
<figcaption id="caption-attachment-12742">Source: Carbon Brief</figcaption></figure>
<h2><span>Baseless, Unproductive Claims</span></h2>
<p><span>In response to the lawsuit, Chevron’s legal representative said the claims are baseless and counterproductive in “advancing international policy solutions”.&nbsp;</span></p>
<p><span>Shell also responded saying that the court isn’t the right venue in tackling climate change. Rather, this issue needs collaboration from all sectors and a “smart government policy” as the right way to find solutions.&nbsp;</span></p>
<p><span>Exxon’s spokesperson said that this kind of lawsuit won’t be helpful in addressing climate change, and will just waste time and resources. The oil giant further stated that it won’t impact their commitment to invest billions to reach global <a href="https://carboncredits.com/what-does-net-zero-emissions-really-mean/">net zero emissions.</a>&nbsp;</span></p>
<p><span>If big oil companies ended up paying the damages, it can make the cost of doing fossil fuel business more expensive, as per a </span><a href="https://blogs.law.columbia.edu/climatechange/2023/05/12/cities-counties-and-states-score-major-procedural-win-in-climate-liability-suits-against-fossil-fuel-companies/" target="_blank" rel="noopener"><span>climate law fellow </span></a><span>at Columbia University’s Sabin Center for Climate Change Law.</span></p>
<p><span>In effect, alternatives to fossil fuels will be more cost-competitive. This may not be a direct effect of climate change, but it could be a crucial turn of event.</span></p>
<p><span>Multnomah County brought the lawsuit in state court and has secured outside lawyers for the case.&nbsp;</span></p>
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[C++ GPT-2 inference engine (106 pts)]]></title>
            <link>https://github.com/a1k0n/a1gpt</link>
            <guid>36556293</guid>
            <pubDate>Sat, 01 Jul 2023 23:11:14 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/a1k0n/a1gpt">https://github.com/a1k0n/a1gpt</a>, See on <a href="https://news.ycombinator.com/item?id=36556293">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text"><h2 tabindex="-1" dir="auto">a1gpt</h2>
<p dir="auto">throwaway C++ GPT-2 inference engine from @a1k0n w/ minimal but optimized BLAS
ops for AVX and Apple Silicon</p>
<p dir="auto">no external dependencies except for accelerate framework on macos</p>
<h2 tabindex="-1" dir="auto">build / run</h2>
<ul dir="auto">
<li>First, download and convert the model</li>
</ul>
<p dir="auto"><code>$ python3 scripts/download_and_convert_gpt2.py</code></p>
<p dir="auto">This will require <code>numpy</code> and <code>huggingface_hub</code> to be installed in Python</p>
<ul dir="auto">
<li>CMake and build</li>
</ul>
<p dir="auto">note: RelWithDebInfo is the default build type, so it should run pretty quick</p>
<div data-snippet-clipboard-copy-content="$ mkdir build
$ cd build
$ cmake ..
-- The CXX compiler identification is GNU 11.3.0
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Check for working CXX compiler: /usr/bin/c++ - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - done
-- Configuring done
-- Generating done
-- Build files have been written to: a1gpt/build
$ make -j
[ 12%] Building CXX object CMakeFiles/bpe_test.dir/bpe_test.cpp.o
[ 25%] Building CXX object CMakeFiles/bpe_test.dir/bpe.cpp.o
[ 37%] Building CXX object CMakeFiles/gpt2.dir/main.cpp.o
[ 50%] Building CXX object CMakeFiles/gpt2.dir/model_load_gpt2.cpp.o
[ 62%] Building CXX object CMakeFiles/gpt2.dir/model.cpp.o
[ 75%] Building CXX object CMakeFiles/gpt2.dir/bpe.cpp.o
[ 87%] Linking CXX executable bpe_test
[100%] Linking CXX executable gpt2
[100%] Built target bpe_test
[100%] Built target gpt2
$ ./gpt2 &quot;provide your own prompt here&quot;"><pre><code>$ mkdir build
$ cd build
$ cmake ..
-- The CXX compiler identification is GNU 11.3.0
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Check for working CXX compiler: /usr/bin/c++ - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - done
-- Configuring done
-- Generating done
-- Build files have been written to: a1gpt/build
$ make -j
[ 12%] Building CXX object CMakeFiles/bpe_test.dir/bpe_test.cpp.o
[ 25%] Building CXX object CMakeFiles/bpe_test.dir/bpe.cpp.o
[ 37%] Building CXX object CMakeFiles/gpt2.dir/main.cpp.o
[ 50%] Building CXX object CMakeFiles/gpt2.dir/model_load_gpt2.cpp.o
[ 62%] Building CXX object CMakeFiles/gpt2.dir/model.cpp.o
[ 75%] Building CXX object CMakeFiles/gpt2.dir/bpe.cpp.o
[ 87%] Linking CXX executable bpe_test
[100%] Linking CXX executable gpt2
[100%] Built target bpe_test
[100%] Built target gpt2
$ ./gpt2 "provide your own prompt here"
</code></pre></div>
</article>
          </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Beyond Markdown (2018) (117 pts)]]></title>
            <link>https://johnmacfarlane.net/beyond-markdown.html</link>
            <guid>36556261</guid>
            <pubDate>Sat, 01 Jul 2023 23:06:29 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://johnmacfarlane.net/beyond-markdown.html">https://johnmacfarlane.net/beyond-markdown.html</a>, See on <a href="https://news.ycombinator.com/item?id=36556261">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
        
<p><em>This essay was originally posted at <a href="https://talk.commonmark.org/t/beyond-markdown/2787">https://talk.commonmark.org/t/beyond-markdown/2787</a> in April, 2018.</em></p>
<p>In developing Commonmark, we have tried, as far as possible, to remain faithful to John Gruber’s original Markdown syntax description. We have diverged from it only occasionally, in the interest of removing ambiguity and increasing uniformity, and with the addition of a few syntax elements that are now virtuously ubiquitous (like fenced code blocks and shortcut reference links).</p>
<p>There are very good reasons for being conservative in this way. But this respect for the past has made the CommonMark spec a very complicated beast. There are <a href="http://spec.commonmark.org/0.28/#emphasis-and-strong-emphasis">17 principles governing emphasis</a>, for example, and <a href="https://github.com/commonmark/CommonMark/issues/475">these rules still leave cases undecided</a>. The <a href="http://spec.commonmark.org/0.28/#list-items">rules for list items</a> and <a href="http://spec.commonmark.org/0.28/#html-blocks">HTML blocks</a> are also very complex. All of these rules lead to unexpected results sometimes, and they make writing a parser for CommonMark a complex affair. I despair, at times, of getting to a spec that is worth calling 1.0.</p>
<p>What if we weren’t chained to the past? What if we tried to create a light markup syntax that keeps what is good about Markdown, while revising some of the features that have led to bloat and complexity in the CommonMark spec?</p>
<p>Let me be clear up front that I’m not suggesting any change in the goals of the Commonmark project. If these reflections lead to anything, it should probably be an entirely new project under a new name. And, being realistic, the burdens of maintaining backwards compatibility are light in comparison with the enormous practical costs of moving existing systems to a new light markup language. Still…I think it can be useful to daydream.</p>
<p>In what follows, I’ll go through the six features of Markdown that I think have created the most difficulties, and I’ll suggest how each pain point can be fixed.</p>
<h2 id="emphasis">1. Emphasis</h2>
<p>In Markdown, emphasis is created by surrounding text with <code>*</code> or <code>_</code> characters, <code>*like this*</code>. Strong emphasis is created by doubling these, <code>**like this**</code>. That all sounds very simple, and it’s visually clear which one is strong emphasis.</p>
<p>Unfortunately, these simple statements aren’t enough to pin down the syntax. Consider, for example,</p>
<pre><code>**this* text**</code></pre>
<p>Our simple rules are consistent with both of these readings:</p>
<ol type="1">
<li><code>&lt;strong&gt;this* text&lt;/strong&gt;</code></li>
<li><code>&lt;em&gt;&lt;em&gt;this&lt;/em&gt; text&lt;/em&gt;*</code></li>
</ol>
<p>So, to fully specify emphasis parsing, we need additional rules. The 17 discouragingly complex rules in the CommonMark spec are intended to force the sorts of readings that humans will find most natural.</p>
<p>It seems to me that the use of doubled characters for strong emphasis, and the possibility of emphasizing even part of a word, as in <code>fan*tas*tic</code>, have made the problem of specifying emphasis parsing far worse, by vastly increasing the ambiguities the spec must resolve. Depending on context, a string of three <code>***</code> in the middle of a word might be any of the following:</p>
<ol type="1">
<li>A <code>*</code> character followed by the beginning of strong emphasis.</li>
<li>The end of strong emphasis followed by a <code>*</code> character.</li>
<li>The end of normal emphasis, a <code>*</code> character, then the beginning of normal emphasis.</li>
<li>The end of strong emphasis followed by the beginning of normal emphasis.</li>
<li>The end of normal emphasis followed by the beginning of strong emphasis.</li>
<li>The end of normal emphasis followed by a literal <code>**</code>.</li>
<li>A literal <code>**</code> followed by the beginning of normal emphasis.</li>
<li>Literal <code>***</code>.</li>
</ol>
<h3 id="how-to-fix-emphasis">How to fix emphasis</h3>
<p>To dramatically reduce ambiguities, we can remove the doubled character delimiters for strong emphasis. Instead, use a single <code>_</code> for regular emphasis, and a single <code>*</code> for strong emphasis. Emphasis would now start with a left-flanking but not right-flanking delimiter and end with a right-flanking but not left-flanking delimiter of the same kind.</p>
<p>For intraword emphasis, we’d require a special syntax:</p>
<pre><code>fan~_tas_~tic</code></pre>
<p>Intraword emphasis is extremely rare, so it’s a good tradeoff to make it a little harder, in exchange for simplifying the rules (and conceptual model) for emphasis in general. The special character <code>~</code> here acts like a space for purposes of parsing emphasis (allowing the intraword <code>_</code> to start and end emphasis), but isn’t rendered as a space. (It thus behaves like an escaped space does in reStructuredText.)</p>
<p><em>Added 2022-04-22:</em> This would also give us a way to express something that is currently <em>inexpressible</em> in commonmark: <code>a&lt;em&gt;[b]&lt;/em&gt;c</code>. There is currently <em>no way to write</em> this with commonmark’s rules, since in <code>a*[b]*c</code> the first <code>*</code> is right-flanking and the second <code>*</code> is left-flanking. But with the proposed syntax, it could be written as <code>a~_[b]_~c</code>.</p>
<h2 id="reference-links">2. Reference links</h2>
<p>The usual treatment of reference links makes it impossible to classify any syntax element until the whole document has been parsed. For example, consider</p>
<pre><code>[foo][bar][baz]

[bar]: url</code></pre>
<p>This is interpreted as</p>
<pre><code>&lt;p&gt;&lt;a href="url"&gt;foo&lt;/a&gt;[baz]&lt;/p&gt;</code></pre>
<p>But suppose we define a link for <code>baz</code> instead of <code>bar</code>:</p>
<pre><code>[foo][bar][baz]

[baz]: url</code></pre>
<p>Then we get:</p>
<pre><code>&lt;p&gt;[foo]&lt;a href="url"&gt;bar&lt;/a&gt;&lt;/p&gt;</code></pre>
<p>So, we can’t tell whether <code>[foo]</code> is literal bracketed text or a link with link description <code>foo</code> until we’ve parsed the entire document.</p>
<p>This makes syntax highlighting very difficult, and it also complicates writing parsers. For example, you can’t parse links, then resolve references in the AST after the document is parsed.</p>
<h3 id="how-to-fix-reference-links">How to fix reference links</h3>
<p>Make reference links recognizable by their shape alone, independent of what references are defined in the document. Thus,</p>
<pre><code>[foo][bar][baz]</code></pre>
<p>would be parsed as a link with link text <code>foo</code> to whatever URL is defined for reference <code>bar</code> (or to nothing, if none is defined), followed by literal text <code>[baz]</code>.</p>
<p>Shortcut references like</p>
<pre><code>[foo]

[foo]: url</code></pre>
<p>would have to be disallowed (unless we were willing to force writers to escape all literal bracket characters). The compact form could be used instead:</p>
<pre><code>[foo][]

[foo]: url</code></pre>
<p>This is a bit more typing, but it makes it clear and unambiguous that there is a link.</p>
<h2 id="indented-code-blocks-and-lists">3. Indented code blocks and lists</h2>
<p>Parsing indented code blocks is straightforward, but their presence complicates the rules for list items.</p>
<p>In specifying the syntax for list items, we need to say how far content must be indented in order to be considered part of the list item. The original Markdown syntax documents hinted at a “four-space rule,” requiring four spaces indentation, but implementations rarely followed that, and most people find it counterintuitive that</p>
<pre><code>- a
  - b</code></pre>
<p>wouldn’t be considered a nested list. So, in CommonMark, we surveyed a large number of possible rules, eventually ending up with a rule requiring the contents of the list item to be indented at least to the level of the first non-space content after the list marker:</p>
<pre><code>  -  Item

     ^-- contents must be indented to here.</code></pre>
<p>This is not a bad rule, but it adds complexity: one has to keep track not just of the position of the list marker, but of the position of the first non-space content that follows it. And then one needs special rules for cases like empty list items and list items that begin with indented code. Finally, many people still find it surprising that, for example, this isn’t a nested list:</p>
<pre><code>- a
 - b</code></pre>
<p>Thus one might ask: why not just require that the contents of a list item be indented at least one space past the list marker? That’s the obvious minimal rule. What blocks this is the presence of indented code blocks. If block-level content under a list item begins at one space indent after the list marker, then indented code would have to be indented five spaces past the list marker. Not only is that incompatible with the eight spaces indicated in the original Markdown syntax description, it leads to terrible results with longer list markers:</p>
<pre><code>99.  Here's my list item.

     And this is indented code! Even though it
     lines up with the paragraph above!</code></pre>
<p>To sum up: most of the complexity in the rules for list items is motivated by the need to deal with indented code blocks.</p>
<h3 id="how-to-fix-indented-code-blocks-and-lists">How to fix indented code blocks and lists</h3>
<p>Fenced code blocks are now usually preferred to indented code blocks, because you can specify a syntax for highlighting and you needn’t indent/deindent when copying and pasting code. Since we have fenced code blocks, we don’t need indented code blocks. So, we can just get rid of them.</p>
<p>This frees up indentation to be used more flexibly to indicate list nesting, and we can embrace the simple, obvious rule that the contents of a list item must be indented at least one space relative to the list marker.</p>
<p>Another advantage of removing indented code blocks is that initial indentation can now be ignored in general, except insofar as it affects lists.</p>
<h2 id="raw-html">4. Raw HTML</h2>
<p>From the beginning, you could insert raw HTML into Markdown documents, and it would be passed through verbatim. The idea is that you could drop back to raw HTML for anything that can’t be expressed in plain text.</p>
<p>This sounds simpler than it is. From the beginning, <code>Markdown.pl</code> distinguished between inline and block level HTML. Inline HTML tags were passed through verbatim, but their contents could be interpreted as Markdown:</p>
<pre><code>&lt;em&gt;**hi**&lt;/em&gt;</code></pre>
<p>would give you</p>
<pre><code>&lt;em&gt;&lt;strong&gt;hi&lt;/strong&gt;&lt;/em&gt;</code></pre>
<p>Block-level HTML content, it was stipulated, should be separated by blank lines, and the start and end tags should not be indented. In such HTML blocks, everything would be passed through verbatim, and not interpreted as Markdown. So,</p>
<pre><code>&lt;div&gt;
*hello*
&lt;/div&gt;</code></pre>
<p>would just give you</p>
<pre><code>&lt;div&gt;
*hello*
&lt;/div&gt;</code></pre>
<p>This raised several problems. First, how do we identify block-level content? Do we need to hard-code a list of HTML elements that may change as HTML evolves? What about elements like <code>&lt;del&gt;</code> that can occur in inline or block contexts?</p>
<p>Second, what about block-level HTML that is not properly separated and indented?</p>
<pre><code>hi &lt;div&gt;
  hello&lt;/div&gt;</code></pre>
<p>Should parsers just treat it as inline HTML and generate invalid HTML?</p>
<p>Third, how do we identify the end of an HTML block? Given that tags can be nested, this requires nontrivial HTML parsing. The released version of <code>Markdown.pl</code> produced invalid HTML for a doubly-nested <code>&lt;div&gt;</code> element; a beta version designed to fix this problem had serious performance issues.</p>
<p>CommonMark’s spec for HTML blocks was designed to make it easy to parse raw HTML blocks (without indefinite lookahead or full implementation of HTML parsing), and also to make it possible for authors to include CommonMark content inside block-level HTML tags, if they wanted to. But the result is rather complex: seven distinct pairs of start and end conditions. The rules for inline HTML are also complex, with a large number of definitions.</p>
<p>In addition, as Markdown has become useful not just for creating HTML, but for creating documents in a number of different formats, the way HTML is singled out for raw pass-through has come to seem a bit arbitrary. Those who author in other formats would benefit from a way to pass through raw content, too.</p>
<h3 id="how-to-fix-raw-html">How to fix raw HTML</h3>
<p>Instead of passing through raw HTML, we should introduce a special syntax that allows passing through raw content of any format. For this we can overload our existing containers for raw strings: code spans and code blocks:</p>
<pre><code>This is raw HTML: `&lt;img src="myimage.jpg"&gt;`{=html}.

And here's an HTML block:

```{=html}
&lt;div id="main"&gt;
 &lt;div class="article"&gt;
```</code></pre>
<p>But we can do LaTeX too:</p>
<pre><code>```{=latex}
\begin{tikzpicture}
\node[inner sep=0pt] (russell) at (0,0)
    {\includegraphics[width=.25\textwidth]{bertrand_russell.jpg}};
\node[inner sep=0pt] (whitehead) at (5,-6)
    {\includegraphics[width=.25\textwidth]{alfred_north_whitehead.jpg}};
\draw[&lt;-&gt;,thick] (russell.south east) -- (whitehead.north west)
    node[midway,fill=white] {Principia Mathematica};
\end{tikzpicture}
```</code></pre>
<p>We could even pass through different raw content to different formats, for example including HTML and LaTeX versions of a complex figure.</p>
<h2 id="lists-and-blank-lines">5. Lists and blank lines</h2>
<p>Can a list interrupt a paragraph, like this?</p>
<pre><code>Paragraph test.
- Item one
- Item two</code></pre>
<p>The original Markdown syntax documentation does not settle this, but <code>Markdown.pl</code> and its test suite require a blank line between paragraph text and a following list. As the test suite indicates, this requirement was introduced in order to avoid accidental creation of lists by things like:</p>
<pre><code>I think he weighed 200 pounds, maybe even
220.  But he was no more than five feet tall.</code></pre>
<p>However, one exception was made: when the paragraph text is <em>itself</em> part of a list item, no blank line is required.</p>
<pre><code>-   Paragraph one

    paragraph two
    - sublist item one
    - sublist item two</code></pre>
<p>If this exception were not made, then we would not be able to recognize a nested list in this kind of case:</p>
<pre><code>- a
  - b
  - c
- d</code></pre>
<p>In thinking about the CommonMark spec for list items, we realized that the <code>Markdown.pl</code> behavior violates what we called the <em>principle of uniformity,</em> which says that the contents of a list item should have the same meaning they would have outside of the list item. This principle implies that if</p>
<pre><code>a
- b
- c</code></pre>
<p>does not contain a list, then</p>
<pre><code>- a
  - b
  - c
- d</code></pre>
<p>does not contain a sublist. We think that the principle of uniformity is important. Indeed, the way we specify list items and block quotes presupposes it. This means that we faced a choice: either require a blank line between paragraph text and a following list, or allow lists to interrupt paragraphs, and risk accidental interpretation of paragraph text as a list. We took the first option to be off the table, since it is very common in Markdown to have tight sublists without a preceding blank line. So we opted for the second option, mitigating the damage with an ugly heuristic (we only allow an ordered list to interrupt a paragraph when the list number is <code>1</code>).</p>
<h3 id="how-to-fix-lists-and-blank-lines">How to fix lists and blank lines</h3>
<p>We should require a blank line between paragraph text and a list. Always. That means, even in sublists. So, to create a tight list with a sublist, you’d write:</p>
<pre><code>- a

  - b
  - c

- d</code></pre>
<p>We’ll say a list is tight if it contains at least one pair of items with no blank line between, so in the above example, the inner list is tight and the outer list is not. To get both lists tight:</p>
<pre><code>- a

  - b
  - c
- d</code></pre>
<h2 id="attributes">6. Attributes</h2>
<p>Markdown offers no general way to add attributes (such as classes or identifiers) to elements. This deprives it of a native way of creating internal links to sections of a document. (Many implementations have introduced subtly different ways of automatically generating identifiers from headers.) It also deprives it of a natural extension mechanism. Markdown has containers for inlines (e.g.&nbsp;emphasis), blocks (e.g.&nbsp;block quote), and raw inline content (code spans), and raw block content (code blocks). If arbitrary attributes could be attached to these, they could be manipulated by filters to produce very flexible output. For example, one could treat a block quote with the class “warning” as a warning admonition, or one could treat a code block with the class “dot” as a graphviz dot diagram, to be rendered as an image. Currently, though, the only way to attach attributes to an element is to drop down to raw HTML.</p>
<h3 id="how-to-fix-attributes">How to fix attributes</h3>
<p>Introduce a syntax for an attribute specification. Following pandoc, use braces <code>{}</code> for this. An identifier is indicated with <code>#</code>. A bare word is treated as a class (or, an initial <code>.</code> could be required as in pandoc). Use <code>=</code> for an arbitrary key/value attribute.</p>
<p>Allow attributes to be added on the line <em>before</em> any block element and directly <em>after</em> any inline element:</p>
<pre><code>{#myheader}
# The *Blue Title*{blue position=left}</code></pre>
<p>Here the identifier <code>myheader</code> is added to the header block, and the class <code>blue</code> and key/value attribute <code>position=left</code> are added to the emphasized text <code>Blue Title</code>.</p>
<p>Attributes specifiers must fit on one line, but several may be used (and will then be combined):</p>
<pre><code>{#mywarning}
{warning}
&gt; Don't try this at home!
&gt; It might be dangerous.</code></pre>
<p>Perhaps it would be helpful to add a syntax for unadorned inline spans, and a fenced generic block container, as in pandoc. But we can use emphasis for an inline container and block quote for a block container, so this wouldn’t be absolutely necessary.</p>
<h2 id="summary-of-recommendations">Summary of recommendations</h2>
<ol type="1">
<li><p>Emphasis</p>
<ol type="a">
<li>Use distinct characters for emphasis and strong emphasis.</li>
<li>Don’t use doubled-character delimiters.</li>
<li>Simplify emphasis rules.</li>
<li>Introduce special syntax for intraword emphasis, with <code>~</code> behaving like a space as far as parsing emphasis goes, but render as nothing.</li>
</ol></li>
<li><p>Reference links</p>
<ol type="a">
<li>Don’t make parsing something as a link depend on whether a reference link definition exists elsewhere in the document.</li>
<li>Remove shortcut reference links.</li>
</ol></li>
<li><p>Code</p>
<ol type="a">
<li>Remove indented code blocks. Use only fenced blocks for code.</li>
</ol></li>
<li><p>Lists</p>
<ol type="a">
<li>Use a simple rule for determining what belongs under a list item: anything indented at all with respect to the list marker belongs in the item.</li>
<li>Require a blank line between paragraph content and a following list.</li>
<li>Revise rules for tight lists: a list is tight if any two items lack a blank line between them.</li>
</ol></li>
<li><p>HTML</p>
<ol type="a">
<li>Remove automatic pass-through of raw HTML. Things like <code>&lt;br&gt;</code> will now be treated as regular text and escaped.</li>
<li>Introduce an explicit syntax for passing through raw content in an arbitrary format. In inline contexts, a code span followed by <code>{=FORMAT}</code>; in block contexts, a fenced code block with info string <code>{=FORMAT}</code>.</li>
</ol></li>
<li><p>Attributes</p>
<ol type="a">
<li>Introduce a uniform attribute syntax, like this: <code>{class #identifier key=value}</code>.</li>
<li>Allow attributes on any block element. The identifier must appear by itself on the line before the block element. Multiple attributes can be specified on successive lines; they will be combined.</li>
<li>Allow attributes on any inline element. The identifier must appear immediately after (and adjacent to) the inline element to which it is to apply.</li>
</ol></li>
</ol>
      </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Fake reviews are illegal and subject to big fines under new FTC rules (558 pts)]]></title>
            <link>https://www.washingtonpost.com/technology/2023/06/30/fake-reviews-online-ftc/</link>
            <guid>36556228</guid>
            <pubDate>Sat, 01 Jul 2023 23:02:28 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.washingtonpost.com/technology/2023/06/30/fake-reviews-online-ftc/">https://www.washingtonpost.com/technology/2023/06/30/fake-reviews-online-ftc/</a>, See on <a href="https://news.ycombinator.com/item?id=36556228">Hacker News</a></p>
Couldn't get https://www.washingtonpost.com/technology/2023/06/30/fake-reviews-online-ftc/: Error [ERR_FR_TOO_MANY_REDIRECTS]: Maximum number of redirects exceeded]]></description>
        </item>
        <item>
            <title><![CDATA[How I changed my D-Link camera to a locally managed IP camera (291 pts)]]></title>
            <link>https://github.com/bmork/defogger</link>
            <guid>36555507</guid>
            <pubDate>Sat, 01 Jul 2023 21:35:32 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/bmork/defogger">https://github.com/bmork/defogger</a>, See on <a href="https://news.ycombinator.com/item?id=36555507">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text"><h2 tabindex="-1" dir="auto">D-Link DCS-8000LH</h2>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/5244688931d03820c3c14ba9290d133b3cf658fa6c2306b730c3531018425f30/68747470733a2f2f65752e646c696e6b2e636f6d2f756b2f656e2f70726f64756374732f2d2f6d656469612f70726f647563742d70616765732f6463732f383030306c682f6463735f383030306c685f66726f6e742e706e67"><img src="https://camo.githubusercontent.com/5244688931d03820c3c14ba9290d133b3cf658fa6c2306b730c3531018425f30/68747470733a2f2f65752e646c696e6b2e636f6d2f756b2f656e2f70726f64756374732f2d2f6d656469612f70726f647563742d70616765732f6463732f383030306c682f6463735f383030306c685f66726f6e742e706e67" alt="D-Link DCS-8000LH" data-canonical-src="https://eu.dlink.com/uk/en/products/-/media/product-pages/dcs/8000lh/dcs_8000lh_front.png"></a></p>
<p dir="auto">These are random notes descibing how I changed my D-Link DCS-8000LH
from a cloud camera to a locally managed IP camera, streaming H.264
MPEG-TS over HTTP and HTTPS. Some of the tools and ideas might work
for other cameras too, given some model specific adaptation.</p>
<p dir="auto">Complete defogging requires modifying one of the file systems in the
camera.  This implies a slight risk of ending up with a brick. You
have now been warned...</p>
<p dir="auto">This is tested and developed on firmware versions v2.01.03 and
v2.02.02 only.  The final complete procedure has only been tested with
v2.02.02. It should work fine with v2.01.03 and other versions, in
theory, but could fail like anything untested.  Please let me know if
you have an original v2.01.03 firmware update from D-Link, or any
other version for that matter, or know where firmware updates can be
downloaded.</p>
<p dir="auto">The v2.02.02 update is available from
<a href="https://mydlinkmpfw.auto.mydlink.com/DCS-8000LH/DCS-8000LH_Ax_v2.02.02_3014.bin" rel="nofollow">https://mydlinkmpfw.auto.mydlink.com/DCS-8000LH/DCS-8000LH_Ax_v2.02.02_3014.bin</a>
at the time of writing. But I assume this link stops working as soon
as there is a newer version available.</p>
<h2 tabindex="-1" dir="auto">Changelog</h2>
<ul dir="auto">
<li>v0.01 (20190515) - initial published version</li>
<li>v0.02 (20190515) - added RTSP support and information</li>
</ul>
<h2 tabindex="-1" dir="auto">Problem</h2>
<p dir="auto">My D-Link DCS-8000LH came with firmware version 2.01.03 from factory.
This firmware is locked to the <a href="https://www.mydlink.com/" rel="nofollow"><strong>mydlink</strong></a>
app/cloud service.  It does not provide a local NIPCA compatible HTTP
API or similar, and it does not stream video over HTTP, HTTPS or RTSP.</p>
<p dir="auto">Additionally, there is no way to downgrade the firmware.  In fact,
there is no documented way to install any firmware image at all,
except trusting the "mydlink" cloud service to do it for you.</p>
<h2 tabindex="-1" dir="auto">Solution</h2>
<h4 tabindex="-1" dir="auto">Primary goals achieved:</h4>
<ul dir="auto">
<li>configuration of network and admin password via Bluetooth LE, without
registering with D-Link or using the <a href="https://www.mydlink.com/" rel="nofollow"><strong>mydlink</strong></a> app at all</li>
<li>streaming MPEG-TS directly from camera over HTTP and HTTPS</li>
<li>direct RTSP streaming</li>
<li>NIPCA API configuration over HTTP and HTTPS, supporting settings
like LED, nightmode, etc</li>
</ul>
<h4 tabindex="-1" dir="auto">And some extra goodies which came for free</h4>
<ul dir="auto">
<li>Firmware upgrades and downgrades via HTTP</li>
<li>telnet server with a root account (admin/PIN Code)</li>
<li>easy access to serial console, using the same root account</li>
<li>running arbitrary commands on the camera using Bluetooth</li>
</ul>
<p dir="auto">Read on for all the gory details...</p>
<h3 tabindex="-1" dir="auto">Requirements</h3>
<ul dir="auto">
<li>a Linux PC with a Bluetooth controller</li>
<li>python3 with @IanHarvey's
<a href="https://ianharvey.github.io/bluepy-doc/index.html" rel="nofollow"><strong>bluepy</strong></a>
library</li>
<li>WiFi network with WPA2-PSK and a known password</li>
<li>mksquashfs from the squashfs-tools package</li>
<li>a tftp server or web server accepting file uploads (for backups)</li>
<li>guts :-)</li>
</ul>
<p dir="auto">Most recent Linux distros will probably do. The bluepy library can be
installed using pip if it is not available as a distro package.  Other
types of WiFi networks might work, but has not been tested with the
provided tools.  The squashfs-tools are only necessary if you want to
rebuild the "mydlink" alternative file system.  I assume you can even
run the tools without installing Linux, by using a Linux "Live"
CD/DVD/USB stick.</p>
<p dir="auto">This was developed and tested on Debian Buster.</p>
<h3 tabindex="-1" dir="auto">Camera configuration using the Bluetooth LE GATT API</h3>
<p dir="auto">The "mydlink" app uses Bluetooth LE for camera setup, authenticated by
the camera pincode.  This repo includes an alternative python script
with a few extra goodies, but needing a better name:
<a href="https://github.com/bmork/defogger/blob/master/dcs8000lh-configure.py"><strong>dcs8000lh-configure.py</strong></a></p>
<p dir="auto">(Why not an Android app?  Because it would take me much more time to
write. Should be fairly easy to do though, for anyone with enough
interest.  You can find all the necessary protocol details here and in
the python code. Please let me know if you are interested)</p>
<p dir="auto">The script does not support scanning for the simple reason that this
would require root access for not real gain.  You have to provide the
<strong>PIN Code</strong> from the camera label
anyway.  Reading the <strong>MAC ID</strong> as well is simple enough
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/3d60e9ce4d86b619250f09dee7ca094f922067b9702df75c6b40694343c5fbf2/68747470733a2f2f7777772e6d6f726b2e6e6f2f7e626a6f726e2f646373383030306c682f646373383030306c682d6c6162656c2e6a7067"><img src="https://camo.githubusercontent.com/3d60e9ce4d86b619250f09dee7ca094f922067b9702df75c6b40694343c5fbf2/68747470733a2f2f7777772e6d6f726b2e6e6f2f7e626a6f726e2f646373383030306c682f646373383030306c682d6c6162656c2e6a7067" alt="camera label" data-canonical-src="https://www.mork.no/~bjorn/dcs8000lh/dcs8000lh-label.jpg"></a></p>
<p dir="auto">The <strong>PIN Code</strong> and <strong>MAC</strong> is also printed on the code card that
came with the camera:
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/6e7195feb91e23ff11aee043c48383df3a93295c753d4fd0718d36f31f18ab94/68747470733a2f2f7777772e6d6f726b2e6e6f2f7e626a6f726e2f646373383030306c682f646373383030306c682d636f64652d636172642e6a7067"><img src="https://camo.githubusercontent.com/6e7195feb91e23ff11aee043c48383df3a93295c753d4fd0718d36f31f18ab94/68747470733a2f2f7777772e6d6f726b2e6e6f2f7e626a6f726e2f646373383030306c682f646373383030306c682d636f64652d636172642e6a7067" alt="code card" data-canonical-src="https://www.mork.no/~bjorn/dcs8000lh/dcs8000lh-code-card.jpg"></a></p>
<p dir="auto">Note that the command line <strong>address</strong> paramenter must be formatted as
<strong>01:23:45:67:89:AB</strong> instead of the <strong>0123456789AB</strong> format printed
on the label.</p>
<p dir="auto">Current script help text at the time of writing shows what the script
can do:</p>
<div data-snippet-clipboard-copy-content="$ ./dcs8000lh-configure.py -h
usage: dcs8000lh-configure.py [-h] [--essid ESSID] [--wifipw WIFIPW]
                              [--survey] [--netconf] [--sysinfo]
                              [--command COMMAND] [--telnetd] [--lighttpd]
                              [--rtsp] [--unsignedfw] [--attrs] [-V]
                              address pincode

IPCam Bluetooth configuration tool.

positional arguments:
  address            IPCam Bluetooth MAC address (01:23:45:67:89:AB)
  pincode            IPCam PIN Code (6 digits)

optional arguments:
  -h, --help         show this help message and exit
  --essid ESSID      Connect to this WiFi network
  --wifipw WIFIPW    Password for ESSID
  --survey           List WiFi networks seen by the IPCam
  --netconf          Print current network configuration
  --sysinfo          Dump system configuration
  --command COMMAND  Run command on IPCam
  --telnetd          Start telnet server on IPCam
  --lighttpd         Start web server on IPCam
  --rtsp             Enable access to RTSP server on IPCam
  --unsignedfw       Allow unsigned firmware
  --attrs            Dump IPCam GATT characteristics
  -V, --version      show program's version number and exit"><pre><code>$ ./dcs8000lh-configure.py -h
usage: dcs8000lh-configure.py [-h] [--essid ESSID] [--wifipw WIFIPW]
                              [--survey] [--netconf] [--sysinfo]
                              [--command COMMAND] [--telnetd] [--lighttpd]
                              [--rtsp] [--unsignedfw] [--attrs] [-V]
                              address pincode

IPCam Bluetooth configuration tool.

positional arguments:
  address            IPCam Bluetooth MAC address (01:23:45:67:89:AB)
  pincode            IPCam PIN Code (6 digits)

optional arguments:
  -h, --help         show this help message and exit
  --essid ESSID      Connect to this WiFi network
  --wifipw WIFIPW    Password for ESSID
  --survey           List WiFi networks seen by the IPCam
  --netconf          Print current network configuration
  --sysinfo          Dump system configuration
  --command COMMAND  Run command on IPCam
  --telnetd          Start telnet server on IPCam
  --lighttpd         Start web server on IPCam
  --rtsp             Enable access to RTSP server on IPCam
  --unsignedfw       Allow unsigned firmware
  --attrs            Dump IPCam GATT characteristics
  -V, --version      show program's version number and exit
</code></pre></div>
<h4 tabindex="-1" dir="auto">Real session excample after a clean upgrade to firmware v2.02.02, followed by factory reset</h4>
<ol dir="auto">
<li>Start by making sure the camera can see our WiFi network.  This
also verifies that we can connect and authenticate against the
Bluetooth LE IPCam service, without making any changes to any
camera settings:</li>
</ol>
<div data-snippet-clipboard-copy-content="$ ./dcs8000lh-configure.py B0:C5:54:AA:BB:CC 123456 --survey
Connecting to B0:C5:54:AA:BB:CC...
Verifying IPCam service
Connected to 'DCS-8000LH-BBCC'
DCS-8000LH-BBCC is scanning for WiFi networks...
{'I': 'AirLink126FD4', 'M': '0', 'C': '11', 'S': '4', 'E': '2', 'P': '47'}
{'I': 'Antiboks', 'M': '0', 'C': '11', 'S': '4', 'E': '2', 'P': '73'}
{'I': 'ASV17', 'M': '0', 'C': '11', 'S': '4', 'E': '2', 'P': '47'}
{'I': 'ASV17-dlink', 'M': '0', 'C': '6', 'S': '4', 'E': '2', 'P': '57'}
{'I': 'DIRECT-33-HP%20ENVY%205000%20series', 'M': '0', 'C': '1', 'S': '4', 'E': '2', 'P': '46'}
{'I': 'fjorde123', 'M': '0', 'C': '1', 'S': '4', 'E': '2', 'P': '55'}
{'I': 'JOJ', 'M': '0', 'C': '11', 'S': '4', 'E': '2', 'P': '48'}
{'I': 'Kjellerbod', 'M': '0', 'C': '11', 'S': '4', 'E': '2', 'P': '75'}
{'I': 'Landskap_24', 'M': '0', 'C': '11', 'S': '4', 'E': '2', 'P': '46'}
{'I': 'mgmt', 'M': '0', 'C': '1', 'S': '4', 'E': '2', 'P': '72'}
{'I': 'Rindedal', 'M': '0', 'C': '11', 'S': '4', 'E': '2', 'P': '68'}
{'I': 'risikovirus', 'M': '0', 'C': '1', 'S': '4', 'E': '2', 'P': '45'}
{'I': 'risikovirus%20WIFI', 'M': '0', 'C': '11', 'S': '4', 'E': '2', 'P': '45'}
{'I': 'Stavik2014', 'M': '0', 'C': '6', 'S': '4', 'E': '2', 'P': '47'}
{'I': 'TomterNett1', 'M': '0', 'C': '6', 'S': '4', 'E': '2', 'P': '44'}
{'I': 'VIF', 'M': '0', 'C': '11', 'S': '4', 'E': '2', 'P': '47'}
Done."><pre><code>$ ./dcs8000lh-configure.py B0:C5:54:AA:BB:CC 123456 --survey
Connecting to B0:C5:54:AA:BB:CC...
Verifying IPCam service
Connected to 'DCS-8000LH-BBCC'
DCS-8000LH-BBCC is scanning for WiFi networks...
{'I': 'AirLink126FD4', 'M': '0', 'C': '11', 'S': '4', 'E': '2', 'P': '47'}
{'I': 'Antiboks', 'M': '0', 'C': '11', 'S': '4', 'E': '2', 'P': '73'}
{'I': 'ASV17', 'M': '0', 'C': '11', 'S': '4', 'E': '2', 'P': '47'}
{'I': 'ASV17-dlink', 'M': '0', 'C': '6', 'S': '4', 'E': '2', 'P': '57'}
{'I': 'DIRECT-33-HP%20ENVY%205000%20series', 'M': '0', 'C': '1', 'S': '4', 'E': '2', 'P': '46'}
{'I': 'fjorde123', 'M': '0', 'C': '1', 'S': '4', 'E': '2', 'P': '55'}
{'I': 'JOJ', 'M': '0', 'C': '11', 'S': '4', 'E': '2', 'P': '48'}
{'I': 'Kjellerbod', 'M': '0', 'C': '11', 'S': '4', 'E': '2', 'P': '75'}
{'I': 'Landskap_24', 'M': '0', 'C': '11', 'S': '4', 'E': '2', 'P': '46'}
{'I': 'mgmt', 'M': '0', 'C': '1', 'S': '4', 'E': '2', 'P': '72'}
{'I': 'Rindedal', 'M': '0', 'C': '11', 'S': '4', 'E': '2', 'P': '68'}
{'I': 'risikovirus', 'M': '0', 'C': '1', 'S': '4', 'E': '2', 'P': '45'}
{'I': 'risikovirus%20WIFI', 'M': '0', 'C': '11', 'S': '4', 'E': '2', 'P': '45'}
{'I': 'Stavik2014', 'M': '0', 'C': '6', 'S': '4', 'E': '2', 'P': '47'}
{'I': 'TomterNett1', 'M': '0', 'C': '6', 'S': '4', 'E': '2', 'P': '44'}
{'I': 'VIF', 'M': '0', 'C': '11', 'S': '4', 'E': '2', 'P': '47'}
Done.
</code></pre></div>
<ol start="2" dir="auto">
<li>We're going to use the 'Kjellerbod' network, so that looks good.
Select it and give the associated WiFi password to the camera:</li>
</ol>
<div data-snippet-clipboard-copy-content="$ ./dcs8000lh-configure.py B0:C5:54:AA:BB:CC 123456 --essid Kjellerbod --wifipw redacted
Connecting to B0:C5:54:AA:BB:CC...
Verifying IPCam service
Connected to 'DCS-8000LH-BBCC'
DCS-8000LH-BBCC is scanning for WiFi networks...
Will configure: M=0;I=Kjellerbod;S=4;E=2;K=redacted
Done."><pre><code>$ ./dcs8000lh-configure.py B0:C5:54:AA:BB:CC 123456 --essid Kjellerbod --wifipw redacted
Connecting to B0:C5:54:AA:BB:CC...
Verifying IPCam service
Connected to 'DCS-8000LH-BBCC'
DCS-8000LH-BBCC is scanning for WiFi networks...
Will configure: M=0;I=Kjellerbod;S=4;E=2;K=redacted
Done.
</code></pre></div>
<ol start="3" dir="auto">
<li>Verify that the camera connected to the Wifi network and got an
address.  If not, go back and try again, making sure you are using
the correct WiFi password:</li>
</ol>
<div data-snippet-clipboard-copy-content="$ ./dcs8000lh-configure.py B0:C5:54:AA:BB:CC 123456 --netconf
Connecting to B0:C5:54:AA:BB:CC...
Verifying IPCam service
Connected to 'DCS-8000LH-BBCC'
wifi link is Up
wifi config: {'M': '0', 'I': 'Kjellerbod', 'S': '4', 'E': '2'}
ip config: {'I': '192.168.2.37', 'N': '255.255.255.0', 'G': '192.168.2.1', 'D': '148.122.16.253'}
Done."><pre><code>$ ./dcs8000lh-configure.py B0:C5:54:AA:BB:CC 123456 --netconf
Connecting to B0:C5:54:AA:BB:CC...
Verifying IPCam service
Connected to 'DCS-8000LH-BBCC'
wifi link is Up
wifi config: {'M': '0', 'I': 'Kjellerbod', 'S': '4', 'E': '2'}
ip config: {'I': '192.168.2.37', 'N': '255.255.255.0', 'G': '192.168.2.1', 'D': '148.122.16.253'}
Done.
</code></pre></div>
<p dir="auto"><strong>WARNING</strong>: You must make a backup of your device at this point if
you haven't done so already.  See the <a href="#Backup"><strong>Backup</strong></a> section
below.  I only skipped it in this example because I already had a
complete backup of my camera.</p>
<ol start="4" dir="auto">
<li>We need HTTP NIPCA API for the remaining tasks, so temporarily
start lighttpd on the camera:</li>
</ol>
<div data-snippet-clipboard-copy-content="$ ./dcs8000lh-configure.py B0:C5:54:AA:BB:CC 123456 --lighttpd
Connecting to B0:C5:54:AA:BB:CC...
Verifying IPCam service
Connected to 'DCS-8000LH-BBCC'
Attempting to run '[ $(tdb get HTTPServer Enable_byte) -eq 1 ] || tdb set HTTPServer Enable_byte=1' on DCS-8000LH-BBCC by abusing the 'set admin password' request
Attempting to run '/etc/rc.d/init.d/extra_lighttpd.sh start' on DCS-8000LH-BBCC by abusing the 'set admin password' request
Done."><pre><code>$ ./dcs8000lh-configure.py B0:C5:54:AA:BB:CC 123456 --lighttpd
Connecting to B0:C5:54:AA:BB:CC...
Verifying IPCam service
Connected to 'DCS-8000LH-BBCC'
Attempting to run '[ $(tdb get HTTPServer Enable_byte) -eq 1 ] || tdb set HTTPServer Enable_byte=1' on DCS-8000LH-BBCC by abusing the 'set admin password' request
Attempting to run '/etc/rc.d/init.d/extra_lighttpd.sh start' on DCS-8000LH-BBCC by abusing the 'set admin password' request
Done.
</code></pre></div>
<p dir="auto">Note that this implicitly changes a couple of settings which are
stored in the <a href="#Partitions">"db"</a> NVRAM partition, and therefore will persist until
the next factory reset:</p>
<ul dir="auto">
<li>extra_lighttpd.sh will exit without doing anything unless
<strong>HTTPServer Enable</strong> is set</li>
<li>the admin password is set both because we're abusing that BLE
request, and because we need it for the HTTP API access.  The
script only supports setting the password to the <strong>PIN Code</strong>.</li>
</ul>
<p dir="auto"><em>This password restriction is because I'm lazy - there is nothing in
the camera or protocol preventing the password from being set to
something else. But the script would then need the new password as
an additional input parameter for most commands</em></p>
<ol start="5" dir="auto">
<li>Disable firmware signature verification. Only firmwares signed by
D-Link are accepted by default. This feature can be disabled by
changing a variable in the <a href="#Partitions">"db"</a> NVRAM partition:</li>
</ol>
<div data-snippet-clipboard-copy-content="$ ./dcs8000lh-configure.py B0:C5:54:AA:BB:CC 123456  --unsignedfw 
Connecting to B0:C5:54:AA:BB:CC...
Verifying IPCam service
Connected to 'DCS-8000LH-BBCC'
Attempting to run 'tdb set SecureFW _TrustLevel_byte=0' on DCS-8000LH-BBCC by abusing the 'set admin password' request
Done."><pre><code>$ ./dcs8000lh-configure.py B0:C5:54:AA:BB:CC 123456  --unsignedfw 
Connecting to B0:C5:54:AA:BB:CC...
Verifying IPCam service
Connected to 'DCS-8000LH-BBCC'
Attempting to run 'tdb set SecureFW _TrustLevel_byte=0' on DCS-8000LH-BBCC by abusing the 'set admin password' request
Done.
</code></pre></div>
<ol start="6" dir="auto">
<li>The final step is the dangerous one.  It replaces the file system
on the <a href="#Partitions"><strong>userdata</strong></a> partition with our home cooked one.  The D-Link
firmware uses this partition exclusively for the "mydlink" cloud
tools, which we don't need.  The rest of the system is not touched
by our firmware update.  The camera will therefore run exactly the
same kernel and rootfs as before the update, whatever version they
were.  I.e., the firmware version does not change - only the
"mydlink" version.</li>
</ol>
<p dir="auto"><strong>NOTE</strong>; You need to <a href="#BuildFirmware">build</a> a <strong>fw.tar</strong> firmware
update image first.</p>
<div data-snippet-clipboard-copy-content="$ curl --http1.0 -u admin:123456 --form upload=@fw.tar http://192.168.2.37/config/firmwareupgrade.cgi
upgrade=ok"><pre><code>$ curl --http1.0 -u admin:123456 --form upload=@fw.tar http://192.168.2.37/config/firmwareupgrade.cgi
upgrade=ok
</code></pre></div>
<p dir="auto">See the section on <a href="#Errors">error handling</a> if the upgrade request
returned anything else.</p>
<p dir="auto">The camera will reboot automatically at this point, assuming the
update was successful.  From now both with telnetd and lighttpd
running, and with external access to the RTSP server. All services
will use the same <strong>admin:PIN Code</strong> account for authentication.</p>
<p dir="auto">So we now have access to direct <a href="#Streaming">streaming</a> over HTTP,
HTTPS and RTSP without ever having been in contact with the
<a href="https://www.mydlink.com/" rel="nofollow"><strong>mydlink</strong></a> service!</p>
<h3 tabindex="-1" dir="auto"><a name="user-content-Streaming"></a>Streaming video locally</h3>
<p dir="auto">Which was the whole point of all this... We can now stream directly
from the camera using for example:</p>
<h4 tabindex="-1" dir="auto">HTTP or HTTPS</h4>
<div data-snippet-clipboard-copy-content="vlc https://192.168.2.37/video/mpegts.cgi
vlc https://192.168.2.37/video/flv.cgi"><pre><code>vlc https://192.168.2.37/video/mpegts.cgi
vlc https://192.168.2.37/video/flv.cgi
</code></pre></div>
<p dir="auto">Authenticate using the <strong>admin</strong> user with <strong>PIN Code</strong> as password</p>
<p dir="auto">AFAICS, this camera does not support MJPEG encoding. But you can
always use ffmpeg to transcode the H.264 anyway.  Looking closer at a
stream sample:</p>
<div data-snippet-clipboard-copy-content="$ curl --insecure -u admin:123456 https://192.168.2.37/video/mpegts.cgi>/tmp/stream
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0 93.1G    0  438k    0     0  92872      0  12d 11h  0:00:04  12d 11h 92853^C

$ mediainfo /tmp/stream 
General
ID                                       : 1 (0x1)
Complete name                            : /tmp/stream
Format                                   : MPEG-TS
File size                                : 500 KiB
Duration                                 : 5 s 433 ms
Overall bit rate mode                    : Variable
Overall bit rate                         : 752 kb/s

Video
ID                                       : 257 (0x101)
Menu ID                                  : 1 (0x1)
Format                                   : AVC
Format/Info                              : Advanced Video Codec
Format profile                           : High@L4
Format settings, CABAC                   : Yes
Format settings, ReFrames                : 1 frame
Format settings, GOP                     : M=1, N=30
Codec ID                                 : 27
Duration                                 : 5 s 450 ms
Width                                    : 1 280 pixels
Height                                   : 720 pixels
Display aspect ratio                     : 16:9
Frame rate mode                          : Variable
Color space                              : YUV
Chroma subsampling                       : 4:2:0
Bit depth                                : 8 bits
Scan type                                : Progressive

Audio
ID                                       : 256 (0x100)
Menu ID                                  : 1 (0x1)
Format                                   : AAC
Format/Info                              : Advanced Audio Codec
Format version                           : Version 2
Format profile                           : LC
Muxing mode                              : ADTS
Codec ID                                 : 15
Duration                                 : 3 s 456 ms
Bit rate mode                            : Variable
Channel(s)                               : 1 channel
Channel positions                        : Front: C
Sampling rate                            : 16.0 kHz
Frame rate                               : 15.625 FPS (1024 spf)
Compression mode                         : Lossy"><pre><code>$ curl --insecure -u admin:123456 https://192.168.2.37/video/mpegts.cgi&gt;/tmp/stream
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0 93.1G    0  438k    0     0  92872      0  12d 11h  0:00:04  12d 11h 92853^C

$ mediainfo /tmp/stream 
General
ID                                       : 1 (0x1)
Complete name                            : /tmp/stream
Format                                   : MPEG-TS
File size                                : 500 KiB
Duration                                 : 5 s 433 ms
Overall bit rate mode                    : Variable
Overall bit rate                         : 752 kb/s

Video
ID                                       : 257 (0x101)
Menu ID                                  : 1 (0x1)
Format                                   : AVC
Format/Info                              : Advanced Video Codec
Format profile                           : High@L4
Format settings, CABAC                   : Yes
Format settings, ReFrames                : 1 frame
Format settings, GOP                     : M=1, N=30
Codec ID                                 : 27
Duration                                 : 5 s 450 ms
Width                                    : 1 280 pixels
Height                                   : 720 pixels
Display aspect ratio                     : 16:9
Frame rate mode                          : Variable
Color space                              : YUV
Chroma subsampling                       : 4:2:0
Bit depth                                : 8 bits
Scan type                                : Progressive

Audio
ID                                       : 256 (0x100)
Menu ID                                  : 1 (0x1)
Format                                   : AAC
Format/Info                              : Advanced Audio Codec
Format version                           : Version 2
Format profile                           : LC
Muxing mode                              : ADTS
Codec ID                                 : 15
Duration                                 : 3 s 456 ms
Bit rate mode                            : Variable
Channel(s)                               : 1 channel
Channel positions                        : Front: C
Sampling rate                            : 16.0 kHz
Frame rate                               : 15.625 FPS (1024 spf)
Compression mode                         : Lossy
</code></pre></div>
<h4 tabindex="-1" dir="auto">RTSP</h4>
<p dir="auto">Direct RTSP access is also supported, using the same <strong>admin</strong> user.</p>
<p dir="auto">The RTSP URLs are configurable, so the proper way to use RTSP is to
first check the URL of the wanted profile using the NIPCA API:</p>
<div data-snippet-clipboard-copy-content="$ curl -u admin:123456 --insecure 'https://192.168.2.37/config/rtspurl.cgi?profileid=1'
profileid=1
urlentry=live/profile.0
video_codec=H264
audio_codec=OPUS"><pre><code>$ curl -u admin:123456 --insecure 'https://192.168.2.37/config/rtspurl.cgi?profileid=1'
profileid=1
urlentry=live/profile.0
video_codec=H264
audio_codec=OPUS
</code></pre></div>
<p dir="auto">and then connect to this RTSP URL:</p>
<div data-snippet-clipboard-copy-content="$ vlc rtsp://192.168.2.37/live/profile.0"><pre><code>$ vlc rtsp://192.168.2.37/live/profile.0
</code></pre></div>
<p dir="auto">Note that persistent RTSP access can be enabled with original
unmodified D-Link firmware, using the Bluetooth <strong>--rtsp</strong> option.
This modifies the necessary settings.  The <strong>rtspd</strong> service is
already started by default in the original firmware.</p>
<p dir="auto">So there is no need to mess with the firmware at all if all you want
is RTSP.</p>
<h4 tabindex="-1" dir="auto"><a name="user-content-Errors"></a>Errors during firmware update via HTTP</h4>
<p dir="auto">The <strong>firmwareupgrade.cgi</strong> script running in the camera isn't much
smarter than the rest of the system, so there are a few important
things keep in mind.  These are found by trial-and-error:</p>
<ul dir="auto">
<li>HTTP/1.1 might not work - the firmwareupgrade.cgi script does not support <strong>100 Continue</strong> AFAICS</li>
<li>The firmware update image should be provided as a <strong>file</strong> input field from a form</li>
<li>The field name must be <strong>upload</strong>.</li>
</ul>
<p dir="auto">Use the exact curl command provided above, replacing only the PIN
Code, IP address and firmware filename.  This should work.  Anything
else might not.</p>
<p dir="auto">The camera must be manually rebooted by removing power or pressing
reset if the firmware upgrade fails for any reason. The
<strong>firmwareupgrade.cgi</strong> script stops most processes, inluding the
Bluetooth handler, and fails to restart them on errors.</p>
<p dir="auto">There will be no permanent harm if the upload fails.  But note that
you have to repeat the <strong>--lighttpd</strong> step after rebooting the camera,
before you can retry. It does not start automatically until we've
installed our modified "mydlink" alternative.</p>
<p dir="auto">The contents of the fw.tar file must obviously be a valid, encrypted,
firmware update intended for the specified hardware.  It must also be
signed.  But the signing key can be unknown to the camera provided the
previous <strong>--unsignedfw</strong> request above was successful.</p>
<p dir="auto">The <a href="https://github.com/bmork/defogger/blob/master/Makefile"><strong>Makefile</strong></a> provided here shows how to <a href="#BuildFirmware">build</a> a valid firmware
update, but for the DCS-8000LH only!  It does not support any other
model. It will create a new throwaway signing key if it canæt find a
real one, and include the associated public key in the archive in case
you want to verify the signature manually.</p>
<p dir="auto">Note that the encryption key might be model specific.  I do not know
this as I have no other model to look at.  Please let me know if you
have any information on this topic.</p>
<p dir="auto">The encryption key is part ot the <a href="#Partitions"><strong>pib</strong></a> partition, and can be
read from a shell using</p>

<p dir="auto">Or you can simply look at your partition backup.  The key is stored as
a plain text <em>RSA PRIVATE KEY</em> PEM blob, so it is easy to spot. This
repo includes a copy of my <a href="https://github.com/bmork/defogger/blob/master/keys/DCS-8000LH-PriKey.pem">key</a> as I see
no point in attempting to keep a well known shared key like this one
"secret"</p>
<h3 tabindex="-1" dir="auto"><a name="user-content-Backup"></a>Backup</h3>
<p dir="auto">Create a backup of everything <em>before</em> you mess up.  Restoring will be
hard anyway, so don't rely on that.  But you can forget about
restoring at all unless you have a backup, so make it anyway.</p>
<p dir="auto">Note that the <a href="#Partitions"><strong>pib</strong></a> partition contains data which are
specific to <strong>your</strong> camera, and cannot be restored from any other
source!  This includes</p>
<ul dir="auto">
<li>model number</li>
<li>hardware revision</li>
<li>mac address</li>
<li>feature bits</li>
<li>private keys, pincode and passwords</li>
</ul>
<p dir="auto">Well, OK, we can restore most of the <a href="#Partitions"><strong>pib</strong></a>  using information from
the <a href="https://www.mork.no/~bjorn/dcs8000lh/dcs8000lh-label.jpg" rel="nofollow">camera label</a>, but
it's better to avoid having to do that...</p>
<p dir="auto">A backup is also useful for analyzing the file systems offline.</p>
<p dir="auto">Making a backup without networking is inconvenient, so setup
networking first. In theory, you could dump the flash to the serial
console. But this would be very time consuming and tiresome.</p>
<p dir="auto">The D-Link firmware provides a selection of network file transfer
tools. Pick anyone you like:</p>
<ul dir="auto">
<li>tftp</li>
<li>wget</li>
<li>curl</li>
<li>...and probably more</li>
</ul>
<p dir="auto">I've been using tftp for my backups because it is simple. You'll
obviously need a tftp server for this. Google for instructions on
setting that up.  You could alternatively set up a web server and use
wget or curl to post the files there, but this is more complx to set
up IMHO.</p>
<p dir="auto">Here is one example of how to enable temporary telnet access and
copying all camera flash partitions to a tftp server:</p>
<div data-snippet-clipboard-copy-content="$ ./dcs8000lh-configure.py B0:C5:54:AA:BB:CC 123456 --telnetd
Connecting to B0:C5:54:AA:BB:CC...
Verifying IPCam service
Connected to 'DCS-8000LH-BBCC'
Adding the 'admin' user as an alias for 'root'
Attempting to run 'grep -Eq ^admin: /etc/passwd||echo admin:x:0:0::/:/bin/sh >>/etc/passwd' on DCS-8000LH-BBCC by abusing the 'set admin password' request
Setting the 'admin' user password to '123456'
Attempting to run 'grep -Eq ^admin:x: /etc/passwd&amp;&amp;echo admin:123456|chpasswd' on DCS-8000LH-BBCC by abusing the 'set admin password' request
Starting telnetd
Attempting to run 'pidof telnetd||telnetd' on DCS-8000LH-BBCC by abusing the 'set admin password' request
 

Attempting to run '[ $(tdb get HTTPServer Enable_byte) -eq 1 ] || tdb set HTTPServer Enable_byte=1' on DCS-8000LH-BBCC by abusing the 'set admin password' request
Attempting to run '/etc/rc.d/init.d/extra_lighttpd.sh start' on DCS-8000LH-BBCC by abusing the 'set admin password' request
Done.


$ telnet 192.168.2.37
Trying 192.168.2.37...
Connected to 192.168.2.37.
Escape character is '^]'.
localhost login: admin
Password: 


BusyBox v1.22.1 (2019-02-14 17:06:35 CST) built-in shell (ash)
Enter 'help' for a list of built-in commands.


# for i in 0 1 2 3 4 5 6 7 8; do tftp -l /dev/mtd${i}ro -r mtd$i -p 192.168.2.1; done`"><pre><code>$ ./dcs8000lh-configure.py B0:C5:54:AA:BB:CC 123456 --telnetd
Connecting to B0:C5:54:AA:BB:CC...
Verifying IPCam service
Connected to 'DCS-8000LH-BBCC'
Adding the 'admin' user as an alias for 'root'
Attempting to run 'grep -Eq ^admin: /etc/passwd||echo admin:x:0:0::/:/bin/sh &gt;&gt;/etc/passwd' on DCS-8000LH-BBCC by abusing the 'set admin password' request
Setting the 'admin' user password to '123456'
Attempting to run 'grep -Eq ^admin:x: /etc/passwd&amp;&amp;echo admin:123456|chpasswd' on DCS-8000LH-BBCC by abusing the 'set admin password' request
Starting telnetd
Attempting to run 'pidof telnetd||telnetd' on DCS-8000LH-BBCC by abusing the 'set admin password' request
 

Attempting to run '[ $(tdb get HTTPServer Enable_byte) -eq 1 ] || tdb set HTTPServer Enable_byte=1' on DCS-8000LH-BBCC by abusing the 'set admin password' request
Attempting to run '/etc/rc.d/init.d/extra_lighttpd.sh start' on DCS-8000LH-BBCC by abusing the 'set admin password' request
Done.


$ telnet 192.168.2.37
Trying 192.168.2.37...
Connected to 192.168.2.37.
Escape character is '^]'.
localhost login: admin
Password: 


BusyBox v1.22.1 (2019-02-14 17:06:35 CST) built-in shell (ash)
Enter 'help' for a list of built-in commands.


# for i in 0 1 2 3 4 5 6 7 8; do tftp -l /dev/mtd${i}ro -r mtd$i -p 192.168.2.1; done`
</code></pre></div>
<p dir="auto">Change 192.168.2.37 to the address of your camera and 192.168.2.1 to
the address of your tftp server. Note that most tftp servers require
existing and writable destination files. Refer to your tftp server docs
for details.</p>
<h2 tabindex="-1" dir="auto">All the gory details</h2>
<h3 tabindex="-1" dir="auto">Restoring original D-Link firmware</h3>
<p dir="auto">The D-Link firmware, including the mydlink tools in the
<a href="#Partitions"><strong>userdata</strong></a> partition, can be restored by doing a
manual firmware upgrade providing a firmware update from D-Link.  Real
example, going back to v2.02.02:</p>
<div data-snippet-clipboard-copy-content="$ curl --http1.0 -u admin:123456 --form upload=@DCS-8000LH_Ax_v2.02.02_3014.bin http://192.168.2.37/config/firmwareupgrade.cgi
curl: (52) Empty reply from server"><pre><code>$ curl --http1.0 -u admin:123456 --form upload=@DCS-8000LH_Ax_v2.02.02_3014.bin http://192.168.2.37/config/firmwareupgrade.cgi
curl: (52) Empty reply from server
</code></pre></div>
<p dir="auto">I don't know why I got that <strong>Empty reply</strong> warning instead of the
expected <strong>upgrade=ok</strong>, but update went fine so I guess it can safely
be ignored. Might be a side effect of rewriting the root file system,
which the firmwareupgrade.cgi script is running from.</p>
<h3 tabindex="-1" dir="auto">Serial console</h3>
<p dir="auto">Useful for fw greater than v2.02.02. The serial console is used to temporally
enable the webservice of the camera. Then, the fw can be downloaded using defogging procedure
and further flash the custom fw.tar firmware.</p>
<p dir="auto">There is a 4 hole female header with 2 mm spacing in the bottom of the
camera. This header is easily accessible without opening the case at
all. But you will need to remove the bottom label to find it:
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/b4e18c41addca19b895a207850e8018ed1c8c33be1f2e032f8d883133560f7d1/68747470733a2f2f7777772e6d6f726b2e6e6f2f7e626a6f726e2f646373383030306c682f646373383030306c682d6c6162656c2d72656d6f7665642e6a7067"><img src="https://camo.githubusercontent.com/b4e18c41addca19b895a207850e8018ed1c8c33be1f2e032f8d883133560f7d1/68747470733a2f2f7777772e6d6f726b2e6e6f2f7e626a6f726e2f646373383030306c682f646373383030306c682d6c6162656c2d72656d6f7665642e6a7067" alt="label removed" data-canonical-src="https://www.mork.no/~bjorn/dcs8000lh/dcs8000lh-label-removed.jpg"></a></p>
<p dir="auto">Take a picure of the lable or save the information somewhere else
first, in case you make the it unreadable in the process.</p>
<p dir="auto">Mate with a 3 (or 4) pin male 2 mm connector, or use sufficiently
solid wires.  The pins need to be 6-10 mm long.  The pins will mess up the QR code, but the rest of the label can be left intact if you're careful:
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/754a1734b411c0cc154dccb0cdc32205ad14787834c2364d25ee1afdb034798c/68747470733a2f2f7777772e6d6f726b2e6e6f2f7e626a6f726e2f646373383030306c682f646373383030306c682d6c6162656c2d776974682d73657269616c2d70696e732e6a7067"><img src="https://camo.githubusercontent.com/754a1734b411c0cc154dccb0cdc32205ad14787834c2364d25ee1afdb034798c/68747470733a2f2f7777772e6d6f726b2e6e6f2f7e626a6f726e2f646373383030306c682f646373383030306c682d6c6162656c2d776974682d73657269616c2d70696e732e6a7067" alt="header with pins" data-canonical-src="https://www.mork.no/~bjorn/dcs8000lh/dcs8000lh-label-with-serial-pins.jpg"></a></p>
<p dir="auto">The pinout seen from egde to center of camera  is:</p>
<table>
<thead>
<tr>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
</tr>
</thead>
<tbody>
<tr>
<td>3.3V</td>
<td>TX</td>
<td>RX</td>
<td>GND</td>
</tr>
</tbody>
</table>
<p dir="auto">and the serial port parameters are 57600 8N1.</p>
<p dir="auto">You obviously need a 3.3V TTL adapter for this, Look at for example
at the generic OpenWrt console instructions if you need guidance.
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/3a21813ffb894a078773408e4bc0a5e918a159d8b733b07e9037f4a14f8506d3/68747470733a2f2f7777772e6d6f726b2e6e6f2f7e626a6f726e2f646373383030306c682f646373383030306c682d73657269616c2d636f6e6e65637465642e6a7067"><img src="https://camo.githubusercontent.com/3a21813ffb894a078773408e4bc0a5e918a159d8b733b07e9037f4a14f8506d3/68747470733a2f2f7777772e6d6f726b2e6e6f2f7e626a6f726e2f646373383030306c682f646373383030306c682d73657269616c2d636f6e6e65637465642e6a7067" alt="USB ttl adapter connected" data-canonical-src="https://www.mork.no/~bjorn/dcs8000lh/dcs8000lh-serial-connected.jpg"></a></p>
<p dir="auto">Do not connect the 3.3V pin.  All USB TTL adapters are powered by the
USB bus.</p>
<h3 tabindex="-1" dir="auto">Opening the case</h3>
<p dir="auto">Remove the top and bottom parts of the sylinder.  I assume the two
remaning halves of the sylinder are simple held together by clips, but
I did not verify this after discovering the easily accessible console
header.</p>
<p dir="auto">The top lid is clipped on:
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/cbe28bf86a3750c73fe4344e9fa1dcf4bc4b96fc74601d864f7d6631b00499b3/68747470733a2f2f7777772e6d6f726b2e6e6f2f7e626a6f726e2f646373383030306c682f646373383030306c682d746f702d6c69642e6a7067"><img src="https://camo.githubusercontent.com/cbe28bf86a3750c73fe4344e9fa1dcf4bc4b96fc74601d864f7d6631b00499b3/68747470733a2f2f7777772e6d6f726b2e6e6f2f7e626a6f726e2f646373383030306c682f646373383030306c682d746f702d6c69642e6a7067" alt="top lid" data-canonical-src="https://www.mork.no/~bjorn/dcs8000lh/dcs8000lh-top-lid.jpg"></a></p>
<p dir="auto">The bottom cover is held in place by two screws under the label:
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/b4e18c41addca19b895a207850e8018ed1c8c33be1f2e032f8d883133560f7d1/68747470733a2f2f7777772e6d6f726b2e6e6f2f7e626a6f726e2f646373383030306c682f646373383030306c682d6c6162656c2d72656d6f7665642e6a7067"><img src="https://camo.githubusercontent.com/b4e18c41addca19b895a207850e8018ed1c8c33be1f2e032f8d883133560f7d1/68747470733a2f2f7777772e6d6f726b2e6e6f2f7e626a6f726e2f646373383030306c682f646373383030306c682d6c6162656c2d72656d6f7665642e6a7067" alt="bottom cover" data-canonical-src="https://www.mork.no/~bjorn/dcs8000lh/dcs8000lh-label-removed.jpg"></a></p>
<p dir="auto">Removing the bottom cover reveals the reset button and the console header:
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/d75ff10cb9ce671f921c6f4acaa7991c1eb3e328528e15ca5af04e3ca252f495/68747470733a2f2f7777772e6d6f726b2e6e6f2f7e626a6f726e2f646373383030306c682f646373383030306c682d626f74746f6d2d776974686f75742d636f7665722e6a7067"><img src="https://camo.githubusercontent.com/d75ff10cb9ce671f921c6f4acaa7991c1eb3e328528e15ca5af04e3ca252f495/68747470733a2f2f7777772e6d6f726b2e6e6f2f7e626a6f726e2f646373383030306c682f646373383030306c682d626f74746f6d2d776974686f75742d636f7665722e6a7067" alt="bottom removed" data-canonical-src="https://www.mork.no/~bjorn/dcs8000lh/dcs8000lh-bottom-without-cover.jpg"></a></p>
<h3 tabindex="-1" dir="auto">U-Boot</h3>
<p dir="auto">My DCS-8000LH came with this boot loader:</p>
<p dir="auto"><code>U-Boot 2014.01-rc2-V1.1 (Jun 06 2018 - 03:44:37)</code></p>
<p dir="auto">But it is patched/configured to require a password for access to the
U-Boot prompt. Fortunately, D-Link makes the password readily
available in their GPL package :-) It is found in the file
<code>DCS-8000LH-GPL/configs/gpl_defconfig</code>:</p>
<p dir="auto"><code>ALPHA_FEATURES_UBOOT_LOGIN_PASSWORD="alpha168"</code></p>
<p dir="auto">Enter <strong>alpha168</strong> password when you see</p>
<p dir="auto"><code>Press ESC to abort autoboot in 3 seconds</code></p>
<p dir="auto">and you'll get a <code>rlxboot#</code> prompt, with access to these U-Boot commands :</p>
<div data-snippet-clipboard-copy-content="rlxboot# ?
?       - alias for 'help'
base    - print or set address offset
bootm   - boot application image from memory
bootp   - boot image via network using BOOTP/TFTP protocol
cmp     - memory compare
coninfo - print console devices and information
cp      - memory copy
crc32   - checksum calculation
echo    - echo args to console
editenv - edit environment variable
efuse   - efuse readall | read addr
env     - environment handling commands
fephy   - fephy read/write
go      - start application at address 'addr'
help    - print command description/usage
imxtract- extract a part of a multi-image
loadb   - load binary file over serial line (kermit mode)
loadx   - load binary file over serial line (xmodem mode)
loady   - load binary file over serial line (ymodem mode)
loop    - infinite loop on address range
md      - memory display
mm      - memory modify (auto-incrementing address)
mw      - memory write (fill)
nm      - memory modify (constant address)
ping    - send ICMP ECHO_REQUEST to network host
printenv- print environment variables
reset   - Perform RESET of the CPU
setenv  - set environment variables
setethaddr- set eth address
setipaddr- set ip address
sf      - SPI flash sub-system
source  - run script from memory
tftpboot- boot image via network using TFTP protocol
tftpput - TFTP put command, for uploading files to a server
tftpsrv - act as a TFTP server and boot the first received file
update  - update image
version - print monitor, compiler and linker version"><pre><code>rlxboot# ?
?       - alias for 'help'
base    - print or set address offset
bootm   - boot application image from memory
bootp   - boot image via network using BOOTP/TFTP protocol
cmp     - memory compare
coninfo - print console devices and information
cp      - memory copy
crc32   - checksum calculation
echo    - echo args to console
editenv - edit environment variable
efuse   - efuse readall | read addr
env     - environment handling commands
fephy   - fephy read/write
go      - start application at address 'addr'
help    - print command description/usage
imxtract- extract a part of a multi-image
loadb   - load binary file over serial line (kermit mode)
loadx   - load binary file over serial line (xmodem mode)
loady   - load binary file over serial line (ymodem mode)
loop    - infinite loop on address range
md      - memory display
mm      - memory modify (auto-incrementing address)
mw      - memory write (fill)
nm      - memory modify (constant address)
ping    - send ICMP ECHO_REQUEST to network host
printenv- print environment variables
reset   - Perform RESET of the CPU
setenv  - set environment variables
setethaddr- set eth address
setipaddr- set ip address
sf      - SPI flash sub-system
source  - run script from memory
tftpboot- boot image via network using TFTP protocol
tftpput - TFTP put command, for uploading files to a server
tftpsrv - act as a TFTP server and boot the first received file
update  - update image
version - print monitor, compiler and linker version
</code></pre></div>
<p dir="auto">Using the boot loader for image manipulation will be hard though,
since the camera has no ethernet, USB or removable flash and the boot
loader has no WiFi driver.  It is probably possible to load an image
over serial, but I don't have the patience for that...</p>
<p dir="auto">The environment is fixed and pretty clean:</p>
<div data-snippet-clipboard-copy-content="rlxboot# printenv
=3
addmisc=setenv bootargs ${bootargs}console=ttyS0,${baudrate}panic=1
baudrate=57600
bootaddr=(0xBC000000 + 0x1e0000)
bootargs=console=ttyS1,57600 root=/dev/mtdblock8 rts_hconf.hconf_mtd_idx=0 mtdparts=m25p80:256k(boot),128k(pib),1024k(userdata),128k(db),128k(log),128k(dbbackup),128k(logbackup),3072k(kernel),11264k(rootfs)
bootcmd=bootm 0xbc1e0000
bootfile=/vmlinux.img
ethact=r8168#0
ethaddr=00:00:00:00:00:00
load=tftp 80500000 ${u-boot}
loadaddr=0x82000000
stderr=serial
stdin=serial
stdout=serial

Environment size: 533/131068 bytes"><pre><code>rlxboot# printenv
=3
addmisc=setenv bootargs ${bootargs}console=ttyS0,${baudrate}panic=1
baudrate=57600
bootaddr=(0xBC000000 + 0x1e0000)
bootargs=console=ttyS1,57600 root=/dev/mtdblock8 rts_hconf.hconf_mtd_idx=0 mtdparts=m25p80:256k(boot),128k(pib),1024k(userdata),128k(db),128k(log),128k(dbbackup),128k(logbackup),3072k(kernel),11264k(rootfs)
bootcmd=bootm 0xbc1e0000
bootfile=/vmlinux.img
ethact=r8168#0
ethaddr=00:00:00:00:00:00
load=tftp 80500000 ${u-boot}
loadaddr=0x82000000
stderr=serial
stdin=serial
stdout=serial

Environment size: 533/131068 bytes
</code></pre></div>
<p dir="auto">So we can get ourselves a root shell:</p>
<div data-snippet-clipboard-copy-content="rlxboot# setenv bootargs ${bootargs} init=/bin/sh
rlxboot# ${bootcmd}"><pre><code>rlxboot# setenv bootargs ${bootargs} init=/bin/sh
rlxboot# ${bootcmd}
</code></pre></div>
<p dir="auto">Nothing is mounted or started since /sbin/init is skipped altogether
in this case.  Not even /sys and /proc.  We can emulate a semi-normal
system by running</p>
<p dir="auto"><code>/etc/rc.d/rcS</code></p>
<p dir="auto">as the first command.  And then run for example</p>
<p dir="auto"><code>telnetd -l /bin/sh</code></p>
<p dir="auto">to enable temporary passwordless telnet into the camera instead of/in
addition to the serial console. This is futile unless you have
networking of course.  Use the much simpler Bluetooth procedure described
above. Or the "mydlink" app if you prefer to establish a network connection
to your camera.</p>
<p dir="auto">Then run the following commands:</p>
<p dir="auto"><code>grep -Eq ^admin: /etc/passwd || echo admin:x:0:0::/:/bin/sh &gt;&gt;/etc/passwd</code></p>
<p dir="auto"><code>grep -Eq ^admin:x: /etc/passwd &amp;&amp; echo "admin:$(pibinfo Pincode)" | chpasswd</code></p>
<p dir="auto"><code>tdb set HTTPServer Enable_byte=1"</code></p>
<p dir="auto"><code>tdb set HTTPAccount AdminPasswd_ss="$(pibinfo Pincode)"</code></p>
<p dir="auto"><code>/etc/rc.d/init.d/extra_lighttpd.sh start</code></p>
<p dir="auto">on the local machine, run</p>
<p dir="auto"><code>$ curl --http1.0 -u admin:CAMPIN --form upload=@DCS-8000LH_Ax_v2.02.02_3014.bin http://CAM.IP/config/firmwareupgrade.cgi curl: (52) Empty reply from server</code></p>
<p dir="auto">this will downgrade the firmware to 2.02.02.</p>
<p dir="auto">Repeat the bluetooth hack or using serial to re-enable lighttpd server on your camera and run
the following command on your local machine.</p>
<p dir="auto"><code>$ curl --http1.0 -u admin:CAMPIN --form upload=@fw.tar http://CAM.IP/config/firmwareupgrade.cgi</code>
About 1 min later, the camera will reboot.
After the reboot process, you will have a cam with all the goodies mentioned above with fw 2.02.02.</p>
<h3 tabindex="-1" dir="auto">OEM boot log</h3>
<div data-snippet-clipboard-copy-content="U-Boot 2014.01-rc2-V1.1 (Jun 06 2018 - 03:44:37)

rx5281 prid=0xdc02
DRAM:  64 MiB @ 800 MHz
Skipping flash_init
Flash: 0 Bytes
flash status is 0, 2, 0
SF: Detected W25Q128FV with page size 256 Bytes, erase size 64 KiB, total 16 MiB
Using default environment

In:    serial
Out:   serial
Err:   serial
Net:   Realtek PCIe GBE Family Controller mcfg = 0024
no hw config header
new_ethaddr = 00:00:00:00:00:00
r8168#0
no hw config header
Press ESC to abort autoboot in 3 seconds## Booting kernel from Legacy Image at bc1e0000 ...
get header OKimage_get_kernel check hcrc
image_get_kernel print contents
   Image Name:   linux_3.10
   Created:      2018-06-05  19:44:27 UTC
   Image Type:   MIPS Linux Kernel Image (uncompressed)
   Data Size:    1662157 Bytes = 1.6 MiB
   Load Address: 804d4960
   Entry Point:  804d4960
   Verifying Checksum ... OK
   Loading Kernel Image ... OK

Starting kernel ...

Linux version 3.10.27 (jenkins@DMdssdFW1) (gcc version 4.8.5 20150209 (prerelease) (Realtek RSDK-4.8.5p1 Build 2278) ) #1 PREEMPT Wed Jun 6 03:36:32 CST 2018
prom cpufreq = 500000000
prom memsize = 67108864
hw_ver: 0x1, hw_rev: 0x2, isp_ver: 0x0
bootconsole [early0] enabled
CPU revision is: 0000dc02
Determined physical RAM map:
 memory: 04000000 @ 00000000 (usable)
Reserved contiguous memory at 0x4f3000
Zone ranges:
  Normal   [mem 0x00000000-0x03ffffff]
Movable zone start for each node
Early memory node ranges
  node   0: [mem 0x00000000-0x03ffffff]
icache: 32kB/32B, dcache: 16kB/32B, scache: 0kB/0B
Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 16256
Kernel command line: console=ttyS1,57600 root=/dev/mtdblock8 rts_hconf.hconf_mtd_idx=0 mtdparts=m25p80:256k(boot),128k(pib),1024k(userdata),128k(db),128k(log),128k(dbbackup),128k(logbackup),3072k(kernel),11264k(rootfs)
PID hash table entries: 256 (order: -2, 1024 bytes)
Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)
Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)
Memory: 48600k/65536k available (3844k kernel code, 16936k reserved, 888k data, 192k init, 0k highmem)
SLUB: HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
Preemptible hierarchical RCU implementation.
NR_IRQS:49
Calibrating delay loop... 498.89 BogoMIPS (lpj=2494464)
pid_max: default: 32768 minimum: 301
Mount-cache hash table entries: 512
pinctrl core: initialized pinctrl subsystem
regulator-dummy: no parameters
NET: Registered protocol family 16
rtsxb2 registered with IRQs
INFO: initializing USB host ...
INFO: initializing spi host ...0
spi platform id is 0
INFO: initializing I2C master ...
INFO: initializing DMA controller ...
INFO: initializing SD controller ...
INFO: initializing snd device ...
snd resvd mem size : 1048576
INFO: initializing pinctrl device ...
pinctrl_platform pinctrl_platform: rtspc registered with IRQs
INFO: initializing ethernet devices ...
INFO: initializing dwc_otg devices ...
INFO: initializing USB phy ...
INFO: initializing ISP device ...
isp resvd mem addr : 0x005f3000, size : 0xa00000
ISP camera platform devices added
INFO: initializing watchdog controller ...
INFO: initializing PWM controller ...
INFO: initializing crypto device ...
INFO: initializing pmu device ...
bio: create slab <bio-0> at 0
rts_dmac rts_dmac: DesignWare DMA Controller, 1 channels
INFO: realtek DMA engine inited
SCSI subsystem initialized
spic-platform spic-platform.0: master is unqueued, this is deprecated
INFO:allocate spi master 0, 0
usbcore: registered new interface driver usbfs
usbcore: registered new interface driver hub
usbcore: registered new device driver usb
usbphy-platform usbphy-platform: Initialized Realtek IPCam USB Phy module
Linux video capture interface: v2.00
Advanced Linux Sound Architecture Driver Initialized.
Bluetooth: Core ver 2.16
NET: Registered protocol family 31
Bluetooth: HCI device and connection manager initialized
Bluetooth: HCI socket layer initialized
Bluetooth: L2CAP socket layer initialized
Bluetooth: SCO socket layer initialized
NET: Registered protocol family 2
TCP established hash table entries: 512 (order: 0, 4096 bytes)
TCP bind hash table entries: 512 (order: -1, 2048 bytes)
TCP: Hash tables configured (established 512 bind 512)
TCP: reno registered
UDP hash table entries: 256 (order: 0, 4096 bytes)
UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
NET: Registered protocol family 1
RPC: Registered named UNIX socket transport module.
RPC: Registered udp transport module.
RPC: Registered tcp transport module.
RPC: Registered tcp NFSv4.1 backchannel transport module.
squashfs: version 4.0 (2009/01/31) Phillip Lougher
NFS: Registering the id_resolver key type
Key type id_resolver registered
Key type id_legacy registered
jffs2: version 2.2. (NAND) © 2001-2006 Red Hat, Inc.
msgmni has been set to 94
NET: Registered protocol family 38
Block layer SCSI generic (bsg) driver version 0.4 loaded (major 253)
io scheduler noop registered
io scheduler deadline registered
io scheduler cfq registered (default)
Serial: 8250/16550 driver, 3 ports, IRQ sharing disabled
serial8250: ttyS0 at MMIO 0x18810000 (irq = 6) is a 16550A
console [ttyS1] enabled, bootconsole disabled
console [ttyS1] enabled, bootconsole disabled
serial8250: ttyS1 at MMIO 0x18810100 (irq = 6) is a 16550A
serial8250: ttyS2 at MMIO 0x18810200 (irq = 6) is a 16550A
dbg_iomem initialized!
m25p80 spi0.0: unrecognized id mx25l12845e
m25p80 spi0.0: found w25q128fv, expected m25p80
m25p80 spi0.0: w25q128fv (16384 Kbytes)
9 cmdlinepart partitions found on MTD device m25p80
Creating 9 MTD partitions on &quot;m25p80&quot;:
0x000000000000-0x000000040000 : &quot;boot&quot;
0x000000040000-0x000000060000 : &quot;pib&quot;
0x000000060000-0x000000160000 : &quot;userdata&quot;
0x000000160000-0x000000180000 : &quot;db&quot;
0x000000180000-0x0000001a0000 : &quot;log&quot;
0x0000001a0000-0x0000001c0000 : &quot;dbbackup&quot;
0x0000001c0000-0x0000001e0000 : &quot;logbackup&quot;
0x0000001e0000-0x0000004e0000 : &quot;kernel&quot;
0x0000004e0000-0x000000fe0000 : &quot;rootfs&quot;
invalid hconf_mtd_idx!
hconf init failed
rtl8168 Gigabit Ethernet driver 8.038.00-NAPI loaded
rtl8168 rtl8168 (unregistered net_device): Get invalid MAC address from flash!
eth%d: 0xb8400000, 00:00:00:00:00:00, IRQ 10
PPP generic driver version 2.4.2
PPP MPPE Compression module registered
NET: Registered protocol family 24
ehci_hcd: USB 2.0 'Enhanced' Host Controller (EHCI) Driver
ehci-rts: ehci-rts platform driver
ehci-platform ehci-platform: EHCI Host Controller
ehci-platform ehci-platform: new USB bus registered, assigned bus number 1
ehci-platform ehci-platform: irq 11, io mem 0x18100000
ehci-platform ehci-platform: USB 2.0 started, EHCI 1.00
usb usb1: New USB device found, idVendor=1d6b, idProduct=0002
usb usb1: New USB device strings: Mfr=3, Product=2, SerialNumber=1
usb usb1: Product: EHCI Host Controller
usb usb1: Manufacturer: Linux 3.10.27 ehci_hcd
usb usb1: SerialNumber: ehci-platform
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 1 port detected
ohci_hcd: USB 1.1 'Open' Host Controller (OHCI) Driver
ohci-platform ohci-platform: Generic Platform OHCI Controller
ohci-platform ohci-platform: new USB bus registered, assigned bus number 2
ohci-platform ohci-platform: irq 11, io mem 0x18180000
usb usb2: New USB device found, idVendor=1d6b, idProduct=0001
usb usb2: New USB device strings: Mfr=3, Product=2, SerialNumber=1
usb usb2: Product: Generic Platform OHCI Controller
usb usb2: Manufacturer: Linux 3.10.27 ohci_hcd
usb usb2: SerialNumber: ohci-platform
hub 2-0:1.0: USB hub found
hub 2-0:1.0: 1 port detected
dwc_otg: version 3.10b 20-MAY-2013
Core Release: 3.10a
Setting default values for core params
WARN::dwc_otg_set_param_dev_tx_fifo_size:6354: Value is larger then power-on FIFO size

WARN::dwc_otg_set_param_dev_tx_fifo_size:6354: Value is larger then power-on FIFO size

Using Buffer DMA mode
Periodic Transfer Interrupt Enhancement - disabled
Multiprocessor Interrupt Enhancement - disabled
OTG VER PARAM: 0, OTG VER FLAG: 0
Shared Tx FIFO mode
usbcore: registered new interface driver usb-storage
g_mass_storage gadget: Mass Storage Function, version: 2009/09/11
g_mass_storage gadget: Number of LUNs=1
 lun0: LUN: removable file: (no medium)
g_mass_storage gadget: Mass Storage Gadget, version: 2009/09/11
g_mass_storage gadget: g_mass_storage ready
usb device pull 1
i2c /dev entries driver
Unable to read RTP_REG_CHIP_VERSION reg
rtp_mfd 0-0030: pre_init() failed: -140
rtp_mfd: probe of 0-0030 failed with error -140
Stopped watchdog timer
timer margin: 8 sec
nf_conntrack version 0.5.0 (759 buckets, 3036 max)
ip_tables: (C) 2000-2006 Netfilter Core Team
TCP: cubic registered
NET: Registered protocol family 17
Bluetooth: RFCOMM TTY layer initialized
Bluetooth: RFCOMM socket layer initialized
usb 1-1: new high-speed USB device number 2 using ehci-platform
Bluetooth: RFCOMM ver 1.11
Bluetooth: BNEP (Ethernet Emulation) ver 1.3
Bluetooth: BNEP filters: protocol multicast
Bluetooth: BNEP socket layer initialized
Key type dns_resolver registered
ALSA device list:
  No soundcards found.
VFS: Mounted root (squashfs filesystem) readonly on device 31:8.
Freeing unused kernel memory: 192K (804b0000 - 804e0000)
usb 1-1: New USB device found, idVendor=0bda, idProduct=b720
usb 1-1: New USB device strings: Mfr=1, Product=2, SerialNumber=3
usb 1-1: Product: 802.11n WLAN Adapter
usb 1-1: Manufacturer: Realtek
usb 1-1: SerialNumber: 00e04c000001
init started: BusyBox v1.22.1 (2018-06-06 03:10:44 CST)
starting pid 54, tty '': '/etc/rc.d/rcS start'
mount: mounting none on /proc/bus/usb failed: No such file or directory
rm: can't remove '/dev/mtd9': No such file or directory
mknod: /dev/console: File exists
soc-audio soc-audio.0: ASoC: machine RLX_INTERN_CARD should use snd_soc_register_card()
soc-audio soc-audio.0:  rlx-codec-digital <-> pcm-platform mapping ok
soc-audio soc-audio.0:  rlx-codec-analog <-> pcm-platform mapping ok
pinctrl_platform pinctrl_platform: request() failed for pin 0
pinctrl_platform pinctrl_platform: pin-0 (pinctrl-rts:0) status -16
request GPIO failed
sd-platform: probe of rts3901-sdhc failed with error -16
rtscam:rtscam_soc_probe
rtscam:rtscam_hx280_probe
rtscam:hx280enc:HW at base <0x18060000> with ID <0x48314810>
rtscam:rtscam_jpgenc_probe
rtscam:rtstream_init
rtscam:begin to load fw from isp.fw
rtscam:Load firmware size : 131072.
rtscam:Found ISP 1.006 device
rtscam:video device <rts3901-isp> registered
rtscam:rts3901-isp initialized
Setup db... ok.
Startting dbd... Password for 'root' changed
ok.
set the date to default:
Wed Jun  6 00:00:00 UTC 2018
No SD Device Path Exists.
rc.sysinit start ok.
============ normal mode ===============
dbd(181) is already running.
Startting tz_dst... ok.
setsystz ok
Startting watchDog... ok.
Startting avcd... 
mic vol = 80
avcd ok.
starting create_certificate...get server.pem... ok.
Startting dbus-daemon... ok.
Startting bluetoothd... sendCmd : 0
Open /tmp/ap_list fail: No such file or directory
main[283] Fail to get channel of Kjellerbod network
configure : 
 			Wireless : essid: Kjellerbod, encryp_method: AES, auth_method: WPA2PSK 
 			Network  : dhcp_enable: 1, hostname: DCS-8000LH 
Open /proc/sys/net/ipv6/conf/wlan0/autoconf fail: No such file or directory
killall: rtspd: no process killed
killall: udhcpc: no process killed
killall: wifiAutoReconnect: no process killed
sendCmd : 0
sendCmd : 0
/bin/sh: dibbler-client: not found
killall: orthrus: no process killed
killall: orthrusipv6: no process killed
killall: pppd: no process killed
killall: zcip: no process killed
wlan1 MAC [b2:c5:54:4c:cc:73]
23186 wpa_supplicant -B -c /tmp/wpa_supplicant.conf -i wlan0 -P /tmp/wpa_supplicant.pid
rfkill: Cannot open RFKILL control device
ioctl[SIOCSIWAP]: Operation not permitted
udhcpc (v1.22.1) started
/sbin/udhcpc.sh: line 1: /etc/rc.d/init.d/zcip.sh: not found
Sending discover...
Sending discover...
Sending select for 192.168.2.37...
Lease of 192.168.2.37 obtained, lease time 432000
ifdown: interface wlan1 not configured
cat: can't open '/tmp/wifi-led.pid': No such file or directory
sh: you need to specify whom to kill
deleting routers
route: ioctl 0x890c failed: No such process
adding dns 148.122.16.253
adding dns 148.122.164.253
start network services, ...
Startting mDNSResponder... ok.
Starting rtspd... ok.
Startting ntpd... disabled.
Startting firewall...ok.
/etc/rc.d/rcS: /etc/rc.d/rcS.d/S24network.sh: line 5: /etc/rc.d/init.d/network_services_ipv6.sh: not found
Starting Apple Darwin Multicast DNS / DNS Service Discovery daemon: mdnsd.
Jun  6 02:00:32 mDNSResponder: mDNSResponder (Engineering Build) (Jun  6 2018 03:55:36) starting
Jun  6 02:00:32 mDNSResponder: mDNS_AddDNSServer: Lock not held! mDNS_busy (0) mDNS_reentrancy (0)
Jun  6 02:00:32 mDNSResponder: mDNS_AddDNSServer: Lock not held! mDNS_busy (0) mDNS_reentrancy (0)
Jun  6 02:00:32 mDNSResponder: WARNING: mdnsd continuing as root because user &quot;nobody&quot; does not exist
Startting ntpd... disabled.
Startting db_analysis... ok.
Startting firewall...ok.
rtspd(1011 878) is already running.
Startting myDlinkEvent... ok.
2018-06-06 02:00:37 | INFO    | tcp_listen               |  176| listening 127.0.0.1:7000
2018-06-06 02:00:37 | INFO    | http_listen              |   40| waiting new connections ...
rc.local start ok.
starting pid 1157, tty '': '/bin/busybox getty -L ttyS1 57600 vt100'

localhost login: May  6 22:34:35 mDNSResponder: mDNS_Execute: mDNSPlatformRawTime went backwards by 438780374 ticks; setting correction factor to -1542198966
May  6 22:34:37 mDNSResponderPosix: mDNSCoreReceive: mDNSPlatformRawTime went backwards by 438777274 ticks; setting correction factor to 1206127822"><pre><code>U-Boot 2014.01-rc2-V1.1 (Jun 06 2018 - 03:44:37)

rx5281 prid=0xdc02
DRAM:  64 MiB @ 800 MHz
Skipping flash_init
Flash: 0 Bytes
flash status is 0, 2, 0
SF: Detected W25Q128FV with page size 256 Bytes, erase size 64 KiB, total 16 MiB
Using default environment

In:    serial
Out:   serial
Err:   serial
Net:   Realtek PCIe GBE Family Controller mcfg = 0024
no hw config header
new_ethaddr = 00:00:00:00:00:00
r8168#0
no hw config header
Press ESC to abort autoboot in 3 seconds## Booting kernel from Legacy Image at bc1e0000 ...
get header OKimage_get_kernel check hcrc
image_get_kernel print contents
   Image Name:   linux_3.10
   Created:      2018-06-05  19:44:27 UTC
   Image Type:   MIPS Linux Kernel Image (uncompressed)
   Data Size:    1662157 Bytes = 1.6 MiB
   Load Address: 804d4960
   Entry Point:  804d4960
   Verifying Checksum ... OK
   Loading Kernel Image ... OK

Starting kernel ...

Linux version 3.10.27 (jenkins@DMdssdFW1) (gcc version 4.8.5 20150209 (prerelease) (Realtek RSDK-4.8.5p1 Build 2278) ) #1 PREEMPT Wed Jun 6 03:36:32 CST 2018
prom cpufreq = 500000000
prom memsize = 67108864
hw_ver: 0x1, hw_rev: 0x2, isp_ver: 0x0
bootconsole [early0] enabled
CPU revision is: 0000dc02
Determined physical RAM map:
 memory: 04000000 @ 00000000 (usable)
Reserved contiguous memory at 0x4f3000
Zone ranges:
  Normal   [mem 0x00000000-0x03ffffff]
Movable zone start for each node
Early memory node ranges
  node   0: [mem 0x00000000-0x03ffffff]
icache: 32kB/32B, dcache: 16kB/32B, scache: 0kB/0B
Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 16256
Kernel command line: console=ttyS1,57600 root=/dev/mtdblock8 rts_hconf.hconf_mtd_idx=0 mtdparts=m25p80:256k(boot),128k(pib),1024k(userdata),128k(db),128k(log),128k(dbbackup),128k(logbackup),3072k(kernel),11264k(rootfs)
PID hash table entries: 256 (order: -2, 1024 bytes)
Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)
Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)
Memory: 48600k/65536k available (3844k kernel code, 16936k reserved, 888k data, 192k init, 0k highmem)
SLUB: HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
Preemptible hierarchical RCU implementation.
NR_IRQS:49
Calibrating delay loop... 498.89 BogoMIPS (lpj=2494464)
pid_max: default: 32768 minimum: 301
Mount-cache hash table entries: 512
pinctrl core: initialized pinctrl subsystem
regulator-dummy: no parameters
NET: Registered protocol family 16
rtsxb2 registered with IRQs
INFO: initializing USB host ...
INFO: initializing spi host ...0
spi platform id is 0
INFO: initializing I2C master ...
INFO: initializing DMA controller ...
INFO: initializing SD controller ...
INFO: initializing snd device ...
snd resvd mem size : 1048576
INFO: initializing pinctrl device ...
pinctrl_platform pinctrl_platform: rtspc registered with IRQs
INFO: initializing ethernet devices ...
INFO: initializing dwc_otg devices ...
INFO: initializing USB phy ...
INFO: initializing ISP device ...
isp resvd mem addr : 0x005f3000, size : 0xa00000
ISP camera platform devices added
INFO: initializing watchdog controller ...
INFO: initializing PWM controller ...
INFO: initializing crypto device ...
INFO: initializing pmu device ...
bio: create slab &lt;bio-0&gt; at 0
rts_dmac rts_dmac: DesignWare DMA Controller, 1 channels
INFO: realtek DMA engine inited
SCSI subsystem initialized
spic-platform spic-platform.0: master is unqueued, this is deprecated
INFO:allocate spi master 0, 0
usbcore: registered new interface driver usbfs
usbcore: registered new interface driver hub
usbcore: registered new device driver usb
usbphy-platform usbphy-platform: Initialized Realtek IPCam USB Phy module
Linux video capture interface: v2.00
Advanced Linux Sound Architecture Driver Initialized.
Bluetooth: Core ver 2.16
NET: Registered protocol family 31
Bluetooth: HCI device and connection manager initialized
Bluetooth: HCI socket layer initialized
Bluetooth: L2CAP socket layer initialized
Bluetooth: SCO socket layer initialized
NET: Registered protocol family 2
TCP established hash table entries: 512 (order: 0, 4096 bytes)
TCP bind hash table entries: 512 (order: -1, 2048 bytes)
TCP: Hash tables configured (established 512 bind 512)
TCP: reno registered
UDP hash table entries: 256 (order: 0, 4096 bytes)
UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
NET: Registered protocol family 1
RPC: Registered named UNIX socket transport module.
RPC: Registered udp transport module.
RPC: Registered tcp transport module.
RPC: Registered tcp NFSv4.1 backchannel transport module.
squashfs: version 4.0 (2009/01/31) Phillip Lougher
NFS: Registering the id_resolver key type
Key type id_resolver registered
Key type id_legacy registered
jffs2: version 2.2. (NAND) © 2001-2006 Red Hat, Inc.
msgmni has been set to 94
NET: Registered protocol family 38
Block layer SCSI generic (bsg) driver version 0.4 loaded (major 253)
io scheduler noop registered
io scheduler deadline registered
io scheduler cfq registered (default)
Serial: 8250/16550 driver, 3 ports, IRQ sharing disabled
serial8250: ttyS0 at MMIO 0x18810000 (irq = 6) is a 16550A
console [ttyS1] enabled, bootconsole disabled
console [ttyS1] enabled, bootconsole disabled
serial8250: ttyS1 at MMIO 0x18810100 (irq = 6) is a 16550A
serial8250: ttyS2 at MMIO 0x18810200 (irq = 6) is a 16550A
dbg_iomem initialized!
m25p80 spi0.0: unrecognized id mx25l12845e
m25p80 spi0.0: found w25q128fv, expected m25p80
m25p80 spi0.0: w25q128fv (16384 Kbytes)
9 cmdlinepart partitions found on MTD device m25p80
Creating 9 MTD partitions on "m25p80":
0x000000000000-0x000000040000 : "boot"
0x000000040000-0x000000060000 : "pib"
0x000000060000-0x000000160000 : "userdata"
0x000000160000-0x000000180000 : "db"
0x000000180000-0x0000001a0000 : "log"
0x0000001a0000-0x0000001c0000 : "dbbackup"
0x0000001c0000-0x0000001e0000 : "logbackup"
0x0000001e0000-0x0000004e0000 : "kernel"
0x0000004e0000-0x000000fe0000 : "rootfs"
invalid hconf_mtd_idx!
hconf init failed
rtl8168 Gigabit Ethernet driver 8.038.00-NAPI loaded
rtl8168 rtl8168 (unregistered net_device): Get invalid MAC address from flash!
eth%d: 0xb8400000, 00:00:00:00:00:00, IRQ 10
PPP generic driver version 2.4.2
PPP MPPE Compression module registered
NET: Registered protocol family 24
ehci_hcd: USB 2.0 'Enhanced' Host Controller (EHCI) Driver
ehci-rts: ehci-rts platform driver
ehci-platform ehci-platform: EHCI Host Controller
ehci-platform ehci-platform: new USB bus registered, assigned bus number 1
ehci-platform ehci-platform: irq 11, io mem 0x18100000
ehci-platform ehci-platform: USB 2.0 started, EHCI 1.00
usb usb1: New USB device found, idVendor=1d6b, idProduct=0002
usb usb1: New USB device strings: Mfr=3, Product=2, SerialNumber=1
usb usb1: Product: EHCI Host Controller
usb usb1: Manufacturer: Linux 3.10.27 ehci_hcd
usb usb1: SerialNumber: ehci-platform
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 1 port detected
ohci_hcd: USB 1.1 'Open' Host Controller (OHCI) Driver
ohci-platform ohci-platform: Generic Platform OHCI Controller
ohci-platform ohci-platform: new USB bus registered, assigned bus number 2
ohci-platform ohci-platform: irq 11, io mem 0x18180000
usb usb2: New USB device found, idVendor=1d6b, idProduct=0001
usb usb2: New USB device strings: Mfr=3, Product=2, SerialNumber=1
usb usb2: Product: Generic Platform OHCI Controller
usb usb2: Manufacturer: Linux 3.10.27 ohci_hcd
usb usb2: SerialNumber: ohci-platform
hub 2-0:1.0: USB hub found
hub 2-0:1.0: 1 port detected
dwc_otg: version 3.10b 20-MAY-2013
Core Release: 3.10a
Setting default values for core params
WARN::dwc_otg_set_param_dev_tx_fifo_size:6354: Value is larger then power-on FIFO size

WARN::dwc_otg_set_param_dev_tx_fifo_size:6354: Value is larger then power-on FIFO size

Using Buffer DMA mode
Periodic Transfer Interrupt Enhancement - disabled
Multiprocessor Interrupt Enhancement - disabled
OTG VER PARAM: 0, OTG VER FLAG: 0
Shared Tx FIFO mode
usbcore: registered new interface driver usb-storage
g_mass_storage gadget: Mass Storage Function, version: 2009/09/11
g_mass_storage gadget: Number of LUNs=1
 lun0: LUN: removable file: (no medium)
g_mass_storage gadget: Mass Storage Gadget, version: 2009/09/11
g_mass_storage gadget: g_mass_storage ready
usb device pull 1
i2c /dev entries driver
Unable to read RTP_REG_CHIP_VERSION reg
rtp_mfd 0-0030: pre_init() failed: -140
rtp_mfd: probe of 0-0030 failed with error -140
Stopped watchdog timer
timer margin: 8 sec
nf_conntrack version 0.5.0 (759 buckets, 3036 max)
ip_tables: (C) 2000-2006 Netfilter Core Team
TCP: cubic registered
NET: Registered protocol family 17
Bluetooth: RFCOMM TTY layer initialized
Bluetooth: RFCOMM socket layer initialized
usb 1-1: new high-speed USB device number 2 using ehci-platform
Bluetooth: RFCOMM ver 1.11
Bluetooth: BNEP (Ethernet Emulation) ver 1.3
Bluetooth: BNEP filters: protocol multicast
Bluetooth: BNEP socket layer initialized
Key type dns_resolver registered
ALSA device list:
  No soundcards found.
VFS: Mounted root (squashfs filesystem) readonly on device 31:8.
Freeing unused kernel memory: 192K (804b0000 - 804e0000)
usb 1-1: New USB device found, idVendor=0bda, idProduct=b720
usb 1-1: New USB device strings: Mfr=1, Product=2, SerialNumber=3
usb 1-1: Product: 802.11n WLAN Adapter
usb 1-1: Manufacturer: Realtek
usb 1-1: SerialNumber: 00e04c000001
init started: BusyBox v1.22.1 (2018-06-06 03:10:44 CST)
starting pid 54, tty '': '/etc/rc.d/rcS start'
mount: mounting none on /proc/bus/usb failed: No such file or directory
rm: can't remove '/dev/mtd9': No such file or directory
mknod: /dev/console: File exists
soc-audio soc-audio.0: ASoC: machine RLX_INTERN_CARD should use snd_soc_register_card()
soc-audio soc-audio.0:  rlx-codec-digital &lt;-&gt; pcm-platform mapping ok
soc-audio soc-audio.0:  rlx-codec-analog &lt;-&gt; pcm-platform mapping ok
pinctrl_platform pinctrl_platform: request() failed for pin 0
pinctrl_platform pinctrl_platform: pin-0 (pinctrl-rts:0) status -16
request GPIO failed
sd-platform: probe of rts3901-sdhc failed with error -16
rtscam:rtscam_soc_probe
rtscam:rtscam_hx280_probe
rtscam:hx280enc:HW at base &lt;0x18060000&gt; with ID &lt;0x48314810&gt;
rtscam:rtscam_jpgenc_probe
rtscam:rtstream_init
rtscam:begin to load fw from isp.fw
rtscam:Load firmware size : 131072.
rtscam:Found ISP 1.006 device
rtscam:video device &lt;rts3901-isp&gt; registered
rtscam:rts3901-isp initialized
Setup db... ok.
Startting dbd... Password for 'root' changed
ok.
set the date to default:
Wed Jun  6 00:00:00 UTC 2018
No SD Device Path Exists.
rc.sysinit start ok.
============ normal mode ===============
dbd(181) is already running.
Startting tz_dst... ok.
setsystz ok
Startting watchDog... ok.
Startting avcd... 
mic vol = 80
avcd ok.
starting create_certificate...get server.pem... ok.
Startting dbus-daemon... ok.
Startting bluetoothd... sendCmd : 0
Open /tmp/ap_list fail: No such file or directory
main[283] Fail to get channel of Kjellerbod network
configure : 
 			Wireless : essid: Kjellerbod, encryp_method: AES, auth_method: WPA2PSK 
 			Network  : dhcp_enable: 1, hostname: DCS-8000LH 
Open /proc/sys/net/ipv6/conf/wlan0/autoconf fail: No such file or directory
killall: rtspd: no process killed
killall: udhcpc: no process killed
killall: wifiAutoReconnect: no process killed
sendCmd : 0
sendCmd : 0
/bin/sh: dibbler-client: not found
killall: orthrus: no process killed
killall: orthrusipv6: no process killed
killall: pppd: no process killed
killall: zcip: no process killed
wlan1 MAC [b2:c5:54:4c:cc:73]
23186 wpa_supplicant -B -c /tmp/wpa_supplicant.conf -i wlan0 -P /tmp/wpa_supplicant.pid
rfkill: Cannot open RFKILL control device
ioctl[SIOCSIWAP]: Operation not permitted
udhcpc (v1.22.1) started
/sbin/udhcpc.sh: line 1: /etc/rc.d/init.d/zcip.sh: not found
Sending discover...
Sending discover...
Sending select for 192.168.2.37...
Lease of 192.168.2.37 obtained, lease time 432000
ifdown: interface wlan1 not configured
cat: can't open '/tmp/wifi-led.pid': No such file or directory
sh: you need to specify whom to kill
deleting routers
route: ioctl 0x890c failed: No such process
adding dns 148.122.16.253
adding dns 148.122.164.253
start network services, ...
Startting mDNSResponder... ok.
Starting rtspd... ok.
Startting ntpd... disabled.
Startting firewall...ok.
/etc/rc.d/rcS: /etc/rc.d/rcS.d/S24network.sh: line 5: /etc/rc.d/init.d/network_services_ipv6.sh: not found
Starting Apple Darwin Multicast DNS / DNS Service Discovery daemon: mdnsd.
Jun  6 02:00:32 mDNSResponder: mDNSResponder (Engineering Build) (Jun  6 2018 03:55:36) starting
Jun  6 02:00:32 mDNSResponder: mDNS_AddDNSServer: Lock not held! mDNS_busy (0) mDNS_reentrancy (0)
Jun  6 02:00:32 mDNSResponder: mDNS_AddDNSServer: Lock not held! mDNS_busy (0) mDNS_reentrancy (0)
Jun  6 02:00:32 mDNSResponder: WARNING: mdnsd continuing as root because user "nobody" does not exist
Startting ntpd... disabled.
Startting db_analysis... ok.
Startting firewall...ok.
rtspd(1011 878) is already running.
Startting myDlinkEvent... ok.
2018-06-06 02:00:37 | INFO    | tcp_listen               |  176| listening 127.0.0.1:7000
2018-06-06 02:00:37 | INFO    | http_listen              |   40| waiting new connections ...
rc.local start ok.
starting pid 1157, tty '': '/bin/busybox getty -L ttyS1 57600 vt100'

localhost login: May  6 22:34:35 mDNSResponder: mDNS_Execute: mDNSPlatformRawTime went backwards by 438780374 ticks; setting correction factor to -1542198966
May  6 22:34:37 mDNSResponderPosix: mDNSCoreReceive: mDNSPlatformRawTime went backwards by 438777274 ticks; setting correction factor to 1206127822
</code></pre></div>
<h3 tabindex="-1" dir="auto"><a name="user-content-Partitions"></a>Partitions</h3>
<p dir="auto">The D-Link DCS-8000LH partitions are:</p>
<div data-snippet-clipboard-copy-content="# cat /proc/mtd 
dev:    size   erasesize  name
mtd0: 00040000 00010000 &quot;boot&quot;
mtd1: 00020000 00010000 &quot;pib&quot;
mtd2: 00100000 00010000 &quot;userdata&quot;
mtd3: 00020000 00010000 &quot;db&quot;
mtd4: 00020000 00010000 &quot;log&quot;
mtd5: 00020000 00010000 &quot;dbbackup&quot;
mtd6: 00020000 00010000 &quot;logbackup&quot;
mtd7: 00300000 00010000 &quot;kernel&quot;
mtd8: 00b00000 00010000 &quot;rootfs&quot;"><pre><code># cat /proc/mtd 
dev:    size   erasesize  name
mtd0: 00040000 00010000 "boot"
mtd1: 00020000 00010000 "pib"
mtd2: 00100000 00010000 "userdata"
mtd3: 00020000 00010000 "db"
mtd4: 00020000 00010000 "log"
mtd5: 00020000 00010000 "dbbackup"
mtd6: 00020000 00010000 "logbackup"
mtd7: 00300000 00010000 "kernel"
mtd8: 00b00000 00010000 "rootfs"
</code></pre></div>
<p dir="auto">Or as seen by the driver with start and end addresses:</p>
<div data-snippet-clipboard-copy-content="9 cmdlinepart partitions found on MTD device m25p80
Creating 9 MTD partitions on &quot;m25p80&quot;:
0x000000000000-0x000000040000 : &quot;boot&quot;
0x000000040000-0x000000060000 : &quot;pib&quot;
0x000000060000-0x000000160000 : &quot;userdata&quot;
0x000000160000-0x000000180000 : &quot;db&quot;
0x000000180000-0x0000001a0000 : &quot;log&quot;
0x0000001a0000-0x0000001c0000 : &quot;dbbackup&quot;
0x0000001c0000-0x0000001e0000 : &quot;logbackup&quot;
0x0000001e0000-0x0000004e0000 : &quot;kernel&quot;
0x0000004e0000-0x000000fe0000 : &quot;rootfs&quot;"><pre><code>9 cmdlinepart partitions found on MTD device m25p80
Creating 9 MTD partitions on "m25p80":
0x000000000000-0x000000040000 : "boot"
0x000000040000-0x000000060000 : "pib"
0x000000060000-0x000000160000 : "userdata"
0x000000160000-0x000000180000 : "db"
0x000000180000-0x0000001a0000 : "log"
0x0000001a0000-0x0000001c0000 : "dbbackup"
0x0000001c0000-0x0000001e0000 : "logbackup"
0x0000001e0000-0x0000004e0000 : "kernel"
0x0000004e0000-0x000000fe0000 : "rootfs"
</code></pre></div>
<p dir="auto">Partition usage:</p>
<table>
<thead>
<tr>
<th>number</th>
<th>name</th>
<th>start</th>
<th>end</th>
<th>size</th>
<th>fstype</th>
<th>contents</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>"boot"</td>
<td>0x000000</td>
<td>0x040000</td>
<td>0x40000</td>
<td>boot</td>
<td>U-Boot</td>
</tr>
<tr>
<td>1</td>
<td>"pib"</td>
<td>0x040000</td>
<td>0x060000</td>
<td>0x20000</td>
<td>raw</td>
<td>device info</td>
</tr>
<tr>
<td>2</td>
<td>"userdata"</td>
<td>0x060000</td>
<td>0x160000</td>
<td>0x100000</td>
<td>squashfs</td>
<td>mydlink (/opt)</td>
</tr>
<tr>
<td>3</td>
<td>"db"</td>
<td>0x160000</td>
<td>0x180000</td>
<td>0x20000</td>
<td>tar.gz</td>
<td>non-volatile data</td>
</tr>
<tr>
<td>4</td>
<td>"log"</td>
<td>0x180000</td>
<td>0x1a0000</td>
<td>0x20000</td>
<td>raw?</td>
<td>empty</td>
</tr>
<tr>
<td>5</td>
<td>"dbbackup"</td>
<td>0x1a0000</td>
<td>0x1c0000</td>
<td>0x20000</td>
<td>tar.gz</td>
<td>copy of "db"</td>
</tr>
<tr>
<td>6</td>
<td>"logbackup"</td>
<td>0x1c0000</td>
<td>0x1e0000</td>
<td>0x20000</td>
<td>raw?</td>
<td>empty</td>
</tr>
<tr>
<td>7</td>
<td>"kernel"</td>
<td>0x1e0000</td>
<td>0x4e0000</td>
<td>0x300000</td>
<td>uImage</td>
<td>Linux 3.10</td>
</tr>
<tr>
<td>8</td>
<td>"rootfs"</td>
<td>0x4e0000</td>
<td>0xfe0000</td>
<td>0xb00000</td>
<td>squashfs</td>
<td>rootfs (/)</td>
</tr>
</tbody>
</table>
<p dir="auto">The D-Link firmware updates I have looked at will replace the
"userdata", "kernel" and "rootfs" partitions, but leave other
partitions unchanged. I imagine that the "boot" partition might be
upgraded too if deemed necessary by D-Link. But it was not touched
when going from 2.01.03 to 2.02.02.</p>
<p dir="auto">The "log" and "logbackup" appear to be currently unused.  But I am
reluctant trusting this, given their names.  I guess they could be
cleaned and overwritten anytime.  They are too small to be very useful
anyway.  You can't put any writable file system om them with only two
erase blocks.</p>
<h3 tabindex="-1" dir="auto">Backing up dynamic data</h3>
<p dir="auto">This is not necessary for system operation as any non-volatile data is
saved in the <a href="#Partitions"><strong>db</strong></a> partition anyway.  But it can still be useful to
have a copy of the system state for offline studying, so I also like
to save a working copy of /tmp:</p>
<div data-snippet-clipboard-copy-content="tar zcvf /tmp/tmp.tgz /tmp/
tftp -l /tmp/tmp.tgz -r tmp.tgz -p 192.168.2.1"><pre><code>tar zcvf /tmp/tmp.tgz /tmp/
tftp -l /tmp/tmp.tgz -r tmp.tgz -p 192.168.2.1
</code></pre></div>
<h3 tabindex="-1" dir="auto">Why can we run the NIPCA webserver before we modify the firmware?</h3>
<p dir="auto">D-Link left all the webserver parts in the firmware, including all the
NIPCA CGI tools. The only change they made was disabling the startup
script.</p>
<p dir="auto">The webserver can be enabled and started manually from the shell by
running:</p>
<div data-snippet-clipboard-copy-content="tdb set HTTPServer Enable_byte=1
/etc/rc.d/init.d/extra_lighttpd.sh start"><pre><code>tdb set HTTPServer Enable_byte=1
/etc/rc.d/init.d/extra_lighttpd.sh start
</code></pre></div>
<p dir="auto">This is precisely what our Bluetooth tool does when it is called with
the <strong>--lighttpd</strong> option.</p>
<p dir="auto">The <code>HTTPServer Enable_byte</code> is persistent, so setting is only
necessary once. Unless you do a factory reset.</p>
<h3 tabindex="-1" dir="auto">What's the problem with the RTSP server in the unmodified firmware?</h3>
<p dir="auto">The original D-Link firmware is already running <strong>rtspd</strong>, but it is only
listening on the loopback address 127.0.0.1.  It is probably intended
as a backend server for the <strong>mydlink</strong> services.</p>
<p dir="auto">We can make rtspd listen on all addresses by clearing the <strong>RTPServer
RejectExtIP</strong> setting.  Both rtspd and the firewall need a restart for
this to have an effect.  Enabling <strong>RTPServer Authenticate</strong> is
probably a good idea when doing this, to prevent the camera from
streaming to anyone who can connect.</p>
<div data-snippet-clipboard-copy-content="tdb set RTPServer RejectExtIP_byte=0
tdb set RTPServer Authenticate_byte=1
/etc/rc.d/init.d/firewall.sh reload
/etc/rc.d/init.d/rtspd.sh restart"><pre><code>tdb set RTPServer RejectExtIP_byte=0
tdb set RTPServer Authenticate_byte=1
/etc/rc.d/init.d/firewall.sh reload
/etc/rc.d/init.d/rtspd.sh restart
</code></pre></div>
<p dir="auto">These settings are persistent as usual, so they only need to be
modified after factory resets. Changing the settings and then
rebooting the camera will therefore enable remote RTSP access, since
both services are running by default in the D-Link firmware.</p>
<h3 tabindex="-1" dir="auto">The "userdata" file system</h3>
<p dir="auto">The <a href="#Partitions"><strong>userdata</strong></a> you backed up as <strong>mtd2</strong> contains a xz compressed
squasfs file system, with most of the mydlink cloud tools. The file
system can be unpacked on a Linux system using unsquashfs:</p>
<div data-snippet-clipboard-copy-content="$ unsquashfs mtd2
Parallel unsquashfs: Using 4 processors
15 inodes (22 blocks) to write

[=============================================================================================================================================================================================================|] 22/22 100%

created 12 files
created 1 directories
created 3 symlinks
created 0 devices
created 0 fifos
$ ls -la squashfs-root/
total 1156
drwxr-xr-x  2 bjorn bjorn    340 Feb 14 10:58 .
drwxrwxrwt 41 root  root    2280 May 13 15:13 ..
-rwxr-xr-x  1 bjorn bjorn  13184 Feb 14 10:58 ca-refresh
-rwxr-xr-x  1 bjorn bjorn 273692 Feb 14 10:58 cda
lrwxrwxrwx  1 bjorn bjorn      9 May 13 15:13 cert -> /tmp/cert
-rwxr-xr-x  1 bjorn bjorn   5991 Feb 14 10:58 client-ca.crt.pem
lrwxrwxrwx  1 bjorn bjorn      7 May 13 15:13 config -> /tmp/db
-rwxr-xr-x  1 bjorn bjorn 436428 Feb 14 10:58 da_adaptor
-rwxr-xr-x  1 bjorn bjorn      4 Feb 14 10:58 dcp_version
-rwxr-xr-x  1 bjorn bjorn    814 Feb 14 10:58 device.cfg
lrwxrwxrwx  1 bjorn bjorn     17 May 13 15:13 lib -> /var/libevent/lib
-rwxr-xr-x  1 bjorn bjorn      5 Feb 14 10:58 m2m
-rwxr-xr-x  1 bjorn bjorn   6220 Feb 14 10:58 mydlink_watchdog.sh
-rwxr-xr-x  1 bjorn bjorn   1034 Feb 14 10:58 opt.local
-rwxr-xr-x  1 bjorn bjorn 171828 Feb 14 10:58 sa
-rwxr-xr-x  1 bjorn bjorn 242028 Feb 14 10:58 strmsvr
-rwxr-xr-x  1 bjorn bjorn     10 Feb 14 10:58 version"><pre><code>$ unsquashfs mtd2
Parallel unsquashfs: Using 4 processors
15 inodes (22 blocks) to write

[=============================================================================================================================================================================================================|] 22/22 100%

created 12 files
created 1 directories
created 3 symlinks
created 0 devices
created 0 fifos
$ ls -la squashfs-root/
total 1156
drwxr-xr-x  2 bjorn bjorn    340 Feb 14 10:58 .
drwxrwxrwt 41 root  root    2280 May 13 15:13 ..
-rwxr-xr-x  1 bjorn bjorn  13184 Feb 14 10:58 ca-refresh
-rwxr-xr-x  1 bjorn bjorn 273692 Feb 14 10:58 cda
lrwxrwxrwx  1 bjorn bjorn      9 May 13 15:13 cert -&gt; /tmp/cert
-rwxr-xr-x  1 bjorn bjorn   5991 Feb 14 10:58 client-ca.crt.pem
lrwxrwxrwx  1 bjorn bjorn      7 May 13 15:13 config -&gt; /tmp/db
-rwxr-xr-x  1 bjorn bjorn 436428 Feb 14 10:58 da_adaptor
-rwxr-xr-x  1 bjorn bjorn      4 Feb 14 10:58 dcp_version
-rwxr-xr-x  1 bjorn bjorn    814 Feb 14 10:58 device.cfg
lrwxrwxrwx  1 bjorn bjorn     17 May 13 15:13 lib -&gt; /var/libevent/lib
-rwxr-xr-x  1 bjorn bjorn      5 Feb 14 10:58 m2m
-rwxr-xr-x  1 bjorn bjorn   6220 Feb 14 10:58 mydlink_watchdog.sh
-rwxr-xr-x  1 bjorn bjorn   1034 Feb 14 10:58 opt.local
-rwxr-xr-x  1 bjorn bjorn 171828 Feb 14 10:58 sa
-rwxr-xr-x  1 bjorn bjorn 242028 Feb 14 10:58 strmsvr
-rwxr-xr-x  1 bjorn bjorn     10 Feb 14 10:58 version
</code></pre></div>
<p dir="auto">The primary entry point here is the <strong>opt.local</strong> init-script.  This
is also the only required file.  The <strong>version</strong> file is read by the
Bluetooth API, and reported as the mydlink version, which makes it
useful for verifying a modified camera.  Our alternate
<a href="#Partitions"><strong>userdata</strong></a> file system contains only these two
files. But one could imagine including a number of other useful tools,
like tcpdump, a ssh server etc.</p>
<p dir="auto">It is also possible to keep all the D-Link files, if that's
wanted. The original <strong>opt.local</strong> script can be modified to leave
mydlink support running while still starting other features.  We could
even add our own non-volatile setting to choose one or the other, or
both, and making it a configuration thing. Fantasy is the only
limiting factor.</p>
<p dir="auto">Repacking the files into a camera compatible squashfs file system:</p>
<div data-snippet-clipboard-copy-content="mksquashfs squashfs-root mtd2.new -all-root -comp xz"><pre><code>mksquashfs squashfs-root mtd2.new -all-root -comp xz
</code></pre></div>
<p dir="auto">Note that <strong>xz</strong> compression is required.  No other compression is
supported AFAIK.</p>
<p dir="auto">There are simpler ways to write the new file system to the camera than
creating a firmware update package, if you just want to test it. One
example:</p>
<div data-snippet-clipboard-copy-content="tftp -r mtd2.new -l /tmp/mtd2.new -g 192.168.2.1
cat /tmp/mtd2.new >/dev/mtdblock2 "><pre><code>tftp -r mtd2.new -l /tmp/mtd2.new -g 192.168.2.1
cat /tmp/mtd2.new &gt;/dev/mtdblock2 
</code></pre></div>
<p dir="auto">But DON'T do that unless you both have a backup and know what you are
doing...</p>
<p dir="auto">You should reboot the camera after doing this, unless you make sure
you stop any process running from the previous /opt system and remount
it properly.</p>
<h3 tabindex="-1" dir="auto"><a name="user-content-NIPCA"></a>Using NIPCA to manage the camera</h3>
<p dir="auto">The local web server provides a direct camera management API, but not
a web GUI application. All API requests require authentication. We
have added a single admin user, using the pincode from the camera
label as passord.  More users can be adding if necessary, even by
using the API itself.</p>
<p dir="auto">Read the NIPCA reference spec for usage, or look at the script names
under <strong>/var/www</strong> in the <a href="#Partitions"><strong>rootfs</strong></a> and simply try
them out. Most API endpoints return a list of current settings. Some
of the settings can be set by GET requests by providing the new values
as URL parameters.</p>
<p dir="auto">A few NIPCA references of different age:</p>
<ul dir="auto">
<li><a href="http://gurau-audibert.hd.free.fr/josdblog/wp-content/uploads/2013/09/CGI_2121.pdf" rel="nofollow">http://gurau-audibert.hd.free.fr/josdblog/wp-content/uploads/2013/09/CGI_2121.pdf</a></li>
<li><a href="https://docplayer.net/33354138-Network-ip-camera-application-programming-interface-nipca.html" rel="nofollow">https://docplayer.net/33354138-Network-ip-camera-application-programming-interface-nipca.html</a></li>
<li>ftp://ftp.dlink.net.pl/dcs/dcs-2132L/documentation/DCS-2132L_NIPCA_support table_1-9-5_20131211.pdf</li>
<li><a href="https://www.airlivecam.eu/data/IP%20Camera%20Open%20API.doc" rel="nofollow">https://www.airlivecam.eu/data/IP%20Camera%20Open%20API.doc</a></li>
</ul>
<p dir="auto">Google for more. Be aware that a most of these settings depend on the
hardware.  There is obviously no point in trying to manage an SD card
slot of the DCS-8000LH...</p>
<p dir="auto">A few of examples, using curl to read and set configuration variables:</p>
<div data-snippet-clipboard-copy-content="$ curl -u admin:123456 http://192.168.2.37/common/info.cgi
model=DCS-8000LH
product=Wireless Internet Camera
brand=D-Link
version=2.02
build=02
hw_version=A
nipca=1.9.7
name=DCS-8000LH
location=
macaddr=B0:C5:54:AA:BB:CC
ipaddr=192.168.2.37
netmask=255.255.255.0
gateway=192.168.2.1
wireless=yes
inputs=0
outputs=0
speaker=no
videoout=no
pir=no
icr=yes
ir=yes
mic=yes
led=no
td=no
playing_music=no
whitelightled=no

$ curl -u admin:123456 'http://192.168.2.37/config/datetime.cgi' 
method=1
timeserver=ntp1.dlink.com
timezone=1
utcdate=2019-05-09
utctime=13:25:14
date=2019-05-09
time=15:25:14
dstenable=yes
dstauto=yes
offset=01:00
starttime=3.2.0/02:00:00
stoptime=11.1.0/02:00:00

$ curl -u admin:123456 http://192.168.2.37/config/led.cgi?led=off
led=off"><pre><code>$ curl -u admin:123456 http://192.168.2.37/common/info.cgi
model=DCS-8000LH
product=Wireless Internet Camera
brand=D-Link
version=2.02
build=02
hw_version=A
nipca=1.9.7
name=DCS-8000LH
location=
macaddr=B0:C5:54:AA:BB:CC
ipaddr=192.168.2.37
netmask=255.255.255.0
gateway=192.168.2.1
wireless=yes
inputs=0
outputs=0
speaker=no
videoout=no
pir=no
icr=yes
ir=yes
mic=yes
led=no
td=no
playing_music=no
whitelightled=no

$ curl -u admin:123456 'http://192.168.2.37/config/datetime.cgi' 
method=1
timeserver=ntp1.dlink.com
timezone=1
utcdate=2019-05-09
utctime=13:25:14
date=2019-05-09
time=15:25:14
dstenable=yes
dstauto=yes
offset=01:00
starttime=3.2.0/02:00:00
stoptime=11.1.0/02:00:00

$ curl -u admin:123456 http://192.168.2.37/config/led.cgi?led=off
led=off
</code></pre></div>
<p dir="auto">Most camera settings can be controlled using this API and e.g curl for
the command line.  There are also packages implementing API clients,
like for example this nodejs one: <a href="https://www.npmjs.com/package/nipca" rel="nofollow">https://www.npmjs.com/package/nipca</a></p>
<h3 tabindex="-1" dir="auto">Bluetooth LE GATT API</h3>
<p dir="auto">The Bluetooth service is in a "locked" mode by default. This is
controlled by the "Ble Mode" persistent setting stored in the <strong>db</strong>
partition. If true ("1"), then most of the Bluetooth commands are
rejected.  But changing the setting manually will not help much, since
the system automatically enter lock mode 180 seconds after the last
Bluetooth client disconnected.</p>
<p dir="auto">The challenge -&gt; response unlock method described below is much more
useful.</p>
<h4 tabindex="-1" dir="auto">Converting the PIN Code to a Bluetooth unlock key</h4>
<p dir="auto">Most Bluetooth commands are rejected when locked.  Access to the full
Bluetooth API can be unlocked by using the PIN Code printed on the
camera label.  This code is not sent directly over the air
though. Instead it is combined with a random challenge.</p>
<p dir="auto">Both the random challenge and the matching key are generated by the
application <code>sbin/gen_bt_config</code> on the camera side.  The key is
calculated by taking the first 16 bytes of the base64 encoded md5
digest of</p>
<ul dir="auto">
<li>model string + '-'  four last mac digits (or Bluetooth device name?)</li>
<li>PIN Code</li>
<li>challenge.</li>
</ul>
<p dir="auto">Note that this application depends on bluetooth libraries, which are
not in /lib. So we have to set LD_LIBRARY_PATH to run it manually:</p>
<div data-snippet-clipboard-copy-content="# LD_LIBRARY_PATH=/var/bluetooth/lib sbin/gen_bt_config update_key_only
In main:182: modelStr = 'DCS-8000LH'
In main:183: mac = 'b0:c5:54:ab:cd:ef'
In update_ble_key:87: key data = 'DCS-8000LH-CDEF012345b2gaescrbldchnik'"><pre><code># LD_LIBRARY_PATH=/var/bluetooth/lib sbin/gen_bt_config update_key_only
In main:182: modelStr = 'DCS-8000LH'
In main:183: mac = 'b0:c5:54:ab:cd:ef'
In update_ble_key:87: key data = 'DCS-8000LH-CDEF012345b2gaescrbldchnik'
</code></pre></div>
<p dir="auto">I've slightly obfuscated my data here - the pincode in the above case
is <code>012345</code>, and the dynamically generated challenge is
<code>b2gaescrbldchnik</code>. The generated challenge and key are stored in
<code>/tmp/db/db.xml</code> and can be read directly from there:</p>
<div data-snippet-clipboard-copy-content="# grep Key /tmp/db/db.xml |tail -2
<ChallengeKey type=&quot;3&quot; content=&quot;b2gaescrbldchnik&quot; />
<Key type=&quot;5&quot; content=&quot;jrtY6nONQ5rV+2Ph&quot; />"><pre><code># grep Key /tmp/db/db.xml |tail -2
&lt;ChallengeKey type="3" content="b2gaescrbldchnik" /&gt;
&lt;Key type="5" content="jrtY6nONQ5rV+2Ph" /&gt;
</code></pre></div>
<p dir="auto">Or you can read them using the same tools the Bluetooth system uses:</p>
<div data-snippet-clipboard-copy-content="# tdb get Ble ChallengeKey_ss
b2gaescrbldchnik
# mdb get ble_key
jrtY6nONQ5rV+2Ph"><pre><code># tdb get Ble ChallengeKey_ss
b2gaescrbldchnik
# mdb get ble_key
jrtY6nONQ5rV+2Ph
</code></pre></div>
<p dir="auto">Yes, the D-Link code does actually use tdb for the first one and mdb
for the second.  I have absolutely no idea why,... It is possible to
read the key using tdb too:</p>
<div data-snippet-clipboard-copy-content="# tdb get Ble Key_ss
jrtY6nONQ5rV+2Ph"><pre><code># tdb get Ble Key_ss
jrtY6nONQ5rV+2Ph
</code></pre></div>
<p dir="auto">Generating the same key by hand on a Linux system is simple:</p>
<div data-snippet-clipboard-copy-content="$ echo -n 'DCS-8000LH-CDEF012345b2gaescrbldchnik' | md5sum | xxd -r -p | base64 | cut -c-16
jrtY6nONQ5rV+2Ph"><pre><code>$ echo -n 'DCS-8000LH-CDEF012345b2gaescrbldchnik' | md5sum | xxd -r -p | base64 | cut -c-16
jrtY6nONQ5rV+2Ph
</code></pre></div>
<h4 tabindex="-1" dir="auto">Characteristic UUIDs</h4>
<p dir="auto">D-Link is using the GATT BlueZ example plugin, patching it to add
their camera specific endpoints.  This means that we can find all the
API "documentation" in the
<code>DCS-8000LH-GPL/package/bluez_utils/feature-patch/5.28/customized-mydlink.patch</code>
file in the GPL archive.</p>
<p dir="auto">This defines a number of 16bit UUIDs with mostly nonsense names:</p>
<div data-snippet-clipboard-copy-content="+#define IPCAM_UUID		0xD001
+#define A000_UUID		0xA000
+#define A001_UUID		0xA001
+#define A100_UUID		0xA100
+#define A101_UUID		0xA101
+#define A102_UUID		0xA102
+#define A103_UUID		0xA103
+#define A104_UUID		0xA104
+#define A200_UUID		0xA200
+#define A201_UUID		0xA201
+#define A300_UUID		0xA300
+#define A301_UUID		0xA301
+#define A302_UUID		0xA302
+#define A303_UUID		0xA303
+#define A304_UUID		0xA304"><pre><code>+#define IPCAM_UUID		0xD001
+#define A000_UUID		0xA000
+#define A001_UUID		0xA001
+#define A100_UUID		0xA100
+#define A101_UUID		0xA101
+#define A102_UUID		0xA102
+#define A103_UUID		0xA103
+#define A104_UUID		0xA104
+#define A200_UUID		0xA200
+#define A201_UUID		0xA201
+#define A300_UUID		0xA300
+#define A301_UUID		0xA301
+#define A302_UUID		0xA302
+#define A303_UUID		0xA303
+#define A304_UUID		0xA304
</code></pre></div>
<p dir="auto"><code>IPCAM_UUID</code> is registered as the <code>GATT_PRIM_SVC_UUID</code>, which means
that it shows up as a primary GATT service we can look for when
looking for a supported camera.</p>
<p dir="auto">The rest of the UUIDs are characteristics of this primary service. The
API is based on reading or writing these characteristics.</p>
<h4 tabindex="-1" dir="auto">Data formatting</h4>
<p dir="auto">Both input and output parameters are sent as ascii strings using
key=value pairs joined by <code>;</code>, with an exception for the nested KV
pairs in the WiFi survey results.  All keys are single upper case
characters. Key names are somewhat reused, so the exact meaning depend
on the characteristic.</p>
<p dir="auto">Values are either integers, including boolean 0/1, or some set of
ascii text.</p>
<p dir="auto">Three real examples, read from 0xA001, 0xA200 and 0xA104:</p>
<div data-snippet-clipboard-copy-content="M=1;C=b2gaescrbldchnik
N=DCS-8000LH;P=1;T=1557349762;Z=CET-1CEST,M3.5.0,M10.5.0/3;F=2.01.03;H=A1;M=B0C554ABCDEF;V=3.0.0-b71
I=192.168.2.37;N=255.255.255.0;G=192.168.2.1;D=148.122.16.253"><pre><code>M=1;C=b2gaescrbldchnik
N=DCS-8000LH;P=1;T=1557349762;Z=CET-1CEST,M3.5.0,M10.5.0/3;F=2.01.03;H=A1;M=B0C554ABCDEF;V=3.0.0-b71
I=192.168.2.37;N=255.255.255.0;G=192.168.2.1;D=148.122.16.253
</code></pre></div>
<h4 tabindex="-1" dir="auto">Listing characteristics</h4>
<p dir="auto">The <strong>gattool</strong> Linux command line tool is useful for exploring
Bluetooth LE devices.  You can look for primary services and list
associated characteristics of a service:</p>
<div data-snippet-clipboard-copy-content="[B0:C5:54:AA:BB:CC][LE]> primary 
attr handle: 0x0001, end grp handle: 0x0008 uuid: 00001800-0000-1000-8000-00805f9b34fb
attr handle: 0x0010, end grp handle: 0x0010 uuid: 00001801-0000-1000-8000-00805f9b34fb
attr handle: 0x0011, end grp handle: 0x002e uuid: 0000d001-0000-1000-8000-00805f9b34fb
[B0:C5:54:AA:BB:CC][LE]> characteristics 0x0011
handle: 0x0012, char properties: 0x12, char value handle: 0x0013, uuid: 0000a000-0000-1000-8000-00805f9b34fb
handle: 0x0015, char properties: 0x0a, char value handle: 0x0016, uuid: 0000a001-0000-1000-8000-00805f9b34fb
handle: 0x0017, char properties: 0x02, char value handle: 0x0018, uuid: 0000a100-0000-1000-8000-00805f9b34fb
handle: 0x0019, char properties: 0x0a, char value handle: 0x001a, uuid: 0000a101-0000-1000-8000-00805f9b34fb
handle: 0x001b, char properties: 0x08, char value handle: 0x001c, uuid: 0000a102-0000-1000-8000-00805f9b34fb
handle: 0x001d, char properties: 0x02, char value handle: 0x001e, uuid: 0000a103-0000-1000-8000-00805f9b34fb
handle: 0x001f, char properties: 0x02, char value handle: 0x0020, uuid: 0000a104-0000-1000-8000-00805f9b34fb
handle: 0x0021, char properties: 0x0a, char value handle: 0x0022, uuid: 0000a200-0000-1000-8000-00805f9b34fb
handle: 0x0023, char properties: 0x08, char value handle: 0x0024, uuid: 0000a201-0000-1000-8000-00805f9b34fb
handle: 0x0025, char properties: 0x0a, char value handle: 0x0026, uuid: 0000a300-0000-1000-8000-00805f9b34fb
handle: 0x0027, char properties: 0x02, char value handle: 0x0028, uuid: 0000a301-0000-1000-8000-00805f9b34fb
handle: 0x0029, char properties: 0x08, char value handle: 0x002a, uuid: 0000a302-0000-1000-8000-00805f9b34fb
handle: 0x002b, char properties: 0x08, char value handle: 0x002c, uuid: 0000a303-0000-1000-8000-00805f9b34fb
handle: 0x002d, char properties: 0x02, char value handle: 0x002e, uuid: 0000a304-0000-1000-8000-00805f9b34fb"><pre><code>[B0:C5:54:AA:BB:CC][LE]&gt; primary 
attr handle: 0x0001, end grp handle: 0x0008 uuid: 00001800-0000-1000-8000-00805f9b34fb
attr handle: 0x0010, end grp handle: 0x0010 uuid: 00001801-0000-1000-8000-00805f9b34fb
attr handle: 0x0011, end grp handle: 0x002e uuid: 0000d001-0000-1000-8000-00805f9b34fb
[B0:C5:54:AA:BB:CC][LE]&gt; characteristics 0x0011
handle: 0x0012, char properties: 0x12, char value handle: 0x0013, uuid: 0000a000-0000-1000-8000-00805f9b34fb
handle: 0x0015, char properties: 0x0a, char value handle: 0x0016, uuid: 0000a001-0000-1000-8000-00805f9b34fb
handle: 0x0017, char properties: 0x02, char value handle: 0x0018, uuid: 0000a100-0000-1000-8000-00805f9b34fb
handle: 0x0019, char properties: 0x0a, char value handle: 0x001a, uuid: 0000a101-0000-1000-8000-00805f9b34fb
handle: 0x001b, char properties: 0x08, char value handle: 0x001c, uuid: 0000a102-0000-1000-8000-00805f9b34fb
handle: 0x001d, char properties: 0x02, char value handle: 0x001e, uuid: 0000a103-0000-1000-8000-00805f9b34fb
handle: 0x001f, char properties: 0x02, char value handle: 0x0020, uuid: 0000a104-0000-1000-8000-00805f9b34fb
handle: 0x0021, char properties: 0x0a, char value handle: 0x0022, uuid: 0000a200-0000-1000-8000-00805f9b34fb
handle: 0x0023, char properties: 0x08, char value handle: 0x0024, uuid: 0000a201-0000-1000-8000-00805f9b34fb
handle: 0x0025, char properties: 0x0a, char value handle: 0x0026, uuid: 0000a300-0000-1000-8000-00805f9b34fb
handle: 0x0027, char properties: 0x02, char value handle: 0x0028, uuid: 0000a301-0000-1000-8000-00805f9b34fb
handle: 0x0029, char properties: 0x08, char value handle: 0x002a, uuid: 0000a302-0000-1000-8000-00805f9b34fb
handle: 0x002b, char properties: 0x08, char value handle: 0x002c, uuid: 0000a303-0000-1000-8000-00805f9b34fb
handle: 0x002d, char properties: 0x02, char value handle: 0x002e, uuid: 0000a304-0000-1000-8000-00805f9b34fb
</code></pre></div>
<p dir="auto">It is also possible to read and write characteristics using this tool,
but this can be a bit cumbersome unless you are fluent in ASCII coding
;-)</p>
<h4 tabindex="-1" dir="auto">The IPCam characteristics</h4>
<p dir="auto">Guessed meanings of each characteristic, based on the source code and
some trial and error. Not necessarily how D-Link would describe them:</p>
<table>
<thead>
<tr>
<th>UUID</th>
<th>op</th>
<th>description</th>
<th>format</th>
<th>keys</th>
</tr>
</thead>
<tbody>
<tr>
<td>A000</td>
<td>read</td>
<td>last status</td>
<td>C=%d;A=%d;R=%d</td>
<td>C: uuid, A: mode, R: state</td>
</tr>
<tr>
<td>A000</td>
<td>notify</td>
<td>last status</td>
<td>C=%d;A=%d;R=%d</td>
<td>C: uuid, A: mode, R: state</td>
</tr>
<tr>
<td>A001</td>
<td>read</td>
<td>challenge</td>
<td>M=%d;C=%s</td>
<td>M: opmode, C: challenge</td>
</tr>
<tr>
<td>A001</td>
<td>write</td>
<td>auth</td>
<td>M=%d;K=%s</td>
<td>M: opmode, K: key</td>
</tr>
<tr>
<td>A100</td>
<td>read</td>
<td>wifi survey</td>
<td>N=%d;P=%d;...</td>
<td></td>
</tr>
<tr>
<td>A101</td>
<td>read</td>
<td>wifi config</td>
<td>M=%s;I=%s;S=%s;E=%s</td>
<td>M: opmode, I: essid, S: 4 , E: 2</td>
</tr>
<tr>
<td>A101</td>
<td>write</td>
<td>wifi config</td>
<td>M=%s;I=%s;S=%s;E=%s;K=%s</td>
<td>M: opmode, I: essid, S: 4 , E: 2, K: password</td>
</tr>
<tr>
<td>A102</td>
<td>write</td>
<td>wifi connect</td>
<td>C=%d</td>
<td>C: connect (0/1)</td>
</tr>
<tr>
<td>A103</td>
<td>read</td>
<td>wifi status</td>
<td>S=%d</td>
<td>S: wifi link status (0,1,?)</td>
</tr>
<tr>
<td>A104</td>
<td>read</td>
<td>ip config</td>
<td>I=%s;N=%s;G=%s;D=%s</td>
<td>I: address, N: netmask, G: gateway, D: DNS-server</td>
</tr>
<tr>
<td>A200</td>
<td>read</td>
<td>system info</td>
<td>N=%s;P=%d;T=%d;Z=%s;F=%s;H=%s;M=%s;V=%s</td>
<td>N: devicename, P: haspin (0/1), T: time (unix epoch), Z: timezone, F: fwver, H: hwver, M: macaddr, V:mydlinkver</td>
</tr>
<tr>
<td>A200</td>
<td>write</td>
<td>name and time</td>
<td>N=%s;T=%d;Z=%s</td>
<td>N: devicename, T: time (unix epoch), Z: timezone</td>
</tr>
<tr>
<td>A201</td>
<td>write</td>
<td>admin password</td>
<td>P=%s;N=%s</td>
<td>P: current password, N: new password</td>
</tr>
<tr>
<td>A300</td>
<td>read</td>
<td>reg state</td>
<td>G=%d</td>
<td>G: registration state (0/1)</td>
</tr>
<tr>
<td>A300</td>
<td>write</td>
<td>reg state</td>
<td>G=%d</td>
<td>G: registration state (0/1)</td>
</tr>
<tr>
<td>A301</td>
<td>read</td>
<td>provisioning</td>
<td>N=%s;T=%s;U=%s</td>
<td>N: username, T: footprint, U: portal</td>
</tr>
<tr>
<td>A302</td>
<td>write</td>
<td>restart mydlink</td>
<td>C=%d</td>
<td>C: restart (0/1)</td>
</tr>
<tr>
<td>A303</td>
<td>write</td>
<td>register</td>
<td>S=%s;M=%s</td>
<td>S: , M:  (written to /tmp/mydlink/reg_info, and then kill -USR1 <code>pidof da_adaptor</code>)</td>
</tr>
<tr>
<td>A304</td>
<td>read</td>
<td>register</td>
<td>S=%d;E=%d</td>
<td>S: , E:  (cat /tmp/mydlink/reg_st)</td>
</tr>
</tbody>
</table>
<p dir="auto">The UUIDs from 0xA300 to 0xA304 are all related to the mydlink cloud
service, and therefore not of much use to us.  I haven't bothered
trying to figure out exactly how they are used.</p>
<p dir="auto">We could in theory use the 0xA303 request which simply calls
<strong>/opt/opt.local restart</strong>.  But with the gaping 0xA201 hole,
allowing <strong>any</strong> command, there isn't much need for this one...</p>
<p dir="auto">A few more details on the more complex characteristics:</p>
<h5 tabindex="-1" dir="auto">A000</h5>
<p dir="auto">The only characteristic sent as notifications.  But it can also be
read directly for syncronous operations.</p>
<p dir="auto">The value is the state to the last Bluetooth action:</p>
<div data-snippet-clipboard-copy-content="&quot;C=%d;A=%d;R=%d&quot;, last_action_status.uuid, last_action_status.mode, last_action_status.state"><pre><code>"C=%d;A=%d;R=%d", last_action_status.uuid, last_action_status.mode, last_action_status.state
</code></pre></div>
<h5 tabindex="-1" dir="auto">A100</h5>
<p dir="auto">The wifi survey scan results are split in 128 byte "pages", where each
page starts with the total number of pages and the current page
number.  The characteristic value must be read as many times as the
given total.</p>
<p dir="auto">For example, reading 3 pages:</p>
<div data-snippet-clipboard-copy-content="[B0:C5:54:AA:BB:CC][LE]> char-read-hnd 0x0018
Characteristic value/descriptor: 4e 3d 33 3b 50 3d 31 3b 4c 3d 49 3d 41 6e 74 69 62 6f 6b 73 2c 4d 3d 30 2c 43 3d 36 2c 53 3d 34 2c 45 3d 32 2c 50 3d 36 32 26 4c 3d 49 3d 41 53 56 31 37 2c 4d 3d 30 2c 43 3d 31 31 2c 53 3d 34 2c 45 3d 32 2c 50 3d 34 36 26 4c 3d 49 3d 41 53 56 31 37 2d 64 6c 69 6e 6b 2c 4d 3d 30 2c 43 3d 36 2c 53 3d 34 2c 45 3d 32 2c 50 3d 36 38 26 4c 3d 49 3d 66 6a 6f 72 64 65 31 32 33 2c 4d 3d 30 
[B0:C5:54:AA:BB:CC][LE]> char-read-hnd 0x0018
Characteristic value/descriptor: 4e 3d 33 3b 50 3d 32 3b 2c 43 3d 31 2c 53 3d 34 2c 45 3d 32 2c 50 3d 35 38 26 4c 3d 49 3d 4a 4f 4a 2c 4d 3d 30 2c 43 3d 31 31 2c 53 3d 34 2c 45 3d 32 2c 50 3d 34 37 26 4c 3d 49 3d 4b 6a 65 6c 6c 65 72 62 6f 64 2c 4d 3d 30 2c 43 3d 36 2c 53 3d 34 2c 45 3d 32 2c 50 3d 36 32 26 4c 3d 49 3d 6d 67 6d 74 2c 4d 3d 30 2c 43 3d 31 2c 53 3d 34 2c 45 3d 32 2c 50 3d 37 34 26 4c 3d 49 3d 52 69 
[B0:C5:54:AA:BB:CC][LE]> char-read-hnd 0x0018
Characteristic value/descriptor: 4e 3d 33 3b 50 3d 33 3b 6e 64 65 64 61 6c 2c 4d 3d 30 2c 43 3d 31 31 2c 53 3d 34 2c 45 3d 32 2c 50 3d 36 32 "><pre><code>[B0:C5:54:AA:BB:CC][LE]&gt; char-read-hnd 0x0018
Characteristic value/descriptor: 4e 3d 33 3b 50 3d 31 3b 4c 3d 49 3d 41 6e 74 69 62 6f 6b 73 2c 4d 3d 30 2c 43 3d 36 2c 53 3d 34 2c 45 3d 32 2c 50 3d 36 32 26 4c 3d 49 3d 41 53 56 31 37 2c 4d 3d 30 2c 43 3d 31 31 2c 53 3d 34 2c 45 3d 32 2c 50 3d 34 36 26 4c 3d 49 3d 41 53 56 31 37 2d 64 6c 69 6e 6b 2c 4d 3d 30 2c 43 3d 36 2c 53 3d 34 2c 45 3d 32 2c 50 3d 36 38 26 4c 3d 49 3d 66 6a 6f 72 64 65 31 32 33 2c 4d 3d 30 
[B0:C5:54:AA:BB:CC][LE]&gt; char-read-hnd 0x0018
Characteristic value/descriptor: 4e 3d 33 3b 50 3d 32 3b 2c 43 3d 31 2c 53 3d 34 2c 45 3d 32 2c 50 3d 35 38 26 4c 3d 49 3d 4a 4f 4a 2c 4d 3d 30 2c 43 3d 31 31 2c 53 3d 34 2c 45 3d 32 2c 50 3d 34 37 26 4c 3d 49 3d 4b 6a 65 6c 6c 65 72 62 6f 64 2c 4d 3d 30 2c 43 3d 36 2c 53 3d 34 2c 45 3d 32 2c 50 3d 36 32 26 4c 3d 49 3d 6d 67 6d 74 2c 4d 3d 30 2c 43 3d 31 2c 53 3d 34 2c 45 3d 32 2c 50 3d 37 34 26 4c 3d 49 3d 52 69 
[B0:C5:54:AA:BB:CC][LE]&gt; char-read-hnd 0x0018
Characteristic value/descriptor: 4e 3d 33 3b 50 3d 33 3b 6e 64 65 64 61 6c 2c 4d 3d 30 2c 43 3d 31 31 2c 53 3d 34 2c 45 3d 32 2c 50 3d 36 32 
</code></pre></div>
<p dir="auto">These strings are decoded as:</p>
<div data-snippet-clipboard-copy-content="N=3;P=1;L=I=Antiboks,M=0,C=6,S=4,E=2,P=62&amp;L=I=ASV17,M=0,C=11,S=4,E=2,P=46&amp;L=I=ASV17-dlink,M=0,C=6,S=4,E=2,P=68&amp;L=I=fjorde123,M=0
N=3;P=2;,C=1,S=4,E=2,P=58&amp;L=I=JOJ,M=0,C=11,S=4,E=2,P=47&amp;L=I=Kjellerbod,M=0,C=6,S=4,E=2,P=62&amp;L=I=mgmt,M=0,C=1,S=4,E=2,P=74&amp;L=I=Ri
N=3;P=3;ndedal,M=0,C=11,S=4,E=2,P=62"><pre><code>N=3;P=1;L=I=Antiboks,M=0,C=6,S=4,E=2,P=62&amp;L=I=ASV17,M=0,C=11,S=4,E=2,P=46&amp;L=I=ASV17-dlink,M=0,C=6,S=4,E=2,P=68&amp;L=I=fjorde123,M=0
N=3;P=2;,C=1,S=4,E=2,P=58&amp;L=I=JOJ,M=0,C=11,S=4,E=2,P=47&amp;L=I=Kjellerbod,M=0,C=6,S=4,E=2,P=62&amp;L=I=mgmt,M=0,C=1,S=4,E=2,P=74&amp;L=I=Ri
N=3;P=3;ndedal,M=0,C=11,S=4,E=2,P=62
</code></pre></div>
<p dir="auto">Which, when joined after removing the N/P paging info, becomes::</p>
<div data-snippet-clipboard-copy-content="L=I=Antiboks,M=0,C=6,S=4,E=2,P=62&amp;L=I=ASV17,M=0,C=11,S=4,E=2,P=46&amp;L=I=ASV17-dlink,M=0,C=6,S=4,E=2,P=68&amp;L=I=fjorde123,M=0,C=1,S=4,E=2,P=58&amp;L=I=JOJ,M=0,C=11,S=4,E=2,P=47&amp;L=I=Kjellerbod,M=0,C=6,S=4,E=2,P=62&amp;L=I=mgmt,M=0,C=1,S=4,E=2,P=74&amp;L=I=Rindedal,M=0,C=11,S=4,E=2,P=62"><pre><code>L=I=Antiboks,M=0,C=6,S=4,E=2,P=62&amp;L=I=ASV17,M=0,C=11,S=4,E=2,P=46&amp;L=I=ASV17-dlink,M=0,C=6,S=4,E=2,P=68&amp;L=I=fjorde123,M=0,C=1,S=4,E=2,P=58&amp;L=I=JOJ,M=0,C=11,S=4,E=2,P=47&amp;L=I=Kjellerbod,M=0,C=6,S=4,E=2,P=62&amp;L=I=mgmt,M=0,C=1,S=4,E=2,P=74&amp;L=I=Rindedal,M=0,C=11,S=4,E=2,P=62
</code></pre></div>
<p dir="auto">And after splitting this on &amp; we get the final result:</p>
<div data-snippet-clipboard-copy-content="L=I=Antiboks,M=0,C=6,S=4,E=2,P=62
L=I=ASV17,M=0,C=11,S=4,E=2,P=46
L=I=ASV17-dlink,M=0,C=6,S=4,E=2,P=68
L=I=fjorde123,M=0,C=1,S=4,E=2,P=58
L=I=JOJ,M=0,C=11,S=4,E=2,P=47
L=I=Kjellerbod,M=0,C=6,S=4,E=2,P=62
L=I=mgmt,M=0,C=1,S=4,E=2,P=74
L=I=Rindedal,M=0,C=11,S=4,E=2,P=62"><pre><code>L=I=Antiboks,M=0,C=6,S=4,E=2,P=62
L=I=ASV17,M=0,C=11,S=4,E=2,P=46
L=I=ASV17-dlink,M=0,C=6,S=4,E=2,P=68
L=I=fjorde123,M=0,C=1,S=4,E=2,P=58
L=I=JOJ,M=0,C=11,S=4,E=2,P=47
L=I=Kjellerbod,M=0,C=6,S=4,E=2,P=62
L=I=mgmt,M=0,C=1,S=4,E=2,P=74
L=I=Rindedal,M=0,C=11,S=4,E=2,P=62
</code></pre></div>
<p dir="auto">So each L entry is made up of the same set of keys:</p>
<ul dir="auto">
<li>I: essid</li>
<li>M: opmode? or authalg? (always 0 in the sample)</li>
<li>C: channel (2.4 GHz only)</li>
<li>S: key_mgmt/auth_alg/proto?</li>
<li>E: key_mgmt/auth_alg/proto?</li>
<li>P: relative signal. Higher is better. dBm + 100?</li>
</ul>
<p dir="auto">Still need to figure out the mapping of the M,S,E keys to
wpa_supplicant config settings. I assume they represent enums.  But we
can simply treat them as opaque values since we only use the survey
data to help setup WiFi anyway. We copy these to the setup request,
and do not need to know what they mean.</p>
<p dir="auto">FWIW, my example setting <code>M=0;I=Kjellerbod;S=4;E=2</code>
is mapped to this wpa_supplicant configuration:</p>
<div data-snippet-clipboard-copy-content="# cat /tmp/wpa_supplicant.conf 
ctrl_interface=/var/run/wpa_supplicant
device_type=4-0050F204-3
model_name=DCS-8000LH
manufacturer=D-Link
os_version=01020300
config_methods=push_button virtual_push_button
eapol_version=1
network={
        scan_ssid=1
        ssid=&quot;Kjellerbod&quot;
        key_mgmt=WPA-PSK
        auth_alg=OPEN
        proto=RSN
        psk=&quot;redeacted&quot;
}"><pre><code># cat /tmp/wpa_supplicant.conf 
ctrl_interface=/var/run/wpa_supplicant
device_type=4-0050F204-3
model_name=DCS-8000LH
manufacturer=D-Link
os_version=01020300
config_methods=push_button virtual_push_button
eapol_version=1
network={
        scan_ssid=1
        ssid="Kjellerbod"
        key_mgmt=WPA-PSK
        auth_alg=OPEN
        proto=RSN
        psk="redeacted"
}
</code></pre></div>
<h5 tabindex="-1" dir="auto">A201</h5>
<p dir="auto">This write request allows setting an admin password, used for example
by the webserver. It takes the old and new passwords as unencoded
input, verifies that the old password matches, and then change the
admin password to the provided new one.</p>
<p dir="auto">The initial password is empty, which prevents webserver
authentication. Simply provide an empty string for the old password in
the first request: <strong>P=;N=newpassword</strong></p>
<p dir="auto">But this request is much more useful in other ways.... The new passord
(N_str) is processed like this (after slight compression of the
interesting code lines):</p>
<div dir="auto" data-snippet-clipboard-copy-content="	snprintf(cmd, sizeof(cmd), &quot;mdb set admin_passwd %s&quot;, N_str);
	snprintf(cmdbuf, sizeof(cmdbuf), &quot;%s > %s 2>&amp;1&quot;, cmd, p_name);
	fp = popen(cmdbuf, &quot;r&quot;);"><pre>	<span>snprintf</span>(<span>cmd</span>, <span>sizeof</span>(<span>cmd</span>), <span>"mdb set admin_passwd %s"</span>, <span>N_str</span>);
	<span>snprintf</span>(<span>cmdbuf</span>, <span>sizeof</span>(<span>cmdbuf</span>), <span>"%s &gt; %s 2&gt;&amp;1"</span>, <span>cmd</span>, <span>p_name</span>);
	<span>fp</span> <span>=</span> <span>popen</span>(<span>cmdbuf</span>, <span>"r"</span>);</pre></div>
<p dir="auto">You don't have to be a security expert to see the problem here. But
one mans bug is another mans feature :-)</p>
<h5 tabindex="-1" dir="auto">A303</h5>
<p dir="auto">The two strings S and M are url decoded and checked for special
characters.  Then the <strong>orginal</strong> url encoded strings are written to
<strong>/tmp/mydlink/reg_info</strong> and SIGUSR1 is sent to the <strong>da_adaptor</strong>
process.  Presumably triggering it to reread the reg_info file.</p>
<p dir="auto">It is pretty safe to assume that this provides some registration info
to the mydlink system, allowing it to connect to the cloud service.</p>
<p dir="auto">The set of allowed characters is rather interesting:</p>
<div data-snippet-clipboard-copy-content=" &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789 !\&quot;#$%&amp;'()*+,-./:;<=>?@[\\]^_`{|}~&quot;"><pre><code> "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789 !\"#$%&amp;'()*+,-./:;&lt;=&gt;?@[\\]^_`{|}~"
</code></pre></div>
<p dir="auto">Which initially made me think that this was an obvious security hole,
since I missed the point that it's the url encoded strings that are
used on the command line.</p>
<p dir="auto">But given the quality of the rest of the code here, I would be very
surprised if there isn't an issue or ten in the da_adaptor code
allowing this to be abused. It's just a bit harder to figure out
without the source code.</p>
<h3 tabindex="-1" dir="auto">Firmware updates</h3>
<p dir="auto">There are at least two shell scripts providing a firmware update
service in the D-Link firmware:</p>
<ul dir="auto">
<li>/var/www/config/firmwareupgrade.cgi</li>
<li>/sbin/fwupdate</li>
</ul>
<p dir="auto">They are both pretty similar and obviously come from the same source.
The main difference is that firmwareupgrade.cgi provides the NIPCA
firmwareupgrade service, while fwupdate is a command line tool.</p>
<p dir="auto">The web service is most interesting for us, providing both the upload
and upgrade in one simple tool.  The fwupdate tool is used by the
mydlink cloud tool <strong>da_adaptor</strong> , via an fw_upgrade symlink.</p>
<h4 tabindex="-1" dir="auto">Signed and encrypted</h4>
<p dir="auto">Looking at the contents of a firmware update from D-Link can be
demotivating at the beginning:</p>
<div data-snippet-clipboard-copy-content="$ tar xvf DCS-8000LH_Ax_v2.02.02_3014.bin 
update.bin.aes
update.aes
aes.key.rsa
certificate.info
sign.sha1.rsa

$ file *
aes.key.rsa:      data
certificate.info: ASCII text
sign.sha1.rsa:    data
update.aes:       data
update.bin.aes:   data

$ ls -l
total 10956
-rw-r--r-- 1 bjorn bjorn      128 Feb 14 10:58 aes.key.rsa
-rw-r--r-- 1 bjorn bjorn      130 Feb 14 10:58 certificate.info
-rw-r--r-- 1 bjorn bjorn      128 Feb 14 10:58 sign.sha1.rsa
-rw-r--r-- 1 bjorn bjorn 10268368 Feb 14 10:58 update.aes
-rw-r--r-- 1 bjorn bjorn   936464 Feb 14 10:58 update.bin.aes"><pre><code>$ tar xvf DCS-8000LH_Ax_v2.02.02_3014.bin 
update.bin.aes
update.aes
aes.key.rsa
certificate.info
sign.sha1.rsa

$ file *
aes.key.rsa:      data
certificate.info: ASCII text
sign.sha1.rsa:    data
update.aes:       data
update.bin.aes:   data

$ ls -l
total 10956
-rw-r--r-- 1 bjorn bjorn      128 Feb 14 10:58 aes.key.rsa
-rw-r--r-- 1 bjorn bjorn      130 Feb 14 10:58 certificate.info
-rw-r--r-- 1 bjorn bjorn      128 Feb 14 10:58 sign.sha1.rsa
-rw-r--r-- 1 bjorn bjorn 10268368 Feb 14 10:58 update.aes
-rw-r--r-- 1 bjorn bjorn   936464 Feb 14 10:58 update.bin.aes
</code></pre></div>
<p dir="auto">So all the interesting stuff is AES encrypted, and the AES key is RSA
encrypted.  The only directly readable file is this one, and it
doesn't tell us much:</p>
<div data-snippet-clipboard-copy-content="$ cat certificate.info 
Publisher:DMdssdFW1
Supported Models:DCS-8000LH,DCS-8000LH
Firmware Version:1.0.0
Target:update.bin
Build No:3014
Contents:update"><pre><code>$ cat certificate.info 
Publisher:DMdssdFW1
Supported Models:DCS-8000LH,DCS-8000LH
Firmware Version:1.0.0
Target:update.bin
Build No:3014
Contents:update
</code></pre></div>
<p dir="auto">Not much we can do about this then.  Or so it seems...  Until we look
at <strong>firmwareupgrade.cgi</strong>, or <strong>fwupdate</strong> which has almost the same
code:</p>
<div dir="auto" data-snippet-clipboard-copy-content="verifyFirmware() {
	result=uploadSign
	#tar tf &quot;$UPLOADBIN&quot; > /dev/null 2> /dev/null || return 1
	fw_sign_verify.sh &quot;$UPLOADBIN&quot; /etc/db/verify.key > /dev/null 2> /dev/null || return 1
	return 0
}

decryptFirmware() {
	result=uploadDecrypt
	pibinfo PriKey > $dir/decrypt.key 2> /dev/null
	fw_decrypt.sh $dir/decrypt.key $out > /dev/null 2> /dev/null || return 1
	return 0
}"><pre><span>verifyFirmware</span>() {
	result=uploadSign
	<span><span>#</span>tar tf "$UPLOADBIN" &gt; /dev/null 2&gt; /dev/null || return 1</span>
	fw_sign_verify.sh <span><span>"</span><span>$UPLOADBIN</span><span>"</span></span> /etc/db/verify.key <span>&gt;</span> /dev/null <span>2&gt;</span> /dev/null <span>||</span> <span>return</span> 1
	<span>return</span> 0
}

<span>decryptFirmware</span>() {
	result=uploadDecrypt
	pibinfo PriKey <span>&gt;</span> <span>$dir</span>/decrypt.key <span>2&gt;</span> /dev/null
	fw_decrypt.sh <span>$dir</span>/decrypt.key <span>$out</span> <span>&gt;</span> /dev/null <span>2&gt;</span> /dev/null <span>||</span> <span>return</span> 1
	<span>return</span> 0
}</pre></div>
<p dir="auto">Can it be that simple?  Yes, it is.</p>
<p dir="auto">Looking further at the <strong>fw_sign_verify.sh</strong> and <strong>fw_decrypt.sh</strong>,
used by both update tools, confirms it.  The firmware is verified by
using the RSA public key in <strong>/etc/db/verify.key</strong> to decrypt the hash
in <strong>sign.sha1.rsa</strong>.  Then it is decrypted using a key from the
factory data <strong>pib</strong> partition.</p>
<h4 tabindex="-1" dir="auto">Further unpacking the firmware update</h4>
<p dir="auto">So we have the keys and the hashing algorithms we need to both verify
and decrypt this firmware.  We can run the commands found in
<strong>fw_decrypt.sh</strong> to get the real contents (slightly adapted to modern
openssl versions):</p>
<div data-snippet-clipboard-copy-content="$ openssl rsautl -decrypt -in aes.key.rsa -inkey decrypt.key -out aes.key

$ openssl aes-128-cbc -v -md md5 -kfile aes.key -nosalt -d -in update.bin.aes -out update.bin
bufsize=8192
*** WARNING : deprecated key derivation used.
Using -iter or -pbkdf2 would be better.
bytes read   :   936464
bytes written:   936454

$ openssl aes-128-cbc -v -md md5 -kfile aes.key -nosalt -d -in update.aes -out update
bufsize=8192
*** WARNING : deprecated key derivation used.
Using -iter or -pbkdf2 would be better.
bytes read   : 10268368
bytes written: 10268355

$ file update.bin update
update.bin: POSIX shell script, ASCII text executable
update:     data"><pre><code>$ openssl rsautl -decrypt -in aes.key.rsa -inkey decrypt.key -out aes.key

$ openssl aes-128-cbc -v -md md5 -kfile aes.key -nosalt -d -in update.bin.aes -out update.bin
bufsize=8192
*** WARNING : deprecated key derivation used.
Using -iter or -pbkdf2 would be better.
bytes read   :   936464
bytes written:   936454

$ openssl aes-128-cbc -v -md md5 -kfile aes.key -nosalt -d -in update.aes -out update
bufsize=8192
*** WARNING : deprecated key derivation used.
Using -iter or -pbkdf2 would be better.
bytes read   : 10268368
bytes written: 10268355

$ file update.bin update
update.bin: POSIX shell script, ASCII text executable
update:     data
</code></pre></div>
<p dir="auto">OK, the <strong>update</strong> file is still in an unknown format, but at least
we have the tool used to write it to the system. And it is a shell
script, so we have the source to look at too!  But 936454 bytes is a
hell of a shell script, and this is of course because most of it is an
uuencoded binary.  So we don't know exactly what that does.  But it is
named ddPack so a fair guess is that it is a tool for dd'ing multiple
file systems or other images packed as a single file.  That's really
enough info.</p>
<p dir="auto">binwalk shows that the <strong>update</strong> file is just two squashfs systems
and a kernel, with a 1024 header of some sort.  The header presumably
tells ddPack how it should apply these three images:</p>
<div data-snippet-clipboard-copy-content="$ binwalk update

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
1024          0x400           Squashfs filesystem, little endian, version 4.0, compression:xz, size: 338755 bytes, 16 inodes, blocksize: 131072 bytes, created: 2019-02-14 09:58:28
340992        0x53400         uImage header, header size: 64 bytes, header CRC: 0x675F081D, created: 2019-02-14 09:31:53, image size: 1661571 bytes, Data Address: 0x804D4960, Entry Point: 0x804D4960, data CRC: 0x73083021, OS: Linux, CPU: MIPS, image type: OS Kernel Image, compression type: none, image name: &quot;linux_3.10&quot;
2002627       0x1E8EC3        Squashfs filesystem, little endian, version 4.0, compression:xz, size: 8265620 bytes, 2145 inodes, blocksize: 131072 bytes, created: 2019-02-14 09:58:45"><pre><code>$ binwalk update

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
1024          0x400           Squashfs filesystem, little endian, version 4.0, compression:xz, size: 338755 bytes, 16 inodes, blocksize: 131072 bytes, created: 2019-02-14 09:58:28
340992        0x53400         uImage header, header size: 64 bytes, header CRC: 0x675F081D, created: 2019-02-14 09:31:53, image size: 1661571 bytes, Data Address: 0x804D4960, Entry Point: 0x804D4960, data CRC: 0x73083021, OS: Linux, CPU: MIPS, image type: OS Kernel Image, compression type: none, image name: "linux_3.10"
2002627       0x1E8EC3        Squashfs filesystem, little endian, version 4.0, compression:xz, size: 8265620 bytes, 2145 inodes, blocksize: 131072 bytes, created: 2019-02-14 09:58:45
</code></pre></div>
<p dir="auto">But we can easily guess that without knowing anything about the
header.  There is only one alternative:</p>
<ul dir="auto">
<li>The kernel goes into the <strong>kernel</strong> partition</li>
<li>The 8265620 bytes squasfs system goes into the <strong>rootfs</strong> partition</li>
<li>The remaining squasfs system goes into the <strong>userdata</strong> partition</li>
</ul>
<p dir="auto">So there is no need to analyze ddPack.  We have the necessary entry
points for <strong>fwupdate</strong> or <strong>firmwareupgrade.cgi</strong> in the
<strong>update.bin</strong> script, and that's what we needed to know for the next
step:</p>
<h4 tabindex="-1" dir="auto">Creating our own firmware updates</h4>
<p dir="auto">We do have shell access, so we can simply write the file systems we
want to flash as shown earlier.  We don't need to use the D-Link
scripts.  But where's the fun in that?</p>
<p dir="auto">There is one challenge here: The D-Link tools are expecting signed and
encrypted firmware updates.  They will run their verifyFirmware() and
decryptFirmware() functions, and fail the update if any of the returns
an error.</p>
<p dir="auto">But bailing out on verification errors is only the default setting, as
illustrated by this code from <strong>fwupdate</strong> (there is code with similar
functionality in <strong>firmwareupgrade.cgi</strong>):</p>
<div dir="auto" data-snippet-clipboard-copy-content="        TrustLevel=`tdb get SecureFW _TrustLevel_byte`
        verifyFirmware
        ret=$?
        case $ret in
                2)
                        sign=&quot;not_signed&quot;
                ;;
                0)
                        sign=&quot;trust&quot;
                ;;
                *)
                        sign=&quot;untrust&quot;
                ;;
        esac    
        if [ &quot;$do_up&quot; = &quot;1&quot; -a &quot;$ret&quot; != &quot;0&quot; -a &quot;$TrustLevel&quot; = &quot;1&quot; ]; then
                echo &quot;3&quot;
                return 1
        fi"><pre>        TrustLevel=<span><span>`</span>tdb get SecureFW _TrustLevel_byte<span>`</span></span>
        verifyFirmware
        ret=<span>$?</span>
        <span>case</span> <span>$ret</span> <span>in</span>
                2)
                        sign=<span><span>"</span>not_signed<span>"</span></span>
                ;;
                0)
                        sign=<span><span>"</span>trust<span>"</span></span>
                ;;
                <span>*</span>)
                        sign=<span><span>"</span>untrust<span>"</span></span>
                ;;
        <span>esac</span>    
        <span>if</span> [ <span><span>"</span><span>$do_up</span><span>"</span></span> <span>=</span> <span><span>"</span>1<span>"</span></span> <span>-a</span> <span><span>"</span><span>$ret</span><span>"</span></span> <span>!=</span> <span><span>"</span>0<span>"</span></span> <span>-a</span> <span><span>"</span><span>$TrustLevel</span><span>"</span></span> <span>=</span> <span><span>"</span>1<span>"</span></span> ]<span>;</span> <span>then</span>
                <span>echo</span> <span><span>"</span>3<span>"</span></span>
                <span>return</span> 1
        <span>fi</span></pre></div>
<p dir="auto">So we don't need to sign the firmware if we change the <strong>SecureFW
_TrustLevel</strong> setting.  Or we can even sign it with a key unknown to
the camera if we like.  Which can be useful if we ever replace the
[<strong>rootfs</strong>]](#Partitions), since it will allow us to install our own verification
key and use it with D-Links tools.</p>
<p dir="auto">But what about the encryption?  This cannot be disabled.  This gets
even better: The decrypting key so graciously provided to us in the
<a href="#Partitions"><strong>pib</strong></a> partition is an RSA private key. So not only can we decrypt
the firmware with it, but we can also encrypt! Nice.</p>
<p dir="auto">The <a href="https://github.com/bmork/defogger/blob/master/Makefile"><strong>Makefile</strong></a> in this repo has examples of how to use this to
create firmware update images which are accepted by the <strong>fwupdate</strong>
and <strong>firmwareupgrade.cgi</strong> tools.  It uses an alternatative
<a href="https://github.com/bmork/defogger/blob/master/update.sh"><strong>update.bin</strong></a> made to modify only the <a href="#Partitions"><strong>userdata</strong></a> partition.  This
way we can install our own code in the camera, but still leave the
D-Link camera OS unmodified.</p>
<h4 tabindex="-1" dir="auto"><a name="user-content-BuildFirmware"></a>Bulding the example firmware update in this repo</h4>
<p dir="auto">Rebuilding the example is as easy as typing <strong>make</strong>.  The Makefile is a
noisy one, so you can see all that's going on:</p>
<div data-snippet-clipboard-copy-content="$ make
echo &quot;WARNING: keys/DCS-8000LH-sign.pem is missing - using a new abitrary key instead&quot;
WARNING: keys/DCS-8000LH-sign.pem is missing - using a new abitrary key instead
[ -f random-signkey.pem ] || openssl genrsa -out random-signkey.pem
Generating RSA private key, 2048 bit long modulus (2 primes)
...............................................................................................................................+++++
........................................................................................................................................................+++++
e is 65537 (0x010001)
openssl rsa -pubout -in random-signkey.pem -out verify.key
writing RSA key
echo &quot;Publisher:DMdssdFW1&quot; >certificate.info
echo &quot;Supported Models:DCS-8000LH,DCS-8000LH&quot; >>certificate.info
echo &quot;Firmware Version:1.0.0&quot; >>certificate.info
echo &quot;Target:update.bin&quot; >>certificate.info
echo &quot;Build No:9999&quot; >>certificate.info
echo &quot;Contents:update&quot; >>certificate.info
openssl rand 16 > aes.key
openssl rsautl -encrypt -in aes.key -inkey keys/DCS-8000LH-PriKey.pem -out aes.key.rsa
sed -ne 's/&quot;//g' -e 's/^VERSION *= *//p' dcs8000lh-configure.py >version
mksquashfs version opt.local opt.squashfs -all-root -comp xz
Parallel mksquashfs: Using 4 processors
Creating 4.0 filesystem on opt.squashfs, block size 131072.
[===============================================================================================================================================================================================================|] 2/2 100%

Exportable Squashfs 4.0 filesystem, xz compressed, data block size 131072
        compressed data, compressed metadata, compressed fragments, compressed xattrs
        duplicates are removed
Filesystem size 1.08 Kbytes (0.00 Mbytes)
        60.69% of uncompressed filesystem size (1.79 Kbytes)
Inode table size 98 bytes (0.10 Kbytes)
        100.00% of uncompressed inode table size (98 bytes)
Directory table size 46 bytes (0.04 Kbytes)
        100.00% of uncompressed directory table size (46 bytes)
Number of duplicate files found 0
Number of inodes 3
Number of files 2
Number of fragments 1
Number of symbolic links  0
Number of device nodes 0
Number of fifo nodes 0
Number of socket nodes 0
Number of directories 1
Number of ids (unique uids + gids) 1
Number of uids 1
        root (0)
Number of gids 1
        root (0)
openssl aes-128-cbc -md md5 -kfile aes.key -nosalt -e -out update.aes -in opt.squashfs
*** WARNING : deprecated key derivation used.
Using -iter or -pbkdf2 would be better.
*** WARNING : deprecated key derivation used.
Using -iter or -pbkdf2 would be better.
sed  -e &quot;s/@@MODEL@@/\&quot;DCS-8000LH\&quot;/&quot; -e &quot;s/@@MD5SUM@@/\&quot;f1a1d3952c1630e5adb53e7f93b59d5e\&quot;/&quot; -e &quot;s/@@VERSION@@/\&quot;1.0.0-9999\&quot;/&quot; update.sh >update.bin
openssl aes-128-cbc -md md5 -kfile aes.key -nosalt -e -out update.bin.aes -in update.bin
*** WARNING : deprecated key derivation used.
Using -iter or -pbkdf2 would be better.
openssl dgst -sha1 update.aes | cut -d' ' -f2 > update.sha1
cat update.bin.aes aes.key.rsa certificate.info update.sha1 | openssl dgst -sha1 | cut -d' ' -f2 > sign.sha1
openssl rsautl -sign -inkey random-signkey.pem -out sign.sha1.rsa -in sign.sha1
tar cvf fw.tar certificate.info aes.key.rsa sign.sha1.rsa update.aes update.bin.aes verify.key
certificate.info
aes.key.rsa
sign.sha1.rsa
update.aes
update.bin.aes
verify.key
"><pre><code>$ make
echo "WARNING: keys/DCS-8000LH-sign.pem is missing - using a new abitrary key instead"
WARNING: keys/DCS-8000LH-sign.pem is missing - using a new abitrary key instead
[ -f random-signkey.pem ] || openssl genrsa -out random-signkey.pem
Generating RSA private key, 2048 bit long modulus (2 primes)
...............................................................................................................................+++++
........................................................................................................................................................+++++
e is 65537 (0x010001)
openssl rsa -pubout -in random-signkey.pem -out verify.key
writing RSA key
echo "Publisher:DMdssdFW1" &gt;certificate.info
echo "Supported Models:DCS-8000LH,DCS-8000LH" &gt;&gt;certificate.info
echo "Firmware Version:1.0.0" &gt;&gt;certificate.info
echo "Target:update.bin" &gt;&gt;certificate.info
echo "Build No:9999" &gt;&gt;certificate.info
echo "Contents:update" &gt;&gt;certificate.info
openssl rand 16 &gt; aes.key
openssl rsautl -encrypt -in aes.key -inkey keys/DCS-8000LH-PriKey.pem -out aes.key.rsa
sed -ne 's/"//g' -e 's/^VERSION *= *//p' dcs8000lh-configure.py &gt;version
mksquashfs version opt.local opt.squashfs -all-root -comp xz
Parallel mksquashfs: Using 4 processors
Creating 4.0 filesystem on opt.squashfs, block size 131072.
[===============================================================================================================================================================================================================|] 2/2 100%

Exportable Squashfs 4.0 filesystem, xz compressed, data block size 131072
        compressed data, compressed metadata, compressed fragments, compressed xattrs
        duplicates are removed
Filesystem size 1.08 Kbytes (0.00 Mbytes)
        60.69% of uncompressed filesystem size (1.79 Kbytes)
Inode table size 98 bytes (0.10 Kbytes)
        100.00% of uncompressed inode table size (98 bytes)
Directory table size 46 bytes (0.04 Kbytes)
        100.00% of uncompressed directory table size (46 bytes)
Number of duplicate files found 0
Number of inodes 3
Number of files 2
Number of fragments 1
Number of symbolic links  0
Number of device nodes 0
Number of fifo nodes 0
Number of socket nodes 0
Number of directories 1
Number of ids (unique uids + gids) 1
Number of uids 1
        root (0)
Number of gids 1
        root (0)
openssl aes-128-cbc -md md5 -kfile aes.key -nosalt -e -out update.aes -in opt.squashfs
*** WARNING : deprecated key derivation used.
Using -iter or -pbkdf2 would be better.
*** WARNING : deprecated key derivation used.
Using -iter or -pbkdf2 would be better.
sed  -e "s/@@MODEL@@/\"DCS-8000LH\"/" -e "s/@@MD5SUM@@/\"f1a1d3952c1630e5adb53e7f93b59d5e\"/" -e "s/@@VERSION@@/\"1.0.0-9999\"/" update.sh &gt;update.bin
openssl aes-128-cbc -md md5 -kfile aes.key -nosalt -e -out update.bin.aes -in update.bin
*** WARNING : deprecated key derivation used.
Using -iter or -pbkdf2 would be better.
openssl dgst -sha1 update.aes | cut -d' ' -f2 &gt; update.sha1
cat update.bin.aes aes.key.rsa certificate.info update.sha1 | openssl dgst -sha1 | cut -d' ' -f2 &gt; sign.sha1
openssl rsautl -sign -inkey random-signkey.pem -out sign.sha1.rsa -in sign.sha1
tar cvf fw.tar certificate.info aes.key.rsa sign.sha1.rsa update.aes update.bin.aes verify.key
certificate.info
aes.key.rsa
sign.sha1.rsa
update.aes
update.bin.aes
verify.key

</code></pre></div>
<p dir="auto">This will produce a new <strong>fw.tar</strong> firmware update image.</p>
<h2 tabindex="-1" dir="auto">Contact</h2>
<p dir="auto">Please contact me on <a href="mailto:bjorn@mork.no">bjorn@mork.no</a> if you have questions, comments or
just want to say hi.</p>
<p dir="auto">But please note that I won't be able to provide any support for this.
I am making this information available for educational purposes.  If
you find it useful, then great!  If you brick a camera, then I am
truly sorry about that.  But there isn't much I can do about it....</p>
</article>
          </div></div>]]></description>
        </item>
    </channel>
</rss>