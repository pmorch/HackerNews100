<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
    <channel>
        <title>HN100 - Readable Contents</title>
        <link>https://hn.algolia.com/api/v1/search_by_date?tags=%28story,poll%29&amp;numericFilters=points%3E100</link>
        <description>Uses Readability to add bodies to the RSS feed</description>
        <lastBuildDate>Mon, 17 Nov 2025 18:30:01 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Google is killing the open web, part 2 (213 pts)]]></title>
            <link>https://wok.oblomov.eu/tecnologia/google-killing-open-web-2/</link>
            <guid>45954560</guid>
            <pubDate>Mon, 17 Nov 2025 15:41:08 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://wok.oblomov.eu/tecnologia/google-killing-open-web-2/">https://wok.oblomov.eu/tecnologia/google-killing-open-web-2/</a>, See on <a href="https://news.ycombinator.com/item?id=45954560">Hacker News</a></p>
<div id="readability-page-1" class="page"><article class="page" lang="en">







<section id="pagebody" role="main">
<p>I wrote a few months ago about <a href="https://wok.oblomov.eu/tecnologia/google-killing-open-web/">the proxy war by Google against the open web by means of XSLT</a>.
Unsurprisingly, <a href="http://en.wikipedia.org/wiki/Google">Google</a> <a href="https://developer.chrome.com/docs/web-platform/deprecating-xslt" title="Deprecating and removing XSLT in the browser">has been moving forward on the deprecation</a>,
still without providing a solid justification on the reasons why other than
“we've been leeching off a <a href="http://en.wikipedia.org/wiki/FLOSS">FLOSS</a> library for which we've finally found enough security bugs to use as an excuse”.
They do not explain why they haven't decided to fix the security issues in the library instead,
or adopt a more modern library written in a safe language, taking the opportunity to upgrade <a href="https://wok.oblomov.eu/tag/XSLT/" rel="tag">XSLT</a> support
to a more recent, powerful and easier-to-use revision of the standard.</p>

<p>Instead, what they do is to provide a “polyfill”, a piece of <a href="https://wok.oblomov.eu/tag/javascript/" rel="tag">JavaScript</a> that can allegedly used to supplant the functionality.
Curiously, however, they do <em>not</em> plan to ship such alternative in-browser,
which would allow a transparent transition without even a need to talk about XSLT <em>at all</em>.
No, they specifically refuse to do it, and instead are requesting anyone still relying on XSLT to
replace the invocation of the XSLT with a <em>non-standard</em> invocation of the JavaScript polyfill that should replace it.</p>

<p>This means that at least one of these two things are true:</p>

<ol>
<li><p>the polyfill is not, in fact, sufficient to cover all the use cases previously covered by the built-in support for XSLT,
and insofar as it's not, they (Google) do not intend to invest resources in maintaining it,
meaning that the task is being dumped on web developers
(<abbr title="In Other Words">IOW</abbr>, Google is removing a feature that is going to create
<em>more work</em> for web developers just to provide the same functionality that they used to have from the browsers);</p></li>
<li><p>insofar as the polyfill is sufficient to replace the XSLT support in the browser,
the policy to not ship it as a replacement confirms that the security issues in the XSLT library used in Chrome
were nothing more than excuses to give the final blow to <a href="https://wok.oblomov.eu/tag/rss/" rel="tag">RSS</a> and any other <a href="https://wok.oblomov.eu/tag/XML/" rel="tag">XML</a> format
that is still the backbone of an independent web.</p></li>
</ol>

<p>As I have mentioned <a href="https://developer.chrome.com/docs/web-platform/deprecating-xslt" title="DO NOT COMPLY.">in the Fediverse thread I wrote before this long-form article</a>,
there's an obvious parallel here with the events that I already mentioned
<a href="https://wok.oblomov.eu/tecnologia/google-killing-open-web/">in my previous article</a>:
when <a href="https://wok.oblomov.eu/tag/mozilla/" rel="tag">Mozilla</a> bent over to <a href="https://wok.oblomov.eu/tag/google/" rel="tag">Google</a>'s pressure to kill off RSS by removing the “Live Bookmarks” features from the browser,
they did this on presumed technical grounds (citing as usual <a href="https://www.gijsk.com/blog/2018/10/firefox-removes-core-product-support-for-rss-atom-feeds/" title="Firefox removes core product support for RSS/Atom feeds">security and maintenance costs</a>,
but despite paid lip service to their importance for an open and interoperable web,
they didn't provide any official replacement for the functionality,
directing users instead to <a href="https://support.mozilla.org/en-US/kb/feed-reader-replacements-firefox" title="Feed reader replacements for Firefox">a number of add-ons that provided similar functionality</a>,
<em>none of which are written or supported by Mozilla</em>.
Compare and contrast with their <a href="http://en.wikipedia.org/wiki/Pocket%20%28service%29">Pocket</a> integration that they force-installed everywhere
<a href="https://support.mozilla.org/en-US/kb/future-of-pocket" title="Pocket has shut down - What you need to know">before ultimately killing the service</a></p>

<p>Actions, as they say, speak louder than words.
When a company claims that a service or feature they are removing can be still accessed by other means,
but do not streamline such access said alternative,
and instead require their users to do the work necessary to access it,
you can rest assured that beyond any word of support they may coat their actions with
there is a plain and direct intent at sabotaging said feature,
and you can rest assured that any of the excuses brought forward to defend the choice
are nothing but lies to cover a vested interest in sabotaging the adoption of the service or feature:
the intent is for you to <em>not</em> use that feature at all, because they have a financial interest in you <em>not</em> using it.</p>

<p>And the best defense against that is to attack, and push the use of that feature even harder.</p>

<div>
<ol>
	<li><a href="#index1h1">Google is killing the open web, part 2</a>
	<ol>
		<li><a href="#do.not.comply.">Do. Not. Comply.</a>
		</li>
		<li><a href="#thewhatwgisnotagoodstewardoftheopenweb">The WHATWG is not a good steward of the open web</a>
		</li>
		<li><a href="#anewbrowserwar">A new browser war?</a>
		</li>
		<li><a href="#gemini">Another web?</a>
		</li>
		<li><a href="#awebofinterconnectedsoftware">A Web of interconnected software?</a>
		<ol>
			<li><a href="#theroleofmultimediastreaminginthedeathoftheuseragent">The role of multimedia streaming in the death of the User Agent</a>
			</li>
			<li><a href="#controlledevolution">Controlled evolution</a>
			</li>
			<li><a href="#ameshofbuildingblocks">A mesh of building blocks</a>
			</li>
		</ol>
		</li>
		<li><a href="#resist">Resist</a>
		</li>
		<li><a href="#postscriptum">Post scriptum</a>
		</li>
	</ol>
	</li>
</ol>
</div>

<h2 id="do.not.comply."><a name="index1h2"></a>Do. Not. Comply.</h2>

<p>This is the gist of <a href="https://developer.chrome.com/docs/web-platform/deprecating-xslt" title="DO NOT COMPLY.">my Fediverse thread</a>.</p>

<p>
Do not install the polyfill.
Do not change your XML files to load it.
Instead, flood their issue tracker with requests to bring back in-browser XSLT support.
Report failed support for XSLT as a broken in browsers, because this is not a website issue.
</p>

<p><strong>I will not comply.</strong>
As I have for <em>years</em> continued using <a href="https://wok.oblomov.eu/tag/mathml/" rel="tag">MathML</a>, <a href="https://wok.oblomov.eu/tag/svg/" rel="tag">SVG</a> and <a href="https://wok.oblomov.eu/tag/smil/" rel="tag">SMIL</a>
(sometimes <a href="https://wok.oblomov.eu/ars/halving-series/">even all together</a>) despite Google's intent on their deprecation,
I will keep using XSLT, and in fact will look for new opportunities to rely on it.
At most, I'll set up an infobox warning users reading my site about their browser's potential brokenness
and inability to follow standards, just like I've done for MathML and SMIL
(you can see such infoboxes in the page I linked above).
And just like ultimately I was proven right
(after several years, Google ended up fixing both their SMIL and their MathML support in Chrome),
my expectation is that, particularly with more of us pushing through,
the standards will once again prevail.</p>

<p>Remember: there is not technical justification for Google's choice.
This is not about a lone free software developer donating their free time to the community
and finding they do not have the mental or financial resources to provide a particular feature.
This is a trillion-dollar ad company who has been actively destroying the open web
for over a decade <a href="https://www.theverge.com/news/773928/google-open-web-rapid-decline" title="Google admits the open web is in ‘rapid decline’">and finally admitting to it</a>
as a consequence of the <abbr title="Large Language Model">LLM</abbr> push
and <a href="https://www.wheresyoured.at/the-men-who-killed-google/" title="The man who killed Google Search">intentional</a> [enshittification of web search]<a href="https://www.404media.co/google-search-really-has-gotten-worse-researchers-find/" title="Google Search Really Has Gotten Worse, Researchers Find">404mediaSearch</a>.</p>

<p>The deprecation of XSLT is entirely political,
fitting within the same grand scheme of the parasitic corporation killing the foundations of its own success
in an effort to grasp more and more control of it.
And the fact that the <a href="https://wok.oblomov.eu/tag/webkit/" rel="tag">WebKit</a> team at <a href="http://en.wikipedia.org/wiki/Apple%20Inc%2E">Apple</a>
and the <a href="https://wok.oblomov.eu/tag/firefox/" rel="tag">Firefox</a> team at <a href="http://en.wikipedia.org/wiki/Mozilla">Mozilla</a>
are intentioned to follow along on the same destructive path is not a counterpoint,
but rather an endorsement of the analysis,
as neither of those companies is interested in providing a <a href="https://wok.oblomov.eu/tecnologia/not-your-pc/">User Agent</a>
<span id="surveillance">as much as a <a href="http://en.wikipedia.org/wiki/surveillance%20capitalism">surveillance capitalism</a> tool that you happen to use.</span></p>

<p>(Hence why Mozilla, a company allegedly starved for resources,
is wasting them implementing <a href="https://flamedfury.com/posts/disable-ai-in-firefox/">LLM features nobody wants</a>
instead of <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=155730">fixing much-voted decade-old bugs with several duplicates</a>.
Notice how the bug pertains the (mis)treatment of XML-based formats —like RSS.)</p>

<p>If you have to spend any time at all to confront the Chrome push to deprecate XSLT,
your time is much better spent inventing better uses of XSLT
and reporting broken rendering if/when they start disabling it,
than caving to their destructive requests.</p>

<h2 id="thewhatwgisnotagoodstewardoftheopenweb"><a name="index2h2"></a>The WHATWG is not a good steward of the open web</h2>

<p>I've mentioned it <a href="https://wok.oblomov.eu/tecnologia/google-killing-open-web/">before</a>,
but the <a href="http://en.wikipedia.org/wiki/WHATWG">WHATWG</a>, even assuming the best of intentions at the time it was founded,
is not a good steward of the open web.
It is more akin to the corrupt takeover you see in <a href="http://en.wikipedia.org/wiki/regulatory%20capture">regulatory capture</a>,
except that instead of taking over the <a href="http://en.wikipedia.org/wiki/W3C">W3C</a>
they just decided to get the ball and run with it,
taking advantage of the fact that, as implementors,
they had the final say on what counted as “standard”
(<em lang="lat">de facto</em> if not <em lang="lat">de jure</em>):
exactly the same attitude with which <a href="http://en.wikipedia.org/wiki/Microsoft">Microsoft</a> tried taking over the web
through <a href="http://en.wikipedia.org/wiki/Internet%20Explorer">Internet Explorer</a> at the time of the <a href="http://en.wikipedia.org/wiki/First%20browser%20war">First browser war</a>,
an attitude that was rightly condemned at the time
—even as many of those who did, have so far failed to acknowledge the problem
with Google's no less detrimental approach.</p>

<p>The key point here is that,
whatever the <a href="https://wok.oblomov.eu/tag/WHATWG/" rel="tag">WHATWG</a> was (or was intended to be)
when it was founded by <a href="http://en.wikipedia.org/wiki/Opera%20%28company%29">Opera</a> and <a href="http://en.wikipedia.org/wiki/Mozilla">Mozilla</a> developers,
it is now manifestly a corporate monster.
Their corporate stakeholder have a very different vision of what the Web should be
compared to the vision on which the Web was founded, the vision promoted by the <a href="https://wok.oblomov.eu/tag/W3C/" rel="tag">W3C</a>,
and the vision that underlies a truly open and independent web.</p>

<p>The WHATWG aim is to turn the Web into an <em>application delivery platform</em>,
a profit-making machine for corporations where the computer
(and the browser through it)
are a means for <em>them</em> to make money off <em>you</em>
rather than for <em>you</em> to gain access to services you may be interested in.
Because of this, the browser in their vision is not a User Agent anymore,
but a tool that sacrifices privacy, actual security and user control
at the behest of the corporations “on the other side of the wire”
—and of their political interests
(refs. for <a href="https://www.axios.com/2025/01/03/tim-cook-apple-donate-1-million-trump-inauguration" title="Scoop: Apple CEO Tim Cook donates $1 million to Trump inauguration">Apple</a>, <a href="https://www.politico.com/live-updates/2025/01/09/congress/google-donation-donald-trump-inauguration-00197233" title="Google gives $1 million to Trump inauguration">Google</a>,
and <a href="https://edition.cnn.com/2025/10/23/politics/ballroom-donors-white-house-trump" title="White House releases list of donors for Trump’s multi-million-dollar ballroom">a more recent list with all of them together</a>).</p>

<p>Such vision is in direct contrast with that of the Web as a
<em>repository of knowledge</em>, a vast vault of interconnected <em>documents</em>
whose value emerges from organic connections, personalization,
variety, curation and <em>user control</em>.
But who in the WHATWG today would defend such vision?</p>

<h2 id="anewbrowserwar"><a name="index3h2"></a>A new browser war?</h2>

<p>Maybe what we need is a new browser war.
Not one of corporation versus corporation
—doubly more so when all currently involved parties are allied
in their efforts to enclose the Web than in fostering an open and independent one—
but one of users versus corporations,
a war to take <em>back</em> control of the Web and its tools.</p>

<p>It's kind of ironic that in a time when <em>hosting</em> has become almost trivial,
the fight we're going to have to fight is going to be on the <em>client</em> side.
But the biggest question is: who do we have as champions on our side?</p>

<p>I would have liked to see browsers like <a href="https://vivaldi.net/">Vivaldi</a>,
the spiritual successor to <a href="https://wok.oblomov.eu/tecnologia/opera-requiem/">my beloved classic Opera browser</a>,
amongst our ranks,
but with their dependency on the <a href="https://wok.oblomov.eu/tag/blink/" rel="tag">Blink</a> rendering engine, controlled by Google,
they won't be able to do anything but cave,
as will all other FLOSS browsers relying on Google's or Apple's engines,
none of which I foresee spending any significant efforts rolling back the extensive changes that these deprecations will involve.
(We see this already when it comes to JPEG&nbsp;XL support,
but it's also true that e.g. Vivaldi has made RSS feeds first-class documents,
so who knows, maybe they'll find a way for XSLT through the polyfill that was mentioned above,
or something like that?)</p>

<p>Who else is there?
There is <a href="https://servo.org/">Servo</a>, the rendering engine that was being developed at Mozilla to replace Gecko,
and that turned into an independent project when its team was fired <em lang="lat">en masse</em> <a href="https://www.cnet.com/tech/computing/mozilla-cutting-250-jobs-after-coronavirus-pandemic-cuts-revenue/">in 2020</a>;
but they don't support XSLT yet,
and I don't see why they would prioritize its implementation over, say, stuff like MathML or SVG animations with SMIL
(just to name two of my pet peeves), or optimizing browsing speed
(seriously, try opening <a href="https://wok.oblomov.eu/">the home page of this site</a> and scrolling through).</p>

<p>What we're left with at the moment is basically just Firefox forks,
and two of these (<a href="https://librewolf.net/">LibreWolf</a> and <a href="https://waterfox.net/">WaterFox</a>)
are basically just “Firefox without the most egregious privacy-invasive misfeatures”,
which leaves the question open about what they will be willing to do when Mozilla helps Google kill XSLT,
and only the other one, <a href="https://palemoon.org/">Pale&nbsp;Moon</a>, has grown into its own independent fork
(since such an old version of Firefox, in fact, that it doesn't support WebExtensions-based plugins,
such as the most recent versions of crucial plugins like <a href="http://en.wikipedia.org/wiki/uBlock%20Origin">uBlock Origin</a> or <a href="http://en.wikipedia.org/wiki/Privacy%20Badger">Privacy Badger</a>,
although it's possible to install community-supported forks of these plugins designed
for legacy versions of Firefox and forks like Pale&nbsp;Moon).</p>

<p>(Yes, I am aware that there are other minor independent browser projects,
like <a href="https://dillo-browser.github.io/">Dillo</a> and <a href="https://ladybird.org/">Ladybird</a>,
but the former is in no shape of being a serious contender for general use
on more sophisticated pages —just see it in action on this site, as always—
and the latter is not even in alpha phase,
just in case the questionable “no politics” policies
—which consistently prove to be weasel words for “we're right-wingers but too chicken to come out as such”—
weren't enough to stay away from it.)</p>

<p>Periodically, I go through them (the Firefox forks, that is) to check if they are good enough for me to become my daily drivers.
Just for you (not really: just for me, actually), I just tested them again.
They're not ready yet, at least not for me, although I must say that I'm seeing clear improvements since my last foray into the matter,
that wasn't even that long ago.
In some cases, I can attest that they are even better than Firefox:
for example, Pale&nbsp;Moon and WaterFox have good JPEG&nbsp;XL support
(including transparency and animation support,
which break in LibreWolf as they do in the latest nightly version of Firefox I tried),
and Pale&nbsp;Moon still has first-class support for RSS,
from address bar indicator to rendering even in the absence of a stylesheet
(be it CSS or XSLT).</p>

<p>(A suggestion? Look into more <a href="http://en.wikipedia.org/wiki/microformats">microformats</a> support.
An auxiliary bar with previous/<wbr>next/<wbr>up links on pages where this is relevant
would be a nice touch, for example.
<a href="https://wok.oblomov.eu/tecnologia/opera-requiem-3/">It's one of those little details that really made classic Opera shine</a>.
EDIT: I <a href="https://pleroma.envs.net/objects/3bafa2dc-9621-4f13-a8f2-89fd000ba862">just found out</a>
that there's <a href="https://addons.palemoon.org/addon/website-navigation-bar/">a relevant addon</a> for Pale Moon!)</p>

<p>An interesting difference is that the user interface of these browsers is perceivably less refined than Firefox'.
It's a bit surprising, given the common roots,
but it emerges in several more and less apparent details,
from the spacing between menu items to overlapping text and icons in context menus,
passing through incomplete support for dark themes and other little details that all add up,
giving these otherwise quite valid browsers and amateurish feeling.</p>

<p>And I get it: UI design is hard, and I myself suck at it, so I'm the last person that should be giving recommendations,
but I'm still able to differentiate between more curated interfaces and ones that need some work;
and if even someone like me who distinctly prefers function over form finds these little details annoying,
I can imagine how much worse this may feel to users who care less about the former and more about the latter.
Sadly, if a new browser war is to be fought to wrestle control from the corporate-controlled WHATWG,
<em>this matters</em>.</p>

<p>In the end, I find myself in a “waiting” position.
How long will it take for Firefox to kill their XSLT support?
What will its closest forks
(WaterFox in particular is the one I'm eyeing)
be able to do about it?
Or will Pale&nbsp;Moon remain the only modern broser with support for it,
as a hard fork that has since long gone its own way?
Will they have matured enough to become my primary browsers?
We'll see in time.</p>

<h2 id="gemini"><a name="index4h2"></a>Another web?</h2>

<p>There's more to the Internet than the World Wide Web built around the <a href="http://en.wikipedia.org/wiki/HTTP">HTTP</a> protocol and the <a href="http://en.wikipedia.org/wiki/HTML">HTML</a> file format.
There used to be <em>a lot</em> of the Internet beyond the Web,
and while much of it still remains as little more than a shadow of the past,
largely eclipsed by the Web and what has been built on top of it
(not all of it good) outside of some modest revivals,
there's also new parts of it that have tried to learn from the past,
and build towards something different.</p>

<p>This is the case for example of the so-called “<a href="http://en.wikipedia.org/wiki/Gemini%20%28protocol%29">Gemini</a> Space”,
a small corner of the Internet that has nothing to do with the LLM Google is trying to shove down everyone's throat,
and in fact not only predates it, <a href="https://wok.oblomov.eu/tecnologia/google-killing-open-web/">as I've mentioned already</a>,
but is intentionally built around dfferent technology to <em>stay away</em> from the influence of Google and the like.</p>

<p>The Gemini protocol is designed to be conceptually simpler than HTTP,
while providing modern features like built-in transport-level security
and certificate-based client-side authentication,
and its own “native” document format, the so-called <a href="https://geminiprotocol.net/docs/gemtext-specification.gmi" title="Gemini hypertext format, aka 'gemtext', specification">gemtext</a>.</p>

<p>As I said in <a href="https://developer.chrome.com/docs/web-platform/deprecating-xslt" title="DO NOT COMPLY.">my aforementioned Fediverse thread</a>:</p>

<p>
There's something to be said about not wanting to share your environment with the poison that a large part of the web has become,
but at the same time, there's also something to be said about throwing away the baby with the bathwater.
The problem with the web isn't technical, it's social. The tech itself is fine.
</p>

<p>I'm not going to write up an extensive criticism of the Gemini Space:
you can <a href="https://daniel.haxx.se/blog/2023/05/28/the-gemini-protocol-seen-by-this-http-client-person/" title="The Gemini protocol seen by this HTTP client person">find here an older opinion</a> by the author of <a href="http://en.wikipedia.org/wiki/Curl%20%28software%29"><code>curl</code></a>,
(although it should be kept in mind that things have changed quite a bit since:
for example, <a href="https://geminiprotocol.net/docs/" title="Gemini protocol documentation">the specification of the different components has been separated</a>,
as suggested by Daniel),
and <a href="https://aartaka.me/gmi-a11y.html" title="Gemtext Is Not Accessible">some criticism about how gemtext is used</a>.</p>

<p>I'm not going to sing the praises of the Gemini protocol or gemtext either,
even though I do like the idea of a web built on lightweight markup formats:
I would love it if browsers had native support for formats like
<a href="http://en.wikipedia.org/wiki/Markdown">Markdown</a> or <a href="http://en.wikipedia.org/wiki/AsciiDoc">AsciiDoc</a> (and gemtext, for the matter):
it's why I keep the <a href="https://docs.asciidoctor.org/browser-extension/" title="Asciidoctor Browser Extension Documentation">AsciiDoctor Browser Extension</a> installed.</p>

<p>But more in general, the Web (or at least its user agents) should not differentiate.
It should not differentiate by protocol, and it should not differentiate by format.
We've seen it with image formats like <a href="http://en.wikipedia.org/wiki/MNG">MNG</a> being unfairly excluded,
with [motivations based on alleged code bloat][nomng] that today are manifest in their idiocy
(and yes, it hasn't escaped my that even Pale&nbsp;Moon doesn't support the format),
and we're seeing it today with JPEG&nbsp;XL threatened with a similar fate,
without even gracing us with a ridiculous excuse.
On the upside, we have browsers shipping with <a href="https://mozilla.github.io/pdf.js/">a full-fledged PDF reader</a>,
which is a good step towards the integration of this format with the greater Web.</p>

<p>In an ideal world, browsers would have not deprecated older protocols
like <a href="http://en.wikipedia.org/wiki/Gopher%20%28protocol%29">Gopher</a> or <a href="http://en.wikipedia.org/wiki/FTP">FTP</a>,
and would just add support for new ones like Gemini,
as they would have introduced support for new (open) document formats as they came along.</p>

<p>(<a name="flash">Why insist on the <em>open</em> part?</a>
In <a href="https://mastodon.social/@whitequark/115509662529186486">another Fediverse thread about the XSLT deprecation</a>
I had an interesting discussion with the <abbr title="Original Poster">OP</abbr> about <a href="http://en.wikipedia.org/wiki/SWF">SWF</a>,
<em>the</em> interactive multimedia format for the Web at the turn of the century.
The <a href="http://en.wikipedia.org/wiki/Adobe%20Flash%20Player">Adobe Flash Player</a> ultimately fell out of favour,
arguably due to the advent of mobile Internet:
it has been argued that <a href="https://en.wikipedia.org/wiki/Adobe_Flash#End_of_life" title="Adobe Flash - End of life">the iPhone killed Flash</a>,
and while there's some well-deserved criticism of hypocrisy levelled against <a href="http://en.wikipedia.org/wiki/Steve%20Jobs">Steve Jobs</a> infamous <a href="http://en.wikipedia.org/wiki/Thoughts%20on%20Flash">Thoughts on Flash</a> letter,
it <em>is</em> true that what ultimatelly <em>truly</em> killed the format was it being proprietary and not fully documented.
And while we might not want to cry about the death of a proprietary format,
it remains true even today that the loss of even just legacy suport for it
<a href="https://mastodon.social/@whitequark/115512475517697743" title="flash was way more valuable to culture and art than xslt is ever going to be.">has been a significant loss to culture and art</a>,
as argued by <a href="https://mastodon.social/@whitequark">@whiteshark​@mastodon.social</a>.)</p>

<h2 id="awebofinterconnectedsoftware"><a name="index5h2"></a>A Web of interconnected software?</h2>

<p>It shouldn't be up to the User Agent to determine which formats the user is able to access, and through which protocol.
(If I had any artistic prowess (and willpower), I'd hack the “myth of consensual X” meme
representing the user and the server saying “I consent”, and the browser saying “I don't”.)
I do appreciate that there is a non-trivial maintenance cost that grows with the number of formats and protocols,
but <a href="https://wok.oblomov.eu/tecnologia/opera-requiem-2/">we know from classic Opera</a> that it is indeed quite possible
to <a href="https://wok.oblomov.eu/tecnologia/opera-requiem-3/">ship a full Internet suite</a> in a browser packaging.</p>

<p>In the old days, browser developers were well-aware that a single vendor couldn't “cover all bases”,
which is how interfaces like the once ubiquituous <a href="http://en.wikipedia.org/wiki/NPAPI">NPAPI</a> were born.
The plug-in interface has been since removed from most browsers,
an initiative <a href="https://www.chromium.org/developers/npapi-deprecation/" title="NPAPI deprecation: developer guide">again promoted by Google</a>, announced in 2013 and completed in 2015
(I should really add this to <a href="https://wok.oblomov.eu/tecnologia/google-killing-open-web/">my previous post on Google killing the open web</a>,
but I also really don't feel like touching that anymore; here will have to suffice),
with the other major browsers quickly following suit,
and its support is now relegated only to independent browsers like Pale&nbsp;Moon.</p>

<p>And even if it can be argued that the NPAPI specifically was indeed mired with unfixable security and portability issues and it had to go,
its removal without a clear cross-browser upgrade path has been <a name="pluginevolution">a significant loss for the evolution of the web</a>,
destroying the primary “escape hatch” to solve the chicken-and-egg problem of client-side format support versus server-side format adoption.
By the way, it was also responsible for the biggest <a href="http://en.wikipedia.org/wiki/W3C">W3C</a> blunder,
the standardization of <abbr title="Digital Restriction Management">DRM</abbr> for the web through the so-called
<a href="http://en.wikipedia.org/wiki/Encrypted%20Media%20Extensions">Encrypted Media Extensions</a>, a betrayal of the W3C own mission statement.</p>

<h3 id="theroleofmultimediastreaminginthedeathoftheuseragent"><a name="index1h3"></a>The role of multimedia streaming in the death of the User Agent</h3>

<p>The timeline here is quite interesting, and correlates with <a href="#flash">the already briefly mentioned history of Flash</a>,
and its short-lived <a href="http://en.wikipedia.org/wiki/Microsoft%20Silverlight">Microsoft Silverlight</a> competitor, that were largely responsible for
<a href="https://en.wikipedia.org/wiki/Streaming_media#Business_developments">the early expansive growth of multimedia streaming services</a> in the early years of the XXI century:
with the tension between Apple's effort to kill Flash
and the need of emerging streaming services like <a href="http://en.wikipedia.org/wiki/Netflix">Netflix</a>' and <a href="http://en.wikipedia.org/wiki/Hulu">Hulu</a>'s
to support in-browser multimedia streaming,
there was a need to improve support for multimedia formats in the nascent <a href="http://en.wikipedia.org/wiki/HTML5">HTML5</a> specification,
but also a requirement from the <a href="https://en.wiktionary.org/wiki/MAFIAA"><abbr title="Music And Film Industry Associations of America">MAFIAA</abbr></a> partners
that such a support would allow enforcing the necessary restrictions that would, among other things, prevent users from saving a local copy of the stream,
something that could be more easily enforced within the Flash players the industries had control over
than in a <em>User Agent</em> controlled by <em>the user</em>.</p>

<p>This is where the development of <abbr title="Encrypted Media Extensions">EME</abbr> came in in 2013:
this finally allowed a relatively quick phasing out of the Flash plugin,
and <em lang="lat">a posteriori</em> of the plugin interface that allowed its integration with the browsers:
by that time, the Flash plugin was by and large <em>the</em> plugin the API existed for,
and the plugin itself was indeed still supported by the browsers for some time after support for the API was otherwise discontinued
(sometimes through alternative interfaces such as the <a href="http://en.wikipedia.org/wiki/PPAPI">PPAPI</a>,
other times by keeping the NPAPI support around, but only enabled for the Flash plugin).</p>

<p>There are several interesting consideration that emerge from this little glimpse at the history of Flash and the EME.</p>

<p>First of all,
this is one more piece of history that goes to show how pivotal the year 2013 was for the enshittification of the World Wide Web,
<a href="https://wok.oblomov.eu/tecnologia/google-killing-open-web/#2013">as discussed already</a>.</p>

<p>Secondly,
it shows how the developers of major browsers are more than willing to provide a smooth transition path with no user intervention,
at least when catering to the interests of major industries.
This indicates that when they don't, it's not because they <em>can't</em>:
it's because <em>they have a vested interest in not doing it</em>.
Major browser development is now (and has been for over a decade at least)
beholden not to the needs and wants of <em>their own users</em>,
but to those of other industries.
<a href="#surveillance">But I repeat myself</a>.</p>

<p>And thirdly, it's an excellent example, for the good and the bad, of how the plugin interface has helped drive the evolution of the web,
<a href="#pluginevolution">as I was saying</a>.</p>

<h3 id="controlledevolution"><a name="index2h3"></a>Controlled evolution</h3>

<p>The removal of NPAPI support,
followed a few years later by the removal of the (largely Chrome-specific) PPAPI interface
(that was supposed to be the “safer, more portable” evolution of NPAPI),
without providing <em>any</em> alternative,
is a very strong indication of the path that browser development has taken in the last “decade plus”:
a path where the Web is entirely controlled by what Google, Apple and Microsoft
(hey look, it's <a href="http://en.wikipedia.org/wiki/GAFAM">GAFAM</a> all over again!) decide about what is allowed on it,
and what is <em>not</em> allowed to <em>not</em> be on it (to wit, ads and other user tracking implements).</p>

<p>In this perspective,
the transition from plugins to <a href="http://en.wikipedia.org/wiki/browser%20extensions">browser extensions</a> cannot be viewed (just) as a matter of security and portability,
but —more importantly, in fact— as a matter of crippled functionality:
indeed, extensions maintain <em>enough capabilities</em> to be <a href="https://en.wikipedia.org/wiki/Browser_extension#Unwanted_behavior" title="Browser extension - Unwanted behavior">a vector of malware and adware</a>,
but <em>not enough</em> to circumvent unwanted browser behavior,
doubly more so with the so-called <a href="https://developer.chrome.com/docs/extensions/develop/migrate/what-is-mv3" title="Extensions / Manifest V3">Extension Manifest V3</a>
specifically designed to thwart ad blocking
<a href="https://wok.oblomov.eu/tecnologia/google-killing-open-web/#mv3">as I've already mentioned in the previous post of the series</a>.</p>

<p>With plugins, <em>anything</em> could be integrated in the World Wide Web,
and such integration would be close to as efficient as could be.
Without plugins, such integration, when possible at all,
becomes clumsier and more expensive.</p>

<p>As an example, there are browser extensions that can introduce support for JPEG&nbsp;XL to browsers that don't have native support.
This provides a workaround to display such images in said browsers,
but when a picture with multiple formats is offered
(which is what I do e.g. to provide a PNG fallback for the JXL images I provide),
this results in <em>both</em> the PNG <em>and</em> JXL formats being downloaded,
<em>increasing</em> the amount of data transferred instead of decreasing it
(one of the many benefits of JXL over PNG).
By contrast, a plugin could register itself a handler for the JPEG&nbsp;XL format,
and the browser would then be able to delegate rendering of the image to the plugin,
only falling back to the PNG in case of failure,
thus maximizing the usefulness of the format pending a built-in implementation.</p>

<p>The poster child of this lack of efficiency is arguably <a href="http://en.wikipedia.org/wiki/MathJax">MathJax</a>,
that has been carrying for nearly two decades the burden of bringing math to the web while browser implementors slacked off on their MathML support.
And while MathJax <em>does</em> offer more than just MathML support for browers without native implementations,
there is little doubt that it would be more effective in delivering the services it delivers
if it could be a plugin rather than a multi-megabyte
(any efforts to minimize its size notwithstanding)
JavaScript library each math-oriented website needs to load.</p>

<p>(In fact, it is somewhat surprising that there isn't a browser extesion version of MathJax that I can find
other than a <a href="http://en.wikipedia.org/wiki/GreaseMonkey">GreaseMonkey</a> <a href="https://docs.mathjax.org/en/v1.0/dynamic.html#mathjax-and-greasemonkey" title="MathJax and GreaseMonkey">user script with convoluted usage requirements</a>,
but I guess this is the cost we have to pay for the library flexibility,
and the sandboxing requirements enforced on JavaScript in modern browsers.)</p>

<p>Since apparently “defensive writing” is a thing we need when jotting down an article such as this
(as if it even matters, given how little attention people give to what they read —if they read it at all— before commenting),
I should clarify that I'm not necessarily for a return to NPAPI advocating.
We have decades of experience about what could be considered the actual technical issues with that interface,
and how they can be improved upon
(which is for example what PPAPI allegedly did,
before Google decided it would be better off to kill plugins entirely
and thus gain full control of the Web as a platform),
as we do about sandboxing external code running in browsers
(largely through the efforts to sandbox JavaScript).
A better plugin API could be designed.</p>

<p>It's not going to happen.
It is now apparent that the major browsers explicitly and intentionally do not want to allow the kind of flexibility that plugins would allow,
hiding their controlling efforts behind security excuses.
It would thus be up to the minority browsers to come up with such an interface
(or actually multiple ones, at least one for protocols and one for document types),
but with most of them beholden to the rendering engines controlled by Google
(for the most part), Apple (some, still using WebKit over Blink), and Mozilla (the few Firefox forks),
they are left with very little leeway, if any at all, in terms of what they can support.</p>

<p>But even if, by some miraculous convergence, they did manage to agree on and implement support for such an API,
would there actually be an interest by third party to develop plugins for it?
I can envision this as a way for browsers to share coding efforts in supporting new protocols and formats before integrating them as first-class
(for example, the <a href="#gemini">already mentioned</a> Gemini protocol and gemtext format could be implemented first as a plugin
to the benefit of any browsers supporting such hypothetical interfaces)
but there be any interest in developing for it, rather tha just trying to get the feature implemented in the browsers themselves?</p>

<h3 id="ameshofbuildingblocks"><a name="index3h3"></a>A mesh of building blocks</h3>

<p>Still, let me dream a bit of something like this,
a browser made up of composable components,
protocol handlers separate from primary document renderers separate from attachment handlers.</p>

<dl>
<dt>A new protocol comes out?</dt>
<dd>Implement a plugin to handle that, and you can test it by delivering the same content over it,
and see it rendered just the same from the other components in the chain.</dd>
<dt>A new document format comes out?</dt>
<dd>Implement a plugin to handle that, and it will be used to render documents in the new format.</dd>
<dt>A new image format comes out?</dt>
<dd>Implement a plugin to handle that, and any image in the new format will be visible.</dd>
<dt>A new scripting language comes out?</dt>
<dd>You guessed it: implement a plugin to handle that&nbsp;…</dd>
</dl>

<p>How much tech would have had a real chance at proving itself in the field if this had been the case,
or would have survived being ousted not by technical limitations,
but by unfriendly corporate control?
Who knows, maybe
RSS and Atom integration would still be trivially at everybody's hand;
nobody would have had to fight with the long-standing bugs in PNG rendering from Internet Explorer,
MNG would have flourished, JPEG&nbsp;XL would have become ubiquituous six months after the specification had been finalized;
we would have seen HTML+SMIL provide declarative interactive documents without JavaScript as far back as 2008;
XSLT 2 and 3 would have long superseded XSLT 1 as <em>the</em> templating languages for the web,
or XSLT would have been supplanted by the considerably more accessible XQuery;
XHTML2 would have lived and grown alongside HTML5,
offering more sensible markup for many common features,
and much-wanted capabilities such as client-side includes.</p>

<p>The web would have been very different from what it is today,
and most importantly we would never would have had to worry
about a single corporation getting to dictate what is and what isn't allowed on the Web.</p>

<p>But the reality is much harsher and darker.
Google has control, and we do need to wrestle it out of their hands.</p>

<h2 id="resist"><a name="index6h2"></a>Resist</h2>

<p>So, do not comply.<br>
Resist.<br>
Force the unwanted tech through.<br>
Use RSS.<br>
Use XSLT.<br>
Adopt JPEG&nbsp;XL as your primary image format.<br>
And report newly broken sites for what they are:<br>
a browser fault, not a content issue.</p>

<h2 id="postscriptum"><a name="index7h2"></a>Post scriptum</h2>

<p>I would like to add here any <em lang="fr">pièces de résistance</em> for XSLT.</p>

<p>I'm going to inaugurate with a link <a href="https://www.jwz.org/blog/2025/11/xslt-rip/">I've just discovered</a> thanks to <a href="http://en.wikipedia.org/wiki/JWZ">JWZ</a>:</p>

<ol>
<li><p><a href="https://xslt.rip/">xslt.rip</a> (best viewed with a browser that supports XSLT; viewing the source is highly recommended);</p></li>
<li><p>and last but not least (yeah I know, doesn't make much sense with the current short list, but still),
a shameless plug of <a href="https://wok.oblomov.eu/">my own website</a>, of course,
because of the idea to use XSLT not to produce HTML, but to produce SVG.</p></li>
</ol>

</section>



</article></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Replicate is joining Cloudflare (210 pts)]]></title>
            <link>https://replicate.com/blog/replicate-cloudflare</link>
            <guid>45953702</guid>
            <pubDate>Mon, 17 Nov 2025 14:11:57 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://replicate.com/blog/replicate-cloudflare">https://replicate.com/blog/replicate-cloudflare</a>, See on <a href="https://news.ycombinator.com/item?id=45953702">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><p>
Posted <span>November 17, 2025</span> by  </p><ul> <li> <a href="https://replicate.com/bfirsh"> bfirsh </a> </li> </ul> </div><div> <video src="https://replicate.com/_content/assets/sky-loop.BBa_Oct6.mp4" muted="true" autoplay="" loop="" playsinline=""></video>
<p>Big news: We’re joining Cloudflare.</p>
<p>Replicate’s going to carry on as a distinct brand, and all that’ll happen is that it’s going to get way better. It’ll be faster, we’ll have more resources, and it’ll integrate with the rest of Cloudflare’s Developer Platform.</p>
<p>The API isn’t changing. The models you’re using today will keep working. If you’ve built something on Replicate, it’ll keep running just like it does now.</p>
<p>So, why are we doing this?</p>
<p>At Replicate, we’re building the primitives for AI: the tools and abstractions that let software developers use AI without having to understand all the complex stuff underneath.</p>
<p>We started with <a href="https://github.com/replicate/cog">Cog</a>, an open-source tool which defines a standard format for what a model is. Then, we created Replicate, a platform where people can share models and run them with an API. We’ve defined what a model is, how you publish it, how you run it, how you get data in and out.</p>
<p>These abstractions are like the low-level primitives of an operating system. But what’s interesting is that these primitives are running in the cloud. They have to — they need specialized GPUs and clusters to scale up in production. It’s like a distributed operating system for AI, running in the cloud. In other words, <a href="https://blog.cloudflare.com/the-network-is-the-computer/">the network is the computer</a>.</p>
<p>Who has the best network? Cloudflare.</p>
<p>Cloudflare has built so many other parts of this operating system. Workers is the perfect platform for running agents and glue code. Durable Objects for managing state, R2 for storing files, WebRTC for streaming media.</p>
<p>Now that we’ve got these low-level abstractions, we can build higher-level abstractions. Ways to orchestrate models and build agents. Ways to run real-time models, or run models on the edge.</p>
<p>This is why we’re joining Cloudflare.</p>
<p>For my whole career, I’ve looked up to Cloudflare. How they built a product for developers, and turned that into a huge enterprise business. It’s the only public company that actually <em>gets</em> developers and knows how to build good products for them.</p>
<p>Cloudflare is the default for building web apps. From day one of Replicate, when we were building a prototype to apply to Y Combinator, we put Cloudflare in front of it.</p>
<p>Together, we’re going to become the default for building AI apps.</p>
<hr>
<p>Check out the <a href="https://blog.cloudflare.com/replicate-joins-cloudflare/">official announcement</a> on Cloudflare’s blog for more details.</p> </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[FreeMDU: Open-source Miele appliance diagnostic tools (151 pts)]]></title>
            <link>https://github.com/medusalix/FreeMDU</link>
            <guid>45953452</guid>
            <pubDate>Mon, 17 Nov 2025 13:40:40 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/medusalix/FreeMDU">https://github.com/medusalix/FreeMDU</a>, See on <a href="https://news.ycombinator.com/item?id=45953452">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><div dir="auto"><h2 tabindex="-1" dir="auto">FreeMDU <a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/19d10a0cd860e45b2ba94910328abe561db32b2ec743d5f54dab506baad8190c/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f616374696f6e732f776f726b666c6f772f7374617475732f6d65647573616c69782f467265654d44552f63692e796d6c"><img src="https://camo.githubusercontent.com/19d10a0cd860e45b2ba94910328abe561db32b2ec743d5f54dab506baad8190c/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f616374696f6e732f776f726b666c6f772f7374617475732f6d65647573616c69782f467265654d44552f63692e796d6c" alt="Build Status" data-canonical-src="https://img.shields.io/github/actions/workflow/status/medusalix/FreeMDU/ci.yml"></a></h2><a id="user-content-freemdu-" aria-label="Permalink: FreeMDU " href="#freemdu-"></a></div>
<p dir="auto">
  <a target="_blank" rel="noopener noreferrer" href="https://github.com/medusalix/FreeMDU/blob/master/demo.gif"><img src="https://github.com/medusalix/FreeMDU/raw/master/demo.gif" alt="Demo" data-animated-image=""></a>
</p>
<p dir="auto">The FreeMDU project provides open hardware and software tools for communicating with Miele appliances via their optical diagnostic interface. It serves as a free and open alternative to the proprietary <strong>Miele Diagnostic Utility (MDU)</strong> software, which is only available to registered service technicians.</p>
<p dir="auto">Most Miele devices manufactured after 1996 include an optical infrared-based diagnostic interface, hidden behind one of the indicator lights on the front panel. On older appliances, this interface is marked by a <strong>Program Correction (PC)</strong> label.</p>
<p dir="auto">Until now, communication with this interface required an expensive infrared adapter sold exclusively by Miele, along with their closed-source software. The goal of FreeMDU is to make this interface accessible to everyone for diagnostic and home automation purposes.</p>
<p dir="auto">The project is split into three main components:</p>
<ul dir="auto">
<li><a href="https://github.com/medusalix/FreeMDU/blob/master/protocol"><strong>Protocol</strong></a>: core protocol library and device implementations</li>
<li><a href="https://github.com/medusalix/FreeMDU/blob/master/tui"><strong>TUI</strong></a>: terminal-based device diagnostic and testing tool</li>
<li><a href="https://github.com/medusalix/FreeMDU/blob/master/home"><strong>Home</strong></a>: communication adapter firmware with MQTT integration for Home Assistant</li>
</ul>
<p dir="auto">More details about the proprietary diagnostic interface and the reverse-engineering process behind this project can be found in this <a href="https://medusalix.github.io/posts/miele-interface" rel="nofollow"><strong>blog post</strong></a>.</p>
<div dir="auto"><p dir="auto">Caution</p><p dir="auto">This project is highly experimental and can cause permanent damage to your Miele devices if not used responsibly. Proceed at your own risk.</p>
</div>
<p dir="auto"><h2 tabindex="-1" dir="auto">Supported devices</h2><a id="user-content-supported-devices" aria-label="Permalink: Supported devices" href="#supported-devices"></a></p>
<p dir="auto">When a connection is established via the diagnostic interface, the appliance responds with its <strong>software ID</strong>, a 16-bit number that uniquely identifies the firmware version running on the device's microcontroller. However, this ID does not directly correspond to a specific model or board type, so it's impossible to provide a comprehensive list of supported models.</p>
<p dir="auto">The following table lists the software IDs and device/board combinations that have been confirmed to work with FreeMDU:</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Software ID</th>
<th>Device</th>
<th>Board</th>
<th>Microcontroller</th>
<th>Optical interface location</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>360</td>
<td>Bare board</td>
<td>EDPW 223-A</td>
<td>Mitsubishi M38078MC-065FP</td>
<td><em>Check inlet (PC)</em> indicator</td>
<td>🟢 Fully supported</td>
</tr>
<tr>
<td>419</td>
<td>Bare board</td>
<td>EDPW 206</td>
<td>Mitsubishi M37451MC-804FP</td>
<td><em>Check inlet (PC)</em> indicator</td>
<td>🟢 Fully supported</td>
</tr>
<tr>
<td>605</td>
<td>G 651 I PLUS-3</td>
<td>EGPL 542-C</td>
<td>Mitsubishi M38027M8</td>
<td><em>Salt (PC)</em> indicator</td>
<td>🟢 Fully supported</td>
</tr>
<tr>
<td>629</td>
<td>W 2446</td>
<td>EDPL 126-B</td>
<td>Mitsubishi M38079MF-308FP</td>
<td><em>Check inlet (PC)</em> indicator</td>
<td>🟢 Fully supported</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto">If your appliance is not listed here but has a model number similar to one of the above, it might already be compatible. In all other cases, determining the <strong>software ID</strong> is the first step toward adding support for new devices.</p>
<p dir="auto">Details for adding support for new devices will be provided soon.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Getting started</h2><a id="user-content-getting-started" aria-label="Permalink: Getting started" href="#getting-started"></a></p>
<p dir="auto">Before using any FreeMDU components, make sure you have the <a href="https://rust-lang.org/tools/install" rel="nofollow">Rust toolchain</a> installed on your system.</p>
<p dir="auto">Next, you'll need to build a <a href="https://github.com/medusalix/FreeMDU/blob/master/home/README.md#getting-started">communication adapter</a> to interface with your Miele device. Once the adapter is ready, choose the appropriate use case from the options below:</p>
<p dir="auto"><h3 tabindex="-1" dir="auto">Device diagnostics and testing</h3><a id="user-content-device-diagnostics-and-testing" aria-label="Permalink: Device diagnostics and testing" href="#device-diagnostics-and-testing"></a></p>
<p dir="auto">If you want to repair or test your appliance:</p>
<ol dir="auto">
<li>
<p dir="auto">Flash the <a href="https://github.com/medusalix/FreeMDU/blob/master/home">home</a> firmware in <strong>bridge mode</strong> onto your communication adapter and attach it to your device.</p>
</li>
<li>
<p dir="auto">Run the <a href="https://github.com/medusalix/FreeMDU/blob/master/tui">TUI</a> application on your desktop computer.</p>
</li>
</ol>
<p dir="auto"><h3 tabindex="-1" dir="auto">Integration into home automation systems</h3><a id="user-content-integration-into-home-automation-systems" aria-label="Permalink: Integration into home automation systems" href="#integration-into-home-automation-systems"></a></p>
<p dir="auto">If you want to integrate your appliance into <strong>Home Assistant</strong> or another home automation system:</p>
<ol dir="auto">
<li>Flash the <a href="https://github.com/medusalix/FreeMDU/blob/master/home">home</a> firmware in <strong>standalone mode</strong> onto your communication adapter and attach it to your device.</li>
</ol>
<p dir="auto"><h3 tabindex="-1" dir="auto">Building custom tools</h3><a id="user-content-building-custom-tools" aria-label="Permalink: Building custom tools" href="#building-custom-tools"></a></p>
<p dir="auto">If you want to develop your own software to communicate with Miele devices:</p>
<ol dir="auto">
<li>
<p dir="auto">Flash the <a href="https://github.com/medusalix/FreeMDU/blob/master/home">home</a> firmware in <strong>bridge mode</strong> onto your communication adapter and attach it to your device.</p>
</li>
<li>
<p dir="auto">Use the <a href="https://github.com/medusalix/FreeMDU/blob/master/protocol">protocol</a> crate to implement your custom software.</p>
</li>
</ol>
<p dir="auto"><h2 tabindex="-1" dir="auto">Disclaimer</h2><a id="user-content-disclaimer" aria-label="Permalink: Disclaimer" href="#disclaimer"></a></p>
<p dir="auto">This is an independent, open-source project and is <strong>not affiliated with, endorsed by, or sponsored by Miele &amp; Cie. KG</strong> or its affiliates. All product names and trademarks are the property of their respective owners. References to Miele appliances are for descriptive purposes only and do not imply any association with Miele.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">License</h2><a id="user-content-license" aria-label="Permalink: License" href="#license"></a></p>
<p dir="auto">Licensed under either of</p>
<ul dir="auto">
<li>Apache License, Version 2.0 (<a href="https://github.com/medusalix/FreeMDU/blob/master/LICENSE-APACHE">LICENSE-APACHE</a> or <a href="http://www.apache.org/licenses/LICENSE-2.0" rel="nofollow">http://www.apache.org/licenses/LICENSE-2.0</a>)</li>
<li>MIT license (<a href="https://github.com/medusalix/FreeMDU/blob/master/LICENSE-MIT">LICENSE-MIT</a> or <a href="http://opensource.org/licenses/MIT" rel="nofollow">http://opensource.org/licenses/MIT</a>)</li>
</ul>
<p dir="auto">at your option.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Contribution</h2><a id="user-content-contribution" aria-label="Permalink: Contribution" href="#contribution"></a></p>
<p dir="auto">Unless you explicitly state otherwise, any contribution intentionally submitted for inclusion in the work by you, as defined in the Apache-2.0 license, shall be dual licensed as above, without any additional terms or conditions.</p>
</article></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Giving C a Superpower (180 pts)]]></title>
            <link>https://hwisnu.bearblog.dev/giving-c-a-superpower-custom-header-file-safe_ch/</link>
            <guid>45952428</guid>
            <pubDate>Mon, 17 Nov 2025 10:40:55 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://hwisnu.bearblog.dev/giving-c-a-superpower-custom-header-file-safe_ch/">https://hwisnu.bearblog.dev/giving-c-a-superpower-custom-header-file-safe_ch/</a>, See on <a href="https://news.ycombinator.com/item?id=45952428">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
    

    

    
        

        <p>
            <i>
                <time datetime="2025-11-09T15:47Z">
    09 Nov, 2025
</time>
            </i>
        </p>
    

    <p><em>The story of how I wrote a leak-free, thread-safe grep in C23 without shooting yourself in the foot, and how you can too!</em></p>
<h2 id="introduction">Introduction</h2><p>Let's be honest: most people have a love-hate relationship with C. We love its raw speed, its direct connection to the metal, and its elegant simplicity. But we hate its footguns, its dragons, the untamed beasts. The segfaults that appear from nowhere, the memory leaks that slowly drain the life from our applications, and the endless goto cleanup; chains that make our code look like a plate of spaghetti pasta.</p>
<p>This is the classic C curse: power without guardrails...at least that's the <em>fear mongering mantra</em> being said again and again. But is that still relevant in today's world with all the tools available for C devs like static analyzer and dynamic sanitizers? I've written about this <a href="https://hwisnu.bearblog.dev/make-c-safe-again/" target="_blank">here</a> and <a href="https://hwisnu.bearblog.dev/debunking-the-unsafe-c-myths-part-2/" target="_blank">here</a>.</p>
<p>What if, with the help of the modern tools and a custom header file (600 loc), you could tame those footguns beasts? What if you could keep C's power but wrap it in a suit of modern armor? That's what the custom header file safe_c.h is for. It's designed to give C some <mark>safety and convenience features from C++ and Rust</mark>, and I'm using it to build a high-performance grep clone called cgrep as my test case.</p>
<p>By the end this article I hope it could provide the audience with the idea of C is super flexible and extensible, sort of <em>"do whatever you want with it"</em> kind of thing. And this is why C (and its close cousin: Zig) remain to be my favorite language to write programs in; it's the language of freedom!</p>
<h2 id="safe_ch">safe_c.h</h2><p>Is a custom C header file that takes features mainly from C++ and Rust and implements them into our C code ~ [write C code, get C++ and Rust features!]</p>
<p>It starts by bridging the gap between old and new C. C23 gave us <code>[[cleanup]]</code> attributes, but in the real world, you need code that compiles on GCC 11 or Clang 18. safe_c.h detects your compiler and gives you the same RAII semantics everywhere. No more <code>#ifdef</code> soup.</p>
<div><pre><span></span>// The magic behind CLEANUP: zero overhead, maximum safety
#if defined(__STDC_VERSION__) &amp;&amp; __STDC_VERSION__ &gt;= 202311L
#define CLEANUP(func) [[cleanup(func)]]
#else
#define CLEANUP(func) __attribute__((cleanup(func)))
#endif

// Branch prediction that actually matters in hot paths
#ifdef __GNUC__
#define LIKELY(x)   __builtin_expect(!!(x), 1)
#define UNLIKELY(x) __builtin_expect(!!(x), 0)
#else
#define LIKELY(x)   (x)
#define UNLIKELY(x) (x)
#endif
</pre></div>
<p>Your cleanup code runs even if you return early, goto out, or panic. It's <code>finally</code>, but for C.</p>
<h2 id="the-memory-management-beast-slain-with-smart-pointers-c-feature">The Memory Management Beast: Slain with Smart Pointers (C++ feature)</h2><p>The oldest, fiercest and most feared by devs: manual memory management.</p>
<p>Before: the highway path to leaks.<br>
Forgetting a single <code>free()</code> is a disaster. In cgrep, parsing command-line options the old way is a breeding ground for CVEs and its bestiary. You have to remember to free the memory on every single exit path, difficult for the undisciplined.</p>
<div><pre><span></span><span>// The Old Way (don't do this)</span>
<span>char</span><span>*</span><span> </span><span>include_pattern</span><span> </span><span>=</span><span> </span><span>NULL</span><span>;</span>
<span>if</span><span> </span><span>(</span><span>optarg</span><span>)</span><span> </span><span>{</span>
<span>    </span><span>include_pattern</span><span> </span><span>=</span><span> </span><span>strdup</span><span>(</span><span>optarg</span><span>);</span>
<span>}</span>
<span>// ...200 lines later...</span>
<span>if</span><span> </span><span>(</span><span>some_error</span><span>)</span><span> </span><span>{</span>
<span>    </span><span>if</span><span> </span><span>(</span><span>include_pattern</span><span>)</span><span> </span><span>free</span><span>(</span><span>include_pattern</span><span>);</span><span> </span><span>// Did I free it? Did I??</span>
<span>    </span><span>return</span><span> </span><span>1</span><span>;</span>
<span>}</span>
<span>// And remember to free it at *every* return path...</span>
</pre></div>
<p>After: memory that <strong>automatically</strong> cleans itself up.<br>
UniquePtr is a "smart pointer" that owns a resource. When the UniquePtr variable goes out of scope, its resource is automatically freed. It's impossible to forget.</p>
<p>Here's the machinery inside <code>safe_c.h</code>:</p>
<div><pre><span></span>// The UniquePtr machinery: a struct + automatic cleanup
typedef struct {
    void* ptr;
    void (*deleter)(void*);
} UniquePtr;

#define AUTO_UNIQUE_PTR(name, ptr, deleter) \
    UniquePtr name CLEANUP(unique_ptr_cleanup) = UNIQUE_PTR_INIT(ptr, deleter)

static inline void unique_ptr_cleanup(UniquePtr* uptr) {
    if (uptr &amp;&amp; uptr-&gt;ptr &amp;&amp; uptr-&gt;deleter) {
        uptr-&gt;deleter(uptr-&gt;ptr);
        uptr-&gt;ptr = NULL;
    }
}
</pre></div>
<p>And here's how cgrep uses it. The cleanup is automatic, even if errors happen:</p>
<div><pre><span></span><span>// In cgrep, we use this for command-line arguments</span>
<span>AUTO_UNIQUE_PTR</span><span>(</span><span>include_pattern_ptr</span><span>,</span><span> </span><span>NULL</span><span>,</span><span> </span><span>options_string_deleter</span><span>);</span>

<span>// When we get a new pattern, the old one is automatically freed!</span>
<span>unique_ptr_delete</span><span>(</span><span>&amp;</span><span>include_pattern_ptr</span><span>);</span>
<span>include_pattern_ptr</span><span>.</span><span>ptr</span><span> </span><span>=</span><span> </span><span>strdup</span><span>(</span><span>optarg</span><span>);</span>
<span>// No leaks, even if an error happens later!</span>
</pre></div>
<p><strong>Sharing Safely with SharedPtr</strong></p>
<p>Before: manual, bug-prone reference counting.<br>
You'd have to implement reference counting by hand, creating a complex and fragile system where a single mistake leads to a leak or a use-after-free bug.</p>
<div><pre><span></span><span>// The old way of manual reference counting</span>
<span>typedef</span><span> </span><span>struct</span><span> </span><span>{</span>
<span>    </span><span>MatchStore</span><span>*</span><span> </span><span>store</span><span>;</span>
<span>    </span><span>int</span><span> </span><span>ref_count</span><span>;</span>
<span>    </span><span>pthread_mutex_t</span><span> </span><span>mutex</span><span>;</span>
<span>}</span><span> </span><span>SharedStore</span><span>;</span>

<span>void</span><span> </span><span>release_store</span><span>(</span><span>SharedStore</span><span>*</span><span> </span><span>s</span><span>)</span><span> </span><span>{</span>
<span>    </span><span>pthread_mutex_lock</span><span>(</span><span>&amp;</span><span>s</span><span>-&gt;</span><span>mutex</span><span>);</span>
<span>    </span><span>s</span><span>-&gt;</span><span>ref_count</span><span>--</span><span>;</span>
<span>    </span><span>bool</span><span> </span><span>is_last</span><span> </span><span>=</span><span> </span><span>(</span><span>s</span><span>-&gt;</span><span>ref_count</span><span> </span><span>==</span><span> </span><span>0</span><span>);</span>
<span>    </span><span>pthread_mutex_unlock</span><span>(</span><span>&amp;</span><span>s</span><span>-&gt;</span><span>mutex</span><span>);</span>

<span>    </span><span>if</span><span> </span><span>(</span><span>is_last</span><span>)</span><span> </span><span>{</span>
<span>        </span><span>match_store_deleter</span><span>(</span><span>s</span><span>-&gt;</span><span>store</span><span>);</span>
<span>        </span><span>free</span><span>(</span><span>s</span><span>);</span>
<span>    </span><span>}</span>
<span>}</span>
</pre></div>
<p>After: automated reference counting.<br>
SharedPtr automates this entire process. The last thread to finish using the object automatically triggers its destruction.
The machinery:</p>
<div><pre><span></span>// The SharedPtr machinery: reference counting without the boilerplate
typedef struct {
    void* ptr;
    void (*deleter)(void*);
    size_t* ref_count;
} SharedPtr;

#define AUTO_SHARED_PTR(name) \
    SharedPtr name CLEANUP(shared_ptr_cleanup) = {.ptr = NULL, .deleter = NULL, .ref_count = NULL}

static inline void shared_ptr_cleanup(SharedPtr* sptr) {
    shared_ptr_delete(sptr); // Decrement and free if last reference
}
</pre></div>
<p>The usage is clean and safe. No more manual counting.</p>
<div><pre><span></span><span>// In our thread worker context, multiple threads access the same results store</span>
<span>typedef</span><span> </span><span>struct</span><span> </span><span>{</span>
<span>    </span><span>// ...</span>
<span>    </span><span>SharedPtr</span><span> </span><span>store</span><span>;</span><span>  </span><span>// No more worrying about who frees this!</span>
<span>    </span><span>SharedPtr</span><span> </span><span>file_counts</span><span>;</span>
<span>    </span><span>// ...</span>
<span>}</span><span> </span><span>FileWorkerContext</span><span>;</span>

<span>// In main(), we create it once and share it safely</span>
<span>// SharedPtr: Reference-counted stores for thread-safe sharing</span>
<span>SharedPtr</span><span> </span><span>store_shared</span><span> </span><span>=</span><span> </span><span>{</span><span>0</span><span>};</span>
<span>shared_ptr_init</span><span>(</span><span>&amp;</span><span>store_shared</span><span>,</span><span> </span><span>store_ptr</span><span>.</span><span>ptr</span><span>,</span><span> </span><span>match_store_deleter</span><span>);</span>
<span>// Pass to threads: ctx-&gt;store = shared_ptr_copy(&amp;store_shared);</span>
<span>// ref-count increments automatically; last thread out frees it.</span>
</pre></div>
<h2 id="the-buffer-overflow-beast-contained-with-vectors-and-views-c-feature">The Buffer Overflow Beast: Contained with Vectors and Views (C++ feature)</h2><p>Dynamically growing arrays in C is a horror show.</p>
<p>Before: the realloc dance routine.<br>
You have to manually track capacity and size, and every realloc risks fragmenting memory or failing, requiring careful error handling for every single element you add.</p>
<div><pre><span></span><span>// The old way: manual realloc is inefficient and complex</span>
<span>MatchEntry</span><span>**</span><span> </span><span>matches</span><span> </span><span>=</span><span> </span><span>NULL</span><span>;</span>
<span>size_t</span><span> </span><span>matches_count</span><span> </span><span>=</span><span> </span><span>0</span><span>;</span>
<span>size_t</span><span> </span><span>matches_capacity</span><span> </span><span>=</span><span> </span><span>0</span><span>;</span>

<span>for</span><span> </span><span>(</span><span>/*...each match...*/</span><span>)</span><span> </span><span>{</span>
<span>    </span><span>if</span><span> </span><span>(</span><span>matches_count</span><span> </span><span>&gt;=</span><span> </span><span>matches_capacity</span><span>)</span><span> </span><span>{</span>
<span>        </span><span>matches_capacity</span><span> </span><span>=</span><span> </span><span>(</span><span>matches_capacity</span><span> </span><span>==</span><span> </span><span>0</span><span>)</span><span> </span><span>?</span><span> </span><span>8</span><span> </span><span>:</span><span> </span><span>matches_capacity</span><span> </span><span>*</span><span> </span><span>2</span><span>;</span>
<span>        </span><span>MatchEntry</span><span>**</span><span> </span><span>new_matches</span><span> </span><span>=</span><span> </span><span>realloc</span><span>(</span><span>matches</span><span>,</span><span> </span><span>matches_capacity</span><span> </span><span>*</span><span> </span><span>sizeof</span><span>(</span><span>MatchEntry</span><span>*</span><span>));</span>
<span>        </span><span>if</span><span> </span><span>(</span><span>!</span><span>new_matches</span><span>)</span><span> </span><span>{</span>
<span>            </span><span>free</span><span>(</span><span>matches</span><span>);</span><span> </span><span>// Don't leak!</span>
<span>            </span><span>/* handle error */</span>
<span>        </span><span>}</span>
<span>        </span><span>matches</span><span> </span><span>=</span><span> </span><span>new_matches</span><span>;</span>
<span>    </span><span>}</span>
<span>    </span><span>matches</span><span>[</span><span>matches_count</span><span>++</span><span>]</span><span> </span><span>=</span><span> </span><span>current_match</span><span>;</span>
<span>}</span>
</pre></div>
<p>After: a type-safe, auto-growing vector.<br>
safe_c.h generates an entire type-safe vector for you. It handles allocation, growth, and cleanup automatically.
The magic that generates the vector:</p>
<div><pre><span></span>// The magic that generates a complete vector type from a single line
#define DEFINE_VECTOR_TYPE(name, type) \
    typedef struct { \
        Vector base; \
        type* data; \
    } name##Vector; \
    \
    static inline bool name##_vector_push_back(name##Vector* vec, type value) { \
        bool result = vector_push_back(&amp;vec-&gt;base, &amp;value); \
        vec-&gt;data = (type*)vec-&gt;base.data; /* Sync pointer after potential realloc */ \
        return result; \
    } \
    \
    static inline bool name##_vector_reserve(name##Vector* vec, size_t new_capacity) { \
        bool result = vector_reserve(&amp;vec-&gt;base, new_capacity); \
        vec-&gt;data = (type*)vec-&gt;base.data; /* Sync pointer after potential realloc */ \
        return result; \
    } \


    /* more helper functions not outlined here */

// And the underlying generic Vector implementation
typedef struct {
    size_t size;
    size_t capacity;
    void* data;
    size_t element_size;
} Vector;
</pre></div>
<p>Using it in cgrep is simple and safe. The vector cleans itself up when it goes out of scope.</p>
<div><pre><span></span><span>// Type-safe vector for collecting matches</span>
<span>DEFINE_VECTOR_TYPE</span><span>(</span><span>MatchEntryPtr</span><span>,</span><span> </span><span>MatchEntry</span><span>*</span><span>)</span>

<span>AUTO_TYPED_VECTOR</span><span>(</span><span>MatchEntryPtr</span><span>,</span><span> </span><span>all_matches_vec</span><span>);</span>
<span>MatchEntryPtr_vector_reserve</span><span>(</span><span>&amp;</span><span>all_matches_vec</span><span>,</span><span> </span><span>store</span><span>-&gt;</span><span>total_matches</span><span>);</span>

<span>// Pushing elements is safe and simple</span>
<span>for</span><span> </span><span>(</span><span>MatchEntry</span><span>*</span><span> </span><span>entry</span><span> </span><span>=</span><span> </span><span>store</span><span>-&gt;</span><span>buckets</span><span>[</span><span>i</span><span>];</span><span> </span><span>entry</span><span>;</span><span> </span><span>entry</span><span> </span><span>=</span><span> </span><span>entry</span><span>-&gt;</span><span>next</span><span>)</span><span> </span><span>{</span>
<span>    </span><span>MatchEntryPtr_vector_push_back</span><span>(</span><span>&amp;</span><span>all_matches_vec</span><span>,</span><span> </span><span>entry</span><span>);</span>
<span>}</span>
</pre></div>
<h2 id="views-look-dont-touch-or-malloc-c-feature">Views: Look, Don't Touch (or malloc) - C++ feature</h2><p>Before: needless allocations.<br>
To handle a substring or a slice of an array, you'd often malloc a new buffer and copy the data into it, which is incredibly slow in a tight loop.</p>
<div><pre><span></span><span>// The old way: allocating a new string just to get a substring</span>
<span>const</span><span> </span><span>char</span><span>*</span><span> </span><span>line</span><span> </span><span>=</span><span> </span><span>"this is a long line of text"</span><span>;</span>
<span>char</span><span>*</span><span> </span><span>pattern</span><span> </span><span>=</span><span> </span><span>"long line"</span><span>;</span>
<span>// To pass just the pattern to a function, you might do this:</span>
<span>char</span><span>*</span><span> </span><span>sub</span><span> </span><span>=</span><span> </span><span>malloc</span><span>(</span><span>strlen</span><span>(</span><span>pattern</span><span>)</span><span> </span><span>+</span><span> </span><span>1</span><span>);</span>
<span>strncpy</span><span>(</span><span>sub</span><span>,</span><span> </span><span>pattern</span><span>,</span><span> </span><span>strlen</span><span>(</span><span>pattern</span><span>)</span><span> </span><span>+</span><span> </span><span>1</span><span>);</span>
<span>// ... use sub ...</span>
<span>free</span><span>(</span><span>sub</span><span>);</span><span> </span><span>// And hope you remember this free call</span>
</pre></div>
<p>After: zero-cost, non-owning views.<br>
A StringView or a Span is just a pointer and a length. It's a non-owning reference that lets you work with slices of data without any allocation.
The definitions are pure and simple:</p>
<div><pre><span></span><span>// The StringView and Span definitions: pure, simple, zero-cost</span>
<span>typedef</span><span> </span><span>struct</span><span> </span><span>{</span>
<span>    </span><span>const</span><span> </span><span>char</span><span>*</span><span> </span><span>data</span><span>;</span>
<span>    </span><span>size_t</span><span> </span><span>size</span><span>;</span>
<span>}</span><span> </span><span>StringView</span><span>;</span>

<span>typedef</span><span> </span><span>struct</span><span> </span><span>{</span>
<span>    </span><span>void</span><span>*</span><span> </span><span>data</span><span>;</span>
<span>    </span><span>size_t</span><span> </span><span>size</span><span>;</span>
<span>    </span><span>size_t</span><span> </span><span>element_size</span><span>;</span>
<span>}</span><span> </span><span>Span</span><span>;</span>
</pre></div>
<p>In cgrep, the search pattern becomes a StringView, avoiding allocation entirely.</p>
<div><pre><span></span><span>// Our options struct holds a StringView, not a char*</span>
<span>typedef</span><span> </span><span>struct</span><span> </span><span>{</span>
<span>    </span><span>StringView</span><span> </span><span>pattern</span><span>;</span><span> </span><span>// Clean, simple, and safe</span>
<span>    </span><span>// ...</span>
<span>}</span><span> </span><span>GrepOptions</span><span>;</span>

<span>// Initializing it is a piece of cake</span>
<span>options</span><span>.</span><span>pattern</span><span> </span><span>=</span><span> </span><span>string_view_init</span><span>(</span><span>argv</span><span>[</span><span>optind</span><span>]);</span>
</pre></div>
<p>For safe array access, Span provides a bounds-checked window into existing data.</p>
<div><pre><span></span>// safe_c.h
#define DEFINE_SPAN_TYPE(name, type) \
    typedef struct { \
        type* data; \
        size_t size; \
    } name##Span; \
    \
    static inline name##Span name##_span_init(type* data, size_t size) { \
        return (name##Span){.data = data, .size = size}; \
    } \
    \

    /* other helper functions not outlined here */
</pre></div>
<div><pre><span></span><span>// Span: Type-safe array slices for chunk processing</span>
<span>DEFINE_SPAN_TYPE</span><span>(</span><span>LineBuffer</span><span>,</span><span> </span><span>char</span><span>)</span>
<span>LineBufferSpan</span><span> </span><span>input_span</span><span> </span><span>=</span><span> </span><span>LineBuffer_span_init</span><span>((</span><span>char</span><span>*</span><span>)</span><span>start</span><span>,</span><span> </span><span>len</span><span>);</span>

<span>for</span><span> </span><span>(</span><span>size_t</span><span> </span><span>i</span><span> </span><span>=</span><span> </span><span>0</span><span>;</span><span> </span><span>i</span><span> </span><span>&lt;</span><span> </span><span>LineBuffer_span_size</span><span>(</span><span>&amp;</span><span>input_span</span><span>);</span><span> </span><span>i</span><span>++</span><span>)</span><span> </span><span>{</span>
<span>    </span><span>char</span><span>*</span><span> </span><span>line</span><span> </span><span>=</span><span> </span><span>LineBuffer_span_at</span><span>(</span><span>&amp;</span><span>input_span</span><span>,</span><span> </span><span>i</span><span>);</span><span> </span><span>// asserts i &lt; span.size</span>
<span>}</span>
</pre></div>
<h2 id="the-error-handling-codegotocode-beast-replaced-with-results-rust-feature-and-raii-c-feature">The Error-Handling <code>goto</code> Beast: Replaced with Results (Rust feature) and RAII (C++ feature)</h2><p>C's error handling is notoriously messy.</p>
<p>Before: goto cleanup spaghetti carbonara.<br>
Functions return special values like -1 or NULL, and you have to check errno. This leads to deeply nested if statements and a single goto cleanup; label that has to handle every possible failure case.</p>
<div><pre><span></span><span>// The old way: goto cleanup</span>
<span>int</span><span> </span><span>do_something</span><span>(</span><span>const</span><span> </span><span>char</span><span>*</span><span> </span><span>path</span><span>)</span><span> </span><span>{</span>
<span>    </span><span>int</span><span> </span><span>fd</span><span> </span><span>=</span><span> </span><span>open</span><span>(</span><span>path</span><span>,</span><span> </span><span>O_RDONLY</span><span>);</span>
<span>    </span><span>if</span><span> </span><span>(</span><span>fd</span><span> </span><span>&lt;</span><span> </span><span>0</span><span>)</span><span> </span><span>{</span>
<span>        </span><span>return</span><span> </span><span>-1</span><span>;</span><span> </span><span>// Error</span>
<span>    </span><span>}</span>

<span>    </span><span>void</span><span>*</span><span> </span><span>mem</span><span> </span><span>=</span><span> </span><span>malloc</span><span>(</span><span>1024</span><span>);</span>
<span>    </span><span>if</span><span> </span><span>(</span><span>!</span><span>mem</span><span>)</span><span> </span><span>{</span>
<span>        </span><span>close</span><span>(</span><span>fd</span><span>);</span><span> </span><span>// Manual cleanup</span>
<span>        </span><span>return</span><span> </span><span>-1</span><span>;</span>
<span>    </span><span>}</span>
<span>    </span>
<span>    </span><span>// ... do more work ...</span>

<span>    </span><span>free</span><span>(</span><span>mem</span><span>);</span>
<span>    </span><span>close</span><span>(</span><span>fd</span><span>);</span>
<span>    </span><span>return</span><span> </span><span>0</span><span>;</span><span> </span><span>// Success</span>
<span>}</span>
</pre></div>
<p>After: explicit, type-safe result.<br>
Inspired by Rust, Result<t, e=""> forces you to handle errors explicitly by returning a type that is either a success value or an error value.
The Result machinery:</t,></p>
<div><pre><span></span>// The Result type machinery: tagged unions for success/failure
typedef enum { RESULT_OK, RESULT_ERROR } ResultStatus;

#define DEFINE_RESULT_TYPE(name, value_type, error_type) \
    typedef struct { \
        ResultStatus status; \
        union { \
            value_type value; \
            error_type error; \
        }; \
    } Result##name;
</pre></div>
<p>Handling errors becomes easy. You can't accidentally use an error as a valid value.</p>
<div><pre><span></span><span>// Define a Result for file operations</span>
<span>DEFINE_RESULT_TYPE</span><span>(</span><span>FileOp</span><span>,</span><span> </span><span>i32</span><span>,</span><span> </span><span>const</span><span> </span><span>char</span><span>*</span><span>)</span>

<span>// Our function now returns a clear Result</span>
<span>static</span><span> </span><span>ResultFileOp</span><span> </span><span>submit_stat_request_safe</span><span>(...)</span><span> </span><span>{</span>
<span>    </span><span>// ...</span>
<span>    </span><span>if</span><span> </span><span>(</span><span>!</span><span>sqe</span><span>)</span><span> </span><span>{</span>
<span>        </span><span>return</span><span> </span><span>RESULT_ERROR</span><span>(</span><span>FileOp</span><span>,</span><span> </span><span>"Could not get SQE for stat"</span><span>);</span>
<span>    </span><span>}</span>
<span>    </span><span>return</span><span> </span><span>RESULT_OK</span><span>(</span><span>FileOp</span><span>,</span><span> </span><span>0</span><span>);</span>
<span>}</span>

<span>// And handling it is clean</span>
<span>ResultFileOp</span><span> </span><span>result</span><span> </span><span>=</span><span> </span><span>submit_stat_request_safe</span><span>(</span><span>path</span><span>,</span><span> </span><span>&amp;</span><span>ring</span><span>,</span><span> </span><span>&amp;</span><span>pending_ops</span><span>);</span>
<span>if</span><span> </span><span>(</span><span>!</span><span>RESULT_IS_OK</span><span>(</span><span>result</span><span>))</span><span> </span><span>{</span>
<span>    </span><span>fprintf</span><span>(</span><span>stderr</span><span>,</span><span> </span><span>"Error: %s</span><span>\n</span><span>"</span><span>,</span><span> </span><span>RESULT_UNWRAP_ERROR</span><span>(</span><span>result</span><span>));</span>
<span>}</span>
</pre></div>
<p>This is powered by RAII. The <code>CLEANUP</code> attribute ensures resources are freed no matter how a function exits.</p>
<div><pre><span></span><span>#define AUTO_MEMORY(name, size) \</span>
<span>    void* name CLEANUP(memory_cleanup) = malloc(size)</span>

<span>// DIR pointers are automatically closed, even on an early return.</span>
<span>DIR</span><span>*</span><span> </span><span>dir</span><span> </span><span>CLEANUP</span><span>(</span><span>dir_cleanup</span><span>)</span><span> </span><span>=</span><span> </span><span>opendir</span><span>(</span><span>req</span><span>-&gt;</span><span>path</span><span>);</span>
<span>if</span><span> </span><span>(</span><span>!</span><span>dir</span><span>)</span><span> </span><span>{</span>
<span>    </span><span>return</span><span> </span><span>RESULT_ERROR</span><span>(</span><span>FileOp</span><span>,</span><span> </span><span>"Failed to open dir"</span><span>);</span><span> </span><span>// dir_cleanup is NOT called</span>
<span>}</span>
<span>if</span><span> </span><span>(</span><span>some_condition</span><span>)</span><span> </span><span>{</span>
<span>    </span><span>return</span><span> </span><span>RESULT_OK</span><span>(</span><span>FileOp</span><span>,</span><span> </span><span>0</span><span>);</span><span> </span><span>// closedir() is called automatically HERE!</span>
<span>}</span>
</pre></div>
<h2 id="the-assumption-beast-challenged-with-contracts-and-safe-strings">The Assumption Beast: Challenged with Contracts and Safe Strings</h2><p>Before: <code>assert()</code> and pray.<br>
A standard <code>assert(ptr != NULL)</code> is good, but when it fails, the message is generic. You know the condition failed, but not the context or why it was important.</p>
<p>After: self-documenting contracts.<br>
<code>requires()</code> and <code>ensures()</code> make function contracts explicit. The failure messages tell you exactly what went wrong.
The contract macros:</p>
<div><pre><span></span>#define requires(cond) assert_msg(cond, "Precondition failed")
#define ensures(cond) assert_msg(cond, "Postcondition failed")

#define assert_msg(cond, msg) /* ... full implementation ... */
</pre></div>
<p>This turns assertions into executable documentation:</p>
<div><pre><span></span><span>// Preconditions that document and enforce contracts</span>
<span>static</span><span> </span><span>inline</span><span> </span><span>bool</span><span> </span><span>arena_create</span><span>(</span><span>Arena</span><span>*</span><span> </span><span>arena</span><span>,</span><span> </span><span>size_t</span><span> </span><span>size</span><span>)</span>
<span>{</span>
<span>    </span><span>requires</span><span>(</span><span>arena</span><span> </span><span>!=</span><span> </span><span>NULL</span><span>);</span><span>  </span><span>// Precondition: arena must not be null</span>
<span>    </span><span>requires</span><span>(</span><span>size</span><span> </span><span>&gt;</span><span> </span><span>0</span><span>);</span><span>       </span><span>// Precondition: size must be positive</span>
<span>    </span>
<span>    </span><span>// ... implementation ...</span>
<span>    </span>
<span>    </span><span>ensures</span><span>(</span><span>arena</span><span>-&gt;</span><span>buffer</span><span> </span><span>!=</span><span> </span><span>NULL</span><span>);</span><span>  </span><span>// Postcondition: buffer is allocated</span>
<span>    </span><span>ensures</span><span>(</span><span>arena</span><span>-&gt;</span><span>size</span><span> </span><span>==</span><span> </span><span>size</span><span>);</span><span>    </span><span>// Postcondition: size is set correctly</span>
<span>    </span>
<span>    </span><span>return</span><span> </span><span>true</span><span>;</span>
<span>}</span>
</pre></div>
<h3 id="codestrcpycode-is-a-security-vulnerability"><code>strcpy()</code> is a Security Vulnerability</h3><p>Before: buffer overflows.<br>
strcpy has no bounds checking. It's the source of countless security holes. <code>strncpy</code> is little better, as it might not null-terminate the destination string.</p>
<div><pre><span></span><span>// The old, dangerous way</span>
<span>char</span><span> </span><span>dest</span><span>[</span><span>20</span><span>];</span>
<span>const</span><span> </span><span>char</span><span>*</span><span> </span><span>src</span><span> </span><span>=</span><span> </span><span>"This is a very long string that will overflow the buffer"</span><span>;</span>
<span>strcpy</span><span>(</span><span>dest</span><span>,</span><span> </span><span>src</span><span>);</span><span> </span><span>// Undefined behavior! Stack corruption!</span>
</pre></div>
<p>After: safe, bounds-checked operations.<br>
safe_c.h provides alternatives that check bounds and return a success/failure status. No surprises.
The safe implementation:</p>
<div><pre><span></span><span>// The safe string operations: bounds checking that can't be ignored</span>
<span>static</span><span> </span><span>inline</span><span> </span><span>bool</span><span> </span><span>safe_strcpy</span><span>(</span><span>char</span><span>*</span><span> </span><span>dest</span><span>,</span><span> </span><span>size_t</span><span> </span><span>dest_size</span><span>,</span><span> </span><span>const</span><span> </span><span>char</span><span>*</span><span> </span><span>src</span><span>)</span><span> </span><span>{</span>
<span>    </span><span>if</span><span> </span><span>(</span><span>!</span><span>dest</span><span> </span><span>||</span><span> </span><span>dest_size</span><span> </span><span>==</span><span> </span><span>0</span><span> </span><span>||</span><span> </span><span>!</span><span>src</span><span>)</span><span> </span><span>return</span><span> </span><span>false</span><span>;</span>
<span>    </span><span>size_t</span><span> </span><span>src_len</span><span> </span><span>=</span><span> </span><span>strlen</span><span>(</span><span>src</span><span>);</span>
<span>    </span><span>if</span><span> </span><span>(</span><span>src_len</span><span> </span><span>&gt;=</span><span> </span><span>dest_size</span><span>)</span><span> </span><span>return</span><span> </span><span>false</span><span>;</span>
<span>    </span><span>memcpy</span><span>(</span><span>dest</span><span>,</span><span> </span><span>src</span><span>,</span><span> </span><span>src_len</span><span> </span><span>+</span><span> </span><span>1</span><span>);</span>
<span>    </span><span>return</span><span> </span><span>true</span><span>;</span>
<span>}</span>
</pre></div>
<p>In cgrep, this prevents path buffer overflows cleanly:</p>
<div><pre><span></span><span>// Returns bool, not silent truncation</span>
<span>if</span><span> </span><span>(</span><span>!</span><span>safe_strcpy</span><span>(</span><span>req</span><span>-&gt;</span><span>path</span><span>,</span><span> </span><span>PATH_MAX</span><span>,</span><span> </span><span>path</span><span>))</span><span> </span><span>{</span>
<span>    </span><span>free</span><span>(</span><span>req</span><span>);</span>
<span>    </span><span>return</span><span> </span><span>RESULT_ERROR</span><span>(</span><span>FileOp</span><span>,</span><span> </span><span>"Path is too long"</span><span>);</span>
<span>}</span>
</pre></div>
<h2 id="concurrency-mutexes-that-unlock-themselves-rust-feature">Concurrency: Mutexes That Unlock Themselves (Rust feature)</h2><p>Before: leaked locks and deadlocks.<br>
Forgetting to unlock a mutex, especially on an error path, is a catastrophic bug that causes your program to deadlock.</p>
<div><pre><span></span><span>// The Buggy Way</span>
<span>pthread_mutex_lock</span><span>(</span><span>&amp;</span><span>mutex</span><span>);</span>
<span>if</span><span> </span><span>(</span><span>some_error</span><span>)</span><span> </span><span>{</span>
<span>    </span><span>return</span><span>;</span><span> </span><span>// Oops, mutex is still locked! Program will deadlock.</span>
<span>}</span>
<span>pthread_mutex_unlock</span><span>(</span><span>&amp;</span><span>mutex</span><span>);</span>
</pre></div>
<p>After: RAII-based locks.<br>
Using the same CLEANUP attribute, we can ensure a mutex is always unlocked when the scope is exited. This bug becomes impossible to write.</p>
<div><pre><span></span><span>// With a cleanup function, unlocking is automatic.</span>
<span>void</span><span> </span><span>mutex_unlock_cleanup</span><span>(</span><span>pthread_mutex_t</span><span>**</span><span> </span><span>lock</span><span>)</span><span> </span><span>{</span>
<span>    </span><span>if</span><span> </span><span>(</span><span>lock</span><span> </span><span>&amp;&amp;</span><span> </span><span>*</span><span>lock</span><span>)</span><span> </span><span>pthread_mutex_unlock</span><span>(</span><span>*</span><span>lock</span><span>);</span>
<span>}</span>

<span>// RAII lock guard via cleanup attribute</span>
<span>pthread_mutex_t</span><span> </span><span>my_lock</span><span>;</span>
<span>pthread_mutex_t</span><span>*</span><span> </span><span>lock_ptr</span><span> </span><span>CLEANUP</span><span>(</span><span>mutex_unlock_cleanup</span><span>)</span><span> </span><span>=</span><span> </span><span>&amp;</span><span>my_lock</span><span>;</span>
<span>pthread_mutex_lock</span><span>(</span><span>lock_ptr</span><span>);</span>

<span>if</span><span> </span><span>(</span><span>some_error</span><span>)</span><span> </span><span>{</span>
<span>    </span><span>return</span><span>;</span><span> </span><span>// Mutex is automatically unlocked here!</span>
<span>}</span>
</pre></div>
<p>Simple wrappers also clean up the boilerplate of managing threads:</p>
<div><pre><span></span>// The concurrency macros: spawn and join without boilerplate
#define SPAWN_THREAD(name, func, arg) \
    thrd_t name; \
    thrd_create(&amp;name, (func), (arg))

#define JOIN_THREAD(name) \
    thrd_join(name, NULL)
</pre></div>
<p>And in cgrep:</p>
<div><pre><span></span>// Thread pool spawn without boilerplate
SPAWN_THREAD(workers[i], file_processing_worker, &amp;contexts[i]);
JOIN_THREAD(workers[i]); // No manual pthread_join() error handling
</pre></div>
<h2 id="performance-safety-at-o2-not-o0">Performance: Safety at -O2, Not -O0</h2><p>Safety doesn't mean slow. The UNLIKELY() macro tells the compiler which branches are cold, adding zero overhead in hot paths.</p>
<div><pre><span></span>#ifdef __GNUC__
#define LIKELY(x)   __builtin_expect(!!(x), 1)
#define UNLIKELY(x) __builtin_expect(!!(x), 0)
#else
#define LIKELY(x)   (x)
#define UNLIKELY(x) (x)
#endif
</pre></div>
<p>The real win is in the fast paths:</p>
<div><pre><span></span><span>// In hot allocation path: branch prediction</span>
<span>if</span><span> </span><span>(</span><span>UNLIKELY</span><span>(</span><span>store</span><span>-&gt;</span><span>local_buffer_sizes</span><span>[</span><span>thread_id</span><span>]</span><span> </span><span>&gt;=</span><span> </span><span>LOCAL_BUFFER_CAPACITY</span><span>))</span><span> </span><span>{</span>
<span>    </span><span>match_store_flush_buffer</span><span>(</span><span>store</span><span>,</span><span> </span><span>thread_id</span><span>);</span><span> </span><span>// Rarely taken</span>
<span>}</span>

<span>// In match checking: likely path first</span>
<span>if</span><span> </span><span>(</span><span>!</span><span>options</span><span>-&gt;</span><span>case_insensitive</span><span> </span><span>&amp;&amp;</span><span> </span><span>options</span><span>-&gt;</span><span>fixed_string</span><span>)</span><span> </span><span>{</span>
<span>    </span><span>// Most common case: fast path with no branches</span>
<span>    </span><span>const</span><span> </span><span>char</span><span>*</span><span> </span><span>result</span><span> </span><span>=</span><span> </span><span>strstr</span><span>(</span><span>line</span><span>,</span><span> </span><span>options</span><span>-&gt;</span><span>pattern</span><span>.</span><span>data</span><span>);</span>
<span>    </span><span>return</span><span> </span><span>result</span><span> </span><span>!=</span><span> </span><span>NULL</span><span>;</span>
<span>}</span>
</pre></div>
<p>The above is similar to what a PGO (Profile Guided Optimization) would have.</p>
<p>This is what main() looks like when you stop fighting the language:</p>
<div><pre><span></span><span>int</span><span> </span><span>main</span><span>(</span><span>int</span><span> </span><span>argc</span><span>,</span><span> </span><span>char</span><span>*</span><span> </span><span>argv</span><span>[])</span><span> </span><span>{</span>
<span>    </span><span>initialize_simd</span><span>();</span>
<span>    </span><span>output_buffer_init</span><span>();</span><span> </span><span>// Auto-cleanup on exit</span>
<span>    </span>
<span>    </span><span>GrepOptions</span><span> </span><span>options</span><span> </span><span>=</span><span> </span><span>{</span><span>0</span><span>};</span>
<span>    </span><span>AUTO_UNIQUE_PTR</span><span>(</span><span>include_pattern_ptr</span><span>,</span><span> </span><span>NULL</span><span>,</span><span> </span><span>options_string_deleter</span><span>);</span>
<span>    </span>
<span>    </span><span>// ... parse args with getopt_long ...</span>
<span>    </span>
<span>    </span><span>AUTO_UNIQUE_PTR</span><span>(</span><span>store_ptr</span><span>,</span><span> </span><span>NULL</span><span>,</span><span> </span><span>match_store_deleter</span><span>);</span>
<span>    </span><span>SharedPtr</span><span> </span><span>store_shared</span><span> </span><span>=</span><span> </span><span>{</span><span>0</span><span>};</span>
<span>    </span><span>if</span><span> </span><span>(</span><span>need_match_store</span><span>)</span><span> </span><span>{</span>
<span>        </span><span>store_ptr</span><span>.</span><span>ptr</span><span> </span><span>=</span><span> </span><span>malloc</span><span>(</span><span>sizeof</span><span>(</span><span>ConcurrentMatchStore</span><span>));</span>
<span>        </span><span>if</span><span> </span><span>(</span><span>!</span><span>store_ptr</span><span>.</span><span>ptr</span><span> </span><span>||</span><span> </span><span>!</span><span>match_store_create</span><span>(</span><span>store_ptr</span><span>.</span><span>ptr</span><span>,</span><span> </span><span>hash_capacity</span><span>,</span><span> </span><span>1000</span><span>))</span><span> </span><span>{</span>
<span>            </span><span>return</span><span> </span><span>1</span><span>;</span><span> </span><span>// All allocations cleaned up automatically</span>
<span>        </span><span>}</span>
<span>        </span><span>shared_ptr_init</span><span>(</span><span>&amp;</span><span>store_shared</span><span>,</span><span> </span><span>store_ptr</span><span>.</span><span>ptr</span><span>,</span><span> </span><span>match_store_deleter</span><span>);</span>
<span>    </span><span>}</span>
<span>    </span>
<span>    </span><span>// Process files with thread pool...</span>
<span>    </span>
<span>cleanup</span><span>:</span><span> </span><span>// Single cleanup label needed -- RAII handles the rest</span>
<span>    </span><span>output_buffer_destroy</span><span>();</span><span> </span><span>// Flushes and destroys</span>
<span>    </span><span>return</span><span> </span><span>0</span><span>;</span>
<span>}</span>
</pre></div>
<h2 id="conclusion">Conclusion</h2><p>In the end, cgrep is 2,300 lines of C. Without safe_c.h, it would have required over 50 manual free() calls ~ a recipe for leaks and segfaults. With the custom header file, it's 2,300 lines that compile to the same assembly, run just as fast, and are fundamentally safer.</p>
<p>This proves that the best abstraction is the one you don't pay for and can't forget to use. It enables a clear and powerful development pattern: validate inputs at the boundary, then unleash C's raw speed on the core logic. You get all the power of C without the infamous self-inflicted footgun wounds.</p>
<p>C simplicity makes writing programs with it becomes fun, however there are ways to make it both <strong>fun and safe</strong>..just like using condoms, you know?</p>
<p>This post has gotten too long for comfort, but I have one final food for thought for you the readers: after all these guard rails, what do you think of cgrep's performance? Check the screenshots below:</p>
<ul>
<li><p>grep bench on recursive directories
<img src="https://i.ibb.co.com/ZpKKd4FS/grep-bench-recursive-Dirs.png" alt="recursive-Dirs"></p>
</li>
<li><p>grep bench on single large file
<img src="https://i.ibb.co.com/qMKqFhmm/grep-bench-single-Large-File.png" alt="Large-File">
<strong>NOTE: make sure you check the memory usage comparison between cgrep and ripgrep</strong></p>
</li>
</ul>
<hr>
<hr>
<p>In the next article, I will discuss how I built cgrep, the design I chose for it, why and how cgrep managed to be a couple of times faster than ripgrep (more than 2x faster in the recursive directory bench) while being super efficient with resource usage (20x smaller memory footprint in the single large file bench).</p>
<p>It's gonna be a lot of fun! Cheers!</p>
<p><mark>If you enjoyed this post, click the little up arrow chevron on the bottom left of the page to help it rank in Bear's Discovery feed and if you got any questions or anything, please use the comments section.</mark></p>


    

    
        

        
            


        

        
            
        
    


  </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Building a Simple Search Engine That Works (240 pts)]]></title>
            <link>https://karboosx.net/post/4eZxhBon/building-a-simple-search-engine-that-actually-works</link>
            <guid>45950720</guid>
            <pubDate>Mon, 17 Nov 2025 03:52:50 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://karboosx.net/post/4eZxhBon/building-a-simple-search-engine-that-actually-works">https://karboosx.net/post/4eZxhBon/building-a-simple-search-engine-that-actually-works</a>, See on <a href="https://news.ycombinator.com/item?id=45950720">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
        <article itemscope="" itemtype="https://schema.org/BlogPosting">
            

            <div itemprop="articleBody">
                <h2>Why Build Your Own?</h2>
<p>Look, I know what you're thinking. "Why not just use Elasticsearch?" or "What about Algolia?" Those are valid options, but they come with complexity. You need to learn their APIs, manage their infrastructure, and deal with their quirks.</p>
<p>Sometimes you just want something that:</p>
<ul>
<li>Works with your existing database</li>
<li>Doesn't require external services</li>
<li>Is easy to understand and debug</li>
<li>Actually finds relevant results</li>
</ul>
<p>That's what I built. A search engine that uses your existing database, respects your current architecture, and gives you full control over how it works.</p>
<hr>
<h2>The Core Idea</h2>
<p>The concept is simple: <strong>tokenize everything, store it, then match tokens when searching</strong>.</p>
<p>Here's how it works:</p>
<ol>
<li><strong>Indexing</strong>: When you add or update content, we split it into tokens (words, prefixes, n-grams) and store them with weights</li>
<li><strong>Searching</strong>: When someone searches, we tokenize their query the same way, find matching tokens, and score the results</li>
<li><strong>Scoring</strong>: We use the stored weights to calculate relevance scores</li>
</ol>
<p>The magic is in the tokenization and weighting. Let me show you what I mean.</p>
<hr>
<h2>Building Block 1: The Database Schema</h2>
<p>We need two simple tables: <code>index_tokens</code> and <code>index_entries</code>.</p>
<h3>index_tokens</h3>
<p>This table stores all unique tokens with their tokenizer weights. Each token name can have multiple records with different weights—one per tokenizer.</p>
<pre><code>// index_tokens table structure
id | name    | weight
---|---------|-------
1  | parser  | 20     // From WordTokenizer
2  | parser  | 5      // From PrefixTokenizer
3  | parser  | 1      // From NGramsTokenizer
4  | parser  | 10     // From SingularTokenizer
</code></pre>
<p>Why store separate tokens per weight? Different tokenizers produce the same token with different weights. For example, "parser" from WordTokenizer has weight 20, but "parser" from PrefixTokenizer has weight 5. We need separate records to properly score matches.</p>
<p>The unique constraint is on <code>(name, weight)</code>, so the same token name can exist multiple times with different weights.</p>
<h3>index_entries</h3>
<p>This table links tokens to documents with field-specific weights.</p>
<pre><code>// index_entries table structure
id | token_id | document_type | field_id | document_id | weight
---|----------|---------------|----------|-------------|-------
1  | 1        | 1             | 1        | 42          | 2000
2  | 2        | 1             | 1        | 42          | 500
</code></pre>
<p>The <code>weight</code> here is the final calculated weight: <code>field_weight × tokenizer_weight × ceil(sqrt(token_length))</code>. This encodes everything we need for scoring. We will talk about scoring later in the post.</p>
<p>We add indexes on:</p>
<ul>
<li><code>(document_type, document_id)</code> - for fast document lookups</li>
<li><code>token_id</code> - for fast token lookups</li>
<li><code>(document_type, field_id)</code> - for field-specific queries</li>
<li><code>weight</code> - for filtering by weight</li>
</ul>
<p>Why this structure? Simple, efficient, and leverages what databases do best.</p>
<hr>
<h2>Building Block 2: Tokenization</h2>
<p>What is tokenization? It's breaking text into searchable pieces. The word "parser" becomes tokens like <code>["parser"]</code>, <code>["par", "pars", "parse", "parser"]</code>, or <code>["par", "ars", "rse", "ser"]</code> depending on which tokenizer we use.</p>
<p>Why multiple tokenizers? Different strategies for different matching needs. One tokenizer for exact matches, another for partial matches, another for typos.</p>
<p>All tokenizers implement a simple interface:</p>
<pre><code>interface TokenizerInterface
{
    public function tokenize(string $text): array;  // Returns array of Token objects
    public function getWeight(): int;               // Returns tokenizer weight
}
</code></pre>
<p>Simple contract, easy to extend.</p>
<h3>Word Tokenizer</h3>
<p>This one is straightforward—it splits text into individual words. "parser" becomes just <code>["parser"]</code>. Simple, but powerful for exact matches.</p>
<p>First, we normalize the text. Lowercase everything, remove special characters, normalize whitespace:</p>
<pre><code>class WordTokenizer implements TokenizerInterface
{
    public function tokenize(string $text): array
    {
        // Normalize: lowercase, remove special chars
        $text = mb_strtolower(trim($text));
        $text = preg_replace('/[^a-z0-9]/', ' ', $text);
        $text = preg_replace('/\s+/', ' ', $text);
</code></pre>
<p>Next, we split into words and filter out short ones:</p>
<pre><code>        // Split into words, filter short ones
        $words = explode(' ', $text);
        $words = array_filter($words, fn($w) =&gt; mb_strlen($w) &gt;= 2);
</code></pre>
<p>Why filter short words? Single-character words are usually too common to be useful. "a", "I", "x" don't help with search.</p>
<p>Finally, we return unique words as Token objects:</p>
<pre><code>        // Return as Token objects with weight
        return array_map(
            fn($word) =&gt; new Token($word, $this-&gt;weight),
            array_unique($words)
        );
    }
}
</code></pre>
<p>Weight: 20 (high priority for exact matches)</p>
<h3>Prefix Tokenizer</h3>
<p>This generates word prefixes. "parser" becomes <code>["par", "pars", "parse", "parser"]</code> (with min length 4). This helps with partial matches and autocomplete-like behavior.</p>
<p>First, we extract words (same normalization as WordTokenizer):</p>
<pre><code>class PrefixTokenizer implements TokenizerInterface
{
    public function __construct(
        private int $minPrefixLength = 4,
        private int $weight = 5
    ) {}
    
    public function tokenize(string $text): array
    {
        // Normalize same as WordTokenizer
        $words = $this-&gt;extractWords($text);
</code></pre>
<p>Then, for each word, we generate prefixes from the minimum length to the full word:</p>
<pre><code>        $tokens = [];
        foreach ($words as $word) {
            $wordLength = mb_strlen($word);
            // Generate prefixes from min length to full word
            for ($i = $this-&gt;minPrefixLength; $i &lt;= $wordLength; $i++) {
                $prefix = mb_substr($word, 0, $i);
                $tokens[$prefix] = true; // Use associative array for uniqueness
            }
        }
</code></pre>
<p>Why use an associative array? It ensures uniqueness. If "parser" appears twice in the text, we only want one "parser" token.</p>
<p>Finally, we convert the keys to Token objects:</p>
<pre><code>        return array_map(
            fn($prefix) =&gt; new Token($prefix, $this-&gt;weight),
            array_keys($tokens)
        );
    }
}
</code></pre>
<p>Weight: 5 (medium priority)</p>
<p>Why min length? Avoid too many tiny tokens. Prefixes shorter than 4 characters are usually too common to be useful.</p>
<h3>N-Grams Tokenizer</h3>
<p>This creates character sequences of a fixed length (I use 3). "parser" becomes <code>["par", "ars", "rse", "ser"]</code>. This catches typos and partial word matches.</p>
<p>First, we extract words:</p>
<pre><code>class NGramsTokenizer implements TokenizerInterface
{
    public function __construct(
        private int $ngramLength = 3,
        private int $weight = 1
    ) {}
    
    public function tokenize(string $text): array
    {
        $words = $this-&gt;extractWords($text);
</code></pre>
<p>Then, for each word, we slide a window of fixed length across it:</p>
<pre><code>        $tokens = [];
        foreach ($words as $word) {
            $wordLength = mb_strlen($word);
            // Sliding window of fixed length
            for ($i = 0; $i &lt;= $wordLength - $this-&gt;ngramLength; $i++) {
                $ngram = mb_substr($word, $i, $this-&gt;ngramLength);
                $tokens[$ngram] = true;
            }
        }
</code></pre>
<p>The sliding window: for "parser" with length 3, we get:</p>
<ul>
<li>Position 0: "par"</li>
<li>Position 1: "ars"</li>
<li>Position 2: "rse"</li>
<li>Position 3: "ser"</li>
</ul>
<p>Why this works? Even if someone types "parsr" (typo), we still get "par" and "ars" tokens, which match the correctly spelled "parser".</p>
<p>Finally, we convert to Token objects:</p>
<pre><code>        return array_map(
            fn($ngram) =&gt; new Token($ngram, $this-&gt;weight),
            array_keys($tokens)
        );
    }
}
</code></pre>
<p>Weight: 1 (low priority, but catches edge cases)</p>
<p>Why 3? Balance between coverage and noise. Too short and you get too many matches, too long and you miss typos.</p>
<h3>Normalization</h3>
<p>All tokenizers do the same normalization:</p>
<ul>
<li>Lowercase everything</li>
<li>Remove special characters (keep only alphanumerical)</li>
<li>Normalize whitespace (multiple spaces to single space)</li>
</ul>
<p>This ensures consistent matching regardless of input format.</p>
<hr>
<h2>Building Block 3: The Weight System</h2>
<p>We have three levels of weights working together:</p>
<ol>
<li><strong>Field weights</strong>: Title vs content vs keywords</li>
<li><strong>Tokenizer weights</strong>: Word vs prefix vs n-gram (stored in index_tokens)</li>
<li><strong>Document weights</strong>: Stored in index_entries (calculated: <code>field_weight × tokenizer_weight × ceil(sqrt(token_length))</code>)</li>
</ol>
<h3>Final Weight Calculation</h3>
<p>When indexing, we calculate the final weight like this:</p>
<pre><code>$finalWeight = $fieldWeight * $tokenizerWeight * ceil(sqrt($tokenLength));
</code></pre>
<p>For example:</p>
<ul>
<li>Title field: weight 10</li>
<li>Word tokenizer: weight 20</li>
<li>Token "parser": length 6</li>
<li>Final weight: <code>10 × 20 × ceil(sqrt(6)) = 10 × 20 × 3 = 600</code></li>
</ul>
<p>Why use <code>ceil(sqrt())</code>? Longer tokens are more specific, but we don't want weights to blow up with very long tokens. "parser" is more specific than "par", but a 100-character token shouldn't have 100x the weight. The square root function gives us diminishing returns—longer tokens still score higher, but not linearly. We use <code>ceil()</code> to round up to the nearest integer, keeping weights as whole numbers.</p>
<h3>Tuning Weights</h3>
<p>You can adjust weights for your use case:</p>
<ul>
<li>Increase field weights for titles if titles are most important</li>
<li>Increase tokenizer weights for exact matches if you want to prioritize exact matches</li>
<li>Adjust the token length function (ceil(sqrt), log, or linear) if you want longer tokens to matter more or less</li>
</ul>
<p>You can see exactly how weights are calculated and adjust them as needed.</p>
<hr>
<h2>Building Block 4: The Indexing Service</h2>
<p>The indexing service takes a document and stores all its tokens in the database.</p>
<h3>The Interface</h3>
<p>Documents that can be indexed implement <code>IndexableDocumentInterface</code>:</p>
<pre><code>interface IndexableDocumentInterface
{
    public function getDocumentId(): int;
    public function getDocumentType(): DocumentType;
    public function getIndexableFields(): IndexableFields;
}
</code></pre>
<p>To make a document searchable, you implement these three methods:</p>
<pre><code>class Post implements IndexableDocumentInterface
{
    public function getDocumentId(): int
    {
        return $this-&gt;id ?? 0;
    }
    
    public function getDocumentType(): DocumentType
    {
        return DocumentType::POST;
    }
    
    public function getIndexableFields(): IndexableFields
    {
        $fields = IndexableFields::create()
            -&gt;addField(FieldId::TITLE, $this-&gt;title ?? '', 10)
            -&gt;addField(FieldId::CONTENT, $this-&gt;content ?? '', 1);
        
        // Add keywords if present
        if (!empty($this-&gt;keywords)) {
            $fields-&gt;addField(FieldId::KEYWORDS, $this-&gt;keywords, 20);
        }
        
        return $fields;
    }
}
</code></pre>
<p>Three methods to implement:</p>
<ul>
<li><code>getDocumentType()</code>: returns the document type enum</li>
<li><code>getDocumentId()</code>: returns the document ID</li>
<li><code>getIndexableFields()</code>: builds fields with weights using fluent API</li>
</ul>
<p>You can index documents:</p>
<ul>
<li>On create/update (via event listeners)</li>
<li>Via commands: <code>app:index-document</code>, <code>app:reindex-documents</code></li>
<li>Via cron (for batch reindexing)</li>
</ul>
<h3>How It Works</h3>
<p>Here's the indexing process, step by step.</p>
<p>First, we get the document information:</p>
<pre><code>class SearchIndexingService
{
    public function indexDocument(IndexableDocumentInterface $document): void
    {
        // 1. Get document info
        $documentType = $document-&gt;getDocumentType();
        $documentId = $document-&gt;getDocumentId();
        $indexableFields = $document-&gt;getIndexableFields();
        $fields = $indexableFields-&gt;getFields();
        $weights = $indexableFields-&gt;getWeights();
</code></pre>
<p>The document provides its fields and weights via the <code>IndexableFields</code> builder.</p>
<p>Next, we remove the existing index for this document. This handles updates—if the document changed, we need to reindex it:</p>
<pre><code>        // 2. Remove existing index for this document
        $this-&gt;removeDocumentIndex($documentType, $documentId);
        
        // 3. Prepare batch insert data
        $insertData = [];
</code></pre>
<p>Why remove first? If we just add new tokens, we'll have duplicates. Better to start fresh.</p>
<p>Now, we process each field. For each field, we run all tokenizers:</p>
<pre><code>        // 4. Process each field
        foreach ($fields as $fieldIdValue =&gt; $content) {
            if (empty($content)) {
                continue;
            }
            
            $fieldId = FieldId::from($fieldIdValue);
            $fieldWeight = $weights[$fieldIdValue] ?? 0;
            
            // 5. Run all tokenizers on this field
            foreach ($this-&gt;tokenizers as $tokenizer) {
                $tokens = $tokenizer-&gt;tokenize($content);
</code></pre>
<p>For each tokenizer, we get tokens. Then, for each token, we find or create it in the database and calculate the final weight:</p>
<pre><code>                foreach ($tokens as $token) {
                    $tokenValue = $token-&gt;value;
                    $tokenWeight = $token-&gt;weight;
                    
                    // 6. Find or create token in index_tokens
                    $tokenId = $this-&gt;findOrCreateToken($tokenValue, $tokenWeight);
                    
                    // 7. Calculate final weight
                    $tokenLength = mb_strlen($tokenValue);
                    $finalWeight = (int) ($fieldWeight * $tokenWeight * ceil(sqrt($tokenLength)));
                    
                    // 8. Add to batch insert
                    $insertData[] = [
                        'token_id' =&gt; $tokenId,
                        'document_type' =&gt; $documentType-&gt;value,
                        'field_id' =&gt; $fieldId-&gt;value,
                        'document_id' =&gt; $documentId,
                        'weight' =&gt; $finalWeight,
                    ];
                }
            }
        }
</code></pre>
<p>Why batch insert? Performance. Instead of inserting one row at a time, we collect all rows and insert them in one query.</p>
<p>Finally, we batch insert everything:</p>
<pre><code>        // 9. Batch insert for performance
        if (!empty($insertData)) {
            $this-&gt;batchInsertSearchDocuments($insertData);
        }
    }
</code></pre>
<p>The <code>findOrCreateToken</code> method is straightforward:</p>
<pre><code>    private function findOrCreateToken(string $name, int $weight): int
    {
        // Try to find existing token with same name and weight
        $sql = "SELECT id FROM index_tokens WHERE name = ? AND weight = ?";
        $result = $this-&gt;connection-&gt;executeQuery($sql, [$name, $weight])-&gt;fetchAssociative();
        
        if ($result) {
            return (int) $result['id'];
        }
        
        // Create new token
        $insertSql = "INSERT INTO index_tokens (name, weight) VALUES (?, ?)";
        $this-&gt;connection-&gt;executeStatement($insertSql, [$name, $weight]);
        
        return (int) $this-&gt;connection-&gt;lastInsertId();
    }
}
</code></pre>
<p>Why find or create? Tokens are shared across documents. If "parser" already exists with weight 20, we reuse it. No need to create duplicates.</p>
<p>The key points:</p>
<ul>
<li>We remove old index first (handles updates)</li>
<li>We batch insert for performance (one query instead of many)</li>
<li>We find or create tokens (avoids duplicates)</li>
<li>We calculate final weight on the fly</li>
</ul>
<hr>
<h2>Building Block 5: The Search Service</h2>
<p>The search service takes a query string and finds relevant documents. It tokenizes the query the same way we tokenized documents during indexing, then matches those tokens against the indexed tokens in the database. The results are scored by relevance and returned as document IDs with scores.</p>
<h3>How It Works</h3>
<p>Here's the search process, step by step.</p>
<p>First, we tokenize the query using all tokenizers:</p>
<pre><code>class SearchService
{
    public function search(DocumentType $documentType, string $query, ?int $limit = null): array
    {
        // 1. Tokenize query using all tokenizers
        $queryTokens = $this-&gt;tokenizeQuery($query);
        
        if (empty($queryTokens)) {
            return [];
        }
</code></pre>
<p>If the query produces no tokens (e.g., only special characters), we return empty results.</p>
<h3>Why Tokenize the Query Using the Same Tokenizers?</h3>
<p>Different tokenizers produce different token values. If we index with one set and search with another, we'll miss matches.</p>
<p>Example:</p>
<ul>
<li>Indexing with PrefixTokenizer creates tokens: "par", "pars", "parse", "parser"</li>
<li>Searching with only WordTokenizer creates token: "parser"</li>
<li>We'll find "parser", but we won't find documents that only have "par" or "pars" tokens</li>
<li>Result: Incomplete matches, missing relevant documents!</li>
</ul>
<p><strong>The solution</strong>: Use the same tokenizers for both indexing and searching. Same tokenization strategy = same token values = complete matches.</p>
<p>This is why the <code>SearchService</code> and <code>SearchIndexingService</code> both receive the same set of tokenizers.</p>
<p>Next, we extract unique token values. Multiple tokenizers might produce the same token value, so we deduplicate:</p>
<pre><code>        // 2. Extract unique token values
        $tokenValues = array_unique(array_map(
            fn($token) =&gt; $token instanceof Token ? $token-&gt;value : $token,
            $queryTokens
        ));
</code></pre>
<p>Why extract values? We search by token name, not by weight. We need the unique token names to search for.</p>
<p>Then, we sort tokens by length (longest first). This prioritizes specific matches:</p>
<pre><code>        // 3. Sort tokens (longest first - prioritize specific matches)
        usort($tokenValues, fn($a, $b) =&gt; mb_strlen($b) &lt;=&gt; mb_strlen($a));
</code></pre>
<p>Why sort? Longer tokens are more specific. "parser" is more specific than "par", so we want to search for "parser" first.</p>
<p>We also limit the token count to prevent DoS attacks with huge queries:</p>
<pre><code>        // 4. Limit token count (prevent DoS with huge queries)
        if (count($tokenValues) &gt; 300) {
            $tokenValues = array_slice($tokenValues, 0, 300);
        }
</code></pre>
<p>Why limit? A malicious user could send a query that produces thousands of tokens, causing performance issues. We keep the longest 300 tokens (already sorted).</p>
<p>Now, we execute the optimized SQL query. The <code>executeSearch()</code> method builds the SQL query and executes it:</p>
<pre><code>        // 5. Execute optimized SQL query
        $results = $this-&gt;executeSearch($documentType, $tokenValues, $limit);
</code></pre>
<p>Inside <code>executeSearch()</code>, we build the SQL query with parameter placeholders, execute it, filter low-scoring results, and convert to SearchResult objects:</p>
<pre><code>private function executeSearch(DocumentType $documentType, array $tokenValues, int $tokenCount, ?int $limit, int $minTokenWeight): array
{
    // Build parameter placeholders for token values
    $tokenPlaceholders = implode(',', array_fill(0, $tokenCount, '?'));
    
    // Build the SQL query (shown in full in "The SQL Query" section below)
    $sql = "SELECT sd.document_id, ... FROM index_entries sd ...";
    
    // Build parameters array
    $params = [
        $documentType-&gt;value,  // document_type
        ...$tokenValues,       // token values for IN clause
        $documentType-&gt;value,  // for subquery
        ...$tokenValues,       // token values for subquery
        $minTokenWeight,      // minimum token weight
        // ... more parameters
    ];
    
    // Execute query with parameter binding
    $results = $this-&gt;connection-&gt;executeQuery($sql, $params)-&gt;fetchAllAssociative();
    
    // Filter out results with low normalized scores (below threshold)
    $results = array_filter($results, fn($r) =&gt; (float) $r['score'] &gt;= 0.05);
    
    // Convert to SearchResult objects
    return array_map(
        fn($result) =&gt; new SearchResult(
            documentId: (int) $result['document_id'],
            score: (float) $result['score']
        ),
        $results
    );
}
</code></pre>
<p>The SQL query does the heavy lifting: finds matching documents, calculates scores, and sorts by relevance. We use raw SQL for performance and full control—we can optimize the query exactly how we need it.</p>
<p>The query uses JOINs to connect tokens and documents, subqueries for normalization, aggregation for scoring, and indexes on token name, document type, and weight. We use parameter binding for security (prevents SQL injection).</p>
<p>We'll see the full query in the next section.</p>
<p>The main <code>search()</code> method then returns the results:</p>
<pre><code>        // 5. Return results
        return $results;
    }
}
</code></pre>
<h3>The Scoring Algorithm</h3>
<p>The scoring algorithm balances multiple factors. Let's break it down step by step.</p>
<p>The base score is the sum of all matched token weights:</p>
<pre><code>SELECT 
    sd.document_id,
    SUM(sd.weight) as base_score
FROM index_entries sd
INNER JOIN index_tokens st ON sd.token_id = st.id
WHERE 
    sd.document_type = ?
    AND st.name IN (?, ?, ?)  -- Query tokens
GROUP BY sd.document_id
</code></pre>
<ul>
<li><code>sd.weight</code>: from index_entries (field_weight × tokenizer_weight × ceil(sqrt(token_length)))</li>
</ul>
<p>Why not multiply by <code>st.weight</code>? The tokenizer weight is already included in <code>sd.weight</code> during indexing. The <code>st.weight</code> from <code>index_tokens</code> is used only in the full SQL query's WHERE clause for filtering (ensures at least one token with weight &gt;= minTokenWeight).</p>
<p>This gives us the raw score. But we need more than that.</p>
<p>We add a token diversity boost. Documents matching more unique tokens score higher:</p>
<pre><code>(1.0 + LOG(1.0 + COUNT(DISTINCT sd.token_id))) * base_score
</code></pre>
<p>Why? A document matching 5 different tokens is more relevant than one matching the same token 5 times. The LOG function makes this boost logarithmic—matching 10 tokens doesn't give 10x the boost.</p>
<p>We also add an average weight quality boost. Documents with higher quality matches score higher:</p>
<pre><code>(1.0 + LOG(1.0 + AVG(sd.weight))) * base_score
</code></pre>
<p>Why? A document with high-weight matches (e.g., title matches) is more relevant than one with low-weight matches (e.g., content matches). Again, LOG makes this logarithmic.</p>
<p>We apply a document length penalty. Prevents long documents from dominating:</p>
<pre><code>base_score / (1.0 + LOG(1.0 + doc_token_count.token_count))
</code></pre>
<p>Why? A 1000-word document doesn't automatically beat a 100-word document just because it has more tokens. The LOG function makes this penalty logarithmic—a 10x longer document doesn't get 10x the penalty.</p>
<p>Finally, we normalize by dividing by the maximum score:</p>
<pre><code>score / GREATEST(1.0, max_score) as normalized_score
</code></pre>
<p>This gives us a 0-1 range, making scores comparable across different queries.</p>
<p>The full formula looks like this:</p>
<pre><code>SELECT 
    sd.document_id,
    (
        SUM(sd.weight) *                                  -- Base score
        (1.0 + LOG(1.0 + COUNT(DISTINCT sd.token_id))) * -- Token diversity boost
        (1.0 + LOG(1.0 + AVG(sd.weight))) /              -- Average weight quality boost
        (1.0 + LOG(1.0 + doc_token_count.token_count))   -- Document length penalty
    ) / GREATEST(1.0, max_score) as score                -- Normalization
FROM index_entries sd
INNER JOIN index_tokens st ON sd.token_id = st.id
INNER JOIN (
    SELECT document_id, COUNT(*) as token_count
    FROM index_entries
    WHERE document_type = ?
    GROUP BY document_id
) doc_token_count ON sd.document_id = doc_token_count.document_id
WHERE 
    sd.document_type = ?
    AND st.name IN (?, ?, ?)  -- Query tokens
    AND sd.document_id IN (
        SELECT DISTINCT document_id
        FROM index_entries sd2
        INNER JOIN index_tokens st2 ON sd2.token_id = st2.id
        WHERE sd2.document_type = ?
        AND st2.name IN (?, ?, ?)
        AND st2.weight &gt;= ?  -- Ensure at least one token with meaningful weight
    )
GROUP BY sd.document_id
ORDER BY score DESC
LIMIT ?
</code></pre>
<p>Why the subquery with <code>st2.weight &gt;= ?</code>? This ensures we only include documents that have at least one matching token with a meaningful tokenizer weight. Without this filter, a document matching only low-priority tokens (like n-grams with weight 1) would be included even if it doesn't match any high-priority tokens (like words with weight 20). This subquery filters out documents that only match noise. We want documents that match at least one meaningful token.</p>
<p>Why this formula? It balances multiple factors for relevance. Exact matches score high, but so do documents matching many tokens. Long documents don't dominate, but high-quality matches do.</p>
<p>If no results with weight 10, we retry with weight 1 (fallback for edge cases).</p>
<h3>Converting IDs to Documents</h3>
<p>The search service returns <code>SearchResult</code> objects with document IDs and scores:</p>
<pre><code>class SearchResult
{
    public function __construct(
        public readonly int $documentId,
        public readonly float $score
    ) {}
}
</code></pre>
<p>But we need actual documents, not just IDs. We convert them using repositories:</p>
<pre><code>// Perform search
$searchResults = $this-&gt;searchService-&gt;search(
    DocumentType::POST,
    $query,
    $limit
);

// Get document IDs from search results (preserving order)
$documentIds = array_map(fn($result) =&gt; $result-&gt;documentId, $searchResults);

// Get documents by IDs (preserving order from search results)
$documents = $this-&gt;documentRepository-&gt;findByIds($documentIds);
</code></pre>
<p>Why preserve order? The search results are sorted by relevance score. We want to keep that order when displaying results.</p>
<p>The repository method handles the conversion:</p>
<pre><code>public function findByIds(array $ids): array
{
    if (empty($ids)) {
        return [];
    }
    
    return $this-&gt;createQueryBuilder('d')
        -&gt;where('d.id IN (:ids)')
        -&gt;setParameter('ids', $ids)
        -&gt;orderBy('FIELD(d.id, :ids)')  // Preserve order from IDs array
        -&gt;getQuery()
        -&gt;getResult();
}
</code></pre>
<p>The <code>FIELD()</code> function preserves the order from the IDs array, so documents appear in the same order as search results.</p>
<hr>
<h2>The Result: What You Get</h2>
<p>What you get is a search engine that:</p>
<ul>
<li><strong>Finds relevant results quickly</strong> (leverages database indexes)</li>
<li><strong>Handles typos</strong> (n-grams catch partial matches)</li>
<li><strong>Handles partial words</strong> (prefix tokenizer)</li>
<li><strong>Prioritizes exact matches</strong> (word tokenizer has highest weight)</li>
<li><strong>Works with existing database</strong> (no external services)</li>
<li><strong>Easy to understand and debug</strong> (everything is transparent)</li>
<li><strong>Full control over behavior</strong> (adjust weights, add tokenizers, modify scoring)</li>
</ul>
<hr>
<h2>Extending the System</h2>
<p>Want to add a new tokenizer? Implement <code>TokenizerInterface</code>:</p>
<pre><code>class StemmingTokenizer implements TokenizerInterface
{
    public function tokenize(string $text): array
    {
        // Your stemming logic here
        // Return array of Token objects
    }
    
    public function getWeight(): int
    {
        return 15; // Your weight
    }
}
</code></pre>
<p>Register it in your services configuration, and it's automatically used for both indexing and searching.</p>
<p>Want to add a new document type? Implement <code>IndexableDocumentInterface</code>:</p>
<pre><code>class Comment implements IndexableDocumentInterface
{
    public function getIndexableFields(): IndexableFields
    {
        return IndexableFields::create()
            -&gt;addField(FieldId::CONTENT, $this-&gt;content ?? '', 5);
    }
}
</code></pre>
<p>Want to adjust weights? Change the configuration. Want to modify scoring? Edit the SQL query. Everything is under your control.</p>
<hr>
<h2>Conclusion</h2>
<p>So there you have it. A simple search engine that actually works. It's not fancy, and it doesn't need a lot of infrastructure, but for most use cases, it's perfect.</p>
<p>The key insight? Sometimes the best solution is the one you understand. No magic, no black boxes, just straightforward code that does what it says.</p>
<p>You own it, you control it, you can debug it. And that's worth a lot.</p>

            </div>

            
        </article>

        
    </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[A 1961 Relay Computer Running in the Browser (129 pts)]]></title>
            <link>https://minivac.greg.technology/</link>
            <guid>45950396</guid>
            <pubDate>Mon, 17 Nov 2025 02:36:18 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://minivac.greg.technology/">https://minivac.greg.technology/</a>, See on <a href="https://news.ycombinator.com/item?id=45950396">Hacker News</a></p>
<div id="readability-page-1" class="page">
    <p>
      Best viewed on desktop for now.
    </p>
    
    
    
  

</div>]]></description>
        </item>
        <item>
            <title><![CDATA[A new chapter begins for EV batteries with the expiry of key LFP patents (181 pts)]]></title>
            <link>https://www.shoosmiths.com/insights/articles/a-new-chapter-begins-for-ev-batteries-with-the-expiry-of-key-lfp-patents</link>
            <guid>45949655</guid>
            <pubDate>Sun, 16 Nov 2025 23:58:21 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.shoosmiths.com/insights/articles/a-new-chapter-begins-for-ev-batteries-with-the-expiry-of-key-lfp-patents">https://www.shoosmiths.com/insights/articles/a-new-chapter-begins-for-ev-batteries-with-the-expiry-of-key-lfp-patents</a>, See on <a href="https://news.ycombinator.com/item?id=45949655">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-component="">
            <h3>The expiry of key patents for LFP battery chemistry in 2022 transformed the EV industry. With technology now freely accessible, global battery strategies are shifting as former IP barriers fall.</h3>
    <p>An LFP battery is a type of lithium-ion battery that uses lithium iron phosphate (LiFePO4) as the cathode material. LFP’s appeal in the EV sector is clear: lower cost compared to batteries based on nickel and cobalt chemistries, low toxicity and good safety due to their superior thermal stability. Tesla’s use of LFP in some of its standard-range models signalled the beginning of a broader trend, now accelerating across Western markets. LFP batteries are also proving a popular choice for renewable energy storage.</p>
<p>However, barriers to commercialisation of LFP technology remain. With the core chemistry now in the public domain, the focus of intellectual property protection has shifted. Companies are securing patents around secondary innovation, with a focus on enhancing energy density, improving safety, fast-charging capabilities and reducing costs. For example, CATL (Contemporary Amperex Technology Co. Limited) has developed and commercialised cell-to-pack technology with its Quilin battery. BYD and Tesla, amongst others, also own patents relating to LFP technology. Such proprietary engineering technology will still deliver competitive advantage. Trade secrets and manufacturing know-how are also becoming increasingly valuable.</p>
<p>Freedom-to-operate (FTO) analysis therefore remains critical for market entrants. Whilst the primary patents have expired, a dense web of secondary patents, covering additives, coatings, and production methods, still poses infringement risks. Firms entering the LFP space need to engage in increasingly nuanced FTO due diligence to navigate this residual IP thicket and minimise their risk of being on the receiving end of an infringement lawsuit.</p>
<p>Aside from the patent landscape, there are other structural and strategic barriers for exploitation of LFP technology:</p>
<ul>
    <li>recycling economics: as LFP batteries lack high-value metals like cobalt and nickel, they are less attractive to recyclers. This poses a challenge in light of EU regulations requiring lithium-ion batteries to contain at least 6% recycled lithium by 2031, rising to 12% by 2036. Whilst companies are developing new capabilities, for example UK-based Altilium’s proprietary EcoCathode technology, which promises to recover 97% lithium and 99% graphite from used LFP cells, these technologies are in their infancy.</li>
    <li>supply chain dependencies: Western manufacturers remain heavily reliant on Chinese suppliers for high tap-density iron phosphate precursors (which allows for increased energy density in the battery) and cell manufacturing expertise.</li>
    <li>infrastructure misalignment: the UK’s charging infrastructure still needs to be significantly developed to encourage uptake of EVs.</li>
</ul>
<p>In short, the LFP patent cliff is not the end of the story. Rather it is the beginning of a new chapter in EV innovation, where competitive advantage can still be obtained through further technological developments. For IP professionals and EV strategists, the task is to develop protection strategies that reflect this new paradigm. Effective trade secret and patent protection will be essential components of this, as well as the formation of strategic partnerships.&nbsp;</p>
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[PicoIDE – An open IDE/ATAPI drive emulator (171 pts)]]></title>
            <link>https://picoide.com/</link>
            <guid>45949352</guid>
            <pubDate>Sun, 16 Nov 2025 23:19:24 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://picoide.com/">https://picoide.com/</a>, See on <a href="https://news.ycombinator.com/item?id=45949352">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
        <header>
            <h2><img src="https://picoide.com/picoide-logo-black-red.svg" alt="PicoIDE"></h2>
            
        </header>

        <main>
            <article>
                <h3>
                    PicoIDE is a device that emulates IDE/ATAPI devices developed by Ian Scott, creator of <a href="https://picog.us/">PicoGUS</a>.
                </h3>

                <section>
                    <ul>
                        <li>Fully open source firmware and hardware</li>
                        <li>Emulates ATAPI CD-ROM and IDE fixed hard drives
                            <ul>
                                <li>.bin/.cue or .iso image support for CD-ROM</li>
                                <li>.img/.hda/.vhd/.hdf for HDD</li>
                            </ul>
                        </li>
                        <li>Built-in CD audio output on 3.5" jack and MPC-2 header</li>
                        <li>Supports PIO modes 0-4 and multi-word DMA modes 0-2</li>
                        <li>Optional front panel/3.5" drive bay enclosure with:
                            <ul>
                                <li>1.3" 128x64 OLED screen &amp; 4-way navigation buttons</li>
                                <li>WiFi for remote control and upload/management of disk images</li>
                                <li>RGB activity LED</li>
                            </ul>
                        </li>
                    </ul>

                    <figure>
                        <a href="https://picoide.com/picoide_evt2_angle.jpg">
                            <img src="https://picoide.com/picoide-on-stack.jpg" alt="PicoIDE seen from an angle">
                        </a>
                    </figure>
                </section>
            </article>

            <section>
                <a href="https://picoide.com/picoide-ready-sm.jpg">
                    <img src="https://picoide.com/picoide-front-quarter.jpg" alt="Front quarter view of the PicoIDE">
                </a>
                <a href="https://picoide.com/disc-selection-sm.jpg">
                    <img src="https://picoide.com/disc-selection-sm.jpg" alt="Selecting from a list of discs">
                </a>
                <a href="https://picoide.com/picoide.jpg">
                    <img src="https://picoide.com/picoide.jpg" alt="The venerable oakcdrom.sys being loaded">
                </a>
                <a href="https://picoide.com/picoide-speedsys.jpg">
                    <img src="https://picoide.com/picoide-speedsys.jpg" alt="SpeedSys benchmark of CD-ROM mode">
                </a>
            </section>

            
        </main>

        <section>
            <h2>Frequently Asked Questions</h2>
            <dl>
                <dt>Can PicoIDE emulate more than 1 drive at a time?</dt>
                <dd>Currently PicoIDE only emulates one drive, but the hardware is capable of supporting two devices simultaneously. Enabling this is a priority for development after the PicoIDE is released.</dd>

                <dt>Can you add [hardware feature]?</dt>
                <dd>The current hardware design is locked in, but who knows what the future may bring.</dd>

                <dt>Will PicoIDE work in my device?</dt>
                <dd>The primary development/testing platform for PicoIDE is 90s-era PCs, but PicoIDE has a high level of compatibility with the ATA and ATAPI standards, so there's a good chance it will work in your device. If your device is particularly finicky, that sounds like a fun development challenge!</dd>

                <dt>What about UDMA support?</dt>
                <dd>In the interest of providing a cost-effective design, PicoIDE's hardware doesn't support UDMA, but faster systems are very well served in the area of fast HDD replacements by CF, SD, and M.2 to IDE adapters, and for optical, PicoIDE's MWDMA mode 2 and PIO mode 4 support is as fast as a 52X CD-ROM drive, plenty for fast systems.</dd>

                <dt>Will there be a 5.25" or 2.5" version?</dt>
                <dd>PicoIDE will launch with a 3.5" enclosure only, but depending how things go, other form factors may be made available.</dd>

                <dt>When will PicoIDE be available?</dt>
                <dd>PicoIDE will be launching soon™. Sign up below to be notified when it becomes available for purchase.</dd>
                
                <dt>Where will I be able to purchase a PicoIDE? How much will it cost?</dt>
                <dd>Availability and pricing will be announced when PicoIDE is launched. If you're familiar with <a href="https://picog.us/">PicoGUS</a>, you know I value making attainable hardware.</dd>
            </dl>
        </section>

        <section>
            <p>
            PicoIDE will be launching soon. Sign up to be notified when that happens!
            </p>
            
        </section>
    </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Britney Spears' Guide to Semiconductor Physics (270 pts)]]></title>
            <link>https://britneyspears.ac/lasers.htm</link>
            <guid>45949326</guid>
            <pubDate>Sun, 16 Nov 2025 23:15:20 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://britneyspears.ac/lasers.htm">https://britneyspears.ac/lasers.htm</a>, See on <a href="https://news.ycombinator.com/item?id=45949326">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="main">

		
		
		
				
			
		
		<table>
			<tbody><tr>
				<td>
					<p>
						<img src="https://britneyspears.ac/images/bs2.jpg" width="320" height="240" alt="Britney Spears with density of states formula in a bulk material">
					</p>
					<p>
						It is a little known fact, that Ms Spears is an expert in semiconductor
						physics. Not content with just singing and acting, in the following pages, she
						will guide you in the fundamentals of the vital semiconductor laser components that have made it possible to hear her super music in a digital format.
					</p>
				</td>
				<td>
					<img src="https://britneyspears.ac/images/booble.gif" alt="Google">
<!-- SiteSearch Google -->

<!-- SiteSearch Google -->
					<p><a href="https://britneyspears.ac/physics/calculator/calculator2.htm" target="_blank">Scientific Calculator</a></p>

					<p>
						<a href="http://thehungersite.com/" target="_blank" rel="nofollow">Click here</a>
						to donate food to the starving people of the world.
						<br>
						<a href="http://thehungersite.com/" rel="nofollow"><img src="https://britneyspears.ac/hunger.gif" width="122" height="60" alt="the hunger site"></a>

					</p>


				</td>
			</tr>
		</tbody></table>
		
		<table>
			<tbody><tr>
				<td>
				
							<p><a href="http://www.splung.com/" rel="nofollow">
Splung.com Physics</a> is a website for students of physics with sections on: mechanics, optics, electricity and magnetism, thermodynamics, nuclear physics and cosmology. The site also uses Flash for demonstrations. I am looking to expand this site by concentrating on the interactive components. If you are passionate about physics and would like to collaborate in this project, by writing content then please <a href="mailto:hepcj@hotmail.com">contact me</a>.</p>
				
				</td>
				<td>
		
								<a href="http://www.splung.com/" target="_blank">
									<img src="https://britneyspears.ac/images/90x30banner02.gif" alt="splung.com physics">
								</a></td>
			</tr>
			<tr colspan="2">
			<td>
			<br>
			<a href="http://www.bad-ads.co.uk/" target="_blank">Bad-Ads.co.uk</a> Hate TV adverts? Read Bad Ads
			</td>
			</tr>
		</tbody></table>
<hr></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Goldman Sachs asks in biotech Report: Is curing patients a sustainable business? (230 pts)]]></title>
            <link>https://www.cnbc.com/2018/04/11/goldman-asks-is-curing-patients-a-sustainable-business-model.html</link>
            <guid>45949247</guid>
            <pubDate>Sun, 16 Nov 2025 23:01:24 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.cnbc.com/2018/04/11/goldman-asks-is-curing-patients-a-sustainable-business-model.html">https://www.cnbc.com/2018/04/11/goldman-asks-is-curing-patients-a-sustainable-business-model.html</a>, See on <a href="https://news.ycombinator.com/item?id=45949247">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="RegularArticle-ArticleBody-5" data-module="ArticleBody" data-test="articleBody-2" data-analytics="RegularArticle-articleBody-5-2"><div id="ArticleBody-InlineImage-104324084" data-test="InlineImage"><p>Yuri Arcurs | Getty Images</p></div><div><p>Goldman Sachs analysts attempted to address a touchy subject for biotech companies, especially those involved in the pioneering "gene therapy" treatment: cures could be bad for business in the long run. </p><p>"Is curing patients a sustainable business model?" analysts ask in an April 10 report entitled "The Genome Revolution."</p><p>"The potential to deliver 'one shot cures' is one of the most attractive aspects of gene therapy, genetically-engineered cell therapy and gene editing. However, such treatments offer a very different outlook with regard to recurring revenue versus chronic therapies," analyst Salveen Richter wrote in the note to clients Tuesday. "While this proposition carries tremendous value for patients and society, it could represent a challenge for genome medicine developers looking for sustained cash flow."</p></div><div id="Placeholder-ArticleBody-Video-105119182" data-test="VideoPlaceHolder" role="region" tabindex="0" data-vilynx-id="7000012181" aria-labelledby="Placeholder-ArticleBody-Video-105119182"><p><img src="https://image.cnbcfm.com/api/v1/image/105119335-2ED1-PL-MegT-040918.jpg?v=1529477963&amp;w=750&amp;h=422&amp;vtcrop=y" alt="Biotech shares soar on dealmaking, drug progress"><span></span><span></span></p></div><div><p>Richter cited <span data-test="QuoteInBody" id="RegularArticle-QuoteInBody-1"><a href="https://www.cnbc.com/quotes/GILD/">Gilead Sciences'</a><span><span id="-WatchlistDropdown" data-analytics-id="-WatchlistDropdown"></span></span></span> treatments for hepatitis C, which achieved cure rates of more than 90 percent. The company's U.S. sales for these hepatitis C treatments peaked at $12.5 billion in 2015, but have been falling ever since. Goldman estimates the U.S. sales for these treatments will be less than $4 billion this year, according to a table in the report.</p><p>"GILD is a case in point, where the success of its hepatitis C franchise has gradually exhausted the available pool of treatable patients," the analyst wrote. "In the case of infectious diseases such as hepatitis C, curing existing patients also decreases the number of carriers able to transmit the virus to new patients, thus the incident pool also declines … Where an incident pool remains stable (eg, in cancer) the potential for a cure poses less risk to the sustainability of a franchise."</p><p>The analyst didn't immediately respond to a request for comment.</p><p>The report suggested three potential solutions for biotech firms:</p><div><p>"Solution 1: Address large markets: Hemophilia is a $9-10bn WW market (hemophilia A, B), growing at ~6-7% annually."</p><p> "Solution 2: Address disorders with high incidence: Spinal muscular atrophy (SMA) affects the cells (neurons) in the spinal cord, impacting the ability to walk, eat, or breathe."</p><p> "Solution 3: Constant innovation and portfolio expansion: There are hundreds of inherited retinal diseases (genetics forms of blindness) … Pace of innovation will also play a role as future programs can offset the declining revenue trajectory of prior assets."</p></div></div></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Neuroscientists track the neural activity underlying an “aha” (155 pts)]]></title>
            <link>https://www.quantamagazine.org/how-your-brain-creates-aha-moments-and-why-they-stick-20251105/</link>
            <guid>45948792</guid>
            <pubDate>Sun, 16 Nov 2025 21:57:13 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.quantamagazine.org/how-your-brain-creates-aha-moments-and-why-they-stick-20251105/">https://www.quantamagazine.org/how-your-brain-creates-aha-moments-and-why-they-stick-20251105/</a>, See on <a href="https://news.ycombinator.com/item?id=45948792">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
        <p>
            A sudden flash of insight is a product of your brain. Neuroscientists track the neural activity underlying an “aha” and how it might boost memory.        </p>
        
    </div><div>
            <h2>Introduction</h2>
            <div data-role="selectable">
    <p>Here are three words: pine, crab, sauce. There’s a fourth word that combines with each of the others to create another common word. What is it?</p>
<p>When <a href="#answer">the answer</a> finally comes to you, it’ll likely feel instantaneous. You might even say “Aha!” This kind of sudden realization is known as insight, and a research team recently uncovered <a href="https://doi.org/10.1038/s41467-025-59355-4">how the brain produces it</a>, which suggests why insightful ideas tend to stick in our memory.</p>
<p><a href="https://mnemology.org/team/maxi-becker/">Maxi Becker</a>, a cognitive neuroscientist at Duke University, first got interested in insight after reading the landmark 1962 book <a href="https://press.uchicago.edu/ucp/books/book/chicago/S/bo13179781.html"><em>The Structure of Scientific Revolutions</em></a> by the historian and philosopher of science Thomas Kuhn. “He describes how some ideas are so powerful that they can completely shift the way an entire field thinks,” she said. “That got me wondering: How does the brain come up with those kinds of ideas? How can a single thought change how we see the world?”</p>
<p>Such moments of insight are written across history. According to the Roman architect and engineer Vitruvius, in the third century BCE the Greek mathematician Archimedes suddenly exclaimed “Eureka!” after he slid into a bathtub and saw the water level rise by an amount equal to his submerged volume (although this tale <a href="https://www.scientificamerican.com/article/fact-or-fiction-archimede/">may be apocryphal</a>). In the 17th century, according to lore, Sir Isaac Newton had a breakthrough in understanding gravity after an apple fell on his head. In the early 1900s, Einstein came to a sudden realization that “if a man falls freely, he would not feel his weight,” which led him to his theory of relativity, as he later described in a lecture.</p>
<p>Insights are not limited to geniuses: We have these cognitive experiences all the time when solving riddles or dealing with social or intellectual problems. They are distinct from analytical problem-solving, such as the process of doing formulaic algebra, in which you arrive at a solution slowly and gradually as if you’re getting warmer. Instead, insights often follow periods of confusion. You never feel as if you’re getting warmer; rather, you go from cold to hot, seemingly in an instant. Or, as the neuropsychologist Donald Hebb, known for his work building neurobiological models of learning, wrote in the 1940s, sometimes “learning occurs as a single jump, an all-or-none affair.”</p>
</div>
    </div><div data-role="selectable">
    <p>An abrupt cognitive shift in how the mind understands information is known as a representational change. Although researchers have inferred sudden shifts in understanding from the behavior of subjects, they have not pinned down how the brain supports representational change.</p>
<p>During moments of insight, representational change typically occurs, said <a href="https://drexel.edu/coas/faculty-research/faculty-directory/psychology/Kounios-John/">John Kounios</a>, a cognitive neuroscientist at Drexel University and co-author of the book <em>The Eureka Factor: Aha Moments, Creative Insight, and the Brain</em>. “The question is: How is it occurring?”</p>
<h2><strong>Insightful Activity</strong></h2>
<p>While at Humboldt University of Berlin, Becker set out to uncover this neural signature of insight. Given that it’s nearly impossible to fabricate life-changing, field-altering insights in the lab, her team needed to identify a simple task that could produce a sudden feeling of understanding rather than a slowly unfolding solution.</p>
<p>They turned to abstracted black-and-white pictures called Mooney images, which are made by cranking up the contrast on a photograph all the way so that the subjects — a dog or a coffee mug, for example — are unrecognizable at first. The pictures pose a challenge for human brains, which typically identify objects by piecing together their different parts. But if given enough time with a Mooney image, even a few seconds, the brain can rearrange the contours to recognize the pictured object — and trigger the insightful “aha” feeling, a representational change.</p>
</div><div data-role="selectable">
    <p>Over the course of two days, Becker had study participants lie in a functional magnetic resonance imaging (fMRI) scanner, which detects blood flow in the brain as a proxy for neural activity, and view a series of 120 Mooney images. After 10 seconds of viewing a single image, the participant would indicate whether they recognized the pictured object. If they did, they would then answer a series of questions about the suddenness, positive emotion and certainty associated with their experience — three measures that have been linked to moments of insight.</p>
<p>Becker and her team then used neural networks to parse the fMRI data, looking to identify consistent changes in brain activity shared by participants when they correctly recognized Mooney images. They observed that when a participant noticed a hidden object, brain activity increased in the ventral occipitotemporal cortex (VOTC), a region responsible for recognizing visual patterns in the environment; the amygdala, which processes both positive and negative emotions; and the hippocampus, a deep-brain structure involved in handling memories. This activity was greater for experiences rated more certain and emotionally positive — in other words, more insightful ones.</p>
<p>The hippocampus is sometimes known as the brain’s “mismatch detector,” Becker said, because it reacts when an input doesn’t align with expectations. In this case, insight leads a once-meaningless image to gain meaning, going against the brain’s predictions.</p>
<figure>
    <p><img width="1500" height="1813" src="https://www.quantamagazine.org/wp-content/uploads/2025/11/Maxi-Becker-cr-Courtesy-of-Maxi-Becker.webp" alt="A portrait of Maxi Becker" decoding="async" srcset="https://www.quantamagazine.org/wp-content/uploads/2025/11/Maxi-Becker-cr-Courtesy-of-Maxi-Becker.webp 1500w, https://www.quantamagazine.org/wp-content/uploads/2025/11/Maxi-Becker-cr-Courtesy-of-Maxi-Becker-1423x1720.webp 1423w, https://www.quantamagazine.org/wp-content/uploads/2025/11/Maxi-Becker-cr-Courtesy-of-Maxi-Becker-430x520.webp 430w, https://www.quantamagazine.org/wp-content/uploads/2025/11/Maxi-Becker-cr-Courtesy-of-Maxi-Becker-768x928.webp 768w, https://www.quantamagazine.org/wp-content/uploads/2025/11/Maxi-Becker-cr-Courtesy-of-Maxi-Becker-1271x1536.webp 1271w, https://www.quantamagazine.org/wp-content/uploads/2025/11/Maxi-Becker-cr-Courtesy-of-Maxi-Becker-98x118.webp 98w" sizes="(max-width: 1500px) 100vw, 1500px">    </p>
            <figcaption>
                            <p>Maxi Becker, a cognitive neuroscientist at Duke University, explores what insight looks like in the brain.</p>
            <p>Courtesy of Maxi Becker</p>
        </figcaption>
    </figure>

<p>These regions — the hippocampus, amygdala and VOTC — create “a plausible network of brain areas” behind representational change, said Kounios, who was not involved in the study. These findings finally “connect the psychological theory with the neural mechanism,” said <a href="https://sites.northwestern.edu/markbeemanlab/team/yuhua-yu/">Yuhua Yu</a>, a postdoctoral researcher in neuroscience at the University of Arizona, who was also not involved with the study.</p>
<p>Becker and her team likely found representational change in the VOTC because of the visual nature of their stimuli. If they had chosen another type of stimulus, like words, the change would probably have appeared in language-processing areas of the brain.</p>
<p>Once the team had figured out which brain areas support insight, they wanted to probe whether these regions might be working together to create a lasting memory.</p>
<h2><strong>A Memory Boost</strong></h2>
<p>Since they began investigating insight, researchers have suspected that such experiences might boost memory. In his 1949 book <em>The Organization of Behavior</em>, Hebb <a href="https://pure.mpg.de/pubman/item/item_2346268_3/component/file_2346267/Hebb_1949_The_Organization_of_Behavior.pdf">wrote</a> that “whatever insight is, we now know that it continually affects the learning of the adult mammal.” Insight not only feels notable or salient in the moment but also helps us retain new information as memory.</p>
<p>This memory boost, which became known as the insight-memory advantage, has since been studied in many types of problem-solving, including the unraveling of <a href="https://doi.org/10.1016/j.cognition.2020.104411">magic tricks</a> and <a href="https://doi.org/10.1016/j.tics.2025.01.001">puzzles</a>. “When you have an insight, you tend to be better able to remember the solution,” Becker said, compared to when you resolve a problem more gradually. She wanted to understand why.</p>
</div><div data-role="selectable">
    <p>A few days after the initial experiment, the team tested participants’ memory by having them look at more Mooney images online, including some they had seen before. Participants were better able to remember prior images that they had rated highly on the three aspects of insight. This suggested that the insight-memory advantage was real, but the team wanted to see what was going on under the hood. Did brain activity during insight predict better memory five days later?</p>
<p>The researchers found that the larger the activity boost in both the VOTC and the hippocampus during the initial insight, the better participants remembered the Mooney images. The big change in brain activity likely makes the experience more salient, Becker said, and salient experiences are known to better encode long-term memories.</p>
<p>While insight creates stronger memories of an idea, it doesn’t mean the idea is correct. Previous work has shown that the quicker, more certain and more pleasurable a solution feels, the more likely it is to be correct — but false insights <a href="https://doi.org/10.3389/fpsyg.2016.02077">can and do exist</a>. In Becker’s study, participants wrongly identified the subjects of more than half the Mooney images they saw. Of those incorrect trials (which the researchers excluded from the analysis), the participants reported experiencing insight 40% of the time. In comparison, correct trials were accompanied by feelings of insight 65% of the time.</p>
<p>These kinds of studies of insight in the lab will set researchers up to look at how it functions in the real world. Once we decompose insight into “very simple tasks that we already understand well,” Becker said, we can “move on to more complex, truly creative tasks.”</p>
<h2><strong>Insight Into the Future</strong></h2>

<p>As a self-described uncreative person, Yu has been particularly fascinated by insight’s role in the creative process. Creativity is “like a magic power,” she said. “A really big creative idea is [often] associated with insight because a creative idea is in some way a leap in your cognitive world, and a leap will often elicit an insight or ‘aha’ feeling.”</p>
<p>However, Yu is finding that insight’s role in creativity might depend on the kind of problem a person is solving. In a recent study, she asked participants to come up with metaphors for scientific concepts and asked whether they used insight as they did so. The insight-driven metaphors <a href="https://doi.org/10.1111/cogs.13488">weren’t more or less creative</a> than those created through analytic thinking, she found — and the participants were more likely to remember the science concepts behind the latter.</p>
<p>This may be because, unlike the task of seeing a hidden object in a Mooney image, creating a metaphor tends to rely on slower cognitive problem-solving rather than sudden moments of insight, Becker suggested. The effects of insight therefore likely depend on the context.</p>
<p>Next, Yu wants to investigate insight in more contexts. “Most of the insight research is looking at insight in the problem-solving context and in the lab setting,” Yu said. She hopes that researchers will begin investigating “insight within many other domains, like in psychotherapy, in meditation, even in psychedelic experiences.”</p>
        
        
<p>Beyond offering a better understanding of how the human brain learns, these findings could have applications in classrooms. Kounios believes that applying insight-boosting strategies to teaching could lead to better learning outcomes for students. Insight seems to be a powerful and positive experience that generates accurate solutions, confidence in our answers and strong memories.</p>
<p>“It’s very intensive for a teacher to do this, but a lot of really good teachers try to get the students to have the insights themselves about how something works, and that will burn it into their memories,” Kounios said. “Another aspect of that [is], it’s very motivating, too.”</p>
<p><a id="answer"></a>It’s a nice feeling when your brain suddenly comes up with an answer. Perhaps you’ve even experienced that feeling since reading this piece’s first sentence. Maybe it even hit you like an<strong><em> apple</em></strong> on the head.</p>
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Peter Thiel sells off all Nvidia stock, stirring bubble fears (201 pts)]]></title>
            <link>https://www.thestreet.com/investing/peter-thiel-dumps-top-ai-stock-stirring-bubble-fears</link>
            <guid>45948477</guid>
            <pubDate>Sun, 16 Nov 2025 21:19:08 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.thestreet.com/investing/peter-thiel-dumps-top-ai-stock-stirring-bubble-fears">https://www.thestreet.com/investing/peter-thiel-dumps-top-ai-stock-stirring-bubble-fears</a>, See on <a href="https://news.ycombinator.com/item?id=45948477">Hacker News</a></p>
Couldn't get https://www.thestreet.com/investing/peter-thiel-dumps-top-ai-stock-stirring-bubble-fears: Error: Request failed with status code 403]]></description>
        </item>
        <item>
            <title><![CDATA[Why Castrol Honda Superbike crashes on (most) modern systems (160 pts)]]></title>
            <link>https://seri.tools/blog/castrol-honda-superbike/</link>
            <guid>45948311</guid>
            <pubDate>Sun, 16 Nov 2025 20:54:14 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://seri.tools/blog/castrol-honda-superbike/">https://seri.tools/blog/castrol-honda-superbike/</a>, See on <a href="https://news.ycombinator.com/item?id=45948311">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><main><div><p>Posted: 2025-11-16</p><p>A friend cleaned up and gave me a copy of a game I've not heard about before: <em>Castrol Honda Superbike World Champions</em>, a motorbike racing game for PC, released 1998 by Interactive Entertainment Ltd. and Midas Interactive Entertainment.</p><p><a title="Picture of the jewelcase" href="https://seri.tools/blog/castrol-honda-superbike/jewelcase.webp"> <img alt="Picture of the jewelcase" loading="lazy" src="https://seri.tools/blog/castrol-honda-superbike/jewelcase.webp" width="1024"> </a></p><p>Given the age of the game (and looking at the system requirements) it's clear that the game comes from the tricky era of early 3D-accelerated PC gaming. For context, my copy of the game helpfully asks to install DirectX 5.</p><p>Before Windows was known for cramming AI and account requirements into every single corner of the system, no matter how unnecessary, it was known for its excellent backwards compatibility with older software. Generally, unless there are genuine bugs (and sometimes even despite them), Windows tries its hardest to run old applications correctly.</p><p>Pushing my luck and trying to run it on my Windows 7 machine, however, resulted in either a getting stuck on a black screen, or a crash, seemingly at random:</p><p><a title="Crash dialog from Windows 7: bike.exe has stopped working" href="https://seri.tools/blog/castrol-honda-superbike/crash.webp"> <img alt="Crash dialog from Windows 7: bike.exe has stopped working" loading="lazy" src="https://seri.tools/blog/castrol-honda-superbike/crash.webp" width="527"> </a></p><p>Let's go back in time and see how far we need to go to get it running: Installing and running it on my Windows 98 and Windows XP machines was as uneventful, and the game works just fine<sup id="fr-1-1"><a href="#fn-1">1</a></sup>, including with 3D acceleration. Glorious 1024x768x16:</p><p><a title="Screencap ingame" href="https://seri.tools/blog/castrol-honda-superbike/ingame.webp"> <img alt="Screencap ingame" loading="lazy" src="https://seri.tools/blog/castrol-honda-superbike/ingame.webp" width="1024"> </a></p><h2 id="debugging-the-issue">Debugging the issue&nbsp;<a href="#debugging-the-issue">#</a></h2><p>Debugging is more fun than playing, so let's get started! :^)</p><p>I pulled over the installation directory to my main machine and ran <a href="https://github.com/horsicq/Detect-It-Easy">Detect It Easy</a> to see what we can learn about the executable:</p><p><a title="Screenshot of Detect It Easy with bike.exe loaded" href="https://seri.tools/blog/castrol-honda-superbike/die.webp"> <img alt="Screenshot of Detect It Easy with bike.exe loaded" loading="lazy" src="https://seri.tools/blog/castrol-honda-superbike/die.webp" width="1440"> </a></p><p><code>Linker: Microsoft Linker(5.10)</code> and <code>Compiler: Microsoft Visual C/C++(...)[libcmtd]</code> are the interesting bits here. Notice how it's <code>libcmtd</code>, not <code>libcmt</code>? The binary is linked against the static <em>debug</em> version of VC5's runtime. The debug runtime has heaps of extra checks and <a href="https://learn.microsoft.com/en-us/windows/win32/api/debugapi/nf-debugapi-outputdebugstringa">logging</a>, which might help later.</p><p>Let's attach a debugger and see what's going on. Given that the game crashes very early on (before the credits intro screen), I hoped to see something right away. The cases where the game got stuck in a loop seemed to actually get stuck in some Windows API call stack.</p><p>Anyway, the cases where it crashed gave a clearer starting point:</p><p><a title="Stack trace from debugger" href="https://seri.tools/blog/castrol-honda-superbike/stack.webp"> <img alt="Stack trace from debugger" loading="lazy" src="https://seri.tools/blog/castrol-honda-superbike/stack.webp" width="821"> </a></p><p>The game seems to be stuck after a call to DirectInput's <code>DirectInputCreateEx</code> function. At this point I started to do some static analysis of the functions leading to this call. While doing that I noticed that the game seems to have quite extensive logging, anything from game initialization to memory allocations.</p><blockquote><p>If you're interested in all the logs, here are the config settings to enable them all:</p><ul><li>In <code>Config.dat</code>, switch <code>ErrorLog</code>, <code>FileLog</code>, <code>MallocLog</code> from <code>off</code> to <code>on</code>. <ul><li>These are the "normal" log files the game produces.</li><li><code>ErrorLog</code> produces <code>error.log</code>, which is the general log file.</li><li><code>FileLog</code> produces <code>files.log</code>, tracking all opened files and their access modes.</li><li><code>MallocLog</code> produces <code>malloc.log</code>, tracking all memory allocations and frees. The devs even kept descriptions for every allocation site!</li></ul></li><li>Set an environment variable named <code>errorfile</code> to any file name (not path). The game will write logs to that file in the game directory. <ul><li>You might also need to create an empty <code>*.c</code> file in the game directory.</li><li>Just gives a bit of extra logging.</li></ul></li></ul><p>Bonus: add a setting named <code>windowed=true</code> to the config file to force windowed mode; only works correctly in 16-bit mode (garbled graphics in True Color).</p></blockquote><p>After enabling all the logging, I ran the game a few more times, and noticed that the last log messages in <code>error.log</code> before the crash were these:</p><pre><code><span>0&gt; Instance : Mouse
</span><span>0&gt; Product : Mouse
</span><span>1&gt; Instance : Keyboard
</span><span>1&gt; Product : Keyboard
</span><span>2&gt; Instance : Gaming Mouse G502
</span><span>2&gt; Product : Gaming Mouse G502
</span><span>3&gt; Instance : Gaming Mouse G502
</span><span>3&gt; Product : Gaming Mouse G502
</span><span>4&gt; Instance : Gaming Mouse G502
</span><span>4&gt; Product : Gaming Mouse G502
</span><span>5&gt; Instance : Gaming Mouse G502
</span><span>5&gt; Product : Gaming Mouse G502
</span><span>6&gt; Instance : USB Keyboard
</span><span>6&gt; Product : USB Keyboard
</span><span>7&gt; Instance : USB Keyboard
</span><span>7&gt; Product : USB Keyboard
</span><span>8&gt; Instance : LED Controller
</span><span>8&gt; Product : LED Controller
</span></code></pre><p>Great, the game is enumerating input devices— uh, why is there an "LED Controller" device? The motherboard in my Windows 7 machine has a built-in LED controller, so that checks out. Maybe the detection isn't working properly, and the game is trying to use it as an input device?</p><p>After disabling the LED controller in Device Manager, the game started up just fine, consistently! So far, so good. Of course I wanted to know what was actually going wrong, though, so let's see where these messages are printed.</p><h2 id="side-quest-cd-check">Side quest: CD check&nbsp;<a href="#side-quest-cd-check">#</a></h2><p>The game seemed to close without any notice if I forgot to insert the game disc. A quick trace showed that the <code>GibbonPosture</code> setting in <code>f1.cfg</code> is used to point to the disc drive from which the game was installed. The only check seems to be that the path <code>redist\dsetup.dll</code> exists on the disc. Copying the redist folder to the installation directory and changing the setting to <code>GibbonPosture=.\</code> seems to work just fine. :)</p><h2 id="the-bug">The bug&nbsp;<a href="#the-bug">#</a></h2><p>Finding the <code>Instance :</code> and <code>Product :</code> log messages in the binary was easy enough. They are referenced in only one function, which is a <a href="https://learn.microsoft.com/en-us/previous-versions/windows/desktop/ee416622(v=vs.85)"><code>DIEnumDevicesCallback</code></a> callback function that is provided to <code>IDirectInput::EnumDevices</code> (Microsoft has only kept the documentation for the <a href="https://learn.microsoft.com/en-us/previous-versions/windows/desktop/ee417804(v=vs.85)">DX8 version</a> of EnumDevices left online, but it's close enough).</p><p>This is the pseudocode of the call and the callback, and the relevant data structure:</p><pre data-lang="c"><code data-lang="c"><span>struct </span><span>DinputDeviceData
</span><span>{
</span><span>  </span><span>char</span><span> instance_name[</span><span>128</span><span>];
</span><span>  </span><span>char</span><span> product_name[</span><span>128</span><span>];
</span><span>  </span><span>DWORD</span><span> dwDevType;
</span><span>  GUID guid;
</span><span>};
</span><span>
</span><span>// ...
</span><span>
</span><span>BOOL</span><span> __stdcall </span><span>dinput_enumdevices_callback</span><span>(LPCDIDEVICEINSTANCEA </span><span>lpDevice</span><span>, </span><span>LPVOID </span><span>pvRef</span><span>)
</span><span>{
</span><span>    </span><span>int</span><span> index </span><span>=</span><span> g_dinput_device_index;
</span><span>    g_direct_input_devices[index].</span><span>guid </span><span>=</span><span> lpDevice-&gt;guidInstance;
</span><span>    </span><span>strcpy</span><span>(g_direct_input_devices[index].instance_name, lpDevice-&gt;tszInstanceName)</span><span>;
</span><span>    </span><span>strcpy</span><span>(g_direct_input_devices[index].product_name, lpDevice-&gt;tszProductName)</span><span>;
</span><span>    g_direct_input_devices[index].</span><span>dwDevType </span><span>=</span><span> lpDevice-&gt;dwDevType;
</span><span>
</span><span>    </span><span>log_line(</span><span>"</span><span>%d</span><span>&gt; Instance : </span><span>%s</span><span>\n"</span><span>, index, lpDevice-&gt;tszInstanceName)</span><span>;
</span><span>    </span><span>log_line(</span><span>"</span><span>%d</span><span>&gt; Product : </span><span>%s</span><span>\n"</span><span>, index, lpDevice-&gt;tszProductName)</span><span>;
</span><span>
</span><span>    </span><span>if </span><span>( </span><span>LOBYTE(g_direct_input_devices[index].dwDevType) </span><span>==</span><span> DIDEVTYPE_JOYSTICK )
</span><span>    {
</span><span>        </span><span>int</span><span> joystick_index </span><span>=</span><span> g_joystick_index;
</span><span>        g_joystick_info[joystick_index].</span><span>dinput_device_index </span><span>=</span><span> index;
</span><span>        g_joystick_info[joystick_index].</span><span>field_4 </span><span>= </span><span>0</span><span>;
</span><span>        g_joystick_info[joystick_index].</span><span>field_8 </span><span>= </span><span>0</span><span>;
</span><span>        g_joystick_info[joystick_index].</span><span>field_38 </span><span>= </span><span>0</span><span>;
</span><span>        g_joystick_info[joystick_index].</span><span>field_1 </span><span>= </span><span>0</span><span>;
</span><span>        g_joystick_index </span><span>=</span><span> joystick_index </span><span>+ </span><span>1</span><span>;
</span><span>    }
</span><span>    g_dinput_device_index </span><span>=</span><span> index </span><span>+ </span><span>1</span><span>;
</span><span>
</span><span>    </span><span>return</span><span> DIENUM_CONTINUE;
</span><span>}
</span><span>
</span><span>// ...
</span><span>
</span><span>g_dinput_create_hresult </span><span>= </span><span>DirectInputCreateA(hInstance, </span><span>0x500</span><span>u</span><span>, </span><span>&amp;</span><span>g_dinput_instance, </span><span>0</span><span>)</span><span>;
</span><span>g_dinput_device_index </span><span>= </span><span>0</span><span>;
</span><span>g_joystick_index </span><span>= </span><span>0</span><span>;
</span><span>g_dinput_instance-&gt;lpVtbl-&gt;</span><span>EnumDevices(
</span><span>    g_dinput_instance, </span><span>0</span><span>, dinput_enumdevices_callback, </span><span>0</span><span>, DIEDFL_ATTACHEDONLY)</span><span>;
</span></code></pre><p>So, for each enumerated device, the game stores some general information about it in the global array <code>g_direct_input_devices</code>. Then, if the device is a joystick (generally, a game controller), it also adds it to <code>g_joystick_info</code>.</p><p>Can you guess the bug yet? :) If not, here's the declaration of the global arrays:</p><pre data-lang="c"><code data-lang="c"><span>DinputDeviceData g_direct_input_devices[</span><span>8</span><span>];
</span><span>// ...
</span><span>JoystickInfo g_joystick_info[</span><span>8</span><span>];
</span></code></pre><p>There's only space for eight DirectInput devices in the array! <code>8&gt; Instance : LED Controller</code> was the ninth one, overwriting lots of important other data in the process, including timer handles and the actual DirectInput instance pointer.</p><p>But it gets worse: The game uses DirectInput for game controllers only. Copying the device info out of <code>lpDevice</code> is entirely pointless for other types of devices. Just moving the <code>DIDEVTYPE_JOYSTICK</code> check up would have hidden the bug for basically all setups, since you'd have to have more than 8 game controllers connected for the game to write out of bounds.</p><p>Actually, there would've been an even simpler workaround: <code>EnumDevices</code> allows passing a <code>DIDEVTYPE</code> as a filter:</p><pre data-lang="c"><code data-lang="c"><span>g_dinput_instance-&gt;lpVtbl-&gt;</span><span>EnumDevices(
</span><span>    g_dinput_instance, DIDEVTYPE_JOYSTICK, dinput_enumdevices_callback, </span><span>0</span><span>, DIEDFL_ATTACHEDONLY)</span><span>;
</span><span>                    </span><span>// ^^^^^^^^^^^^^^^^^^
</span></code></pre><p>This would make DirectInput call the callback for game controllers only. Without it, all devices, whether they are keyboards, mice, or actually any HID devices, are enumerated. (I've checked the DirectX 5 SDK docs, and even there it mentions the HID device support.) This includes the vendor-defined devices of my mouse and its emulated keyboard (for macros), and of course the motherboard's LED controller.</p><p>The moral of the story? Always check your bounds, kids! You'll never know if some weirdo comes along and plugs in a dozen game controllers to their PC. :^)</p><h2 id="the-fix">The fix&nbsp;<a href="#the-fix">#</a></h2><p><a href="https://github.com/seritools/castrol-honda-dinput-fix">Over on GitHub</a> I've pushed a minimal patch as a classic DLL shim. With the provided <code>dinput.dll</code> in the game directory, the game will load that instead of the system one. DirectInput has only one relevant exported function that we need to shim: <code>DirectInputCreateA</code>. The rest of the API is implemented via COM interfaces, for which we can modify the respective vtables as needed.</p><p>I've implemented two fixes in the shim:</p><ol><li>Inject the <code>DIDEVTYPE_JOYSTICK</code> filter in the call to <code>EnumDevices</code> to only return joysticks/game controllers.</li><li>Cancel enumeration once 8 joysticks have been found.</li></ol><p>For fun, I've also tried to minimize the size of the shim DLL -- the final binary weighs in at 2 KiB.</p><blockquote><p>These are the reasonable settings I changed:</p><ul><li>Compile with <code>opt-level = "z"</code> to optimize for minimum size. (though the code is so low-level that it's effectively the same as <code>opt-level = 3</code>)</li><li><code>#[no_std]</code> to avoid linking the Rust standard library.</li><li><code>codegen-units = 1</code> and <code>lto = true</code> to enable whole-program optimization.</li><li><code>panic = "immediate-abort"</code> to remove all unnecessary panic handling code; an unwrap will immediately abort the process.</li></ul><p>And these are the cursed ones:</p><ul><li><code>/NODEFAULTLIB</code> to not link against any MSVC runtime library; added my own minimal <code>DllMain</code>.</li><li><code>/FORCE:UNRESOLVED</code> to ignore the missing symbols for <code>_aullrem</code>, <code>_aulldiv</code>, and <code>_fltused</code>. We aren't using any of these, but the LLVM target still seems to insist on linking them in.</li><li><code>/FILEALIGN:512</code> to force the linker to use the minimum supported PE section alignment in the file.</li><li><code>/MERGE:.rdata=.text</code> merges the read-only data section into the code section.</li><li>Prevent zero-initialization of the system directory path by using <code>MaybeUninit</code>.</li><li>Storing globals in <code>static mut</code> just like the original game does. Since the fix is specific to this game I can do these "global" assumptions here :^) <ul><li>Ensure all globals are zero-initialized so the <code>.data</code> section is 0 bytes in the binary.</li></ul></li><li><code>.unwrap_unchecked()</code> to avoid any extra branches where they aren't needed.</li><li><code>/DEBUG:NONE</code> to not generate debug information, and not store a <code>.pdb</code> path in the binary.</li></ul></blockquote><p>Furthermore, I switched to <code>rust-lld.exe</code> as the linker, as it's fine with setting <code>/SUBSYSTEM:WINDOWS,4.0"</code> and <code>/OSVERSION:4.0</code> without complaining. :) Since there is no linked runtime code at all, the resulting binary should work on any 32-bit Windows version, even without <a href="https://github.com/rust9x/rust/wiki">Rust9x</a>. I've tested it on Windows 7 and Windows 98 SE.</p><p>Feel free to grab the compiled DLL from the <a href="https://github.com/seritools/castrol-honda-dinput-fix/releases">releases page</a>.</p><section><ol><li id="fn-1"><p>Except for True Color rendering, <a href="https://seri.tools/blog/castrol-honda-superbike/truecolor.webp">which seems to be broken</a>, no matter the system, graphics card, or game version? Investigating that is left as a mystery for another day. <a href="#fr-1-1">↩</a></p></li></ol></section></div></main></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[The Pragmatic Programmer: 20th Anniversary Edition (2023) (196 pts)]]></title>
            <link>https://www.ahalbert.com/technology/2023/12/19/the_pragmatic_programmer.html</link>
            <guid>45948254</guid>
            <pubDate>Sun, 16 Nov 2025 20:46:30 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.ahalbert.com/technology/2023/12/19/the_pragmatic_programmer.html">https://www.ahalbert.com/technology/2023/12/19/the_pragmatic_programmer.html</a>, See on <a href="https://news.ycombinator.com/item?id=45948254">Hacker News</a></p>
<div id="readability-page-1" class="page"><div> 
    <p>
    
    
    <img src="https://www.ahalbert.com/assets/tpp20.jpg"></p><hr>
    
    
    

    <p><a href="https://pragprog.com/titles/tpp20/the-pragmatic-programmer-20th-anniversary-edition/"><em>The Pragmatic Programmer: From Journeyman to Master</em></a> by Dave Thomas and Andrew Hunt was given to me as a gift after an internship. The book gave me invaluable advice as I started out in my career as a professional software engineer. Re-reading it a decade later, I thought the general advice still held up well, but it made references to technologies such as CORBA that are no longer used and felt dated as a result. The authors agreed and wrote a 20th anniversary edition that was updated for modern developers. A third of the book is brand-new material, covering subjects such as security and concurrency. The rest of the book has been extensively rewritten based on the authors’ experience putting these principles into practice. We discussed the 20th anniversary edition in my book club at work.&nbsp;</p>

<p>The book is meant for those just starting out in the world of professional software engineering. Many of the tips, such as <strong>Tip 28: Always Use Version Control</strong> will seem obvious to experienced hands. However, it can also be a guide for senior developers mentoring junior developers, putting actionable advice into words. The book is also valuable to those who lack a formal CS education; it explains things like big-O notation and where to learn more about these subjects. I think that any software engineer will get one or two things out of this book, though it’s most valuable for beginners.</p>

<p>One of the things I appreciate about the book is that they talk about applying the principles not only to software engineering but to writing the book as well. The book was originally written in troff and later converted to LaTeX. For example, to illustrate <strong>Tip 29: Write Code That Writes Code</strong> they wrote a program to convert troff markup to LaTeX. In the 20th anniversary edition, they talk about their efforts to use parallelism to speed up the book build process and how it led to surprising bugs.</p>

<p>Perhaps the best thing about the book is that the authors summarize their points into short tips highlighted throughout the book. The authors helpfully attach these tips to a card attached to the physical book. This makes it easy to remember the principles espoused in the book and to refer to them later. I think this is a feature that more books should include, especially managerial or technical books.</p>

<h2 id="chapter-1-a-pragmatic-philosophy">Chapter 1: A Pragmatic Philosophy</h2>

<p>The first chapter is less about coding and more about the general principles a pragmatic programmer follows. Most of all, it’s about taking responsibility for your work. The first tip of the chapter is <strong>Tip 3: You Have Agency</strong>: if you don’t like something, you can be a catalyst for change. Or you can change organizations if change isn’t happening. The most important tip of the chapter to me is <strong>Tip 4: Provide Options, Don’t Make Lame Excuses</strong>. In this section, they discuss taking responsibility for the commitments you make and having a contingency plan for things outside your control. If you don’t meet the commitment, provide solutions to fix the problems. Don’t tell your boss, “The cat ate my source code.”</p>

<p>Software rots over time without efforts to fix it. The authors talk about broken windows policing, the theory that minor problems such as a single broken window give people the psychological safety to commit larger crimes. Regardless of whether broken windows policing is actually true, the metaphor applies to software. This leads to <strong>Tip 5: Don’t Live with Broken Windows</strong>: If you see a broken window in your software, make an effort to fix it, even if it’s only a minor effort to board it up. This may seem impractical if your project already has a lot of broken windows, but this tip helps you avoid creating such an environment in the first place. In my experience, it works: when we set up a new project at work, we made a commitment to use git commit hooks to enforce coding standards. This made each of us more reluctant to compromise on software to begin with, and all of the code was a good example to copy from.</p>

<p>A pragmatic programmer is always learning, and learns things outside their specialty; they are a jack of all trades. Even if they are a specialist in their current role, they invest regularly in a broad knowledge portfolio. In addition to software skills, people skills are important as well. The section “Communicate!” shows how to effectively communicate your ideas, such as how to present, what to say, and how pick the right time. In the words of <strong>Tip 11: English is Just Another Programming Language</strong>. If you don’t have an answer to an email immediately, respond with an acknowledgment and that you’ll get back to them later - nobody wants to be talking to a void. Don’t be afraid to reach out for help if you need it; that’s what your colleagues are there for, after all. And don’t neglect documentation! Make it an integral part of the development process, not an afterthought.</p>

<p>Finally, the principles in this book are not iron-clad: you must consider the tradeoffs between different values and make the right decision for your project. Your software does not need to be perfect. When working on software, involve your users in deciding what quality issues are acceptable in return for getting it out faster. After all, if you wait a year to ship the perfect version, their requirements will change anyways. As <strong>Tip 8 says: Make Quality a Requirements Issue</strong>.</p>

<h2 id="chapter-2-a-pragmatic-approach">Chapter 2: A Pragmatic Approach</h2>

<blockquote>
  <p>Why is decoupling good? Because by isolating concerns we make each easier to change. ETC.<br>
Why is the single responsibility principle useful? Because a change in requirements is mirrored by a change in just one module. ETC.<br>
Why is naming important? Because good names make code easier to read, and you have to read it to change it. ETC! <br></p>
</blockquote>

<p>However, the authors also stress that ETC is a <em>value</em>, not a <em>rule</em>. For example, ETC may not be appropriate for writing code that has high performance requirements; making the code complex to achieve the performance requirements is an acceptable tradeoff.&nbsp;</p>

<p>They then turn to another important acronym for implementing ETC in <strong>Tip 15: DRY—Don’t Repeat Yourself</strong>. DRY makes things easier to change by having one place to change anything. Worse, if you forget to make a change, you’ll have contradictory information in your program that could crash it or silently corrupt data.</p>

<h3 id="what-kind-of-duplication-is-there">What kind of duplication is there?</h3>

<ul>
  <li><strong>Code Duplication</strong>: For example, having a case statement duplicated across several different places rather than in a single function.</li>
  <li><strong>Documentation Duplication</strong>: Some people believe that every function needs a comment. If you do this, you will also have to update the comments each time the function changes. Ask what your comment adds to the code before writing it!</li>
  <li><strong>Data Duplication</strong>: Caching an expensive result and forgetting to update the cache when the source data changes.</li>
  <li><strong>Representational Duplication</strong>: When you work with external API, the client and server must adhere to the same format in order to work. If one changes, the other side will break Having a common specification, such as openAPI allows you to integrate more reliably with the service.</li>
  <li><strong>Interdeveloper duplication</strong>: When two developers do the same work. This can be mitigated by <strong>Tip 16: Make It Easy to Reuse</strong>. If it’s hard to use your code, other developers will be tempted to duplicate it.</li>
</ul>

<p>A closely related principle to DRY is <em>Orthogonality</em>. Two components of a software system are orthogonal if changes in one do not effect the other. Systems should be designed as a set of cooperating independent modules, each of which has a single, well-defined purpose. Modules communicate between themselves using well defined interfaces and don’t rely on shared global data or the implementation details of another module. Unless you change a component’s external interfaces, it should not cause changes in the rest of the system. Orthogonal systems are easier to test, because more testing can be done at the module level in unit tests rather than end-to-end integration tests that test the whole system.</p>

<p>Often, when starting a software project, there are a lot of unknowns. The user has an idea of what they want, but there’s some ambiguity in the requirements. You don’t know if the library and frameworks you pick will work nicely together. The solution here is <strong>Tip 20: Use Tracer Bullets to Find the Target</strong>. In a machine gun, tracer bullets are bullets that glow in the air, enabling the user to see if they’re hitting the target at night. Tracer Bullet Development provides that kind of immediate feedback. Look for a single feature that can be built quickly using the architectural approach you’ve chosen, and put that in front of the users. You may miss; users may say that’s not quite what they wanted. But that’s the point of tracer code: it allows you to adjust your aim with a skeleton project that’s easier to change than a final application. Users will be delighted to see something working early, and you’ll have an integration platform to build the rest of the application on.</p>

<p>Tracer code is different from prototypes. To the authors, prototypes are disposable code used to learn about a problem domain, never meant to be used in production. Prototypes don’t even have to be code. A UI can be mocked up in an interface builder, or an architecture mapped out with post-it notes. In terms of <strong>Tip 21: Prototype to Learn</strong>. In contrast, tracer bullet code is meant to be part of the final application.</p>

<p>The final tip of this chapter I bring up is <strong>Tip 18: There Are No Final Decisions</strong>. Decisions should be reversible; if you rely on MySQL today, you may find yourself needing to switch to Postgres six months from now. If you’ve properly abstracted the database logic, making this change should be easy. Marketing may decide that your web app should be a mobile app in the future; if your architecture is built well, this extra demand should not be a burden. This is one tip I disagree with: I think it can easily be taken too far. If you provide too much reversibility, you’ll end up with over-abstracted code with configuration options that are never used. I think it’s more reasonable to think about what decisions can reasonably change and make them flexible; if you spend all your time trying to cover for every possibility, you’ll never get around to actually coding the required functionality.</p>



<p>This chapter focuses on how to make the most out of your tools, what tools to invest in, and how to approach debugging. The first bit of advice: <strong>Tip 25: Keep Knowledge in Plain Text</strong>. By plain text, they mean keep knowledge such as configuration or data in a simultaneously human-readable and computer readable format. Plain text insures you against obsolesce; you can always write something to parse it later, while reverse-engineering a binary format is significantly harder. In addition, almost any other tool in existence can process plain text in some way, so you’ll have an extensive suite of other tools to use. As an extension of the power of plain text, they also suggest you master a command shell such as <code>bash</code>. Shells provide a family of tools that are composable with each other, and can be combined as much as your imagination allows. A GUI in contrast, limits you to the actions the programmers of the GUI thought of in advance. Finally, you should learn a text processing language such as <code>awk</code> or <code>perl</code> to get the most out of text - the authors used perl (first edition) and ruby (20th anniversary edition) to automatically highlight the source code in the book, for example.</p>

<p>The next topic the authors turn to is debugging. Debugging is the main task a software engineer does throughout their day, so it’s essential you get good at it. Defects show up in a variety of ways, from misunderstood requirements to coding errors. Some cultures try to find someone to blame for a defect; the authors think you should avoid that with <strong>Tip 29: Fix the Problem, Not the Blame</strong>.</p>

<p>They give the following tips on debugging your code:</p>

<ul>
  <li><strong>Tip 30: Don’t Panic</strong>: It’s easy to panic when you’re on a tight deadline or a client is angry at you. However, take a deep breath and think about the problem at hand. The cause of the bug may be several layers removed from what you’re seeing, so try to focus on root causes rather than fixing the symptoms.</li>
  <li><strong>The Impossible has Happened</strong>: If you think to yourself “that’s not possible” - you’re wrong. It’s clearly possible, and it’s staring you in the face.</li>
  <li><strong>Reproduce It!</strong>: Find a minimal case that triggers the bug, whether that be a certain input data set, or pattern of actions. Once you can reliably cause the bug, you can trace it through your code.</li>
  <li><strong>Tip 32: Read the Damn Error Message</strong>: Enough said.</li>
  <li><strong>The Operating System is Fine</strong>: It’s <em>possible</em> that you found a bug in the Linux kernel or postgres, but these are extensively battle-tested applications. It’s much more likely that the problem is in your code.</li>
  <li><strong>The Binary Chop</strong>: Cut things in half until you find the problem. This massively decreases the search space you have to work in. If you have a long stack trace and are trying to find which function mangled the value, log the value halfway through. If the value is fine, log the value halfway through the next half, or if it’s mangled, halfway through the previous half, and so on. If a release introduces a regression, find a version that’s fine, and binary chop through the commits to find the commit that introduced the bug.</li>
  <li><strong>Use a Debugger and/or Logging Statements</strong>: Debuggers allow you to step through the code and inspect the values of variables, finding the exact point where things go wrong. In environments where a debugger is not available, logging statements can show you how a variable changes in time, or just how far the program got before crashing.</li>
  <li><strong>Rubber Ducking</strong>: Explain the bug to a colleague, or talk out loud to a rubber duck. You don’t have to get a response, by verbalizing your assumptions you may gain sudden insight into the problem.</li>
</ul>

<p>Once you’ve solved the bug, however there’s still one more step: you should write a test to catch that bug in the future.</p>

<h2 id="chapter-4-pragmatic-paranoia">Chapter 4: Pragmatic Paranoia</h2>

<p><strong>Tip 36: You Can’t Write Perfect Software</strong> starts off the chapter. While we’d like to write perfect software, there will always be bugs, poor design decisions, and missing documentation. The theme of this chapter is how to design this fact in mind.</p>

<p>The first idea they propose is <em>Design By Contract</em>. Similar to legal contracts, it explains a function or module’s rights and responsibilities. A contract has three parts: It has <em>Preconditions</em>: things that must be true when it is called, such as what qualifies as valid inputs. <em>Postconditions</em> are what will be true when it is done, such as a sort routine returning a sorted array. Finally, <em>Invariants</em> are things that are always true from the caller’s perspective - they may change while the routine is running, but will hold at the beginning and the end of the call. For example, in a sort routine, the invariant is that the list to be sorted will contain the same number of items when it started as when it finished. If the contract is violated, the contract will specify what to do, such as crash or throw an exception.</p>

<p>Some languages, such as Clojure have built-in semantics for design by contract, with explicit pre- and post- conditions. However, if your language doesn’t support contracts, you can implement them with <strong>Tip 39: Use Assertions to Prevent the Impossible</strong>. You can assert that the conditions of your contract are true, and handle the cases where the contract is violated. If you don’t know what to do when a contract is violated, the authors recommend <strong>Tip 38: Crash Early</strong>. It’s better that you crash rather than write incorrect data to the database. After all, dead programs tell no lies. Of course, crashing immediately may not be appropriate - if you have resources open make sure to close them before exiting.</p>

<p>The final paranoid tip is <strong>Tip 43: Avoid Fortune-Telling</strong>. Pragmatic programmers only make decisions that they can get immediate feedback on. The more predictions you make about the future, the more likely you’ll get some of the predictions wrong and make the wrong decision based on them.</p>

<blockquote>
  <p>You might find yourself slipping into fortune telling when you have to:</p>
  <ul>
    <li>Estimate completion dates months in the future</li>
    <li>Plan a design for future maintenance or extendability</li>
    <li>Guess user’s future needs</li>
    <li>Guess future tech availability</li>
  </ul>
</blockquote>

<h2 id="chapter-5-bend-or-break">Chapter 5: Bend, or Break</h2>

<p>In a previous chapter, the authors wrote about making decisions <em>reversible</em> and <em>easier to change</em>. This chapter tells you how to implement it in your code. The key here is to make your code flexible rather than rigid - good code bends to circumstances rather than breaks. Part of this is <em>decoupling</em> code. Code is consider coupled when they share something in common. This may be something as simple as a shared global variable, or something more complex like an inheritance chain.</p>

<p>The authors argue against what they term <em>Train Wrecks</em> - long chains of method calls, such as this example they give:</p>

<div><pre><code>public void applyDiscount(customer, order_id, discount) { 
	totals = customer
			  .orders 
			  .find(order_id) 
			  .getTotals();

	totals.grandTotal = totals.grandTotal - discount;
	totals.discount = discount; 
}

</code></pre></div>

<p>This code is traversing many different levels of abstraction - you have to know that a customer object exposes orders, that orders have a <code>find</code> method, and that the order <code>find</code> returns has a <code>getTotal</code> method. If any of these levels of abstraction are changed, your code might break. And requirements may change; What if the business decides to implement a maximum discount amount of 40%? Certainly, this could be applied in the <code>applyDiscount</code> routine, but anything could modify the <code>grandTotal</code> and <code>discount</code> fields - this rule could be violated if other modules modifying the totals object don’t get the memo.</p>

<p>The authors suggest refactoring the code so that there is no orders object, just a <code>find</code> method and an applyDiscount method for the order object that implements the 40% rule:</p>

<div><pre><code>public void applyDiscount(customer, order_id, discount) { 
	customer
	.findOrder(order_id)
	.applyDiscount(discount); 
}
</code></pre></div>

<p>The authors suggest having only one . when you access something if that something is likely to change, such as anything in your application, or a fast moving external API. This includes using intermediate variables between accesses, such as this code:</p>

<div><pre><code># This is cheating!
orders = customer.orders
order = orders.find(order_id)
totals = order.getTotals
</code></pre></div>

<p>However, the rule does not apply to things that are unlikely to change, such as core language APIs. So this code is ok:</p>

<div><pre><code>people
.sort_by {|person| person.age } 
.first(10)
.map {| person | person.name }
</code></pre></div>

<p>Another source of coupling is globally accessible data. Global data makes it hard to reason about the state of a program, since any other module might be able to change it. Global data includes design patterns such as singletons, and external resources such as databases. Given how extensive global resources are, how can one avoid them? If global data is unavoidable, the key is to manage them through a well-defined API that you control, rather than allowing anything to read and write global data. In the words of <strong>Tip 48: If It’s Important Enough to Be Global, Wrap It in an API</strong>.</p>

<p>Poor use of inheritance is a third source of coupling. Inheritance is used for two reasons: code reuse and type modeling. Inheritance doesn’t work for code reuse; Not only is the code of a child class coupled to any ancestor of the class, so is any code that uses the class. Things may unexpectedly break when an ancestor changes an API, even if you are using a subclass.</p>

<p>Nor does inheritance work for modeling types. Class hierarchies quickly become tangled, wall covering monstrosities. Another problem is multiple inheritance. A <code>Car</code> may be a type of <code>Vehicle</code>, but it may be an <code>Asset</code> or <code>InsuredItem</code>. Multiple inheritance is required to model this, and many OO languages don’t support multiple inheritance. Instead of paying the inheritance tax, the authors suggest using:</p>

<ul>
  <li>Interfaces/Protocols</li>
  <li>Delegation</li>
  <li>Mixins/Traits</li>
</ul>

<p><em>Interfaces</em> or <em>Protocols</em> are classes that contain no code but instead contains behaviors. A class that implements an interface promises to define the behaviors. For example, a <code>Car</code> might implement <code>Drivable</code> which has methods such as <code>accelerate</code> and <code>brake</code>. Interfaces can be used as types, and any class that implements the interface will be compatible with that type. This is a much easier way to provide polymorphism than inheritance.</p>

<p>Another alternative to inheritance is <em>delegation</em>. If you want to include behavior from class <code>Foo</code> add a member of type <code>Foo</code> to your class rather than inherit from <code>Foo</code>. You can then use Foo’s API wrapped in code you control. Delegation is a <em>has-a</em> relationship rather than a <em>is-a</em> relationship.</p>

<p>The problem with interfaces and delegation is that they require writing lots of boilerplate code. For example, it’s likely that most of your classes that implement <code>Drivable</code> will have the same logic for <code>brake</code>, but each class will have to write it’s own implementation of <code>brake</code>. This leads to repeated code across your codebase, violating the DRY principle. To resolve this, the authors turn to <em>Mixins</em> - sets of functions that can be “mixed into” a class. This allows you to add common functionality without using inheritance. I wonder how mixins are implemented in a language like Java, which doesn’t have an obvious version of that feature. It’s also not clear to me how mixins are different from inheritance; aren’t they just a form of multiple inheritance?</p>

<p><strong>Tip 55: Parameterize Your App Using External Configuration</strong>: Code may have values that change while the application is running, such as credentials for for third-party services. Rather than directly including the values in your code, you should externalize them and put them in a configuration bucket. Keeping credentials in source code is a security risk - hackers scan public git repositories for common security credentials, such as AWS keys. It’s common to store them in a flat file or database tables, and read them when the application initializes. However, in our world of highly-available applications that’s not as appropriate. Instead the authors propose configuration-as-a-service, where configuration is stored behind a service API. This allows multiple applications to share configuration information, use access control to control who can see and edit configuration, and provide a UI to easily edit config information. Using the configuration service, applications can subscribe to a configuration item and get notifications when they change. This allows applications to update config data on their side without restarting.</p>

<h2 id="chapter-6-concurrency">Chapter 6: Concurrency</h2>

<p>This chapter deals with <em>Parallelism</em>, where two pieces of code run at the same time, and <em>Concurrency</em>, where things act as if they run at the same time. In the real world, things are asynchronous - the user is supplying input, network resources are called, and the screen is being redrawn all at the same time. Applications that run everything serially feel sluggish.</p>

<p>In <strong>Tip 56: Analyze Workflow to Improve Concurrency</strong> the authors advocate that you break temporal coupling where possible. <em>Temporal Coupling</em> is when your code depends on event A happening before event B. You should look at your workflow to see what can be executed concurrently. Look for activities that take a lot of time that would allow for something else to be done in the meantime. If your application makes multiple independent API calls to a remote service, execute them on separate threads rather than serially, then gather up the results of each call. If your workflow allows a way to split the work into multiple independent units, take advantage of those multiple cores and execute them in parallel.</p>

<p>Of course, parallelism has its pitfalls as well. For example, imagine reading an integer, incrementing it, and writing it back. If two processes read that integer at the same time, they will each increment the value to n+1, when you want it to be n+2. The update needs to be atomic; each process needs to do this sequentially without the other process interfering. This can be done through synchronized methods, semaphores, or other forms of resource locking. However, they have their own dangers as well, such as deadlocking, where two processes each get a lock on one of two needed resources, but not the other. Each waits forever for the other to release its lock. The authors think you should avoid shared state rather than try to handle yourself wherever possible; <strong>Tip 57: Shared State Is Incorrect State</strong>.</p>

<p>The authors ran into this issue when writing the 20th anniversary edition: they updated the build process for the book to utilize parallelism. However, the build would randomly fail. The authors tracked this down to changing the directory temporarily. In the original, a subtask would change directory, then go back to the original directory. However, this no longer worked when new threads started, expecting to be in the root directory. Depending on the timing, this could break the build. This prompted them to write <strong>Tip 58: Random Failures Are Often Concurrency Issues</strong>.</p>

<h2 id="chapter-7-while-you-are-coding">Chapter 7: While You Are Coding</h2>

<p>This chapter is more of a grab-bag. It covers subjects such as psychology, big-O notation, refactoring, security, and testing.</p>

<p>In <strong>Tip 61: Listen to Your Inner Lizard</strong> the authors talk about listening to your instincts (your lizard-brain). If you find yourself having a hard time writing code, your brain is trying to tell you something. Perhaps the structure or design is wrong, or you don’t fully understand the requirements. If you find yourself in this situation, take a step back and think about what you are doing. Maybe go for a walk, or sleep on it. You might find that the solution is staring you in the face when you come back.</p>

<p>Perhaps you need to refactor the code instead of writing more. Refactoring is a continuous process, espoused in <strong>Tip 65: Refactor Early, Refactor Often</strong>. If anything strikes you as wrong in your code, such as DRY violations, outdated knowledge or non-orthogonal design, don’t hesitate to fix it. When you are refactoring, make sure you have a good suite of unit tests beforehand to test if your changes break anything. Run the tests frequently to check if you’ve broken anything.</p>

<p>Speaking of tests, the authors start with a bold assertion: <strong>Tip 67: Testing Is Not About Finding Bugs</strong>. Instead, tests function as <em>the First User of Your Code</em> - a source of immediate feedback, and immediately forces you to think about what counts as a correct solution. In addition, tightly coupled code tends to be hard to test, so it helps you make good design decisions. The authors emphatically do not think you should adopt full-on Test Driven Development - it’s too easy to become a slave to writing tests. They note an example of a TDD advocate starting a sudoku solver using TDD and spent so much time writing the tests they failed to write the solver itself!</p>

<p>In a sidebar, Dave Thomas explains that he stopped writing tests for a few months, and said “not a lot” happened. The quality didn’t drop, nor did he introduce bugs into the code. His code was still testable, it just wasn’t tested.</p>

<blockquote>
  <p>Andy says I shouldn’t include this sidebar. He worries it will tempt inexperienced developers not to test. Here’s my compromise:
Should you write tests? Yes. But after you’ve been doing it for 30 years, feel free to experiment a little to see where the benefit lies for you.</p>
</blockquote>

<h2 id="chapter-8-before-the-project">Chapter 8: Before the Project</h2>

<p>This chapter focuses on how to start your project on the right foot. The first subject the authors tackle is requirements gathering: <em>The Requirements Pit</em>. While we talk about gathering requirements as if they are on the ground, waiting to be picked up, requirements are non-obvious because of <strong>Tip 75: No One Knows Exactly What They Want</strong>. They think of requirements gathering as a kind of therapy, where you take an initial requirement and ask questions about the details to nail down exactly what they need. The authors show an example of a simple requirement: <em>“Shipping should be free on all orders costing  <span>$</span>50 or more”</em>. Does that include the shipping cost itself? Tax? If you’re selling ebooks as well, should they be included? The job of the programmer is <strong>Tip 76: Programmers Help People Understand What They Want</strong>. You should find any edge cases the client may not have considered and make sure they’re documented. This doesn’t mean creating long specifications the client won’t read. Instead, the authors think requirements should be able to fit on an index card. This helps prevent feature creep; if the client understands how adding one more index card will impact the schedule, they’ll consider the tradeoffs and prioritize the requirements they need the most.</p>

<p>You are given constraints in your requirements as well. Your job as a software engineer is to evaluate if those constraints are things you actually have to live with or if you can relax them. In the words of <strong>Tip 81: Don’t Think Outside the Box—Find the Box</strong>, the constraints are the edges of the box. What you initially thought of as a constraint may actually be an assumption you held.</p>

<p>Another tip the authors advocate for is <strong>Tip 78: Work with a User to Think Like a User</strong>. If you’re building an inventory system, work in the warehouse for a few days to get an idea of their processes and how your system will be used. If you don’t understand how it will be used, you could create something that meets all of the requirements but is totally useless. They cite an example of a digital sound mixing board that could do anything to sound that was possible, yet nobody wanted to use it. Rather than take advantage of recording engineers’ experience with tactile sliders and knobs, they built an interface that was unfamiliar to them. Each feature was buried behind menus and given unintuitive names. &nbsp;It did <em>what</em> was required, but didn’t do it <em>how</em> it was required.&nbsp;</p>

<p>The authors also consider in this chapter what it means to be Agile. Many teams and companies are eager for an off-the-shelf solution: call it Agile-in-a-Box. But no process can make you Agile; “Use this process and you’ll be agile” ignores a key part of the Agile manifesto: <em>Individuals and interactions over processes and tools</em>. To the authors Agile can be boiled down to the following:</p>

<blockquote>
  <ol>
    <li>Work out where you are.</li>
    <li>Make the smallest meaningful step towards where you want to be.</li>
    <li>Evaluate where you end up, and fix anything you broke.</li>
  </ol>
</blockquote>

<p>Do this for every level of what you do, from process to code, and you’ll have adopted the Agile spirit.</p>

<h2 id="chapter-9-pragmatic-projects">Chapter 9: Pragmatic Projects</h2>

<p>Can the lessons of <em>The Pragmatic Programmer</em> be applied to teams too? The authors say yes. This chapter focuses on how to apply the lessons of the previous chapters to the team level. Many of the lessons are the same as those mentioned previously, so I won’t go into them again.</p>

<p>The authors advise <strong>Tip 87: Do What Works, Not What’s Fashionable</strong>. Just because Google or Facebook adopts process $ x $ doesn’t mean it’s right for your team. How do you know if something works? Try it. Pilot an idea with a small team, and see what works about it and what doesn’t. The goal isn’t to “do Scrum” or “be Agile”, but to deliver working software continuously. When you adopt a new idea, you should do it with improving continuous deployment of software in mind. If you’re measuring your deployments in months, try to get it down to weeks instead. Once you get it down to weeks, try to deliver in one-week iterations.</p>

<p>Related to continuously delivering software is <strong>Tip 96: Delight Users, Don’t Just Deliver Code</strong>. Delivering working software in a timely matter is not enough to delight your users; that is merely meeting expectations. The authors suggest you ask your users a question:</p>

<blockquote>
  <p>How will you know that we’ve all been successful a month (or a year, or whatever) after this project is done?</p>
</blockquote>

<p>The answer may not be related to the requirements, and may surprise you. For example, a recommendations engine might be valued on driving customer retention. But once you know what the secret to success is, you should aim not just to hit the goal but to exceed it.</p>

<p>Finally, take pride in your work. The final tip of the book is <strong>Tip 97: Sign Your Work</strong>.</p>

<h2 id="final-thoughts">Final Thoughts</h2>

<p>I was only able to cover a portion of this remarkable book in this review. I highly recommend this book to any software engineer, especially to those just starting out in the field. It makes a great graduation gift to someone just finishing their CS degree.</p>


    <hr>
     <p><a href="https://www.ahalbert.com/reviews/2023/11/25/family_and_borghesia.html">&lt;&lt; Previous </a> 
     <span><a href="https://www.ahalbert.com/reviews/2023/12/29/and_the_band_played_on.html"> Next &gt;&gt;</a> </span></p>
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[I have recordings proving Coinbase knew about breach months before disclosure (639 pts)]]></title>
            <link>https://jonathanclark.com/posts/coinbase-breach-timeline.html</link>
            <guid>45948058</guid>
            <pubDate>Sun, 16 Nov 2025 20:18:10 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://jonathanclark.com/posts/coinbase-breach-timeline.html">https://jonathanclark.com/posts/coinbase-breach-timeline.html</a>, See on <a href="https://news.ycombinator.com/item?id=45948058">Hacker News</a></p>
<div id="readability-page-1" class="page"><article>
                    <p><img src="https://jonathanclark.com/images/coinbase-breach/hero-timeline.png" alt="Coinbase data breach timeline investigation">
                    </p>
                    
                    <h2>The Call That Changed Everything</h2>
                    
                    <p>On January 7, 2025, at 5:02 PM, I received an email with a subject line that immediately caught my attention:</p>
                    
                    <blockquote>
                        <p><strong>"Order N54HJG3V: Withdrawal of 2.93 ETH initiated. A representative will be in touch shortly before we mark the payment completed"</strong></p>
                    </blockquote>
                    
                    <p>Minutes later, my phone rang. The caller ID showed 1-805-885-0141. An American-sounding woman who identified herself as a Coinbase fraud prevention representative said someone had initiated a large transfer from my account and she was calling to confirm.</p>
                    
                    <p>What happened next was chilling: <strong>She knew my social security number. She knew my Bitcoin balance down to the decimal point. She knew personal details that should have been impossible for a scammer to possess.</strong></p>
                    
                    <p>This wasn't just another phishing attempt. This was something far more sophisticated.</p>

                    <hr>

                    <h2>The Timeline That Doesn't Make Sense</h2>
                    
                    <p>Here's where the story gets interesting—and troubling:</p>
                    
                    <ul>
                        <li><strong>January 7, 2025:</strong> I was attacked by scammers with detailed personal information</li>
                        <li><strong>January 7, 2025:</strong> I reported the attack to Coinbase security@coinbase.com</li>
                        <li><strong>January 7, 2025 (same day):</strong> Brett Farmer, Head of Trust &amp; Safety, responded: "This report is super robust and gives us a lot to look into. We are investigating this scammer now."</li>
                        <li><strong>January 13, 2025:</strong> I asked Coinbase: "How did the attacker know the balance of my bitcoin holdings?" <em>(No response)</em></li>
                        <li><strong>January 17, 2025:</strong> I followed up again, asking for a reply <em>(No response)</em></li>
                        <li><strong>January 22, 2025:</strong> Still no answer to my critical question <em>(No response)</em></li>
                        <li><strong>January 29, 2025:</strong> I asked again: "Could I please get a response?" <em>(No response)</em></li>
                        <li><strong>May 11, 2025:</strong> Coinbase says they became aware of the breach (when attackers demanded $20M ransom)</li>
                        <li><strong>May 15, 2025:</strong> Coinbase publicly disclosed the breach</li>
                    </ul>
                    
                    <p><strong>That's a four-month gap.</strong></p>
                    
                    <p>For four months, I had concrete evidence that attackers possessed detailed Coinbase customer data. For four months, I repeatedly asked Coinbase to explain how this was possible. And for four months, my questions went unanswered.</p>
                    
                    <p><strong>Coinbase never replied to a single follow-up email after Brett Farmer's initial response.</strong> Despite his promise that they were "investigating this scammer," the most important question—how the attacker obtained my private account data—was met with complete silence.</p>

                    <hr>

                    <h2>What We Now Know About the Breach</h2>
                    
                    <p>In May 2025, Coinbase finally disclosed what had happened: cybercriminals had bribed overseas customer support contractors—particularly employees at TaskUs in India—to steal sensitive customer data.</p>
                    
                    <p>The compromised information included:</p>
                    <ul>
                        <li>Names, addresses, and phone numbers</li>
                        <li>Email addresses</li>
                        <li>Last four digits of Social Security numbers</li>
                        <li>Government-issued ID images</li>
                        <li>Account balances</li>
                        <li>Transaction histories</li>
                    </ul>
                    
                    <p>Coinbase estimated the financial impact at <strong>$180-400 million</strong>, affecting less than 1% of their customer base. Over 200 TaskUs employees were ultimately terminated.</p>
                    
                    <p>But here's the crucial question: <strong>If attackers were actively using stolen data to target customers in January, when did the actual breach occur? And when did Coinbase first become aware that something was wrong?</strong></p>

                    <hr>

                    <h2>What I Reported to Coinbase</h2>
                    
                    <p>On January 7, 2025, immediately after recognizing the attack, I sent a comprehensive security report to Coinbase's security team. This wasn't a vague complaint—it was a detailed technical analysis that should have raised immediate red flags about a data breach.</p>
                    
                    <p><strong>My report included:</strong></p>
                    
                    <ul>
                            <li><strong>Full email headers:</strong> Complete technical headers showing the email was routed through Amazon SES (a32-86.smtp-out.amazonses.com), not Coinbase's own mail servers, despite appearing to come from commerce@coinbase.com</li>
                            
                            <li><strong>DKIM signature analysis:</strong> Documentation that while the email passed DKIM validation for both coinbase.com and amazonses.com, the actual sending infrastructure was suspicious</li>
                            
                            <li><strong>The phishing email content:</strong> The complete HTML email with its fake "suspicious activity" warning and fraudulent transaction details (Order N54HJG3V, 2.93 ETH withdrawal)</li>
                            
                            <li><strong>Phone number used:</strong> 1-805-885-0141 (later confirmed to be a Google Voice number)</li>
                            
                            <li><strong>Voice recording:</strong> An audio recording of my second call with the scammer, capturing the entire conversation where she demonstrated knowledge of my personal information</li>
                            
                            <li><strong>Specific data the attacker possessed:</strong> A detailed list of what the scammer knew, including:
                                <ul>
                                    <li>My Social Security number</li>
                                    <li>My exact Bitcoin balance</li>
                                    <li>My account signup date</li>
                                    <li>Driver's license information</li>
                                    <li>The amount of the fabricated "suspicious transfer"</li>
                                </ul>
                            </li>
                            
                            <li><strong>Attack methodology:</strong> Description of their social engineering tactics, including the attempt to get me to move funds to "a cold wallet" by downloading Coinbase Wallet</li>
                            
                            <li><strong>Red flags I identified:</strong> The inability of the caller to authenticate herself, the Google Voice callback number, the lack of any notifications in my actual Coinbase account</li>
                            
                            <li><strong>Post-call SMS flooding:</strong> Documentation that immediately after the call, I received hundreds of spam text messages for random service signups—a potential attempt to hide legitimate 2FA codes or security alerts in the noise</li>
                    </ul>
                    
                    <p>This wasn't a typical phishing report. <strong>I specifically highlighted that the attacker had access to non-public account information that should have been impossible to obtain without either a device compromise on my end or a data breach at Coinbase.</strong></p>
                    
                    <p>Brett Farmer, Coinbase's Head of Trust &amp; Safety, responded the same day, calling it a "super robust" report that gave them "a lot to look into."</p>
                    
                    <p>But when I followed up six days later with the key question—<em>"How did the attacker know the balance of my bitcoin holdings?"</em>—the conversation ended. That question, which should have immediately triggered an internal investigation into potential data compromise, was never answered.</p>

                    <hr>

                    <h2>The Attack: A Perfect Impersonation</h2>
                    
                    <p>The sophistication of this attack cannot be overstated. Let me walk you through what made it so convincing—and what ultimately saved me.</p>
                    
                    <h3>The Email: Remarkably Convincing</h3>
                    
                    <p>The phishing email I received looked completely legitimate at first glance:</p>
                    
                    <ul>
                        <li><strong>From:</strong> Coinbase Commerce &lt;commerce@coinbase.com&gt;</li>
                        <li><strong>DKIM signatures:</strong> Passed validation for both coinbase.com and amazonses.com</li>
                        <li><strong>Professional formatting:</strong> Perfect HTML layout, correct branding, legitimate-looking transaction details</li>
                        <li><strong>Convincing narrative:</strong> "We detected suspicious activity on your account. A fraud prevention representative will be in touch shortly..."</li>
                    </ul>
                    
                    <p>The email even included what appeared to be a verification code (96841) and assigned me a specific case agent ("Sarah Schueler"). This level of detail gave it tremendous credibility.</p>
                    
                    <h3>The Critical Red Flag: Amazon SES</h3>
                    
                    <p>But when I examined the email headers more carefully, I found something suspicious:</p>
                    
                    <pre>Received: from a32-86.smtp-out.amazonses.com (a32-86.smtp-out.amazonses.com. [54.240.32.86])
Return-Path: &lt;01000194436f122c-535a7ce0-f493-41c2-b966-dcaa1a9e6b57-000000@amazonses.com&gt;
                    </pre>
                    
                    <p>The email was sent through <strong>Amazon SES (Simple Email Service)</strong>, not Coinbase's own servers. While Coinbase might use Amazon infrastructure, this raised my suspicion. A legitimate security-critical email about fraud should come through more controlled channels.</p>

                    <h3>The Phone Call: Even More Convincing (And Recorded)</h3>
                    
                    <p>When the woman called me, she was professional, intelligent, and sounded exactly like a legitimate customer service representative. She had information that seemed impossible for a scammer to possess:</p>
                    
                    <ul>
                        <li>My exact Bitcoin balance</li>
                        <li>My account signup date</li>
                        <li>My driver's license details</li>
                        <li>My Social Security number</li>
                        <li>The amount of the "suspicious transfer" (2.93 ETH)</li>
                    </ul>
                    
                    <p>During our conversation, I asked her to authenticate herself. Here's where things got interesting.</p>

                    <hr>

                    <h2>How I Detected It Was a Scam</h2>
                    
                    <p>Despite the sophistication of the attack, several red flags eventually convinced me this was fraudulent:</p>
                    
                    <h3>Red Flag #1: The Authentication Problem</h3>
                    
                    <p>I asked the caller to prove she was from Coinbase. She offered to read me my personal information—but I already knew she had that information. That's not authentication; that's just proving she has stolen data.</p>
                    
                    <p>When I suggested she send me an email from a verified Coinbase address that I could reply to, she claimed she didn't have access to personal email addresses and could only use generic support channels. <strong>A fraud prevention specialist without the ability to send verified emails? That didn't add up.</strong></p>
                    
                    <h3>Red Flag #2: The Callback Issue</h3>
                    
                    <p>When I asked if I could call her back, she said I couldn't reach her because she was "in the fraud department." After the call, I tried calling the number back: <strong>it was a Google Voice number.</strong></p>
                    
                    <p>Legitimate financial institutions always provide callback numbers that route to their main systems. A Google Voice number is a massive red flag.</p>
                    
                    <h3>Red Flag #3: Email Verification Confusion</h3>
                    
                    <p>When I challenged the authenticity of the email sender, the caller insisted that Amazon was just Coinbase's "service provider" and that the DKIM signatures proved legitimacy. But when pressed, she couldn't explain away the anomalies in a satisfactory way.</p>
                    
                    <p>The conversation on the recorded call shows my growing skepticism:</p>
                    
                    <blockquote>
                        <p><strong>Me:</strong> "I don't think there is enough information provided for me to authenticate you."</p>
                        <p><strong>Caller:</strong> "I'm not sure what you would like me to do..."</p>
                        <p><strong>Me:</strong> "There are just too many red flags."</p>
                    </blockquote>
                    
                    <h3>Red Flag #4: No Notifications in My Account</h3>
                    
                    <p>After the call, I logged into my actual Coinbase account. There were:</p>
                    <ul>
                        <li>No notifications about the alleged transfer</li>
                        <li>No new login attempts</li>
                        <li>No new authorized devices</li>
                        <li>No actual transaction matching what the caller described</li>
                    </ul>
                    
                    <p>If this were real, there would have been notifications everywhere.</p>
                    
                    <h3>Red Flag #5: The Pressure to Use Coinbase Wallet</h3>
                    
                    <p>The caller wanted me to move my cryptocurrency to "a cold wallet" and started walking me through downloading Coinbase Wallet. <strong>This is a classic social engineering tactic—get the victim to move funds to an address controlled by the attacker.</strong></p>
                    
                    <p>I didn't follow through, so I never discovered exactly how they planned to steal the funds, but the intent was clear.</p>

                    <hr>

                    <h2>The SMS Flooding Attack: A Sinister Twist</h2>
                    
                    <p>Here's where things got even more concerning. Immediately after I ended the call with the scammer, <strong>my phone was bombarded with hundreds of text messages—random service signups, verification codes, newsletters, everything imaginable.</strong></p>
                    
                    <p>At first, I thought this was just a vindictive "FU" from the scammer. But the timing and volume suggest something more calculated: <strong>SMS flooding is a known technique to hide legitimate security alerts in noise.</strong></p>
                    
                    <p>The attack works like this:</p>
                    <ol>
                        <li>Scammer floods your phone with spam texts</li>
                        <li>While you're overwhelmed, they attempt account takeovers on various services</li>
                        <li>Real 2FA codes and security alerts get buried in the flood</li>
                        <li>You miss the critical warnings because they're hidden among hundreds of spam messages</li>
                    </ol>
                    
                    <p>This could have been an attempt to:</p>
                    <ul>
                        <li>Hijack my SMS-based two-factor authentication</li>
                        <li>Hide real alerts from Coinbase or other services</li>
                        <li>Overwhelm me while they attempted unauthorized access to various accounts</li>
                        <li>Create confusion and distract from their next moves</li>
                    </ul>
                    
                    <p><strong>This wasn't just a phishing call—it was a coordinated, multi-vector attack.</strong></p>

                    <hr>

                    <h2>What Coinbase Got Wrong</h2>
                    
                    <p>Coinbase's handling of this breach raises serious questions:</p>
                    
                    <h3>1. Outsourcing Security-Sensitive Roles</h3>
                    
                    <p>Customer support agents at third-party contractors had access to extremely sensitive data: Social Security numbers, account balances, transaction histories, and personal documents. <strong>Why were overseas contractors given such privileged access?</strong></p>
                    
                    <p>The economics of the bribery scheme tell the story: attackers likely paid relatively small amounts to contractors earning modest wages to access data they then used to attempt thefts worth potentially millions.</p>
                    
                    <h3>2. Failed Detection Systems</h3>
                    
                    <p>Coinbase claims they "discovered" the breach on May 11, 2025, when attackers attempted to extort $20 million. But my case—and likely many others—proves the breach was being actively exploited months earlier.</p>
                    
                    <p><strong>What monitoring systems failed to detect that customer data was being used in sophisticated phishing attacks?</strong> I reported this in January with specific details about how the attacker knew my information. That report should have triggered alarm bells.</p>
                    
                    <h3>3. Inadequate Response to User Reports</h3>
                    
                    <p>On January 7, 2025, I submitted a detailed security report to Coinbase. Brett Farmer, Head of Trust &amp; Safety, responded on January 7:</p>
                    
                    <blockquote>
                        <p>"Hey Jonathan, I just wanted to send a personal note and thank you for this information. This report is super robust and gives us a lot to look into. We are investigating this scammer now."</p>
                    </blockquote>
                    
                    <p>But when I followed up with the critical question—"How did the attacker know the balance of my bitcoin holdings?"—my subsequent emails went unanswered:</p>
                    
                    <ul>
                        <li>January 13: "Do you have any updates on this incident?"</li>
                        <li>January 17: "Could I please get a reply on my question below?"</li>
                        <li>January 22: "Could I please get an update to my question as to how the attacker was able to determine my coinbase bitcoin balance?"</li>
                        <li>January 29: "Could I please get a response?"</li>
                    </ul>
                    
                    <p><strong>My question was specific and technical. It went to the heart of what should have been a massive red flag: How did attackers have access to non-public account data?</strong></p>
                    
                    <p>Had Coinbase investigated this seriously in January, they might have discovered the insider threat months earlier and prevented additional victims.</p>
                    
                    <h3>4. The Disclosure Timeline</h3>
                    
                    <p>Coinbase says they "became aware" of the breach on May 11, 2025. But my January attack proves the breach was active at least four months earlier. This raises uncomfortable questions:</p>
                    
                    <ul>
                        <li>When did the actual data exfiltration occur? Late 2024?</li>
                        <li>How many other victims reported similar attacks between January and May?</li>
                        <li>Were those reports properly escalated and investigated?</li>
                        <li>Would Coinbase have disclosed the breach if not for the extortion attempt?</li>
                    </ul>

                    <hr>

                    <h2>Lessons Learned: How to Protect Yourself</h2>
                    
                    <p>The sad reality is that when a major platform gets breached, your personal information may already be in attackers' hands. But you can still protect yourself from falling victim to the scams that follow:</p>
                    
                    <h3>1. Never Trust Caller ID</h3>
                    
                    <p>Phone numbers can be spoofed. Even if the caller ID shows a legitimate company, don't trust it. Always hang up and call back using a number you independently verify (from the company's official website, not from the email or caller).</p>
                    
                    <p><strong>Pro tip:</strong> Ask the caller for their callback number, then look up that number online before calling it back. Search for "[phone number] scam" or "[phone number] reviews" to see if others have reported it as fraudulent. In my case, when I called back the number the scammer gave me (1-805-885-0141), it turned out to be a Google Voice number—an instant red flag. Legitimate corporate support lines won't use Google Voice.</p>
                    
                    <h3>2. Understand That Scammers May Have Your Personal Info</h3>
                    
                    <p>In the age of massive data breaches, assume attackers may know:</p>
                    <ul>
                        <li>Your name, address, phone number, email</li>
                        <li>Last 4 digits of your SSN</li>
                        <li>Your account balances and transaction history</li>
                        <li>Other "secret" information you thought was secure</li>
                    </ul>
                    
                    <p><strong>Just because someone knows this information doesn't mean they're legitimate.</strong> Authentication needs to work both ways.</p>
                    
                    <h3>3. Verify Email Headers</h3>
                    
                    <p>Learn to check email headers. Look for:</p>
                    <ul>
                        <li>The actual sending server (not just the "From" address)</li>
                        <li>SPF, DKIM, and DMARC validation results</li>
                        <li>Unusual routing or relay servers</li>
                    </ul>
                    
                    <p>In my case, the Amazon SES sending address was the tip-off, even though DKIM signatures technically validated.</p>
                    
                    <p><strong>Pro tip:</strong> If you're not sure how to interpret email headers, copy the full headers and paste them into a good AI assistant (like ChatGPT or Claude) and ask: "Analyze these email headers and tell me if there are any red flags or signs this could be a phishing email." AI tools are excellent at spotting anomalies in technical data like email routing.</p>
                    
                    <h3>4. Demand Proper Authentication</h3>
                    
                    <p>If someone calls claiming to be from your bank, exchange, or other financial institution, <strong>they should be able to authenticate themselves to you, not just read back information they already have.</strong></p>
                    
                    <p>Legitimate companies can:</p>
                    <ul>
                        <li>Send you emails from verified domain addresses you can reply to</li>
                        <li>Provide callback numbers that route through their main system</li>
                        <li>Verify their identity through the app or website you're already logged into</li>
                    </ul>
                    
                    <h3>5. Check Your Account Directly</h3>
                    
                    <p>If someone alerts you to suspicious activity, don't trust the email or call. Open a browser, type in the company's URL directly (don't click links), log in, and check for yourself. If there's really a problem, it will show up in your account.</p>
                    
                    <h3>6. Never Move Funds Under Pressure</h3>
                    
                    <p>Legitimate companies will never pressure you to immediately move your funds, download software, or take urgent action to "protect" your account. <strong>That pressure is the scam.</strong></p>
                    
                    <h3>7. Use App-Based or Hardware 2FA, Not SMS</h3>
                    
                    <p>My experience with SMS flooding shows why SMS-based two-factor authentication is vulnerable. Use:</p>
                    <ul>
                        <li>Hardware security keys (YubiKey, Titan)</li>
                        <li>Authenticator apps (Google Authenticator, Authy)</li>
                        <li>Platform-specific authentication (like Coinbase's app-based approval)</li>
                    </ul>
                    
                    <p>SMS can be hijacked, flooded, or intercepted.</p>
                    
                    <h3>8. Report Everything</h3>
                    
                    <p>If you're targeted by a sophisticated attack, report it immediately and provide as much detail as possible:</p>
                    <ul>
                        <li>Full email headers</li>
                        <li>Phone numbers used</li>
                        <li>Specific information the attacker knew</li>
                        <li>Recording of calls if possible (check your local laws)</li>
                    </ul>
                    
                    <p>Your report might be the data point that helps the company detect a breach.</p>

                    <hr>

                    <h2>The Bigger Picture</h2>
                    
                    <p>My case represents just one data point in what appears to be a months-long campaign of attacks enabled by the Coinbase breach. How many other customers were targeted between January and May? How many fell for these scams because they didn't catch the red flags I did?</p>
                    
                    <p>Coinbase has committed to reimbursing customers who were defrauded. But the $180-400 million estimated cost of this breach doesn't just represent reimbursements—it represents the human cost of trust betrayed, security compromised, and warnings ignored.</p>
                    
                    <p>The cryptocurrency industry promises decentralization and security, but incidents like this expose the risks of centralized custody. When you trust an exchange with your assets and personal information, you're trusting their security practices, their contractor oversight, and their incident response capabilities.</p>
                    
                    <p>In this case, that trust was misplaced.</p>

                    <hr>

                    <h2>Unanswered Questions</h2>
                    
                    <p>Four months after my attack, and several months after Coinbase's disclosure, key questions remain:</p>
                    
                    <ol>
                        <li><strong>When did the actual breach occur?</strong> My January attack suggests late 2024 at the latest.</li>
                        
                        <li><strong>How many customers were targeted before May 2025?</strong> Am I one of dozens? Hundreds? Thousands?</li>
                        
                        <li><strong>What happened to the user reports filed between January and May?</strong> Were they properly investigated and escalated?</li>
                        
                        <li><strong>Why wasn't the connection made between user reports of sophisticated phishing and a potential data breach?</strong></li>
                        
                        <li><strong>What specific access controls failed that allowed overseas contractors to exfiltrate sensitive data?</strong></li>
                        
                        <li><strong>Will there be regulatory consequences for the delayed disclosure?</strong> SEC rules require timely reporting of material cybersecurity incidents.</li>
                        
                        <li><strong>How can users trust that the security improvements Coinbase claims to have made are actually effective?</strong></li>
                    </ol>

                    <hr>

                    <h2>Conclusion: The Timeline Matters</h2>
                    
                    <p>The discrepancy between my January attack and Coinbase's May disclosure isn't just an interesting footnote—it's a critical part of understanding what went wrong and who bears responsibility.</p>
                    
                    <p>My emails, timestamped and documented, prove that:</p>
                    <ul>
                        <li>The breach was being actively exploited months before Coinbase's "discovery"</li>
                        <li>A customer reported detailed evidence of the attack and asked specific questions about data compromise</li>
                        <li>Those questions went unanswered for months</li>
                        <li>The breach was only disclosed after attackers attempted extortion</li>
                    </ul>
                    
                    <p><strong>I was one of the lucky ones—I detected the scam and didn't lose funds. But how many others weren't so fortunate during those four months of silence?</strong></p>
                    
                    <p>Coinbase's Head of Trust &amp; Safety called my initial report "super robust" and said it gave them "a lot to look into." But when I asked the one question that mattered most—how did the attacker have my data?—the company went silent.</p>
                    
                    <p>That silence lasted 120 days.</p>
                    
                    <p>And that's the real story behind the $400 million breach.</p>

                    <hr>

                    <hr>

                    
                </article></div>]]></description>
        </item>
        <item>
            <title><![CDATA[62 chapter open-source Zig book (681 pts)]]></title>
            <link>https://www.zigbook.net</link>
            <guid>45947810</guid>
            <pubDate>Sun, 16 Nov 2025 19:44:27 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.zigbook.net">https://www.zigbook.net</a>, See on <a href="https://news.ycombinator.com/item?id=45947810">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><div><div><p><img alt="Zig Logo" loading="lazy" width="240" height="240" decoding="async" data-nimg="1" src="https://www.zigbook.net/assets/zig-logo-light.svg"></p></div><div><h2>Learning Zig is not just about adding a language to your resume.</h2><p>It is about fundamentally changing how you think about software.</p></div><div><p>“You came for syntax.</p><p>You'll leave with a philosophy.”</p></div><p>61 chapters • Project-based • Zero AI • Written by @zigbook</p></div><div><div><div><p>zsh — zigbook.net</p></div><div><p>Welcome to Zigbook 🦎</p><p>Ready to transform how you think about software?</p><p>Exec: zig build zigbook</p><p><span>zigbook %</span><span>$ </span><span></span><span></span></p></div></div><div><p><span></span><span>Interactive terminal • Type to get started</span></p></div></div></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Tracking users with favicons, even in incognito mode (346 pts)]]></title>
            <link>https://github.com/jonasstrehle/supercookie</link>
            <guid>45947770</guid>
            <pubDate>Sun, 16 Nov 2025 19:39:52 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/jonasstrehle/supercookie">https://github.com/jonasstrehle/supercookie</a>, See on <a href="https://news.ycombinator.com/item?id=45947770">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto">
  <a href="https://supercookie.me/" rel="nofollow">
    <img src="https://camo.githubusercontent.com/272799d3dd981f0335a930bb7fdd97a41e4fc62c9187d81554e75eaf36a1454b/687474703a2f2f7375706572636f6f6b69652e6d652f66617669636f6e2e69636f" alt="supercookie" width="100" data-canonical-src="http://supercookie.me/favicon.ico">
  </a>
</p>
<p dir="auto">
  <a href="https://supercookie.me/workwise" rel="nofollow">
    <img src="https://camo.githubusercontent.com/67ee1d2e8c25f7351ef75ee2d8216e9c291a9a05fb1e704f6dcba15b304e9591/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f446f63732d7375706572636f6f6b69652e6d652d626c7565" alt="Documentation" data-canonical-src="https://img.shields.io/badge/Docs-supercookie.me-blue">
  </a>
</p>
<p dir="auto">
  <a href="https://supercookie.me/" rel="nofollow">
    <img src="https://camo.githubusercontent.com/4cb18353ec402c26cf260f19f13b6efa92ac311d6bb8ca84c9c24d8d6212bc79/68747470733a2f2f696d672e736869656c64732e696f2f776562736974653f646f776e5f6d6573736167653d646f776e2675705f636f6c6f723d677265656e2675705f6d6573736167653d6f6e6c696e652675726c3d68747470732533412532462532467375706572636f6f6b69652e6d65" alt="Website Status" data-canonical-src="https://img.shields.io/website?down_message=down&amp;up_color=green&amp;up_message=online&amp;url=https%3A%2F%2Fsupercookie.me">
  </a>
  <a href="https://github.com/jonasstrehle/supercookie">
    <img src="https://camo.githubusercontent.com/a9e94c5827d8c06fb55a38a8f40c576b49c700abbf9e6d891bb9bb9363c21e17/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6963656e73652f6a6f6e617373747265686c652f7375706572636f6f6b6965" alt="License" data-canonical-src="https://img.shields.io/github/license/jonasstrehle/supercookie">
  </a>
</p>
<p dir="auto">
  <a href="https://supercookie.me/" rel="nofollow">
    <img src="https://camo.githubusercontent.com/eaca07141f165dcac60511c41ebac7b86b98b5bc283de0edbb64fb8925b93e7f/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f64796e616d69632f6a736f6e3f6c6162656c3d46696e6765727072696e74732671756572793d696e6465782675726c3d68747470733a2f2f7375706572636f6f6b69652e6d652f61706926636f6c6f723d79656c6c6f77" alt="Fingerprint index" data-canonical-src="https://img.shields.io/badge/dynamic/json?label=Fingerprints&amp;query=index&amp;url=https://supercookie.me/api&amp;color=yellow">
  </a>
  <a href="https://supercookie.me/" rel="nofollow">
    <img src="https://camo.githubusercontent.com/4cf682487e2cfda7f137cd5530457eb3423a8cd14da04558b1f9687af527dbee/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f64796e616d69632f6a736f6e3f6c6162656c3d43757272656e742532307265646972656374732671756572793d626974732675726c3d68747470733a2f2f7375706572636f6f6b69652e6d652f61706926636f6c6f723d79656c6c6f77" alt="N Redirects" data-canonical-src="https://img.shields.io/badge/dynamic/json?label=Current%20redirects&amp;query=bits&amp;url=https://supercookie.me/api&amp;color=yellow">
  </a>
</p>
<p dir="auto"><strong>Supercookie</strong> uses favicons to assign a unique identifier to website visitors.<br>
Unlike traditional tracking methods, this ID can be stored almost persistently and cannot be easily cleared by the user.</p>
<p dir="auto">The tracking method works even in the browser's incognito mode and is not cleared by flushing the cache, closing the browser or restarting the operating system, using a VPN or installing AdBlockers. 🍿 <a href="https://supercookie.me/" rel="nofollow">Live demo</a>.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">About</h2><a id="user-content-about" aria-label="Permalink: About" href="#about"></a></p>
<p dir="auto"><h3 tabindex="-1" dir="auto">💭 Inspiration</h3><a id="user-content--inspiration" aria-label="Permalink: 💭 Inspiration" href="#-inspiration"></a></p>
<ul dir="auto">
<li>Paper by Scientists at University of Illinois, Chicago: <a href="https://www.cs.uic.edu/~polakis/papers/solomos-ndss21.pdf" rel="nofollow">www.cs.uic.edu</a></li>
<li>Article by heise: <a href="https://heise.de/-5027814" rel="nofollow">heise.de</a></li>
</ul>
<p dir="auto"><h3 tabindex="-1" dir="auto">🌱 Purpose</h3><a id="user-content--purpose" aria-label="Permalink: 🌱 Purpose" href="#-purpose"></a></p>
<p dir="auto">This repository is for <strong>educational</strong> and <strong>demonstration purposes</strong> only!</p>
<p dir="auto">The demo of "supercookie" as well as the publication of the source code of this repository is intended to draw attention to the problem of tracking possibilities using favicons.</p>
<p dir="auto">📕 <a href="https://supercookie.me/workwise" rel="nofollow">Full documentation</a></p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Installation</h2><a id="user-content-installation" aria-label="Permalink: Installation" href="#installation"></a></p>
<p dir="auto"><h3 tabindex="-1" dir="auto">🔧 Docker</h3><a id="user-content--docker" aria-label="Permalink: 🔧 Docker" href="#-docker"></a></p>
<p dir="auto"><strong>requirements</strong>:
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/3ac73afa62552f6bcf98b1268be81caf0c30941316ba690664ae87980e16048f/68747470733a2f2f7777772e646f636b65722e636f6d2f77702d636f6e74656e742f75706c6f6164732f323032322f30332f766572746963616c2d6c6f676f2d6d6f6e6f6368726f6d617469632e706e67"><img src="https://camo.githubusercontent.com/3ac73afa62552f6bcf98b1268be81caf0c30941316ba690664ae87980e16048f/68747470733a2f2f7777772e646f636b65722e636f6d2f77702d636f6e74656e742f75706c6f6164732f323032322f30332f766572746963616c2d6c6f676f2d6d6f6e6f6368726f6d617469632e706e67" width="12" data-canonical-src="https://www.docker.com/wp-content/uploads/2022/03/vertical-logo-monochromatic.png"></a> <a href="https://docs.docker.com/get-docker/" rel="nofollow">Docker daemon</a></p>
<ol dir="auto">
<li>Clone repository</li>
</ol>
<div dir="auto" data-snippet-clipboard-copy-content="git clone https://github.com/jonasstrehle/supercookie"><pre>git clone https://github.com/jonasstrehle/supercookie</pre></div>
<ol start="2" dir="auto">
<li>Update .env file in <a href="https://github.com/jonasstrehle/supercookie/blob/main/server/.env">supercookie/server/.env</a></li>
</ol>
<div dir="auto" data-snippet-clipboard-copy-content="HOST_MAIN=yourdomain.com #or localhost:10080
PORT_MAIN=10080

HOST_DEMO=demo.yourdomain.com #or localhost:10081
PORT_DEMO=10081"><pre><span>HOST_MAIN</span><span>=</span><span>yourdomain.com</span> <span><span>#</span>or localhost:10080</span>
<span>PORT_MAIN</span><span>=</span><span>10080</span>

<span>HOST_DEMO</span><span>=</span><span>demo.yourdomain.com</span> <span><span>#</span>or localhost:10081</span>
<span>PORT_DEMO</span><span>=</span><span>10081</span></pre></div>
<ol start="3" dir="auto">
<li>Run container</li>
</ol>
<div dir="auto" data-snippet-clipboard-copy-content="cd supercookie/server
docker-compose up"><pre><span>cd</span> supercookie/server
docker-compose up</pre></div>
<p dir="auto">-&gt; Webserver will be running at <a href="https://yourdomain.com/" rel="nofollow">https://yourdomain.com</a></p>
<p dir="auto"><h3 tabindex="-1" dir="auto">🤖 Local machine</h3><a id="user-content--local-machine" aria-label="Permalink: 🤖 Local machine" href="#-local-machine"></a></p>
<p dir="auto"><strong>requirements</strong>:
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/979a8a431325fa2bc0e18d3e2a5789eee129e50c7dcef08137aece8757fd39c6/68747470733a2f2f7365656b6c6f676f2e636f6d2f696d616765732f4e2f6e6f64656a732d6c6f676f2d464245313232453337372d7365656b6c6f676f2e636f6d2e706e67"><img src="https://camo.githubusercontent.com/979a8a431325fa2bc0e18d3e2a5789eee129e50c7dcef08137aece8757fd39c6/68747470733a2f2f7365656b6c6f676f2e636f6d2f696d616765732f4e2f6e6f64656a732d6c6f676f2d464245313232453337372d7365656b6c6f676f2e636f6d2e706e67" width="12" data-canonical-src="https://seeklogo.com/images/N/nodejs-logo-FBE122E377-seeklogo.com.png"></a> <a href="https://nodejs.org/" rel="nofollow">Node.js</a></p>
<ol dir="auto">
<li>Clone repository</li>
</ol>
<div dir="auto" data-snippet-clipboard-copy-content="git clone https://github.com/jonasstrehle/supercookie"><pre>git clone https://github.com/jonasstrehle/supercookie</pre></div>
<ol start="2" dir="auto">
<li>Update .env file in <a href="https://github.com/jonasstrehle/supercookie/blob/main/server/.env">supercookie/server/.env</a></li>
</ol>
<div dir="auto" data-snippet-clipboard-copy-content="HOST_MAIN=localhost:10080
PORT_MAIN=10080

HOST_DEMO=localhost:10081
PORT_DEMO=10081"><pre><span>HOST_MAIN</span><span>=</span><span>localhost:10080</span>
<span>PORT_MAIN</span><span>=</span><span>10080</span>

<span>HOST_DEMO</span><span>=</span><span>localhost:10081</span>
<span>PORT_DEMO</span><span>=</span><span>10081</span></pre></div>
<ol start="3" dir="auto">
<li>Run service</li>
</ol>
<div dir="auto" data-snippet-clipboard-copy-content="cd supercookie/server
node --experimental-json-modules main.js"><pre><span>cd</span> supercookie/server
node --experimental-json-modules main.js</pre></div>
<p dir="auto">-&gt; Webserver will be running at <a href="http://localhost:10080/" rel="nofollow">http://localhost:10080</a></p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Workwise of <a href="https://supercookie.me/workwise" rel="nofollow">supercookie</a></h2><a id="user-content-workwise-of-supercookie" aria-label="Permalink: Workwise of supercookie" href="#workwise-of-supercookie"></a></p>
<p dir="auto"><h3 tabindex="-1" dir="auto"><a href="https://supercookie.me/workwise#content-background" rel="nofollow">📖 Background</a></h3><a id="user-content--background" aria-label="Permalink: 📖 Background" href="#-background"></a></p>
<p dir="auto">Modern browsers offer a wide range of features to improve and simplify the user experience.
One of these features are the so-called favicons: A favicon is a small (usually 16×16 or 32×32 pixels) logo used by web browsers to brand a website in a recognizable way. Favicons are usually shown by most browsers in the address bar and next to the page's name in a list of bookmarks.</p>
<p dir="auto">To serve a favicon on their website, a developer has to include an  attribute in the webpage’s header. If this tag does exist, the browser requests the icon from the predefined source and if the server response contains an valid icon file that can be properly rendered this icon is displayed by the browser. In any other case, a blank favicon is shown.</p>
<div dir="auto" data-snippet-clipboard-copy-content="<link rel=&quot;icon&quot; href=&quot;/favicon.ico&quot; type=&quot;image/x-icon&quot;>"><pre><span>&lt;</span><span>link</span> <span>rel</span>="<span>icon</span>" <span>href</span>="<span>/favicon.ico</span>" <span>type</span>="<span>image/x-icon</span>"<span>&gt;</span></pre></div>
<p dir="auto">The favicons must be made very easily accessible by the browser. Therefore, they are cached in a separate local database on the system, called the favicon cache (F-Cache). A F-Cache data entries includes the visited URL (subdomain, domain, route, URL paramter), the favicon ID and the time to live (TTL).
While this provides web developers the ability to delineate parts of their website using a wide variety of icons for individual routes and subdomains, it also leads to a possible tracking scenario.</p>
<p dir="auto">When a user visits a website, the browser checks if a favicon is needed by looking up the source of the shortcut icon link reference of the requested webpage.
The browser initialy checks the local F-cache for an entry containing the URL of the active website. If a favicon entry exists, the icon will be loaded from the cache and then displayed. However, if there is no entry, for example because no favicon has ever been loaded under this particular domain, or the data in the cache is out of date, the browser makes a GET request to the server to load the site's favicon.</p>
<p dir="auto"><h3 tabindex="-1" dir="auto"><a href="https://supercookie.me/workwise#content-threat-model" rel="nofollow">💣 Threat Model</a></h3><a id="user-content--threat-model" aria-label="Permalink: 💣 Threat Model" href="#-threat-model"></a></p>
<p dir="auto">In the article a possible threat model is explained that allows to assign a unique identifier to each browser in order to draw conclusions about the user and to be able to identify this user even in case of applied anti-fingerprint measures, such as the use of a VPN, deletion of cookies, deletion of the browser cache or manipulation of the client header information.</p>
<p dir="auto">A web server can draw conclusions about whether a browser has already loaded a favicon or not:
So when the browser requests a web page, if the favicon is not in the local F-cache, another request for the favicon is made. If the icon already exists in the F-Cache, no further request is sent.
By combining the state of delivered and not delivered favicons for specific URL paths for a browser, a unique pattern (identification number) can be assigned to the client.
When the website is reloaded, the web server can reconstruct the identification number with the network requests sent by the client for the missing favicons and thus identify the browser.</p>
<p dir="auto">
  <a href="https://supercookie.me/" rel="nofollow">
    <img src="https://camo.githubusercontent.com/040dbe51ecaea7c0782054f0d65b9bef438e87d452ce9ba7a0cbe6547afc5719/68747470733a2f2f7375706572636f6f6b69652e6d652f6173736574732f6865616465722e706e67" alt="Supercookie Header" width="600" data-canonical-src="https://supercookie.me/assets/header.png">
  </a>
</p>
<markdown-accessiblity-table><table>
  <thead>
    <tr>
      <th></th>
      <th><a target="_blank" rel="noopener noreferrer" href=""></a> <p dir="auto">conventional cookies</p></th>
      <th><a target="_blank" rel="noopener noreferrer" href=""></a> <p dir="auto">supercookie</p></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Identification accuracy</td>
      <td>-</td>
      <td>100%</td>
    </tr>
    <tr>
      <td>Incognito / Private mode detection</td>
      <td>❌</td>
      <td>✅</td>
    </tr>
    <tr>
      <td>Persistent after flushed website cache and cookies</td>
      <td>❌</td>
      <td>✅</td>
    </tr>
    <tr>
      <td>Identify multiple windows</td>
      <td>❌</td>
      <td>✅</td>
    </tr>
    <tr>
      <td>Working with Anti-Tracking SW</td>
      <td>❌</td>
      <td>✅</td>
    </tr>
  </tbody>
</table></markdown-accessiblity-table>
<p dir="auto"><h3 tabindex="-1" dir="auto"><a href="https://supercookie.me/workwise#content-target" rel="nofollow">🎯 Target</a></h3><a id="user-content--target" aria-label="Permalink: 🎯 Target" href="#-target"></a></p>
<p dir="auto">It looks like all top browsers (<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/4118d0bdf482abbf0c219ab6bdc1c2c321ce8f19882f9e88948b766ba08f36c5/68747470733a2f2f7777772e676f6f676c652e636f6d2f66617669636f6e2e69636f"><img src="https://camo.githubusercontent.com/4118d0bdf482abbf0c219ab6bdc1c2c321ce8f19882f9e88948b766ba08f36c5/68747470733a2f2f7777772e676f6f676c652e636f6d2f66617669636f6e2e69636f" width="12" data-canonical-src="https://www.google.com/favicon.ico"></a> <a href="https://google.com/chrome/" rel="nofollow">Chrome</a>, <a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/98ad4c97f64d82aa53fe071b035536ac4ab97ec3cd9be6021157634debea749d/68747470733a2f2f7777772e6d6f7a696c6c612e6f72672f66617669636f6e2e69636f"><img src="https://camo.githubusercontent.com/98ad4c97f64d82aa53fe071b035536ac4ab97ec3cd9be6021157634debea749d/68747470733a2f2f7777772e6d6f7a696c6c612e6f72672f66617669636f6e2e69636f" width="12" data-canonical-src="https://www.mozilla.org/favicon.ico"></a> <a href="https://www.mozilla.org/en-US/firefox/new/" rel="nofollow">Firefox</a>, <a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/672c5caa1e356588e7fcfa0c0b5a0cc3dee7df44f3b71d30010560acd737aec0/68747470733a2f2f7777772e6170706c652e636f6d2f66617669636f6e2e69636f"><img src="https://camo.githubusercontent.com/672c5caa1e356588e7fcfa0c0b5a0cc3dee7df44f3b71d30010560acd737aec0/68747470733a2f2f7777772e6170706c652e636f6d2f66617669636f6e2e69636f" width="12" data-canonical-src="https://www.apple.com/favicon.ico"></a> <a href="https://www.apple.com/safari/" rel="nofollow">Safari</a>, <a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/2ba225a9c34297fd64a7ba7397891e7c50c8ca7211fc9018943aacb2a953ec25/68747470733a2f2f7777772e6d6963726f736f66742e636f6d2f66617669636f6e2e69636f"><img src="https://camo.githubusercontent.com/2ba225a9c34297fd64a7ba7397891e7c50c8ca7211fc9018943aacb2a953ec25/68747470733a2f2f7777772e6d6963726f736f66742e636f6d2f66617669636f6e2e69636f" width="12" data-canonical-src="https://www.microsoft.com/favicon.ico"></a> <a href="https://www.microsoft.com/edge/" rel="nofollow">Edge</a>) are vulnerable to this attack scenario.<br>
Mobile browsers are also affected.</p>
<p dir="auto"><h4 tabindex="-1" dir="auto">Current versions</h4><a id="user-content-current-versions" aria-label="Permalink: Current versions" href="#current-versions"></a></p>
<markdown-accessiblity-table><table>
  <thead>
    <tr>
      <th><p dir="auto">Browser</p></th>
      <th><p dir="auto">Windows</p></th>
      <th><p dir="auto">MacOS</p></th>
      <th><p dir="auto">Linux</p></th>
      <th><p dir="auto">iOS</p></th>
      <th><p dir="auto">Android</p></th>
      <th><i>Info</i></th>
    </tr>
  </thead>
  <tbody>
    <tr>
        <td>Chrome <em>(v 111.0)</em></td>
        <td>✅</td>
        <td>✅</td>
        <td>✅</td>
        <td>?</td>
        <td>✅</td>
        <td>-</td>
    </tr>
    <tr>
        <td>Safari <em>(v 14.0)</em></td>
        <td>-</td>
        <td>✅</td>
        <td>-</td>
        <td>✅</td>
        <td>-</td>
        <td>-</td>
    </tr>
    <tr>
        <td>Edge <em>(v 87.0)</em></td>
        <td>✅</td>
        <td>✅</td>
        <td>❌</td>
        <td>❌</td>
        <td>✅</td>
        <td>-</td>
    </tr>
    <tr>
        <td>Firefox <em>(v 86.0)</em></td>
        <td>✅</td>
        <td>✅</td>
        <td>❌</td>
        <td>❌</td>
        <td>❌</td>
        <td>Fingerprint different in incognito mode</td>
    </tr>
    <tr>
        <td>Brave <em>(v 1.19.92)</em></td>
        <td>❌</td>
        <td>❌</td>
        <td>❌</td>
        <td>❔</td>
        <td>❌</td>
        <td>-</td>
    </tr>
  </tbody>
</table></markdown-accessiblity-table>
<p dir="auto"><h4 tabindex="-1" dir="auto">Previous versions</h4><a id="user-content-previous-versions" aria-label="Permalink: Previous versions" href="#previous-versions"></a></p>
<markdown-accessiblity-table><table>
  <thead>
    <tr>
      <th><p dir="auto">Browser</p></th>
      <th><p dir="auto">Windows</p></th>
      <th><p dir="auto">MacOS</p></th>
      <th><p dir="auto">Linux</p></th>
      <th><p dir="auto">iOS</p></th>
      <th><p dir="auto">Android</p></th>
      <th><i>Info</i></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><b>Brave</b> (v 1.14.0)</td>
      <td>✅</td>
      <td>✅</td>
      <td>✅</td>
      <td>✅</td>
      <td>✅</td>
      <td>-</td>
    </tr>
    <tr>
      <td><b>Firefox</b> (&lt; v 84.0)</td>
      <td>✅</td>
      <td>✅</td>
      <td>❔</td>
      <td>❌</td>
      <td>✅</td>
      <td>-</td>
    </tr>
  </tbody>
</table></markdown-accessiblity-table>
<p dir="auto"><h3 tabindex="-1" dir="auto"><a href="https://supercookie.me/workwise#content-scalability-performance" rel="nofollow">⚙ Scalability &amp; Performance</a></h3><a id="user-content--scalability--performance" aria-label="Permalink: ⚙ Scalability &amp; Performance" href="#-scalability--performance"></a></p>
<p dir="auto">By varying the number of bits that corresponds to the number of redirects to subpaths, this attack can be scaled almost arbitrarily.
It can distinguish 2^N unique users, where N is the number of redirects on the client side.
The time taken for the read and write operation increases as the number of distinguishable clients does.
<br>
In order to keep the number of redirects as minimal as possible, N can have a dynamic length.
More about this <a href="https://supercookie.me/workwise#content-scalability-performance" rel="nofollow">here</a>.</p>
<p dir="auto"><h3 tabindex="-1" dir="auto"><a href="https://supercookie.me/workwise" rel="nofollow">📌How to defend against?</a></h3><a id="user-content-how-to-defend-against" aria-label="Permalink: 📌How to defend against?" href="#how-to-defend-against"></a></p>
<p dir="auto">The most straightforward solution is to disable the favicon cache completely. As long as the browser vendors do not provide a feature against this vulnerability it's probably the best way to clear the F-cache.</p>
<ul dir="auto">
<li>
<p dir="auto"><a href="https://www.google.com/chrome/" rel="nofollow">Chrome</a> • <strong>MacOS</strong><br></p>
<ul dir="auto">
<li>Delete <code>~/Library/Application Support/Google/Chrome/Default/Favicons</code></li>
<li>Delete <code>~/Library/Application Support/Google/Chrome/Default/Favicons-journal</code></li>
</ul>
</li>
<li>
<p dir="auto"><a href="https://www.google.com/chrome/" rel="nofollow">Chrome</a> • <strong>Windows</strong><br></p>
<ul dir="auto">
<li>Delete <code>C:\Users\username\AppData\Local\Google\Chrome\User Data\Default</code></li>
</ul>
</li>
<li>
<p dir="auto"><a href="https://www.apple.com/safari/" rel="nofollow">Safari</a> • <strong>MacOS</strong><br></p>
<ul dir="auto">
<li>Delete content of <code>~/Library/Safari/Favicon Cache</code></li>
</ul>
</li>
<li>
<p dir="auto"><a href="https://www.microsoft.com/edge" rel="nofollow">Edge</a> • <strong>MacOS</strong><br></p>
<ul dir="auto">
<li>Delete <code>~/Library/Application Support/Microsoft Edge/Default/Favicon</code></li>
<li>Delete <code>~/Library/Application Support/Microsoft Edge/Default/Favicons-journal</code></li>
</ul>
</li>
</ul>
<p dir="auto"><h2 tabindex="-1" dir="auto">Other</h2><a id="user-content-other" aria-label="Permalink: Other" href="#other"></a></p>
<p dir="auto"><h3 tabindex="-1" dir="auto"><a href="https://jonas.strehles.info/" rel="nofollow">🙎‍♂️ About me</a></h3><a id="user-content-‍️-about-me" aria-label="Permalink: 🙎‍♂️ About me" href="#‍️-about-me"></a></p>
<p dir="auto">I am a twenty year old student from 🇩🇪 Germany. I like to work in software design and development and have an interest in the IT security domain.</p>
<p dir="auto">This repository, including the setup of a demonstration portal, was created within two days as part of a private research project on the topic of "Tracking on the Web".</p>
<p dir="auto"><h3 tabindex="-1" dir="auto"><a href="https://ko-fi.com/jonasstrehle" rel="nofollow">💖 Support the project</a></h3><a id="user-content--support-the-project" aria-label="Permalink: 💖 Support the project" href="#-support-the-project"></a></p>
<p dir="auto"><a href="https://ko-fi.com/jonasstrehle" rel="nofollow"><img src="https://camo.githubusercontent.com/201ef269611db7eb6b5d08e9f756ab8980df3014b64492770bdf13a6ed924641/68747470733a2f2f6b6f2d66692e636f6d2f696d672f676974687562627574746f6e5f736d2e737667" alt="ko-fi" data-canonical-src="https://ko-fi.com/img/githubbutton_sm.svg"></a></p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Spread the world!</h2><a id="user-content-spread-the-world" aria-label="Permalink: Spread the world!" href="#spread-the-world"></a></p>
<p dir="auto">Liked the project? Just give it a star ⭐ and spread the world!</p>
<ul dir="auto">
<li><a href="https://www.schneier.com/crypto-gram/archives/2021/0315.html#cg5" rel="nofollow">Bruce Schneier on schneier.com</a></li>
<li><a href="https://www.vice.com/amp/en/article/n7v5y7/browser-favicons-can-be-used-as-undeletable-supercookies-to-track-you-online?__twitter_impression=true" rel="nofollow">Matthew Gault on vice.com</a></li>
<li><a href="https://gizmodo.com/favicons-could-be-the-supercookie-that-tracks-you-every-1846229089/" rel="nofollow">Rhett Jones on gizmodo.com</a></li>
<li><a href="https://www.computing.co.uk/news/4027035/tiny-favicons-utilised-track-users-movements-online" rel="nofollow">Dev Kundaliyaon on computing.co.uk</a></li>
<li><a href="https://www.techradar.com/news/these-tiny-icons-could-be-tracking-you-across-the-internet" rel="nofollow">Barclay Ballard on techradar.com</a></li>
<li><a href="https://news.ycombinator.com/item?id=26051370" rel="nofollow">Discussion on ycombinator.com</a></li>
<li>🇩🇪 <a href="https://www.derstandard.de/story/2000124123751/supercookies-datensammler-finden-immer-neue-wege-die-nutzer-auszuspionieren" rel="nofollow">Andreas Proschofsky on derstandard.de</a></li>
<li>🇩🇪 <a href="https://t3n.de/news/tracking-id-favicons-supercookie-1355514/" rel="nofollow">Dieter Petereit on t3n.de</a></li>
<li>🇪🇸 <a href="https://www.microsiervos.com/archivo/seguridad/supercookie-me-identificador-personal-imborrable-icono-favicon.html" rel="nofollow">ALVY on microsiervos.com</a></li>
<li>🇧🇷 <a href="https://canaltech.com.br/seguranca/favicons-podem-ser-usados-para-rastrear-usuarios-online-permanentemente-178834/" rel="nofollow">Felipe Demartini on canaltech.com.br</a></li>
<li>🇧🇬 <a href="https://www.kaldata.com/it-%D0%BD%D0%BE%D0%B2%D0%B8%D0%BD%D0%B8/%D0%BD%D0%BE%D0%B2-%D0%BC%D0%B5%D1%82%D0%BE%D0%B4-%D0%B7%D0%B0-%D0%B8%D0%B4%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D1%8F-%D0%BD%D0%B0-%D0%BA%D0%BE%D0%BD%D0%BA%D1%80%D0%B5%D1%82-355279.html" rel="nofollow">Daniel Despodov on kaldata.com</a></li>
<li>🇫🇷 <a href="https://www.clubic.com/navigateur-internet/actualite-353236-publicite-les-favicons-des-sites-web-pourraient-se-montrer-un-peu-trop-curieux.html" rel="nofollow">Guillaume Belfiore on clubic.com</a></li>
<li>🇨🇳 <a href="https://www.cnbeta.com/articles/tech/1089095.htm" rel="nofollow">study875 on cnbeta.com</a></li>
<li>🇷🇺 <a href="https://habr.com/ru/company/itsumma/blog/542734/" rel="nofollow">ITSumma on habr.com</a></li>
<li>🇷🇺 <a href="https://www.securitylab.ru/news/516436.php" rel="nofollow">securitylab.ru</a></li>
<li><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/867e9a74739d08208ee30384cd9f274b64373d9939fe1d9ed175c7e5e59b6524/68747470733a2f2f796f75747562652e636f6d2f66617669636f6e2e69636f"><img src="https://camo.githubusercontent.com/867e9a74739d08208ee30384cd9f274b64373d9939fe1d9ed175c7e5e59b6524/68747470733a2f2f796f75747562652e636f6d2f66617669636f6e2e69636f" width="20" data-canonical-src="https://youtube.com/favicon.ico"></a> <a href="https://youtu.be/X7OW5hTt5hY" rel="nofollow">Seytonic on YouTube</a></li>
</ul>
</article></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Dark Pattern Games (317 pts)]]></title>
            <link>https://www.darkpattern.games</link>
            <guid>45947761</guid>
            <pubDate>Sun, 16 Nov 2025 19:38:49 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.darkpattern.games">https://www.darkpattern.games</a>, See on <a href="https://news.ycombinator.com/item?id=45947761">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
		<p><b>Definition</b>: A gaming dark pattern is something that is deliberately added to a game to cause an unwanted negative experience for the player with a positive outcome <span>for the game developer.</span>
		</p>
	</div><div id="beta">
		<p>DarkPattern.Games is a brand new website. We are starting with iOS and Android games because this is where most dark patterns appear, but we will be adding other platforms soon.</p>
		<p>Because we are new, we have a lot of games that don't have any reviews yet. This will improve over time and we are working hard to get games reviewed. Please help us by <a href="https://www.darkpattern.games/search.php">finding</a> a familiar game and submitting a review.</p>
	</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[The fate of "small" open source (278 pts)]]></title>
            <link>https://nolanlawson.com/2025/11/16/the-fate-of-small-open-source/</link>
            <guid>45947639</guid>
            <pubDate>Sun, 16 Nov 2025 19:21:13 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://nolanlawson.com/2025/11/16/the-fate-of-small-open-source/">https://nolanlawson.com/2025/11/16/the-fate-of-small-open-source/</a>, See on <a href="https://news.ycombinator.com/item?id=45947639">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
				<p>By far the most popular npm package I’ve ever written is <a href="https://www.npmjs.com/package/blob-util"><code>blob-util</code></a>, which is ~10 years old and still gets 5+ million weekly downloads.</p>
<p>It’s a small collection of utilities for working with <a href="https://developer.mozilla.org/en-US/docs/Web/API/Blob"><code>Blob</code>s</a> in JavaScript. I wrote it because I found that PouchDB users were endlessly confused about how to work with <code>Blob</code>s and how to convert them to strings, <code>ArrayBuffer</code>s, etc.</p>
<p>Given that <a href="https://survey.stackoverflow.co/2025/ai#sentiment-and-usage">some 80% of developers</a> are now using AI in their regular work, <code>blob-util</code> is almost certainly the kind of thing that most developers would just happily have an LLM generate for them. Sure, you <em>could</em> use <code>blob-util</code>, but then you’d be taking on an extra dependency, with unknown performance, maintenance, and supply-chain risks.</p>
<p>And sure enough, Claude will happily spit out whatever <code>Blob</code> utilities you need when prompted:</p>
<p><em>&gt; Write me a utility function in TypeScript to convert a Blob to an ArrayBuffer. It should return a Promise.</em></p>
<pre title="">function blobToArrayBuffer(blob: Blob): Promise&lt;ArrayBuffer&gt; {
  return new Promise((resolve, reject) =&gt; {
    const reader = new FileReader();

    reader.onload = () =&gt; {
      if (reader.result instanceof ArrayBuffer) {
        resolve(reader.result);
      } else {
        reject(new Error('Failed to read Blob as ArrayBuffer'));
      }
    };

    reader.onerror = () =&gt; {
      reject(reader.error);
    };

    reader.readAsArrayBuffer(blob);
  });
}
</pre>
<p>Claude’s version is pretty close to <a href="https://github.com/nolanlawson/blob-util/blob/99c06472d18329eda1421286692bd875d76d5c9c/src/blob-util.ts#L384-L394">the <code>blob-util</code> version</a> (unsurprising, since it was probably trained on it!). Although it’s much more verbose, unnecessarily checking if <code>readAsArrayBuffer</code> actually gives you an <code>ArrayBuffer</code> (although this does make TypeScript happy). To be fair, it also improves on my implementation by directly <code>reject</code>ing with an error rather than the more awkward <code>onerror</code> event.</p>

<p>I suppose some people would see this as progress: fewer dependencies, more robust code (even if it’s a bit more verbose), quicker turnaround time than the old “search npm, find a package, read the docs, install it” approach.</p>
<p>I don’t have any excessive pride in this library, and I don’t particularly care if the download numbers go up or down. But I do think something is lost with the AI approach. When I wrote <code>blob-util</code>, I took a teacher’s mentality: the README has <a href="https://www.npmjs.com/package/blob-util#tutorial">a cutesy and whimsical tutorial</a> featuring Kirby, in all his blobby glory. (I had a thing for putting Nintendo characters in all my stuff at the time.)</p>
<p>The goal wasn’t just to give you a utility to solve your problem (although it does that) – the goal was also to <em>teach</em> people how to use JavaScript effectively, so that you’d have an understanding of how to solve other problems in the future.</p>
<p>I don’t know which direction we’re going in with AI (well, ~80% of us; to the remaining holdouts, I salute you and wish you godspeed!), but I do think it’s a future where we prize instant answers over teaching and understanding. There’s less reason to use something like <code>blob-util</code>, which means there’s less reason to write it in the first place, and therefore less reason to educate people about the problem space.</p>
<p>Even now there’s a movement toward putting documentation in an <a href="https://llmstxt.org/"><code>llms.txt</code></a> file, so you can just point an agent at it and save your brain cells the effort of deciphering English prose. (Is this even documentation anymore? What <em>is</em> documentation?)</p>
<h2>Conclusion</h2>
<p>I still believe in open source, and I’m still doing it (in fits and starts). But one thing has become clear to me: the era of small, low-value libraries like <code>blob-util</code> is over. They were already on their way out thanks to Node.js and the browser taking on more and more of their functionality (see <code>node:glob</code>, <code>structuredClone</code>, etc.), but LLMs are the final nail in the coffin.</p>
<p>This does mean that there’s less opportunity to use these libraries as a springboard for user education (Underscore.js <a href="https://underscorejs.org/docs/underscore-esm.html">also had this philosophy</a>), but maybe that’s okay. If there’s no need to find a library to, say, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/groupBy">group the items in an array</a>, then maybe learning about the mechanics of such libraries is unnecessary. Many software developers will argue that asking a candidate to reverse a binary tree is pointless, since it never comes up in the day-to-day job, so maybe the same can be said for utility libraries.</p>
<p>I’m still trying to figure out what <em>kinds</em> of open source are worth writing in this new era (hint: ones that an LLM can’t just spit out on command), and where education is the most lacking. My current thinking is that the most value is in bigger projects, more inventive projects, or in more niche topics not covered in an LLM’s training data. For example, I look back on my work on <a href="https://github.com/nolanlawson/fuite"><code>fuite</code></a> and various <a href="https://nolanlawson.com/2022/01/05/memory-leaks-the-forgotten-side-of-web-performance/">memory-leak-hunting blog posts</a>, and I’m pretty satisfied that an LLM couldn’t reproduce this, because it requires novel research and creative techniques. (Although who knows: maybe someday an agent will be able to just bang its head against Chrome heap snapshots until it finds the leak. I’ll believe it when I see it.)</p>
<p>There’s been a lot of hand-wringing lately about where open source fits in in a world of LLMs, but I still see people pushing the boundaries. For example, a lot of naysayers think there’s no point in writing a new JavaScript framework, since LLMs are so heavily trained on React, but then there goes the indefatigable <a href="https://github.com/trueadm">Dominic Gannaway</a> writing <a href="https://www.ripplejs.com/">Ripple.js</a>, yet another JavaScript framework (and with <a href="https://podrocket.logrocket.com/ripple-js-dominic-gannaway-logrocket-podrocket">some new ideas</a>, to boot!). This is the kind of thing I like to see: humans laughing in the face of the machine, going on with their human thing.</p>
<p>So if there’s a conclusion to this meandering blog post (excuse my squishy human brain; I didn’t use an LLM to write this), it’s just that: yes, LLMs have made some kinds of open source obsolete, but there’s still plenty of open source left to write. I’m excited to see what kinds of novel and unexpected things you all come up with.</p>
							</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[What if you don't need MCP at all? (219 pts)]]></title>
            <link>https://mariozechner.at/posts/2025-11-02-what-if-you-dont-need-mcp/</link>
            <guid>45947444</guid>
            <pubDate>Sun, 16 Nov 2025 18:58:10 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://mariozechner.at/posts/2025-11-02-what-if-you-dont-need-mcp/">https://mariozechner.at/posts/2025-11-02-what-if-you-dont-need-mcp/</a>, See on <a href="https://news.ycombinator.com/item?id=45947444">Hacker News</a></p>
<div id="readability-page-1" class="page"><article>



<p>2025-11-02</p>

<figure>
<img src="https://mariozechner.at/posts/2025-11-02-what-if-you-dont-need-mcp/media/header.png">
<figcaption>One chonky MCP server</figcaption>
</figure>




<div>
<ul><li><a href="#toc_0">My Browser DevTools Use Cases</a></li><li><a href="#toc_1">Problems with Common Browser DevTools for Your Agent</a></li><li><a href="#toc_2">Embracing Bash (and Code)</a><ul><li><a href="#toc_3">The Start Tool</a></li><li><a href="#toc_4">The Navigate Tool</a></li><li><a href="#toc_5">The Evaluate JavaScript Tool</a></li><li><a href="#toc_6">The Screenshot Tool</a></li></ul></li><li><a href="#toc_7">The Benefits</a></li><li><a href="#toc_8">Adding the Pick Tool</a></li><li><a href="#toc_9">Adding the Cookies Tool</a></li><li><a href="#toc_10">A Contrived Example</a></li><li><a href="#toc_11">Making This Reusable Across Agents</a></li><li><a href="#toc_12">In Conclusion</a></li></ul>
</div>

<p>After months of agentic coding frenzy, Twitter is still ablaze with discussions about MCP servers. I previously did some <a href="https://mariozechner.at/posts/2025-08-15-mcp-vs-cli/">very light benchmarking</a> to see if Bash tools or MCP servers are better suited for a specific task. The TL;DR: both can be efficient if you take care.</p>
<p>Unfortunately, many of the most popular MCP servers are inefficient for a specific task. They need to cover all bases, which means they provide large numbers of tools with lengthy descriptions, consuming significant context.</p>
<p>It's also hard to extend an existing MCP server. You could check out the source and modify it, but then you'd have to understand the codebase, together with your agent.</p>
<p>MCP servers also aren't composable. Results returned by an MCP server have to go through the agent's context to be persisted to disk or combined with other results.</p>
<p>I'm a simple boy, so I like simple things. Agents can run Bash and write code well. Bash and code are composable. So what's simpler than having your agent just invoke CLI tools and write code? This is nothing new. We've all been doing this since the beginning. I'd just like to convince you that in many situations, you don't need or even want an MCP server.</p>
<p>Let me illustrate this with a common MCP server use case: browser dev tools.</p>
<h2 id="toc_0">My Browser DevTools Use Cases</h2>
<p>My use cases are working on web frontends together with my agent, or abusing my agent to become a scrapey little hacker boy so I can scrape all the data in the world. For these two use cases, I only need a minimal set of tools:</p>
<ul>
<li>Start the browser, optionally with my default profile so I'm logged in</li>
<li>Navigate to a URL, either in the active tab or a new tab</li>
<li>Execute JavaScript in the active page context</li>
<li>Take a screenshot of the viewport</li>
</ul>
<p>And if my use case requires additional special tooling, I want to quickly have my agent generate that for me and slot it in with the other tools.</p>
<h2 id="toc_1">Problems with Common Browser DevTools for Your Agent</h2>
<p>People will recommend <a href="https://github.com/microsoft/playwright-mcp">Playwright MCP</a> or <a href="https://github.com/ChromeDevTools/chrome-devtools-mcp">Chrome DevTools MCP</a> for the use cases I illustrated above. Both are fine, but they need to cover all the bases. Playwright MCP has 21 tools using 13.7k tokens (6.8% of Claude's context). Chrome DevTools MCP has 26 tools using 18.0k tokens (9.0%). That many tools will confuse your agent, especially when combined with other MCP servers and built-in tools.</p>
<p>Using those tools also means you suffer from the composability issue: any output has to go through your agent's context. You can kind of fix this by using sub-agents, but then you rope in all the issues that sub-agents come with.</p>
<h2 id="toc_2">Embracing Bash (and Code)</h2>
<p>Here's my minimal set of tools, illustrated via the README.md:</p>
<pre><code><span># Browser Tools</span>

Minimal CDP tools for collaborative site exploration.

<span>## Start Chrome</span>

\<span>`\`</span>\`bash
./start.js              # Fresh profile
./start.js --profile    # Copy your profile (cookies, logins)
\<span>`\`</span>\`

Start Chrome on <span>`:9222`</span> with remote debugging.

<span>## Navigate</span>

\<span>`\`</span>\`bash
./nav.js https://example.com
./nav.js https://example.com --new
\<span>`\`</span>\`

Navigate current tab or open new tab.

<span>## Evaluate JavaScript</span>

\<span>`\`</span>\`bash
./eval.js 'document.title'
./eval.js 'document.querySelectorAll("a").length'
\<span>`\`</span>\`

Execute JavaScript in active tab (async context).

<span>## Screenshot</span>

\<span>`\`</span>\`bash
./screenshot.js
\<span>`\`</span>\`

Screenshot current viewport, returns temp file path.
</code></pre><p>This is all I feed to my agent. It's a handful of tools that cover all the bases for my use case. Each tool is a simple Node.js script that uses <a href="https://pptr.dev/">Puppeteer Core</a>. By reading that README, the agent knows the available tools, when to use them, and how to use them via Bash.</p>
<p>When I start a session where the agent needs to interact with a browser, I just tell it to read that file in full and that's all it needs to be effective. Let's walk through their implementations to see how little code this actually is.</p>
<h3 id="toc_3">The Start Tool</h3>
<p>The agent needs to be able to start a new browser session. For scraping tasks, I often want to use my actual Chrome profile so I'm logged in everywhere. This script either rsyncs my Chrome profile to a temporary folder (Chrome doesn't allow debugging on the default profile), or starts fresh:</p>
<pre><code><span>#!/usr/bin/env node</span>

<span>import</span> { spawn, execSync } <span>from</span> <span>"node:child_process"</span>;
<span>import</span> puppeteer <span>from</span> <span>"puppeteer-core"</span>;

<span>const</span> useProfile = process.<span>argv</span>[<span>2</span>] === <span>"--profile"</span>;

<span>if</span> (process.<span>argv</span>[<span>2</span>] &amp;&amp; process.<span>argv</span>[<span>2</span>] !== <span>"--profile"</span>) {
    <span>console</span>.<span>log</span>(<span>"Usage: start.ts [--profile]"</span>);
    <span>console</span>.<span>log</span>(<span>"\nOptions:"</span>);
    <span>console</span>.<span>log</span>(<span>"  --profile  Copy your default Chrome profile (cookies, logins)"</span>);
    <span>console</span>.<span>log</span>(<span>"\nExamples:"</span>);
    <span>console</span>.<span>log</span>(<span>"  start.ts            # Start with fresh profile"</span>);
    <span>console</span>.<span>log</span>(<span>"  start.ts --profile  # Start with your Chrome profile"</span>);
    process.<span>exit</span>(<span>1</span>);
}

<span>// Kill existing Chrome</span>
<span>try</span> {
    <span>execSync</span>(<span>"killall 'Google Chrome'"</span>, { <span>stdio</span>: <span>"ignore"</span> });
} <span>catch</span> {}

<span>// Wait a bit for processes to fully die</span>
<span>await</span> <span>new</span> <span>Promise</span>(<span>(<span>r</span>) =&gt;</span> <span>setTimeout</span>(r, <span>1000</span>));

<span>// Setup profile directory</span>
<span>execSync</span>(<span>"mkdir -p ~/.cache/scraping"</span>, { <span>stdio</span>: <span>"ignore"</span> });

<span>if</span> (useProfile) {
    <span>// Sync profile with rsync (much faster on subsequent runs)</span>
    <span>execSync</span>(
        <span>'rsync -a --delete "/Users/badlogic/Library/Application Support/Google/Chrome/" ~/.cache/scraping/'</span>,
        { <span>stdio</span>: <span>"pipe"</span> },
    );
}

<span>// Start Chrome in background (detached so Node can exit)</span>
<span>spawn</span>(
    <span>"/Applications/Google Chrome.app/Contents/MacOS/Google Chrome"</span>,
    [<span>"--remote-debugging-port=9222"</span>, <span>`--user-data-dir=<span>${process.env[<span>"HOME"</span>]}</span>/.cache/scraping`</span>],
    { <span>detached</span>: <span>true</span>, <span>stdio</span>: <span>"ignore"</span> },
).<span>unref</span>();

<span>// Wait for Chrome to be ready by attempting to connect</span>
<span>let</span> connected = <span>false</span>;
<span>for</span> (<span>let</span> i = <span>0</span>; i &lt; <span>30</span>; i++) {
    <span>try</span> {
        <span>const</span> browser = <span>await</span> puppeteer.<span>connect</span>({
            <span>browserURL</span>: <span>"http://localhost:9222"</span>,
            <span>defaultViewport</span>: <span>null</span>,
        });
        <span>await</span> browser.<span>disconnect</span>();
        connected = <span>true</span>;
        <span>break</span>;
    } <span>catch</span> {
        <span>await</span> <span>new</span> <span>Promise</span>(<span>(<span>r</span>) =&gt;</span> <span>setTimeout</span>(r, <span>500</span>));
    }
}

<span>if</span> (!connected) {
    <span>console</span>.<span>error</span>(<span>"✗ Failed to connect to Chrome"</span>);
    process.<span>exit</span>(<span>1</span>);
}

<span>console</span>.<span>log</span>(<span>`✓ Chrome started on :9222<span>${useProfile ? <span>" with your profile"</span> : <span>""</span>}</span>`</span>);
</code></pre><p>All the agent needs to know is to use Bash to run the start.js script, either with <code>--profile</code> or without.</p>
<h3 id="toc_4">The Navigate Tool</h3>
<p>Once the browser is running, the agent needs to navigate to URLs, either in a new tab or the active tab. That's exactly what the navigate tool provides:</p>
<pre><code><span>#!/usr/bin/env node</span>

<span>import</span> puppeteer <span>from</span> <span>"puppeteer-core"</span>;

<span>const</span> url = process.<span>argv</span>[<span>2</span>];
<span>const</span> newTab = process.<span>argv</span>[<span>3</span>] === <span>"--new"</span>;

<span>if</span> (!url) {
    <span>console</span>.<span>log</span>(<span>"Usage: nav.js &lt;url&gt; [--new]"</span>);
    <span>console</span>.<span>log</span>(<span>"\nExamples:"</span>);
    <span>console</span>.<span>log</span>(<span>"  nav.js https://example.com       # Navigate current tab"</span>);
    <span>console</span>.<span>log</span>(<span>"  nav.js https://example.com --new # Open in new tab"</span>);
    process.<span>exit</span>(<span>1</span>);
}

<span>const</span> b = <span>await</span> puppeteer.<span>connect</span>({
    <span>browserURL</span>: <span>"http://localhost:9222"</span>,
    <span>defaultViewport</span>: <span>null</span>,
});

<span>if</span> (newTab) {
    <span>const</span> p = <span>await</span> b.<span>newPage</span>();
    <span>await</span> p.<span>goto</span>(url, { <span>waitUntil</span>: <span>"domcontentloaded"</span> });
    <span>console</span>.<span>log</span>(<span>"✓ Opened:"</span>, url);
} <span>else</span> {
    <span>const</span> p = (<span>await</span> b.<span>pages</span>()).<span>at</span>(-<span>1</span>);
    <span>await</span> p.<span>goto</span>(url, { <span>waitUntil</span>: <span>"domcontentloaded"</span> });
    <span>console</span>.<span>log</span>(<span>"✓ Navigated to:"</span>, url);
}

<span>await</span> b.<span>disconnect</span>();
</code></pre><h3 id="toc_5">The Evaluate JavaScript Tool</h3>
<p>The agent needs to execute JavaScript to read and modify the DOM of the active tab. The JavaScript it writes runs in the page context, so it doesn't have to fuck around with Puppeteer itself. All it needs to know is how to write code using the DOM API, and it sure knows how to do that:</p>
<pre><code><span>#!/usr/bin/env node</span>

<span>import</span> puppeteer <span>from</span> <span>"puppeteer-core"</span>;

<span>const</span> code = process.<span>argv</span>.<span>slice</span>(<span>2</span>).<span>join</span>(<span>" "</span>);
<span>if</span> (!code) {
    <span>console</span>.<span>log</span>(<span>"Usage: eval.js 'code'"</span>);
    <span>console</span>.<span>log</span>(<span>"\nExamples:"</span>);
    <span>console</span>.<span>log</span>(<span>'  eval.js "document.title"'</span>);
    <span>console</span>.<span>log</span>(<span>'  eval.js "document.querySelectorAll(\'a\').length"'</span>);
    process.<span>exit</span>(<span>1</span>);
}

<span>const</span> b = <span>await</span> puppeteer.<span>connect</span>({
    <span>browserURL</span>: <span>"http://localhost:9222"</span>,
    <span>defaultViewport</span>: <span>null</span>,
});

<span>const</span> p = (<span>await</span> b.<span>pages</span>()).<span>at</span>(-<span>1</span>);

<span>if</span> (!p) {
    <span>console</span>.<span>error</span>(<span>"✗ No active tab found"</span>);
    process.<span>exit</span>(<span>1</span>);
}

<span>const</span> result = <span>await</span> p.<span>evaluate</span>(<span>(<span>c</span>) =&gt;</span> {
    <span>const</span> <span>AsyncFunction</span> = (<span>async</span> () =&gt; {}).<span>constructor</span>;
    <span>return</span> <span>new</span> <span>AsyncFunction</span>(<span>`return (<span>${c}</span>)`</span>)();
}, code);

<span>if</span> (<span>Array</span>.<span>isArray</span>(result)) {
    <span>for</span> (<span>let</span> i = <span>0</span>; i &lt; result.<span>length</span>; i++) {
        <span>if</span> (i &gt; <span>0</span>) <span>console</span>.<span>log</span>(<span>""</span>);
        <span>for</span> (<span>const</span> [key, value] <span>of</span> <span>Object</span>.<span>entries</span>(result[i])) {
            <span>console</span>.<span>log</span>(<span>`<span>${key}</span>: <span>${value}</span>`</span>);
        }
    }
} <span>else</span> <span>if</span> (<span>typeof</span> result === <span>"object"</span> &amp;&amp; result !== <span>null</span>) {
    <span>for</span> (<span>const</span> [key, value] <span>of</span> <span>Object</span>.<span>entries</span>(result)) {
        <span>console</span>.<span>log</span>(<span>`<span>${key}</span>: <span>${value}</span>`</span>);
    }
} <span>else</span> {
    <span>console</span>.<span>log</span>(result);
}

<span>await</span> b.<span>disconnect</span>();
</code></pre><h3 id="toc_6">The Screenshot Tool</h3>
<p>Sometimes the agent needs to have a visual impression of a page, so naturally we want a screenshot tool:</p>
<pre><code><span>#!/usr/bin/env node</span>

<span>import</span> { tmpdir } <span>from</span> <span>"node:os"</span>;
<span>import</span> { join } <span>from</span> <span>"node:path"</span>;
<span>import</span> puppeteer <span>from</span> <span>"puppeteer-core"</span>;

<span>const</span> b = <span>await</span> puppeteer.<span>connect</span>({
    <span>browserURL</span>: <span>"http://localhost:9222"</span>,
    <span>defaultViewport</span>: <span>null</span>,
});

<span>const</span> p = (<span>await</span> b.<span>pages</span>()).<span>at</span>(-<span>1</span>);

<span>if</span> (!p) {
    <span>console</span>.<span>error</span>(<span>"✗ No active tab found"</span>);
    process.<span>exit</span>(<span>1</span>);
}

<span>const</span> timestamp = <span>new</span> <span>Date</span>().<span>toISOString</span>().<span>replace</span>(<span>/[:.]/g</span>, <span>"-"</span>);
<span>const</span> filename = <span>`screenshot-<span>${timestamp}</span>.png`</span>;
<span>const</span> filepath = <span>join</span>(<span>tmpdir</span>(), filename);

<span>await</span> p.<span>screenshot</span>({ <span>path</span>: filepath });

<span>console</span>.<span>log</span>(filepath);

<span>await</span> b.<span>disconnect</span>();
</code></pre><p>This will take a screenshot of the current viewport of the active tab, write it to a .png file in a temporary directory, and output the file path to the agent, which can then turn around and read it in and use its vision capabilities to "see" the image.</p>
<h2 id="toc_7">The Benefits</h2>
<p>So how does this compare to the MCP servers I mentioned above? Well, to start, I can pull in the README whenever I need it and don't pay for it in every session. This is very similar to Anthropic's recently introduced skills capabilities. Except it's even more ad hoc and works with any coding agent. All I need to do is instruct my agent to read the README file.</p>
<p>Side note: many folks including myself have used this kind of setup before Anthropic released their skills system. You can see something similar in my <a href="https://mariozechner.at/posts/2025-06-02-prompts-are-code/">"Prompts are Code" blog post</a> or my little <a href="https://sitegeist.ai/">sitegeist.ai</a>. <a href="https://lucumr.pocoo.org/2025/8/18/code-mcps/">Armin</a> has also touched on the power of Bash and code compared to MCPs previously. Anthropic's skills add progressive disclosure (love it) and they make them available to a non-technical audience across almost all their products (also love it).</p>
<p>Speaking of the README, instead of pulling in 13,000 to 18,000 tokens like the MCP servers mentioned above, this README has a whopping 225 tokens. This efficiency comes from the fact that models know how to write code and use Bash. I'm conserving context space by relying heavily on their existing knowledge.</p>
<p>These simple tools are also composable. Instead of reading the outputs of an invocation into the context, the agent can decide to save them to a file for later processing, either by itself or by code. The agent can also easily chain multiple invocations in a single Bash command.</p>
<p>If I find that the output of a tool is not token efficient, I can just change the output format. Something that's hard or impossible to do depending on what MCP server you use.</p>
<p>And it's ridiculously easy to add a new tool or modify an existing tool for my needs. Let me illustrate.</p>
<h2 id="toc_8">Adding the Pick Tool</h2>
<p>When the agent and I try to come up with a scraping method for a specific site, it's often more efficient if I'm able to point out DOM elements to it directly by just clicking on them. To make this super easy, I can just build a picker. Here's what I add to the README:</p>
<pre><code><span>## Pick Elements</span>

\<span>`\`</span>\`bash
./pick.js "Click the submit button"
\<span>`\`</span>\`

Interactive element picker. Click to select, Cmd/Ctrl+Click for multi-select, Enter to finish.
</code></pre><p>And here's the code:</p>
<pre><code><span>#!/usr/bin/env node</span>

<span>import</span> puppeteer <span>from</span> <span>"puppeteer-core"</span>;

<span>const</span> message = process.<span>argv</span>.<span>slice</span>(<span>2</span>).<span>join</span>(<span>" "</span>);
<span>if</span> (!message) {
    <span>console</span>.<span>log</span>(<span>"Usage: pick.js 'message'"</span>);
    <span>console</span>.<span>log</span>(<span>"\nExample:"</span>);
    <span>console</span>.<span>log</span>(<span>'  pick.js "Click the submit button"'</span>);
    process.<span>exit</span>(<span>1</span>);
}

<span>const</span> b = <span>await</span> puppeteer.<span>connect</span>({
    <span>browserURL</span>: <span>"http://localhost:9222"</span>,
    <span>defaultViewport</span>: <span>null</span>,
});

<span>const</span> p = (<span>await</span> b.<span>pages</span>()).<span>at</span>(-<span>1</span>);

<span>if</span> (!p) {
    <span>console</span>.<span>error</span>(<span>"✗ No active tab found"</span>);
    process.<span>exit</span>(<span>1</span>);
}

<span>// Inject pick() helper into current page</span>
<span>await</span> p.<span>evaluate</span>(<span>() =&gt;</span> {
    <span>if</span> (!<span>window</span>.<span>pick</span>) {
        <span>window</span>.<span>pick</span> = <span>async</span> (message) =&gt; {
            <span>if</span> (!message) {
                <span>throw</span> <span>new</span> <span>Error</span>(<span>"pick() requires a message parameter"</span>);
            }
            <span>return</span> <span>new</span> <span>Promise</span>(<span>(<span>resolve</span>) =&gt;</span> {
                <span>const</span> selections = [];
                <span>const</span> selectedElements = <span>new</span> <span>Set</span>();

                <span>const</span> overlay = <span>document</span>.<span>createElement</span>(<span>"div"</span>);
                overlay.<span>style</span>.<span>cssText</span> =
                    <span>"position:fixed;top:0;left:0;width:100%;height:100%;z-index:2147483647;pointer-events:none"</span>;

                <span>const</span> highlight = <span>document</span>.<span>createElement</span>(<span>"div"</span>);
                highlight.<span>style</span>.<span>cssText</span> =
                    <span>"position:absolute;border:2px solid #3b82f6;background:rgba(59,130,246,0.1);transition:all 0.1s"</span>;
                overlay.<span>appendChild</span>(highlight);

                <span>const</span> banner = <span>document</span>.<span>createElement</span>(<span>"div"</span>);
                banner.<span>style</span>.<span>cssText</span> =
                    <span>"position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#1f2937;color:white;padding:12px 24px;border-radius:8px;font:14px sans-serif;box-shadow:0 4px 12px rgba(0,0,0,0.3);pointer-events:auto;z-index:2147483647"</span>;

                <span>const</span> <span>updateBanner</span> = (<span></span>) =&gt; {
                    banner.<span>textContent</span> = <span>`<span>${message}</span> (<span>${selections.length}</span> selected, Cmd/Ctrl+click to add, Enter to finish, ESC to cancel)`</span>;
                };
                <span>updateBanner</span>();

                <span>document</span>.<span>body</span>.<span>append</span>(banner, overlay);

                <span>const</span> <span>cleanup</span> = (<span></span>) =&gt; {
                    <span>document</span>.<span>removeEventListener</span>(<span>"mousemove"</span>, onMove, <span>true</span>);
                    <span>document</span>.<span>removeEventListener</span>(<span>"click"</span>, onClick, <span>true</span>);
                    <span>document</span>.<span>removeEventListener</span>(<span>"keydown"</span>, onKey, <span>true</span>);
                    overlay.<span>remove</span>();
                    banner.<span>remove</span>();
                    selectedElements.<span>forEach</span>(<span>(<span>el</span>) =&gt;</span> {
                        el.<span>style</span>.<span>outline</span> = <span>""</span>;
                    });
                };

                <span>const</span> <span>onMove</span> = (<span>e</span>) =&gt; {
                    <span>const</span> el = <span>document</span>.<span>elementFromPoint</span>(e.<span>clientX</span>, e.<span>clientY</span>);
                    <span>if</span> (!el || overlay.<span>contains</span>(el) || banner.<span>contains</span>(el)) <span>return</span>;
                    <span>const</span> r = el.<span>getBoundingClientRect</span>();
                    highlight.<span>style</span>.<span>cssText</span> = <span>`position:absolute;border:2px solid #3b82f6;background:rgba(59,130,246,0.1);top:<span>${r.top}</span>px;left:<span>${r.left}</span>px;width:<span>${r.width}</span>px;height:<span>${r.height}</span>px`</span>;
                };

                <span>const</span> <span>buildElementInfo</span> = (<span>el</span>) =&gt; {
                    <span>const</span> parents = [];
                    <span>let</span> current = el.<span>parentElement</span>;
                    <span>while</span> (current &amp;&amp; current !== <span>document</span>.<span>body</span>) {
                        <span>const</span> parentInfo = current.<span>tagName</span>.<span>toLowerCase</span>();
                        <span>const</span> id = current.<span>id</span> ? <span>`#<span>${current.id}</span>`</span> : <span>""</span>;
                        <span>const</span> cls = current.<span>className</span>
                            ? <span>`.<span>${current.className.trim().split(/\s+/).join(<span>"."</span>)}</span>`</span>
                            : <span>""</span>;
                        parents.<span>push</span>(parentInfo + id + cls);
                        current = current.<span>parentElement</span>;
                    }

                    <span>return</span> {
                        <span>tag</span>: el.<span>tagName</span>.<span>toLowerCase</span>(),
                        <span>id</span>: el.<span>id</span> || <span>null</span>,
                        <span>class</span>: el.<span>className</span> || <span>null</span>,
                        <span>text</span>: el.<span>textContent</span>?.<span>trim</span>().<span>slice</span>(<span>0</span>, <span>200</span>) || <span>null</span>,
                        <span>html</span>: el.<span>outerHTML</span>.<span>slice</span>(<span>0</span>, <span>500</span>),
                        <span>parents</span>: parents.<span>join</span>(<span>" &gt; "</span>),
                    };
                };

                <span>const</span> <span>onClick</span> = (<span>e</span>) =&gt; {
                    <span>if</span> (banner.<span>contains</span>(e.<span>target</span>)) <span>return</span>;
                    e.<span>preventDefault</span>();
                    e.<span>stopPropagation</span>();
                    <span>const</span> el = <span>document</span>.<span>elementFromPoint</span>(e.<span>clientX</span>, e.<span>clientY</span>);
                    <span>if</span> (!el || overlay.<span>contains</span>(el) || banner.<span>contains</span>(el)) <span>return</span>;

                    <span>if</span> (e.<span>metaKey</span> || e.<span>ctrlKey</span>) {
                        <span>if</span> (!selectedElements.<span>has</span>(el)) {
                            selectedElements.<span>add</span>(el);
                            el.<span>style</span>.<span>outline</span> = <span>"3px solid #10b981"</span>;
                            selections.<span>push</span>(<span>buildElementInfo</span>(el));
                            <span>updateBanner</span>();
                        }
                    } <span>else</span> {
                        <span>cleanup</span>();
                        <span>const</span> info = <span>buildElementInfo</span>(el);
                        <span>resolve</span>(selections.<span>length</span> &gt; <span>0</span> ? selections : info);
                    }
                };

                <span>const</span> <span>onKey</span> = (<span>e</span>) =&gt; {
                    <span>if</span> (e.<span>key</span> === <span>"Escape"</span>) {
                        e.<span>preventDefault</span>();
                        <span>cleanup</span>();
                        <span>resolve</span>(<span>null</span>);
                    } <span>else</span> <span>if</span> (e.<span>key</span> === <span>"Enter"</span> &amp;&amp; selections.<span>length</span> &gt; <span>0</span>) {
                        e.<span>preventDefault</span>();
                        <span>cleanup</span>();
                        <span>resolve</span>(selections);
                    }
                };

                <span>document</span>.<span>addEventListener</span>(<span>"mousemove"</span>, onMove, <span>true</span>);
                <span>document</span>.<span>addEventListener</span>(<span>"click"</span>, onClick, <span>true</span>);
                <span>document</span>.<span>addEventListener</span>(<span>"keydown"</span>, onKey, <span>true</span>);
            });
        };
    }
});

<span>const</span> result = <span>await</span> p.<span>evaluate</span>(<span>(<span>msg</span>) =&gt;</span> <span>window</span>.<span>pick</span>(msg), message);

<span>if</span> (<span>Array</span>.<span>isArray</span>(result)) {
    <span>for</span> (<span>let</span> i = <span>0</span>; i &lt; result.<span>length</span>; i++) {
        <span>if</span> (i &gt; <span>0</span>) <span>console</span>.<span>log</span>(<span>""</span>);
        <span>for</span> (<span>const</span> [key, value] <span>of</span> <span>Object</span>.<span>entries</span>(result[i])) {
            <span>console</span>.<span>log</span>(<span>`<span>${key}</span>: <span>${value}</span>`</span>);
        }
    }
} <span>else</span> <span>if</span> (<span>typeof</span> result === <span>"object"</span> &amp;&amp; result !== <span>null</span>) {
    <span>for</span> (<span>const</span> [key, value] <span>of</span> <span>Object</span>.<span>entries</span>(result)) {
        <span>console</span>.<span>log</span>(<span>`<span>${key}</span>: <span>${value}</span>`</span>);
    }
} <span>else</span> {
    <span>console</span>.<span>log</span>(result);
}

<span>await</span> b.<span>disconnect</span>();
</code></pre><p>Whenever I think it's faster for me to just click on a bunch of DOM elements instead of having the agent figure out the DOM structure, I can just tell it to use the pick tool. It's super efficient and allows me to build scrapers in no time. It's also fantastic to adjust the scraper if the DOM layout of a site changed.</p>
<p>If you're having trouble following what this tool does, worry not, I will have a video at the end of the blog post where you can see it in action. Before we look at that, let me show you an additional tool.</p>
<h2 id="toc_9">Adding the Cookies Tool</h2>
<p>During one of my recent scraping adventures, I had a need for HTTP-only cookies of that site, so the deterministic scraper could pretend it's me. The Evaluate JavaScript tool cannot handle this as it executes in the page context. But it took not even a minute for me to instruct Claude to create that tool, add it to the readme, and away we went.</p>
<img src="https://mariozechner.at/posts/2025-11-02-what-if-you-dont-need-mcp/media/extension.png" loading="lazy">

<p>This is so much easier than adjusting, testing, and debugging an existing MCP server.</p>
<h2 id="toc_10">A Contrived Example</h2>
<p>Let me illustrate usage of this set of tools with a contrived example. I set out to build a simple Hacker News scraper where I basically pick the DOM elements for the agent, based on which it can then write a minimal Node.js scraper. Here's how that looks in action. I sped up a few sections where Claude was its usual slow self.</p>
<video src="https://mariozechner.at/posts/2025-11-02-what-if-you-dont-need-mcp/media/scrape.mp4" poster="https://mariozechner.at/posts/2025-11-02-what-if-you-dont-need-mcp/media/scrape-poster.png" controls="">
</video>

<p>Real world scraping tasks would look a bit more involved. Also, there's no point in doing it like this for such a simple site like Hacker News. But you get the idea.</p>
<p>Final token tally:</p>
<img src="https://mariozechner.at/posts/2025-11-02-what-if-you-dont-need-mcp/media/scrape-tokens.png" loading="lazy">

<h2 id="toc_11">Making This Reusable Across Agents</h2>
<p>Here's how I've set things up so I can use this with Claude Code and other agents. I have a folder <code>agent-tools</code> in my home directory. I then clone the repositories of individual tools, like the browser tools repository above, into that folder. Then I set up an alias:</p>
<pre><code><span>alias</span> cl=<span>"PATH=<span>$PATH</span>:/Users/badlogic/agent-tools/browser-tools:&lt;other-tool-dirs&gt; &amp;&amp; claude --dangerously-skip-permissions"</span>
</code></pre><p>This way all of the scripts are available to sessions of Claude, but don't pollute my normal environment. I also prefix each script with the full tool name, e.g. <code>browser-tools-start.js</code>, to eliminate name collisions. I also add a single sentence to the README telling the agent that all the scripts are globally available. This way, the agent doesn't have to change its working directory just to call a tool script, saving a few tokens here and there, and reducing the chances of the agent getting confused by the constant working directory changes.</p>
<p>Finally, I add the agent tools directory as a working directory to Claude Code via <code>/add-dir</code>, so I can use <code>@README.md</code> to reference a specific tool's README file and get it into the agent's context. I prefer this to Anthropic's skill auto-discovery, which I found to not work reliably in practice. It also means I save a few more tokens: Claude Code injects all the frontmatter of all skills it can find into the system prompt (or first user message, I forgot, see <a href="https://cchistory.mariozechner.at/">https://cchistory.mariozechner.at</a>)</p>
<h2 id="toc_12">In Conclusion</h2>
<p>Building these tools is ridiculously easy, gives you all the freedom you need, and makes you, your agent, and your token usage efficient. You can find the browser tools on <a href="https://github.com/badlogic/browser-tools">GitHub</a>.</p>
<p>This general principle can apply to any kind of harness that has some kind of code execution environment. Think outside the MCP box and you'll find that this is much more powerful than the more rigid structure you have to follow with MCP.</p>
<p>With great power comes great responsibility though. You will have to come up with a structure for how you build and maintain those tools yourself. Anthropic's skill system can be one way to do it, though that's less transferable to other agents. Or you follow my setup above.</p>
<p>
    This page respects your privacy by not using cookies or similar technologies and by not collecting any personally identifiable information.
</p>

</article></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Z3 API in Python: From Sudoku to N-Queens in Under 20 Lines (143 pts)]]></title>
            <link>https://ericpony.github.io/z3py-tutorial/guide-examples.htm</link>
            <guid>45947301</guid>
            <pubDate>Sun, 16 Nov 2025 18:38:37 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://ericpony.github.io/z3py-tutorial/guide-examples.htm">https://ericpony.github.io/z3py-tutorial/guide-examples.htm</a>, See on <a href="https://news.ycombinator.com/item?id=45947301">Hacker News</a></p>
<div id="readability-page-1" class="page">
<h3></h3>

<h2>Z3 API in Python</h2>
<p>Z3 is a high performance theorem prover developed at <a target="_blank" href="http://research.microsoft.com/">Microsoft Research</a>.
Z3 is used in many applications such as: software/hardware verification and testing, constraint solving, analysis of hybrid systems,
security, biology (in silico analysis), and geometrical problems.</p>
<p>This tutorial demonstrates the main capabilities of Z3Py: the Z3 API in <a target="_blank" href="http://www.python.org/">Python</a>.
No Python background is needed to read this tutorial. However, it is useful to learn Python (a fun language!) at some point, and
there are many excellent free resources for doing so (<a target="_blank" href="http://docs.python.org/tutorial/">Python Tutorial</a>).
</p>

<p>The Z3 distribution also contains the <b>C</b>, <b>.Net</b> and <b>OCaml</b> APIs. The source code of Z3Py is available in
the Z3 distribution, feel free to modify it to meet your needs. The source code also demonstrates how to use new features in Z3 4.0.
Other cool front-ends for Z3 include <a target="_blank" href="http://lara.epfl.ch/~psuter/ScalaZ3/">Scala^Z3</a> and <a target="_blank" href="http://hackage.haskell.org/package/sbv">SBV</a>.</p>

<!--<p>
Be sure to follow along with the examples by clicking the <b>load in editor</b> link in the
corner. See what Z3Py says, try your own scripts, and experiment!
</p>-->

<p>
Please send feedback, comments and/or corrections to <a href="mailto:leonardo@microsoft.com">leonardo@microsoft.com</a>.
Your comments are very valuable.
</p>

<h2>Getting Started</h2>

<p>Let us start with the following simple example:</p>

<example pref="z3py.1">
<div><pre><span>x</span> <span>=</span> <span>Int</span><span>(</span><span>'x'</span><span>)</span>
<span>y</span> <span>=</span> <span>Int</span><span>(</span><span>'y'</span><span>)</span>
<span>solve</span><span>(</span><span>x</span> <span>&gt;</span> <span>2</span><span>,</span> <span>y</span> <span>&lt;</span> <span>10</span><span>,</span> <span>x</span> <span>+</span> <span>2</span><span>*</span><span>y</span> <span>==</span> <span>7</span><span>)</span>
</pre></div>
</example>

<p>The function <tt>Int('x')</tt> creates an integer variable in Z3 named <tt>x</tt>.
The <tt>solve</tt> function solves a system of constraints. The example above uses
two variables <tt>x</tt> and <tt>y</tt>, and three constraints.
Z3Py like Python uses <b>=</b> for assignment. The operators <tt>&lt;</tt>,
<tt>&lt;=</tt>,
<tt>&gt;</tt>,
<tt>&gt;=</tt>,
<tt>==</tt> and
<tt>!=</tt> for comparison.
In the example above, the expression <tt>x + 2*y  == 7</tt> is a Z3 constraint.
Z3 can solve and crunch formulas.
</p>

<p>
The next examples show how to use the Z3 formula/expression simplifier.
</p>

<example pref="z3py.2">
<div><pre><span>x</span> <span>=</span> <span>Int</span><span>(</span><span>'x'</span><span>)</span>
<span>y</span> <span>=</span> <span>Int</span><span>(</span><span>'y'</span><span>)</span>
<span>print</span> (<span>simplify</span><span>(</span><span>x</span> <span>+</span> <span>y</span> <span>+</span> <span>2</span><span>*</span><span>x</span> <span>+</span> <span>3</span><span>)</span>)
<span>print</span> (<span>simplify</span><span>(</span><span>x</span> <span>&lt;</span> <span>y</span> <span>+</span> <span>x</span> <span>+</span> <span>2</span><span>)</span>)
<span>print</span> (<span>simplify</span><span>(</span><span>And</span><span>(</span><span>x</span> <span>+</span> <span>1</span> <span>&gt;=</span> <span>3</span><span>,</span> <span>x</span><span>**</span><span>2</span> <span>+</span> <span>x</span><span>**</span><span>2</span> <span>+</span> <span>y</span><span>**</span><span>2</span> <span>+</span> <span>2</span> <span>&gt;=</span> <span>5</span><span>))</span>)
</pre></div>
</example>

<p>
By default, Z3Py (for the web) displays formulas and expressions using mathematical notation.
As usual, <tt>∧</tt> is the logical and, <tt>∨</tt> is the logical or, and so on.
The command <tt>set_option(html_mode=False)</tt> makes all formulas and expressions to be
displayed in Z3Py notation. This is also the default mode for the offline version of Z3Py that
comes with the Z3 distribution.
</p>

<example pref="printer">
<div><pre><span>x</span> <span>=</span> <span>Int</span><span>(</span><span>'x'</span><span>)</span>
<span>y</span> <span>=</span> <span>Int</span><span>(</span><span>'y'</span><span>)</span>
<span>print</span> (<span>x</span><span>**</span><span>2</span> <span>+</span> <span>y</span><span>**</span><span>2</span> <span>&gt;=</span> <span>1</span>)
<span>set_option</span><span>(</span><span>html_mode</span><span>=</span><span>False</span><span>)</span>
<span>print</span> (<span>x</span><span>**</span><span>2</span> <span>+</span> <span>y</span><span>**</span><span>2</span> <span>&gt;=</span> <span>1</span>)
</pre></div>
</example>

<p>
Z3 provides functions for traversing expressions.
</p>

<example pref="z3py.3">
<div><pre><span>x</span> <span>=</span> <span>Int</span><span>(</span><span>'x'</span><span>)</span>
<span>y</span> <span>=</span> <span>Int</span><span>(</span><span>'y'</span><span>)</span>
<span>n</span> <span>=</span> <span>x</span> <span>+</span> <span>y</span> <span>&gt;=</span> <span>3</span>
<span>print</span> (<span>"num args: "</span><span>,</span> <span>n</span><span>.</span><span>num_args</span><span>()</span>)
<span>print</span> (<span>"children: "</span><span>,</span> <span>n</span><span>.</span><span>children</span><span>()</span>)
<span>print</span> (<span>"1st child:"</span><span>,</span> <span>n</span><span>.</span><span>arg</span><span>(</span><span>0</span><span>)</span>)
<span>print</span> (<span>"2nd child:"</span><span>,</span> <span>n</span><span>.</span><span>arg</span><span>(</span><span>1</span><span>)</span>)
<span>print</span> (<span>"operator: "</span><span>,</span> <span>n</span><span>.</span><span>decl</span><span>()</span>)
<span>print</span> (<span>"op name:  "</span><span>,</span> <span>n</span><span>.</span><span>decl</span><span>()</span><span>.</span><span>name</span><span>()</span>)
</pre></div>
</example>

<p>
Z3 provides all basic mathematical operations. Z3Py uses the same operator precedence of the Python language.
Like Python, <tt>**</tt> is the power operator. Z3 can solve nonlinear <i>polynomial</i> constraints.
</p>

<example pref="z3py.4">
<div><pre><span>x</span> <span>=</span> <span>Real</span><span>(</span><span>'x'</span><span>)</span>
<span>y</span> <span>=</span> <span>Real</span><span>(</span><span>'y'</span><span>)</span>
<span>solve</span><span>(</span><span>x</span><span>**</span><span>2</span> <span>+</span> <span>y</span><span>**</span><span>2</span> <span>&gt;</span> <span>3</span><span>,</span> <span>x</span><span>**</span><span>3</span> <span>+</span> <span>y</span> <span>&lt;</span> <span>5</span><span>)</span>
</pre></div>
</example>

<p>
The procedure <tt>Real('x')</tt> creates the real variable <tt>x</tt>.
Z3Py can represent arbitrarily large integers, rational numbers (like in the example above),
and irrational algebraic numbers. An irrational algebraic number is a root of a polynomial with integer coefficients.
Internally, Z3 represents all these numbers precisely.
The irrational numbers are displayed in decimal notation for making it easy to read the results.
</p>

<example pref="z3py.5">
<div><pre><span>x</span> <span>=</span> <span>Real</span><span>(</span><span>'x'</span><span>)</span>
<span>y</span> <span>=</span> <span>Real</span><span>(</span><span>'y'</span><span>)</span>
<span>solve</span><span>(</span><span>x</span><span>**</span><span>2</span> <span>+</span> <span>y</span><span>**</span><span>2</span> <span>==</span> <span>3</span><span>,</span> <span>x</span><span>**</span><span>3</span> <span>==</span> <span>2</span><span>)</span>

<span>set_option</span><span>(</span><span>precision</span><span>=</span><span>30</span><span>)</span>
<span>print</span> (<span>"Solving, and displaying result with 30 decimal places"</span>)
<span>solve</span><span>(</span><span>x</span><span>**</span><span>2</span> <span>+</span> <span>y</span><span>**</span><span>2</span> <span>==</span> <span>3</span><span>,</span> <span>x</span><span>**</span><span>3</span> <span>==</span> <span>2</span><span>)</span>
</pre></div>
</example>

<p>
The procedure <tt>set_option</tt> is used to configure the Z3 environment. It is used to set global configuration options
such as how the result is displayed. The option <tt>set_option(precision=30)</tt> sets the number of decimal places used when displaying results.
The <tt>?</tt> mark in <tt>1.2599210498?</tt> indicates the output is truncated.
</p>

<p>
The following example demonstrates a common mistake. The expression <tt>3/2</tt> is a Python integer and not a Z3 rational number.
The example also shows different ways to create rational numbers in Z3Py. The procedure <tt>Q(num, den)</tt> creates a
Z3 rational where <tt>num</tt> is the numerator and <tt>den</tt> is the denominator. The <tt>RealVal(1)</tt> creates a Z3 real number
representing the number <tt>1</tt>.
</p>

<example pref="z3py.6">
<div><pre><span>print</span> (<span>1</span><span>/</span><span>3</span>)
<span>print</span> (<span>RealVal</span><span>(</span><span>1</span><span>)</span><span>/</span><span>3</span>)
<span>print</span> (<span>Q</span><span>(</span><span>1</span><span>,</span><span>3</span><span>)</span>)

<span>x</span> <span>=</span> <span>Real</span><span>(</span><span>'x'</span><span>)</span>
<span>print</span> (<span>x</span> <span>+</span> <span>1</span><span>/</span><span>3</span>)
<span>print</span> (<span>x</span> <span>+</span> <span>Q</span><span>(</span><span>1</span><span>,</span><span>3</span><span>)</span>)
<span>print</span> (<span>x</span> <span>+</span> <span>"1/3"</span>)
<span>print</span> (<span>x</span> <span>+</span> <span>0.25</span>)
</pre></div>
</example>

<p>
Rational numbers can also be displayed in decimal notation.
</p>

<example pref="z3py.6aa">
<div><pre><span>x</span> <span>=</span> <span>Real</span><span>(</span><span>'x'</span><span>)</span>
<span>solve</span><span>(</span><span>3</span><span>*</span><span>x</span> <span>==</span> <span>1</span><span>)</span>

<span>set_option</span><span>(</span><span>rational_to_decimal</span><span>=</span><span>True</span><span>)</span>
<span>solve</span><span>(</span><span>3</span><span>*</span><span>x</span> <span>==</span> <span>1</span><span>)</span>

<span>set_option</span><span>(</span><span>precision</span><span>=</span><span>30</span><span>)</span>
<span>solve</span><span>(</span><span>3</span><span>*</span><span>x</span> <span>==</span> <span>1</span><span>)</span>
</pre></div>
</example>

<p>
A system of constraints may not have a solution. In this case, we say the system is <b>unsatisfiable</b>.
</p>

<example pref="z3py.6a">
<div><pre><span>x</span> <span>=</span> <span>Real</span><span>(</span><span>'x'</span><span>)</span>
<span>solve</span><span>(</span><span>x</span> <span>&gt;</span> <span>4</span><span>,</span> <span>x</span> <span>&lt;</span> <span>0</span><span>)</span>
</pre></div>
</example>

<p>
Like in Python, comments begin with the hash character <tt>#</tt> and are terminated by the end of line.
Z3Py does not support comments that span more than one line.
</p>

<example pref="comment">
<div><pre><span># This is a comment</span>
<span>x</span> <span>=</span> <span>Real</span><span>(</span><span>'x'</span><span>)</span> <span># comment: creating x</span>
<span>print</span> (<span>x</span><span>**</span><span>2</span> <span>+</span> <span>2</span><span>*</span><span>x</span> <span>+</span> <span>2</span>  <span># comment: printing polynomial</span>)
</pre></div>
</example>

<h2>Boolean Logic</h2>

<p>
Z3 supports Boolean operators: <tt>And</tt>, <tt>Or</tt>, <tt>Not</tt>, <tt>Implies</tt> (implication),
<tt>If</tt> (if-then-else). Bi-implications are represented using equality <tt>==</tt>.
The following example shows how to solve a simple set of Boolean constraints.
</p>

<example pref="z3py.7">
<div><pre><span>p</span> <span>=</span> <span>Bool</span><span>(</span><span>'p'</span><span>)</span>
<span>q</span> <span>=</span> <span>Bool</span><span>(</span><span>'q'</span><span>)</span>
<span>r</span> <span>=</span> <span>Bool</span><span>(</span><span>'r'</span><span>)</span>
<span>solve</span><span>(</span><span>Implies</span><span>(</span><span>p</span><span>,</span> <span>q</span><span>),</span> <span>r</span> <span>==</span> <span>Not</span><span>(</span><span>q</span><span>),</span> <span>Or</span><span>(</span><span>Not</span><span>(</span><span>p</span><span>),</span> <span>r</span><span>))</span>

</pre></div>
</example>

<p>
The Python Boolean constants <tt>True</tt> and <tt>False</tt> can be used to build Z3 Boolean expressions.
</p>

<example pref="z3py.8">
<div><pre><span>p</span> <span>=</span> <span>Bool</span><span>(</span><span>'p'</span><span>)</span>
<span>q</span> <span>=</span> <span>Bool</span><span>(</span><span>'q'</span><span>)</span>
<span>print</span> (<span>And</span><span>(</span><span>p</span><span>,</span> <span>q</span><span>,</span> <span>True</span><span>)</span>)
<span>print</span> (<span>simplify</span><span>(</span><span>And</span><span>(</span><span>p</span><span>,</span> <span>q</span><span>,</span> <span>True</span><span>))</span>)
<span>print</span> (<span>simplify</span><span>(</span><span>And</span><span>(</span><span>p</span><span>,</span> <span>False</span><span>))</span>)
</pre></div>
</example>

<p>The following example uses a combination of polynomial and Boolean constraints.
</p>

<example pref="z3py.9">
<div><pre><span>p</span> <span>=</span> <span>Bool</span><span>(</span><span>'p'</span><span>)</span>
<span>x</span> <span>=</span> <span>Real</span><span>(</span><span>'x'</span><span>)</span>
<span>solve</span><span>(</span><span>Or</span><span>(</span><span>x</span> <span>&lt;</span> <span>5</span><span>,</span> <span>x</span> <span>&gt;</span> <span>10</span><span>),</span> <span>Or</span><span>(</span><span>p</span><span>,</span> <span>x</span><span>**</span><span>2</span> <span>==</span> <span>2</span><span>),</span> <span>Not</span><span>(</span><span>p</span><span>))</span>
</pre></div>
</example>

<h2>Solvers</h2>

<p>Z3 provides different solvers. The command <tt>solve</tt>, used in the previous examples, is implemented using the Z3 solver API.
The implementation can be found in the file <tt>z3.py</tt> in the Z3 distribution.
The following example demonstrates the basic Solver API.
</p>

<example pref="z3py.10">
<div><pre><span>x</span> <span>=</span> <span>Int</span><span>(</span><span>'x'</span><span>)</span>
<span>y</span> <span>=</span> <span>Int</span><span>(</span><span>'y'</span><span>)</span>

<span>s</span> <span>=</span> <span>Solver</span><span>()</span>
<span>print</span> (<span>s</span>)

<span>s</span><span>.</span><span>add</span><span>(</span><span>x</span> <span>&gt;</span> <span>10</span><span>,</span> <span>y</span> <span>==</span> <span>x</span> <span>+</span> <span>2</span><span>)</span>
<span>print</span> (<span>s</span>)
<span>print</span> (<span>"Solving constraints in the solver s ..."</span>)
<span>print</span> (<span>s</span><span>.</span><span>check</span><span>()</span>)

<span>print</span> (<span>"Create a new scope..."</span>)
<span>s</span><span>.</span><span>push</span><span>()</span>
<span>s</span><span>.</span><span>add</span><span>(</span><span>y</span> <span>&lt;</span> <span>11</span><span>)</span>
<span>print</span> (<span>s</span>)
<span>print</span> (<span>"Solving updated set of constraints..."</span>)
<span>print</span> (<span>s</span><span>.</span><span>check</span><span>()</span>)

<span>print</span> (<span>"Restoring state..."</span>)
<span>s</span><span>.</span><span>pop</span><span>()</span>
<span>print</span> (<span>s</span>)
<span>print</span> (<span>"Solving restored set of constraints..."</span>)
<span>print</span> (<span>s</span><span>.</span><span>check</span><span>()</span>)
</pre></div>
</example>

<p>
The command <tt>Solver()</tt> creates a general purpose solver. Constraints can be added using the method <tt>add</tt>.
We say the constraints have been <b>asserted</b> in the solver. The method <tt>check()</tt> solves the asserted constraints.
The result is <tt>sat</tt> (satisfiable) if a solution was found. The result is <tt>unsat</tt> (unsatisfiable) if
no solution exists. We may also say the system of asserted constraints is <b>infeasible</b>. Finally, a solver may fail
to solve a system of constraints and <tt>unknown</tt> is returned.
</p>

<p>
In some applications, we want to explore several similar problems that share several constraints.
We can use the commands <tt>push</tt> and <tt>pop</tt> for doing that.
Each solver maintains a stack of assertions. The command <tt>push</tt> creates a new scope by
saving the current stack size.
The command <tt>pop</tt> removes any assertion performed between it and the matching <tt>push</tt>.
The <tt>check</tt> method always operates on the content of solver assertion stack.
</p>

<p>
The following example shows an example that Z3 cannot solve. The solver returns <tt>unknown</tt> in this case.
Recall that Z3 can solve nonlinear polynomial constraints, but <tt>2**x</tt> is not a polynomial.
</p>

<example pref="z3py.11">
<div><pre><span>x</span> <span>=</span> <span>Real</span><span>(</span><span>'x'</span><span>)</span>
<span>s</span> <span>=</span> <span>Solver</span><span>()</span>
<span>s</span><span>.</span><span>add</span><span>(</span><span>2</span><span>**</span><span>x</span> <span>==</span> <span>3</span><span>)</span>
<span>print</span> (<span>s</span><span>.</span><span>check</span><span>()</span>)
</pre></div>
</example>

<p>
The following example shows how to traverse the constraints asserted into a solver, and how to collect performance statistics for
the <tt>check</tt> method.
</p>

<example pref="z3py.12">
<div><pre><span>x</span> <span>=</span> <span>Real</span><span>(</span><span>'x'</span><span>)</span>
<span>y</span> <span>=</span> <span>Real</span><span>(</span><span>'y'</span><span>)</span>
<span>s</span> <span>=</span> <span>Solver</span><span>()</span>
<span>s</span><span>.</span><span>add</span><span>(</span><span>x</span> <span>&gt;</span> <span>1</span><span>,</span> <span>y</span> <span>&gt;</span> <span>1</span><span>,</span> <span>Or</span><span>(</span><span>x</span> <span>+</span> <span>y</span> <span>&gt;</span> <span>3</span><span>,</span> <span>x</span> <span>-</span> <span>y</span> <span>&lt;</span> <span>2</span><span>))</span>
<span>print</span> (<span>"asserted constraints..."</span>)
<span>for</span> <span>c</span> <span>in</span> <span>s</span><span>.</span><span>assertions</span><span>():</span>
    <span>print</span> (<span>c</span>)

<span>print</span> (<span>s</span><span>.</span><span>check</span><span>()</span>)
<span>print</span> (<span>"statistics for the last check method..."</span>)
<span>print</span> (<span>s</span><span>.</span><span>statistics</span><span>()</span>)
<span># Traversing statistics</span>
<span>for</span> <span>k</span><span>,</span> <span>v</span> <span>in</span> <span>s</span><span>.</span><span>statistics</span><span>():</span>
    <span>print</span> (<span>"</span><span>%s</span><span> : </span><span>%s</span><span>"</span> <span>%</span> <span>(</span><span>k</span><span>,</span> <span>v</span><span>)</span>)
</pre></div>
</example>

<p>
The command <tt>check</tt> returns <tt>sat</tt> when Z3 finds a solution for the set of asserted constraints.
We say Z3 <b>satisfied</b> the set of constraints. We say the solution is a <b>model</b> for the set of asserted
constraints. A model is an <b>interpretation</b> that makes each asserted constraint <b>true</b>.
The following example shows the basic methods for inspecting models.
</p>

<example pref="z3py.13">
<div><pre><span>x</span><span>,</span> <span>y</span><span>,</span> <span>z</span> <span>=</span> <span>Reals</span><span>(</span><span>'x y z'</span><span>)</span>
<span>s</span> <span>=</span> <span>Solver</span><span>()</span>
<span>s</span><span>.</span><span>add</span><span>(</span><span>x</span> <span>&gt;</span> <span>1</span><span>,</span> <span>y</span> <span>&gt;</span> <span>1</span><span>,</span> <span>x</span> <span>+</span> <span>y</span> <span>&gt;</span> <span>3</span><span>,</span> <span>z</span> <span>-</span> <span>x</span> <span>&lt;</span> <span>10</span><span>)</span>
<span>print</span> (<span>s</span><span>.</span><span>check</span><span>()</span>)

<span>m</span> <span>=</span> <span>s</span><span>.</span><span>model</span><span>()</span>
<span>print</span> (<span>"x = </span><span>%s</span><span>"</span> <span>%</span> <span>m</span><span>[</span><span>x</span><span>]</span>)

<span>print</span> (<span>"traversing model..."</span>)
<span>for</span> <span>d</span> <span>in</span> <span>m</span><span>.</span><span>decls</span><span>():</span>
    <span>print</span> (<span>"</span><span>%s</span><span> = </span><span>%s</span><span>"</span> <span>%</span> <span>(</span><span>d</span><span>.</span><span>name</span><span>(),</span> <span>m</span><span>[</span><span>d</span><span>])</span>)
</pre></div>
</example>

<p>In the example above, the function <tt>Reals('x y z')</tt> creates the variables. <tt>x</tt>, <tt>y</tt> and <tt>z</tt>.
It is shorthand for:
</p>

<pre>x = Real('x')
y = Real('y')
z = Real('z')
</pre>

<p>
The expression <tt>m[x]</tt> returns the interpretation of <tt>x</tt> in the model <tt>m</tt>.
The expression <tt>"%s = %s" % (d.name(), m[d])</tt> returns a string where the first <tt>%s</tt> is replaced with
the name of <tt>d</tt> (i.e., <tt>d.name()</tt>), and the second <tt>%s</tt> with a textual representation of the
interpretation of <tt>d</tt> (i.e., <tt>m[d]</tt>). Z3Py automatically converts Z3 objects into a textual representation
when needed.
</p>

<h2>Arithmetic</h2>

<p>Z3 supports real and integer variables. They can be mixed in a single problem.
Like most programming languages, Z3Py will automatically add coercions converting integer expressions to real ones when needed.
The following example demonstrates different ways to declare integer and real variables.
</p>

<example pref="arith.1">
<div><pre><span>x</span> <span>=</span> <span>Real</span><span>(</span><span>'x'</span><span>)</span>
<span>y</span> <span>=</span> <span>Int</span><span>(</span><span>'y'</span><span>)</span>
<span>a</span><span>,</span> <span>b</span><span>,</span> <span>c</span> <span>=</span> <span>Reals</span><span>(</span><span>'a b c'</span><span>)</span>
<span>s</span><span>,</span> <span>r</span> <span>=</span> <span>Ints</span><span>(</span><span>'s r'</span><span>)</span>
<span>print</span> (<span>x</span> <span>+</span> <span>y</span> <span>+</span> <span>1</span> <span>+</span> <span>(</span><span>a</span> <span>+</span> <span>s</span><span>)</span>)
<span>print</span> (<span>ToReal</span><span>(</span><span>y</span><span>)</span> <span>+</span> <span>c</span>)
</pre></div>
</example>

<p>The function <tt>ToReal</tt> casts an integer expression into a real expression.</p>

<p>Z3Py supports all basic arithmetic operations.</p>

<example pref="arith.2">
<div><pre><span>a</span><span>,</span> <span>b</span><span>,</span> <span>c</span> <span>=</span> <span>Ints</span><span>(</span><span>'a b c'</span><span>)</span>
<span>d</span><span>,</span> <span>e</span> <span>=</span> <span>Reals</span><span>(</span><span>'d e'</span><span>)</span>
<span>solve</span><span>(</span><span>a</span> <span>&gt;</span> <span>b</span> <span>+</span> <span>2</span><span>,</span>
      <span>a</span> <span>==</span> <span>2</span><span>*</span><span>c</span> <span>+</span> <span>10</span><span>,</span>
      <span>c</span> <span>+</span> <span>b</span> <span>&lt;=</span> <span>1000</span><span>,</span>
      <span>d</span> <span>&gt;=</span> <span>e</span><span>)</span>
</pre></div>
</example>

<p>The command <tt>simplify</tt> applies simple transformations on Z3 expressions.</p>

<example pref="arith.3">
<div><pre><span>x</span><span>,</span> <span>y</span> <span>=</span> <span>Reals</span><span>(</span><span>'x y'</span><span>)</span>
<span># Put expression in sum-of-monomials form</span>
<span>t</span> <span>=</span> <span>simplify</span><span>((</span><span>x</span> <span>+</span> <span>y</span><span>)</span><span>**</span><span>3</span><span>,</span> <span>som</span><span>=</span><span>True</span><span>)</span>
<span>print</span> (<span>t</span>)
<span># Use power operator</span>
<span>t</span> <span>=</span> <span>simplify</span><span>(</span><span>t</span><span>,</span> <span>mul_to_power</span><span>=</span><span>True</span><span>)</span>
<span>print</span> (<span>t</span>)
</pre></div>
</example>

<p>The command <tt>help_simplify()</tt> prints all available options.
Z3Py allows users to write option in two styles. The Z3 internal option names start with <tt>:</tt> and words are separated by <tt>-</tt>.
These options can be used in Z3Py. Z3Py also supports Python-like names,
where <tt>:</tt> is suppressed and <tt>-</tt> is replaced with <tt>_</tt>.
The following example demonstrates how to use both styles.
</p>

<example pref="arith.4">
<div><pre><span>x</span><span>,</span> <span>y</span> <span>=</span> <span>Reals</span><span>(</span><span>'x y'</span><span>)</span>
<span># Using Z3 native option names</span>
<span>print</span> (<span>simplify</span><span>(</span><span>x</span> <span>==</span> <span>y</span> <span>+</span> <span>2</span><span>,</span> <span>':arith-lhs'</span><span>,</span> <span>True</span><span>)</span>)
<span># Using Z3Py option names</span>
<span>print</span> (<span>simplify</span><span>(</span><span>x</span> <span>==</span> <span>y</span> <span>+</span> <span>2</span><span>,</span> <span>arith_lhs</span><span>=</span><span>True</span><span>)</span>)

<span>print</span> (<span>"</span><span>\n</span><span>All available options:"</span>)
<span>help_simplify</span><span>()</span>
</pre></div>
</example>

<p>Z3Py supports arbitrarily large numbers. The following example demonstrates how to perform basic arithmetic using larger integer, rational and irrational numbers.
Z3Py only supports <a target="”_blank”" href="http://en.wikipedia.org/wiki/Algebraic_number">algebraic irrational numbers</a>. Algebraic irrational numbers are sufficient for presenting the solutions of systems of polynomial constraints.
Z3Py will always display irrational numbers in decimal notation since it  is more convenient to read. The internal representation can be extracted using the method <tt>sexpr()</tt>.
It displays Z3 internal representation for mathematical formulas and expressions in <a target="_blank" href="http://en.wikipedia.org/wiki/S-expression">s-expression</a> (Lisp-like) notation.
</p>

<example pref="arith.5">
<div><pre><span>x</span><span>,</span> <span>y</span> <span>=</span> <span>Reals</span><span>(</span><span>'x y'</span><span>)</span>
<span>solve</span><span>(</span><span>x</span> <span>+</span> <span>10000000000000000000000</span> <span>==</span> <span>y</span><span>,</span> <span>y</span> <span>&gt;</span> <span>20000000000000000</span><span>)</span>

<span>print</span> (<span>Sqrt</span><span>(</span><span>2</span><span>)</span> <span>+</span> <span>Sqrt</span><span>(</span><span>3</span><span>)</span>)
<span>print</span> (<span>simplify</span><span>(</span><span>Sqrt</span><span>(</span><span>2</span><span>)</span> <span>+</span> <span>Sqrt</span><span>(</span><span>3</span><span>))</span>)
<span>print</span> (<span>simplify</span><span>(</span><span>Sqrt</span><span>(</span><span>2</span><span>)</span> <span>+</span> <span>Sqrt</span><span>(</span><span>3</span><span>))</span><span>.</span><span>sexpr</span><span>()</span>)
<span># The sexpr() method is available for any Z3 expression</span>
<span>print</span> (<span>(</span><span>x</span> <span>+</span> <span>Sqrt</span><span>(</span><span>y</span><span>)</span> <span>*</span> <span>2</span><span>)</span><span>.</span><span>sexpr</span><span>()</span>)
</pre></div>
</example>

<h2>Machine Arithmetic</h2>

<p>
Modern CPUs and main-stream programming languages use
arithmetic over fixed-size bit-vectors.
Machine arithmetic is available in Z3Py as <i>Bit-Vectors</i>.
They implement the
precise semantics of unsigned and of
signed <a target="_blank" href="http://en.wikipedia.org/wiki/Two's_complement">two-complements arithmetic</a>.

</p>
<p>
The following example demonstrates how to create bit-vector variables and constants.
The function <tt>BitVec('x', 16)</tt> creates a bit-vector variable in Z3 named <tt>x</tt> with <tt>16</tt> bits.
For convenience, integer constants can be used to create bit-vector expressions in Z3Py.
The function <tt>BitVecVal(10, 32)</tt> creates a bit-vector of size <tt>32</tt> containing the value <tt>10</tt>.
</p>

<example pref="bitvec.1">
<div><pre><span>x</span> <span>=</span> <span>BitVec</span><span>(</span><span>'x'</span><span>,</span> <span>16</span><span>)</span>
<span>y</span> <span>=</span> <span>BitVec</span><span>(</span><span>'y'</span><span>,</span> <span>16</span><span>)</span>
<span>print</span> (<span>x</span> <span>+</span> <span>2</span>)
<span># Internal representation</span>
<span>print</span> (<span>(</span><span>x</span> <span>+</span> <span>2</span><span>)</span><span>.</span><span>sexpr</span><span>()</span>)

<span># -1 is equal to 65535 for 16-bit integers </span>
<span>print</span> (<span>simplify</span><span>(</span><span>x</span> <span>+</span> <span>y</span> <span>-</span> <span>1</span><span>)</span>)

<span># Creating bit-vector constants</span>
<span>a</span> <span>=</span> <span>BitVecVal</span><span>(</span><span>-</span><span>1</span><span>,</span> <span>16</span><span>)</span>
<span>b</span> <span>=</span> <span>BitVecVal</span><span>(</span><span>65535</span><span>,</span> <span>16</span><span>)</span>
<span>print</span> (<span>simplify</span><span>(</span><span>a</span> <span>==</span> <span>b</span><span>)</span>)

<span>a</span> <span>=</span> <span>BitVecVal</span><span>(</span><span>-</span><span>1</span><span>,</span> <span>32</span><span>)</span>
<span>b</span> <span>=</span> <span>BitVecVal</span><span>(</span><span>65535</span><span>,</span> <span>32</span><span>)</span>
<span># -1 is not equal to 65535 for 32-bit integers </span>
<span>print</span> (<span>simplify</span><span>(</span><span>a</span> <span>==</span> <span>b</span><span>)</span>)
</pre></div>
</example>

<p>
In contrast to programming languages, such as C, C++, C#, Java,
there is no distinction between signed and unsigned bit-vectors
as numbers. Instead, Z3 provides special signed versions of arithmetical operations
where it makes a difference whether the bit-vector is treated as signed or unsigned.
In Z3Py, the operators
<tt>&lt;</tt>,
<tt>&lt;=</tt>,
<tt>&gt;</tt>,
<tt>&gt;=</tt>, <tt>/</tt>, <tt>%</tt> and <tt>&gt;&gt;</tt> correspond to the signed versions.
The corresponding unsigned operators are
<tt>ULT</tt>,
<tt>ULE</tt>,
<tt>UGT</tt>,
<tt>UGE</tt>, <tt>UDiv</tt>, <tt>URem</tt> and <tt>LShR</tt>.
</p>

<example pref="bitvec.2">
<div><pre><span># Create to bit-vectors of size 32</span>
<span>x</span><span>,</span> <span>y</span> <span>=</span> <span>BitVecs</span><span>(</span><span>'x y'</span><span>,</span> <span>32</span><span>)</span>

<span>solve</span><span>(</span><span>x</span> <span>+</span> <span>y</span> <span>==</span> <span>2</span><span>,</span> <span>x</span> <span>&gt;</span> <span>0</span><span>,</span> <span>y</span> <span>&gt;</span> <span>0</span><span>)</span>

<span># Bit-wise operators</span>
<span># &amp; bit-wise and</span>
<span># | bit-wise or</span>
<span># ~ bit-wise not</span>
<span>solve</span><span>(</span><span>x</span> <span>&amp;</span> <span>y</span> <span>==</span> <span>~</span><span>y</span><span>)</span>

<span>solve</span><span>(</span><span>x</span> <span>&lt;</span> <span>0</span><span>)</span>

<span># using unsigned version of &lt; </span>
<span>solve</span><span>(</span><span>ULT</span><span>(</span><span>x</span><span>,</span> <span>0</span><span>))</span>
</pre></div>
</example>

<p>
The operator <tt>&gt;&gt;</tt> is the arithmetic shift right, and
<tt>&lt;&lt;</tt> is the shift left. The logical shift right is the operator <tt>LShR</tt>.
</p>

<example pref="bitvec.3">
<div><pre><span># Create to bit-vectors of size 32</span>
<span>x</span><span>,</span> <span>y</span> <span>=</span> <span>BitVecs</span><span>(</span><span>'x y'</span><span>,</span> <span>32</span><span>)</span>

<span>solve</span><span>(</span><span>x</span> <span>&gt;&gt;</span> <span>2</span> <span>==</span> <span>3</span><span>)</span>

<span>solve</span><span>(</span><span>x</span> <span>&lt;&lt;</span> <span>2</span> <span>==</span> <span>3</span><span>)</span>

<span>solve</span><span>(</span><span>x</span> <span>&lt;&lt;</span> <span>2</span> <span>==</span> <span>24</span><span>)</span>
</pre></div>
</example>

<h2>Functions</h2>

<p>
Unlike programming languages, where functions have side-effects, can throw exceptions,
or never return, functions in Z3 have no side-effects and are <b>total</b>.
That is, they are defined on all input values. This includes functions, such
as division. Z3 is based on <a target="_blank" href="http://en.wikipedia.org/wiki/First-order_logic">first-order logic</a>.
</p>

<p>
Given a constraints such as <tt>x + y &gt; 3</tt>, we have been saying that <tt>x</tt> and <tt>y</tt>
are variables. In many textbooks, <tt>x</tt> and <tt>y</tt> are called uninterpreted constants.
That is, they allow any interpretation that is consistent with the constraint <tt>x + y &gt; 3</tt>.
</p>

<p>
More precisely, function and constant symbols in pure first-order logic are <i>uninterpreted</i> or <i>free</i>,
which means that no a priori interpretation is attached.
This is in contrast to functions belonging to the signature of theories,
such as arithmetic where the function <tt>+</tt> has a fixed standard interpretation
(it adds two numbers). Uninterpreted functions and constants are maximally flexible;
they allow any interpretation that is consistent with the constraints over the function or constant.
</p>

<p>
To illustrate uninterpreted functions and constants let us the uninterpreted integer constants (aka variables)
<tt>x</tt>, <tt>y</tt>. Finally let <tt>f</tt> be an uninterpreted function that takes one argument of type (aka sort) integer
and results in an integer value.
The example illustrates how one can force an interpretation where <tt>f</tt>
applied twice to <tt>x</tt> results in <tt>x</tt> again, but <tt>f</tt> applied once to <tt>x</tt> is different from <tt>x</tt>.
</p>

<example pref="z3py.14">
<div><pre><span>x</span> <span>=</span> <span>Int</span><span>(</span><span>'x'</span><span>)</span>
<span>y</span> <span>=</span> <span>Int</span><span>(</span><span>'y'</span><span>)</span>
<span>f</span> <span>=</span> <span>Function</span><span>(</span><span>'f'</span><span>,</span> <span>IntSort</span><span>(),</span> <span>IntSort</span><span>())</span>
<span>solve</span><span>(</span><span>f</span><span>(</span><span>f</span><span>(</span><span>x</span><span>))</span> <span>==</span> <span>x</span><span>,</span> <span>f</span><span>(</span><span>x</span><span>)</span> <span>==</span> <span>y</span><span>,</span> <span>x</span> <span>!=</span> <span>y</span><span>)</span>
</pre></div>
</example>

<p>The solution (interpretation) for <tt>f</tt> should be read as <tt>f(0)</tt> is <tt>1</tt>, <tt>f(1)</tt> is <tt>0</tt>, and <tt>f(a)</tt>
is <tt>1</tt> for all <tt>a</tt> different from <tt>0</tt> and <tt>1</tt>.
</p>

<p>In Z3, we can also evaluate expressions in the model for a system of constraints. The following example shows how to
use the <tt>evaluate</tt> method.</p>

<example pref="z3py.15">
<div><pre><span>x</span> <span>=</span> <span>Int</span><span>(</span><span>'x'</span><span>)</span>
<span>y</span> <span>=</span> <span>Int</span><span>(</span><span>'y'</span><span>)</span>
<span>f</span> <span>=</span> <span>Function</span><span>(</span><span>'f'</span><span>,</span> <span>IntSort</span><span>(),</span> <span>IntSort</span><span>())</span>
<span>s</span> <span>=</span> <span>Solver</span><span>()</span>
<span>s</span><span>.</span><span>add</span><span>(</span><span>f</span><span>(</span><span>f</span><span>(</span><span>x</span><span>))</span> <span>==</span> <span>x</span><span>,</span> <span>f</span><span>(</span><span>x</span><span>)</span> <span>==</span> <span>y</span><span>,</span> <span>x</span> <span>!=</span> <span>y</span><span>)</span>
<span>print</span> (<span>s</span><span>.</span><span>check</span><span>()</span>)
<span>m</span> <span>=</span> <span>s</span><span>.</span><span>model</span><span>()</span>
<span>print</span> (<span>"f(f(x)) ="</span><span>,</span> <span>m</span><span>.</span><span>evaluate</span><span>(</span><span>f</span><span>(</span><span>f</span><span>(</span><span>x</span><span>)))</span>)
<span>print</span> (<span>"f(x)    ="</span><span>,</span> <span>m</span><span>.</span><span>evaluate</span><span>(</span><span>f</span><span>(</span><span>x</span><span>))</span>)
</pre></div>
</example>

<h2>Satisfiability and Validity</h2>

<p>A formula/constraint <tt>F</tt> is <b>valid</b> if <tt>F</tt> always evaluates to true for any assignment of appropriate values to its
uninterpreted symbols.
A formula/constraint <tt>F</tt> is <b>satisfiable</b> if there is some assignment of appropriate values
to its uninterpreted  symbols under which <tt>F</tt> evaluates to true.
Validity is about finding a proof of a statement; satisfiability is about finding a solution to a set of constraints.
Consider a formula <tt>F</tt> containing <tt>a</tt> and <tt>b</tt>.
We can ask whether <tt>F</tt> is valid, that is whether it is always true for any combination of values for
<tt>a</tt> and <tt>b</tt>. If <tt>F</tt> is always
true, then <tt>Not(F)</tt> is always false, and then <tt>Not(F)</tt> will not have any satisfying assignment (i.e., solution); that is,
<tt>Not(F)</tt> is unsatisfiable. That is,
<tt>F</tt> is valid precisely when <tt>Not(F)</tt> is not satisfiable (is unsatisfiable).
Alternately,
<tt>F</tt> is satisfiable if and only if <tt>Not(F)</tt> is not valid (is invalid).
The following example proves the deMorgan's law.
</p>

<p>The following example redefines the Z3Py function <tt>prove</tt> that receives a formula as a parameter.
This function creates a solver, adds/asserts the negation of the formula, and check if the negation is unsatisfiable.
The implementation of this function is a simpler version of the Z3Py command <tt>prove</tt>.
</p>

<example pref="z3py.16">
<div><pre><span>p</span><span>,</span> <span>q</span> <span>=</span> <span>Bools</span><span>(</span><span>'p q'</span><span>)</span>
<span>demorgan</span> <span>=</span> <span>And</span><span>(</span><span>p</span><span>,</span> <span>q</span><span>)</span> <span>==</span> <span>Not</span><span>(</span><span>Or</span><span>(</span><span>Not</span><span>(</span><span>p</span><span>),</span> <span>Not</span><span>(</span><span>q</span><span>)))</span>
<span>print</span> (<span>demorgan</span>)

<span>def</span> <span>prove</span><span>(</span><span>f</span><span>):</span>
    <span>s</span> <span>=</span> <span>Solver</span><span>()</span>
    <span>s</span><span>.</span><span>add</span><span>(</span><span>Not</span><span>(</span><span>f</span><span>))</span>
    <span>if</span> <span>s</span><span>.</span><span>check</span><span>()</span> <span>==</span> <span>unsat</span><span>:</span>
        <span>print</span> (<span>"proved"</span>)
    <span>else</span><span>:</span>
        <span>print</span> (<span>"failed to prove"</span>)

<span>print</span> (<span>"Proving demorgan..."</span>)
<span>prove</span><span>(</span><span>demorgan</span><span>)</span>
</pre></div>
</example>

<h2>List Comprehensions</h2>

<p>
Python supports <a target="_blank" href="http://docs.python.org/tutorial/datastructures.html#list-comprehensions">list comprehensions</a>.
List comprehensions provide a concise way to create lists. They can be used to create Z3 expressions and problems in Z3Py.
The following example demonstrates how to use Python list comprehensions in Z3Py.
</p>

<example pref="list.1">
<div><pre><span># Create list [1, ..., 5] </span>
<span>print</span> (<span>[</span> <span>x</span> <span>+</span> <span>1</span> <span>for</span> <span>x</span> <span>in</span> <span>range</span><span>(</span><span>5</span><span>)</span> <span>]</span>)

<span># Create two lists containing 5 integer variables</span>
<span>X</span> <span>=</span> <span>[</span> <span>Int</span><span>(</span><span>'x</span><span>%s</span><span>'</span> <span>%</span> <span>i</span><span>)</span> <span>for</span> <span>i</span> <span>in</span> <span>range</span><span>(</span><span>5</span><span>)</span> <span>]</span>
<span>Y</span> <span>=</span> <span>[</span> <span>Int</span><span>(</span><span>'y</span><span>%s</span><span>'</span> <span>%</span> <span>i</span><span>)</span> <span>for</span> <span>i</span> <span>in</span> <span>range</span><span>(</span><span>5</span><span>)</span> <span>]</span>
<span>print</span> (<span>X</span>)

<span># Create a list containing X[i]+Y[i]</span>
<span>X_plus_Y</span> <span>=</span> <span>[</span> <span>X</span><span>[</span><span>i</span><span>]</span> <span>+</span> <span>Y</span><span>[</span><span>i</span><span>]</span> <span>for</span> <span>i</span> <span>in</span> <span>range</span><span>(</span><span>5</span><span>)</span> <span>]</span>
<span>print</span> (<span>X_plus_Y</span>)

<span># Create a list containing X[i] &gt; Y[i]</span>
<span>X_gt_Y</span> <span>=</span> <span>[</span> <span>X</span><span>[</span><span>i</span><span>]</span> <span>&gt;</span> <span>Y</span><span>[</span><span>i</span><span>]</span> <span>for</span> <span>i</span> <span>in</span> <span>range</span><span>(</span><span>5</span><span>)</span> <span>]</span>
<span>print</span> (<span>X_gt_Y</span>)

<span>print</span> (<span>And</span><span>(</span><span>X_gt_Y</span><span>)</span>)

<span># Create a 3x3 "matrix" (list of lists) of integer variables</span>
<span>X</span> <span>=</span> <span>[</span> <span>[</span> <span>Int</span><span>(</span><span>"x_</span><span>%s</span><span>_</span><span>%s</span><span>"</span> <span>%</span> <span>(</span><span>i</span><span>+</span><span>1</span><span>,</span> <span>j</span><span>+</span><span>1</span><span>))</span> <span>for</span> <span>j</span> <span>in</span> <span>range</span><span>(</span><span>3</span><span>)</span> <span>]</span>
      <span>for</span> <span>i</span> <span>in</span> <span>range</span><span>(</span><span>3</span><span>)</span> <span>]</span>
<span>pp</span><span>(</span><span>X</span><span>)</span>
</pre></div>
</example>

<p>In the example above, the expression <tt>"x%s" % i</tt> returns a string where <tt>%s</tt> is replaced with the value of <tt>i</tt>.</p>

<p>The command <tt>pp</tt> is similar to <tt>print</tt>, but it uses Z3Py formatter for lists and tuples instead of Python's formatter.</p>

<p>Z3Py also provides functions for creating vectors of Boolean, Integer and Real variables. These functions
are implemented using list comprehensions.
</p>

<example pref="list.2">
<div><pre><span>X</span> <span>=</span> <span>IntVector</span><span>(</span><span>'x'</span><span>,</span> <span>5</span><span>)</span>
<span>Y</span> <span>=</span> <span>RealVector</span><span>(</span><span>'y'</span><span>,</span> <span>5</span><span>)</span>
<span>P</span> <span>=</span> <span>BoolVector</span><span>(</span><span>'p'</span><span>,</span> <span>5</span><span>)</span>
<span>print</span> (<span>X</span>)
<span>print</span> (<span>Y</span>)
<span>print</span> (<span>P</span>)
<span>print</span> (<span>[</span> <span>y</span><span>**</span><span>2</span> <span>for</span> <span>y</span> <span>in</span> <span>Y</span> <span>]</span>)
<span>print</span> (<span>Sum</span><span>([</span> <span>y</span><span>**</span><span>2</span> <span>for</span> <span>y</span> <span>in</span> <span>Y</span> <span>])</span>)
</pre></div>
</example>

<h2>Kinematic Equations</h2>

<p>
In high school, students learn the kinematic equations.
These equations describe the mathematical relationship between <b>displacement</b> (<tt>d</tt>),
<b>time</b> (<tt>t</tt>), <b>acceleration</b> (<tt>a</tt>), <b>initial velocity</b> (<tt>v_i</tt>) and <b>final velocity</b> (<tt>v_f</tt>).
In Z3Py notation, we can write these equations as:
</p>
<pre>   d == v_i * t + (a*t**2)/2,
   v_f == v_i + a*t
</pre>

<h3>Problem 1</h3>

<p>
Ima Hurryin is approaching a stoplight moving with a velocity of <tt>30.0</tt> m/s.
The light turns yellow, and Ima applies the brakes and skids to a stop.
If Ima's acceleration is <tt>-8.00</tt> m/s<sup>2</sup>, then determine the displacement of the
car during the skidding process.
</p>

<example pref="k.1">
<div><pre><span>d</span><span>,</span> <span>a</span><span>,</span> <span>t</span><span>,</span> <span>v_i</span><span>,</span> <span>v_f</span> <span>=</span> <span>Reals</span><span>(</span><span>'d a t v__i v__f'</span><span>)</span>

<span>equations</span> <span>=</span> <span>[</span>
   <span>d</span> <span>==</span> <span>v_i</span> <span>*</span> <span>t</span> <span>+</span> <span>(</span><span>a</span><span>*</span><span>t</span><span>**</span><span>2</span><span>)</span><span>/</span><span>2</span><span>,</span>
   <span>v_f</span> <span>==</span> <span>v_i</span> <span>+</span> <span>a</span><span>*</span><span>t</span><span>,</span>
<span>]</span>
<span>print</span> (<span>"Kinematic equations:"</span>)
<span>print</span> (<span>equations</span>)

<span># Given v_i, v_f and a, find d</span>
<span>problem</span> <span>=</span> <span>[</span>
    <span>v_i</span> <span>==</span> <span>30</span><span>,</span>
    <span>v_f</span> <span>==</span> <span>0</span><span>,</span>
    <span>a</span>   <span>==</span> <span>-</span><span>8</span>
<span>]</span>
<span>print</span> (<span>"Problem:"</span>)
<span>print</span> (<span>problem</span>)

<span>print</span> (<span>"Solution:"</span>)
<span>solve</span><span>(</span><span>equations</span> <span>+</span> <span>problem</span><span>)</span>
</pre></div>
</example>


<h3>Problem 2</h3>

<p>
Ben Rushin is waiting at a stoplight. When it finally turns green, Ben accelerated from rest at a rate of
a <tt>6.00</tt> m/s<sup>2</sup> for a time of <tt>4.10</tt> seconds. Determine the displacement of Ben's car during this time period.
</p>

<example pref="k.2">
<div><pre><span>d</span><span>,</span> <span>a</span><span>,</span> <span>t</span><span>,</span> <span>v_i</span><span>,</span> <span>v_f</span> <span>=</span> <span>Reals</span><span>(</span><span>'d a t v__i v__f'</span><span>)</span>

<span>equations</span> <span>=</span> <span>[</span>
   <span>d</span> <span>==</span> <span>v_i</span> <span>*</span> <span>t</span> <span>+</span> <span>(</span><span>a</span><span>*</span><span>t</span><span>**</span><span>2</span><span>)</span><span>/</span><span>2</span><span>,</span>
   <span>v_f</span> <span>==</span> <span>v_i</span> <span>+</span> <span>a</span><span>*</span><span>t</span><span>,</span>
<span>]</span>

<span># Given v_i, t and a, find d</span>
<span>problem</span> <span>=</span> <span>[</span>
    <span>v_i</span> <span>==</span> <span>0</span><span>,</span>
    <span>t</span>   <span>==</span> <span>4.10</span><span>,</span>
    <span>a</span>   <span>==</span> <span>6</span>
<span>]</span>

<span>solve</span><span>(</span><span>equations</span> <span>+</span> <span>problem</span><span>)</span>

<span># Display rationals in decimal notation</span>
<span>set_option</span><span>(</span><span>rational_to_decimal</span><span>=</span><span>True</span><span>)</span>

<span>solve</span><span>(</span><span>equations</span> <span>+</span> <span>problem</span><span>)</span>
</pre></div>
</example>

<h2>Bit Tricks</h2>

<p>Some low level <a target="_blank" href="http://graphics.stanford.edu/~seander/bithacks.html">hacks</a> are very popular with C programmers.
We use some of these hacks in the Z3 implementation.
</p>

<h3>Power of two</h3>

<p>This hack is frequently used in C programs (Z3 included) to test whether a machine integer is a power of two.
We can use Z3 to prove it really works. The claim is that <tt>x != 0 &amp;&amp; !(x &amp; (x - 1))</tt> is true if and only if <tt>x</tt>
is a power of two.
</p>

<example pref="bit.1">
<div><pre><span>x</span>      <span>=</span> <span>BitVec</span><span>(</span><span>'x'</span><span>,</span> <span>32</span><span>)</span>
<span>powers</span> <span>=</span> <span>[</span> <span>2</span><span>**</span><span>i</span> <span>for</span> <span>i</span> <span>in</span> <span>range</span><span>(</span><span>32</span><span>)</span> <span>]</span>
<span>fast</span>   <span>=</span> <span>And</span><span>(</span><span>x</span> <span>!=</span> <span>0</span><span>,</span> <span>x</span> <span>&amp;</span> <span>(</span><span>x</span> <span>-</span> <span>1</span><span>)</span> <span>==</span> <span>0</span><span>)</span>
<span>slow</span>   <span>=</span> <span>Or</span><span>([</span> <span>x</span> <span>==</span> <span>p</span> <span>for</span> <span>p</span> <span>in</span> <span>powers</span> <span>])</span>
<span>print</span> (<span>fast</span>)
<span>prove</span><span>(</span><span>fast</span> <span>==</span> <span>slow</span><span>)</span>

<span>print</span> (<span>"trying to prove buggy version..."</span>)
<span>fast</span>   <span>=</span> <span>x</span> <span>&amp;</span> <span>(</span><span>x</span> <span>-</span> <span>1</span><span>)</span> <span>==</span> <span>0</span>
<span>prove</span><span>(</span><span>fast</span> <span>==</span> <span>slow</span><span>)</span>
</pre></div>
</example>

<h3>Opposite signs</h3>

<p>The following simple hack can be used to test whether two machine integers have opposite signs.</p>

<example pref="bit.2">
<div><pre><span>x</span>      <span>=</span> <span>BitVec</span><span>(</span><span>'x'</span><span>,</span> <span>32</span><span>)</span>
<span>y</span>      <span>=</span> <span>BitVec</span><span>(</span><span>'y'</span><span>,</span> <span>32</span><span>)</span>

<span># Claim: (x ^ y) &lt; 0 iff x and y have opposite signs</span>
<span>trick</span>  <span>=</span> <span>(</span><span>x</span> <span>^</span> <span>y</span><span>)</span> <span>&lt;</span> <span>0</span>

<span># Naive way to check if x and y have opposite signs</span>
<span>opposite</span> <span>=</span> <span>Or</span><span>(</span><span>And</span><span>(</span><span>x</span> <span>&lt;</span> <span>0</span><span>,</span> <span>y</span> <span>&gt;=</span> <span>0</span><span>),</span>
              <span>And</span><span>(</span><span>x</span> <span>&gt;=</span> <span>0</span><span>,</span> <span>y</span> <span>&lt;</span> <span>0</span><span>))</span>

<span>prove</span><span>(</span><span>trick</span> <span>==</span> <span>opposite</span><span>)</span>
</pre></div>
</example>

<h2>Puzzles</h2>

<h3>Dog, Cat and Mouse</h3>

<p>Consider the following puzzle. Spend exactly 100 dollars and buy exactly 100 animals.
Dogs cost 15 dollars, cats cost 1 dollar, and mice cost 25 cents each.
You have to buy at least one of each.
How many of each should you buy?
</p>

<example pref="puzzle.1">
<div><pre><span># Create 3 integer variables</span>
<span>dog</span><span>,</span> <span>cat</span><span>,</span> <span>mouse</span> <span>=</span> <span>Ints</span><span>(</span><span>'dog cat mouse'</span><span>)</span>
<span>solve</span><span>(</span><span>dog</span> <span>&gt;=</span> <span>1</span><span>,</span>   <span># at least one dog</span>
      <span>cat</span> <span>&gt;=</span> <span>1</span><span>,</span>   <span># at least one cat</span>
      <span>mouse</span> <span>&gt;=</span> <span>1</span><span>,</span> <span># at least one mouse</span>
      <span># we want to buy 100 animals</span>
      <span>dog</span> <span>+</span> <span>cat</span> <span>+</span> <span>mouse</span> <span>==</span> <span>100</span><span>,</span>
      <span># We have 100 dollars (10000 cents):</span>
      <span>#   dogs cost 15 dollars (1500 cents), </span>
      <span>#   cats cost 1 dollar (100 cents), and </span>
      <span>#   mice cost 25 cents </span>
      <span>1500</span> <span>*</span> <span>dog</span> <span>+</span> <span>100</span> <span>*</span> <span>cat</span> <span>+</span> <span>25</span> <span>*</span> <span>mouse</span> <span>==</span> <span>10000</span><span>)</span>
</pre></div>
</example>

<h3>Sudoku</h3>

<p><a target="_blank" href="http://www.dailysudoku.com/sudoku/">Sudoku</a> is a very popular puzzle.
The goal is to insert the numbers in the boxes to satisfy only one condition: each row, column and
<tt>3x3</tt> box must contain the digits <tt>1</tt> through <tt>9</tt> exactly once.
</p>

<img src="https://ericpony.github.io/z3py-tutorial/examples/sudoku.png">

<p>
The following example encodes the sudoku problem in Z3. Different sudoku instances can be solved
by modifying the matrix <tt>instance</tt>. This example makes heavy use of
<a target="_blank" href="http://docs.python.org/tutorial/datastructures.html#list-comprehensions">list comprehensions</a>
available in the Python programming language.
</p>

<example pref="puzzle.2">
<div><pre><span># 9x9 matrix of integer variables</span>
<span>X</span> <span>=</span> <span>[</span> <span>[</span> <span>Int</span><span>(</span><span>"x_</span><span>%s</span><span>_</span><span>%s</span><span>"</span> <span>%</span> <span>(</span><span>i</span><span>+</span><span>1</span><span>,</span> <span>j</span><span>+</span><span>1</span><span>))</span> <span>for</span> <span>j</span> <span>in</span> <span>range</span><span>(</span><span>9</span><span>)</span> <span>]</span>
      <span>for</span> <span>i</span> <span>in</span> <span>range</span><span>(</span><span>9</span><span>)</span> <span>]</span>

<span># each cell contains a value in {1, ..., 9}</span>
<span>cells_c</span>  <span>=</span> <span>[</span> <span>And</span><span>(</span><span>1</span> <span>&lt;=</span> <span>X</span><span>[</span><span>i</span><span>][</span><span>j</span><span>],</span> <span>X</span><span>[</span><span>i</span><span>][</span><span>j</span><span>]</span> <span>&lt;=</span> <span>9</span><span>)</span>
             <span>for</span> <span>i</span> <span>in</span> <span>range</span><span>(</span><span>9</span><span>)</span> <span>for</span> <span>j</span> <span>in</span> <span>range</span><span>(</span><span>9</span><span>)</span> <span>]</span>

<span># each row contains a digit at most once</span>
<span>rows_c</span>   <span>=</span> <span>[</span> <span>Distinct</span><span>(</span><span>X</span><span>[</span><span>i</span><span>])</span> <span>for</span> <span>i</span> <span>in</span> <span>range</span><span>(</span><span>9</span><span>)</span> <span>]</span>

<span># each column contains a digit at most once</span>
<span>cols_c</span>   <span>=</span> <span>[</span> <span>Distinct</span><span>([</span> <span>X</span><span>[</span><span>i</span><span>][</span><span>j</span><span>]</span> <span>for</span> <span>i</span> <span>in</span> <span>range</span><span>(</span><span>9</span><span>)</span> <span>])</span>
             <span>for</span> <span>j</span> <span>in</span> <span>range</span><span>(</span><span>9</span><span>)</span> <span>]</span>

<span># each 3x3 square contains a digit at most once</span>
<span>sq_c</span>     <span>=</span> <span>[</span> <span>Distinct</span><span>([</span> <span>X</span><span>[</span><span>3</span><span>*</span><span>i0</span> <span>+</span> <span>i</span><span>][</span><span>3</span><span>*</span><span>j0</span> <span>+</span> <span>j</span><span>]</span>
                        <span>for</span> <span>i</span> <span>in</span> <span>range</span><span>(</span><span>3</span><span>)</span> <span>for</span> <span>j</span> <span>in</span> <span>range</span><span>(</span><span>3</span><span>)</span> <span>])</span>
             <span>for</span> <span>i0</span> <span>in</span> <span>range</span><span>(</span><span>3</span><span>)</span> <span>for</span> <span>j0</span> <span>in</span> <span>range</span><span>(</span><span>3</span><span>)</span> <span>]</span>

<span>sudoku_c</span> <span>=</span> <span>cells_c</span> <span>+</span> <span>rows_c</span> <span>+</span> <span>cols_c</span> <span>+</span> <span>sq_c</span>

<span># sudoku instance, we use '0' for empty cells</span>
<span>instance</span> <span>=</span> <span>((</span><span>0</span><span>,</span><span>0</span><span>,</span><span>0</span><span>,</span><span>0</span><span>,</span><span>9</span><span>,</span><span>4</span><span>,</span><span>0</span><span>,</span><span>3</span><span>,</span><span>0</span><span>),</span>
            <span>(</span><span>0</span><span>,</span><span>0</span><span>,</span><span>0</span><span>,</span><span>5</span><span>,</span><span>1</span><span>,</span><span>0</span><span>,</span><span>0</span><span>,</span><span>0</span><span>,</span><span>7</span><span>),</span>
            <span>(</span><span>0</span><span>,</span><span>8</span><span>,</span><span>9</span><span>,</span><span>0</span><span>,</span><span>0</span><span>,</span><span>0</span><span>,</span><span>0</span><span>,</span><span>4</span><span>,</span><span>0</span><span>),</span>
            <span>(</span><span>0</span><span>,</span><span>0</span><span>,</span><span>0</span><span>,</span><span>0</span><span>,</span><span>0</span><span>,</span><span>0</span><span>,</span><span>2</span><span>,</span><span>0</span><span>,</span><span>8</span><span>),</span>
            <span>(</span><span>0</span><span>,</span><span>6</span><span>,</span><span>0</span><span>,</span><span>2</span><span>,</span><span>0</span><span>,</span><span>1</span><span>,</span><span>0</span><span>,</span><span>5</span><span>,</span><span>0</span><span>),</span>
            <span>(</span><span>1</span><span>,</span><span>0</span><span>,</span><span>2</span><span>,</span><span>0</span><span>,</span><span>0</span><span>,</span><span>0</span><span>,</span><span>0</span><span>,</span><span>0</span><span>,</span><span>0</span><span>),</span>
            <span>(</span><span>0</span><span>,</span><span>7</span><span>,</span><span>0</span><span>,</span><span>0</span><span>,</span><span>0</span><span>,</span><span>0</span><span>,</span><span>5</span><span>,</span><span>2</span><span>,</span><span>0</span><span>),</span>
            <span>(</span><span>9</span><span>,</span><span>0</span><span>,</span><span>0</span><span>,</span><span>0</span><span>,</span><span>6</span><span>,</span><span>5</span><span>,</span><span>0</span><span>,</span><span>0</span><span>,</span><span>0</span><span>),</span>
            <span>(</span><span>0</span><span>,</span><span>4</span><span>,</span><span>0</span><span>,</span><span>9</span><span>,</span><span>7</span><span>,</span><span>0</span><span>,</span><span>0</span><span>,</span><span>0</span><span>,</span><span>0</span><span>))</span>

<span>instance_c</span> <span>=</span> <span>[</span> <span>If</span><span>(</span><span>instance</span><span>[</span><span>i</span><span>][</span><span>j</span><span>]</span> <span>==</span> <span>0</span><span>,</span>
                  <span>True</span><span>,</span>
                  <span>X</span><span>[</span><span>i</span><span>][</span><span>j</span><span>]</span> <span>==</span> <span>instance</span><span>[</span><span>i</span><span>][</span><span>j</span><span>])</span>
               <span>for</span> <span>i</span> <span>in</span> <span>range</span><span>(</span><span>9</span><span>)</span> <span>for</span> <span>j</span> <span>in</span> <span>range</span><span>(</span><span>9</span><span>)</span> <span>]</span>

<span>s</span> <span>=</span> <span>Solver</span><span>()</span>
<span>s</span><span>.</span><span>add</span><span>(</span><span>sudoku_c</span> <span>+</span> <span>instance_c</span><span>)</span>
<span>if</span> <span>s</span><span>.</span><span>check</span><span>()</span> <span>==</span> <span>sat</span><span>:</span>
    <span>m</span> <span>=</span> <span>s</span><span>.</span><span>model</span><span>()</span>
    <span>r</span> <span>=</span> <span>[</span> <span>[</span> <span>m</span><span>.</span><span>evaluate</span><span>(</span><span>X</span><span>[</span><span>i</span><span>][</span><span>j</span><span>])</span> <span>for</span> <span>j</span> <span>in</span> <span>range</span><span>(</span><span>9</span><span>)</span> <span>]</span>
          <span>for</span> <span>i</span> <span>in</span> <span>range</span><span>(</span><span>9</span><span>)</span> <span>]</span>
    <span>print_matrix</span><span>(</span><span>r</span><span>)</span>
<span>else</span><span>:</span>
    <span>print</span> (<span>"failed to solve"</span>)
</pre></div>
</example>

<h3>Eight Queens</h3>

<p>
The eight queens puzzle is the problem of placing eight chess queens on an 8x8 chessboard so that no two queens attack each other.
Thus, a solution requires that no two queens share the same row, column, or diagonal.
</p>

<p> <img src="https://ericpony.github.io/z3py-tutorial/examples/queens.png">
</p>

<example pref="puzzle.3">
<div><pre><span># We know each queen must be in a different row.</span>
<span># So, we represent each queen by a single integer: the column position</span>
<span>Q</span> <span>=</span> <span>[</span> <span>Int</span><span>(</span><span>'Q_</span><span>%i</span><span>'</span> <span>%</span> <span>(</span><span>i</span> <span>+</span> <span>1</span><span>))</span> <span>for</span> <span>i</span> <span>in</span> <span>range</span><span>(</span><span>8</span><span>)</span> <span>]</span>

<span># Each queen is in a column {1, ... 8 }</span>
<span>val_c</span> <span>=</span> <span>[</span> <span>And</span><span>(</span><span>1</span> <span>&lt;=</span> <span>Q</span><span>[</span><span>i</span><span>],</span> <span>Q</span><span>[</span><span>i</span><span>]</span> <span>&lt;=</span> <span>8</span><span>)</span> <span>for</span> <span>i</span> <span>in</span> <span>range</span><span>(</span><span>8</span><span>)</span> <span>]</span>

<span># At most one queen per column</span>
<span>col_c</span> <span>=</span> <span>[</span> <span>Distinct</span><span>(</span><span>Q</span><span>)</span> <span>]</span>

<span># Diagonal constraint</span>
<span>diag_c</span> <span>=</span> <span>[</span> <span>If</span><span>(</span><span>i</span> <span>==</span> <span>j</span><span>,</span>
              <span>True</span><span>,</span>
              <span>And</span><span>(</span><span>Q</span><span>[</span><span>i</span><span>]</span> <span>-</span> <span>Q</span><span>[</span><span>j</span><span>]</span> <span>!=</span> <span>i</span> <span>-</span> <span>j</span><span>,</span> <span>Q</span><span>[</span><span>i</span><span>]</span> <span>-</span> <span>Q</span><span>[</span><span>j</span><span>]</span> <span>!=</span> <span>j</span> <span>-</span> <span>i</span><span>))</span>
           <span>for</span> <span>i</span> <span>in</span> <span>range</span><span>(</span><span>8</span><span>)</span> <span>for</span> <span>j</span> <span>in</span> <span>range</span><span>(</span><span>i</span><span>)</span> <span>]</span>

<span>solve</span><span>(</span><span>val_c</span> <span>+</span> <span>col_c</span> <span>+</span> <span>diag_c</span><span>)</span>
</pre></div>
</example>

<h2>Application: Install Problem</h2>

<p>The <b>install problem</b> consists of determining whether a new set of packages can be installed in a system.
This application is based on the article
<a target="_blank" href="http://cseweb.ucsd.edu/~rjhala/papers/opium.pdf">OPIUM: Optimal Package Install/Uninstall Manager</a>.
Many packages depend on other packages to provide some functionality.
Each distribution contains a meta-data file that
explicates the requirements of each package of the distribution.
The meta-data contains details like the name, version, etc. More importantly, it contains
<b>depends</b> and <b>conflicts</b>
clauses that stipulate which other packages should be on the
system. The depends clauses stipulate which other packages must be present.
The conflicts clauses stipulate which other packages must not be present.
</p>

<p>The install problem can be easily solved using Z3. The idea is to define a Boolean variable for each
package. This variable is true if the package must be in the system. If package <tt>a</tt> depends on
packages <tt>b</tt>, <tt>c</tt> and <tt>z</tt>, we write:
</p>

<pre>DependsOn(a, [b, c, z])
</pre>

<p><tt>DependsOn</tt> is a simple Python function that creates Z3 constraints that capture the
depends clause semantics.
</p>

<pre>def DependsOn(pack, deps):
   return And([ Implies(pack, dep) for dep in deps ])
</pre>

<p>
Thus, <tt>Depends(a, [b, c, z])</tt> generates the constraint
</p>

<pre>And(Implies(a, b), Implies(a, c), Implies(a, z))
</pre>

<p>That is, if users install package <tt>a</tt>, they must also install packages
<tt>b</tt>, <tt>c</tt> and <tt>z</tt>.
</p>

<p>
If package <tt>d</tt> conflicts with package <tt>e</tt>, we write <tt>Conflict(d, e)</tt>.
<tt>Conflict</tt> is also a simple Python function.
</p>

<pre>def Conflict(p1, p2):
    return Or(Not(p1), Not(p2))
</pre>

<p><tt>Conflict(d, e)</tt> generates the constraint <tt>Or(Not(d), Not(e))</tt>.
With these two functions, we can easily encode the example in the
<a target="_blank" href="http://cseweb.ucsd.edu/~rjhala/papers/opium.pdf">Opium article</a> (Section 2) in Z3Py as:
</p>

<example pref="install.1">
<div><pre><span>def</span> <span>DependsOn</span><span>(</span><span>pack</span><span>,</span> <span>deps</span><span>):</span>
    <span>return</span> <span>And</span><span>([</span> <span>Implies</span><span>(</span><span>pack</span><span>,</span> <span>dep</span><span>)</span> <span>for</span> <span>dep</span> <span>in</span> <span>deps</span> <span>])</span>

<span>def</span> <span>Conflict</span><span>(</span><span>p1</span><span>,</span> <span>p2</span><span>):</span>
    <span>return</span> <span>Or</span><span>(</span><span>Not</span><span>(</span><span>p1</span><span>),</span> <span>Not</span><span>(</span><span>p2</span><span>))</span>

<span>a</span><span>,</span> <span>b</span><span>,</span> <span>c</span><span>,</span> <span>d</span><span>,</span> <span>e</span><span>,</span> <span>f</span><span>,</span> <span>g</span><span>,</span> <span>z</span> <span>=</span> <span>Bools</span><span>(</span><span>'a b c d e f g z'</span><span>)</span>

<span>solve</span><span>(</span><span>DependsOn</span><span>(</span><span>a</span><span>,</span> <span>[</span><span>b</span><span>,</span> <span>c</span><span>,</span> <span>z</span><span>]),</span>
      <span>DependsOn</span><span>(</span><span>b</span><span>,</span> <span>[</span><span>d</span><span>]),</span>
      <span>DependsOn</span><span>(</span><span>c</span><span>,</span> <span>[</span><span>Or</span><span>(</span><span>d</span><span>,</span> <span>e</span><span>),</span> <span>Or</span><span>(</span><span>f</span><span>,</span> <span>g</span><span>)]),</span>
      <span>Conflict</span><span>(</span><span>d</span><span>,</span> <span>e</span><span>),</span>
      <span>a</span><span>,</span> <span>z</span><span>)</span>
</pre></div>
</example>

<p>
Note that the example contains the constraint
</p>

<pre>DependsOn(c, [Or(d, e), Or(f, g)]),
</pre>

<p>
The meaning is: to install <tt>c</tt>, we must install <tt>d</tt> or <tt>e</tt>, and <tt>f</tt> or <tt>g</tt>
</p>

<p>Now, we refine the previous example. First, we modify <tt>DependsOn</tt> to allow
us to write <tt>DependsOn(b, d)</tt> instead of <tt>DependsOn(b, [d])</tt>. We also
write a function <tt>install_check</tt> that returns a list of packages that must be installed
in the system. The function <tt>Conflict</tt> is also modified. It can now receive multiple
arguments.
</p>

<example pref="install.2">
<div><pre><span>def</span> <span>DependsOn</span><span>(</span><span>pack</span><span>,</span> <span>deps</span><span>):</span>
    <span>if</span> <span>is_expr</span><span>(</span><span>deps</span><span>):</span>
        <span>return</span> <span>Implies</span><span>(</span><span>pack</span><span>,</span> <span>deps</span><span>)</span>
    <span>else</span><span>:</span>
        <span>return</span> <span>And</span><span>([</span> <span>Implies</span><span>(</span><span>pack</span><span>,</span> <span>dep</span><span>)</span> <span>for</span> <span>dep</span> <span>in</span> <span>deps</span> <span>])</span>

<span>def</span> <span>Conflict</span><span>(</span><span>*</span><span>packs</span><span>):</span>
    <span>return</span> <span>Or</span><span>([</span> <span>Not</span><span>(</span><span>pack</span><span>)</span> <span>for</span> <span>pack</span> <span>in</span> <span>packs</span> <span>])</span>

<span>a</span><span>,</span> <span>b</span><span>,</span> <span>c</span><span>,</span> <span>d</span><span>,</span> <span>e</span><span>,</span> <span>f</span><span>,</span> <span>g</span><span>,</span> <span>z</span> <span>=</span> <span>Bools</span><span>(</span><span>'a b c d e f g z'</span><span>)</span>

<span>def</span> <span>install_check</span><span>(</span><span>*</span><span>problem</span><span>):</span>
    <span>s</span> <span>=</span> <span>Solver</span><span>()</span>
    <span>s</span><span>.</span><span>add</span><span>(</span><span>*</span><span>problem</span><span>)</span>
    <span>if</span> <span>s</span><span>.</span><span>check</span><span>()</span> <span>==</span> <span>sat</span><span>:</span>
        <span>m</span> <span>=</span> <span>s</span><span>.</span><span>model</span><span>()</span>
        <span>r</span> <span>=</span> <span>[]</span>
        <span>for</span> <span>x</span> <span>in</span> <span>m</span><span>:</span>
            <span>if</span> <span>is_true</span><span>(</span><span>m</span><span>[</span><span>x</span><span>]):</span>
                <span># x is a Z3 declaration</span>
                <span># x() returns the Z3 expression</span>
                <span># x.name() returns a string</span>
                <span>r</span><span>.</span><span>append</span><span>(</span><span>x</span><span>())</span>
        <span>print</span> (<span>r</span>)
    <span>else</span><span>:</span>
        <span>print</span> (<span>"invalid installation profile"</span>)

<span>print</span> (<span>"Check 1"</span>)
<span>install_check</span><span>(</span><span>DependsOn</span><span>(</span><span>a</span><span>,</span> <span>[</span><span>b</span><span>,</span> <span>c</span><span>,</span> <span>z</span><span>]),</span>
              <span>DependsOn</span><span>(</span><span>b</span><span>,</span> <span>d</span><span>),</span>
              <span>DependsOn</span><span>(</span><span>c</span><span>,</span> <span>[</span><span>Or</span><span>(</span><span>d</span><span>,</span> <span>e</span><span>),</span> <span>Or</span><span>(</span><span>f</span><span>,</span> <span>g</span><span>)]),</span>
              <span>Conflict</span><span>(</span><span>d</span><span>,</span> <span>e</span><span>),</span>
              <span>Conflict</span><span>(</span><span>d</span><span>,</span> <span>g</span><span>),</span>
              <span>a</span><span>,</span> <span>z</span><span>)</span>

<span>print</span> (<span>"Check 2"</span>)
<span>install_check</span><span>(</span><span>DependsOn</span><span>(</span><span>a</span><span>,</span> <span>[</span><span>b</span><span>,</span> <span>c</span><span>,</span> <span>z</span><span>]),</span>
              <span>DependsOn</span><span>(</span><span>b</span><span>,</span> <span>d</span><span>),</span>
              <span>DependsOn</span><span>(</span><span>c</span><span>,</span> <span>[</span><span>Or</span><span>(</span><span>d</span><span>,</span> <span>e</span><span>),</span> <span>Or</span><span>(</span><span>f</span><span>,</span> <span>g</span><span>)]),</span>
              <span>Conflict</span><span>(</span><span>d</span><span>,</span> <span>e</span><span>),</span>
              <span>Conflict</span><span>(</span><span>d</span><span>,</span> <span>g</span><span>),</span>
              <span>a</span><span>,</span> <span>z</span><span>,</span> <span>g</span><span>)</span>
</pre></div>
</example>

<h2>Using Z3Py Locally</h2>

<p>Z3Py is part of the Z3 distribution. It is located in the <tt>python</tt> subdirectory.
To use it locally, you have to include the following command in your Python script.</p>
<pre>from Z3 import *
</pre>
<p>
The Z3 Python frontend directory must be in your <tt>PYTHONPATH</tt> environment variable.
Z3Py will automatically search for the Z3 library (<tt>z3.dll</tt> (Windows), <tt>libz3.so</tt> (Linux), or <tt>libz3.dylib</tt> (OSX)).
You may also initialize Z3Py manually using the command:
</p>
<pre>init("z3.dll")
</pre>



</div>]]></description>
        </item>
    </channel>
</rss>