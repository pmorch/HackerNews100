<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
    <channel>
        <title>HN100 - Readable Contents</title>
        <link>https://hn.algolia.com/api/v1/search_by_date?tags=%28story,poll%29&amp;numericFilters=points%3E100</link>
        <description>Uses Readability to add bodies to the RSS feed</description>
        <lastBuildDate>Mon, 02 Sep 2024 07:30:03 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[1M Users (255 pts)]]></title>
            <link>https://blog.spacehey.com/entry?id=1245177</link>
            <guid>41422311</guid>
            <pubDate>Mon, 02 Sep 2024 03:13:08 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://blog.spacehey.com/entry?id=1245177">https://blog.spacehey.com/entry?id=1245177</a>, See on <a href="https://news.ycombinator.com/item?id=41422311">Hacker News</a></p>
<div id="readability-page-1" class="page"><div itemprop="articleBody">
      <p>Hello everyone - it's been a while!</p><p>I was super busy with 
university and my mandatory internship in a software company for the 
past 6 months, so I haven't posted in a while. But that doesn't mean 
that I was inactive - I spent nearly every evening and every weekend 
working on SpaceHey. I didn't develop any new ground-breaking features, 
but instead I focused on improving the overall SpaceHey experience - 
making it smoother, more stable, easier to use and safer.</p><p>But before I get into the details, let's have a look at a huge milestone first: SpaceHey hit 1 Million registered users!! That's crazy!!<br></p><h2>1 Million users</h2><p>I
 launched SpaceHey at the end of 2020 - I had just graduated high-school,
 and the world was on Covid lockdown. I made SpaceHey, so my generation 
could experience the early days of social media - without a feed, likes 
and whatnot - but instead with colorful, customizable profiles, bulletins and forums. I didn't plan to create anything <i>big</i> - I just had some fun creating this site and improving my coding skills at the same time.</p><p>Still, three and a half years later - SpaceHey has indeed become <i>big</i>.
 One million people is an incredibly huge number of people - it's&nbsp; simply crazy! If someone would've told my 18-year-old self in 2020, I 
would've never believed them. And yet - here we are. I am so incredibly 
thankful for all the support over the past three and a half years - the 
friends I made along the way and the lessons I've learned - both in 
running a community as big as this one as well as the technical challenges that came along.</p><p>One
 million people from all over the world have used SpaceHey so far - an 
independently run platform that does not track you and does not show 
you personalized feeds nor ads. My mission is not to become another big 
social network like <i>Facebook</i> or <i>Twitter</i> (I don't think 
I'll ever call it "X") - but rather trying to be different. More 
personal, more fun to use, and more humane. And I'm proud to say that 
this mission is still very much alive - no matter if there were 500 
users or 1,000,000.<br></p><p>If you like SpaceHey and want to support the platform, you can support me <a href="https://spacehey.com/support" target="_self" rel="ugc">here</a>, and there is also a special #1 Million Merch drop available <a href="https://shop.spacehey.com/" target="_self" rel="ugc">here</a>
 to support SpaceHey. Your support - no matter if it's a donation or a 
Merch order - is what keeps SpaceHey running: thank you!!<br></p><h2>Improving SpaceHey</h2><p>I've
 stopped myself from working on any new features in the past months, but
 rather improve the existing ones and make SpaceHey overall a bit 
smoother. It wasn't easy - but I think it was worth it. You may have 
already noticed less downtime and less App crashes in the past weeks - 
and there are some more improvements coming soon.</p><p>I'm now also 
starting to work on some new features again - which is super fun - and I can't 
wait to share more with you soon (T8 👀) - so stay tuned!<br></p><h2>Keeping SpaceHey safe</h2><p>Another
 big topic I worked on in the past months is safety. As more and more 
people joined SpaceHey, the bots and spammers also increased. Spam, 
hate speech, and other kinds of harmful content has no place on SpaceHey -
 that's why a solution was needed, and eventually found.<br></p><p>The 
solution isn't actually one solution - but a combination of multiple. On
 the one hand, I've implemented more ways to prevent spam in the first 
place - and on the other hand, I've developed more ways to combat 
existing spam. I've expanded the <a href="https://spacehey.com/modapplication" target="_self" rel="ugc">volunteer moderation team</a> and improved the ways the team can discover spam, react to <a href="https://spacehey.com/report" target="_self" rel="ugc">reports</a>
 and keep track of rule violations. I am immensely thankful to the 
volunteers helping me, and I think we are on a great path to keep 
SpaceHey safe.</p><p>If you come across harmful content on SpaceHey, 
please click the "Report" icon next to it, and we'll check it. Thank you
 for doing your part!<br></p><h2>The next steps</h2><p>I am super 
thrilled to keep working on SpaceHey - there are so many awesome, 
talented and fun people here. I can't wait to keep improving the site 
and the App and keep working on some great new features in the near 
future. I am super happy to have you all here, and I hope you are 
enjoying this journey as much as I do!<br></p><h2>Thank you!</h2><p>Last but not least, a <b>huge thank you</b> to every single one of you - you are the people who make SpaceHey what it is - you make it awesome. Thank you so, so much!<br></p><p>Have an awesome day &amp; thank you for using SpaceHey!<br><i>An</i><br></p>
    </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Tbsp – treesitter-based source processing language (107 pts)]]></title>
            <link>https://git.peppe.rs/languages/tbsp/</link>
            <guid>41421650</guid>
            <pubDate>Mon, 02 Sep 2024 01:04:16 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://git.peppe.rs/languages/tbsp/">https://git.peppe.rs/languages/tbsp/</a>, See on <a href="https://news.ycombinator.com/item?id=41421650">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><table summary="repository info"><tbody><tr><th>Branch</th><th>Commit message</th><th>Author</th><th colspan="2">Age</th></tr>
<tr><td><a href="https://git.peppe.rs/languages/tbsp/log/">master</a></td><td><a href="https://git.peppe.rs/languages/tbsp/commit/">add lists and index exprs</a></td><td>Akshay</td><td colspan="2"><span title="2024-08-23 23:00:52 +0100">9 days</span></td></tr>
<tr><td colspan="5">&nbsp;</td></tr><tr><td colspan="5">&nbsp;</td></tr><tr><th>Age</th><th>Commit message</th><th>Author</th><th>Files</th><th>Lines</th></tr>
<tr><td><span title="2024-08-23 23:00:52 +0100">9 days</span></td><td><a href="https://git.peppe.rs/languages/tbsp/commit/?id=1702f955a4546828cd535be6cecad57b90128de8">add lists and index exprs</a><span><a href="https://git.peppe.rs/languages/tbsp/commit/?id=1702f955a4546828cd535be6cecad57b90128de8">HEAD</a><a href="https://git.peppe.rs/languages/tbsp/log/">master</a></span></td><td>Akshay</td><td>3</td><td><span>-13</span>/<span>+229</span></td></tr>
<tr><td><span title="2024-08-08 22:19:14 +0100">2024-08-08</span></td><td><a href="https://git.peppe.rs/languages/tbsp/commit/?id=32de8bd5dac80a2c09e7106144cab5a8e16accc4">store nodes as usize</a></td><td>Akshay</td><td>4</td><td><span>-82</span>/<span>+170</span></td></tr>
<tr><td><span title="2024-08-05 21:52:22 +0100">2024-08-05</span></td><td><a href="https://git.peppe.rs/languages/tbsp/commit/?id=3ad5ba1f6d3f4c5944bbf29a7d761c93cf3740e3">add string::substr</a></td><td>Akshay</td><td>3</td><td><span>-12</span>/<span>+150</span></td></tr>
<tr><td><span title="2024-07-14 21:00:26 +0100">2024-07-14</span></td><td><a href="https://git.peppe.rs/languages/tbsp/commit/?id=ba102d6162d046f7ed7b139355e81da0c9f89acb">add usage and roadmap to readme</a></td><td>Akshay</td><td>1</td><td><span>-0</span>/<span>+56</span></td></tr>
<tr><td><span title="2024-07-14 19:39:41 +0100">2024-07-14</span></td><td><a href="https://git.peppe.rs/languages/tbsp/commit/?id=52ea89604e1bc2f7b38698e38ee256218e879a08">fix link to tree-viz</a></td><td>Akshay</td><td>1</td><td><span>-1</span>/<span>+1</span></td></tr>
<tr><td><span title="2024-07-14 14:00:55 +0100">2024-07-14</span></td><td><a href="https://git.peppe.rs/languages/tbsp/commit/?id=58b651418ee59eb576595718439352f244b23ddc">add readme</a></td><td>Akshay</td><td>2</td><td><span>-1</span>/<span>+149</span></td></tr>
<tr><td><span title="2024-07-14 13:01:23 +0100">2024-07-14</span></td><td><a href="https://git.peppe.rs/languages/tbsp/commit/?id=9ad06d721c1e481c82b4f43df819d76e35757282">add examples</a></td><td>Akshay</td><td>8</td><td><span>-0</span>/<span>+260</span></td></tr>
<tr><td><span title="2024-07-14 13:00:51 +0100">2024-07-14</span></td><td><a href="https://git.peppe.rs/languages/tbsp/commit/?id=83b537bb860643ebdabc43ab47cb8645da8a2e6d">rename: trawk -&gt; tbsp</a></td><td>Akshay</td><td>4</td><td><span>-155</span>/<span>+307</span></td></tr>
<tr><td><span title="2024-07-14 10:16:15 +0100">2024-07-14</span></td><td><a href="https://git.peppe.rs/languages/tbsp/commit/?id=7ae7e42eb1eb981483cc4183368bec4932b8f1c2">add trawk cli</a></td><td>Akshay</td><td>6</td><td><span>-71</span>/<span>+297</span></td></tr>
<tr><td><span title="2024-07-13 18:32:41 +0100">2024-07-13</span></td><td><a href="https://git.peppe.rs/languages/tbsp/commit/?id=8eb38033e0c615983c4490354dad4abb00031042">init trawk</a></td><td>Akshay</td><td>8</td><td><span>-0</span>/<span>+1862</span></td></tr>
<tr><td colspan="5">&nbsp;</td></tr><tr><th colspan="5">Clone</th></tr>
<tr><td colspan="5"><a rel="vcs-git" href="https://git.peppe.rs/languages/tbsp" title="tbsp Git repository">https://git.peppe.rs/languages/tbsp</a></td></tr>
</tbody></table></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Extreme Pi Boot Optimization (302 pts)]]></title>
            <link>https://kittenlabs.de/blog/2024/09/01/extreme-pi-boot-optimization/</link>
            <guid>41420597</guid>
            <pubDate>Sun, 01 Sep 2024 21:36:55 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://kittenlabs.de/blog/2024/09/01/extreme-pi-boot-optimization/">https://kittenlabs.de/blog/2024/09/01/extreme-pi-boot-optimization/</a>, See on <a href="https://news.ycombinator.com/item?id=41420597">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><p>🚀 3.5 sec to Linux userspace code</p><h3 id="motivation">Motivation<a href="#motivation" aria-label="Heading self-link"></a></h3><p>A while ago, the <a href="https://kittenlabs.de/solarcampi/">SolarCamPi</a> project, a off-grid solar-powered WiFi camera, was built.</p><p>In this project, a Raspberry Pi Zero 2 W is being booted into Linux, a picture is taken, WiFi connectivity is established and the Pi is shut down again (to save power).
This repeats every couple of minutes to always deliver a fresh image to a cloud service.</p><p><img src="https://kittenlabs.de/blog/2024/09/01/extreme-pi-boot-optimization/IMG_4607.jpg" width="49%" alt="Weatherproof enclosure, with 7.2Ah lead-gel battery and SolarCamPi inside"> <img src="https://kittenlabs.de/blog/2024/09/01/extreme-pi-boot-optimization/IMG_4629.jpg" width="49%" alt="Mast, with solar panel, WiFi antenna and SolarCamPi enclosure mounted to it, in nature"></p><p>Each second the Pi Zero is powered up uses valuable electricity, which is a scarce resource in a solar-powered device (at least in West European winters…).<br>The user space application (server connection, picture upload, etc.) was already optimized as best as possible.<br>The electronics setup was also specifically designed to use as little power as possible while asleep.</p><p>There a 2 possible ways to reduce total energy consumption further:</p><ul><li>decrease power consumption / current</li><li>decrease time spent running</li></ul><p>However, in some situations a balance needs to be found between the two.
For example: Disabling CPU turbo just to save some current consumption is a bad choice, because the resulting extra time will use more energy than just getting the job done quickly and shutting off.
We want the least area under the graph (of current vs. time) possible.</p><h3 id="hardware-setup">Hardware setup<a href="#hardware-setup" aria-label="Heading self-link"></a></h3><p>Having a short cycle time between making a change and actually seeing it run is critical when optimizing embedded boot processes.
Swapping SD cards, messing with card readers and power supplies while working is distracting and annoying.</p><p>In order to avoid this, a number of useful tools exist:</p><ul><li><a href="https://www.nordicsemi.com/Products/Development-hardware/Power-Profiler-Kit-2" target="_blank">Nordic Power Profiler Kit II</a></li><li><a href="https://github.com/linux-automation/usbsdmux" target="_blank">USB-SD-Mux Fast</a></li><li>USB-UART converter</li></ul><p><img src="https://kittenlabs.de/blog/2024/09/01/extreme-pi-boot-optimization/featured-DSC01414.jpg" width="80%" alt="Hardware setup, Raspberry Pi Zero 2 W, USB-SD-Mux and PPK2"></p><h5 id="power-profiler-kit">Power Profiler Kit<a href="#power-profiler-kit" aria-label="Heading self-link"></a></h5><p>The Power Profiler Kit II (now called PPK) can supply power to a device-under-test (DUT) and will measure it accurately over time.
You can enable/disable the DUT, see the power consumption at any point and also see the status of 8 digital inputs!
We’ll connect one of the digital inputs to a GPIO pin on the Raspberry Pi.</p><p>This way, the first action of “our application” (aka the finish line) will be to toggle the GPIO pin.
We then just have to measure the time between power-up and GPIO toggle.</p><h5 id="usb-sd-mux">USB-SD-Mux<a href="#usb-sd-mux" aria-label="Heading self-link"></a></h5><p>The USB-SD-Mux is a very useful tool for hardware hackers - it’s an interposer between a microSD card and a DUT with a USB-C interface.
A computer can “steal” the microSD card from the DUT, rewrite its contents and then plug the microSD card back into the DUT, without ever having to touch the device.</p><p>This makes the workflow of testing changes <em>much</em> easier and faster by avoiding unplugging the card, plugging it into a microSD reader, flashing it, plugging the card back into the DUT, etc. It can even be used to automate the reset or power of the DUT with on-board GPIOs.</p><h5 id="usb-uart-converter">USB-UART converter<a href="#usb-uart-converter" aria-label="Heading self-link"></a></h5><p>Some form of UART interface is pretty much required. These changes will break system boot, WiFi connectivity, etc. at some point and without a UART console we would be flying blind. A standard CP2102, FTDI, etc. will work well.</p><h3 id="measurement--test-setup">Measurement / Test setup<a href="#measurement--test-setup" aria-label="Heading self-link"></a></h3><p>On a clean Debian 12 (bookworm) arm64 Lite image, the <code>/boot/firmware/cmdline.txt</code> file was modified to include <code>init=/init.sh</code>.
This means that the kernel will execute the script at <code>/init.sh</code> as the very first thing in userspace (before running systemd or anything else).</p><p>Such an <code>init.sh</code> script might look like this:</p><div><pre tabindex="0"><code data-lang="bash"><span><span><span>#!/bin/bash
</span></span></span><span><span><span></span>
</span></span><span><span>gpioset <span>0</span> <span>4</span><span>=</span><span>0</span>
</span></span><span><span>sleep <span>1</span>
</span></span><span><span>gpioset <span>0</span> <span>4</span><span>=</span><span>1</span>
</span></span><span><span>sleep <span>1</span>
</span></span><span><span>gpioset <span>0</span> <span>4</span><span>=</span><span>0</span>
</span></span><span><span>
</span></span><span><span><span>exec</span> /sbin/init
</span></span></code></pre></div><p>which will toggle the GPIO4 and then resume normal boot by replacing itself with <code>/sbin/init</code> (aka systemd).</p><p><img src="https://kittenlabs.de/blog/2024/09/01/extreme-pi-boot-optimization/debian12-lite-arm64-initsh.png" alt="Power Profiler screenshot, showing GPIO4 going low after about 12s"></p><p>In this screenshot from Nordic’s Power Profiler software, you can see the current consumption of the Raspberry Pi (at 5V) while booting.
After about 12 seconds, digital input 0 is going low, showing that our <code>init.sh</code> was executed.</p><p>In doing so, a total charge of 1.90 coulomb (coulomb and ampere-seconds are equivalent) was used.<br>Calculating <code>1.9As * 5.0V</code> comes out to <code>9.5Ws</code> energy usage for this boot process.</p><p>For reference: A single AA-alkaline battery can deliver about 13500 Ws of energy.</p><h3 id="reducing-current">Reducing current<a href="#reducing-current" aria-label="Heading self-link"></a></h3><p>Let’s get the easy part out of the way first and reduce the operating current as much as possible.</p><h5 id="disabling-hdmi">Disabling HDMI<a href="#disabling-hdmi" aria-label="Heading self-link"></a></h5><p>We can disable the HDMI encoder entirely. Disabling the GPU is not possible, because we need it to encode our camera data.
If your application doesn’t require camera/GPU support, try disabling the GPU entirely.</p><p>This reduces the current consumption from 136.7mA down to 122.6mA (over 10%!).</p><p>Relevant config.txt parameters:</p><div><pre tabindex="0"><code data-lang="ini"><span><span><span># disable HDMI (saves power)</span>
</span></span><span><span><span>dtoverlay</span><span>=</span><span>vc4-kms-v3d,nohdmi</span>
</span></span><span><span><span>max_framebuffers</span><span>=</span><span>1</span>
</span></span><span><span><span>disable_fw_kms_setup</span><span>=</span><span>1</span>
</span></span><span><span><span>disable_overscan</span><span>=</span><span>1</span>
</span></span><span><span>
</span></span><span><span><span># disable composite video output</span>
</span></span><span><span><span>enable_tvout</span><span>=</span><span>0</span>
</span></span></code></pre></div><h5 id="disabling-activity-led">Disabling Activity LED<a href="#disabling-activity-led" aria-label="Heading self-link"></a></h5><p>Just by disabling the activity LED, we can save 2mA (122.6mA down to 120.6mA).</p><div><pre tabindex="0"><code data-lang="ini"><span><span><span>dtparam</span><span>=</span><span>act_led_trigger=none</span>
</span></span><span><span><span>dtparam</span><span>=</span><span>act_led_activelow=on</span>
</span></span></code></pre></div><h5 id="disabling-camera-led">Disabling Camera LED<a href="#disabling-camera-led" aria-label="Heading self-link"></a></h5><p>Repeat the same for the camera LED (if present). It will also reduce the chance of the LED reflecting back into the image.</p><h4 id="turbo-tweaking">Turbo tweaking<a href="#turbo-tweaking" aria-label="Heading self-link"></a></h4><p>As mentioned before, saving current while wasting time might not be ideal.</p><p>With our current changes, the Pi can boot while using 1.62As.
<img src="https://kittenlabs.de/blog/2024/09/01/extreme-pi-boot-optimization/turbo-defaults.png" alt="Power Profiler screenshot, showing a total current usage of 1.62C/As"></p><div><pre tabindex="0"><code data-lang="ini"><span><span><span>force_turbo</span><span>=</span><span>0</span>
</span></span><span><span><span>initial_turbo</span><span>=</span><span>10</span>
</span></span><span><span><span>arm_boost</span><span>=</span><span>0</span>
</span></span></code></pre></div><p>Without forced turbo mode, 1.58As were used:
<img src="https://kittenlabs.de/blog/2024/09/01/extreme-pi-boot-optimization/turbo-disabled.png" alt="Power Profiler screenshot, showing a total current usage of 1.58C/As"></p><p>For some, unknown reason, disabling the turbo/boost mode also inverts the default state of GPIO4 (thus I’ve switched the polarity in init.sh).</p><h3 id="reducing-time">Reducing time<a href="#reducing-time" aria-label="Heading self-link"></a></h3><p>The ~13% reduction in current is helpful, but there’s still a long way to go.</p><p>The Pi takes 8s (while consuming ~1As) before the first line of Linux output appears on the console.<br>Luckily, there a number of ways to get more info about those 8 seconds.</p><h4 id="debug-boot">Debug boot<a href="#debug-boot" aria-label="Heading self-link"></a></h4><p>In the boot process of the Raspberry Pi family, the GPU initializes first.<br>It talks to the SD card and looks for a <code>bootcode.bin</code> file (Pi 4 and newer use an EEPROM instead).</p><p>We can modify this bootcode.bin to <a href="https://www.raspberrypi.com/documentation/computers/raspberry-pi.html#bootcode-bin-uart-enable" target="_blank">enable detailed UART logging</a>:</p><div><pre tabindex="0"><code data-lang="bash"><span><span>sed -i -e <span>"s/BOOT_UART=0/BOOT_UART=1/"</span> /boot/firmware/bootcode.bin
</span></span></code></pre></div><p><strong>Backup the original bootcode.bin first, this process is potentially destructive.</strong></p><p>Rebooting with <code>BOOT_UART</code> enabled gives us loads of nice information:</p><pre tabindex="0"><code>Raspberry Pi Bootcode

Found SD card, config.txt = 1, start.elf = 1, recovery.elf = 0, timeout = 0
Read File: config.txt, 1322 (bytes)

Raspberry Pi Bootcode
Read File: config.txt, 1322
Read File: start.elf, 2981376 (bytes)
Read File: fixup.dat, 7303 (bytes)
MESS:00:00:01.295242:0: brfs: File read: /mfs/sd/config.txt
MESS:00:00:01.300131:0: brfs: File read: 1322 bytes
MESS:00:00:01.335680:0: HDMI0:EDID error reading EDID block 0 attempt 0
[..]
MESS:00:00:01.392537:0: HDMI0:EDID error reading EDID block 0 attempt 9
MESS:00:00:01.398632:0: HDMI0:EDID giving up on reading EDID block 0
MESS:00:00:01.406335:0: brfs: File read: /mfs/sd/config.txt
MESS:00:00:01.411272:0: gpioman: gpioman_get_pin_num: pin LEDS_PWR_OK not defined
MESS:00:00:01.918176:0: gpioman: gpioman_get_pin_num: pin LEDS_PWR_OK not defined
MESS:00:00:01.923999:0: *** Restart logging
MESS:00:00:01.927872:0: brfs: File read: 1322 bytes
MESS:00:00:01.933328:0: hdmi: HDMI0:EDID error reading EDID block 0 attempt 0
[..]
MESS:00:00:01.995436:0: hdmi: HDMI0:EDID error reading EDID block 0 attempt 9
MESS:00:00:02.002052:0: hdmi: HDMI0:EDID giving up on reading EDID block 0
MESS:00:00:02.007955:0: hdmi: HDMI0:EDID error reading EDID block 0 attempt 0
[..]
MESS:00:00:02.070610:0: hdmi: HDMI0:EDID error reading EDID block 0 attempt 9
MESS:00:00:02.077225:0: hdmi: HDMI0:EDID giving up on reading EDID block 0
MESS:00:00:02.082840:0: hdmi: HDMI:hdmi_get_state is deprecated, use hdmi_get_display_state instead
MESS:00:00:02.091586:0: HDMI0: hdmi_pixel_encoding: 162000000
MESS:00:00:02.799203:0: brfs: File read: /mfs/sd/initramfs8
MESS:00:00:02.803082:0: Loaded 'initramfs8' to 0x0 size 0xb0898e
MESS:00:00:02.821799:0: initramfs loaded to 0x1b4e7000 (size 0xb0898e)
MESS:00:00:02.836318:0: dtb_file 'bcm2710-rpi-zero-2-w.dtb'
MESS:00:00:02.840194:0: brfs: File read: 11569550 bytes
MESS:00:00:02.849171:0: brfs: File read: /mfs/sd/bcm2710-rpi-zero-2-w.dtb
MESS:00:00:02.854262:0: Loaded 'bcm2710-rpi-zero-2-w.dtb' to 0x100 size 0x8258
MESS:00:00:02.876038:0: brfs: File read: 33368 bytes
MESS:00:00:02.892755:0: brfs: File read: /mfs/sd/overlays/overlay_map.dtb
MESS:00:00:02.927145:0: brfs: File read: 5255 bytes
MESS:00:00:02.933541:0: brfs: File read: /mfs/sd/config.txt
MESS:00:00:02.937568:0: dtparam: audio=on
MESS:00:00:02.948005:0: brfs: File read: 1322 bytes
MESS:00:00:02.971952:0: brfs: File read: /mfs/sd/overlays/vc4-kms-v3d.dtbo
MESS:00:00:03.023016:0: Loaded overlay 'vc4-kms-v3d'
MESS:00:00:03.026278:0: dtparam: nohdmi=true
MESS:00:00:03.031105:0: dtparam: act_led_trigger=none
MESS:00:00:03.048180:0: dtparam: act_led_activelow=on
MESS:00:00:03.149316:0: brfs: File read: 2760 bytes
MESS:00:00:03.154502:0: brfs: File read: /mfs/sd/cmdline.txt
MESS:00:00:03.158504:0: Read command line from file 'cmdline.txt':
MESS:00:00:03.164369:0: 'console=serial0,115200 console=tty1 root=PARTUUID=26bbce6b-02 rootfstype=ext4 fsck.repair=yes rootwait cfg80211.ieee80211_regdom=DE init=/init.sh'
MESS:00:00:03.195926:0: gpioman: gpioman_get_pin_num: pin EMMC_ENABLE not defined
MESS:00:00:03.269361:0: brfs: File read: 146 bytes
MESS:00:00:03.812401:0: brfs: File read: /mfs/sd/kernel8.img
MESS:00:00:03.816343:0: Loaded 'kernel8.img' to 0x200000 size 0x8d8bd7
MESS:00:00:05.364579:0: Device tree loaded to 0x1b4de900 (size 0x8605)
MESS:00:00:05.370571:0: uart: Set PL011 baud rate to 103448.300000 Hz
MESS:00:00:05.377080:0: uart: Baud rate change done...
MESS:00:00:05.380495:0: uart: Baud rate[    0.000000] Booting Linux on physical CPU 0x0000000000 [0x410fd034]
</code></pre><h3 id="disabling-hdmi-probing">Disabling HDMI probing<a href="#disabling-hdmi-probing" aria-label="Heading self-link"></a></h3><p>The bootloader spends a lot of time trying to auto-detect video parameters for a possibly attached HDMI monitor.<br>We don’t have HDMI (it’s disabled anyway, remember?), so it doesn’t make much sense to wait for an I2C response with EDID (resolution, frame rate, etc.) information.</p><p>By simply hardcoding an EDID string, we can disable any probing:</p><div><pre tabindex="0"><code data-lang="ini"><span><span><span># don't try to read HDMI eeprom</span>
</span></span><span><span><span>hdmi_blanking</span><span>=</span><span>2</span>
</span></span><span><span><span>hdmi_ignore_edid</span><span>=</span><span>0xa5000080</span>
</span></span><span><span><span>hdmi_ignore_cec_init</span><span>=</span><span>1</span>
</span></span><span><span><span>hdmi_ignore_cec</span><span>=</span><span>1</span>
</span></span></code></pre></div><h3 id="disable-hat-poe-and-lcd-probing">Disable HAT, PoE and LCD probing<a href="#disable-hat-poe-and-lcd-probing" aria-label="Heading self-link"></a></h3><p>The boot process will additionally try to detect I2C EEPROMs on HATs, will try to detect a PoE hat (which needs a fan) and some other things.
We can safely disable those:</p><div><pre tabindex="0"><code data-lang="ini"><span><span><span># all these options cause a wait for an I2C bus response, we don't need any of them, so let's disable them.</span>
</span></span><span><span><span>force_eeprom_read</span><span>=</span><span>0</span>
</span></span><span><span><span>disable_poe_fan</span><span>=</span><span>1</span>
</span></span><span><span><span>ignore_lcd</span><span>=</span><span>1</span>
</span></span><span><span><span>disable_touchscreen</span><span>=</span><span>1</span>
</span></span><span><span><span>disable_fw_kms_setup</span><span>=</span><span>1</span>
</span></span></code></pre></div><h3 id="disable-camera--display-probing">Disable camera &amp; display probing<a href="#disable-camera--display-probing" aria-label="Heading self-link"></a></h3><p>Probing for an attached MIPI camera or display will also take some time.
We know which camera is attached (HQ Camera, IMX477 in this case), so let’s hardcode this:</p><div><pre tabindex="0"><code data-lang="ini"><span><span><span># no autodetection for anything (will wait for I2C answers)</span>
</span></span><span><span><span>camera_auto_detect</span><span>=</span><span>0</span>
</span></span><span><span><span>display_auto_detect</span><span>=</span><span>0</span>
</span></span><span><span>
</span></span><span><span><span># load HQ camera IMX477 sensor manually</span>
</span></span><span><span><span>dtoverlay</span><span>=</span><span>imx477</span>
</span></span></code></pre></div><h3 id="disabling-initramfs">Disabling initramfs<a href="#disabling-initramfs" aria-label="Heading self-link"></a></h3><p>The above changes brought the (self reported) boot time from 5.38s down to 4.75s.<br>We can disable the initramfs entirely by removing <code>auto_initramfs=1</code>.</p><p>Savings depend on the size of the initramfs of course, but this brings us down to 4.47s.</p><h3 id="tested-with-no-significant-difference">Tested, with no significant difference<a href="#tested-with-no-significant-difference" aria-label="Heading self-link"></a></h3><p>Overclocking the SD peripheral to 100 MHz is often recommended online but did not create a measurable difference in boot performance.</p><div><pre tabindex="0"><code data-lang="ini"><span><span><span># not recommended! data corruption risk!</span>
</span></span><span><span><span>dtoverlay</span><span>=</span><span>sdtweak,overclock_50=100</span>
</span></span></code></pre></div><p>Operating the SD peripheral at such high speeds also risks data corruption (on write accesses), which is very undesirable in remote IoT devices.</p><h3 id="kernel-load">Kernel load<a href="#kernel-load" aria-label="Heading self-link"></a></h3><p>At this point, loading the kernel is one of the slowest operations:</p><pre tabindex="0"><code>MESS:00:00:03.816343:0: Loaded 'kernel8.img' to 0x200000 size 0x8d8bd7
MESS:00:00:05.364579:0: Device tree loaded to 0x1b4de900 (size 0x8605)
</code></pre><p>Loading 9276375 Bytes takes about 1.54s -&gt; about 6 MiB/s transfer speed.</p><p>This load is being done by the GPU (!) with the internal, proprietary VideoCoreIV processor.<br>It’s possible that the loader code is just inefficient and slow, it’s also possible that it is using very conservative settings.<br>Sadly, it’s a black box and we can’t touch registers or mess with the parameters in any other useful way.</p><p>I haven’t found a good way to optimize this yet, so a smaller kernel is needed.</p><p>Overclocking the GPU processor core is theoretically possible with</p><div><pre tabindex="0"><code data-lang="ini"><span><span><span># Overclock GPU VideoCore IV processor (not recommended!)</span>
</span></span><span><span><span>core_freq_min</span><span>=</span><span>500</span>
</span></span><span><span><span>core_freq</span><span>=</span><span>550</span>
</span></span></code></pre></div><p>which does lead to a 20% reduction in kernel load time. The side effects (reliability, etc.) of this are unknown.</p><h3 id="buildroot--custom-kernel">Buildroot / Custom kernel<a href="#buildroot--custom-kernel" aria-label="Heading self-link"></a></h3><p>It’s time to migrate the system from Raspbian/Debian to a custom built Buildroot distro (especially to get the custom kernel).</p><p>Using buildroot 2024.02.1, a very stripped down system was configured.<br>Native aarch64 toolchain, still with full glibc and the Raspberry Pi userland tools (like camera utilities).</p><p><img src="https://kittenlabs.de/blog/2024/09/01/extreme-pi-boot-optimization/buildroot-menuconfig.png" alt="Buildroot ncurses menuconfig screenshot"></p><p>The kernel was configured:</p><ul><li>without sound support</li><li>without most of the block device &amp; filesystem drivers (except SD/MMC and ext4)</li><li>without RAID support</li><li>without USB support</li><li>without HID support</li><li>without DVB support</li><li>without video &amp; framebuffer support (HDMI is disabled anyway)</li><li>without advanced networking features (tunnels, bridging, firewalling, etc.)</li><li>uncompressed (not Gzip)</li><li>modules uncompressed (not Gzip)</li></ul><p>In testing, having both the kernel and the modules uncompressed results in a net-positive energy result (even if more time is spent in the GPU loading the kernel).
Decompressing Gzip takes a lot of energy (and effectively involves another relocation step).</p><p>A security feature called KASLR was also disabled.<br>KASLR randomizes the load address of the kernel in memory, making it harder to write exploit code (because the memory location of the kernel is unknown).
This requires the kernel to be re-located after it has been loaded by the GPU.</p><p>In our usecase, the network attack surface is very limited, so KASLR can be disabled (all application software runs as root anyway).
Mitigations for speculative execution vulnurabilies like Spectre were also disabled.</p><p><img src="https://kittenlabs.de/blog/2024/09/01/extreme-pi-boot-optimization/buildroot-linux-menuconfig.png" alt="Linux 6.6.26 menuconfig screenshot"></p><p>The resulting kernel is 8.5MiB (uncompressed) in size, 4.1MiB compressed as Gzip (which isn’t used here, just for comparison).<br>The original Raspbian kernel was 25 MiB (uncompressed), 8.9 MiB compressed as Gzip.</p><h3 id="final-result">Final result<a href="#final-result" aria-label="Heading self-link"></a></h3><p><img src="https://kittenlabs.de/blog/2024/09/01/extreme-pi-boot-optimization/buildroot-kernel.png" alt="Power Profiler screenshot, showing GPIO4 going low after 3.4s"></p><p><strong>We can now boot into a Linux user space program in less than 3.5s!</strong><br>~400ms is spent in the Linux kernel (difference between pin 0 and pin 1)</p><p>Total energy consumption: <strong>0.364 As * 5.0 V = 1.82 Ws</strong><br>We reduced the energy required by a factor of 5 (compared to stock Debian at 9.5 Ws until user space).</p><h3 id="links">Links<a href="#links" aria-label="Heading self-link"></a></h3><ul><li><a href="https://github.com/Manawyrm/SolarCamPi-Buildroot/blob/v2/buildroot/board/raspberrypi0w/config.txt" target="_blank">SolarCamPi config.txt</a>: Complete config.txt</li><li><a href="https://github.com/Manawyrm/SolarCamPi-Buildroot/blob/v2/buildroot/configs/linux_solarcampi_defconfig" target="_blank">SolarCamPi Linux kernel defconfig</a>: Stripped down kernel config</li><li><a href="https://github.com/Manawyrm/SolarCamPi-Buildroot/tree/v2" target="_blank">SolarCamPi-Buildroot (v2 branch)</a>: Full Buildroot tree (work-in-progress!)</li></ul></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Americans' love affair with big cars is killing them (228 pts)]]></title>
            <link>https://www.economist.com/interactive/united-states/2024/08/31/americans-love-affair-with-big-cars-is-killing-them</link>
            <guid>41418562</guid>
            <pubDate>Sun, 01 Sep 2024 17:18:31 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.economist.com/interactive/united-states/2024/08/31/americans-love-affair-with-big-cars-is-killing-them">https://www.economist.com/interactive/united-states/2024/08/31/americans-love-affair-with-big-cars-is-killing-them</a>, See on <a href="https://news.ycombinator.com/item?id=41418562">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>    <main>   <div><p><body-text><!-- HTML_TAG_START --><span data-caps="initial">W</span><small>itnesses said</small> the driver showed no signs of slowing down. On June 3rd Nicole Louthain and her six-year-old daughter were stopped at a red light in Grand Forks, North Dakota when they were struck from behind by Travis Bell. Such crashes are not uncommon—around 10,000 rear-end collisions occur in America every day. What made this one noteworthy was that the vehicles involved were so unevenly matched. Ms Louthain was driving a Ford Focus, a compact car weighing around 3,000lb (1,360kg), whereas Mr Bell was in a 7,000lb Ram 3500 “heavy duty” pickup. Alas, the disparity proved deadly. Although Mr Bell was not harmed, Ms Louthain suffered serious injuries. (Court documents later showed that Mr Bell had been drinking.) Her daughter Katarina was air-lifted to a nearby hospital where she died two days later.<!-- HTML_TAG_END --> </body-text> </p> </div><div><p><body-text><!-- HTML_TAG_START -->The crash in Grand Forks helps to illustrate a sad truth about America’s roads. For all the safety features available in cars today to help them avoid crashes, when they happen they are still often determined by the laws of physics. When two vehicles collide, it is usually the heavier one that prevails. This advantage has changed little over time. Thirty years ago when a passenger car crashed with a <a href="https://www.economist.com/united-states/2023/04/20/rural-americans-are-importing-tiny-japanese-pickup-trucks">pickup truck</a> or sport-utility vehicle (<small>SUV</small>), the driver of the car was roughly four times as likely to die; today this driver dies around three times as often. Critics say this is too high a price to pay for roomier interiors and more powerful engines. Carmakers insist they are giving consumers what they want. An analysis by <i>The Economist</i> shows that weight remains a critical factor in car crashes in America. Reining in <a href="https://www.economist.com/the-economist-explains/2024/03/11/why-american-cars-are-so-big">the heaviest vehicles</a> would save lives.<!-- HTML_TAG_END --> </body-text> </p> </div> <figure><ai2sveltewrap> </ai2sveltewrap>  </figure><div><p><body-text><!-- HTML_TAG_START -->Mismatches between big and small cars on America’s roads are not new. In the 1960s the 1,400lb Mini Cooper shared the road with the 5,000lb Cadillac Fleetwood and the 5,500lb Lincoln Continental. But whereas today heavier vehicles attract the bulk of the criticism, back then it was lighter ones that drew scrutiny. Indeed many cars of the time were woefully unsafe. In 1969 America’s National Highway Safety Bureau conducted crash tests on a Subaru 360 and a King Midget, two sub-1,000lb “mini-cars”. When pitted against vehicles twice their size, the tiny cars crumpled like soda cans.<!-- HTML_TAG_END --> </body-text> </p> </div><div><p><body-text><!-- HTML_TAG_START -->Over the years policymakers struggled to solve this mismatch, or “incompatibility”, problem. Often, they made things worse. When Congress set fuel-efficiency standards in the wake of the oil shocks of the 1970s, cars were swiftly downsized. Within ten years cars shed 1,000lb; trucks dropped 500lb. Although these changes saved motorists money at the pump, they also led to more traffic fatalities. A paper published in 1989 by researchers at the Brookings Institution and the Harvard School of Public Health estimated that the shift towards smaller, lighter cars in the 1970s and 1980s boosted fatalities by 14-27%. A report released in 2002 by America’s National Research Council concluded that the downsizing of America’s fleet led to thousands of unnecessary deaths.<!-- HTML_TAG_END --> </body-text> </p> </div><div><p><body-text><!-- HTML_TAG_START -->As cars got bigger, regulators shifted their focus from the lightest vehicles to the heaviest ones. The impetus for this was the rise of <small>SUV</small>s. Between 1990 and 2005 the market share of such vehicles in America grew from 6% to 26%, pushing up the weight of an average new car from 3,400lb to nearly 4,100lb. As suburban soccer moms traded in their station wagons for Ford Expeditions, many felt safer. And they were right. “One of the reasons the roads are much safer is because vehicles... [are] bigger and they’re heavier than they were,” Adrian Lund of the Insurance Institute for Highway Safety (<small>IIHS</small>), an industry research organisation, told conference-goers in 2011. The Competitive Enterprise Institute, a think-tank, even advocated supersizing America’s fleet to improve safety, writing in the <i>Wall Street Journal</i> that large vehicles are “the solution, not the problem”.<!-- HTML_TAG_END --> </body-text> </p> </div><div><p><body-text><!-- HTML_TAG_START -->But researchers quickly learned that the extra protection provided by heavier vehicles comes at the expense of others on the road. In a paper published in 2004 Michelle White of the University of California, San Diego estimated that for every deadly crash avoided by an <small>SUV</small> or pickup truck, there were an additional 4.3 among other drivers, pedestrians and cyclists. Another paper in 2012 by Shanjun Li of Resources for the Future, a think-tank, estimated that when a car crashes with an <small>SUV</small> or pickup, rather than another car, the driver’s fatality rate increased by 31%. In 2014 Michael Anderson and Maximilian Auffhammer of the University of California, Berkeley estimated that when two cars crash, a 1,000lb increase in the weight of one vehicle raised the fatality rate in the other by 47%.<!-- HTML_TAG_END --> </body-text> </p> </div><div><p><body-text><!-- HTML_TAG_START -->Researchers also found that the safety benefits of vehicle weight suffer from diminishing returns. This means that, once vehicles reach a certain weight, packing on more pounds provides little additional safety, while inflicting more harm on others. “At some point heavy vehicles cost more lives…than they save,” wrote Brian O’Neill and Sergey Kyrychenko of the <small>IIHS</small> in 2004. This makes intuitive sense, says Mr Anderson of Berkeley. “Once you outweigh the other guy by a factor of two times, is adding 200 pounds more really going to make a difference for you? Probably not. But it’ll make sure that he gets completely destroyed.”<!-- HTML_TAG_END --> </body-text> </p> </div><div><p><body-text><!-- HTML_TAG_START -->So how big is too big? At what point do the costs of the heaviest vehicles—measured in lives lost—vastly exceed their benefits? To answer this question, <i>The Economist</i> compiled ten years’ worth of crash data from more than a dozen states. Like the data compiled by Messrs Anderson and Auffhammer, our figures come from reports filed by police officers, who are tasked with recording information about car crashes when called to the scene. Although all states collect such data, we focus on those that collect the most detailed figures and share them with researchers. The resulting dataset, which covers more than a third of America’s population, provides us with a sample that is both big and representative.<!-- HTML_TAG_END --> </body-text> </p> </div><div><p><body-text><!-- HTML_TAG_START -->In total, our dataset includes millions of crashes across 14 states between 2013 and 2023. Although accident reports vary from state to state, most of the crashes in our database include information about the location of the crash, the number of cars involved, each passenger’s age and gender, whether they were wearing seatbelts and the types of injuries that they suffered. To obtain the curb weight of each vehicle, we collected the vehicle identification numbers (<small>VINs</small>) included in each crash report, and then matched them to vehicle specs data from VinAudit, an auto-data provider. Combining these data yielded roughly 10m crashes. After dropping observations with missing data, we were left with around 7.5m two-vehicle crashes involving more than 15m cars.<!-- HTML_TAG_END --> </body-text> </p> </div><div><p><body-text><!-- HTML_TAG_START -->What do these data tell us about the relationship between vehicle weight and road safety?<!-- HTML_TAG_END --> </body-text> </p> </div> <div><p><body-text><!-- HTML_TAG_START -->The heaviest 1% of vehicles in our dataset—those weighing around 6,800lb—suffer 4.1 “own-car deaths” per 10,000 crashes, on average, compared with around 6.6 for cars in the middle of our sample weighing 3,500lb, and 15.8 for the lightest 1% of vehicles weighing just 2,300lb. But heavy cars are also far more dangerous to other drivers. The heaviest vehicles in our data were responsible for 37 “partner-car deaths” per 10,000 crashes, on average, compared with 5.7 for median-weight cars and 2.6 for the lightest cars.<!-- HTML_TAG_END --> </body-text> </p> </div><div><p><body-text><!-- HTML_TAG_START -->To estimate this relationship more precisely, and control for potential sources of bias, we conducted a regression analysis of our sample of 7.5m two-vehicle crashes. We found that getting into a crash with a vehicle that is 1,000lb heavier is associated with a 0.06-percentage-point increase in the probability of suffering a fatality, even after controlling for the curb weight of one’s own car, the age and gender of the driver, the population density of the crash location and whether the passengers were wearing seatbelts. Given that the probability of suffering a fatality in a two-vehicle crash is 0.09%, on average, this suggests that getting hit by an additional 1,000lbs of steel and aluminium—roughly the difference between a Toyota Camry and a Ford Explorer—boosts the likelihood of death by 66%.<!-- HTML_TAG_END --> </body-text> </p> </div><div><p><body-text><!-- HTML_TAG_START -->As for the weight at which the social costs of driving a heavier vehicle exceed the benefits, the evidence is clear. Vehicles in the top 10% of our sample—those weighing at least 5,000lb—are involved in roughly 26 deaths per 10,000 crashes, on average, including 5.9 in their own car and 20.2 in partner vehicles. For vehicles in the next-heaviest 10% of our sample—those weighing between 4,500lb and 5,000lb—the equivalent figures are 5.4 and 10.3 deaths per 10,000 crashes. A back-of-the-envelope estimate suggests that if the heaviest tenth of vehicles in America’s fleet were downsized to this lighter weight class, road fatalities in multi-car crashes—which totaled 19,081 in 2023—could be reduced by 12%, or 2,300, without sacrificing the safety of any cars involved.<!-- HTML_TAG_END --> </body-text> </p> </div><div><p><body-text><!-- HTML_TAG_START -->Given these figures, you might expect carmakers to be slamming the brakes on production of their heaviest <small>SUV</small>s and pickups. In fact, they are pressing on the accelerator. Official figures from the Environmental Protection Agency show that the average new car in America weighs more than 4,400lb (compared with 3,300lb in the European Union and 2,600lb in Japan). In 2023 vehicles weighing more than 5,000lb accounted for a whopping 31% of new cars, up from 22% five years earlier.<!-- HTML_TAG_END --> </body-text> </p> </div> <figure><ai2sveltewrap> </ai2sveltewrap>  </figure><div><p><body-text><!-- HTML_TAG_START -->It would be easy to blame car-buyers for this trend but Mr Anderson says that Americans looking for a new car face a cold-war-style “arms race”. “As you see the vehicle fleet around you getting heavier, then you want to protect yourself rationally by buying a bigger and heavier car.” Such rational individual decisions have led to a suboptimal outcome for society as a whole.<!-- HTML_TAG_END --> </body-text> </p> </div><div><p><body-text><!-- HTML_TAG_START -->When asked to comment on <i>The Economist</i>’s findings, representatives from the big three car manufacturers pointed to safety features that help drivers avoid crashes, rather than those that make them less deadly. “Vehicle weight doesn’t solely determine crash performance,” Mike Levine, a Ford spokesman, wrote in an email, highlighting crash-avoidance technologies such as automatic emergency braking and front and rear “brake assist”. General Motors pointed out that carmakers have improved the compatibility of their vehicles over the years, citing a voluntary deal struck by manufacturers in 2003, more than twenty years ago. Stellantis (whose biggest shareholder part-owns <i>The Economist</i>’s parent company) declined to comment except to say that the company’s vehicles “meet or exceed all applicable federal safety standards”.<!-- HTML_TAG_END --> </body-text> </p> </div><div><p><body-text><!-- HTML_TAG_START -->Regulators are ill-equipped to fix the problem. America’s tax system subsidises heavier vehicles by setting more lenient fuel-efficiency standards for light trucks, and allowing bosses who purchase heavy-duty vehicles for business purposes to deduct part of the cost from their taxable income. The National Highway Traffic Safety Administration (<small>NHTSA</small>), America’s top auto-safety agency, uses a five-star rating system to score crash performance, but only takes account of the safety of the occupants of the vehicle in question, not that of other drivers. “Our rating system reflects a bias towards the occupant,” explains Laura Sandt of the Highway Safety Research Centre at the University of North Carolina, “it is not designed to rate the car in terms of its holistic safety effects.” The <small>NHTSA</small> declined to comment on <i>The Economist</i>’s findings.<!-- HTML_TAG_END --> </body-text> </p> </div><div><p><body-text><!-- HTML_TAG_START -->There are signs that Americans may be wising up. A survey conducted last year by YouGov, a pollster, found that 41% of Americans think that <small>SUV</small>s and pickup trucks have become too big; 49% said such vehicles are more dangerous for other cars and 50% said they endanger cyclists and pedestrians. Researchers are raising the alarm. Since 1989 the <small>IIHS</small> has regularly published the driver-fatality rates of popular car models. In 2023, for the first time, the group also estimated the rate at which cars kill drivers in other vehicles. Policymakers are starting to take notice too. “I’m concerned about the increased risk of severe injury and death for all road users from heavier curb weights,” Jennifer Homendy, chair of the National Transportation Safety Board, said in a speech last year.<!-- HTML_TAG_END --> </body-text> </p> </div><div><p><body-text><!-- HTML_TAG_START -->But the odds that carmakers curb their heaviest, most dangerous vehicles are slim. American car-buyers value safety, but mainly for themselves, not society as a whole. And although regulators are tasked with protecting consumers, they rarely do so at the expense of choice, no matter how deadly the consequences. “There may be a certain point where you say, ‘You know what, passenger vehicles shouldn't be weighing this much,’” says Raul Arbelaez of the <small>IIHS</small>’s Vehicle Research Centre. “But it would, politically, be really hard to gain any momentum on that.” Finally the shift towards <a href="https://www.economist.com/business/2024/04/07/think-tesla-is-in-trouble-pity-even-more-its-wannabe-ev-rivals">electric power</a> is likely to increase their weight further, as battery-powered vehicles tend to be heavier than their internal-combustion equivalents.<!-- HTML_TAG_END --> </body-text> </p> </div><div><p><body-text><!-- HTML_TAG_START -->“Manufacturers are playing by the book,” says Mark Chung of the National Safety Council, a non-profit. “They’re making a business decision, and it’s a rational decision. Unless they’re forced to think differently, they’re not going to. So I think this is where our federal partners really need to step up.”<span data-ornament="ufinish">■</span><!-- HTML_TAG_END --> </body-text> </p> </div><div><p>Sources: </p><body-text><!-- HTML_TAG_START -->State governments; VinAudit; <i>The Economist</i><!-- HTML_TAG_END --> </body-text> </div>  </main>  
			
			
		</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Apple and Nvidia in talks to invest in ChatGPT (123 pts)]]></title>
            <link>https://www.businesstoday.in/technology/news/story/apple-nvidia-in-talks-to-invest-in-chatgpt-maker-openai-potentially-valuing-company-over-100-billion-443624-2024-08-30</link>
            <guid>41418302</guid>
            <pubDate>Sun, 01 Sep 2024 16:46:12 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.businesstoday.in/technology/news/story/apple-nvidia-in-talks-to-invest-in-chatgpt-maker-openai-potentially-valuing-company-over-100-billion-443624-2024-08-30">https://www.businesstoday.in/technology/news/story/apple-nvidia-in-talks-to-invest-in-chatgpt-maker-openai-potentially-valuing-company-over-100-billion-443624-2024-08-30</a>, See on <a href="https://news.ycombinator.com/item?id=41418302">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="descriptionStoryId"><p>Apple and Nvidia are reportedly in talks to invest in OpenAI, the company behind ChatGPT, as part of a new fundraising round. This round could potentially value OpenAI at over $100 billion, according to media reports.</p>

<p>The Wall Street Journal reported that Apple is exploring the possibility of joining the funding round, while Bloomberg News indicated Nvidia’s potential involvement. This comes after news that Thrive Capital, a venture capital firm, is planning to invest around $1 billion in OpenAI, leading the current fundraising efforts.</p><div><h4>Related Articles</h4><div><ul><li><a target="_blank" title="OpenAI launches fine-tuning for GPT-4o, unlocking enhanced performance and customisation" href="https://www.businesstoday.in/technology/news/story/openai-launches-fine-tuning-for-gpt-4o-unlocking-enhanced-performance-and-customisation-442518-2024-08-22">OpenAI launches fine-tuning for GPT-4o, unlocking enhanced performance and customisation</a></li><li><a target="_blank" title="Ex-Google CEO thinks company's ‘work-life balance’ mentality is why it is losing AI race to startups like OpenAI" href="https://www.businesstoday.in/technology/news/story/ex-google-ceo-thinks-companys-work-life-balance-mentality-is-why-it-is-losing-ai-race-to-startups-like-openai-441535-2024-08-14">Ex-Google CEO thinks company's ‘work-life balance’ mentality is why it is losing AI race to startups like OpenAI</a></li></ul></div></div>

<p>OpenAI has become increasingly integral to Apple’s AI strategy. In June, Apple introduced OpenAI’s chatbot, ChatGPT, to its devices under the initiative called “Apple Intelligence.” Additionally, Apple is reportedly set to gain an observer role on OpenAI’s board, highlighting the deepening relationship between the two companies.</p>

<p>Microsoft, OpenAI’s largest investor with over $10 billion already committed, is also expected to participate in this new funding round. However, the specific amounts that Apple, Nvidia, and Microsoft are planning to invest have not been disclosed.</p>

<p>OpenAI’s rising valuation is a result of the intense competition in the AI sector, which intensified after the launch of ChatGPT in late 2022. This launch spurred companies across various industries to pour billions into AI technology to stay competitive. Earlier this year, OpenAI was valued at $80 billion following a tender offer led by Thrive Capital, where the firm sold existing shares.<br>
&nbsp;</p>
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[The Pentium as a Navajo Weaving (271 pts)]]></title>
            <link>https://www.righto.com/2024/08/pentium-navajo-fairchild-shiprock.html</link>
            <guid>41418301</guid>
            <pubDate>Sun, 01 Sep 2024 16:46:07 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.righto.com/2024/08/pentium-navajo-fairchild-shiprock.html">https://www.righto.com/2024/08/pentium-navajo-fairchild-shiprock.html</a>, See on <a href="https://news.ycombinator.com/item?id=41418301">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="post-body-1847189222202375114" itemprop="description articleBody">
<p>Hurrying through the National Gallery of Art five minutes before closing, I passed a Navajo weaving with a complex abstract
pattern.
Suddenly, I realized the pattern was strangely familiar, so I stopped and looked closely.
The design turned out to be an image of Intel's Pentium chip, the start of the long-lived Pentium family.<span id="fnref:pentium"><a href="#fn:pentium">1</a></span>
The weaver, Marilou Schultz, created the artwork in 1994 using traditional materials and techniques.
The rug was commissioned by Intel as a gift to <a href="https://archive.org/details/ERIC_ED409127/page/n2/mode/1up">AISES</a> (American Indian Science &amp; Engineering Society) and
is currently part of an art exhibition—<a href="https://www.nga.gov/exhibitions/2024/woven-histories-textiles-modern-abstraction.html">Woven Histories: Textiles and Modern Abstraction</a>—focusing on the intersection between abstract art and woven textiles.</p>
<p><a href="https://static.righto.com/images/pentium-rug/pentium-rug.jpg"><img alt="&quot;Replica of a Chip&quot;, created by Marilou Schultz, 1994. Wool. Photo taken at the National Gallery of Art, 2024." height="560" src="https://static.righto.com/images/pentium-rug/pentium-rug-w500.jpg" title="&quot;Replica of a Chip&quot;, created by Marilou Schultz, 1994. Wool. Photo taken at the National Gallery of Art, 2024." width="500"></a></p><p>"Replica of a Chip", created by Marilou Schultz, 1994. Wool. Photo taken at the National Gallery of Art, 2024.</p>
<p>I talked with Marilou Schultz, a Navajo/Diné weaver and math teacher, to learn more about the artwork.
Schultz learned weaving as a child—part of four generations of weavers—carding the wool, spinning it into yarn, and then weaving it.
For the Intel project, she worked from a photograph of the die, marking it into 64 sections along each side so the die pattern could be
accurately transferred to the weaving.
Schultz used the "raised outline" technique, which gives a three-dimensional effect along borders.
One of the interesting characteristics of the Pentium from the weaving perspective is its lack of symmetry, unlike traditional rugs.
The Pentium weaving was colored with traditional plant dyes;
the cream regions are the natural color of the
wool from the long-horned Navajo-Churro sheep.<span id="fnref:sheep"><a href="#fn:sheep">2</a></span>
The yarn in the weaving is a bit finer than the yarn typically used for knitting.
Weaving was a slow process, with a day's work extending the rug by 1" to 1.5".</p>
<p>The Pentium die photo below shows the patterns and structures on the surface of the fingernail-sized silicon die, over
three million tiny transistors.
The weaving is a remarkably accurate representation of the die,
reproducing the processor's complex designs.
However, I noticed that the weaving was a mirror image of the physical Pentium die; I had to flip the rug image below to make them match.
I asked Ms. Schultz if this was an artistic decision and she explained that she wove the rug to match the photograph.
There is no specific front or back to a Navajo weaving because the design is similar on both sides,<span id="fnref:sides"><a href="#fn:sides">3</a></span>
so the gallery picked an arbitrary side to display.
Unfortunately, they picked the wrong side, resulting in a backward die image. This probably bothers nobody but me, but I
hope the gallery will correct this in future exhibits.
For the remainder of this article, I will mirror the rug to match the physical die.</p>
<p><a href="https://static.righto.com/images/pentium-rug/comparison.jpg"><img alt="Comparison of the Pentium weaving (flipped vertically) with a Pentium die photo. Original die photo from Intel." height="330" src="https://static.righto.com/images/pentium-rug/comparison-w600.jpg" title="Comparison of the Pentium weaving (flipped vertically) with a Pentium die photo. Original die photo from Intel." width="600"></a></p><p>Comparison of the Pentium weaving (flipped vertically) with a Pentium die photo. Original die photo from <a href="https://en.wikichip.org/wiki/File:pentium_die_shot.png">Intel</a>.</p>
<p>The rug is accurate enough that each region can be marked with its corresponding function in the real chip, as shown below.
Starting in the center, the section labeled "integer execution units" is the heart of the processor, performing
arithmetic operations and other functions on integer numbers.
The Pentium is a 32-bit processor, so the integer execution unit is a vertical rectangle, 32 bits wide.
The horizontal lines correspond to different types of circuitry such as adders, multipliers, shifters, and registers.
To the right, the "floating point unit" performs more complex arithmetic operations on floating-point numbers, 
numbers with a fractional part that are used in applications such as spreadsheets and CAD drawings.
Like the integer execution unit, the floating point unit has horizontal stripes corresponding to different functions.
Floating-point numbers are represented with more bits, so the stripes are wider.</p>
<p><a href="https://static.righto.com/images/pentium-rug/p54c-rug-floorplan2.jpg"><img alt="The Pentium weaving, flipped and marked with the chip floorplan." height="640" src="https://static.righto.com/images/pentium-rug/p54c-rug-floorplan2-w600.jpg" title="The Pentium weaving, flipped and marked with the chip floorplan." width="600"></a></p><p>The Pentium weaving, flipped and marked with the chip floorplan.</p>
<p>At the top, the "instruction fetch" section fetches the machine instructions that make up the software.
The "instruction decode" section analyzes each instruction to determine what operations to perform.
Simple operations, such as addition, are performed directly by the integer execution unit.
Complicated instructions (a hallmark of Intel's processors) are broken down into
smaller steps by the "complex instruction support" circuitry, with the steps held in the "microcode ROM".
The "branch prediction logic" improves performance when the processor must make a decision for a branch instruction.</p>
<p>The code and data caches provide a substantial performance boost.
The problem is that the processor is considerably faster than the computer's RAM memory, so the processor can end up sitting idle until program
code or data is provided by memory.
The solution is the cache, a small, fast memory that holds bytes that the processor is likely to need.
The Pentium processor had a small cache by modern standards, holding 8 kilobytes of code and 8 kilobytes of data.
(In comparison, modern processors have multiple caches, with hundreds of kilobytes in the fastest cache and megabytes in a slower
cache.)
Cache memories are built from an array of memory storage elements in a structured grid,
visible in the rug as uniform pink rectangles.
The TLB (Translation Lookaside Buffer) assists the cache.
Finally, the "bus interface logic" connects the processor to the computer's bus, providing access to memory and peripheral
devices.
Around the edges of the physical chip, tiny bond pads provide the connections between the silicon chip and the integrated circuit package.
In the weaving, these tiny pads have been abstracted into small black rectangles.</p>
<p>The weaving is accurate enough to determine that it represents a specific Pentium variant, called P54C.
The motivation for the P54C was that
the original Pentium chips (called P5) were not as fast as hoped and ran hot.
Intel fixed this by using a more advanced manufacturing process, reducing the feature size from 800 to 600 nanometers
and running the chip at 3.3 volts instead of 5 volts.
Intel also modified the chip so that when parts of the chip were idle, the clock signal could be stopped to
save power. (This is the "clock driver" circuitry at the top of the weaving.)
Finally, Intel added multiprocessor logic (adding 200,000 more transistors), allowing two processors to work together more
easily. 
The improved Pentium chip was smaller, faster, and used less power. This variant was called the P54C (for reasons I haven't
been able to determine).
The "multiprocessor logic" is visible in the Pentium rug, showing that it is the P54C Pentium (right) and not the P5 Pentium (left).</p>
<p><a href="https://static.righto.com/images/pentium-rug/pentiums.jpg"><img alt="The Pentium P5 on the left and the P54C on the right, showing the difference in die and package sizes. If you look closely, the P5 die on the left lacks the &quot;multiprocessor logic&quot; in the weaving, showing that the weaving is the P54C. I clipped the pins on the P5 to fit it under a microscope." height="270" src="https://static.righto.com/images/pentium-rug/pentiums-w600.jpg" title="The Pentium P5 on the left and the P54C on the right, showing the difference in die and package sizes. If you look closely, the P5 die on the left lacks the &quot;multiprocessor logic&quot; in the weaving, showing that the weaving is the P54C. I clipped the pins on the P5 to fit it under a microscope." width="600"></a></p><p>The Pentium P5 on the left and the P54C on the right, showing the difference in die and package sizes. If you look closely, the P5 die on the left lacks the "multiprocessor logic" in the weaving, showing that the weaving is the P54C. I clipped the pins on the P5 to fit it under a microscope.</p>
<p>Intel's connection with New Mexico started in 1980 when Intel opened a chip fabrication plant (fab) in Rio Rancho, a suburb north of Albuquerque.
At the time, this plant, Fab 7, was Intel's largest and produced <a href="https://archive.org/details/intelinsidenewme0000unse/page/11/mode/1up">70%</a> of Intel's profits.
Intel steadily grew the New Mexico facility, adding Fab 9 and then Fab 11, which <a href="https://www.nytimes.com/1995/12/03/business/suiting-up-for-america-s-high-tech-future.html">opened</a> in September 1995, building Pentium and Pentium Pro chips in a <a href="https://www.nytimes.com/1995/12/03/business/suiting-up-for-america-s-high-tech-future.html">140-step</a> manufacturing process.
Intel's investment in Rio Rancho has continued with a $4 billion project <a href="https://www.intel.com/content/www/us/en/newsroom/news/updates-intel-10-largest-construction-projects.html#gs.di125l">underway</a> for Fab 9 and Fab 11x.
Intel has been criticized for environmental issues in New Mexico, detailed in the book
<a href="https://archive.org/details/intelinsidenewme0000unse">Intel inside New Mexico: A case study of environmental and economic injustice</a>.
Intel, however, claims a <a href="https://download.intel.com/newsroom/2024/manufacturing/Intel-in-NM-Sustainability-Fact-Sheet.pdf">sustainable future</a> in New Mexico, restoring watersheds, using 100% renewable electricity, and recycling construction waste.</p>
<!--
Intel has continued to support Native American communities through scholarships and the [Next Generation of Native
American Coders program](https://woc.aises.org/content/intel-and-aises-history-engagement).
-->

<h2>Fairchild and Shiprock</h2>
<p>Marilou Schultz is currently creating another weaving based on an integrated circuit, shown below.
Although this chip, the Fairchild 9040, 
is much more obscure than the Pentium, it has important historical symbolism,
as it was built by Navajo workers at a plant on Navajo land.</p>
<p><a href="https://static.righto.com/images/pentium-rug/fairchild-rug.jpg"><img alt="Marilou Schultz's current weaving project. Photo provided by the artist." height="558" src="https://static.righto.com/images/pentium-rug/fairchild-rug-w400.jpg" title="Marilou Schultz's current weaving project. Photo provided by the artist." width="400"></a></p><p>Marilou Schultz's current weaving project. Photo provided by the artist.</p>
<p>In 1965, Fairchild started producing semiconductors in Shiprock, New Mexico, 
about 200 miles northwest of Intel's future facility.
Fairchild produced a <a href="https://archive.computerhistory.org/resources/access/text/2017/01/102770254-05-01-acc.pdf">brochure</a> in 1969 to commemorate the opening of a new plant. Two of the photos in that brochure compared a traditional Navajo weaving to the pattern of a chip, which happened to be the 9040.
Although Fairchild's Shiprock project started optimistically, it was suddenly
shut down a decade later after an armed takeover.
I'll discuss the complicated history of Fairchild in Shiprock and then describe the 9040 chip in more detail.</p>
<p><a href="https://static.righto.com/images/pentium-rug/rug-ic.jpg"><img alt="A Navajo rug and the die of a Fairchild 9040 integrated circuit. Images from Fairchild's commemorative brochure on the opening of a new plant at Shiprock." height="347" src="https://static.righto.com/images/pentium-rug/rug-ic-w600.jpg" title="A Navajo rug and the die of a Fairchild 9040 integrated circuit. Images from Fairchild's commemorative brochure on the opening of a new plant at Shiprock." width="600"></a></p><p>A Navajo rug and the die of a Fairchild 9040 integrated circuit. Images from Fairchild's <a href="https://archive.computerhistory.org/resources/access/text/2017/01/102770254-05-01-acc.pdf">commemorative brochure</a> on the opening of a new plant at Shiprock.</p>
<p>The story of Fairchild starts with William Shockley, who invented the junction transistor at Bell Labs, won the Nobel prize, and founded
Shockley Semiconductor Laboratory in 1957 to build transistors.
Unfortunately, although Shockley was brilliant,
he was said to be <a href="https://www.npr.org/2006/07/21/5573656/electronics-pioneer-william-shockleys-legacy">the worst manager in the history of electronics</a>, not to mention a notorious eugenicist and racist later in life.
Eight of his top employees—called the "traitorous eight"—left Shockley's company in 1957 to found Fairchild Semiconductor.
(The traitorous eight included Gordon Moore and Robert Noyce who ended up founding Intel in 1968).
Noyce (co-)invented the integrated circuit in 1959 and Fairchild soon became a top semiconductor manufacturer, famous
for its foundational role in Silicon Valley.</p>
<p>The Shiprock project was part of an attempt in the 1960s to improve the economic situation of the Navajo through industrial development.
The Navajo had suffered a century of oppression including forced deportation from their land through the Long Walk (1864-1866).
The Navajo were suffering from 65% unemployment, a per-capita income of $300, and a lack
of basics such as roads, electricity, running water, and health care.
The Bureau of Indian Affairs was now trying to encourage economic
self-sufficiency by funding industrial projects on Indian land.<span id="fnref:economy"><a href="#fn:economy">4</a></span>
Navajo Tribal Chairman Raymond Nakai viewed industrialization as the only answer.
Called "<a href="https://books.google.com/books?id=aP4QyAXsnmkC&amp;lpg=PP1&amp;pg=PA228#v=onepage&amp;q&amp;f=false">the first modern Navajo political leader</a>", Nakai <a href="https://books.google.com/books?id=0y-8OOtshbAC&amp;pg=PA7#v=onepage&amp;q&amp;f=false">stated</a>,
"There are some would-be leaders of the tribe calling for the banishment of industry from the reservation and a return to the life of a century ago! But, it would not solve the problems. There is not sufficient grazing land on the reservation to support the population so industry must be brought in."
Finally, Fairchild was trying to escape the high cost of Silicon Valley labor by opening plants in low-cost locations such as Maine, Australia, and Hong Kong. <!-- https://archive.computerhistory.org/resources/access/text/2017/03/102770842-05-01-acc.pdf --></p>
<p>These factors led 
Fairchild to open a manufacturing facility on Navajo land in Shiprock, New Mexico.
The project started in 1965 with 50 Navajo workers in the Shiprock Community Center manufacturing transistors,
rapidly increasing to <a href="https://www.bia.gov/as-ia/opa/online-press-release/electronics-industry-expanding-navajo-reservation">366 Navajo workers</a>.</p>
<p><a href="https://static.righto.com/images/pentium-rug/shiprock.jpg"><img alt="Fairchild's manufacturing plant in Shiprock, NM, named after the Shiprock rock formation in the background. The formation is called Tsé Bitʼaʼí in Navajo.
    From The Industrialization of a 'Sleeping Giant', Commerce Today, January 25, 1971." height="283" src="https://static.righto.com/images/pentium-rug/shiprock-w500.jpg" title="Fairchild's manufacturing plant in Shiprock, NM, named after the Shiprock rock formation in the background. The formation is called Tsé Bitʼaʼí in Navajo.
    From The Industrialization of a 'Sleeping Giant', Commerce Today, January 25, 1971." width="500"></a></p><p>Fairchild's manufacturing plant in Shiprock, NM, named after the Shiprock rock formation in the background. The formation is called <i>Tsé Bitʼaʼí</i> in Navajo.
    From <a href="https://books.google.com/books?id=GddHAQAAIAAJ&amp;newbks=1&amp;newbks_redir=0&amp;pg=RA7-PA17#v=onepage&amp;q&amp;f=false">The Industrialization of a 'Sleeping Giant'</a>, Commerce Today, January 25, 1971.</p>
<p>By 1967, Robert Noyce, group vice-president of Fairchild, regarded the Shiprock plant as successful.
He <a href="https://bitsavers.org/magazines/Computers_And_Automation/196704.pdf">explained</a> that Fairchild
was motivated both by low labor costs and by social benefits, saying, "Probably nobody would
ever admit it, but I feel sure the Indians are the most underprivileged ethnic group in the United States."
Two years later, Lester Hogan, Fairchild's president,
<a href="https://www.worldradiohistory.com/Archive-Electronics/60s/69/Electronics-1969-03-17.pdf#page=55">stated</a>,
"I thought the Shiprock plant was one of Bob Noyce's philanthropies until I went there," but he was so impressed that
he decided to expand the plant.
Hogan also directed Fairchild to help build hundreds of houses for workers; since a traditional Navajo dwelling is called a hogan,
the houses were dubbed <a href="https://archive.computerhistory.org/resources/access/text/2021/08/102710155-05-01-acc.pdf">Hogan's hogans</a>.</p>
<p><a href="https://static.righto.com/images/pentium-rug/102785007-03-15-acc.jpg"><img alt="Workers in Fairchild's Shiprock plan, 1966. Photo by Jack Grimes. Photo courtesy of Computer History Museum, Henry Mahler collection of Fairchild Semiconductor photographs." height="399" src="https://static.righto.com/images/pentium-rug/102785007-03-15-acc-w500.jpg" title="Workers in Fairchild's Shiprock plan, 1966. Photo by Jack Grimes. Photo courtesy of Computer History Museum, Henry Mahler collection of Fairchild Semiconductor photographs." width="500"></a></p>
<p>In 1969, Fairchild opened its new facility at Shiprock and produced the <a href="https://www.computerhistory.org/collections/catalog/102770254">commemorative brochure</a> mentioned earlier.
As well as showing the striking visual similarity between the designs of traditional Navajo weavings and modern integrated circuits,
it stated that "Weaving, like all Navajo arts, is done with unique imagination and craftsmanship" and described
the "blending of innate Navajo skill and [Fairchild] Semiconductor's precision assembly techniques."
Fairchild later said that "rug weaving, for instance, provides an inherent
ability to recognize complex patterns, a skill which makes memorizing integrated circuit patterns a minimal problem."<span id="fnref:ncio"><a href="#fn:ncio">7</a></span></p>
<p>However, in <a href="https://lisanakamura.net/wp-content/uploads/2011/01/indigenous-circuits-nakamura-aq.pdf">Indigenous Circuits: Navajo Women and the Racialization of Early Electronic Manufacture</a>,
digital media theorist Lisa Nakamura critiques this language as
a process by which "electronics assembly work became both gendered and identified with specific racialized qualities".<span id="fnref:racialization"><a href="#fn:racialization">5</a></span>
Nakamura points out how "Navajo
women’s affinity for electronics manufacture [was described] as both reflecting and satisfying
an intrinsic gendered and racialized drive toward intricacy, detail, and quality."</p>
<p><a href="https://static.righto.com/images/pentium-rug/shiprock-plant.jpg"><img alt="Fairchild's Shiprock plant, 1966. From the patterns on the floor, this photo may show the time period when Fairchild set up manufacturing in the school gymnasium. Photo by Jack Grimes. Photo courtesy of Computer History Museum, Henry Mahler collection of Fairchild Semiconductor photographs." height="400" src="https://static.righto.com/images/pentium-rug/shiprock-plant-w500.jpg" title="Fairchild's Shiprock plant, 1966. From the patterns on the floor, this photo may show the time period when Fairchild set up manufacturing in the school gymnasium. Photo by Jack Grimes. Photo courtesy of Computer History Museum, Henry Mahler collection of Fairchild Semiconductor photographs." width="500"></a></p><p>Fairchild's Shiprock plant, 1966. From the patterns on the floor, this photo may show the time period when Fairchild set up manufacturing in the school gymnasium. Photo by Jack Grimes. Photo courtesy of Computer History Museum, <a href="https://www.computerhistory.org/collections/catalog/102785007">Henry Mahler collection of Fairchild Semiconductor photographs</a>.</p>
<p>At Shiprock, Fairchild employed 1200 workers,<span id="fnref:workers"><a href="#fn:workers">6</a></span> and all but 24 were Navajo, making Fairchild the nation's largest
non-government employer of American Indians. Of the 33 production supervisors, 30 were Navajo.
This project had extensive government involvement from the Bureau of Indian Affairs and the U.S. Public Health Service,
while the Economic Development Administration made business loans to Fairchild,
the Labor Department had job training programs, and Housing and Urban Development built housing at Shiprock<span id="fnref2:ncio"><a href="#fn:ncio">7</a></span>.</p>
<p>The Shiprock plant was considered a major success story at a meeting of the National Council on Indian Opportunity in 1971.<span id="fnref3:ncio"><a href="#fn:ncio">7</a></span>
US Vice President Agnew called the economic deprivation and
40-80% unemployment on Indian reservations "a problem of staggering magnitude" and encouraged more industrial development.
Fairchild President Hogan stated that "Fairchild's program at Shiprock has been one of the most rewarding in the history of our company, from the standpoint of a sound business as well as social responsibility."
He said that at first the plant was considered the "Shiprock experiment", but the plant
was "now among the most productive and efficient of any Fairchild operation in the world."
Peter MacDonald, Chairman of the Navajo Tribal Council and a World War II Navajo <a href="https://en.wikipedia.org/wiki/Code_talker">code talker</a>, discussed the extreme poverty and unemployment on the Navajo reservation, along with "inadequate housing,
inadequate health care and the lack of viable economic activities."
He referred to Fairchild as "one of the best arrangements we have ever had" providing not only employment but also supporting
housing through a non-profit.</p>
<p><a href="https://static.righto.com/images/pentium-rug/national-geographic.jpg"><img alt="Navajo workers using microscopes in Fairchild's Shiprock plant. From &quot;The Navajo Nation Looks Ahead&quot;, National Geographic, December 1972." height="407" src="https://static.righto.com/images/pentium-rug/national-geographic-w500.jpg" title="Navajo workers using microscopes in Fairchild's Shiprock plant. From &quot;The Navajo Nation Looks Ahead&quot;, National Geographic, December 1972." width="500"></a></p><p>Navajo workers using microscopes in Fairchild's Shiprock plant. From "The Navajo Nation Looks Ahead", National Geographic, December 1972.</p>
<p>In December 1972, National Geographic highlighted the Shiprock plant as "weaving for the Space Age", stating that the Fairchild plant was the tribe's most
successful economic project with Shiprock booming due to the 4.5-million-dollar annual payroll. The article states: "Though the plant runs happily today, it was at first a battleground of warring
cultures."
A new manager, Paul Driscoll, realized that strict "white man's rules" were counterproductive.
For instance, many employees couldn't phone in if they would be absent, as they didn't have telephones.
Another issue was the language barrier since many workers spoke only Navajo, not English.
So when technical words didn't exist in Navajo, substitutes were found: "aluminum" became "shiny metal".
Driscoll also realized that Fairchild needed to adapt to traditional nine-day religious ceremonies.
Soon the monthly turnover rate dropped from 12% to under 1%, better than Fairchild's other plants.</p>
<p>Unfortunately, the Fairchild-Navajo manufacturing partnership soon met a dramatic end.
In 1975, the semiconductor industry was suffering from the ongoing US recession. Fairchild was especially hard hit,
<a href="https://archive.computerhistory.org/resources/access/text/2023/07/102710181-05-01-acc.pdf#page=24">losing money</a> on its integrated circuits, and it shed over <a href="https://archive.computerhistory.org/resources/access/text/2023/07/102710181-05-01-acc.pdf#page=21">8000 employees</a> between 1973 and 1975.<span id="fnref:fairchild"><a href="#fn:fairchild">8</a></span>
At the Shiprock plant, Fairchild laid off<span id="fnref:laid-off"><a href="#fn:laid-off">9</a></span> 140 Navajo employees in February 1975, angering the community.
A group of 20 Indians armed with high-power rifles
<a href="https://www.nytimes.com/1975/03/02/archives/indians-vow-to-stay-in-fairchild-plant.html">took over</a> the plant, demanding that
Fairchild rehire the employees.
Fairchild portrayed the occupiers, part of the AIM (American Indian Movement), as an "<a href="https://archive.computerhistory.org/resources/access/text/2017/02/102770538-05-01-acc.pdf">outside group—representing neither employees, tribal authorities nor the community</a>."
Peter MacDonald, chairman of the Navajo Nation, agreed with the AIM on many points but viewed the AIM occupiers as "foolish" with "little sense of Navajo history" and "no sense of the need for an Indian nation to grow" (<a href="https://archive.org/details/lastwarriorpeter0000macd/page/320/mode/1up">source</a>).
MacDonald negotiated with the occupiers and the occupation <a href="https://www.nytimes.com/1975/03/04/archives/40-indians-accept-amnesty-and-end-plant-occupation.html">ended</a> peacefully a week later, with <a href="https://www.nytimes.com/1975/03/04/archives/40-indians-accept-amnesty-and-end-plant-occupation.html">unconditional amnesty</a> granted to the occupiers.<span id="fnref:aim"><a href="#fn:aim">10</a></span>
However, concerned about future disruptions, Fairchild <a href="https://www.nytimes.com/1975/03/13/archives/plant-that-indians-seized-is-now-shut.html">permanently closed</a> the Shiprock plant and <a href="https://archive.computerhistory.org/resources/access/text/2015/07/102658280-05-01-acc.pdf#page=6">transferred</a> production to Southeast Asia.</p>
<p><a href="https://static.righto.com/images/pentium-rug/occupy.jpg"><img alt="An article entitled &quot;Navajos Occupy Plant&quot;. Contrary to the title, MacDonald stated that many of the occupiers were from other tribes and were not acting in the best interest of the Navajo. From Workers' Power, the biweekly newspaper of the International Socialists, March 13-26, 1975." height="481" src="https://static.righto.com/images/pentium-rug/occupy-w500.jpg" title="An article entitled &quot;Navajos Occupy Plant&quot;. Contrary to the title, MacDonald stated that many of the occupiers were from other tribes and were not acting in the best interest of the Navajo. From Workers' Power, the biweekly newspaper of the International Socialists, March 13-26, 1975." width="500"></a></p><p>An article entitled "Navajos Occupy Plant". Contrary to the title, MacDonald stated that many of the occupiers were from other tribes and were not acting in the best interest of the Navajo. From <a href="https://www.marxists.org/history/etol/newspape/workerspower/wp116.pdf">Workers' Power</a>, the biweekly newspaper of the International Socialists, March 13-26, 1975.</p>
<p>For the most part, the Fairchild plant was viewed as a success prior to its occupation and closure.
Navajo leader MacDonald looked back on the Fairchild plant as "a cooperative effort that was succeeding for everyone" (<a href="https://archive.org/details/lastwarriorpeter0000macd/page/318/mode/1up">link</a>).
Alice Funston, a Navajo forewoman at Shiprock said, "Fairchild has not only helped women get ahead, it has been good
for the entire Indian community in Shiprock."<span id="fnref:funston"><a href="#fn:funston">11</a></span>
On the other hand,
Fairchild general manager Charles Sporck had a negative view looking back:
"It [Shiprock] never worked out. We were really screwing up the whole societal structure of the Indian tribe.
You know, the women were making money and the guys were drinking it up.
We had a very major negative impact upon the Navajo tribe."<span id="fnref:sporck"><a href="#fn:sporck">12</a></span></p>
<p>Despite the stereotypes in Sporck's comments, he touches on important gender issues, both at Fairchild and in the electronics
industry as a whole.
Fairchild had long recognized the lack of jobs for men at Shiprock, despite attempts to create roles for men. In 1971, Fairchild President Hogan stated that
since "semiconductor assembly operation require a great amount of detail work with tiny components, [it] lends itself to
female workers. As a result, there are nearly three times as many Navajo women employed by Fairchild as men."<span id="fnref4:ncio"><a href="#fn:ncio">7</a></span></p>
<p>The role of women in fabricating and assembling electronics is often not recognized.
A <a href="https://fraser.stlouisfed.org/files/docs/publications/bls/bls_1363_1963.pdf#page=43">1963 report</a> on electronics manufacturing
estimated that women workers made up
41 percent of total employment in electronics manufacturing, largely in gendered roles.
The report suggested that 
microminiaturization of semiconductors gave women an advantage over men in assembly and production-line work;
women made up over 70% of semiconductor production-line workers, with
90-99% of inspecting and testing jobs.
and 90-100% of assembler jobs.
Women were largely locked out of non-production jobs;
although women held a few technician and drafting roles, the percentage of woman engineers was too low to measure.</p>
<p>The defense contractor General Dynamics also had Navajo plants, but with more success than Fairchild.
General Dynamics opened a Navajo Nation plant in Fort Defiance, Arizona in <a href="https://www.andrews.edu/~tidwell/bsad560/Navajo">1967</a> to make <a href="https://www.bia.gov/as-ia/opa/online-press-release/missile-parts-plant-set-navajo-area">missiles for the Navy</a>.
At the plant's opening, Navajo Tribal Chairman Raymond Nakai pushed for industrialization, <a href="https://archive.library.nau.edu/digital/collection/cpa/id/37191">stating</a>
that it was in "industrialization and the money and the jobs engendered thereby that the future of
the Navajo people will lie."
The plant started with 30 employees, growing to 224 by the end of 1969, but then dropping to 99 in 1971 due to
a <a href="https://books.google.com/books?id=0y-8OOtshbAC&amp;pg=PA196#v=onepage&amp;q&amp;f=false">slowdown in the electronics industry</a>.
General Dynamics opened another Navajo plant near Farmington NM in <a href="https://www.nytimes.com/1988/06/09/business/company-news-navajos-to-build-plant-for-dynamics.html">1988</a>.
Due to the <a href="https://books.google.com/books?id=DkIrAQAAIAAJ&amp;pg=PA231">end of the Cold War</a>,
Hughes acquired General Dynamics' missile business in 1991 before being
acquired by General Motors in 1985 and <a href="https://www.nytimes.com/1997/01/17/business/gm-to-sell-a-hughes-unit-to-raytheon.html">sold to Raytheon in 1997</a>.
The Fort Defiance facility was <a href="https://www.nhonews.com/opinion/ft-defiance-factory-to-close/article_4690c724-8082-5627-bdac-c001940e160b.html">closed in 2002</a> when its parent company, Delphi Automotive Systems, moved out of the military wiring business.
The Farmington plant remains open, now <a href="https://www.dws.state.nm.us/Portals/0/DM/Raytheon_Dine_Facility.pdf">Raytheon Diné</a>, building
components for <a href="https://raytheon.mediaroom.com/2017-04-24-Raytheon-completes-new-5-million-warehouse-at-Dine-facility-near-Farmington">Tomahawk, Javelin, and AMRAMM missiles</a>.</p>
<!-- formerly Stinger 
https://books.google.com/books?id=jqCSmD9riiAC&pg=PA41&dq=Packard-Hughes+Interconnect+Fort+Defiance&hl=en&newbks=1&newbks_redir=0&sa=X&ved=2ahUKEwivzPX-7I6IAxU55ckDHWzALbAQuwV6BAgLEAc#v=onepage&q=Packard-Hughes%20Interconnect%20Fort%20Defiance&f=false
-->

<p><a href="https://static.righto.com/images/pentium-rug/general-dynamics.jpg"><img alt="Navajo workers at the General Dynamics plant in Fort Defiance, AZ. From the 1965 General Dynamics film &quot;The Navajo moves into the electronic age&quot;. From American Indian Film Gallery." height="446" src="https://static.righto.com/images/pentium-rug/general-dynamics-w500.jpg" title="Navajo workers at the General Dynamics plant in Fort Defiance, AZ. From the 1965 General Dynamics film &quot;The Navajo moves into the electronic age&quot;. From American Indian Film Gallery." width="500"></a></p><p>Navajo workers at the General Dynamics plant in Fort Defiance, AZ. From the 1965 General Dynamics film "The Navajo moves into the electronic age". From <a href="https://aifg.arizona.edu/film/navajo-moves-electronic-age">American Indian Film Gallery</a>.</p>
<h2>Inside the Fairchild 9040 integrated circuit</h2>
<p>The integrated circuit die image in
Fairchild's commemorative brochure has an exceptionally striking design and color scheme.
It's clear why this chip brings weaving to mind.
Studying the die photo of the 9040 carefully reveals some interesting characteristics of integrated circuit design, so
I will go into some detail.</p>
<p><a href="https://static.righto.com/images/pentium-rug/9040.jpg"><img alt="Die photo of the Fairchild 9040 flip-flop. From the commemorative brochure." height="500" src="https://static.righto.com/images/pentium-rug/9040-w500.jpg" title="Die photo of the Fairchild 9040 flip-flop. From the commemorative brochure." width="500"></a></p><p>Die photo of the Fairchild 9040 flip-flop. From the commemorative brochure.</p>
<p>The chip was fabricated from a tiny square of silicon, which appears purple in the photograph.
Different regions of the silicon die were treated (doped) with impurities to change the properties of the silicon and thus create
electronic devices. These doped regions appear as green or blue lines.
The white lines are the metal layer on top of the silicon, connecting the components. The 13 metal rectangles
around the border are the bond pads.
The chip was packaged in an unusual 13-pin flat-pack, as shown below.
Each of the 13 bond pads above was connected by a tiny wire to one
of the 13 external pins.</p>
<p><a href="https://static.righto.com/images/pentium-rug/flatpack.jpg"><img alt="The Fairchild 9040 packaged in a 13-pin flatpack integrated circuit. The chip was also available in a 14-pin DIP, a standard way of packaging chips. Photo from the commemorative brochure." height="97" src="https://static.righto.com/images/pentium-rug/flatpack-w250.jpg" title="The Fairchild 9040 packaged in a 13-pin flatpack integrated circuit. The chip was also available in a 14-pin DIP, a standard way of packaging chips. Photo from the commemorative brochure." width="250"></a></p><p>The Fairchild 9040 packaged in a 13-pin flatpack integrated circuit. The chip was also available in a 14-pin DIP, a standard way of packaging chips. Photo from the commemorative brochure.</p>
<p>The Fairchild 9040 was introduced in the mid-1960s as part of Fairchild's Micrologic family, a set of high-performance
integrated circuits that were designed to work together.<span id="fnref:dtl"><a href="#fn:dtl">13</a></span>
The 9040 chip was a "flip-flop", a circuit capable of storing a single bit, a 0 or 1. Flip-flops can be combined to
form counters, counting the number of pulses, for instance.</p>
<p>The most dramatic patterns on the chip are the intricate serpentine blue lines.
Each line forms a resistor, controlling the flow of electricity by impeding its path.
The lines must be long to provide the desired resistance, so they wind back and forth to fit into the available space.
Each end of a resistor is connected to the metal layer, wiring it to another part of the circuit.
Most of the die is occupied by resistors, which is a disadvantage of this type of circuit. Modern integrated circuits
use a different type of circuitry (CMOS), which is much more compact, partly because it doesn't need bulky resistors.</p>
<p><a href="https://static.righto.com/images/pentium-rug/resistors.jpg"><img alt="Resistors in the 9040 die." height="241" src="https://static.righto.com/images/pentium-rug/resistors-w500.jpg" title="Resistors in the 9040 die." width="500"></a></p><p>Resistors in the 9040 die.</p>
<p>Transistors are the main component of an integrated circuit. These tiny devices act as switches, turning signals on and off.
The photo below shows one of the transistors in the 9040.
It consists of three layers of silicon, with metal wiring connected to each layer. Note the blue region in the middle,
surrounded by a slightly darker purple region; these color changes indicate that the silicon has been doped to change
its properties.
The green region surrounding the transistor provides isolation between this transistor and the other circuitry, so
the transistors don't interfere with each other.
The chip also has many diodes, which look similar to transistors except a diode has two connections.</p>
<p><a href="https://static.righto.com/images/pentium-rug/transistor.jpg"><img alt="A transistor in the 9040 die. The three contacts are called the base, emitter, and collector." height="135" src="https://static.righto.com/images/pentium-rug/transistor-w200.jpg" title="A transistor in the 9040 die. The three contacts are called the base, emitter, and collector." width="200"></a></p><p>A transistor in the 9040 die. The three contacts are called the base, emitter, and collector.</p>
<p>These transistors with their three layers of silicon are a type known as bipolar. 
Modern computers use a different type of transistor, metal-oxide-semiconductor (MOS), which is much more compact and
efficient. 
One of Fairchild's major failures was staying with bipolar transistors too long, rather than moving to MOS.<span id="fnref:mos"><a href="#fn:mos">14</a></span>
In a sense, the photo of the 9040 die shows the seeds of Fairchild's failure.</p>
<p>The 9040 chip was constructed on a completely different scale from the Pentium, showing the rapid progress of the IC industry.
The 9040 contains just 16 transistors, while the Pentium contains 3.3 million transistors.
Thus, individual transistors can be seen in the 9040 image, while only large-scale functional blocks are visible in the Pentium.
This increasing transistor count illustrates the exponential growth
in integrated circuit capacity between the 9040 in the mid-1960s and the Pentium in 1993.
This growth pattern, with the number of transistors doubling about every two years, is known as Moore's law, since it
was first observed in 1965 by Gordon Moore (one of Fairchild's "traitorous eight", who later started Intel).</p>
<p>The schematic below shows the circuitry inside the 9040 chip, with its
16 transistors, 16 diodes, and 22 resistors.
The symmetry of the 9040 die photo makes it appealing, and that symmetry is reflected in the circuit below, with the left side and
the right side mirror images.
The idea behind a flip-flop is that it can hold either a 0 or a 1. In the chip, this is implemented by turning on the
right side of the chip to hold a 0, or the left side to hold a 1. If one side of the chip is on, it forces the other side
off, accomplished by the X-like crossings of signals in the center.<span id="fnref:schematic"><a href="#fn:schematic">15</a></span>
Thus, the symmetry is not arbitrary, but is critical to the operation of the circuit.</p>
<p><a href="https://static.righto.com/images/pentium-rug/schematic.jpg"><img alt="Schematic of the Fairchild 9040 flip-flop chip. From Fairchild 1970 Data Catalog." height="498" src="https://static.righto.com/images/pentium-rug/schematic-w600.jpg" title="Schematic of the Fairchild 9040 flip-flop chip. From Fairchild 1970 Data Catalog." width="600"></a></p>
<p>Despite the obscurity of the 9040, multiple 9040 chips are currently on the Moon.
The chip was
used in the Apollo Lunar Surface Experiments Package (ALSEP),<span id="fnref:apollo"><a href="#fn:apollo">16</a></span>
in particular, the Active Seismic Experiment on Apollo 14 and 16. This experiment detonated small explosives on the Moon
and measured the resulting seismic waves.
The photo below is a detail from a blueprint<span id="fnref:alsep"><a href="#fn:alsep">17</a></span>
that shows three of the nineteen 9040 flip-flops (labeled "FF") as well as two 9041 logic gates, a chip in the same family
as the 9040.</p>
<p><a href="https://static.righto.com/images/pentium-rug/ase.jpg"><img alt="Detail from Logic Schematic Type B Board No.4 ASE." height="261" src="https://static.righto.com/images/pentium-rug/ase-w400.jpg" title="Detail from Logic Schematic Type B Board No.4 ASE." width="400"></a></p><p>Detail from Logic Schematic Type B Board No.4 ASE.</p>
<h2>Conclusions</h2>
<p>The similarities between Navajo weavings and the patterns in integrated circuits have been described since the 1960s.
Marilou Schultz's weavings of integrated circuits make these visual metaphors into concrete works of art.
Although the Woven Histories exhibit at the National Gallery of Art is no longer on display,
the exhibit will be at the National Gallery of Canada (Ottawa) starting November 8, 2024, and the Museum of Modern Art (New York)
starting April 20, 2025
(full dates <a href="https://www.nga.gov/press/exhibitions/exhibitions-2024/5415.html">here</a>).
If you're in the area, I recommend viewing the exhibit, but don't make my mistake: leave more than
five minutes to see it!</p>
<p>Many thanks to Marilou Schultz for discussing her art with me.
For more on her art, see <a href="https://www.youtube.com/watch?v=lyVDvYURpqo">A Conversation with Marilou Schultz</a> on YouTube.<span id="fnref:amd"><a href="#fn:amd">18</a></span>
Follow me on Mastodon as <a href="https://oldbytes.space/@kenshirriff">@<span data-cfemail="c9a2aca7baa1a0bbbba0afaf89a6a5adabb0bdacbae7bab9a8aaac">[email&nbsp;protected]</span></a>
or <a href="https://www.righto.com/feeds/posts/default">RSS</a> for updates.</p>
<h2>Notes and references</h2>


</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Using the moiré effect to show different arrows to each observer (2018) (140 pts)]]></title>
            <link>https://www.popularmechanics.com/technology/infrastructure/a19091534/inogon-leading-mark-moire-effect-light/</link>
            <guid>41417997</guid>
            <pubDate>Sun, 01 Sep 2024 16:06:13 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.popularmechanics.com/technology/infrastructure/a19091534/inogon-leading-mark-moire-effect-light/">https://www.popularmechanics.com/technology/infrastructure/a19091534/inogon-leading-mark-moire-effect-light/</a>, See on <a href="https://news.ycombinator.com/item?id=41417997">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-journey-body="standard-article"><p data-journey-content="true" data-node-id="0">Imagine you're in charge of guiding ships into a harbor and you want to use a sign to direct them all to one specific point, perhaps a dock or a channel. How might you make a single signal light that always points to the right direction depending on the angle you look at it, to the right if you're too far left, and to the left if you're too far right? </p><p data-journey-content="true" data-node-id="1">Here in 2018, your mind might go to location tracking or some other high tech solution, but in 1982, some clever engineers had already figured out an answer with no electronics required. Well, other than a light. <a href="https://www.youtube.com/watch?v=d99_h30swtM" target="_blank" data-vars-ga-outbound-link="https://www.youtube.com/watch?v=d99_h30swtM" data-vars-ga-ux-element="Hyperlink" data-vars-ga-call-to-action="Tom Scott explains">Tom Scott explains</a>: </p><p data-journey-content="true" data-node-id="3">The Inogon Leading Mark makes use of what's called the moiré effect, that strange type of distortion you see when looking at a series of overlapping, not-quite-parallel lines. You may be familiar with it as a form of digital image artifacting, a strange jaggy cloudiness that can appear in certain images or video, like <a href="https://www.youtube.com/watch?v=jXEgnRWRJfg" target="_blank" data-vars-ga-outbound-link="https://www.youtube.com/watch?v=jXEgnRWRJfg" data-vars-ga-ux-element="Hyperlink" data-vars-ga-call-to-action="a clip of a striped shirt">a clip of a striped shirt</a>. <br></p><p data-journey-content="true" data-node-id="5">If you use this phenomenon cleverly, however,  you can create an image that can change depending on the angle its viewed from. In the case of the Inogon light, it will always display an arrow or series of arrows (sometimes strange, distorted ones) pointed in the direction you want them to go. It's like an optical illusion that's good for more than <a href="https://www.popularmechanics.com/science/a14400798/optical-illusion-new/" target="_blank" data-vars-ga-outbound-link="https://www.popularmechanics.com/science/a14400798/optical-illusion-new/" data-vars-ga-ux-element="Hyperlink" data-vars-ga-call-to-action="just blowing your mind">just blowing your mind</a>.</p><p data-journey-content="true" data-node-id="6">Source: <a href="https://www.youtube.com/watch?v=d99_h30swtM" target="_blank" data-vars-ga-outbound-link="https://www.youtube.com/watch?v=d99_h30swtM" data-vars-ga-ux-element="Hyperlink" data-vars-ga-call-to-action="Tom Scott">Tom Scott</a><br></p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[HNInternal: Ask HN: How to store and share passwords in a company? (165 pts)]]></title>
            <link>https://news.ycombinator.com/item?id=41417659</link>
            <guid>41417659</guid>
            <pubDate>Sun, 01 Sep 2024 15:17:07 GMT</pubDate>
            <description><![CDATA[<p>See on <a href="https://news.ycombinator.com/item?id=41417659">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
            <tbody><tr id="41420875"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41420875" href="https://news.ycombinator.com/vote?id=41420875&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>You generally want to minimize the number of passwords you manage; for instance, you should generally be paying the SSO tax and getting as many services as you can onto OIDC. After that, just do the cloud version of 1Password, which is easy to audit and manage access for, which you'll thank yourself for when it comes time to SOC2.</p><p>Remember, as you give people access to passwords, that those passwords will need to be rotated when those people change to incompatible roles or depart the company. If passwords aren't a total pain in the ass for you, you're probably doing something wrong.</p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="41421614"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41421614" href="https://news.ycombinator.com/vote?id=41421614&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>And when you set up 1Password, make sure you also get the CLI going, so passwords &amp; shared gunk that's needed to access other people's services can be scripted, and when the passwords, etc get rotated no-one needs to know because no-one needs to store them.</p>
              </div></td></tr>
        </tbody></table></td></tr>
                <tr id="41421701"><td></td></tr>
                  <tr id="41421696"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41421696" href="https://news.ycombinator.com/vote?id=41421696&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>Never pay the "SSO tax" by outsourcing to Okta, etc. There many FOSS IdP solutions that are usable with some customization and integration.</p>
              </div></td></tr>
        </tbody></table></td></tr>
            <tr id="41421635"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41421635" href="https://news.ycombinator.com/vote?id=41421635&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>That is the answer.</p><p>SSO, then password manager.</p><p>I'd strongly recommend bitwarden, having deployed and managed it. I would warn against lastpass, strongly, due to papercut level issues everywhere. I haven't used 1password in an appropriate scenario to comment on it.</p></div></td></tr>
        </tbody></table></td></tr>
                  <tr id="41420882"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41420882" href="https://news.ycombinator.com/vote?id=41420882&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>Don't. Give them access to all systems they need with their own user/password. That way you can revoke them (if/when necessary) without disrupting everyone else.</p><p>Also automate as much as is reasonable, e.g. github access to push code to a dev branch, then enqueue merging of it. But a CI/CD pipeline does the actual deploy, the employee doesn't need to access any of the production systems. A very small number still will, but that's a much better situation.</p><p>Give the employee 1Password to manage their own passwords.</p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="41421022"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41421022" href="https://news.ycombinator.com/vote?id=41421022&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>I agree with this. But I want to ask a similar question as OP but for services. How do you handle service account credentials in a good way? Typically multiple engineers need to be able to test out a given service account. So a number of users need to have access to the credentials of that service account. And you need a good way to enroll a new service to service connection, i.e give a service account access to another service.</p><p>I haven't seen this done in a way that didn't feel overly complex, prone to error and oversharing of secrets.</p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="41421367"><td><table>  <tbody><tr>    <td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td>
      <center><a id="up_41421367" href="https://news.ycombinator.com/vote?id=41421367&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>You need to be able to automate 3 things:</p><pre><code>   1. Account pass retrieval
   2. Account pass rotation
   3. Account pass ref update
</code></pre><p>
(1) is how a user gets the pass when needed (normal process or break glass debug). (2) is how the pass rotates to an unknown value, automatically, after the user is done with it. (3) is how the new value gets updated in references, without the user knowing the new value.</p><p>At the root of any solution are answers to those 3 needs.</p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="41421043"><td><table>  <tbody><tr>    <td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td>
      <center><a id="up_41421043" href="https://news.ycombinator.com/vote?id=41421043&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>&gt; <i>the credentials</i> of that service account</p><p>Why do these accounts only have a single user/password?</p><p>In any case, my answer would again be automation. Script the test, have the authorized process test out the service account on behalf of any employee who can create and run those tests.</p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="41421664"><td><table>  <tbody><tr>    <td indent="3"><img src="https://news.ycombinator.com/s.gif" height="1" width="120"></td><td>
      <center><a id="up_41421664" href="https://news.ycombinator.com/vote?id=41421664&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>Because that's just how some products are set up. Not every external service account provides separate passwords for different employees, there's just a single corporate account that some certain number of people need to have access to.</p><p>And automation isn't an answer to that. The question is how to share the password in the first place, not to automate what is done with it.</p></div></td></tr>
        </tbody></table></td></tr>
                        <tr id="41421160"><td></td></tr>
                <tr id="41421592"><td><table>  <tbody><tr>    <td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td>
      <center><a id="up_41421592" href="https://news.ycombinator.com/vote?id=41421592&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>Ideally they would support SSO, but at a minimum any service that wants business customers will have accounts in some form. If they don't even have that then I would seriously second guess using them for anything in production. They're clearly not designed for businesses and can't be relied upon to not screw you up in serious ways.</p>
              </div></td></tr>
        </tbody></table></td></tr>
                        <tr id="41419715"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41419715" href="https://news.ycombinator.com/vote?id=41419715&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>&gt; We tend to have zillions of passwords in IT jobs right?</p><p>Yes, but they should be unique to your account. I.e. via SSO.</p><p>&gt; What are the recommended ways to store and give access to passwords?</p><p>Whenever possible, don't.  Otherwise, it depends on the scale and security you need.  A password manager is one possible solution. Another solution is something like Hashicorp's Vault or OpenBao.</p><p>&gt; How can a new hire be given access to all required passwords day 1?</p><p>They should access it through their SSO account, and not need a billion passwords across systems.</p><p>&gt; And when such new hire gets promoted, how can we give access to the additional passwords they will need?</p><p>Again, whenever possible, tie access to their SSO account.</p><p>&gt; And if someone leaves the company, how can we change only the sensible passwords they had access to and preferably notify everyone with access to it that it was changed?</p><p>Well if you did all of the above this wouldn't be an issue, you just close the 1 account.</p><p>&gt; Any best practices? Any 80/20 suggestions? Low hanging fruits? Any warnings about what not to do?</p><p>Another thing you can do is give people 2 accounts, a normal account and an Admin level account, this is useful for things where the employee needs a regular day to day account as well.  i.e. for the employee self portal for instance.</p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="41420216"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41420216" href="https://news.ycombinator.com/vote?id=41420216&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>&gt; Yes, but they should be unique to your account. I.e. via SSO.</p><p>This is a great best practice, but user-based value metrics for many SaaS platforms make this untenable for some IT departments. If folks have to log in seldomly, it's very hard to make the business case to pay per user.</p><p>Similarly, there's many SaaS platforms that charge A LOT extra for SSO because you have to upgrade to their Enterprise-pricing model. If managing a separate user directory isn't worth it because the software isn't personalized, understaffed IT departments aren't going to do that either.</p><p>So while there is a best practice, dismissing solutions that are "good enough" (while sharing tradeoffs) isn't as helpful.</p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="41420260"><td></td></tr>
                <tr id="41421507"><td></td></tr>
                  <tr id="41420934"><td><table>  <tbody><tr>    <td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td>
      <center><a id="up_41420934" href="https://news.ycombinator.com/vote?id=41420934&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>We change our PW for some platforms every month, so that people leaving won’t have access anymore</p>
              </div></td></tr>
        </tbody></table></td></tr>
                <tr id="41421780"><td><table>  <tbody><tr>    <td indent="3"><img src="https://news.ycombinator.com/s.gif" height="1" width="120"></td><td>
      <center><a id="up_41421780" href="https://news.ycombinator.com/vote?id=41421780&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>Well except for the period of time between them quitting and the new month rolls around.</p><p>You really should change passwords the second they leave. Yes it's a PITA, but you should do it anyway.</p></div></td></tr>
        </tbody></table></td></tr>
                  <tr id="41420238"><td><table>  <tbody><tr>    <td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td>
      <center><a id="up_41420238" href="https://news.ycombinator.com/vote?id=41420238&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>Shared PWs are sometimes inevitable but then you must rotate them every time someone with access leaves the company. OneLogin also has a way to minimize handling of the shared passwords for auto-logins that depend on shared creds</p>
              </div></td></tr>
        </tbody></table></td></tr>
                  <tr id="41420259"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41420259" href="https://news.ycombinator.com/vote?id=41420259&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>SSO all the way (if you can). Chances are you've got Google Workspace or Microsoft 365 - both allow you to configure SAML based SSO into many SaaS apps either through their respective app galleries or some kind of custom configuration. Otherwise you could look at Okta, but be prepared to fork out serious cash. We use Entra ID (part of Microsoft 365) for SSO in our business, and it generally works well.</p><p>There'll be times that employees can't use SSO though. For that I'll add my voice to 1Password - it's well designed such that a breach of the 1PW service itself won't reveal credentials (you'd need peoples vault passwords and secret keys for that). Avoid Lastpass - the UI is awful, and they've been breached in the past.</p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="41420371"><td><table>  <tbody><tr>    <td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td>
      <center><a id="up_41420371" href="https://news.ycombinator.com/vote?id=41420371&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>&gt; Avoid Lastpass - the UI is awful, and they've been breached in the past</p><p>They have had multiple serious breaches and to add insult to injury they have engaged in some gaslighting-esque style marketing to inquiries.</p></div></td></tr>
        </tbody></table></td></tr>
                        <tr id="41421756"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41421756" href="https://news.ycombinator.com/vote?id=41421756&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>Best fight?  Don't be in one.</p><p>As many here have recommended, where possible employ authentication/authorization mechanisms which are not reliant upon account+password for everything.  OIDC, OAuth2, Kerberos[0], and Active Directory[1] are all technologies worth considering.</p><p>Where possible, employ a per-developer sandbox development environment such that each can have a representative system able to support feature/integration tests without having to rely on the CI/CD workflow or a fully replicated production environment.</p><p>All of the above share a common theme - limit shared access while maximizing productivity.</p><p>As for access to support tools, like source code repositories, ticketing systems, wikis, HR systems, and the like, automate where possible to create the requisite accounts and recommend use of a password manager for same.</p><p>EDIT: bonus points for using a private organizational GitHub repo configured to execute GitHub actions that create the above support accounts when a new-hire PR is approved by authorized personnel.</p><p>0 - <a href="https://en.wikipedia.org/wiki/Kerberos_(protocol)" rel="nofollow">https://en.wikipedia.org/wiki/Kerberos_(protocol)</a></p><p>1 - <a href="https://en.wikipedia.org/wiki/Active_Directory" rel="nofollow">https://en.wikipedia.org/wiki/Active_Directory</a></p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="41419274"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41419274" href="https://news.ycombinator.com/vote?id=41419274&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>- Use 1Password or similar password vault to deliver account passwords on day one; the password manager also promotes good personal password management practices</p><p>- only share passwords for personal accounts; those accounts you terminate when the employee separates. For shared resources, use SSO and SCIM group management via the SSO provider to add and remove accounts from groups with different roles.</p><p>Rippling seems like a neat offering because they bundle SSO with HR people management, and their HR product is the best I’ve used as an employee - hopefully the administrative side is just as good or better.</p><p>If those SaaS tools aren’t in your budget, try looking for open-source or gratis alternatives with the same shape, or repurposing whatever IT infra you have to implement a similar model.</p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="41420192"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41420192" href="https://news.ycombinator.com/vote?id=41420192&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>I wouldn't want HR in charge of my secrets management in any way shape or form.</p><p>Happy to have a level of group synchronisation out of HR's systems, but certainly would not give them the ability to manage the high-power users.</p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="41419876"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41419876" href="https://news.ycombinator.com/vote?id=41419876&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>We use 1Password at our company and it works extremely well.</p><p>We also use opal for dynamic access to things like AWS or our DB service where a temp user with a specific IAM role / temp db user / pass is created for that user's session. For higher level access, someone would approve the request before credentials are generated.</p><p><a href="https://opal.dev/" rel="nofollow">https://opal.dev/</a></p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="41419925"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41419925" href="https://news.ycombinator.com/vote?id=41419925&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>OOI do you ever use SCIM for something really granular? I have a service where people can be one of 5 roles and then have access to 1..30 named 'workspaces' - all that we'd like to control with policy on our side not vendor side</p><p>I think it's unsuitable for SCIM because I'd have to create 5*30 AD groups?</p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="41421526"><td></td></tr>
                  <tr id="41420215"><td></td></tr>
                  <tr id="41420433"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41420433" href="https://news.ycombinator.com/vote?id=41420433&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>We always used 1Password[0]. We still use it in the open-source projects that I work with.</p><p>I have heard that LastPass is about as good, but have no experience using it.</p><p>The latest version of 1Password isn't so good, but it works fine.</p><p>[0] <a href="https://1password.com/" rel="nofollow">https://1password.com</a></p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="41420680"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41420680" href="https://news.ycombinator.com/vote?id=41420680&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>&gt; I have heard that LastPass is about as good</p><p>I am shocked how you could've possibly heard this. Basically everything I've heard rounds to "LastPass is the worst available option" and "1Password is the best available option." I use neither.</p></div></td></tr>
        </tbody></table></td></tr>
                      <tr id="41421105"><td></td></tr>
            <tr id="41420591"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41420591" href="https://news.ycombinator.com/vote?id=41420591&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>+1 for 1password, it just works.</p><p>Avoid lastpass like the plague. I can’t believe the company is still around.</p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="41421633"><td></td></tr>
            <tr id="41420624"><td></td></tr>
            <tr id="41420739"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41420739" href="https://news.ycombinator.com/vote?id=41420739&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>Have also used 1password.  It's great.  It has an API that you can code against for automation, and you can also mirror some passwords / tokens into hashicorp vault.</p>
              </div></td></tr>
        </tbody></table></td></tr>
            <tr id="41420971"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41420971" href="https://news.ycombinator.com/vote?id=41420971&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>The fanbase for LastPass on HN is close to zero.</p><p>Bitwarden paid allows for sharing folders out to other users. I believe those can be non-paid.</p><p>Various clients have used 1PW. It works but for reasons I don't recall atm I never liked it as much as BW.</p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="41420833"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41420833" href="https://news.ycombinator.com/vote?id=41420833&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>1Password is the way to go for service accounts shared by admins. Not sure if OP is talking about users though. In that case, should definitely pick an SSO solution for as many services as possible.</p>
              </div></td></tr>
        </tbody></table></td></tr>
                  <tr id="41420517"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41420517" href="https://news.ycombinator.com/vote?id=41420517&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>This is a great question IMO. For those saying "just don't share passwords", consider that many of the vendor accounts you might need to use in business don't have team accounts, and there is no option but to share accounts. It's a legitimate thing that comes up rather often.</p>
              </div></td></tr>
        </tbody></table></td></tr>
            <tr id="41420357"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41420357" href="https://news.ycombinator.com/vote?id=41420357&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>Don't think that SSO is a magic solution for all of this. I'd say SSO won't work with any of it. SSO will work for new integrations but typically a team and team members will need passwords or API keys or tokens (all of these are strings, in effect passwords), and for that, beyond SSO, I have used and can recommend, for many teams in large organisations:</p><p>- A secrets manager (e.g. AWS Secrets manager) with an API key for each team, and the team can access their secrets on a team level there</p><p>- An encrypted file encrypted with e.g. KeePass, and one password for that</p><p>- Bitwarden or Lastpass on a team or department level (yes, shared passwords, for example where there is one password for one proxy)</p><p>- Yopass <a href="https://yopass.se/" rel="nofollow">https://yopass.se/</a></p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="41421684"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41421684" href="https://news.ycombinator.com/vote?id=41421684&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>Keeper for human-to-human ones that cannot be otherwise managed with individual account access and OpenBao (Vault fork) for automated secret generation and sharing. Implement an IdP (SSO and more) on-prem because it's so much more convenient and safer than outsourcing.</p>
              </div></td></tr>
        </tbody></table></td></tr>
            <tr id="41419578"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41419578" href="https://news.ycombinator.com/vote?id=41419578&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>I'd strongly advise against 1Password, several answers here recommending it and I suspect conflating personal use with 'good enough for business', hard disagree.</p><p>Your company can apply various aspects of threat modelling and more often than not several companies I've worked with find that Bitwarden self-hosted can meet a lot of requirements, this is the best solution in terms of privacy and security and controlling your trust boundaries. Failing that, Bitwarden Enterprise (they host) is also just as good. In either case there's granular controls for controlling what your new hires can be given access to.</p><p>There won't be a perfect solution such as notifying everyone about rotation, it's not needed though - simply rotate it and the next time they need it they get the new version.</p><p>Of course the general advice is something I agree with - use SSO where possible, but I fully recognise that it isn't always possible with some third party services that haven't implemented it yet.</p><p>There is a cruder solution I've often seen too, it's a bit painful but KeePass2/KeePassXC on a company hosted SAN is the ultimate offline, fully controlled solution but comes with extra hurdles to access, whereas Bitwarden is browser based and simpler to use.</p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="41419669"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41419669" href="https://news.ycombinator.com/vote?id=41419669&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>We used 1Password at a ~6,000 employee tech company and it was fine. Never had any issues with 1Password.</p>
              </div></td></tr>
        </tbody></table></td></tr>
            <tr id="41419628"><td></td></tr>
                      <tr id="41419637"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41419637" href="https://news.ycombinator.com/vote?id=41419637&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>We use Bitwarden as well. It seems to offer the sort of fine grained controls that let the right people have access to the right secrets.</p>
              </div></td></tr>
        </tbody></table></td></tr>
            <tr id="41419883"><td></td></tr>
                <tr id="41420300"><td><table>  <tbody><tr>    <td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td>
      <center><a id="up_41420300" href="https://news.ycombinator.com/vote?id=41420300&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>They mention self-hosted. Unless there's a long-game supply chain attack where they infiltrate the vendor and poison the updates and nobody notices until it's too late (that disaster scenario can always happen), at least not all your passwords are gone the minute the central server where everyone's data is stored gets compromised</p><p>I don't have much experience with either product but based on what the person said, that seems the most plausible reason to me. If 1Password does something like encrypting it for every user individually and so the server can't read the stored data (like when it's decrypted in the browser with the user's password, then an attacker would again need to compromise the website, wait, and hope nobody notices until their target logs in), then I guess GP really needs to clarify what they meant</p></div></td></tr>
        </tbody></table></td></tr>
                        <tr id="41419378"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41419378" href="https://news.ycombinator.com/vote?id=41419378&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>A password manager with some documentation and process could solve this.</p><p>What I describe is more or less what has been the standard at the companies I worked for, no secret sauce here, and I added some extra processes to address the questions you asked.</p><p>Get a password manager service (none of the keepass file thrown onto Google Drive), we used 1password, it's good enough I assume. Keep related items in one collection, don't mix unrelated items. Always save passwords in the pw manager, and make sure everyone does that, too. When someone joins, give them access to what makes sense. If someone gets promoted, add them to a new collection. Document who is allowed access to each collection if necessary. When someone leaves, kick them out of the password manager service first, then in a timely fashion, change the passwords (I don't know if you can do it automatically, but if churn isn't too bad, you can also do it manually). Save the new passwords in your passwords manager. As everyone uses the password manager, they will automatically get the new passwords without them even realizing it changed.</p><p>Some extra that's also important: if possible, use SSO and everyone uses their own account, eg Okta. Create and share passwords only if needed. When one off accounts are needed, make sure they are created with company email addresses, ideally named after a team rather an individual.</p><p>My experience is that most companies can't be bothered to change passwords every time someone leaves. Most people are not assholes, or want to go to court and possibly jail for messing around in accounts from their old companies (even if they could technically save the passwords for their own use for later).</p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="41421081"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41421081" href="https://news.ycombinator.com/vote?id=41421081&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>Question: has anybody actually worked in a password-less or even “zero trust” environment?</p><p>Most environments I have worked with struggle with sharing passwords like OP and it’s a massive pain. One time, dev team was sharing active directory credentials to access service. At some point service account gets locked because someone was using an older password of the account.</p><p>Usually a quick problem to solve with 2-3 people in same region (or prevented entirely), but teams across time zones and  countries (US vs Vietnam or India). It becomes painful. Doesn’t matter if they are “senior” or green/“junior” engineers.</p><p>If I ever have my own company, I want my own internal IdP (identity provider) and all internal and external services integrated with it. Employees issued (multiple) physical hardware keys. This is required to authenticate with work computer and subsequent access to VPN/tail scale.</p><p>Individual services and products must support oauth.</p><p>Access to public cloud resources? AuthN through company IdP. Admin creates roles for you to access resources necessary for work</p><p>Access to database? No shared passwords. get admin to add authorization, then authN via IdP and get access token</p><p>Version control? Same as above.</p><p>E-mail? Same as above.</p><p>Company document repository? AuthN through IdP which requires physical security key.</p><p>Access to company laptop/desktop? Plug-in security key. Permissions/roles managed remotely (give bob sys access for dev work but jenny from HR is given very basic system access).</p><p>Then once you are done, then remove security key and all established sessions are removed and logged out of computer (or just locked).</p><p>Employee leaves? Just disable the account. Maybe leave a small window of access to certain services (ie, email) so they could say their goodbyes, turn in company equipment. Then revoke access completely.</p><p>Hostile or state actor obtained security key of active employee? From IdP, mass revoke all access. Can also track what actor accessed as well.</p><p>With this, problem OP has proposed has disappeared completely.</p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="41421116"><td></td></tr>
                  <tr id="41419249"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41419249" href="https://news.ycombinator.com/vote?id=41419249&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>I've built security programs at 3 companies. This is how I would solve these problems.</p><p>1. SSO everywhere. Okta if budget is no concern and Keycloak if it is.</p><p>2. Password manager for the entire company. Even if it's possible to go SSO everywhere, there are still secrets employees will need to manage. Give them a solution or they'll solve it on their own and not in a good way. I like 1Password.</p><p>3. All services use a secret solution that can broker short lived secrets and a policy that limits secret TTL to a day or less. I like HashiCorp Vault.</p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="41419368"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41419368" href="https://news.ycombinator.com/vote?id=41419368&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>Next you’re gonna tell me “send me the password over slack and then delete the message” isn’t good password security.</p>
              </div></td></tr>
        </tbody></table></td></tr>
            <tr id="41419519"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41419519" href="https://news.ycombinator.com/vote?id=41419519&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>About 1, unless you have a dev team and dedicated time to make compatibility layers, you're more or less limited to whatever application and saas supports your sso of choice though, correct ?</p>
              </div></td></tr>
        </tbody></table></td></tr>
                <tr id="41420373"><td><table>  <tbody><tr>    <td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td>
      <center><a id="up_41420373" href="https://news.ycombinator.com/vote?id=41420373&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>No, SAML is the standard these days and it’s supported nearly everywhere (where it matters). No vendor lock-in.</p><p>Although I’m not sure why you’d go with a 3rd party idp rather than just using Google Workspace (or Microsoft equivalent).</p></div></td></tr>
        </tbody></table></td></tr>
                        <tr id="41420622"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41420622" href="https://news.ycombinator.com/vote?id=41420622&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>Most services are connected through SSO, so those won't have passwords and are automatically shut down when the user leaves the company.</p><p>All employees also have a 1password account for which we can store individual passwords for the services that are not connected through SSO.</p><p>For some services we only have a single token/service account which we need to share within the team. Often they were stored in a `.env` file, but that tend to be a burden for onboarding and quite a bit of maintenance for each individual.</p><p>Within my current team we share them using direnv and <a href="https://github.com/tmatilai/direnv-1password">https://github.com/tmatilai/direnv-1password</a>. Secrets are loaded as environment variables whenever the dev enters the projects directory. They are loaded from 1password which is unlocked using fingerprint scanner. This way the secrets are not actually stored on disk.</p><p>People leaving the team does still require manual password rotation, but at least not everyone in the team needs to update their `.env` file this way.</p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="41420769"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41420769" href="https://news.ycombinator.com/vote?id=41420769&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>Thanks for this comment. I currently use direnv with great success for managing virtual environments (mostly various language versions, dependencies, and environment variables). I'll look into this approach of pulling in credentials for those environments from a password store.</p><p>I think direnv is a highly underrated tool. Switching between environments with a simple 'cd' is of huge benefit to my development experience.</p></div></td></tr>
        </tbody></table></td></tr>
                  <tr id="41421787"><td></td></tr>
            <tr id="41421502"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41421502" href="https://news.ycombinator.com/vote?id=41421502&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>Use a payroll or onboarding system that incorporates password management</p><p>Rippling's Rpass is a good example of effective implementation.</p><p>You can deploy passwords on day 1 based on roles, dept etc.</p><p>You can also set passwords to be hidden , not shared etc.</p><p>SSO is best practice but this is by far the most effective way for vendor account management.</p><p>Oh if you are doing this make sure you have set up group-based SSO.</p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="41420663"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41420663" href="https://news.ycombinator.com/vote?id=41420663&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>I have Bitwarden Enterprise deployed and authenticate via our IDP. It's been working well for us, each team has their own collection that they manage. From an IT admin perspective, it's pretty hands off. Any changes to password are automatically synced between users.</p>
              </div></td></tr>
        </tbody></table></td></tr>
            <tr id="41421447"><td></td></tr>
            <tr id="41420392"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41420392" href="https://news.ycombinator.com/vote?id=41420392&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>I can only say that using pass (<a href="https://www.passwordstore.org/" rel="nofollow">https://www.passwordstore.org/</a>) is an absolute nightmare, in case anyone else is considering that</p><p>It seems like perfect simplicity built on time-tested cryptography: store pgp-encrypted files in a git repository. We already had an internal git server and used PGP internally, it was the perfect marriage. The tool provides the common functions like selecting which colleagues to encrypt for, finding an entry and copying it to clipboard... but think of the moment your organization changes. Everyone has access to everything offline, which is great if you need it in a rainforest or when the server is down, but also you'd need to rotate all exposed-to-them entries whenever someone leaves. Re-encrypting everything to remove an old key is pointless because the git history will provide an attacker with whatever version they need.</p><p>Offline access is useful for selected credentials (like the disk unlock password for some central servers) but, to avoid unnecessary rotations, should not be the default unless you're a sysadmin mentioned on disaster recovery team</p><p>Skimming the recommendations, so far there are no tools mentioned that don't require maintaining another service or that can't read your data. At least pass had that going for it</p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="41420513"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41420513" href="https://news.ycombinator.com/vote?id=41420513&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>In that sense pass is no different from other password managers. What prevents the user of an "online" password manager from storing the passwords offline, remembering them, or not logging out and reusing cookies? You have to rotate the credentials themselves anyway.</p>
              </div></td></tr>
        </tbody></table></td></tr>
                <tr id="41420967"><td><table>  <tbody><tr>    <td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td>
      <center><a id="up_41420967" href="https://news.ycombinator.com/vote?id=41420967&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>Not sure what cookies have to do with it. If we would use a system where the client software only obtains the secret that the user is asking for, it can later say which credentials were accessed and thus need to be rotated when the employee leaves. If session cookies are still usable by an employee whose account was deleted, that's a vulnerability...</p>
              </div></td></tr>
        </tbody></table></td></tr>
                        <tr id="41420021"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41420021" href="https://news.ycombinator.com/vote?id=41420021&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>Shared passwords should always be an exception. Prefer SSO. However the exception will always exist, in which case:</p><p>Some suggest using KeePass or equivalent, but I advise against it - too easy to copy and leave with the vault and very difficult to audit.</p><p>Find a solution that audits who had access to such password. And do your audits!</p><p>Consider rotating your shared passwords frequently, especially any high privileged ones.</p><p>If your risks warrant it, check for a PAM (privileged access manager) that acts as a middlemen and fully hides the password.</p><p>I realize I am not really answering your questions, so I'll stop here. But... SSO and proper directory management!</p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="41421618"><td></td></tr>
                <tr id="41421625"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41421625" href="https://news.ycombinator.com/vote?id=41421625&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>Ditto this. We use this in our ~100 company and it works great. Plus, it can hold more than just IT/Tech passwords. Everyone in the company uses it constantly and only has access to what they need.</p>
              </div></td></tr>
        </tbody></table></td></tr>
                  <tr id="41421350"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41421350" href="https://news.ycombinator.com/vote?id=41421350&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>IMHO better write automation as much possible to rotate passwords firsts. Then remove ability for humans to set passwords (if possible). Your automations should store it vault (for machines) or write to 1Password directly  (for humans).</p>
              </div></td></tr>
        </tbody></table></td></tr>
            <tr id="41420751"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41420751" href="https://news.ycombinator.com/vote?id=41420751&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>Best to use SSO for SaaS passwords. This is where your whole team has a Microsoft or Google (or other identity provider) login administered centrally by the company that is further used to authenticate to various services.</p><p>As opposed to "login with Facebook etc." logins that are individually administered by each end user for each app.</p><p>This is low fruit for many things but often companies require you to be on an expensive SaaS pricing tier to use SSO on their product.</p><p>Next problem to solve is Software Engineer's cloud secrets. Use key vaults in your cloud for this. Use SSO to authenticate your team to that cloud.</p><p>Enable 2fa as much as possible. TOTP not SMS.</p><p>Finally you will need people to save passwords for some stuff. Lastpass or Bitwarden etc.</p><p>Avoid shared passwords. Sometimes unavoidable in which case rotate them often and when people leave too.</p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="41420643"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41420643" href="https://news.ycombinator.com/vote?id=41420643&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>There's a lot of tools you could use for this (I'd personally recommend OpenBao), but in my opinion proper SSO, permission and group management is way more important.</p><p>If you make an effort to define granular groups for every team, and role you have in your company it makes the management of access to resources (and not only secrets) a lot easier.</p><p>In the example you describe, the newly promoted hire would automatically be added to new groups which will have the right to access the needed Secrets. Similarly, whenever a person leaves your company, simply remove them from the groups they are in and they (almost) immediately loose all access.</p><p>It's not a small feat to built, maintain and reconfigure all your tools to use it, but if you do it really pays dividends</p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="41420086"><td></td></tr>
            <tr id="41419672"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41419672" href="https://news.ycombinator.com/vote?id=41419672&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>While building Adaptive (<a href="https://adaptive.live/" rel="nofollow">https://adaptive.live</a>), I have been working very closely with regulated industries, financial institutions, healthcare orgs. Traditionally,  people have been using Cyberark to do Identity management, paired with Privilege access management.</p><p>There are some modern Privileged Access Management platforms like Strongdm, teleport, us (<a href="https://adaptive.live/" rel="nofollow">https://adaptive.live</a>) and few more in the market that works well with cloud and modern application architectures.</p><p>There is debate in the industry whether access should be given or not. There is pros and cons for either of them. This purely  depends on the culture of the org in my opinion. But in scenario, you really have to give access, it should have the least privilege as well it should be time bound. Also, all the operations should be audited and recorded.</p><p>I believe you should have zero standing access in the org, but there are always use cases like data repair and administration where you have to give access to users. In that scenario, the access should be limit, time bound and audited. Also, you have to make sure you run access review campaigns and checks for over privileged or unused users.</p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="41420737"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41420737" href="https://news.ycombinator.com/vote?id=41420737&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>I use LastPass, and know that they have been breached before. I am in a smaller company, and force strong master passwords, as well as monitor password security. Assuming that LastPass is not the solution I should use, is there a simple way to migrate to another service such as 1Password? I see people mention the UI being difficult for LastPass, but I do not find this to be true, and it makes a lot of sense to me from a security standpoint. I have specific groups, and use shared folders with group and/or user permissions.</p><p>Any help/advice would be greatly appreciated, and thank you in advance.</p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="41419239"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41419239" href="https://news.ycombinator.com/vote?id=41419239&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>Lots of people suggest 1Password, and it works really well for larger or more disperse groups needing some shared vault capability, and perhaps those that want a more visual-driven web interface. Keep in mind there is the per-seat pricing for that.</p><p>What has also worked really well in the past for me and my teams, especially if they are more technical and these credentials really never need to go beyond this more technical team is setting up a single 'vault' encrypted with GPG. Each team member then gets the vault re-encrypted for them, adding them to the recipient list. While this takes a little bit of effort to get a workflow going, it keeps it out of a cloud service, if you're concerned about that, and you get to pass it around just like any other file. When someone leaves, or no longer needs access, their recipient is removed and then the file recommitted and redistributed. In the past I've had the ASCII-armored file committed in git and people just pull down a tools repo every so often.</p><p>If you are wanting to store credentials for, say, public cloud services, don't. Use roles as much as possible, don't pass around passwords, don't bother setting up individual users beyond those required to bind a role to it, grant only by roles as much as possible.</p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="41421098"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41421098" href="https://news.ycombinator.com/vote?id=41421098&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>I use a similar flow with the technical team to avoid unencrypted credentials in SCM. The vault (or other secrets) are encrypted with a common passphrase and then only this passphrase is whats encrypted with GPG for multiple recipients.</p>
              </div></td></tr>
        </tbody></table></td></tr>
            <tr id="41419725"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41419725" href="https://news.ycombinator.com/vote?id=41419725&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>We uses
D the same approach for a while. Pass/gopass will do that for you. However, the downside here is that it quickly gets unwieldy as you’ll end up with a relatively large vaults. And you can’t really remove people, they can always keep and decrypt old versions of the vault, that means that you do have to rotate all of the secrets in that vault manually if someone leaves. And then, there’s also the support cost for non-tech people. GPG on windows is a particular pain.</p><p>You’ll have a similar effect in all password storage solutions, but since adding/removing people from vaults is much simpler, you end up with smaller, more fine-grained vaults and less secrets to rotate. Also, SSO, SCIM, tying the password management into a proper group/authentication system will help.</p></div></td></tr>
        </tbody></table></td></tr>
                  <tr id="41419482"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41419482" href="https://news.ycombinator.com/vote?id=41419482&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>Since you asked for warnings about what not to do, here's one – don't share passwords! With shared accounts, you won't be able to tell who did what. If it is an important thing to which you are sharing passwords and bad thing happens, due to user action that is either accidentally or maliciously, you won't be able to find out who exactly did it and take corrective action.</p>
              </div></td></tr>
        </tbody></table></td></tr>
            <tr id="41420709"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41420709" href="https://news.ycombinator.com/vote?id=41420709&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>Reduce the number of passwords the user needs via SSO.</p><p>Be absolutely strict on password sharing via non approved means.</p><p>Bitwarden enterprise for whatever is left, with collections per team/department.</p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="41419402"><td></td></tr>
                <tr id="41419828"><td></td></tr>
                  <tr id="41419178"><td></td></tr>
                <tr id="41419297"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41419297" href="https://news.ycombinator.com/vote?id=41419297&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>This is the right answer for internal threats, because having each employee have their own login to services means there are auditable. However it does mean you need to think carefully about the SPOF issue (single point of failure). Especially if your SSO is Google or some other company with a habit of pulling the plug without recourse.</p><p>Domain registry, password management and SSO are services which can kill your entire company if you lose access. The other option is to deploy your own SSO as a service, but that does run into the issue of potentially running a security critical service without having sufficient chops internally to keep it secure.</p></div></td></tr>
        </tbody></table></td></tr>
                  <tr id="41420865"><td></td></tr>
            <tr id="41420785"><td></td></tr>
            <tr id="41421381"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41421381" href="https://news.ycombinator.com/vote?id=41421381&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>Bitwarden can be used with groups, or even Google Sheets or something with proper access control (both are just kv after all... both should require 2fa, and both include auditing)</p><p>There's no good solution imo for what I think you're asking for (and that isn't: how can I share passwords for services that allow SSOv?)</p><p>"This reminds me of a problem that I wanted to solve in the future, but I don’t have the expertise.
The problem is when an organization has a single account on an external service which needs to be used by several people, and the organization wants to safely manage the access to the shared account on the external service, adding accountability: who was using the account at X time?
Users of the shared external account should not know the credentials of the account, so rotation of passwords when employees leave/change roles is not as necessary.
I thought of something like a proxy which could use a Selenium (or something else) script for each of the external website, which would handle the login/authentication flow for the external service.If this was a business, those scripts could be offered as a per-website/month package. An administrator would create the automatic flow for a specific service, and save the username and password somewhere in the script. Normal users of the external service’s singular account would then use the proxy using their individual credentials, to add accountability to accessing the external service.
Maybe someone in this realm could come up with something and market it."</p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="41420315"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41420315" href="https://news.ycombinator.com/vote?id=41420315&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>There has been a lot of good mentions so far for permanent solutions on storing secrets securely..</p><p>On the other end, I'll chip in on <a href="https://onetimesecret.com/" rel="nofollow">https://onetimesecret.com/</a> for quickly sharing a secret. It will only allow the consumer to view the secret once, after that, the secret is no longer available. You can also set up One Time Secret with your company domain (self-hosted, I presume)</p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="41419584"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41419584" href="https://news.ycombinator.com/vote?id=41419584&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>I work for a financial, we take security seriously. Production secrets like passwords, private keys etc are stored in Hashicorp Vault. They aren't stored on disk anywhere else. Privileged system account that runs the production processes can't be used by interactive users. SREs can get access if they have to but its locked down and every session is recorded. The secrets are rotated regularly. So your new hire never gets to see production passwords effective.</p><p>For developers, everything is done in their individual accounts, no system accounts. There is a dev system account that does leak out some times but this is frowned upon. Production data that is synced to dev environments have to be scrambled so devs dont get to see all the real prod data.</p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="41420351"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41420351" href="https://news.ycombinator.com/vote?id=41420351&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>Exactly.</p><p>For robotic accounts, cloud providers usually even come with a vault solution (Azure keyvault, etc.) that is audited. Those vaults can be integrated in kube/openshift and seen as secrets directly by applications.</p><p>For human users, SSO is a must, otherwise a password manager that also gets audited.</p><p>PCI-DSS audit would require this kind of things.</p></div></td></tr>
        </tbody></table></td></tr>
                  <tr id="41420927"><td></td></tr>
            <tr id="41419841"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41419841" href="https://news.ycombinator.com/vote?id=41419841&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>Hashicorp Vault generally linked up to IDp or One Time Secret (or some service with expiring limited use links).</p><p>It’s pretty extendable and can integrate with other engineering use cases, shame about hashicorp license change though. Openbao looks great though as a replacement. These are open source so look no further if that’s what you’re looking for if you want password management, ssh auth, cert issuance, authentication and secret retrieval with k8s for example.</p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="41419781"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41419781" href="https://news.ycombinator.com/vote?id=41419781&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>KeePassX file in a repo with long password is a reasonably good solution. Not perfect, but open source and you can segregate by user/team. Also in a team there can be 1 person who has write/update duties and updates the passwords if there a shared ones (not the best approach).</p><p>BTW, not related to the passwords is to put everything non-public serving behind a firewall and access it only via individual VPN keys.</p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="41420193"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41420193" href="https://news.ycombinator.com/vote?id=41420193&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>Don't put in a place where history is saved (as in, don't put it in a repo, put on a shared disk). Also, make sure to rotate the key when people change.</p>
              </div></td></tr>
        </tbody></table></td></tr>
                <tr id="41420435"><td><table>  <tbody><tr>    <td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td>
      <center><a id="up_41420435" href="https://news.ycombinator.com/vote?id=41420435&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>&gt; Don't put in a place where history is saved</p><p>What risks &amp; attack vectors do you have in mind here? Also, in how far is this an issue with KeePass (whose files are encrypted)?</p></div></td></tr>
        </tbody></table></td></tr>
                        <tr id="41419731"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41419731" href="https://news.ycombinator.com/vote?id=41419731&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>Never bind critical services to the account of one employee. When that one employee gets hit by a bus you loose access to critical infrastructure.</p>
              </div></td></tr>
        </tbody></table></td></tr>
                <tr id="41420273"><td></td></tr>
                  <tr id="41420033"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41420033" href="https://news.ycombinator.com/vote?id=41420033&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>At my previous work 1Password was replaced with Keeper. The main reason was better integration with SSO as Keeper can be unlocked with SSO itself so the user needs to remember just single password and for the rest either SSO was used directly or Keeper was used for other passwords.</p>
              </div></td></tr>
        </tbody></table></td></tr>
                <tr id="41421245"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41421245" href="https://news.ycombinator.com/vote?id=41421245&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>We also use Keeper via SSO. We had Lastpass before and switched for obvious (breach of their vault) reasons. It's OK? It does its job.</p>
              </div></td></tr>
        </tbody></table></td></tr>
                  <tr id="41421530"><td></td></tr>
            <tr id="41420541"><td></td></tr>
            <tr id="41419172"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41419172" href="https://news.ycombinator.com/vote?id=41419172&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>I'd say you will need a password manager with good auditing. Give them access to all the required passwords but log every access to it. So if someone leaves the company, you know which passwords to change.</p><p>Groups and ACLs would help to give "scoped" access to passwords.</p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="41419107"><td></td></tr>
                <tr id="41419246"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41419246" href="https://news.ycombinator.com/vote?id=41419246&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>The critical missing piece of 1Password for Business is that it won't reveal to IT admins what passwords are weak across the org (Watchtower only works for the individual). Despite endless training, people still choose really weak passwords, and you need tools to spot this and require employees to change them.</p>
              </div></td></tr>
        </tbody></table></td></tr>
                <tr id="41419503"><td></td></tr>
                        <tr id="41420578"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41420578" href="https://news.ycombinator.com/vote?id=41420578&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>Our team was on lastpass,
For some reason closed it down and now using Keeper.
So far so good</p>
              </div></td></tr>
        </tbody></table></td></tr>
            <tr id="41420612"><td></td></tr>
            <tr id="41420386"><td></td></tr>
                <tr id="41420425"><td></td></tr>
                  <tr id="41421265"><td></td></tr>
            <tr id="41420600"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41420600" href="https://news.ycombinator.com/vote?id=41420600&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>(Personal background: I currently work in the enterprise identity space, where problems like this are bog-standard.)</p><p>Everyone else seems to be going on about SSO. That's good for end users signing into websites &amp; laptops, but I'm getting the sense that you're more worried about admin-level permissions management.</p><p>First, some terminology to help you Google for things:</p><p>&gt; new hire be given access to all required passwords day 1</p><p>&gt; when such new hire gets promoted, how can we give access to the additional passwords</p><p>&gt; if someone leaves the company, how can we change only the sensible passwords they had access to and preferably notify everyone with access</p><p>The more technical/sales-y way to say this is "I want a PAM solution with JML workflow integration for my secrets management" (JML: Joiner, Mover, Leaver, PAM: Privileged Access Management), and it'd be part of your overall identity management (IdM) strategy.</p><p>Some big-name companies in the IdM space: Sailpoint, Quest One Identity, CyberArk. Those'll give extended management of your canonical source(s) of identity &amp; authorization info (typically Active Directory/Entra ID, but with the big-name products you can also integrate with modern solutions like Workday, FOSS e.g. LDAP servers, or old-fashioned stuff like CSV drops on an FTP share, and set up push or pull workflows to set user attributes &amp; permissions based on your needs).</p><p>So you want IdM, plus (at least) 1 of 2 things:</p><p>1. Secrets management (for static secrets). I've personally seen folks using Thycotic Secret Server and LastPass Enterprise (although there's lots more companies in that space). That gets you the basic "get admin X a password that was created by admin Y". This is more of a requirement for servers you can't integrate IdM with (so it'd be licensed to admins only), because for day-to-day admin work (stuff like "add this user to that group"), what you'd ideally want is:</p><p>2. Full PAM. Essentially, you'd set up a workflow to temporarily "check out" a secret (i.e. password) for a set period of time (which the user could request some capped number of extensions to), that's then automatically-changed by the IdM once their time's up. (You can also do things like "give anyone who asks &amp; gets manager signoff group permissions to XYZ that expires in 90 days".) Sailpoint and CyberArk can both do this.</p><p>Now, all that's for server admin. If you're talking about handing out admin permissions for endpoints (this is your classic "Tech support needs to privesc to fix something, but I don't want to leave the Windows admin passwords lying around in random techs' clipboards, and I don't want to let just anyone use ADUC (which, IIRC, is required to effectively use LAPS)"), you want something slightly different (in addition to an IdM solution):</p><p>3. EPM (Endpoint Privilege Management). BeyondTrust is the big name here. This lets you grant some permissions to end users (e.g. "install pre-approved software", "change (only some) networking settings"), while locking everything else behind an admin account (which you can gate access to using your PAM; that gets you auto-rotation of Windows admin PWs right after they're touched, plus JML workflows for your tech support personnel).</p><p>Now, go forth and Google (and when you start asking for demos, try not to let the salespeople drown you in buzzwords like I just did)!</p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="41417679"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41417679" href="https://news.ycombinator.com/vote?id=41417679&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>1. Don't have passwords. This is why there's an "SSO tax". If you setup SSO then there will be less passwords / accounts.</p><p>2. Use a password manager that enables sharing. There are 1s with company accounts and different ways to share. A new hire can pick up a certain role/group and get all the passwords.</p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="41417802"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41417802" href="https://news.ycombinator.com/vote?id=41417802&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>And #2 is only to be used if absolutely unavoidable and even then, I would think hard about alternatives such as ditching the service that would require using that solution.</p>
              </div></td></tr>
        </tbody></table></td></tr>
                            <tr id="41419812"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41419812" href="https://news.ycombinator.com/vote?id=41419812&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>Folks are going to have strong opinions here about things, so I'll try to stick to my personal experience. I adopted 1Password at my current organization. Overall, I've been very satisfied with it. Here are the major points I've noticed:</p><p>* Great authenticator support. We have some accounts that our team members have to share, and we want MFA on those accounts. I can add an MFA field to 1Password entry and the people who have access to that entry can use it. Doesn't help when those entries require phone/e-mail based MFA; I'm working on a little Twilio / outlook group setup to take care of that.
* Easy to navigate group membership. Passwords are stored in vaults and individuals or groups can be given access to those vaults. The model for it fits in my head and I like that.
* Easy share ability. There are a few credentials that I occasionally need to share outside of a vault. I can create a link and grant access to specific individuals for a given amount of time.
* The browser extension and integration have been really smooth in my opinion.
* I find tagging and taxonomies of tags to be helpful, and 1Password supports those well.
* We've gotten some great mileage out of 1Password connect. Some of our infrastructure secrets now reside directly in 1Password, and 1PW connect pushes them into our k8s environment as secrets where our apps can refer to them. Makes secret management across environments that much easier.
* SCIM support (which I haven't yet implemented) and SSO support to bring more convenience for end-users.
* Easy ability to recover if an employee forgets their master PW (have done this a handful of times).
* A nice perk: our 1PW business comes with a free 1PW personal subscription for people, completely separate. If the employee leaves they have can convert their personal vault to a paid subscription or export it.</p><p>To answer your questions specifically based on my current context:</p><p>&gt; What are the recommended ways to store and give access to passwords?</p><p>1Password vaults. One vault per style of responsibility. 1+ groups have access to a vault. People get put into 1+ groups.</p><p>&gt; How can a new hire be given access to all required passwords day 1?</p><p>In our case, day 1 they accept the 1PW invite in their inbox, and then we assign them to groups. Done.</p><p>&gt; And when such new hire gets promoted, how can we give access to the additional passwords they will need?</p><p>Keep those "tiers" of passwords in separate vaults. Update the groups when someone's role changes.</p><p>&gt; And if someone leaves the company, how can we change only the sensible passwords they had access to and preferably notify everyone with access to it that it was changed?</p><p>See what groups that person is in and what vaults they had access to. Review "high priority" items which you've tagged in such a way as to surface them. Send an e-mail to the members of the vault telling them you're rotating passwords. Rotate the passwords. Anyone who's a vault member can see the password history too, I believe, so if something goes wrong the old password will still be available.</p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="41420337"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41420337" href="https://news.ycombinator.com/vote?id=41420337&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>&gt; Easy ability to recover if an employee forgets their master PW</p><p>So the server can read all data or how does this work?</p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="41420330"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41420330" href="https://news.ycombinator.com/vote?id=41420330&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>&gt; * Great authenticator support. We have some accounts that our team members have to share, and we want MFA on those accounts. I can add an MFA field to 1Password entry and the people who have access to that entry can use it. Doesn't help when those entries require phone/e-mail based MFA; I'm working on a little Twilio / outlook group setup to take care of that. * Easy to navigate group membership. Passwords are stored in vaults and individuals or groups can be given access to those vaults. The model for it fits in my head and I like that. * Easy share ability. There are a few credentials that I occasionally need to share outside of a vault. I can create a link and grant access to specific individuals for a given amount of time. * The browser extension and integration have been really smooth in my opinion. * I find tagging and taxonomies of tags to be helpful, and 1Password supports those well. * We've gotten some great mileage out of 1Password connect. Some of our infrastructure secrets now reside directly in 1Password, and 1PW connect pushes them into our k8s environment as secrets where our apps can refer to them. Makes secret management across environments that much easier. * SCIM support (which I haven't yet implemented) and SSO support to bring more convenience for end-users. * Easy ability to recover if an employee forgets their master PW (have done this a handful of times). * A nice perk: our 1PW business comes with a free 1PW personal subscription for people, completely separate. If the employee leaves they have can convert their personal vault to a paid subscription or export it.</p><p>inserting some line breaks...</p><p>* Great authenticator support. We have some accounts that our team members have to share, and we want MFA on those accounts. I can add an MFA field to 1Password entry and the people who have access to that entry can use it. Doesn't help when those entries require phone/e-mail based MFA; I'm working on a little Twilio / outlook group setup to take care of that.</p><p>* Easy to navigate group membership. Passwords are stored in vaults and individuals or groups can be given access to those vaults. The model for it fits in my head and I like that.</p><p>* Easy share ability. There are a few credentials that I occasionally need to share outside of a vault. I can create a link and grant access to specific individuals for a given amount of time.</p><p>* The browser extension and integration have been really smooth in my opinion.</p><p>* I find tagging and taxonomies of tags to be helpful, and 1Password supports those well.</p><p>* We've gotten some great mileage out of 1Password connect. Some of our infrastructure secrets now reside directly in 1Password, and 1PW connect pushes them into our k8s environment as secrets where our apps can refer to them. Makes secret management across environments that much easier.</p><p>* SCIM support (which I haven't yet implemented) and SSO support to bring more convenience for end-users.</p><p>* Easy ability to recover if an employee forgets their master PW (have done this a handful of times).</p><p>* A nice perk: our 1PW business comes with a free 1PW personal subscription for people, completely separate. If the employee leaves they have can convert their personal vault to a paid subscription or export it.</p></div></td></tr>
        </tbody></table></td></tr>
                  <tr id="41419037"><td></td></tr>
            <tr id="41420569"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41420569" href="https://news.ycombinator.com/vote?id=41420569&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>KeePass in enterprise form with Pleasant Password Server. Supports many things including SSO. Of course it is local.</p>
              </div></td></tr>
        </tbody></table></td></tr>
            <tr id="41420452"><td></td></tr>
            <tr id="41419822"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41419822" href="https://news.ycombinator.com/vote?id=41419822&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>Ess Ess Oh. Understand the number of individual warm bodies who need access to what. In an ideal world (that may not exist) this should be aligned to job description/contract and the process for when those people are removed under any circumstance. Pay for the users you need on the platforms you use, whether that's cloud or resources for on-prem/locally managed tools. Elevate legacy systems that aren't implemented for the scale you're operating at to be managed safely on a per-user level. Tell executives/budget process/whatever/whoever these liabilities exist and need to be covered in budget.</p><p>And then, yeah, find a password manager tied into that SSO platform to fill the gaps/enforce policies for users using tools that don't have SSO available.</p><p>HR-and-manager-enforceable policies and penalties for users who go off the reservations.</p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="41420407"><td></td></tr>
            <tr id="41420621"><td></td></tr>
            <tr id="41419522"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41419522" href="https://news.ycombinator.com/vote?id=41419522&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>honestly wonder if this is a 1pass ad thinly veiled as a question on the hn front page? if you have to ask, you shouldnt be doing it - hire or at least consult an IT professional</p>
              </div></td></tr>
        </tbody></table></td></tr>
                <tr id="41419893"><td></td></tr>
                  <tr id="41419682"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_41419682" href="https://news.ycombinator.com/vote?id=41419682&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>Just want to say that StackExchange is the place to get answers for questions like this (waiting for my downvotes). Is there a better place?</p>
              </div></td></tr>
        </tbody></table></td></tr>
                <tr id="41419912"><td></td></tr>
            <tr id="41419703"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_41419703" href="https://news.ycombinator.com/vote?id=41419703&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>I think stack exchange would delete the question because it is too vague and open to opinion.</p>
              </div></td></tr>
        </tbody></table></td></tr>
                <tr id="41420328"><td></td></tr>
                <tr id="41420347"><td><table>  <tbody><tr>    <td indent="3"><img src="https://news.ycombinator.com/s.gif" height="1" width="120"></td><td>
      <center><a id="up_41420347" href="https://news.ycombinator.com/vote?id=41420347&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>I was going to ask if it isn't the other way around, when I realized you probably mean off-topic rather than on-topic. If anyone ever runs a competition for the worst acronym ever, this nominee can probably only be topped by a three-way confusion or something that threatens lives!</p>
              </div></td></tr>
        </tbody></table></td></tr>
                  <tr id="41419749"><td><table>  <tbody><tr>    <td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td>
      <center><a id="up_41419749" href="https://news.ycombinator.com/vote?id=41419749&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>true, ask chatgpt to reword this post to be appropriate for stackexchange first. i cant think of a way to ask this and chatgpt failed also. maybe there is a link to a duplicate answered q there</p>
              </div></td></tr>
        </tbody></table></td></tr>
                <tr id="41419762"><td><table>  <tbody><tr>    <td indent="3"><img src="https://news.ycombinator.com/s.gif" height="1" width="120"></td><td>
      <center><a id="up_41419762" href="https://news.ycombinator.com/vote?id=41419762&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>there is no way to word this question to be appropriate for stack exchange. it fundamentally does not belong on stack exchange</p>
              </div></td></tr>
        </tbody></table></td></tr>
                <tr id="41419811"><td><table>  <tbody><tr>    <td indent="4"><img src="https://news.ycombinator.com/s.gif" height="1" width="160"></td><td>
      <center><a id="up_41419811" href="https://news.ycombinator.com/vote?id=41419811&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div>
                  <p>yes I can kind of see that, its not specific enough and almost a product recommendation ask. Normally the Security department handles this and we turn it over to them to make the policies and procedures.</p>
              </div></td></tr>
        </tbody></table></td></tr>
                  <tr id="41420367"><td><table>  <tbody><tr>    <td indent="3"><img src="https://news.ycombinator.com/s.gif" height="1" width="120"></td><td>
      <center><a id="up_41420367" href="https://news.ycombinator.com/vote?id=41420367&amp;how=up&amp;goto=item%3Fid%3D41417659"></a></center>    </td><td><br><div><p>yeah let's waste big LLM energy on obfuscating wording to make it sound like your off-topic question is actually topical ...</p><p>When I see how people decide to use this tool, I really wonder if (the current state of the art at least) really is a tool for the good or if it needs big watermarks so it can be rejected when you try to propagate/submit the contents somewhere and it becomes only usable for the things it's good at like summarizing short texts to tweet size or helping with language learning or such</p></div></td></tr>
        </tbody></table></td></tr>
                              </tbody></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[How a Leading Chain of Psychiatric Hospitals Traps Patients (190 pts)]]></title>
            <link>https://www.nytimes.com/2024/09/01/business/acadia-psychiatric-patients-trapped.html</link>
            <guid>41417284</guid>
            <pubDate>Sun, 01 Sep 2024 14:33:23 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.nytimes.com/2024/09/01/business/acadia-psychiatric-patients-trapped.html">https://www.nytimes.com/2024/09/01/business/acadia-psychiatric-patients-trapped.html</a>, See on <a href="https://news.ycombinator.com/item?id=41417284">Hacker News</a></p>
Couldn't get https://www.nytimes.com/2024/09/01/business/acadia-psychiatric-patients-trapped.html: Error: Request failed with status code 403]]></description>
        </item>
        <item>
            <title><![CDATA[Athletes and musicians pursue virtuosity in fundamental skills (111 pts)]]></title>
            <link>https://notes.andymatuschak.org/zBmSSpM1WfFDehxNCBcqSZp?stackedNotes=zMX9Lfuz8sGfDUivWZcyWT</link>
            <guid>41417109</guid>
            <pubDate>Sun, 01 Sep 2024 14:10:45 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://notes.andymatuschak.org/zBmSSpM1WfFDehxNCBcqSZp?stackedNotes=zMX9Lfuz8sGfDUivWZcyWT">https://notes.andymatuschak.org/zBmSSpM1WfFDehxNCBcqSZp?stackedNotes=zMX9Lfuz8sGfDUivWZcyWT</a>, See on <a href="https://news.ycombinator.com/item?id=41417109">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><h2>Athletes and musicians pursue virtuosity in fundamental skills much more rigorously than knowledge workers do</h2><p>Top-tier athletes are fanatically disciplined about improving their foundational skills—skills which transcend any sport, the same kind of agility drills you might see an army recruit do. Top-tier musicians do likewise: Lang Lang, for instance, is still working on his scales after 30 years as a concert pianist. They’re not just doing rote drills: they’re working to improve those skills critically, poring over performance videos and working with coaches.</p><p>By comparison, <a href="https://notes.andymatuschak.org/zMbCwoVdjsqPNyTRRr3phPN"><span>Knowledge work rarely involves deliberate practice</span></a>. Knowledge workers seem surprisingly unserious about honing fundamental skills like reading (<a href="https://notes.andymatuschak.org/zL33c5cHy4bH7HvMcv2py9H"><span>People seem to forget most of what they read, and they mostly don’t notice</span></a>), note-taking (<a href="https://notes.andymatuschak.org/zDfV5GX8kKScLkE8Dq1rFUk"><span>Note-writing practices are generally ineffective</span></a>), developing ideas over time (<a href="https://notes.andymatuschak.org/zQUKGy9JpHnWRDJh7X6yP9t"><span>Knowledge workers usually have no specific methods for developing ideas over time</span></a>). <a href="https://notes.andymatuschak.org/zPFYKBrsvL88opKh28UYxWv"><span>Core practices in knowledge work are often ad-hoc</span></a>, and knowledge workers generally don’t seem to pursue a serious program of improving in those core skills. I suspect that this is in large part because the possibility of improvement isn’t salient: <a href="https://notes.andymatuschak.org/zQeW31KRF1tk2zCPPGWc7UD"><span>Salience of improvement drives skill development</span></a>.</p><p>What might it mean for knowledge workers to fanatically pursue virtuosity in these fundamental skills, in the way that athletes seek in their fundamental skills?</p><ul><li>Ben Franklin practiced writing by taking an essay he found compelling and, without referencing it, rewriting it in his own words; then studying the differences between its language and his own. (<a href="https://www.gutenberg.org/files/148/148-h/148-h.htm">The Autobiography of Benjamin Franklin, p17</a>)</li><li><a href="https://notes.andymatuschak.org/zVA2gCLV4BfdmMmeLqf7RKt"><span>Susan Sontag</span></a> 7/5/72 (As Consciousness Is Harnessed to Flesh: Journals and Notebooks, 1964-1980)</li></ul><blockquote><p>A writer, like an athlete, must ‘train’ every day. What did I do today to keep in ‘form’?</p></blockquote><ul><li>2022-03-07 Interview with Pat Metheny in <a href="https://believermag.com/an-interview-with-pat-metheny/">Believer</a>, via Subtle Maneuvers:</li></ul><blockquote><p>Metheny has a devotional relationship to music. He dismisses the idea of talent in favor of disciplined work, and is known for practicing the guitar for eight hours a day. He tours nearly constantly, performing over three hundred shows a year. For each one, he spends four hours in preparation: he avoids conversation, runs purposely mindless exercises, and abstains from all food. After the show, he writes ten pages of notes on the performance, critiquing the sound, music, and environment. He has never tasted alcohol or tried any drug, in order to stay focused on music.</p></blockquote><hr><h2>References</h2><p>I first asked the core question (“what might it mean for knowledge workers…?”) in my Emergent Ventures grant application, 2019-05-13</p><p>Matuschak, A. (2019, December). <em>Taking knowledge work seriously</em>. Presented at the Stripe Convergence, San Francisco.</p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Starliner crew reports hearing "sonar like noises" (109 pts)]]></title>
            <link>https://twitter.com/SpaceBasedFox/status/1830180273130242223</link>
            <guid>41416872</guid>
            <pubDate>Sun, 01 Sep 2024 13:36:28 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://twitter.com/SpaceBasedFox/status/1830180273130242223">https://twitter.com/SpaceBasedFox/status/1830180273130242223</a>, See on <a href="https://news.ycombinator.com/item?id=41416872">Hacker News</a></p>
&lt;Unparsable&gt;]]></description>
        </item>
        <item>
            <title><![CDATA[Show HN: Linkpreview, see how your sites looks in social media and chat apps (284 pts)]]></title>
            <link>https://linkpreview.xyz</link>
            <guid>41416714</guid>
            <pubDate>Sun, 01 Sep 2024 13:07:14 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://linkpreview.xyz">https://linkpreview.xyz</a>, See on <a href="https://news.ycombinator.com/item?id=41416714">Hacker News</a></p>
<div id="readability-page-1" class="page"><!--teleport start anchor--><!--teleport anchor--><div id="__nuxt"><!--[--><div><!--[--><header><div><svg fill="none" height="48" viewBox="0 0 48 48" width="48" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><filter id="a" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse" height="54" width="48" x="0" y="-3"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" mode="normal" result="shape"></feBlend><feColorMatrix in="SourceAlpha" result="hardAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"></feColorMatrix><feOffset dy="-3"></feOffset><feGaussianBlur stdDeviation="1.5"></feGaussianBlur><feComposite in2="hardAlpha" k2="-1" k3="1" operator="arithmetic"></feComposite><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"></feColorMatrix><feBlend in2="shape" mode="normal" result="effect1_innerShadow_3051_46941"></feBlend><feColorMatrix in="SourceAlpha" result="hardAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"></feColorMatrix><feOffset dy="3"></feOffset><feGaussianBlur stdDeviation="1.5"></feGaussianBlur><feComposite in2="hardAlpha" k2="-1" k3="1" operator="arithmetic"></feComposite><feColorMatrix type="matrix" values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.1 0"></feColorMatrix><feBlend in2="effect1_innerShadow_3051_46941" mode="normal" result="effect2_innerShadow_3051_46941"></feBlend><feColorMatrix in="SourceAlpha" result="hardAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"></feColorMatrix><feMorphology in="SourceAlpha" operator="erode" radius="1" result="effect3_innerShadow_3051_46941"></feMorphology><feOffset></feOffset><feComposite in2="hardAlpha" k2="-1" k3="1" operator="arithmetic"></feComposite><feColorMatrix type="matrix" values="0 0 0 0 0.0627451 0 0 0 0 0.0941176 0 0 0 0 0.156863 0 0 0 0.24 0"></feColorMatrix><feBlend in2="effect2_innerShadow_3051_46941" mode="normal" result="effect3_innerShadow_3051_46941"></feBlend></filter><filter id="b" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse" height="42" width="36" x="6" y="5.25"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" result="hardAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"></feColorMatrix><feMorphology in="SourceAlpha" operator="erode" radius="1.5" result="effect1_dropShadow_3051_46941"></feMorphology><feOffset dy="2.25"></feOffset><feGaussianBlur stdDeviation="2.25"></feGaussianBlur><feComposite in2="hardAlpha" operator="out"></feComposite><feColorMatrix type="matrix" values="0 0 0 0 0.141176 0 0 0 0 0.141176 0 0 0 0 0.141176 0 0 0 0.1 0"></feColorMatrix><feBlend in2="BackgroundImageFix" mode="normal" result="effect1_dropShadow_3051_46941"></feBlend><feBlend in="SourceGraphic" in2="effect1_dropShadow_3051_46941" mode="normal" result="shape"></feBlend></filter><linearGradient id="c" gradientUnits="userSpaceOnUse" x1="24" x2="26" y1=".000001" y2="48"><stop offset="0" stop-color="#fff" stop-opacity="0"></stop><stop offset="1" stop-color="#fff" stop-opacity=".12"></stop></linearGradient><linearGradient id="d" gradientUnits="userSpaceOnUse" x1="24" x2="24" y1="9" y2="39"><stop offset="0" stop-color="#fff" stop-opacity=".8"></stop><stop offset="1" stop-color="#fff" stop-opacity=".5"></stop></linearGradient><linearGradient id="e" gradientUnits="userSpaceOnUse" x1="24" x2="24" y1="0" y2="48"><stop offset="0" stop-color="#fff" stop-opacity=".12"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></linearGradient><clipPath id="f"><rect height="48" rx="12" width="48"></rect></clipPath><g filter="url(#a)"><g clip-path="url(#f)"><rect fill="#0c111d" height="48" rx="12" width="48"></rect><path d="m0 0h48v48h-48z" fill="url(#c)"></path><g filter="url(#b)"><path clip-rule="evenodd" d="m15 9c-3.3137 0-6 2.6863-6 6v18c0 3.3137 2.6863 6 6 6h18c3.3137 0 6-2.6863 6-6v-18c0-3.3137-2.6863-6-6-6zm2.25 11.625h7.4733l-8.7991 8.7992 2.6516 2.6516 8.7992-8.7991v7.4733h3.75v-12c0-1.0355-.8395-1.875-1.875-1.875h-12z" fill="url(#d)" fill-rule="evenodd"></path></g></g><rect height="46" rx="11" stroke="url(#e)" stroke-width="2" width="46" x="1" y="1"></rect></g></svg><p>LinkPreview</p></div><div><!--[--><a href="https://supersaas.dev/" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!----><!--]--><!--[--><img src="https://supersaas.dev/logo.png" alt="Supersaas"><!--]--><!--[--><!----><!--]--><!--]--></a><!--]--><!--[--><!--]--></div></header><div><form data-n-ids="{&quot;np6cif8hBbo-0&quot;:&quot;np6cif8hBbo-0&quot;}"><!--[--><!--]--></form><!----></div><!--[--><p><a href="https://supersaas.dev/" target="_blank"><img src="https://essentials.supersaas.dev/supersaas-banner.png" alt="Supersaas"></a></p><!--]--><!--]--></div><!--]--><section aria-label="Notifications alt+T" tabindex="-1"><!--[--><ol data-sonner-toaster="" dir="ltr" tabindex="-1" data-theme="light" data-rich-colors="false" data-y-position="top" data-x-position="center"><!--[--><!--]--></ol><!--]--></section><!--teleport start--><!--teleport end--></div>
</div>]]></description>
        </item>
        <item>
            <title><![CDATA[The web's clipboard, and how it stores data of different types (195 pts)]]></title>
            <link>https://alexharri.com/blog/clipboard</link>
            <guid>41415866</guid>
            <pubDate>Sun, 01 Sep 2024 11:02:35 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://alexharri.com/blog/clipboard">https://alexharri.com/blog/clipboard</a>, See on <a href="https://news.ycombinator.com/item?id=41415866">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><main><p>If you've been using computers for a while, you probably know that the clipboard can store multiple types of data (images, rich text content, files, and so on). As a software developer, it started frustrating me that I didn't have a good understanding of how the clipboard stores and organizes data of different types.</p>
<p>I recently decided to unveil the mystery that is the clipboard and wrote this post using my learnings. We'll focus on the web clipboard and its APIs, though we'll also touch on how it interacts with operating system clipboards.</p>
<p>We'll start by exploring the web's clipboard APIs and their history. The clipboard APIs have some interesting limitations around data types, and we'll see how some companies have worked around those limitations. We'll also look at some proposals that aim to resolve those limitations (most notably, <a target="_blank" href="https://github.com/w3c/editing/blob/gh-pages/docs/clipboard-pickling/explainer.md">Web Custom Formats</a>).</p>
<p>If you've ever wondered how the web's clipboard works, this post is for you.</p>
<h2>Using the async Clipboard API</h2>
<p>If I copy some content from a website and paste it into Google Docs, some of its formatting is retained, such as links, font size, and color.</p>
<p><img src="https://alexharri.com/images/posts/clipboard/copy-paste-rich-content.png"></p>
<p>But if I open VS Code and paste it there, only the raw text content is pasted.</p>
<p><img src="https://alexharri.com/images/posts/clipboard/copy-paste-into-vscode.png"></p>
<p>The clipboard serves these two use cases by allowing information to be stored in multiple <a target="_blank" href="https://www.w3.org/TR/clipboard-apis/#list-of-representations"><em>representations</em></a> associated with MIME types. The W3C Clipboard spec <a target="_blank" href="https://www.w3.org/TR/clipboard-apis/#mandatory-data-types-x">mandates</a> that for writing to and reading from the clipboard, these three data types must be supported:</p>
<ul>
<li><code>text/plain</code> for plain text.</li>
<li><code>text/html</code> for HTML.</li>
<li><code>image/png</code> for PNG images.</li>
</ul>
<p>So when I pasted before, Google Docs read the <code>text/html</code> representation and used that to retain the rich text formatting. VS Code only cares about the raw text and reads the <code>text/plain</code> representation. Makes sense.</p>
<p>Reading a specific representation via the async Clipboard API's <code>read</code> method is quite straightforward:</p>
<div><pre><p><span>const</span><span> items </span><span>=</span><span> </span><span>await</span><span> navigator</span><span>.</span><span>clipboard</span><span>.</span><span>read</span><span>(</span><span>)</span><span>;</span><span></span></p><p><span></span><span>for</span><span> </span><span>(</span><span>const</span><span> item </span><span>of</span><span> items</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>  </span><span>if</span><span> </span><span>(</span><span>item</span><span>.</span><span>types</span><span>.</span><span>includes</span><span>(</span><span>"text/html"</span><span>)</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>    </span><span>const</span><span> blob </span><span>=</span><span> </span><span>await</span><span> item</span><span>.</span><span>getType</span><span>(</span><span>"text/html"</span><span>)</span><span>;</span><span></span></p><p><span>    </span><span>const</span><span> html </span><span>=</span><span> </span><span>await</span><span> blob</span><span>.</span><span>text</span><span>(</span><span>)</span><span>;</span><span></span></p><p><span>  </span><span>}</span><span></span></p><p><span></span><span>}</span><span></span></p></pre></div>
<p>Writing multiple representations to the clipboard via <code>write</code> is a bit more involved, but still relatively straightforward. First, we construct <code>Blob</code>s for each representation that we want to write to the clipboard:</p>
<div><pre><p><span>const</span><span> textBlob </span><span>=</span><span> </span><span>new</span><span> </span><span>Blob</span><span>(</span><span>[</span><span>"Hello, world"</span><span>]</span><span>,</span><span> </span><span>{</span><span> type</span><span>:</span><span> </span><span>"text/plain"</span><span> </span><span>}</span><span>)</span><span>;</span><span></span></p><p><span></span><span>const</span><span> htmlBlob </span><span>=</span><span> </span><span>new</span><span> </span><span>Blob</span><span>(</span><span>[</span><span>"Hello, &lt;em&gt;world&lt;em&gt;"</span><span>]</span><span>,</span><span> </span><span>{</span><span> type</span><span>:</span><span> </span><span>"text/html"</span><span> </span><span>}</span><span>)</span><span>;</span><span></span></p></pre></div>
<p>Once we have the blobs, we pass them to a new <code>ClipboardItem</code> in a key-value store with the data types as the keys and the blobs as the values:</p>
<div><pre><p><span>const</span><span> clipboardItem </span><span>=</span><span> </span><span>new</span><span> </span><span>ClipboardItem</span><span>(</span><span>{</span><span></span></p><p><span>  </span><span>[</span><span>textBlob</span><span>.</span><span>type</span><span>]</span><span>:</span><span> textBlob</span><span>,</span><span></span></p><p><span>  </span><span>[</span><span>htmlBlob</span><span>.</span><span>type</span><span>]</span><span>:</span><span> htmlBlob</span><span>,</span><span></span></p><p><span></span><span>}</span><span>)</span><span>;</span><span></span></p></pre></div>
<p>Note: <!-- -->I like that <code>ClipboardItem</code> accepts a key-value store. It nicely aligns with the idea of using a data structure that makes illegal states unrepresentable, as discussed in <a target="_blank" href="https://lexi-lambda.github.io/blog/2019/11/05/parse-don-t-validate/#:~:text=Use%20a%20data%20structure%20that%20makes%20illegal%20states%20unrepresentable">Parse, don't validate</a>.</p>
<p>Finally, we invoke <code>write</code> with our newly constructed <code>ClipboardItem</code>:</p>
<div><pre><p><span>await</span><span> navigator</span><span>.</span><span>clipboard</span><span>.</span><span>write</span><span>(</span><span>[</span><span>clipboardItem</span><span>]</span><span>)</span><span>;</span><span></span></p></pre></div>
<h3>What about other data types?</h3>
<p>HTML and images are cool, but what about general data interchange formats like JSON? If I were writing an application with copy-paste support, I could imagine wanting to write JSON or some binary data to the clipboard.</p>
<p>Let's try to write JSON data to the clipboard:</p>
<div><pre><p><span></span><span>const</span><span> json </span><span>=</span><span> </span><span>JSON</span><span>.</span><span>stringify</span><span>(</span><span>{</span><span> message</span><span>:</span><span> </span><span>"Hello"</span><span> </span><span>}</span><span>)</span><span>;</span><span></span></p><p><span></span><span>const</span><span> blob </span><span>=</span><span> </span><span>new</span><span> </span><span>Blob</span><span>(</span><span>[</span><span>json</span><span>]</span><span>,</span><span> </span><span>{</span><span> type</span><span>:</span><span> </span><span>"application/json"</span><span> </span><span>}</span><span>)</span><span>;</span><span></span></p><p><span></span><span>const</span><span> clipboardItem </span><span>=</span><span> </span><span>new</span><span> </span><span>ClipboardItem</span><span>(</span><span>{</span><span> </span><span>[</span><span>blob</span><span>.</span><span>type</span><span>]</span><span>:</span><span> blob </span><span>}</span><span>)</span><span>;</span><span></span></p><p><span></span><span>await</span><span> navigator</span><span>.</span><span>clipboard</span><span>.</span><span>write</span><span>(</span><span>[</span><span>clipboardItem</span><span>]</span><span>)</span><span>;</span><span></span></p></pre></div>
<p>Upon running this, an exception is thrown:</p>
<div><pre><p><span>Failed to execute 'write' on 'Clipboard':</span></p><p><span>  Type application/json not supported on write.</span></p></pre></div>
<p>Hmm, what's up with that? Well, the <a target="_blank" href="https://www.w3.org/TR/clipboard-apis/#dom-clipboard-write">spec</a> for <code>write</code> tells us that data types other than <code>text/plain</code>, <code>text/html</code>, and <code>image/png</code> must be rejected:</p>
<blockquote>
<p>If <em>type</em> is not in the <a target="_blank" href="https://www.w3.org/TR/clipboard-apis/#mandatory-data-types-x">mandatory data types</a> list, then reject [...] and abort these steps.</p>
</blockquote>
<p>Interestingly, the <code>application/json</code> MIME type was in the mandatory data types list from <a target="_blank" href="https://www.w3.org/TR/2012/WD-clipboard-apis-20120223/#mandatory-data-types-1">2012</a> to <a target="_blank" href="https://www.w3.org/TR/2021/WD-clipboard-apis-20210806/#mandatory-data-types-x">2021</a> but was removed from the spec in <a target="_blank" href="https://github.com/w3c/clipboard-apis/pull/155">w3c/clipboard-apis#155</a>. Prior to that change, the lists of mandatory data types were much longer, with 16 mandatory data types for reading from the clipboard, and 8 for writing to it. After the change, only <code>text/plain</code>, <code>text/html</code>, and <code>image/png</code> remained.</p>
<p>This change was made after browsers opted not to support many of the mandatory types due to <a target="_blank" href="https://webkit.org/blog/8170/clipboard-api-improvements/#custom-mime-types:~:text=into%20web%20pages.-,Custom%20MIME%20Types,-Because%20the%20system">security concerns</a>. This is reflected by a warning in the <a target="_blank" href="https://www.w3.org/TR/clipboard-apis/#mandatory-data-types-x">mandatory data types</a> section in the spec:</p>
<blockquote>
<p>Warning! The data types that untrusted scripts are allowed to write to the clipboard are limited as a security precaution.</p>
<p>Untrusted scripts can attempt to exploit security vulnerabilities in local software by placing data known to trigger those vulnerabilities on the clipboard.</p>
</blockquote>
<p>Okay, so we can only write a limited set of data types to the clipboard. But what's that about "<em>untrusted</em> scripts"? Can we somehow run code in a "trusted" script that lets us write other data types to the clipboard?</p>
<h3>The isTrusted property</h3>
<p>Perhaps the "trusted" part refers to the <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/Event/isTrusted"><code>isTrusted</code> property on events</a>. <code>isTrusted</code> is a read-only property that is only set to true if the event was dispatched by the user agent.</p>
<div><pre><p><span>document</span><span>.</span><span>addEventListener</span><span>(</span><span>"copy"</span><span>,</span><span> </span><span>(</span><span>e</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>{</span><span></span></p><p><span>  </span><span>if</span><span> </span><span>(</span><span>e</span><span>.</span><span>isTrusted</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>  </span><span>}</span><span></span></p><p><span></span><span>}</span><span>)</span><span></span></p></pre></div>
<p>Being "dispatched by the user agent" means that it was triggered by the user, such as a copy event triggered by the user pressing <span><span>Command</span><code title="Command"><svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.3 4V6.3H4C2.72975 6.3 1.7 5.27026 1.7 4C1.7 2.72975 2.72975 1.7 4 1.7C5.27026 1.7 6.3 2.72975 6.3 4Z" stroke="currentColor" stroke-width="1.4"></path><path d="M4 11.7H6.3V14C6.3 15.2703 5.27026 16.3 4 16.3C2.72975 16.3 1.7 15.2703 1.7 14C1.7 12.7297 2.72975 11.7 4 11.7Z" stroke="currentColor" stroke-width="1.4"></path><path d="M14 6.3H11.7V4C11.7 2.72975 12.7297 1.7 14 1.7C15.2703 1.7 16.3 2.72975 16.3 4C16.3 5.27026 15.2703 6.3 14 6.3Z" stroke="currentColor" stroke-width="1.4"></path><path d="M11.7 11.7H14C15.2703 11.7 16.3 12.7297 16.3 14C16.3 15.2703 15.2703 16.3 14 16.3C12.7297 16.3 11.7 15.2703 11.7 14V11.7Z" stroke="currentColor" stroke-width="1.4"></path><rect x="6.3" y="6.3" width="5.4" height="5.4" stroke="currentColor" stroke-width="1.4"></rect></svg></code>&nbsp;<code title="C">C</code></span>. This is in contrast to a synthetic event programmatically dispatched via <code>dispatchEvent()</code>:</p>
<div><pre><p><span>document</span><span>.</span><span>addEventListener</span><span>(</span><span>"copy"</span><span>,</span><span> </span><span>(</span><span>e</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>{</span><span></span></p><p><span>  </span><span>console</span><span>.</span><span>log</span><span>(</span><span>"e.isTrusted is "</span><span> </span><span>+</span><span> e</span><span>.</span><span>isTrusted</span><span>)</span><span>;</span><span></span></p><p><span></span><span>}</span><span>)</span><span>;</span><span></span></p><p><span>document</span><span>.</span><span>dispatchEvent</span><span>(</span><span>new</span><span> </span><span>ClipboardEvent</span><span>(</span><span>"copy"</span><span>)</span><span>)</span><span>;</span><span></span></p></pre></div>
<p>Let's look at the clipboard events and see whether they allow us to write arbitrary data types to the clipboard.</p>
<h2>The Clipboard Events API</h2>
<p>A <code>ClipboardEvent</code> is dispatched for copy, cut, and paste events, and it contains a <code>clipboardData</code> property of type <code>DataTransfer</code>. The <code>DataTransfer</code> object is used by the Clipboard Events API to hold multiple representations of data.</p>
<p>Writing to the clipboard in a <code>copy</code> event is very straightforward:</p>
<div><pre><p><span>document</span><span>.</span><span>addEventListener</span><span>(</span><span>"copy"</span><span>,</span><span> </span><span>(</span><span>e</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>{</span><span></span></p><p><span>  e</span><span>.</span><span>preventDefault</span><span>(</span><span>)</span><span>;</span><span> </span><span></span></p><p><span>  e</span><span>.</span><span>clipboardData</span><span>.</span><span>setData</span><span>(</span><span>"text/plain"</span><span>,</span><span> </span><span>"Hello, world"</span><span>)</span><span>;</span><span></span></p><p><span>  e</span><span>.</span><span>clipboardData</span><span>.</span><span>setData</span><span>(</span><span>"text/html"</span><span>,</span><span> </span><span>"Hello, &lt;em&gt;world&lt;/em&gt;"</span><span>)</span><span>;</span><span></span></p><p><span></span><span>}</span><span>)</span><span>;</span><span></span></p></pre></div>
<p>And reading from the clipboard in a <code>paste</code> event is just as simple:</p>
<div><pre><p><span>document</span><span>.</span><span>addEventListener</span><span>(</span><span>"paste"</span><span>,</span><span> </span><span>(</span><span>e</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>{</span><span></span></p><p><span>  e</span><span>.</span><span>preventDefault</span><span>(</span><span>)</span><span>;</span><span> </span><span></span></p><p><span>  </span><span>const</span><span> html </span><span>=</span><span> e</span><span>.</span><span>clipboardData</span><span>.</span><span>getData</span><span>(</span><span>"text/html"</span><span>)</span><span>;</span><span></span></p><p><span>  </span><span>if</span><span> </span><span>(</span><span>html</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>  </span><span>}</span><span></span></p><p><span></span><span>}</span><span>)</span><span>;</span><span></span></p></pre></div>
<p>Now for the big question: can we write JSON to the clipboard?</p>
<div><pre><p><span>document</span><span>.</span><span>addEventListener</span><span>(</span><span>"copy"</span><span>,</span><span> </span><span>(</span><span>e</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>{</span><span></span></p><p><span>  e</span><span>.</span><span>preventDefault</span><span>(</span><span>)</span><span>;</span><span></span></p><p><span>  </span><span>const</span><span> json </span><span>=</span><span> </span><span>JSON</span><span>.</span><span>stringify</span><span>(</span><span>{</span><span> message</span><span>:</span><span> </span><span>"Hello"</span><span> </span><span>}</span><span>)</span><span>;</span><span></span></p><p><span>  e</span><span>.</span><span>clipboardData</span><span>.</span><span>setData</span><span>(</span><span>"application/json"</span><span>,</span><span> json</span><span>)</span><span>;</span><span> </span><span></span></p><p><span></span><span>}</span><span>)</span><span>;</span><span></span></p></pre></div>
<p>No exception is thrown, but did this actually write the JSON to the clipboard? Let's verify that by writing a paste handler that iterates over all of the entries in the clipboard and logs them out:</p>
<div><pre><p><span>document</span><span>.</span><span>addEventListener</span><span>(</span><span>"paste"</span><span>,</span><span> </span><span>(</span><span>e</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>{</span><span></span></p><p><span>  </span><span>for</span><span> </span><span>(</span><span>const</span><span> item </span><span>of</span><span> e</span><span>.</span><span>clipboardData</span><span>.</span><span>items</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>    </span><span>const</span><span> </span><span>{</span><span> kind</span><span>,</span><span> type </span><span>}</span><span> </span><span>=</span><span> item</span><span>;</span><span></span></p><p><span>    </span><span>if</span><span> </span><span>(</span><span>kind </span><span>===</span><span> </span><span>"string"</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>      item</span><span>.</span><span>getAsString</span><span>(</span><span>(</span><span>content</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>{</span><span></span></p><p><span>        </span><span>console</span><span>.</span><span>log</span><span>(</span><span>{</span><span> type</span><span>,</span><span> content </span><span>}</span><span>)</span><span>;</span><span></span></p><p><span>      </span><span>}</span><span>)</span><span>;</span><span></span></p><p><span>    </span><span>}</span><span></span></p><p><span>  </span><span>}</span><span></span></p><p><span></span><span>}</span><span>)</span><span>;</span><span></span></p></pre></div>
<p>Adding both of these handlers and invoking copy-paste results in the following being logged:</p>
<div><pre><p><span>{</span><span> </span><span>"type"</span><span>:</span><span> </span><span>"application/json"</span><span>,</span><span> content</span><span>:</span><span> </span><span>"{\"message\":\"Hello\"}"</span><span> </span><span>}</span><span></span></p></pre></div>
<p>It works! It seems that <code>clipboardData.setData</code> does not restrict data types in the same manner as the async <code>write</code> method does.</p>
<p>But... why? Why can we read and write arbitrary data types using <code>clipboardData</code> but not when using the async Clipboard API?</p>
<h3>History of <code>clipboardData</code></h3>
<p>The relatively new async Clipboard API was added to the spec in <a target="_blank" href="https://www.w3.org/TR/2017/WD-clipboard-apis-20170929/">2017</a>, but <code>clipboardData</code> is <em>much</em> older than that. A W3C draft for the Clipboard API from <a target="_blank" href="https://www.w3.org/TR/2006/WD-clipboard-apis-20061115/">2006</a> defines <code>clipboardData</code> and its <code>setData</code> and <code>getData</code> methods (which shows us that MIME types were not being used at that point):</p>
<blockquote>
<p><code>setData()</code> This takes one or two parameters. The first must be set to either 'text' or 'URL' (case-insensitive).</p>
<p><code>getData()</code> This takes one parameter, that allows the target to request a specific type of data.</p>
</blockquote>
<p>But it turns out that <code>clipboardData</code> is even older than the 2006 draft. Look at this quote from the "Status of this Document" section:</p>
<blockquote>
<p>In large part [this document] describes the functionalities as implemented in Internet Explorer...</p>
<p>The intention of this document is [...] to specify what actually works in current browsers, or [be] a simple target for them to improve interoperability, rather than adding new features.</p>
</blockquote>
<p>This <a target="_blank" href="https://www.arstdesign.com/articles/clipboardexploit.html">2003 article</a> details how, at the time, in Internet Explorer 4 and above, you could use <code>clipboardData</code> to read the user's clipboard without their consent. Since Internet Explorer 4 was released in 1997 it seems that the <code>clipboardData</code> interface is at least 26 years old at the time of writing.</p>
<p>MIME types entered the <a target="_blank" href="https://www.w3.org/TR/2011/WD-clipboard-apis-20110412/">spec in 2011</a>:</p>
<blockquote>
<p>The <em>dataType</em> argument is a string, for example but not limited to a MIME type...</p>
</blockquote>
<blockquote>
<p>If a script calls getData('text/html')...</p>
</blockquote>
<p>At the time, the spec had not determined which data types should be used:</p>
<blockquote>
<p>While it is possible to use any string for setData()'s type argument, sticking to common types is recommended.</p>
<p>[Issue] Should we list some "common types"?</p>
</blockquote>
<p>Being able to use <em>any</em> string for <code>setData</code> and <code>getData</code> still holds today. This works perfectly fine:</p>
<div><pre><p><span>document</span><span>.</span><span>addEventListener</span><span>(</span><span>"copy"</span><span>,</span><span> </span><span>(</span><span>e</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>{</span><span></span></p><p><span>  e</span><span>.</span><span>preventDefault</span><span>(</span><span>)</span><span>;</span><span></span></p><p><span>  e</span><span>.</span><span>clipboardData</span><span>.</span><span>setData</span><span>(</span><span>"foo bar baz"</span><span>,</span><span> </span><span>"Hello, world"</span><span>)</span><span>;</span><span></span></p><p><span></span><span>}</span><span>)</span><span>;</span><span></span></p><p><span>document</span><span>.</span><span>addEventListener</span><span>(</span><span>"paste"</span><span>,</span><span> </span><span>(</span><span>e</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>{</span><span></span></p><p><span>  </span><span>const</span><span> content </span><span>=</span><span> e</span><span>.</span><span>clipboardData</span><span>.</span><span>getData</span><span>(</span><span>"foo bar baz"</span><span>)</span><span>;</span><span></span></p><p><span>  </span><span>if</span><span> </span><span>(</span><span>content</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>    </span><span>console</span><span>.</span><span>log</span><span>(</span><span>content</span><span>)</span><span>;</span><span> </span><span></span></p><p><span>  </span><span>}</span><span></span></p><p><span></span><span>}</span><span>)</span><span>;</span><span></span></p></pre></div>
<p>If you paste this code snippet into your DevTools and then hit copy and paste, you will see the message "Hello, world" logged to your console.</p>
<p>The reason for the Clipboard Events API's <code>clipboardData</code> allowing us to use any data type seems to be a historical one. <em>"Don't break the web"</em>.</p>
<h3>Revisiting isTrusted</h3>
<p>Let's consider this sentence from the <a target="_blank" href="https://www.w3.org/TR/clipboard-apis/#mandatory-data-types-x">mandatory data types</a> section again:</p>
<blockquote>
<p>The data types that untrusted scripts are allowed to write to the clipboard are limited as a security precaution.</p>
</blockquote>
<p>So what happens if we attempt to write to the clipboard in a synthetic (untrusted) clipboard event?</p>
<div><pre><p><span>document</span><span>.</span><span>addEventListener</span><span>(</span><span>"copy"</span><span>,</span><span> </span><span>(</span><span>e</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>{</span><span></span></p><p><span>  e</span><span>.</span><span>preventDefault</span><span>(</span><span>)</span><span>;</span><span></span></p><p><span>  e</span><span>.</span><span>clipboardData</span><span>.</span><span>setData</span><span>(</span><span>"text/plain"</span><span>,</span><span> </span><span>"Hello"</span><span>)</span><span>;</span><span></span></p><p><span></span><span>}</span><span>)</span><span>;</span><span></span></p><p><span>document</span><span>.</span><span>dispatchEvent</span><span>(</span><span>new</span><span> </span><span>ClipboardEvent</span><span>(</span><span>"copy"</span><span>,</span><span> </span><span>{</span><span></span></p><p><span>  clipboardData</span><span>:</span><span> </span><span>new</span><span> </span><span>DataTransfer</span><span>(</span><span>)</span><span>,</span><span></span></p><p><span></span><span>}</span><span>)</span><span>)</span><span>;</span><span></span></p></pre></div>
<p>This runs successfully, but it doesn't modify the clipboard. This is the expected behavior <a target="_blank" href="https://www.w3.org/TR/clipboard-apis/#integration-with-other-scripts-and-events">as explained in the spec</a>:</p>
<blockquote>
<p>Synthetic cut and copy events <em>must not</em> modify data on the system clipboard.</p>
</blockquote>
<blockquote>
<p>Synthetic paste events <em>must not</em> give a script access to data on the real system clipboard.</p>
</blockquote>
<p>So only copy and paste events dispatched by the user agent are allowed to modify the clipboard. Makes total sense—I wouldn't want websites to freely read my clipboard contents and steal my passwords.</p>
<hr>
<p>To summarize our findings so far:</p>
<ul>
<li>The async Clipboard API introduced in 2017 restricts which data types can be written to and read from the clipboard. However, it can read from and write to the clipboard at any time, given that the user has granted permission to do so (and the <a target="_blank" href="https://www.w3.org/TR/clipboard-apis/#privacy-async">document is focused</a>).</li>
<li>The older Clipboard Events API has no real restrictions on which data types can be written to and read from the clipboard. However, it can only be used in copy and paste event handlers triggered by the user agent (i.e. when <code>isTrusted</code> is true).</li>
</ul>
<p>It seems that using the Clipboard Events API is the only way forward if you want to write data types to the clipboard that are not just plain text, HTML, or images. It's much less restrictive in that regard.</p>
<p>But what if you want to build a Copy button that writes non-standard data types to the clipboard? It doesn't seem like you'd be able to use the Clipboard Events API if the user did not trigger a copy event. Right?</p>
<h2>Building a copy button that writes arbitrary data types</h2>
<p>I went and tried out Copy buttons in different web applications and inspected what was written to the clipboard. It yielded interesting results.</p>
<p>Google Docs has a Copy button which can be found in their right-click menu.</p>
<p><img src="https://alexharri.com/images/posts/clipboard/google-docs-copy-button.png" width="480"></p>
<p>This copy button writes three representations to the clipboard:</p>
<ul>
<li><code>text/plain</code>,</li>
<li><code>text/html</code>, and</li>
<li><code>application/x-vnd.google-docs-document-slice-clip+wrapped</code></li>
</ul>
<p>Note: <!-- -->The third representation contains JSON data.</p>
<p>They're writing a custom data type to the clipboard, which means that they aren't using the async Clipboard API. How are they doing that through a click handler?</p>
<p>I ran the profiler, hit the copy button, and inspected the results. It turns out that clicking the copy button triggers a call to <code>document.execCommand("copy")</code>.</p>
<p><img src="https://alexharri.com/images/posts/clipboard/google-docs-exec-command.png"></p>
<p>This was surprising to me. My first thought was <em>"Isn't <code>execCommand</code> the old, deprecated way of copying text to the clipboard?"</em>.</p>
<p>Yes, it is, but Google uses it for a reason. <code>execCommand</code> is special in that it allows you to programmatically dispatch a trusted copy event <em>as if</em> the user invoked the copy command themselves.</p>
<div><pre><p><span>document</span><span>.</span><span>addEventListener</span><span>(</span><span>"copy"</span><span>,</span><span> </span><span>(</span><span>e</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>{</span><span></span></p><p><span>  </span><span>console</span><span>.</span><span>log</span><span>(</span><span>"e.isTrusted is "</span><span> </span><span>+</span><span> e</span><span>.</span><span>isTrusted</span><span>)</span><span>;</span><span></span></p><p><span></span><span>}</span><span>)</span><span>;</span><span></span></p><p><span>document</span><span>.</span><span>execCommand</span><span>(</span><span>"copy"</span><span>)</span><span>;</span><span></span></p></pre></div>
<p>Note: <!-- -->Safari requires an active selection for <code>execCommand("copy")</code> to dispatch a copy event. That selection can be faked by adding a non-empty input element to the DOM and selecting it prior to invoking <code>execCommand("copy")</code>, after which the input can be removed from the DOM.</p>
<p>Okay, so using <code>execCommand</code> allows us to write arbitrary data types to the clipboard in response to click events. Cool!</p>
<p>What about paste? Can we use <code>execCommand("paste")</code>?</p>
<h2>Building a paste button</h2>
<p>Let's try the Paste button in Google Docs and see what it does.</p>
<p><img src="https://alexharri.com/images/posts/clipboard/google-docs-paste-button.png" width="480"></p>
<p>On my Macbook, I got a popup telling me that I need to install an extension to use the paste button.</p>
<p><img src="https://alexharri.com/images/posts/clipboard/google-docs-paste-popup.png" width="650"></p>
<p>But oddly, on my Windows laptop, the paste button just worked.</p>
<p>Weird. Where does the inconsistency come from? Well, whether or not the paste button will work can be checked by running <code>queryCommandSupported("paste")</code>:</p>
<div><pre><p><span>document</span><span>.</span><span>queryCommandSupported</span><span>(</span><span>"paste"</span><span>)</span><span>;</span><span></span></p></pre></div>
<p>On my Macbook, I got <code>false</code> on Chrome and Firefox, but <code>true</code> on Safari.</p>
<p>Safari, being privacy-conscious, required me to confirm the paste action. I think that's a really good idea. It makes it very explicit that the website will read from your clipboard.</p>
<p><img src="https://alexharri.com/images/posts/clipboard/google-docs-paste-confirm.png" width="650"></p>
<p>On my Windows laptop, I got <code>true</code> on Chrome and Edge, but <code>false</code> on Firefox. The inconsistency with Chrome is surprising. Why does Chrome allow <code>execCommand("paste")</code> on Windows but not macOS? I wasn't able to find any info on this.</p>
<p>I find it surprising that Google doesn't attempt to fall back to the async Clipboard API when <code>execCommand("paste")</code> is unavailable. Even though they wouldn't be able to read the <code>application/x-vnd.google-[...]</code> representation using it, the HTML representation contains internal IDs that could be used.</p>
<div><pre><p><span></span><span>&lt;</span><span>meta</span><span> </span><span>charset</span><span>=</span><span>"</span><span>utf-8</span><span>"</span><span>&gt;</span><span></span></p><p><span></span><span>&lt;</span><span>b</span><span> </span><span>id</span><span>=</span><span>"</span><span>docs-internal-guid-[guid]</span><span>"</span><span> </span><span>style</span><span>=</span><span>"</span><span>...</span><span>"</span><span>&gt;</span><span></span></p><p><span>  </span><span>&lt;</span><span>span</span><span> </span><span>style</span><span>=</span><span>"</span><span>...</span><span>"</span><span>&gt;</span><span>Copied text</span><span>&lt;/</span><span>span</span><span>&gt;</span><span></span></p><p><span></span><span>&lt;/</span><span>b</span><span>&gt;</span><span></span></p></pre></div>
<hr>
<p>Another web application with a paste button is Figma, and they take a completely different approach. Let's see what they're doing.</p>
<h2>Copy and Paste in Figma</h2>
<p>Figma is a web-based application (their native app uses <a target="_blank" href="https://www.electronjs.org/">Electron</a>). Let's see what their copy button writes to the clipboard.</p>
<p><img src="https://alexharri.com/images/posts/clipboard/figma-copy-button.png" width="480"></p>
<p>Figma's copy button writes two representations to the clipboard: <code>text/plain</code> and <code>text/html</code>. This was surprising to me at first. How would Figma represent their various layout and styling features in plain HTML?</p>
<p>But looking at the HTML, we see two empty <code>span</code> elements with <code>data-metadata</code> and <code>data-buffer</code> properties:</p>
<div><pre><p><span>&lt;</span><span>meta</span><span> </span><span>charset</span><span>=</span><span>"</span><span>utf-8</span><span>"</span><span>&gt;</span><span></span></p><p><span></span><span>&lt;</span><span>div</span><span>&gt;</span><span></span></p><p><span>  </span><span>&lt;</span><span>span</span><span> </span><span>data-metadata</span><span>=</span><span>"</span><span>&lt;!--(figmeta)eyJma[...]9ifQo=(/figmeta)--&gt;</span><span>"</span><span>&gt;</span><span>&lt;/</span><span>span</span><span>&gt;</span><span></span></p><p><span>  </span><span>&lt;</span><span>span</span><span> </span><span>data-buffer</span><span>=</span><span>"</span><span>&lt;!--(figma)ZmlnL[...]P/Ag==(/figma)--&gt;</span><span>"</span><span>&gt;</span><span>&lt;/</span><span>span</span><span>&gt;</span><span></span></p><p><span></span><span>&lt;/</span><span>div</span><span>&gt;</span><span></span></p><p><span></span><span>&lt;</span><span>span</span><span> </span><span>style</span><span>=</span><span>"</span><span>white-space</span><span>:</span><span>pre-wrap</span><span>;</span><span>"</span><span>&gt;</span><span>Text</span><span>&lt;/</span><span>span</span><span>&gt;</span><span></span></p></pre></div>
<p>Note: <!-- -->The <code>data-buffer</code> string is ~26,000 characters for an empty frame. After that, the length of <code>data-buffer</code> seems to grow linearly with the amount of content that was copied.</p>
<p>Looks like base64. The <code>eyJ</code> start is a clear indication of <code>data-metadata</code> being a base64 encoded JSON string. Running <code>JSON.parse(atob())</code> on <code>data-metadata</code> yields:</p>
<div><pre><p><span>{</span><span></span></p><p><span>  </span><span>"fileKey"</span><span>:</span><span> </span><span>"4XvKUK38NtRPZASgUJiZ87"</span><span>,</span><span></span></p><p><span>  </span><span>"pasteID"</span><span>:</span><span> </span><span>1261442360</span><span>,</span><span></span></p><p><span>  </span><span>"dataType"</span><span>:</span><span> </span><span>"scene"</span><span></span></p><p><span></span><span>}</span><span></span></p></pre></div>
<p>Note: <!-- -->I've replaced the real <code>fileKey</code> and <code>pasteID</code>.</p>
<p>But what about the big <code>data-buffer</code> property? Base64 decoding it yields the following:</p>
<div><pre><p><span>fig-kiwiF\x00\x00\x00\x1CK\x00\x00µ½\v\x9CdI[...]\x197Ü\x83\x03</span></p></pre></div>
<p>Looks like a binary format. After a bit of digging—using <code>fig-kiwi</code> as a clue—I discovered that this is the <a target="_blank" href="https://github.com/evanw/kiwi">Kiwi message format</a> (created by Figma's co-founder and former CTO, <a target="_blank" href="https://github.com/evanw">Evan Wallace</a>), which is used to encode <code>.fig</code> files.</p>
<p>Since Kiwi is a schema-based format, it seemed like we wouldn't be able to parse this data without knowing the schema. However, lucky for us, Evan created a <a target="_blank" href="https://github.com/evanw/kiwi/issues/17#issuecomment-1937797254">public <code>.fig</code> file parser</a>. Let's try plugging the buffer into that!</p>
<p>To convert the buffer into a <code>.fig</code> file, I wrote a small script to generate a Blob URL:</p>
<div><pre><p><span>const</span><span> base64 </span><span>=</span><span> </span><span>"ZmlnL[...]P/Ag=="</span><span>;</span><span></span></p><p><span></span><span>const</span><span> blob </span><span>=</span><span> </span><span>base64toBlob</span><span>(</span><span>base64</span><span>,</span><span> </span><span>"application/octet-stream"</span><span>)</span><span>;</span><span></span></p><p><span></span><span>console</span><span>.</span><span>log</span><span>(</span><span>URL</span><span>.</span><span>createObjectURL</span><span>(</span><span>blob</span><span>)</span><span>)</span><span>;</span><span></span></p></pre></div>
<p>I then downloaded the resulting blob as a <code>.fig</code> file, uploaded that to the <code>.fig</code> file parser, and voilà:</p>
<p><img src="https://alexharri.com/images/posts/clipboard/figma-data.png" width="620"></p>
<p>So copying in Figma works by creating a small Figma file, encoding that as a base64, placing the resulting base64 string into the <code>data-buffer</code> attribute of an empty HTML <code>span</code> element, and storing that in the user's clipboard.</p>
<h3>The benefits of copy-pasting HTML</h3>
<p>This seemed a bit silly to me at first, but there is a strong benefit to taking that approach. To understand why, consider how the web-based Clipboard API interacts with the various operating system Clipboard APIs.</p>
<p>Windows, macOS, and Linux all offer different formats for writing data to the clipboard. If you want to write HTML to the clipboard, <a target="_blank" href="https://learn.microsoft.com/en-us/windows/win32/dataxchg/html-clipboard-format">Windows has <code>CF_HTML</code></a> and <a target="_blank" href="https://developer.apple.com/documentation/appkit/nspasteboard/pasteboardtype/1529057-html">macOS has <code>NSPasteboard.PasteboardType.html</code></a>.</p>
<p>All of the operating systems offer types for "standard" formats (plain text, HTML, and PNG images). But which OS format should the browser use when the user attempts to write an arbitrary data type like <code>application/foo-bar</code> to the clipboard?</p>
<p>There isn't a good match, so the browser doesn't write that representation to common formats on the OS clipboard. Instead, that representation only exists within a custom browser-specific clipboard format on the OS clipboard. This results in being able to copy and paste arbitrary data types across browser tabs, but <em>not</em> across applications.</p>
<p>This is why using the common data types <code>text/plain</code>, <code>text/html</code> and <code>image/png</code> is so convenient. They are mapped to common OS clipboard formats and as such can be easily read by other applications, which makes copy/paste work across applications. In Figma's case, using <code>text/html</code> enables copying a Figma element from <code>figma.com</code> in the browser and then pasting it into the native Figma app, and vice versa.</p>
<h2>What do browsers write to the clipboard for custom data types?</h2>
<p>We've learned that we can write and read custom data types to and from the clipboard across browser tabs, but not across applications. But what exactly are browsers writing to the native OS clipboard when we write custom data types to the web clipboard?</p>
<p>I ran the following in a <code>copy</code> listener in each of the major browsers on my Macbook:</p>
<div><pre><p><span>document</span><span>.</span><span>addEventListener</span><span>(</span><span>"copy"</span><span>,</span><span> </span><span>(</span><span>e</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>{</span><span></span></p><p><span>  e</span><span>.</span><span>preventDefault</span><span>(</span><span>)</span><span>;</span><span></span></p><p><span>  e</span><span>.</span><span>clipboardData</span><span>.</span><span>setData</span><span>(</span><span>"text/plain"</span><span>,</span><span> </span><span>"Hello, world"</span><span>)</span><span>;</span><span></span></p><p><span>  e</span><span>.</span><span>clipboardData</span><span>.</span><span>setData</span><span>(</span><span>"text/html"</span><span>,</span><span> </span><span>"&lt;em&gt;Hello, world&lt;/em&gt;"</span><span>)</span><span>;</span><span></span></p><p><span>  e</span><span>.</span><span>clipboardData</span><span>.</span><span>setData</span><span>(</span><span>"application/json"</span><span>,</span><span> </span><span>JSON</span><span>.</span><span>stringify</span><span>(</span><span>{</span><span> type</span><span>:</span><span> </span><span>"Hello, world"</span><span> </span><span>}</span><span>)</span><span>)</span><span>;</span><span></span></p><p><span>  e</span><span>.</span><span>clipboardData</span><span>.</span><span>setData</span><span>(</span><span>"foo bar baz"</span><span>,</span><span> </span><span>"Hello, world"</span><span>)</span><span>;</span><span></span></p><p><span></span><span>}</span><span>)</span><span>;</span><span></span></p></pre></div>
<p>I then inspected the clipboard using <a target="_blank" href="https://apps.apple.com/us/app/pasteboard-viewer/id1499215709">Pasteboard Viewer</a>. Chrome adds four entries to the Pasteboard:</p>
<ul>
<li><code>public.html</code> contains the HTML representation.</li>
<li><code>public.utf8-plain-text</code> contains the plain text representation.</li>
<li><code>org.chromium.web-custom-data</code> contains the custom representations.</li>
<li><code>org.chromium.source-url</code> contains the URL of the web page where the copy was performed.</li>
</ul>
<p>Looking at the <code>org.chromium.web-custom-data</code>, we see the data we copied:</p>
<p><img src="https://alexharri.com/images/posts/clipboard/pasteboard-chrome.png"></p>
<p>I imagine the accented "î" and inconsistent line breaks are the result of some delimiters being displayed incorrectly.</p>
<p>Firefox creates the <code>public.html</code> and <code>public.utf8-plain-text</code> entries as well, but writes the custom data to <code>org.mozilla.custom-clipdata</code>. It does not store the source URL like Chrome does.</p>
<p>Safari, as you might expect, also creates the <code>public.html</code> and <code>public.utf8-plain-text</code> entries. It writes the custom data to <code>com.apple.WebKit.custom-pasteboard-data</code> and, interestingly, it also stores the full list of representations (including plain text and HTML) and source URL there.</p>
<p>Note: <!-- -->Safari allows copy-pasting custom data types across browser tabs if the source URL (domain) is the same, but not across different domains. This limitation does not seem to be present in Chrome or Firefox (even though Chrome stores the source URL).</p>
<h2>Raw Clipboard Access for the Web</h2>
<p>A proposal for <a target="_blank" href="https://github.com/WICG/raw-clipboard-access/blob/f58f5cedc753d55c77994aa05e75d5d2ad7344a7/explainer.md">Raw Clipboard Access</a> was created in 2019, which proposed an API for giving web applications raw read and write access to the native OS clipboards.</p>
<p>This excerpt from the <a target="_blank" href="https://chromestatus.com/feature/5682768497344512">Motivation section on chromestatus.com</a> for the Raw Clipboard Access feature highlights the benefits rather succinctly:</p>
<blockquote>
<p>Without Raw Clipboard Access [...] web applications are generally limited to a small subset of formats, and are unable to interoperate with the long tail of formats. For example, Figma and Photopea are unable to interoperate with most image formats.</p>
</blockquote>
<p>However, the Raw Clipboard Access proposal ended up not being taken further due to <a target="_blank" href="https://github.com/WICG/raw-clipboard-access/blob/f58f5cedc753d55c77994aa05e75d5d2ad7344a7/explainer.md#stakeholder-feedback--opposition">security concerns</a> around exploits such as remote code execution in native applications.</p>
<p>The most recent proposal for writing custom data types to the clipboard is the Web Custom Formats proposal (often referred to as pickling).</p>
<h2>Web Custom Formats (Pickling)</h2>
<p>In 2022, Chromium implemented support for <a target="_blank" href="https://developer.chrome.com/blog/web-custom-formats-for-the-async-clipboard-api">Web Custom Formats</a> in the async Clipboard API.</p>
<p>It allows web applications to write custom data types via the async Clipboard API by prefixing the data type with <code>"web "</code>:</p>
<div><pre><p><span></span><span>const</span><span> json </span><span>=</span><span> </span><span>JSON</span><span>.</span><span>stringify</span><span>(</span><span>{</span><span> message</span><span>:</span><span> </span><span>"Hello, world"</span><span> </span><span>}</span><span>)</span><span>;</span><span></span></p><p><span></span><span>const</span><span> jsonBlob </span><span>=</span><span> </span><span>new</span><span> </span><span>Blob</span><span>(</span><span>[</span><span>json</span><span>]</span><span>,</span><span> </span><span>{</span><span> type</span><span>:</span><span> </span><span>"application/json"</span><span> </span><span>}</span><span>)</span><span>;</span><span></span></p><p><span></span><span>const</span><span> clipboardItem </span><span>=</span><span> </span><span>new</span><span> </span><span>ClipboardItem</span><span>(</span><span>{</span><span></span></p><p><span>  </span><span>[</span><span>`</span><span>web </span><span>${</span><span>jsonBlob</span><span>.</span><span>type</span><span>}</span><span>`</span><span>]</span><span>:</span><span> jsonBlob</span><span>,</span><span></span></p><p><span></span><span>}</span><span>)</span><span>;</span><span></span></p><p><span>navigator</span><span>.</span><span>clipboard</span><span>.</span><span>write</span><span>(</span><span>[</span><span>clipboardItem</span><span>]</span><span>)</span><span>;</span><span></span></p></pre></div>
<p>These are read using the async Clipboard API like any other data type:</p>
<div><pre><p><span>const</span><span> items </span><span>=</span><span> </span><span>await</span><span> navigator</span><span>.</span><span>clipboard</span><span>.</span><span>read</span><span>(</span><span>)</span><span>;</span><span></span></p><p><span></span><span>for</span><span> </span><span>(</span><span>const</span><span> item </span><span>of</span><span> items</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>  </span><span>if</span><span> </span><span>(</span><span>item</span><span>.</span><span>types</span><span>.</span><span>includes</span><span>(</span><span>"web application/json"</span><span>)</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>    </span><span>const</span><span> blob </span><span>=</span><span> </span><span>await</span><span> item</span><span>.</span><span>getType</span><span>(</span><span>"web application/json"</span><span>)</span><span>;</span><span></span></p><p><span>    </span><span>const</span><span> json </span><span>=</span><span> </span><span>await</span><span> blob</span><span>.</span><span>text</span><span>(</span><span>)</span><span>;</span><span></span></p><p><span>  </span><span>}</span><span></span></p><p><span></span><span>}</span><span></span></p></pre></div>
<p>What's more interesting is what is written to the native clipboard. When writing web custom formats, the following is written to the native OS clipboard:</p>
<ul>
<li>A mapping from the data types to clipboard entry names</li>
<li>Clipboard entries for each data type</li>
</ul>
<p>On macOS, the mapping is written to <code>org.w3.web-custom-format.map</code> and its content looks like so:</p>
<div><pre><p><span>{</span><span></span></p><p><span>  </span><span>"application/json"</span><span>:</span><span> </span><span>"org.w3.web-custom-format.type-0"</span><span>,</span><span></span></p><p><span>  </span><span>"application/octet-stream"</span><span>:</span><span> </span><span>"org.w3.web-custom-format.type-1"</span><span></span></p><p><span></span><span>}</span><span></span></p></pre></div>
<p>The <code>org.w3.web-custom-format.type-[index]</code> keys correspond to entries on the OS clipboard containing the unsanitized data from the blobs. This allows native applications to look at the mapping to see if a given representation is available and then read the unsanitized content from the corresponding clipboard entry.</p>
<p>Note: <!-- -->Windows and Linux <a target="_blank" href="https://github.com/dway123/clipboard-pickling/blob/bce5101564d379f48f11839e2c141ee51438e13c/explainer.md#os-interaction-format-naming">use a different naming convention</a> for the mapping and clipboard entries.</p>
<p>This avoids the security issues around raw clipboard access since web applications cannot write unsanitized data to whatever OS clipboard format they want to. That comes with an interoperability trade-off that is explicitly listed in the <a target="_blank" href="https://github.com/dway123/clipboard-pickling/blob/bce5101564d379f48f11839e2c141ee51438e13c/explainer.md#non-goals">Pickling for Async Clipboard API spec</a>:</p>
<blockquote>
<h4>Non-goals</h4>
<p>Allow interoperability with legacy native applications, without update. This was explored in a raw clipboard proposal, and may be explored further in the future, but comes with significant security challenges (remote code execution in system native applications).</p>
</blockquote>
<p>This means that native applications need to be updated for clipboard interop with web applications when using custom data types.</p>
<p>Web Custom Formats have been available in Chromium-based browsers since 2022, but other browsers have not implemented this proposal yet.</p>
<h2>Final words</h2>
<p>As of right now, there isn't a great way to write custom data types to the clipboard that works across all browsers. Figma's approach of placing base64 strings into an HTML representation is crude but effective in that it circumvents the plethora of limitations around the clipboard API. It seems like a good approach to take if you need to transmit custom data types via the clipboard.</p>
<p>I find the Web Custom Formats proposal promising, and I hope it becomes implemented by all of the major browsers. It seems like it would enable writing custom data types to the clipboard in a secure and practical manner.</p>
<p>Thanks for reading! I hope this was interesting.</p>
<p>— Alex Harri</p><div><p>Mailing list</p><div><p>To be notified of new posts, subscribe to my mailing list.</p></div></div></main></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Anarchy in Sudan has spawned the world’s worst famine in 40 years (235 pts)]]></title>
            <link>https://www.economist.com/briefing/2024/08/29/anarchy-in-sudan-has-spawned-the-worlds-worst-famine-in-40-years</link>
            <guid>41415819</guid>
            <pubDate>Sun, 01 Sep 2024 10:48:53 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.economist.com/briefing/2024/08/29/anarchy-in-sudan-has-spawned-the-worlds-worst-famine-in-40-years">https://www.economist.com/briefing/2024/08/29/anarchy-in-sudan-has-spawned-the-worlds-worst-famine-in-40-years</a>, See on <a href="https://news.ycombinator.com/item?id=41415819">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><main role="main" id="content"><article data-test-id="Article" id="new-article-template"><div data-test-id="standard-article-template"><section><p><span><a href="https://www.economist.com/briefing" data-analytics="sidebar:section"><span>Briefing</span></a></span><span> | <!-- -->An intensifying calamity</span></p><h2>Anarchy in Sudan has spawned the world’s worst famine in 40 years</h2><h2>Millions are likely to perish</h2></section><section><figure><img alt="Sudanese refugees wait for food distribution at a camp in Chad" fetchpriority="high" width="1280" height="720" decoding="async" data-nimg="1" sizes="(min-width: 960px) 700px, 95vw" srcset="https://www.economist.com/cdn-cgi/image/width=360,quality=80,format=auto/content-assets/images/20240831_FBP001.jpg 360w, https://www.economist.com/cdn-cgi/image/width=384,quality=80,format=auto/content-assets/images/20240831_FBP001.jpg 384w, https://www.economist.com/cdn-cgi/image/width=480,quality=80,format=auto/content-assets/images/20240831_FBP001.jpg 480w, https://www.economist.com/cdn-cgi/image/width=600,quality=80,format=auto/content-assets/images/20240831_FBP001.jpg 600w, https://www.economist.com/cdn-cgi/image/width=834,quality=80,format=auto/content-assets/images/20240831_FBP001.jpg 834w, https://www.economist.com/cdn-cgi/image/width=960,quality=80,format=auto/content-assets/images/20240831_FBP001.jpg 960w, https://www.economist.com/cdn-cgi/image/width=1096,quality=80,format=auto/content-assets/images/20240831_FBP001.jpg 1096w, https://www.economist.com/cdn-cgi/image/width=1280,quality=80,format=auto/content-assets/images/20240831_FBP001.jpg 1280w, https://www.economist.com/cdn-cgi/image/width=1424,quality=80,format=auto/content-assets/images/20240831_FBP001.jpg 1424w" src="https://www.economist.com/cdn-cgi/image/width=1424,quality=80,format=auto/content-assets/images/20240831_FBP001.jpg"><figcaption><span>Photograph: Panos Pictures/ Sven Torfinn</span></figcaption></figure></section><div><section data-body-id="cp2"><p data-component="paragraph"><span data-caps="initial">I</span><small>T IS OFFICIAL</small>: for only the third time in the past 20 years, the <small>UN</small> has declared a full-blown famine. The declaration concerns a refugee camp called Zamzam, on the outskirts of the city of el-Fasher in Sudan. As long ago as April, Médecins Sans Frontières, a charity, estimated that every two hours a child in the camp was dying from starvation or disease—and since then the situation has got worse.</p></section><p>This article appeared in the Briefing section of the print edition under the headline “An intensifying calamity”</p><div orientation="vertical" data-test-id="vertical"><div orientation="vertical"><figure><img alt="Sudan: Why its catastrophic war is the world’s problem" loading="lazy" width="1280" height="1709" decoding="async" data-nimg="1" sizes="300px" srcset="https://www.economist.com/cdn-cgi/image/width=16,quality=80,format=auto/media-assets/image/20240831_DE_EU.jpg 16w, https://www.economist.com/cdn-cgi/image/width=32,quality=80,format=auto/media-assets/image/20240831_DE_EU.jpg 32w, https://www.economist.com/cdn-cgi/image/width=48,quality=80,format=auto/media-assets/image/20240831_DE_EU.jpg 48w, https://www.economist.com/cdn-cgi/image/width=64,quality=80,format=auto/media-assets/image/20240831_DE_EU.jpg 64w, https://www.economist.com/cdn-cgi/image/width=96,quality=80,format=auto/media-assets/image/20240831_DE_EU.jpg 96w, https://www.economist.com/cdn-cgi/image/width=128,quality=80,format=auto/media-assets/image/20240831_DE_EU.jpg 128w, https://www.economist.com/cdn-cgi/image/width=256,quality=80,format=auto/media-assets/image/20240831_DE_EU.jpg 256w, https://www.economist.com/cdn-cgi/image/width=360,quality=80,format=auto/media-assets/image/20240831_DE_EU.jpg 360w, https://www.economist.com/cdn-cgi/image/width=384,quality=80,format=auto/media-assets/image/20240831_DE_EU.jpg 384w, https://www.economist.com/cdn-cgi/image/width=480,quality=80,format=auto/media-assets/image/20240831_DE_EU.jpg 480w, https://www.economist.com/cdn-cgi/image/width=600,quality=80,format=auto/media-assets/image/20240831_DE_EU.jpg 600w, https://www.economist.com/cdn-cgi/image/width=834,quality=80,format=auto/media-assets/image/20240831_DE_EU.jpg 834w, https://www.economist.com/cdn-cgi/image/width=960,quality=80,format=auto/media-assets/image/20240831_DE_EU.jpg 960w, https://www.economist.com/cdn-cgi/image/width=1096,quality=80,format=auto/media-assets/image/20240831_DE_EU.jpg 1096w, https://www.economist.com/cdn-cgi/image/width=1280,quality=80,format=auto/media-assets/image/20240831_DE_EU.jpg 1280w, https://www.economist.com/cdn-cgi/image/width=1424,quality=80,format=auto/media-assets/image/20240831_DE_EU.jpg 1424w" src="https://www.economist.com/cdn-cgi/image/width=1424,quality=80,format=auto/media-assets/image/20240831_DE_EU.jpg"></figure></div><div orientation="vertical"><h3 orientation="vertical">From the August 31st 2024 edition</h3><p orientation="vertical">Discover stories from this section and more in the list of contents</p><p><a href="https://www.economist.com/weeklyedition/2024-08-31" data-analytics="sidebar:weekly_edition"><span>Explore the edition</span></a></p></div></div></div></div></article></main></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Postgres Webhooks with Pgstream (115 pts)]]></title>
            <link>https://xata.io/blog/postgres-webhooks-with-pgstream</link>
            <guid>41415651</guid>
            <pubDate>Sun, 01 Sep 2024 10:10:51 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://xata.io/blog/postgres-webhooks-with-pgstream">https://xata.io/blog/postgres-webhooks-with-pgstream</a>, See on <a href="https://news.ycombinator.com/item?id=41415651">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><p><a href="https://xata.io/pgstream">pgstream</a> is a CDC (Change-Data-Capture) tool focused on PostgreSQL. Among other <a href="https://github.com/xataio/pgstream?tab=readme-ov-file#features">things</a>, it can be used to call webhooks whenever there is a data (or schema) change in a Postgres database. This means that whenever a row is inserted, updated, or deleted, or a table is created, altered, truncated or deleted, a webhook is notified of the relevant event details.</p>
<p>In this article we're going to dive into the pgstream webhooks functionality, including more advanced topics, like sending the old and new values, TOAST support, and schema changes support.</p>
<div><p><a href="https://xata.io/mdx/docs/mdx-blog/pgstream-webhooks.png"><img alt="Postgres webhooks with pgstream" loading="lazy" decoding="async" data-nimg="fill" sizes="100vw" srcset="https://xata.io/_next/image?url=%2Fmdx%2Fdocs%2Fmdx-blog%2Fpgstream-webhooks.png&amp;w=640&amp;q=75 640w, https://xata.io/_next/image?url=%2Fmdx%2Fdocs%2Fmdx-blog%2Fpgstream-webhooks.png&amp;w=750&amp;q=75 750w, https://xata.io/_next/image?url=%2Fmdx%2Fdocs%2Fmdx-blog%2Fpgstream-webhooks.png&amp;w=828&amp;q=75 828w, https://xata.io/_next/image?url=%2Fmdx%2Fdocs%2Fmdx-blog%2Fpgstream-webhooks.png&amp;w=1080&amp;q=75 1080w, https://xata.io/_next/image?url=%2Fmdx%2Fdocs%2Fmdx-blog%2Fpgstream-webhooks.png&amp;w=1200&amp;q=75 1200w, https://xata.io/_next/image?url=%2Fmdx%2Fdocs%2Fmdx-blog%2Fpgstream-webhooks.png&amp;w=1920&amp;q=75 1920w, https://xata.io/_next/image?url=%2Fmdx%2Fdocs%2Fmdx-blog%2Fpgstream-webhooks.png&amp;w=2048&amp;q=75 2048w, https://xata.io/_next/image?url=%2Fmdx%2Fdocs%2Fmdx-blog%2Fpgstream-webhooks.png&amp;w=3840&amp;q=75 3840w" src="https://xata.io/_next/image?url=%2Fmdx%2Fdocs%2Fmdx-blog%2Fpgstream-webhooks.png&amp;w=3840&amp;q=75"></a></p><p><figcaption>Postgres webhooks with pgstream</figcaption></p></div>

<p>For this tutorial we need a Postgres instance that has logical replication enabled and the <a href="https://github.com/eulerto/wal2json">wal2json</a> output plugin loaded. There are a number of ways to do this, but we're going to use the <a href="https://github.com/xataio/pgstream/blob/main/build/docker/docker-compose.yml">docker-compose file</a> from the pgstream repo:</p>
<div role="group"><pre tabindex="0"><code><span><span>git</span><span> clone</span><span> https://github.com/xataio/pgstream.git</span></span>
<span></span></code></pre></div>
<p>And then start the Postgres instance:</p>
<div role="group"><pre tabindex="0"><code><span><span>docker</span><span> compose</span><span> -f</span><span> build/docker/docker-compose.yml</span><span> up</span><span> db</span></span>
<span></span></code></pre></div>
<p>Then, in a new terminal window, you can connect to it and create a simple table to play with:</p>
<div role="group"><pre tabindex="0"><code><span><span>psql</span><span> "postgres://postgres:postgres@localhost:5432/postgres"</span></span>
<span></span></code></pre></div>
<p>At the psql prompt:</p>
<div role="group"><pre tabindex="0"><code><span><span>CREATE</span><span> TABLE</span><span> employees</span><span>(id </span><span>SERIAL</span><span> PRIMARY KEY</span><span>, </span><span>name</span><span> TEXT</span><span>, </span><span>role</span><span> TEXT</span><span>);</span></span>
<span></span></code></pre></div>
<p>Let's now install <code>pgstream</code>. One option is to build it from source, since we already have the repo cloned:</p>

<p>The above assumes you have Go installed. If you don't, check out the other <a href="https://github.com/xataio/pgstream/tree/main?tab=readme-ov-file#installation">installation options</a>.</p>
<p>Next step is to initialize <code>pgstream</code>, like this:</p>
<div role="group"><pre tabindex="0"><code><span><span>./pgstream</span><span> init</span><span> --pgurl</span><span> "postgres://postgres:postgres@localhost/postgres?sslmode=disable"</span></span>
<span></span></code></pre></div>
<p>This creates several tables managed by pgstream, which are grouped in a schema called <code>pgstream</code>.</p>

<p>The <code>pgstream</code> repo comes with a <code>pg2webhook.env</code> configuration file for this purpose. Its contents are:</p>
<div role="group"><pre tabindex="0"><code><span><span># Listener config</span></span>
<span><span>PGSTREAM_POSTGRES_LISTENER_URL</span><span>=</span><span>"postgres://postgres:postgres@localhost?sslmode=disable"</span></span>
<span></span>
<span><span># Processor config</span></span>
<span><span>PGSTREAM_TRANSLATOR_STORE_POSTGRES_URL</span><span>=</span><span>"postgres://postgres:postgres@localhost?sslmode=disable"</span></span>
<span><span>PGSTREAM_WEBHOOK_SUBSCRIPTION_STORE_URL</span><span>=</span><span>"postgres://postgres:postgres@localhost?sslmode=disable"</span></span>
<span><span>PGSTREAM_WEBHOOK_SUBSCRIPTION_STORE_CACHE_ENABLED</span><span>=</span><span>false</span></span>
<span><span>PGSTREAM_WEBHOOK_SUBSCRIPTION_STORE_CACHE_REFRESH_INTERVAL</span><span>=</span><span>"60s"</span></span>
<span></span></code></pre></div>
<p><code>PGSTREAM_POSTGRES_LISTENER_URL</code> indicates which database the pgstream listener should connect to. <code>PGSTREAM_WEBHOOK_SUBSCRIPTION_STORE_URL</code> is used as a metadata db to store the registered subscriptions and their configuration. In this example, they are both set to the same database, but you can use different databases or instances if you prefer. More details can be found in the <a href="https://github.com/xataio/pgstream/tree/main?tab=readme-ov-file#configuration">readme configuration section</a>.</p>
<p>You are now ready to start <code>pgstream</code> like this:</p>
<div role="group"><pre tabindex="0"><code><span><span>./pgstream</span><span> run</span><span> -c</span><span> pg2webhook.env</span></span>
<span></span></code></pre></div>

<p>We now have pgstream ready to go, but we need something to receive the webhooks. This is normally your application, or a lambda function, or similar. pgstream comes with a sample webhooks listener written in Go. You can start it like this:</p>
<div role="group"><pre tabindex="0"><code><span><span>go</span><span> run</span><span> tools/webhook/webhook_server.go</span></span>
<span></span></code></pre></div>
<p>This starts a server on port 9910 that simply logs any JSON payload that is received under the <code>/webhook</code> path.</p>
<p>Now we have to create a subscription so that <code>pgstream</code> knows to send the webhook to <code>localhost:9910/webhook</code> where the <code>webhook_server.go</code> program is waiting. We do this by calling an API which the webhook module from <code>pgstream</code> serves:</p>
<div role="group"><pre tabindex="0"><code><span><span>curl</span><span> localhost:9900/webhooks/subscribe</span><span> \</span></span>
<span><span>    -H</span><span> "content-type: application/json"</span><span> \</span></span>
<span><span>    -d</span><span> '{"url":"http://localhost:9910/webhook", "schema": "public", "table": "employees"}'</span></span>
<span></span></code></pre></div>
<p>The above adds a line in the <code>pgstream.webhook_subscriptions</code> table, which is maintained by <code>pgstream</code>. You can verify by running via <code>psql</code>:</p>
<div role="group"><pre tabindex="0"><code><span><span>postgres</span><span>=</span><span># </span><span>select</span><span> *</span><span> from</span><span> pgstream.webhook_subscriptions;</span></span>
<span><span>              url</span><span>              | schema_name | table_name | event_types</span></span>
<span><span>-------------------------------+-------------+------------+-------------</span></span>
<span><span> http</span><span>:</span><span>//</span><span>localhost:</span><span>9910</span><span>/</span><span>webhook | public      | employees  |</span></span>
<span><span>(</span><span>1</span><span> row</span><span>)</span></span>
<span></span></code></pre></div>
<p>Notes:</p>
<ul role="list"><li>in the API call above, we subscribe to a particular table. If you'd like to subscribe to all tables in a schema, leave the <code>table</code> key unset.</li><li>you can also subscribe to only some particular event types. To do this, set the <code>event_types</code> key to an array containing the operations you want (<code>I</code> for inserts, <code>U</code> for updates, <code>D</code> for deletes, <code>T</code> for truncates).</li></ul>

<p>With <code>pgstream</code> and the <code>webhooks_server.py</code> started in different consoles, let's run the following SQL via <code>psql</code>:</p>
<div role="group"><pre tabindex="0"><code><span><span>INSERT INTO</span><span> employees(</span><span>name</span><span>,</span><span>role</span><span>) </span><span>VALUES</span><span>(</span><span>'Dwight Schrute'</span><span>, </span><span>'Assistant Regional Manager'</span><span>);</span></span>
<span></span></code></pre></div>
<p>You should see the following printed by the python program:</p>
<div role="group"><pre tabindex="0"><code><span><span>{</span></span>
<span><span>  "Data"</span><span>:</span><span> {</span></span>
<span><span>    "action"</span><span>:</span><span> "I"</span><span>,</span></span>
<span><span>    "timestamp"</span><span>:</span><span> "2024-08-20 13:57:16.806107+00"</span><span>,</span></span>
<span><span>    "lsn"</span><span>:</span><span> "0/15F1D60"</span><span>,</span></span>
<span><span>    "schema"</span><span>:</span><span> "public"</span><span>,</span></span>
<span><span>    "table"</span><span>:</span><span> "employees"</span><span>,</span></span>
<span><span>    "columns"</span><span>:</span><span> [</span></span>
<span><span>      {</span></span>
<span><span>        "id"</span><span>:</span><span> "cr2a0enjc0j00h93rdj0-1"</span><span>,</span></span>
<span><span>        "name"</span><span>:</span><span> "id"</span><span>,</span></span>
<span><span>        "type"</span><span>:</span><span> "integer"</span><span>,</span></span>
<span><span>        "value"</span><span>:</span><span> 1</span></span>
<span><span>      }</span><span>,</span></span>
<span><span>      {</span></span>
<span><span>        "id"</span><span>:</span><span> "cr2a0enjc0j00h93rdj0-2"</span><span>,</span></span>
<span><span>        "name"</span><span>:</span><span> "name"</span><span>,</span></span>
<span><span>        "type"</span><span>:</span><span> "text"</span><span>,</span></span>
<span><span>        "value"</span><span>:</span><span> "Dwight Schrute"</span></span>
<span><span>      }</span><span>,</span></span>
<span><span>      {</span></span>
<span><span>        "id"</span><span>:</span><span> "cr2a0enjc0j00h93rdj0-3"</span><span>,</span></span>
<span><span>        "name"</span><span>:</span><span> "role"</span><span>,</span></span>
<span><span>        "type"</span><span>:</span><span> "text"</span><span>,</span></span>
<span><span>        "value"</span><span>:</span><span> "Assistant Regional Manager"</span></span>
<span><span>      }</span></span>
<span><span>    ]</span><span>,</span></span>
<span><span>    "identity"</span><span>:</span><span> null</span><span>,</span></span>
<span><span>    "metadata"</span><span>:</span><span> {</span></span>
<span><span>      "schema_id"</span><span>:</span><span> "cr2a0enjc0j00h93rdig"</span><span>,</span></span>
<span><span>      "table_pgstream_id"</span><span>:</span><span> "cr2a0enjc0j00h93rdj0"</span><span>,</span></span>
<span><span>      "id_col_pgstream_id"</span><span>:</span><span> [</span><span>"cr2a0enjc0j00h93rdj0-1"</span><span>]</span><span>,</span></span>
<span><span>      "version_col_pgstream_id"</span><span>:</span><span> ""</span></span>
<span><span>    }</span></span>
<span><span>  }</span></span>
<span><span>}</span></span>
<span></span></code></pre></div>
<p>Things to note in the above:</p>
<ul role="list"><li>The "action" is <code>I</code> for "insert".</li><li>The LSN (Log Sequence Number) is included. This is a unique and sorted value generated by Postgres, which you can use to order the events in case they are processed out of order.</li><li>Each column is included with their name, type, new value, and an ID generated by pgstream (e.g. <code>cr2a0enjc0j00h93rdj0-2</code> for the <code>name</code> column). This ID is unique for each column and can be used to follow columns across renames.</li></ul>

<p>Now let's run an update statement:</p>
<div role="group"><pre tabindex="0"><code><span><span>UPDATE</span><span> employees </span><span>SET</span><span> role=</span><span>'Assistant to the Regional Manager'</span><span> WHERE</span><span> name=</span><span>'Dwight Schrute'</span><span>;</span></span>
<span></span></code></pre></div>
<p>The following webhook event is received:</p>
<div role="group"><pre tabindex="0"><code><span><span>{</span></span>
<span><span>  "Data"</span><span>:</span><span> {</span></span>
<span><span>    "action"</span><span>:</span><span> "U"</span><span>,</span></span>
<span><span>    "timestamp"</span><span>:</span><span> "2024-08-20 14:01:28.86832+00"</span><span>,</span></span>
<span><span>    "lsn"</span><span>:</span><span> "0/15F1FB8"</span><span>,</span></span>
<span><span>    "schema"</span><span>:</span><span> "public"</span><span>,</span></span>
<span><span>    "table"</span><span>:</span><span> "employees"</span><span>,</span></span>
<span><span>    "columns"</span><span>:</span><span> [</span></span>
<span><span>      {</span></span>
<span><span>        "id"</span><span>:</span><span> "cr2a0enjc0j00h93rdj0-1"</span><span>,</span></span>
<span><span>        "name"</span><span>:</span><span> "id"</span><span>,</span></span>
<span><span>        "type"</span><span>:</span><span> "integer"</span><span>,</span></span>
<span><span>        "value"</span><span>:</span><span> 1</span></span>
<span><span>      }</span><span>,</span></span>
<span><span>      {</span></span>
<span><span>        "id"</span><span>:</span><span> "cr2a0enjc0j00h93rdj0-2"</span><span>,</span></span>
<span><span>        "name"</span><span>:</span><span> "name"</span><span>,</span></span>
<span><span>        "type"</span><span>:</span><span> "text"</span><span>,</span></span>
<span><span>        "value"</span><span>:</span><span> "Dwight Schrute"</span></span>
<span><span>      }</span><span>,</span></span>
<span><span>      {</span></span>
<span><span>        "id"</span><span>:</span><span> "cr2a0enjc0j00h93rdj0-3"</span><span>,</span></span>
<span><span>        "name"</span><span>:</span><span> "role"</span><span>,</span></span>
<span><span>        "type"</span><span>:</span><span> "text"</span><span>,</span></span>
<span><span>        "value"</span><span>:</span><span> "Assistant to the Regional Manager"</span></span>
<span><span>      }</span></span>
<span><span>    ]</span><span>,</span></span>
<span><span>    "identity"</span><span>:</span><span> [</span></span>
<span><span>      {</span></span>
<span><span>        "id"</span><span>:</span><span> "cr2a0enjc0j00h93rdj0-1"</span><span>,</span></span>
<span><span>        "name"</span><span>:</span><span> "id"</span><span>,</span></span>
<span><span>        "type"</span><span>:</span><span> "integer"</span><span>,</span></span>
<span><span>        "value"</span><span>:</span><span> 1</span></span>
<span><span>      }</span></span>
<span><span>    ]</span><span>,</span></span>
<span><span>    "metadata"</span><span>:</span><span> {</span></span>
<span><span>      "schema_id"</span><span>:</span><span> "cr2a0enjc0j00h93rdig"</span><span>,</span></span>
<span><span>      "table_pgstream_id"</span><span>:</span><span> "cr2a0enjc0j00h93rdj0"</span><span>,</span></span>
<span><span>      "id_col_pgstream_id"</span><span>:</span><span> [</span><span>"cr2a0enjc0j00h93rdj0-1"</span><span>]</span><span>,</span></span>
<span><span>      "version_col_pgstream_id"</span><span>:</span><span> ""</span></span>
<span><span>    }</span></span>
<span><span>  }</span></span>
<span><span>}</span></span>
<span></span></code></pre></div>
<p>The above is very similar to the INSERT event, with a couple of differences:</p>
<ul role="list"><li>The "action" is set to <code>U</code>, for update</li><li>The <code>identity</code> sub-object is now filled. It contains the primary key of the affected row. Notably, this is the value of the primary key <strong>before the update</strong>, in case the update has changed the value of the PK.</li></ul>

<p>How about including the old values in addition to the new values for UPDATEs? Yes, that's possible, using a little trick.</p>
<p>See how in the above UPDATE event, the "identity" contains the PK value, and we noted that this is the PK value <strong>before the update</strong>? That is because the "replica identity" for the table is set to "primary key", which is the default. However, the replica identity can be set to any unique group of columns, or to "all columns" by setting it to FULL:</p>
<div role="group"><pre tabindex="0"><code><span><span>ALTER</span><span> TABLE</span><span> employees </span><span>REPLICA</span><span> IDENTITY</span><span> FULL;</span></span>
<span></span></code></pre></div>
<p>If we run the update again:</p>
<div role="group"><pre tabindex="0"><code><span><span>UPDATE</span><span> employees </span><span>SET</span><span> role=</span><span>'Assistant Regional Manager'</span><span> WHERE</span><span> name=</span><span>'Dwight Schrute'</span><span>;</span></span>
<span></span></code></pre></div>
<p>We now get all values after the update, but also before the update, under the <code>identity</code> field:</p>
<div role="group"><pre tabindex="0"><code><span><span>{</span></span>
<span><span>  "Data"</span><span>:</span><span> {</span></span>
<span><span>    "action"</span><span>:</span><span> "U"</span><span>,</span></span>
<span><span>    "timestamp"</span><span>:</span><span> "2024-08-20 17:50:50.503662+00"</span><span>,</span></span>
<span><span>    "lsn"</span><span>:</span><span> "0/15F65F0"</span><span>,</span></span>
<span><span>    "schema"</span><span>:</span><span> "public"</span><span>,</span></span>
<span><span>    "table"</span><span>:</span><span> "employees"</span><span>,</span></span>
<span><span>    "columns"</span><span>:</span><span> [</span></span>
<span><span>      {</span></span>
<span><span>        "id"</span><span>:</span><span> "cr2a0enjc0j00h93rdj0-1"</span><span>,</span></span>
<span><span>        "name"</span><span>:</span><span> "id"</span><span>,</span></span>
<span><span>        "type"</span><span>:</span><span> "integer"</span><span>,</span></span>
<span><span>        "value"</span><span>:</span><span> 1</span></span>
<span><span>      }</span><span>,</span></span>
<span><span>      {</span></span>
<span><span>        "id"</span><span>:</span><span> "cr2a0enjc0j00h93rdj0-2"</span><span>,</span></span>
<span><span>        "name"</span><span>:</span><span> "name"</span><span>,</span></span>
<span><span>        "type"</span><span>:</span><span> "text"</span><span>,</span></span>
<span><span>        "value"</span><span>:</span><span> "Dwight Schrute"</span></span>
<span><span>      }</span><span>,</span></span>
<span><span>      {</span></span>
<span><span>        "id"</span><span>:</span><span> "cr2a0enjc0j00h93rdj0-3"</span><span>,</span></span>
<span><span>        "name"</span><span>:</span><span> "role"</span><span>,</span></span>
<span><span>        "type"</span><span>:</span><span> "text"</span><span>,</span></span>
<span><span>        "value"</span><span>:</span><span> "Assistant Regional Manager"</span></span>
<span><span>      }</span></span>
<span><span>    ]</span><span>,</span></span>
<span><span>    "identity"</span><span>:</span><span> [</span></span>
<span><span>      {</span></span>
<span><span>        "id"</span><span>:</span><span> "cr2a0enjc0j00h93rdj0-1"</span><span>,</span></span>
<span><span>        "name"</span><span>:</span><span> "id"</span><span>,</span></span>
<span><span>        "type"</span><span>:</span><span> "integer"</span><span>,</span></span>
<span><span>        "value"</span><span>:</span><span> 1</span></span>
<span><span>      }</span><span>,</span></span>
<span><span>      {</span></span>
<span><span>        "id"</span><span>:</span><span> "cr2a0enjc0j00h93rdj0-2"</span><span>,</span></span>
<span><span>        "name"</span><span>:</span><span> "name"</span><span>,</span></span>
<span><span>        "type"</span><span>:</span><span> "text"</span><span>,</span></span>
<span><span>        "value"</span><span>:</span><span> "Dwight Schrute"</span></span>
<span><span>      }</span><span>,</span></span>
<span><span>      {</span></span>
<span><span>        "id"</span><span>:</span><span> "cr2a0enjc0j00h93rdj0-3"</span><span>,</span></span>
<span><span>        "name"</span><span>:</span><span> "role"</span><span>,</span></span>
<span><span>        "type"</span><span>:</span><span> "text"</span><span>,</span></span>
<span><span>        "value"</span><span>:</span><span> "Assistant to the Regional Manager"</span></span>
<span><span>      }</span></span>
<span><span>    ]</span><span>,</span></span>
<span><span>    "metadata"</span><span>:</span><span> {</span></span>
<span><span>      "schema_id"</span><span>:</span><span> "cr2ae77jc0j00h93rdjg"</span><span>,</span></span>
<span><span>      "table_pgstream_id"</span><span>:</span><span> "cr2a0enjc0j00h93rdj0"</span><span>,</span></span>
<span><span>      "id_col_pgstream_id"</span><span>:</span><span> [</span><span>"cr2a0enjc0j00h93rdj0-1"</span><span>]</span><span>,</span></span>
<span><span>      "version_col_pgstream_id"</span><span>:</span><span> ""</span></span>
<span><span>    }</span></span>
<span><span>  }</span></span>
<span><span>}</span></span>
<span></span></code></pre></div>

<p>Let's try a simple delete as well:</p>
<div role="group"><pre tabindex="0"><code><span><span>DELETE</span><span> FROM</span><span> employees </span><span>WHERE</span><span> name=</span><span>'Dwight Schrute'</span><span>;</span></span>
<span></span></code></pre></div>
<p>The generated event:</p>
<div role="group"><pre tabindex="0"><code><span><span>{</span></span>
<span><span>  "Data"</span><span>:</span><span> {</span></span>
<span><span>    "action"</span><span>:</span><span> "D"</span><span>,</span></span>
<span><span>    "timestamp"</span><span>:</span><span> "2024-08-21 15:31:55.992618+00"</span><span>,</span></span>
<span><span>    "lsn"</span><span>:</span><span> "0/163CEC8"</span><span>,</span></span>
<span><span>    "schema"</span><span>:</span><span> "public"</span><span>,</span></span>
<span><span>    "table"</span><span>:</span><span> "employees"</span><span>,</span></span>
<span><span>    "columns"</span><span>:</span><span> null</span><span>,</span></span>
<span><span>    "identity"</span><span>:</span><span> [</span></span>
<span><span>      {</span></span>
<span><span>        "id"</span><span>:</span><span> "cr2a0enjc0j00h93rdj0-1"</span><span>,</span></span>
<span><span>        "name"</span><span>:</span><span> "id"</span><span>,</span></span>
<span><span>        "type"</span><span>:</span><span> "integer"</span><span>,</span></span>
<span><span>        "value"</span><span>:</span><span> 1</span></span>
<span><span>      }</span><span>,</span></span>
<span><span>      {</span></span>
<span><span>        "id"</span><span>:</span><span> "cr2a0enjc0j00h93rdj0-2"</span><span>,</span></span>
<span><span>        "name"</span><span>:</span><span> "name"</span><span>,</span></span>
<span><span>        "type"</span><span>:</span><span> "text"</span><span>,</span></span>
<span><span>        "value"</span><span>:</span><span> "Dwight Schrute"</span></span>
<span><span>      }</span><span>,</span></span>
<span><span>      {</span></span>
<span><span>        "id"</span><span>:</span><span> "cr2a0enjc0j00h93rdj0-3"</span><span>,</span></span>
<span><span>        "name"</span><span>:</span><span> "role"</span><span>,</span></span>
<span><span>        "type"</span><span>:</span><span> "text"</span><span>,</span></span>
<span><span>        "value"</span><span>:</span><span> "Assistant Regional Manager"</span></span>
<span><span>      }</span><span>,</span></span>
<span><span>      {</span></span>
<span><span>        "id"</span><span>:</span><span> "cr2a0enjc0j00h93rdj0-4"</span><span>,</span></span>
<span><span>        "name"</span><span>:</span><span> "last_name"</span><span>,</span></span>
<span><span>        "type"</span><span>:</span><span> "text"</span><span>,</span></span>
<span><span>        "value"</span><span>:</span><span> null</span></span>
<span><span>      }</span></span>
<span><span>    ]</span><span>,</span></span>
<span><span>    "metadata"</span><span>:</span><span> {</span></span>
<span><span>      "schema_id"</span><span>:</span><span> "cr2r0lvjc0j00h93rdn0"</span><span>,</span></span>
<span><span>      "table_pgstream_id"</span><span>:</span><span> "cr2a0enjc0j00h93rdj0"</span><span>,</span></span>
<span><span>      "id_col_pgstream_id"</span><span>:</span><span> [</span><span>"cr2a0enjc0j00h93rdj0-1"</span><span>]</span><span>,</span></span>
<span><span>      "version_col_pgstream_id"</span><span>:</span><span> ""</span></span>
<span><span>    }</span></span>
<span><span>  }</span></span>
<span><span>}</span></span>
<span></span></code></pre></div>
<p>To note:</p>
<ul role="list"><li>The "action" key is set to <code>D</code>, for "delete"</li><li>The full row is included in the <code>identity</code> object. That is because we have the replicate identity set to FULL, otherwise only the PK would have been included.</li></ul>

<p>Setting the replica identity to full accomplishes one more thing: it includes the large values in the webhook events.</p>
<p>Postgres values over the page size (commonly 8k, after compression) are stored separately from the main table data in <a href="https://www.postgresql.org/docs/current/storage-toast.html">TOAST storage</a>. This means they are also not included in the logical replication events by default, unless they are changed by the current UPDATE statement. This is a gotcha: you are expecting all columns to always be present, but once they reach a certain size they will be missing.</p>
<p>However, setting the replica identity to <code>full</code> solves this. To test this, try the following:</p>
<div role="group"><pre tabindex="0"><code><span><span>-- set the identity back to be just PK</span></span>
<span><span>ALTER</span><span> TABLE</span><span> employees </span><span>REPLICA</span><span> IDENTITY</span><span> DEFAULT</span><span>;</span></span>
<span></span>
<span><span>-- set the role column to a large value.</span></span>
<span><span>-- This will be in the event because the role column is modified</span></span>
<span><span>UPDATE</span><span> employees </span><span>SET</span><span> role=</span><span>(</span></span>
<span><span>    SELECT</span><span> string_agg</span><span>(generate_series::</span><span>text</span><span>, </span><span>' '</span><span>) </span><span>FROM</span><span> generate_series</span><span>(</span><span>0</span><span>, </span><span>8000</span><span>)</span></span>
<span><span>    ) </span><span>WHERE</span><span> name=</span><span>'Dwight Schrute'</span><span>;</span></span>
<span></span>
<span><span>-- change another column.</span></span>
<span><span>-- This time the role column is not present because it's TOASTed</span></span>
<span><span>UPDATE</span><span> employees </span><span>SET</span><span> name=</span><span>'Jim Halpert'</span><span> WHERE</span><span> name=</span><span>'Dwight Schrute'</span><span>;</span></span>
<span></span>
<span><span>-- set the identity to FULL</span></span>
<span><span>ALTER</span><span> TABLE</span><span> employees </span><span>REPLICA</span><span> IDENTITY</span><span> FULL;</span></span>
<span></span>
<span><span>-- try the update again, this time the value is included in the event.</span></span>
<span><span>UPDATE</span><span> employees </span><span>SET</span><span> name=</span><span>'Dwight Schrute'</span><span> WHERE</span><span> name=</span><span>'Jim Halpert'</span><span>;</span></span>
<span></span></code></pre></div>
<p>Note, however, that the TOASTed value is included only in the <code>identity</code> part of the event, so your application needs to pick it up from there.</p>
<p>At this point, you might be wondering what are the downsides of setting the replica identity to full. Luckily, we wrote a <a href="https://xata.io/blog/replica-identity-full-performance">full blog post about that</a>. In short: there are some performance impacts, more relevant for the Postgres to Postgres replication use case and less relevant for the webhooks calling use case.</p>

<p>Let's look at one more pgstream trick: receiving webhooks for schema changes, in addition to data changes.</p>
<p>Postgres replication events have the well-known limitation that they don't include any schema changes. This can be an issue if your application requires having an up-to-date view of the schema.</p>
<p>pgstream works around this limitation by installing <a href="https://wiki.postgresql.org/wiki/Event_Triggers">DDL event triggers</a> and maintaining the list of changes in a separate table, called <code>pgstream.schema_log</code>. Then, pgstream can subscribe to this table just like any other table.</p>
<p>To get schema events, we create another subscription pointing to the same webhooks listener server as before:</p>
<div role="group"><pre tabindex="0"><code><span><span>curl</span><span> localhost:9900/webhooks/subscribe</span><span> \</span></span>
<span><span>  -H</span><span> "content-type: application/json"</span><span> \</span></span>
<span><span>  -d</span><span> '{"url":"http://localhost:9910/webhook", "schema": "pgstream", "table": "schema_log"}'</span></span>
<span></span></code></pre></div>
<p>Now if we do a schema change:</p>
<div role="group"><pre tabindex="0"><code><span><span>ALTER</span><span> TABLE</span><span> employees </span><span>ADD</span><span> COLUMN first_name </span><span>TEXT</span><span>;</span></span>
<span></span></code></pre></div>
<p>We get an event like this:</p>
<div role="group"><pre tabindex="0"><code><span><span>{</span></span>
<span><span>  "Data"</span><span>:</span><span> {</span></span>
<span><span>    "action"</span><span>:</span><span> "I"</span><span>,</span></span>
<span><span>    "timestamp"</span><span>:</span><span> "2024-08-21 09:10:07.940957+00"</span><span>,</span></span>
<span><span>    "lsn"</span><span>:</span><span> "0/16240F8"</span><span>,</span></span>
<span><span>    "schema"</span><span>:</span><span> "pgstream"</span><span>,</span></span>
<span><span>    "table"</span><span>:</span><span> "schema_log"</span><span>,</span></span>
<span><span>    "columns"</span><span>:</span><span> [</span></span>
<span><span>      {</span></span>
<span><span>        "id"</span><span>:</span><span> ""</span><span>,</span></span>
<span><span>        "name"</span><span>:</span><span> "id"</span><span>,</span></span>
<span><span>        "type"</span><span>:</span><span> "pgstream.xid"</span><span>,</span></span>
<span><span>        "value"</span><span>:</span><span> "cr2qtrvjc0j00h93rdmg"</span></span>
<span><span>      }</span><span>,</span></span>
<span><span>      {</span></span>
<span><span>        "id"</span><span>:</span><span> ""</span><span>,</span></span>
<span><span>        "name"</span><span>:</span><span> "version"</span><span>,</span></span>
<span><span>        "type"</span><span>:</span><span> "bigint"</span><span>,</span></span>
<span><span>        "value"</span><span>:</span><span> 11</span></span>
<span><span>      }</span><span>,</span></span>
<span><span>      {</span></span>
<span><span>        "id"</span><span>:</span><span> ""</span><span>,</span></span>
<span><span>        "name"</span><span>:</span><span> "schema_name"</span><span>,</span></span>
<span><span>        "type"</span><span>:</span><span> "text"</span><span>,</span></span>
<span><span>        "value"</span><span>:</span><span> "public"</span></span>
<span><span>      }</span><span>,</span></span>
<span><span>      {</span></span>
<span><span>        "id"</span><span>:</span><span> ""</span><span>,</span></span>
<span><span>        "name"</span><span>:</span><span> "schema"</span><span>,</span></span>
<span><span>        "type"</span><span>:</span><span> "jsonb"</span><span>,</span></span>
<span><span>        "value"</span><span>:</span><span> "{\"tables\": [{\"oid\": \"16480\", \"name\": \"employees\", \"columns\": [{\"name\": \"first_name\", \"type\": \"text\", \"unique\": false, \"default\": null, \"metadata\": null, \"nullable\": true, \"pgstream_id\": \"cr2a0enjc0j00h93rdj0-4\"}, {\"name\": \"name\", \"type\": \"text\", \"unique\": false, \"default\": null, \"metadata\": null, \"nullable\": true, \"pgstream_id\": \"cr2a0enjc0j00h93rdj0-2\"}, {\"name\": \"role\", \"type\": \"text\", \"unique\": false, \"default\": null, \"metadata\": null, \"nullable\": true, \"pgstream_id\": \"cr2a0enjc0j00h93rdj0-3\"}, {\"name\": \"id\", \"type\": \"integer\", \"unique\": true, \"default\": \"nextval('public.employees_id_seq'::regclass)\", \"metadata\": null, \"nullable\": false, \"pgstream_id\": \"cr2a0enjc0j00h93rdj0-1\"}], \"pgstream_id\": \"cr2a0enjc0j00h93rdj0\", \"primary_key_columns\": [\"id\"]}, {\"oid\": \"16472\", \"name\": \"webhook_subscriptions\", \"columns\": [{\"name\": \"url\", \"type\": \"text\", \"unique\": false, \"default\": null, \"metadata\": null, \"nullable\": false, \"pgstream_id\": \"cr29p2vjc0j00i13rdhg-1\"}, {\"name\": \"schema_name\", \"type\": \"text\", \"unique\": false, \"default\": null, \"metadata\": null, \"nullable\": false, \"pgstream_id\": \"cr29p2vjc0j00i13rdhg-2\"}, {\"name\": \"table_name\", \"type\": \"text\", \"unique\": false, \"default\": null, \"metadata\": null, \"nullable\": false, \"pgstream_id\": \"cr29p2vjc0j00i13rdhg-3\"}, {\"name\": \"event_types\", \"type\": \"text[]\", \"unique\": false, \"default\": null, \"metadata\": null, \"nullable\": true, \"pgstream_id\": \"cr29p2vjc0j00i13rdhg-4\"}], \"pgstream_id\": \"cr29p2vjc0j00i13rdhg\", \"primary_key_columns\": [\"url\", \"schema_name\", \"table_name\"]}]}"</span></span>
<span><span>      }</span><span>,</span></span>
<span><span>      {</span></span>
<span><span>        "id"</span><span>:</span><span> ""</span><span>,</span></span>
<span><span>        "name"</span><span>:</span><span> "created_at"</span><span>,</span></span>
<span><span>        "type"</span><span>:</span><span> "timestamp without time zone"</span><span>,</span></span>
<span><span>        "value"</span><span>:</span><span> "2024-08-21 09:10:07.909214"</span></span>
<span><span>      }</span><span>,</span></span>
<span><span>      {</span></span>
<span><span>        "id"</span><span>:</span><span> ""</span><span>,</span></span>
<span><span>        "name"</span><span>:</span><span> "acked"</span><span>,</span></span>
<span><span>        "type"</span><span>:</span><span> "boolean"</span><span>,</span></span>
<span><span>        "value"</span><span>:</span><span> false</span></span>
<span><span>      }</span></span>
<span><span>    ]</span><span>,</span></span>
<span><span>    "identity"</span><span>:</span><span> null</span><span>,</span></span>
<span><span>    "metadata"</span><span>:</span><span> {</span></span>
<span><span>      "schema_id"</span><span>:</span><span> null</span><span>,</span></span>
<span><span>      "table_pgstream_id"</span><span>:</span><span> ""</span><span>,</span></span>
<span><span>      "id_col_pgstream_id"</span><span>:</span><span> null</span><span>,</span></span>
<span><span>      "version_col_pgstream_id"</span><span>:</span><span> ""</span></span>
<span><span>    }</span></span>
<span><span>  }</span></span>
<span><span>}</span></span>
<span></span></code></pre></div>
<p>The event is more complex, but if you look under the <code>schema</code> column value, you see the newly added column:</p>
<div role="group"><pre tabindex="0"><code><span><span>{</span></span>
<span><span>  "name"</span><span>:</span><span> "first_name"</span><span>,</span></span>
<span><span>  "type"</span><span>:</span><span> "text"</span><span>,</span></span>
<span><span>  "unique"</span><span>:</span><span> false</span><span>,</span></span>
<span><span>  "default"</span><span>:</span><span> null</span><span>,</span></span>
<span><span>  "metadata"</span><span>:</span><span> null</span><span>,</span></span>
<span><span>  "nullable"</span><span>:</span><span> true</span><span>,</span></span>
<span><span>  "pgstream_id"</span><span>:</span><span> "cr2a0enjc0j00h93rdj0-4"</span></span>
<span><span>}</span></span>
<span></span></code></pre></div>
<p>Note how you get not only the name and the type of the column, but also metadata information (is nullable, is unique, default value).</p>
<p>Also, the <code>pgstream_id</code> value is unique and fixed for this column, regardless of the name. You can verify this by performing a rename:</p>
<div role="group"><pre tabindex="0"><code><span><span>ALTER</span><span> TABLE</span><span> employees RENAME COLUMN first_name </span><span>TO</span><span> last_name;</span></span>
<span></span></code></pre></div>

<p>In this guide, we demonstrated how to set up and trigger webhooks based on data changes in a PostgreSQL database using <code>pgstream</code>. We covered the initial setup, webhook configuration, and handling basic operations like inserts, updates, and deletes.</p>
<p><code>pgstream</code> also offers advanced capabilities, such as sending both old and new values during updates and managing schema changes. By integrating <code>pgstream</code> into your PostgreSQL environment, you can automate workflows, trigger real-time notifications, and build more responsive applications, whether for data synchronization, auditing, or microservices communication.</p>
<p>If you have any questions or hit issues with this tutorial, please open an issue in the <a href="https://github.com/xataio/pgstream">pgstream repo</a> or join us in <a href="https://xata.io/discord">Discord</a>.</p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Einstein's Other Theory of Everything (165 pts)]]></title>
            <link>https://nautil.us/einsteins-other-theory-of-everything-823245/</link>
            <guid>41415647</guid>
            <pubDate>Sun, 01 Sep 2024 10:09:15 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://nautil.us/einsteins-other-theory-of-everything-823245/">https://nautil.us/einsteins-other-theory-of-everything-823245/</a>, See on <a href="https://news.ycombinator.com/item?id=41415647">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
                        
            <p><span>E</span>instein finished his masterwork, the theory of general relativity, in 1915. He was 37 years old and would live for another 40 years. He spent these decades in the attempt to explain that everything—matter, energy, and even ourselves—were simply deformations of spacetime.&nbsp;</p><p>Einstein, feeling that his theory of general relativity was incomplete, wanted to develop a unified field theory—a framework that would combine space and time with energy and matter. (Indeed, it was Einstein who coined the term “unified theory.”) He ultimately failed. But I have begun to wonder if his idea, as ambitious as it was startling, isn’t worth revisiting.</p>
      
    <p>Einstein built his unified theory off of general relativity, which says that gravity is a property of spacetime. This is often depicted with a marble that weighs down a rubber sheet. The rubber sheet is spacetime, the marble’s mass provides gravity. If a smaller marble rolls by the larger one, it will not roll in a straight line. It will roll in a curve as if it was attracted to the bigger marble. You need that marble to cause the curvature in the first place. It’s the same in Einstein’s general relativity: You need spacetime <em>and</em> matter in it to describe what we see happening in the universe.</p><p>Einstein seems to have tried to find a theory in which there is <em>only</em> spacetime and <em>no</em> matter—and in which we only interpret some of the spacetime as matter. He wanted to find equations that would have solutions that correspond to the fundamental particles of nature, such as electrons.</p>
          <blockquote>
<p>Einstein and Rosen assumed the black hole has no inside and instead connects two universes.</p>
</blockquote><p>When Einstein set out to find this theory, in the first half of the 20th century, physicists’ knowledge of the properties of matter and how it behaved were incomplete. Today, we know of four fundamental interactions. Beside gravity, there’s electromagnetism and the strong and weak nuclear interactions. But in the early 20th century, the strong nuclear interaction had not yet been discovered, and the theory for the weak nuclear interaction had not yet been developed. Einstein therefore really only had two interactions to work with to make sense of matter: gravity and electromagnetism. The gravitational force law, also known as Newton’s law, is similar to that for electric charges, known as Coulomb’s law. And because Einstein had been so successful with describing gravity as the curvature of space, he wondered whether electromagnetism could be described in much the same way.</p><p>In 1919, Einstein published a <a href="https://einsteinpapers.press.princeton.edu/vol7-trans/96" target="_blank" rel="noreferrer noopener">paper</a> titled “Do gravitational fields play an essential role in the structure of the elementary particles of matter?” The idea he pursued in the paper was to take a modified version of general relativity, with different field equations, then add electromagnetism and ask whether this would give rise to solutions that could be interpreted as particles.</p><p>The conclusion he arrived at is: No, this doesn’t work because the quantity that could be interpreted as mass could take on any value, whereas the particles that matter are made of have very specific values.</p>
          <p>In 1923, he published another paper in which he basically said that his previous idea to make matter from spacetime didn’t work because there were some equations missing. He then proposed some equations that might do the job … but again concluded that this doesn’t work</p><p>In 1925, he published yet <em>another</em> paper in which he said that he had been trying for two years to combine electromagnetism with gravity, and it didn’t work.&nbsp;</p><p>But Einstein had another clue for his unified theory: black holes.</p><p>You see, as soon as Einstein had finished his theory of general relativity, the German physicist and astronomer Karl Schwarzschild discovered a solution to Einstein’s equations that described what we now call black holes. But this solution has singularities, places where some quantities take on infinite values. Einstein thought that this couldn’t be right. Singularities shouldn’t happen in reality. And if his theory allowed those, then there was something wrong with it. He therefore tried to use the requirement that singularities should be absent to go back and find solutions that would describe elementary particles.</p>
          <p>But he made a mistake there. In Schwarzschild’s black hole solution, there isn’t just one singularity, but two. One is at the horizon of the black hole, the other in the center. We know today that the singularity at the horizon does not correspond to any physically measurable quantity. It’s a mathematical artifact that can be removed. Einstein tried to find a way to remove this singularity that wasn’t there. (You’d think that physicists would have learned from this that it’s a mistake to go on about the properties of unobservable quantities, but still, it’s the same mistake that led to all these wrong predictions for the Large Hadron Collider. But I digress.)</p><blockquote>
<p>I want to call this Einstein’s Other Theory of Everything: that matter is really just made of spacetime.</p>
</blockquote><div><p>Einstein’s quest to get rid of black hole singularities is what led to his famous paper with Nathan Rosen in 1935, in which they introduced what is now called an Einstein-Rosen bridge. They assumed the black hole has no inside and instead connects two universes. It’s the simplest known example of a wormhole.</p><p>But they didn’t write the paper to introduce wormholes. Einstein and Rosen thought these wormholes were elementary particles. After they’d constructed their bridge, they wrote very clearly, “We see now in the given solution, free from singularities, the mathematical representation of an elementary particle (neutrons or neutrinos).”</p></div><div><p>They then went on to add electric charges and interpreted those as charged particles. Now, we know today that neutrons are not elementary particles, they are made of smaller particles (quarks and gluons). But this wasn’t the main problem with the idea. The main problem is that one can calculate the size of the bridge, or wormhole, or whatever you want to call it, from its mass. And that’d tell you that the “size” of a neutron would be about 10<sup>-52</sup> centimeters. That’s more than 30 orders of magnitude smaller than its actual size. For other elementary particles, this becomes even more extreme.</p><p>This means that if elementary particles were wormholes or black holes, they would be much smaller than the quantum uncertainty that we measure. (Stephen Hawking also taught us that they’d be unstable, but again, Einstein couldn’t have known this.)</p></div>
          <div><p>In any case, he didn’t pursue this idea further. Instead, he pursued a different direction which he had proposed in 1925: that the properties of matter are encoded in the relations between different locations in spacetime, an approach that he dubbed “tele-parallelism.” It is this tele-parallelism that later became known as Einstein’s unified field theory. It has, however, little to do with his original idea.</p><p>This teleparallel approach to a unified field theory was not pursued after Einstein’s death in 1955. Because by then it had become clear that it wasn’t compatible with the new things that physicists had discovered, such as the weak and strong nuclear forces.</p></div><p>That said, I find it somewhat surprising—and maybe even concerning—that physicists have also thrown out Einstein’s original idea, that I want to call his Other Theory of Everything: that matter is really just made of spacetime, curved in a particular way. The notion has survived in some areas of physics, where such objects are known as “solitons”—or noise-free subsystems—but mostly it’s been given up.&nbsp;</p><p>It has been replaced by a different idea of unification, that matter and spacetime are both made of something else, such as, for example, strings or loops or networks.</p><p>So why am I returning to this old story? Primarily because I think it’s interesting what Einstein, undoubtedly one of the most intelligent people to walk on this planet, did with much of his life. But also because I don’t want Einstein’s idea—about what we and the universe might be made out of—to be forgotten. <img decoding="async" src="https://assets.nautil.us/sites/3/nautilus/nautilus-favicon-14.png?fm=png" alt=""></p>
          <p><em>Lead image: Muhammad suryanto / Shutterstock</em></p>              
                            <ul>
                                      <li>
                      <div>
                        <h6>
                          Sabine Hossenfelder                        </h6>
                        <p>
                          Posted on <time datetime="2024-08-30T10:39:35-05:00">August 30, 2024</time>
                        </p>
                      </div>
                                                <p>
                            Sabine Hossenfelder is a theoretical physicist at the Munich Center for Mathematical Philosophy, in Germany, focusing on modifications of general relativity, phenomenological quantum gravity, and the foundations of quantum mechanics. She is the creative director of the YouTube channel <a href="https://www.youtube.com/channel/UC1yNl2E66ZzKApQdRuTQ4tw">“Science without the gobbledygook”</a> where she talks about recent scientific developments and debunks hype. Her latest book is <i><a href="https://www.penguinrandomhouse.com/books/616868/existential-physics-by-sabine-hossenfelder/">Existential Physics: A Scientist’s Guide to Life’s Biggest Questions</a></i>. Follow her on X (formerly known as Twitter) <a href="https://twitter.com/skdh">@skdh</a>.                          </p>
                                            </li>
                                  </ul>
            <div>
  <p><img src="https://nautil.us/wp-content/themes/nautilus-block-theme/images/icons/logo-icon.svg" alt="new_letter"></p><div>
    <h4>Get the Nautilus newsletter</h4>
    <p>Cutting-edge science, unraveled by the very brightest living thinkers.</p>
  </div>

  
</div>        </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Honey, I shrunk {fmt}: bringing binary size to 14k and ditching the C++ runtime (229 pts)]]></title>
            <link>https://vitaut.net/posts/2024/binary-size/</link>
            <guid>41415238</guid>
            <pubDate>Sun, 01 Sep 2024 08:30:45 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://vitaut.net/posts/2024/binary-size/">https://vitaut.net/posts/2024/binary-size/</a>, See on <a href="https://news.ycombinator.com/item?id=41415238">Hacker News</a></p>
<div id="readability-page-1" class="page"><div v-pre=""><p><img src="https://vitaut.net/img/kennedy.jpg#floatright" alt="" title="We do this not because it is easy, but because we thought it would be easy."></p><p><a href="https://github.com/fmtlib/fmt">The {fmt} formatting library</a> is known for its small binary footprint,
often producing code that is several times smaller per function call compared
to alternatives like IOStreams, Boost Format, or, somewhat ironically,
tinyformat. This is mainly achieved through careful application of type erasure
on various levels, which effectively minimizes template bloat.</p><p>Formatting arguments are passed via type-erased <code>format_args</code>:</p><div><pre tabindex="0"><code data-lang="c++"><span><span><span>auto</span> <span>vformat</span><span>(</span><span>string_view</span> <span>fmt</span><span>,</span> <span>format_args</span> <span>args</span><span>)</span> <span>-&gt;</span> <span>std</span><span>::</span><span>string</span><span>;</span>
</span></span><span><span>
</span></span><span><span><span>template</span> <span>&lt;</span><span>typename</span><span>...</span> <span>T</span><span>&gt;</span>
</span></span><span><span><span>auto</span> <span>format</span><span>(</span><span>format_string</span><span>&lt;</span><span>T</span><span>...</span><span>&gt;</span> <span>fmt</span><span>,</span> <span>T</span><span>&amp;&amp;</span><span>...</span> <span>args</span><span>)</span> <span>-&gt;</span> <span>std</span><span>::</span><span>string</span> <span>{</span>
</span></span><span><span>  <span>return</span> <span>vformat</span><span>(</span><span>fmt</span><span>,</span> <span>fmt</span><span>::</span><span>make_format_args</span><span>(</span><span>args</span><span>...));</span>
</span></span><span><span><span>}</span>
</span></span></code></pre></div><p>As you can see, <code>format</code> delegates all its work to <code>vformat</code>, which is not a
template.</p><p>Output iterators and other output types are also type-erased through a specially
designed buffer API.</p><p>This approach confines template usage to a minimal top-level layer, leading to
both a smaller binary size and <a href="https://vitaut.net/posts/2024/faster-cpp-compile-times/">faster build times</a>.</p><p>For example, the following code:</p><div><pre tabindex="0"><code data-lang="c++"><span><span><span>// test.cc
</span></span></span><span><span><span></span><span>#include</span> <span>&lt;fmt/base.h&gt;</span><span>
</span></span></span><span><span><span></span>
</span></span><span><span><span>int</span> <span>main</span><span>()</span> <span>{</span>
</span></span><span><span>  <span>fmt</span><span>::</span><span>print</span><span>(</span><span>"The answer is {}."</span><span>,</span> <span>42</span><span>);</span>
</span></span><span><span><span>}</span>
</span></span></code></pre></div><p>compiles to just</p><pre tabindex="0"><code>.LC0:
        .string "The answer is {}."
main:
        sub     rsp, 24
        mov     eax, 1
        mov     edi, OFFSET FLAT:.LC0
        mov     esi, 17
        mov     rcx, rsp
        mov     rdx, rax
        mov     DWORD PTR [rsp], 42
        call    fmt::v11::vprint(fmt::v11::basic_string_view&lt;char&gt;, fmt::v11::basic_format_args&lt;fmt::v11::context&gt;)
        xor     eax, eax
        add     rsp, 24
        ret
</code></pre><p><a href="https://godbolt.org/z/PMKdPPnYn">godbolt</a></p><p>It is much smaller than the equivalent IOStreams code and comparable to that
of <code>printf</code>:</p><pre tabindex="0"><code>.LC0:
        .string "The answer is %d."
main:
        sub     rsp, 8
        mov     esi, 42
        mov     edi, OFFSET FLAT:.LC0
        xor     eax, eax
        call    printf
        xor     eax, eax
        add     rsp, 8
        ret
</code></pre><p><a href="https://godbolt.org/z/soTjfno71">godbolt</a></p><p>Unlike <code>printf</code>, {fmt} offers full runtime type safety. Errors in format strings
can be caught at compile time, and even when the format string is determined at
runtime, errors are managed through exceptions, preventing undefined behavior,
memory corruption, and potential crashes. Additionally, {fmt} calls are
generally more efficient, particularly when using positional arguments, which C
varargs are not well-suited for.</p><p>Back in 2020, I dedicated some time to <a href="https://vitaut.net/posts/2020/reducing-library-size/">optimizing the library size</a>,
successfully reducing it to under 100kB (just ~57kB with <code>-Os -flto</code>).
A lot has changed since then. Most notably, {fmt} now uses the exceptional
<a href="https://github.com/jk-jeon/dragonbox">Dragonbox</a> algorithm for floating-point formatting, kindly
contributed by its author, Junekey Jeon. Let’s explore how these changes have
impacted the binary size and see if further reductions are possible.</p><p>But why, some say, the binary size? Why choose this as our goal?</p><p>There has been considerable interest in using {fmt} on memory-constrained
devices, see e.g. <a href="https://github.com/fmtlib/fmt/issues/758">#758</a> and <a href="https://github.com/fmtlib/fmt/issues/1226">#1226</a> for just two examples from
the distant past. A particularly intriguing use case is retro computing, with
people using {fmt} on systems like Amiga (<a href="https://github.com/fmtlib/fmt/issues/4054">#4054</a>).</p><p>We’ll apply the same methodology as in <a href="https://vitaut.net/posts/2020/reducing-library-size/">previous work</a>, examining the
executable size of a program that uses {fmt}, as this is most relevant to end
users. All tests will be conducted on an aarch64 Ubuntu 22.04 system with GCC
11.4.0.</p><p>First, let’s establish the baseline: what is the binary size for the latest
version of {fmt} (11.0.2)?</p><pre tabindex="0"><code>$ git checkout 11.0.2
$ g++ -Os -flto -DNDEBUG -I include test.cc src/format.cc
$ strip a.out &amp;&amp; ls -lh a.out
-rwxrwxr-x 1 vagrant vagrant 75K Aug 30 19:24 a.out
</code></pre><p>The resulting binary size is 75kB (stripped). The positive takeaway is that
despite numerous developments over the past four years, the size has not
significantly regressed.</p><p>Now, let’s explore potential optimizations. One of the first adjustments you
might consider is disabling locale support. All the formatting in {fmt} is
locale-independent by default (which breaks with the C++’s tradition of having
wrong defaults), but it is still available as an opt in via the <code>L</code> format
specifier. It can be disabled in a somewhat obscure way via the
<code>FMT_STATIC_THOUSANDS_SEPARATOR</code> macro:</p><pre tabindex="0"><code>$ g++ -Os -flto -DNDEBUG "-DFMT_STATIC_THOUSANDS_SEPARATOR=','" \
      -I include test.cc src/format.cc
$ strip a.out &amp;&amp; ls -lh a.out
-rwxrwxr-x 1 vagrant vagrant 71K Aug 30 19:25 a.out
</code></pre><p>Disabling locale support reduces the binary size to 71kB.</p><p>Next, let’s examine the results using our trusty tool, <a href="https://github.com/google/bloaty">Bloaty</a>:</p><pre tabindex="0"><code>$ bloaty -d symbols a.out

    FILE SIZE        VM SIZE
 --------------  --------------
  43.8%  41.1Ki  43.6%  29.0Ki    [121 Others]
   6.4%  6.04Ki   8.1%  5.42Ki    fmt::v11::detail::do_write_float&lt;&gt;()
   5.9%  5.50Ki   7.5%  4.98Ki    fmt::v11::detail::write_int_noinline&lt;&gt;()
   5.7%  5.32Ki   5.8%  3.88Ki    fmt::v11::detail::write&lt;&gt;()
   5.4%  5.02Ki   7.2%  4.81Ki    fmt::v11::detail::parse_replacement_field&lt;&gt;()
   3.9%  3.69Ki   3.7%  2.49Ki    fmt::v11::detail::format_uint&lt;&gt;()
   3.2%  3.00Ki   0.0%       0    [section .symtab]
   2.7%  2.50Ki   0.0%       0    [section .strtab]
   2.3%  2.12Ki   2.9%  1.93Ki    fmt::v11::detail::dragonbox::to_decimal&lt;&gt;()
   2.0%  1.89Ki   2.4%  1.61Ki    fmt::v11::detail::write_int&lt;&gt;()
   2.0%  1.88Ki   0.0%       0    [ELF Section Headers]
   1.9%  1.79Ki   2.5%  1.66Ki    fmt::v11::detail::write_float&lt;&gt;()
   1.9%  1.78Ki   2.7%  1.78Ki    [section .dynstr]
   1.8%  1.72Ki   2.4%  1.62Ki    fmt::v11::detail::format_dragon()
   1.8%  1.68Ki   1.5%    1016    fmt::v11::detail::format_decimal&lt;&gt;()
   1.6%  1.52Ki   2.1%  1.41Ki    fmt::v11::detail::format_float&lt;&gt;()
   1.6%  1.49Ki   0.0%       0    [Unmapped]
   1.5%  1.45Ki   2.2%  1.45Ki    [section .dynsym]
   1.5%  1.45Ki   2.0%  1.31Ki    fmt::v11::detail::write_loc()
   1.5%  1.44Ki   2.2%  1.44Ki    [section .rodata]
   1.5%  1.40Ki   1.1%     764    fmt::v11::detail::do_write_float&lt;&gt;()::{lambda()#2}::operator()()
 100.0%  93.8Ki 100.0%  66.6Ki    TOTAL
</code></pre><p>Unsurprisingly, a significant portion of the binary size is dedicated to numeric
formatting, particularly floating-point numbers. FP formatting also relies on
sizable tables, which aren’t shown here. But what if floating-point support
isn’t required? {fmt} provides a way to disable it, though the method is
somewhat ad hoc and doesn’t extend to other types.</p><p>The core issue is that formatting functions need to be aware of all formattable
types. Or do they? This is true for <code>printf</code> as defined by the C standard, but
not necessarily for {fmt}. {fmt} supports an extension API that allows
formatting arbitrary types without knowing the complete set of types in advance.
While built-in and string types are handled specially for performance reasons,
focusing on binary size might warrant a different approach. By removing this
special handling and routing every type through the extension API, you can avoid
paying for types you don’t use.</p><p>I did an experimental <a href="https://github.com/fmtlib/fmt/commit/377cf20">implementation of this idea</a>. With the
<code>FMT_BUILTIN_TYPES</code> macro set to 0, only <code>int</code> is handled specially, and all
other types go through the general extension API. We still need to know about
<code>int</code> for dynamic width and precision, for example</p><div><pre tabindex="0"><code data-lang="c++"><span><span><span>fmt</span><span>::</span><span>print</span><span>(</span><span>"{:{}}</span><span>\n</span><span>"</span><span>,</span> <span>"hello"</span><span>,</span> <span>10</span><span>);</span> <span>// prints "hello     "
</span></span></span></code></pre></div><p>This gives you the “don’t pay for what you don’t use” model, though it comes
with a slight increase in per-call binary size. If you do format floating-point
numbers or other types, the relevant code will still be included in the build.
While it’s possible to make the FP implementation smaller, we won’t delve into
that here.</p><p>With <code>FMT_BUILTIN_TYPES=0</code>, the binary size in our example reduced to 31kB,
representing a substantial improvement:</p><pre tabindex="0"><code>$ git checkout 377cf20
$ g++ -Os -flto -DNDEBUG \
      "-DFMT_STATIC_THOUSANDS_SEPARATOR=','" -DFMT_BUILTIN_TYPES=0 \
      -I include test.cc src/format.cc
$ strip a.out &amp;&amp; ls -lh a.out
-rwxrwxr-x 1 vagrant vagrant 31K Aug 30 19:37 a.out
</code></pre><p>However, the updated Bloaty results reveal some lingering locale artifacts,
such as <code>digit_grouping</code>:</p><pre tabindex="0"><code>$ bloaty -d fullsymbols a.out

    FILE SIZE        VM SIZE
 --------------  --------------
  41.8%  18.0Ki  39.7%  11.0Ki    [84 Others]
   6.4%  2.77Ki   0.0%       0    [section .symtab]
   5.3%  2.28Ki   0.0%       0    [section .strtab]
   4.6%  1.99Ki   6.9%  1.90Ki    fmt::v11::detail::format_handler&lt;char&gt;::on_format_specs(int, char const*, char const*)
   4.4%  1.88Ki   0.0%       0    [ELF Section Headers]
   4.1%  1.78Ki   5.8%  1.61Ki    fmt::v11::basic_appender&lt;char&gt; fmt::v11::detail::write_int_noinline&lt;char, fmt::v11::basic_appender&lt;char&gt;, unsigned int&gt;(fmt::v11::basic_appender&lt;char&gt;, fmt::v11::detail::write_int_arg&lt;unsigned int&gt;, fmt::v11::format_specs const&amp;, fmt::v11::detail::locale_ref) (.constprop.0)
   3.7%  1.60Ki   5.8%  1.60Ki    [section .dynstr]
   3.5%  1.50Ki   4.8%  1.34Ki    void fmt::v11::detail::vformat_to&lt;char&gt;(fmt::v11::detail::buffer&lt;char&gt;&amp;, fmt::v11::basic_string_view&lt;char&gt;, fmt::v11::detail::vformat_args&lt;char&gt;::type, fmt::v11::detail::locale_ref) (.constprop.0)
   3.5%  1.49Ki   4.9%  1.35Ki    fmt::v11::basic_appender&lt;char&gt; fmt::v11::detail::write_int&lt;fmt::v11::basic_appender&lt;char&gt;, unsigned __int128, char&gt;(fmt::v11::basic_appender&lt;char&gt;, unsigned __int128, unsigned int, fmt::v11::format_specs const&amp;, fmt::v11::detail::digit_grouping&lt;char&gt; const&amp;)
   3.1%  1.31Ki   4.7%  1.31Ki    [section .dynsym]
   3.0%  1.29Ki   4.2%  1.15Ki    fmt::v11::basic_appender&lt;char&gt; fmt::v11::detail::write_int&lt;fmt::v11::basic_appender&lt;char&gt;, unsigned long, char&gt;(fmt::v11::basic_appender&lt;char&gt;, unsigned long, unsigned int, fmt::v11::format_specs const&amp;, fmt::v11::detail::digit_grouping&lt;char&gt; const&amp;)
</code></pre><p>After disabling these artifacts in commits <a href="https://github.com/fmtlib/fmt/commit/e582d37">e582d37</a> and
<a href="https://github.com/fmtlib/fmt/commit/b3ccc2d">b3ccc2d</a>, and introducing a more user-friendly option to opt out via
the <code>FMT_USE_LOCALE</code> macro, the binary size drops to 27kB:</p><pre tabindex="0"><code>$ git checkout b3ccc2d
$ g++ -Os -flto -DNDEBUG -DFMT_USE_LOCALE=0 -DFMT_BUILTIN_TYPES=0 \
      -I include test.cc src/format.cc
$ strip a.out &amp;&amp; ls -lh a.out
-rwxrwxr-x 1 vagrant vagrant 27K Aug 30 19:38 a.out
</code></pre><p>The library includes several areas where size is traded off for speed.
For example, consider this function used to compute the number of decimal
digits:</p><div><pre tabindex="0"><code data-lang="c++"><span><span><span>auto</span> <span>do_count_digits</span><span>(</span><span>uint32_t</span> <span>n</span><span>)</span> <span>-&gt;</span> <span>int</span> <span>{</span>
</span></span><span><span><span>// An optimization by Kendall Willets from https://bit.ly/3uOIQrB.
</span></span></span><span><span><span>// This increments the upper 32 bits (log10(T) - 1) when &gt;= T is added.
</span></span></span><span><span><span></span><span>#  define FMT_INC(T) (((sizeof(#T) - 1ull) &lt;&lt; 32) - T)
</span></span></span><span><span><span></span>  <span>static</span> <span>constexpr</span> <span>uint64_t</span> <span>table</span><span>[]</span> <span>=</span> <span>{</span>
</span></span><span><span>      <span>FMT_INC</span><span>(</span><span>0</span><span>),</span>          <span>FMT_INC</span><span>(</span><span>0</span><span>),</span>          <span>FMT_INC</span><span>(</span><span>0</span><span>),</span>           <span>// 8
</span></span></span><span><span><span></span>      <span>FMT_INC</span><span>(</span><span>10</span><span>),</span>         <span>FMT_INC</span><span>(</span><span>10</span><span>),</span>         <span>FMT_INC</span><span>(</span><span>10</span><span>),</span>          <span>// 64
</span></span></span><span><span><span></span>      <span>FMT_INC</span><span>(</span><span>100</span><span>),</span>        <span>FMT_INC</span><span>(</span><span>100</span><span>),</span>        <span>FMT_INC</span><span>(</span><span>100</span><span>),</span>         <span>// 512
</span></span></span><span><span><span></span>      <span>FMT_INC</span><span>(</span><span>1000</span><span>),</span>       <span>FMT_INC</span><span>(</span><span>1000</span><span>),</span>       <span>FMT_INC</span><span>(</span><span>1000</span><span>),</span>        <span>// 4096
</span></span></span><span><span><span></span>      <span>FMT_INC</span><span>(</span><span>10000</span><span>),</span>      <span>FMT_INC</span><span>(</span><span>10000</span><span>),</span>      <span>FMT_INC</span><span>(</span><span>10000</span><span>),</span>       <span>// 32k
</span></span></span><span><span><span></span>      <span>FMT_INC</span><span>(</span><span>100000</span><span>),</span>     <span>FMT_INC</span><span>(</span><span>100000</span><span>),</span>     <span>FMT_INC</span><span>(</span><span>100000</span><span>),</span>      <span>// 256k
</span></span></span><span><span><span></span>      <span>FMT_INC</span><span>(</span><span>1000000</span><span>),</span>    <span>FMT_INC</span><span>(</span><span>1000000</span><span>),</span>    <span>FMT_INC</span><span>(</span><span>1000000</span><span>),</span>     <span>// 2048k
</span></span></span><span><span><span></span>      <span>FMT_INC</span><span>(</span><span>10000000</span><span>),</span>   <span>FMT_INC</span><span>(</span><span>10000000</span><span>),</span>   <span>FMT_INC</span><span>(</span><span>10000000</span><span>),</span>    <span>// 16M
</span></span></span><span><span><span></span>      <span>FMT_INC</span><span>(</span><span>100000000</span><span>),</span>  <span>FMT_INC</span><span>(</span><span>100000000</span><span>),</span>  <span>FMT_INC</span><span>(</span><span>100000000</span><span>),</span>   <span>// 128M
</span></span></span><span><span><span></span>      <span>FMT_INC</span><span>(</span><span>1000000000</span><span>),</span> <span>FMT_INC</span><span>(</span><span>1000000000</span><span>),</span> <span>FMT_INC</span><span>(</span><span>1000000000</span><span>),</span>  <span>// 1024M
</span></span></span><span><span><span></span>      <span>FMT_INC</span><span>(</span><span>1000000000</span><span>),</span> <span>FMT_INC</span><span>(</span><span>1000000000</span><span>)</span>                        <span>// 4B
</span></span></span><span><span><span></span>  <span>};</span>
</span></span><span><span>  <span>auto</span> <span>inc</span> <span>=</span> <span>table</span><span>[</span><span>__builtin_clz</span><span>(</span><span>n</span> <span>|</span> <span>1</span><span>)</span> <span>^</span> <span>31</span><span>];</span>
</span></span><span><span>  <span>return</span> <span>static_cast</span><span>&lt;</span><span>int</span><span>&gt;</span><span>((</span><span>n</span> <span>+</span> <span>inc</span><span>)</span> <span>&gt;&gt;</span> <span>32</span><span>);</span>
</span></span><span><span><span>}</span>
</span></span></code></pre></div><p>The table used here is 256 bytes. There isn’t a one-size-fits-all solution,
and changing it unconditionally might negatively impact other use cases.
Fortunately, we have a fallback implementation of this function for scenarios
where <code>__builtin_clz</code> is unavailable, such as with <code>constexpr</code>:</p><div><pre tabindex="0"><code data-lang="c++"><span><span><span>template</span> <span>&lt;</span><span>typename</span> <span>T</span><span>&gt;</span> <span>constexpr</span> <span>auto</span> <span>count_digits_fallback</span><span>(</span><span>T</span> <span>n</span><span>)</span> <span>-&gt;</span> <span>int</span> <span>{</span>
</span></span><span><span>  <span>int</span> <span>count</span> <span>=</span> <span>1</span><span>;</span>
</span></span><span><span>  <span>for</span> <span>(;;)</span> <span>{</span>
</span></span><span><span>    <span>// Integer division is slow so do it for a group of four digits instead
</span></span></span><span><span><span></span>    <span>// of for every digit. The idea comes from the talk by Alexandrescu
</span></span></span><span><span><span></span>    <span>// "Three Optimization Tips for C++". See speed-test for a comparison.
</span></span></span><span><span><span></span>    <span>if</span> <span>(</span><span>n</span> <span>&lt;</span> <span>10</span><span>)</span> <span>return</span> <span>count</span><span>;</span>
</span></span><span><span>    <span>if</span> <span>(</span><span>n</span> <span>&lt;</span> <span>100</span><span>)</span> <span>return</span> <span>count</span> <span>+</span> <span>1</span><span>;</span>
</span></span><span><span>    <span>if</span> <span>(</span><span>n</span> <span>&lt;</span> <span>1000</span><span>)</span> <span>return</span> <span>count</span> <span>+</span> <span>2</span><span>;</span>
</span></span><span><span>    <span>if</span> <span>(</span><span>n</span> <span>&lt;</span> <span>10000</span><span>)</span> <span>return</span> <span>count</span> <span>+</span> <span>3</span><span>;</span>
</span></span><span><span>    <span>n</span> <span>/=</span> <span>10000u</span><span>;</span>
</span></span><span><span>    <span>count</span> <span>+=</span> <span>4</span><span>;</span>
</span></span><span><span>  <span>}</span>
</span></span><span><span><span>}</span>
</span></span></code></pre></div><p>All that remains is to provide users with control over when to use the fallback
implementation via (you guessed it) another configuration macro,
<code>FMT_OPTIMIZE_SIZE</code>:</p><div><pre tabindex="0"><code data-lang="c++"><span><span><span>auto</span> <span>count_digits</span><span>(</span><span>uint32_t</span> <span>n</span><span>)</span> <span>-&gt;</span> <span>int</span> <span>{</span>
</span></span><span><span><span>#ifdef FMT_BUILTIN_CLZ
</span></span></span><span><span><span></span>  <span>if</span> <span>(</span><span>!</span><span>is_constant_evaluated</span><span>()</span> <span>&amp;&amp;</span> <span>!</span><span>FMT_OPTIMIZE_SIZE</span><span>)</span> <span>return</span> <span>do_count_digits</span><span>(</span><span>n</span><span>);</span>
</span></span><span><span><span>#endif
</span></span></span><span><span><span></span>  <span>return</span> <span>count_digits_fallback</span><span>(</span><span>n</span><span>);</span>
</span></span><span><span><span>}</span>
</span></span></code></pre></div><p>With this and a few similar adjustments, we reduced the binary size to 23kB:</p><pre tabindex="0"><code>$ git checkout 8e3da9d
$ g++ -Os -flto -DNDEBUG -I include \
      -DFMT_USE_LOCALE=0 -DFMT_BUILTIN_TYPES=0 -DFMT_OPTIMIZE_SIZE=1 \
      test.cc src/format.cc
$ strip a.out &amp;&amp; ls -lh a.out
-rwxrwxr-x 1 vagrant vagrant 23K Aug 30 19:41 a.out
</code></pre><p>We could likely reduce the binary size even further with additional tweaks,
but let’s address the elephant in the room which is, of course, the C++ standard
library. What’s the point of optimizing the size when you end up getting
a megabyte or two of the C++ runtime?</p><p>While {fmt} relies minimally on the standard library, is it possible to
remove it completely as a dependency? One obvious problem is exceptions and
those can be disabled via <code>FMT_THROW</code>, e.g. by defining it to <code>abort</code>.
In general it is not recommended but it might be OK for some use cases
especially considering that most errors are caught at compile time.</p><p>Let’s try it out and compile with <code>-nodefaultlibs</code> and exceptions disabled:</p><pre tabindex="0"><code>$ g++ -Os -flto -DNDEBUG -I include \
      -DFMT_USE_LOCALE=0 -DFMT_BUILTIN_TYPES=0 -DFMT_OPTIMIZE_SIZE=1 \
      '-DFMT_THROW(s)=abort()' -fno-exceptions test.cc src/format.cc \
      -nodefaultlibs -lc

/usr/bin/ld: /tmp/cc04DFeK.ltrans0.ltrans.o: in function `fmt::v11::basic_memory_buffer&lt;char, 500ul, std::allocator&lt;char&gt; &gt;::grow(fmt::v11::detail::buffer&lt;char&gt;&amp;, unsigned long)':
&lt;artificial&gt;:(.text+0xaa8): undefined reference to `std::__throw_bad_alloc()'
/usr/bin/ld: &lt;artificial&gt;:(.text+0xab8): undefined reference to `operator new(unsigned long)'
/usr/bin/ld: &lt;artificial&gt;:(.text+0xaf8): undefined reference to `operator delete(void*, unsigned long)'
/usr/bin/ld: /tmp/cc04DFeK.ltrans0.ltrans.o: in function `fmt::v11::vprint_buffered(_IO_FILE*, fmt::v11::basic_string_view&lt;char&gt;, fmt::v11::basic_format_args&lt;fmt::v11::context&gt;) [clone .constprop.0]':
&lt;artificial&gt;:(.text+0x18c4): undefined reference to `operator delete(void*, unsigned long)'
collect2: error: ld returned 1 exit status
</code></pre><p>Amazingly, this approach mostly works. The only remaining dependency on the C++
runtime comes from <code>fmt::basic_memory_buffer</code>, which is a small stack-allocated
buffer that can grow into dynamic memory if necessary.</p><p><code>fmt::print</code> can write directly into the <code>FILE</code> buffer and generally
doesn’t require dynamic allocation. So we could remove the dependency on
<code>fmt::basic_memory_buffer</code> from <code>fmt::print</code>. However, since it may be used
elsewhere, a better solution is to replace the default allocator with one that
uses <code>malloc</code> and <code>free</code> instead of <code>new</code> and <code>delete</code>.</p><div><pre tabindex="0"><code data-lang="c++"><span><span><span>template</span> <span>&lt;</span><span>typename</span> <span>T</span><span>&gt;</span> <span>struct</span> <span>allocator</span> <span>{</span>
</span></span><span><span>  <span>using</span> <span>value_type</span> <span>=</span> <span>T</span><span>;</span>
</span></span><span><span>
</span></span><span><span>  <span>T</span><span>*</span> <span>allocate</span><span>(</span><span>size_t</span> <span>n</span><span>)</span> <span>{</span>
</span></span><span><span>    <span>FMT_ASSERT</span><span>(</span><span>n</span> <span>&lt;=</span> <span>max_value</span><span>&lt;</span><span>size_t</span><span>&gt;</span><span>()</span> <span>/</span> <span>sizeof</span><span>(</span><span>T</span><span>),</span> <span>""</span><span>);</span>
</span></span><span><span>    <span>T</span><span>*</span> <span>p</span> <span>=</span> <span>static_cast</span><span>&lt;</span><span>T</span><span>*&gt;</span><span>(</span><span>malloc</span><span>(</span><span>n</span> <span>*</span> <span>sizeof</span><span>(</span><span>T</span><span>)));</span>
</span></span><span><span>    <span>if</span> <span>(</span><span>!</span><span>p</span><span>)</span> <span>FMT_THROW</span><span>(</span><span>std</span><span>::</span><span>bad_alloc</span><span>());</span>
</span></span><span><span>    <span>return</span> <span>p</span><span>;</span>
</span></span><span><span>  <span>}</span>
</span></span><span><span>
</span></span><span><span>  <span>void</span> <span>deallocate</span><span>(</span><span>T</span><span>*</span> <span>p</span><span>,</span> <span>size_t</span><span>)</span> <span>{</span> <span>free</span><span>(</span><span>p</span><span>);</span> <span>}</span>
</span></span><span><span><span>};</span>
</span></span></code></pre></div><p>This reduces binary size to just 14kB:</p><pre tabindex="0"><code>$ git checkout c0fab5e
$ g++ -Os -flto -DNDEBUG -I include \
      -DFMT_USE_LOCALE=0 -DFMT_BUILTIN_TYPES=0 -DFMT_OPTIMIZE_SIZE=1 \
      '-DFMT_THROW(s)=abort()' -fno-exceptions test.cc src/format.cc \
      -nodefaultlibs -lc
$ strip a.out &amp;&amp; ls -lh a.out
-rwxrwxr-x 1 vagrant vagrant 14K Aug 30 19:06 a.out
</code></pre><p>Considering that a C program with an empty <code>main</code> function is 6kB on this
system, {fmt} now adds less than 10kB to the binary.</p><p>We can also easily verify that it no longer depends on the C++ runtime:</p><pre tabindex="0"><code>$ ldd a.out
        linux-vdso.so.1 (0x0000ffffb0738000)
        libc.so.6 =&gt; /lib/aarch64-linux-gnu/libc.so.6 (0x0000ffffb0530000)
        /lib/ld-linux-aarch64.so.1 (0x0000ffffb06ff000)
</code></pre><p>Hope you found this interesting and happy embedded formatting!</p><hr id="EOF"><p>Last modified on 2024-08-30</p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[E Ink faces growing competition in the "paper-like" display space (139 pts)]]></title>
            <link>https://liliputing.com/e-ink-faces-growing-competition-in-the-paper-like-display-space/</link>
            <guid>41415144</guid>
            <pubDate>Sun, 01 Sep 2024 08:09:03 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://liliputing.com/e-ink-faces-growing-competition-in-the-paper-like-display-space/">https://liliputing.com/e-ink-faces-growing-competition-in-the-paper-like-display-space/</a>, See on <a href="https://news.ycombinator.com/item?id=41415144">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><article id="post-171433"><div><div><p><em><p>Disclosure: Some links on this page are monetized by the <a rel="nofollow" href="http://go.skimlinks.com/?id=32X105&amp;xs=1&amp;url=http://skimlinks.com">Skimlinks</a>, <a rel="nofollow" href="https://affiliate-program.amazon.com/welcome">Amazon</a>, <a rel="nofollow" href="https://rakutenadvertising.com/">Rakuten Advertising, and </a><a rel="no follow" href="https://partnernetwork.ebay.com/">eBay</a>, affiliate programs, and Liliputing may earn a commission if you make a purchase after clicking on those links. All prices are subject to change, and this article only reflects the prices available at time of publication.</p></em></p></div><p>For the past few decades, E Ink has dominated the market for the paper-like displays found in eBook readers and other devices. The screens are high-contrast, easy to view indoors or outdoors, don’t require a backlight, don’t reflect glare, and consume very little power.</p><p>But E Ink displays also have slow screen refresh rates, limited support for color (on models that support any color at all), and generally aren’t very useful for high-motion graphics like videos or games. So while there are a handful of companies producing <a href="https://liliputing.com/tag/e-ink-phone/">E Ink smartphones</a> and <a href="https://liliputing.com/tag/e-ink-tablet/">tablets</a>, they tend to be niche devices. And now we’re seeing a growing number of companies offering products with reflective LCD displays or similar technology that offer some of the paper-like qualities of E Ink, but which are more suitable for animation and video.</p><figure id="attachment_171436" aria-describedby="caption-attachment-171436"><img fetchpriority="high" decoding="async" src="https://liliputing.com/wp-content/uploads/2024/08/hannsnote-2_02-415x500.jpg" alt="" width="415" height="500" srcset="https://liliputing.com/wp-content/uploads/2024/08/hannsnote-2_02-415x500.jpg 415w, https://liliputing.com/wp-content/uploads/2024/08/hannsnote-2_02-332x400.jpg 332w, https://liliputing.com/wp-content/uploads/2024/08/hannsnote-2_02-125x150.jpg 125w, https://liliputing.com/wp-content/uploads/2024/08/hannsnote-2_02-768x925.jpg 768w, https://liliputing.com/wp-content/uploads/2024/08/hannsnote-2_02-400x482.jpg 400w, https://liliputing.com/wp-content/uploads/2024/08/hannsnote-2_02.jpg 1200w" sizes="(max-width: 415px) 100vw, 415px"><figcaption id="caption-attachment-171436">Hannspree HannsNote 2 with ecoVISION Paper Display</figcaption></figure><p>Reflective LCD displays don’t have a backlight and instead reflect ambient light, allowing you to use them without any additional illumination as long as you’re in a brightly lit environment. If you want to make a tablet or another device with a reflective LCD that can be used in dimmer environments, you’ll want to add some front-lights that shine onto the screen… much the way most modern eReaders with E Ink displays have front lighting.</p><p>But while reflective LCD technology has been around for decades, the screens don’t tend to look as bright or vibrant as the transmissive LCDs (with backlights) or OLED screens that have become more common in recent years.</p><p>Recently several companies have decided to try to make&nbsp;<em>better</em> reflective screens though, in an effort to offer an alternative to E Ink that can be used as a paper-like screen for reading and writing, but which also supports full-motion graphics for video, smooth scrolling, and other applications.</p><p>One effort that’s gotten a lot of attention this year is the <a href="https://liliputing.com/daylight-computer-dc-1-is-a-799-tablet-with-a-live-paper-display-designed-to-be-easy-on-the-eyes-but-not-the-wallet/"><strong>Daylight Computer DC-1</strong></a>, which has a “Live Paper” display that’s a black and white IGZO LCD display with a 60 Hz refresh rate and an amber-colored backlight (that can be turned entirely off when you don’t need it).</p><p><img decoding="async" src="https://liliputing.com/wp-content/uploads/2024/05/dc1_02-762x500.jpg" alt="" width="762" height="500" srcset="https://liliputing.com/wp-content/uploads/2024/05/dc1_02-762x500.jpg 762w, https://liliputing.com/wp-content/uploads/2024/05/dc1_02-400x262.jpg 400w, https://liliputing.com/wp-content/uploads/2024/05/dc1_02-150x98.jpg 150w, https://liliputing.com/wp-content/uploads/2024/05/dc1_02-768x504.jpg 768w, https://liliputing.com/wp-content/uploads/2024/05/dc1_02.jpg 1200w" sizes="(max-width: 762px) 100vw, 762px"></p><p><a href="https://daylightcomputer.com/" rel="nofollow"><strong>Daylight</strong></a> is a startup that’s pushing the DC-1 as a tablet that can do more than a typical eReader, while still offering a comfortable viewing experience indoors or outdoors. It has a 10.5 inch display with support for touch and Wacom EMR pen input and the tablet runs a custom version of Android. It’s also expensive, with <a href="https://daylightcomputer.com/cart" rel="nofollow">a $729 price tag</a>.</p><p>If that price tag seems too steep, there’s always TCL’s <a href="https://www.tcl.com/global/en/tcl-nxtpaper-technology" rel="nofollow"><strong>NXTPAPER</strong></a> display technology. The company has been using its full-color, glare-free matte displays on a handful of smartphones and tablets over the past few years. I’ve seen mixed reports on whether this is technically a reflective LCD or not, but while TCL tends to use these displays on relatively affordable devices with budget or mid-range specs, the <a href="https://www.zdnet.com/article/i-gave-away-my-kindle-and-ipad-within-hours-of-testing-this-tablet/" rel="nofollow">screens tend to get positive reviews</a> from folks who are comparing them to E Ink.</p><figure id="attachment_165542" aria-describedby="caption-attachment-165542"><img loading="lazy" decoding="async" src="https://liliputing.com/wp-content/uploads/2024/01/tab-10-nxtpaper-5g-749x500.jpg" alt="" width="749" height="500" srcset="https://liliputing.com/wp-content/uploads/2024/01/tab-10-nxtpaper-5g-749x500.jpg 749w, https://liliputing.com/wp-content/uploads/2024/01/tab-10-nxtpaper-5g-400x267.jpg 400w, https://liliputing.com/wp-content/uploads/2024/01/tab-10-nxtpaper-5g-150x100.jpg 150w, https://liliputing.com/wp-content/uploads/2024/01/tab-10-nxtpaper-5g-768x513.jpg 768w, https://liliputing.com/wp-content/uploads/2024/01/tab-10-nxtpaper-5g.jpg 1200w" sizes="(max-width: 749px) 100vw, 749px"><figcaption id="caption-attachment-165542">TCL NXTPAPER 10 5G</figcaption></figure><p>A TCL NXTPAPER 5G Android tablet with a 10.4 inch display currently <a href="https://fave.co/3MtxTqI" rel="nofollow">sells for $240 at Verizon</a>, making it pricier than an <a href="https://amzn.to/3AKts8d" rel="nofollow">Amazon Kindle Paperwhite</a>, but comparable to the list price for an <a href="https://amzn.to/3yOsA20" rel="nofollow">Amazon Fire Max 11</a>.</p><p>One of the more recent entries into this space is HannSpree’s <strong><a href="https://www.hannspree.eu/about-ecovision-paper-display/" rel="nofollow">ecoVISION Paper Display</a></strong> technology, which also offers “fast, full-colour performance,” energy efficiency, and “true 8-bit, non-FRC, flicker-free, and low blue light features” that are said to “help reduce eye strain.”</p><p>One of the first devices featuring this display has the <a href="https://www.hannspree.com/hannsnote2" rel="nofollow"><strong>Hannspree HannsNote 2</strong></a>.&nbsp; It’s a device that the company is positioning as an eReader, but it’s basically an Android tablet with a 10 inch, 1600 x 1200 pixel (200 ppi), 60 Hz display and USI 2.0 stylus support.</p><figure id="attachment_171438" aria-describedby="caption-attachment-171438"><img loading="lazy" decoding="async" src="https://liliputing.com/wp-content/uploads/2024/08/hannsnote-2_05-415x500.jpg" alt="" width="415" height="500" srcset="https://liliputing.com/wp-content/uploads/2024/08/hannsnote-2_05-415x500.jpg 415w, https://liliputing.com/wp-content/uploads/2024/08/hannsnote-2_05-332x400.jpg 332w, https://liliputing.com/wp-content/uploads/2024/08/hannsnote-2_05-125x150.jpg 125w, https://liliputing.com/wp-content/uploads/2024/08/hannsnote-2_05-768x925.jpg 768w, https://liliputing.com/wp-content/uploads/2024/08/hannsnote-2_05-400x482.jpg 400w, https://liliputing.com/wp-content/uploads/2024/08/hannsnote-2_05.jpg 1200w" sizes="(max-width: 415px) 100vw, 415px"><figcaption id="caption-attachment-171438">Hannspree HannsNote 2 with ecoVISION Paper Display</figcaption></figure><p>It also has a Rockchip RK3566 quad-core ARM Cortex-A55 processor, 4GB of RAM, 64GB of storage, and an Android 13-based operating system. The Google Play store comes pre-loaded.</p><p>Interestingly one thing the HannsNote 2 lacks? A front-light. It’s meant to be used&nbsp;<em>only</em> with ambient lighting, which should make it easy to use outdoors or in brightly lit rooms. But if you want to read in the dark you’ll probably need a clip-on booklight.</p><p>The tablet doesn’t seem to be available for purchase in the US, but it’s sold in Europe <a href="https://fave.co/4dK2vjM" rel="nofollow">for about 315€</a>.</p><p><iframe loading="lazy" title="RLCD Color E-Paper Tablet: HannsNote 2 First Look" width="780" height="439" src="https://www.youtube.com/embed/0d7gc8xflHI?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen=""></iframe></p><p>HannSpree has also announced plans to launch a series of “<a href="https://www.prnewswire.com/news-releases/hannspree-unveils-ecovision-paper-display-at-ifa-2024-302233719.html" rel="nofollow">next-generation e-readers</a>” soon, with ecoVISION displays, Android 14 software, and 10 inch or 7.8 inch displays, as well as other products including a 23.8 inch monitor digital signage featuring up to a 28-inch ecoVISION display.</p><div id="custom_html-9"><p>Liliputing's primary sources of revenue are advertising and affiliate links (if you click the "<a target="_blank" rel="nofollow noopener" href="https://www.amazon.com/Best-Sellers-Computers-Accessories/zgbs/pc/ref=as_li_ss_tl?_encoding=UTF8&amp;linkCode=ll2&amp;tag=liliputing_shop-20&amp;linkId=93aaf7ba4e36ed56d46003558471548d">Shop</a>" button at the top of the page and buy something on Amazon, for example, we'll get a small commission).</p><p>But there are several ways you can support the site directly even if you're using an ad blocker* and hate online shopping.</p><h3>Contribute to our <a href="https://www.patreon.com/bradlinder">Patreon campaign</a></h3><p> <em>or...</em></p><h3>Contribute via <a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&amp;hosted_button_id=PTBQ9EKAYTZBS&amp;source=url">PayPal</a></h3><p> * If you <em>are</em> using an ad blocker like uBlock Origin and seeing a pop-up message at the bottom of the screen, we have a <a target="blank_" href="https://liliputing.com/2020/09/ublock-origin-how-to-hide-googles-script-blocking-warning-for-websites-using-funding-choices.html" rel="noopener">guide that may help you disable it.</a></p></div><div id="blog_subscription-2"><p> Join 9,573 other subscribers</p></div></div></article></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Godot on iPad, Toolbars, Importers, Embedding, Debugger (178 pts)]]></title>
            <link>https://blog.la-terminal.net/godot-on-ipad-summer-update/</link>
            <guid>41415077</guid>
            <pubDate>Sun, 01 Sep 2024 07:50:35 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://blog.la-terminal.net/godot-on-ipad-summer-update/">https://blog.la-terminal.net/godot-on-ipad-summer-update/</a>, See on <a href="https://news.ycombinator.com/item?id=41415077">Hacker News</a></p>
<div id="readability-page-1" class="page"><section>
    <p>This is a long-due update on porting Godot to the iPad. &nbsp;Shortly after my last blog post covering the development work on May 29th, Apple held its WWDC 2024 conference. &nbsp; I went into the conference with gusto, expecting to fully embrace all the iOS 18 APIs. I already knew by then that I would not complete the port before iOS 18 became widely available.</p><p>One thing I was not counting on was Apple releasing FinalCut Pro for the iPad, a professional video editing tool. It looked nice on the videos, but I did not expect it to be such a revelation from a UX perspective. While I have been following the Apple Human Interface Guidelines guidance and trying to mimic what other iPad system applications do, FinalCut Pro is packed with small details that have informed Godot for iPad ever since. &nbsp;&nbsp;</p><p>The app itself is glorious and a delight to use, and not being a user interface designer, I did not quite understand what made the app feel so good. &nbsp; A few things were more or less obvious like the Final Cut Pro controls for selecting values:</p><figure><img src="https://paper-attachments.dropboxusercontent.com/s_BF3AD6EA8C16ADCDBFFBE2C86A5DC3002F99676ABA007444AD8B02E5E9853638_1725137064781_image.png" alt="" loading="lazy" width="640" height="334"><figcaption><span>FinalCut Pro's numeric input.</span></figcaption></figure><p>On the surface, this property editor felt better. Most edits can be done with your finger by dragging the value, and fine editing is possible by tapping on the number, which would bring a text editor. While I already had a little popup that would come up when editing a number, my editor defaulted to having a TextField, so it would always trigger the keyboard to pop up to edit.</p><p>I had completely missed the now obvious benefit of using a custom data entry popup, which was to avoid getting a system keyboard, one that has all sorts of letters and takes a large chunk of the screen, purely to enter numbers. It is obvious in retrospect, but it was not obvious when I was coding it.</p><p>I fell in love with these slide controls. The above one can edit values on a fixed range, but some editors would scroll, and I spent a few weeks reimplementing them and getting the behavior to match it; here are a few of them:</p><figure data-kg-thumbnail="https://blog.la-terminal.net/content/media/2024/08/252bace3f38a89a2_thumb.jpg" data-kg-custom-thumbnail="">
            <div>
                <video src="https://blog.la-terminal.net/content/media/2024/08/252bace3f38a89a2.mp4" poster="https://img.spacergif.org/v1/672x900/0a/spacer.png" width="672" height="900" playsinline="" preload="metadata"></video>
                
                <div>
                        <p>
                        
                        <span>0:00</span></p><p>
                            /<span>0:15</span>
                        </p>
                        </div>
            </div>
            <figcaption><p><span>My new data entry controls, attempting to follow the FinalCut Pro idioms.</span></p></figcaption>
        <img src="https://blog.la-terminal.net/content/media/2024/08/252bace3f38a89a2_thumb.jpg"></figure><p>But beyond these very obvious changes, something more subtle was going on. &nbsp; This is what my test code for a potpourri of properties looked like before I looked at Final Cut Pro:</p><figure><img src="https://files.mastodon.social/media_attachments/files/112/754/487/057/645/000/original/666868d31af3e7e3.png" alt="" loading="lazy" width="732" height="2112"></figure><p>What made Final Cut Pro look so much better was a combination of things:</p><ul><li>Font sizes for sections, labels and values</li><li>Color scheme used for labels and values</li><li>Tasteful grouping and padding of elements</li><li>Removal of the&nbsp;“lock”&nbsp;icon for linked properties from this screen and moving them directly to the data input</li></ul><p>So I set out with Preview and the Digital Color meter to match the colors, font sizes and spacing of the property editors to improve this user experience, and within a few days, I had something that looked a little bit better:</p><figure><img src="https://paper-attachments.dropboxusercontent.com/s_BF3AD6EA8C16ADCDBFFBE2C86A5DC3002F99676ABA007444AD8B02E5E9853638_1725137815878_image.png" alt="" loading="lazy" width="812" height="1600"></figure><p>And now, rather than using a popup to edit each value, I now offer an editor that can take care of all the grouped values at once - and the value linkage is now done entirely on this editor. &nbsp; Additionally, a description is shown at the top, plus a “Reset”&nbsp;option, similar to Final Cut Pro:</p><figure><img src="https://paper-attachments.dropboxusercontent.com/s_BF3AD6EA8C16ADCDBFFBE2C86A5DC3002F99676ABA007444AD8B02E5E9853638_1725137940198_image.png" alt="" loading="lazy" width="838" height="1362"></figure><p>Then, I noticed that FinalCut Pro did not shy away from nesting values to edit, where I would try to flatten everything out. &nbsp; Here, I had to come up with my idiom, as I expect that some users would not want to dig deeper into the hierarchy to edit values, so I allow users to&nbsp;“pin”&nbsp;a subgroup&nbsp;(I&nbsp;hijack Godot’s existing system for expanding a subtree for this):</p><figure><img src="https://paper-attachments.dropboxusercontent.com/s_BF3AD6EA8C16ADCDBFFBE2C86A5DC3002F99676ABA007444AD8B02E5E9853638_1725138413447_image.png" alt="" loading="lazy" width="742" height="368"></figure><p>Tapping the pin button would put that subgroup in the container.</p><p>The work on the new controls and the polishing of the property editor took about a month. &nbsp; I think that it was a worthwhile investment to make the user interface better suited for touch. &nbsp; What surprised me was how big of an upgrade using the proper font sizes, hierarchy of colors and accents brought to the app.</p><p>Another upgrade I did to the inspector during the summer is supporting nested property editing. &nbsp; Once I embraced the FinalCut Pro approach of navigation for properties, it came naturally, and now you can edit those properties by simply tapping on the object as well as rendering previews of some properties. In this case, you can see the material for the mesh:</p><figure><img src="https://paper-attachments.dropboxusercontent.com/s_BF3AD6EA8C16ADCDBFFBE2C86A5DC3002F99676ABA007444AD8B02E5E9853638_1725144211229_image.png" alt="" loading="lazy" width="1156" height="2066"><figcaption><span>Resource Previews in the Inspector</span></figcaption></figure><h2 id="embedded-windows">Embedded Windows</h2><p>As I have shared over the past year, Godot on iPad is made up of the Godot engine embedded inside SwiftUI, and it started looking like this:</p><figure><img src="https://paper-attachments.dropboxusercontent.com/s_BF3AD6EA8C16ADCDBFFBE2C86A5DC3002F99676ABA007444AD8B02E5E9853638_1725139189530_image.png" alt="" loading="lazy" width="2728" height="2038"><figcaption><span>An older version of Godot on iPad, showing the underlying editor running.</span></figcaption></figure><p>An older version of Godot on iPad shows the underlying editor running.Above, you can see that Godot is still running in full screen, but with a few of the Godot pads removed on both sides. The center of the screen still contains the Godot tab-based scene selector, the toolbar, the per-view menu&nbsp;(itsays“Perspective”), and the bottom bar, which contains various tools.</p><p>While this works, I wanted more control over what would be displayed here, so rather than lay things on top of Godot, I wanted to extract a view and fully control it. &nbsp; In my case, I wanted the editor's surface but none of the additional elements. &nbsp; In other cases, I wanted to embed some property controls directly into the property editor.</p><p>The Migeran team developed a set of Godot patches that allow me to do this embedding, and I am using them to revamp the user interface.</p><p>The first use was to re-host the top editor and the bottom bar directly and then control their display as a group. &nbsp; Then, I graduated to rehosting every single tap on the bottom bar so I could start incrementally rewriting each of those tabs into SwiftUI.</p><p>First, I replaced the Output Pad, which looks like this on the desktop:</p><figure><img src="https://paper-attachments.dropboxusercontent.com/s_BF3AD6EA8C16ADCDBFFBE2C86A5DC3002F99676ABA007444AD8B02E5E9853638_1725139592542_image.png" alt="" loading="lazy" width="1228" height="498"><figcaption><span>Godot Desktop Output Pad</span></figcaption></figure><p>With this version:</p><figure><img src="https://blog.la-terminal.net/content/images/2024/08/F6iVjkNQ.jpg" alt="" loading="lazy" width="2000" height="591" srcset="https://blog.la-terminal.net/content/images/size/w600/2024/08/F6iVjkNQ.jpg 600w, https://blog.la-terminal.net/content/images/size/w1000/2024/08/F6iVjkNQ.jpg 1000w, https://blog.la-terminal.net/content/images/size/w1600/2024/08/F6iVjkNQ.jpg 1600w, https://blog.la-terminal.net/content/images/2024/08/F6iVjkNQ.jpg 2000w" sizes="(min-width: 1200px) 1200px"><figcaption><span>Godot on iPad Output Pad</span></figcaption></figure><p>To avoid taking up a whole row for text filtering, I allow each tab to have an optional tool that can be displayed on the right side of the user interface, like in this case.</p><p>It also shows some inspiration taken from LogicPro, another one of Apple’s professional tools for the iPad. &nbsp; In this case, I have replaced a difficult-to-grab&nbsp;“splitter”&nbsp;common in Godot with an explicit handle that the user can drag to grow the region, tap to expand, or dismiss with a flick.</p><p>Similarly, the native Godot debugger went on a user interface diet, as I do not have the space available:</p><figure><img src="https://paper-attachments.dropboxusercontent.com/s_BF3AD6EA8C16ADCDBFFBE2C86A5DC3002F99676ABA007444AD8B02E5E9853638_1725140554713_image.png" alt="" loading="lazy" width="1454" height="588"></figure><p>This time, I drew inspiration from Xcode and Swift Playgrounds. In this case, I collapsed the thread selector to one Picker that allows you to jump to different threads. The entire stack frames pane is also replaced by a single picker&nbsp;(here,showing&nbsp;hello:10), and the variables are shown on the left side, similar to Xcode. &nbsp;&nbsp;</p><p>Another Xcode-inspired idea is that the variables and the output live side by side and can be toggled on and on using the small controls at the bottom of the screen:</p><figure><img src="https://paper-attachments.dropboxusercontent.com/s_BF3AD6EA8C16ADCDBFFBE2C86A5DC3002F99676ABA007444AD8B02E5E9853638_1725140664442_image.png" alt="" loading="lazy" width="2092" height="752"></figure><p>The next big chunk of work this summer was to provide alternatives to the toolbars and menus used in Godot 3D and 2D editors. I started with the same principle: to be in control of those user interface elements and make them suitable for use on the iPad&nbsp;(and&nbsp;soon on the VisionPro). &nbsp;&nbsp;</p><p>Initially, I felt like I could use the embedding technology to reuse the menus as-is because they were tappable enough. &nbsp; But once I looked at them, I realized they were too busy, had very long lists of data, and would work poorly on the iPad. &nbsp; This shows a partial view of the various toolbar elements for the 3D editor and what they unfold to:</p><figure><img src="https://files.mastodon.social/media_attachments/files/112/883/661/063/563/770/original/24dcab2a69e9306b.png" alt="" loading="lazy" width="2004" height="2076"><figcaption><span>The Godot Menus and Options for the 3D editor</span></figcaption></figure><p>This is what the toolbar looks like now after the iPad-ification was done:</p><figure><img src="https://paper-attachments.dropboxusercontent.com/s_BF3AD6EA8C16ADCDBFFBE2C86A5DC3002F99676ABA007444AD8B02E5E9853638_1725141991249_image.png" alt="" loading="lazy" width="1248" height="730"></figure><p>I enjoyed turning a modal settings box for the Field of View, Near Clip Distance and Far Clip Distance into a live setting, so you can immediately see the changes happen. &nbsp; This view is still using the old sliders, but will soon be replaced with the new sliders that I cooked up.</p><p>Merging the six different viewport options into a single line saved plenty of vertical space, and merging those settings into the general-purpose settings and letting the user configure them there saved two icon slots on the toolbar for Light and Environment.</p><p>Had I designed this six months ago, I would have made the configuration for Light and Environment a long-press action on the light and environment buttons. But the more I use the app and the more professional apps I use on the iPad, I realize that long-press actions are useful for power users, but they are just not discoverable. I am being more mindful and considerate about my users by moving away from this idiom. &nbsp;Very demure.</p><p>And this is what I did with the per-view menus:</p><figure><img src="https://paper-attachments.dropboxusercontent.com/s_BF3AD6EA8C16ADCDBFFBE2C86A5DC3002F99676ABA007444AD8B02E5E9853638_1725142140383_image.png" alt="" loading="lazy" width="1382" height="1036"></figure><p>I might add some icons to the labels, but these look fine to me now.</p><p>A similar exercise was necessary for the 2D surface:</p><figure><img src="https://paper-attachments.dropboxusercontent.com/s_BF3AD6EA8C16ADCDBFFBE2C86A5DC3002F99676ABA007444AD8B02E5E9853638_1725142451978_image.png" alt="" loading="lazy" width="1630" height="774"></figure><p>It did not seem like I could re-host those user interface elements, it just did not feel right after the 3D user interface had gotten that big upgrade.</p><p>So this is what the 2D toolbar turned into:</p><figure><img src="https://paper-attachments.dropboxusercontent.com/s_BF3AD6EA8C16ADCDBFFBE2C86A5DC3002F99676ABA007444AD8B02E5E9853638_1725142787835_image.png" alt="" loading="lazy" width="1150" height="720"></figure><p>My goal was to preserve all the features available in Godot and surface them in an iPad-friendly way without sacrificing any functionality. If I had telemetry for which features users were using, I could have left a few things out, but generally, I erred on the side of not leaving things out. &nbsp;&nbsp;</p><p>There are two small exceptions, and I made them only after reading the commit that introduced the feature and the discussion on the GitHub issue—they looked like relatively fringe features that had little use. But hopefully, during the public TestFlight, folks will inform me if I made a mistake.</p><p>You can tell that I worked hard to preserve all the functionality but also organize the features in a way that would be simpler to find:</p><figure><img src="https://paper-attachments.dropboxusercontent.com/s_BF3AD6EA8C16ADCDBFFBE2C86A5DC3002F99676ABA007444AD8B02E5E9853638_1725142810630_image.png" alt="" loading="lazy" width="1508" height="1056"></figure><p>You might have noticed the&nbsp;“Control:&nbsp;Anchors” toolbar there. It turns out that I got more than I bargained for. Godot has additional&nbsp;“toolbars”&nbsp;that can be loaded into the toolbar depending on the object that you are editing, so I had to support not only the basics but also other custom toolbars. &nbsp;&nbsp;</p><p>As Godot allows scripts and extensions to add elements to the Toolbar, I am replacing the known element toolbars with my own. If I encounter one kind that I do not support, I will merely&nbsp;“re-host”&nbsp;the Godot-native control in the user interface.</p><p>That said, my goal is to cover all the popular toolbars from the start so that none of the native ones are exposed and to fall back to the embedded situation when necessary.</p><p>I feel like I can do slightly better organization of these properties for Godot on iPad because of the additional user interface elements available at my disposal, like the Picker above or the visual cues for grouping. &nbsp; This is a feeling that I got repeatedly during this exercise. The spectrum of tools available in SwiftUI gave me a richer vocabulary to express the capabilities than the controls that come with Godot - I hope to publish a list of&nbsp;“nice&nbsp;to haves” so the Godot folks can bring that into mainline Godot.</p><p>Lastly, I realized that the toolbars are taking some precious space on the user interface, and they might get in the way of your work. &nbsp; I remembered that Apple had a talk some years ago about&nbsp;“<a href="https://developer.apple.com/videos/play/wwdc2018/803/?ref=blog.la-terminal.net" rel="noreferrer nofollow noopener">Fluid</a><a href="https://developer.apple.com/videos/play/wwdc2018/803/?ref=blog.la-terminal.net" rel="noreferrer nofollow noopener">&nbsp;Interfaces</a>” that covered this scenario, for what they called the&nbsp;“Picture&nbsp;in Picture View”. &nbsp; The description starts after minute 41 of the talk.</p><p>So I brought that user interface idiom to the toolbars, allowing users to&nbsp;“flick”&nbsp;the toolbar to one of the four corners of the user interface to get out of the way:</p><figure data-kg-thumbnail="https://blog.la-terminal.net/content/media/2024/08/ScreenRecording_08-31-2024-18-28-08_1_thumb.jpg" data-kg-custom-thumbnail="">
            <div>
                <video src="https://blog.la-terminal.net/content/media/2024/08/ScreenRecording_08-31-2024-18-28-08_1.MP4" poster="https://img.spacergif.org/v1/1920x1342/0a/spacer.png" width="1920" height="1342" playsinline="" preload="metadata"></video>
                
                <div>
                        <p>
                        
                        <span>0:00</span></p><p>
                            /<span>0:13</span>
                        </p>
                        </div>
            </div>
            <figcaption><p><span>Moving the toolbar around</span></p></figcaption>
        <img src="https://blog.la-terminal.net/content/media/2024/08/ScreenRecording_08-31-2024-18-28-08_1_thumb.jpg"></figure><h2 id="other-work">Other Work</h2><p>Miroslav has been an invaluable partner in this SwiftUI adventure, and while he had initially just focused on the SwiftUI components, he has recently taken over rewriting many of the full-screen importers for Godot. &nbsp; We realized early on that some of the importers in Godot were great, but again, they would take up all the space and did not fit at all in the iPad, it was not even possible to reach all the elements of the UI.</p><p>He rewrote the Scene Importer and the Audio Importer, which were large projects on their own:</p><figure><img src="https://paper-attachments.dropboxusercontent.com/s_BF3AD6EA8C16ADCDBFFBE2C86A5DC3002F99676ABA007444AD8B02E5E9853638_1725146091645_image.png" alt="" loading="lazy" width="2388" height="1668"><figcaption><span>Scene Importer, the sidebar is closed.</span></figcaption></figure><figure><img src="https://paper-attachments.dropboxusercontent.com/s_BF3AD6EA8C16ADCDBFFBE2C86A5DC3002F99676ABA007444AD8B02E5E9853638_1725146031864_image.png" alt="" loading="lazy" width="2388" height="1668"><figcaption><span>Audio Importer</span></figcaption></figure><h2 id="next-steps">Next Steps</h2><p>One thing that has been bothering me is how to activate/deactivate panels on such a small screen, and I had my share of poor man’s hacks. &nbsp; Logic Pro introduced me to an idiom&nbsp;(and&nbsp;while it is in FinalCut Pro, I was not paying enough attention to see it): small icons at the bottom of the screen. &nbsp; I spent the last week redoing my bottom bar to incorporate this idiom.</p><p>I lack a&nbsp;“Scene&nbsp;Switcher”&nbsp;(what&nbsp;Godot has in tabs). &nbsp;The way to switch scenes is to select the file directly, but that feels clunky, so that is next.</p><p>In addition to these two high-level topics, I have some fifty-nine other small bugs that need to be fixed before this is suitable for a TestFlight, and I hope to finalize those in September.&nbsp;</p><p>My hope is that while I collect feedback for this beta and fix bugs, I can look into integrating Apple Pencil support, spend some quality time on the touch interactions for it, and make sure that Godot on iPad really shines as a touch-first experience.</p>
</section></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Founder Mode (1011 pts)]]></title>
            <link>https://paulgraham.com/foundermode.html</link>
            <guid>41415023</guid>
            <pubDate>Sun, 01 Sep 2024 07:35:23 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://paulgraham.com/foundermode.html">https://paulgraham.com/foundermode.html</a>, See on <a href="https://news.ycombinator.com/item?id=41415023">Hacker News</a></p>
<div id="readability-page-1" class="page"><div width="435"><tbody><tr><td><img src="https://s.turbifycdn.com/aah/paulgraham/founder-mode-1.gif" width="118" height="18" alt="Founder Mode"><span size="2" face="verdana">September 2024<p>At a YC event last week Brian Chesky gave a talk that everyone who
was there will remember. Most founders I talked to afterward said
it was the best they'd ever heard. Ron Conway, for the first time
in his life, forgot to take notes. I'm not going to try to reproduce
it here. Instead I want to talk about a question it raised.</p><p>The theme of Brian's talk was that the conventional wisdom about
how to run larger companies is mistaken. As Airbnb grew, well-meaning
people advised him that he had to run the company in a certain way
for it to scale. Their advice could be optimistically summarized
as "hire good people and give them room to do their jobs." He
followed this advice and the results were disastrous. So he had to
figure out a better way on his own, which he did partly by studying
how Steve Jobs ran Apple. So far it seems to be working. Airbnb's
free cash flow margin is now among the best in Silicon Valley.</p><p>The audience at this event included a lot of the most successful
founders we've funded, and one after another said that the same
thing had happened to them. They'd been given the same advice about
how to run their companies as they grew, but instead of helping
their companies, it had damaged them.</p><p>Why was everyone telling these founders the wrong thing? That was
the big mystery to me. And after mulling it over for a bit I figured
out the answer: what they were being told was how to run a company
you hadn't founded — how to run a company if you're merely a
professional manager. But this m.o. is so much less effective that
to founders it feels broken. There are things founders can do that
managers can't, and not doing them feels wrong to founders, because
it is.</p><p>In effect there are two different ways to run a company: founder
mode and manager mode. Till now most people even in Silicon Valley
have implicitly assumed that scaling a startup meant switching to
manager mode. But we can infer the existence of another mode from
the dismay of founders who've tried it, and the success of their
attempts to escape from it.</p><p>There are as far as I know no books specifically about founder mode.
Business schools don't know it exists. All we have so far are the
experiments of individual founders who've been figuring it out for
themselves. But now that we know what we're looking for, we can
search for it. I hope in a few years founder mode will be as well
understood as manager mode. We can already guess at some of the
ways it will differ.</p><p>The way managers are taught to run companies seems to be like modular
design in the sense that you treat subtrees of the org chart as
black boxes. You tell your direct reports what to do, and it's up
to them to figure out how. But you don't get involved in the details
of what they do. That would be micromanaging them, which is bad.</p><p>Hire good people and give them room to do their jobs. Sounds great
when it's described that way, doesn't it? Except in practice, judging
from the report of founder after founder, what this often turns out
to mean is: hire professional fakers and let them drive the company
into the ground.</p><p>One theme I noticed both in Brian's talk and when talking to founders
afterward was the idea of being gaslit. Founders feel like they're
being gaslit from both sides — by the people telling them they
have to run their companies like managers, and by the people working
for them when they do. Usually when everyone around you disagrees
with you, your default assumption should be that you're mistaken.
But this is one of the rare exceptions. VCs who haven't been founders
themselves don't know how founders should run companies, and C-level
execs, as a class, include some of the most skillful liars in the
world.
</p><span color="#dddddd">[<a href="#f1n"><span color="#dddddd">1</span></a>]</span><p>Whatever founder mode consists of, it's pretty clear that it's going
to break the principle that the CEO should engage with the company
only via his or her direct reports. "Skip-level" meetings will
become the norm instead of a practice so unusual that there's a
name for it. And once you abandon that constraint there are a huge
number of permutations to choose from.</p><p>For example, Steve Jobs used to run an annual retreat for what he
considered the 100 most important people at Apple, and these were
not the 100 people highest on the org chart. Can you imagine the
force of will it would take to do this at the average company? And
yet imagine how useful such a thing could be. It could make a big
company feel like a startup. Steve presumably wouldn't have kept
having these retreats if they didn't work. But I've never heard of
another company doing this. So is it a good idea, or a bad one? We
still don't know. That's how little we know about founder mode.
</p><span color="#dddddd">[<a href="#f2n"><span color="#dddddd">2</span></a>]</span><p>Obviously founders can't keep running a 2000 person company the way
they ran it when it had 20. There's going to have to be some amount
of delegation. Where the borders of autonomy end up, and how sharp
they are, will probably vary from company to company. They'll even
vary from time to time within the same company, as managers earn
trust. So founder mode will be more complicated than manager mode.
But it will also work better. We already know that from the examples
of individual founders groping their way toward it.</p><p>Indeed, another prediction I'll make about founder mode is that
once we figure out what it is, we'll find that a number of individual
founders were already most of the way there — except that in doing
what they did they were regarded by many as eccentric or worse.
</p><span color="#dddddd">[<a href="#f3n"><span color="#dddddd">3</span></a>]</span><p>Curiously enough it's an encouraging thought that we still know so
little about founder mode. Look at what founders have achieved
already, and yet they've achieved this against a headwind of bad
advice. Imagine what they'll do once we can tell them how to run
their companies like Steve Jobs instead of John Sculley.</p><p><b>Notes</b></p><p>[</p><a name="f1n"><span color="#000000">1</span></a>]
The more diplomatic way of phrasing this statement would be
to say that experienced C-level execs are often very skilled at
managing up. And I don't think anyone with knowledge of this world
would dispute that.<p>[</p><a name="f2n"><span color="#000000">2</span></a>]
If the practice of having such retreats became so widespread
that even mature companies dominated by politics started to do it,
we could quantify the senescence of companies by the average depth
on the org chart of those invited.<p>[</p><a name="f3n"><span color="#000000">3</span></a>]
I also have another less optimistic prediction: as soon as
the concept of founder mode becomes established, people will start
misusing it. Founders who are unable to delegate even things they
should will use founder mode as the excuse. Or managers who aren't
founders will decide they should try act like founders. That may
even work, to some extent, but the results will be messy when it
doesn't; the modular approach does at least limit the damage a bad
CEO can do.<span color="888888"><b>Thanks</b> to Brian Chesky, Patrick Collison, 
Ron Conway, Jessica
Livingston, Elon Musk, Ryan Petersen, Harj Taggar, and Garry Tan
for reading drafts of this.</span></span></td></tr></tbody></div></div>]]></description>
        </item>
    </channel>
</rss>