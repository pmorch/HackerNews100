<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
    <channel>
        <title>HN100 - Readable Contents</title>
        <link>https://hn.algolia.com/api/v1/search_by_date?tags=%28story,poll%29&amp;numericFilters=points%3E100</link>
        <description>Uses Readability to add bodies to the RSS feed</description>
        <lastBuildDate>Tue, 24 Dec 2024 17:30:03 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Tokyo released point cloud data of the entire city for free (128 pts)]]></title>
            <link>https://twitter.com/spatiallyjess/status/1871342549958537326</link>
            <guid>42501102</guid>
            <pubDate>Tue, 24 Dec 2024 10:51:39 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://twitter.com/spatiallyjess/status/1871342549958537326">https://twitter.com/spatiallyjess/status/1871342549958537326</a>, See on <a href="https://news.ycombinator.com/item?id=42501102">Hacker News</a></p>
&lt;Unparsable&gt;]]></description>
        </item>
        <item>
            <title><![CDATA[Paris to Berlin by train is now faster by five hours (105 pts)]]></title>
            <link>https://www.theguardian.com/travel/2024/dec/24/paris-to-berlin-by-train-faster-service-via-strasbourg</link>
            <guid>42500704</guid>
            <pubDate>Tue, 24 Dec 2024 09:17:14 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.theguardian.com/travel/2024/dec/24/paris-to-berlin-by-train-faster-service-via-strasbourg">https://www.theguardian.com/travel/2024/dec/24/paris-to-berlin-by-train-faster-service-via-strasbourg</a>, See on <a href="https://news.ycombinator.com/item?id=42500704">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="maincontent"><p><span>U</span>ntil last week, my most recent trip from Paris to Berlin on a direct daytime train was way back in early 2015 with RZD Russian Railways. The train had a Polish restaurant car with a quirky menu featuring caviar, kangaroo steak and South African wines. The journey between the two capital cities was scheduled to take 13 hours, and despite dawdling along the way, we arrived in Berlin bang on time. It was a day with breakfast by the Seine, lunch (without caviar) on the train as we crossed the Rhine and nightcaps by the Spree in Berlin.</p><figure id="disclaimer" data-spacefinder-role="inline" data-spacefinder-type="model.dotcomrendering.pageElements.DisclaimerBlockElement"><span></span></figure><p>More recently, the only direct service between Paris and Berlin has been a thrice-weekly overnight train. Branded as a Nightjet, there is nothing jet-like about it. It takes even longer than the Russian daytime train did 10 years ago. But as of last week, there is now a faster direct option. Germany’s national rail operator Deutsche Bahn and its French counterpart SNCF have just launched a much faster direct daytime Paris to Berlin train.</p><figure id="52683568-99a3-4675-85c2-ceaf28a963a0" data-spacefinder-role="showcase" data-spacefinder-type="model.dotcomrendering.pageElements.ImageBlockElement"><div id="img-2"><picture><source srcset="https://i.guim.co.uk/img/media/fa0df7fe701b760716b19241f3a70bce12d68a4d/0_268_5616_3370/master/5616.jpg?width=880&amp;dpr=2&amp;s=none&amp;crop=none" media="(min-width: 1300px) and (-webkit-min-device-pixel-ratio: 1.25), (min-width: 1300px) and (min-resolution: 120dpi)"><source srcset="https://i.guim.co.uk/img/media/fa0df7fe701b760716b19241f3a70bce12d68a4d/0_268_5616_3370/master/5616.jpg?width=880&amp;dpr=1&amp;s=none&amp;crop=none" media="(min-width: 1300px)"><source srcset="https://i.guim.co.uk/img/media/fa0df7fe701b760716b19241f3a70bce12d68a4d/0_268_5616_3370/master/5616.jpg?width=800&amp;dpr=2&amp;s=none&amp;crop=none" media="(min-width: 1140px) and (-webkit-min-device-pixel-ratio: 1.25), (min-width: 1140px) and (min-resolution: 120dpi)"><source srcset="https://i.guim.co.uk/img/media/fa0df7fe701b760716b19241f3a70bce12d68a4d/0_268_5616_3370/master/5616.jpg?width=800&amp;dpr=1&amp;s=none&amp;crop=none" media="(min-width: 1140px)"><source srcset="https://i.guim.co.uk/img/media/fa0df7fe701b760716b19241f3a70bce12d68a4d/0_268_5616_3370/master/5616.jpg?width=640&amp;dpr=2&amp;s=none&amp;crop=none" media="(min-width: 980px) and (-webkit-min-device-pixel-ratio: 1.25), (min-width: 980px) and (min-resolution: 120dpi)"><source srcset="https://i.guim.co.uk/img/media/fa0df7fe701b760716b19241f3a70bce12d68a4d/0_268_5616_3370/master/5616.jpg?width=640&amp;dpr=1&amp;s=none&amp;crop=none" media="(min-width: 980px)"><source srcset="https://i.guim.co.uk/img/media/fa0df7fe701b760716b19241f3a70bce12d68a4d/0_268_5616_3370/master/5616.jpg?width=620&amp;dpr=2&amp;s=none&amp;crop=none" media="(min-width: 660px) and (-webkit-min-device-pixel-ratio: 1.25), (min-width: 660px) and (min-resolution: 120dpi)"><source srcset="https://i.guim.co.uk/img/media/fa0df7fe701b760716b19241f3a70bce12d68a4d/0_268_5616_3370/master/5616.jpg?width=620&amp;dpr=1&amp;s=none&amp;crop=none" media="(min-width: 660px)"><source srcset="https://i.guim.co.uk/img/media/fa0df7fe701b760716b19241f3a70bce12d68a4d/0_268_5616_3370/master/5616.jpg?width=605&amp;dpr=2&amp;s=none&amp;crop=none" media="(min-width: 480px) and (-webkit-min-device-pixel-ratio: 1.25), (min-width: 480px) and (min-resolution: 120dpi)"><source srcset="https://i.guim.co.uk/img/media/fa0df7fe701b760716b19241f3a70bce12d68a4d/0_268_5616_3370/master/5616.jpg?width=605&amp;dpr=1&amp;s=none&amp;crop=none" media="(min-width: 480px)"><source srcset="https://i.guim.co.uk/img/media/fa0df7fe701b760716b19241f3a70bce12d68a4d/0_268_5616_3370/master/5616.jpg?width=445&amp;dpr=2&amp;s=none&amp;crop=none" media="(min-width: 320px) and (-webkit-min-device-pixel-ratio: 1.25), (min-width: 320px) and (min-resolution: 120dpi)"><source srcset="https://i.guim.co.uk/img/media/fa0df7fe701b760716b19241f3a70bce12d68a4d/0_268_5616_3370/master/5616.jpg?width=445&amp;dpr=1&amp;s=none&amp;crop=none" media="(min-width: 320px)"><img alt="Passengers prepare to board the first Paris-Berlin high speed train line that started on 16 December." src="https://i.guim.co.uk/img/media/fa0df7fe701b760716b19241f3a70bce12d68a4d/0_268_5616_3370/master/5616.jpg?width=445&amp;dpr=1&amp;s=none&amp;crop=none" width="445" height="267.0316951566952" loading="lazy"></picture></div><figcaption data-spacefinder-role="inline"><span><svg width="18" height="13" viewBox="0 0 18 13"><path d="M18 3.5v8l-1.5 1.5h-15l-1.5-1.5v-8l1.5-1.5h3.5l2-2h4l2 2h3.5l1.5 1.5zm-9 7.5c1.9 0 3.5-1.6 3.5-3.5s-1.6-3.5-3.5-3.5-3.5 1.6-3.5 3.5 1.6 3.5 3.5 3.5z"></path></svg></span><span>Passengers prepare to board the first Paris-Berlin high speed train line that started on 16 December.</span> Photograph: Aurélien Morissard/AP</figcaption></figure><p>I join the debut service from Paris on Monday 16 December, which clocks a travel time of 7hrs 59mins, symbolically important in ushering in a new era of rail travel between the capitals of the EU’s two most populous states. Fast, but some say not fast enough. On board are assorted media and rail industry officials, plus some regular travellers who unwittingly find themselves bit-part players in a piece of railway history. An Australian family on the train is surprised to find garlands, ribbons and gifts. “It’s our first train in Europe. Will we get this on every train?” they ask.</p><p>This new direct Intercity Express (ICE) train from Paris to Berlin leaves from the Gare de l’Est, one-time departure station for such illustrious trains as the Orient Express. On Platform 29 a German ICE train, handsomely turned out for the occasion, is ready for boarding.</p><p>The new train serves just three intermediate cities en route to Berlin: Strasbourg, Karlsruhe and Frankfurt am Main, in the latter case serving a secondary station (Frankfurt Süd) in the city’s trendy Sachsenhausen district. Departure from Paris is at 09.55 with arrival in Berlin Hauptbahnhof scheduled for 17.58. Along the way, travellers experience a fine sweep of European geography as they travel from the Seine to the Spree, crossing six other major rivers along the way: the Moselle, Meuse, Rhine, Neckar, Main and Elbe.</p><p>I am struck by the engaging mix of landscapes. On a fast run east from Paris, the train speeds by Champagne vineyards then crests the Vosges hills in the Saverne tunnel before dropping down to Strasbourg, reached in just 1hr 45mins from the French capital. The Russian train in 2015 took over four hours merely to reach Strasbourg. The city is keen to promote its position as <em>Capitale de Noël</em>, but on this particular Monday, Santa is sidelined by an enthusiastic group of flag-waving Strasbourg <em>députés</em> delighted to see this first direct daytime train to Berlin for nine years.</p><p>A few minutes beyond Strasbourg we cross the Rhine, arriving in Germany at Kehl. Back before the days of Schengen, even the Orient Express was forced to stop at Kehl for customs and immigration formalities. Our ICE to Berlin glides through without slowing. Once in Germany, progress is more measured than on the initial fast leg from Paris to Strasbourg. As we slip through reedy flatlands towards Karlsruhe, with misty views of the Black Forest away to the east, I repair to the restaurant car for that most quintessential of German delicacies: currywurst and chips.</p><figure id="491f3510-1831-40aa-bcbc-10b59496b4e7" data-spacefinder-role="inline" data-spacefinder-type="model.dotcomrendering.pageElements.ImageBlockElement"><div id="img-3"><picture><source srcset="https://i.guim.co.uk/img/media/a02095e945c080a6cc09ac665e5db1845e04ffb9/0_0_6720_4032/master/6720.jpg?width=620&amp;dpr=2&amp;s=none&amp;crop=none" media="(min-width: 660px) and (-webkit-min-device-pixel-ratio: 1.25), (min-width: 660px) and (min-resolution: 120dpi)"><source srcset="https://i.guim.co.uk/img/media/a02095e945c080a6cc09ac665e5db1845e04ffb9/0_0_6720_4032/master/6720.jpg?width=620&amp;dpr=1&amp;s=none&amp;crop=none" media="(min-width: 660px)"><source srcset="https://i.guim.co.uk/img/media/a02095e945c080a6cc09ac665e5db1845e04ffb9/0_0_6720_4032/master/6720.jpg?width=605&amp;dpr=2&amp;s=none&amp;crop=none" media="(min-width: 480px) and (-webkit-min-device-pixel-ratio: 1.25), (min-width: 480px) and (min-resolution: 120dpi)"><source srcset="https://i.guim.co.uk/img/media/a02095e945c080a6cc09ac665e5db1845e04ffb9/0_0_6720_4032/master/6720.jpg?width=605&amp;dpr=1&amp;s=none&amp;crop=none" media="(min-width: 480px)"><source srcset="https://i.guim.co.uk/img/media/a02095e945c080a6cc09ac665e5db1845e04ffb9/0_0_6720_4032/master/6720.jpg?width=445&amp;dpr=2&amp;s=none&amp;crop=none" media="(min-width: 320px) and (-webkit-min-device-pixel-ratio: 1.25), (min-width: 320px) and (min-resolution: 120dpi)"><source srcset="https://i.guim.co.uk/img/media/a02095e945c080a6cc09ac665e5db1845e04ffb9/0_0_6720_4032/master/6720.jpg?width=445&amp;dpr=1&amp;s=none&amp;crop=none" media="(min-width: 320px)"><img alt="The new service reaches Strasbourg from Paris in less than two hours." src="https://i.guim.co.uk/img/media/a02095e945c080a6cc09ac665e5db1845e04ffb9/0_0_6720_4032/master/6720.jpg?width=445&amp;dpr=1&amp;s=none&amp;crop=none" width="445" height="267" loading="lazy"></picture></div><figcaption data-spacefinder-role="inline"><span><svg width="18" height="13" viewBox="0 0 18 13"><path d="M18 3.5v8l-1.5 1.5h-15l-1.5-1.5v-8l1.5-1.5h3.5l2-2h4l2 2h3.5l1.5 1.5zm-9 7.5c1.9 0 3.5-1.6 3.5-3.5s-1.6-3.5-3.5-3.5-3.5 1.6-3.5 3.5 1.6 3.5 3.5 3.5z"></path></svg></span><span>The new service reaches Strasbourg from Paris in less than two hours.</span> Photograph: Hemis/Alamy</figcaption></figure><p>Karlsruhe comes and goes, and now we are sedately running along the flank of the Odenwald, a range of forested hills dotted with attractive villages and vineyards on their western slopes. The Odenwald is one of those blocky uplands, not particularly mountainous in character, which dominate central Germany.</p><p>Beyond Frankfurt, our train follows main rail routes north-east towards the Fulda Gap, taking advantage of a lowland route between the much higher Vogelsberg (to our left) and the Rhön uplands (to our right). Fine views of lovely hill country, then at Kassel we pick up a high-speed line to Hanover, where we swing off to the east and leave the hills behind as we make tracks across the North European Plain towards Berlin. The beauty of this journey is that you get a real feel for changing landscapes.</p><p>Paris to Berlin as the crow flies is about 550 miles. The route taken by the new train runs to 770 miles. So our train averages 96 mph from Paris to Berlin, which is not particularly “high speed” by the standards of French TGV services.</p><figure id="6737d24e-5abe-40bf-8fad-24b83010f994" data-spacefinder-role="inline" data-spacefinder-type="model.dotcomrendering.pageElements.ImageBlockElement"><div id="img-4"><picture><source srcset="https://i.guim.co.uk/img/media/a065225758d1b1aeb392c68784c0a8fc468f5f6d/0_0_3960_2376/master/3960.jpg?width=620&amp;dpr=2&amp;s=none&amp;crop=none" media="(min-width: 660px) and (-webkit-min-device-pixel-ratio: 1.25), (min-width: 660px) and (min-resolution: 120dpi)"><source srcset="https://i.guim.co.uk/img/media/a065225758d1b1aeb392c68784c0a8fc468f5f6d/0_0_3960_2376/master/3960.jpg?width=620&amp;dpr=1&amp;s=none&amp;crop=none" media="(min-width: 660px)"><source srcset="https://i.guim.co.uk/img/media/a065225758d1b1aeb392c68784c0a8fc468f5f6d/0_0_3960_2376/master/3960.jpg?width=605&amp;dpr=2&amp;s=none&amp;crop=none" media="(min-width: 480px) and (-webkit-min-device-pixel-ratio: 1.25), (min-width: 480px) and (min-resolution: 120dpi)"><source srcset="https://i.guim.co.uk/img/media/a065225758d1b1aeb392c68784c0a8fc468f5f6d/0_0_3960_2376/master/3960.jpg?width=605&amp;dpr=1&amp;s=none&amp;crop=none" media="(min-width: 480px)"><source srcset="https://i.guim.co.uk/img/media/a065225758d1b1aeb392c68784c0a8fc468f5f6d/0_0_3960_2376/master/3960.jpg?width=445&amp;dpr=2&amp;s=none&amp;crop=none" media="(min-width: 320px) and (-webkit-min-device-pixel-ratio: 1.25), (min-width: 320px) and (min-resolution: 120dpi)"><source srcset="https://i.guim.co.uk/img/media/a065225758d1b1aeb392c68784c0a8fc468f5f6d/0_0_3960_2376/master/3960.jpg?width=445&amp;dpr=1&amp;s=none&amp;crop=none" media="(min-width: 320px)"><img alt="The service reaches Berlin at about 6pm." src="https://i.guim.co.uk/img/media/a065225758d1b1aeb392c68784c0a8fc468f5f6d/0_0_3960_2376/master/3960.jpg?width=445&amp;dpr=1&amp;s=none&amp;crop=none" width="445" height="267" loading="lazy"></picture></div><figcaption data-spacefinder-role="inline"><span><svg width="18" height="13" viewBox="0 0 18 13"><path d="M18 3.5v8l-1.5 1.5h-15l-1.5-1.5v-8l1.5-1.5h3.5l2-2h4l2 2h3.5l1.5 1.5zm-9 7.5c1.9 0 3.5-1.6 3.5-3.5s-1.6-3.5-3.5-3.5-3.5 1.6-3.5 3.5 1.6 3.5 3.5 3.5z"></path></svg></span><span>The service reaches Berlin at about 6pm.</span> Photograph: Andrey Denisyuk/Getty Images</figcaption></figure><p>Winter darkness falls before Wolfsburg where our speed is tempered by a slower train on the track ahead. We slip by the striking Volkswagen factory in Wolfsburg, partly festooned with Christmas lights and a huge Santa Claus beside the railway. A few moments later we cross the former frontier between the two German states and dash through sparsely populated terrain to Berlin.</p><p>Upon arrival at Berlin Hauptbahnhof, happily a few minutes early, there is a low-key but joyous celebration of all things European. Two leading capitals now linked by a direct and very comfortable daytime ICE train gives good cause for many smiles and handshakes. But many will still ask just why it has taken so very long to launch this service. And how many years will it take before an hour or two can be trimmed from the journey time, so that this new link can offer real competition to air travel.</p><figure id="d634a778-2531-432e-9118-77584dbe4f13" data-spacefinder-role="richLink" data-spacefinder-type="model.dotcomrendering.pageElements.RichLinkBlockElement"><gu-island name="RichLinkComponent" priority="feature" deferuntil="idle" props="{&quot;richLinkIndex&quot;:18,&quot;element&quot;:{&quot;_type&quot;:&quot;model.dotcomrendering.pageElements.RichLinkBlockElement&quot;,&quot;prefix&quot;:&quot;Related: &quot;,&quot;text&quot;:&quot;Winter rail adventures in Europe: three itineraries for the colder months&quot;,&quot;elementId&quot;:&quot;d634a778-2531-432e-9118-77584dbe4f13&quot;,&quot;role&quot;:&quot;richLink&quot;,&quot;url&quot;:&quot;https://www.theguardian.com/travel/2024/nov/30/winter-rail-adventures-europe-itineraries-from-uk-to-germany-france-austria-italy&quot;},&quot;ajaxUrl&quot;:&quot;https://api.nextgen.guardianapps.co.uk&quot;,&quot;format&quot;:{&quot;design&quot;:10,&quot;display&quot;:2,&quot;theme&quot;:4}}"></gu-island></figure><h2 id="way-to-go"><strong>Way to go</strong></h2><p>The new direct ICE leaves the Gare de l’Est in Paris daily at 09.55 and Berlin Hauptbahnhof at 11.54. One-way fares from €59.99 second class or €69.99 first class. On such a long daytime journey the first-class upgrade, if not excessive, is probably money well spent. Purchase online at <a href="https://int.bahn.de/" data-link-name="in body link">int.bahn.de</a> or <a href="https://go.skimresources.com/?id=114047X1572903&amp;url=https%3A%2F%2Fwww.raileurope.com&amp;sref=https://www.theguardian.com/travel/2024/dec/24/paris-to-berlin-by-train-faster-service-via-strasbourg" data-link-name="in body link">raileurope.com</a>. Interrail passes are valid, but pass holders need to pay a supplement (usually €19) on journeys to or from Paris or Strasbourg. This can be bought on Rail Europe.</p><p><strong>Nicky Gardner is lead author of Europe by Rail: The Definitive Guide (18th edition, Hidden Europe, £20.99), available from <a href="https://guardianbookshop.com/europe-by-rail-the-definitive-guide-18th-edition-9783945225042/?utm_source=editoriallink&amp;amp;utm_medium=merch&amp;amp;utm_campaign=article" data-link-name="in body link">guardianbookshop.com</a></strong></p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Intel shareholders file case asking ex CEO, CFO to return 3 years of salary (196 pts)]]></title>
            <link>https://www.cfodive.com/news/intel-shareholders-yank-exceo-cfo-compensation-foundry/736193/</link>
            <guid>42500482</guid>
            <pubDate>Tue, 24 Dec 2024 08:17:54 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.cfodive.com/news/intel-shareholders-yank-exceo-cfo-compensation-foundry/736193/">https://www.cfodive.com/news/intel-shareholders-yank-exceo-cfo-compensation-foundry/736193/</a>, See on <a href="https://news.ycombinator.com/item?id=42500482">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
                        
                        

<h3>Dive Brief:</h3>
<ul>
<li>Intel Corporation shareholders are asking for <a href="https://storage.courtlistener.com/recap/gov.uscourts.cand.441318/gov.uscourts.cand.441318.1.0.pdf">the disgorgement of</a> “all profits, benefits, and other compensation” obtained by ex-CEO Pat Gelsinger, CFO and current co-interim CFO David Zinsner and other company leadership, arguing the leaders breached their fiduciary and contractual duties, according to a shareholder derivative lawsuit filed Tuesday.</li>
<li>Filed in the United States District Court of the Northern District of California, the suit by shareholder LR Trust on behalf of Intel alleges that both Gelsinger and Zinsner breached their fiduciary duties as officers of the company by issuing misleading disclosures and failing to accurately report financials related to the company’s foundry business.&nbsp;Gelsinger and Zinsner, as well as other named defendants, which include both current and past members of the company’s board, “exposed the Company to significant liability under various federal securities laws by their misconduct,” according to the suit.</li>
<li>“As a result of the individual defendants’ breaches of fiduciary duty and other misconduct, Intel has sustained substantial damages and irreparable injury to its reputation,” the suit says, noting that the officers received “unjust enrichment” stemming from their misconduct.</li>
</ul>



<h3>Dive Insight:</h3>
<p>The suit coincides with efforts by the chipmaker to regain the trust of its shareholders after it failed to execute a turnaround plan spearheaded by Gelsinger. A 40-year veteran of the Santa Clara, California-based company, Gelsinger abruptly <a href="https://www.cfodive.com/news/intel-cfo-takes-interim-co-ceo-role-board-ousts-leadership-genAI-layoffs/734506/">resigned from his position as CEO</a> and a member of the board effective Dec. 1 after the company reported a record quarterly loss of $16.6 billion for its third quarter, with losses related to the turnaround efforts, CFO Dive previously reported.</p>
<p>The company subsequently appointed Zinsner and Intel Products CEO Michelle Johnston Holthaus as co-interim CEOs, with Zinsner continuing to serve as CFO, as it continues to move forward with its restructuring efforts, targeting $10 billion in cost savings.</p>
<p>The restructuring, which also includes wide-scale layoffs throughout the business, is also widely focused on the company’s foundry business — a key element of the shareholder derivative suit. &nbsp;</p>
<p>Gelsinger’s turnaround plan included a shift in Intel’s foundry strategy, with the ex-CEO looking to spin off the unit <a href="https://www.cfodive.com/news/core-business-strategy-intact-ceo-intel-cfo-foundry-chips-semiconductors/734767/">into its own independent business</a> with the goal of allowing Intel foundry to produce chips for its competitors, CFO Dive previously reported.</p>
<p>However, Gelsinger, Zinsner and other company leaders misled shareholders about the financial performance of the foundry unit, the suit alleges. Both officers pointed to the foundry unit as a “significant tailwind” for Intel’s business in various statements and company filings, including during the earnings report for the chipmaker’s full-year 2023 results, according to the suit.</p>
<p>However, in a retrospective revision to the company’s financials filed in April, the chipmaker revealed Intel Foundry to be one of its main cost centers — with <a href="https://www.sec.gov/ix?doc=/Archives/edgar/data/0000050863/000005086324000068/intc-20240402.htm">the division losing $7 billion</a> in 2023, according to the filing with the Securities and Exchange Commission. The recast sent Intel’s shares spiraling down by 9.2% at the time, according to the suit. The news was also followed by a class action suit alleging shareholders were mislead regarding those <a href="https://www.theregister.com/2024/06/25/intel_foundry_investor_lawsuit/">losses related to its Foundry business</a>, according to a report at the time by The Register.</p>
<p>As a result, the chipmaker “has been and will continue to be exposed to significant losses due to the wrongdoing complained of herein, yet the board has not caused the company to take action to recover for the company the damages it has suffered and will continue to suffer thereby,” the December shareholder derivative suit alleges.</p>
<p>As well as Zinsner and Gelsinger, the suit named multiple current and former board members as defendants. Other defendants include Lip-Bu Tan, a former member of the board who abruptly stepped down from his position in August due to concerns <a href="https://www.reuters.com/technology/intel-board-member-quit-after-differences-over-chipmakers-revival-plan-2024-08-27/">related to Gelsinger’s turnaround plan</a>, according to a report at the time by Reuters cited by the suit.</p>
<p>The semiconductor manufacturer has remained focused on its foundry business following its leadership shift. Intel is still seeking to be a “world-class foundry,” Zinsner said during a conference a few days after his appointment to co-interim CEO. As such, it’s also likely Gelsinger’s <a href="https://www.cfodive.com/news/core-business-strategy-intact-ceo-intel-cfo-foundry-chips-semiconductors/734767/">permanent successor as CEO</a> will have “some capability” around foundry, he said at the time.</p>
<p>Intel declined to comment on the suit. Weiss Law, the attorneys for the plaintiffs, did not immediately respond to requests for comment.</p>

                    </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[38th Chaos Communication Congress (301 pts)]]></title>
            <link>https://events.ccc.de/congress/2024/infos/index.html</link>
            <guid>42500475</guid>
            <pubDate>Tue, 24 Dec 2024 08:15:49 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://events.ccc.de/congress/2024/infos/index.html">https://events.ccc.de/congress/2024/infos/index.html</a>, See on <a href="https://news.ycombinator.com/item?id=42500475">Hacker News</a></p>
Couldn't get https://events.ccc.de/congress/2024/infos/index.html: Error: timeout of 10000ms exceeded]]></description>
        </item>
        <item>
            <title><![CDATA[The number pi has an evil twin (330 pts)]]></title>
            <link>https://mathstodon.xyz/@johncarlosbaez/113703444230936435</link>
            <guid>42499567</guid>
            <pubDate>Tue, 24 Dec 2024 03:41:22 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://mathstodon.xyz/@johncarlosbaez/113703444230936435">https://mathstodon.xyz/@johncarlosbaez/113703444230936435</a>, See on <a href="https://news.ycombinator.com/item?id=42499567">Hacker News</a></p>
&lt;Unparsable&gt;]]></description>
        </item>
        <item>
            <title><![CDATA[Automating the Search for Artificial Life with Foundation Models (129 pts)]]></title>
            <link>https://sakana.ai/asal/</link>
            <guid>42499332</guid>
            <pubDate>Tue, 24 Dec 2024 02:47:47 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://sakana.ai/asal/">https://sakana.ai/asal/</a>, See on <a href="https://news.ycombinator.com/item?id=42499332">Hacker News</a></p>
<div id="readability-page-1" class="page"><article>
  <header>
  <h2><a href="https://sakana.ai/asal/">Automating the Search for Artificial Life with Foundation Models</a></h2><time datetime="2024-12-24T00:00:00+09:00">December 24, 2024</time>
</header>

  <center>
<video src="https://pub.sakana.ai/asal_blog_assets/cover_video_square_small_compressed.mp4" type="video/mp4" autoplay="" muted="" playsinline="" loop=""></video>
<!--<video class="b-lazy" autoplay="" muted="" playsinline="" loop="" style="display: block; margin: auto; width: 100%;"><source src="https://pub.sakana.ai/asal_blog_assets/cover_video_square_small_compressed.mp4" /></video>-->
</center>
<!--more-->
<p><small><b>Examples of discovered artificial lifeforms.</b></small><br>
<small><i>We show examples of the simulations discovered by our algorithm, <b>Automated Search for Artificial Life</b> (<b><a href="https://arxiv.org/abs/2412.17799">Paper</a></b>, <b><a href="https://asal.sakana.ai/">Website</a></b>). In Lenia (top-left), ASAL discovers a diverse set of dynamic self-organizing patterns reminiscent of real cells. In Boids (top-right), ASAL discovers exotic emergent flocking behavior. In Particle Life and Particle Life++ (bottom-left), ASAL discovers dynamic open-ended ecosystems of agentic patterns. In Game of Life (bottom-right), ASAL identifies novel cellular automata rules that are more open-ended and expressive than the original Conway’s Game of Life.</i></small></p>



<h2 id="introduction">Introduction</h2>

<p>For the past 300,000 years, Earth has had only one form of advanced intelligence on it: humans. With the recent advent of AI foundation models, some believe we are at the dawn of a new kind of intelligence. As AI continues to evolve, we may witness the proliferation of diverse intelligent lifeforms coexisting with us.</p>

<p>But how did we get here in the first place? What fundamental principles govern the emergence of all life and intelligence, whether biological or artificial? What might the open-ended evolution of the ecosystem of our AI agents look like in the future? Though we don’t yet have the definitive answers to these questions, we can gain insight by returning to the scientific field that laid the groundwork for exploring these questions: <em>Artificial Life</em> (ALife). ALife offers the tools and framework to study the dynamics of artificial lifeforms, fostering insights into their potential behaviors, interactions, and trajectories.</p>

<p>So what is ALife? At its core, ALife is the ambitious quest to recreate and understand the phenomena of life itself—how it emerges, evolves, and thrives. It’s not just about mimicking Earth’s biology but going beyond and creating completely alien worlds to understand the principles that underlie all possible life. ALife researchers craft virtual ecosystems, robotic organisms, self-replicating programs, and biochemical simulations to uncover the deep mechanisms of complexity, evolution, and intelligence.</p>

<p>Sakana AI has previously drawn ideas from ALife to develop better foundation models, resulting in our works on <a href="https://sakana.ai/evolutionary-model-merge/">evolutionary model merging</a>, <a href="https://sakana.ai/llm-squared/">LLM self-play</a>, and <a href="https://sakana.ai/ai-scientist/">autonomous open-ended discovery</a>. But now we want to go the other way: <em>can foundation models help the study of ALife</em>? Bridging this two-way road will be essential to getting more capable, natural systems and for understanding them as well. Regardless of whether or not you think foundation models will lead to the next generation of artificial lifeforms, they have already started revolutionizing various scientific fields. In fact, the recent Nobel Prize was awarded for radical advances in protein discovery, driven by a foundation model. They are also being used to predict the climate, do AI research itself, and prove mathematical theorems, so why not apply them to help in the search for artificial lifeforms?</p>


<center>
<video autoplay="" muted="" playsinline="" loop=""><source src="https://pub.sakana.ai/asal_blog_assets/teaser.mp4" type="video/mp4"></video>
</center>


<p>In collaboration with <strong>MIT</strong>, <strong>OpenAI</strong>, <strong>The Swiss AI Lab IDSIA</strong>, and <b><a href="https://en.wikipedia.org/wiki/Kenneth_Stanley">Ken Stanley</a></b>, we are excited to release our new paper, <strong><a href="https://arxiv.org/abs/2412.17799">Automating the Search for Artificial Life with Foundation Models</a></strong> (<strong><a href="https://pub.sakana.ai/asal/">website</a></strong>).</p>

<p>In our paper, we propose a new algorithm called <strong>Automated Search for Artificial Life</strong> (“<strong>ASAL</strong>”) to <em>automate</em> the discovery of artificial life using vision-language foundation models! Our proposed approach aims to <strong>(1)</strong> find simulations that produce a specific target behavior, <strong>(2)</strong> discover simulations that keep generating novelty forever as you run it, and <strong>(3)</strong> illuminate all the different simulations that are possible.</p>


<center>
<video autoplay="" muted="" playsinline="" loop=""><source src="https://pub.sakana.ai/asal_blog_assets/supervised_3x6_compressed.mp4" type="video/mp4"></video>
</center>
<p><small>
<i><b>Finding lifeforms that produce a specific target behavior:</b> Here, we present examples of Artificial Life simulations, discovered by <b>ASAL</b>, which were found only with specified target prompts. Read on to see more results below in this blog post!
</i></small></p>


<p>Because of the generality of foundation models, ASAL can discover new lifeforms across a diverse range of seminal ALife simulations, including Boids, Particle Life, Game of Life, Lenia, and Neural Cellular Automata. ASAL even discovered novel cellular automata rules that are more open-ended and expressive than the original Conway’s Game of Life. Additionally, the use of foundation models allows us to quantifiably measure previously qualitative phenomena, in a human-aligned way.</p>

<p>We believe this new paradigm may reignite ALife research by overcoming the bottleneck of manually designed simulations, thus advancing beyond the limits of human ingenuity.</p>



<h2 id="what-is-artificial-life">What is Artificial Life?</h2>

<div><p><small>
<img data-src="/assets/asal/chatgpt-alife.jpg" src="https://sakana.ai/assets/asal/chatgpt-alife.jpg">
<i>ChatGPT-generated image with the prompt “the open-endedness of evolution on earth producing all the diversity of life”.
</i></small></p></div>

<p>Natural evolution has produced the vast diversity of life on Earth, from bacteria to whales and humans. Artificial Life (ALife) seeks to understand this open-ended process of life by recreating it through computer simulations. While inspired by biology, ALife’s ambitions extend far beyond, exploring not only “life as we know it” but also “<em><a href="https://en.wikipedia.org/wiki/Artificial_life#Philosophy">life as it could be</a>.</em>” Over time, ALife has grown to study the general emergence of complex behaviors from simple components, encompassing phenomena such as self-organization, collective intelligence, and open-ended evolution.</p>

<p>Using ALife, we can study some intriguing questions:</p>

<ul>
  <li>What exactly is “life”?
    <ul>
      <li>What lifeforms can exist in a hyper-realistic 3D world simulation?</li>
      <li>What does life even look like in a cellular automata?</li>
      <li>How does life emerge in a digital soup of self-replicating computer programs?</li>
    </ul>
  </li>
  <li>If we slightly change the environment’s rules, is life still possible? When is it inevitable?</li>
  <li>What is required to ignite a “never-ending” algorithm similar to natural evolution?</li>
</ul>

<p>The last question touches on perhaps the most fascinating property of natural evolution: open-endedness. The pursuit of truly open-ended systems capable of discovering interesting artifacts indefinitely remains so elusive that it is widely regarded as a <a href="https://www.oreilly.com/radar/open-endedness-the-last-grand-challenge-youve-never-heard-of/">grand challenge</a>.</p>




<p><small><i><b><a href="https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life">John Conway’s Game of Life</a></b> (CGoL) is a simulation of a 2D grid with rules like “a dead cell with 3 alive neighbors becomes alive in the next timestep”. With only these simple rules, CGoL is able to simulate entire self-replicating “spaceships”. It can even simulate CGoL within itself!</i></small></p>

<div><p><small><i><b><a href="https://www.karlsims.com/evolved-virtual-creatures.html">Karl Sim’s Evolved Virtual Creatures</a></b> is a masterclass in discovering artificial lifeforms in a 3D virtual world. Similar to real animals, these artificial animals have DNA that encodes the morphology and the brain of the animal. Then, the DNA can be evolved with a genetic algorithm to produce phenotypes capable of swimming, walking, and jumping.</i></small></p></div>


<p><small><i><b>Other ALife projects:</b> Many more ALife simulations have been developed. Some model ecosystems of cells, while others simulate the evolutionary arms race of predators and prey as they forage for resources. Self-play, which bootstraps capabilities from scratch, is inspired by these evolutionary dynamics.</i></small></p>



<h2 id="our-method-automated-search-for-artificial-life-asal">Our Method: Automated Search for Artificial Life (ASAL)</h2>

<p>The most compelling ALife simulations took months, if not years, to hand-design. This is because the emergent behavior of complex systems <a href="https://en.wikipedia.org/wiki/Computational_irreducibility">is often impossible to predict in advance</a>. Imagine the challenge of designing the periodic table from scratch, manually specifying the pairwise interactions of all elements. Finding the exact configuration that leads to interesting outcomes would be a nearly endless task. Now, imagine instead that you could simply define the number of elements—say, 100—and let an algorithm automatically discover the interaction rules that produce fascinating emergent simulations.</p>


<center>
<img data-src="/assets/asal/methods_figure.png" src="https://sakana.ai/assets/asal/methods_figure.png">
</center>
<div><p><small><i>
<b>ASAL</b>: Our proposed framework, ASAL, uses vision-language foundation models to discover ALife simulations by formulating the processes as three search problems. <b>Supervised Target</b>: To find target simulations, ASAL searches for a simulation which produces a trajectory in the foundation model space that aligns with a given sequence of prompts. <b>Open-Endedness</b>: To find open-ended simulations, ASAL searches for a simulation which produces a trajectory that has high historical novelty during each timestep. <b>Illumination</b>: To illuminate the set of simulations, ASAL searches for a set of diverse simulations which are far from their nearest neighbor.</i>
</small></p></div>

<p>This is the new paradigm we propose for ALife research. Once the researcher defines a space of simulations, or “substrate,” to search over, ASAL automates the search for interesting simulations that, when run, produce videos matching desired criteria, as evaluated by a vision-language foundation model. The criteria include:</p>

<ol>
  <li>
    <p><strong>Supervised Target</strong>: Searching for a simulation that produces a specified target event or sequence of events, facilitating the discovery of arbitrary worlds or those similar to our own.</p>
  </li>
  <li>
    <p><strong>Open-Endedness</strong>: Searching for a simulation that itself produces novelty in the foundation model representation space as you run it, thereby discovering worlds that are persistently interesting to a <em>human observer</em>.</p>
  </li>
  <li>
    <p><strong>Illumination</strong>: Searching for a set of interestingly diverse simulations, enabling the <a href="https://arxiv.org/abs/1504.04909">illumination</a> of all the possible alien worlds.</p>
  </li>
</ol>

<p>Here are some simulations ASAL discovered after specifying a single prompt, which is a text description of the image the simulation should create. In Lenia, prompts like “a self-replicating pattern” revealed dynamic structures mimicking biological processes, while Boids captured emergent behaviors such as “collective intelligence” and “a Fibonacci spiral in nature”. Particle Life produced visually compelling patterns like “cell division” and “a diverse ecosystem of cells”, highlighting ASAL’s ability to turn abstract concepts into concrete simulations that evoke both scientific and artistic intrigue.</p>


<center>
<video autoplay="" muted="" playsinline="" loop=""><source src="https://pub.sakana.ai/asal_blog_assets/supervised_3x6_compressed.mp4" type="video/mp4"></video>
</center>


<p>Multiple prompts can be applied sequentially to find simulations producing a desired sequence of events. In the first simulation, ASAL discovered an update rule which allows a cell to split into two. The second simulation showcases ASAL’s level of control and its potential to eventually discover simulations displaying long and complex evolutionary trajectories. However, our work has not yet achieved this ultimate vision, and more progress is needed before truly fascinating worlds can be discovered solely through specified text descriptions.</p>


<center>
<video autoplay="" muted="" playsinline="" loop=""><source src="https://pub.sakana.ai/asal_blog_assets/nca_temporal.mp4" type="video/mp4"></video>
</center>

<p>For Open-endedness, ASAL discovered several simulations which are more open-ended than the famous Conway’s Game of Life (CGoL). If people have found spaceships and computers in CGoL, imagine what we could discover in these new cellular automata worlds!</p>


<center>
<video autoplay="" muted="" playsinline="" loop=""><source src="https://pub.sakana.ai/asal_blog_assets/oe_gol_1.mp4" type="video/mp4"></video>
</center>


<p>ASAL can also illuminate the entire substrate to find a set of interestingly different simulations as shown here. This provides researchers with a general overview of what may be possible in a given substrate and serves as a step toward taxonomizing all potential life forms within the computational universe.</p>


<center>
<video autoplay="" muted="" playsinline="" loop=""><source src="https://pub.sakana.ai/asal_blog_assets/atlas_lenia_cropped.mp4" type="video/mp4"></video>
<video autoplay="" muted="" playsinline="" loop=""><source src="https://pub.sakana.ai/asal_blog_assets/atlas_boids_cropped_compressed.mp4" type="video/mp4"></video>
</center>



<h2 id="what-now">What Now?</h2>

<p>ASAL is an exciting achievement, but there’s lots more to be done…by you! We open source our code on our <a href="https://github.com/SakanaAI/asal">GitHub</a>.</p>



<h3 id="try-your-own-substrate"><strong>Try your own substrate</strong></h3>

<p>We encourage you to apply ASAL to your own custom substrates you find interesting and explore what happens!</p>

<p>Here, we develop a novel substrate “Particle Life++” based on Particle Life, but which allows the colors to change as part of the dynamics rule, allowing for a combinatorial explosion in interaction dynamics. Out of the box, ASAL is able to find open-ended simulations in this substrate:</p>


<center>
<video autoplay="" muted="" playsinline="" loop=""><source src="https://pub.sakana.ai/asal_blog_assets/plife_plus_oe_compressed.mp4" type="video/mp4"></video>
</center>


<p>It would be very interesting to see ASAL applied to other substrates like <a href="https://www.youtube.com/watch?v=qwbMGPkoJmg">ALIEN</a> and <a href="https://arxiv.org/abs/2409.00853">JaxLife</a>!</p>



<h3 id="room-for-creative-exploration"><strong>Room for creative exploration</strong></h3>

<p>After discovering some cool simulations, there is a lot of room for creativity and exploration. For example, here, we take the many “species” of Boids creatures discovered, and allow them to enter each other’s universes after a period of time. We can see some symbiotic relationships emerge, while some relationships are more invasive and destructive:</p>


<center>
<video autoplay="" muted="" playsinline="" loop=""><source src="https://pub.sakana.ai/asal_blog_assets/boids_mush.mp4" type="video/mp4"></video>
</center>
<div><p>
Similarly, we can also compare different cellular automata by pitting them against each other to see which one dominates the most territory:
</p></div>
<center>
<video autoplay="" muted="" playsinline="" loop=""><source src="https://pub.sakana.ai/asal_blog_assets/gol_mush_large_compressed.mp4" type="video/mp4"></video>
</center>



<h3 id="bigger-picture"><strong>Bigger picture</strong></h3>

<p>Overall, our ASAL framework will allow for the automated discovery of many new kinds of artificial lifeforms. In turn, this will help us understand the general principles of life and all complex systems, adding to our knowledge of concepts like emergence, computational irreducibility, assembly theory, and open-endedness.</p>

<p>In the bigger picture, we believe ALife is worth researching because there are a lot of important ideas from ALife that can be and should be incorporated into AI. For instance, the next generation of AI algorithms will likely incorporate concepts like open-endedness, self-organization, and collective intelligence in order to be more adaptive, creative, and continually learn. By bridging ALife and AI, we as a field have the unique opportunity to unlock a new era of natural AI systems.</p>


<center>
<img data-src="/assets/asal/ending.jpg" src="https://sakana.ai/assets/asal/ending.jpg">
</center>




<p>Interested in joining us? Please see our <a href="https://sakana.ai/careers/">career opportunities</a> for more information.</p>



  
</article></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Demystifying Debuggers, Part 2: The Anatomy of a Running Program (134 pts)]]></title>
            <link>https://www.rfleury.com/p/demystifying-debuggers-part-2-the</link>
            <guid>42498982</guid>
            <pubDate>Tue, 24 Dec 2024 01:33:31 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.rfleury.com/p/demystifying-debuggers-part-2-the">https://www.rfleury.com/p/demystifying-debuggers-part-2-the</a>, See on <a href="https://news.ycombinator.com/item?id=42498982">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><article><div dir="auto"><p>From day one using a modern home computer, users are exposed to the concept of a program. Support for separate programs is, after all, the main value-add of multitasking operating systems. But—if we take a peek under the hood—a program is a high-level term which refers to many lower level mechanisms and concepts, and it isn’t obvious from the outset how they’re all arranged.</p><p>To unpack debuggers—programs which analyze the execution of other programs—it’s important that we first unpack the concept of a program, so that we’re familiar with the details of programs that a debugger must contend with.</p><p>Programs are the virtualized equivalent of cartridges for an old video game console, like the Nintendo Entertainment System. The NES didn’t have a multitasking operating system, and it only executed a single program while it was turned on—whatever one was stored on the cartridge that the player installed.</p><p>In this context, the program executing on the system had full availability to all of the system’s resources. There was no code running of which the program couldn’t be aware.</p><p><span>Programs, in the context of a multitasking operating system, are a bundle of mechanisms used to approximately provide the same thing </span><em>virtually</em><span> as the NES provided to the program stored on the cartridge </span><em>physically</em><span>. Of course, multitasking operating systems also provide ways for these programs to communicate and interact (that is indeed the point), but at some level they must still exist independently, as different physical cartridges do.</span></p><p><span>Because programs, unlike cartridges, can be executing on the same chip </span><em>at the same time</em><span>, and thus contend for the same resources, there are many additional </span><em>software</em><span> concepts that operating systems use to virtualize independent program execution:</span></p><ul><li><p><span>A </span><em><strong>virtual address space</strong></em><span> — A range of </span><em>virtual addresses</em><span>, for which the platform provides a mapping to </span><em>physical addresses</em><span>. Programs are built to interact with </span><em>virtual addresses, </em><span>which are entirely independent from addresses in other virtual address spaces. Virtual address spaces can be much </span><em>larger</em><span> than, for example, physical RAM limitations.</span></p></li><li><p><span>A </span><em><strong>thread of execution</strong></em><span> — A bundle of state which is used to initialize the CPU to coherently execute a sequence of instructions. Threads of execution are </span><em>scheduled</em><span> by the platform, such that many threads can execute on a small, fixed number of </span><em>cores</em><span>.</span></p></li><li><p><span>An </span><em><strong>executable image</strong></em><span> — A sequence of bytes encoding data in a platform-defined format, to encode executable machine instructions, as well as relevant headers and metadata. An independent code package’s </span><em>non-live</em><span> representation—a blueprint for execution.</span></p></li><li><p><span>A </span><em><strong>loader</strong></em><span> — The part of an operating system responsible for parsing </span><em>executable images</em><span>—blueprints for execution—and instantiating them, so that the code encoded in the images may be actually executed.</span></p></li><li><p><span>A </span><em><strong>module</strong></em><span> — The loaded equivalent of an </span><em>executable image</em><span>. One </span><em>process</em><span> can load several </span><em>modules</em><span>, although a process is always initialized by the loading of </span><em>one specific module</em><span> (the initial executable image). Modules can be both dynamically </span><em>loaded</em><span> and </span><em>unloaded</em><span>.</span></p></li><li><p><span>A </span><em><strong>process</strong></em><span> — An instance of a live, running program. Instantiated by the platform’s </span><em>loader</em><span> using the initial </span><em>executable image</em><span> to determine how it’s initialized, and what code is initially loaded. The granularity at which operating systems assign </span><em>virtual address spaces</em><span>. The container of several </span><em>modules</em><span>, and </span><em>threads of execution</em><span>.</span></p></li></ul><p>Let’s unpack all of this.</p><blockquote><p><em>A range of virtual addresses, for which the platform provides a mapping to physical addresses. Programs are built to interact with virtual addresses, which are entirely independent from addresses in other virtual address spaces. Virtual address spaces can be much larger than, for example, physical RAM limitations.</em></p></blockquote><p><span>Whether it’s through the easy or hard way, all programmers learn about pointers. When I first learned about pointers, I understood them as being used to encode integers, with the integers being addresses, which address bytes within memory, in linear order. Address </span><code>0</code><span> comes before </span><code>1</code><span>, which comes before </span><code>2</code><span>, and so on.</span></p><p>In other words, I was under the impression that physical memory, and its relationship to addresses, was structured like this:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbf0d7080-b386-4391-95f7-4b7f3a98aa46_1398x1137.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbf0d7080-b386-4391-95f7-4b7f3a98aa46_1398x1137.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbf0d7080-b386-4391-95f7-4b7f3a98aa46_1398x1137.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbf0d7080-b386-4391-95f7-4b7f3a98aa46_1398x1137.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbf0d7080-b386-4391-95f7-4b7f3a98aa46_1398x1137.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbf0d7080-b386-4391-95f7-4b7f3a98aa46_1398x1137.png" width="568" height="461.9570815450644" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/bf0d7080-b386-4391-95f7-4b7f3a98aa46_1398x1137.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1137,&quot;width&quot;:1398,&quot;resizeWidth&quot;:568,&quot;bytes&quot;:302713,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbf0d7080-b386-4391-95f7-4b7f3a98aa46_1398x1137.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbf0d7080-b386-4391-95f7-4b7f3a98aa46_1398x1137.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbf0d7080-b386-4391-95f7-4b7f3a98aa46_1398x1137.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbf0d7080-b386-4391-95f7-4b7f3a98aa46_1398x1137.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>This is a fine mental model to begin with. But it isn’t accurate.</p><p><span>When many independent programs execute on a single machine, it isn’t difficult to imagine one of them getting an address wrong. In fact, sometimes, it feels like “getting addresses wrong” is the only thing anybody talks about these days. If all of these programs shared a single memory space, this could easily lead to one program stomping over data that another program is using. It could also lead to, for example, a </span><em>malicious program</em><span>—let’s call it </span><code>ryans_game.exe</code><span>—reading information from </span><code>chrome.exe</code><span>, browsing a page from </span><code>chase.com</code><span> with all of your sensitive information on it. This is purely hypothetical!</span></p><p><em>Virtual address spaces</em><span> are used to mediate between different programs accessing the same resource—physical memory. Addresses </span><em>can</em><span> be understood as integers, and as such, they </span><em>are</em><span> linearly ordered, and they </span><em>do</em><span> each refer to sequential bytes—but these bytes are sequential in </span><em>virtual address space</em><span>, not in </span><em>physical memory</em><span>.</span></p><p><span>Virtual address spaces are implemented with a mapping data structure known as a </span><em>page table</em><span>. Page tables can be used to translate a virtual address to a physical address. They can then be used directly by the CPU in order to do address translation. For instance, if a CPU core were to execute a </span><code>mov</code><span> (move) instruction, to load 8 bytes from address </span><code>0x1000</code><span> into a register, then before issuing a read from physical memory, the CPU would first treat </span><code>0x1000</code><span> as a </span><em>virtual address</em><span>, and translate it into a </span><em>physical address, </em><span>which might be completely different—like </span><code>0x111000</code><span>.</span></p><p><span>“Page tables” are called as such, because they map from virtual to physical addresses at </span><em>page-size granularity</em><span>. A system’s page-size varies—on an x64 Windows PC, it’ll be 4 kilobytes. On an iPhone, it’ll be 16 kilobytes. Operating systems also expose larger page sizes under some circumstances.</span></p><p><span>This means the relationship between physical memory and an address—as used by a program, as a </span><em>virtual address</em><span>—looks more like this:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2ee85c0c-2624-4ffb-9810-633b75e933b6_1533x1377.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2ee85c0c-2624-4ffb-9810-633b75e933b6_1533x1377.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2ee85c0c-2624-4ffb-9810-633b75e933b6_1533x1377.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2ee85c0c-2624-4ffb-9810-633b75e933b6_1533x1377.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2ee85c0c-2624-4ffb-9810-633b75e933b6_1533x1377.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2ee85c0c-2624-4ffb-9810-633b75e933b6_1533x1377.png" width="602" height="540.8076923076923" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/2ee85c0c-2624-4ffb-9810-633b75e933b6_1533x1377.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1308,&quot;width&quot;:1456,&quot;resizeWidth&quot;:602,&quot;bytes&quot;:509363,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2ee85c0c-2624-4ffb-9810-633b75e933b6_1533x1377.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2ee85c0c-2624-4ffb-9810-633b75e933b6_1533x1377.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2ee85c0c-2624-4ffb-9810-633b75e933b6_1533x1377.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2ee85c0c-2624-4ffb-9810-633b75e933b6_1533x1377.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>If a virtual address </span><em>cannot be mapped</em><span> to a physical address, then a “page fault” exception is issued by the CPU, and execution is interrupted. If this is done by a program’s code, then execution will be transferred to the operating system’s code, which can take measures to address the cause of the exception and resume, or do whatever else it deems appropriate.</span></p><p>This provides a great deal of flexibility to operating systems. An operating system can move memory allocated by one program to disk—what’s known as “paging out”, or “swapping out”—if it expects that memory to not be accessed in the near future. It can then use that physical memory for more frequently accessed addresses, in any of the active virtual address spaces. If a page fault occurs when code attempts to access memory which has been paged out, then the operating system can simply page that memory back in, and resume execution. Thus, even though hundreds—if not thousands—of programs can be executing at once, the operating system can make much more efficient use of physical memory, given its analysis of which addresses in which spaces are needed, and when. This is critical in building operating systems which can support the execution of many programs, where all programs are contending for the same physical hardware.</p><p><span>It also provides a great deal of flexibility to programs, as it can be used to implement virtual address spaces which are </span><em>much larger</em><span> than physical memory. Nowadays, nearly every consumer CPU—from phones, to game consoles, to PCs, to laptops—is a 64-bit processor. For PCs and laptops running on 64-bit CPUs, the CPU and operating system normally provide a 48-bit address space. On some server systems, it is larger, and on some mobile and console platforms, it is smaller.</span></p><p><span>Taking a 48-bit address space as an example—48 bits allow the representation of 2</span><sup>48</sup><span> different values (each bit multiplies the number of possible values by 2). Since each value refers to a different potential byte, that is enough address space to refer to 256 terabytes.</span></p><p>To understand this further, let’s dissect the “page table” data structure a bit more.</p><p><span>First, let’s assume a 48-bit address space, and a 4 kilobyte page size (the usual configuration on x64 Windows systems). As I said, page tables map from virtual to physical addresses at </span><em>page-size granularity</em><span>. Because of our 4 kilobyte page size, we can infer that the bottom 12 bits of any address are </span><em>identical</em><span> for both a virtual address and a physical address (2</span><sup>12</sup><span> = 4096 = 4 kilobytes).</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F18d8c36d-3abc-4faf-9d4a-f525f7a8dc9d_1572x633.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F18d8c36d-3abc-4faf-9d4a-f525f7a8dc9d_1572x633.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F18d8c36d-3abc-4faf-9d4a-f525f7a8dc9d_1572x633.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F18d8c36d-3abc-4faf-9d4a-f525f7a8dc9d_1572x633.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F18d8c36d-3abc-4faf-9d4a-f525f7a8dc9d_1572x633.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F18d8c36d-3abc-4faf-9d4a-f525f7a8dc9d_1572x633.png" width="1456" height="586" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/18d8c36d-3abc-4faf-9d4a-f525f7a8dc9d_1572x633.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:586,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:293389,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F18d8c36d-3abc-4faf-9d4a-f525f7a8dc9d_1572x633.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F18d8c36d-3abc-4faf-9d4a-f525f7a8dc9d_1572x633.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F18d8c36d-3abc-4faf-9d4a-f525f7a8dc9d_1572x633.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F18d8c36d-3abc-4faf-9d4a-f525f7a8dc9d_1572x633.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>This leaves 36 remaining bits, of each address, to map from virtual to physical addresses. These bits are used to index into several hierarchical levels, within the page table—it is actually a hierarchical data structure, despite its name, which sounds like it implies a flat table. To understand why, imagine, first, a naïve page table implementation, which simply stores a 64-bit physical address, for each value in this 36-bit space. This, unsurprisingly, would require an unrealistically large amount of storage. Instead, we can notice that the page table need only map virtual addresses </span><em>which have actually been allocated</em><span>. At the outset, </span><em>none</em><span> are allocated. When a virtual address space allocation is made, a hierarchical data structure allows the page table implementation to </span><em>only</em><span> allocate nodes in the hierarchy which are actually touched, by that one allocation.</span></p><p>Each node in the hierarchy can simply be a table of 64-bit addresses which point to children nodes (or, at the final level, it can store each page’s physical address). If each node is a 512-element table, and each element is a 64-bit address (8 bytes), then each node requires 4096 bytes, which is our page-size!</p><p><span>Because 2</span><sup>9</sup><span> = 512, we can slice our 36-bits into </span><em>4</em><span> table indices—each 9 bits—and use that to traverse the page table. The first 9 bits indexes into the first level, the next into the second, the next into the third, the next into the fourth—the fourth provides the base address of the containing page of our address, and then the bottom 12 bits can be used as an offset from that base.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6f29652e-7a7a-4a0c-a6f3-8c90134f7976_2048x2048.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6f29652e-7a7a-4a0c-a6f3-8c90134f7976_2048x2048.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6f29652e-7a7a-4a0c-a6f3-8c90134f7976_2048x2048.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6f29652e-7a7a-4a0c-a6f3-8c90134f7976_2048x2048.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6f29652e-7a7a-4a0c-a6f3-8c90134f7976_2048x2048.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6f29652e-7a7a-4a0c-a6f3-8c90134f7976_2048x2048.png" width="1456" height="1456" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/6f29652e-7a7a-4a0c-a6f3-8c90134f7976_2048x2048.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1456,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:1042833,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6f29652e-7a7a-4a0c-a6f3-8c90134f7976_2048x2048.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6f29652e-7a7a-4a0c-a6f3-8c90134f7976_2048x2048.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6f29652e-7a7a-4a0c-a6f3-8c90134f7976_2048x2048.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6f29652e-7a7a-4a0c-a6f3-8c90134f7976_2048x2048.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>For each virtual address space, the operating system manages this page table structure. Before the operating system prepares the CPU to execute code for one program, it can supply this table, such that the CPU can appropriately issue memory reads and writes to </span><em>physical </em><span>addresses for the appropriate virtual address space. The end result is that each program can, in effect, live in its own universe of virtual addresses, as if it had access to the entire system’s memory space, and if that memory space far exceeded the limitations of a system’s random access memory (RAM) capacity.</span></p><blockquote><p><em>A bundle of state which is used to initialize the CPU to cohesively execute a sequence of instructions. Threads of execution are scheduled by the platform, such that many threads can execute on a small, fixed number of cores.</em></p></blockquote><p><span>Beyond a page table, a CPU core requires other information to coherently execute code. For instance, it requires the “instruction pointer” (or “program counter”)—this is a register, which stores the virtual address of the next instruction which should execute, in a given instruction stream. After each instruction is executed, the value in this register is updated to reflect the base address of the next subsequent instruction. On x64, this is known as the </span><code>rip</code><span> register.</span></p><p>When using a debugger, you’ll often see golden arrows, pointing to lines of source code or disassembly. This directly visualizes the location of the instruction pointer.</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe21e4ab3-7d54-4384-9722-9b4552b406da_1419x248.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe21e4ab3-7d54-4384-9722-9b4552b406da_1419x248.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe21e4ab3-7d54-4384-9722-9b4552b406da_1419x248.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe21e4ab3-7d54-4384-9722-9b4552b406da_1419x248.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe21e4ab3-7d54-4384-9722-9b4552b406da_1419x248.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe21e4ab3-7d54-4384-9722-9b4552b406da_1419x248.png" width="1419" height="248" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/e21e4ab3-7d54-4384-9722-9b4552b406da_1419x248.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:248,&quot;width&quot;:1419,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:42198,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe21e4ab3-7d54-4384-9722-9b4552b406da_1419x248.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe21e4ab3-7d54-4384-9722-9b4552b406da_1419x248.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe21e4ab3-7d54-4384-9722-9b4552b406da_1419x248.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe21e4ab3-7d54-4384-9722-9b4552b406da_1419x248.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>There are several other registers, used for a variety of purposes, including general purpose slots for computations. The state of </span><em>all</em><span> such registers is called a “register state”, or “register file”. One register state is paired exclusively with one instruction stream, from one program—a register state should only change if a single instruction stream performs work which causes it.</span></p><p><span>But a CPU has only a fixed number of cores, be it 1, 2, 4, 8, 12, 16, 32, and so on—yet operating systems support a much larger number of programs executing simultaneously. Or, at least, it </span><em>seems</em><span> like they execute simultaneously.</span></p><p><span>The operating system implements this illusion—of hundreds if not thousands (if not more—unfortunately…) programs running simultaneously on a small, fixed number of cores—by </span><em>scheduling</em><span> </span><em>work</em><span> from these programs. One CPU core will perform work for one program, for some period of time—it will be interrupted, and the operating system can make the decision to schedule work from another program, for example.</span></p><p><span>A </span><em>thread of execution</em><span> is the name given to the execution state for one instruction stream. Each contains one register state, which includes the instruction pointer, and thus a stream of instructions—among whatever other state each operating system deems appropriate.</span></p><p><span>In other words, operating systems do not just schedule </span><em>programs</em><span>—they schedule </span><em>threads</em><span>. When an operating system </span><em>schedules a thread</em><span>, it incurs a “context switch”—this is the process of storing the CPU core state for whatever thread </span><em>was executing </em><span>to memory, and initializing that core to execute work for the thread which </span><em>will execute</em><span>.</span></p><blockquote><p><em>A sequence of bytes encoding data in a platform-defined format, to encode executable machine instructions, as well as relevant headers and metadata. An independent code package’s non-live representation—a blueprint for execution.</em></p></blockquote><p><span>On Windows, you’ll find executable images stored on the filesystem with a </span><code>.exe</code><span>, or a </span><code>.dll</code><span> extension. These files are stored in the </span><a href="https://learn.microsoft.com/en-us/windows/win32/debug/pe-format" rel="">Portable Executable (PE) format</a><span>. The difference between </span><code>.exe</code><span> and </span><code>.dll</code><span> is that the former is used to signify that an executable image is a viable </span><em>initial module</em><span> for a process, whereas the latter is used to signify that an executable image is only to be loaded dynamically as an </span><em>additional module</em><span> for a process.</span></p><p><span>On Linux systems, there is a similar structure—executable images are stored on the filesystem (the extension convention varies—sometimes there is no extension for the equivalent of Windows’ </span><code>.exe</code><span>, sometimes there is a </span><code>.elf</code><span> extension, and for the equivalent of Windows’ </span><code>.dll</code><span>, the extension is generally </span><code>.so</code><span>). These files are stored in the </span><a href="https://en.wikipedia.org/wiki/Executable_and_Linkable_Format" rel="">Executable and Linkable Format (ELF)</a><span>.</span></p><p><span>When I say “these files are stored in” a particular format, what I mean is that the associated operating system’s </span><em>loader</em><span> expects files in that format. In order to produce code which can be loaded on a platform out-of-the-box, one must package that code in the format which is expected by that platform.</span></p><p>It’s not in this series’ scope to comprehensively dissect either the PE or the ELF formats. But to justify the definition and concepts I’ve provided, let’s investigate the PE format using a simple example.</p><p>First, consider the following code:</p><pre><code>// sample.c

void WinMainCRTStartup(void)
{
  int x = 0;
}</code></pre><p>This can be built with the following command, using the Visual Studio Build Tools:</p><pre><code>cl /nologo /Zi sample.c /link /NODEFAULTLIB /INCREMENTAL:NO /SUBSYSTEM:WINDOWS</code></pre><p>This command will produce an executable image, containing machine code. This machine code could be disassembled (for instance, using a debugger)—that would show something like this:</p><pre><code>sub rsp, 0x18              ; - push 24 bytes onto the stack, for locals
mov dword ptr [rsp], 0x00  ; - set the 4 bytes we are using of the stack
                           ;     for `x` to 0
add rsp, 0x18              ; - pop the 24 bytes we pushed off the stack
ret                        ; - return to the caller of our main function</code></pre><p><span>Even if we know nothing else about the PE format, we </span><em>do know</em><span> that these instructions need to be encoded </span><em>somewhere</em><span> in the file. We can identify how these are encoded using a disassembler tool as well, which should have an ability to visualize the machine code bytes which were parsed to form each instruction:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa185fe0b-85c6-4e6a-a279-abf50f96727d_849x512.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa185fe0b-85c6-4e6a-a279-abf50f96727d_849x512.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa185fe0b-85c6-4e6a-a279-abf50f96727d_849x512.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa185fe0b-85c6-4e6a-a279-abf50f96727d_849x512.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa185fe0b-85c6-4e6a-a279-abf50f96727d_849x512.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa185fe0b-85c6-4e6a-a279-abf50f96727d_849x512.png" width="849" height="512" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/a185fe0b-85c6-4e6a-a279-abf50f96727d_849x512.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:512,&quot;width&quot;:849,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:48721,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa185fe0b-85c6-4e6a-a279-abf50f96727d_849x512.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa185fe0b-85c6-4e6a-a279-abf50f96727d_849x512.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa185fe0b-85c6-4e6a-a279-abf50f96727d_849x512.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa185fe0b-85c6-4e6a-a279-abf50f96727d_849x512.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>The above image shows the disassembled instructions in the RAD Debugger, as well as the bytes from which they were parsed. If you took a look at the disassembly yourself, and were confused by the </span><code>add [rax], al</code><span> instruction everywhere surrounding the actual code, the code bytes also clear that mystery up—that is simply the instruction one obtains when parsing two sequential zero bytes.</span></p><p>Given the above, we know that the generated machine code is encoded with 16 bytes. Each byte can be represented with two hexadecimal digits:</p><pre><code>48 83 ec 18 c7 04 24 00 00 00 00 48 83 c4 18 c3</code></pre><p>If we look at the generated EXE with a memory viewer, we can, indeed, find this sequence of bytes.</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa4cda8a-786d-494b-9b6d-bcb6ccc5d0bf_870x610.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa4cda8a-786d-494b-9b6d-bcb6ccc5d0bf_870x610.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa4cda8a-786d-494b-9b6d-bcb6ccc5d0bf_870x610.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa4cda8a-786d-494b-9b6d-bcb6ccc5d0bf_870x610.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa4cda8a-786d-494b-9b6d-bcb6ccc5d0bf_870x610.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa4cda8a-786d-494b-9b6d-bcb6ccc5d0bf_870x610.png" width="870" height="610" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/fa4cda8a-786d-494b-9b6d-bcb6ccc5d0bf_870x610.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:610,&quot;width&quot;:870,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:37748,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa4cda8a-786d-494b-9b6d-bcb6ccc5d0bf_870x610.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa4cda8a-786d-494b-9b6d-bcb6ccc5d0bf_870x610.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa4cda8a-786d-494b-9b6d-bcb6ccc5d0bf_870x610.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa4cda8a-786d-494b-9b6d-bcb6ccc5d0bf_870x610.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>We know that this sequence of bytes is the primary “payload”—the actual program code. Everything else in the file is used to either instruct the loader how to correctly prepare a process for this code to execute, or to associate various metadata with the code.</p><p>For example, if you scan around the file, you’ll find the full path to the debug information file (PDB) for the executable image.</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86b44674-2b9d-44ad-9945-36916129bf95_869x568.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86b44674-2b9d-44ad-9945-36916129bf95_869x568.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86b44674-2b9d-44ad-9945-36916129bf95_869x568.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86b44674-2b9d-44ad-9945-36916129bf95_869x568.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86b44674-2b9d-44ad-9945-36916129bf95_869x568.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86b44674-2b9d-44ad-9945-36916129bf95_869x568.png" width="869" height="568" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/86b44674-2b9d-44ad-9945-36916129bf95_869x568.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:568,&quot;width&quot;:869,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:69255,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86b44674-2b9d-44ad-9945-36916129bf95_869x568.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86b44674-2b9d-44ad-9945-36916129bf95_869x568.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86b44674-2b9d-44ad-9945-36916129bf95_869x568.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86b44674-2b9d-44ad-9945-36916129bf95_869x568.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>The executable image also must store data to which code refers. We can see this by inserting a recognizable pattern into a global variable:</p><pre><code>// sample.c

static char important_data[] = {0x12, 0x34, 0x56, 0x78, 0x90};

void WinMainCRTStartup(void)
{
  int x = important_data[0];
}</code></pre><p>We can also easily find the corresponding data in the PE file:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc3f5a56f-c105-4e90-a39b-16f5fad3fddd_896x310.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc3f5a56f-c105-4e90-a39b-16f5fad3fddd_896x310.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc3f5a56f-c105-4e90-a39b-16f5fad3fddd_896x310.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc3f5a56f-c105-4e90-a39b-16f5fad3fddd_896x310.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc3f5a56f-c105-4e90-a39b-16f5fad3fddd_896x310.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc3f5a56f-c105-4e90-a39b-16f5fad3fddd_896x310.png" width="896" height="310" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/c3f5a56f-c105-4e90-a39b-16f5fad3fddd_896x310.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:310,&quot;width&quot;:896,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:17650,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc3f5a56f-c105-4e90-a39b-16f5fad3fddd_896x310.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc3f5a56f-c105-4e90-a39b-16f5fad3fddd_896x310.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc3f5a56f-c105-4e90-a39b-16f5fad3fddd_896x310.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc3f5a56f-c105-4e90-a39b-16f5fad3fddd_896x310.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>If you investigate formats like PE or ELF more closely, what you’ll find is that various categories of data—code, initialized global variables—are separated into </span><em>sections</em><span>. Each section has a name, which is also encoded in the file.</span></p><p><span>In PE, </span><code>.text</code><span>, for example, encodes all of the machine code (rather than, well, text…). </span><code>.data</code><span> stores data for initialized global variables. </span><code>.rdata</code><span> stores the same, but is separated to be allocated in read-only pages, such that code cannot modify that data.</span></p><p><code>.pdata</code><span> and </span><code>.xdata</code><span> encode information about how, given a procedure, one may </span><em>unwind</em><span> a thread, to—for example—produce a call stack, which is simply recreating the information of which functions called which other functions in order to get a thread of execution to its current point in a procedure. But we’ll dig into that topic in a later post.</span></p><p><code>.edata</code><span> and </span><code>.idata</code><span> encode information about </span><em>exports</em><span> and </span><em>imports</em><span>, respectively, which associate strings (“symbol names”) with locations in the file. An export is used by DLLs, for example, to export functions which can be dynamically loaded by name, by code in an executable or other DLL, and called. An import is used by either executables or DLLs to specify functions from other modules with which it must dynamically “link”.</span></p><p>When implementing a debugger, the precise details of formats like PE and ELF become relevant—but this should be a sufficient introduction for those unfamiliar with the basics.</p><blockquote><p><em><span>A </span><strong>loader</strong><span> — The part of an operating system responsible for parsing executable images—blueprints for execution—and instantiating them, so that the code encoded in the images may be actually executed.</span></em></p><p><span>A </span><em><strong>module</strong></em><span> — The loaded equivalent of an </span><em>executable image</em><span>. One </span><em>process</em><span> can load several </span><em>modules</em><span>, although a process is always initialized by the loading of </span><em>one specific module</em><span> (the initial executable image). Modules can be both dynamically </span><em>loaded</em><span> and </span><em>unloaded</em><span>.</span></p></blockquote><p><span>More than a debugger, a </span><em>loader</em><span> must be highly aware of executable image format details, because it has the task of </span><em>parsing</em><span> those images and making preparations,</span><em> </em><span>such that the code contained in the executable image can be executed.</span></p><p><span>A loader executes when a program is initially launched, or when actively-executing code requests to dynamically load another image—for instance, via </span><code>LoadLibrary</code><span> (Windows) or </span><code>dlopen</code><span> (Linux).</span></p><p><span>To understand this, let’s build a toy executable image format, and write our own loader, which parses </span><em>our </em><span>format, rather than PE or ELF.</span></p><p>Consider the following code, from earlier:</p><pre><code>// sample.c

void WinMainCRTStartup(void)
{
  int x = 0;
}</code></pre><p>And its disassembly:</p><pre><code>&gt; c:/devel/sample/sample.c
&gt; {
{48 83 ec 18}              sub rsp, 0x18
&gt; int x = 0;
{c7 04 24 00 00 00 00}     mov dword ptr [rsp], 0x00
&gt; }
{48 83 c4 18}              add rsp, 0x18
{c3}                       ret</code></pre><p>Our toy format can have a simple header, at the beginning of the image, containing the following values, in order:</p><ul><li><p><span>An 8-byte signature, denoting that the file is in our format—must always be </span><code>54 4f 59 45 58 45 00 00</code><span>—encoding the ASCII text </span><code>TOYEXE</code><span>, followed by two zero bytes.</span></p></li><li><p>An 8-byte offset into the file, encoding where in the file all readable-and-writable global data is stored—the “data section”</p></li><li><p>An 8-byte offset into the file, encoding where in the file all read-only global data is stored—the “read-only data section”</p></li><li><p>An 8-byte offset into the file, encoding where in the file all executable data is stored— the “code section”</p></li></ul><p>Each section size is determined by taking the next subsequent section offset (or the file size, in the case of the final section), and subtracting from it the section offset. If sections contain no data in any case, they will simply have the same offset as the next section.</p><p>Given this simple format, our full executable file for the simple example program can be encoded with the following bytes:</p><pre><code>{54 4f 59 45 58 45 00 00} (magic)
{20 00 00 00 00 00 00 00} (read/write data offset)
{20 00 00 00 00 00 00 00} (read-only data offset)
{20 00 00 00 00 00 00 00} (executable data offset)
{48 83 ec 18 c7 04 24 00 00 00 00 48 83 c4 18 c3} (executable data)</code></pre><p><span>In this case, our data sections are completely empty, because no global data is used by the code. Every section offset begins at offset </span><code>0x20</code><span> (or 32 bytes) into the file—or, directly after the header. The executable data section, being the final section, occupies the remainder of the file.</span></p><p>Our “loader” can define the format’s header with the following structure:</p><pre><code>typedef struct ToyExe_Header ToyExe_Header;
struct ToyExe_Header
{
  U64 magic;       // must be {54 4f 59 45 58 45 00 00}
  U64 rw_data_off; // read/write
  U64 r_data_off;  // read
  U64 x_data_off;  // executable
};</code></pre><p>It can begin by reading the file, and extracting the header:</p><pre><code>// open file, map it into the process address space
HANDLE file = CreateFileA(arguments, GENERIC_READ, 0, 0, OPEN_EXISTING, 0, 0);
U64 file_size = 0;
if(file != INVALID_HANDLE_VALUE)
{
  DWORD file_size_hi = 0;
  DWORD file_size_lo = GetFileSize(file, &amp;file_size_hi);
  file_size = (((U64)file_size_hi) &lt;&lt; 32) | (U64)file_size_lo;
}
HANDLE file_map = CreateFileMappingA(file, 0, PAGE_EXECUTE_READ, 0, 0, 0);
void *file_base = MapViewOfFile(file_map, FILE_MAP_ALL_ACCESS, 0, 0, 0);

// extract the header
ToyExe_Header header_stub = {0};
ToyExe_Header *header = &amp;header_stub;
if(file_base &amp;&amp; file_size &gt;= sizeof(*header))
{
  header = (ToyExe_Header *)file_base;
}  </code></pre><p>It can then allocate memory, big enough for the image’s data, and copy the file’s contents into that address range.</p><pre><code><code>// allocate memory for all executable data - ensure it is all
// writeable, executable, and readable
void *exe_data = VirtualAlloc(0, file_size, MEM_RESERVE|MEM_COMMIT, 
                              PAGE_EXECUTE_READWRITE);

// copy file's data into memory
CopyMemory(exe_data, file_base, file_size);</code></code></pre><p>Given the header’s information encoding where in the executable data the code is stored, we can now call into that code directly:</p><pre><code>// call the code
void *x_data = (U8 *)exe_data + header-&gt;x_data_off;
((void (*)())x_data)();</code></pre><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff13a85b2-3f22-4989-942b-521f5cb892dd_1350x726.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff13a85b2-3f22-4989-942b-521f5cb892dd_1350x726.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff13a85b2-3f22-4989-942b-521f5cb892dd_1350x726.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff13a85b2-3f22-4989-942b-521f5cb892dd_1350x726.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff13a85b2-3f22-4989-942b-521f5cb892dd_1350x726.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff13a85b2-3f22-4989-942b-521f5cb892dd_1350x726.png" width="1350" height="726" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/f13a85b2-3f22-4989-942b-521f5cb892dd_1350x726.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:726,&quot;width&quot;:1350,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:95139,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff13a85b2-3f22-4989-942b-521f5cb892dd_1350x726.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff13a85b2-3f22-4989-942b-521f5cb892dd_1350x726.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff13a85b2-3f22-4989-942b-521f5cb892dd_1350x726.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff13a85b2-3f22-4989-942b-521f5cb892dd_1350x726.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>And it actually works! But there is, as you might expect, more minutiae to this in practice.</p><p><span>In this example, I’ve allocated all of the executable’s data with identical </span><em>memory protections</em><span>—all bytes in the executable’s data are legal to read, write, </span><em>and</em><span> execute. The point of having different sections at all is to organize data by how it will be accessed and used, so that—for instance—our “read-only data section” can actually be read-only (such that, if any code were to attempt writing to it, it would fail).</span></p><p><span>Because memory protections are assigned at </span><em>page granularity</em><span>, each individual section, after it’s loaded by our toy loader, must be </span><em>at least</em><span> one page size (so that we can assign appropriate protections to each section), and it must be aligned to page boundaries. But, were we actually designing a format, to require all sections be at least one page size (which is normally 4 kilobytes, if not larger), at least </span><em>in the executable image itself </em><span>(as it’s stored in the filesystem), can be fairly wasteful for smaller executables.</span></p><p>Instead of our loaded image being a flat copy from the image file:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb1a1b1e4-4a94-4d55-9775-ce0fc7c84407_1278x1446.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb1a1b1e4-4a94-4d55-9775-ce0fc7c84407_1278x1446.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb1a1b1e4-4a94-4d55-9775-ce0fc7c84407_1278x1446.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb1a1b1e4-4a94-4d55-9775-ce0fc7c84407_1278x1446.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb1a1b1e4-4a94-4d55-9775-ce0fc7c84407_1278x1446.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb1a1b1e4-4a94-4d55-9775-ce0fc7c84407_1278x1446.png" width="364" height="411.84976525821594" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/b1a1b1e4-4a94-4d55-9775-ce0fc7c84407_1278x1446.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1446,&quot;width&quot;:1278,&quot;resizeWidth&quot;:364,&quot;bytes&quot;:812416,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb1a1b1e4-4a94-4d55-9775-ce0fc7c84407_1278x1446.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb1a1b1e4-4a94-4d55-9775-ce0fc7c84407_1278x1446.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb1a1b1e4-4a94-4d55-9775-ce0fc7c84407_1278x1446.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb1a1b1e4-4a94-4d55-9775-ce0fc7c84407_1278x1446.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>We can adjust it to being an </span><em>expansion</em><span> for each section</span><em> </em><span>to page granularity, and a copy:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F13ac2a39-66e1-4568-a052-b70d2ff91dc5_2048x2048.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F13ac2a39-66e1-4568-a052-b70d2ff91dc5_2048x2048.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F13ac2a39-66e1-4568-a052-b70d2ff91dc5_2048x2048.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F13ac2a39-66e1-4568-a052-b70d2ff91dc5_2048x2048.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F13ac2a39-66e1-4568-a052-b70d2ff91dc5_2048x2048.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F13ac2a39-66e1-4568-a052-b70d2ff91dc5_2048x2048.png" width="518" height="518" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/13ac2a39-66e1-4568-a052-b70d2ff91dc5_2048x2048.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1456,&quot;width&quot;:1456,&quot;resizeWidth&quot;:518,&quot;bytes&quot;:1320933,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F13ac2a39-66e1-4568-a052-b70d2ff91dc5_2048x2048.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F13ac2a39-66e1-4568-a052-b70d2ff91dc5_2048x2048.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F13ac2a39-66e1-4568-a052-b70d2ff91dc5_2048x2048.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F13ac2a39-66e1-4568-a052-b70d2ff91dc5_2048x2048.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>To do this, we can introduce a distinction between </span><em>unloaded</em><span> sections (that which stored in an executable image), and </span><em>loaded </em><span>sections (that which are loaded in memory, when a process executes). So far, our toy format has one notion of “offset”. We can break that down into two notions of offset, into two separate spaces—”unloaded space” and “loaded space”. These are generally called “file space” and “virtual space” (where “virtual” refers to a process’ “virtual address space”). Thus, instead of one type of offset, we can have </span><em>file offsets</em><span>, or </span><em>virtual offsets</em><span>. In code, instead of using </span><code>off</code><span> as our naming convention, we can explicitly encode which space we’re working within, by prefixing a name with either </span><code>f</code><span> or </span><code>v</code><span>. For example, “offsets” can now be referred to as either </span><code>foff</code><span> for file offsets, or </span><code>voff</code><span> for virtual offsets.</span></p><p><span>This distinction of </span><em>unloaded</em><span> and </span><em>loaded</em><span> images is the reason for the separation between the terms </span><em>image</em><span> and </span><em>module</em><span>. We call the </span><em>image</em><span> the “cold” equivalent of the data, and we call the </span><em>module</em><span> the “hot”—the loaded—equivalent of the data.</span></p><p><span>We can rewrite our header structure as follows, to encode both the locations of section data within the image, </span><em>and</em><span> to encode where the section data should be arranged </span><em>within memory</em><span> before execution:</span></p><pre><code><code>typedef struct ToyExe_Header ToyExe_Header;
struct ToyExe_Header
{
  U64 magic;   // must be {54 4f 59 45 58 45 00 00}
  U64 padding; // (round up to 64 bytes)
  U64 rw_foff; // read/write (file)
  U64 r_foff;  // read (file)
  U64 x_foff;  // executable (file)
  U64 rw_voff; // read/write (virtual)
  U64 r_voff;  // read (virtual)
  U64 x_voff;  // executable (virtual)
};</code></code></pre><p>Our test program can then be adjusted to the following bytes, assuming 4 kilobyte pages:</p><pre><code><code>{54 4f 59 45 58 45 00 00} (magic)
{00 00 00 00 00 00 00 00} (padding)
{20 00 00 00 00 00 00 00} (read/write data file offset)
{20 00 00 00 00 00 00 00} (read-only data file offset)
{20 00 00 00 00 00 00 00} (executable data file offset)
{00 10 00 00 00 00 00 00} (read/write data virtual offset)
{00 10 00 00 00 00 00 00} (read-only data virtual offset)
{00 10 00 00 00 00 00 00} (executable data virtual offset)
{48 83 ec 18 c7 04 24 00 00 00 00 48 83 c4 18 c3} (executable data)</code></code></pre><p>And our loader can be adjusted to perform the “expansionary copy”:</p><pre><code><code>// unpack f/v dimensions of each section (and header)
U64 fdata_hdr_size = sizeof(*header);
U64 fdata_rw_size  = header-&gt;r_foff - header-&gt;rw_foff;
U64 fdata_r_size   = header-&gt;x_foff - header-&gt;r_foff;
U64 fdata_x_size   = file_size - header-&gt;x_foff;
U64 vdata_hdr_size = fdata_hdr_size;
U64 vdata_rw_size  = header-&gt;r_voff - header-&gt;rw_voff;
U64 vdata_r_size   = header-&gt;x_voff - header-&gt;r_voff;
U64 vdata_x_size   = fdata_x_size;

// round up virtual sizes to 4K boundaries
vdata_hdr_size+= 4095;
vdata_rw_size += 4095;
vdata_r_size  += 4095;
vdata_x_size  += 4095;
vdata_hdr_size-= vdata_hdr_size%4096;
vdata_rw_size -= vdata_rw_size%4096;
vdata_r_size  -= vdata_r_size%4096;
vdata_x_size  -= vdata_x_size%4096;

// calculate total needed virtual size, allocate
U64 vdata_size = (vdata_hdr_size + vdata_rw_size + vdata_r_size + vdata_x_size);
U8 *vdata = (U8 *)VirtualAlloc(0, vdata_size, MEM_RESERVE|MEM_COMMIT, 
                               PAGE_READWRITE);

// unpack parts of virtual data
U8 *vdata_hdr     = vdata + 0;
U8 *vdata_rw      = vdata + header-&gt;rw_voff;
U8 *vdata_r       = vdata + header-&gt;r_voff;
U8 *vdata_x       = vdata + header-&gt;x_voff;

// unpack parts of file data
U8 *fdata         = (U8 *)file_base;
U8 *fdata_hdr     = fdata + 0;
U8 *fdata_rw      = fdata + header-&gt;rw_foff;
U8 *fdata_r       = fdata + header-&gt;r_foff;
U8 *fdata_x       = fdata + header-&gt;x_foff;

// copy &amp; protect
CopyMemory(vdata_hdr, fdata_hdr, fdata_hdr_size);
CopyMemory(vdata_rw, fdata_rw, fdata_rw_size);
CopyMemory(vdata_r, fdata_r, fdata_r_size);
CopyMemory(vdata_x, fdata_x, fdata_x_size);
DWORD old_protect = 0;
VirtualProtect(vdata_hdr, vdata_hdr_size, PAGE_READONLY, &amp;old_protect);
VirtualProtect(vdata_rw, vdata_rw_size, PAGE_READWRITE, &amp;old_protect);
VirtualProtect(vdata_r, vdata_r_size, PAGE_READONLY, &amp;old_protect);
VirtualProtect(vdata_x, vdata_x_size, PAGE_EXECUTE, &amp;old_protect);</code></code></pre><p>And—since it’s easy to notice that this is getting rather repetitive for each section—we can table-drive this “expansionary copy”. Doing so will eliminate most of the per-section duplication:</p><pre><code><code>// gather all information for all boundaries between all sections (&amp; header)
struct
{
  U64 foff;
  U64 voff;
  DWORD protect_flags;
}
boundaries[] =
{
  {0,               0,               PAGE_READONLY},
  {header-&gt;rw_foff, header-&gt;rw_voff, PAGE_READWRITE},
  {header-&gt;r_foff,  header-&gt;r_voff,  PAGE_READONLY},
  {header-&gt;x_foff,  header-&gt;x_voff,  PAGE_EXECUTE},
  {file_size,       0,               PAGE_READONLY},
};
U64 region_count = (sizeof(boundaries)/sizeof(boundaries[0]) - 1);

// calculate vsize for all regions
U64 vdata_size = 0;
for(U64 idx = 0; idx &lt; region_count; idx += 1)
{
  U64 vsize = (boundaries[idx+1].foff - boundaries[idx].foff);
  vsize += 4095;
  vsize -= vsize%4096;
  vdata_size += vsize;
}
boundaries[region_count].voff = vdata_size;

// allocate; iterate regions, do copy &amp; protect
U8 *vdata = (U8 *)VirtualAlloc(0, vdata_size, MEM_RESERVE|MEM_COMMIT, 
                               PAGE_READWRITE);
U8 *fdata = (U8 *)file_data;
DWORD old_protect = 0;
for(U64 idx = 0; idx &lt; region_count; idx += 1)
{
  CopyMemory(vdata + boundaries[idx].voff,
             fdata + boundaries[idx].foff,
             (boundaries[idx+1].foff - boundaries[idx].foff));
  VirtualProtect(vdata + boundaries[idx].voff,
                 (boundaries[idx+1].voff - boundaries[idx].voff),
                 boundaries[idx].protect_flags, &amp;old_protect);
}</code></code></pre><p>It’s not much shorter, but all work for all expanded and copied sections has been deduplicated. In order to adjust this for a larger number of different sections, only the boundary table must change.</p><p><span>Now that we have a basic structure for loading our image format, let’s consider how a loader is used. As I’ve stated, an executable image is loaded whenever a program is </span><em>launched</em><span>, or when an executing program requests to dynamically load another image (for instance, through </span><code>LoadLibrary</code><span> or </span><code>dlopen</code><span>).</span></p><p>We’ve already explored the first case—program launching—as that will consist of simply beginning execution of the program. With our toy loader, we can just immediately execute the code after we’ve loaded it:</p><pre><code><code>// call the code
void *vdata_x = (U8 *)vdata + header-&gt;x_voff;
((void (*)())vdata_x)();</code></code></pre><p><span>This makes the assumption that the first instruction stored is our entry point. If we ever wanted that to </span><em>not be the case</em><span>—as “real” executable image formats do—then we can simply store a virtual offset for the desired entry point within the image’s header.</span></p><p><span>But in the case of </span><em>dynamic loading</em><span>, our loader’s job is not to merely begin executing at a single point in some code. Our load instead must load the image, and prepare for dynamic lookups of potentially many named entry points. On Windows, the usage code for this looks something like:</span></p><pre><code>HMODULE foo_library = LoadLibraryA("foo.dll");
void (*foo_function)(void) = GetProcAddress(foo_library, "foo_function");
foo_function();</code></pre><p><span>To facilitate this path, our executable image format must associate a number of names—like </span><code>foo_function</code><span>—with specific virtual offsets in the executable data section. This concept is known as an executable image’s </span><em>exports</em><span>, and it can be straightforwardly encoded as a set of pairs of names and virtual offsets.</span></p><p><span>There’s a symmetric concept known as </span><em>imports</em><span>, which function as a fast path for the manual lookup of functions from a loaded executable image like the above code. On Windows, the usage code for </span><em>that</em><span> looks something like:</span></p><pre><code>__declspec(dllimport) void foo_function(void);
#pragma comment(lib, "foo.lib")
foo_function();</code></pre><p><span>Both </span><em>explicitly</em><span> loaded (via </span><code>GetProcAddress</code><span> on Windows, or </span><code>dlsym</code><span> on Linux), and </span><em>implicitly</em><span> loaded (via </span><code>__declspec(dllimport)</code><span> on Windows, which is more automatic on Linux toolchains) functions are called through a double indirection. To perform an actual function call, first the CPU must follow the address of the pointer in which the loaded address is stored, </span><em>then</em><span> it can use whatever the value of that pointer as the address of the function to call.</span></p><p><span>In the above example with </span><em>explicit</em><span> loading, the address of the loaded function is stored in the explicit </span><code>foo_function</code><span> function pointer variable. In the above example with </span><em>implicit</em><span> loading, the address of the loaded function is implicitly stored in hidden state, as an implementation detail.</span></p><p><span>When an executable image has imports, in order for the loading of that image to succeed, the associated imports must be dynamically linked. This will be done automatically, as opposed to the program code manually calling—for instance—</span><code>LoadLibrary</code><span> or </span><code>GetProcAddress</code><span>.</span></p><p><span>Machine code contained in an executable image can be hardcoded to refer to specific addresses. But as you’ll notice, in our toy loader, we don’t control which address at which our </span><em>module</em><span> for an image is placed in memory. We call </span><code>VirtualAlloc</code><span> to allocate memory for our module data, and whatever address it returns, we use that. Of course, we can </span><em>request</em><span> that </span><code>VirtualAlloc</code><span> place our allocation at a specific address, but that is not necessarily guaranteed to succeed.</span></p><p>This means that if we, for instance, had an image with instructions which referred to a global variable’s absolute address, they would only be valid given that the image is loaded at a particular address. </p><p><span>In principle, a loader could guarantee a fixed virtual address </span><em>for a program’s initially loaded executable image. </em><a href="https://en.wikipedia.org/wiki/Address_space_layout_randomization" rel="">They don’t</a><span>. But in any case, that cannot generally be true, because images can be loaded or unloaded dynamically, and they are not built to be aware of which other images are loaded simultaneously. Thus, they must be dynamically arranged—each image’s code should be able to operate correctly, irrespective of where its loaded module equivalent is placed in memory.</span></p><p><span>In many cases, especially nowadays, addresses are encoded as </span><em>relative to some offset into code</em><span>, in which case they’re always valid, irrespective of which runtime address at which the module is loaded. But, nevertheless, there still exist mechanisms for code to be hardwired to refer to specific addresses. In such cases, an executable image also contains </span><em>relocations</em><span>, which encode locations within the executable image which must be </span><em>reencoded</em><span> after the base address of the loaded image is determined at runtime.</span></p><p>It is the loader’s job to iterate these relocations, and patch in the appropriate addresses given the only-then-available knowledge of where the image’s loaded data is actually stored.</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc9e7b8be-92da-4f66-9800-cb0686184931_2048x2048.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc9e7b8be-92da-4f66-9800-cb0686184931_2048x2048.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc9e7b8be-92da-4f66-9800-cb0686184931_2048x2048.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc9e7b8be-92da-4f66-9800-cb0686184931_2048x2048.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc9e7b8be-92da-4f66-9800-cb0686184931_2048x2048.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc9e7b8be-92da-4f66-9800-cb0686184931_2048x2048.png" width="496" height="496" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/c9e7b8be-92da-4f66-9800-cb0686184931_2048x2048.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1456,&quot;width&quot;:1456,&quot;resizeWidth&quot;:496,&quot;bytes&quot;:689644,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc9e7b8be-92da-4f66-9800-cb0686184931_2048x2048.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc9e7b8be-92da-4f66-9800-cb0686184931_2048x2048.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc9e7b8be-92da-4f66-9800-cb0686184931_2048x2048.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc9e7b8be-92da-4f66-9800-cb0686184931_2048x2048.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><blockquote><p><em>An instance of a live, running program. Instantiated by the platform’s loader using the initial executable image to determine how it’s initialized, and what code is initially loaded. The granularity at which operating systems assign virtual address spaces. The container of several modules, and threads of execution.</em></p></blockquote><p><span>We’ve covered everything we need to sketch out a definition of a </span><em>process</em><span>—a running program.</span></p><p><span>Each </span><em>process</em><span> is the owner of some number of </span><em>threads</em><span>, and some number of </span><em>modules</em><span>. It is the owner of a single </span><em>virtual address space</em><span>.</span></p><p><span>Threads and virtual address spaces are, in a sense, </span><em>orthogonal concepts</em><span>—threads are used to virtualize CPU cores, virtual address spaces are used to virtualize physical storage—the </span><em>process</em><span> is the concept which binds them together.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F65f796a4-42e3-48da-9d54-f9757e8017af_2048x2048.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F65f796a4-42e3-48da-9d54-f9757e8017af_2048x2048.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F65f796a4-42e3-48da-9d54-f9757e8017af_2048x2048.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F65f796a4-42e3-48da-9d54-f9757e8017af_2048x2048.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F65f796a4-42e3-48da-9d54-f9757e8017af_2048x2048.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F65f796a4-42e3-48da-9d54-f9757e8017af_2048x2048.png" width="474" height="474" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/65f796a4-42e3-48da-9d54-f9757e8017af_2048x2048.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1456,&quot;width&quot;:1456,&quot;resizeWidth&quot;:474,&quot;bytes&quot;:928209,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F65f796a4-42e3-48da-9d54-f9757e8017af_2048x2048.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F65f796a4-42e3-48da-9d54-f9757e8017af_2048x2048.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F65f796a4-42e3-48da-9d54-f9757e8017af_2048x2048.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F65f796a4-42e3-48da-9d54-f9757e8017af_2048x2048.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>When a program is launched, a process is created, an executable image is loaded to produce an initial module, and an initial thread is spawned.</p><p>An operating system’s scheduler then considers that process’ main thread as a viable candidate for scheduling. When it’s scheduled, the program executes.</p><p><span>When a debugger is used to analyze another program, it does so at process granularity. It is registered by the operating system as being </span><em>attached to a process</em><span>. When a debugger is attached to a process, the operating system enables additional codepaths, which report information about that process’ execution to the debugger’s process. If that information includes addresses, they’re reported as </span><em>virtual addresses</em><span>, within the address space of the process to which the debugger is attached.</span></p><p>But that’s enough for now! We’ll dig into exactly what kind of information an operating system reports to a debugger process, how it can do so, and how the debugger can interact with the debugged process, next time.</p><p>If you enjoyed this post, please consider subscribing. Thanks for reading.</p><p>-Ryan</p></div></article></div><div id="discussion"><h4>Discussion about this post</h4></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Build a Low-Cost Drone Using ESP32 (281 pts)]]></title>
            <link>https://www.digikey.com/en/maker/projects/a-step-by-step-guide-to-build-a-low-cost-drone-using-esp32/8afccd0690574bcebfa0d2ad6fd0a391</link>
            <guid>42498648</guid>
            <pubDate>Tue, 24 Dec 2024 00:20:39 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.digikey.com/en/maker/projects/a-step-by-step-guide-to-build-a-low-cost-drone-using-esp32/8afccd0690574bcebfa0d2ad6fd0a391">https://www.digikey.com/en/maker/projects/a-step-by-step-guide-to-build-a-low-cost-drone-using-esp32/8afccd0690574bcebfa0d2ad6fd0a391</a>, See on <a href="https://news.ycombinator.com/item?id=42498648">Hacker News</a></p>
Couldn't get https://www.digikey.com/en/maker/projects/a-step-by-step-guide-to-build-a-low-cost-drone-using-esp32/8afccd0690574bcebfa0d2ad6fd0a391: Error: Request failed with status code 403]]></description>
        </item>
        <item>
            <title><![CDATA[Making AMD GPUs competitive for LLM inference (2023) (230 pts)]]></title>
            <link>https://blog.mlc.ai/2023/08/09/Making-AMD-GPUs-competitive-for-LLM-inference</link>
            <guid>42498634</guid>
            <pubDate>Tue, 24 Dec 2024 00:17:18 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://blog.mlc.ai/2023/08/09/Making-AMD-GPUs-competitive-for-LLM-inference">https://blog.mlc.ai/2023/08/09/Making-AMD-GPUs-competitive-for-LLM-inference</a>, See on <a href="https://news.ycombinator.com/item?id=42498634">Hacker News</a></p>
Couldn't get https://blog.mlc.ai/2023/08/09/Making-AMD-GPUs-competitive-for-LLM-inference: Error: timeout of 10000ms exceeded]]></description>
        </item>
        <item>
            <title><![CDATA[Parsing millions of URLs per Second (2023) (127 pts)]]></title>
            <link>https://onlinelibrary.wiley.com/doi/10.1002/spe.3296</link>
            <guid>42498514</guid>
            <pubDate>Mon, 23 Dec 2024 23:48:08 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://onlinelibrary.wiley.com/doi/10.1002/spe.3296">https://onlinelibrary.wiley.com/doi/10.1002/spe.3296</a>, See on <a href="https://news.ycombinator.com/item?id=42498514">Hacker News</a></p>
Couldn't get https://onlinelibrary.wiley.com/doi/10.1002/spe.3296: Error: timeout of 10000ms exceeded]]></description>
        </item>
        <item>
            <title><![CDATA[Why are cancer guidelines stuck in PDFs? (219 pts)]]></title>
            <link>https://seangeiger.substack.com/p/why-are-cancer-guidelines-stuck-in</link>
            <guid>42498462</guid>
            <pubDate>Mon, 23 Dec 2024 23:36:37 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://seangeiger.substack.com/p/why-are-cancer-guidelines-stuck-in">https://seangeiger.substack.com/p/why-are-cancer-guidelines-stuck-in</a>, See on <a href="https://news.ycombinator.com/item?id=42498462">Hacker News</a></p>
Couldn't get https://seangeiger.substack.com/p/why-are-cancer-guidelines-stuck-in: Error: timeout of 10000ms exceeded]]></description>
        </item>
        <item>
            <title><![CDATA[Show HN: Complete decompilation of Lego Island (207 pts)]]></title>
            <link>https://github.com/isledecomp/isle</link>
            <guid>42497173</guid>
            <pubDate>Mon, 23 Dec 2024 20:03:37 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/isledecomp/isle">https://github.com/isledecomp/isle</a>, See on <a href="https://news.ycombinator.com/item?id=42497173">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto"><h2 tabindex="-1" dir="auto">LEGO Island Decompilation</h2><a id="user-content-lego-island-decompilation" aria-label="Permalink: LEGO Island Decompilation" href="#lego-island-decompilation"></a></p>
<p dir="auto"><a href="https://www.youtube.com/playlist?list=PLbpl-gZkNl2COf_bB6cfgTapD5WduAfPz" rel="nofollow">Development Vlog</a> | <a href="https://github.com/isledecomp/isle/blob/master/CONTRIBUTING.md">Contributing</a> | <a href="https://matrix.to/#/#isledecomp:matrix.org" rel="nofollow">Matrix</a> | <a href="https://forum.mattkc.com/viewforum.php?f=1" rel="nofollow">Forums</a> | <a href="https://www.patreon.com/mattkc" rel="nofollow">Patreon</a></p>
<p dir="auto">This is a functionally complete decompilation of LEGO Island (Version 1.1, English). It aims to be as accurate as possible, matching the recompiled instructions to the original machine code as much as possible. The goal is to provide a workable codebase that can be modified, improved, and ported to other platforms later on.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Status</h2><a id="user-content-status" aria-label="Permalink: Status" href="#status"></a></p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/d27978e87b3d5547e472ae3f6610ae64892cffc1ab7628ed0b8e683142d2bf8e/68747470733a2f2f6c65676f69736c616e642e6f72672f70726f67726573732f49534c4550524f47524553532e535647"><img src="https://camo.githubusercontent.com/d27978e87b3d5547e472ae3f6610ae64892cffc1ab7628ed0b8e683142d2bf8e/68747470733a2f2f6c65676f69736c616e642e6f72672f70726f67726573732f49534c4550524f47524553532e535647" width="50%" data-canonical-src="https://legoisland.org/progress/ISLEPROGRESS.SVG"></a><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/dd9ae27b175ec9c47fa3d75495cf660d5a16c83f8c303b97e87fea750a234c7a/68747470733a2f2f6c65676f69736c616e642e6f72672f70726f67726573732f4c45474f3150524f47524553532e535647"><img src="https://camo.githubusercontent.com/dd9ae27b175ec9c47fa3d75495cf660d5a16c83f8c303b97e87fea750a234c7a/68747470733a2f2f6c65676f69736c616e642e6f72672f70726f67726573732f4c45474f3150524f47524553532e535647" width="50%" data-canonical-src="https://legoisland.org/progress/LEGO1PROGRESS.SVG"></a></p>
<p dir="auto">Both <code>ISLE.EXE</code> and <code>LEGO1.DLL</code> are completely decompiled and, to the best of our knowledge, are functionally identical to the originals. However, work is still ongoing to improve the accuracy, naming, documentation, and structure of the source code. While there may still be unresolved bugs that are not present in retail, the game should be fully playable with the binaries derived from this source code.</p>
<p dir="auto">Due to various complexities with regard to the compiler, these binaries are not a byte-for-byte match of the original executables. We remain hopeful that this can be resolved at some point.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Building</h2><a id="user-content-building" aria-label="Permalink: Building" href="#building"></a></p>
<p dir="auto">This project uses the <a href="https://cmake.org/" rel="nofollow">CMake</a> build system, which allows for a high degree of versatility regarding compilers and development environments. For the most accurate results, Microsoft Visual C++ 4.20 (the same compiler used to build the original game) is recommended. Since we're trying to match the output of this code to the original executables as closely as possible, all contributions will be graded with the output of this compiler.</p>
<p dir="auto">These instructions will outline how to compile this repository using Visual C++ 4.2 into highly-accurate binaries where the majority of functions are instruction-matching with retail. If you wish, you can try using other compilers, but this is at your own risk and won't be covered in this guide.</p>
<p dir="auto"><h4 tabindex="-1" dir="auto">Prerequisites</h4><a id="user-content-prerequisites" aria-label="Permalink: Prerequisites" href="#prerequisites"></a></p>
<p dir="auto">You will need the following software installed:</p>
<ul dir="auto">
<li>Microsoft Visual C++ 4.2. This can be found on many abandonware sites, but the installer can be a little iffy on modern versions of Windows. For convenience, a <a href="https://github.com/itsmattkc/msvc420">portable version</a> is available that can be downloaded and used quickly instead.</li>
<li><a href="https://cmake.org/" rel="nofollow">CMake</a>. A copy is often included with the "Desktop development with C++" workload in newer versions of Visual Studio; however, it can also be installed as a standalone app.</li>
</ul>
<p dir="auto"><h4 tabindex="-1" dir="auto">Compiling</h4><a id="user-content-compiling" aria-label="Permalink: Compiling" href="#compiling"></a></p>
<ol dir="auto">
<li>Open a Command Prompt (<code>cmd</code>).</li>
<li>From Visual C++ 4.2, run <code>BIN/VCVARS32.BAT x86</code> to populate the path and other environment variables for compiling with MSVC.</li>
<li>Make a folder for compiled objects to go, such as a <code>build</code> folder inside the source repository (the folder you cloned/downloaded to).</li>
<li>In your Command Prompt, <code>cd</code> to the build folder.</li>
<li>Configure the project with CMake by running:</li>
</ol>
<div data-snippet-clipboard-copy-content="cmake <path-to-source> -G &quot;NMake Makefiles&quot; -DCMAKE_BUILD_TYPE=RelWithDebInfo"><pre><code>cmake &lt;path-to-source&gt; -G "NMake Makefiles" -DCMAKE_BUILD_TYPE=RelWithDebInfo
</code></pre></div>
<ul dir="auto">
<li><strong>Visual C++ 4.2 has issues with paths containing spaces</strong>. If you get configure or build errors, make sure neither CMake, the repository, nor Visual C++ 4.2 is in a path that contains spaces.</li>
<li>Replace <code>&lt;path-to-source&gt;</code> with the source repository. This can be <code>..</code> if your build folder is inside the source repository.</li>
<li><code>RelWithDebInfo</code> is recommended because it will produce debug symbols useful for further decompilation work. However, you can change this to <code>Release</code> if you don't need them. <code>Debug</code> builds are not recommended because they are unlikely to be compatible with the retail <code>LEGO1.DLL</code>, which is currently the only way to use this decompilation for gameplay.</li>
<li><code>NMake Makefiles</code> is most recommended because it will be immediately compatible with Visual C++ 4.2. For faster builds, you can use <code>Ninja</code> (if you have it installed), however due to limitations in Visual C++ 4.2, you can only build <code>Release</code> builds this way (debug symbols cannot be generated with <code>Ninja</code>).</li>
</ul>
<ol dir="auto">
<li>Build the project by running <code>nmake</code> or <code>cmake --build &lt;build-folder&gt;</code></li>
<li>When this is done, there should be a recompiled <code>ISLE.EXE</code> and <code>LEGO1.DLL</code> in the build folder.</li>
<li>Note that <code>nmake</code> must be run twice under certain conditions, so it is advisable to always (re-)compile using <code>nmake &amp;&amp; nmake</code>.</li>
</ol>
<p dir="auto">If you have a CMake-compatible IDE, it should be pretty straightforward to use this repository, as long as you can use <code>VCVARS32.BAT</code> and set the generator to <code>NMake Makefiles</code>.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Usage</h2><a id="user-content-usage" aria-label="Permalink: Usage" href="#usage"></a></p>
<p dir="auto">Simply place the compiled <code>ISLE.EXE</code> and <code>LEGO1.DLL</code> into LEGO Island's install folder (usually <code>C:\Program Files\LEGO Island</code> or <code>C:\Program Files (x86)\LEGO Island</code>). Alternatively, LEGO Island can run from any directory as long as <code>ISLE.EXE</code> and <code>LEGO1.DLL</code> are in the same directory, and the registry keys (usually <code>HKEY_LOCAL_MACHINE\Software\Mindscape\LEGO Island</code> or <code>HKEY_LOCAL_MACHINE\Software\Wow6432Node\Mindscape\LEGO Island</code>) point to the correct location for the asset files.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Contributing</h2><a id="user-content-contributing" aria-label="Permalink: Contributing" href="#contributing"></a></p>
<p dir="auto">If you're interested in helping or contributing to this project, check out the <a href="https://github.com/isledecomp/isle/blob/master/CONTRIBUTING.md">CONTRIBUTING</a> page.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Additional Information</h2><a id="user-content-additional-information" aria-label="Permalink: Additional Information" href="#additional-information"></a></p>
<p dir="auto"><h3 tabindex="-1" dir="auto">Which version of LEGO Island do I have?</h3><a id="user-content-which-version-of-lego-island-do-i-have" aria-label="Permalink: Which version of LEGO Island do I have?" href="#which-version-of-lego-island-do-i-have"></a></p>
<p dir="auto">Right click on <code>LEGO1.DLL</code>, select <code>Properties</code>, and switch to the <code>Details</code> tab. Under <code>Version</code> you should either see <code>1.0.0.0</code> (1.0) or <code>1.1.0.0</code> (1.1). Additionally, you can look at the game disc files; 1.0's files will all say August 8, 1997, and 1.1's files will all say September 8, 1997. Version 1.1 is by far the most common, especially if you're not using the English or Japanese versions, so that's most likely the version you have.</p>
<p dir="auto">Please note that some localized versions of LEGO Island were recompiled with small changes despite maintaining a version number parallel with other versions; this decompilation specifically targets the English release of version 1.1 of LEGO Island. You can verify you have the correct version using the checksums below:</p>
<ul dir="auto">
<li>ISLE.EXE <code>md5: f6da12249e03eed1c74810cd23beb9f5</code></li>
<li>LEGO1.DLL <code>md5: 4e2f6d969ea2ef8655ba3fc221a0c8fe</code></li>
<li>CONFIG.EXE <code>md5: 92d958a64a273662c591c88b09100f4a</code></li>
</ul>
</article></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[The journey to save the last known 43-inch Sony CRT (551 pts)]]></title>
            <link>https://obsoletesony.substack.com/p/the-journey-to-save-the-last-known</link>
            <guid>42497093</guid>
            <pubDate>Mon, 23 Dec 2024 19:49:34 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://obsoletesony.substack.com/p/the-journey-to-save-the-last-known">https://obsoletesony.substack.com/p/the-journey-to-save-the-last-known</a>, See on <a href="https://news.ycombinator.com/item?id=42497093">Hacker News</a></p>
Couldn't get https://obsoletesony.substack.com/p/the-journey-to-save-the-last-known: Error: timeout of 10000ms exceeded]]></description>
        </item>
        <item>
            <title><![CDATA[Why HNSW is not the answer and disk-based alternatives might be more practical (131 pts)]]></title>
            <link>https://blog.pgvecto.rs/why-hnsw-is-not-the-answer</link>
            <guid>42496465</guid>
            <pubDate>Mon, 23 Dec 2024 18:24:09 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://blog.pgvecto.rs/why-hnsw-is-not-the-answer">https://blog.pgvecto.rs/why-hnsw-is-not-the-answer</a>, See on <a href="https://news.ycombinator.com/item?id=42496465">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="post-content-parent"><p>HNSW (Hierarchical Navigable Small World) has become the go-to algorithm for many vector databases. Its multi-layered graph structure and ability to efficiently navigate vector embeddings make it particularly appealing. However, despite its apparent advantages, HNSW may not be the optimal solution for large-scale and dynamic vector similarity search. In this blog post, we challenge the dominance of HNSW and explore why disk-based alternatives, such as IVF (Inverted File Index), might be more practical for massive datasets.</p>
<hr>
<h2 id="heading-the-appeal-of-hnsw">The Appeal of HNSW</h2>
<p>HNSW offers several advantages:</p>
<ul>
<li><p><strong>Efficient Search</strong>: Its graph-based structure enables quick nearest-neighbor searches, especially for smaller datasets.</p>
</li>
<li><p><strong>Incremental Updates</strong>: The ability to add new vectors incrementally without needing to rebuild the index is a major benefit for dynamic environments.</p>
</li>
<li><p><strong>High Recall</strong>: HNSW delivers high recall with relatively low latency, making it an ideal option for real-time applications.</p>
</li>
</ul>
<p>However, these benefits come with trade-offs that become more noticeable as dataset sizes increase.</p>
<hr>
<h2 id="heading-the-problem-of-hnsw">The Problem of HNSW</h2>
<p>One of the main challenges of HNSW is its significant dependence on memory for indexing and search operations. Here are the primary issues that emerge:</p>
<ul>
<li><p><strong>Memory Overhead</strong>: Traversing HNSW’s graph structure involves highly random access patterns. The entire dataset must be stored in memory to achieve reasonable performance. This becomes infeasible for large-scale datasets with billions of high-dimensional vectors due to exorbitant memory requirements.</p>
</li>
<li><p><strong>Performance Sensitivity to Memory Size</strong>: HNSW’s performance degrades sharply if the memory is even slightly insufficient to hold all vectors. In such cases, swapping data to disk drastically impacts search speed, making it impractical for systems with constrained memory.</p>
</li>
<li><p><strong>Unsuitability for Disk-Based Environments</strong>: HNSW is fundamentally designed for in-memory operations and performs poorly in disk-oriented scenarios, such as PostgreSQL. Its reliance on frequent random access patterns makes it incompatible with the sequential access nature of disk storage.</p>
</li>
<li><p><strong>Insertion and Deletion Costs</strong>: Updating the index in HNSW involves cascading modifications throughout the graph, leading to significant computation and write amplification. This makes insertion and deletion operations both slow and resource-intensive.</p>
</li>
</ul>
<p>In contrast, disk-based solutions like IVF excel in scenarios requiring scalability and efficiency at the cost of minimal complexity.</p>
<hr>
<h2 id="heading-why-ivf-can-be-faster-than-hnsw">Why IVF Can Be Faster Than HNSW</h2>
<p><img data-zoomable="true" loading="lazy" src="https://www.researchgate.net/publication/357875438/figure/fig15/AS:1113078611607560@1642390029247/Two-state-of-the-art-ANN-indexing-methods-the-IVF-index-Left-and-the-three-layer.ppm" alt="10: Two state-of-the-art ANN indexing methods: the IVF index (Left) and the (three-layer) HNSW index (Right). Figure credit: Li et al. [2020] ."></p>
<p>A critical observation across all vector search algorithms is that their performance largely hinges on the number of distance computations they perform. Minimizing these computations is essential for improving search speed. Although the original IVF index required scanning 1% to 5% of the total vectors, modern advancements in quantization and optimization have significantly enhanced its efficiency, making IVF a strong competitor to HNSW.</p>
<h3 id="heading-quantization-the-game-changer">Quantization: The Game Changer</h3>
<p>Quantization compresses high-dimensional vectors into compact representations. For instance:</p>
<ul>
<li><p><strong>RaBitQ</strong>: Leverages concentration of measure phenomena to enhance binary and scalar quantization accuracy, quantizing each dimension into 1 bit for a 32x compression ratio.</p>
</li>
<li><p><strong>Product Quantization (PQ)</strong>: Works by dividing the vector space into subspaces, quantizing each subspace independently to minimize approximation error. This method offers flexible compression ratios from 4x to 64x in FAISS, enabling finer compression and faster approximate searches.</p>
</li>
<li><p><strong>Scalar Quantization (SQ)</strong>: Quantizes each vector dimension independently by dividing its range into discrete levels, typically achieving a 4x compression ratio by converting from float to int8.</p>
</li>
<li><p><strong>ScaNN</strong>: Uses anisotropic vector quantization to optimize inner product accuracy by penalizing errors in directions that impact high inner products, achieving superior recall and speed.</p>
</li>
</ul>
<p>Quantization reduces memory and disk space usage significantly—often by a factor of 32x when converting floats into bits—while drastically lowering computational overhead. Despite some loss of precision, quantization makes vector comparisons far more efficient. For example, the typical distance computation complexity between two D-dimensional vectors is O(D^2), but compressing floats into bits reduces this by a factor of 1024 (32x32). With fast-scan optimizations, these computations are further accelerated via efficient CPU register lookups. Combined with IVF, many quantization methods consistently outperform HNSW in both speed and scalability. The typical workflow involves:</p>
<ol>
<li><p><strong>Initial Search</strong>: Leveraging compressed representations to rapidly identify candidate vectors.</p>
</li>
<li><p><strong>Reranking</strong>: Refining results using full-precision distance calculations on a smaller subset of candidates.</p>
</li>
</ol>
<h3 id="heading-comparing-rabitqivf-and-hnsw">Comparing RaBitQ+IVF and HNSW</h3>
<p>IVF with quantization provides a highly efficient way to store all quantized vectors in memory. By leveraging RaBitQ, memory usage is reduced by a factor of 32 compared to full-size vectors, allowing the entire quantized dataset to fit in memory. This design enables the index to rapidly retrieve approximate nearest neighbors using bit vectors and rerank them with full-precision vectors fetched from disk. For a typical Top-10 query, IVF fetches only 100-200 vectors from disk, compared to HNSW, which may require 800-1000 vectors. This efficient approach achieves an optimal balance between memory usage and disk access, offering outstanding cost-performance benefits.</p>
<p><img data-zoomable="true" loading="lazy" src="https://cdn.hashnode.com/res/hashnode/image/upload/v1734489380210/a2812b59-5ffd-4ee3-ac35-1681950ef550.png?auto=compress,format&amp;format=webp" alt=""></p>
<p>While similar quantization techniques could theoretically be applied to HNSW, practical constraints reduce their effectiveness:</p>
<ul>
<li><p><strong>Vector Packing</strong>: Fast scan optimization relies on packing 32 compressed vectors together, which is incompatible with HNSW’s graph structure.</p>
</li>
<li><p><strong>Random Access Costs</strong>: HNSW involves frequent random access across graph nodes and edges, making traversal inefficient. In contrast, IVF organizes vectors sequentially in posting lists, enabling faster prefetching and efficient sequential scans.</p>
</li>
<li><p><strong>Reranking Costs</strong>: Both IVF and HNSW share similar reranking computational costs due to their reliance on quantized representations in the first stage.</p>
</li>
</ul>
<p>Ultimately, the performance difference between quantized IVF and HNSW is likely minimal, but IVF stands out with its simplicity and efficiency.</p>
<hr>
<div>
<table>
<thead>
<tr>
<td>Feature</td><td>IVF</td><td>IVF + RaBitQ</td><td>HNSW</td></tr>
</thead>
<tbody>
<tr>
<td>Indexing Method</td><td>KMeans can be offloaded to GPU</td><td>KMeans + Quantization</td><td>Nearest Neighbor Graph, need to keep everything in memory</td></tr>
<tr>
<td>Overlapped Data Across Query</td><td>Centroids</td><td>Quantized vectors</td><td>No</td></tr>
<tr>
<td>Scalability</td><td>Limited by CPU and memory</td><td>Outstanding</td><td>Limited by memory</td></tr>
<tr>
<td>Insertion/Deletion</td><td>Simple (updates posting lists)</td><td>Simple (updates posting lists)</td><td>Complex (cascading graph changes)</td></tr>
<tr>
<td>Search Speed</td><td>Slow</td><td>Extremely Fast with Quantization</td><td>Fast with sufficient memory</td></tr>
<tr>
<td>Overall Complexity</td><td>Low</td><td>Low</td><td>High</td></tr>
</tbody>
</table>
</div><hr>
<h2 id="heading-operational-simplicity-of-ivf">Operational Simplicity of IVF</h2>
<p>IVF’s simplicity makes it a more practical choice for real-world applications:</p>
<ul>
<li><p><strong>Insertion and Deletion</strong>: In HNSW, these operations trigger cascading modifications throughout the graph, resulting in significant computation and write amplification. IVF, in contrast, only requires updating the relevant posting list.</p>
</li>
<li><p><strong>Disk-Based Storage</strong>: IVF’s reliance on disk-based indexing enables it to scale efficiently without the prohibitive memory costs associated with HNSW.</p>
</li>
<li><p><strong>Adaptability</strong>: IVF can be easily combined with advanced quantization techniques, enabling further optimizations.</p>
</li>
</ul>
<hr>
<h2 id="heading-conclusion">Conclusion</h2>
<p>While HNSW has solidified its reputation as a fast and accurate algorithm for vector similarity search, it is not without limitations. Its memory-intensive nature and operational complexity make it less suitable for large-scale applications. In contrast, IVF offers a scalable and cost-effective alternative, particularly when paired with modern quantization techniques.</p>
<p>As the demand for vector search continues to grow, practitioners must carefully evaluate the trade-offs between memory-based and disk-based solutions. HNSW may dominate small to medium-scale applications, but for massive datasets, it’s time to look beyond HNSW and embrace simpler, scalable approaches like IVF.</p>
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Nordstrom family to take company private (106 pts)]]></title>
            <link>https://www.bloomberg.com/news/articles/2024-12-23/nordstrom-family-to-take-company-private-in-6-25-billion-deal</link>
            <guid>42496104</guid>
            <pubDate>Mon, 23 Dec 2024 17:38:25 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.bloomberg.com/news/articles/2024-12-23/nordstrom-family-to-take-company-private-in-6-25-billion-deal">https://www.bloomberg.com/news/articles/2024-12-23/nordstrom-family-to-take-company-private-in-6-25-billion-deal</a>, See on <a href="https://news.ycombinator.com/item?id=42496104">Hacker News</a></p>
<div id="readability-page-1" class="page"><section>
    <section>
        <h3>Why did this happen?</h3>
        <p>Please make sure your browser supports JavaScript and cookies and that you are not
            blocking them from loading.
            For more information you can review our <a href="https://www.bloomberg.com/notices/tos">Terms of
                Service</a> and <a href="https://www.bloomberg.com/notices/tos">Cookie Policy</a>.</p>
    </section>
    <section>
        <h3>Need Help?</h3>
        <p>For inquiries related to this message please <a href="https://www.bloomberg.com/feedback">contact
            our support team</a> and provide the reference ID below.</p>
        <p>Block reference ID:</p>
    </section>
</section></div>]]></description>
        </item>
    </channel>
</rss>