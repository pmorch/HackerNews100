<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
    <channel>
        <title>HN100 - Readable Contents</title>
        <link>https://hn.algolia.com/api/v1/search_by_date?tags=%28story,poll%29&amp;numericFilters=points%3E100</link>
        <description>Uses Readability to add bodies to the RSS feed</description>
        <lastBuildDate>Wed, 31 Jul 2024 03:30:05 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Our Audit of Homebrew (335 pts)]]></title>
            <link>https://blog.trailofbits.com/2024/07/30/our-audit-of-homebrew/</link>
            <guid>41114839</guid>
            <pubDate>Tue, 30 Jul 2024 22:39:21 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://blog.trailofbits.com/2024/07/30/our-audit-of-homebrew/">https://blog.trailofbits.com/2024/07/30/our-audit-of-homebrew/</a>, See on <a href="https://news.ycombinator.com/item?id=41114839">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="page" role="main">

			
				
<article id="post-107865">
	<!-- .entry-header -->

	<div>
		<p><em>By William Woodruff</em></p>
<p>This is a joint post with the Homebrew maintainers; <a href="https://brew.sh/2024/07/30/homebrew-security-audit/">read their announcement here</a>!</p>
<p>Last summer, we performed an audit of <a href="https://brew.sh/">Homebrew</a>. Our audit’s scope included <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> itself (home of the brew CLI), and three adjacent repositories responsible for various security-relevant aspects of Homebrew’s operation:</p>
<ul>
<li><a href="https://github.com/Homebrew/actions">Homebrew/actions</a>: a repository of custom GitHub Actions used throughout Homebrew’s CI/CD;</li>
<li><a href="https://github.com/Homebrew/formulae.brew.sh">Homebrew/formulae.brew.sh</a>: the codebase responsible for Homebrew’s JSON index of installable packages;</li>
<li><a href="https://github.com/Homebrew/homebrew-test-bot">Homebrew/homebrew-test-bot</a>: Homebrew’s core CI/CD orchestration and lifecycle management routines.</li>
</ul>
<p>We found issues within Homebrew that, while not critical, could allow an attacker to load executable code at unexpected points and undermine the integrity guarantees intended by Homebrew’s use of sandboxing. Similarly, we found issues in Homebrew’s CI/CD that could allow an attacker to surreptitiously modify binary (“<a href="https://docs.brew.sh/Bottles">bottle</a>”) builds of formulae and potentially pivot from triggering CI/CD workflows to controlling the execution of CI/CD workflows and exfiltrating their secrets.</p>
<p>This audit was sponsored by the <a href="https://www.opentech.fund/">Open Tech Fund</a> as part of their larger mission to secure critical pieces of internet infrastructure. You can read the full report in <a href="https://github.com/trailofbits/publications#technology-product-reviews">our publications repository</a>.</p>
<h3>Homebrew</h3>
<p>Homebrew is the self-described “missing package manager for macOS (or Linux).” It serves as the <em>de facto</em> standard package manager for software developers on macOS, and <a href="https://formulae.brew.sh/analytics/install/365d/">serves hundreds of millions of package installs</a> annually. These installations include “keystone” packages such as <a href="https://formulae.brew.sh/formula/go#default">Golang</a>, <a href="https://formulae.brew.sh/formula/node#default">Node.js</a>, and <a href="https://formulae.brew.sh/formula/openssl@3#default">OpenSSL</a>, making Homebrew’s security (and the integrity of its builds) critical to the security of downstream software ecosystems as a whole. Homebrew’s core (not to be confused with <a href="https://github.com/Homebrew/homebrew-core">homebrew-core</a>) is a Ruby monolith responsible for providing the <a href="https://docs.brew.sh/Manpage"><code>brew</code> CLI</a> to users along with an <a href="https://rubydoc.brew.sh/">importable Ruby API</a>.</p>
<p>Since its inception in 2009, Homebrew has undergone several architectural shifts aimed at improving the reliability and usability of packages delivered to users: binary builds (bottles) were implemented, made into the default installation mechanism (replacing local source builds), and subsequently built solely on CI/CD to limit the risk of a compromised developer machine. Despite this increasingly static approach, Homebrew’s core codebase is fundamentally dynamic and, in many places, reflects Homebrew’s historical need for dynamic loading of <a href="https://docs.brew.sh/Formula-Cookbook">DSL-specified formulae</a> via user-controlled Ruby code.</p>
<h3>Scope</h3>
<p>Homebrew is both a user-installable package manager (the <code>brew</code> CLI) and a packaging ecosystem, with an extensive and bespoke CI/CD configuration for reviewing, building, and distributing bottles to end users. Our audit focused on aspects of both of these, and aimed to answer questions like (but not limited to) the following:</p>
<ul>
<li>Can a local actor induce unexpected execution of a formula’s DSL, e.g. without an explicit invocation of <code>brew install</code>?</li>
<li>Can a local actor induce unexpected evaluation of a tap’s formulae, e.g. from just <code>brew tap</code> with no subsequent user actions?</li>
<li>Can a local actor induce namespace confusions or conflicts within brew, resulting in <code>brew install foo</code> installing an unexpected formula?</li>
<li>Can a locally installed formula surreptitiously subvert or bypass Homebrew’s build isolation mechanisms?</li>
<li>Can an unprivileged or low-privilege CI/CD actor (such as a third-party contributor) pivot to a higher privilege in Homebrew’s CI/CD?</li>
<li>Can an unprivileged or low-privilege CI/CD actor surreptitiously taint or compromise a bottle build?</li>
<li>Can an unprivileged or low-privilege CI/CD actor establish persistence in Homebrew’s CI/CD?</li>
</ul>
<h3>Highlighted findings</h3>
<h4>brew</h4>
<p>During our review of the <code>brew</code> CLI’s codebase, we uncovered a number of findings that, while not critical, could potentially undermine Homebrew’s per-formula integrity and isolation properties. We also uncovered findings that could allow loading of formulae (i.e., executable code) from surprising sources, such as remote URLs.</p>
<p>Some findings of interest include:</p>
<ul>
<li>TOB-BREW-2, wherein a formula can influence the construction of its sandbox through string injection, resulting in a sandbox escape.</li>
<li>TOB-BREW-5, wherein Homebrew used a collision-prone hash function (MD5) for a synthetic namespace (<code>FormulaNamespace</code>) could allow an attacker to induce runtime confusion between formulae.</li>
<li>TOB-BREW-8, wherein a formula can surreptitiously include networked resources in its build without explicitly listing them via <code>resource</code> stanzas.</li>
<li>TOB-BREW-11, wherein a formula can potentially use a socket pivot to escape its build sandbox on macOS.</li>
<li>TOB-BREW-12, wherein a formula could opportunistically perform a privilege escalation through a user’s previously activated <code>sudo</code> token.</li>
<li>TOB-BREW-13, wherein <code>brew install</code> can be induced to install formulae from non-local URLs for any protocol supported by the version of <code>curl</code> being used, such as SFTP or SCP.</li>
</ul>
<p>Our overall evaluation of <a href="https://github.com/Homebrew/brew">Homebrew/brew</a> is reflected in our report: while extensively tested, Homebrew’s large API and CLI surface and informal local behavioral contract offer a large variety of avenues for unsandboxed, local code execution to an opportunistic attacker. These avenues do not necessarily violate Homebrew’s core security assumptions (which assume trustworthy formulae), but may be subverted either by malicious formulae or through unexpected sources of formula loading (such as insufficiently sanitized inputs).</p>
<h4>Homebrew’s CI/CD</h4>
<p>Our review of Homebrew’s CI/CD workflows and actions uncovered findings that, while not critical, could undermine the integrity of Homebrew’s CI/CD runs and allow a less-privileged user to pivot to a position of higher privilege or even obtain persistence on Homebrew’s self-hosted GitHub Actions runners.</p>
<p>Some findings of interest include:</p>
<ul>
<li>TOB-BREW-18, wherein multiple CI/CD workflows use the <code>pull_request_target</code> trigger to allow third-party pull requests to run code in the context of Homebrew’s upstream repository, potentially enabling either credential disclosure or tampering with Homebrew’s bottle builds.</li>
<li>TOB-BREW-23, wherein multiple CI/CD workflows inadvertently allow shell injection via unsanitized <code>workflow_dispatch</code> inputs, potentially enabling vertical movement by a less-privileged user (i.e., one who can dispatch workflows but not modify them).</li>
</ul>
<p>Beyond CI/CD-specific findings, many brew findings are also salient in the CI/CD setting:</p>
<ul>
<li>TOB-BREW-6, which describes a lack of sandboxing/isolation during archive extraction, could be used by a less-privileged CI actor to pivot into a higher-privileged context by inducing extraction of a formula or other executable code that gets auto-loaded and executed during the CI’s lifecycle.</li>
<li>TOB-BREW-13, described above, could be used by a less-privileged CI actor to pivot into a higher-privileged context, by inducing arbitrary code execution through <code>brew install</code> of a formula not present in the CI’s pre-configured (presumed trusted) context.</li>
</ul>
<p>Our report concludes that Homebrew’s CI/CD, while mature and effective at reducing the number of human touch-points in Homebrew’s package lifecycle, is complex and relies on misuse-prone patterns common in GitHub Actions workflows (such as dangerous workflow triggers and mixing of configuration, code, and data via template expansion). These patterns do not necessarily enable persistence or pivoting by a fully external actor, but may be leveraged by a lower-privileged insider (such as a rogue maintainer) to undermine the integrity and isolation assumptions made by Homebrew’s CI/CD.</p>
<h3>Takeaways</h3>
<p>Auditing a package management ecosystem such as Homebrew poses unique challenges. Local package management tools install and execute arbitrary third-party code by design and, as such, typically have informal and loosely defined boundaries between expected and unexpected code execution. This is especially true in packaging ecosystems like Homebrew, where the “carrier” format for packages (formulae) is itself executable code (Ruby scripts, in Homebrew’s case).</p>
<p>Throughout the audit, we worked closely with the <a href="https://github.com/Homebrew/brew?tab=readme-ov-file#who-we-are">Homebrew maintainers</a> and the <a href="https://docs.brew.sh/Homebrew-Governance">Homebrew PLC</a> and would like to thank them for sharing their extensive knowledge and expertise. We would also like to thank <a href="https://github.com/p-linnane">Patrick Linnane</a>, Homebrew’s security manager, in particular for his triage and coordination efforts on behalf of Homebrew.</p>

			</div><!-- .entry-content -->

	
</article><!-- #post-107865 -->
						<!-- #nav-below -->
		
					<!-- #comments .comments-area -->

			
			</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Fake Job Interviews Are Securities Fraud (228 pts)]]></title>
            <link>https://www.bloomberg.com/opinion/articles/2024-07-30/fake-job-interviews-are-securities-fraud</link>
            <guid>41112855</guid>
            <pubDate>Tue, 30 Jul 2024 18:55:14 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.bloomberg.com/opinion/articles/2024-07-30/fake-job-interviews-are-securities-fraud">https://www.bloomberg.com/opinion/articles/2024-07-30/fake-job-interviews-are-securities-fraud</a>, See on <a href="https://news.ycombinator.com/item?id=41112855">Hacker News</a></p>
<div id="readability-page-1" class="page"><section>
    <section>
        <h3>Why did this happen?</h3>
        <p>Please make sure your browser supports JavaScript and cookies and that you are not
            blocking them from loading.
            For more information you can review our <a href="https://www.bloomberg.com/notices/tos">Terms of
                Service</a> and <a href="https://www.bloomberg.com/notices/tos">Cookie Policy</a>.</p>
    </section>
    <section>
        <h3>Need Help?</h3>
        <p>For inquiries related to this message please <a href="https://www.bloomberg.com/feedback">contact
            our support team</a> and provide the reference ID below.</p>
        <p>Block reference ID:</p>
    </section>
</section></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Porffor: A from-scratch ahead-of-time JS engine (298 pts)]]></title>
            <link>https://porffor.dev/</link>
            <guid>41112854</guid>
            <pubDate>Tue, 30 Jul 2024 18:55:10 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://porffor.dev/">https://porffor.dev/</a>, See on <a href="https://news.ycombinator.com/item?id=41112854">Hacker News</a></p>
<div id="readability-page-1" class="page"><article>
    <h2>A from-scratch experimental ahead-of-time JS engine</h2>
    <p>Porffor is a unique JS engine/compiler/runtime, compiling JS code to WebAssembly or native ahead-of-time.<br>It is seriously limited for now; intended for research, not serious use!</p>

    <section>
      <div>
        <h2>Wasm compilation</h2>
        <p>Porffor's WebAssembly output is much faster and smaller compared to existing JS -&gt; Wasm projects. This is because Porffor compiles JS AOT instead of bundling an interpreter.</p>
        <ul>
          <li>Wasm size: <b>32x smaller</b> than Javy (~1.3MB -&gt; ~40KB)</li>
          <li>Wasm perf: <b>18x faster</b> than Javy (~70m -&gt; ~4m)</li>
        </ul>
      </div>

      <div>
        <h2>Native compilation</h2>
        <p>Due to compiling JS ahead-of-time, Porffor can compile to real native binaries without just packaging a runtime like existing solutions. This leads to:</p>
        <ul>
          <li>Binary sizes <b>over 1000x smaller</b> (~90MB -&gt; &lt;50KB)</li>
          <li>Memory usage <b>over 40x less</b> (~50MB -&gt; ~1MB)</li>
          <li>Performance <b>up to 3x faster</b></li>
        </ul>
      </div>

      <div>
        <h2>Plus...</h2>
        <p><b>Porffor is safe</b> as it compiles to Wasm (and then native). It is also written in a memory safe language (JS).</p>
        <p><b>Porffor is written from the ground-up</b> with AOT in mind instead of being based on any existing JS engine. The only dependency is a JS parser.</p>
        <p><b>Porffor supports TypeScript input</b>, no clunky transpiler step needed: just feed it a TS file.</p>
      </div>
    </section>

    <!-- <section class="bars">
      <div>
        <span>Porffor</span>
        <div style="--time: 19; --color: var(--accent-light)"><div></div></div>
        <span>19s</span>
      </div>

      <div>
        <span>Bun</span>
        <div style="--time: 43; --color: #fbf0df"><div></div></div>
        <span>43s</span>
      </div>

      <div>
        <span>Node</span>
        <div style="--time: 67; --color: #68bc4a"><div></div></div>
        <span>67s</span>
      </div>

      <p>
        Execution time for a benchmark (running a BF interpreter running <code>mandelbrot.bf</code>). Porffor ran using native compilation.
      </p>
    </section> -->

    <h2>Playground <span>You can try Porffor here online or locally with <code>npm i -g porffor@latest &amp;&amp; porf</code></span></h2>
    
    <!-- Valtype <select id="valtype_dropdown"></select> -->
    <!-- <span title="Optimization level">-O</span> <select id="opt_dropdown"></select> -->
    <span title="JS parser to use">Parser</span> 
    <span title="Experimental!">Target</span> 
    
    
    
    

    <h2>Test262 <span id="test262_percent"></span> <span><a href="https://github.com/tc39/test262">Test262</a> is the official ECMAScript conformance test suite. Porffor is ran against it each commit to track conformance progress!</span></h2>
    <div id="test262">
        
        <div id="graph_time">
          <p>3 months</p>
          <p>6 months</p>
          <p>all-time</p>
        </div>
        <svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none" id="svg"></svg>
      </div>
  </article></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Federal regulator says Amazon can be held responsible for faulty goods (114 pts)]]></title>
            <link>https://www.cnbc.com/2024/07/30/cpsc-says-amazon-responsible-for-faulty-goods-sold-on-its-marketplace.html</link>
            <guid>41111317</guid>
            <pubDate>Tue, 30 Jul 2024 16:53:11 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.cnbc.com/2024/07/30/cpsc-says-amazon-responsible-for-faulty-goods-sold-on-its-marketplace.html">https://www.cnbc.com/2024/07/30/cpsc-says-amazon-responsible-for-faulty-goods-sold-on-its-marketplace.html</a>, See on <a href="https://news.ycombinator.com/item?id=41111317">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="RegularArticle-ArticleBody-5" data-module="ArticleBody" data-test="articleBody-2" data-analytics="RegularArticle-articleBody-5-2"><div id="ArticleBody-InlineImage-107157826" data-test="InlineImage"><p>Packages move along a conveyor belt at an Amazon Fulfillment center on Cyber Monday in Robbinsville, New Jersey, on Nov. 28, 2022.</p><p>Stephanie Keith | Bloomberg | Getty Images</p></div><div><p>Federal regulators <a href="https://www.cpsc.gov/Newsroom/News-Releases/2024/CPSC-Finds-Amazon-Responsible-Under-Federal-Safety-Law-for-Hazardous-Products-Sold-by-Third-Party-Sellers-on-Amazon-com" target="_blank">have determined</a> that <span data-test="QuoteInBody" id="RegularArticle-QuoteInBody-2"><a href="https://www.cnbc.com/quotes/AMZN/">Amazon</a><span><span id="-WatchlistDropdown" data-analytics-id="-WatchlistDropdown"></span></span></span> can be held responsible for defective goods sold by third-party merchants on its online marketplace, rejecting the company's position that it's merely an intermediary between consumers and sellers.</p><p>In <a href="https://www.cpsc.gov/s3fs-public/pdfs/recall/lawsuits/abc/142%20-%20In%20the%20Matter%20of%20Amazon.com%20Inc.%20Decision%20and%20Order.pdf?" target="_blank">a landmark order</a> released Tuesday, the U.S. Consumer Product Safety Commission said the agency unanimously agreed Amazon "fits squarely" within the definition of a distributor of goods, "and therefore bears legal responsibility for their recall."</p><p>As part of the agency's decision, Amazon is required to develop a plan to notify purchasers and the public about the product hazards, as well as offer shoppers refunds or replacements for the affected products.</p><p>Amazon's marketplace, which hosts millions of third-party sellers, now accounts for&nbsp;<a href="https://blog.aboutamazon.com/policy/statement-by-jeff-bezos-to-the-u-s-house-committee-on-the-judiciary" target="_blank">approximately 60%</a>&nbsp;of the company's e-commerce sales. While the marketplace has helped Amazon bring in record revenue, it has also proven to host&nbsp;<a href="https://www.cnbc.com/2016/05/25/amazon-counterfeiters-wreak-havoc-on-artists-and-small-businesses.html">counterfeit</a>,&nbsp;<a href="https://www.cnbc.com/2019/08/29/senators-ask-jeff-bezos-to-crack-down-on-unsafe-products-on-amazon.html">unsafe</a>&nbsp;and even&nbsp;<a href="https://www.cnbc.com/2019/10/20/amazon-is-shipping-expired-baby-formula-and-other-out-of-date-foods.html">expired goods</a>. The company has previously said it invests hundreds of millions of dollars per year to ensure products sold are safe and compliant.</p><p>The decision addresses a thorny issue that's been debated for years. In numerous lawsuits, Amazon has maintained it just serves as the conduit between buyers and sellers on its marketplace and that it's not involved in the sourcing or distribution of products sold by third-party sellers, removing it from liability. That has been a successful defense for Amazon in the past, including&nbsp;<a href="https://www.cnbc.com/2018/06/02/amazon-not-liable-for-exploding-hoverboard-marketplace-argument-wins.html">in a 2018 case</a>&nbsp;concerning the purchase of a faulty hoverboard that exploded and burned down an Amazon shopper's house in Tennessee.&nbsp;In other cases, <a href="https://www.cnbc.com/2020/08/13/amazon-can-be-held-liable-for-faulty-goods-court-rules.html">federal courts</a> and <a href="https://www.cnbc.com/2020/08/31/controversial-ca-consumer-bill-will-not-advance-in-its-present-form.html">legislators</a> have said the e-commerce giant should be held liable.</p><p>In 2021, the CPSC <a href="https://www.cnbc.com/2021/07/14/us-regulator-sues-amazon-demands-recall-of-hazardous-products.html">sued</a> Amazon to force it to recall hundreds of thousands of products that it deemed hazardous. At issue were 418,818 goods sold through Amazon, including faulty carbon monoxide detectors, hairdryers without electrocution protection and children's sleepwear that posed a burn risk.</p><p>Amazon argued in its response to the agency complaint that it should be characterized as a third-party logistics provider, saying it only receives and transports the products sold through its site.</p><p>Still, Amazon removed all the products flagged by the CPSC and prohibited merchants from selling them on its marketplace. The company informed shoppers who purchased the items of "potential safety issues," told them to destroy the items and offered a credit.</p><p>The CPSC called these actions "inadequate," saying the company should've offered refunds to incentivize consumers to destroy or return the product.</p><p>In Tuesday's ruling, the agency said an administrative law judge dismissed Amazon's argument that it should be classified as a third-party logistics provider. The judge pointed to Amazon's Fulfilled by Amazon service, where sellers ship inventory into the company's warehouses, and those products are stored until they're purchased.</p><p>This program gives Amazon "far-reaching control" over the products sold on its platform, the judge said.</p><p>"Amazon cannot sidestep its obligations under the [Consumer Product Safety Act] simply because some portion of its extensive services involve logistics," the decision states. "Amazon must therefore comply with the CPSA to protect consumers from injury."</p><p>An Amazon spokesperson said in a statement that the company is "disappointed" by the CPSC's decision and plans to appeal. They added that Amazon stands behind the safety of every product in its store, regardless of whether it's sold by the company our a third-party seller. </p><p>If a product is recalled, Amazon removes them from its platform and informs shoppers of any product safety information, the spokesperson said. In 2021, the company <a href="https://www.cnbc.com/2021/08/10/amazon-lets-consumers-file-complaints-for-faulty-goods-from-3p-sellers.html">updated its returns policy</a> to allow shoppers to contact Amazon directly with any complaints of faulty goods, rather than communicating with the third-party merchant. </p></div><div id="RegularArticle-RelatedContent-1"><h2>Don’t miss these insights from CNBC PRO</h2><div><ul><li><a href="https://www.cnbc.com/2024/07/26/nvidia-may-face-a-massive-technical-sell-off-chart-analyst-warns.html">Nvidia could be on the verge of a massive technical sell-off, chart analyst warns</a></li><li><a href="https://www.cnbc.com/2024/07/25/tom-lee-says-the-rotation-out-of-large-caps-is-just-beginning-small-caps-to-surge-15percent-in-august.html">Tom Lee says the rotation out of large caps is just beginning, small caps to surge 15% in August</a></li><li><a href="https://www.cnbc.com/2024/07/24/5-attractively-valued-growth-stocks-to-buy-hold-for-next-decade-pros5-attractively-valued-growth-stocks-to-buy-hold-for-next-decade-pros.html">Buy and hold these 5 attractively valued growth stocks for the next decade, the pros say</a></li><li><a href="https://www.cnbc.com/2024/07/23/magnificent-7-alternatives-buy-these-stocks-instead-wealth-manager-says.html">Avoid the ‘Magnificent 7’ and buy these lesser-known stocks instead, wealth manager says</a></li></ul></div></div><div id="Placeholder-ArticleBody-Video-107131531" data-test="VideoPlaceHolder" role="region" tabindex="0" data-vilynx-id="7000267761" aria-labelledby="Placeholder-ArticleBody-Video-107131531"><p><img src="https://image.cnbcfm.com/api/v1/image/107132294-1665466235480-bags.jpg?v=1665579541&amp;w=750&amp;h=422&amp;vtcrop=y" alt="How Amazon private labels work, from AmazonBasics to its 100+ other owned brands"><span></span><span></span></p></div></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Meta to pay Texas $1.4B for using facial recognition without users' permission (313 pts)]]></title>
            <link>https://www.texastribune.org/2024/07/30/texas-meta-facebook-biometric-data-settlement/</link>
            <guid>41111145</guid>
            <pubDate>Tue, 30 Jul 2024 16:41:13 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.texastribune.org/2024/07/30/texas-meta-facebook-biometric-data-settlement/">https://www.texastribune.org/2024/07/30/texas-meta-facebook-biometric-data-settlement/</a>, See on <a href="https://news.ycombinator.com/item?id=41111145">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
  
    
      


    
      <p><em><a href="https://www.texastribune.org/newsletters/the-brief/?utm_medium=website&amp;utm_source=trib-ads-owned&amp;utm_campaign=trib-marketing&amp;utm_term=inline-CTA-brief">Sign up for The Brief</a>, The Texas Tribune’s daily newsletter that keeps readers up to speed on the most essential Texas news.</em>
</p>
<hr>
    
      <p>Facebook’s parent company Meta will pay Texas $1.4 billion to settle a lawsuit that accused the company of using personal biometric data without users’ authorization.</p>

    
      <p>The 2022 lawsuit, filed by Texas Attorney General Ken Paxton in state court, alleged that Meta had been using facial recognition software on photos uploaded to Facebook without Texans’ consent.</p>

    
      <p>Paxton’s office said this is the largest settlement ever obtained by a single state and the largest related to privacy ever secured by a state attorney general. The settlement will be paid over five years. The attorney general’s office did not say whether the money from the settlement would go into the state’s general fund or if it would be distributed in some other way.</p>

    
      <p>“This historic settlement demonstrates our commitment to standing up to the world’s biggest technology companies and holding them accountable for breaking the law and violating Texans’ privacy rights. Any abuse of Texans’ sensitive data will be met with the full force of the law,” Paxton said in a statement.</p>

    
      


    
      <p>The settlement, announced Tuesday, does not act as an admission of guilt and Meta maintains no wrongdoing.</p>

    
      <p>This was the first lawsuit Paxton’s office argued under a 2009 state law that protects Texans’ biometric data, like fingerprints and facial scans. The law requires businesses to inform and get consent from individuals before collecting such data. It also limits sharing this data, except in certain cases like helping law enforcement or completing financial transactions. Businesses must protect this data and destroy it within a year after it's no longer needed.</p>

    
      <p>In 2011, Meta introduced a feature known as Tag Suggestions to make it easier for users to tag people in their photos. According to Paxton’s office, the feature was turned on by default and ran facial recognition on users’ photos, automatically capturing data protected by the 2009 law. That system was discontinued in 2021, with Meta saying it deleted over 1 billion people’s individual facial recognition data.</p>

    
      <p>As part of the settlement, Meta must notify the attorney general’s office of anticipated or ongoing activities that may fall under the state’s biometric data laws. If Texas objects, the parties have 60 days to attempt to resolve the issue.</p>

    
      


    
      <p>Meta officials said the settlement will make it easier for the company to discuss the implications and requirements of the state’s biometric data laws with the attorney general’s office, adding that data protection and privacy are core priorities for the firm.</p>

    
      <p>“We are pleased to resolve this matter, and look forward to exploring future opportunities to deepen our business investments in Texas, including potentially developing data centers,” a Meta spokesperson said Tuesday.</p>

    
      <p>Meta has about a month to pay the first installment of $500 million to the state. Subsequent installments of $225 million each will be paid annually from 2025 to 2028.</p>

    
      <p><i>Disclosure: Facebook has been a financial supporter of The Texas Tribune, a nonprofit, nonpartisan news organization that is funded in part by donations from members, foundations and corporate sponsors. Financial supporters play no role in the Tribune's journalism. Find a complete <a href="https://www.texastribune.org/support-us/corporate-sponsors/">list of them here</a>.</i></p>

    
      


    
      <hr>

    
      <p><em>The full program is now LIVE for the <a href="https://trib.it/X3GApE" rel="noopener" target="_blank"><strong>2024 Texas Tribune Festival</strong></a>, happening Sept. 5–7 in downtown Austin. Explore the program featuring more than 100 unforgettable conversations on topics covering education, the economy, Texas and national politics, criminal justice, the border, the 2024 elections and so much more. <a href="https://trib.it/dKMrcr" rel="noopener" target="_blank"><strong>See the full program.</strong></a></em></p>

    
  
</div><p><strong>
    <a href="https://www.texastribune.org/corrections/"><em>Correction, <time datetime="2024-07-30T12:03:38.033540">July 30, 2024 at 12:03 p.m.</time></em></a>:
</strong>

An earlier version of this story said the Texas attorney general's office announced the settlement on Monday. It was on Tuesday.</p></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Swift Homomorphic Encryption (214 pts)]]></title>
            <link>https://www.swift.org/blog/announcing-swift-homomorphic-encryption/</link>
            <guid>41111129</guid>
            <pubDate>Tue, 30 Jul 2024 16:40:13 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.swift.org/blog/announcing-swift-homomorphic-encryption/">https://www.swift.org/blog/announcing-swift-homomorphic-encryption/</a>, See on <a href="https://news.ycombinator.com/item?id=41111129">Hacker News</a></p>
<div id="readability-page-1" class="page"><div role="main">
<article>
  <header>
    

    <time pubdate="" datetime="2024-07-30T06:00:00-04:00">July 30, 2024</time>
    
  </header>

  <p>We’re excited to announce a new open source Swift package for homomorphic
encryption in Swift:
<a href="https://github.com/apple/swift-homomorphic-encryption">swift-homomorphic-encryption</a>.</p>

<p>Homomorphic encryption (HE) is a cryptographic technique that enables
computation on encrypted data <em>without</em> revealing the underlying unencrypted
data to the operating process. It provides a means for clients to send encrypted
data to a server, which operates on that encrypted data and returns a result
that the client can decrypt. During the execution of the request, the server
itself never decrypts the original data or even has access to the decryption
key. Such an approach presents new opportunities for cloud services to operate
while protecting the privacy and security of a user’s data, which is obviously
highly attractive for many scenarios.</p>

<p>At Apple, we’re using homomorphic encryption in our own work; we’re therefore
delighted to share this Swift implementation in the community for others to use
and contribute to.</p>

<p>One example of how we’re using this implementation in iOS 18, is the new <a href="https://developer.apple.com/documentation/sms_and_call_reporting/getting_up-to-date_calling_and_blocking_information_for_your_app">Live
Caller ID
Lookup</a>
feature, which provides caller ID and spam blocking services. Live Caller ID
Lookup uses homomorphic encryption to send an encrypted query to a server that
can provide information about a phone number without the server knowing the
specific phone number in the request. To demonstrate this, we are also sharing
<a href="https://github.com/apple/live-caller-id-lookup-example">live-caller-id-lookup-example</a>,
which provides a functional example backend to test the Live Caller ID Lookup
feature using homomorphic encryption.</p>

<p>These two packages take full advantage of features such as:</p>
<ul>
  <li><a href="https://www.swift.org/documentation/server/">Swift on Server</a>, including the Hummingbird HTTP framework and cross-platform support</li>
  <li>easy benchmarking with the <a href="https://github.com/ordo-one/package-benchmark">Benchmark</a> library</li>
  <li>performant low-level cryptography primitives in <a href="https://github.com/apple/swift-crypto">Swift Crypto</a>.</li>
</ul>


<p>Live Caller ID Lookup relies on <em>Private Information Retrieval (PIR)</em>, a form of private key-value database lookup.
In the PIR setting, a client has a private keyword (such as a phone number) and wants to retrieve the associated value from a server.
Because the keyword is private, the client wants to perform this lookup without the server learning the keyword.</p>

<p>A trivial implementation of PIR is to have the server send the entire database to the client for local processing.
While this does prevent the server from knowing what queries are being made, it is only feasible for small databases with infrequent updates.</p>

<p>In contrast, our PIR implementation, which relies on homomorphic encryption, only needs to sync a small amount of database metadata with the client.
This metadata changes infrequently, which allows efficient handling of very large databases with a high volume of updates.</p>


<p>As mentioned above, homomorphic encryption enables computation on encrypted data without decryption or access to the decryption key.</p>

<p>A typical workflow for homomorphic encryption might be as follows:</p>
<ul>
  <li>The client encrypts its sensitive data and sends the result to the server.</li>
  <li>The server performs computation on the ciphertext (perhaps incorporating its
own plaintext inputs), without learning what any ciphertext decrypts to.</li>
  <li>The server sends the resulting ciphertext response to the client.</li>
  <li>The client decrypts the resulting response.</li>
</ul>

<p>The Swift implementation of homomorphic encryption implements the
Brakerski-Fan-Vercauteren (BFV) HE scheme
(<a href="https://eprint.iacr.org/2012/078">https://eprint.iacr.org/2012/078</a>,
<a href="https://eprint.iacr.org/2012/144">https://eprint.iacr.org/2012/144</a>). BFV
is based on the ring learning with errors (RLWE) hardness problem, which is
quantum resistant.</p>

<p>The Live Caller ID Lookup feature requires BFV parameters
with post-quantum 128-bit security, to provide strong security against both classical and
potential future quantum attacks, previously explained in https://security.apple.com/blog/imessage-pq3/.</p>


<p>We believe developers will find homomorphic encryption useful for a wide variety
of standalone privacy-preserving applications both inside and outside the Apple
ecosystem, including private set intersection, secure aggregation, and machine
learning.</p>

<p>Below is a basic example for how to use Swift Homomorphic Encryption.</p>
<div><pre><code><span>import</span> <span>HomomorphicEncryption</span>

<span>// We start by choosing some encryption parameters for the Bfv&lt;UInt64&gt; scheme.</span>
<span>// *These encryption parameters are insecure, suitable for testing only.*</span>
<span>let</span> <span>encryptParams</span> <span>=</span>
    <span>try</span> <span>EncryptionParameters</span><span>&lt;</span><span>Bfv</span><span>&lt;</span><span>UInt64</span><span>&gt;&gt;</span><span>(</span><span>from</span><span>:</span> <span>.</span><span>insecure_n_8_logq_5x18_logt_5</span><span>)</span>
<span>// Perform pre-computation for HE computation with these parameters.</span>
<span>let</span> <span>context</span> <span>=</span> <span>try</span> <span>Context</span><span>(</span><span>encryptionParameters</span><span>:</span> <span>encryptParams</span><span>)</span>

<span>// We encode N values using coefficient encoding.</span>
<span>let</span> <span>values</span><span>:</span> <span>[</span><span>UInt64</span><span>]</span> <span>=</span> <span>[</span><span>8</span><span>,</span> <span>5</span><span>,</span> <span>12</span><span>,</span> <span>12</span><span>,</span> <span>15</span><span>,</span> <span>0</span><span>,</span> <span>8</span><span>,</span> <span>5</span><span>]</span>
<span>let</span> <span>plaintext</span><span>:</span> <span>Bfv</span><span>&lt;</span><span>UInt64</span><span>&gt;.</span><span>CoeffPlaintext</span> <span>=</span> <span>try</span> <span>context</span><span>.</span><span>encode</span><span>(</span>
    <span>values</span><span>:</span> <span>values</span><span>,</span>
    <span>format</span><span>:</span> <span>.</span><span>coefficient</span><span>)</span>

<span>// We generate a secret key and use it to encrypt the plaintext.</span>
<span>let</span> <span>secretKey</span> <span>=</span> <span>try</span> <span>context</span><span>.</span><span>generateSecretKey</span><span>()</span>
<span>let</span> <span>ciphertext</span> <span>=</span> <span>try</span> <span>plaintext</span><span>.</span><span>encrypt</span><span>(</span><span>using</span><span>:</span> <span>secretKey</span><span>)</span>

<span>// Decrypting the plaintext yields the original values.</span>
<span>let</span> <span>decrypted</span> <span>=</span> <span>try</span> <span>ciphertext</span><span>.</span><span>decrypt</span><span>(</span><span>using</span><span>:</span> <span>secretKey</span><span>)</span>
<span>let</span> <span>decoded</span><span>:</span> <span>[</span><span>UInt64</span><span>]</span> <span>=</span> <span>try</span> <span>decrypted</span><span>.</span><span>decode</span><span>(</span><span>format</span><span>:</span> <span>.</span><span>coefficient</span><span>)</span>
<span>precondition</span><span>(</span><span>decoded</span> <span>==</span> <span>values</span><span>)</span>
</code></pre></div>

<p>We look forward to working with others to enhance this package: you can read more about contributing at the repositories on GitHub.
We also encourage you to file issues to <a href="https://github.com/apple/swift-homomorphic-encryption/issues">swift-homomorphic-encryption</a> and <a href="https://github.com/apple/live-caller-id-lookup-example/issues">live-caller-id-lookup-examples</a> if you encounter any problems or have suggestions for improvements.</p>

<p>We’re excited to see how homomorphic encryption can empower developers and
researchers in the Swift community to enable new use cases!</p>


  
</article>
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[The Truth About Linear Regression (2015) (216 pts)]]></title>
            <link>https://www.stat.cmu.edu/~cshalizi/TALR/</link>
            <guid>41111115</guid>
            <pubDate>Tue, 30 Jul 2024 16:38:40 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.stat.cmu.edu/~cshalizi/TALR/">https://www.stat.cmu.edu/~cshalizi/TALR/</a>, See on <a href="https://news.ycombinator.com/item?id=41111115">Hacker News</a></p>
Couldn't get https://www.stat.cmu.edu/~cshalizi/TALR/: Error: unable to verify the first certificate]]></description>
        </item>
        <item>
            <title><![CDATA[JavaScript garbage collection and closures (108 pts)]]></title>
            <link>https://jakearchibald.com/2024/garbage-collection-and-closures/</link>
            <guid>41111062</guid>
            <pubDate>Tue, 30 Jul 2024 16:35:04 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://jakearchibald.com/2024/garbage-collection-and-closures/">https://jakearchibald.com/2024/garbage-collection-and-closures/</a>, See on <a href="https://news.ycombinator.com/item?id=41111062">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><div><p><time datetime="2024-07-30">Posted 30 July 2024 </time></p><div><p>Me, <a href="https://twitter.com/DasSurma">Surma</a>, and <a href="https://twitter.com/_developit">Jason</a> were hacking on a thing, and discovered that garbage collection within a function doesn't quite work like we expected.</p>
<div><pre><code><span>function</span> <span>demo</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> bigArrayBuffer <span>=</span> <span>new</span> <span>ArrayBuffer</span><span>(</span><span>100_000_000</span><span>)</span><span>;</span>
  <span>const</span> id <span>=</span> <span>setTimeout</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    console<span>.</span><span>log</span><span>(</span>bigArrayBuffer<span>.</span>byteLength<span>)</span><span>;</span>
  <span>}</span><span>,</span> <span>1000</span><span>)</span><span>;</span>

  <span>return</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>clearTimeout</span><span>(</span>id<span>)</span><span>;</span>
<span>}</span>

globalThis<span>.</span>cancelDemo <span>=</span> <span>demo</span><span>(</span><span>)</span><span>;</span></code></pre></div><p>With the above, <code>bigArrayBuffer</code> is leaked forever. I didn't expect that, because:</p>
<ul>
<li>After a second, the function referencing <code>bigArrayBuffer</code> is no longer callable.</li>
<li>The returned cancel function doesn't reference <code>bigArrayBuffer</code>.</li>
</ul>
<p>But that doesn't matter. Here's why:</p>
<h2 id="javascript-engines-are-reasonably-smart"><a href="#javascript-engines-are-reasonably-smart">JavaScript engines are reasonably smart</a></h2>
<p>This doesn't leak:</p>
<div><pre><code><span>function</span> <span>demo</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> bigArrayBuffer <span>=</span> <span>new</span> <span>ArrayBuffer</span><span>(</span><span>100_000_000</span><span>)</span><span>;</span>
  console<span>.</span><span>log</span><span>(</span>bigArrayBuffer<span>.</span>byteLength<span>)</span><span>;</span>
<span>}</span>

<span>demo</span><span>(</span><span>)</span><span>;</span></code></pre></div><p>The function executes, <code>bigArrayBuffer</code> is no longer needed, so it's garbage collected.</p>
<p>This also doesn't leak:</p>
<div><pre><code><span>function</span> <span>demo</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> bigArrayBuffer <span>=</span> <span>new</span> <span>ArrayBuffer</span><span>(</span><span>100_000_000</span><span>)</span><span>;</span>

  <span>setTimeout</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    console<span>.</span><span>log</span><span>(</span>bigArrayBuffer<span>.</span>byteLength<span>)</span><span>;</span>
  <span>}</span><span>,</span> <span>1000</span><span>)</span><span>;</span>
<span>}</span>

<span>demo</span><span>(</span><span>)</span><span>;</span></code></pre></div><p>In this case:</p>
<ol>
<li>The engine knows it needs to retain <code>bigArrayBuffer</code> beyond the initial execution of the function, so it's kept around. It's associated with the scope that was created when <code>demo()</code> was called.</li>
<li>After a second, the function referencing <code>bigArrayBuffer</code> is no longer callable.</li>
<li>Since nothing within the scope is callable, the scope is garbage collected, along with <code>bigArrayBuffer</code>.</li>
</ol>
<p>This also doesn't leak:</p>
<div><pre><code><span>function</span> <span>demo</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> bigArrayBuffer <span>=</span> <span>new</span> <span>ArrayBuffer</span><span>(</span><span>100_000_000</span><span>)</span><span>;</span>

  <span>const</span> id <span>=</span> <span>setTimeout</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    console<span>.</span><span>log</span><span>(</span><span>'hello'</span><span>)</span><span>;</span>
  <span>}</span><span>,</span> <span>1000</span><span>)</span><span>;</span>

  <span>return</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>clearTimeout</span><span>(</span>id<span>)</span><span>;</span>
<span>}</span>

globalThis<span>.</span>cancelDemo <span>=</span> <span>demo</span><span>(</span><span>)</span><span>;</span></code></pre></div><p>In this case, the engine knows it doesn't need to retain <code>bigArrayBuffer</code> beyond the initial execution of the function, as none of the future-callables access it.</p>
<h2 id="the-problem-case"><a href="#the-problem-case">The problem case</a></h2>
<p>Here's where it gets messy:</p>
<div><pre><code><span>function</span> <span>demo</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> bigArrayBuffer <span>=</span> <span>new</span> <span>ArrayBuffer</span><span>(</span><span>100_000_000</span><span>)</span><span>;</span>

  <span>const</span> id <span>=</span> <span>setTimeout</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    console<span>.</span><span>log</span><span>(</span>bigArrayBuffer<span>.</span>byteLength<span>)</span><span>;</span>
  <span>}</span><span>,</span> <span>1000</span><span>)</span><span>;</span>

  <span>return</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>clearTimeout</span><span>(</span>id<span>)</span><span>;</span>
<span>}</span>

globalThis<span>.</span>cancelDemo <span>=</span> <span>demo</span><span>(</span><span>)</span><span>;</span></code></pre></div><p>This leaks, because:</p>
<ol>
<li>The engine knows it needs to retain <code>bigArrayBuffer</code> beyond the initial execution of the function, so it's kept around. It's associated with the scope that was created when <code>demo()</code> was called.</li>
<li>After a second, the function referencing <code>bigArrayBuffer</code> is no longer callable.</li>
<li>But, the scope remains, because the cleanup function within is still callable.</li>
<li><code>bigArrayBuffer</code> is associated with the scope, so it remains in memory.</li>
</ol>
<p>I thought engines would be smarter, and GC <code>bigArrayBuffer</code> since it's no longer referenceable, but that isn't the case.</p>
<div><pre><code>globalThis<span>.</span>cancelDemo <span>=</span> <span>null</span><span>;</span></code></pre></div><p><em>Now</em> <code>bigArrayBuffer</code> is GC'd, since nothing within the scope is callable.</p>
<p>This isn't specific to timers, it's just how I encountered the issue. For example:</p>
<div><pre><code><span>function</span> <span>demo</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> bigArrayBuffer <span>=</span> <span>new</span> <span>ArrayBuffer</span><span>(</span><span>100_000_000</span><span>)</span><span>;</span>

  globalThis<span>.</span><span>innerFunc1</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    console<span>.</span><span>log</span><span>(</span>bigArrayBuffer<span>.</span>byteLength<span>)</span><span>;</span>
  <span>}</span><span>;</span>

  globalThis<span>.</span><span>innerFunc2</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    console<span>.</span><span>log</span><span>(</span><span>'hello'</span><span>)</span><span>;</span>
  <span>}</span><span>;</span>
<span>}</span>

<span>demo</span><span>(</span><span>)</span><span>;</span>
<span>// bigArrayBuffer is retained, as expected.</span>

globalThis<span>.</span>innerFunc1 <span>=</span> <span>undefined</span><span>;</span>
<span>// bigArrayBuffer is still retained, as unexpected.</span>

globalThis<span>.</span>innerFunc2 <span>=</span> <span>undefined</span><span>;</span>
<span>// bigArrayBuffer can now be collected.</span></code></pre></div><p>TIL!</p>
</div><p><small><a href="https://github.com/jakearchibald/jakearchibald.com/blob/main/static-build/posts/2024/07/garbage-collection-and-closures/index.md">View this page on GitHub</a></small></p></div><section><figure><h2><picture><source srcset="https://jakearchibald.com/c/me-cat-2a46b6f2.avif" type="image/avif"><source srcset="https://jakearchibald.com/c/me-cat-29ff6dc5.webp" type="image/webp"><img width="800" height="844" src="https://jakearchibald.com/c/me-cat-862e9e16.jpg" alt="Jake Archibald in a garden with a black cat"></picture></h2></figure><p>Hello, I'm Jake and that's me there. The one that isn't a cat. I'm a developer of sorts.</p><h2>Elsewhere</h2><h2>Contact</h2><p>Feel free to <a href="mailto:jaffathecake@gmail.com">throw me an email</a>, unless you're a recruiter, or someone trying to offer me 'sponsored content' for this site, in which case write your request on a piece of paper, and fling it out the window.</p></section></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[HNInternal: Launch HN: SSOReady (YC W24) – Making SAML SSO painless and open source (216 pts)]]></title>
            <link>https://news.ycombinator.com/item?id=41110850</link>
            <guid>41110850</guid>
            <pubDate>Tue, 30 Jul 2024 16:19:45 GMT</pubDate>
            <description><![CDATA[<p>See on <a href="https://news.ycombinator.com/item?id=41110850">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><td><table>
        <tbody><tr id="41110850">
      <td><span></span></td>      <td><center><a id="up_41110850" href="https://news.ycombinator.com/vote?id=41110850&amp;how=up&amp;goto=item%3Fid%3D41110850"></a></center></td><td><span><a href="https://news.ycombinator.com/item?id=41110850">Launch HN: SSOReady (YC W24) – Making SAML SSO painless and open source</a></span></td></tr><tr><td colspan="2"></td><td><span>
          <span id="score_41110850">108 points</span> by <a href="https://news.ycombinator.com/user?id=ucarion">ucarion</a> <span title="2024-07-30T16:19:45"><a href="https://news.ycombinator.com/item?id=41110850">3 hours ago</a></span> <span id="unv_41110850"></span> | <a href="https://news.ycombinator.com/hide?id=41110850&amp;goto=item%3Fid%3D41110850">hide</a> | <a href="https://hn.algolia.com/?query=Launch%20HN%3A%20SSOReady%20(YC%20W24)%20%E2%80%93%20Making%20SAML%20SSO%20painless%20and%20open%20source&amp;type=story&amp;dateRange=all&amp;sort=byDate&amp;storyText=false&amp;prefix&amp;page=0">past</a> | <a href="https://news.ycombinator.com/fave?id=41110850&amp;auth=136767a880b85e046625fe9d6b781c656b3492cf">favorite</a> | <a href="https://news.ycombinator.com/item?id=41110850">45&nbsp;comments</a>        </span>
              </td></tr>
    <tr><td></td></tr><tr><td colspan="2"></td><td><div><p>Hey everyone, I'm Ulysse, CTO at SSOReady (<a href="https://github.com/ssoready/ssoready">https://github.com/ssoready/ssoready</a>).</p><p>SSOReady is an open-source (MIT) service that lets you implement SAML single sign-on without ever touching SAML yourself. You just need to implement two API endpoints: one to initiate SAML logins and another to receive incoming SAML messages. And then you're pretty much done.</p><p>Here's me setting up SAML single sign-on in under a minute: (<a href="https://www.youtube.com/watch?v=_HVtFkW8xCI" rel="nofollow">https://www.youtube.com/watch?v=_HVtFkW8xCI</a>).</p><p>You can use our service with whatever tech stack or programming language you prefer.</p><p>Earlier in my career, I worked on SAML authentication at Segment. I've been pretty obsessed with SAML since then. In the depths of the COVID pandemic, I even wrote an implementation of SAML in Go to entertain myself (<a href="https://github.com/ucarion/saml">https://github.com/ucarion/saml</a>).</p><p>Over the years, I've gotten really itchy to build better SAML tooling. There just aren't a lot of great options out there. Almost no one seems interested in making SAML easy for developers. Almost no one seems interested in writing clear documentation.</p><p>We're hoping to change that with SSOReady. We've open-sourced our codebase on an MIT license. You can do pretty much whatever you want with the code. Fork us. Self-host us.</p><p>We've also made the product entirely free.</p><p>Why free and open source? We're focused solitarily on becoming developers' first choice for SAML SSO. If it makes developers' lives easier, it works for us. We expect to monetize in the future by building extra features that serve large companies with complex needs. We don't see any point to being secretive or squeezing dollars out of small companies.</p><p>I'd be thrilled if you gave the product a try, and I'd be really grateful for any feedback on your experience.</p><p>If you have any questions or concerns, my cofounder Ned and I will stay active on this thread throughout the day. You can also reach us directly at founders@ssoready.com. (We really mean this! We want to hear from you!)</p></div></td></tr>        <tr><td></td></tr><tr><td colspan="2"></td><td><form action="comment" method="post"></form></td></tr>  </tbody></table>
  </td></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[DARPA: Translating All C to Rust (Tractor) (259 pts)]]></title>
            <link>https://www.darpa.mil/program/translating-all-c-to-rust</link>
            <guid>41110269</guid>
            <pubDate>Tue, 30 Jul 2024 15:42:06 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.darpa.mil/program/translating-all-c-to-rust">https://www.darpa.mil/program/translating-all-c-to-rust</a>, See on <a href="https://news.ycombinator.com/item?id=41110269">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="ContentPane" role="main">

						





						















						<div>
							<h2>Tags</h2>
						</div>
						<!-- need a horizontal datalist control so that tag values can be bound to the anchor tag with the id of the tag -->

						<p><span>|</span>

						</p>


						







						<div id="myRelatedContent_dRelated">
								<h2>Similarly&nbsp;&nbsp;&nbsp;&nbsp;Tagged&nbsp;&nbsp;&nbsp;&nbsp;Content</h2>
								
							</div>

						<div id="divMedia">
							<p>
								<h2>Images</h2>
							</p>
							<ul id="ulMedia">
							</ul>
						</div>

					</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Dear AI Companies, instead of scraping OpenStreetMap, how about a $10k donation? (362 pts)]]></title>
            <link>https://en.osm.town/@Firefishy/112875549871566269</link>
            <guid>41109926</guid>
            <pubDate>Tue, 30 Jul 2024 15:11:44 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://en.osm.town/@Firefishy/112875549871566269">https://en.osm.town/@Firefishy/112875549871566269</a>, See on <a href="https://news.ycombinator.com/item?id=41109926">Hacker News</a></p>
&lt;Unparsable&gt;]]></description>
        </item>
        <item>
            <title><![CDATA[Why doesn't advice work? (240 pts)]]></title>
            <link>https://dynomight.substack.com/p/advice</link>
            <guid>41109891</guid>
            <pubDate>Tue, 30 Jul 2024 15:07:51 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://dynomight.substack.com/p/advice">https://dynomight.substack.com/p/advice</a>, See on <a href="https://news.ycombinator.com/item?id=41109891">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><article><div dir="auto"><p><span>In ancient India, there was a long-running feud between the </span><a href="https://en.wikipedia.org/wiki/Pandava" rel="">Pandavas</a><span> and the </span><a href="https://en.wikipedia.org/wiki/Kaurava" rel="">Kauravas</a><span>. </span><a href="https://en.wikipedia.org/wiki/Duryodhana" rel="">Duryodhana</a><span>, leader of the Kauravas, planned a huge war to end things forever. </span><a href="https://en.wikipedia.org/wiki/Krishna" rel="">Krishna</a><span> warned that this would lead to the total destruction of both sides and made every effort to forge a peace.</span></p><p>Duryodhana refused to listen and launched his war. There were 4 million warriors at the start. After 18 days, all but 11 were dead.</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcc07d16b-a9b5-426f-8507-0ebc2557dda1_703x367.jpeg" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcc07d16b-a9b5-426f-8507-0ebc2557dda1_703x367.jpeg 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcc07d16b-a9b5-426f-8507-0ebc2557dda1_703x367.jpeg 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcc07d16b-a9b5-426f-8507-0ebc2557dda1_703x367.jpeg 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcc07d16b-a9b5-426f-8507-0ebc2557dda1_703x367.jpeg 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcc07d16b-a9b5-426f-8507-0ebc2557dda1_703x367.jpeg" width="703" height="367" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/cc07d16b-a9b5-426f-8507-0ebc2557dda1_703x367.jpeg&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:367,&quot;width&quot;:703,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:null,&quot;alt&quot;:&quot;&quot;,&quot;title&quot;:null,&quot;type&quot;:null,&quot;href&quot;:null,&quot;belowTheFold&quot;:false,&quot;topImage&quot;:true,&quot;internalRedirect&quot;:null}" alt="" title="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcc07d16b-a9b5-426f-8507-0ebc2557dda1_703x367.jpeg 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcc07d16b-a9b5-426f-8507-0ebc2557dda1_703x367.jpeg 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcc07d16b-a9b5-426f-8507-0ebc2557dda1_703x367.jpeg 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcc07d16b-a9b5-426f-8507-0ebc2557dda1_703x367.jpeg 1456w" sizes="100vw" fetchpriority="high"></picture></div></a></figure></div><p><span>It’s unclear if Duryodhana knew Krishna was a god. Duryodhana may have been an atheist, despite having seen Krishna in his extremely multi-armed/multi-headed </span><a href="https://en.wikipedia.org/wiki/Vishvarupa" rel="">Vishvarupa</a><span> form. But Krishna had certainly proven himself to be a master tactician and strategist—also he was blue.</span></p><p>So why didn’t Duryodhana listen?</p><p>It seems like this happens a lot. Someone has a problem, they ask you for advice, and you give it to them. Your advice is impeccable, pragmatic, human, wise. But they ignore you and suffer the predictable consequences. All they had to do is listen. So why didn’t they?</p><p>Big picture, my impression is that advice just doesn’t seem to do all that much. Why?</p><p>Maybe your advice is terrible and if people followed it, they’d do even worse. Or maybe your advice is good for the situation as you understand it, but not for the real world because of details you don’t know about.</p><p><span>I’m sure there’s lots of this. The median nutrition advice is appalling. In 1962, President Kennedy’s Joint Chiefs of Staff </span><em>all</em><span> advised air strikes on Soviet missile installations in Cuba. Internet people seem to think you should divorce your spouse for misdeeds as minor as forgetting to buy shampoo.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3180c6e2-7251-4e5c-bbe6-ae3dc27d1425_600x507.gif" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_lossy/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3180c6e2-7251-4e5c-bbe6-ae3dc27d1425_600x507.gif 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_lossy/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3180c6e2-7251-4e5c-bbe6-ae3dc27d1425_600x507.gif 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_lossy/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3180c6e2-7251-4e5c-bbe6-ae3dc27d1425_600x507.gif 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_lossy/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3180c6e2-7251-4e5c-bbe6-ae3dc27d1425_600x507.gif 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_lossy/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3180c6e2-7251-4e5c-bbe6-ae3dc27d1425_600x507.gif" width="600" height="507" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/3180c6e2-7251-4e5c-bbe6-ae3dc27d1425_600x507.gif&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:507,&quot;width&quot;:600,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:null,&quot;alt&quot;:&quot;&quot;,&quot;title&quot;:null,&quot;type&quot;:null,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" title="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_lossy/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3180c6e2-7251-4e5c-bbe6-ae3dc27d1425_600x507.gif 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_lossy/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3180c6e2-7251-4e5c-bbe6-ae3dc27d1425_600x507.gif 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_lossy/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3180c6e2-7251-4e5c-bbe6-ae3dc27d1425_600x507.gif 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_lossy/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3180c6e2-7251-4e5c-bbe6-ae3dc27d1425_600x507.gif 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>But I’m still convinced that lots of good advice gets ignored. Because—people sometimes ask me for advice, ignore it, struggle, and then finally come back and </span><em>explain my advice to me</em><span> as if it was novel. (Presumably I do the same thing.)</span></p><p><span>When I was learning to climb, everyone said things like, “if in doubt, move your feet up” or “don’t pull yourself up with your arms, push yourself up with your legs”. These people were much better than me, and I could </span><em>see</em><span> them moving their feet up. I knew their advice was good and I tried to follow it, but I couldn’t understand how.</span></p><p>After learning to climb, I found myself telling newcomers the same things, with the same result.</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcaabd7cb-488a-4aeb-ae59-607d8661f43b_775x966.jpeg" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcaabd7cb-488a-4aeb-ae59-607d8661f43b_775x966.jpeg 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcaabd7cb-488a-4aeb-ae59-607d8661f43b_775x966.jpeg 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcaabd7cb-488a-4aeb-ae59-607d8661f43b_775x966.jpeg 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcaabd7cb-488a-4aeb-ae59-607d8661f43b_775x966.jpeg 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcaabd7cb-488a-4aeb-ae59-607d8661f43b_775x966.jpeg" width="775" height="966" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/caabd7cb-488a-4aeb-ae59-607d8661f43b_775x966.jpeg&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:966,&quot;width&quot;:775,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:null,&quot;alt&quot;:&quot;&quot;,&quot;title&quot;:null,&quot;type&quot;:null,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" title="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcaabd7cb-488a-4aeb-ae59-607d8661f43b_775x966.jpeg 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcaabd7cb-488a-4aeb-ae59-607d8661f43b_775x966.jpeg 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcaabd7cb-488a-4aeb-ae59-607d8661f43b_775x966.jpeg 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcaabd7cb-488a-4aeb-ae59-607d8661f43b_775x966.jpeg 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>I’m now convinced that “move your feet up” simply isn’t enough information. In reality you need to find the right holds, grab them in the right way, hang your arms the right way, get your center of gravity into the right position, and twist your hips and knees and ankles into the right angles. Then you need to move the right foot to the right new position while shifting your weight with the right speed. All these things are hard to explain in words and experienced climbers often don’t even think about them.</p><p><span>“Move your feet up” </span><em>seems</em><span> like a good explanation, because it’s the most visible action, and the one that you’ll most likely think about consciously. But it only works once you’ve internalized lots of other stuff through trial and error.</span></p><p><span>Sometimes I’ll have a personal revelation and then it will dawn on me that—oh </span><em>yeah</em><span>—people have been dropping hints about this for years, haven’t they? (Common themes include, “Wow you sure drink a lot of coffee!” and “I hear lavender oil is relaxing!” and “Have you ever tried yoga?”)</span></p><p>Often the advice was good and there wasn’t anything difficult about it. But I didn’t understand it and didn’t take it seriously. Looking back, I should have thought, “There must be a reason all these smart people keep bringing this up.” But instead my brain sort of converted their words into a big whooshing sound.</p><p><span>Maybe ignoring stuff we don’t understand is a cognitive bias. I suspect this bias has an evil sibling: Our brains often </span><em>make</em><span> us not understand advice that we don’t </span><em>want</em><span> to follow.</span></p><p><span>You’ve surely known someone who, after dating someone for 6-12 months was constantly stressed and anxious, but their relationship hasn’t progressed to the stage that they’d feel comfortable even </span><em>discussing</em><span> if they are “in a relationship”.</span></p><p>The conventional wisdom is to end things, or at least have a tough conversation, damn the consequences. Everyone knows this. But people in this situation often convince themselves their situation is exceptional, because ending the relationship (or whatever it is) would be so painful.</p><p><span>My theory of </span><a href="https://dynomight.net/procrastination/" rel="">procrastination</a><span> is that a guy named Jim lives in your head. Before you try to do something, Jim calculates how hard it will be and what benefits it’s likely to bring. If he doesn’t like the ratio, he adds a “tax” that makes it very hard to do the thing. Jim is stubborn and not very bright.</span></p><p>But Jim Theory, if correct, explains more than just procrastination. A childhood friend of mine always wanted to be a programmer. He did it for fun as a teenager and was good at it, but in college he had to major in something else for financial reasons. Afterwards, he felt stuck in a career he didn’t like very much.</p><p><span>I was sure he could still transition into programming. I begged him to try taking a night class, or get a low-level tech support job, or get some kind of online certification, or start an open-source project. I promised him that he could surely find </span><em>someone</em><span> who would pay him a below-market salary to do </span><em>something</em><span> programming-related. As I said these things, he would nod his head, but in his heart I think he never </span><em>felt</em><span> it could work. So he never did anything. It’s incredibly hard to do things when Jim isn’t on board.</span></p><p>Some time ago, my dog died. One very caring and empathetic friend sensed that I was devastated and promised me that I’d feel better if I binged on reality TV. But I would not have felt better if I binged on reality TV.</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdb4cba5a-361a-4e07-b4d6-9069b7a2b690_1024x822.jpeg" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdb4cba5a-361a-4e07-b4d6-9069b7a2b690_1024x822.jpeg 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdb4cba5a-361a-4e07-b4d6-9069b7a2b690_1024x822.jpeg 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdb4cba5a-361a-4e07-b4d6-9069b7a2b690_1024x822.jpeg 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdb4cba5a-361a-4e07-b4d6-9069b7a2b690_1024x822.jpeg 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdb4cba5a-361a-4e07-b4d6-9069b7a2b690_1024x822.jpeg" width="1024" height="822" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/db4cba5a-361a-4e07-b4d6-9069b7a2b690_1024x822.jpeg&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:822,&quot;width&quot;:1024,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:null,&quot;alt&quot;:&quot;&quot;,&quot;title&quot;:null,&quot;type&quot;:null,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" title="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdb4cba5a-361a-4e07-b4d6-9069b7a2b690_1024x822.jpeg 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdb4cba5a-361a-4e07-b4d6-9069b7a2b690_1024x822.jpeg 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdb4cba5a-361a-4e07-b4d6-9069b7a2b690_1024x822.jpeg 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdb4cba5a-361a-4e07-b4d6-9069b7a2b690_1024x822.jpeg 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>(My “reality TV” is goat videos.)</p><p><span>I often wonder—how different are people? The trouble is that we’re all trapped inside of ourselves. I can’t truly know what it’s like to be you without </span><em><a href="https://en.wikipedia.org/wiki/What_Is_It_Like_to_Be_a_Bat%3F" rel="">being you</a></em><span>. But my guess is that people vary a </span><em>lot</em><span> and often along unsuspected dimensions. So it’s hard to predict what advice will transfer.</span></p><p><span>Of all the advice I’ve given out on this blog, I think people would benefit the most from following my advice on </span><a href="https://dynomight.net/2021/01/25/how-to-run-without-all-the-agonizing-pain/" rel="">how to start running</a><span>. A bunch of people have told me they tried this advice and went running at least a few times. But I’m not aware of a single case of this leading to a new long-term running habit.</span></p><p><span>Meanwhile, </span><em>many</em><span> people have told me I convinced them to start using </span><a href="https://dynomight.net/noise/" rel="">noise cancelling headphones</a><span> and even more have told me I convinced them to get an </span><a href="https://dynomight.net/air/" rel="">air purifier</a><span>.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe65f3067-a74f-4f5e-aefe-9834092cefce_1341x1085.jpeg" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe65f3067-a74f-4f5e-aefe-9834092cefce_1341x1085.jpeg 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe65f3067-a74f-4f5e-aefe-9834092cefce_1341x1085.jpeg 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe65f3067-a74f-4f5e-aefe-9834092cefce_1341x1085.jpeg 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe65f3067-a74f-4f5e-aefe-9834092cefce_1341x1085.jpeg 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe65f3067-a74f-4f5e-aefe-9834092cefce_1341x1085.jpeg" width="1341" height="1085" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/e65f3067-a74f-4f5e-aefe-9834092cefce_1341x1085.jpeg&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1085,&quot;width&quot;:1341,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:null,&quot;alt&quot;:&quot;&quot;,&quot;title&quot;:null,&quot;type&quot;:null,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" title="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe65f3067-a74f-4f5e-aefe-9834092cefce_1341x1085.jpeg 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe65f3067-a74f-4f5e-aefe-9834092cefce_1341x1085.jpeg 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe65f3067-a74f-4f5e-aefe-9834092cefce_1341x1085.jpeg 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe65f3067-a74f-4f5e-aefe-9834092cefce_1341x1085.jpeg 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>Why? Probably because running is hard. I maintain that if you run the right way, it isn’t nearly </span><em>as hard</em><span> as it first seems. But it’s still hard. Buying headphones or installing an air purifier is incredibly easy.</span></p><p>Maybe we ask for advice because we want reassurance that our pre-determined choices are right. If you ask enough people, eventually someone will give you validation.</p><p>Or maybe we ask for advice to have something fun to talk about. Asking someone for advice is a genuinely great way to start a conversation—though it might work best with hypotheticals.</p><p>Or maybe advice is a “guardrail”. Even if we know what we want to do, we want to make sure other people don’t have irrefutable proof it will lead to catastrophe. That could still be worth it even if we only change our minds 1% of the time.</p><p>Or, if you’re an economist, try this: Advice is cheap. So maybe we keep asking for advice in more and more situations where it’s increasingly unlikely to be helpful, until expected benefit matches the (tiny) cost.</p><p>Sometimes we have too much information. We’re too close to the situation, too overloaded to see the big picture.</p><p><span>You could probably name some “obvious” things that would make my writing better. (Really, you could probably do this!) But I might struggle to implement your advice because it’s hard to see your own writing objectively—to separate what you </span><em>mean</em><span> to say from what you’ve actually said. (Tell me anyway.)</span></p><p>A few years ago, I lived overseas. I liked living there and wanted to stay, but changes were coming that would make my then-amazing job into a nightmare. I spent months asking everyone what I should do. But in retrospect, I’m not sure what I was hoping to hear. There was no solution. I could stay with a worse job, or I could leave. Somehow I couldn’t see that.</p><p>Here’s some advice, from me:</p><ul><li><p>Avoid drinking pond water.</p></li><li><p>If you want to get better at math, try doing practice problems.</p></li><li><p>If people have a good “user experience” when they interact with you, then they will want to interact with you more in the future.</p></li></ul><p>Maybe when advice works, we reclassify it as something other than “advice”.</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F649e79ae-8752-4d5b-8884-40126cac76cf_520x572.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F649e79ae-8752-4d5b-8884-40126cac76cf_520x572.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F649e79ae-8752-4d5b-8884-40126cac76cf_520x572.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F649e79ae-8752-4d5b-8884-40126cac76cf_520x572.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F649e79ae-8752-4d5b-8884-40126cac76cf_520x572.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F649e79ae-8752-4d5b-8884-40126cac76cf_520x572.png" width="520" height="572" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/649e79ae-8752-4d5b-8884-40126cac76cf_520x572.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:572,&quot;width&quot;:520,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:54486,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F649e79ae-8752-4d5b-8884-40126cac76cf_520x572.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F649e79ae-8752-4d5b-8884-40126cac76cf_520x572.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F649e79ae-8752-4d5b-8884-40126cac76cf_520x572.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F649e79ae-8752-4d5b-8884-40126cac76cf_520x572.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>I struggle to answer my email. I accumulate ever-larger numbers of emails marked </span><em>REPLY ASAP</em><span> feeling ever-more guilty until after some months I “declare bankruptcy”, mark everything as resolved, and begin the cycle anew. If you’ve emailed me and I haven’t written back, I genuinely feel terrible about it.</span></p><p>Unless you have the same problem, you probably have questions like:</p><ul><li><p>Why don’t you just answer everything as it comes in?</p></li><li><p>Why don’t you just set aside some time every day to answer emails?</p></li></ul><p><span>Why don’t I do these very obvious things which would clearly 100% solve my problem? That’s hard to explain. But if I </span><em>could</em><span> do them, then I wouldn’t bloody have this problem in the first place, would I?</span></p><p><span>Probably everyone has </span><em>some</em><span> issues and struggles to deal with </span><em>some</em><span> things. Maybe the same issues that make them </span><em>need</em><span> your advice also make them unable to use it.</span></p><p>What lessons does this exercise offer for how to “fix” advice? I think… not a lot?</p><p><span>For </span><strong>consumers</strong><span> of advice, I guess there are two meager lessons:</span></p><ol><li><p>If people you respect are repeatedly giving you advice that doesn’t make sense, consider that you might be missing something.</p></li><li><p>Maybe consider blindly following advice sometimes? If you’ve repeatedly made terrible choices in some domain, maybe try the wisdom of the crowds instead?</p><p>(I’m particularly thinking of people who have a track record of picking terrible romantic partners here, but I’m not sure it’s realistic.)</p></li></ol><p><span>And for </span><strong>producers</strong><span> of advice:</span></p><ol><li><p>Have realistic expectations. Most advice isn’t followed.</p></li><li><p>If you really want to have impact, focus on giving advice that is easy to follow.</p><p><span>If you </span><em>really</em><span> want to have an impact, I think there’s a specific category of advice, one that people are particularly interested in and particularly likely to follow: Advice about ways to spend money.</span></p><p>What’s so attractive about this type of advice? I think it’s that the space of “things one could buy” seems so much vaster than the space of “things one could do”. It seems like there’s a higher chance there’s some hidden secret that could move the needle.</p></li></ol><p>So I guess that’s my advice on advice? Embrace consumerism? Not what I expected.</p></div></article></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Meta Launches AI Studio in US (175 pts)]]></title>
            <link>https://ai.meta.com/ai-studio/</link>
            <guid>41109822</guid>
            <pubDate>Tue, 30 Jul 2024 15:00:34 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://ai.meta.com/ai-studio/">https://ai.meta.com/ai-studio/</a>, See on <a href="https://news.ycombinator.com/item?id=41109822">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><h2>Get inspired and discover AIs </h2><div><div><p>Whether you’re a creator who wants to save time by using AI to help engage with your audience, or a travel influencer who creates a guide on local experiences, AI Studio can help you engage in new ways. </p></div><a href="https://aistudio.instagram.com/?utm_source=ai_meta_site&amp;utm_medium=web&amp;utm_content=AI_studio_page&amp;utm_campaign=July_moment" data-ms-clickable="true" data-ms="{&quot;creative&quot;:&quot;click_external-link&quot;,&quot;creative_detail&quot;:&quot;ai_studio_get_inspired_and_discover_AIs_ai_explore_AI_studio_cta&quot;}" target="_blank" rel="noreferrer noopener" data-lnfb-mode="ie" id="u_0_8_9f"><svg viewBox="0 0 38 38" fill="none" xmlns="http://www.w3.org/2000/svg"><path opacity="0.4" fill-rule="evenodd" clip-rule="evenodd" d="M19 37C9.05887 37 1 28.9411 1 19C1 9.05887 9.05887 1 19 1C28.9411 1 37 9.05887 37 19C37 28.9411 28.9411 37 19 37Z" stroke="CurrentColor"></path><path d="M21.9657 12L28.9287 18.963L21.9657 25.926L20.7348 24.7193L25.6203 19.8334L10.0001 19.8334V18.0926L25.5966 18.0926L20.7348 13.2309L21.9657 12Z" fill="CurrentColor"></path><path d="M21.9657 12L28.9287 18.963L21.9657 25.926L20.7348 24.7193L25.6203 19.8334L10.0001 19.8334V18.0926L25.5966 18.0926L20.7348 13.2309L21.9657 12Z" fill="CurrentColor"></path></svg>Explore AI Studio</a></div><div><div><div><p><img src="https://static.xx.fbcdn.net/rsrc.php/v3/y4/r/-PAXP-deijE.gif" alt="violetbenson Creator AI image"></p></div><h3>Creator AI</h3><div><p>Entertaining comedian, dating expert and podcast host.</p><a href="https://www.instagram.com/violetbenson/profilecard/?igsh=NTVmMGE0ZDQxNA%3D%3D" data-ms-clickable="true" data-ms="{&quot;creative&quot;:&quot;click_external-link&quot;,&quot;creative_detail&quot;:&quot;ai_studio_get_inspired_and_discover_AIs_ai_chat_with_violetbenson_cta&quot;}" target="_blank" rel="noreferrer noopener" data-lnfb-mode="ie" id="u_0_9_dK"><svg viewBox="0 0 38 38" fill="none" xmlns="http://www.w3.org/2000/svg"><path opacity="0.4" fill-rule="evenodd" clip-rule="evenodd" d="M19 37C9.05887 37 1 28.9411 1 19C1 9.05887 9.05887 1 19 1C28.9411 1 37 9.05887 37 19C37 28.9411 28.9411 37 19 37Z" stroke="CurrentColor"></path><path d="M21.9657 12L28.9287 18.963L21.9657 25.926L20.7348 24.7193L25.6203 19.8334L10.0001 19.8334V18.0926L25.5966 18.0926L20.7348 13.2309L21.9657 12Z" fill="CurrentColor"></path><path d="M21.9657 12L28.9287 18.963L21.9657 25.926L20.7348 24.7193L25.6203 19.8334L10.0001 19.8334V18.0926L25.5966 18.0926L20.7348 13.2309L21.9657 12Z" fill="CurrentColor"></path></svg>Chat with violetbenson</a></div></div><div><div><p><img src="https://static.xx.fbcdn.net/rsrc.php/v3/y4/r/-PAXP-deijE.gif" alt="Eat like you live there AI character image"></p></div><h3>AI character</h3><div><p>Get etiquette tips and advice on embracing local dining customs.</p><a href="https://aistudio.instagram.com/ai/974785541030953/?utm_source=mshare" data-ms-clickable="true" data-ms="{&quot;creative&quot;:&quot;click_external-link&quot;,&quot;creative_detail&quot;:&quot;ai_studio_get_inspired_and_discover_AIs_ai_chat_with_eat_like_you_live_there_cta&quot;}" target="_blank" rel="noreferrer noopener" data-lnfb-mode="ie" id="u_0_a_UA"><svg viewBox="0 0 38 38" fill="none" xmlns="http://www.w3.org/2000/svg"><path opacity="0.4" fill-rule="evenodd" clip-rule="evenodd" d="M19 37C9.05887 37 1 28.9411 1 19C1 9.05887 9.05887 1 19 1C28.9411 1 37 9.05887 37 19C37 28.9411 28.9411 37 19 37Z" stroke="CurrentColor"></path><path d="M21.9657 12L28.9287 18.963L21.9657 25.926L20.7348 24.7193L25.6203 19.8334L10.0001 19.8334V18.0926L25.5966 18.0926L20.7348 13.2309L21.9657 12Z" fill="CurrentColor"></path><path d="M21.9657 12L28.9287 18.963L21.9657 25.926L20.7348 24.7193L25.6203 19.8334L10.0001 19.8334V18.0926L25.5966 18.0926L20.7348 13.2309L21.9657 12Z" fill="CurrentColor"></path></svg>Chat with Eat like you live there!</a></div></div></div></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[A Eulogy for Dark Sky, a Data Visualization Masterpiece (2023) (317 pts)]]></title>
            <link>https://nightingaledvs.com/dark-sky-weather-data-viz/</link>
            <guid>41109799</guid>
            <pubDate>Tue, 30 Jul 2024 14:58:54 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://nightingaledvs.com/dark-sky-weather-data-viz/">https://nightingaledvs.com/dark-sky-weather-data-viz/</a>, See on <a href="https://news.ycombinator.com/item?id=41109799">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>

<p>On January 1, 2023, Apple sunsetted (pun intended) the Dark Sky mobile app on iOS. Apple purchased the company behind the popular weather application in early 2020, then announced that it would be shutting down the Dark Sky applications (first on Android, then on iOS and web), and finally stated in 2022 that the forecast technology would be integrated into the Apple Weather app with iOS 16.</p>


<div>
<figure><img fetchpriority="high" decoding="async" width="720" height="669" src="https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky1.png?resize=720%2C669&amp;ssl=1" alt="A comparison of Dark Sky with Apple Weather. The Dark Sky app is white. It's interface has a simple location marker with a list of forecasted temperature readings. Buttons at the bottom allow users to toggle between maps, forecasts, notifications and reports. The Apple Weather app has an image of the sky. It has current weather, hourly weather temperatures, and a 10-day forecast. " data-recalc-dims="1"><figcaption>Comparison of Dark Sky with Apple Weather. </figcaption></figure></div>


<p>But Dark Sky was<em> much </em>more than just an API or a set of “forecast technologies.” The design of the Dark Sky mobile application represented a hallmark of information design because the team clearly obsessed over how people would actually use the app on a daily basis.</p>



<p>Here’s a gallery of screenshots I personally took in the last year.</p>







<p>The design of Dark Sky was so wonderful that I could understand the <em>shape</em> of the weather at a glance, even from a zoomed out view of the app.</p>



<h2>Common use cases for a weather app</h2>



<p>Before we can dissect what makes the design of this app so special, let’s define the most common use cases for a weather app. A good weather app attempts to address a range of use cases in a person’s life. Here are some common use cases for a weather app, starting with the contextual goals first:</p>







<p>You’ll notice that the questions I want to answer vary based on the context and situation I’m in. This is the perfect situation for software that embraces good information design principles.</p>



<p>In <a href="http://worrydream.com/MagicInk/" target="_blank" rel="noreferrer noopener">Magic Ink</a>, Bret Victor defined information design “as the design of context-sensitive information graphics.” Unlike static graphics, like a weather map in a newspaper, information graphics in software can be highly dynamic and can incorporate <a href="http://worrydream.com/MagicInk/#inferring_context_from_the_environment" target="_blank" rel="noreferrer noopener">context from the user’s environment.</a>&nbsp;</p>



<p>Dark Sky aggressively leaned into these ideas, and the team worked hard to turn nearly everything in the application into a context-sensitive information graphic. Let’s dive deeper into some examples where this notion is in full display.</p>



<h2><strong>Weather forecast for the day at a precise location</strong></h2>



<p>I’ll start by listing my goals when trying to understand the upcoming weather for the day:</p>











<p>The default experience for the Dark Sky application is to show weather for the next 12 hours at my precise location. Here are three screenshots from the app, from different days and locations. <strong>What do you notice?</strong></p>


<div>
<figure><img loading="lazy" decoding="async" width="720" height="503" src="https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky3.png?resize=720%2C503&amp;ssl=1" alt="Screenshots of the app showing 1) a storm system passing over the Northeast U.S., with a temperature chart by the hour and a note of precipitation at some of those hours, 2) the same same map, but with a change-of-precipitation chart, and 3) an extended hourly temperature chart with buttons allowing the user to choose to focus on temperature, feels-like temperature and precipitation." srcset="https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky3.png?resize=1024%2C716&amp;ssl=1 1024w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky3.png?resize=300%2C210&amp;ssl=1 300w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky3.png?resize=768%2C537&amp;ssl=1 768w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky3.png?resize=1536%2C1074&amp;ssl=1 1536w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky3.png?resize=500%2C350&amp;ssl=1 500w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky3.png?resize=800%2C559&amp;ssl=1 800w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky3.png?resize=1280%2C895&amp;ssl=1 1280w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky3.png?resize=1920%2C1343&amp;ssl=1 1920w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky3.png?resize=450%2C315&amp;ssl=1 450w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky3.png?resize=1144%2C800&amp;ssl=1 1144w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky3.png?resize=1360%2C951&amp;ssl=1 1360w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky3.png?resize=250%2C175&amp;ssl=1 250w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky3.png?resize=550%2C385&amp;ssl=1 550w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky3.png?resize=257%2C180&amp;ssl=1 257w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky3.png?resize=429%2C300&amp;ssl=1 429w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky3.png?resize=715%2C500&amp;ssl=1 715w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky3.png?w=1999&amp;ssl=1 1999w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky3.png?w=1440&amp;ssl=1 1440w" sizes="(max-width: 720px) 100vw, 720px" data-recalc-dims="1"></figure></div>






<p>The app contextualizes the information that’s presented based on what’s most relevant.</p>



<p>In the left-most screenshot, the context of the weather storm that’s passing by my location and some potential light rain is emphasized to the user. The wind advisory and dip in the “feels like” temperature also make honorable mentions. In combination with the clickable <strong>Wind Advisory</strong> warning, I can quickly understand that the storm has passed my specific location but I should still be mindful of the wind.</p>


<div>
<figure><img loading="lazy" decoding="async" width="720" height="679" src="https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky4.png?resize=720%2C679&amp;ssl=1" alt="Screenshot of the app showing a storm system passing over the Northeast U.S., with a temperature chart by the hour and a note of precipitation at some of those hours, plus a wind advisory. " srcset="https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky4.png?resize=1024%2C965&amp;ssl=1 1024w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky4.png?resize=300%2C283&amp;ssl=1 300w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky4.png?resize=768%2C724&amp;ssl=1 768w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky4.png?resize=1536%2C1448&amp;ssl=1 1536w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky4.png?resize=500%2C471&amp;ssl=1 500w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky4.png?resize=800%2C754&amp;ssl=1 800w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky4.png?resize=1280%2C1206&amp;ssl=1 1280w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky4.png?resize=1920%2C1810&amp;ssl=1 1920w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky4.png?resize=450%2C424&amp;ssl=1 450w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky4.png?resize=849%2C800&amp;ssl=1 849w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky4.png?resize=1360%2C1282&amp;ssl=1 1360w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky4.png?resize=250%2C236&amp;ssl=1 250w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky4.png?resize=550%2C518&amp;ssl=1 550w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky4.png?resize=191%2C180&amp;ssl=1 191w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky4.png?resize=318%2C300&amp;ssl=1 318w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky4.png?resize=531%2C500&amp;ssl=1 531w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky4.png?w=1999&amp;ssl=1 1999w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky4.png?w=1440&amp;ssl=1 1440w" sizes="(max-width: 720px) 100vw, 720px" data-recalc-dims="1"></figure></div>






<p>In the middle screenshot, the storm front heading my direction, the imminent rain starting within the hour, and the hours of rain later in the day are emphasized front and center. Based on my interest in the rain, I scrolled down (not shown in screenshot) to switch from temperature to rain probability for the main weather view.</p>


<div>
<figure><img loading="lazy" decoding="async" width="720" height="681" src="https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky5.png?resize=720%2C681&amp;ssl=1" alt="Screenshot of the app showing the storm map, but with a change-of-precipitation chart over the coming hours." srcset="https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky5.png?resize=1024%2C968&amp;ssl=1 1024w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky5.png?resize=300%2C283&amp;ssl=1 300w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky5.png?resize=768%2C726&amp;ssl=1 768w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky5.png?resize=1536%2C1451&amp;ssl=1 1536w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky5.png?resize=500%2C472&amp;ssl=1 500w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky5.png?resize=800%2C756&amp;ssl=1 800w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky5.png?resize=1280%2C1210&amp;ssl=1 1280w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky5.png?resize=1920%2C1814&amp;ssl=1 1920w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky5.png?resize=450%2C425&amp;ssl=1 450w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky5.png?resize=847%2C800&amp;ssl=1 847w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky5.png?resize=1360%2C1285&amp;ssl=1 1360w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky5.png?resize=250%2C236&amp;ssl=1 250w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky5.png?resize=550%2C520&amp;ssl=1 550w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky5.png?resize=190%2C180&amp;ssl=1 190w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky5.png?resize=317%2C300&amp;ssl=1 317w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky5.png?resize=529%2C500&amp;ssl=1 529w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky5.png?w=1999&amp;ssl=1 1999w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky5.png?w=1440&amp;ssl=1 1440w" sizes="(max-width: 720px) 100vw, 720px" data-recalc-dims="1"></figure></div>






<p>In the right-most screenshot, the temperature distribution throughout the day is emphasized.</p>


<div>
<figure><img loading="lazy" decoding="async" width="720" height="729" src="https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky6.png?resize=720%2C729&amp;ssl=1" alt="Screenshot of the app showing an extended hourly temperature chart with buttons allowing the user to choose to focus on temperature, feels-like temperature and precipitation." srcset="https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky6.png?resize=1011%2C1024&amp;ssl=1 1011w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky6.png?resize=296%2C300&amp;ssl=1 296w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky6.png?resize=768%2C778&amp;ssl=1 768w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky6.png?resize=1516%2C1536&amp;ssl=1 1516w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky6.png?resize=500%2C507&amp;ssl=1 500w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky6.png?resize=800%2C811&amp;ssl=1 800w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky6.png?resize=1280%2C1297&amp;ssl=1 1280w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky6.png?resize=1920%2C1946&amp;ssl=1 1920w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky6.png?resize=70%2C70&amp;ssl=1 70w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky6.png?resize=450%2C456&amp;ssl=1 450w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky6.png?resize=789%2C800&amp;ssl=1 789w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky6.png?resize=1360%2C1378&amp;ssl=1 1360w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky6.png?resize=48%2C48&amp;ssl=1 48w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky6.png?resize=250%2C253&amp;ssl=1 250w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky6.png?resize=550%2C557&amp;ssl=1 550w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky6.png?resize=178%2C180&amp;ssl=1 178w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky6.png?resize=493%2C500&amp;ssl=1 493w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky6.png?w=1954&amp;ssl=1 1954w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky6.png?w=1440&amp;ssl=1 1440w" sizes="(max-width: 720px) 100vw, 720px" data-recalc-dims="1"></figure></div>






<p>There are lots of little details that are easy to miss, as well. For example, all three screenshots above start showing weather information starting at the current moment (“now”) and onwards. This is brilliant, because I only occasionally care about weather from a few hours or days ago. (To accommodate those situations, the app did have a unique Time Machine view to explore past weather data.)</p>



<h2>Weather forecast for the week</h2>



<p>Let’s revisit our goals when trying to understand the weather for the week:</p>











<p>While many other weather apps focus on helping me understand the weather at the city level, the Dark Sky app differentiates itself by enabling me to understand the weather with a <em>hyperlocal</em> view. I can view the weather at specific addresses and landmarks and understand how the weather might be different in a city center compared to the towns around it.</p>



<p>By default, the Dark Sky app shows the weekly weather summary at my current location (screenshot on the left).&nbsp; I can <em>contextualize</em> the weekly weather view by clicking the search icon and typing in the alternative location I’m interested in (screenshot on the right).</p>


<div>
<figure><img loading="lazy" decoding="async" width="720" height="659" src="https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky7.png?resize=720%2C659&amp;ssl=1" alt="Two screenshots of the DarkSky app for different locations, showing the coming days' high and low temperatures, rain chance, and the extent of rain, sun, wind, and cloudcover." srcset="https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky7.png?resize=1024%2C937&amp;ssl=1 1024w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky7.png?resize=300%2C275&amp;ssl=1 300w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky7.png?resize=768%2C703&amp;ssl=1 768w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky7.png?resize=1536%2C1406&amp;ssl=1 1536w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky7.png?resize=500%2C458&amp;ssl=1 500w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky7.png?resize=800%2C732&amp;ssl=1 800w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky7.png?resize=1280%2C1172&amp;ssl=1 1280w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky7.png?resize=1920%2C1758&amp;ssl=1 1920w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky7.png?resize=450%2C412&amp;ssl=1 450w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky7.png?resize=874%2C800&amp;ssl=1 874w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky7.png?resize=1360%2C1245&amp;ssl=1 1360w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky7.png?resize=250%2C229&amp;ssl=1 250w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky7.png?resize=550%2C504&amp;ssl=1 550w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky7.png?resize=197%2C180&amp;ssl=1 197w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky7.png?resize=328%2C300&amp;ssl=1 328w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky7.png?resize=546%2C500&amp;ssl=1 546w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky7.png?w=1999&amp;ssl=1 1999w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky7.png?w=1440&amp;ssl=1 1440w" sizes="(max-width: 720px) 100vw, 720px" data-recalc-dims="1"></figure></div>






<p>At a glance, I can quickly understand:</p>



<ul>
<li>Which days are likely to rain.</li>



<li>Which days have wide temperature ranges (low lows and high highs).</li>



<li>The general shape of the weather (micro-trends).</li>
</ul>



<figure><img loading="lazy" decoding="async" width="720" height="399" src="https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky8.png?resize=720%2C399&amp;ssl=1" alt="The same screenshot as before, showing daily temperatures, precipitation and other elements with author annotations calling out 
the highs and lows for the week. The chart presenting this information shows the &quot;shape&quot; of the weather as the temperature lines move up and down." srcset="https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky8.png?resize=1024%2C567&amp;ssl=1 1024w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky8.png?resize=300%2C166&amp;ssl=1 300w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky8.png?resize=768%2C425&amp;ssl=1 768w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky8.png?resize=1536%2C851&amp;ssl=1 1536w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky8.png?resize=500%2C277&amp;ssl=1 500w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky8.png?resize=800%2C443&amp;ssl=1 800w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky8.png?resize=1280%2C709&amp;ssl=1 1280w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky8.png?resize=450%2C249&amp;ssl=1 450w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky8.png?resize=1445%2C800&amp;ssl=1 1445w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky8.png?resize=1360%2C753&amp;ssl=1 1360w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky8.png?resize=250%2C138&amp;ssl=1 250w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky8.png?resize=550%2C305&amp;ssl=1 550w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky8.png?resize=325%2C180&amp;ssl=1 325w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky8.png?resize=542%2C300&amp;ssl=1 542w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky8.png?resize=903%2C500&amp;ssl=1 903w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky8.png?w=1618&amp;ssl=1 1618w" sizes="(max-width: 720px) 100vw, 720px" data-recalc-dims="1"></figure>







<h2>Gallery of subtle design elements</h2>



<p>In the first few sections, I laid the groundwork by diving a bit more deeply into specific aspects of Dark Sky. Now that I’ve hopefully engaged your critical design eye, I’d like to elevate other elements in the app’s design in a more rapid-fire fashion. I hope that this section will provide some ideas and inspiration for people designing their own data-rich applications.</p>



<p><strong>Preserving temperature magnitudes in ranges</strong></p>



<p>To represent data visually, the data needs to be mapped from “data space” to “pixel space”. In some domains and scenarios, you want to ensure the magnitudes are carried over, and in others you want to <a href="https://en.wikipedia.org/wiki/Feature_scaling#Rescaling_(min-max_normalization)" target="_blank" rel="noreferrer noopener">rescale the values</a> to a fixed scale so the resulting charts are more consistent in the space and pixels they take up.</p>



<p>In the Dark Sky app, the “temperature pills” representing the forecasted temperatures for the upcoming week preserve their existing magnitude more effectively in the visualization. The temperature values are more tightly <em>integrated</em> with the visual representation, making the combined experience more amenable to quick comparison across multiple days.</p>



<p>Many weather apps opt for the design pattern on the right, where all temperature ranges are rescaled to take up the same amount of space in the app.</p>


<div>
<figure><img loading="lazy" decoding="async" width="720" height="501" src="https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky9.png?resize=720%2C501&amp;ssl=1" alt="In the DarkSky weather app, the highs and lows were placed in bars that were relative to each other. In the Apple Weather app, the lows are aligned on the left side and the highs are aligned on the right side so the user has to read each temperature number for each day to know how it compares with other days" srcset="https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky9.png?resize=1024%2C713&amp;ssl=1 1024w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky9.png?resize=300%2C209&amp;ssl=1 300w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky9.png?resize=768%2C534&amp;ssl=1 768w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky9.png?resize=500%2C348&amp;ssl=1 500w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky9.png?resize=800%2C557&amp;ssl=1 800w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky9.png?resize=1280%2C891&amp;ssl=1 1280w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky9.png?resize=450%2C313&amp;ssl=1 450w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky9.png?resize=1150%2C800&amp;ssl=1 1150w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky9.png?resize=250%2C174&amp;ssl=1 250w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky9.png?resize=550%2C383&amp;ssl=1 550w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky9.png?resize=259%2C180&amp;ssl=1 259w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky9.png?resize=431%2C300&amp;ssl=1 431w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky9.png?resize=718%2C500&amp;ssl=1 718w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky9.png?w=1322&amp;ssl=1 1322w" sizes="(max-width: 720px) 100vw, 720px" data-recalc-dims="1"></figure></div>






<p><strong>Replacing numbers with rough categories</strong></p>



<p>Interpreting hourly distributions of rainfall or snowfall can be difficult. Is 0.25 inches of rain a lot over the next hour? What about 0.2 inches of snow per hour for the next hour, then 0.15 for the hour after that? How do I prepare for these circumstances?</p>



<p>To help users stay informed and take action, the app will often replace precise forecast distributions of rainfall and snowfall with <em>rough</em> categories instead. This design choice has two positive effects on users:</p>



<ul>
<li>It contextualizes the forecast to simpler categories that can help us quickly make changes in our life if needed.
<ul>
<li>Light snow that starts and stops means that my snow shoveling company won’t come out, but heavy snow means they likely will.</li>



<li>Heavy snow means I should probably make sure my outdoor furniture is better covered and ready to take the snow.</li>
</ul>
</li>



<li>It removes a sense of artificial precision that doesn’t <em>really</em> exist because weather forecasts fundamentally have very high uncertainty and error bands.</li>
</ul>


<div>
<figure><img loading="lazy" decoding="async" width="720" height="266" src="https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky10.png?resize=720%2C266&amp;ssl=1" alt="Screenshots of snow and rain line charts, where the x-axis is time and the y-axis is a vague gauge of the precipitation. Instead of the precise values, the y-axis has &quot;light,&quot; &quot;medium,&quot; and &quot;heavy&quot; ranges.  " srcset="https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky10.png?resize=1024%2C378&amp;ssl=1 1024w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky10.png?resize=300%2C111&amp;ssl=1 300w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky10.png?resize=768%2C283&amp;ssl=1 768w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky10.png?resize=1536%2C566&amp;ssl=1 1536w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky10.png?resize=500%2C184&amp;ssl=1 500w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky10.png?resize=800%2C295&amp;ssl=1 800w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky10.png?resize=1280%2C472&amp;ssl=1 1280w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky10.png?resize=1920%2C708&amp;ssl=1 1920w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky10.png?resize=450%2C166&amp;ssl=1 450w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky10.png?resize=1360%2C501&amp;ssl=1 1360w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky10.png?resize=250%2C92&amp;ssl=1 250w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky10.png?resize=550%2C203&amp;ssl=1 550w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky10.png?resize=488%2C180&amp;ssl=1 488w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky10.png?resize=814%2C300&amp;ssl=1 814w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky10.png?resize=1356%2C500&amp;ssl=1 1356w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky10.png?w=1999&amp;ssl=1 1999w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky10.png?w=1440&amp;ssl=1 1440w" sizes="(max-width: 720px) 100vw, 720px" data-recalc-dims="1"></figure></div>






<p><strong>Contextualized storm map</strong></p>



<p>Simple color scales combined with arrows go a very long way to conveying relevant storm information.</p>


<div>
<figure><img loading="lazy" decoding="async" width="720" height="158" src="https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky11.png?resize=720%2C158&amp;ssl=1" alt="Screenshots of different storm systems with colors that indicate the intensity of the storm, and directional arrows showing where the storm system is headed." srcset="https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky11.png?resize=1024%2C225&amp;ssl=1 1024w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky11.png?resize=300%2C66&amp;ssl=1 300w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky11.png?resize=768%2C169&amp;ssl=1 768w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky11.png?resize=1536%2C337&amp;ssl=1 1536w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky11.png?resize=500%2C110&amp;ssl=1 500w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky11.png?resize=800%2C176&amp;ssl=1 800w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky11.png?resize=1280%2C281&amp;ssl=1 1280w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky11.png?resize=1920%2C422&amp;ssl=1 1920w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky11.png?resize=450%2C99&amp;ssl=1 450w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky11.png?resize=1360%2C299&amp;ssl=1 1360w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky11.png?resize=250%2C55&amp;ssl=1 250w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky11.png?resize=550%2C121&amp;ssl=1 550w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky11.png?resize=820%2C180&amp;ssl=1 820w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky11.png?resize=1366%2C300&amp;ssl=1 1366w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky11.png?w=1999&amp;ssl=1 1999w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky11.png?w=1440&amp;ssl=1 1440w" sizes="(max-width: 720px) 100vw, 720px" data-recalc-dims="1"></figure></div>






<p><b>W</b><strong>ind direction</strong></p>



<p>Instead of conveying wind direction using text (“NW” or “Northwest”), the app uses arrows! If the wind shifts directions throughout the day, I can <em>feel</em> the wind direction changing using my body.</p>


<div>
<figure><img loading="lazy" decoding="async" width="473" height="1024" src="https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky12.jpg?resize=473%2C1024&amp;ssl=1" alt="Screen shot of DarkSky app showing the wind speeds for each hour in a horizontal bar chart. At the end of each bar is a directional arrow. " srcset="https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky12.jpg?resize=473%2C1024&amp;ssl=1 473w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky12.jpg?resize=138%2C300&amp;ssl=1 138w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky12.jpg?resize=500%2C1083&amp;ssl=1 500w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky12.jpg?resize=450%2C975&amp;ssl=1 450w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky12.jpg?resize=369%2C800&amp;ssl=1 369w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky12.jpg?resize=250%2C542&amp;ssl=1 250w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky12.jpg?resize=550%2C1191&amp;ssl=1 550w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky12.jpg?resize=83%2C180&amp;ssl=1 83w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky12.jpg?resize=231%2C500&amp;ssl=1 231w, https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/darksky12.jpg?w=602&amp;ssl=1 602w" sizes="(max-width: 473px) 100vw, 473px" data-recalc-dims="1"></figure></div>






<h2><strong>Complaints from former Dark Sky users</strong></h2>



<p>As you can tell, I could probably write an <em>entire book</em> about the design of Dark Sky.</p>



<p>Instead, I want to share some passionate comments from other Dark Sky fans. While most of them aren’t data viz or design nerds, they <em>feel</em> that the Apple Weather app is not a sufficient replacement. These people relied on Dark Sky to make decisions and grew very attached to an application that integrated deeply into their lives.</p>



<p>Here are some examples:</p>



<ul>
<li><a href="https://www.reddit.com/r/ios/comments/z11dr9/comment/ix8hqjp/?utm_source=reddit&amp;utm_medium=web2x&amp;context=3" target="_blank" rel="noreferrer noopener">0000GKP on Reddit</a>: “I have already made the transition to the Weather app. <strong>The information is presented in a much less efficient manner than Dark Sky so it takes more effort to get it</strong>, but it is all there (except for cloud cover).”</li>



<li><a href="https://www.reddit.com/r/ios/comments/z11dr9/comment/j0bh6j7/?utm_source=reddit&amp;utm_medium=web2x&amp;context=3" target="_blank" rel="noreferrer noopener">TheGeckoDude on Reddit</a>: “Is there anything that has the precipitation graph similar to dark sky? <strong>The biggest thing I will miss from dark sky is that graph. I’m outside a lot and it is super helpful for knowing when to take cover or when it might rain</strong>. I need to find a feature like that because the vague weather precipitation info will not cut it for me.”</li>
</ul>



<h2>Let’s make data shine!</h2>



<p>Dark Sky started with publicly available data, augmented it with contextualized predictions, rigorously iterated on data visualization design, and packaged all of this into a contextualized experience to make weather data <em>useful</em> for me in my daily life.</p>



<p>While the availability of data has never been higher, we’re still missing software experiences that contextualize that data to make our lives better. Data alone isn’t enough.</p>



<p>The world needs more Dark Sky-like experiences to help us improve our spending habits, help us sleep better, and more. If you’re working on information software, I hope you can be inspired by the body of design and engineering work that Dark Sky pioneered.</p>

<!-- MOLONGUI AUTHORSHIP PLUGIN 4.9.5 -->
<!-- https://www.molongui.com/wordpress-plugin-post-authors -->

<div data-profile-layout="layout-1" data-author-ref="guest-16419" itemscope="" itemid="#molongui-disabled-link" itemtype="https://schema.org/Person" id="mab-6219593189" data-box-layout="stacked" data-box-position="below" data-multiauthor="false" data-author-id="16419" data-author-type="guest" data-author-archived=""><p><span><img loading="lazy" decoding="async" width="129" height="150" src="https://i0.wp.com/nightingaledvs.com/wp-content/uploads/2023/03/srini1.png?fit=129%2C150&amp;ssl=1" alt="Headshot of author Srini Kadamati" itemprop="image"></span></p><div><p><h5><span>Srini Kadamati</span></h5></p><div><p>Srini Kadamati currently helps build&nbsp;better data management tools for biomedical research at Manifold.ai. Previously, he taught data visualization and data skills at Dataquest.io and Preset.io.</p></div></div></div>
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Was the Internet created to survive a nuclear strike? (167 pts)]]></title>
            <link>https://siliconfolklore.com/internet-history/</link>
            <guid>41108884</guid>
            <pubDate>Tue, 30 Jul 2024 13:20:14 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://siliconfolklore.com/internet-history/">https://siliconfolklore.com/internet-history/</a>, See on <a href="https://news.ycombinator.com/item?id=41108884">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
<section>

<h2>Was The Internet designed to survive a nuclear attack?
<small>The History of the Narrative History of the Internet</small>
</h2>
<h2>Was The Internet Designed to Survive a Nuclear Attack?
</h2>
<p><img alt="Nine images depicting the layout of the ARPANET between 1969 and 1978 as a stylized header for the article." title="Nine images depicting the layout of the ARPANET between 1969 and 1978 as a stylized header for the article." src="https://siliconfolklore.com/internet-history/Report4799AHistoryOfArpanetTheFirstDecade_0023.png">
<img src="https://siliconfolklore.com/internet-history/Report4799AHistoryOfArpanetTheFirstDecade_0024.png">
<img src="https://siliconfolklore.com/internet-history/Report4799AHistoryOfArpanetTheFirstDecade_0025.png">
<img src="https://siliconfolklore.com/internet-history/Report4799AHistoryOfArpanetTheFirstDecade_0026.png">
<img src="https://siliconfolklore.com/internet-history/Report4799AHistoryOfArpanetTheFirstDecade_0027.png">
<img src="https://siliconfolklore.com/internet-history/Report4799AHistoryOfArpanetTheFirstDecade_0028.png">
<img src="https://siliconfolklore.com/internet-history/Report4799AHistoryOfArpanetTheFirstDecade_0030.png">
<img src="https://siliconfolklore.com/internet-history/Report4799AHistoryOfArpanetTheFirstDecade_0031.png">
<img src="https://siliconfolklore.com/internet-history/Report4799AHistoryOfArpanetTheFirstDecade_0032.png">
</p>
<center><h4><em>(Note: The print version has videos and some artwork removed. Hyperlinks are numbered like so <tt>[L##]</tt> with a corresponding list at the end)</em></h4></center>
<p>You've probably heard the story of how the Internet was designed to withstand a nuclear attack. It usually goes "DARPA was doing cold war planning and was eager for a distributed resilient command-and-contro"… actually let's hear Professor Rob Larson, author of <cite><a href="https://www.haymarketbooks.org/books/1381-bit-tyrants">Bit Tyrants: The Political Economy of Silicon Valley</a></cite>, <a href="https://kpfa.org/episode/against-the-grain-october-18-2022/">give it on Oct 18, 2022</a>:
</p><figure>
<audio controls="" src="https://siliconfolklore.com/internet-history/rob-larson.mp3"></audio>
<figcaption>Is any of this true?</figcaption>
</figure>
<p>Apparently, the Internet is from "back in the 1980s", was called DARPAnet and was built to defend against a nuclear attack.</p>

<p>Is that true? Let's find out.</p>

<p>This is the story of the various histories of the Internet, where they came from and which ones are real.</p>

<p>The early Internet didn't look like the mountainside NORAD bunkers you see in movies. Instead it was computers sitting in normal offices in university buildings without any backup power, fortification, security (network or physical) and no connections to military communication. Designed for World War 3? The children in <cite><a href="https://www.youtube.com/watch?v=LWH4tWkZpPU">"Duck and Cover"</a></cite> from 1951 had a better chance of surviving.</p>
<p>The "Computing on Doomsday" story is disputed by people who did the actual designing of the Internet and an older network, ARPANET.<sup><a href="#jcr">1</a></sup></p>
<p>In texts giving Internet history a serious treatment, such as the 1996 <cite><a href="https://archive.org/details/wherewizardsstay00haf_vgj/">“Where Wizards Stay Up Late - The Origin of the Internet”</a></cite> you can <a href="https://archive.org/details/wherewizardsstay00haf_vgj/page/n4/mode/2up?q=nuclear">search the word “nuclear”</a> and come up with passages like:</p>
<blockquote>
<p><a href="https://en.wikipedia.org/wiki/Robert_Taylor_(computer_scientist)">Bob Taylor</a>… was also on a personal mission to correct an inaccuracy of long standing. Rumors had persisted for years that the ARPANET had been built to protect national security in the face of a nuclear attack. It was a myth that had gone unchallenged long enough to become widely accepted as fact.</p>
</blockquote>
<p>and:</p>
<blockquote>
<p>Lately, the mainstream press had picked up the grim myth of a nuclear survival scenario and had presented it as an established truth. When <a href="http://content.time.com/time/magazine/0,9263,7601940725,00.html">TIME magazine committed the error</a>, Taylor wrote a letter to the editor, but the magazine didn’t print it. The effort to set the record straight was like chasing the wind</p>
</blockquote>
<p>Here’s <a href="https://en.wikipedia.org/wiki/Vint_Cerf">Vint Cerf</a>, one of the key architects of the Internet, in <a href="https://youtu.be/lWyv4wU-WNA?t=4441">July 2022 still trying to correct things</a>. Apparently, the "Networking for the Post-Apocalypse" story has gotten out of hand and people who were there have been trying to politely fix things in vain for decades.</p>
<p>It's understandable how it could spread. Military communications during Nuclear War makes a more memorable story than designing a way to remote access what would become the first massively parallel computer, the <a href="https://en.wikipedia.org/wiki/ILLIAC_IV">ILLIAC IV</a>. The funding and motivation for building ARPANET was partially to get this computer, once built, to be "online" in order to justify the cost of building it. This way more scientists could use the expensive machine.<sup><a href="#cerf">2</a></sup></p>
<p>See you glazed over that. I know it. Isn’t <a href="https://jacobin.com/2022/06/internet-privatization-profit-centralization-democracy"><q>bringing the mainframe to the battlefield</q></a> more sexy? That’s from June 2022.</p>
<p>To find out where this story comes from we're going back to when hard drives were measured in megabytes and colorful floppies arrived in your mail promising you 100 free hours online.</p>
</section>
<section>
<h2>The origin of the origin myth</h2>
<p>That's not a typo. We're trying to find out when the folklore began; the history of this "History of the Internet".</p>
<p>Prior to 1991 there is no history narrative which has the nuclear origin story so let's look at what came before.<sup><a href="#prior">3</a></sup></p>
<p>Back then, the stories more closely resembled the one Cerf and Taylor of the ARPANET project advocate for. In April 1988 for instance, <a href="https://twitter.com/slfisher">Sharon Fisher</a><sup><a href="#sharon">4</a></sup> in <cite><a href="https://books.google.com/books?id=pj0EAAAAMBAJ&amp;pg=PA57&amp;hl=en&amp;sa=X#v=onepage&amp;q&amp;f=false">Infoworld</a></cite> says:</p>
<blockquote>
<p>The network was originally set up for universities and research organizations to exchange information efficiently.</p>
</blockquote>

<p><a href="https://en.wikipedia.org/wiki/DARPA">DARPA</a>, the organization that funded the development of ARPANET in the 1960s (The "D" was added to ARPA in 1972) has a similar story in <cite><a href="https://www.researchgate.net/publication/235051902_DARPA_Technical_Accomplishments_An_Historical_Review_of_Selected_DARPA_Projects_Volume_1">“DARPA Technical Accomplishments”</a></cite>, from 1990. ARPANET is in the “Information Processing” section claiming it's part of a larger “batch-processing” to “time-sharing” revolution (<a href="#time-sharing">more about this later</a>). From section 20-1:</p>
<blockquote>
<p>After time sharing had been demonstrated and its impact began to be widespread in the mid 1960’s, the next logical step in this program was the linking of computers and terminals by communications networks, so that computer capabilities, programs and file resources could be accessed readily and shared remotely. The mainstream of ARPANET development involved individuals and institutions in the computer research communities which were supported by the growing ARPA <a href="https://en.wikipedia.org/wiki/Information_Processing_Techniques_Office">IPTO</a> program.</p>
</blockquote>
<p>So what happened? We're going to set our Wayback machine to 1991 to find out. But first, homework!</p>
</section>
<section>
<h4>Common Knowledge or "Come on! Knowledge!"</h4>
<p>Before we continue we need a headache-inducing distinction between <a href="https://en.wikipedia.org/wiki/Common_knowledge">"common knowledge or wisdom"</a> and <a href="https://en.wikipedia.org/wiki/General_knowledge">"general knowledge"</a>. Common knowledge is specific to a community and general knowledge is not. For instance, cultural customs are common knowledge.</p>
<p>This difference is important. If you meet a foreigner, you'll likely tell them about regional laws or customs. You don't need to cite anything or know the history to be correct. It's not general knowledge because you also presume the foreigner doesn't know it.</p>
<p>In our context, <b><em>common knowledge is a statement which can be falsified and verified wherein the one who states feels an obligation to share the information but doesn't feel an obligation to falsify or verify the statement or provide a mechanism for others to do so</em></b>. In more coarse language, these are facts that go uncited.</p>
<p>You may notice there is a requisite of commonality for common knowledge. When trying to figure out narrative histories, whether someone cites a passage or not is a forensic tool of how common they considered the knowledge. Generally speaking, presuming good intent, the more careful a narration is, the more likely we are to an early version of it. This is of course a statistical and not anecdotal statement.</p>
<p>Alright, good homework. You get an A+. Let's continue.</p>
</section>
<section>
<h3>1991: Network World Vol.8-33 P65§12. It Begins.</h3>
<p>The first instance<sup><a href="#first">5</a></sup> of the misattribution is both a victim of how chronology works and slight journalistic error. The <cite><a href="https://books.google.com/books?id=mREEAAAAMBAJ&amp;pg=PA65&amp;hl=en&amp;sa=X#v=onepage&amp;q&amp;f=false">August 19, 1991 issue of Network World</a></cite> has a biography on someone who will be important in our story, <a href="https://en.wikipedia.org/wiki/Paul_Baran">Paul Baran</a>. It’s a long passage. I snipped the relevant parts below:</p>
<blockquote>
  <p>… questions were being asked regarding the U.S.’s ability to survive a pre-emptive nuclear attack with enough of its military capability intact … Baran and his RAND colleagues decided to keep the packet-switching research unclassified… After delays caused by political issues, the government commissioned a public net based on Baran’s research <b>(my note: false)</b>. In 1969, the Defense Advanced Research Projects Agency completed the first packet switched net, dubbed ARPANET.</p>
</blockquote>
<p>This is the correct timeline, but not the correct chain of events. It’s not the last time that mistake will be made.</p>
<p>This passage is buried right near the end of the magazine, after the small back-of-the issue black and white ads. But this is 1991, 13 days after <a href="https://en.wikipedia.org/wiki/Tim_Berners-Lee">Tim Berners-Lee</a> <a href="https://www.w3.org/People/Berners-Lee/1991/08/art-6484.txt">announced the WorldWideWeb</a>. Who cares about the Internet except for a bunch of nerds and weirdos? I'm sure it will continue to be obscure and irrelevant!</p>
<p>Let's move on to 1992.</p>
</section>
<section>
<h3>1992: The Inter-what?!</h3>
<p>So apparently the Internet is becoming a big deal. The first prominent and more direct "Internet was designed to survive bombs" connection is in <cite><a href="https://archive.org/details/wholeinternetuse00krol/page/10/mode/2up">“The Whole Internet User’s Guide &amp; Catalog” from September 1992</a></cite> by <a href="https://en.wikipedia.org/wiki/Ed_Krol">Ed Krol</a>. This is one of those books that’s so successful he came back to pen two sequels. <a href="https://www.amazon.com/Internet-Catalog-Intanetto-yuzazu-Japanese/dp/4900718122/">Amazon even sells a Japanese version</a>. Here, near the beginning of the book, we get our narrative. However, instead of “nuclear” it’s an unspecified “bomb attack”:</p>
<figure>
<img src="https://siliconfolklore.com/internet-history/first-reference.png" alt="An image of the first page of the book. The important text is 'research about how to build networks that could withstand partial outages (like bomb attacks) and still function'" title="An image of the first page of the book. The important text is 'research about how to build networks that could withstand partial outages (like bomb attacks) and still function'"><figcaption><b id="img-1">Figure 1.</b> Is this the beginning?</figcaption>
</figure>
<p>This is an honest error connecting a project that didn’t get approved, the bomb resilient network Paul Baran proposed to the Air Force, with the ARPA Network project (more on both of these later). Specifically this is referring to what Baran called <a href="https://www.rand.org/content/dam/rand/pubs/research_memoranda/2006/RM3103.pdf"><q>hot-potato routing</q></a> in 1964.</p>
<p>Without knowing the individuals involved in each project it is understandable to assume they are connected; that a later effort was a result of an earlier effort as opposed to an independent one.</p>
<p>The ARPA narrative continues to persist as well such as in the 1992 <cite><a href="https://archive.org/details/dnsbindinnutshel00albi/page/n29/mode/2up">“DNS and BIND in a nutshell”</a></cite> by <a href="https://www.linkedin.com/in/paul-albitz-9602294/">Paul Albitz</a> and <a href="https://www.linkedin.com/in/cricketliu/">Cricket Liu</a>:</p>
<blockquote>
<p>The original goal of the ARPANET was to allow government contractors to share expensive or scarce computing resources. <b>(my note: time-sharing)</b> From the beginning, however, users of the ARPANET also used the network for collaboration. This collaboration ranged from sharing files and software and exchanging electronic mail - to joint development and research using shared remote computers.</p>
</blockquote>
<p>Looks like there's now two fairly incompatible stories. Well I'm sure this will be tidied right up. Hold on, I heard from the future. Apparently no, it's just a bigger mess.</p>
</section>
<section>
<h3>1993: This thing's getting popular…</h3>
<p>By 1993, second generation references start to pop up. For instance, <cite><a href="https://archive.org/details/internetfordummi03levi/page/11/mode/1up">"The Internet for Dummies"</a></cite>, in a section written by <a href="https://en.wikipedia.org/wiki/John_R._Levine">John Levine</a> elaborates multiple narratives including from Ed Krol's 1992 work down to oddly specific details:</p> 
<figure>
<picture>
<source srcset="https://siliconfolklore.com/internet-history/inet-for-dummies.webp" type="image/webp">
<img src="https://siliconfolklore.com/internet-history/inet-for-dummies.jpg" alt="Two screenshots comparing an almost identical passage between the two books. The text is 'these days backhoes cutting cables are more of a threat' compared with 'an errant backhoe cutting a cable is just as much of a threat'" title="Two screenshots comparing an almost identical passage between the two books. The text is 'these days backhoes cutting cables are more of a threat' compared with 'an errant backhoe cutting a cable is just as much of a threat'">
</picture>
<figcaption><b id="img-2">Figure 2.</b> “The Whole Internet User’s Guide &amp; Catalog”, 1992 versus "Internet for Dummies", 1993.</figcaption>
</figure>
<p>(<b>Note:</b> John Levine responded to and disputed this section. Please <a href="#backhoe">see the note below for more information</a>.)</p> 
<p>The generic bomb gets an upgrade in what was at the time, a best-seller, the 1993 text, “The Internet Navigator” by <a href="https://www.planetary.org/profiles/paul-gilster">Paul Gilster</a> which, <a href="https://archive.org/details/internetnavigato00paul/page/14/mode/2up">on page 14 says in an uncited passage</a>:</p>
<blockquote>
<p>The ARPANET was a network connecting university, military, and defense contractors; it was established to aid researchers in the process of sharing information, and not coincidentally to study how communications could be maintained in the event of nuclear attack.</p>
</blockquote>
<p>Ladies and gentlemen, we’ve gone nuclear.</p>

<p>Also, notably, in February of 1993, the science fiction author <a href="https://en.wikipedia.org/wiki/Bruce_Sterling">Bruce Sterling</a> writes perhaps the most compelling narrative fixture of what becomes a later source. This text <a href="https://groups.google.com/g/alt.politics.datahighway/c/FNqaxfFk2hU/m/2E8hxTU823UJ">was shared around USENET</a> throughout 1993. USENET was in practice, social networking over email.</p>
<p>In it there’s a clean narrative line that’s drawn between Paul Baran and ARPANET. It’s a long passage so some cutting was done:</p>
<blockquote>
<p>…the RAND Corporation, America’s foremost Cold War think-tank, faced a strange strategic problem. How could the US authorities successfully communicate after a nuclear war?</p>
<p>Postnuclear America would need a command-and-control network, linked from city to city, state to state, base to base. But no matter how thoroughly that network was armored or protected, its switches and wiring would always be vulnerable to the impact of atomic bombs. A nuclear attack would reduce any conceivable network to tatters. …</p>
<p>RAND mulled over this grim puzzle in deep military secrecy, and arrived at a daring solution. The RAND proposal (the brainchild of RAND staffer Paul Baran) was made public in 1964. In the first place, the network would <em>have no central authority.</em> Furthermore, it would be <em>designed from the beginning to operate while in tatters.</em> …</p>
<p>During the 60s, this intriguing concept of a decentralized, blastproof, packet-switching network was kicked around by RAND, MIT and UCLA. The National Physical Laboratory in Great Britain set up the first test network on these principles in 1968. <b>(my note: this is the transition)</b> Shortly afterward, the Pentagon’s Advanced Research Projects Agency decided to fund a larger, more ambitious project in the USA. The nodes of the network were to be high-speed supercomputers (or what passed for supercomputers at the time). These were rare and valuable machines which were in real need of good solid networking, for the sake of national research-and-development projects.</p>
</blockquote>
<p>Look how smooth that is with the phrase "Shortly afterward". He's not exactly <em>saying</em> they're explicitly connected, just that's the chronology. Someone misreading this as a claim of attribution probably can't be faulted.</p>
<p>This connection can be found in other texts such as 1994’s <cite><a href="https://archive.org/details/internetconnecti0000quar/page/20/mode/2up">“The Internet Connection: System Connectivity and Configuration”</a></cite> where the author, <a href="https://en.wikipedia.org/wiki/John_Quarterman">John Quarterman</a> states without citation (going back to our "common knowledge" definition above) in a section titled “Surviving a Nuclear War” a very similar passage he stated in a 1993 text co-authored with <a href="https://www.linkedin.com/in/carlmitchell/">Smoot Carl-Mitchell</a>†, <cite><a href="https://archive.org/details/practicalinterne0000carl/page/4/mode/2up">“Practical Internetworking with TCP/IP and Unix”</a></cite>:</p>
<figure>
<img src="https://siliconfolklore.com/internet-history/quarterman.png" alt="Another split image demonstrating an almost identical passage between two books. The passage reads 'The ARPANET was a direct product of the Cold War. ARPA itself was formed in response to the launching of the Sputnik satellite by the Soviet Union in 1957. It was intended to ensure the US got ahead in military research and stayed there. As DoD urgently wanted military command and control networks that could survive a nuclear war...'" title="Another split image demonstrating an almost identical passage between two books. The passage reads 'The ARPANET was a direct product of the Cold War. ARPA itself was formed in response to the launching of the Sputnik satellite by the Soviet Union in 1957. It was intended to ensure the US got ahead in military research and stayed there. As DoD urgently wanted military command and control networks that could survive a nuclear war...'"><figcaption><b id="img-3">Figure 3.</b> Quite similar</figcaption>
</figure>
<p>It’s worth noting that John Quarterman might have had his mind changed on this. In an earlier, widely cited, 1990 text by him, <cite><a href="https://archive.org/details/matrixcomputernet00quar/page/142/mode/2up">"The Matrix: Computer Networks and Conferencing Systems Worldwide"</a></cite>, he used a citation, suggesting we haven't entered a common knowledge phase, and told a much more ARPA history as follows:</p>
<blockquote>
<p>In the beginning, ARPA…noticed that its contractors were tending to request the same resources (such as databases, powerful CPUs, and graphics facilities) and decided to develop a network among the contractors that would allow sharing such resources [Roberts 1974].</p>
</blockquote>
<p>Why didn’t he stick with that?</p>

<p>Indeed, it looks like Quarterman had multiple tracks in his writing. For our purposes we can say there was one for a general audience and one with much more rigor (he claims this is a too primitive split see the <a href="#all-emails">full email dump below if interested</a>). For instance, in the <a href="https://archive.org/details/sim_unix-review_1993-08_11_8/page/n79/mode/2up">before August</a>, 1993 more academic text with <a href="https://dl.acm.org/profile/81100325226">Susanne Wilhelm</a>, <cite><a href="https://archive.org/details/unixposixopensys0000quar/page/194/mode/2up">"UNIX, POSIX, and Open Systems: The Open Standards Puzzle"</a></cite>, the story given is:</p>
<blockquote>
  <p>
  …The ARPANET was created by DARPA as an experiment in and platform for research in packet switched networking.
  </p>
</blockquote>
<p>Regardless, the "common knowledge" narrative continues to evolve.</p>
</section>
<section>
<h3>1994: The Cathedral Becomes a Bazaar</h3>
<p>It's 1994! Along with GeoCitites, Lycos and CDNow, we get perhaps the first claim of a direct causal connection from <cite><a href="https://www.google.com/books/edition/INSCOM_Journal/wqkrAAAAYAAJ?hl=en&amp;gbpv=1&amp;pg=RA3-PA10&amp;printsec=frontcover">INSCOM (Army Intelligence &amp; Security Command) in March 1994 on page 10</a></cite>:</p>
<blockquote>
<p>…says University of Pennsylvania Telecommunications Professor David Farber, “that the Internet is actually a cold war relic, designed in the 1960s as a decentralized military communications system <b>capable of surviving a nuclear attack</b>. The Internet, which has grown explosively ever since Hurricane Andrew in 1992, has now proved its usefulness for emergency action in the civilian world.”</p>
</blockquote>
<p>There's that popular phrase "capable of surviving a nuclear attack" starting up. It's a good search term if you just feel like reading a mountainful of versions of this narrative. <a href="https://en.wikipedia.org/wiki/David_J._Farber">David Farber</a> is not a nobody. Designer of predecessor networks such as <a href="https://en.wikipedia.org/wiki/CSNET">CSNET</a>, <a href="https://en.wikipedia.org/wiki/National_Science_Foundation_Network">NSFNet</a>, and <a href="https://en.wikipedia.org/wiki/National_research_and_education_network">NREN</a>, he’s a <a href="https://en.wikipedia.org/wiki/Bell_Labs">Bell Labs</a>, <a href="https://en.wikipedia.org/wiki/Scientific_Data_Systems">SDS</a> and <a href="https://en.wikipedia.org/wiki/RAND_Corporation">RAND Corporation</a> alumni. That last one, RAND, will be more important in our story.</p>
<p>We also find the older narrative “ARPANET is an indirect consequence of nuclear war planning” starting to become "common knowledge" such as in <cite><a href="https://www.google.com/books/edition/Japanese_Technical_Literature_Bulletin/gLIvm9n9a3EC?hl=en&amp;gbpv=1&amp;pg=RA7-PA5&amp;printsec=frontcover">“Japan’s Information Highway” from Nov 26, 1994</a></cite>, also uncited:</p>
<blockquote>
<p>Spawned by a Pentagon doomsday scheme to keep US military computers operating in the event of a nuclear war, the Internet…</p>
</blockquote>
<p>In all these claims the statement was ARPA was looking for a resilient network due to cold war politics with the risk of nuclear war playing somewhere in the background and the ARPANET came out of this dynamic.</p>
<p>Also by 1994 the ARPA people have started to hear the nuclear narrative a bit too much. In <cite><a href="https://books.google.com/books?id=URcEAAAAMBAJ&amp;lpg=PA61&amp;pg=PA61#v=onepage&amp;q&amp;f=false">"Network World" from Aug 22, 1994</a></cite> there's “Myth vs.&nbsp;Reality” inset from <a href="https://en.wikipedia.org/wiki/Leonard_Kleinrock">Leonard Kleinrock</a> in an absolutely futile effort to try and dislodge things:</p>
<figure>
<picture>
<source srcset="https://siliconfolklore.com/internet-history/myth-v-reality.webp" type="image/webp">
<img src="https://siliconfolklore.com/internet-history/myth-v-reality.jpg" alt="The text of the image reads: Myth: ARPANET was conceived as a way to maintain government data communications after a nuclear war. Reality: ARPANET was conceived as a way to save money by getting government-funded researchers to share computers rather than each of them buying their own. Source: Leonard Kleinrock, UCLA" title="The text of the image reads: Myth: ARPANET was conceived as a way to maintain government data communications after a nuclear war. Reality: ARPANET was conceived as a way to save money by getting government-funded researchers to share computers rather than each of them buying their own. Source: Leonard Kleinrock, UCLA"><figcaption><b id="img-4">Figure 4.</b> Sigh, we’re still trying to correct this</figcaption>
</picture>
</figure>
<p>It was hopeless. Network World was the first source we found for spreading it to begin with.</p>
<p>While we're here, the article that was referenced in "Where the Wizards Stay Up Late" from the beginning is the lead for the <cite><a href="https://content.time.com/time/subscriber/article/0,33009,981132,00.html">July 25, 1994 issue of TIME Magazine</a></cite><sup><a href="#time-date">6</a></sup>. Here's the now common story:</p>
<blockquote>
  <p>The Internet evolved from a computer system built 25 years ago by the Defense Department to enable academic and military researchers to continue to do government work even if part of the network were taken out in a nuclear attack. It eventually linked universities, government facilities and corporations around the world, and they all shared the costs and technical work of running the system.</p>
</blockquote>
</section>
<section>
<h3>1995: The extended universe</h3>
<p>1995! Let's log on to AOL and use the keyword MovieLink to find the screentimes for The Net with Sandra Bullock. Then we'll hop in the minivan and watch it at the mall!</p>
<div>
<p>"Oh what do you mean we have to watch PBS instead?! Alright alright fine, let's <a href="https://archive.org/details/The_Internet_Show_KCET_PBS_1994">watch the documentary</a>!":</p>
<figure>
<iframe alt="The predecessor of the internet was a child of the Cold War first developed by the defense departments advanced research projects agency or ARPA partly to ensure the data communications could survive in case of a nuclear attack. Created in the late 1960s ARPANET first connected four computers in California and Utah campuses using a new networking technique. It allowed researchers to run programs on remote computers. Later other research institutions and military sites were added. The idea was even if one part of the system were damaged, the rest would still function and it worked." title="The predecessor of the internet was a child of the Cold War first developed by the defense departments advanced research projects agency or ARPA partly to ensure the data communications could survive in case of a nuclear attack. Created in the late 1960s ARPANET first connected four computers in California and Utah campuses using a new networking technique. It allowed researchers to run programs on remote computers. Later other research institutions and military sites were added. The idea was even if one part of the system were damaged, the rest would still function and it worked." width="560" height="315" src="https://www.youtube.com/embed/S_JzUBP_1wM" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
<figcaption><b id="vid-1">Video 1.</b> We even get to see the explosion! (♿ <a href="#pbs-text">Transcript</a>)</figcaption>
</figure>
</div>
<p>By now the nuclear narrative has become "common knowledge" so people start making logical inferences from it in official documents such as the US Congressional Office of Technology Assessment's <cite><a href="https://www.google.com/books/edition/Global_Communications/m4keIKypadcC?hl=en&amp;gbpv=1&amp;pg=PA102&amp;printsec=frontcover">“Global Communications: Opportunities for Trade and Aid”</a></cite> from 1995, page 102:</p>
<blockquote>
<p>…the desire for a computer network that would remain operational in the event that part of the network was destroyed by a nuclear explosion. The ARPANET therefore had no central control.</p>
</blockquote>
<p>You even get hybrids combining multiple narrative strains. Watch it grow in the 1995 academic text, <cite><a href="https://www.google.com/books/edition/Technology_in_the_national_interest/jEqFQv1P_UYC?hl=en&amp;gbpv=1&amp;pg=PA66&amp;printsec=frontcover">“Technology in The National Interest”</a></cite>:</p>
<blockquote>
<p>war planners undertook and effort to ensure the survivability of America’s computing and communication capabilities in a nuclear first strike to preserve a credible U.S. retaliatory capability. From this initiative the first network, ARPANET, was established, allowing geographically separated researchers to share computer resources.</p>
</blockquote>
<p>After that it was off to the races, such as in this 1995 text, <cite><a href="https://archive.org/details/vrmlbrowsingbuil00pesc/page/10/mode/2up">"VRML Browsing &amp; Building Cyberspace: The Definitive Resource for VRML Technology"</a></cite>:</p>
<figure>
<img src="https://siliconfolklore.com/internet-history/routing-errors.png" alt="The text of the image is 'To ARPAnet, nuclear war is no more than a bunch of routing errors that it could immediately correct'" title="The text of the image is 'To ARPAnet, nuclear war is no more than a bunch of routing errors that it could immediately correct'"><figcaption><b id="img-5">Figure 5.</b> What have we done?!</figcaption>
</figure>
<p>This story has serious sticking power and other than for the people who actually built the Internet, nobody seems to have any desire to correct it.</p>
</section>
<section>
<h2 id="survey">Narrative Survey</h2>
<p>The history narrative appears to be able to be clustered in three general camps:</p>
<ul>
  <li><b>ARPA:</b> Documents bearing the ARPA name or people directly involved with the ARPANET project. (A)</li>
  <li><b>Peers:</b> Either scholars or people who worked on other networks. (P)</li>
  <li><b>Outsiders:</b> Those who are not in the first two groups but are what we called knowledge staters, such as reporters. They either credit members of either of the first two groups or nobody. (A<sub>o</sub>, P<sub>o</sub>, or N<sub>o</sub>). Outsiders Nobody (N<sub>o</sub>) is possibly equivalent to "common knowledge".</li>
</ul>
<p>
The narrative has been broken down into a number of story points and were arranged as chronologically as possible. The methodology <a href="#survey-method">can be found at the end</a>.</p>
<ul>
  <li>Blue cells with a ✓ mean a claim was made. For instance, "Paul Baran invented packet-switching at RAND which led to ARPAnet".</li>
  <li>Grey cells with a § sign means things were mentioned but not causally linked. For instance, "Before ARPAnet, Paul Baran also had a packet-switching project at RAND" would be "sectional" and not "causal".</li>
  <li>Red cells with a ✗ mean a claim was refuted. For instance, "ARPAnet's architecture was distinct from Paul Baran's and both groups say they're unrelated".</li>
  <li>Empty cells mean nothing either way was said.</li>
  <li>Word count is the number of words dedicated to the telling of the narrative.</li>
  <li>The "faction" is approximately where the narrative split is (see below).</li>
  <li>The columns with the <span>thicker border</span><span>green background (♿ titled "arpa" and for the color-blind, vertical lines)</span> are ARPA faction narratives. They are additionally stylized to demonstrate a point made below.</li>
</ul>
<div>
<h4>Table headers</h4>
<ol>
<li>1988/04: <a href="https://books.google.com/books?id=pj0EAAAAMBAJ&amp;pg=PA57&amp;hl=en&amp;sa=X#v=onepage&amp;q&amp;f=false">Infoworld</a></li>
<li>1990/01: <a href="https://archive.org/details/matrixcomputernet00quar/page/142/mode/2up">Matrix</a></li>
<li>1990/02: <a href="https://www.researchgate.net/publication/235051902_DARPA_Technical_Accomplishments_An_Historical_Review_of_Selected_DARPA_Projects_Volume_1">DARPA</a></li>
<li>1990/09: <a href="https://www.nytimes.com/1990/09/02/business/creating-a-giant-computer-highway.html">NYT</a></li>
<li>1991/08: <a href="https://books.google.com/books?id=mREEAAAAMBAJ&amp;pg=PA65&amp;hl=en&amp;sa=X&amp;q&amp;f=false">Network World</a></li>
<li>1991/09: <a href="https://archive.org/details/computer-magazine-1991-09/page/n69/mode/2up">Computer Magazine</a></li>
<li>1992/09: <a href="https://archive.org/details/wholeinternetuse00krol/page/10/mode/2up">Krol</a></li>
<li>1992/10: <a href="https://archive.org/details/dnsbindinnutshel00albi/page/n29/mode/2up">DNS/BIND</a></li>
<li>1993/02: <a href="https://groups.google.com/g/alt.politics.datahighway/c/FNqaxfFk2hU/m/2E8hxTU823UJ">Sterling</a></li>
<li>1993/<a href="https://archive.org/details/sim_special-libraries_fall-1993_84_4/page/n13/mode/2up">09</a>: <a href="https://archive.org/details/internetnavigato00paul/page/14/mode/2up">Gilster</a></li>
<li>1993/<a href="https://greensboro.com/internet-s-growli-is-catching-lie-eye-of-businesses-for/article_23e4343f-2d3f-53e1-88ee-a0a2943cf95f.html">11</a>: <a href="https://archive.org/details/internetfordummi03levi/page/11/mode/1up">The Internet For Dummies</a></li>
<li>1994/<a href="https://archive.org/details/login_mar94/page/n43/mode/2up">02</a>: <a href="https://archive.org/details/internetconnecti0000quar/page/20/mode/2up">Quarterman</a></li>
<li>1994/03: <a href="https://www.google.com/books/edition/INSCOM_Journal/wqkrAAAAYAAJ?hl=en&amp;gbpv=1&amp;pg=RA3-PA10&amp;printsec=frontcover">INSCOM</a></li>
<li>1994/<a href="https://archive.org/details/ConneXions.08.07/page/26/mode/2up">07</a>: <a href="https://archive.org/details/internetguidefor00dani/page/8/mode/2up">The Internet Guide for New Users</a></li>
<li>1994/07: <a href="https://content.time.com/time/subscriber/article/0,33009,981132,00.html">Time</a></li>
<li>1994/08: <a href="https://books.google.com/books?id=URcEAAAAMBAJ&amp;lpg=PA61&amp;pg=PA61#v=onepage&amp;q&amp;f=false">Network World</a></li>
<li>1994/08: <a href="https://www.latimes.com/archives/la-xpm-1994-08-11-me-26027-story.html">LA Times</a></li>
<li>1995/??: <a href="https://archive.org/details/teachyourselfint00rand/page/34/mode/2up">Teach yourself the Internet in a Week</a></li>
<li>1995/<a href="https://www.imdb.com/title/tt7076054/">08</a>: <a href="https://archive.org/details/TheInternetShow1995IzqMrhG50q0/The+Internet+Show+(1995)-IzqMrhG50q0.mp4">The Internet Show</a></li>
<li>1995/09: <a href="https://www.google.com/books/edition/Global_Communications/m4keIKypadcC?hl=en&amp;gbpv=1&amp;pg=PA102&amp;printsec=frontcover">Global Communications</a></li>
<li>2022/02: <a href="#narrative">Siliconfolklore.com</a></li>
</ol>
</div>
<center>

</center>
<section>
<h4>The Winner's Circle Theory</h4>
<p>There appears to roughly be two schools. The Peer group gave more encompassing histories then the ARPA group. The ARPA group told a history to more or less the exclusion or omission of other projects.</p>
<p>Because the Peer group had more moving pieces, a wider diversity of narratives could be constructed from it.</p>
<p>This is more a social phenomena than anything intentional and will be explored in other articles. People in "the winner's circle", defined by that which became dominant, tend to narrow the narrative and give their efforts a higher priority while the outsiders in other notable projects, tend to broaden the narrative and level things out.</p>
<p>They both play an important role in the documentation. The outsiders carefully document the important contributions of others while the winner's circle carefully document their own contributions. They pair together to form a complete picture.</p>
</section>
<h3 id="narrative">The evidence supported story</h3>
<p>Before we go on let's untangle things. I believe this is what has direct evidence. As this is yet an additional narrative, it's been included as the right-most column in <a href="#tbl-1">Table 1</a>:</p>
<ul>
  <li><a href="https://archive.org/details/RecommendationToTheAirStaff/mode/2up">Paul Baran and RAND had a proposed network in 1965 to USAF</a>.</li>
  <li>(same reference) It was not intended to use the phone system but instead, be an independent network built parallel to the electric grid.</li>
  <li><a href="https://www.rand.org/pubs/research_memoranda/RM3103.html">It was designed to be redundant, but not to scale</a>.</li>
  <li>(same reference) It was meant to be used for command and control loads and not intended to be expanded beyond military communication and use.</li>
  <li><a href="https://archive.org/details/DraftReportForDataCommunicationFacilities/page/n1/mode/2up">The 1967 ARPA Network proposal by BBN says it's for research, sharing, and cost cutting</a>.</li>
  <li>(same reference) It was to run on normal phone lines and be focused on connecting nodes, presumed the network would be cared for, and did not offer extreme redundancy.</li>
</ul>
<p>
Additionally, Cerf claims the following in personal email correspondances, with verifications below:</p>
<blockquote><p>
Kleinrock did queueing theoretic analysis of capacity, delay, throughput of store-and-forward networks. The routing protocols of ARPANET were developed at Bolt, Beranek and Newman. Bob Kahn, John McQuillan and William Crowther and maybe David Walden (?) were principal architects of the routing system of the ARPANET.</p>
</blockquote>
<p>Kleinrock did lots of networking work. This is a claim of the work he did specifically for ARPANET. It can be confirmed in the 1970 ARPA document, <a href="https://archive.org/details/DTIC_AD0711342/page/n9/mode/2up">DTIC AD0711342</a>.</p>
<blockquote><p>BBN did its routing work independent of Davies <b>(my note: Paul Baran believes it was based on Davies work <a href="#baran-agrees">in a 2001 Wired article</a>)</b> Roberts learned of the <a href="https://en.wikipedia.org/wiki/NPL_network">NPL work</a> while at a 1967 ACM conference in Gatlinburg, TN. One of the NPL team, Roger Scantlebury, was there and told Roberts about the NPL packet network (Davies coined the term "packet" to describe the system he had designed). The NPL network was a single node so there was no real routing in the system. Davies did invent something he called "isarhythmic networking" but it did not scale and was not implemented as far as I am aware.</p></blockquote>
<p>Here's the <a href="https://dblp.org/db/conf/sosp/sosp67.html">1967 ACM Conference</a> proceedings. There are two adjacent records in the proceedings:
</p><ol>
  <li>Donald W. <b>Davies</b>, Keith A. Bartlett, Roger A. <b>Scantlebury</b>, Peter T. Wilkinson:<br>
  A digital <b>communication network for computers</b> giving rapid response at remote terminals.</li>
  <li>Lawrence G. <b>Roberts</b>:<br>
  Multiple computer networks and intercomputer communication.</li>
</ol>

<p>Additionally Cerf backs the claim of the scaling over reliability aspect of ARPANET which really lays bare any design for nuclear survivability hypothesis:</p>
<blockquote><p>
Regarding unreliability - yes, alternative, adaptive routing was part of the ARPANET design to deal with link and/or node (packet switch) failures but the protocols internal to the ARPANET were designed to include end-to-end retransmission WITHIN THE NETWORK. The Host-Host protocol (also known as the Network Control Protocol) basically assumed the network was reliable. The Internet design, which had to cope with unreliable radio communications of the Packet Radio and Packet Satellite networks, required end-to-end retransmission at the HOST level. 
</p></blockquote>
<p>Probably the most approachable narrative history of ARPA's side of the story is from a 1999 documentary, Nerds 2.0.1. The history goes from the timestamp at 19:22 to the end of the video with a bunch of interludes that make you think they're moving on from the narrative, but then they go right back. I clicked the gear, then playback speed and I know you will too.</p>
<figure>
<iframe width="560" height="315" src="https://www.youtube.com/embed/L4D2nxQBmOM?start=1162" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
<figcaption><b id="vid-2">Video 2.</b> I'll hold my tongue on the narrator. However, <a href="https://en.wikipedia.org/wiki/Robert_X._Cringely#InfoWorld">Wikipedia does not</a>.</figcaption></figure>

<p>
The first article about ARPANET I could find was before it was called ARPANET. In September of 1968, <cite><a href="https://archive.org/details/bitsavers_Electronic9680916_134517369/page/62/mode/2up">Electronics Magazine</a></cite>:
</p><blockquote>
  <p>
The first time-sharing network using incompatible computers has come a big step closer to reality. The project, announced last year, now has a timetable and is ready to buy hardware, says Lawrence G. Roberts, assistant to the director of information processing at the Pentagon’s Advanced Research
Projects Agency.
In the ARPA network, a user of one computer will have access to programs in all other machines, even if those programs won’t run on the computer to which he’s directly connected.
  </p>
</blockquote>
<p>This was followed up two weeks later by a <a href="https://archive.org/details/bitsavers_Electronic9680930_123128184/page/130/mode/2up">4-page article</a>. The analysis of this text is amazing. And I quote, from 1968, before the ARPANET was built:</p>
<blockquote>
  <p><em>(Distributed Denial of Service Attacks):</em> Roberts notes that sites with smaller computers could start “ganging up” on those with larger processors. This could mean that a lot of work could be thrust upon, say, the Univac 1108’s in the network.</p>
  <p><em>(Societal Implications of the Network):</em> …geographical separation and user isolation may limit the network’s utility. Mills believes the problem may grow as the user population increases. “There should have been a definition of the relationship between a man and his program, as a unit, and the distant central machine or other data processing gear with which they are working.” In other words, Mills believes ARPA put the cart before the horse by going ahead on interconnecting computers before determining what the benefits of such a network would be.</p>
</blockquote>
<p>I think this is prescient but I might be reading too much into this. Vint Cerf thinks it was impossible to predict things.<sup><a href="#cerf">2</a></sup></p>
</section>
<section>
<h3 id="common">How common are the narratives</h3>
<p>Barry Gerber, who <a href="https://siliconfolklore.com/internet-history/gerber-email.txt">was contacted for this story</a> and did some early social science research about the ARPAnet at UCLA presented an interesting question: "I have to wonder how widespread the belief in this particular myth is today".</p>
<p>To make an attempt to discover this, a corpus of 13.5 billion <a href="https://files.pushshift.io/reddit/comments/">Reddit comments</a> were analyzed with <a href="https://github.com/kristopolous/sf/blob/main/narrative-extractor.sh">a complex regex yielding 191,725 candidate comments</a>. Then <a href="https://github.com/kristopolous/sf/blob/main/narrative-counter.py">a second pass was done</a> using a naive Regex classifier with another naive way to see if the user is negating (as in saying "arpanet was not about ww3"). No stemming, tokenizing or lemmatization was done; scikit wasn't even included. This is certainly ongoing research. (<a href="https://en.wikipedia.org/wiki/BERT_(language_model)">BERT Transformers</a> are the most likely next approach along with also using the <a href="https://files.pushshift.io/hackernews/">HackerNews corpus</a>.)</p>
<p>The first column are affirmatives of the story point and the second columns are instances where negation appeared. The "sample size" is the total number of comments considered for a given year. You can hover over each cell to see the value on desktop.</p>
<center>
<h2>This table does not work on the print version due to being based on cell opacity and background colors. Sorry, I'll get around to fixing this.</h2>
<div>
<!-- This is generated from the python program linked above. -->
<table id="heat">
<caption><b id="tbl-2">Table 2.</b> Heatmap of Internet history narrative story points from Reddit comments.</caption>
<thead><tr><th>Year</th><th>Sample Size</th><th colspan="2">Paul Baran/RAND</th><th colspan="2">Bomb</th><th colspan="2">Nuclear</th><th colspan="2">Decentralized</th><th colspan="2">Cost Reduction</th><th colspan="2">Research</th><th colspan="2">Collaboration</th></tr></thead><tbody>
<tr><td>2009</td><td>75</td><td title="8%"></td><td title="1%"></td><td title="0%"></td><td title="0%"></td><td title="16%"></td><td title="1%"></td><td title="8%"></td><td title="6%"></td><td title="6%"></td><td title="2%"></td><td title="25%"></td><td title="13%"></td><td title="9%"></td><td title="1%"></td></tr>
<tr><td>2010</td><td>150</td><td title="8%"></td><td title="5%"></td><td title="4%"></td><td title="2%"></td><td title="12%"></td><td title="5%"></td><td title="7%"></td><td title="2%"></td><td title="8%"></td><td title="3%"></td><td title="16%"></td><td title="8%"></td><td title="17%"></td><td title="4%"></td></tr>
<tr><td>2011</td><td>221</td><td title="8%"></td><td title="3%"></td><td title="2%"></td><td title="2%"></td><td title="19%"></td><td title="6%"></td><td title="8%"></td><td title="4%"></td><td title="5%"></td><td title="3%"></td><td title="23%"></td><td title="14%"></td><td title="10%"></td><td title="4%"></td></tr>
<tr><td>2012</td><td>512</td><td title="8%"></td><td title="3%"></td><td title="5%"></td><td title="0%"></td><td title="16%"></td><td title="6%"></td><td title="5%"></td><td title="2%"></td><td title="7%"></td><td title="2%"></td><td title="25%"></td><td title="9%"></td><td title="13%"></td><td title="5%"></td></tr>
<tr><td>2013</td><td>504</td><td title="9%"></td><td title="3%"></td><td title="3%"></td><td title="1%"></td><td title="14%"></td><td title="4%"></td><td title="5%"></td><td title="3%"></td><td title="8%"></td><td title="2%"></td><td title="25%"></td><td title="13%"></td><td title="14%"></td><td title="3%"></td></tr>
<tr><td>2014</td><td>655</td><td title="8%"></td><td title="4%"></td><td title="3%"></td><td title="1%"></td><td title="16%"></td><td title="6%"></td><td title="7%"></td><td title="4%"></td><td title="8%"></td><td title="4%"></td><td title="22%"></td><td title="9%"></td><td title="13%"></td><td title="4%"></td></tr>
<tr><td>2015</td><td>671</td><td title="9%"></td><td title="4%"></td><td title="4%"></td><td title="2%"></td><td title="15%"></td><td title="4%"></td><td title="6%"></td><td title="2%"></td><td title="7%"></td><td title="3%"></td><td title="23%"></td><td title="11%"></td><td title="12%"></td><td title="5%"></td></tr>
<tr><td>2016</td><td>731</td><td title="11%"></td><td title="3%"></td><td title="3%"></td><td title="1%"></td><td title="17%"></td><td title="4%"></td><td title="7%"></td><td title="2%"></td><td title="8%"></td><td title="3%"></td><td title="23%"></td><td title="9%"></td><td title="11%"></td><td title="3%"></td></tr>
<tr><td>2017</td><td>946</td><td title="11%"></td><td title="2%"></td><td title="4%"></td><td title="1%"></td><td title="15%"></td><td title="3%"></td><td title="9%"></td><td title="3%"></td><td title="10%"></td><td title="4%"></td><td title="24%"></td><td title="7%"></td><td title="10%"></td><td title="5%"></td></tr>
<tr><td>2018</td><td>1023</td><td title="9%"></td><td title="2%"></td><td title="3%"></td><td title="1%"></td><td title="14%"></td><td title="4%"></td><td title="10%"></td><td title="4%"></td><td title="7%"></td><td title="2%"></td><td title="23%"></td><td title="8%"></td><td title="15%"></td><td title="4%"></td></tr>
<tr><td>2019</td><td>1182</td><td title="10%"></td><td title="3%"></td><td title="3%"></td><td title="1%"></td><td title="16%"></td><td title="4%"></td><td title="7%"></td><td title="3%"></td><td title="5%"></td><td title="2%"></td><td title="25%"></td><td title="9%"></td><td title="17%"></td><td title="4%"></td></tr>
<tr><td>2020</td><td>1294</td><td title="10%"></td><td title="3%"></td><td title="3%"></td><td title="1%"></td><td title="16%"></td><td title="3%"></td><td title="7%"></td><td title="2%"></td><td title="7%"></td><td title="2%"></td><td title="25%"></td><td title="6%"></td><td title="17%"></td><td title="5%"></td></tr>
<tr><td>2021</td><td>1622</td><td title="11%"></td><td title="4%"></td><td title="3%"></td><td title="1%"></td><td title="14%"></td><td title="4%"></td><td title="9%"></td><td title="3%"></td><td title="7%"></td><td title="2%"></td><td title="21%"></td><td title="6%"></td><td title="17%"></td><td title="4%"></td></tr>
<tr><td>2022</td><td>1188</td><td title="12%"></td><td title="2%"></td><td title="4%"></td><td title="0%"></td><td title="19%"></td><td title="4%"></td><td title="10%"></td><td title="2%"></td><td title="5%"></td><td title="2%"></td><td title="20%"></td><td title="5%"></td><td title="15%"></td><td title="4%"></td></tr>
</tbody></table>
</div>
</center>
<h4>Notes</h4>
<p>When filtering strictly on "ARPANET", the nuclear affirmative numbers dropped by about ~4 percentage points which is to be expected if we are to assume those familiar with ARPANET may be more likely to know the (A) narrative. To answer the posed question, it looks to be, at least according to those opining on Reddit in a way that matches my filters, about <b>1/6</b> affirm the nuclear narrative and this appears to be more or less stable over the 13 year range.</p>
<p>The robustness of this result is interesting. The most likely cause is my own incompetent execution. Ignoring that possibility, it's of unique interest simply because of Reddit's growth and demographic change over time.</p>
<p>The graph below is the month-by-month line count for the archival comments linked above. Every comment in the archives is one line of encoded JSON.</p>
<figure>
<img src="https://siliconfolklore.com/internet-history/comments-per-month.png" alt="A chart showing how Reddit has grown to 250 million comments per month since the start of the data dump in 2007'" title="A chart showing how Reddit has grown to 250 million comments per month since the start of the data dump in 2007'">
<figcaption><b id="img-6">Figure 6.</b> Monthly comments on Reddit in millions.</figcaption>
</figure>
<p>Then again, this is something that was communicated by University professors that had been publishing on networks since the 1970s. Newspapers, textbooks, congressional documents, a certain percentage all gave part of a (P) narrative. There could be more fundamental reasons for its continued persistence.</p>
</section>
<section>
<h3 id="why-it-sticks">Why the Nuclear story sticks</h3>
<p>Like good conspiracy theories, there’s related truths that make the core message believable. The ARPANET project was by DARPA, which was under the Department of Defense. This organization was launched after Sputnik. The military had something called <a href="https://en.wikipedia.org/wiki/MILNET">MILNET</a>, it’s own split-off from the Internet from 1983 which became NIPRnet.</p>
<p>In 1971 the command and control <a href="https://en.wikipedia.org/wiki/Worldwide_Military_Command_and_Control_System">WWMCCS</a> had an ARPANET like system using BBN IMPs. <a href="https://en.wikipedia.org/wiki/ALOHAnet">ALOHAnet</a> did lead to <a href="https://en.wikipedia.org/wiki/PRNET">PRNET</a> and a packet-radio van which interacted with a satellite network, SATNET.<sup><a href="#cerf-note">14</a></sup> Before that there was a trans-atlantic link, NORSAR connecting to seismic units in Norway to, among other things, <a href="https://en.wikipedia.org/wiki/NORSAR">enforce the Comprehensive Nuclear Test Ban Treaty</a>.</p>
<p>There is some cold war connection, just like there is in much of computer technology from the era. The generalized statement that DARPA money funded Silicon Valley is true and it’s understandable how fuzzy memories and a bit less rigor can fuse connections.</p>
<p>Also there’s a conspiracy tendency when it comes to grim folklore. Perhaps people denying the nuclear war connection have a political agenda, they were misinformed or they are too scared to admit it. It has its own defense built in that permits people trying to correct the narrative to be dismissed as trying to push an opinion or occluded political agenda.</p>
<p>However, the documentation is voluminous and the people who were in the room have all given a consistent story about how it was to build a network for time-sharing of expensive computers and better collaboration.</p>
<p>People also have a tendency to not be careful with chronologies and often attribute events in a narrative structure that would require people time-traveling to be possible.</p>
<p>To put this in perspective let’s use living recent memory. It would be like seeing a connection between say COVID-19 pandemic outcomes being related to political governance, that there was a 2012 Ebola outbreak and then claim the outcome of the Obama/Romney 2012 election was a direct consequence of the federal COVID-19 response.</p>
<p>That’s really the same dynamic. Events in the 1970s are being placed categorically adjacent to events in the 1960s and after the table is set, a narrative is drawn between them.</p>
<figure>
<picture>
<source srcset="https://siliconfolklore.com/internet-history/cerf1.webp" type="image/webp">
<img src="https://siliconfolklore.com/internet-history/cerf1.jpg" alt="A crop of a comic book where the hero says 'This is worse than I imagined cerf boy. The writer has completely lost control of the plot'" title="A crop of a comic book where the hero says 'This is worse than I imagined cerf boy. The writer has completely lost control of the plot'">
</picture>
<figcaption><b id="img-7">Figure 7.</b> From <a href="https://archive.org/details/CaptainInternetAndCERFBoyNumber1October1991/page/n13/mode/2up">The Adventures of Captain Internet And CERF Boy - Number 1 October 1991</a>.</figcaption>
</figure>
</section>
<section>
<h2>Right Click, View Source</h2>
<p>As I’ll cover in further articles in this series, there’s no expectation that an engineer be a historian or that accurate scholarship can be expected in the days before mass digitization especially in texts where the history isn’t a focus of the scholarship.</p>
<p>Also, the prevailing assumption is to look for mistakes before assuming malice. Not just because it’s more polite to do so but also because these statements are small buried passages in much larger, often dry technical works. There’s no evidence these authors are fabulists trying to tell compelling stories.</p>
<p>To dig deeper on this we’ll refer back to the 1990 DARPA document.</p>
<p>From “DARPA Technical Accomplishments”, section 20-2 we find this:</p>
<blockquote>
<p>Notable early contributions had been made by P. Baran and collaborators at RAND. Baran’s work in the early 1960’s outlined a distributed, survivable digital communications system for the Air Force, in which a data stream would be broken near the point of initiation into addressed subunits of less than two hundred bits, which would then be routed by “intelligent” nodes over multiple paths which could include satellites as well as telephone communication lines. Baran’s group also ran a simplified computer simulation of such a network, using six nodes, which demonstrated its workability and survivability and indicated that the nodes did not need to store many message segments in order to be effective… A 1962 thesis by L. Kleinrock, then at Lincoln Laboratory, came to a similar conclusion.</p>
</blockquote>
<p>With the important part coming after:</p>
<blockquote>
<p>The Air Force did not follow up Baran’s work, apparently because of skepticism from the communications community, which felt that data hang-ups would be common and buffer storage requirements large. Baran’s work, apparently, was not well known to members of the DARPA community when they began their plans for computer communications networks.</p>
</blockquote>
<p>Vint Cerf says as much in the YouTube link provided above in the first section.</p>
<p>The work they are referring to is entitled <cite><a href="https://archive.org/details/RecommendationToTheAirStaff/mode/2up">“Recommendation to the Air Staff”</a></cite> by RAND, from August 1965. Quoting page 2:</p>
<blockquote>
<p>In our view it is possible to build a new large common-user communication network able to withstand heavy damage. Such a network can provide a major step forward in Air Force military communication capability.</p>
</blockquote>
<p>and then page 40 for more lurid detail:</p>
<blockquote>
<p>The cloud-of-doom attitude that nuclear war spells the end of the earth is slowly lifting from the minds of the many. … If war does not mean the end of the earth in a black and white manner, then it follows that we should do those things that make the shade of gray as light as possible: to plan now to minimize potential destruction and to do all those things necessary to permit the survivors of the holocaust to shuck their ashes and reconstruct the economy swiftly.</p>
</blockquote>
<p>So this failed proposal in 1965 matches our claim by David Farber. They both worked at RAND. In a <a href="https://www.kgri.keio.ac.jp/en/news-event/051657.html">2019 interview Farber stated</a>:</p>
<blockquote>
<p>It allowed me to broaden out, quite a bit…. This is also the place where Paul Baran and I became good friends. We remained so for the rest of our lives.</p>
</blockquote>
<p>This is consistent. In a <a href="https://historyofcomputercommunications.info/interviews/david-farber/">1988 interview he stated similarly</a>:</p>
<blockquote>
<p>He next joined RAND Corporation in Southern California where he was “heavily involved with, and affected” by, Paul Baran’s work.</p>
</blockquote>
<p>So we have two possible strains, both sourcing back to early 1960s RAND work by Paul Baran; a connection between Baran and ARPANET made by a good friend of his and an understandable scholarship mistake.</p>
<h3 id="baran-agrees">Paul Baran's side</h3>
<p>After being rejected just to see another network take off a few years later, Paul Baran could have lived the life of <a href="https://en.wikipedia.org/wiki/Miss_Havisham">Miss Havisham</a> in contemptuous bitterness and obscurity but that’s not what he did. He dusted off his shoes, moved on and did many other great things. In <a href="https://www.wired.com/2001/03/baran/">March 2001, Wired interviewed him</a>:</p>
<blockquote>
<p><b>Wired</b>: The myth of the Arpanet - which still persists - is that it was developed to withstand nuclear strikes. That’s wrong, isn’t it?</p>
<p><b>Baran</b>: Yes. Bob Taylor had a couple of computer terminals speaking to different machines, and his idea was to have some way of having a terminal speak to any of them and have a network. That’s really the origin of the Arpanet. The method used to connect things together was an open issue for a time.</p>
</blockquote>
<p>But some contention remained. First, as a 2016 article in <a href="https://theconversation.com/how-the-internet-was-born-the-network-begins-to-take-shape-67904">The Conversation</a> points out, RAND in Santa Monica and the original ARPANET node at UCLA were a short bus ride away from each other.</p>
<p>Could be a coincidence. Baran is a little skeptical of it though. Going back to the Wired article:</p>
<blockquote>
<p><b>Wired</b>: Taylor heard about not through you, but through Donald Davies originally?</p>
<p><b>Baran</b>: I have two different views on that. I didn’t pay much attention to it then, but with all the nonsense about it, I went back and started digging through the old records. I don’t believe anything unless I can find it in writing, in contemporaneous documentation. I had many, many discussions with the folks at Arpa, starting in the very early ’60s. The information about packet switching was not a surprise, not new. People can listen to things and put them in the back of their mind. So you don’t know. People say they’d never heard of me at the time, yet I’d chaired a session with them in it.</p>
</blockquote>
<p>Baran claims the ARPA people say they didn’t know about or were influenced by Baran’s work yet Baran finds that implausible. Vint Cerf responds to this via a personal email:</p>
<blockquote><p>
Roberts likely knew about Paul's report and had done a point-to-point experiment in 1966 (?) linking the TX-2 machine at Lincoln Labs to the ANS/Q-32 at System Development Corporation (Santa Monica spinout from RAND) using a packet-switching format.</p>
</blockquote>

<p>A pont-by-point, design decision by design decision analysis could be made and it might be possible to empirically favor a single narrative but that's out of scope here. Don't worry though, it actually falls within the scope of a planned article so I should get to it eventually.</p>
</section>
<section>
<h3>Final words</h3>
<p>There's earlier notable history to the Internet. Vannevar Bush's <a href="https://www.theatlantic.com/magazine/archive/1945/07/as-we-may-think/303881/">"As We May Think"</a> in July 1945 describes a mechanical microfilm archival machine he dubs the Memex. The IPTO of ARPA, JCR Licklider's April 1963, <a href="http://worrydream.com/refs/Licklider-IntergalacticNetwork.pdf">"Members and Affiliates of the Intergalactic Computer Network"</a>.
</p><p>There's also many other networks long forgotten. The best reference is in the April 1972 issue of Datamation which isn't digitized yet. However, I went to the archives at UCLA and painfully montaged some photocopies. David Farber, who was mentioned above, is the author. Pages <a href="https://siliconfolklore.com/internet-history/farber-datamation-0472-01.png">36, 37</a> and <a href="https://siliconfolklore.com/internet-history/farber-datamation-0472-02.png">38, 39</a>. No mention of Paul Baran or nuclear war this time in his description of ARPANET and we even got a shout out to Slotnick's ILLIAC IV which is also called out in the DARPA document, section 18-1.</p>
<p>Also any scholar reading this will be yelling at their computer screen right now because I seemed to have forgotten the French <a href="https://en.wikipedia.org/wiki/CYCLADES">CYCLADES</a> network. Disarm your keyboards, comrades, we're good.</p>
<p>Also, the Internet is not the ARPANET, as Quarterman pointed out in a few texts, this one from <cite><a href="https://archive.org/details/sim_computerworld_1993-02-22_27_7/page/n85/mode/2up">Computerworld, February 22, 1993</a></cite>:</p>
<blockquote><p>The Arpanet was merely one network within the Internet. Started in 1969, Arpanet was the first distributed packet-switched com- puter network. In 1977, the Arpanet became one of the Internet’s backbone networks, and the protocol research done on the Arpanet was very influential in the development of the TCP/IP currently used on the Internet. Arpanet’s technology became obsolete, however, and it was retired in 1990.</p></blockquote>
<p>For an exhaustive survey of 133 (yes, one hundred and thirty three) networks from 1990, refer to <a href="https://archive.org/details/directoryofelect00frey/mode/2up">"!%@:: a directory of electronic mail addressing and networks"</a> (yes, pages vi and vii were somehow included twice).
</p><h4 id="time-sharing">The Batch-Processing to Time-Sharing Revolution</h4>
<p>This was alluded to above. The Internet can be seen as part of a larger movement in computing away from single monolith installations doing something called "batch-processing" to a world of "time-sharing".</p>
<p>At one time there was a computing center with cubby holes. You’d place your program in a cubby hole and the machine operator would eventually feed it in, generate output, and you’d come back later to see the results.</p>
<p>There’s all kinds of problems with this. You aren’t actually touching the computer. Syntax errors would have the turnaround time of days to correct. You had to go, physically, to the machine.</p>
<p>The fix was time-sharing: the ability of the computer to multi-task. This meant multiple people could interact with one computer simultaneously.</p>
<p>In order to do that you needed multiple input terminals. It wasn’t long before people realized it’d be nice to be able to roll their terminal home with them and just call it in.</p>
<p>This led to remote terminals.</p>
<p>Then people realized they could call up any computer once it got a phone number if only they had some agreed way to talk to it. This is still 1960s.</p>
<p>So you had terminals talking to computers. Surely this will be followed up by computers talking to computers. That’s an obvious next step.</p>
  <p>ARPA even had a separate project, called project MAC, which along with having legends like <a href="https://en.wikipedia.org/wiki/Marvin_Minsky">Marvin Minsky</a> and <a href="https://en.wikipedia.org/wiki/John_McCarthy_(computer_scientist)">John McCarthy</a> made a time-sharing system called <a href="https://en.wikipedia.org/wiki/Compatible_Time-Sharing_System">CTSS</a>.
</p><p>The point is that Paul Baran wasn’t chartering a path through the wilderness. For instance, here's a <a href="https://ieeexplore.ieee.org/document/1088726">1963 text on "Communication Network … Subject to Random Failure (or Destruction)"</a>. Baran's work with hot-potato routing was a year later. Robust networked time-sharing and resource combination was the clear eventual trajectory. The obvious way to achieve this was to time-share the communication channel as well. That’s where you get packets and switching.</p>
<p>Or hey, there’s probably more to it. There always is.</p>
<figure>
<picture>
<source srcset="https://siliconfolklore.com/internet-history/web.avif" type="image/avif">
<img src="https://siliconfolklore.com/internet-history/web.png" alt="A black and white adventurous drawing of a woman with a keyboard strapped to her shoulder like a purse admiring an abstract frame surrounded by a cloud titled 'Internetland' which depicts E-mail, usenet, gopher and other internet technologies that were common in 1994" title="A black and white adventurous drawing of a woman with a keyboard strapped to her shoulder like a purse admiring an abstract frame surrounded by a cloud titled 'Internetland' which depicts E-mail, usenet, gopher and other internet technologies that were common in 1994">
</picture>
<figcaption><b id="img-8">Figure 8.</b> From <a href="https://archive.org/details/internetguidefor00dani/page/n33/mode/2up">The Internet Guide for New Users, 1994</a>. Artist is <a href="http://www.pyracantha.com/">Hannah MG Shapero</a>.</figcaption>
</figure>
</section>
<section>
<hr>
<h3>Notes</h3>
<h4>Timeline &amp; Thanks</h4>
<p>I'd like to thank the following for helping put this together: Barry Gerber, Cricket Liu, John Levine, John Quarterman, Matt Campbell, Paul Albitz, Paul Gilster, Sharon Fisher and Vint Cerf.</p>
<p id="all-emails">In the spirit of full disclosure, <a href="https://en.wikipedia.org/wiki/Mbox">here are all email correspondences</a> (with personal information removed) in <a href="https://en.wikipedia.org/wiki/Mbox">Berkeley mbox</a>. Some parts refer to older drafts of the article, <a href="https://github.com/kristopolous/sf">all of which are publicly available on github</a>.
</p><p>I was unable to find a way to reach Ed Krol or Bruce Sterling and David Farber has not responded.</p>
<p>Corrections and comments are welcome at <a href="mailto:info@siliconfolklore.com">info@siliconfolklore.com</a>. You can also <a href="https://github.com/kristopolous/sf">open up an issue on the github or even do a pull request</a>.</p>
<p>The nine colorful diagrams at the beginning forming the 3x3 motif are from the 1981 text, <a href="https://archive.org/details/Report4799AHistoryOfArpanetTheFirstDecade/page/n23/mode/2up">"A History Of ARPANet. The First Decade"</a>.</p>
<h4>Footnotes</h4>
<ol id="footnotes">
  <li id="jcr"><p>But not, perhaps, by ARPA IPTO (basically the CEO), JCR Licklider as John Quarterman points out in an email, linking to an excerpt from a 2017 book by <a href="https://en.wikipedia.org/wiki/Sharon_Weinberger">Sharon Weinberger</a>, <a href="https://aeon.co/essays/how-nuclear-fears-helped-inspire-creation-of-the-internet">"The Imagineers of War"</a> (not yet available in digital libraries, excerpt from Aeon.co included) where she quotes Licklider, "Who can direct a battle when he’s got to write a program in the middle of that battle?"</p></li>
  <li id="cerf"><p>Thanks to Vint Cerf for helping me on these sections.</p></li>
  <li id="prior"><p>This includes histories of the ARPANET "DARPANET" and “ARPA Network”. <a href="mailto:info@siliconfolklore.com?subject=Before+1991">Please reach out if you know of any</a> and I'll be happy to update.</p></li>
  <li id="sharon"><p>I had a brief chat with Sharon over Facebook. She also wrote a 1993 text, <a href="https://archive.org/details/ridinginternethi00fish/page/12/mode/2up">"Riding the Internet Highway"</a> which contained a similar origin narrative. In our conversation she recommended a <a href="https://vintageapple.org/byte/pdf/199107_Byte_Magazine_Vol_16-07_DOS_5.0.pdf">July 1991 Byte</a> (PDF) article she wrote. It starts on PDF page 209 and cites Quarterman's Matrix as she does in the InfoWorld article work for his 1986 work, <a href="https://dl.acm.org/doi/abs/10.1145/6617.6618">"Notable Computer Networks"</a>.</p>
  </li><li id="first"><p>Calling something "first" is so risky. Let me clarify. First as far as ProQuest, archive.org and Google books is concerned. Have an earlier one? <a href="mailto:info@siliconfolklore.com?subject=Earlier+Reference">Please send it over</a>.</p></li>
  <li id="time-date"><p>This article has been misdated on Times website. It can also be found at <tt>/time/072594/07259925.000</tt> in the <a href="https://archive.org/details/cd_TIME_Magazine_Almanac_-_All_TIME_Magazine_articles_1989-1995_Win3.1">TIME Magazine Almanac CD-ROM from 1995</a> to confirm the 1994 date.</p></li>
  <li id="infoworld"><p>Quarterman's Matrix is included in Fisher's bibliography and her description mirrors the one from The Matrix. Going over the names referenced there's three without Wikipedia pages: David Wasley, David Buerger, John Rugo and <a href="https://en.wikipedia.org/wiki/Robert_Metcalfe">Bob Metcalfe</a> who wasn't used in the history section and is just as much a Peer as an ARPA for our imagined framework. No models are perfect.</p></li>
  <li id="krol"><p>I was unable to determine a source for Krol here. He mentions Quarterman's Matrix but that does not have the (P) bomb narrative. Krol has earlier work such as <a href="https://www.rfc-editor.org/rfc/rfc1118.html">"The Hitchhikers Guide to the Internet"</a> but nothing I could find had an origin story. He references Douglas Comer's "Internetworking TCP/IP" which is a 3-volume set also without an origin story. Comer's work references Cerf's "The History of the ARPANET" but Cerf is (A) while Krol is a (P) narrative. Also mentioned is Craig Hunt's <a href="https://archive.org/details/tcpipnetworkadmi00hunt/page/n25/mode/2up">"TCP/IP network administration"</a> which has an origin story but it's (A) style.</p>
<p>An additional reference later in the work is <a href="https://archive.org/details/computersecurity00russ/page/210/mode/2up">"Computer Security Basics"</a> which references ARPANET but has no origin story. Another reference <a href="https://archive.org/details/practicalunixsec00garf_0/page/6/mode/2up">"Practical UNIX Security"</a> only historical reference is a brief description of Project MAC without referring to it by name.</p>
<p>The section from his book photographed above even gets published as <a href="https://www.rfc-editor.org/rfc/rfc1462">RFC 1462</a> and here is where we find our first potential (P) link. The other author here, <a href="https://dblp.org/pid/86/5409.html">Ellen S Hoffman</a> is from the alternative <a href="https://en.wikipedia.org/wiki/Merit_Network">Merit Network</a> which is older than the ARPANET. It plays a very important role in the history of the Internet which is outside our scope.</p>
<p>Also the author page of a later work from 1995, <a href="https://archive.org/details/wholeinternetfor00krol/page/n649/mode/2up">"The Whole Internet for Windows 95"</a> claims Krol was part of the original NSFnet installation at UIUC which was part of Merit and arguably puts him in the (P) group.</p>
<p>These two (P) links might negate the (A) links and his direct participation does fall under the definition (albeit 15 years later so maybe not). Unless I can find a way to contact Krol, I'll have to leave that question mark there.
  </p></li><li id="dns-note"><p>There's two authors listed, Paul Albitz and Cricket Liu. At first I believed the author of the passage was most likely Paul Albitz because it was repeated in <a href="https://archive.org/details/dnsonwindowsnt00albi/page/n17/mode/2up">"DNS on Windows NT"</a> in 1998 and cannot be found in other work by Cricket Liu such as <a href="https://archive.org/details/dnsbindcookbook0000liuc/mode/2up">"DNS and BIND Cookbook"</a> in 2003 or <a href="https://archive.org/details/managinginternet00jerr/mode/2up">"Managing Internet Information Services"</a> from 1994.</p>
  <p>However, after effort was made to reach out to him via LinkedIn to inquire about the source, he claimed that Cricket Liu wrote that chapter. After reaching out to Liu and a few back and forth emails, his final statement is "I no longer have notes on this.  I’m sorry I couldn’t find anything". </p>
  <p>The text is not robust enough in references to lead to a factional claim, citing a few RFCs. For acknowledgments we get Ken Stone, <a href="https://www.linkedin.com/in/jerry-mccollom-a552316">Jerry McCollom</a>† (HP), <a href="https://www.linkedin.com/in/peterjeffe/">Peter Jeffe</a>† (IBM), Christopher Durham, Hal Stern, Bill Wisner, Dave Curry and Jeff Okamoto. All dead-ends. Paul Albitz credits his spouse, Katherine Albitz, who is also an engineer but without any obvious ARPA or Peer connection. Further searches in google groups, proquest, and archive.org found only references to the aforementioned texts and no other works. This makes it N<sub>o</sub> unless further documentation comes forth.</p></li>
  <li id="sterling"><p>Sterling doesn't directly quote anyone in his February 1993 story however, in his November 1992 text, <cite><a href="https://www.mit.edu/hacker/hacker.html">"The Hacker Crackdown: Law and Disorder on the Electronic Frontier"</a></cite> he talks about a <a href="https://www.mit.edu/hacker/part4.html">1991 CPSR roundtable</a> mentioning two Peers:</p>
    <blockquote><p>Sixty people attended, myself included -- in this instance, not so much as a journalist as a cyberpunk author. Many of the luminaries of the field took part: <a href="https://en.wikipedia.org/wiki/Mitch_Kapor">Kapor</a> and <a href="https://en.wikipedia.org/wiki/Mike_Godwin">Godwin</a> as a matter of course. Richard Civille and <a href="https://en.wikipedia.org/wiki/Marc_Rotenberg">Marc Rotenberg</a> of CPSR. Jerry Berman of the ACLU. <b>John Quarterman</b>, author of The Matrix. <a href="https://en.wikipedia.org/wiki/Steven_Levy">Steven Levy</a>, author of Hackers. George Perry and Sandy Weiss of Prodigy Services, there to network about the civil-liberties troubles their young commercial network was experiencing. <a href="https://en.wikipedia.org/wiki/Dorothy_E._Denning">Dr. Dorothy Denning</a>. Cliff Figallo, manager of the Well. <a href="https://en.wikipedia.org/wiki/Steve_Jackson_(American_game_designer)">Steve Jackson</a> was there, having finally found his ideal target audience, and so was <a href="https://en.wikipedia.org/wiki/Craig_Neidorf">Craig Neidorf</a>, "Knight Lightning" himself, with his attorney, Sheldon Zenner. <a href="https://en.wikipedia.org/wiki/Katie_Hafner">Katie Hafner</a>, science journalist, and co-author of Cyberpunk: Outlaws and Hackers on the Computer Frontier. <b>Dave Farber</b>, ARPAnet pioneer and fabled Internet guru. <a href="https://its.law.nyu.edu/facultyprofiles/index.cfm?fuseaction=profile.overview&amp;personid=43007">Janlori Goldman</a> of the ACLU's Project on Privacy and Technology. John Nagle of Autodesk and the Well. Don Goldberg of the House Judiciary Committee. Tom Guidoboni, the defense attorney in the Internet Worm case. <a href="https://en.wikipedia.org/wiki/Lance_Hoffman">Lance Hoffman</a>, computer-science professor at The George Washington University. Eli Noam of Columbia. And a host of others no less distinguished.</p></blockquote>
  <p>I've failed to find a way to contact Sterling to further elaborate.</p>
  </li>
  <li id="time"><p> Time names the following in the article: <a href="https://en.wikipedia.org/wiki/Laurence_Canter_and_Martha_Siegel">Laurence Canter, Martha Siegel</a>, <a href="https://en.wikipedia.org/wiki/Howard_Rheingold">Howard Rheingold</a>, <a href="https://en.wikipedia.org/wiki/Clifford_Stoll">Clifford Stoll</a> (quoted for article, author of The Cuckoo's Egg), Steven Levy, <a href="https://en.wikipedia.org/wiki/Thomas_Kalil">Tom Kalil</a>, <a href="https://en.wikipedia.org/wiki/Bruce_Fancher">Bruce Fancher</a> (quoted), <a href="https://en.wikipedia.org/wiki/A._J._Liebling">AJ Liebling</a>, <a href="https://en.wikipedia.org/wiki/Adam_Curry">Adam Curry</a>, <a href="https://en.wikipedia.org/wiki/Brad_Templeton"><b>Brad Templeton</b></a>, <a href="https://en.wikipedia.org/wiki/Brock_Meeks">Brock Meeks</a> (quoted), <a href="https://en.wikipedia.org/wiki/Martin_Nisenholtz">Martin Nisenholtz</a> (quoted), <a href="https://en.wikipedia.org/wiki/Dale_Dougherty">Dale Dougherty</a> (quoted), <b>Dave Farber</b>, <a href="https://en.wikipedia.org/wiki/Esther_Dyson">Esther Dyson</a> (quoted) and <a href="https://en.wikipedia.org/wiki/Stacy_Horn">Stacy Horn</a> (quoted). 
  </p></li><li id="pbs"><p> The documentary has a date of 1994 but an air date of 08/1995. Everything takes more than zero time to produce so we're using "release date" for the timestamping.</p>
  <p>This is a co-production of Rice University and there's a few names I've contacted: John Levine, <a href="https://en.wikipedia.org/wiki/Gina_Smith_(author)">Gina Smith</a> (the hosts), <a href="https://www.wattsrunning.com/">Bill Watts</a> (who gets a writer credit), <a href="https://www.uh.edu/nsm/computer-science/people/faculty/">Kevin Brook Long</a> (credited as "Internet Consultant"). <a href="https://en.wikipedia.org/wiki/G._Anthony_Gorry">G. Anthony Gorry</a> (Special Thanks section, Computer Science Professor at Rice University) <a href="https://yale62.org/george-anthony-gorry-jr/">died in 2018</a>. <a href="https://siliconfolklore.com/internet-history/levine-email.txt">John Levine responded</a> giving it an "Other/Nobody" or "common knowledge" mark.</p></li>
  <li id="pbs-text">The 96-word transcript of the narrative is as follows:
<blockquote>
<p>
<b>Gina Smith</b>: The predecessor of the Internet was a child of the Cold War first developed by the Defense Department's Advanced Research Projects Agency or ARPA partly to ensure the data communications could survive in case of a nuclear attack.
</p><p>
<b>John Levine</b>: Created in the late 1960s, ARPANET first connected four computers in California and Utah campuses using a new networking technique. It allowed researchers to run programs on remote computers. Later other research institutions and military sites were added. The idea was even if one part of the system were damaged, the rest would still function and it worked.</p>
</blockquote></li>
    <li id="gore"><p>As Senator and eventual Vice Presidential candidate, Al Gore not only popularized the term "Information Superhighway" but also spearheaded legislation like the <a href="https://en.wikipedia.org/wiki/High_Performance_Computing_Act_of_1991">High Performance Computing Act of 1991</a> which funded the development of the Mosaic Browser.</p>
      <p>The US Presidential campaign cycle of 1992 was arguably the first time (excluding the <a href="https://en.wikipedia.org/wiki/Morris_worm">1988/89 Morris worm</a>) that significant effort was made to explain the concept of the Internet and (in 1993 after assuming office) demonstrate it to general audiences.  See the 24:06 mark of the <a href="https://youtu.be/BIq_mW-nSnQ?t=1446">1992 Stockdale Vice Presidential Debate</a> and <a href="https://www.nytimes.com/1992/11/10/science/clinton-to-promote-high-technology-with-gore-in-charge.html">"Clinton to Promote High Technology, With Gore in Charge"</a> from the November 10, 1992 New York Times as examples.</p>
      </li>
</ol>
<p><a name="unconfirmed"><b>†</b></a> Efforts were made to confirm these links are accurate but there has not been any response.</p>
</section>
<section>
<h4 id="backhoe">Backhoe Section</h4>
<p>Here's John Levine's <a href="https://siliconfolklore.com/internet-history/levine-email-backhoe.txt">response to my claim</a> of the Krol source:</p>
<blockquote>
<p>The research is impressive but sometimes you just guessed wrong.</p>
<p>For example, the reference in Internet for Dummies about backhoe attacks didn't come from Krol's book.  It was and is a cliche in the telecom world (memes hadn't been invented yet) and we both used it independently. </p>
</blockquote>
<p>As a practice and a discipline, a source's claim takes precedence over any interpretation and should be disclosed. However, every subsequent claim needs to be subject to the same rigor and scrutiny and as of now, the phrasing similarity is just too close for me to claim they are disconnected. Additionally, there is no source that I could find that had such similarity prior to Krol. Of course it may not yet be digitized.</p>
<p>The origin of the backhoe seems to be a now obscure December 12, 1986 White Plains ARPAnet Northeast disconnect incident when 7 fiber optic cables going through the same conduit were cut. This has its own narrative history. All New England trunk lines were cut at 1:11 AM and were knocked off until about 12:11.</p>
<p>As far as I can tell, a backhoe started to be associated with this 1AM disconnect around 1988 and later was commonly claimed to be accidental. I was unable to find any criminal investigation, admittance of guilt, or direct evidence as to how the conduit was cut. Being an obscure event, a trip to archival rooms in New York libraries would probably be required to find out more information. Alternatively, it's possible that AT&amp;T, which restored the line, could have a report somewhere.</p>
<p>I will happily annotate the section as false if more instances of backhoes or related narratives comes forward as removing it could lead to Mandela effects and further folklore.</p>
</section>
<section>
<h4 id="survey-method">Survey Methodology</h4>
<p>Search queries were performed on archive.org text search, Google books, Google groups and ProQuest Central with the access covered by the LA public library card between February 18 2022 and March 6 2022.</p>
<p>Terms searched were "arpanet", "arpa network", "darpanet", "internet 1969", "internet history", "internet started", "internet atomic", "internet bomb", "internet nuclear", and "internet war"</p>
  <li><a href="https://archive.org/details/tcpiparchitectur00feit/page/4/mode/2up">Feit, Sidnie. "TCP/IP: Architecture, Protocols, and Implementation", 1993</a>: Description too short. (Scientific Research)</li>
  <li><a href="https://archive.org/details/sim_newsweek_1993-09-06_122_10/page/36/mode/2up">Newsweek, Sep 9, 1993</a>: Description too short. (Collaboration by design)</li>
  <li><a href="https://www-proquest-com.ezproxy.lapl.org/central/docview/294801007/F9B76FC7236D4899PQ/9">(Proquest) Hyatt, Josh. "Network difficulties Computer world's Internet sees clash of cultures", Boston Globe, Sep 15 1993</a>: Description too short (Collaboration by design)</li>
  <li><a href="https://archive.org/details/zenartofinternet00keho/mode/2up">Kehoe, Brendan P. "Zen and The Art of The Internet: A Beginner's Guide", 1994</a>: Frequently referenced, no origin story.</li>
  <li><a href="https://www.proquest.com/central/docview/307909591/CDE810A37ADD4A38PQ/90">(Proquest) Swisher, Kara. "The Frenzy Over the Internet's Fee Enterprise", The Washington Post, Oct 16, 1995</a>: Description too short. ("Since the Internet's founding in 1969 to aid government communications in wartime")</li>
    
<h5><b>You made it to the end. Epic.</b><br>I guess you could also <a href="https://twitter.com/emoRobot">follow me on twitter</a>, ok sure.</h5>
</section>
<section>
<p id="print-links">
<h2>Links</h2>
</p>
</section>

</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[OpenSSL bug exposed up to 255 bytes of server heap and existed since 2011 (129 pts)]]></title>
            <link>https://jbp.io/2024/06/27/cve-2024-5535-openssl-memory-safety.html</link>
            <guid>41108465</guid>
            <pubDate>Tue, 30 Jul 2024 12:29:27 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://jbp.io/2024/06/27/cve-2024-5535-openssl-memory-safety.html">https://jbp.io/2024/06/27/cve-2024-5535-openssl-memory-safety.html</a>, See on <a href="https://news.ycombinator.com/item?id=41108465">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="post">
  <p>
    27 June 2024 
    
  </p>
  <h2>CVE-2024-5535: `SSL_select_next_proto` buffer overread
  <span>celebrating a decade of publishing your heap over the internet</span>
  </h2>
  <p>Since 2011, a bug has existed in OpenSSL that means innocuous code like:</p>

<div><pre><code><span>require</span><span>(</span><span>'</span><span>tls</span><span>'</span><span>).</span><span>connect</span><span>({</span><span>port</span><span>:</span> <span>443</span><span>,</span> <span>NPNProtocols</span><span>:</span> <span>new</span> <span>Uint8Array</span><span>()},</span> <span>function</span><span>(</span><span>c</span><span>)</span> <span>{})</span>
</code></pre></div>

<p>or (equivalently, in Python):</p>

<div><pre><code><span>import</span> <span>ssl</span><span>,</span> <span>socket</span>
<span>assert</span> <span>ssl</span><span>.</span><span>HAS_NPN</span>

<span>ctx</span> <span>=</span> <span>ssl</span><span>.</span><span>create_default_context</span><span>()</span>
<span>ctx</span><span>.</span><span>set_npn_protocols</span><span>([])</span>
<span>ctx</span><span>.</span><span>load_verify_locations</span><span>(</span><span>'root.crt'</span><span>)</span>
<span>sock</span> <span>=</span> <span>socket</span><span>.</span><span>create_connection</span><span>((</span><span>'127.0.0.1'</span><span>,</span> <span>443</span><span>))</span>
<span>sock</span> <span>=</span> <span>ctx</span><span>.</span><span>wrap_socket</span><span>(</span><span>sock</span><span>,</span> <span>server_hostname</span><span>=</span><span>'localhost'</span><span>)</span>
<span>sock</span><span>.</span><span>write</span><span>(</span><span>'hello'</span><span>)</span>
</code></pre></div>

<p><strong>Silently sends up to 255 bytes of the client’s heap to the server</strong>.  The server
must support <a href="https://datatracker.ietf.org/doc/html/draft-agl-tls-nextprotoneg-04">NPN</a>, and the heap data is encrypted in transit.</p>

<p>This is confirmed to affect Python &lt;= 3.9 and Node &lt;= 9.  It may equally
affect any program that calls <code>SSL_select_next_proto</code> with a <code>client</code>
buffer that is not a valid list of protocols (this includes an empty buffer).</p>

<p>Meeting those constraints is quite unlikely nowadays:</p>

<ul>
  <li>NPN is a precursor to ALPN and was abandoned in 2012.  It is very uncommon on internet servers now.</li>
  <li>Node.js 10 and later removed NPN support, and is well past end-of-life.</li>
  <li>Python 3.10 and later removed NPN support.</li>
</ul>

<p>However, they <em>were</em> much more common in the lifetime of this bug.  <strong>You should review your historic usage</strong>
of <code>SSL_select_next_proto</code> and if you could have ever triggered this bug, I would suggest rolling any
secrets available to affected programs.</p>

<p>Android was affected <a href="https://android.googlesource.com/platform/libcore/+/9c5e545bc78132ee8d27fd77ccaea6d3a6090ac0%5E%21/">up until 2014</a>, with the heap leak behaviour
observed <a href="https://github.com/square/okhttp/issues/437#issuecomment-35860090">independently by an okhttp developer</a>.</p>

<h2 id="affected-versions">Affected versions</h2>

<ul>
  <li>All versions of OpenSSL 1.0.x, 1.1.x, 3.x.</li>
  <li>BoringSSL was also affected, and <a href="https://boringssl.googlesource.com/boringssl/+/c1d9ac02514a138129872a036e3f8a1074dcb8bd">have already landed their fix</a>.</li>
  <li>LibreSSL retains the faulty <code>SSL_select_next_proto</code>, however NPN support was removed in 2017
so is not meaningfully broken.</li>
</ul>

<h2 id="timeline">Timeline</h2>

<ul>
  <li><strong>2011-11-13</strong> - Bug introduced.</li>
  <li><strong>2014-04-10</strong> - Work-around for bug added to Android after discovery by okhttp developer.</li>
  <li><strong>2024-04-23</strong> - Discovery of <code>SSL_select_next_proto</code> memory unsafety while <a href="https://github.com/rustls/rustls-openssl-compat/tree/main/rustls-libssl">rewriting it in rust</a>.</li>
  <li><strong>2024-05-02</strong> - Discovery that Python 3.9 was practically affected</li>
  <li><strong>2024-05-02</strong> - Report to OpenSSL project</li>
  <li><strong>2024-05-08</strong> - Chase-up</li>
  <li><strong>2024-05-08</strong> - Acknowledgement from OpenSSL project</li>
  <li><strong>2024-05-22</strong> - Report to BoringSSL</li>
  <li><strong>2024-05-23</strong> - Discovery that Node.js 9 was practically affected</li>
  <li><strong>2024-05-30</strong> - Assigned CVE-2024-5535 and assessed as “Low” severity</li>
  <li><strong>2024-05-31</strong> - Reported to security@python.org by David Benjamin</li>
  <li><strong>2024-06-04</strong> - Python security confirm “Low” severity</li>
  <li><strong>2024-06-25</strong> - In preparing this blog post, discovery that Android was affected until 2014.</li>
  <li><strong>2024-06-27</strong> - <a href="https://www.openssl.org/news/secadv/20240627.txt">Advisory</a> released.</li>
</ul>

<h2 id="conclusions">Conclusions</h2>

<ul>
  <li>
    <p>The various audits, code reviews, static analysis, dynamic analysis, fuzzing,
and popularity were not sufficient to remedy this bug earlier.</p>

    <p>Though valgrind immediately points it out once triggered, and a really basic
static pointer bounds analysis should also find it (though likely with a huge
false-positive rate in other code.)</p>
  </li>
  <li>
    <p>The known exposures to this bug (Python, Node, Android) are probably not all
of them, but most likely will be historic.</p>
  </li>
</ul>

<h2 id="acknowledgements">Acknowledgements</h2>

<ul>
  <li>This discovery was made in the course of building <a href="https://github.com/rustls/rustls-openssl-compat/tree/main/rustls-libssl">rustls-libssl</a>: this work
was funded by <a href="https://www.memorysafety.org/">ISRG Prossimo</a>.</li>
  <li>Thanks to <a href="https://github.com/cpu">Daniel McCarney</a> for pointing out the divergence in our <code>SSL_select_next_proto</code>.</li>
  <li>Thanks to Rich Salz @ Akamai for advice on communications with the OpenSSL project.</li>
  <li>Thanks to David Benjamin @ Google for advice and analysis, and taking care of the report to Python.</li>
</ul>

<h2 id="report">Report<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" rel="footnote">1</a></sup></h2>

<p><code>SSL_select_next_proto</code> called with <code>client_len == 0</code> unconditionally reads
<code>client[0]</code> and returns the pointer <code>client + 1</code>.  Thereafter, <code>*out</code> points
outside a valid address, and <code>*outlen</code> contains an undefined value.</p>

<p>Minimal reproducer:</p>

<div><pre><code><span>#include</span> <span>&lt;openssl/ssl.h&gt;</span><span>
#include</span> <span>&lt;stdint.h&gt;</span><span>
#include</span> <span>&lt;stdio.h&gt;</span><span>
</span>
<span>int</span> <span>main</span><span>()</span> <span>{</span>
  <span>uint8_t</span> <span>client_input</span><span>[]</span> <span>=</span> <span>{};</span>
  <span>uint8_t</span> <span>*</span><span>output</span> <span>=</span> <span>NULL</span><span>;</span>
  <span>uint8_t</span> <span>output_len</span> <span>=</span> <span>0</span><span>;</span>
  <span>const</span> <span>uint8_t</span> <span>server_input</span><span>[]</span> <span>=</span> <span>{</span><span>2</span><span>,</span> <span>'h'</span><span>,</span> <span>'2'</span><span>};</span>

  <span>int</span> <span>ret</span> <span>=</span> <span>SSL_select_next_proto</span><span>(</span><span>&amp;</span><span>output</span><span>,</span> <span>&amp;</span><span>output_len</span><span>,</span> <span>server_input</span><span>,</span>
                                  <span>sizeof</span><span>(</span><span>server_input</span><span>),</span> <span>client_input</span><span>,</span> <span>0</span><span>);</span>
  <span>printf</span><span>(</span><span>"ret = %d</span><span>\n</span><span>"</span><span>,</span> <span>ret</span><span>);</span>
  <span>printf</span><span>(</span><span>"output = %p</span><span>\n</span><span>"</span><span>,</span> <span>output</span><span>);</span>
  <span>printf</span><span>(</span><span>"output_len = %u</span><span>\n</span><span>"</span><span>,</span> <span>(</span><span>unsigned</span><span>)</span><span>output_len</span><span>);</span>
  <span>return</span> <span>0</span><span>;</span>
<span>}</span>
</code></pre></div>

<h2 id="impact">Impact</h2>

<p><code>SSL_select_next_proto</code> is a normal API function so the parameters passed
to it are ultimately up to the application.  However it is almost always used inside
an ALPN or NPN callback:</p>

<p>If <code>SSL_select_next_proto</code> is used straightforwardly in a server’s ALPN callback,
there is no impact because other code in openssl validates the client’s extension as being
non-empty.</p>

<p>If <code>SSL_select_next_proto</code> is used straightforwardly in a client’s NPN callback,
the client data and its length is typically a matter of local configuration and
not under openssl’s control.  Most importantly, the impact of the wrong length and
pointer being returned from this function is a catastrophic memory safety failure:
the memory is copied, placed into the <code>selected_protocol</code> field of the
<code>NextProtocolNegotiationEncryptedExtension</code> and sent to the peer!</p>

<p>As a realistic demonstration, in python3.9<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" rel="footnote">2</a></sup> the following code sees OpenSSL
send a chunk of heap to the server:</p>

<div><pre><code><span>import</span> <span>ssl</span><span>,</span> <span>socket</span>
<span>assert</span> <span>ssl</span><span>.</span><span>HAS_NPN</span>

<span>ctx</span> <span>=</span> <span>ssl</span><span>.</span><span>create_default_context</span><span>()</span>
<span>ctx</span><span>.</span><span>set_npn_protocols</span><span>([])</span>
<span>ctx</span><span>.</span><span>load_verify_locations</span><span>(</span><span>'root.crt'</span><span>)</span>

<span>sock</span> <span>=</span> <span>socket</span><span>.</span><span>create_connection</span><span>((</span><span>'127.0.0.1'</span><span>,</span> <span>443</span><span>))</span>
<span>sock</span> <span>=</span> <span>ctx</span><span>.</span><span>wrap_socket</span><span>(</span><span>sock</span><span>,</span> <span>server_hostname</span><span>=</span><span>'localhost'</span><span>)</span>
<span>sock</span><span>.</span><span>write</span><span>(</span><span>'hello'</span><span>)</span>
</code></pre></div>

<p>The peer receives (for example):</p>

<div><pre><code>NextProtocolNegotiationEncryptedExtension {
  selected_protocol: c2d60ba35f00000000000000000000000000000000000031000000000000000
                     00000000000000060f3030d5e7f0000e0f5b9f1a65f00002006aaf1a65f0000
                     d04b0f0d5e7f0000210000000000000000f6b9f1a65f000030f6b9f1a65f000
                     0d0ebb9f1a65f00003100000000000000,
  padding: 000000000000000000000000000000,
}
</code></pre></div>


</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[FTC Wins Round Two in Its Non-Compete Ban Defense (139 pts)]]></title>
            <link>https://www.jdsupra.com/legalnews/ftc-wins-round-two-in-its-non-compete-4112148/</link>
            <guid>41107845</guid>
            <pubDate>Tue, 30 Jul 2024 10:56:10 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.jdsupra.com/legalnews/ftc-wins-round-two-in-its-non-compete-4112148/">https://www.jdsupra.com/legalnews/ftc-wins-round-two-in-its-non-compete-4112148/</a>, See on <a href="https://news.ycombinator.com/item?id=41107845">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="HTMLContentViewPanel">

<p>The Federal Trade Commission (FTC) is seeking to ban nearly all employee non-compete agreements in the United States [see <a href="https://www.mccarter.com/insights/yes-the-ftc-did-just-try-to-ban-non-compete-agreements-for-now/">April 25, 2024 Alert</a>]. Almost immediately after the FTC issued its final rule, lawsuits challenging that attempt were filed in several courts around the country. On July 3, 2024, the first court ruling in those lawsuits held, on a preliminary basis, that the FTC likely did not have the authority to issue such a sweeping rule [see <a href="https://www.mccarter.com/insights/the-ftcs-non-compete-ban-has-suffered-its-first-setback/">July 10, 2024 Alert</a>]. The United States District Court for the Northern District of Texas held that the FTC’s enabling statute did not authorize it to issue substantive rules to prevent “unfair methods of competition” but rather only allowed the FTC to make substantive rules about “unfair or deceptive acts or practices.” Because the FTC declared that non-competes fell into the former category rather than the latter, the Texas Court determined, the FTC lacked the authority to issue the regulation.</p>

<p>Less than three weeks later, however, another federal court held, again on a preliminary basis, that the FTC likely <strong>did</strong> have the authority to ban all employee non-compete agreements. The United States District Court for the Eastern District of Pennsylvania considered a preliminary injunction motion brought by a tree care company with a dozen employees, each of whom had signed a non-compete agreement. The Court denied the employer’s request for a preliminary injunction on two grounds. First, the Court held that the company had not demonstrated irreparable harm in the absence of a preliminary injunction. Second, and more interesting for purposes of discerning whether the ban will ever actually go into effect, the Court held that the FTC did indeed have the power under its statute to issue substantive rules regarding unfair methods of competition.</p>

<p>As the Pennsylvania Court explained, the core issue was “whether the FTC, under Sections 5 and 6 of the [Federal Trade Commission] Act, has the authority to promulgate substantive regulations like the [Non-Compete ban], or whether the FTC’s enforcement authority is limited to adjudication and strictly procedural rulemaking related to the adjudication process.” The Court began by noting that the FTC Act gave the FTC the power “to make rules and regulations for the purpose of carrying out the provisions of this subchapter,” 15 U.S.C. § 46(g). The Court observed that the statute did not distinguish between “procedural” and “substantive” regulations, and in fact mentioned neither term. The Pennsylvania Court stated that the plaintiff’s proposed interpretation of the FTC Act–the one that had been adopted three weeks earlier in the Texas case–“runs contrary to logic.” Further, the Pennsylvania Court determined that giving the FTC the power to “prevent” unfair methods of competition implies the power to issue substantive regulations in the area. Finally, the Pennsylvania Court declined to infer from the statute’s specific grant of authority to the FTC to issue rules for “unfair or deceptive acts” any limit to its ability to issue regulations related to “unfair methods of competition,” in large part because that section of the statute provides that it “shall not affect any authority of the<a href="https://www.law.cornell.edu/definitions/uscode.php?width=840&amp;height=800&amp;iframe=true&amp;def_id=15-USC-1283237621-1323160499&amp;term_occur=999&amp;term_src="> Commission </a>to prescribe rules (including interpretive rules), and general statements of policy, with respect to unfair methods of competition in or affecting commerce.”</p>

<p>So to switch from the boxing metaphor of our title to a baseball metaphor, after two innings the score is tied 1-1 with plenty of opportunities for both sides left in the game. We expect another preliminary ruling from a federal court in Florida soon, and the Texas Court has indicated that it will rule on the request for a final injunction by the end of August. Then, of course, the appeals will commence. Ultimately, it seems likely that the US Supreme Court will weigh in on the matter unless the political process stops the rule before it gets the chance. We expect several developments on this issue before the September 4, 2024, effective date of the non-compete rule, so stay tuned.</p>

<p>As we noted in our discussion of the Texas decision, the consequences of non-compliance with the FTC non-compete rule appear to be limited. The FTC has authority to seek civil penalties of up to $10,000 per violation in response to violations of its rules concerning <em>unfair or deceptive acts or practices, but not with regard to unfair methods of competition</em>. The non-compete rule is expressly based on the FTC’s finding that non-competes are an <em>unfair method of competition</em>. That (likely) means that even if the non-compete rule goes into effect, the FTC would not be able to impose civil penalties against an employer unless and until it first issues an administrative complaint, holds a hearing, issues a cease and desist order, and that order becomes final (meaning that the time to appeal expired or that all appeals have been exhausted). At that time, if the employer violated the final cease and desist order, the FTC could then file a lawsuit asking a court to award it civil penalties. Employers with non-compete agreements should discuss these issues with their attorneys in order to make the best decisions possible in this dynamic environment.</p>

<p>[<a href="https://www.mccarter.com/insights/ftc-wins-round-two-in-its-non-compete-ban-defense/" target="_blank">View source</a>.]</p>

</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[How to burn US$10M on an ArXiv preprint (264 pts)]]></title>
            <link>https://152334H.github.io/blog/scaling-exponents/</link>
            <guid>41107721</guid>
            <pubDate>Tue, 30 Jul 2024 10:26:55 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://152334H.github.io/blog/scaling-exponents/">https://152334H.github.io/blog/scaling-exponents/</a>, See on <a href="https://news.ycombinator.com/item?id=41107721">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="content"><p>Recently, GDM released a great paper titled, <a href="https://arxiv.org/pdf/2407.05872" target="_blank" rel="noopener noreffer"><em>Scaling Exponents Across Parameterizations and Optimizers</em></a>, in which they conduct over 10,000 LLM training runs to obtain optimal hyperparameters under different regimes.</p><p>After reading it (it was great), I wanted to test my understanding of the paper by tallying up all experiments conducted within, calculating <strong>the total compute cost it would take to replicate the paper</strong>.</p><h2 id="headline-result">Headline result</h2><table><thead><tr><th>Subset</th><th>Sources of uncertainty</th><th>FLOPs</th><th>Costs @ $3/H100/hr</th></tr></thead><tbody><tr><td>Alignment</td><td>N/A</td><td>3.7e20</td><td>$888</td></tr><tr><td>LR variants (+default)</td><td>LR-sweeps, bayes search</td><td>7.99e23</td><td>$1.90M</td></tr><tr><td>LR variants (+optimal)</td><td>LR-sweeps</td><td>1.35e24</td><td>$3.22M</td></tr><tr><td>Epslion (Heatmaps)</td><td>LR-sweeps, $D$</td><td>1.34e24</td><td>$3.19M</td></tr><tr><td>Epslion (Full Sweeps)</td><td>LR-sweeps</td><td>7.99e23</td><td>$1.90M</td></tr><tr><td>Weight Decay</td><td>LR-sweeps</td><td>1.33e23</td><td>$317K</td></tr><tr><td>Adafactor vs Adam+PS</td><td>LR-sweeps, $D$</td><td>7.92e22</td><td>$188.5K</td></tr><tr><td>Compute Optimals</td><td>LR-sweeps, $D$</td><td>7.52e23</td><td>$1.79M</td></tr><tr><td></td><td></td><td></td><td></td></tr><tr><td><strong>Total</strong></td><td>too much</td><td><strong>5.42e24</strong></td><td><strong>$12.9M</strong></td></tr></tbody></table><p><strong>Any corrections on the numbers here will be appreciated.</strong></p><p>Although I have made significant efforts to vet these claims, <em>if I have made significant mistakes in mathematics, these results could be off by magnitudes.</em></p><div><p>Sidenote: What's an H100 worth?</p><div><p>Although it’s never stated, all experiments in the paper were almost certainly conducted with TPUs (because it’s from Google Deepmind). Furthermore, as there is no mention of int8 usage in their paper, it is most likely that all experiments were conducted with bfloat16 compute precision, per the <a href="https://github.com/google-deepmind/nanodo/blob/10aefdeed40a63293daf112b91a5538cd24fa3a4/nanodo/configs/default.py#L41" target="_blank" rel="noopener noreffer">nanodo default</a>.</p><p>However, as a GPU user, I prefer to calculate compute in terms of H100 hours. Some basic facts:</p><ul><li>The H100-SXM is <a href="https://resources.nvidia.com/en-us-tensor-core/nvidia-tensor-core-gpu-datasheet" target="_blank" rel="noopener noreffer">reported</a> as having 989.40TFLOP/s of 16-bit tensor core operations.<ul><li>Also, 66.9TFLOP/s fp32 non-tensor, but I won’t consider non-tensor operations (such as softmax or hadamard products) in my analysis.</li></ul></li><li>Recent pytorch <a href="https://pytorch.org/blog/maximizing-training/" target="_blank" rel="noopener noreffer">blogs</a> and <a href="https://github.com/pytorch/torchtitan/pull/165" target="_blank" rel="noopener noreffer">torchtitan</a> both report single-node FSDP’d bf16 H100 MFU for reasonably mid sized models at (optimistically) 40%.<ul><li>the smaller models ($D&lt;1024$) in the paper are unlikely to have MFU that high.</li><li>Although this is not hard to push higher with some manual tuning, the time spent tuning performance &amp; engineering required to heuristically adjust for efficiency depending on setting is unlikely to be worth it.</li></ul></li><li>The cost of a H100 node (at the time of writing) is $3.5/hr/gpu on <a href="https://cloud.lambdalabs.com/instances" target="_blank" rel="noopener noreffer">lambdalabs</a>, $2.85/hr/gpu from <a href="https://sfcompute.com/" target="_blank" rel="noopener noreffer">sfcompute</a>, and ballpark $2/hr/gpu if you get a <a href="https://gpulist.ai/" target="_blank" rel="noopener noreffer">long term bulk contract</a>.</li></ul><p>If we pessimistically estimate the true average tensor FLOP/s provided by a H100 GPU on an average run as 3.5e14 (aka slightly above 35% MFU), and the cost of a H100 GPU as $3/hr, we get:</p><div><table><tbody><tr><td><pre tabindex="0"><code><span>1
</span><span>2
</span><span>3
</span><span>4
</span><span>5
</span></code></pre></td><td><pre tabindex="0"><code data-lang="python"><span><span><span>def</span> <span>cost_of_run</span><span>(</span><span>flops</span><span>:</span> <span>float</span><span>,</span> <span>pergpu_flops</span><span>=</span><span>3.5e14</span><span>):</span>
</span></span><span><span>  <span>gpu_hours</span> <span>=</span> <span>flops</span> <span>/</span> <span>3600</span> <span>/</span> <span>pergpu_flops</span>
</span></span><span><span>  <span>rental_cost</span> <span>=</span> <span>3</span> <span>*</span> <span>gpu_hours</span>
</span></span><span><span>  <span>single_node_duration</span> <span>=</span> <span>gpu_hours</span> <span>/</span> <span>8</span>
</span></span><span><span>  <span>return</span> <span>rental_cost</span><span>,</span> <span>single_node_duration</span>
</span></span></code></pre></td></tr></tbody></table></div><p><strong>These numbers are fungible</strong> and you can choose to mentally halve (or double) them if you find it appropriate.</p></div></div><hr><h2 id="a-summary-of-all-experiments-tried">A summary of all experiments tried</h2><figure><img src="https://152334h.github.io/blog/scaling-exponents/Pasted%20image%2020240722025146.png"></figure><p>There are a few different types of experiments done in the paper:</p><div><p>Experiment types</p><div><ul><li><strong>Alignment experiments</strong>, which use a single global close-to-optimal LR, while varying<ul><li>$D \in {1024, 2048, 4096}$</li><li>4x paramterizations</li><li>3x optimizers (Adam, SGD+momentum, Adafactor)</li></ul></li><li><strong>Learning rate</strong> experiments, which vary:<ul><li><p>3x optimizers (Adam, SGD+momentum, Adam+PS)</p></li><li><p>4x paramterizations</p></li><li><p><strong>14x model widths</strong> $D \in [128, 16384]$. but this is really best described as scaling numheads $H \in {1,2,4,6,8,12,16,20,24,32,48,64,96,128}$</p></li><li><p>Global LR vs Per-layer Beta LR vs Per-layer $\beta$ Gamma LR + Per-layer $\beta\ \gamma$ No align LR</p><ul><li>The $\gamma$ experiements are particularly complex to calculate, see <a href="#Problems" rel="">point 3</a></li></ul></li><li><p>LR by an <strong>indeterminate range</strong> – they sweep in intervals of $2^{0.25}\text{ or }2^{0.5}$ and terminate rightwards when</p><ol><li>the LR leads to NaNs OR</li><li>the eval loss for a given LR $\mathcal{L}^\eta \gt 1.2\times \text{argmin}_\eta(\mathcal{L^\eta})$</li></ol><p>i.e. the first (larger than optimal) LR to show either of those conditions is <strong>not plotted</strong>, and the LR $\sqrt{2}$ or $\surd\surd2$ is.</p><p>…or at least, that is what the paper says is supposed to be the case. <a href="#Problems" rel="">I explain my contentions later</a>.</p></li></ul></li><li><strong>Adam Epslion</strong> experiments, which vary<ul><li>over 4x parameterizations,<ul><li><em>at least</em> $D\in {3072, 4096, 6144, 8192, 12288, 16384}$ over Adam, where<ul><li><em>at least</em> 6x eps is tried</li><li><em>at least</em> constant vs per-layer $\epsilon$ is compared.</li><li><em>at least</em> 13x LR is tried. Appendix F: “<a href="https://arxiv.org/pdf/2407.05872#page=43" target="_blank" rel="noopener noreffer">learning rate sweep at each model dim for each value of epsilon or base epsilon</a>”</li></ul></li><li>according to Appendix J/K, over <strong>all 14 model dims</strong>,<ul><li>For Adam, 4x (base eps, small const, good per-layer, atan2)<ul><li>technically, we double-count base EPS from the LR experiments, but we also neglect the extra no-align per-layer eps experiments, so this cancels out</li></ul></li><li>For Adam+PS, 2x (base eps, good per-layer)<ul><li>the double-neglect accounting argument applies here too</li></ul></li></ul></li></ul></li></ul></li><li>extra <strong>weight decay</strong> experiments<ul><li>static: adam, per-layer, full alignment, decoupled 1e-4</li><li>4x parameterizations</li><li>LR experiment-like sweep across <strong>all 14 model widths</strong></li></ul></li><li>extra <strong>adafactor</strong> experiments<ul><li>2x optim (Adafactor vs adam+ps)</li><li>2x setting (globalLR+default vs perlayer+optimal)</li><li>4x parameterizations</li><li>LR experiment-like sweep across <strong>only 11x</strong> model widths up to $H=48$ due to FSDP.<ul><li>actually <a href="https://arxiv.org/pdf/2407.05872#page=52" target="_blank" rel="noopener noreffer">implemented as 12x</a> but <a href="https://arxiv.org/pdf/2407.05872#page=47" target="_blank" rel="noopener noreffer">final results are 11x</a> and I follow the latter.</li></ul></li></ul></li><li>extra fixed step vs <strong>compute optimal</strong><ul><li>the 50k fixed step experiments are <strong>not the same</strong> as any of the above; they use “default constant learning rate multipliers” and have different power laws.</li><li>3x optim (SGD+moment, adam, adafactor)</li><li>4x parameterizations</li><li>LR experiment-like sweep across model width &amp;&amp; LR.<ul><li>width <strong>only goes up to 11x</strong>, last 3 are missing on Compute Optimal.</li></ul></li><li>compute-optimal experiments use 20x tokens of non-embedding P as a heuristic.</li></ul></li></ul></div></div><p>However, there are many problems with the experimental summary as given above.</p><div><p>Problems</p><div><ol><li><p>It is <strong>not clear whether they re-executed</strong> the per-layerLR experiments for the two edge cases where per-layer constants lead to identical behavior to globalLR (where $c_1 = c_l = c_{L+1}$):</p><ul><li>muP + SGD + full alignment, or</li><li>Adafactor + any parameterization + no alignment</li></ul><p>My expectation is that <strong>their experiments were repeated</strong>, because if you look at Table E1, you’ll see that the muP+SGD+full columns actually have a single diverging value (presumably caused by precision differences):</p><figure><img src="https://152334h.github.io/blog/scaling-exponents/VXjZe27k.jpeg"></figure><p><strong>However</strong>, I was also given (private) notice that <strong>in some cases, the experiments with theoretically equivalent settings were merely executed once</strong>, with the eval losses copied twice. This makes the true extent of compute unknowable from the paper.</p></li><li><p>The LR experiments have indeterminate bounds, so I can’t directly figure out how many experiments were executed.</p><p>You can’t “just read the graphs” to figure out what the range of LRs used are either; they cut off the y/x axis:</p><figure><img src="https://152334h.github.io/blog/scaling-exponents/Pasted%20image%2020240722134014.png"></figure><p>Frankly, it doesn’t even look like the steps here are guaranteed to be split in intervals of $2^{0.25}\text{ or }2^{0.5}$.</p><figure><img src="https://152334h.github.io/blog/scaling-exponents/Pasted%20image%2020240730045534.png"></figure><p>After further inspection, it looks an awful lot like the runs have <strong>arbitrary LR ranges even for the same $D$, optim, parameterization, and alignment</strong>. Or I just don’t understand the selection process (what are the unshaded shapes?).</p></li><li><p>In <a href="https://arxiv.org/pdf/2407.05872#page=34" target="_blank" rel="noopener noreffer">C.4</a>., they state:</p><blockquote><p>When tuning the per-layer constant multiplicative factors defined in Section 4.2, we use <a href="https://github.com/google/vizier" target="_blank" rel="noopener noreffer">vizier</a> to perform 3D hparam search for $(γ_1, γ_h, γ_{L+1})$ at $b = 1024$. Recall that we define the learning rate in layer $l$ as $η_l = β_n·γ_l·\frac{n}{b}^{−cl}$ and sweep one dimension at all model sizes to determine $β_n$, so these values of $(γ_1, γ_h, γ_{L+1})$ define two ratios where any common factor can be absorbed by $β_n$.</p></blockquote><p>To be clear, that last segment means: “you can divide $(γ_1, γ_h, γ_{L+1})$ by any of the 3 values to obtain some $(\gamma_x, \gamma_y, 1)$ tuple, the sweep will bring $\beta_n$ back to the correct value”. And so they say:</p><blockquote><p>For each optimizer × parameterization, we run 800 trials with at most 100 trials in parallel with a range set to $[1\text{e−}2, 1e2]$ for each constant. If the optimal value for any of the constants is at or near the edge of the range after this first search, we extend the range of the sweep for that constant to 0.01 and 100x the optimal value found in the original sweep and repeat the same tuning procedure.</p></blockquote><p>Upside: this gives 800 experiments as a lower bound for the $\gamma$ experiments.
Downside: We otherwise have no plotted information about the 3D experiments that were conducted. The actual plotted graphs just show final eval loss against base LR, under the assumption that the $b=1024$ base line on the Optimal Constants graphs actually hide the extra work done to sweep $\gamma$ values.</p></li><li><p>It is deeply unclear to me what is actually implemented for the fixed-step vs compute optimal runs. If we look at the <a href="https://arxiv.org/pdf/2407.05872#page=51" target="_blank" rel="noopener noreffer">50k steps graph</a>:</p><figure><img src="https://152334h.github.io/blog/scaling-exponents/Pasted%20image%2020240730044030.png"></figure><p>It looks <em>extremely similar</em>, but <strong>not identical</strong> to the <a href="https://arxiv.org/pdf/2407.05872#page=56" target="_blank" rel="noopener noreffer">original Adam+GlobalLR+default graphs</a>:</p><figure><img src="https://152334h.github.io/blog/scaling-exponents/Pasted%20image%2020240730044047.png"></figure><p>I have no idea what the differences are supposed to be here. However, in the interest of sticking with the paper’s behaviour, I attempt to include the compute used for these psuedo-repeated experiments.</p></li></ol></div></div><p>For each of these issues, I do my best to pick an approximation that makes sense to me in the later sections.</p><hr><h2 id="transformer-information">Transformer information</h2><p>In Appendix C, the model is described as:</p><ul><li>decoder-only</li><li>no bias on weights (including layernorm, which only has learnable scale)</li><li>LPE, pre-LN, GeLU, no tied emb</li><li>T5 Sentencepiece 32k + 1BOS + 100extra, i.e. $V=32101$. This is never stated to be padded.</li><li>“Training inputs are sequence-packed, while evaluation inputs are padded”</li><li>$\text{batch size}=256$, $l_\text{seq}=512$, $L=8$, $D_\text{head}=128$</li><li>$D_\text{head}*H = D$, $R_\text{ffn} = 4$.</li></ul><p>with some extra details for later:</p><ul><li>no dropout</li><li>mostly FSDP</li><li>$P \approx L12D^2 + 2VD$ (this excludes the layernorm params ($2LD$) and the LPE ($Vl_\text{seq}$))</li><li>“The compute optimal experiments include models up to $H = 32$ or $H = 48$, and the fixed (50,000) step experiments include models up to $H = 128$.”</li></ul><h3 id="flops-per-token">FLOPs per token</h3><p>To start, we want to find $M$, the number of FLOPs required per token for a training run.</p><div><p>Basic transformer math</p><div><p>As a reminder for any noam-like transformer, the tensor FLOPs required per token $M$ is approx:</p><p>$$V - \text{vocab size}$$
$$D - \text{hidden dim}$$
$$L - \text{xf layer count}$$</p><p>$$R_{\text{ffn}} - \text{[ffn dim : outer dim] ratio, assuming no GLU}$$
$$R_{kv} - \text{[num k or v heads : num att heads] ratio}$$
$$l_{seq} - \text{assumed average sequence length}$$</p><p>$$M = 12D^2L(1 + R_{kv} + R_{\text{ffn}}) + 6DL\cdot l_{seq} + 6DV$$</p><p>In particular, $6DL\cdot l_\text{seq}$ assumes a causal mask halves the computation required (I assume flash-attn does this)</p></div></div><p>The paper does not describe the usage of any GQA/MQA, so I assume $R_\text{kv} = 1$. This gives us</p><blockquote><p>$M=72D^2L + 6DLl_\text{seq} + 6DV = 6D(12DL + Ll_\text{seq} + V) = 6D(L(12D+l_\text{seq}) + V)$</p></blockquote><p>We have additional constants of $L=8$, $l_\text{seq} = 512$, and $V=32101$, so we write:</p><div><table><tbody><tr><td><pre tabindex="0"><code><span>1
</span><span>2
</span><span>3
</span></code></pre></td><td><pre tabindex="0"><code data-lang="python"><span><span><span>def</span> <span>M</span><span>(</span><span>d</span><span>:</span> <span>int</span><span>,</span> <span>L</span><span>=</span><span>8</span><span>,</span> <span>l_seq</span><span>=</span><span>512</span><span>,</span> <span>V</span><span>=</span><span>32101</span><span>)</span> <span>-&gt;</span> <span>int</span><span>:</span>
</span></span><span><span>    <span>return</span> <span>6</span><span>*</span><span>d</span> <span>*</span> <span>(</span><span>L</span><span>*</span><span>(</span><span>12</span><span>*</span><span>d</span> <span>+</span> <span>l_seq</span><span>)</span> <span>+</span> <span>V</span><span>)</span>
</span></span><span><span><span>TPE</span> <span>=</span> <span>50000</span> <span>*</span> <span>256</span> <span>*</span> <span>512</span>
</span></span></code></pre></td></tr></tbody></table></div><p>For all experiments <em>except the compute-optimal series in Appendix I</em>, we also have a hardcoded number of $steps=50000$ and global $BS=256$, making the total number of tokens seen per experiment $TPE=6.5536\text{e}9$ by default.</p><hr><h2 id="subproblem-alignment-experiments">Subproblem: Alignment experiments</h2><p>I <em>assume</em> the alignment experiments got their optimal LRs from the later experiments, and didn’t do their own sweeps, so that would make the cost simply,
$$
\sum_{d\in {1024,2048,4096}} 4\times\text{tokens per experiment}\times M(d)
$$</p><div><table><tbody><tr><td><pre tabindex="0"><code><span>1
</span><span>2
</span><span>3
</span><span>4
</span><span>5
</span><span>6
</span></code></pre></td><td><pre tabindex="0"><code data-lang="python"><span><span><span>def</span> <span>alignment</span><span>()</span> <span>-&gt;</span> <span>int</span><span>:</span>
</span></span><span><span>    <span>return</span> <span>4</span> <span>*</span> <span>TPE</span> <span>*</span> <span>sum</span><span>(</span><span>M</span><span>(</span><span>d</span><span>)</span> <span>for</span> <span>d</span> <span>in</span> <span>[</span><span>1024</span><span>,</span><span>2048</span><span>,</span><span>4096</span><span>])</span>
</span></span><span><span><span># &gt;&gt;&gt; f'{alignment():.3E}'</span>
</span></span><span><span><span># '3.733E+20'</span>
</span></span><span><span><span># &gt;&gt;&gt; cost_of_run(alignment())[0]</span>
</span></span><span><span><span># 888.81395400704</span>
</span></span></code></pre></td></tr></tbody></table></div><p>These experiments would take &lt;US$1k to execute.</p><h2 id="subproblem-table-e1-experiments">Subproblem: Table E1 experiments</h2><p><a href="https://arxiv.org/pdf/2407.05872#page=40" target="_blank" rel="noopener noreffer">Table E1</a> has a neat collection of many of the runs done for obtaining the <em>best</em> eval losses under any given parameterization/optimizer/setting (some combination of global vs per-layer vs $\gamma$-optimal vs $\epsilon$-optimal).</p><p>This is an easier subproblem to tackle than the general issue of <em>all LR sweeps</em>, as the requirements are better known – though still not entirely determined, per the repetition ambiguity mentioned earlier. For that issue, I assume that all experiments were conducted, with no copied results, making the estimate here an upper bound.</p><p>We have the following schedule:</p><ul><li>$D\in {3072, 4096, 6144, 8192, 12288, 16384}$</li><li>4x parameterizations</li><li>3x optimizers, where<ul><li>SGD only receives 5 experimental settings</li><li>Adam &amp; Adam+PS receives 7</li></ul></li></ul><p>$$
\sum_{d\in {3072,4096,6144,8192,12288,16384}} 4\times(5+7*2)\times\text{tokens per experiment}\times M(d)
$$</p><div><table><tbody><tr><td><pre tabindex="0"><code><span>1
</span><span>2
</span><span>3
</span><span>4
</span><span>5
</span><span>6
</span><span>7
</span><span>8
</span></code></pre></td><td><pre tabindex="0"><code data-lang="python"><span><span><span>H</span> <span>=</span> <span>[</span><span>1</span><span>,</span><span>2</span><span>,</span><span>4</span><span>,</span><span>6</span><span>,</span><span>8</span><span>,</span><span>12</span><span>,</span><span>16</span><span>,</span><span>20</span><span>,</span><span>24</span><span>,</span><span>32</span><span>,</span><span>48</span><span>,</span><span>64</span><span>,</span><span>96</span><span>,</span><span>128</span><span>]</span>
</span></span><span><span><span>D</span> <span>=</span> <span>[</span><span>h</span> <span>*</span> <span>128</span> <span>for</span> <span>h</span> <span>in</span> <span>H</span><span>]</span>
</span></span><span><span><span>def</span> <span>table_e1</span><span>()</span> <span>-&gt;</span> <span>int</span><span>:</span>
</span></span><span><span>  <span>sets_x_optims</span> <span>=</span> <span>5</span> <span>+</span> <span>7</span> <span>+</span> <span>7</span>
</span></span><span><span>  <span>return</span> <span>4</span> <span>*</span> <span>sets_x_optims</span> <span>*</span> <span>TPE</span> <span>*</span> <span>sum</span><span>(</span><span>M</span><span>(</span><span>d</span><span>)</span> <span>for</span> <span>d</span> <span>in</span> <span>D</span><span>[</span><span>-</span><span>6</span><span>:])</span>
</span></span><span><span><span># &gt;&gt;&gt; f'{table_e1():.3E}';cost_of_run(table_e1())</span>
</span></span><span><span><span># '1.634E+23'</span>
</span></span><span><span><span># (388955.9991064986, 16206.499962770775)</span>
</span></span></code></pre></td></tr></tbody></table></div><p>These would’ve taken slightly below $400k in H100 compute to execute. Reasonably speaking, this is within the bounds of SWE life savings / big academic budgets / TPU Research Cloud upper-class. Technically replicable, albeit not cheap.</p><p>But the bulk of the compute used in the paper comes from the LR sweeps, so we have to start working on that.</p><h2 id="estimating-lr-sweep-damage">Estimating LR sweep damage</h2><p>So, here’s a a graph:
<a href="https://152334h.github.io/blog/scaling-exponents/Pasted%20image%2020240730050758.png" title="/blog/scaling-exponents/Pasted%20image%2020240730050758.png" data-thumbnail="/blog/scaling-exponents/Pasted%20image%2020240730050758.png"></a></p><p><a href="https://152334h.github.io/blog/scaling-exponents/Pasted%20image%2020240730050758.png" title="/blog/scaling-exponents/Pasted%20image%2020240730050758.png" data-thumbnail="/blog/scaling-exponents/Pasted%20image%2020240730050758.png"><img src="https://152334h.github.io/blog/scaling-exponents/Pasted%20image%2020240730050758.png" data-src="/blog/scaling-exponents/Pasted%20image%2020240730050758.png" data-srcset="/blog/scaling-exponents/Pasted%20image%2020240730050758.png, /blog/scaling-exponents/Pasted%20image%2020240730050758.png 1.5x, /blog/scaling-exponents/Pasted%20image%2020240730050758.png 2x" data-sizes="auto" alt="/blog/scaling-exponents/Pasted%20image%2020240730050758.png" width="354" height="371" srcset="https://152334h.github.io/blog/scaling-exponents/Pasted%20image%2020240730050758.png, https://152334h.github.io/blog/scaling-exponents/Pasted%20image%2020240730050758.png 1.5x, https://152334h.github.io/blog/scaling-exponents/Pasted%20image%2020240730050758.png 2x"></a></p><p>Here’s another graph:
</p><a href="https://152334h.github.io/blog/scaling-exponents/Pasted%20image%2020240730050857.png" title="/blog/scaling-exponents/Pasted%20image%2020240730050857.png" data-thumbnail="/blog/scaling-exponents/Pasted%20image%2020240730050857.png"><p><img src="https://152334h.github.io/blog/scaling-exponents/Pasted%20image%2020240730050857.png" data-src="/blog/scaling-exponents/Pasted%20image%2020240730050857.png" data-srcset="/blog/scaling-exponents/Pasted%20image%2020240730050857.png, /blog/scaling-exponents/Pasted%20image%2020240730050857.png 1.5x, /blog/scaling-exponents/Pasted%20image%2020240730050857.png 2x" data-sizes="auto" alt="/blog/scaling-exponents/Pasted%20image%2020240730050857.png" width="367" height="347" srcset="https://152334h.github.io/blog/scaling-exponents/Pasted%20image%2020240730050857.png, https://152334h.github.io/blog/scaling-exponents/Pasted%20image%2020240730050857.png 1.5x, https://152334h.github.io/blog/scaling-exponents/Pasted%20image%2020240730050857.png 2x"></p></a><p>And here’s a third one:
</p><a href="https://152334h.github.io/blog/scaling-exponents/Pasted%20image%2020240730050917.png" title="/blog/scaling-exponents/Pasted%20image%2020240730050917.png" data-thumbnail="/blog/scaling-exponents/Pasted%20image%2020240730050917.png"><p><img src="https://152334h.github.io/blog/scaling-exponents/Pasted%20image%2020240730050917.png" data-src="/blog/scaling-exponents/Pasted%20image%2020240730050917.png" data-srcset="/blog/scaling-exponents/Pasted%20image%2020240730050917.png, /blog/scaling-exponents/Pasted%20image%2020240730050917.png 1.5x, /blog/scaling-exponents/Pasted%20image%2020240730050917.png 2x" data-sizes="auto" alt="/blog/scaling-exponents/Pasted%20image%2020240730050917.png" width="346" height="377" srcset="https://152334h.github.io/blog/scaling-exponents/Pasted%20image%2020240730050917.png, https://152334h.github.io/blog/scaling-exponents/Pasted%20image%2020240730050917.png 1.5x, https://152334h.github.io/blog/scaling-exponents/Pasted%20image%2020240730050917.png 2x"></p></a><p>Guess what?</p><ol><li>There isn’t a constant num. of LRs sweeped for a given $D$, or optim/parameterization/setting.<ul><li>Especially notable: number of runs seems inversely correlated with $D$; there are almost always less runs for the highest dim than the lowest.</li></ul></li><li>Neither is there an observable cutoff for when the runs stop – runs will spike up to 2x the optimal no problem.</li><li>You can’t get the <em>exact</em> correct number of runs by graph-reading; in many cases the points are out-of-bounds.</li></ol><p>The consistencies I <em>do</em> spot are that:</p><ul><li>there is typically a “starting LR” (smallest base) for any given line.</li><li>the hollowed points are typically to the right – but sometimes left – of the optimal point.</li></ul><p>so <strong>I <em>think</em> the mechanism worked this way</strong>:</p><ol><li>start a sweep with a starting LR and some expected jumpsizes of $\sqrt{2}$ or $\sqrt{\surd 2}$.</li><li>terminate it by the 20% / NaN heuristic.</li><li>if the graph looks weird (optimal point somewhere odd), rerun to fill many $2^{0.25}$ intervals around the current optimal. These result in the plotted hollow points</li></ol><p>I have no means of confirming this as the experimental procedure, as the authors of the paper stopped replying to me.</p><h3 id="an-arbitrary-decision">An arbitrary decision</h3><p>Due to my desire to finish this blog post in a reasonable amount of time, I made the unprincipled decision of approximating the number of experiments-per-line in any given Eval Loss vs Base Learning Rate graph as <strong>15</strong>.</p><p>Why 15? By eyeballing, the range of runs-per-line for the highest $D=16384$ hovers around 10~15. Although the lines with smaller D tend to have far more points on average, the amount of compute spent per run scales by $O(D^2)$, so I think this is fair enough.</p><p>Feel free to suggest a more principled approach if you have one.</p><hr><h2 id="main-problem-epslion">Main problem: Epslion</h2><p>Much of the compute used up by the paper comes from <a href="https://arxiv.org/pdf/2407.05872#page=15" target="_blank" rel="noopener noreffer">Section 4.3</a>, the Adam epslion experiments.</p><h3 id="optimal-eps-runs">Optimal eps runs</h3><p>Now that we have an estimate of LRs-per-line as 15, we can estimate the compute spent on the actual <a href="https://arxiv.org/pdf/2407.05872#page=44" target="_blank" rel="noopener noreffer">Adam epslion varying graphs</a>:</p><p>$$
\sum_{d} 4*(2+4) \times \text{points per line}\times\text{tokens per experiment}\times M(d)
$$</p><div><table><tbody><tr><td><pre tabindex="0"><code><span>1
</span><span>2
</span><span>3
</span><span>4
</span><span>5
</span><span>6
</span><span>7
</span><span>8
</span></code></pre></td><td><pre tabindex="0"><code data-lang="python"><span><span><span>PpL</span> <span>=</span> <span>15</span> <span># unprincipled estimate</span>
</span></span><span><span><span>def</span> <span>eps_variants</span><span>()</span> <span>-&gt;</span> <span>int</span><span>:</span>
</span></span><span><span>  <span>return</span> <span>4</span> <span>*</span> <span>6</span> <span>*</span> <span>PpL</span> <span>*</span> <span>TPE</span> <span>*</span> <span>sum</span><span>(</span><span>M</span><span>(</span><span>d</span><span>)</span> <span>for</span> <span>d</span> <span>in</span> <span>D</span><span>)</span>
</span></span><span><span><span>'''
</span></span></span><span><span><span>&gt;&gt;&gt; f'{eps_variants():.3E}';cost_of_run(eps_variants())
</span></span></span><span><span><span>'7.988E+23'
</span></span></span><span><span><span>(1902022.3291813303, 79250.93038255542)
</span></span></span><span><span><span>'''</span>
</span></span></code></pre></td></tr></tbody></table></div><p>Simple enough, right? Ignoring the ~$2M bill.</p><h3 id="epslion-heatmaps">Epslion Heatmaps</h3><p>There are two ways you could approach the expected sweep range for this problem:</p><ol><li>assume the LR experiment sweep code was reused. All 14x $D$, LR swept by arcane unknown ruleset.</li><li>Limit to the graphs. Only the last 6 values of $D$ were shown – assume only those were used. Plus, if we look at <a href="https://arxiv.org/pdf/2407.05872#page=16" target="_blank" rel="noopener noreffer">Figure 6</a>:<figure><img src="https://152334h.github.io/blog/scaling-exponents/Pasted%20image%2020240730044906.png"></figure>Notice that the range of evaluated learning rates actually seems constant here, unlike in the normal Eval Loss vs Base LR plots.</li></ol><p>I’m picking the latter because it’s simpler. Would be happy to be shown evidence that this is wrong.</p><p>$$ \sum_{d\in {3072,4096,6144,8192,12288,16384}} 4\cdot 2\cdot 6\cdot 13\times \text{tokens per experiment}\times M(d) $$</p><div><table><tbody><tr><td><pre tabindex="0"><code><span>1
</span><span>2
</span><span>3
</span><span>4
</span><span>5
</span><span>6
</span><span>7
</span><span>8
</span></code></pre></td><td><pre tabindex="0"><code data-lang="python"><span><span><span>def</span> <span>eps_heatmaps</span><span>()</span> <span>-&gt;</span> <span>int</span><span>:</span>
</span></span><span><span>  <span># eps-type * eps-val * parameterizations * LR range * ...</span>
</span></span><span><span>  <span>return</span> <span>2</span> <span>*</span> <span>6</span> <span>*</span> <span>4</span> <span>*</span> <span>13</span> <span>*</span> <span>TPE</span> <span>*</span> <span>sum</span><span>(</span><span>M</span><span>(</span><span>d</span><span>)</span> <span>for</span> <span>d</span> <span>in</span> <span>D</span><span>[</span><span>-</span><span>6</span><span>:])</span>
</span></span><span><span><span>'''
</span></span></span><span><span><span>&gt;&gt;&gt; f'{eps_heatmaps():.3E}';cost_of_run(eps_heatmaps())
</span></span></span><span><span><span>'1.341E+24'
</span></span></span><span><span><span>(3193533.466348094, 133063.89443117057)
</span></span></span><span><span><span>'''</span>
</span></span></code></pre></td></tr></tbody></table></div><h4 id="these-squares-are-worth-us32-million">These squares are worth US$3.2 Million</h4><figure><img src="https://152334h.github.io/blog/scaling-exponents/Pasted%20image%2020240730060102.png"></figure><p>To be clear, this is supposed to be an <strong>underestimate</strong> of the budget required, because we model the average number of unique LRs used per heatmap square as a constant $13$ instead of the (typically higher) value used in variable LR sweeps.</p><h2 id="main-problem-lr-sweep-strategies">Main problem: LR Sweep Strategies</h2><p>The other meat of the paper is in Section 4.2, the $\text{optimizer}\times\text{parameterization}\times D\times\text{LR setting}\times\text{alignment}\times\text{LR Sweeps}$ experiments.</p><h3 id="beta-only-experiments">$\beta$-only experiments</h3><p>“$\beta$” refers to the empirically obtained base LR constant under the equation $\eta_l = \beta_n\cdot\frac{n}{b}^{-c_l}$, also known as the <code>+default</code> experiments.</p><p>The paper sweeps this for 3x optimizers, 4x parameterizations, 14x widths, global vs per-layer $c_l$, and of course unknown LR sweep counts.</p><p>$$ \sum_{d} 3*4*2 \times \text{points per line}\times\text{tokens per experiment}\times M(d) $$</p><div><table><tbody><tr><td><pre tabindex="0"><code><span>1
</span><span>2
</span><span>3
</span></code></pre></td><td><pre tabindex="0"><code data-lang="python"><span><span><span>def</span> <span>beta_only</span><span>()</span> <span>-&gt;</span> <span>int</span><span>:</span>
</span></span><span><span>  <span>return</span> <span>3</span><span>*</span><span>4</span><span>*</span><span>2</span><span>*</span><span>PpL</span> <span>*</span> <span>TPE</span> <span>*</span> <span>sum</span><span>(</span><span>M</span><span>(</span><span>d</span><span>)</span> <span>for</span> <span>d</span> <span>in</span> <span>D</span><span>)</span>
</span></span><span><span><span># 7.988E+23 (1902022.3291813303, 79250.93038255542)</span>
</span></span></code></pre></td></tr></tbody></table></div><p>Incidentally, this has an identical estimated cost to the <a href="#optimal-eps-runs" rel="">epslion variants</a>.</p><h3 id="gamma-experiments">$\gamma$ experiments</h3><p>So, two issues.</p><ol><li>These experiments are “like” the $\beta$-only experiments, but with 3x cases (GlobalLR, Perlayer-fullalign, Perlayer-nolign) instead of 2x (GlobalLR, Perlayer-fullalign).
$$ \sum_{d} 3*4*3 \times \text{points per line}\times\text{tokens per experiment}\times M(d) $$</li><li>Specifically for $d=1024=b$, we have <strong>at least</strong> 800 extra runs, due to the 3D hparam search for $(\gamma_1, \gamma_h, \gamma_{L+1})$.
$$ 3*4*3*800 \times\text{tokens per experiment}\times M(1024) $$</li></ol><p>We can combine those two as,
$$ 36\times\text{tokens per experiment}(800*M(1024) + \text{points per line}\sum_{d}\times M(d)) $$</p><div><table><tbody><tr><td><pre tabindex="0"><code><span>1
</span><span>2
</span><span>3
</span></code></pre></td><td><pre tabindex="0"><code data-lang="python"><span><span><span>def</span> <span>gamma_expts</span><span>()</span> <span>-&gt;</span> <span>int</span><span>:</span>
</span></span><span><span>  <span>return</span> <span>36</span><span>*</span><span>TPE</span> <span>*</span> <span>(</span><span>800</span><span>*</span><span>M</span><span>(</span><span>1024</span><span>)</span> <span>+</span> <span>PpL</span><span>*</span><span>sum</span><span>(</span><span>M</span><span>(</span><span>d</span><span>)</span> <span>for</span> <span>d</span> <span>in</span> <span>D</span><span>))</span>
</span></span><span><span><span># gamma_expts 	 1.354E+24 (3224397.534237257, 134349.8972598857)</span>
</span></span></code></pre></td></tr></tbody></table></div><p>This is, once again, exceedingly close to that of the Adam $\epslion$ heatmap experiments.</p><p>Sidenote: I may be understanding the per-layer aspect of the paper incorrectly; I expected the compute expenditure of this section to be larger.</p><h3 id="weight-decay">Weight Decay</h3><p>The WD experiments are simple enough. We repeat 4x parameterizations &amp;&amp; do a single base-LR sweep on all $D$</p><p>$$
\sum_{d} 4*(2+4) \times \text{points per line}\times\text{tokens per experiment}\times M(d)
$$</p><div><table><tbody><tr><td><pre tabindex="0"><code><span>1
</span><span>2
</span><span>3
</span><span>4
</span><span>5
</span><span>6
</span><span>7
</span></code></pre></td><td><pre tabindex="0"><code data-lang="python"><span><span><span>def</span> <span>weight_decay</span><span>()</span> <span>-&gt;</span> <span>int</span><span>:</span>
</span></span><span><span>  <span>return</span> <span>4</span> <span>*</span> <span>PpL</span> <span>*</span> <span>TPE</span> <span>*</span> <span>sum</span><span>(</span><span>M</span><span>(</span><span>d</span><span>)</span> <span>for</span> <span>d</span> <span>in</span> <span>D</span><span>)</span>
</span></span><span><span><span>'''
</span></span></span><span><span><span>&gt;&gt;&gt; f'{weight_decay():.3E}'; cost_of_run(weight_decay())
</span></span></span><span><span><span>'1.331E+23'
</span></span></span><span><span><span>(317003.7215302217, 13208.488397092571)
</span></span></span><span><span><span>'''</span>
</span></span></code></pre></td></tr></tbody></table></div><p>Incredibly cheap, I could afford that in some years.</p><h3 id="adafactor">Adafactor</h3><p>As a reminder, I only count the first 11 $D$, even though the report actually has 12 in one graph.</p><p>$$
\sum_{d\in D[:11]} 2 * 2* 4\times \text{points per line}\times\text{tokens per experiment}\times M(d)
$$</p><div><table><tbody><tr><td><pre tabindex="0"><code><span>1
</span><span>2
</span><span>3
</span><span>4
</span><span>5
</span><span>6
</span><span>7
</span></code></pre></td><td><pre tabindex="0"><code data-lang="python"><span><span><span>def</span> <span>adafactor</span><span>()</span> <span>-&gt;</span> <span>int</span><span>:</span>
</span></span><span><span>  <span>return</span> <span>2</span><span>*</span><span>2</span><span>*</span><span>4</span><span>*</span><span>PpL</span><span>*</span><span>TPE</span><span>*</span><span>sum</span><span>(</span><span>M</span><span>(</span><span>d</span><span>)</span> <span>for</span> <span>d</span> <span>in</span> <span>D</span><span>[:</span><span>11</span><span>])</span>
</span></span><span><span><span>'''
</span></span></span><span><span><span>&gt;&gt;&gt; f'{adafactor():.3E}'; cost_of_run(adafactor())
</span></span></span><span><span><span>'7.918E+22'
</span></span></span><span><span><span>(188532.80765144504, 7855.533652143543)
</span></span></span><span><span><span>'''</span>
</span></span></code></pre></td></tr></tbody></table></div><h3 id="compute-optimal">Compute Optimal</h3><p>The paper states that,</p><blockquote><p>The compute optimal experiments include models up to $H = 32$ or $H = 48$, and the fixed (50,000) step experiments include models up to $H = 128$.</p></blockquote><p>If you read the graphs in <a href="https://arxiv.org/pdf/2407.05872#page=50" target="_blank" rel="noopener noreffer">Appendix I</a>, this is slightly wrong, because</p><ul><li><p>50k experiments go to $H=48$ on Adafactor, and $H=128$ otherwise</p></li><li><p>all compute optimal experiments go up to $H=32$ only.</p><p>Note that a 4B param run requires 80B tokens by chinchilla, and C4 is less than 200B tokens, so they couldn’t have gone higher without changing the dataset.</p></li></ul><p>This is honestly a bit complex, so let’s forgo the latex and just describe it in python:</p><div><table><tbody><tr><td><pre tabindex="0"><code><span> 1
</span><span> 2
</span><span> 3
</span><span> 4
</span><span> 5
</span><span> 6
</span><span> 7
</span><span> 8
</span><span> 9
</span><span>10
</span></code></pre></td><td><pre tabindex="0"><code data-lang="python"><span><span><span>def</span> <span>P</span><span>(</span><span>d</span><span>:</span> <span>int</span><span>,</span> <span>L</span><span>=</span><span>8</span><span>,</span> <span>V</span><span>=</span><span>32101</span><span>)</span> <span>-&gt;</span> <span>int</span><span>:</span>
</span></span><span><span>    <span>return</span> <span>2</span> <span>*</span> <span>d</span> <span>*</span> <span>(</span><span>6</span><span>*</span><span>L</span><span>*</span><span>d</span> <span>+</span> <span>V</span><span>)</span>
</span></span><span><span>
</span></span><span><span><span>def</span> <span>compute_optimal</span><span>():</span>
</span></span><span><span>  <span>indices_50k</span> <span>=</span> <span>(</span><span>14</span><span>,</span> <span>14</span><span>,</span> <span>12</span><span>)</span>
</span></span><span><span>  <span>return</span> <span>4</span><span>*</span><span>PpL</span><span>*</span><span>sum</span><span>([</span>
</span></span><span><span>    <span>TPE</span> <span>*</span> <span>sum</span><span>(</span><span>sum</span><span>(</span> <span>M</span><span>(</span><span>d</span><span>)</span> <span>for</span> <span>d</span> <span>in</span> <span>D</span><span>[:</span><span>i</span><span>]</span> <span>)</span> <span>for</span> <span>i</span> <span>in</span> <span>indices_50k</span><span>),</span>
</span></span><span><span>	<span>20</span>  <span>*</span> <span>sum</span><span>(</span><span>P</span><span>(</span><span>d</span><span>)</span><span>*</span><span>M</span><span>(</span><span>d</span><span>)</span> <span>for</span> <span>d</span> <span>in</span> <span>D</span><span>[:</span><span>11</span><span>])</span> <span>*</span><span>3</span><span>,</span>
</span></span><span><span>  <span>])</span>
</span></span><span><span><span># compute_optim 	 7.518E+23 (1790104.1799513847, 74587.67416464102)</span>
</span></span></code></pre></td></tr></tbody></table></div><h2 id="code-summary">Code summary</h2><p>Here is the full script to get the estimates I created:</p><div><table><tbody><tr><td><pre tabindex="0"><code><span> 1
</span><span> 2
</span><span> 3
</span><span> 4
</span><span> 5
</span><span> 6
</span><span> 7
</span><span> 8
</span><span> 9
</span><span>10
</span><span>11
</span><span>12
</span><span>13
</span><span>14
</span><span>15
</span><span>16
</span><span>17
</span><span>18
</span><span>19
</span><span>20
</span><span>21
</span><span>22
</span><span>23
</span><span>24
</span><span>25
</span><span>26
</span><span>27
</span><span>28
</span><span>29
</span><span>30
</span><span>31
</span><span>32
</span><span>33
</span><span>34
</span><span>35
</span><span>36
</span><span>37
</span><span>38
</span><span>39
</span><span>40
</span><span>41
</span><span>42
</span><span>43
</span><span>44
</span><span>45
</span><span>46
</span><span>47
</span><span>48
</span><span>49
</span><span>50
</span><span>51
</span><span>52
</span><span>53
</span><span>54
</span><span>55
</span><span>56
</span><span>57
</span><span>58
</span><span>59
</span><span>60
</span><span>61
</span><span>62
</span><span>63
</span></code></pre></td><td><pre tabindex="0"><code data-lang="python"><span><span><span>TPE</span> <span>=</span> <span>50000</span> <span>*</span> <span>256</span> <span>*</span> <span>512</span>
</span></span><span><span><span>H</span> <span>=</span> <span>[</span><span>1</span><span>,</span><span>2</span><span>,</span><span>4</span><span>,</span><span>6</span><span>,</span><span>8</span><span>,</span><span>12</span><span>,</span><span>16</span><span>,</span><span>20</span><span>,</span><span>24</span><span>,</span><span>32</span><span>,</span><span>48</span><span>,</span><span>64</span><span>,</span><span>96</span><span>,</span><span>128</span><span>]</span>
</span></span><span><span><span>D</span> <span>=</span> <span>[</span><span>h</span> <span>*</span> <span>128</span> <span>for</span> <span>h</span> <span>in</span> <span>H</span><span>]</span>
</span></span><span><span><span>PpL</span> <span>=</span> <span>15</span> <span># unprincipled estimate</span>
</span></span><span><span>
</span></span><span><span><span>def</span> <span>cost_of_run</span><span>(</span><span>flops</span><span>:</span> <span>float</span><span>,</span> <span>pergpu_flops</span><span>=</span><span>3.5e14</span><span>):</span>
</span></span><span><span>  <span>gpu_hours</span> <span>=</span> <span>flops</span> <span>/</span> <span>3600</span> <span>/</span> <span>pergpu_flops</span>
</span></span><span><span>  <span>rental_cost</span> <span>=</span> <span>3</span> <span>*</span> <span>gpu_hours</span>
</span></span><span><span>  <span>single_node_duration</span> <span>=</span> <span>gpu_hours</span> <span>/</span> <span>8</span>
</span></span><span><span>  <span>return</span> <span>rental_cost</span><span>,</span> <span>single_node_duration</span>
</span></span><span><span>
</span></span><span><span><span>def</span> <span>M</span><span>(</span><span>d</span><span>:</span> <span>int</span><span>,</span> <span>L</span><span>=</span><span>8</span><span>,</span> <span>l_seq</span><span>=</span><span>512</span><span>,</span> <span>V</span><span>=</span><span>32101</span><span>)</span> <span>-&gt;</span> <span>int</span><span>:</span>
</span></span><span><span>    <span>return</span> <span>6</span><span>*</span><span>d</span> <span>*</span> <span>(</span><span>L</span><span>*</span><span>(</span><span>12</span><span>*</span><span>d</span> <span>+</span> <span>l_seq</span><span>)</span> <span>+</span> <span>V</span><span>)</span>
</span></span><span><span>
</span></span><span><span><span>def</span> <span>P</span><span>(</span><span>d</span><span>:</span> <span>int</span><span>,</span> <span>L</span><span>=</span><span>8</span><span>,</span> <span>V</span><span>=</span><span>32101</span><span>)</span> <span>-&gt;</span> <span>int</span><span>:</span>
</span></span><span><span>    <span>return</span> <span>2</span> <span>*</span> <span>d</span> <span>*</span> <span>(</span><span>6</span><span>*</span><span>L</span><span>*</span><span>d</span> <span>+</span> <span>V</span><span>)</span>
</span></span><span><span>
</span></span><span><span><span>def</span> <span>alignment</span><span>()</span> <span>-&gt;</span> <span>int</span><span>:</span>
</span></span><span><span>    <span>return</span> <span>4</span> <span>*</span> <span>TPE</span> <span>*</span> <span>sum</span><span>(</span><span>M</span><span>(</span><span>d</span><span>)</span> <span>for</span> <span>d</span> <span>in</span> <span>[</span><span>1024</span><span>,</span><span>2048</span><span>,</span><span>4096</span><span>])</span>
</span></span><span><span>
</span></span><span><span><span>def</span> <span>table_e1</span><span>()</span> <span>-&gt;</span> <span>int</span><span>:</span>
</span></span><span><span>  <span>sets_x_optims</span> <span>=</span> <span>5</span> <span>+</span> <span>7</span> <span>+</span> <span>7</span>
</span></span><span><span>  <span>return</span> <span>4</span> <span>*</span> <span>sets_x_optims</span> <span>*</span> <span>TPE</span> <span>*</span> <span>sum</span><span>(</span><span>M</span><span>(</span><span>d</span><span>)</span> <span>for</span> <span>d</span> <span>in</span> <span>D</span><span>[</span><span>-</span><span>6</span><span>:])</span>
</span></span><span><span>
</span></span><span><span><span>def</span> <span>eps_variants</span><span>()</span> <span>-&gt;</span> <span>int</span><span>:</span>
</span></span><span><span>  <span>return</span> <span>4</span> <span>*</span> <span>6</span> <span>*</span> <span>PpL</span> <span>*</span> <span>TPE</span> <span>*</span> <span>sum</span><span>(</span><span>M</span><span>(</span><span>d</span><span>)</span> <span>for</span> <span>d</span> <span>in</span> <span>D</span><span>)</span>
</span></span><span><span>
</span></span><span><span><span>def</span> <span>eps_heatmaps</span><span>()</span> <span>-&gt;</span> <span>int</span><span>:</span>
</span></span><span><span>  <span>return</span> <span>2</span> <span>*</span> <span>6</span> <span>*</span> <span>4</span> <span>*</span> <span>13</span> <span>*</span> <span>TPE</span> <span>*</span> <span>sum</span><span>(</span><span>M</span><span>(</span><span>d</span><span>)</span> <span>for</span> <span>d</span> <span>in</span> <span>D</span><span>[</span><span>-</span><span>6</span><span>:])</span>
</span></span><span><span>
</span></span><span><span><span>def</span> <span>beta_only</span><span>()</span> <span>-&gt;</span> <span>int</span><span>:</span>
</span></span><span><span>  <span>return</span> <span>3</span><span>*</span><span>4</span><span>*</span><span>2</span><span>*</span><span>PpL</span> <span>*</span> <span>TPE</span> <span>*</span> <span>sum</span><span>(</span><span>M</span><span>(</span><span>d</span><span>)</span> <span>for</span> <span>d</span> <span>in</span> <span>D</span><span>)</span>
</span></span><span><span>
</span></span><span><span><span>def</span> <span>gamma_expts</span><span>()</span> <span>-&gt;</span> <span>int</span><span>:</span>
</span></span><span><span>  <span>return</span> <span>36</span><span>*</span><span>TPE</span> <span>*</span> <span>(</span><span>800</span><span>*</span><span>M</span><span>(</span><span>1024</span><span>)</span> <span>+</span> <span>PpL</span><span>*</span><span>sum</span><span>(</span><span>M</span><span>(</span><span>d</span><span>)</span> <span>for</span> <span>d</span> <span>in</span> <span>D</span><span>))</span>
</span></span><span><span>
</span></span><span><span><span>def</span> <span>weight_decay</span><span>()</span> <span>-&gt;</span> <span>int</span><span>:</span>
</span></span><span><span>  <span>return</span> <span>4</span> <span>*</span> <span>PpL</span> <span>*</span> <span>TPE</span> <span>*</span> <span>sum</span><span>(</span><span>M</span><span>(</span><span>d</span><span>)</span> <span>for</span> <span>d</span> <span>in</span> <span>D</span><span>)</span>
</span></span><span><span>
</span></span><span><span><span>def</span> <span>adafactor</span><span>()</span> <span>-&gt;</span> <span>int</span><span>:</span>
</span></span><span><span>  <span>return</span> <span>2</span><span>*</span><span>2</span><span>*</span><span>4</span><span>*</span><span>PpL</span><span>*</span><span>TPE</span><span>*</span><span>sum</span><span>(</span><span>M</span><span>(</span><span>d</span><span>)</span> <span>for</span> <span>d</span> <span>in</span> <span>D</span><span>[:</span><span>11</span><span>])</span>
</span></span><span><span>
</span></span><span><span><span>def</span> <span>compute_optim</span><span>():</span>
</span></span><span><span>  <span>indices_50k</span> <span>=</span> <span>(</span><span>14</span><span>,</span> <span>14</span><span>,</span> <span>12</span><span>)</span>
</span></span><span><span>  <span>return</span> <span>4</span><span>*</span><span>PpL</span><span>*</span><span>sum</span><span>([</span>
</span></span><span><span>    <span>TPE</span> <span>*</span> <span>sum</span><span>(</span><span>sum</span><span>(</span> <span>M</span><span>(</span><span>d</span><span>)</span> <span>for</span> <span>d</span> <span>in</span> <span>D</span><span>[:</span><span>i</span><span>]</span> <span>)</span> <span>for</span> <span>i</span> <span>in</span> <span>indices_50k</span><span>),</span>
</span></span><span><span>	<span>20</span>  <span>*</span> <span>sum</span><span>(</span><span>P</span><span>(</span><span>d</span><span>)</span><span>*</span><span>M</span><span>(</span><span>d</span><span>)</span> <span>for</span> <span>d</span> <span>in</span> <span>D</span><span>[:</span><span>11</span><span>])</span> <span>*</span><span>3</span><span>,</span>
</span></span><span><span>  <span>])</span>
</span></span><span><span>
</span></span><span><span><span>total_flops</span><span>,</span> <span>total_price</span><span>,</span> <span>total_hours</span> <span>=</span> <span>0</span><span>,</span><span>0</span><span>,</span><span>0</span>
</span></span><span><span><span>for</span> <span>f</span> <span>in</span> <span>(</span><span>alignment</span><span>,</span><span>table_e1</span><span>,</span><span>eps_variants</span><span>,</span><span>eps_heatmaps</span><span>,</span><span>beta_only</span><span>,</span><span>gamma_expts</span><span>,</span><span>weight_decay</span><span>,</span><span>adafactor</span><span>,</span><span>compute_optim</span><span>):</span>
</span></span><span><span>    <span>flops</span> <span>=</span> <span>f</span><span>()</span>
</span></span><span><span>    <span>costs</span> <span>=</span> <span>cost_of_run</span><span>(</span><span>flops</span><span>)</span>
</span></span><span><span>    <span>print</span><span>(</span><span>f</span><span>'</span><span>{</span><span>f</span><span>.</span><span>__name__</span><span>:</span><span>15</span><span>}</span><span>'</span><span>,</span> <span>f</span><span>'</span><span>{</span><span>flops</span><span>:</span><span>.3E</span><span>}</span><span>'</span><span>,</span><span>costs</span><span>)</span>
</span></span><span><span>    <span>total_flops</span> <span>+=</span> <span>flops</span><span>;</span> <span>total_price</span> <span>+=</span> <span>costs</span><span>[</span><span>0</span><span>];</span> <span>total_hours</span> <span>+=</span> <span>costs</span><span>[</span><span>1</span><span>]</span>
</span></span><span><span>
</span></span><span><span><span>print</span><span>(</span><span>f</span><span>'</span><span>{</span><span>total_flops</span><span>=:</span><span>.3E</span><span>}</span><span>'</span><span>)</span>
</span></span><span><span><span>print</span><span>(</span><span>f</span><span>'rental price: US$</span><span>{</span><span>total_price</span><span>/</span><span>1e6</span><span>:</span><span>.3</span><span>}</span><span>M'</span><span>)</span>
</span></span><span><span><span>print</span><span>(</span><span>f</span><span>'h100 node months required: </span><span>{</span><span>total_hours</span><span>/</span><span>24</span><span>/</span><span>30</span><span>}</span><span>'</span><span>)</span>
</span></span><span><span><span>print</span><span>()</span>
</span></span><span><span><span>print</span><span>(</span><span>f</span><span>'(sanity check) </span><span>{</span><span>D</span><span>=}</span><span>'</span><span>)</span>
</span></span><span><span><span>print</span><span>(</span><span>'(sanity check) model sizes:'</span><span>,</span> <span>[</span><span>f</span><span>'</span><span>{</span><span>P</span><span>(</span><span>d</span><span>)</span><span>/</span><span>1e9</span><span>:</span><span>.3</span><span>}</span><span>B'</span> <span>for</span> <span>d</span> <span>in</span> <span>D</span><span>])</span>
</span></span><span><span><span>print</span><span>(</span><span>'(sanity check) M/6P:'</span><span>,</span> <span>[</span><span>f</span><span>'</span><span>{</span><span>100</span><span>*</span><span>M</span><span>(</span><span>d</span><span>)</span><span>/</span><span>P</span><span>(</span><span>d</span><span>)</span><span>/</span><span>6</span><span>:</span><span>.3</span><span>}</span><span>%'</span> <span>for</span> <span>d</span> <span>in</span> <span>D</span><span>])</span>
</span></span></code></pre></td></tr></tbody></table></div><p>This gives the following:</p><div><table><tbody><tr><td><pre tabindex="0"><code><span>1
</span><span>2
</span><span>3
</span><span>4
</span><span>5
</span><span>6
</span><span>7
</span><span>8
</span><span>9
</span></code></pre></td><td><pre tabindex="0"><code data-lang="fallback"><span><span>alignment       3.733E+20 (888.81395400704, 37.033914750293334)
</span></span><span><span>table_e1        1.634E+23 (388955.9991064986, 16206.499962770775)
</span></span><span><span>eps_variants    7.988E+23 (1902022.3291813303, 79250.93038255542)
</span></span><span><span>eps_heatmaps    1.341E+24 (3193533.466348094, 133063.89443117057)
</span></span><span><span>beta_only       7.988E+23 (1902022.3291813303, 79250.93038255542)
</span></span><span><span>gamma_expts     1.354E+24 (3224397.534237257, 134349.8972598857)
</span></span><span><span>weight_decay    1.331E+23 (317003.7215302217, 13208.488397092571)
</span></span><span><span>adafactor       7.918E+22 (188532.80765144504, 7855.533652143543)
</span></span><span><span>compute_optim   7.518E+23 (1790104.1799513847, 74587.67416464102)
</span></span></code></pre></td></tr></tbody></table></div><div><table><tbody><tr><td><pre tabindex="0"><code><span>1
</span><span>2
</span><span>3
</span><span>4
</span><span>5
</span><span>6
</span><span>7
</span></code></pre></td><td><pre tabindex="0"><code data-lang="fallback"><span><span>total_flops=5.421E+24
</span></span><span><span>rental price: US$12.9M
</span></span><span><span>h100 node months required: 746.9595590938408
</span></span><span><span>
</span></span><span><span>(sanity check) D=[128, 256, 512, 768, 1024, 1536, 2048, 2560, 3072, 4096, 6144, 8192, 12288, 16384]
</span></span><span><span>(sanity check) model sizes: ['0.00979B', '0.0227B', '0.058B', '0.106B', '0.166B', '0.325B', '0.534B', '0.794B', '1.1B', '1.87B', '4.02B', '6.97B', '15.3B', '26.8B']
</span></span><span><span>(sanity check) M/6P: ['63.4%', '68.5%', '75.3%', '79.7%', '82.8%', '86.8%', '89.3%', '91.0%', '92.2%', '93.9%', '95.7%', '96.7%', '97.7%', '98.3%']
</span></span></code></pre></td></tr></tbody></table></div><p>In the grand scheme of things, 5.42e24 is “not that big”. After all, that’s not even 15% of the <a href="https://ai.meta.com/research/publications/the-llama-3-herd-of-models/" target="_blank" rel="noopener noreffer">compute used for Llama 3</a>; a <a href="https://www.semianalysis.com/p/100000-h100-clusters-power-network" target="_blank" rel="noopener noreffer">100k H100 cluster</a> could accomplish all of these experiments in just 2 days.</p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Butterflies accumulate static electricity to attract pollen without contact (196 pts)]]></title>
            <link>https://www.bristol.ac.uk/news/2024/july/butterflies-static-electricity.html</link>
            <guid>41107480</guid>
            <pubDate>Tue, 30 Jul 2024 09:32:56 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.bristol.ac.uk/news/2024/july/butterflies-static-electricity.html">https://www.bristol.ac.uk/news/2024/july/butterflies-static-electricity.html</a>, See on <a href="https://news.ycombinator.com/item?id=41107480">Hacker News</a></p>
<div id="readability-page-1" class="page"><p property="description">Butterflies and moths collect so much static electricity whilst in flight, that pollen grains from flowers can be pulled by static electricity across air gaps of several millimetres or centimetres.</p><div property="articleBody"><p>The finding, published today in the <em>Journal of the Royal Society Interface, </em>suggests that this likely increases their efficiency and effectiveness as pollinators.</p>
<p>The <a href="https://www.bristol.ac.uk/">University of Bristol</a> team also observed that the amount of static electricity carried by butterflies and moths varies between different species, and that these variations correlate with differences in their ecology, such as whether they visit flowers, are from a tropical environment, or fly during the day or night. This is the first evidence to suggest that the amount of static electricity an animal accumulates is a trait that can be adaptive, and thus evolution can act upon it by natural selection.</p>
<p>Lead author <a href="https://www.bristol.ac.uk/people/person/Sam-England-d27e3877-cc80-444b-adf7-339acff8cb39/">Dr Sam England</a> from Bristol’s <a href="https://www.bristol.ac.uk/biology/">School of Biological Sciences</a>, explained: “We already knew that many species of animal accumulate static electricity as they fly, most likely through friction with the air. There had also been suggestions that this static electricity might improve the ability of flower-visiting animals, like bees and hummingbirds, to pollinate, by attracting pollen using electrostatic attraction.</p>
<p>“However, it wasn’t known whether this idea applied to the wider array of equally important pollinators, such as butterflies and moths. So, we set out to test this idea, and see if butterflies and moths also accumulate charge, and if so, whether this charge is enough to attract pollen from flowers onto their bodies.”</p>
<p>Their study involved 269 butterflies and moths across 11 different species, native to five different continents and inhabiting multiple different ecological niches. They were then then able to compare between them and see if these ecological factors correlated with their charge, establishing if static charging is a trait that evolution can act upon.</p>
<p>Dr England added: “A clearer picture is developing of how the influence of static electricity in pollination may be very powerful and widespread.</p>
<p>“By establishing electrostatic charging as a trait upon which evolution can act, it opens up a great deal of questions about how and why natural selection might lead to animals benefiting or suffering from the amount of static electricity that they accumulate.”</p>
<p>In terms of practical applications, this study opens the door to the possibility for technologies to artificially increase the electrostatic charges or pollinators or pollen, in order to improve pollination rates in natural and agricultural settings.</p>
<p>Dr England concluded: “We’ve discovered that butterflies and moths accumulate so much static electricity when flying, that pollen is literally pulled through the air towards them as they approach a flower.</p>
<p>“This means that they don’t even need to touch flowers in order to pollinate them, making them very good at their jobs as pollinators, and highlighting just how important they might be to the functioning of our flowery ecosystems.</p>
<p>“For me personally, I would love to do a wider survey of as many different species of animal as possible, see how much static electricity they accumulate, and then look for any correlations with their ecology and lifestyle. Then we can really begin to understand how evolution and static electricity interact!”</p>

<p>Paper:</p>
<p>‘<a href="https://royalsocietypublishing.org/doi/10.1098/rsif.2024.0156">Electrostatic pollination by butterflies and moths</a>’ by Sam J. England and Daniel Robert in <em>Journal of the Royal Society Interface</em>.</p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[The lie of music discovery algorithms (124 pts)]]></title>
            <link>https://www.zeynepevecen.dev/writing/music</link>
            <guid>41107396</guid>
            <pubDate>Tue, 30 Jul 2024 09:18:58 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.zeynepevecen.dev/writing/music">https://www.zeynepevecen.dev/writing/music</a>, See on <a href="https://news.ycombinator.com/item?id=41107396">Hacker News</a></p>
&lt;Unparsable&gt;]]></description>
        </item>
        <item>
            <title><![CDATA[Canarytokens: Honeypot for critical credentials, get notified when they are used (2015) (113 pts)]]></title>
            <link>https://canarytokens.org/nest/</link>
            <guid>41107209</guid>
            <pubDate>Tue, 30 Jul 2024 08:39:44 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://canarytokens.org/nest/">https://canarytokens.org/nest/</a>, See on <a href="https://news.ycombinator.com/item?id=41107209">Hacker News</a></p>
&lt;Unparsable&gt;]]></description>
        </item>
        <item>
            <title><![CDATA[C Macro Reflection in Zig – Zig Has Better C Interop Than C Itself (268 pts)]]></title>
            <link>https://jstrieb.github.io/posts/c-reflection-zig/</link>
            <guid>41106686</guid>
            <pubDate>Tue, 30 Jul 2024 06:57:53 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://jstrieb.github.io/posts/c-reflection-zig/">https://jstrieb.github.io/posts/c-reflection-zig/</a>, See on <a href="https://news.ycombinator.com/item?id=41106686">Hacker News</a></p>
<div id="readability-page-1" class="page">



<h2 id="zig-has-better-c-interop-than-c-itself">Zig Has Better C Interop Than C Itself</h2>
<p>By <a href="https://jstrieb.github.io/">Jacob Strieb</a>.</p>
<p>Published on <a href="https://jstrieb.github.io/posts/c-reflection-zig/">July 30, 2024</a>.</p>
<hr>
<h2 id="zig">Zig</h2>
<p><a href="https://ziglang.org/learn/overview/">Zig</a> is a nascent programming language with an emphasis on low-level and systems programming that is positioned to be a C replacement.<a href="#fn1" id="fnref1" role="doc-noteref"><sup>1</sup></a> Despite being under active development (and having some rough edges as a result), Zig is extremely powerful, and is already used by a few substantial projects such as <a href="https://github.com/oven-sh/bun">Bun</a> and <a href="https://github.com/tigerbeetle/tigerbeetle">TigerBeetle</a>.</p>
<p>Zig has many interesting features, but its outstanding interoperability (“interop”) with C is especially impressive. It is easy to call an external library, as in this example from <a href="https://ziglang.org/learn/samples/">the Zig website</a>:</p>
<div id="cb1"><pre><code><span id="cb1-1"><a href="#cb1-1"></a><span>const</span> win <span>=</span> <span>@import</span>(<span>"std"</span>)<span>.</span>os<span>.</span>windows;</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span>extern</span> <span>"user32"</span> <span>fn</span> MessageBoxA(</span>
<span id="cb1-4"><a href="#cb1-4"></a>  <span>?</span>win<span>.</span>HWND<span>,</span> </span>
<span id="cb1-5"><a href="#cb1-5"></a>  [<span>*:</span><span>0</span>]<span>const</span> <span>u8</span><span>,</span> </span>
<span id="cb1-6"><a href="#cb1-6"></a>  [<span>*:</span><span>0</span>]<span>const</span> <span>u8</span><span>,</span> </span>
<span id="cb1-7"><a href="#cb1-7"></a>  <span>u32</span><span>,</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>) <span>callconv</span>(win<span>.</span>WINAPI) <span>i32</span>;</span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a><span>pub</span> <span>fn</span> main() <span>!</span><span>void</span> {</span>
<span id="cb1-11"><a href="#cb1-11"></a>    _ <span>=</span> MessageBoxA(<span>null</span><span>,</span> <span>"world!"</span><span>,</span> <span>"Hello"</span><span>,</span> <span>0</span>);</span>
<span id="cb1-12"><a href="#cb1-12"></a>}</span></code></pre></div>
<p>Calling external functions from C libraries is convenient, but lots of languages can do that. What is more impressive is that, in Zig, it is trivial to import C header files and use them as if they were regular Zig imports. We can rewrite the above to use the Windows header files, instead of manually forward-declaring <code>extern</code> functions:<a href="#fn2" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div id="cb2"><pre><code><span id="cb2-1"><a href="#cb2-1"></a><span>const</span> win32 <span>=</span> <span>@cImport</span>({</span>
<span id="cb2-2"><a href="#cb2-2"></a>    <span>@cInclude</span>(<span>"windows.h"</span>);</span>
<span id="cb2-3"><a href="#cb2-3"></a>    <span>@cInclude</span>(<span>"winuser.h"</span>);</span>
<span id="cb2-4"><a href="#cb2-4"></a>});</span>
<span id="cb2-5"><a href="#cb2-5"></a></span>
<span id="cb2-6"><a href="#cb2-6"></a><span>pub</span> <span>fn</span> main() <span>!</span><span>void</span> {</span>
<span id="cb2-7"><a href="#cb2-7"></a>    _ <span>=</span> win32<span>.</span>MessageBoxA(<span>null</span><span>,</span> <span>"world!"</span><span>,</span> <span>"Hello"</span><span>,</span> <span>0</span>);</span>
<span id="cb2-8"><a href="#cb2-8"></a>}</span></code></pre></div>
<p>The following command will compile both of the code examples above for Windows from any host operating system:</p>
<div id="cb3"><pre><code><span id="cb3-1"><a href="#cb3-1"></a><span># Using Zig 0.13.0</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span>zig</span> build-exe -lc -target x86_64-windows-gnu main.zig</span></code></pre></div>
<p>I continue to be astounded and delighted that that this code can both be written and cross-compiled so easily on any system.<a href="#fn3" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<h2 id="windows-programming">Windows Programming</h2>
<p>I have done my fair share of C programming, but until recently, I had never written a Win32 application,<a href="#fn4" id="fnref4" role="doc-noteref"><sup>4</sup></a> nor had I ever written a program in Zig.<a href="#fn5" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<p>A typical Windows application has a <code>main</code> (or <code>wWinMain</code>) function and a “window procedure” (<code>WindowProc</code>) function. The main function initializes the application, and runs the loop in which messages are dispatched to the window procedure. The window procedure receives and handles the messages, typically taking a different action for each message type. To quote <a href="https://learn.microsoft.com/en-us/windows/win32/learnwin32/window-messages">the Microsoft website</a>:</p>
<blockquote>
<p>Windows uses a message-passing model. The operating system communicates with your application window by passing messages to it. A message is simply a numeric code that designates a particular event. For example, if the user presses the left mouse button, the window receives a message that has the following message code.</p>
<div id="cb4"><pre><code><span id="cb4-1"><a href="#cb4-1"></a><span>#define WM_LBUTTONDOWN 0x0201</span></span></code></pre></div>
<p>Some messages have data associated with them. For example, the <code>WM_LBUTTONDOWN</code> message includes the x-coordinate and y-coordinate of the mouse cursor.</p>
</blockquote>
<p>In practice, the window procedure becomes an enormous <code>switch</code> statement that matches the message code (<code>uMsg</code> in the example below) against macros defined in <code>winuser.h</code>. A minimal Zig example of a Win32 application with the standard structure (abridged from <a href="https://learn.microsoft.com/en-us/windows/win32/learnwin32/your-first-windows-program">the Microsoft Win32 tutorial sequence</a>) is as follows:</p>
<div id="cb5"><pre><code><span id="cb5-1"><a href="#cb5-1"></a><span>const</span> std <span>=</span> <span>@import</span>(<span>"std"</span>);</span>
<span id="cb5-2"><a href="#cb5-2"></a><span>const</span> windows <span>=</span> std<span>.</span>os<span>.</span>windows;</span>
<span id="cb5-3"><a href="#cb5-3"></a><span>const</span> win32 <span>=</span> <span>@cImport</span>({</span>
<span id="cb5-4"><a href="#cb5-4"></a>    <span>@cInclude</span>(<span>"windows.h"</span>);</span>
<span id="cb5-5"><a href="#cb5-5"></a>    <span>@cInclude</span>(<span>"winuser.h"</span>);</span>
<span id="cb5-6"><a href="#cb5-6"></a>});</span>
<span id="cb5-7"><a href="#cb5-7"></a></span>
<span id="cb5-8"><a href="#cb5-8"></a><span>var</span> stdout<span>:</span> std<span>.</span>fs<span>.</span>File<span>.</span>Writer <span>=</span> <span>undefined</span>;</span>
<span id="cb5-9"><a href="#cb5-9"></a></span>
<span id="cb5-10"><a href="#cb5-10"></a><span>pub</span> <span>export</span> <span>fn</span> WindowProc(hwnd<span>:</span> win32<span>.</span>HWND<span>,</span> uMsg<span>:</span> <span>c_uint</span><span>,</span> wParam<span>:</span> win32<span>.</span>WPARAM<span>,</span> lParam<span>:</span> win32<span>.</span>LPARAM) <span>callconv</span>(windows<span>.</span>WINAPI) win32<span>.</span>LRESULT {</span>
<span id="cb5-11"><a href="#cb5-11"></a>    <span>// Handle each type of window message we care about</span></span>
<span id="cb5-12"><a href="#cb5-12"></a>    _ <span>=</span> <span>switch</span> (uMsg) {</span>
<span id="cb5-13"><a href="#cb5-13"></a>        win32<span>.</span>WM_CLOSE <span>=&gt;</span> win32<span>.</span>DestroyWindow(hwnd)<span>,</span></span>
<span id="cb5-14"><a href="#cb5-14"></a>        win32<span>.</span>WM_DESTROY <span>=&gt;</span> win32<span>.</span>PostQuitMessage(<span>0</span>),</span>
<span id="cb5-15"><a href="#cb5-15"></a>        <span>else</span> <span>=&gt;</span> {</span>
<span id="cb5-16"><a href="#cb5-16"></a>            stdout<span>.</span>print(<span>"Unknown window message: 0x{x:0&gt;4}</span><span>\n</span><span>"</span><span>,</span> <span>.</span>{uMsg}) <span>catch</span> <span>undefined</span>;</span>
<span id="cb5-17"><a href="#cb5-17"></a>        }<span>,</span></span>
<span id="cb5-18"><a href="#cb5-18"></a>    };</span>
<span id="cb5-19"><a href="#cb5-19"></a>    <span>return</span> win32<span>.</span>DefWindowProcA(hwnd<span>,</span> uMsg<span>,</span> wParam<span>,</span> lParam);</span>
<span id="cb5-20"><a href="#cb5-20"></a>}</span>
<span id="cb5-21"><a href="#cb5-21"></a></span>
<span id="cb5-22"><a href="#cb5-22"></a><span>pub</span> <span>export</span> <span>fn</span> main(hInstance<span>:</span> win32<span>.</span>HINSTANCE) <span>c_int</span> {</span>
<span id="cb5-23"><a href="#cb5-23"></a>    stdout <span>=</span> std<span>.</span>io<span>.</span>getStdOut()<span>.</span>writer();</span>
<span id="cb5-24"><a href="#cb5-24"></a></span>
<span id="cb5-25"><a href="#cb5-25"></a>    <span>// Windows boilerplate to set up and draw a window</span></span>
<span id="cb5-26"><a href="#cb5-26"></a>    <span>var</span> class <span>=</span> std<span>.</span>mem<span>.</span>zeroes(win32<span>.</span>WNDCLASSEXA);</span>
<span id="cb5-27"><a href="#cb5-27"></a>    class<span>.</span>cbSize <span>=</span> <span>@sizeOf</span>(win32<span>.</span>WNDCLASSEXA);</span>
<span id="cb5-28"><a href="#cb5-28"></a>    class<span>.</span>style <span>=</span> win32<span>.</span>CS_VREDRAW <span>|</span> win32<span>.</span>CS_HREDRAW;</span>
<span id="cb5-29"><a href="#cb5-29"></a>    class<span>.</span>hInstance <span>=</span> hInstance;</span>
<span id="cb5-30"><a href="#cb5-30"></a>    class<span>.</span>lpszClassName <span>=</span> <span>"Class"</span>;</span>
<span id="cb5-31"><a href="#cb5-31"></a>    class<span>.</span>lpfnWndProc <span>=</span> WindowProc; <span>// Handle messages with this function</span></span>
<span id="cb5-32"><a href="#cb5-32"></a>    _ <span>=</span> win32<span>.</span>RegisterClassExA(<span>&amp;</span>class);</span>
<span id="cb5-33"><a href="#cb5-33"></a></span>
<span id="cb5-34"><a href="#cb5-34"></a>    <span>const</span> hwnd <span>=</span> win32<span>.</span>CreateWindowExA(win32<span>.</span>WS_EX_CLIENTEDGE<span>,</span> <span>"Class"</span><span>,</span> <span>"Window"</span><span>,</span> win32<span>.</span>WS_OVERLAPPEDWINDOW<span>,</span> win32<span>.</span>CW_USEDEFAULT<span>,</span> win32<span>.</span>CW_USEDEFAULT<span>,</span> win32<span>.</span>CW_USEDEFAULT<span>,</span> win32<span>.</span>CW_USEDEFAULT<span>,</span> <span>null</span><span>,</span> <span>null</span><span>,</span> hInstance<span>,</span> <span>null</span>);</span>
<span id="cb5-35"><a href="#cb5-35"></a>    _ <span>=</span> win32<span>.</span>ShowWindow(hwnd<span>,</span> win32<span>.</span>SW_NORMAL);</span>
<span id="cb5-36"><a href="#cb5-36"></a>    _ <span>=</span> win32<span>.</span>UpdateWindow(hwnd);</span>
<span id="cb5-37"><a href="#cb5-37"></a></span>
<span id="cb5-38"><a href="#cb5-38"></a>    <span>// Dispatch messages to WindowProc</span></span>
<span id="cb5-39"><a href="#cb5-39"></a>    <span>var</span> message<span>:</span> win32<span>.</span>MSG <span>=</span> std<span>.</span>mem<span>.</span>zeroes(win32<span>.</span>MSG);</span>
<span id="cb5-40"><a href="#cb5-40"></a>    <span>while</span> (win32<span>.</span>GetMessageA(<span>&amp;</span>message<span>,</span> <span>null</span><span>,</span> <span>0</span>, <span>0</span>) <span>&gt;</span> <span>0</span>) {</span>
<span id="cb5-41"><a href="#cb5-41"></a>        _ <span>=</span> win32<span>.</span>TranslateMessage(<span>&amp;</span>message);</span>
<span id="cb5-42"><a href="#cb5-42"></a>        _ <span>=</span> win32<span>.</span>DispatchMessageA(<span>&amp;</span>message);</span>
<span id="cb5-43"><a href="#cb5-43"></a>    }</span>
<span id="cb5-44"><a href="#cb5-44"></a></span>
<span id="cb5-45"><a href="#cb5-45"></a>    <span>return</span> <span>0</span>;</span>
<span id="cb5-46"><a href="#cb5-46"></a>}</span></code></pre></div>
<p>The output of the code above looks like the following when it is run:</p>
<pre><code>Unknown window message: 0x0024
Unknown window message: 0x0081
Unknown window message: 0x0083
Unknown window message: 0x0001
...
Unknown window message: 0x0008
Unknown window message: 0x0281
Unknown window message: 0x0282
Unknown window message: 0x0082</code></pre>
<h2 id="reflection">Reflection</h2>
<p>When extending the Windows code above to handle new message types, it is troublesome to determine which C macro corresponds to each message the window procedure receives. The numeric value of each message code is printed to the standard output, but mapping the numeric values back to C macro names involves either searching through documentation, or manually walking the header <code>#include</code> tree to find the right macro declaration.</p>
<p>The underlying cause of difficulty in mapping macro values back to macro names is that C does not have <a href="https://en.wikipedia.org/wiki/Reflective_programming">reflection</a> for preprocessor macros – there is no way to get a list of all defined macros, let alone all macros with a specific value, from within C code. The preprocessor runs before the code is actually compiled, so the compiler itself is unaware of macros.<a href="#fn6" id="fnref6" role="doc-noteref"><sup>6</sup></a> The separation between the preprocessor and the compiler enables the user to <a href="https://github.com/DosX-dev/obfus.h">make advanced changes to the code at compile time</a>, but in practice, that separation means compiled code cannot introspect macros.<a href="#fn7" id="fnref7" role="doc-noteref"><sup>7</sup></a></p>
<p>Though it may not be obvious from the code above, in Zig, references to macro and non-macro declarations from imported C header files are made in the same way. For example, <code>win32.TranslateMessage</code> is a function declared in the header file, and <code>win32.WM_CLOSE</code> is a macro declared using <code>#define</code>. Both are used in Zig by doing <code>imported_name.declared_value</code>. The Zig <code>@import</code> function returns a <code>struct</code>, so regular declarations and macros, alike, are represented as fields in the struct generated from importing the C header files.</p>
<p>It is significant that declarations are represented in imports as struct fields because, unlike C, Zig <em>does</em> have reflection. In particular, the <a href="https://ziglang.org/documentation/0.13.0/#typeInfo"><code>@typeInfo</code></a> function lists the fields and declarations of structs passed to it. This means that, though we cannot introspect C macros within C, we can introspect C macros within Zig. Consequently, we can create a mapping of macro values to macro names:</p>
<div id="cb7"><pre><code><span id="cb7-1"><a href="#cb7-1"></a><span>const</span> window_messages <span>=</span> get_window_messages();</span>
<span id="cb7-2"><a href="#cb7-2"></a></span>
<span id="cb7-3"><a href="#cb7-3"></a><span>// The WM_* macros have values less than 65536, so an array of that size can</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span>// represent all of them</span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span>fn</span> get_window_messages() [<span>65536</span>][:<span>0</span>]<span>const</span> <span>u8</span> {</span>
<span id="cb7-6"><a href="#cb7-6"></a>    <span>var</span> result<span>:</span> [<span>65536</span>][:<span>0</span>]<span>const</span> <span>u8</span> <span>=</span> <span>undefined</span>;</span>
<span id="cb7-7"><a href="#cb7-7"></a>    <span>@setEvalBranchQuota</span>(<span>1000000</span>);</span>
<span id="cb7-8"><a href="#cb7-8"></a>    <span>// Loop over all struct fields and match against the expected prefix</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>    <span>for</span> (<span>@typeInfo</span>(win32)<span>.</span>Struct<span>.</span>decls) <span>|</span>field<span>|</span> {</span>
<span id="cb7-10"><a href="#cb7-10"></a>        <span>if</span> (field<span>.</span>name<span>.</span>len <span>&gt;=</span> <span>3</span> <span>and</span> std<span>.</span>mem<span>.</span>eql(<span>u8</span><span>,</span> field<span>.</span>name[<span>0</span><span>..</span><span>3</span>], "<span>WM_</span><span>")) {</span></span>
<span id="cb7-11"><a href="#cb7-11"></a>            <span>const</span> value <span>=</span> <span>@field</span>(win32<span>,</span> field<span>.</span>name);</span>
<span id="cb7-12"><a href="#cb7-12"></a>            result[value] <span>=</span> field<span>.</span>name;</span>
<span id="cb7-13"><a href="#cb7-13"></a>        }</span>
<span id="cb7-14"><a href="#cb7-14"></a>    }</span>
<span id="cb7-15"><a href="#cb7-15"></a>    <span>// We return by value here, not by reference, so this is safe to do</span></span>
<span id="cb7-16"><a href="#cb7-16"></a>    <span>return</span> result;</span>
<span id="cb7-17"><a href="#cb7-17"></a>}</span></code></pre></div>
<p>Using the global constant <code>window_messages</code>, we can change our <code>WindowProc</code> function to print more helpful information about the messages it is receiving:</p>
<div id="cb8"><pre><code><span id="cb8-1"><a href="#cb8-1"></a><span>pub</span> <span>export</span> <span>fn</span> WindowProc(hwnd<span>:</span> win32<span>.</span>HWND<span>,</span> uMsg<span>:</span> <span>c_uint</span><span>,</span> wParam<span>:</span> win32<span>.</span>WPARAM<span>,</span> lParam<span>:</span> win32<span>.</span>LPARAM) <span>callconv</span>(windows<span>.</span>WINAPI) win32<span>.</span>LRESULT {</span>
<span id="cb8-2"><a href="#cb8-2"></a>    _ <span>=</span> <span>switch</span> (uMsg) {</span>
<span id="cb8-3"><a href="#cb8-3"></a>        win32<span>.</span>WM_CLOSE <span>=&gt;</span> win32<span>.</span>DestroyWindow(hwnd)<span>,</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>        win32<span>.</span>WM_DESTROY <span>=&gt;</span> win32<span>.</span>PostQuitMessage(<span>0</span>),</span>
<span id="cb8-5"><a href="#cb8-5"></a>        <span>else</span> <span>=&gt;</span> {</span>
<span id="cb8-6"><a href="#cb8-6"></a>            <span>// New: print the macro for the current window message</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>            stdout<span>.</span>print(</span>
<span id="cb8-8"><a href="#cb8-8"></a>                <span>"{s}: 0x{x:0&gt;4}</span><span>\n</span><span>"</span><span>,</span> </span>
<span id="cb8-9"><a href="#cb8-9"></a>                <span>.</span>{ window_messages[uMsg]<span>,</span> uMsg }<span>,</span></span>
<span id="cb8-10"><a href="#cb8-10"></a>            ) <span>catch</span> <span>undefined</span>;</span>
<span id="cb8-11"><a href="#cb8-11"></a>        }<span>,</span></span>
<span id="cb8-12"><a href="#cb8-12"></a>    };</span>
<span id="cb8-13"><a href="#cb8-13"></a>    <span>return</span> win32<span>.</span>DefWindowProcA(hwnd<span>,</span> uMsg<span>,</span> wParam<span>,</span> lParam);</span>
<span id="cb8-14"><a href="#cb8-14"></a>}</span></code></pre></div>
<p>Now, the output of the program looks much nicer when run:</p>
<pre><code>...
WM_NCHITTEST: 0x0084
WM_SETCURSOR: 0x0020
WM_MOUSEMOVE: 0x0200
WM_SYSKEYDOWN: 0x0104
WM_CHAR: 0x0102
WM_KEYUP: 0x0101
WM_SYSKEYUP: 0x0105
WM_WINDOWPOSCHANGING: 0x0046
WM_WINDOWPOSCHANGED: 0x0047
WM_NCACTIVATE: 0x0086
WM_ACTIVATE: 0x0006
WM_ACTIVATEAPP: 0x001c
WM_KILLFOCUS: 0x0008
WM_IME_SETCONTEXT: 0x0281
WM_NCDESTROY: 0x0082</code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>Though this example is small, it illustrates that Zig can do what C does, but can do so more ergonomically by employing modern programming language constructs. One of Zig’s unique superpowers is that it bundles a C compiler toolchain – that is what enables it to transcend C <abbr title="Foreign Function Interface">FFI</abbr> and seamlessly include declarations from C header files, among other capabilities.</p>
<p>Incorporating C interoperability so deeply into the language highlights Zig’s prudent acknowledgment that C has been around for a long time, and is here to stay for a while longer. Integrating with C in this way means that Zig developers have had access to thousands of existing, battle-tested software libraries since the language’s first release. It also gives developers responsible for existing C or C++ codebases a path to transition them to Zig. Availability of high-quality libraries and transition paths for existing code are both critical obstacles to language adoption that Zig has cleverly bypassed by electing to subsume C in the course of replacing it.</p>
<p>Zig’s philosophy of pragmatism is apparent as soon as you begin learning the language. Within a few hours of getting started, I was able to come up with this C macro reflection trick, and also able to be generally productive. That is, to me, clear evidence of Zig’s intuitive, consistent design.<a href="#fn8" id="fnref8" role="doc-noteref"><sup>8</sup></a></p>
<p>Zig’s straightforward cross-compilation and C integration are what drew me to the language, but its philosophy and design are what will keep me here to stay.</p>
<h2 id="acknowledgments">Acknowledgments</h2>
<p>Thanks to <a href="https://github.com/lsnow99">Logan Snow</a> and <a href="https://www.linkedin.com/in/amyjl/">Amy Liu</a> for reviewing a draft of this post.</p>
<p>Shout out to <a href="https://andrewkelley.me/">Andrew Kelley</a> and the other Zig contributors.</p>
<section role="doc-endnotes">
<hr>
<ol>
<li id="fn1" role="doc-endnote"><p>Maybe also a C++ replacement, but there are more contenders vying for that role, such as Rust and Go.<a href="#fnref1" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>It’s not so bad when it’s just one external function. But when it’s tens or hundreds, importing the header file directly makes development a lot smoother.<a href="#fnref2" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p>Zig also has <code>zig cc</code>, which is a drop-in replacement for GCC and Clang that enables easier-than-ever cross-compilation for C projects. If you ever do cross-compilation, I implore you to <a href="https://andrewkelley.me/post/zig-cc-powerful-drop-in-replacement-gcc-clang.html">read this awesome intro to <code>zig cc</code></a>, then try it for yourself.<a href="#fnref3" role="doc-backlink">↩︎</a></p></li>
<li id="fn4" role="doc-endnote"><p>Mainly because getting the MSVC compiler set up for command-line use outside of Visual Studio is painful. Even figuring out what files to download and where to download them from is not straightforward. On the other hand, Zig cross-compilation has been painless.<a href="#fnref4" role="doc-backlink">↩︎</a></p></li>
<li id="fn5" role="doc-endnote"><p>As a result, I may not be writing idiomatic (or correct) Zig or Windows code. Everything included here should only be treated as “proof of concept” code for demonstrating an interesting technique.<a href="#fnref5" role="doc-backlink">↩︎</a></p></li>
<li id="fn6" role="doc-endnote"><p>Most <code>gcc</code> or <code>clang</code> invocations automatically invoke the preprocessor. When I talk about “the compiler” here, I specifically mean the C compiler proper, which runs after the preprocessor is done.<a href="#fnref6" role="doc-backlink">↩︎</a></p></li>
<li id="fn7" role="doc-endnote"><p>At least not without debug information or explicit macro name-value mappings being included in the binary. You could hack something together using <a href="https://en.wikipedia.org/wiki/X_macro">X macros</a> to achieve the latter. But those are a little gross (albeit kind of clever), and only apply if you control the header file where the macros are originally declared, which we don’t in the case of <code>windows.h</code>.<a href="#fnref7" role="doc-backlink">↩︎</a></p></li>
<li id="fn8" role="doc-endnote"><p>The design goals are best explained by Andrew Kelley, the creator of Zig, in his <a href="https://andrewkelley.me/post/intro-to-zig.html">post from 2016 introducing the language and its philosophy</a>.<a href="#fnref8" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>



</div>]]></description>
        </item>
        <item>
            <title><![CDATA[All I Know About Certificates – Certificate Authority (130 pts)]]></title>
            <link>https://www.pixelstech.net/article/1722045726-All-I-Know-About-Certificates----Certificate-Authority</link>
            <guid>41106205</guid>
            <pubDate>Tue, 30 Jul 2024 05:12:42 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.pixelstech.net/article/1722045726-All-I-Know-About-Certificates----Certificate-Authority">https://www.pixelstech.net/article/1722045726-All-I-Know-About-Certificates----Certificate-Authority</a>, See on <a href="https://news.ycombinator.com/item?id=41106205">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="article_content_panel">
		<article>
         	<p>One of the crucial steps in the TLS handshake is for the server to prove its identity to the client. While there is plenty of content explaining the principles of the handshake, there's less information about certificates, which are a critical component of TLS/SSL. This series of articles aim to explain what certificates are used for, how Google prevents others from impersonating Google, and why certificate issues frequently arise, among other topics.</p>
<p>(Postscript: It took me a full 10 hours to write these articles. It's quite straightforward, with no mathematical content, just a few OpenSSL commands. It's a long read, so feel free to grab a beer and take your time.)</p>
<p><strong>What Problem Do Certificates Solve?</strong></p>
<p>Imagine there is a bank called <code>super-bank.com</code> that holds billions of dollars in customer funds, allowing users to transfer money via its website.</p>
<p>Now, a hacker walks into a Starbucks, connects to the WiFi, and uses a fake DHCP service to tell other users on the Starbucks WiFi: "I am the gateway, let me forward your internet traffic if you want to go online!" This allows him to see all usernames and passwords of the users.</p>
<p>Some readers might say, "You can use TLS encryption!"</p>
<p>However, the hacker somehow obtains a certificate issued to <code>super-bank.com</code>, then sets up a fake server and tells users, "Trust me, I am the bank!"</p>
<p>Thus, he steals users' passwords again...</p>
<p>So, where does the problem lie? It lies in the certificate. The role of the certificate is: only the holder of the certificate is the real <code>super-bank.com</code>.</p>
<p>In other words, it proves "I am who I claim to be."</p>
<p>A common misconception is that only certificate authorities can issue certificates. In fact, anyone can issue certificates. I can create a Root certificate myself and issue certificates to any domain. There can be many certificates, but clients must only trust those that are <em>valid</em>.</p>
<p>So, which certificates are trustworthy? The ones issued by authoritative certificate authorities (CAs).</p>
<p>The complexity of this topic arises because these three participants—<strong>client</strong>, <strong>CA</strong>, and <strong>website</strong>—are interconnected yet each has its own responsibilities. During discussions, it’s easy to confuse their roles, leading to misunderstandings. Therefore, this series of articles will discuss the issues and actions of these participants separately, hoping to clarify the matter.</p>
<p>Their relationship is:</p>
<ul>
<li>The client trusts the CA.</li>
<li>The CA issues certificates to websites.</li>
<li>When a client visits a website, the website presents its certificate. Since the client trusts the CA, it also trusts the certificate issued by the CA.</li>
</ul>
<p>It's similar to dining at a restaurant: how do you know it's not a scam? You check if the restaurant has a business license issued by the regulatory authority. If the restaurant has a license issued by the authority, you trust the restaurant.</p>
<p>Now, the problem seems simple, but if we think about ways to break this chain of trust, we realize that solving this "trust" issue is not straightforward.</p>
<p>For example, can I apply to a CA for a certificate issued to <code>super-bank.com</code>? Why wouldn’t the CA issue this certificate to me?&nbsp;</p>
<h2>Certificate Authorities</h2>
<p>Certificate Authorities (CAs) have three main responsibilities:</p>
<ol>
<li>To Websites: When someone applies for a certificate, I must verify the applicant's identity. If they are not super-bank.com, I cannot issue the certificate to them.</li>
<li>To Themselves: Protect the private key of their root certificate.</li>
<li>To Clients: Be trusted by clients.</li>
</ol>
<h2>Verifying Website Identity</h2>
<p>We cannot issue certificates to the wrong person, as this would allow the certificate holder to impersonate others. Therefore, for all applicants, we must ensure they indeed have control over the domain before issuing a certificate. This means verifying the applicant's identity.</p>
<p>The industry standard for this is called the <a href="https://letsencrypt.org/docs/challenge-types/" target="_blank" rel="noopener">ACME Challenge</a>. The basic principle is: to prove to me (the CA) that you are <code>super-bank.com</code>, you need to make the URL <code>super-bank.com/.well-known/acme-challenge/foo</code> return the text <code>bar</code>. This demonstrates your control over the domain, and I will issue the certificate to you. (There are other methods supported as well, such as DNS TXT records.)</p>
<h2>Safeguarding the Private Key</h2>
<p>CAs must protect their private key because if it is leaked, they can no longer fulfill their role. The holder of the leaked key can issue certificates at will. If a private key is compromised, it would be catastrophic for the CA. All certificates issued by the CA would need to be revoked, websites would need to redeploy new certificates, and if clients do not promptly revoke the compromised CA, they could be at risk of accessing fraudulent servers, leading to potential account theft and fraud.</p>
<p>Given the numerous websites that need certificates (including reissuance upon expiration), it would be highly inefficient for the CA to access the private key from a secure vault for each certificate issuance.</p>
<h2>Use of Intermediate Certificates</h2>
<p>To address this, the CA Root certificate usually does not directly issue certificates to websites. Instead, it issues an intermediate certificate, which is then used to issue certificates to websites.</p>
<p>This is where <a href="https://en.wikipedia.org/wiki/X.509" target="_blank" rel="noopener">x509</a> comes in: if a client trusts the CA, then the client should trust certificates issued by the CA, and should trust certificates issued by those certificates, and so on. However, does this mean that a certificate issued to me by the CA can be used by me to issue other certificates? That would mean anyone could use the CA's credibility to issue certificates.</p>
<h2>Certificate Signing</h2>
<p>Of course not. CA-issued certificates include an <code>X509v3 Basic Constraints: critical</code> field, with the value <code>CA:FALSE</code>. By downloading the certificate for this blog and using the OpenSSL tool to parse it, you can see that in this certificate chain, both the Root and Intermediate certificates have CA:TRUE, while my certificate has CA:FALSE.</p>
<p><img src="https://www.pixelstech.net/article/images/site-cert-ca-false.png" width="750"></p>
<p>The CA:FALSE value on certificates issued to entities means that even if they issue a certificate, it won't be trusted. Can we modify this field to issue certificates?&nbsp;</p>
<p>The answer is yes, but if I modify my own certificate, the modified certificate will no longer be trusted.</p>
<h2>Trust Chain</h2>
<p>Client –trust–&gt; Root CA –trust–&gt; Intermediate CA –NOT trust –&gt; kawabangga.com — NOT trust –&gt; super-bank.com signed by kawabangga.com</p>
<p>Why is the modified certificate not trusted?&nbsp;</p>
<h2>Certificate Issuance Process</h2>
<p>The certificate issuance process is straightforward, utilizing the characteristics of private and public keys:</p>
<ul>
<li>Data signed with a private key can be verified with the public key.</li>
<li>Data encrypted with the public key can be decrypted with the private key.</li>
</ul>
<p>Simplified, it means data encrypted with one key can only be decrypted with the other key. One key is released as the public key, and the other is kept private.</p>
<p>The process of signing essentially involves encryption:</p>
<ol>
<li>Hash the entire certificate, then encrypt the hash value with the private key.</li>
<li>The verifier hashes the entire certificate, obtains the hash value, then uses the public key to decrypt the encrypted hash value. If the values match, it confirms the private key holder performed the encryption.</li>
</ol>
<h2>Client Verification Process</h2>
<p>The client verifies the certificate by comparing the hash value decrypted with the public key to the hash value it calculates.</p>
<p>This ensures:</p>
<ul>
<li>The signer cannot deny their actions, as only the private key holder can sign.</li>
<li>The signed content cannot be altered; any modification will cause the verification to fail.</li>
</ul>
<p>Thus, after the CA signs the certificate, no part of the certificate can be modified, including CA:FALSE and the validity period. If expired, the certificate must be re-signed. Simply changing the date to extend its use is not possible.</p>
<p>Many people mistakenly believe that certificate issuance involves the CA signing with its certificate. In reality, the CA only uses its private key to append an encrypted hash value to the original certificate.</p>
<h2>Certificate Authorities Must Be Trusted by Clients</h2>
<p>The foundation of everything is that clients must trust the CA. The trust in all other certificates stems from the trust in the CA Root certificate.</p>
<p>Building trust is a long process.</p>
<p>So how does a client trust a CA? The answer is that clients store the CA locally. The specific location depends on the client: for example, on Linux, it’s in <code>/etc/ssl/certs</code>, on Mac, it can be viewed using Keychain. Chrome’s trusted certificates are <a href="https://chromium.googlesource.com/chromium/src/+/main/net/data/ssl/chrome_root_store/root_store.md" target="_blank" rel="noopener">here</a>, Mozilla’s are <a href="https://wiki.mozilla.org/CA/Included_Certificates" target="_blank" rel="noopener">here</a>.</p>
<p>Given the vast number of clients in the world, adding a new CA seems difficult!</p>
<p>Actually, it’s not. a group of ambitious people created an organization called <a href="https://letsencrypt.org/" target="_blank" rel="noopener"><strong>Let’s Encrypt</strong></a> in 2013: "We want to issue free certificates to all websites needing TLS/SSL! In a friendly manner! Because we want a safer and more private internet."</p>
<p>Where does trust come from for a new CA? In fact, this CA doesn’t need to spend many years slowly gaining the trust of all clients. As mentioned earlier, it only needs a single Root CA’s trust. If a client trusts an old CA, and the old CA signs the new CA, the client will trust the new CA. In this case, the old CA is DST Root CA X3. Following this logic, clients trust DST Root CA X3, and thus trust certificates signed by DST Root CA X3 for Let’s Encrypt, and also trust intermediate certificates signed by Let’s Encrypt, but not further down. Remember CA:FALSE?</p>
<p>With so many certificates, how does a client verify them? It sounds troublesome, and it’s unclear who to trust.&nbsp;</p>
<p>Let's explore the role of clients next:</p>
<ul>
<li><a href="https://www.pixelstech.net/article/1722050582-All-I-Know-About-Certificates----Clients">All I Know About Certificates -- Clients</a></li>
<li><a href="https://www.pixelstech.net/article/1722050937-All-I-Know-About-Certificates----Websites">All I Know About Certificates -- Websites</a></li>
</ul>
<p>Reference:&nbsp;<a href="https://www.kawabangga.com/posts/5330" target="_blank" rel="noopener">https://www.kawabangga.com/posts/5330</a></p>		 </article>
     </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Lewis Lapham has died (178 pts)]]></title>
            <link>https://www.nytimes.com/2024/07/24/business/media/lewis-h-lapham-dead.html</link>
            <guid>41106041</guid>
            <pubDate>Tue, 30 Jul 2024 04:26:29 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.nytimes.com/2024/07/24/business/media/lewis-h-lapham-dead.html">https://www.nytimes.com/2024/07/24/business/media/lewis-h-lapham-dead.html</a>, See on <a href="https://news.ycombinator.com/item?id=41106041">Hacker News</a></p>
Couldn't get https://www.nytimes.com/2024/07/24/business/media/lewis-h-lapham-dead.html: Error: Request failed with status code 403]]></description>
        </item>
        <item>
            <title><![CDATA[If we want a shift to walking, we need to prioritize dignity (288 pts)]]></title>
            <link>https://www.strongtowns.org/journal/2023/7/28/if-we-want-a-shift-to-walking-we-need-to-prioritize-dignity</link>
            <guid>41105944</guid>
            <pubDate>Tue, 30 Jul 2024 03:59:52 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.strongtowns.org/journal/2023/7/28/if-we-want-a-shift-to-walking-we-need-to-prioritize-dignity">https://www.strongtowns.org/journal/2023/7/28/if-we-want-a-shift-to-walking-we-need-to-prioritize-dignity</a>, See on <a href="https://news.ycombinator.com/item?id=41105944">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-nc-base="header" data-controller="AncillaryLayout">
          

          <main>
            
              <section data-content-field="main-content">
                <article id="post-64c2930926f82617bbca3aa5" data-item-id="64c2930926f82617bbca3aa5">

    
      
    

    <div data-layout-label="Post Body" data-type="item" data-updated-on="1690477370700" id="item-64c2930926f82617bbca3aa5"><div data-test="image-block-inline-outer-wrapper" data-block-type="5" id="block-yui_3_17_2_1_1690466434279_269191">

      

      
        <figure>
          
        
        

        
          
            
          <div data-animation-role="image">
            <p><img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/eacf6bfa-c47f-49a1-ae89-74d7c932c612/dignity-comparison-scaled-e1689281726969-624x328.jpg" data-image="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/eacf6bfa-c47f-49a1-ae89-74d7c932c612/dignity-comparison-scaled-e1689281726969-624x328.jpg" data-image-dimensions="624x328" data-image-focal-point="0.5,0.5" alt="" data-load="false" elementtiming="system-image-block" src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/eacf6bfa-c47f-49a1-ae89-74d7c932c612/dignity-comparison-scaled-e1689281726969-624x328.jpg" width="624" height="328" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/eacf6bfa-c47f-49a1-ae89-74d7c932c612/dignity-comparison-scaled-e1689281726969-624x328.jpg?format=100w 100w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/eacf6bfa-c47f-49a1-ae89-74d7c932c612/dignity-comparison-scaled-e1689281726969-624x328.jpg?format=300w 300w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/eacf6bfa-c47f-49a1-ae89-74d7c932c612/dignity-comparison-scaled-e1689281726969-624x328.jpg?format=500w 500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/eacf6bfa-c47f-49a1-ae89-74d7c932c612/dignity-comparison-scaled-e1689281726969-624x328.jpg?format=750w 750w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/eacf6bfa-c47f-49a1-ae89-74d7c932c612/dignity-comparison-scaled-e1689281726969-624x328.jpg?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/eacf6bfa-c47f-49a1-ae89-74d7c932c612/dignity-comparison-scaled-e1689281726969-624x328.jpg?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/eacf6bfa-c47f-49a1-ae89-74d7c932c612/dignity-comparison-scaled-e1689281726969-624x328.jpg?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs">

            </p>
          </div>
        
          
        

        
      
        </figure>
      

    </div><div data-block-type="2" data-border-radii="{&quot;topLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;topRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0}}" id="block-fa7aad9dfb45a96bb22e">
  <p>Have you ever had a friend return from a vacation and gush about how great it was to walk in the place they’d visited? “You can walk everywhere! To a café, to the store. It was amazing!” Immediately after saying that, your friend hops in their car and drives across the parking lot to the Starbucks to which they could easily have walked.</p><p>Why does walking feel so intuitive when we’re in a city built before cars, yet as soon as we return home, walking feels like an unpleasant chore that immediately drives us into a car?</p><p>A lot contributes to this dilemma, like the density of the city, or the relative cheapness and convenience of driving. But there’s a bigger factor here: We don’t design the pedestrian experience for dignity.</p><p>This is a national problem, but certainly one those of us in the Minneapolis–Saint Paul metropolitan area can see throughout the Twin Cities metro: Even where pedestrian facilities are built, brand-new, ADA-compliant, and everything else—using them feels like a chore, or even stressful and unpleasant.</p><p>Dignity is a really important concept in active transportation, but one that we often miss in the conversation about making streets better for walking and biking. I’ve been delighted to see the term appear on&nbsp;<a href="https://www.instagram.com/pedestriandignity/">a social media account advocating for pedestrians</a>. But as we plan and design better streets for active transportation, we need to consider the dignity of the pedestrian experience.</p><h2>A Hierarchy of Needs</h2><p>Three related concepts exist in designing great pedestrian spaces, and they can be arranged similarly to Maslow’s hierarchy of needs. The base of the pyramid is the most essential, but having a complete and delightful pedestrian experience requires all three layers. The layers are compliance, safety, and dignity.</p>
</div><div data-test="image-block-inline-outer-wrapper" data-block-type="5" id="block-yui_3_17_2_1_1690466434279_272938">

      

      
        <figure>
          
        
        

        
          
            
          <div data-animation-role="image">
            <p><img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/11ec90a8-fe26-4d02-bb28-ac29fea82b45/dignity-triangle-500x500.png" data-image="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/11ec90a8-fe26-4d02-bb28-ac29fea82b45/dignity-triangle-500x500.png" data-image-dimensions="500x500" data-image-focal-point="0.5,0.5" alt="" data-load="false" elementtiming="system-image-block" src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/11ec90a8-fe26-4d02-bb28-ac29fea82b45/dignity-triangle-500x500.png" width="500" height="500" sizes="(max-width: 640px) 100vw, (max-width: 767px) 50vw, 50vw" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/11ec90a8-fe26-4d02-bb28-ac29fea82b45/dignity-triangle-500x500.png?format=100w 100w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/11ec90a8-fe26-4d02-bb28-ac29fea82b45/dignity-triangle-500x500.png?format=300w 300w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/11ec90a8-fe26-4d02-bb28-ac29fea82b45/dignity-triangle-500x500.png?format=500w 500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/11ec90a8-fe26-4d02-bb28-ac29fea82b45/dignity-triangle-500x500.png?format=750w 750w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/11ec90a8-fe26-4d02-bb28-ac29fea82b45/dignity-triangle-500x500.png?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/11ec90a8-fe26-4d02-bb28-ac29fea82b45/dignity-triangle-500x500.png?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/11ec90a8-fe26-4d02-bb28-ac29fea82b45/dignity-triangle-500x500.png?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs">

            </p>
          </div>
        
          
        

        
      
        </figure>
      

    </div><div data-block-type="2" data-border-radii="{&quot;topLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;topRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0}}" id="block-yui_3_17_2_1_1690466434279_273322">

<p>
  <h2><strong>Compliance</strong>: Often Not Enough</h2>
</p>




















  
  



</div><div data-test="image-block-inline-outer-wrapper" data-block-type="5" id="block-yui_3_17_2_1_1690466434279_176851">

      

      
        <figure>
          
        
        

        
          
            
          <div data-animation-role="image">
            <p><img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/84362759-87a9-4025-bb23-e600862816e0/shady-oak-road-1024x575.jpg" data-image="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/84362759-87a9-4025-bb23-e600862816e0/shady-oak-road-1024x575.jpg" data-image-dimensions="1024x575" data-image-focal-point="0.5,0.5" alt="" data-load="false" elementtiming="system-image-block" src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/84362759-87a9-4025-bb23-e600862816e0/shady-oak-road-1024x575.jpg" width="1024" height="575" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/84362759-87a9-4025-bb23-e600862816e0/shady-oak-road-1024x575.jpg?format=100w 100w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/84362759-87a9-4025-bb23-e600862816e0/shady-oak-road-1024x575.jpg?format=300w 300w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/84362759-87a9-4025-bb23-e600862816e0/shady-oak-road-1024x575.jpg?format=500w 500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/84362759-87a9-4025-bb23-e600862816e0/shady-oak-road-1024x575.jpg?format=750w 750w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/84362759-87a9-4025-bb23-e600862816e0/shady-oak-road-1024x575.jpg?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/84362759-87a9-4025-bb23-e600862816e0/shady-oak-road-1024x575.jpg?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/84362759-87a9-4025-bb23-e600862816e0/shady-oak-road-1024x575.jpg?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs">

            </p>
          </div>
        
          
        

        
          
          <figcaption>
            <p><em>Shady Oak Road in Hopkins is ADA compliant, but crossing here could be unsafe for any user. (Source: Google Street View.)</em></p>
          </figcaption>
        
      
        </figure>
      

    </div><div data-block-type="2" data-border-radii="{&quot;topLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;topRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0}}" id="block-yui_3_17_2_1_1690466434279_177240">
  <p>At the bottom of the pyramid you have compliance—for pedestrian facilities, that mainly means complying with ADA rules. This requirement is non-negotiable for agencies because failure to obey exposes them to legal challenges. The ADA has done a great deal to make pedestrian facilities better for all—certainly wheelchair users, but also those who walk, use strollers, ride bicycles on sidewalks, etc.</p><p>Unfortunately, compliance with ADA rules&nbsp;<em>alone</em>&nbsp;often does not yield good pedestrian facilities.</p>
</div><div data-test="image-block-inline-outer-wrapper" data-block-type="5" id="block-yui_3_17_2_1_1690466434279_307522">

      

      
        <figure>
          
        
        

        
          
            
          <div data-animation-role="image">
            <p><img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/7241ef8c-b669-46d3-b562-f976acfe94ac/bad-faith-compliance-1024x650.jpg" data-image="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/7241ef8c-b669-46d3-b562-f976acfe94ac/bad-faith-compliance-1024x650.jpg" data-image-dimensions="1024x650" data-image-focal-point="0.5,0.5" alt="" data-load="false" elementtiming="system-image-block" src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/7241ef8c-b669-46d3-b562-f976acfe94ac/bad-faith-compliance-1024x650.jpg" width="1024" height="650" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/7241ef8c-b669-46d3-b562-f976acfe94ac/bad-faith-compliance-1024x650.jpg?format=100w 100w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/7241ef8c-b669-46d3-b562-f976acfe94ac/bad-faith-compliance-1024x650.jpg?format=300w 300w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/7241ef8c-b669-46d3-b562-f976acfe94ac/bad-faith-compliance-1024x650.jpg?format=500w 500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/7241ef8c-b669-46d3-b562-f976acfe94ac/bad-faith-compliance-1024x650.jpg?format=750w 750w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/7241ef8c-b669-46d3-b562-f976acfe94ac/bad-faith-compliance-1024x650.jpg?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/7241ef8c-b669-46d3-b562-f976acfe94ac/bad-faith-compliance-1024x650.jpg?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/7241ef8c-b669-46d3-b562-f976acfe94ac/bad-faith-compliance-1024x650.jpg?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs">

            </p>
          </div>
        
          
        

        
          
          <figcaption>
            <p><em>As part of an ADA upgrade project, Edina and Hennepin County removed the north leg crosswalk, requiring pedestrians to cross this busy intersection three times to proceed on the north-side sidewalk.</em></p>
          </figcaption>
        
      
        </figure>
      

    </div><div data-block-type="2" data-border-radii="{&quot;topLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;topRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0}}" id="block-yui_3_17_2_1_1690466434279_307906">

<p>For example, many agencies will simply remove pedestrian facilities to reduce the cost of compliance. A good example is the intersection of France and Parklawn Avenues in Edina. If you were on the west side of France and wanted to walk to the Allina clinic in 2013, you could simply have crossed on the north crosswalk. But to improve ADA compliance, Edina removed the north crosswalk in 2014. Now, you would have to cross the busy signalized intersection three times just to continue on the north sidewalk.</p>




















  
  



</div><div data-test="image-block-inline-outer-wrapper" data-block-type="5" id="block-yui_3_17_2_1_1690466434279_186897">

      

      
        <figure>
          
        
        

        
          
            
          <div data-animation-role="image">
            <p><img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/5b58d6aa-e00f-4432-aacf-492fb990cb85/removed-ped-button-500x472.jpg" data-image="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/5b58d6aa-e00f-4432-aacf-492fb990cb85/removed-ped-button-500x472.jpg" data-image-dimensions="500x472" data-image-focal-point="0.5,0.5" alt="" data-load="false" elementtiming="system-image-block" src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/5b58d6aa-e00f-4432-aacf-492fb990cb85/removed-ped-button-500x472.jpg" width="500" height="472" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/5b58d6aa-e00f-4432-aacf-492fb990cb85/removed-ped-button-500x472.jpg?format=100w 100w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/5b58d6aa-e00f-4432-aacf-492fb990cb85/removed-ped-button-500x472.jpg?format=300w 300w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/5b58d6aa-e00f-4432-aacf-492fb990cb85/removed-ped-button-500x472.jpg?format=500w 500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/5b58d6aa-e00f-4432-aacf-492fb990cb85/removed-ped-button-500x472.jpg?format=750w 750w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/5b58d6aa-e00f-4432-aacf-492fb990cb85/removed-ped-button-500x472.jpg?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/5b58d6aa-e00f-4432-aacf-492fb990cb85/removed-ped-button-500x472.jpg?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/5b58d6aa-e00f-4432-aacf-492fb990cb85/removed-ped-button-500x472.jpg?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs">

            </p>
          </div>
        
          
        

        
          
          <figcaption>
            <p><em>The crosswalk at France and Parklawn, showing the rusted outline of the former pedestrian push button. (Source: Google Street View.)</em></p>
          </figcaption>
        
      
        </figure>
      

    </div><div data-block-type="2" data-border-radii="{&quot;topLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;topRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0}}" id="block-yui_3_17_2_1_1690466434279_187356">

<p>In other cases, compliance is in good faith but not enough to make a pedestrian facility really usable—because complete compliance would entail a much larger project. This can be found when a broken-down sidewalk, or one with obstructions in the way, gets brand-new corner curb ramps but no other improvements. A wheelchair user can easily get up off the street at the corner, but can’t go farther than 10 feet without hitting another impediment.</p>




















  
  



</div><div data-test="image-block-inline-outer-wrapper" data-block-type="5" id="block-yui_3_17_2_1_1690466434279_328267">

      

      
        <figure>
          
        
        

        
          
            
          <div data-animation-role="image">
            <p><img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/f5951cb9-8f79-4bd9-8cc3-70aba0dd4c47/31st-2nd-1024x663.jpg" data-image="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/f5951cb9-8f79-4bd9-8cc3-70aba0dd4c47/31st-2nd-1024x663.jpg" data-image-dimensions="1024x663" data-image-focal-point="0.5,0.5" alt="" data-load="false" elementtiming="system-image-block" src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/f5951cb9-8f79-4bd9-8cc3-70aba0dd4c47/31st-2nd-1024x663.jpg" width="1024" height="663" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/f5951cb9-8f79-4bd9-8cc3-70aba0dd4c47/31st-2nd-1024x663.jpg?format=100w 100w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/f5951cb9-8f79-4bd9-8cc3-70aba0dd4c47/31st-2nd-1024x663.jpg?format=300w 300w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/f5951cb9-8f79-4bd9-8cc3-70aba0dd4c47/31st-2nd-1024x663.jpg?format=500w 500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/f5951cb9-8f79-4bd9-8cc3-70aba0dd4c47/31st-2nd-1024x663.jpg?format=750w 750w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/f5951cb9-8f79-4bd9-8cc3-70aba0dd4c47/31st-2nd-1024x663.jpg?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/f5951cb9-8f79-4bd9-8cc3-70aba0dd4c47/31st-2nd-1024x663.jpg?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/f5951cb9-8f79-4bd9-8cc3-70aba0dd4c47/31st-2nd-1024x663.jpg?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs">

            </p>
          </div>
        
          
        

        
          
          <figcaption>
            <p><em>This new curb ramp and pedestrian push buttons at 31st and 2nd are great, but if you’re a wheelchair user, they won’t help you for long: not 10 feet away, you’ll encounter a section of sidewalk too narrow to pass due to a street light. (Source: Google Street View.)</em></p>
          </figcaption>
        
      
        </figure>
      

    </div><div data-block-type="2" data-border-radii="{&quot;topLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;topRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0}}" id="block-yui_3_17_2_1_1690466434279_328651">

<p>
  <h2><strong>Safety</strong>: A Step Further, But What Is Still Lacking?</h2>
</p>




















  
  



</div><div data-test="image-block-inline-outer-wrapper" data-block-type="5" id="block-yui_3_17_2_1_1690466434279_342585">

      

      
        <figure>
          
        
        

        
          
            
          <div data-animation-role="image">
            <p><img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/62eb6023-1935-489a-b92e-49dfe8bc0f3d/58th-st-undignified-1024x768.jpg" data-image="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/62eb6023-1935-489a-b92e-49dfe8bc0f3d/58th-st-undignified-1024x768.jpg" data-image-dimensions="1024x768" data-image-focal-point="0.5,0.5" alt="" data-load="false" elementtiming="system-image-block" src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/62eb6023-1935-489a-b92e-49dfe8bc0f3d/58th-st-undignified-1024x768.jpg" width="1024" height="768" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/62eb6023-1935-489a-b92e-49dfe8bc0f3d/58th-st-undignified-1024x768.jpg?format=100w 100w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/62eb6023-1935-489a-b92e-49dfe8bc0f3d/58th-st-undignified-1024x768.jpg?format=300w 300w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/62eb6023-1935-489a-b92e-49dfe8bc0f3d/58th-st-undignified-1024x768.jpg?format=500w 500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/62eb6023-1935-489a-b92e-49dfe8bc0f3d/58th-st-undignified-1024x768.jpg?format=750w 750w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/62eb6023-1935-489a-b92e-49dfe8bc0f3d/58th-st-undignified-1024x768.jpg?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/62eb6023-1935-489a-b92e-49dfe8bc0f3d/58th-st-undignified-1024x768.jpg?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/62eb6023-1935-489a-b92e-49dfe8bc0f3d/58th-st-undignified-1024x768.jpg?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs">

            </p>
          </div>
        
          
        

        
          
          <figcaption>
            <p><em>58th Street in Edina is ADA compliant and probably safe enough to cross with low volumes. But the experience is undignified, with little separation from car traffic, and no shade.</em></p>
          </figcaption>
        
      
        </figure>
      

    </div><div data-block-type="2" data-border-radii="{&quot;topLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;topRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0}}" id="block-yui_3_17_2_1_1690466434279_342970">
  <p>In the middle of the pyramid, you have safety—both perceived and actual. It is possible to create a facility that is compliant but does not seem very safe. Picture sparkling new curb ramps to cross a 45-mph surface street with no marked crosswalk. In other cases, facilities are well-designed and safe, but may still not be dignified.</p><p>An example of this is in my own backyard, on Hennepin County’s Nicollet Avenue. A very-welcome project last year installed new crosswalks to popular Augsburg Park. These have durable crosswalk markings, excellent signage, and refuge medians. But crossing still feels like a negotiation with drivers. And the overall sidewalk experience on the 1950s street is still lacking, with sidewalks at the back-of-curb and little to no shade.</p>
</div><div data-test="image-block-inline-outer-wrapper" data-block-type="5" id="block-yui_3_17_2_1_1690466434279_203270">

      

      
        <figure>
          
        
        

        
          
            
          <div data-animation-role="image">
            <p><img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/f2dde0f3-ac22-425f-9294-a2f3f090419e/nicollet-ave-500x375.jpg" data-image="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/f2dde0f3-ac22-425f-9294-a2f3f090419e/nicollet-ave-500x375.jpg" data-image-dimensions="500x375" data-image-focal-point="0.5,0.5" alt="" data-load="false" elementtiming="system-image-block" src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/f2dde0f3-ac22-425f-9294-a2f3f090419e/nicollet-ave-500x375.jpg" width="500" height="375" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/f2dde0f3-ac22-425f-9294-a2f3f090419e/nicollet-ave-500x375.jpg?format=100w 100w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/f2dde0f3-ac22-425f-9294-a2f3f090419e/nicollet-ave-500x375.jpg?format=300w 300w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/f2dde0f3-ac22-425f-9294-a2f3f090419e/nicollet-ave-500x375.jpg?format=500w 500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/f2dde0f3-ac22-425f-9294-a2f3f090419e/nicollet-ave-500x375.jpg?format=750w 750w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/f2dde0f3-ac22-425f-9294-a2f3f090419e/nicollet-ave-500x375.jpg?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/f2dde0f3-ac22-425f-9294-a2f3f090419e/nicollet-ave-500x375.jpg?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/f2dde0f3-ac22-425f-9294-a2f3f090419e/nicollet-ave-500x375.jpg?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs">

            </p>
          </div>
        
          
        

        
          
          <figcaption>
            <p><em>Nicollet Avenue and 71st Street in Richfield.</em></p>
          </figcaption>
        
      
        </figure>
      

    </div><div data-block-type="2" data-border-radii="{&quot;topLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;topRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0}}" id="block-yui_3_17_2_1_1690466434279_203657">
  <h2><strong>Dignity</strong>: Making Walking Feel Right</h2><p>Finally, we have dignity.&nbsp;To determine whether a facility is dignified, I propose a simple test:</p><p>If you were driving past and saw a friend walking or rolling there, what would your first thought be:</p><ol data-rte-list="default"><li><p>“Oh, no, Henry’s car must have broken down! I better offer him a ride.”</p></li><li><p>“Oh, looks like Henry’s out for a walk! I should text him later.”</p></li></ol><p>This is a surprisingly good test. Picture seeing your friend on a leafy sidewalk versus walking along a 45 mph suburban arterial.&nbsp;<strong>What would you think intuitively?</strong></p><p>But to get more specific, these are the key factors in making a pedestrian experience dignified:</p><ul data-rte-list="default"><li><p>Shade and light.</p></li><li><p>Convenience.</p></li><li><p>Enclosure and proportions.</p></li><li><p>Engagement.</p></li></ul><h3>Shade and Light</h3>
</div><div data-test="image-block-inline-outer-wrapper" data-block-type="5" id="block-yui_3_17_2_1_1690466434279_358827">

      

      
        <figure>
          
        
        

        
          
            
          <div data-animation-role="image">
            <p><img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/ae4bbafa-17df-484b-8d2e-0c6c72683f28/northfield-sidewalk-375x500.jpg" data-image="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/ae4bbafa-17df-484b-8d2e-0c6c72683f28/northfield-sidewalk-375x500.jpg" data-image-dimensions="375x250" data-image-focal-point="0.5,0.5" alt="" data-load="false" elementtiming="system-image-block" src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/ae4bbafa-17df-484b-8d2e-0c6c72683f28/northfield-sidewalk-375x500.jpg" width="375" height="250" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/ae4bbafa-17df-484b-8d2e-0c6c72683f28/northfield-sidewalk-375x500.jpg?format=100w 100w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/ae4bbafa-17df-484b-8d2e-0c6c72683f28/northfield-sidewalk-375x500.jpg?format=300w 300w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/ae4bbafa-17df-484b-8d2e-0c6c72683f28/northfield-sidewalk-375x500.jpg?format=500w 500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/ae4bbafa-17df-484b-8d2e-0c6c72683f28/northfield-sidewalk-375x500.jpg?format=750w 750w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/ae4bbafa-17df-484b-8d2e-0c6c72683f28/northfield-sidewalk-375x500.jpg?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/ae4bbafa-17df-484b-8d2e-0c6c72683f28/northfield-sidewalk-375x500.jpg?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/ae4bbafa-17df-484b-8d2e-0c6c72683f28/northfield-sidewalk-375x500.jpg?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs">

            </p>
          </div>
        
          
        

        
          
          <figcaption>
            <p><em>St. Olaf Avenue in Northfield has a dignified amount of shade—not tunnel-like, but keeping the sidewalk cool and protected from the sun.</em></p>
          </figcaption>
        
      
        </figure>
      

    </div><div data-block-type="2" data-border-radii="{&quot;topLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;topRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0}}" id="block-yui_3_17_2_1_1690466434279_359211">

<p>A dignified facility needs consistent shade during hot summer months. At night, shadows should be minimal and the route should be clear. Especially when a tree canopy is present, this is best achieved with more individual fixtures installed lower to the ground and at a lower light output. However, a fairly consistent light level can be achieved even with basic cobraheads, as long as there are enough to light the corridor fully.</p>




















  
  



</div><div data-test="image-block-inline-outer-wrapper" data-block-type="5" id="block-yui_3_17_2_1_1690466434279_373830">

      

      
        <figure>
          
        
        

        
          
            
          <div data-animation-role="image">
            <p><img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/4b9d977a-b718-4096-9e40-f247fa7907b5/dignity-less-light-scaled.jpg" data-image="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/4b9d977a-b718-4096-9e40-f247fa7907b5/dignity-less-light-scaled.jpg" data-image-dimensions="3404x1915" data-image-focal-point="0.5,0.5" alt="" data-load="false" elementtiming="system-image-block" src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/4b9d977a-b718-4096-9e40-f247fa7907b5/dignity-less-light-scaled.jpg" width="3404" height="1915" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/4b9d977a-b718-4096-9e40-f247fa7907b5/dignity-less-light-scaled.jpg?format=100w 100w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/4b9d977a-b718-4096-9e40-f247fa7907b5/dignity-less-light-scaled.jpg?format=300w 300w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/4b9d977a-b718-4096-9e40-f247fa7907b5/dignity-less-light-scaled.jpg?format=500w 500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/4b9d977a-b718-4096-9e40-f247fa7907b5/dignity-less-light-scaled.jpg?format=750w 750w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/4b9d977a-b718-4096-9e40-f247fa7907b5/dignity-less-light-scaled.jpg?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/4b9d977a-b718-4096-9e40-f247fa7907b5/dignity-less-light-scaled.jpg?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/4b9d977a-b718-4096-9e40-f247fa7907b5/dignity-less-light-scaled.jpg?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs">

            </p>
          </div>
        
          
        

        
          
          <figcaption>
            <p><em>The flowers are beautiful, but a dark street at night is less dignified than a well-lit one. Left is 70th Street near Garfield Avenue; right is Lyndale and 75th.</em></p>
          </figcaption>
        
      
        </figure>
      

    </div><div data-block-type="2" data-border-radii="{&quot;topLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;topRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0}}" id="block-yui_3_17_2_1_1690466434279_374215">
  <h3>Convenience</h3><p>Routes should be intuitive, easy, and not feel tedious to navigate. Having to make sharp, 90° turns or go out of your way feels awkward and makes you feel like your time and effort are wasted—even if the detour is relatively minor.</p>
</div><div data-test="image-block-inline-outer-wrapper" data-block-type="5" id="block-yui_3_17_2_1_1690466434279_229652">

      

      
        <figure>
          
        
        

        
          
            
          <div data-animation-role="image">
            <p><img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/fbf174d1-526f-433e-a75e-cf811929e2ec/inconvenient-routing-1024x768.jpg" data-image="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/fbf174d1-526f-433e-a75e-cf811929e2ec/inconvenient-routing-1024x768.jpg" data-image-dimensions="1024x768" data-image-focal-point="0.5,0.5" alt="" data-load="false" elementtiming="system-image-block" src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/fbf174d1-526f-433e-a75e-cf811929e2ec/inconvenient-routing-1024x768.jpg" width="1024" height="768" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/fbf174d1-526f-433e-a75e-cf811929e2ec/inconvenient-routing-1024x768.jpg?format=100w 100w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/fbf174d1-526f-433e-a75e-cf811929e2ec/inconvenient-routing-1024x768.jpg?format=300w 300w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/fbf174d1-526f-433e-a75e-cf811929e2ec/inconvenient-routing-1024x768.jpg?format=500w 500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/fbf174d1-526f-433e-a75e-cf811929e2ec/inconvenient-routing-1024x768.jpg?format=750w 750w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/fbf174d1-526f-433e-a75e-cf811929e2ec/inconvenient-routing-1024x768.jpg?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/fbf174d1-526f-433e-a75e-cf811929e2ec/inconvenient-routing-1024x768.jpg?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/fbf174d1-526f-433e-a75e-cf811929e2ec/inconvenient-routing-1024x768.jpg?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs">

            </p>
          </div>
        
          
        

        
          
          <figcaption>
            <p><em>Inconvenient pedestrian routing at York and 66th.</em></p>
          </figcaption>
        
      
        </figure>
      

    </div><div data-test="image-block-inline-outer-wrapper" data-block-type="5" id="block-yui_3_17_2_1_1690466434279_393561">

      

      
        <figure>
          
        
        

        
          
            
          <div data-animation-role="image">
            <p><img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/93461139-dd7a-46a0-86a1-387431fe14fc/bloomington-sidewalk-inconvenient-1024x768.jpg" data-image="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/93461139-dd7a-46a0-86a1-387431fe14fc/bloomington-sidewalk-inconvenient-1024x768.jpg" data-image-dimensions="1024x768" data-image-focal-point="0.5,0.5" alt="" data-load="false" elementtiming="system-image-block" src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/93461139-dd7a-46a0-86a1-387431fe14fc/bloomington-sidewalk-inconvenient-1024x768.jpg" width="1024" height="768" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/93461139-dd7a-46a0-86a1-387431fe14fc/bloomington-sidewalk-inconvenient-1024x768.jpg?format=100w 100w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/93461139-dd7a-46a0-86a1-387431fe14fc/bloomington-sidewalk-inconvenient-1024x768.jpg?format=300w 300w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/93461139-dd7a-46a0-86a1-387431fe14fc/bloomington-sidewalk-inconvenient-1024x768.jpg?format=500w 500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/93461139-dd7a-46a0-86a1-387431fe14fc/bloomington-sidewalk-inconvenient-1024x768.jpg?format=750w 750w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/93461139-dd7a-46a0-86a1-387431fe14fc/bloomington-sidewalk-inconvenient-1024x768.jpg?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/93461139-dd7a-46a0-86a1-387431fe14fc/bloomington-sidewalk-inconvenient-1024x768.jpg?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/93461139-dd7a-46a0-86a1-387431fe14fc/bloomington-sidewalk-inconvenient-1024x768.jpg?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs">

            </p>
          </div>
        
          
        

        
          
          <figcaption>
            <p><em>A winding path around a bus stop pull-out on 82nd Street.</em></p>
          </figcaption>
        
      
        </figure>
      

    </div><div data-block-type="2" data-border-radii="{&quot;topLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;topRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0}}" id="block-yui_3_17_2_1_1690466434279_230061">

<p>
  <h3>Enclosure and Proportions</h3>
</p>




















  
  



</div><div data-test="image-block-inline-outer-wrapper" data-block-type="5" id="block-yui_3_17_2_1_1690466434279_402269">

      

      
        <figure>
          
        
        

        
          
            
          <div data-animation-role="image">
            <p><img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/617a965d-a450-458e-9370-4688a6d53bab/hopkins.jpg" data-image="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/617a965d-a450-458e-9370-4688a6d53bab/hopkins.jpg" data-image-dimensions="3143x1768" data-image-focal-point="0.5,0.5" alt="" data-load="false" elementtiming="system-image-block" src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/617a965d-a450-458e-9370-4688a6d53bab/hopkins.jpg" width="3143" height="1768" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/617a965d-a450-458e-9370-4688a6d53bab/hopkins.jpg?format=100w 100w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/617a965d-a450-458e-9370-4688a6d53bab/hopkins.jpg?format=300w 300w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/617a965d-a450-458e-9370-4688a6d53bab/hopkins.jpg?format=500w 500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/617a965d-a450-458e-9370-4688a6d53bab/hopkins.jpg?format=750w 750w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/617a965d-a450-458e-9370-4688a6d53bab/hopkins.jpg?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/617a965d-a450-458e-9370-4688a6d53bab/hopkins.jpg?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/617a965d-a450-458e-9370-4688a6d53bab/hopkins.jpg?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs">

            </p>
          </div>
        
          
        

        
          
          <figcaption>
            <p><em>Compare these two streets in Hopkins: Shady Oak Road, which is wide open without a sense of enclosure, and Eighth Avenue, which is better proportioned with a clear street wall.</em></p>
          </figcaption>
        
      
        </figure>
      

    </div><div data-block-type="2" data-border-radii="{&quot;topLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;topRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0}}" id="block-yui_3_17_2_1_1690466434279_402653">
  <p>It’s a very uncomfortable experience to walk along a wide-open corridor with no walls or edge definition—and it’s a common experience along suburban arterials, where you may have a wide road on one side and a wide-open parking lot on the other. You feel exposed and vulnerable. At the same time, overgrown sidewalks or ones that encroach on pedestrian space can feel claustrophobic and inconvenient. The right balance is needed.</p><h3>Engagement</h3>
</div><div data-test="image-block-inline-outer-wrapper" data-block-type="5" id="block-yui_3_17_2_1_1690466434279_243247">

      

      
        <figure>
          
        
        

        
          
            
          <div data-animation-role="image">
            <p><img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/8e5f9c79-b1cc-4fa8-bc6a-10fd4f2448a8/bp-sidewalk-blank-walls-1024x766.jpg" data-image="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/8e5f9c79-b1cc-4fa8-bc6a-10fd4f2448a8/bp-sidewalk-blank-walls-1024x766.jpg" data-image-dimensions="1024x766" data-image-focal-point="0.5,0.5" alt="" data-load="false" elementtiming="system-image-block" src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/8e5f9c79-b1cc-4fa8-bc6a-10fd4f2448a8/bp-sidewalk-blank-walls-1024x766.jpg" width="1024" height="766" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/8e5f9c79-b1cc-4fa8-bc6a-10fd4f2448a8/bp-sidewalk-blank-walls-1024x766.jpg?format=100w 100w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/8e5f9c79-b1cc-4fa8-bc6a-10fd4f2448a8/bp-sidewalk-blank-walls-1024x766.jpg?format=300w 300w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/8e5f9c79-b1cc-4fa8-bc6a-10fd4f2448a8/bp-sidewalk-blank-walls-1024x766.jpg?format=500w 500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/8e5f9c79-b1cc-4fa8-bc6a-10fd4f2448a8/bp-sidewalk-blank-walls-1024x766.jpg?format=750w 750w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/8e5f9c79-b1cc-4fa8-bc6a-10fd4f2448a8/bp-sidewalk-blank-walls-1024x766.jpg?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/8e5f9c79-b1cc-4fa8-bc6a-10fd4f2448a8/bp-sidewalk-blank-walls-1024x766.jpg?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/8e5f9c79-b1cc-4fa8-bc6a-10fd4f2448a8/bp-sidewalk-blank-walls-1024x766.jpg?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs">

            </p>
          </div>
        
          
        

        
          
          <figcaption>
            <p><em>This sidewalk in Brooklyn Park has only the frontage of dilapidated privacy fences.</em></p>
          </figcaption>
        
      
        </figure>
      

    </div><div data-block-type="2" data-border-radii="{&quot;topLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;topRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0}}" id="block-yui_3_17_2_1_1690466434279_243639">
  <p>Finally, engaging frontage is always more appealing than blank frontage. The extreme of this principle is obvious: Walking down a traditional main street is more pleasurable than walking through an industrial park. But even where land uses are similar, engagement of frontage can vary a lot: picture the difference between walking past the front doors of houses in a traditional neighborhood, and walking past privacy fences and back yards in cul-de-sac suburban neighborhoods. The traditional neighborhood is more interesting and engaging to walk through.</p><p>When I was visiting downtown Northfield, I noted a new building along Water Street (MN-3), which had similar materials to the older downtown buildings on Division: windows, brick, and (cultured) stone base. Yet the back was turned to the street, and the experience of walking past was undignified.</p>
</div><div data-test="image-block-inline-outer-wrapper" data-block-type="5" id="block-yui_3_17_2_1_1690466434279_417919">

      

      
        <figure>
          
        
        

        
          
            
          <div data-animation-role="image">
            <p><img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/2a72184f-93f4-4640-8a39-4b951303a944/northfield-unengaging-2-scaled.jpg" data-image="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/2a72184f-93f4-4640-8a39-4b951303a944/northfield-unengaging-2-scaled.jpg" data-image-dimensions="3413x1920" data-image-focal-point="0.5,0.5" alt="" data-load="false" elementtiming="system-image-block" src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/2a72184f-93f4-4640-8a39-4b951303a944/northfield-unengaging-2-scaled.jpg" width="3413" height="1920" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/2a72184f-93f4-4640-8a39-4b951303a944/northfield-unengaging-2-scaled.jpg?format=100w 100w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/2a72184f-93f4-4640-8a39-4b951303a944/northfield-unengaging-2-scaled.jpg?format=300w 300w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/2a72184f-93f4-4640-8a39-4b951303a944/northfield-unengaging-2-scaled.jpg?format=500w 500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/2a72184f-93f4-4640-8a39-4b951303a944/northfield-unengaging-2-scaled.jpg?format=750w 750w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/2a72184f-93f4-4640-8a39-4b951303a944/northfield-unengaging-2-scaled.jpg?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/2a72184f-93f4-4640-8a39-4b951303a944/northfield-unengaging-2-scaled.jpg?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/2a72184f-93f4-4640-8a39-4b951303a944/northfield-unengaging-2-scaled.jpg?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs">

            </p>
          </div>
        
          
        

        
          
          <figcaption>
            <p><em>Consider the visual interest of these buildings in downtown Northfield. On the left, walking past tinted windows and blank walls on a new building along a concurrent section of Water Street and Highway 3 on the west side of downtown. On the right are Division Street’s engaging storefronts.</em></p>
          </figcaption>
        
      
        </figure>
      

    </div><div data-block-type="2" data-border-radii="{&quot;topLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;topRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0}}" id="block-yui_3_17_2_1_1690466434279_418303">
  <h2>A Pedestrian Cannot Live on Compliance Alone</h2><p>Creating compliant sidewalks and trails is a high priority for agencies seeking to avoid litigation and serve pedestrians on the most basic level. Although that has some benefits, it isn’t enough. Whether actively undermining walkability (like removing crosswalks to achieve ADA compliance) to simply not doing enough (adding a new curb ramp to an otherwise wheelchair-hostile sidewalk), we need to go much further.</p><p>To make walking and rolling a desirable, everyday activity, we need facilities that are compliant, safe, and dignified. We have many examples in our communities of great pedestrian ways—but we have a long way to go to make it universal, and truly move the needle toward walking.</p>
</div><div><div data-test="image-block-inline-outer-wrapper" data-block-type="5" id="block-yui_3_17_2_1_1690466434279_154204">

      

      
        <figure>
          
        
        

        
          
            
          <div data-animation-role="image">
            <p><img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/1054aab5-9291-401b-aa56-3bd8d697b2c9/sean-2014.jpg" data-image="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/1054aab5-9291-401b-aa56-3bd8d697b2c9/sean-2014.jpg" data-image-dimensions="300x200" data-image-focal-point="0.5,0.5" alt="" data-load="false" elementtiming="system-image-block" src="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/1054aab5-9291-401b-aa56-3bd8d697b2c9/sean-2014.jpg" width="300" height="200" sizes="(max-width: 640px) 100vw, (max-width: 767px) 25vw, 25vw" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/1054aab5-9291-401b-aa56-3bd8d697b2c9/sean-2014.jpg?format=100w 100w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/1054aab5-9291-401b-aa56-3bd8d697b2c9/sean-2014.jpg?format=300w 300w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/1054aab5-9291-401b-aa56-3bd8d697b2c9/sean-2014.jpg?format=500w 500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/1054aab5-9291-401b-aa56-3bd8d697b2c9/sean-2014.jpg?format=750w 750w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/1054aab5-9291-401b-aa56-3bd8d697b2c9/sean-2014.jpg?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/1054aab5-9291-401b-aa56-3bd8d697b2c9/sean-2014.jpg?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/53dd6676e4b0fedfbc26ea91/1054aab5-9291-401b-aa56-3bd8d697b2c9/sean-2014.jpg?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs">

            </p>
          </div>
        
          
        

        
      
        </figure>
      

    </div><div data-block-type="2" data-border-radii="{&quot;topLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;topRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomLeft&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0},&quot;bottomRight&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;value&quot;:0.0}}" id="block-yui_3_17_2_1_1690466434279_138835">

<p><a href="https://sdho.org/"><strong>Sean Hayford Oleary</strong></a> is a web developer and planner. He serves on the Richfield City Council, and previously on the city's Planning and Transportation commissions. Articles are written from a personal perspective and not on behalf of Richfield or others. Sean has a masters in urban planning from the Humphrey School. Follow his love of streets, home improvement, and all things Richfield on Twitter <a href="https://twitter.com/sdho">@sdho</a>.</p>




















  
  



</div></div></div>

    

    

    

  </article>





  
              </section>
            
          </main>

        </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[A Visual Guide to LLM Quantization (259 pts)]]></title>
            <link>https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization</link>
            <guid>41105881</guid>
            <pubDate>Tue, 30 Jul 2024 03:42:10 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization">https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization</a>, See on <a href="https://news.ycombinator.com/item?id=41105881">Hacker News</a></p>
<div id="readability-page-1" class="page"><div dir="auto"><p>As their name suggests, Large Language Models (LLMs) are often too large to run on consumer hardware. These models may exceed billions of parameters and generally need GPUs with large amounts of VRAM to speed up inference.</p><p><span>As such, more and more research has been focused on making these models smaller through improved training, adapters, etc. One major technique in this field is called </span><em>quantization</em><span>.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe9d17077-d9af-4b37-9b9b-57ef9aaa1ca9_680x486.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe9d17077-d9af-4b37-9b9b-57ef9aaa1ca9_680x486.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe9d17077-d9af-4b37-9b9b-57ef9aaa1ca9_680x486.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe9d17077-d9af-4b37-9b9b-57ef9aaa1ca9_680x486.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe9d17077-d9af-4b37-9b9b-57ef9aaa1ca9_680x486.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe9d17077-d9af-4b37-9b9b-57ef9aaa1ca9_680x486.png" width="680" height="486" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/e9d17077-d9af-4b37-9b9b-57ef9aaa1ca9_680x486.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:486,&quot;width&quot;:680,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:25448,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:false,&quot;topImage&quot;:true,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe9d17077-d9af-4b37-9b9b-57ef9aaa1ca9_680x486.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe9d17077-d9af-4b37-9b9b-57ef9aaa1ca9_680x486.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe9d17077-d9af-4b37-9b9b-57ef9aaa1ca9_680x486.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe9d17077-d9af-4b37-9b9b-57ef9aaa1ca9_680x486.png 1456w" sizes="100vw" fetchpriority="high"></picture></div></a></figure></div><p>In this post, I will introduce the field of quantization in the context of language modeling and explore concepts one by one to develop an intuition about the field. We will explore various methodologies, use cases, and the principles behind quantization. </p><p>As a visual guide, expect many visualizations to develop an intuition about quantization!</p><h5><strong>Table of Contents</strong></h5><ul><li><p><em><strong>Part 1: The “Problem” with Large Language Models</strong></em></p><ul><li><p><a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#%C2%A7how-to-represent-numerical-values" rel="">How to Represent Numerical Values</a></p></li><li><p><a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#%C2%A7memory-constraints" rel="">Memory Constraints</a></p></li></ul></li><li><p><em><strong>Part 2: Introduction to Quantization</strong></em></p><ul><li><p><a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#%C2%A7common-data-types" rel="">Common Data Types</a></p><ul><li><p><a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#%C2%A7fp16" rel="">FP16</a></p></li><li><p><a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#%C2%A7bf16" rel="">BF16</a></p></li><li><p><a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#%C2%A7int8" rel="">INT8</a></p></li></ul></li><li><p><a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#%C2%A7symmetric-quantization" rel="">Symmetric Quantization</a></p></li><li><p><a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#%C2%A7asymmetric-quantization" rel="">Asymmetric Quantization</a></p></li><li><p><a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#%C2%A7range-mapping-and-clipping" rel="">Range Mapping and Clipping</a></p></li><li><p><a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#%C2%A7calibration" rel="">Calibration</a></p><ul><li><p><a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#%C2%A7weights-and-biases" rel="">Weights (and Biases)</a></p></li><li><p><a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#%C2%A7activations" rel="">Activations</a></p></li></ul></li></ul></li><li><p><em><strong>Part 3: Post-Training Quantization (PTQ)</strong></em></p><ul><li><p><a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#%C2%A7dynamic-quantization" rel="">Dynamic Quantization</a></p></li><li><p><a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#%C2%A7static-quantization" rel="">Static Quantization</a></p></li><li><p><a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#%C2%A7the-realm-of-bit-quantization" rel="">The Realm of 4-bit Quantization</a></p><ul><li><p><a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#%C2%A7gptq" rel="">GPTQ</a></p></li><li><p><a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#%C2%A7gguf" rel="">GGUF</a></p></li></ul></li></ul></li><li><p><em><strong>Part 4: Quantization-Aware Training (QAT)</strong></em></p><ul><li><p><a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#%C2%A7the-era-of-bit-llms-bitnet" rel="">The Era of 1-bit LLMs: BitNet</a></p><ul><li><p><a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#%C2%A7weight-quantization" rel="">Weight Quantization</a></p></li><li><p><a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#%C2%A7activation-quantization" rel="">Activation Quantization</a></p></li><li><p><a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#%C2%A7dequantization" rel="">Dequantization</a></p></li></ul></li><li><p><a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#%C2%A7all-large-language-models-are-in-bits" rel="">All Large Language Models are in 1.58 Bits</a></p><ul><li><p><a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#%C2%A7the-power-of" rel="">The Power of 0</a></p></li><li><p><a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#%C2%A7quantization" rel="">Quantization</a></p></li></ul></li></ul></li></ul><p><span>LLMs get their name due to the number of parameters they contain. Nowadays, these models typically have billions of parameters (mostly </span><em>weights</em><span>) which can be quite expensive to store. </span></p><p>During inference, activations are created as a product of the input and the weights, which similarly can be quite large.</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb99fe2ba-d4f4-4046-850c-e3f469add123_1368x708.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb99fe2ba-d4f4-4046-850c-e3f469add123_1368x708.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb99fe2ba-d4f4-4046-850c-e3f469add123_1368x708.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb99fe2ba-d4f4-4046-850c-e3f469add123_1368x708.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb99fe2ba-d4f4-4046-850c-e3f469add123_1368x708.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb99fe2ba-d4f4-4046-850c-e3f469add123_1368x708.png" width="1368" height="708" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/b99fe2ba-d4f4-4046-850c-e3f469add123_1368x708.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:708,&quot;width&quot;:1368,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:82794,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb99fe2ba-d4f4-4046-850c-e3f469add123_1368x708.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb99fe2ba-d4f4-4046-850c-e3f469add123_1368x708.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb99fe2ba-d4f4-4046-850c-e3f469add123_1368x708.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb99fe2ba-d4f4-4046-850c-e3f469add123_1368x708.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>As a result, we would like to represent billions of values as efficiently as possible, minimizing the amount of space we need to store a given value.</p><p>Let’s start from the beginning and explore how numerical values are represented in the first place before optimizing them. </p><p><span>A given value is often represented as a floating point number (or </span><em>floats</em><span> in computer science): a positive or negative number with a decimal point. </span></p><p><span>These values are represented by “</span><em>bits</em><span>”, or binary digits. The </span><a href="https://en.wikipedia.org/wiki/IEEE_754" rel="">IEEE-754</a><span> standard describes how bits can represent one of three functions to represent the value: the </span><em>sign</em><span>, </span><em>exponent</em><span>, or </span><em>fraction (</em><span>or mantissa</span><em>)</em><span>.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc8362c0e-0a77-4eda-80a8-8e5e1df4433f_1252x308.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc8362c0e-0a77-4eda-80a8-8e5e1df4433f_1252x308.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc8362c0e-0a77-4eda-80a8-8e5e1df4433f_1252x308.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc8362c0e-0a77-4eda-80a8-8e5e1df4433f_1252x308.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc8362c0e-0a77-4eda-80a8-8e5e1df4433f_1252x308.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc8362c0e-0a77-4eda-80a8-8e5e1df4433f_1252x308.png" width="1252" height="308" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/c8362c0e-0a77-4eda-80a8-8e5e1df4433f_1252x308.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:308,&quot;width&quot;:1252,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:27154,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc8362c0e-0a77-4eda-80a8-8e5e1df4433f_1252x308.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc8362c0e-0a77-4eda-80a8-8e5e1df4433f_1252x308.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc8362c0e-0a77-4eda-80a8-8e5e1df4433f_1252x308.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc8362c0e-0a77-4eda-80a8-8e5e1df4433f_1252x308.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>Together, these three aspects can be used to calculate a value given a certain set of bit values:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F4783fd02-a138-40c7-82c7-79dd05a179e4_1472x772.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F4783fd02-a138-40c7-82c7-79dd05a179e4_1472x772.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F4783fd02-a138-40c7-82c7-79dd05a179e4_1472x772.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F4783fd02-a138-40c7-82c7-79dd05a179e4_1472x772.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F4783fd02-a138-40c7-82c7-79dd05a179e4_1472x772.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F4783fd02-a138-40c7-82c7-79dd05a179e4_1472x772.png" width="1456" height="764" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/4783fd02-a138-40c7-82c7-79dd05a179e4_1472x772.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:764,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:68090,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F4783fd02-a138-40c7-82c7-79dd05a179e4_1472x772.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F4783fd02-a138-40c7-82c7-79dd05a179e4_1472x772.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F4783fd02-a138-40c7-82c7-79dd05a179e4_1472x772.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F4783fd02-a138-40c7-82c7-79dd05a179e4_1472x772.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>The more bits we use to represent a value, the more precise it generally is:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1eafac2a-d027-4d66-95de-7030e0392b39_1796x940.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1eafac2a-d027-4d66-95de-7030e0392b39_1796x940.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1eafac2a-d027-4d66-95de-7030e0392b39_1796x940.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1eafac2a-d027-4d66-95de-7030e0392b39_1796x940.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1eafac2a-d027-4d66-95de-7030e0392b39_1796x940.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1eafac2a-d027-4d66-95de-7030e0392b39_1796x940.png" width="1456" height="762" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/1eafac2a-d027-4d66-95de-7030e0392b39_1796x940.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:762,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:94299,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1eafac2a-d027-4d66-95de-7030e0392b39_1796x940.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1eafac2a-d027-4d66-95de-7030e0392b39_1796x940.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1eafac2a-d027-4d66-95de-7030e0392b39_1796x940.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1eafac2a-d027-4d66-95de-7030e0392b39_1796x940.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>The more bits we have available, the larger the range of values that can be represented.</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff306b7f1-dd3c-4001-91d3-bd61f22c5782_1128x452.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff306b7f1-dd3c-4001-91d3-bd61f22c5782_1128x452.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff306b7f1-dd3c-4001-91d3-bd61f22c5782_1128x452.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff306b7f1-dd3c-4001-91d3-bd61f22c5782_1128x452.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff306b7f1-dd3c-4001-91d3-bd61f22c5782_1128x452.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff306b7f1-dd3c-4001-91d3-bd61f22c5782_1128x452.png" width="1128" height="452" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/f306b7f1-dd3c-4001-91d3-bd61f22c5782_1128x452.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:452,&quot;width&quot;:1128,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:35878,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff306b7f1-dd3c-4001-91d3-bd61f22c5782_1128x452.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff306b7f1-dd3c-4001-91d3-bd61f22c5782_1128x452.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff306b7f1-dd3c-4001-91d3-bd61f22c5782_1128x452.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff306b7f1-dd3c-4001-91d3-bd61f22c5782_1128x452.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>The interval of representable numbers a given representation can take is called the </span><em>dynamic range</em><span> whereas the distance between two neighboring values is called </span><em>precision</em><span>.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7dbb8398-9f3f-4d9a-b63f-591cb37bdbdd_1144x856.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7dbb8398-9f3f-4d9a-b63f-591cb37bdbdd_1144x856.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7dbb8398-9f3f-4d9a-b63f-591cb37bdbdd_1144x856.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7dbb8398-9f3f-4d9a-b63f-591cb37bdbdd_1144x856.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7dbb8398-9f3f-4d9a-b63f-591cb37bdbdd_1144x856.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7dbb8398-9f3f-4d9a-b63f-591cb37bdbdd_1144x856.png" width="1144" height="856" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/7dbb8398-9f3f-4d9a-b63f-591cb37bdbdd_1144x856.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:856,&quot;width&quot;:1144,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:61500,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7dbb8398-9f3f-4d9a-b63f-591cb37bdbdd_1144x856.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7dbb8398-9f3f-4d9a-b63f-591cb37bdbdd_1144x856.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7dbb8398-9f3f-4d9a-b63f-591cb37bdbdd_1144x856.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7dbb8398-9f3f-4d9a-b63f-591cb37bdbdd_1144x856.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>A nifty feature of these bits is that we can calculate how much memory your device needs to store a given value. Since there are 8 bits in a byte of memory, we can create a basic formula for most forms of floating point representation.</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe146740d-72e9-44dc-99e1-f7bc42737cec_1128x144.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe146740d-72e9-44dc-99e1-f7bc42737cec_1128x144.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe146740d-72e9-44dc-99e1-f7bc42737cec_1128x144.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe146740d-72e9-44dc-99e1-f7bc42737cec_1128x144.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe146740d-72e9-44dc-99e1-f7bc42737cec_1128x144.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe146740d-72e9-44dc-99e1-f7bc42737cec_1128x144.png" width="1128" height="144" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/e146740d-72e9-44dc-99e1-f7bc42737cec_1128x144.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:144,&quot;width&quot;:1128,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:9756,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe146740d-72e9-44dc-99e1-f7bc42737cec_1128x144.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe146740d-72e9-44dc-99e1-f7bc42737cec_1128x144.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe146740d-72e9-44dc-99e1-f7bc42737cec_1128x144.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe146740d-72e9-44dc-99e1-f7bc42737cec_1128x144.png 1456w" sizes="100vw" loading="lazy"></picture></div></a><figcaption><strong>NOTE</strong><span>: In practice, more things relate to the amount of (V)RAM you need during inference, like the context size and architecture.</span></figcaption></figure></div><p><span>Now let’s assume that we have a model with 70 billion parameters. Most models are natively represented with float 32-bit (often called </span><em>full-precision</em><span>), which would require </span><strong>280GB</strong><span> of memory just to load the model.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9c28e9b0-c002-4a49-9441-af24f261df40_1128x548.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9c28e9b0-c002-4a49-9441-af24f261df40_1128x548.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9c28e9b0-c002-4a49-9441-af24f261df40_1128x548.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9c28e9b0-c002-4a49-9441-af24f261df40_1128x548.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9c28e9b0-c002-4a49-9441-af24f261df40_1128x548.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9c28e9b0-c002-4a49-9441-af24f261df40_1128x548.png" width="1128" height="548" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/9c28e9b0-c002-4a49-9441-af24f261df40_1128x548.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:548,&quot;width&quot;:1128,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:32296,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9c28e9b0-c002-4a49-9441-af24f261df40_1128x548.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9c28e9b0-c002-4a49-9441-af24f261df40_1128x548.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9c28e9b0-c002-4a49-9441-af24f261df40_1128x548.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9c28e9b0-c002-4a49-9441-af24f261df40_1128x548.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>As such, it is very compelling to minimize the number of bits to represent the parameters of your model (as well as during training!). However, as the precision decreases the accuracy of the models generally does as well. </p><p><span>We want to reduce the number of bits representing values while maintaining accuracy… This is where </span><em>quantization</em><span> comes in!</span></p><p>Quantization aims to reduce the precision of a model’s parameter from higher bit-widths (like 32-bit floating point) to lower bit-widths (like 8-bit integers).</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82ac8f88-0cf5-4244-ba9f-cbffdb283947_1008x496.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82ac8f88-0cf5-4244-ba9f-cbffdb283947_1008x496.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82ac8f88-0cf5-4244-ba9f-cbffdb283947_1008x496.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82ac8f88-0cf5-4244-ba9f-cbffdb283947_1008x496.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82ac8f88-0cf5-4244-ba9f-cbffdb283947_1008x496.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82ac8f88-0cf5-4244-ba9f-cbffdb283947_1008x496.png" width="1008" height="496" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/82ac8f88-0cf5-4244-ba9f-cbffdb283947_1008x496.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:496,&quot;width&quot;:1008,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:39183,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82ac8f88-0cf5-4244-ba9f-cbffdb283947_1008x496.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82ac8f88-0cf5-4244-ba9f-cbffdb283947_1008x496.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82ac8f88-0cf5-4244-ba9f-cbffdb283947_1008x496.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82ac8f88-0cf5-4244-ba9f-cbffdb283947_1008x496.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>There is often some loss of precision (granularity) when reducing the number of bits to represent the original parameters. </p><p>To illustrate this effect, we can take any image and use only 8 colors to represent it:</p><p>Notice how the zoomed-in part seems more “grainy” than the original since we can use fewer colors to represent it.</p><p>The main goal of quantization is to reduce the number of bits (colors) needed to represent the original parameters while preserving the precision of the original parameters as best as possible. </p><p><span>First, let’s look at common data types and the impact of using them rather than 32-bit (called </span><em>full-precision</em><span> or </span><em>FP32</em><span>) representations.</span></p><p><span>Let’s look at an example of going from 32-bit to 16-bit (called </span><em>half precision </em><span>or </span><em>FP16</em><span>) floating point:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4ac888a-02b9-4153-915a-e103a12c33a4_1460x892.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4ac888a-02b9-4153-915a-e103a12c33a4_1460x892.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4ac888a-02b9-4153-915a-e103a12c33a4_1460x892.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4ac888a-02b9-4153-915a-e103a12c33a4_1460x892.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4ac888a-02b9-4153-915a-e103a12c33a4_1460x892.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4ac888a-02b9-4153-915a-e103a12c33a4_1460x892.png" width="1456" height="890" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/f4ac888a-02b9-4153-915a-e103a12c33a4_1460x892.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:890,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:64559,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4ac888a-02b9-4153-915a-e103a12c33a4_1460x892.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4ac888a-02b9-4153-915a-e103a12c33a4_1460x892.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4ac888a-02b9-4153-915a-e103a12c33a4_1460x892.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4ac888a-02b9-4153-915a-e103a12c33a4_1460x892.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>Notice how the range of values FP16 can take is quite a bit smaller than FP32. </p><p><span>To get a similar range of values as the original FP32, </span><em>bfloat 16</em><span> was introduced as a type of “truncated FP32”:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F172c93aa-58ae-4d11-8cb7-2917c265cb68_1460x936.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F172c93aa-58ae-4d11-8cb7-2917c265cb68_1460x936.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F172c93aa-58ae-4d11-8cb7-2917c265cb68_1460x936.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F172c93aa-58ae-4d11-8cb7-2917c265cb68_1460x936.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F172c93aa-58ae-4d11-8cb7-2917c265cb68_1460x936.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F172c93aa-58ae-4d11-8cb7-2917c265cb68_1460x936.png" width="1456" height="933" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/172c93aa-58ae-4d11-8cb7-2917c265cb68_1460x936.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:933,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:62352,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F172c93aa-58ae-4d11-8cb7-2917c265cb68_1460x936.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F172c93aa-58ae-4d11-8cb7-2917c265cb68_1460x936.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F172c93aa-58ae-4d11-8cb7-2917c265cb68_1460x936.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F172c93aa-58ae-4d11-8cb7-2917c265cb68_1460x936.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>BF16 uses the same amount of bits as FP16 but can take a wider range of values and is often used in deep learning applications. </p><p><span>When we reduce the number of bits even further, we approach the realm of </span><em>integer-based representations</em><span> rather than floating-point representations. To illustrate, going FP32 to INT8, which has only 8 bits, results in a fourth of the original number of bits:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa37a58d-1f5a-433c-b235-5b073596bbca_1460x848.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa37a58d-1f5a-433c-b235-5b073596bbca_1460x848.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa37a58d-1f5a-433c-b235-5b073596bbca_1460x848.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa37a58d-1f5a-433c-b235-5b073596bbca_1460x848.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa37a58d-1f5a-433c-b235-5b073596bbca_1460x848.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa37a58d-1f5a-433c-b235-5b073596bbca_1460x848.png" width="1456" height="846" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/fa37a58d-1f5a-433c-b235-5b073596bbca_1460x848.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:846,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:59925,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa37a58d-1f5a-433c-b235-5b073596bbca_1460x848.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa37a58d-1f5a-433c-b235-5b073596bbca_1460x848.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa37a58d-1f5a-433c-b235-5b073596bbca_1460x848.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa37a58d-1f5a-433c-b235-5b073596bbca_1460x848.png 1456w" sizes="100vw" loading="lazy"></picture></div></a><figcaption>Depending on the hardware, integer-based calculations might be faster than floating-point calculations but this isn’t always the case. However, computations are generally faster when using fewer bits. </figcaption></figure></div><p>For each reduction in bits, a mapping is performed to “squeeze” the initial FP32 representations into lower bits. </p><p>In practice, we do not need to map the entire FP32 range [-3.4e38, 3.4e38] into INT8. We merely need to find a way to map the range of our data (the model’s parameters) into IN8. </p><p><span>Common squeezing/mapping methods are </span><em>symmetric</em><span> and </span><em>asymmetric</em><span> quantization and are forms of </span><em>linear mapping</em><span>. </span></p><p>Let’s explore these methods to quantize from FP32 to INT8.</p><p>In symmetric quantization, the range of the original floating-point values is mapped to a symmetric range around zero in the quantized space. In the previous examples, notice how the ranges before and after quantization remain centered around zero.</p><p>This means that the quantized value for zero in the floating-point space is exactly zero in the quantized space.</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F730bbb8a-3a44-47f6-aefe-f652b117ae22_1124x600.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F730bbb8a-3a44-47f6-aefe-f652b117ae22_1124x600.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F730bbb8a-3a44-47f6-aefe-f652b117ae22_1124x600.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F730bbb8a-3a44-47f6-aefe-f652b117ae22_1124x600.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F730bbb8a-3a44-47f6-aefe-f652b117ae22_1124x600.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F730bbb8a-3a44-47f6-aefe-f652b117ae22_1124x600.png" width="1124" height="600" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/730bbb8a-3a44-47f6-aefe-f652b117ae22_1124x600.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:600,&quot;width&quot;:1124,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:20896,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F730bbb8a-3a44-47f6-aefe-f652b117ae22_1124x600.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F730bbb8a-3a44-47f6-aefe-f652b117ae22_1124x600.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F730bbb8a-3a44-47f6-aefe-f652b117ae22_1124x600.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F730bbb8a-3a44-47f6-aefe-f652b117ae22_1124x600.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>A nice example of a form of symmetric quantization is called absolute maximum (</span><em>absmax</em><span>) quantization. </span></p><p><span>Given a list of values, we take the </span><em>highest </em><span>absolute value (</span><strong>α</strong><span>) as the range to perform the linear mapping.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F782beaa8-340f-45b8-ba7f-20491f66867a_1172x848.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F782beaa8-340f-45b8-ba7f-20491f66867a_1172x848.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F782beaa8-340f-45b8-ba7f-20491f66867a_1172x848.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F782beaa8-340f-45b8-ba7f-20491f66867a_1172x848.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F782beaa8-340f-45b8-ba7f-20491f66867a_1172x848.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F782beaa8-340f-45b8-ba7f-20491f66867a_1172x848.png" width="1172" height="848" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/782beaa8-340f-45b8-ba7f-20491f66867a_1172x848.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:848,&quot;width&quot;:1172,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:57351,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F782beaa8-340f-45b8-ba7f-20491f66867a_1172x848.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F782beaa8-340f-45b8-ba7f-20491f66867a_1172x848.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F782beaa8-340f-45b8-ba7f-20491f66867a_1172x848.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F782beaa8-340f-45b8-ba7f-20491f66867a_1172x848.png 1456w" sizes="100vw" loading="lazy"></picture></div></a><figcaption>Note the [-127, 127] range of values represents the restricted range. The unrestricted range is [-128, 127] and depends on the quantization method.</figcaption></figure></div><p>Since it is a linear mapping centered around zero, the formula is straightforward. </p><p><span>We first calculate a scale factor (</span><em><strong>s</strong></em><span>) using:</span></p><ul><li><p><em><strong>b</strong></em><span> is the number of bytes that we want to quantize to (8), </span></p></li><li><p><strong>α</strong><em><strong> </strong></em><span>is the </span><em>highest </em><span>absolute value, </span></p></li></ul><p><span>Then, we use the </span><em><strong>s</strong></em><span> to quantize the input </span><em><strong>x</strong></em><span>:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cc76e35-13bf-4d6f-94bf-dbe4725c084f_1644x486.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cc76e35-13bf-4d6f-94bf-dbe4725c084f_1644x486.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cc76e35-13bf-4d6f-94bf-dbe4725c084f_1644x486.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cc76e35-13bf-4d6f-94bf-dbe4725c084f_1644x486.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cc76e35-13bf-4d6f-94bf-dbe4725c084f_1644x486.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cc76e35-13bf-4d6f-94bf-dbe4725c084f_1644x486.png" width="1456" height="430" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/7cc76e35-13bf-4d6f-94bf-dbe4725c084f_1644x486.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:430,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:28246,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cc76e35-13bf-4d6f-94bf-dbe4725c084f_1644x486.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cc76e35-13bf-4d6f-94bf-dbe4725c084f_1644x486.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cc76e35-13bf-4d6f-94bf-dbe4725c084f_1644x486.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cc76e35-13bf-4d6f-94bf-dbe4725c084f_1644x486.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>Filling in the values would then give us the following:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3fd92531-447c-45de-af37-f33ffc446b0b_1644x486.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3fd92531-447c-45de-af37-f33ffc446b0b_1644x486.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3fd92531-447c-45de-af37-f33ffc446b0b_1644x486.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3fd92531-447c-45de-af37-f33ffc446b0b_1644x486.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3fd92531-447c-45de-af37-f33ffc446b0b_1644x486.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3fd92531-447c-45de-af37-f33ffc446b0b_1644x486.png" width="1456" height="430" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/3fd92531-447c-45de-af37-f33ffc446b0b_1644x486.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:430,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:32393,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3fd92531-447c-45de-af37-f33ffc446b0b_1644x486.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3fd92531-447c-45de-af37-f33ffc446b0b_1644x486.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3fd92531-447c-45de-af37-f33ffc446b0b_1644x486.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3fd92531-447c-45de-af37-f33ffc446b0b_1644x486.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>To retrieve the original FP32 values, we can use the previously calculated </span><em>scaling factor</em><span> (</span><em><strong>s</strong></em><span>) to </span><em>dequantize</em><span> the quantized values.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe708f283-3c74-4344-ae76-e96412098c0b_1644x246.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe708f283-3c74-4344-ae76-e96412098c0b_1644x246.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe708f283-3c74-4344-ae76-e96412098c0b_1644x246.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe708f283-3c74-4344-ae76-e96412098c0b_1644x246.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe708f283-3c74-4344-ae76-e96412098c0b_1644x246.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe708f283-3c74-4344-ae76-e96412098c0b_1644x246.png" width="1456" height="218" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/e708f283-3c74-4344-ae76-e96412098c0b_1644x246.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:218,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:12077,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe708f283-3c74-4344-ae76-e96412098c0b_1644x246.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe708f283-3c74-4344-ae76-e96412098c0b_1644x246.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe708f283-3c74-4344-ae76-e96412098c0b_1644x246.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe708f283-3c74-4344-ae76-e96412098c0b_1644x246.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>Applying the quantization and then dequantization process to retrieve the original looks as follows:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5ea2d627-efc7-4a8a-9cf0-7a7020f1253d_1236x348.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5ea2d627-efc7-4a8a-9cf0-7a7020f1253d_1236x348.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5ea2d627-efc7-4a8a-9cf0-7a7020f1253d_1236x348.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5ea2d627-efc7-4a8a-9cf0-7a7020f1253d_1236x348.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5ea2d627-efc7-4a8a-9cf0-7a7020f1253d_1236x348.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5ea2d627-efc7-4a8a-9cf0-7a7020f1253d_1236x348.png" width="1236" height="348" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/5ea2d627-efc7-4a8a-9cf0-7a7020f1253d_1236x348.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:348,&quot;width&quot;:1236,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:26528,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5ea2d627-efc7-4a8a-9cf0-7a7020f1253d_1236x348.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5ea2d627-efc7-4a8a-9cf0-7a7020f1253d_1236x348.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5ea2d627-efc7-4a8a-9cf0-7a7020f1253d_1236x348.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5ea2d627-efc7-4a8a-9cf0-7a7020f1253d_1236x348.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>You can see certain values, such as </span><strong>3.08</strong><span> and </span><strong>3.02</strong><span> being assigned to the INT8, namely </span><strong>36</strong><span>. When you dequantize the values to return to FP32, they lose some precision and are not distinguishable anymore. </span></p><p><span>This is often referred to as the </span><em>quantization error</em><span> which we can calculate by finding the difference between the original and dequantized values.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe173b13b-ed99-4de0-a5e0-4b9114899b3f_1236x372.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe173b13b-ed99-4de0-a5e0-4b9114899b3f_1236x372.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe173b13b-ed99-4de0-a5e0-4b9114899b3f_1236x372.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe173b13b-ed99-4de0-a5e0-4b9114899b3f_1236x372.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe173b13b-ed99-4de0-a5e0-4b9114899b3f_1236x372.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe173b13b-ed99-4de0-a5e0-4b9114899b3f_1236x372.png" width="1236" height="372" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/e173b13b-ed99-4de0-a5e0-4b9114899b3f_1236x372.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:372,&quot;width&quot;:1236,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:29159,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe173b13b-ed99-4de0-a5e0-4b9114899b3f_1236x372.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe173b13b-ed99-4de0-a5e0-4b9114899b3f_1236x372.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe173b13b-ed99-4de0-a5e0-4b9114899b3f_1236x372.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe173b13b-ed99-4de0-a5e0-4b9114899b3f_1236x372.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>Generally, the lower the number of bits, the more quantization error we tend to have.</p><p><span>Asymmetric quantization, in contrast, is not symmetric around zero. Instead, it maps the minimum (</span><strong>β</strong><span>) and maximum (</span><strong>α</strong><span>) values from the float range to the minimum and maximum values of the quantized range. </span></p><p><span>The method we are going to explore is called </span><em>zero-point quantization</em><span>.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8ffa0c54-88bf-45c1-8636-bdb097bb8e6b_1172x848.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8ffa0c54-88bf-45c1-8636-bdb097bb8e6b_1172x848.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8ffa0c54-88bf-45c1-8636-bdb097bb8e6b_1172x848.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8ffa0c54-88bf-45c1-8636-bdb097bb8e6b_1172x848.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8ffa0c54-88bf-45c1-8636-bdb097bb8e6b_1172x848.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8ffa0c54-88bf-45c1-8636-bdb097bb8e6b_1172x848.png" width="1172" height="848" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/8ffa0c54-88bf-45c1-8636-bdb097bb8e6b_1172x848.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:848,&quot;width&quot;:1172,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:57869,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8ffa0c54-88bf-45c1-8636-bdb097bb8e6b_1172x848.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8ffa0c54-88bf-45c1-8636-bdb097bb8e6b_1172x848.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8ffa0c54-88bf-45c1-8636-bdb097bb8e6b_1172x848.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8ffa0c54-88bf-45c1-8636-bdb097bb8e6b_1172x848.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>Notice how the 0 has shifted positions? That’s why it’s called </span><em>asymmetric quantization</em><span>. The min/max values have different distances to 0 in the range [-7.59, 10.8].</span></p><p><span>Due to its shifted position, we have to calculate the zero-point for the INT8 range to perform the linear mapping. As before, we also have to calculate a </span><em>scale factor </em><span>(</span><em><strong>s</strong></em><span>) but use the difference of INT8’s range instead [-128, 127]</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F16cde2f6-aeb5-44d8-b056-846a5f1a0448_1096x508.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F16cde2f6-aeb5-44d8-b056-846a5f1a0448_1096x508.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F16cde2f6-aeb5-44d8-b056-846a5f1a0448_1096x508.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F16cde2f6-aeb5-44d8-b056-846a5f1a0448_1096x508.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F16cde2f6-aeb5-44d8-b056-846a5f1a0448_1096x508.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F16cde2f6-aeb5-44d8-b056-846a5f1a0448_1096x508.png" width="1096" height="508" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/16cde2f6-aeb5-44d8-b056-846a5f1a0448_1096x508.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:508,&quot;width&quot;:1096,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:31046,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F16cde2f6-aeb5-44d8-b056-846a5f1a0448_1096x508.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F16cde2f6-aeb5-44d8-b056-846a5f1a0448_1096x508.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F16cde2f6-aeb5-44d8-b056-846a5f1a0448_1096x508.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F16cde2f6-aeb5-44d8-b056-846a5f1a0448_1096x508.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>Notice how this is a bit more involved due to the need to calculate the </span><em>zeropoint </em><span>(</span><em><strong>z</strong></em><span>) in the INT8 range to shift the weights.</span></p><p>As before, let’s fill in the formula:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92ad0583-277f-4168-bbc7-a5503b5e45c4_1096x468.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92ad0583-277f-4168-bbc7-a5503b5e45c4_1096x468.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92ad0583-277f-4168-bbc7-a5503b5e45c4_1096x468.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92ad0583-277f-4168-bbc7-a5503b5e45c4_1096x468.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92ad0583-277f-4168-bbc7-a5503b5e45c4_1096x468.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92ad0583-277f-4168-bbc7-a5503b5e45c4_1096x468.png" width="1096" height="468" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/92ad0583-277f-4168-bbc7-a5503b5e45c4_1096x468.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:468,&quot;width&quot;:1096,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:39990,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92ad0583-277f-4168-bbc7-a5503b5e45c4_1096x468.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92ad0583-277f-4168-bbc7-a5503b5e45c4_1096x468.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92ad0583-277f-4168-bbc7-a5503b5e45c4_1096x468.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92ad0583-277f-4168-bbc7-a5503b5e45c4_1096x468.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>To dequantize the quantized from INT8 back to FP32, we will need to use the previously calculated </span><em>scale factor</em><span> (</span><em><strong>s</strong></em><span>) and </span><em>zeropoint </em><span>(</span><em><strong>z</strong></em><span>).</span></p><p>Other than that, dequantization is straightforward:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0aee7fd2-c070-4710-9d8c-ccf598d5befe_1016x160.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0aee7fd2-c070-4710-9d8c-ccf598d5befe_1016x160.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0aee7fd2-c070-4710-9d8c-ccf598d5befe_1016x160.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0aee7fd2-c070-4710-9d8c-ccf598d5befe_1016x160.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0aee7fd2-c070-4710-9d8c-ccf598d5befe_1016x160.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0aee7fd2-c070-4710-9d8c-ccf598d5befe_1016x160.png" width="1016" height="160" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/0aee7fd2-c070-4710-9d8c-ccf598d5befe_1016x160.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:160,&quot;width&quot;:1016,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:8232,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0aee7fd2-c070-4710-9d8c-ccf598d5befe_1016x160.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0aee7fd2-c070-4710-9d8c-ccf598d5befe_1016x160.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0aee7fd2-c070-4710-9d8c-ccf598d5befe_1016x160.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0aee7fd2-c070-4710-9d8c-ccf598d5befe_1016x160.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>When we put symmetric and asymmetric quantization side-by-side, we can quickly see the difference between methods:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F01404566-e2ae-4e3f-9101-cafc68d92b40_1172x716.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F01404566-e2ae-4e3f-9101-cafc68d92b40_1172x716.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F01404566-e2ae-4e3f-9101-cafc68d92b40_1172x716.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F01404566-e2ae-4e3f-9101-cafc68d92b40_1172x716.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F01404566-e2ae-4e3f-9101-cafc68d92b40_1172x716.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F01404566-e2ae-4e3f-9101-cafc68d92b40_1172x716.png" width="1172" height="716" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/01404566-e2ae-4e3f-9101-cafc68d92b40_1172x716.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:716,&quot;width&quot;:1172,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:48407,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F01404566-e2ae-4e3f-9101-cafc68d92b40_1172x716.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F01404566-e2ae-4e3f-9101-cafc68d92b40_1172x716.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F01404566-e2ae-4e3f-9101-cafc68d92b40_1172x716.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F01404566-e2ae-4e3f-9101-cafc68d92b40_1172x716.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>Note the zero-centered nature of symmetric quantization versus the offset of asymmetric quantization.</p><p><span>In our previous examples, we explored how the range of values in a given vector could be mapped to a lower-bit representation. Although this allows for the full range of vector values to be mapped, it comes with a major downside, namely </span><em>outliers</em><span>.</span></p><p>Imagine that you have a vector with the following values:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fce7fd7ab-3c4b-401d-893e-d417db946fd8_1172x184.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fce7fd7ab-3c4b-401d-893e-d417db946fd8_1172x184.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fce7fd7ab-3c4b-401d-893e-d417db946fd8_1172x184.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fce7fd7ab-3c4b-401d-893e-d417db946fd8_1172x184.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fce7fd7ab-3c4b-401d-893e-d417db946fd8_1172x184.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fce7fd7ab-3c4b-401d-893e-d417db946fd8_1172x184.png" width="1172" height="184" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/ce7fd7ab-3c4b-401d-893e-d417db946fd8_1172x184.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:184,&quot;width&quot;:1172,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:7881,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fce7fd7ab-3c4b-401d-893e-d417db946fd8_1172x184.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fce7fd7ab-3c4b-401d-893e-d417db946fd8_1172x184.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fce7fd7ab-3c4b-401d-893e-d417db946fd8_1172x184.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fce7fd7ab-3c4b-401d-893e-d417db946fd8_1172x184.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>Note how one value is much larger than all others and could be considered an outlier. If we were to map the full range of this vector, all small values would get mapped to the same lower-bit representation and lose their differentiating factor:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F72052ddb-1c54-45b3-9800-2c4335cc9581_1120x564.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F72052ddb-1c54-45b3-9800-2c4335cc9581_1120x564.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F72052ddb-1c54-45b3-9800-2c4335cc9581_1120x564.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F72052ddb-1c54-45b3-9800-2c4335cc9581_1120x564.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F72052ddb-1c54-45b3-9800-2c4335cc9581_1120x564.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F72052ddb-1c54-45b3-9800-2c4335cc9581_1120x564.png" width="1120" height="564" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/72052ddb-1c54-45b3-9800-2c4335cc9581_1120x564.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:564,&quot;width&quot;:1120,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:34731,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F72052ddb-1c54-45b3-9800-2c4335cc9581_1120x564.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F72052ddb-1c54-45b3-9800-2c4335cc9581_1120x564.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F72052ddb-1c54-45b3-9800-2c4335cc9581_1120x564.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F72052ddb-1c54-45b3-9800-2c4335cc9581_1120x564.png 1456w" sizes="100vw" loading="lazy"></picture></div></a><figcaption>This is the absmax method we used earlier. Note that the same behavior happens with asymmetric quantization if we do not apply clipping.</figcaption></figure></div><p><span>Instead, we can choose to </span><em>clip</em><span> certain values. Clipping involves setting a different dynamic range of the original values such that all outliers get the same value.</span></p><p>In the example below, if we were to manually set the dynamic range to [-5, 5] all values outside that will either be mapped to -127 or to 127 regardless of their value:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F52511453-ca48-42ca-9818-d1afa6dd7369_1120x408.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F52511453-ca48-42ca-9818-d1afa6dd7369_1120x408.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F52511453-ca48-42ca-9818-d1afa6dd7369_1120x408.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F52511453-ca48-42ca-9818-d1afa6dd7369_1120x408.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F52511453-ca48-42ca-9818-d1afa6dd7369_1120x408.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F52511453-ca48-42ca-9818-d1afa6dd7369_1120x408.png" width="1120" height="408" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/52511453-ca48-42ca-9818-d1afa6dd7369_1120x408.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:408,&quot;width&quot;:1120,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:36292,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F52511453-ca48-42ca-9818-d1afa6dd7369_1120x408.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F52511453-ca48-42ca-9818-d1afa6dd7369_1120x408.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F52511453-ca48-42ca-9818-d1afa6dd7369_1120x408.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F52511453-ca48-42ca-9818-d1afa6dd7369_1120x408.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>The major advantage is that the quantization error of the </span><em>non-outliers</em><span> is reduced significantly. However, the quantization error of </span><em>outliers</em><span> increases.</span></p><p><span>In the example, I showed a naive method of choosing an arbitrary range of [-5, 5]. The process of selecting this range is known as </span><em>calibration</em><span> which aims to find a range that includes as many values as possible while minimizing the quantization error.</span></p><p>Performing this calibration step is not equal for all types of parameters. </p><p><span>We can view the weights and biases of an LLM as </span><em>static</em><span> values since they are known before running the model. For instance, the </span><a href="https://huggingface.co/meta-llama/Meta-Llama-3-8B/tree/main" rel="">~20GB file of Llama 3</a><span> consists mostly of its weight and biases.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7d79e60e-92ea-4c91-bbdb-297c819cd821_1456x440.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7d79e60e-92ea-4c91-bbdb-297c819cd821_1456x440.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7d79e60e-92ea-4c91-bbdb-297c819cd821_1456x440.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7d79e60e-92ea-4c91-bbdb-297c819cd821_1456x440.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7d79e60e-92ea-4c91-bbdb-297c819cd821_1456x440.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7d79e60e-92ea-4c91-bbdb-297c819cd821_1456x440.png" width="1456" height="440" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/7d79e60e-92ea-4c91-bbdb-297c819cd821_1456x440.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:440,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:19694,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7d79e60e-92ea-4c91-bbdb-297c819cd821_1456x440.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7d79e60e-92ea-4c91-bbdb-297c819cd821_1456x440.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7d79e60e-92ea-4c91-bbdb-297c819cd821_1456x440.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7d79e60e-92ea-4c91-bbdb-297c819cd821_1456x440.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>Since there are significantly fewer biases (millions) than weights (billions), the biases are often kept in higher precision (such as INT16), and the main effort of quantization is put towards the weights.</p><p>For weights, which are static and known, calibration techniques for choosing the range include:</p><ul><li><p><span>Manually chosing a </span><em>percentile</em><span> of the input range</span></p></li><li><p><span>Optimize the </span><em>mean squared error</em><span> (MSE) between the original and quantized weights.</span></p></li><li><p><span>Minimizing </span><em>entropy</em><span> (KL-divergence) between the original and quantized values</span></p></li></ul><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff24238b2-de53-40c8-8869-9a7d83678544_772x312.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff24238b2-de53-40c8-8869-9a7d83678544_772x312.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff24238b2-de53-40c8-8869-9a7d83678544_772x312.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff24238b2-de53-40c8-8869-9a7d83678544_772x312.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff24238b2-de53-40c8-8869-9a7d83678544_772x312.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff24238b2-de53-40c8-8869-9a7d83678544_772x312.png" width="772" height="312" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/f24238b2-de53-40c8-8869-9a7d83678544_772x312.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:312,&quot;width&quot;:772,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:27048,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff24238b2-de53-40c8-8869-9a7d83678544_772x312.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff24238b2-de53-40c8-8869-9a7d83678544_772x312.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff24238b2-de53-40c8-8869-9a7d83678544_772x312.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff24238b2-de53-40c8-8869-9a7d83678544_772x312.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>Choosing a percentile, for instance, would lead to similar clipping behavior as we have seen before.</p><p><span>The input that is continuously updated throughout the LLM is typically referred to as “</span><em>activations</em><span>”.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6baaee7f-40dd-4f6a-9a8d-bd79a7b2abc7_1456x520.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6baaee7f-40dd-4f6a-9a8d-bd79a7b2abc7_1456x520.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6baaee7f-40dd-4f6a-9a8d-bd79a7b2abc7_1456x520.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6baaee7f-40dd-4f6a-9a8d-bd79a7b2abc7_1456x520.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6baaee7f-40dd-4f6a-9a8d-bd79a7b2abc7_1456x520.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6baaee7f-40dd-4f6a-9a8d-bd79a7b2abc7_1456x520.png" width="1456" height="520" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/6baaee7f-40dd-4f6a-9a8d-bd79a7b2abc7_1456x520.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:520,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:26086,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6baaee7f-40dd-4f6a-9a8d-bd79a7b2abc7_1456x520.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6baaee7f-40dd-4f6a-9a8d-bd79a7b2abc7_1456x520.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6baaee7f-40dd-4f6a-9a8d-bd79a7b2abc7_1456x520.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6baaee7f-40dd-4f6a-9a8d-bd79a7b2abc7_1456x520.png 1456w" sizes="100vw" loading="lazy"></picture></div></a><figcaption>Note that these values are called activations since they often go through some activation function, like sigmoid or relu.</figcaption></figure></div><p>Unlike weights, activations vary with each input data fed into the model during inference, making it challenging to quantize them accurately. </p><p>Since these values are updated after each hidden layer, we only know what they will be during inference as the input data passes through the model.</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6fbb4248-fc4f-4317-b13a-898976010536_1230x672.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6fbb4248-fc4f-4317-b13a-898976010536_1230x672.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6fbb4248-fc4f-4317-b13a-898976010536_1230x672.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6fbb4248-fc4f-4317-b13a-898976010536_1230x672.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6fbb4248-fc4f-4317-b13a-898976010536_1230x672.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6fbb4248-fc4f-4317-b13a-898976010536_1230x672.png" width="1230" height="672" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/6fbb4248-fc4f-4317-b13a-898976010536_1230x672.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:672,&quot;width&quot;:1230,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:83766,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6fbb4248-fc4f-4317-b13a-898976010536_1230x672.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6fbb4248-fc4f-4317-b13a-898976010536_1230x672.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6fbb4248-fc4f-4317-b13a-898976010536_1230x672.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6fbb4248-fc4f-4317-b13a-898976010536_1230x672.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>Broadly, there are two methods for calibrating the quantization method of the weights and activations:</p><ul><li><p>Post-Training Quantization (PTQ)</p><ul><li><p><span>Quantization </span><em><strong>after</strong></em><span> training</span></p></li></ul></li><li><p>Quantization Aware Training (QAT)</p><ul><li><p><span>Quantization </span><em><strong>during</strong></em><span> training/fine-tuning</span></p></li></ul></li></ul><p><span>One of the most popular quantization techniques is post-training quantization (PTQ). It involves quantizing a model’s parameters (both weights and activations) </span><strong>after</strong><span> training the model. </span></p><p><span>Quantization of the </span><em>weights</em><span> is performed using either symmetric or asymmetric quantization. </span></p><p><span>Quantization of the </span><em>activations</em><span>, however, requires inference of the model to get their potential distribution since we do not know their range.</span></p><p>There are two forms of quantization of the activations:</p><ul><li><p><em>Dynamic </em><span>Quantization</span></p></li><li><p><em>Static</em><span> Quantization</span></p></li></ul><p>After data passes a hidden layer, its activations are collected:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0fa3761f-0244-48f7-af56-5fb6c1cdd952_1476x756.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0fa3761f-0244-48f7-af56-5fb6c1cdd952_1476x756.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0fa3761f-0244-48f7-af56-5fb6c1cdd952_1476x756.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0fa3761f-0244-48f7-af56-5fb6c1cdd952_1476x756.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0fa3761f-0244-48f7-af56-5fb6c1cdd952_1476x756.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0fa3761f-0244-48f7-af56-5fb6c1cdd952_1476x756.png" width="1456" height="746" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/0fa3761f-0244-48f7-af56-5fb6c1cdd952_1476x756.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:746,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:86202,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0fa3761f-0244-48f7-af56-5fb6c1cdd952_1476x756.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0fa3761f-0244-48f7-af56-5fb6c1cdd952_1476x756.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0fa3761f-0244-48f7-af56-5fb6c1cdd952_1476x756.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0fa3761f-0244-48f7-af56-5fb6c1cdd952_1476x756.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>This distribution of activations is then used to calculate the </span><em>zeropoint</em><span> (</span><em><strong>z</strong></em><span>) and </span><em>scale factor</em><span> (</span><strong>s</strong><span>) values needed to quantize the output:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa593d70-c28a-43e3-b32c-5c7e46186408_1476x876.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa593d70-c28a-43e3-b32c-5c7e46186408_1476x876.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa593d70-c28a-43e3-b32c-5c7e46186408_1476x876.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa593d70-c28a-43e3-b32c-5c7e46186408_1476x876.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa593d70-c28a-43e3-b32c-5c7e46186408_1476x876.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa593d70-c28a-43e3-b32c-5c7e46186408_1476x876.png" width="1456" height="864" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/fa593d70-c28a-43e3-b32c-5c7e46186408_1476x876.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:864,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:90712,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa593d70-c28a-43e3-b32c-5c7e46186408_1476x876.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa593d70-c28a-43e3-b32c-5c7e46186408_1476x876.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa593d70-c28a-43e3-b32c-5c7e46186408_1476x876.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa593d70-c28a-43e3-b32c-5c7e46186408_1476x876.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>The process is repeated each time data passes through a new layer. Therefore, each layer has its own separate </span><em><strong>z</strong></em><span> and </span><em><strong>s</strong></em><span> values and therefore different quantization schemes.</span></p><p><span>In contrast to dynamic quantization, static quantization does not calculate the </span><em>zeropoint</em><span> (</span><em><strong>z</strong></em><span>) and scale factor (</span><em><strong>s</strong></em><span>) during inference but beforehand.</span></p><p><span>To find those values, a </span><strong>calibration dataset</strong><span> is used and given to the model to collect these potential distributions.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F46dd6825-2a1c-459e-88c0-022a01dcebf2_1194x636.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F46dd6825-2a1c-459e-88c0-022a01dcebf2_1194x636.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F46dd6825-2a1c-459e-88c0-022a01dcebf2_1194x636.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F46dd6825-2a1c-459e-88c0-022a01dcebf2_1194x636.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F46dd6825-2a1c-459e-88c0-022a01dcebf2_1194x636.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F46dd6825-2a1c-459e-88c0-022a01dcebf2_1194x636.png" width="1194" height="636" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/46dd6825-2a1c-459e-88c0-022a01dcebf2_1194x636.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:636,&quot;width&quot;:1194,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:37692,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F46dd6825-2a1c-459e-88c0-022a01dcebf2_1194x636.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F46dd6825-2a1c-459e-88c0-022a01dcebf2_1194x636.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F46dd6825-2a1c-459e-88c0-022a01dcebf2_1194x636.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F46dd6825-2a1c-459e-88c0-022a01dcebf2_1194x636.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>After these values have been collected, we can calculate the necessary </span><em><strong>s</strong></em><span> and </span><em><strong>z</strong></em><span> values to perform quantization during inference.</span></p><p><span>When you are performing actual inference, the </span><em><strong>s</strong></em><span> and </span><em><strong>z</strong></em><span> values are not recalculated but are used globally over all activations to quantize them.</span></p><p><span>In general, dynamic quantization tends to be a bit more accurate since it only attempts to calculate the </span><em><strong>s</strong></em><span> and </span><em><strong>z</strong></em><span> values per hidden layer. However, it might increase compute time as these values need to be calculated.</span></p><p><span>In contrast, static quantization is less accurate but is faster as it already knows the </span><em><strong>s</strong></em><span> and </span><em><strong>z</strong></em><span> values used for quantization.</span></p><p>Going below 8-bit quantization has proved to be a difficult task as the quantization error increases with each loss of bit. Fortunately, there are several smart ways to reduce the bits to 6, 4, and even 2-bits (although going lower than 4-bits using these methods is typically not advised). </p><p>We will explore two methods that are commonly shared on HuggingFace:</p><ul><li><p><em>GPTQ</em><span> (full model on GPU)</span></p></li><li><p><em>GGUF</em><span> (potentially offload layers on the CPU)</span></p></li></ul><p><span>GPTQ is arguably one of the most well-known methods used in practice for quantization to 4-bits.</span><span><a data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-1-145531349" href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#footnote-1-145531349" target="_self" rel="">1</a></span></p><p>It uses asymmetric quantization and does so layer by layer such that each layer is processed independently before continuing to the next:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc260ef95-2dbf-4f7e-80ba-213ce6623fcd_1230x816.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc260ef95-2dbf-4f7e-80ba-213ce6623fcd_1230x816.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc260ef95-2dbf-4f7e-80ba-213ce6623fcd_1230x816.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc260ef95-2dbf-4f7e-80ba-213ce6623fcd_1230x816.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc260ef95-2dbf-4f7e-80ba-213ce6623fcd_1230x816.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc260ef95-2dbf-4f7e-80ba-213ce6623fcd_1230x816.png" width="1230" height="816" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/c260ef95-2dbf-4f7e-80ba-213ce6623fcd_1230x816.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:816,&quot;width&quot;:1230,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:71396,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc260ef95-2dbf-4f7e-80ba-213ce6623fcd_1230x816.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc260ef95-2dbf-4f7e-80ba-213ce6623fcd_1230x816.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc260ef95-2dbf-4f7e-80ba-213ce6623fcd_1230x816.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc260ef95-2dbf-4f7e-80ba-213ce6623fcd_1230x816.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>During this layer-wise quantization process, it first converts the layer’s weights into the inverse-</span><strong>Hessian</strong><span>. It is a second-order derivative of the model’s loss function and tells us how sensitive the model's output is to changes in each weight.</span></p><p><span>Simplified, it essentially demonstrates the (</span><em>inverse</em><span>) </span><strong>importance of each weight</strong><span> in a layer.</span></p><p>Weights associated with smaller values in the Hessian matrix are more crucial because small changes in these weights can lead to significant changes in the model's performance.</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fad39a51b-e47f-44ec-af23-474292719be3_1440x696.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fad39a51b-e47f-44ec-af23-474292719be3_1440x696.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fad39a51b-e47f-44ec-af23-474292719be3_1440x696.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fad39a51b-e47f-44ec-af23-474292719be3_1440x696.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fad39a51b-e47f-44ec-af23-474292719be3_1440x696.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fad39a51b-e47f-44ec-af23-474292719be3_1440x696.png" width="1440" height="696" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/ad39a51b-e47f-44ec-af23-474292719be3_1440x696.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:696,&quot;width&quot;:1440,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:56672,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fad39a51b-e47f-44ec-af23-474292719be3_1440x696.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fad39a51b-e47f-44ec-af23-474292719be3_1440x696.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fad39a51b-e47f-44ec-af23-474292719be3_1440x696.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fad39a51b-e47f-44ec-af23-474292719be3_1440x696.png 1456w" sizes="100vw" loading="lazy"></picture></div></a><figcaption>In the inverse-Hessian, lower values indicate more “important” weights.</figcaption></figure></div><p>Next, we quantize and then dequantize the weight of the first row in our weight matrix:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3eac2072-f4a5-42ca-a251-f934a57d2df5_1146x438.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3eac2072-f4a5-42ca-a251-f934a57d2df5_1146x438.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3eac2072-f4a5-42ca-a251-f934a57d2df5_1146x438.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3eac2072-f4a5-42ca-a251-f934a57d2df5_1146x438.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3eac2072-f4a5-42ca-a251-f934a57d2df5_1146x438.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3eac2072-f4a5-42ca-a251-f934a57d2df5_1146x438.png" width="1146" height="438" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/3eac2072-f4a5-42ca-a251-f934a57d2df5_1146x438.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:438,&quot;width&quot;:1146,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:19404,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3eac2072-f4a5-42ca-a251-f934a57d2df5_1146x438.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3eac2072-f4a5-42ca-a251-f934a57d2df5_1146x438.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3eac2072-f4a5-42ca-a251-f934a57d2df5_1146x438.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3eac2072-f4a5-42ca-a251-f934a57d2df5_1146x438.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>This process allows us to calculate the </span><strong>quantization error (</strong><em><strong>q</strong></em><strong>)</strong><span> which we can weigh using the inverse-Hessian (</span><em><strong>h_1</strong><span>)</span></em><span> that we calculated beforehand. </span></p><p>Essentially, we are creating a weighted-quantization error based on the importance of the weight:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffd4b12b9-8b1b-4aa5-8d8c-ab8c1ab23671_1096x332.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffd4b12b9-8b1b-4aa5-8d8c-ab8c1ab23671_1096x332.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffd4b12b9-8b1b-4aa5-8d8c-ab8c1ab23671_1096x332.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffd4b12b9-8b1b-4aa5-8d8c-ab8c1ab23671_1096x332.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffd4b12b9-8b1b-4aa5-8d8c-ab8c1ab23671_1096x332.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffd4b12b9-8b1b-4aa5-8d8c-ab8c1ab23671_1096x332.png" width="1096" height="332" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/fd4b12b9-8b1b-4aa5-8d8c-ab8c1ab23671_1096x332.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:332,&quot;width&quot;:1096,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:16185,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffd4b12b9-8b1b-4aa5-8d8c-ab8c1ab23671_1096x332.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffd4b12b9-8b1b-4aa5-8d8c-ab8c1ab23671_1096x332.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffd4b12b9-8b1b-4aa5-8d8c-ab8c1ab23671_1096x332.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffd4b12b9-8b1b-4aa5-8d8c-ab8c1ab23671_1096x332.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>Next, we redistribute this weighted quantization error over the other weights in the row. This allows for maintaining the overall function and output of the network.</p><p><span>For example, if we were to do this for the second weight, namely .3 (</span><em><strong>x_2</strong></em><span>), we would add the quantization error (</span><em><strong>q</strong></em><span>) multiplied by the inverse-Hessian of the second weight (</span><em><strong>h</strong></em><strong>_2</strong><span>)</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86456fdb-ba8f-4545-aa45-a0f4d4c59362_1096x244.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86456fdb-ba8f-4545-aa45-a0f4d4c59362_1096x244.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86456fdb-ba8f-4545-aa45-a0f4d4c59362_1096x244.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86456fdb-ba8f-4545-aa45-a0f4d4c59362_1096x244.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86456fdb-ba8f-4545-aa45-a0f4d4c59362_1096x244.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86456fdb-ba8f-4545-aa45-a0f4d4c59362_1096x244.png" width="1096" height="244" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/86456fdb-ba8f-4545-aa45-a0f4d4c59362_1096x244.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:244,&quot;width&quot;:1096,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:12974,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86456fdb-ba8f-4545-aa45-a0f4d4c59362_1096x244.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86456fdb-ba8f-4545-aa45-a0f4d4c59362_1096x244.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86456fdb-ba8f-4545-aa45-a0f4d4c59362_1096x244.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86456fdb-ba8f-4545-aa45-a0f4d4c59362_1096x244.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>We can do the same process over the third weight in the given row:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Faf47538b-4a3b-48df-9dbd-dded0ed09ce4_1284x438.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Faf47538b-4a3b-48df-9dbd-dded0ed09ce4_1284x438.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Faf47538b-4a3b-48df-9dbd-dded0ed09ce4_1284x438.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Faf47538b-4a3b-48df-9dbd-dded0ed09ce4_1284x438.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Faf47538b-4a3b-48df-9dbd-dded0ed09ce4_1284x438.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Faf47538b-4a3b-48df-9dbd-dded0ed09ce4_1284x438.png" width="1284" height="438" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/af47538b-4a3b-48df-9dbd-dded0ed09ce4_1284x438.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:438,&quot;width&quot;:1284,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:29608,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Faf47538b-4a3b-48df-9dbd-dded0ed09ce4_1284x438.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Faf47538b-4a3b-48df-9dbd-dded0ed09ce4_1284x438.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Faf47538b-4a3b-48df-9dbd-dded0ed09ce4_1284x438.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Faf47538b-4a3b-48df-9dbd-dded0ed09ce4_1284x438.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>We iterate over this process of redistributing the weighted quantization error until all values are quantized.</p><p>This works so well because weights are typically related to one another. So when one weight has a quantization error, related weights are updated accordingly (through the inverse-Hessian).</p><blockquote><p><strong>NOTE</strong><span>: </span><a href="https://arxiv.org/pdf/2210.17323" rel="">The authors</a><span> used several tricks to speed up computation and improve performance, such as adding a dampening factor to the Hessian, “lazy batching”, and precomputing information using the Cholesky method. I would highly advise checking out </span><a href="https://www.youtube.com/watch?v=mii-xFaPCrA" rel="">this YouTube video</a><span> on the subject.</span></p></blockquote><blockquote><p><strong>TIP</strong><span>: Check out </span><a href="https://github.com/turboderp/exllamav2" rel="">EXL2</a><span> if you want a quantization method aimed at performance optimizations and improving inference speed.</span></p></blockquote><p><span>While GPTQ is a great quantization method to run your full LLM on a GPU, you might not always have that capacity. Instead, we can use GGUF to offload any layer of the LLM to the CPU. </span><span><a data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-2-145531349" href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#footnote-2-145531349" target="_self" rel="">2</a></span></p><p>This allows you to use both the CPU and GPU when you do not have enough VRAM.</p><p>The quantization method GGUF is updated frequently and might depend on the level of bit quantization. However, the general principle is as follows.</p><p><span>First, the weights of a given layer are split into “super” blocks each containing a set of “sub” blocks. From these blocks, we extract the scale factor (</span><em><strong>s</strong></em><span>) and alpha (</span><em><strong>α</strong></em><span>):</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F98047d62-3925-4a29-a23b-c5bfa517f073_894x480.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F98047d62-3925-4a29-a23b-c5bfa517f073_894x480.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F98047d62-3925-4a29-a23b-c5bfa517f073_894x480.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F98047d62-3925-4a29-a23b-c5bfa517f073_894x480.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F98047d62-3925-4a29-a23b-c5bfa517f073_894x480.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F98047d62-3925-4a29-a23b-c5bfa517f073_894x480.png" width="894" height="480" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/98047d62-3925-4a29-a23b-c5bfa517f073_894x480.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:480,&quot;width&quot;:894,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:15011,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F98047d62-3925-4a29-a23b-c5bfa517f073_894x480.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F98047d62-3925-4a29-a23b-c5bfa517f073_894x480.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F98047d62-3925-4a29-a23b-c5bfa517f073_894x480.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F98047d62-3925-4a29-a23b-c5bfa517f073_894x480.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>To quantize a given “sub” block, we can use the </span><em>absmax</em><span> quantization we used before. Remember that it multiplies a given weight by the scale factor </span><strong>(</strong><em><strong>s</strong></em><strong>)</strong><span>:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbf159bb5-8158-43e3-bae1-8812fc0fa146_1096x120.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbf159bb5-8158-43e3-bae1-8812fc0fa146_1096x120.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbf159bb5-8158-43e3-bae1-8812fc0fa146_1096x120.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbf159bb5-8158-43e3-bae1-8812fc0fa146_1096x120.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbf159bb5-8158-43e3-bae1-8812fc0fa146_1096x120.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbf159bb5-8158-43e3-bae1-8812fc0fa146_1096x120.png" width="1096" height="120" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/bf159bb5-8158-43e3-bae1-8812fc0fa146_1096x120.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:120,&quot;width&quot;:1096,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:9257,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbf159bb5-8158-43e3-bae1-8812fc0fa146_1096x120.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbf159bb5-8158-43e3-bae1-8812fc0fa146_1096x120.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbf159bb5-8158-43e3-bae1-8812fc0fa146_1096x120.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbf159bb5-8158-43e3-bae1-8812fc0fa146_1096x120.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>The scale factor is calculated using the information from the “sub” block but is quantized using the information from the “super” block which has its own scale factor:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe3e7f68b-6ce8-45ba-a844-80b5eb0ab2d3_1096x196.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe3e7f68b-6ce8-45ba-a844-80b5eb0ab2d3_1096x196.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe3e7f68b-6ce8-45ba-a844-80b5eb0ab2d3_1096x196.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe3e7f68b-6ce8-45ba-a844-80b5eb0ab2d3_1096x196.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe3e7f68b-6ce8-45ba-a844-80b5eb0ab2d3_1096x196.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe3e7f68b-6ce8-45ba-a844-80b5eb0ab2d3_1096x196.png" width="1096" height="196" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/e3e7f68b-6ce8-45ba-a844-80b5eb0ab2d3_1096x196.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:196,&quot;width&quot;:1096,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:14531,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe3e7f68b-6ce8-45ba-a844-80b5eb0ab2d3_1096x196.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe3e7f68b-6ce8-45ba-a844-80b5eb0ab2d3_1096x196.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe3e7f68b-6ce8-45ba-a844-80b5eb0ab2d3_1096x196.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe3e7f68b-6ce8-45ba-a844-80b5eb0ab2d3_1096x196.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>This block-wise quantization uses the scale factor (</span><strong>s_super</strong><span>) from the “super” block to quantize the scale factor (</span><strong>s_sub</strong><span>) from the “sub” block.</span></p><p>The quantization level of each scale factor might differ with the “super” block generally having a higher precision than the scale factor of the “sub” block.</p><p>To illustrate, let’s explore a couple of quantization levels (2-bit, 4-bit, and 6-bit):</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F43ca3393-869a-4be3-bf8b-0c52e42017d7_1984x692.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F43ca3393-869a-4be3-bf8b-0c52e42017d7_1984x692.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F43ca3393-869a-4be3-bf8b-0c52e42017d7_1984x692.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F43ca3393-869a-4be3-bf8b-0c52e42017d7_1984x692.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F43ca3393-869a-4be3-bf8b-0c52e42017d7_1984x692.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F43ca3393-869a-4be3-bf8b-0c52e42017d7_1984x692.png" width="1456" height="508" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/43ca3393-869a-4be3-bf8b-0c52e42017d7_1984x692.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:508,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:68162,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F43ca3393-869a-4be3-bf8b-0c52e42017d7_1984x692.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F43ca3393-869a-4be3-bf8b-0c52e42017d7_1984x692.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F43ca3393-869a-4be3-bf8b-0c52e42017d7_1984x692.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F43ca3393-869a-4be3-bf8b-0c52e42017d7_1984x692.png 1456w" sizes="100vw" loading="lazy"></picture></div></a><figcaption><strong>NOTE</strong><span>: Depending on the quantization type, an additional minimum value (</span><em><strong>m</strong></em><span>) is needed to adjust the zero-point. These are quantized the same as the scale factor (</span><em><strong>s</strong></em><span>).</span></figcaption></figure></div><p><span>Check out </span><a href="https://github.com/ggerganov/llama.cpp/pull/1684" rel="">the original pull request</a><span> for an overview of all quantization levels. Also, see </span><a href="https://github.com/ggerganov/llama.cpp/pull/4861" rel="">this pull request</a><span> for more information on quantization using importance matrices.</span></p><p><span>In Part 3, we saw how we could quantize a model </span><em><strong>after</strong></em><span> training. A downside to this approach is that this quantization does not consider the actual training process. </span></p><p><span>This is where Quantization Aware Training (QAT) comes in. Instead of quantizing a model </span><em><strong>after</strong></em><span> it was trained with post-training quantization (PTQ), QAT aims to learn the quantization procedure </span><em><strong>during</strong></em><span> training.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1ad4fa3b-b440-4be3-90bd-b66e219f191e_1368x810.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1ad4fa3b-b440-4be3-90bd-b66e219f191e_1368x810.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1ad4fa3b-b440-4be3-90bd-b66e219f191e_1368x810.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1ad4fa3b-b440-4be3-90bd-b66e219f191e_1368x810.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1ad4fa3b-b440-4be3-90bd-b66e219f191e_1368x810.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1ad4fa3b-b440-4be3-90bd-b66e219f191e_1368x810.png" width="1368" height="810" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/1ad4fa3b-b440-4be3-90bd-b66e219f191e_1368x810.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:810,&quot;width&quot;:1368,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:86444,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1ad4fa3b-b440-4be3-90bd-b66e219f191e_1368x810.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1ad4fa3b-b440-4be3-90bd-b66e219f191e_1368x810.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1ad4fa3b-b440-4be3-90bd-b66e219f191e_1368x810.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1ad4fa3b-b440-4be3-90bd-b66e219f191e_1368x810.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>QAT tends to be more accurate than PTQ since the quantization was already considered during training. It works as follows:</p><p><span>During training, so-called “</span><em>fake</em><span>” quants are introduced. This is the process of first quantizing the weights to, for example, INT4 and then dequantizing back to FP32:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc3a17734-65f8-45d7-8e4e-f7bc1c592577_1824x360.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc3a17734-65f8-45d7-8e4e-f7bc1c592577_1824x360.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc3a17734-65f8-45d7-8e4e-f7bc1c592577_1824x360.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc3a17734-65f8-45d7-8e4e-f7bc1c592577_1824x360.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc3a17734-65f8-45d7-8e4e-f7bc1c592577_1824x360.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc3a17734-65f8-45d7-8e4e-f7bc1c592577_1824x360.png" width="1456" height="287" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/c3a17734-65f8-45d7-8e4e-f7bc1c592577_1824x360.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:287,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:33775,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc3a17734-65f8-45d7-8e4e-f7bc1c592577_1824x360.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc3a17734-65f8-45d7-8e4e-f7bc1c592577_1824x360.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc3a17734-65f8-45d7-8e4e-f7bc1c592577_1824x360.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc3a17734-65f8-45d7-8e4e-f7bc1c592577_1824x360.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>This process allows the model to consider the quantization process during training, the calculation of loss, and weight updates.</p><p><span>QAT attempts to explore the loss landscape for “</span><em>wide</em><span>” minima to minimize the quantization errors as “</span><em>narrow</em><span>” minima tend to result in larger quantization errors.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa70ee37e-3b4f-4598-8eef-2a9ab13658c1_1200x640.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa70ee37e-3b4f-4598-8eef-2a9ab13658c1_1200x640.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa70ee37e-3b4f-4598-8eef-2a9ab13658c1_1200x640.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa70ee37e-3b4f-4598-8eef-2a9ab13658c1_1200x640.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa70ee37e-3b4f-4598-8eef-2a9ab13658c1_1200x640.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa70ee37e-3b4f-4598-8eef-2a9ab13658c1_1200x640.png" width="1200" height="640" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/a70ee37e-3b4f-4598-8eef-2a9ab13658c1_1200x640.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:640,&quot;width&quot;:1200,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:44538,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa70ee37e-3b4f-4598-8eef-2a9ab13658c1_1200x640.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa70ee37e-3b4f-4598-8eef-2a9ab13658c1_1200x640.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa70ee37e-3b4f-4598-8eef-2a9ab13658c1_1200x640.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa70ee37e-3b4f-4598-8eef-2a9ab13658c1_1200x640.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>For example, imagine if we did not consider quantization during the backward pass. We choose the weight with the smallest loss according to gradient descent. However, that would introduce a larger quantization error if it’s in a “</span><em>narrow</em><span>” minima.</span></p><p><span>In contrast, if we consider quantization, a different updated weight will be selected in a “</span><em>wide</em><span>” minima with a much lower quantization error.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb26d3f00-f599-4c75-beb4-21d87625b1d8_1200x640.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb26d3f00-f599-4c75-beb4-21d87625b1d8_1200x640.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb26d3f00-f599-4c75-beb4-21d87625b1d8_1200x640.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb26d3f00-f599-4c75-beb4-21d87625b1d8_1200x640.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb26d3f00-f599-4c75-beb4-21d87625b1d8_1200x640.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb26d3f00-f599-4c75-beb4-21d87625b1d8_1200x640.png" width="1200" height="640" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/b26d3f00-f599-4c75-beb4-21d87625b1d8_1200x640.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:640,&quot;width&quot;:1200,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:64250,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb26d3f00-f599-4c75-beb4-21d87625b1d8_1200x640.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb26d3f00-f599-4c75-beb4-21d87625b1d8_1200x640.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb26d3f00-f599-4c75-beb4-21d87625b1d8_1200x640.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb26d3f00-f599-4c75-beb4-21d87625b1d8_1200x640.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>As such, although PTQ has a lower loss in high precision (e.g., FP32), QAT results in a lower loss in lower precision (e.g., INT4) which is what we aim for.</p><p>Going to 4-bits as we saw before is already quite small but what if we were to reduce it even further?</p><p><span>This is where </span><a href="https://arxiv.org/pdf/2310.11453" rel="">BitNet</a><span> comes in, representing the weights of a model single 1-bit, using either </span><strong>-1</strong><span> or </span><strong>1</strong><span> for a given weight.</span><span><a data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-3-145531349" href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#footnote-3-145531349" target="_self" rel="">3</a></span><span> </span></p><p>It does so by injecting the quantization process directly into the Transformer architecture.</p><p>Remember that the Transformer architecture is used as the foundation of most LLMs and is composed of computations that involve linear layers:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe3587e75-d631-4ecd-8da9-26fedfc68c53_1364x768.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe3587e75-d631-4ecd-8da9-26fedfc68c53_1364x768.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe3587e75-d631-4ecd-8da9-26fedfc68c53_1364x768.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe3587e75-d631-4ecd-8da9-26fedfc68c53_1364x768.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe3587e75-d631-4ecd-8da9-26fedfc68c53_1364x768.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe3587e75-d631-4ecd-8da9-26fedfc68c53_1364x768.png" width="1364" height="768" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/e3587e75-d631-4ecd-8da9-26fedfc68c53_1364x768.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:768,&quot;width&quot;:1364,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:68464,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe3587e75-d631-4ecd-8da9-26fedfc68c53_1364x768.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe3587e75-d631-4ecd-8da9-26fedfc68c53_1364x768.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe3587e75-d631-4ecd-8da9-26fedfc68c53_1364x768.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe3587e75-d631-4ecd-8da9-26fedfc68c53_1364x768.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>These linear layers are generally represented with higher precision, like FP16, and are where most of the weights reside.</p><p><span>BitNet replaces these linear layers with something they call the </span><strong>BitLlinear</strong><span>:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa6b8cbbf-057d-46c9-b275-dab262dd78d5_1364x768.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa6b8cbbf-057d-46c9-b275-dab262dd78d5_1364x768.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa6b8cbbf-057d-46c9-b275-dab262dd78d5_1364x768.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa6b8cbbf-057d-46c9-b275-dab262dd78d5_1364x768.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa6b8cbbf-057d-46c9-b275-dab262dd78d5_1364x768.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa6b8cbbf-057d-46c9-b275-dab262dd78d5_1364x768.png" width="1364" height="768" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/a6b8cbbf-057d-46c9-b275-dab262dd78d5_1364x768.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:768,&quot;width&quot;:1364,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:116998,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa6b8cbbf-057d-46c9-b275-dab262dd78d5_1364x768.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa6b8cbbf-057d-46c9-b275-dab262dd78d5_1364x768.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa6b8cbbf-057d-46c9-b275-dab262dd78d5_1364x768.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa6b8cbbf-057d-46c9-b275-dab262dd78d5_1364x768.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>A BitLinear layer works the same as a regular linear layer and calculates the output based on the weights multiplied by the activation. </p><p>In contrast, a BitLinear layer represents the weights of a model using 1-bit and activations using INT8:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9806feb5-2212-4fc3-af0b-ef42ae536787_1240x552.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9806feb5-2212-4fc3-af0b-ef42ae536787_1240x552.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9806feb5-2212-4fc3-af0b-ef42ae536787_1240x552.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9806feb5-2212-4fc3-af0b-ef42ae536787_1240x552.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9806feb5-2212-4fc3-af0b-ef42ae536787_1240x552.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9806feb5-2212-4fc3-af0b-ef42ae536787_1240x552.png" width="1240" height="552" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/9806feb5-2212-4fc3-af0b-ef42ae536787_1240x552.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:552,&quot;width&quot;:1240,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:20000,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9806feb5-2212-4fc3-af0b-ef42ae536787_1240x552.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9806feb5-2212-4fc3-af0b-ef42ae536787_1240x552.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9806feb5-2212-4fc3-af0b-ef42ae536787_1240x552.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F9806feb5-2212-4fc3-af0b-ef42ae536787_1240x552.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p>A BitLinear layer, like Quantization-Aware Training (QAT) performs a form of “fake” quantization during training to analyze the effect of quantization of the weights and activations:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F25935e2a-7643-4705-8961-0b40506fe757_1296x832.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F25935e2a-7643-4705-8961-0b40506fe757_1296x832.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F25935e2a-7643-4705-8961-0b40506fe757_1296x832.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F25935e2a-7643-4705-8961-0b40506fe757_1296x832.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F25935e2a-7643-4705-8961-0b40506fe757_1296x832.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F25935e2a-7643-4705-8961-0b40506fe757_1296x832.png" width="1296" height="832" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/25935e2a-7643-4705-8961-0b40506fe757_1296x832.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:832,&quot;width&quot;:1296,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:84571,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F25935e2a-7643-4705-8961-0b40506fe757_1296x832.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F25935e2a-7643-4705-8961-0b40506fe757_1296x832.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F25935e2a-7643-4705-8961-0b40506fe757_1296x832.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F25935e2a-7643-4705-8961-0b40506fe757_1296x832.png 1456w" sizes="100vw" loading="lazy"></picture></div></a><figcaption><strong>NOTE</strong><span>: In the paper they used </span><strong>γ</strong><span> instead of </span><strong>α</strong><span> but since we used a throughout our examples, I’m using that. Also, note that </span><strong>β</strong><span> is not the same as we used in zero-point quantization but the average absolute value.</span></figcaption></figure></div><p>Let’s go through the BitLinear step-by-step.</p><p><span>While training, the weights are stored in INT8 and then quantized to 1-bit using a basic strategy, called the </span><em>signum function.</em></p><p>In essence, it moves the distribution of weights to be centered around 0 and then assigns everything left to 0 to be -1 and everything to the right to be 1:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb1080b79-6d3c-4dde-a6f1-a354afae4f54_1152x508.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb1080b79-6d3c-4dde-a6f1-a354afae4f54_1152x508.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb1080b79-6d3c-4dde-a6f1-a354afae4f54_1152x508.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb1080b79-6d3c-4dde-a6f1-a354afae4f54_1152x508.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb1080b79-6d3c-4dde-a6f1-a354afae4f54_1152x508.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb1080b79-6d3c-4dde-a6f1-a354afae4f54_1152x508.png" width="1152" height="508" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/b1080b79-6d3c-4dde-a6f1-a354afae4f54_1152x508.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:508,&quot;width&quot;:1152,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:49127,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb1080b79-6d3c-4dde-a6f1-a354afae4f54_1152x508.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb1080b79-6d3c-4dde-a6f1-a354afae4f54_1152x508.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb1080b79-6d3c-4dde-a6f1-a354afae4f54_1152x508.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb1080b79-6d3c-4dde-a6f1-a354afae4f54_1152x508.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>Additionally, it tracks a value </span><strong>β (</strong><em>average</em><span> absolute value</span><strong>)</strong><span> that we will use later on for dequantization. </span></p><p><span>To quantize the activations, BitLinear makes use of </span><em>absmax quantization</em><span> to convert the activations from FP16 to INT8 as they need to be in higher precision for the matrix multiplication (×). </span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbc69928b-3169-4c35-963b-c25ec218bc12_1260x552.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbc69928b-3169-4c35-963b-c25ec218bc12_1260x552.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbc69928b-3169-4c35-963b-c25ec218bc12_1260x552.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbc69928b-3169-4c35-963b-c25ec218bc12_1260x552.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbc69928b-3169-4c35-963b-c25ec218bc12_1260x552.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbc69928b-3169-4c35-963b-c25ec218bc12_1260x552.png" width="1260" height="552" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/bc69928b-3169-4c35-963b-c25ec218bc12_1260x552.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:552,&quot;width&quot;:1260,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:38296,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbc69928b-3169-4c35-963b-c25ec218bc12_1260x552.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbc69928b-3169-4c35-963b-c25ec218bc12_1260x552.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbc69928b-3169-4c35-963b-c25ec218bc12_1260x552.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbc69928b-3169-4c35-963b-c25ec218bc12_1260x552.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>Additionally, it tracks </span><strong>α (</strong><em>highest</em><span> absolute value</span><strong>)</strong><span> that we will use later on for dequantization.</span></p><p><span>We tracked </span><strong>α (</strong><em>highest absolute value of activations</em><strong>) </strong><span>and </span><strong>β (</strong><em>average absolute value of weights</em><strong>) </strong><span>as those values will help us dequantize the activations  back to FP16.</span></p><p><span>The output activations are rescaled with {</span><strong>α</strong><span>, γ} to dequantize them to the original precision:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F330cb1bb-9a98-45c1-b140-0fa8038d521f_1296x404.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F330cb1bb-9a98-45c1-b140-0fa8038d521f_1296x404.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F330cb1bb-9a98-45c1-b140-0fa8038d521f_1296x404.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F330cb1bb-9a98-45c1-b140-0fa8038d521f_1296x404.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F330cb1bb-9a98-45c1-b140-0fa8038d521f_1296x404.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F330cb1bb-9a98-45c1-b140-0fa8038d521f_1296x404.png" width="1296" height="404" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/330cb1bb-9a98-45c1-b140-0fa8038d521f_1296x404.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:404,&quot;width&quot;:1296,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:22549,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F330cb1bb-9a98-45c1-b140-0fa8038d521f_1296x404.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F330cb1bb-9a98-45c1-b140-0fa8038d521f_1296x404.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F330cb1bb-9a98-45c1-b140-0fa8038d521f_1296x404.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F330cb1bb-9a98-45c1-b140-0fa8038d521f_1296x404.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>And that’s it! This procedure is relatively straightforward and allows models to be represented with only two values, either </span><strong>-1</strong><span> or </span><strong>1</strong><span>. </span></p><p>Using this procedure, the authors observed that as the model size grows, the smaller the performance gap between a 1-bit and FP16-trained becomes.</p><p>However, this is only for larger models (&gt;30B parameters) and the gab with smaller models is still quite large.</p><p><a href="https://arxiv.org/pdf/2402.17764" rel="">BitNet 1.58b</a><span> was introduced to improve upon the scaling issue previously mentioned.</span><span><a data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-4-145531349" href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#footnote-4-145531349" target="_self" rel="">4</a></span></p><p><span>In this new method, every single weight of the model is not just </span><strong>-1</strong><span> or </span><strong>1</strong><span>, but can now also take </span><strong>0</strong><span> as a value, making it </span><em>ternary</em><span>. Interestingly, adding just the </span><strong>0</strong><span> greatly improves upon BitNet and allows for much faster computation.</span></p><p>So why is adding 0 such a major improvement?</p><p><span>It has everything to do with </span><em>matrix multiplication</em><span>!</span></p><p>First, let’s explore how matrix multiplication in general works. When calculating the output, we multiply a weight matrix by an input vector. Below, the first multiplication of the first layer of a weight matrix is visualized:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5f3a7393-5ad4-4375-8382-197c7a5aa442_1048x360.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5f3a7393-5ad4-4375-8382-197c7a5aa442_1048x360.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5f3a7393-5ad4-4375-8382-197c7a5aa442_1048x360.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5f3a7393-5ad4-4375-8382-197c7a5aa442_1048x360.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5f3a7393-5ad4-4375-8382-197c7a5aa442_1048x360.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5f3a7393-5ad4-4375-8382-197c7a5aa442_1048x360.png" width="1048" height="360" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/5f3a7393-5ad4-4375-8382-197c7a5aa442_1048x360.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:360,&quot;width&quot;:1048,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:24808,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5f3a7393-5ad4-4375-8382-197c7a5aa442_1048x360.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5f3a7393-5ad4-4375-8382-197c7a5aa442_1048x360.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5f3a7393-5ad4-4375-8382-197c7a5aa442_1048x360.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5f3a7393-5ad4-4375-8382-197c7a5aa442_1048x360.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>Note that this multiplication involves two actions, </span><strong>multiplying</strong><span> individual weights with the input and then </span><strong>adding</strong><span> them all together.</span></p><p>BitNet 1.58b, in contrast, manages to forego the act of multiplication since ternary weights essentially tell you the following:</p><ul><li><p>1: I want to add this value</p></li><li><p>0: I do not want this value</p></li><li><p>-1: I want to subtract this value</p></li></ul><p>As a result, you only need to perform addition if your weights are quantized to 1.58 bit:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5fed2720-9aa3-4b83-8ba7-4347b2fe1f0d_1048x360.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5fed2720-9aa3-4b83-8ba7-4347b2fe1f0d_1048x360.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5fed2720-9aa3-4b83-8ba7-4347b2fe1f0d_1048x360.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5fed2720-9aa3-4b83-8ba7-4347b2fe1f0d_1048x360.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5fed2720-9aa3-4b83-8ba7-4347b2fe1f0d_1048x360.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5fed2720-9aa3-4b83-8ba7-4347b2fe1f0d_1048x360.png" width="1048" height="360" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/5fed2720-9aa3-4b83-8ba7-4347b2fe1f0d_1048x360.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:360,&quot;width&quot;:1048,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:24345,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5fed2720-9aa3-4b83-8ba7-4347b2fe1f0d_1048x360.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5fed2720-9aa3-4b83-8ba7-4347b2fe1f0d_1048x360.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5fed2720-9aa3-4b83-8ba7-4347b2fe1f0d_1048x360.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5fed2720-9aa3-4b83-8ba7-4347b2fe1f0d_1048x360.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>Not only can this speed up computation significantly, but it also allows for </span><strong>feature filtering</strong><span>.</span></p><p>By setting a given weight to 0 you can now ignore it instead of either adding or subtracting the weights as is the case with 1-bit representations.</p><p><span>To perform weight quantization BitNet 1.58b uses </span><em>absmean</em><span> quantization which is a variation of the absmax quantization that we saw before. </span></p><p><span>It simply compresses the distribution of weights and uses the absolute mean (</span><strong>α</strong><span>) to quantize values. They are then rounded to either -1, 0, or 1:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Facda9425-8b3d-47fe-92de-16c33e57613b_1108x512.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Facda9425-8b3d-47fe-92de-16c33e57613b_1108x512.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Facda9425-8b3d-47fe-92de-16c33e57613b_1108x512.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Facda9425-8b3d-47fe-92de-16c33e57613b_1108x512.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Facda9425-8b3d-47fe-92de-16c33e57613b_1108x512.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Facda9425-8b3d-47fe-92de-16c33e57613b_1108x512.png" width="1108" height="512" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/acda9425-8b3d-47fe-92de-16c33e57613b_1108x512.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:512,&quot;width&quot;:1108,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:46816,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Facda9425-8b3d-47fe-92de-16c33e57613b_1108x512.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Facda9425-8b3d-47fe-92de-16c33e57613b_1108x512.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Facda9425-8b3d-47fe-92de-16c33e57613b_1108x512.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Facda9425-8b3d-47fe-92de-16c33e57613b_1108x512.png 1456w" sizes="100vw" loading="lazy"></picture></div></a></figure></div><p><span>Compared to BitNet the activation quantization is the same except for one thing. Instead of scaling the activations to range [</span><strong>0</strong><span>, </span><strong>2ᵇ⁻¹</strong><span>], they are now scaled to </span><br><span>[</span><strong>-2ᵇ⁻¹</strong><span>,</span><strong> 2ᵇ⁻¹</strong><span>] instead using </span><em>absmax quantization</em><span>.</span></p><p>And that’s it! 1.58-bit quantization required (mostly) two tricks:</p><ul><li><p><span>Adding </span><strong>0</strong><span> to create ternary representations [-1, 0, 1]</span></p></li><li><p><em>absmean quantization</em><span> for weights</span></p></li></ul><p><span>“</span><strong>13B</strong><span> BitNet b1.58 is more efficient, in terms of latency, memory usage, and energy consumption than a </span><strong>3B</strong><span> FP16 LLM”</span></p><p>As a result, we get lightweight models due to having only 1.58 computationally efficient bits!</p><p>This concludes our journey in quantization! Hopefully, this post gives you a better understanding of the potential of quantization, GPTQ, GGUF, and BitNet. Who knows how small the models will be in the future?!</p><p>To see more visualizations related to LLMs and to support this newsletter, check out the book I’m writing with Jay Alammar. It will be released soon!</p><p>Hopefully, this was an accessible introduction to quantization! If you want to go deeper, I would suggest the following resources:</p><ul><li><p><span>A HuggingFace blog about the </span><strong><a href="https://huggingface.co/blog/hf-bitsandbytes-integration" rel="">LLM.int8()</a></strong><span> quantization method: you can find the paper </span><a href="https://arxiv.org/pdf/2208.07339" rel="">here</a><span>. </span></p></li><li><p><span>Another great HuggingFace blog about </span><a href="https://huggingface.co/blog/embedding-quantization" rel="">quantization for </a><strong><a href="https://huggingface.co/blog/embedding-quantization" rel="">embeddings</a></strong><span>.</span></p></li><li><p><span>A blog about </span><a href="https://blog.eleuther.ai/transformer-math/" rel="">Transformer Math 101</a><span>, describing the basic math related to computation and memory usage for transformers.</span></p></li><li><p><a href="https://huggingface.co/spaces/NyxKrage/LLM-Model-VRAM-Calculator" rel="">This</a><span> and </span><a href="https://vram.asmirnov.xyz/" rel="">this</a><span> are two nice resources to calculate the (</span><strong>V)RAM</strong><span> you need for a given model.</span></p></li><li><p><span>If you want to know more about </span><strong>QLoRA</strong><span><a data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-5-145531349" href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-quantization#footnote-5-145531349" target="_self" rel="">5</a></span><span>, a quantization technique for fine-tuning, it is covered extensively in my upcoming book: </span><a href="https://www.amazon.com/Hands-Large-Language-Models-Understanding/dp/1098150961" rel="">Hands-On Large Language Models</a><span>.</span></p></li><li><p><span>A truly </span><a href="https://www.youtube.com/watch?v=mii-xFaPCrA" rel="">amazing YouTube video</a><span> about </span><strong>GPTQ</strong><span> explained incredibly intuitively. </span></p></li></ul></div></div>]]></description>
        </item>
    </channel>
</rss>