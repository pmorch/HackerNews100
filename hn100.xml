<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
    <channel>
        <title>HN100 - Readable Contents</title>
        <link>https://hn.algolia.com/api/v1/search_by_date?tags=%28story,poll%29&amp;numericFilters=points%3E100</link>
        <description>Uses Readability to add bodies to the RSS feed</description>
        <lastBuildDate>Sat, 20 Dec 2025 21:30:01 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Backing Up Spotify (277 pts)]]></title>
            <link>https://annas-archive.li/blog/backing-up-spotify.html</link>
            <guid>46338339</guid>
            <pubDate>Sat, 20 Dec 2025 18:28:41 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://annas-archive.li/blog/backing-up-spotify.html">https://annas-archive.li/blog/backing-up-spotify.html</a>, See on <a href="https://news.ycombinator.com/item?id=46338339">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
  

  <p>
    annas-archive.li/blog, 2025-12-20, <a href="https://news.ycombinator.com/item?id=46338339">Discuss on Hacker News</a>
  </p>

  <div>
    <p>We backed up Spotify (metadata and music files). It’s distributed in bulk torrents (~300TB), grouped by popularity.</p>
    <p>This release includes the largest publicly available music metadata database with 256 million tracks and 186 million unique ISRCs.</p>
    <p>It’s the world’s first “preservation archive” for music which is fully open (meaning it can easily be mirrored by anyone with enough disk space), with 86 million music files, representing around 99.6% of listens.</p>
  </div>

  <p>Anna’s Archive normally focuses on text (e.g. books and papers). We explained in <a href="https://annas-archive.li/blog/critical-window.html">“The critical window of shadow libraries”</a> that we do this because text has the highest information density. But our mission (preserving humanity’s knowledge and culture) doesn’t distinguish among media types. Sometimes an opportunity comes along outside of text. This is such a case.</p>
  <p>A while ago, we discovered a way to scrape Spotify at scale. We saw a role for us here to build a music archive primarily aimed at preservation.</p>
  <p>Generally speaking, music is already fairly well preserved. There are many music enthusiasts in the world who digitized their CD and LP collections, shared them through torrents or other digital means, and meticulously catalogued them.</p>
  <p>However, these existing efforts have some major issues:</p>
  <ol>
  <li><strong>Over-focus on the most popular artists.</strong> There is a long tail of music which only gets preserved when a single person cares enough to share it. And such files are often poorly seeded.</li>
  <li><strong>Over-focus on the highest possible quality.</strong> Since these are created by audiophiles with high end equipment and fans of a particular artist, they chase the highest possible file quality (e.g. lossless FLAC). This inflates the file size and makes it hard to keep a full archive of all music that humanity has ever produced.</li>
  <li><strong>No authoritative list of torrents aiming to represent all music ever produced.</strong> An equivalent of our book torrent list (which aggregate torrents from LibGen, Sci-Hub, Z-Lib, and many more) does not exist for music.</li>
  </ol>
  <p>This Spotify scrape is our humble attempt to start such a “preservation archive” for music. Of course Spotify doesn’t have all the music in the world, but it’s a great start.</p>
  <p>Before we dive into the details of this collection, here is a quick overview:</p>
  <ul>
  <li>Spotify has around 256 million tracks. This collection contains metadata for an estimated 99.9% of tracks.</li>
  <li>We archived around 86 million music files, representing around 99.6% of listens. It’s a little under 300TB in total size.</li>
  <li>We primarily used Spotify’s “popularity” metric to prioritize tracks. View the top 10,000 most popular songs in this <a href="https://annas-archive.li/blog/spotify/spotify-top-10k-songs-table.html">HTML file</a> (13.8MB gzipped).</li>
  <li>For <code>popularity&gt;0</code>, we got close to all tracks on the platform. The quality is the original <a href="https://en.wikipedia.org/wiki/Vorbis">OGG Vorbis</a> at 160kbit/s. Metadata was added without reencoding the audio (and an archive of diff files is available to reconstruct the original files from Spotify, as well as a metadata file with original hashes and checksums).</li>
  <li>For <code>popularity=0</code>, we got files representing about half the number of listens (either original or a copy with the same <a href="https://en.wikipedia.org/wiki/International_Standard_Recording_Code">ISRC</a>). The audio is reencoded to <a href="https://en.wikipedia.org/wiki/Opus_(audio_format">OGG Opus</a> at 75kbit/s — sounding the same to most people, but noticeable to an expert.</li>
  <li>The cutoff is 2025-07, anything released after that date may not be present (though in some cases it is).</li>
  <li>This is by far the largest music metadata database that is publicly available. For comparison, we have 256 million tracks, while <a href="https://en.wikipedia.org/wiki/List_of_online_music_databases">others</a> <a href="https://github.com/OatsCG/OMDB">have</a> 50-150 million. Our data is well-annotated: <a href="https://en.wikipedia.org/wiki/MusicBrainz">MusicBrainz</a> has 5 million unique ISRCs, while our database has 186 million.</li>
  <li>This is the world’s first “preservation archive” for music which is fully open (meaning it can easily be mirrored by anyone with enough disk space).</li>
  </ul>
  <p>The data will be released in different stages on our Torrents page:</p>
  <ul>
  <li>[X] Metadata (Dec 2025)</li>
  <li>[ ] Music files (releasing in order of popularity)</li>
  <li>[ ] Additional file metadata (torrent paths and checksums)</li>
  <li>[ ] Album art</li>
  <li>[ ] .zstdpatch files (to reconstruct original files before we added embedded metadata)</li>
  </ul>
  <p>For now this is a torrents-only archive aimed at preservation, but if there is enough interest, we could add downloading of individual files to Anna’s Archive. Please let us know if you’d like this.</p>
  <p>Please help preserve these files:</p>
  <ol>
  <li>Donate to Anna’s Archive. Any amount helps!</li>
  <li>Seed these torrents (on the Torrents page of Anna’s Archive). Even a seeding a few torrents helps!</li>
  </ol>
  <p>With your help, humanity’s musical heritage will be forever protected from destruction by natural disasters, wars, budget cuts, and other catastrophes.</p>
  <p>In this blog we will analyze the data and look at details of the release. We hope you enjoy.</p>
  <p>— Volunteer “ez” of Anna’s Archive team</p>

  <p>♫ ♫ ♫ ♫ ♫</p>

  <h2 id="data-exploration">Data Exploration</h2>
  <p>Let’s dive into the data! Here's some high-level statistics pulled from the metadata:</p>
  <p><a href="https://annas-archive.li/blog/spotify/sel_01_overview.png"><img src="https://annas-archive.li/blog/spotify/sel_01_overview.png"></a></p>
  <h3 id="songs-tracks">Songs / Tracks</h3>
  <p>Spotify has around 256 million tracks.</p>
  <p>The most convenient available way to sort songs on Spotify is using the popularity metric, <a href="https://developer.spotify.com/documentation/web-api/reference/get-track">defined</a> as follows:</p>
  <blockquote>
  <p>The popularity of a track is a value between 0 and 100, with 100 being the most popular. The popularity is calculated by algorithm and is based, in the most part, on the total number of plays the track has had and how recent those plays are.</p>
  <p>Generally speaking, songs that are being played a lot now will have a higher popularity than songs that were played a lot in the past. Duplicate tracks (e.g. the same track from a single and an album) are rated independently. Artist and album popularity is derived mathematically from track popularity.</p>
  </blockquote>
  <p>If we group songs by popularity, we see that there is an extremely large tail end:</p>
  <p><a href="https://annas-archive.li/blog/spotify/sel_08_songs_by_popularity.png"><img src="https://annas-archive.li/blog/spotify/sel_08_songs_by_popularity.png"></a></p>
  <p>≥70% of songs are ones almost no one ever listens to (stream count &lt; 1000). To see some detail, we can plot this on a logarithmic scale:</p>
  <p><a href="https://annas-archive.li/blog/spotify/sel_08b_songs_by_popularity_log.png"><img src="https://annas-archive.li/blog/spotify/sel_08b_songs_by_popularity_log.png"></a></p>
  <p>The top 10,000 songs span popularities 70-100. You can view them all in this <a href="https://annas-archive.li/blog/spotify/spotify-top-10k-songs-table.html">HTML file</a> (13.8MB gzipped).
  </p><p>Additionally, we can estimate the number of listens per track and total number per popularity. The stream count data is estimated since it is difficult to fetch at scale, so we sampled it randomly.</p>
  <p><a href="https://annas-archive.li/blog/spotify/sel_12d_combined_stream_count_by_popularity_linear.png"><img src="https://annas-archive.li/blog/spotify/sel_12d_combined_stream_count_by_popularity_linear.png"></a></p>
  <p>As we can see, most of the listens come from songs with a popularity between 50 and 80, even though there's only 210.000 songs with popularity ≥50, around 0.1% of songs. Note the huge (subjectively estimated) error bar on pop=0 — the reason for this is that Spotify does not publish stream counts for songs with &lt; 1000 streams.</p>
  <p>We can also estimate that the top three songs (as of writing) have a higher total stream count than the bottom <strong>20-100 million songs combined</strong>:</p>
  <table>
  <thead>
  <tr>
  <th>Artists</th>
  <th>Name</th>
  <th>Popularity</th>
  <th>Stream Count</th>
  </tr>
  </thead>
  <tbody>
  <tr>
  <td>Lady Gaga, Bruno Mars</td>
  <td>Die With A Smile</td>
  <td>100</td>
  <td>3.075 Billion</td>
  </tr>
  <tr>
  <td>Billie Eilish</td>
  <td>BIRDS OF A FEATHER</td>
  <td>98</td>
  <td>3.137 Billion</td>
  </tr>
  <tr>
  <td>Bad Bunny</td>
  <td>DtMF</td>
  <td>98</td>
  <td>1.124 Billion</td>
  </tr>
  </tbody>
  </table>
  <details>
  <summary>SQLite Query</summary>
  <pre><code>select json_group_array(artists.name), tracks.name, tracks.popularity
    from tracks
    join track_artists on track_rowid = tracks.rowid
    join artists on artist_rowid = artists.rowid
    where tracks.id in (select id from tracks order by popularity desc limit 3)
    group by tracks.id;</code></pre>
  </details>

  <p>Note that the popularity is very time-dependent and not directly translatable into stream counts, so these top songs are basically arbitrary.</p>
  <h3 id="songs">Songs</h3>
  <p>We have archived around 86 million songs from Spotify, ordering by popularity descending. While this only represents 37% of songs, it represents around 99.6% of listens:</p>
  <p><a href="https://annas-archive.li/blog/spotify/sel_12e_dls.png"><img src="https://annas-archive.li/blog/spotify/sel_12e_dls.png"></a></p>
  <p>Put another way, for any random song a person listens to, there is a 99.6% likelihood that it is part of the archive. We expect this number to be higher if you filter to only human-created songs. Do remember though that the error bar on listens for popularity 0 is large.</p>
  <p>For <code>popularity=0</code>, we ordered tracks by a secondary importance metric based on artist followers and album popularity, and fetched in descending order.</p>
  <p>We have stopped here due to the long tail end with diminishing returns (700TB+ additional storage for minor benefit), as well as the bad quality of songs with <code>popularity=0</code> (many AI generated, hard to filter).</p>
  <h2 id="torrents">Torrents</h2>
  <p>Before diving into more fun stats, let’s look at how the collection itself is structured. It’s in two parts: <strong>metadata</strong> and <strong>music files</strong>, both of which are distributed through torrents.</p>
  <h3 id="metadata">Metadata</h3>
  <p>The metadata torrents contain, based on statistical analysis, around 99.9% of artists, albums, tracks. The metadata is published as compact queryable SQLite databases. Care was taken, by doing API response reconstruction, that there is (almost) no data loss in the conversion from the API JSON.</p>
  <p>The metadata for artists, albums, tracks is less than 200 GB compressed. The secondary metadata of audio analysis is 4TB compressed.</p>
  <p>We look at more detail at the structure of the metadata at the end of this blog post.</p>
  <h3 id="music-files">Music Files</h3>
  <p>The data itself is distributed in the <a href="https://annas-archive.li/blog/annas-archive-containers.html">Anna’s Archive Containers (AAC)</a> format. This is a standard which we created a few years ago for distributing files across multiple torrents. It is not to be confused with the <a href="https://en.wikipedia.org/wiki/Advanced_Audio_Coding">Advanced Audio Coding (AAC)</a> encoding format.</p>
  <p>Since the original files contain zero metadata, as much metadata as possible was added to the OGG files, including title, url, ISRC, UPC, album art, replaygain information, etc. The invalid OGG data packet Spotify prepends to every track file was stripped — it is present in the <code>track_files</code> db.</p>
  <p>For <code>popularity&gt;0</code>, the quality is the original <a href="https://en.wikipedia.org/wiki/Vorbis">OGG Vorbis</a> at 160kbit/s. Metadata was added without reencoding the audio (and an archive of diff files is available to reconstruct the original files from Spotify).</p>
  <p>For <code>popularity=0</code>, the audio is reencoded to <a href="https://en.wikipedia.org/wiki/Opus_(audio_format">OGG Opus</a> at 75kbit/s — sounding the same to most people, but noticeable to an expert.</p>
  <p>There is a known bug where the <code>REPLAYGAIN_ALBUM_PEAK</code> vorbiscomment tag value is a copy-paste of <code>REPLAYGAIN_ALBUM_GAIN</code> instead of the correct value for many files.</p>
  <h3 id="the-true-shuffle">The True Shuffle</h3>
  <p>Many people complain about how Spotify shuffles tracks. Since we have metadata for 99.9+% of tracks on Spotify, we can create a <strong>true</strong> shuffle across all songs on Spotify!</p>
  <details><summary>Example True Shuffle Playlist</summary>

  <pre><code>$ sqlite3 spotify_clean.sqlite3
  sqlite&gt; .mode table
  sqlite&gt; with random_ids as (select value as inx, (abs(random())%(select max(rowid) from tracks)) as trowid from generate_series(0)) select inx,tracks.id,tracks.popularity,tracks.name from random_ids join tracks on tracks.rowid=trowid limit 20;
  +-----+------------------------+------------+--------------------------------------------------------------+
  | inx |           id           | popularity |                             name                             |
  +-----+------------------------+------------+--------------------------------------------------------------+
  | 0   | 7KS7cm2arAGA2VZaZ2XvNa | 0          | Just Derry                                                   |
  +-----+------------------------+------------+--------------------------------------------------------------+
  | 1   | 1BkLS2tmxD088l2ojUW5cv | 0          | Kapitel 37 - Aber erst wird gegessen - Schon wieder Weihnach |
  |     |                        |            | ten mit der buckligen Verwandtschaft                         |
  +-----+------------------------+------------+--------------------------------------------------------------+
  | 2   | 5RSU7MELzCaPweG8ALmjLK | 0          | El Buen Pastor                                               |
  +-----+------------------------+------------+--------------------------------------------------------------+
  | 3   | 1YNIl8AKIFltYH8O2coSoT | 0          | You Are The One                                              |
  +-----+------------------------+------------+--------------------------------------------------------------+
  | 4   | 1GxMuEYWs6Lzbn2EcHAYVx | 0          | Waorani                                                      |
  +-----+------------------------+------------+--------------------------------------------------------------+
  | 5   | 4NhARf6pjwDpbyQdZeSsW3 | 0          | Magic in the Sand                                            |
  +-----+------------------------+------------+--------------------------------------------------------------+
  | 6   | 7pDrZ6rGaO6FHk6QtTKvQo | 0          | Yo No Fui                                                    |
  +-----+------------------------+------------+--------------------------------------------------------------+
  | 7   | 15w4LBQ6rkf3QA2OiSMBRD | 25         | 你走                                                         |
  +-----+------------------------+------------+--------------------------------------------------------------+
  | 8   | 5Tx7jRLKfYlay199QB2MSs | 0          | Soul Clap                                                    |
  +-----+------------------------+------------+--------------------------------------------------------------+
  | 9   | 3L7CkCD9595MuM0SVuBZ64 | 1          | Xuân Và Tuổi Trẻ                                             |
  +-----+------------------------+------------+--------------------------------------------------------------+
  | 10  | 4S6EkSnfxlU5UQUOZs7bKR | 1          | Elle était belle                                             |
  +-----+------------------------+------------+--------------------------------------------------------------+
  | 11  | 0ZIOUYrrArvSTq6mrbVqa1 | 0          | Kapitel 7.2 - Die Welt der Magie - 4 in 1 Sammelband: Weiße  |
  |     |                        |            | Magie | Medialität, Channeling &amp; Trance | Divination &amp; Wahrs |
  |     |                        |            | agen | Energetisches Heilen                                  |
  +-----+------------------------+------------+--------------------------------------------------------------+
  | 12  | 4VfKaW1X1FKv8qlrgKbwfT | 0          | Pura energia                                                 |
  +-----+------------------------+------------+--------------------------------------------------------------+
  | 13  | 1VugH5kD8tnMKAPeeeTK9o | 10         | Dalia                                                        |
  +-----+------------------------+------------+--------------------------------------------------------------+
  | 14  | 6NPPbOybTFLL0LzMEbVvuo | 4          | Teil 12 - Folge 2: Arkadien brennt                           |
  +-----+------------------------+------------+--------------------------------------------------------------+
  | 15  | 1VSVrAbaxNllk7ojNGXDym | 3          | Bre Petrunko                                                 |
  +-----+------------------------+------------+--------------------------------------------------------------+
  | 16  | 4NSmBO7uzkuES7vDLvHtX8 | 0          | Paranoia                                                     |
  +-----+------------------------+------------+--------------------------------------------------------------+
  | 17  | 7AHhiIXvx09DRZGQIsbcxB | 0          | Sand Underfoot Moments                                       |
  +-----+------------------------+------------+--------------------------------------------------------------+
  | 18  | 0sitt32n4JoSM1ewOWL7hs | 0          | Start Over Again                                             |
  +-----+------------------------+------------+--------------------------------------------------------------+
  | 19  | 080Zimdx271ixXbzdZOqSx | 3          | Auf all euren Wegen                                          |
  +-----+------------------------+------------+--------------------------------------------------------------+</code></pre>
  </details>

  <details><summary>Or, filtering to only somewhat popular songs</summary>

  <pre><code>sqlite&gt; with random_ids as (select value as inx, (abs(random())%(select max(rowid) from tracks)) as trowid from generate_series(0)) select inx,tracks.id,tracks.popularity,albums.name as album_name,tracks.name from random_ids join tracks on tracks.rowid=trowid join albums on albums.rowid = album_rowid
  where tracks.popularity &gt;= 10 limit 20;
  +-----+------------------------+------------+--------------------------------------+-------------------------------+
  | inx |           id           | popularity |                      album_name      |             name              |
  +-----+------------------------+------------+--------------------------------------+-------------------------------+
  | 32  | 1om6LphEpiLpl9irlOsnzb | 23         | The Essential Widespread Panic       | Love Tractor                  |
  | 47  | 2PCtPCRDia6spej5xcxbvW | 20         | Desatinos Desplumados                | Sirena                        |
  | 65  | 5wmR10WloZqVVdIpYhdaqq | 20         | Um Passeio pela Harpa Cristã - Vol 6 | As Santas Escrituras          |
  | 89  | 5xCuYNX3QlPsxhKLbWlQO9 | 11         | No Me Amenaces                       | No Me Amenaces                |
  | 96  | 2GRmiDIcIwhQnkxakNyUy4 | 16         | Very Bad Truth (Kingston Universi... | Kapitel 8.3 - Very Bad Truth  |
  | 98  | 5720pe1PjNXoMcbDPmyeLW | 11         | Kleiner Eisbär: Hilf mir fliegen!    | Kapitel 06: Hilf mir fliegen! |
  | 109 | 1mRXGNVsfD9UtFw6r5YtzF | 11         | Lunar Archive                        | Outdoor Seating               |
  | 110 | 5XOQwf6vkcJxWG9zgqVEWI | 19         | Teenage Dream                        | Firework                      |
  | 125 | 0rbHOp8B4CpPXXZSekySvv | 15         | Previa y Cachengue 2025              | Debi tirar mas fotos          |
  | 145 | 4RGj8KyWGMjrUEseDTc3MO | 19         | High Noon over Camelot               | "The Hierophant"              |
  | 158 | 1MebBcPcUNgdVRMSfzJIyS | 21         | RBS                                  | Estar Vivo                    |
  | 176 | 0E6h47PjbHJFno9IImwFFm | 17         | The Raga Guide                       | Bilaskhani Todi               |
  | 196 | 1QcziEkM8mZSm0hJ1rC2Ft | 14         | Meu Abraço                           | Meu Abraço                    |
  | 204 | 33vRjP0CI7krO2KQ6YS1u7 | 14         | Joan Shelley                         | Pull Me Up One More Time      |
  | 231 | 3rnTIldZ0uHr5aooIwJjvF | 12         | Stjörnulífið                         | Illuminati                    |
  | 246 | 6aVxXv5ywGL2xc2dg0I5jT | 10         | Family                               | Hana no Youni                 |
  | 252 | 3ESGm5fRIOtzA7BfKlNIZy | 10         | Out Of Control                       | Let's Try Love Again          |
  | 297 | 4jZmhTVjIWBmFfnolYLmD5 | 18         | Blood Brothers                       | Faster and Louder             |
  | 298 | 0ebW1CJ4tYRx3VHfqbWzUh | 19         | Vibe da Faixa Rosa                   | Vibe da Faixa Rosa            |
  | 299 | 5xuK0SlWkAqs0w1sq6BZSk | 15         | Swingin Hammers                      | Hangman                       |
  +-----+------------------------+------------+--------------------------------------+-------------------------------+</code></pre>

  </details>

  <h2 id="more-stats">More Stats</h2>
  <p>Here's some more statistics:</p>
  <h3 id="tracks">Tracks</h3>
  <p><a href="https://annas-archive.li/blog/spotify/sel_09_songs_by_duration.png"><img src="https://annas-archive.li/blog/spotify/sel_09_songs_by_duration.png"></a></p>
  <p>We're curious about the peaks at whole minutes (particularly 2:00, 3:00, 4:00). If you know why this is, please let us know!</p>
  <p><a href="https://annas-archive.li/blog/spotify/sel_09b_songs_by_duration_long.png"><img src="https://annas-archive.li/blog/spotify/sel_09b_songs_by_duration_long.png"></a></p>
  <p><a href="https://annas-archive.li/blog/spotify/sel_10_songs_by_explicit.png"><img src="https://annas-archive.li/blog/spotify/sel_10_songs_by_explicit.png"></a></p>
  <p>Some songs, especially popular songs, have 2, 3, or even 20 different versions. We can quantify this by counting number of songs per <a href="https://en.wikipedia.org/wiki/International_Standard_Recording_Code">ISRC</a>:</p>
  <p><a href="https://annas-archive.li/blog/spotify/sel_11_songs_by_isrc_count.png"><img src="https://annas-archive.li/blog/spotify/sel_11_songs_by_isrc_count.png"></a></p>
  <p>Each song on Spotify is only available on a specific set of markets. Most songs are available on most markets, but if we filter to popular songs, you can see a difference in availability (without filtering, the graph is almost flat):</p>
  <p><a href="https://annas-archive.li/blog/spotify/sel_05c_songs_by_market_popgte10.png"><img src="https://annas-archive.li/blog/spotify/sel_05c_songs_by_market_popgte10.png"></a></p>
  <h3 id="artists">Artists</h3>
  <p>Spotify provides a list of genres per artist (not per song). If we count the artists for each genre, we get this result:</p>
  <p><a href="https://annas-archive.li/blog/spotify/sel_02_top_genres.png"><img src="https://annas-archive.li/blog/spotify/sel_02_top_genres.png"></a></p>
  <p>Since each genre is very specific, we can also group genres and count the results:</p>
  <p><a href="https://annas-archive.li/blog/spotify/sel_04_genre_sunburst.png"><img src="https://annas-archive.li/blog/spotify/sel_04_genre_sunburst.png"></a></p>
  <p>We can also group artists by popularity. The resulting graph looks very similar to the tracks popularity graph:</p>
  <p><a href="https://annas-archive.li/blog/spotify/sel_07h_artists_by_popularity_log.png"><img src="https://annas-archive.li/blog/spotify/sel_07h_artists_by_popularity_log.png"></a></p>
  <p>The same graph for albums also looks the same.</p>
  <h3 id="albums">Albums</h3>
  <p>If we group albums by release year, we see that more and more new music is added to Spotify, a lot of it likely automatically generated:</p>
  <p><a href="https://annas-archive.li/blog/spotify/sel_06_albums_timeline.png"><img src="https://annas-archive.li/blog/spotify/sel_06_albums_timeline.png"></a></p>
  <p>The amount of procedurally and AI generated content makes it hard to find what is actually valuable.</p>
  <p><a href="https://annas-archive.li/blog/spotify/sel_07e_albums_by_tracks.png"><img src="https://annas-archive.li/blog/spotify/sel_07e_albums_by_tracks.png"></a></p>
  <p>You can see that most songs on Spotify are singles, not part of an album.</p>
  <p><a href="https://annas-archive.li/blog/spotify/sel_07f_albums_by_upc_count.png"><img src="https://annas-archive.li/blog/spotify/sel_07f_albums_by_upc_count.png"></a></p>
  <h3 id="audio-features">Audio Features</h3>
  <p>We also scraped audio features generated by Spotify. They can be analyzed to find interesting trends.</p>
  <p><a href="https://annas-archive.li/blog/spotify/sel_af_25_mode_by_key.png"><img src="https://annas-archive.li/blog/spotify/sel_af_25_mode_by_key.png"></a></p>
  <p><a href="https://annas-archive.li/blog/spotify/sel_af_23c_feature_heatmap_grid.png"><img src="https://annas-archive.li/blog/spotify/sel_af_23c_feature_heatmap_grid.png"></a></p>
  <p>This chart contains a lot of information. You can for example see that loudness correlates with energy and that BPM is normally distributed with a mean around 120.</p>
  
  <h3 id="-annas_archive_spotify_2025_07_metadata-torrent-spotify_clean-sqlite3-"><code>annas_archive_spotify_2025_07_metadata.torrent/spotify_clean.sqlite3</code></h3>
  <p>A scrape of the three main APIs of Spotify: artists, albums, tracks. Each track exists in exactly one album, but each track and each album can have multiple artists.</p>
  <p>The tables are an almost lossless representation of Spotify API JSON responses, care was taken during creation by always reconstructing the original JSON based on each inserted row, with minor exceptions.</p>
  <pre><code><span>CREATE</span> <span>TABLE</span> <span>`artists`</span> (
          <span>`rowid`</span> <span>integer</span> PRIMARY <span>KEY</span> <span>NOT</span> <span>NULL</span>,
          <span>/* The original Spotify base62 ID. */</span>
          <span>`id`</span> <span>text</span> <span>NOT</span> <span>NULL</span>,
          <span>/* When the item was fetched (unixepoch ms). */</span>
          <span>`fetched_at`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>/* "The name of the artist."*/</span>
          <span>`name`</span> <span>text</span> <span>NOT</span> <span>NULL</span>,
          <span>/* followers.total - "The total number of followers." */</span>
          <span>`followers_total`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>/* "The popularity of the artist. The value will be between 0 and 100, with 100 being the most popular. The artist's popularity is calculated from the popularity of all the artist's tracks." */</span>
          <span>`popularity`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>
  );
  <span>/* "A list of the genres the artist is associated with. If not yet classified, the array is empty." */</span>
  <span>CREATE</span> <span>TABLE</span> <span>`artist_genres`</span> (
          <span>`artist_rowid`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>`genre`</span> <span>text</span> <span>NOT</span> <span>NULL</span>,
          FOREIGN <span>KEY</span> (<span>`artist_rowid`</span>) <span>REFERENCES</span> <span>`artists`</span>(<span>`rowid`</span>)
  );
  <span>/* Images of the artist in various sizes, widest first. */</span>
  <span>CREATE</span> <span>TABLE</span> <span>`artist_images`</span> (
          <span>`artist_rowid`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>`width`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>`height`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>`url`</span> <span>text</span> <span>NOT</span> <span>NULL</span>,
          FOREIGN <span>KEY</span> (<span>`artist_rowid`</span>) <span>REFERENCES</span> <span>`artists`</span>(<span>`rowid`</span>)
  );
  <span>/*
   * Information about artist-albums relationships from /artists/{id}/albums, album.artists[] and album.tracks[].artists[].
   * The relationships "album", "single", "compilation" are left out because they can be reconstructed from `album.type`.
   */</span>
  <span>CREATE</span> <span>TABLE</span> <span>"artist_albums"</span> (
          <span>`artist_rowid`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>`album_rowid`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>/* True if this link was retrieved from /artists/{id}/albums with an "album_group" response of "appears_on". */</span>
          <span>`is_appears_on`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>/* True if this link is based on the actual artists of each track in the album. Only exists if the link is not explicit (above). */</span>
          <span>`is_implicit_appears_on`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>/* If neither is_appears_on or is_implicit_appears_on, the index of album.data.artists[] this was retrieved from. */</span>
          <span>`index_in_album`</span> <span>integer</span>,
          FOREIGN <span>KEY</span> (<span>`artist_rowid`</span>) <span>REFERENCES</span> <span>`artists`</span>(<span>`rowid`</span>),
          FOREIGN <span>KEY</span> (<span>`album_rowid`</span>) <span>REFERENCES</span> <span>`albums`</span>(<span>`rowid`</span>)
  );
  <span>/* combinations of available markets in a separate table to save space */</span>
  <span>CREATE</span> <span>TABLE</span> <span>`available_markets`</span> (
          <span>`rowid`</span> <span>integer</span> PRIMARY <span>KEY</span> <span>NOT</span> <span>NULL</span>,
          <span>/* comma separated ISO 3166-1 alpha-2 country codes. */</span>
          <span>`available_markets`</span> <span>text</span> <span>NOT</span> <span>NULL</span>
  );
  <span>/* /albums/{id} - "Get Spotify catalog information for a single album." */</span>
  <span>CREATE</span> <span>TABLE</span> <span>`albums`</span> (
          <span>`rowid`</span> <span>integer</span> PRIMARY <span>KEY</span> <span>NOT</span> <span>NULL</span>,
          <span>/* The original Spotify base62 ID. */</span>
          <span>`id`</span> <span>text</span> <span>NOT</span> <span>NULL</span>,
          <span>/* When the item was fetched (unixepoch ms). */</span>
          <span>`fetched_at`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>/* "The name of the album. In case of an album takedown, the value may be an empty string." */</span>
          <span>`name`</span> <span>text</span> <span>NOT</span> <span>NULL</span>,
          <span>/* 'The type of the album. Allowed values: "album", "single", "compilation"' */</span>
          <span>`album_type`</span> <span>text</span> <span>NOT</span> <span>NULL</span>,
          <span>/* available markets as an index into the available_markets table to save space. - "The markets in which the album is available: ISO 3166-1 alpha-2 country codes. <span>NOTE:</span> an album is considered available in a market when at least 1 of its tracks is available in that market." */</span>
          <span>`available_markets_rowid`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>/* external_id.upc - Universal Product Code */</span>
          <span>`external_id_upc`</span> <span>text</span>,
          <span>/* external_id.amgid - undocumented - AMG MUSIC GROUP Internal ID */</span>
          <span>"external_id_amgid"</span> <span>text</span>,
          <span>/* "The copyright" */</span>
          <span>`copyright_c`</span> <span>text</span>,
          <span>/* "The sound recording (performance) copyright." */</span>
          <span>`copyright_p`</span> <span>text</span>,
          <span>/* "The label associated with the album." */</span>
          <span>`label`</span> <span>text</span> <span>NOT</span> <span>NULL</span>,
          <span>/* "The popularity of the album. The value will be between 0 and 100, with 100 being the most popular." */</span>
          <span>`popularity`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>/* "The date the album was first released." */</span>
          <span>`release_date`</span> <span>text</span> <span>NOT</span> <span>NULL</span>,
          <span>/* 'The precision with which release_date value is known. Allowed values: "year", "month", "day"' */</span>
          <span>`release_date_precision`</span> <span>text</span> <span>NOT</span> <span>NULL</span>,
          <span>/* tracks.total */</span>
          <span>`total_tracks`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          FOREIGN <span>KEY</span> (<span>`available_markets_rowid`</span>) <span>REFERENCES</span> <span>`available_markets`</span>(<span>`rowid`</span>)
  );

  <span>/* album.images[] - "The cover art for the album in various sizes, widest first." */</span>
  <span>CREATE</span> <span>TABLE</span> <span>"album_images"</span> (
          <span>`album_rowid`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>`width`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>`height`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>`url`</span> <span>text</span> <span>NOT</span> <span>NULL</span>,
          FOREIGN <span>KEY</span> (<span>`album_rowid`</span>) <span>REFERENCES</span> <span>`albums`</span>(<span>`rowid`</span>)
  );
  <span>/* /tracks/{id} */</span>
  <span>CREATE</span> <span>TABLE</span> <span>`tracks`</span> (
          <span>`rowid`</span> <span>integer</span> PRIMARY <span>KEY</span> <span>NOT</span> <span>NULL</span>,
          <span>/* The original Spotify base62 ID. */</span>
          <span>`id`</span> <span>text</span> <span>NOT</span> <span>NULL</span>,
          <span>/* When the item was fetched (unixepoch ms). */</span>
          <span>`fetched_at`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>/* "The name of the track." */</span>
          <span>`name`</span> <span>text</span> <span>NOT</span> <span>NULL</span>,
          <span>/* "A link to a 30 second preview (MP3 format) of the track. Can be null" */</span>
          <span>`preview_url`</span> <span>text</span>,
          <span>`album_rowid`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>/* "The number of the track. If an album has several discs, the track number is the number on the specified disc." */</span>
          <span>`track_number`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>/* http://en.wikipedia.org/wiki/International_Standard_Recording_Code */</span>
          <span>`external_id_isrc`</span> <span>text</span>,
          <span>`external_id_ean`</span> <span>text</span>,
          <span>`external_id_upc`</span> <span>text</span>,
          <span>/* "The popularity of the track. The value will be between 0 and 100, with 100 being the most popular.
  The popularity of a track is a value between 0 and 100, with 100 being the most popular. The popularity is calculated by algorithm and is based, in the most part, on the total number of plays the track has had and how recent those plays are.
  Generally speaking, songs that are being played a lot now will have a higher popularity than songs that were played a lot in the past. Duplicate tracks (e.g. the same track from a single and an album) are rated independently. Artist and album popularity is derived mathematically from track popularity. Note: the popularity value may lag actual popularity by a few days: the value is not updated in real time." */</span>
          <span>`popularity`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>/* A reference into the available_markets table. - "A list of the countries in which the track can be played, identified by their ISO 3166-1 alpha-2 code." */</span>
          <span>`available_markets_rowid`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>/* "The disc number (usually 1 unless the album consists of more than one disc)." */</span>
          <span>`disc_number`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>/* "The track length in milliseconds." */</span>
          <span>`duration_ms`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>/* "Whether or not the track has explicit lyrics ( true = yes it does; false = no it does not OR unknown)." */</span>
          <span>`explicit`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          FOREIGN <span>KEY</span> (<span>`available_markets_rowid`</span>) <span>REFERENCES</span> <span>`available_markets`</span>(<span>`rowid`</span>)
  );
  <span>/* "The artists who performed the track." */</span>
  <span>CREATE</span> <span>TABLE</span> <span>`track_artists`</span> (
          <span>`track_rowid`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>`artist_rowid`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          FOREIGN <span>KEY</span> (<span>`track_rowid`</span>) <span>REFERENCES</span> <span>`tracks`</span>(<span>`rowid`</span>),
          FOREIGN <span>KEY</span> (<span>`artist_rowid`</span>) <span>REFERENCES</span> <span>`artists`</span>(<span>`rowid`</span>)
  );

  <span>CREATE</span> <span>INDEX</span> <span>`artist_genres_artist_id`</span> <span>ON</span> <span>`artist_genres`</span> (<span>`artist_rowid`</span>);
  <span>CREATE</span> <span>INDEX</span> <span>`artist_genres_genre`</span> <span>ON</span> <span>`artist_genres`</span> (<span>`genre`</span>);
  <span>CREATE</span> <span>INDEX</span> <span>`artist_images_artist_id`</span> <span>ON</span> <span>`artist_images`</span> (<span>`artist_rowid`</span>);
  <span>CREATE</span> <span>UNIQUE</span> <span>INDEX</span> <span>`artists_id_unique`</span> <span>ON</span> <span>`artists`</span> (<span>`id`</span>);
  <span>CREATE</span> <span>INDEX</span> <span>`artists_name`</span> <span>ON</span> <span>`artists`</span> (<span>`name`</span>);
  <span>CREATE</span> <span>INDEX</span> <span>`artists_popularity`</span> <span>ON</span> <span>`artists`</span> (<span>`popularity`</span>);
  <span>CREATE</span> <span>INDEX</span> <span>`artists_followers`</span> <span>ON</span> <span>`artists`</span> (<span>`followers_total`</span>);
  <span>CREATE</span> <span>INDEX</span> <span>`artist_album_artist_id`</span> <span>ON</span> <span>"artist_albums"</span> (<span>`artist_rowid`</span>);
  <span>CREATE</span> <span>INDEX</span> <span>`artist_album_album_id`</span> <span>ON</span> <span>"artist_albums"</span> (<span>`album_rowid`</span>);
  <span>CREATE</span> <span>UNIQUE</span> <span>INDEX</span> <span>`albums_id_unique`</span> <span>ON</span> <span>`albums`</span> (<span>`id`</span>);
  <span>CREATE</span> <span>INDEX</span> <span>`album_name`</span> <span>ON</span> <span>`albums`</span> (<span>`name`</span>);
  <span>CREATE</span> <span>INDEX</span> <span>`album_popularity`</span> <span>ON</span> <span>`albums`</span> (<span>`popularity`</span>);
  <span>CREATE</span> <span>UNIQUE</span> <span>INDEX</span> <span>`available_markets_available_markets_unique`</span> <span>ON</span> <span>`available_markets`</span> (<span>`available_markets`</span>);
  <span>CREATE</span> <span>INDEX</span> <span>`track_artists_artist_id`</span> <span>ON</span> <span>`track_artists`</span> (<span>`artist_rowid`</span>);
  <span>CREATE</span> <span>INDEX</span> <span>`track_artists_track_id`</span> <span>ON</span> <span>`track_artists`</span> (<span>`track_rowid`</span>);
  <span>CREATE</span> <span>UNIQUE</span> <span>INDEX</span> <span>`tracks_id_unique`</span> <span>ON</span> <span>`tracks`</span> (<span>`id`</span>);
  <span>CREATE</span> <span>INDEX</span> <span>`tracks_popularity`</span> <span>ON</span> <span>`tracks`</span> (<span>`popularity`</span>);
  <span>CREATE</span> <span>INDEX</span> <span>`tracks_album`</span> <span>ON</span> <span>`tracks`</span> (<span>`album_rowid`</span>);
  <span>CREATE</span> <span>INDEX</span> <span>`album_images_album_id`</span> <span>ON</span> <span>`album_images`</span> (<span>`album_rowid`</span>);
  <span>CREATE</span> <span>INDEX</span> tracks_isrc <span>on</span> tracks(external_id_isrc);</code></pre>

  <h3 id="-annas_archive_spotify_2025_07_metadata-torrent-spotify_clean_audio_features-sqlite3-"><code>annas_archive_spotify_2025_07_metadata.torrent/spotify_clean_audio_features.sqlite3</code></h3>
  <p>A scrape of <code>AudioFeatures</code> objects from the Spotify API. One row per track.</p>
  <pre><code><span>/* /audio-features/{id} "Get audio feature information for a single track identified by its unique Spotify ID." */</span>
  <span>CREATE</span> <span>TABLE</span> <span>`track_audio_features`</span> (
          <span>`rowid`</span> <span>integer</span> PRIMARY <span>KEY</span> <span>NOT</span> <span>NULL</span>,
          <span>`track_id`</span> <span>text</span> <span>NOT</span> <span>NULL</span>,
          <span>`fetched_at`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>/* true if the API returned null for the whole request */</span>
          <span>`null_response`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>/* "The duration of the track in milliseconds." */</span>
          <span>`duration_ms`</span> <span>integer</span>,
          <span>/* 'An estimated time signature. The time signature (meter) is a notational convention to specify how many beats are in each bar (or measure). The time signature ranges from 3 to 7 indicating time signatures of "3/4", to "7/4".' */</span>
          <span>`time_signature`</span> <span>integer</span>,
          <span>/* "The overall estimated tempo of a track in beats per minute (BPM). In musical terminology, tempo is the speed or pace of a given piece and derives directly from the average beat duration." */</span>
          <span>`tempo`</span> <span>integer</span>,
          <span>/* "The key the track is in. Integers map to pitches using standard Pitch Class notation. E.g. 0 = C, 1 = C♯/D♭, 2 = D, and so on. If no key was detected, the value is -1." */</span>
          <span>`key`</span> <span>integer</span>,
          <span>/* "Mode indicates the modality (major or minor) of a track, the type of scale from which its melodic content is derived. Major is represented by 1 and minor is 0." */</span>
          <span>`mode`</span> <span>integer</span>,
          <span>/* "Danceability describes how suitable a track is for dancing based on a combination of musical elements including tempo, rhythm stability, beat strength, and overall regularity. A value of 0.0 is least danceable and 1.0 is most danceable." */</span>
          <span>`danceability`</span> <span>real</span>,
          <span>/* "Energy is a measure from 0.0 to 1.0 and represents a perceptual measure of intensity and activity. Typically, energetic tracks feel fast, loud, and noisy. For example, death metal has high energy, while a Bach prelude scores low on the scale. Perceptual features contributing to this attribute include dynamic range, perceived loudness, timbre, onset rate, and general entropy." */</span>
          <span>`energy`</span> <span>real</span>,
          <span>/* "The overall loudness of a track in decibels (dB). Loudness values are averaged across the entire track and are useful for comparing relative loudness of tracks. Loudness is the quality of a sound that is the primary psychological correlate of physical strength (amplitude). Values typically range between -60 and 0 db." */</span>
          <span>`loudness`</span> <span>real</span>,
          <span>/* "Speechiness detects the presence of spoken words in a track. The more exclusively speech-like the recording (e.g. talk show, audio book, poetry), the closer to 1.0 the attribute value. Values above 0.66 describe tracks that are probably made entirely of spoken words. Values between 0.33 and 0.66 describe tracks that may contain both music and speech, either in sections or layered, including such cases as rap music. Values below 0.33 most likely represent music and other non-speech-like tracks." */</span>
          <span>`speechiness`</span> <span>real</span>,
          <span>/* "A confidence measure from 0.0 to 1.0 of whether the track is acoustic. 1.0 represents high confidence the track is acoustic." */</span>
          <span>`acousticness`</span> <span>real</span>,
          <span>/* "Predicts whether a track contains no vocals. "Ooh" and "aah" sounds are treated as instrumental in this context. Rap or spoken word tracks are clearly "vocal". The closer the instrumentalness value is to 1.0, the greater likelihood the track contains no vocal content. Values above 0.5 are intended to represent instrumental tracks, but confidence is higher as the value approaches 1.0." */</span>
          <span>`instrumentalness`</span> <span>real</span>,
          <span>/* "Detects the presence of an audience in the recording. Higher liveness values represent an increased probability that the track was performed live. A value above 0.8 provides strong likelihood that the track is live." */</span>
          <span>`liveness`</span> <span>real</span>,
          <span>/* "A measure from 0.0 to 1.0 describing the musical positiveness conveyed by a track. Tracks with high valence sound more positive (e.g. happy, cheerful, euphoric), while tracks with low valence sound more negative (e.g. sad, depressed, angry)." */</span>
          <span>`valence`</span> <span>real</span>
  );
  <span>CREATE</span> <span>UNIQUE</span> <span>INDEX</span> <span>`track_audio_features_track_id_unique`</span> <span>ON</span> <span>`track_audio_features`</span> (<span>`track_id`</span>);</code></pre>

  <h3 id="-annas_archive_spotify_2025_07_metadata-torrent-spotify_clean_playlists-sqlite3-"><code>annas_archive_spotify_2025_07_metadata.torrent/spotify_clean_playlists.sqlite3</code></h3>
  <p>A scrape of <code>Playlist</code> objects from the Spotify API. Requires the <code>spotify_clean.sqlite3</code> database to map track_rowid to track_id.</p>
  <p>Most playlists with &lt; 1000 followers were excluded. Completeness unknown.</p>
  <p>Row count: 6.6 million playlists with 1.7 billion playlist tracks.</p>
  <pre><code><span>/* /get-playlist/{id} - "Get a playlist owned by a Spotify user." */</span>
  <span>CREATE</span> <span>TABLE</span> <span>"playlists"</span> (
          <span>`rowid`</span> <span>integer</span> PRIMARY <span>KEY</span> <span>NOT</span> <span>NULL</span>,
          <span>/* the original spotify base62 ID */</span>
          <span>`id`</span> <span>text</span> <span>NOT</span> <span>NULL</span>,
          <span>/* the spotify snapshot ID that was fetched (we only store one copy of each playlist) - "The version identifier for the current playlist. Can be supplied in other requests to target a specific playlist version" */</span>
          <span>`snapshot_id`</span> <span>text</span> <span>NOT</span> <span>NULL</span>,
          <span>/* When the playlist was fetched (unixepoch ms). */</span>
          <span>`fetched_at`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>/* "The name of the playlist." */</span>
          <span>`name`</span> <span>text</span> <span>NOT</span> <span>NULL</span>,
          <span>/* "The playlist description. Only returned for modified, verified playlists, otherwise null. */</span>
          <span>`description`</span> <span>text</span>,
          <span>/* "true if the owner allows other users to modify the playlist." */</span>
          <span>`collaborative`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>-- "The playlist's public/private status (if it is added to the user's profile): true the playlist is public, false the playlist is private, null the playlist status is not relevant. For more about public/private status, see Working with Playlists"</span>
          <span>`public`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>`primary_color`</span> <span>text</span>,
          <span>/* owner.id - "The unique string identifying the Spotify user that you can find at the end of the Spotify URI for the user. The ID of the current user can be obtained via the Get Current User's Profile endpoint." */</span>
          <span>`owner_id`</span> <span>text</span>,
          <span>/* owner.display_name - "The name displayed on the user's profile. null if not available." */</span>
          <span>`owner_display_name`</span> <span>text</span>,
          <span>/* followers.total */</span>
          <span>`followers_total`</span> <span>integer</span>,
          <span>`tracks_total`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>
  );
  <span>CREATE</span> <span>UNIQUE</span> <span>INDEX</span> <span>`playlists_id_unique`</span> <span>ON</span> <span>`playlists`</span> (<span>`id`</span>);
  <span>CREATE</span> <span>INDEX</span> <span>`playlists_name`</span> <span>ON</span> <span>`playlists`</span> (<span>`name`</span>);
  <span>CREATE</span> <span>INDEX</span> <span>`playlists_owner_id`</span> <span>ON</span> <span>`playlists`</span> (<span>`owner_id`</span>);
  <span>CREATE</span> <span>INDEX</span> <span>`playlists_snapshot_id`</span> <span>ON</span> <span>`playlists`</span> (<span>`snapshot_id`</span>);
  <span>CREATE</span> <span>INDEX</span> <span>`playlists_followers`</span> <span>ON</span> <span>`playlists`</span> (<span>`followers_total`</span>);


  <span>/* "Images for the playlist. The array may be empty or contain up to three images. The images are returned by size in descending order. See Working with Playlists. Note: If returned, the source URL for the image (url) is temporary and will expire in less than a day." */</span>
  <span>CREATE</span> <span>TABLE</span> <span>`playlist_images`</span> (
          <span>`playlist_rowid`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>`width`</span> <span>integer</span>,
          <span>`height`</span> <span>integer</span>,
          <span>`url`</span> <span>text</span> <span>NOT</span> <span>NULL</span>,
          FOREIGN <span>KEY</span> (<span>`playlist_rowid`</span>) <span>REFERENCES</span> <span>`playlists`</span>(<span>`rowid`</span>)
  );
  <span>CREATE</span> <span>INDEX</span> <span>`playlist_images_playlist_id`</span> <span>ON</span> <span>`playlist_images`</span> (<span>`playlist_rowid`</span>);

  <span>/* The tracks of the playlist. Merged from all pages of getPlaylistItems. */</span>
  <span>CREATE</span> <span>TABLE</span> <span>"playlist_tracks"</span> (
          <span>`playlist_rowid`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>/* 0-based integer position within the playlists response (playlist.tracks.items[i]) */</span>
          <span>`position`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>/* true if track.type == "episode". false if track.type == "track" */</span>
          <span>`is_episode`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>/* The rowid of this track in the `tracks` table. */</span>
          <span>`track_rowid`</span> <span>integer</span>,
          <span>/* If the rowid is null, this is the spotify base62 ID instead. */</span>
          <span>`id_if_not_in_tracks_table`</span> <span>text</span>,
          <span>/* (unixepoch seconds) - "The date and time the track or episode was added. Note: some very old playlists may return null in this field." */</span>
          <span>`added_at`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>/* added_by.id - "The Spotify user who added the track or episode. Note: some very old playlists may return null in this field." */</span>
          <span>`added_by_id`</span> <span>text</span>,
          <span>/* undocumented */</span>
          <span>`primary_color`</span> <span>text</span>,
          <span>/* video_thumbnail.url - undocumented */</span>
          <span>`video_thumbnail_url`</span> <span>text</span>,
          <span>/* "Whether this track or episode is a local file or not." https://developer.spotify.com/documentation/web-api/concepts/playlists#local-files */</span>
          <span>`is_local`</span> <span>integer</span> <span>NOT</span> <span>NULL</span>,
          <span>/* track.name if is_local is true. For non-local tracks, name can be retrieved from the `tracks` table. */</span>
          <span>`name_if_is_local`</span> <span>text</span>,
          <span>/* track.uri if is_local is true */</span>
          <span>`uri_if_is_local`</span> <span>text</span>,
          <span>/* track.album if is_local is true. Spotify constructs a fake album object for local tracks. For non-local tracks, album can be retrieved from the `albums` table. */</span>
          <span>`album_name_if_is_local`</span> <span>text</span>,
          <span>/* track.artists[0].name if is_local is true. Spotify constructs a single fake artists object for local tracks. For non-local tracks, artist name can be retrieved from the `artists` table. */</span>
          <span>`artists_name_if_is_local`</span> <span>text</span>,
          <span>/* track.duration_ms if is_local is true. For non-local tracks, duration_ms can be retrieved from the `tracks` table. */</span>
          <span>`duration_ms_if_is_local`</span> <span>integer</span>,
          PRIMARY <span>KEY</span>(<span>`playlist_rowid`</span>, <span>`position`</span>),
          FOREIGN <span>KEY</span> (<span>`playlist_rowid`</span>) <span>REFERENCES</span> <span>`playlists`</span>(<span>`rowid`</span>)
  ) <span>WITHOUT</span> <span>ROWID</span>;</code></pre>

  <p>This is an almost lossless representation of the original Spotify API response. JSON reconstruction was tested during creation of all tables, with minor exceptions. For example, the original response JSON for playlists can be reconstructed with code similar to the following:</p>
  <details>
  <summary>Playlist Reconstruction Code (Example)</summary>

  <pre><code>
  function escapeURI(s) {
    return encodeURIComponent(s).replace(
      /[!()*]/g,
      (c) =&gt; "%" + c.charCodeAt(0).toString(16).toUpperCase().padStart(2, "0")
    );
  }
  function booleanToTrackType(is_episode) {
    return is_episode ? "episode" : "track";
  }

  function reconstructTrack(track, track_id) {
    let innerTrack = null;

    if (track.is_local) {
      innerTrack = {
        album: {
          album_type: null,
          available_markets: [],
          external_urls: {},
          href: null,
          id: null,
          images: [],
          name: track.album_name_if_is_local ?? "",
          release_date: null,
          release_date_precision: null,
          type: "album",
          uri: null,
          artists: [],
        },
        artists: [
          {
            external_urls: {},
            href: null,
            id: null,
            name: track.artists_name_if_is_local ?? "",
            type: "artist",
            uri: null,
          },
        ],
        available_markets: [],
        explicit: false,
        preview_url: null,
        type: "track",
        disc_number: 0,
        external_ids: {},
        external_urls: {},
        href: null,
        id: null,
        duration_ms: track.duration_ms_if_is_local,
        name: track.name_if_is_local,
        uri: track.uri_if_is_local,
        popularity: 0,
        track_number: 0,
        is_local: true,
        tags: null,
      };
    } else if (track_id) {
      innerTrack = {
        type: booleanToTrackType(track.is_episode),
        id: track_id,
      };
    } else if (track.id_if_not_in_tracks_table) {
      innerTrack = {
        type: booleanToTrackType(track.is_episode),
        id: track.id_if_not_in_tracks_table,
      };
    }
    return {
      added_at: new Date(track.added_at).toISOString().replace(".000Z", "Z"),
      added_by: {
        id: track.added_by_id,
        type: "user",
        uri: track.added_by_id
          ? `spotify:user:${escapeURI(track.added_by_id)}`
          : null,
        href: `https://api.spotify.com/v1/users/${track.added_by_id}`,
        external_urls: {
          spotify: `https://open.spotify.com/user/${track.added_by_id}`,
        },
      },
      is_local: track.is_local,
      primary_color: track.primary_color,
      video_thumbnail: {
        url: track.video_thumbnail_url,
      },
      track: innerTrack,
    };
  }
  function reconstructPlaylist({
    inserted_playlist,
    inserted_images,
    inserted_tracks,
  }) {
    return {
      id: inserted_playlist.id,
      snapshot_id: inserted_playlist.snapshot_id,
      name: inserted_playlist.name,
      description: inserted_playlist.description || "",
      collaborative: inserted_playlist.collaborative,
      public: inserted_playlist.public,
      primary_color: inserted_playlist.primary_color,
      owner: {
        id: inserted_playlist.owner_id,
        display_name: inserted_playlist.owner_display_name,
        type: "user",
        uri: inserted_playlist.owner_id
          ? `spotify:user:${escapeURI(inserted_playlist.owner_id)}`
          : null,
        href: `https://api.spotify.com/v1/users/${inserted_playlist.owner_id}`,
        external_urls: {
          spotify: `https://open.spotify.com/user/${inserted_playlist.owner_id}`,
        },
      },
      followers: {
        href: null,
        total: inserted_playlist.followers_total,
      },
      images:
        inserted_images.length &gt; 0
          ? inserted_images.map((img) =&gt; ({
              url: img.url,
              height: img.height,
              width: img.width,
            }))
          : null,
      tracks: {
        href: "unimportant",
        total: inserted_playlist.tracks_total,
        limit: 100,
        offset: 0,
        next: null,
        previous: null,
        items: inserted_tracks.map(reconstructTrack),
      },
      external_urls: {
        spotify: `https://open.spotify.com/playlist/${inserted_playlist.id}`,
      },
      href: `https://api.spotify.com/v1/playlists/${inserted_playlist.id}?additional_types=episode&amp;locale=*`,
      type: "playlist",
      uri: `spotify:playlist:${inserted_playlist.id}`,
    };
  }</code></pre>

  </details>

  <h3 id="-annas_archive_spotify_2025_07_metadata-torrent-spotify_clean_track_files-sqlite3-"><code>annas_archive_spotify_2025_07_metadata.torrent/spotify_clean_track_files.sqlite3</code></h3>
  <p>The link between the tracks table in <code>spotify_clean</code> and the actual files we have.</p>
  <p>Row count:</p>
  <pre><code><span>CREATE</span> <span>TABLE</span> <span>IF</span> <span>NOT</span> <span>EXISTS</span> <span>"track_files"</span> (
          <span>`rowid`</span> <span>integer</span> PRIMARY <span>KEY</span> <span>NOT</span> <span>NULL</span>,
          <span>/* spotify base62 id of the track */</span>
          <span>`track_id`</span> <span>text</span> <span>NOT</span> <span>NULL</span>,
          <span>/* the filename of this track within the Spotify Archive 2025 */</span>
          <span>`filename`</span> <span>text</span>,
          <span>/* The status of archiving this track. The nullability of most other fields depends on the status.
              - success: Track file present in archive
              - error_not_available: Track no longer available in any country (likely license expired).
              - error_has_replacement: Track not available, but replacement is. This means Spotify itself replaces transparently (without showing to the user) replace this track with a different track.
              - skipped_isrc_has_download: For tracks with low popularity, we only fetch one copy of a song per ISRC - the one with the highest popularity.
              - skipped_low_priority: Archiving was skipped because track_popularity = 0 and secondary_priority &lt; 0.351
              - todo_unk: Archiving status unknown
              - error_no_ogg160: Spotify reports no file in the highest quality is available
              - error_zero_duration: Spotify reports a duration of 0ms on the track file
          */</span>
          <span>`status`</span> <span>text</span> <span>NOT</span> <span>NULL</span>,
          <span>/* if this track has `popularity=0`, this shows the Ogg Opus kbit/s it was reencoded with. if null, the quality is original. */</span>
          <span>`reencoded_kbit_vbr`</span> <span>integer</span>,
          <span>/* When the item was fetched (unixepoch ms). */</span>
          <span>`fetched_at`</span> <span>integer</span>,
          <span>/* The country the track was fetched from */</span>
          <span>`session_country`</span> <span>text</span>,
          <span>/* The SHA256 of the original raw file - different track ids may be 100% identical */</span>
          <span>`sha256_original`</span> <span>text</span>,
          <span>/* The SHA256 of the actual file with metadata added */</span>
          <span>`sha256_with_embedded_meta`</span> <span>text</span>,
          <span>/* True if this ISRC has an archived file with higher popularity */</span>
          <span>`isrc_has_download`</span> <span>integer</span>,
          <span>/* The popularity of the track at the time of archiving */</span>
          <span>`track_popularity`</span> <span>integer</span>,
          <span>/* secondary archiving priority.
            = (max_artist.popularity from track.artists) / 100
              + album.popularity / 100
              + log10(min(100e6, max_artist.followers.total + 1)) / 8)
              - 10 * isrc_has_download.

            Max = 3. Negative for duplicates.
          */</span>
          <span>`secondary_priority`</span> <span>real</span>,
          <span>/* The actual raw bytes of the invalid Ogg packet stripped from the Ogg Vorbis file.
            Contains unknown data plus the replaygain information:
            offset 144
              + 0: float32le track_gain_db
              + 4: float32le track_peak
              + 8: float32le album_gain_db
              +12: float32le album_peak
          */</span>
          <span>`prefixed_ogg_packet`</span> <span>blob</span>,
          <span>/* JSON array of track ids of transparently-replaceable alternatives Spotify reports for this track. Likely similar to ISRC-equality. */</span>
          <span>`alternatives`</span> <span>text</span>,
          <span>/* The internal unique file ID of the various qualities available for this track. */</span>
          <span>`file_id_ogg_vorbis_96`</span> <span>text</span>,
          <span>/* The archive always contains the file for this quality (vorbis160) */</span>
          <span>`file_id_ogg_vorbis_160`</span> <span>text</span>,
          <span>`file_id_ogg_vorbis_320`</span> <span>text</span>,
          <span>`file_id_aac_24`</span> <span>text</span>,
          <span>`file_id_mp3_96`</span> <span>text</span>,
          <span>/* json array of language codes present in the song */</span>
          <span>`language_of_performance`</span> <span>text</span>,
          <span>/* json array of the role of each artist (e.g. main_artist, composer, featurd_artist) */</span>
          <span>`artist_roles`</span> <span>text</span>,
          <span>/* whether or not Spotify serves lyrics for this track */</span>
          <span>`has_lyrics`</span> <span>integer</span>,
          <span>/* internal id of the entity licensing this track */</span>
          <span>`licensor`</span> <span>text</span>,
          <span>/* The title without suffixes (e.g. feat. X) */</span>
          <span>`original_title`</span> <span>text</span>,
          <span>/* The name of this version of this track */</span>
          <span>`version_title`</span> <span>text</span>,
          <span>/* json array of country-specific content ratings, usually null */</span>
          <span>`content_ratings`</span> <span>text</span>
  );</code></pre>

  <h3 id="-annas_archive_spotify_2025_07_metadata-torrent-spotify_audiobooks-jsonl-zst-"><code>annas_archive_spotify_2025_07_metadata.torrent/spotify_audiobooks.jsonl.zst</code></h3>
  <p>Raw JSON API responses for audiobooks on Spotify. Contains around 700 thousand rows. Incomplete.</p>
  <h3 id="-annas_archive_spotify_2025_07_metadata-torrent-spotify_audiobook_chapters-jsonl-zst-"><code>annas_archive_spotify_2025_07_metadata.torrent/spotify_audiobook_chapters.jsonl.zst</code></h3>
  <p>Raw JSON API responses for audiobook chapters on Spotify. Contains around 20 million rows. Incomplete.</p>
  <h3 id="-annas_archive_spotify_2025_07_metadata-torrent-spotify_shows-jsonl-zst-"><code>annas_archive_spotify_2025_07_metadata.torrent/spotify_shows.jsonl.zst</code></h3>
  <p>Raw JSON API responses for shows (podcasts) on Spotify. Contains around 5 million rows. Incomplete.</p>
  <h3 id="-annas_archive_spotify_2025_07_metadata-torrent-spotify_show_episodes-jsonl-zst-"><code>annas_archive_spotify_2025_07_metadata.torrent/spotify_show_episodes.jsonl.zst</code></h3>
  <p>Raw JSON API responses for (podcast) episodes on Spotify. Contains around 54 million rows. Incomplete.</p>
  <h3 id="-annas_archive_spotify_2025_07_metadata-torrent-spotify_artist_redirects-json-"><code>annas_archive_spotify_2025_07_metadata.torrent/spotify_artist_redirects.json</code></h3>
  <p>Redirect responses for the artist endpoint.</p>
  <h3 id="-annas_archive_spotify_2025_07_audio_analysis-torrent-json-zst-"><code>annas_archive_spotify_2025_07_audio_analysis.torrent/##.json.zst</code></h3>
  <p>Raw JSON API responses for audio analysis on Spotify.
  Contains around 40 million rows, fetched in descending priority order. Many songs do not have an audio analysis (404). Incomplete.</p>
  <h3 id="-annas_archive_spotify_2025_07_coverart-tar-torrent-"><code>annas_archive_spotify_2025_07_coverart.tar.torrent</code></h3>
  <p>Album art files. Correspond to last part of <code>url</code> from <code>album_images</code>. Indexed into directories with filename prefixes (after stripping the first 16 chars from the filename).</p>

     </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[OpenSCAD Is Kinda Neat (128 pts)]]></title>
            <link>https://nuxx.net/blog/2025/12/20/openscad-is-kinda-neat/</link>
            <guid>46337984</guid>
            <pubDate>Sat, 20 Dec 2025 17:45:48 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://nuxx.net/blog/2025/12/20/openscad-is-kinda-neat/">https://nuxx.net/blog/2025/12/20/openscad-is-kinda-neat/</a>, See on <a href="https://news.ycombinator.com/item?id=46337984">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
								<div>
<figure><a href="https://nuxx.net/blog/wp-content/uploads/2025/12/Screenshot-2025-12-20-at-12.11.35-PM-scaled.png"><img fetchpriority="high" decoding="async" width="1024" height="502" src="https://nuxx.net/blog/wp-content/uploads/2025/12/Screenshot-2025-12-20-at-12.11.35-PM-1024x502.png" alt="" srcset="https://nuxx.net/blog/wp-content/uploads/2025/12/Screenshot-2025-12-20-at-12.11.35-PM-1024x502.png 1024w, https://nuxx.net/blog/wp-content/uploads/2025/12/Screenshot-2025-12-20-at-12.11.35-PM-300x147.png 300w, https://nuxx.net/blog/wp-content/uploads/2025/12/Screenshot-2025-12-20-at-12.11.35-PM-768x376.png 768w, https://nuxx.net/blog/wp-content/uploads/2025/12/Screenshot-2025-12-20-at-12.11.35-PM-1536x752.png 1536w, https://nuxx.net/blog/wp-content/uploads/2025/12/Screenshot-2025-12-20-at-12.11.35-PM-2048x1003.png 2048w" sizes="(max-width: 1024px) 100vw, 1024px"></a><figcaption>Designing a simple battery holder in OpenSCAD.</figcaption></figure>
</div>


<p>Earlier this year I designed a very basic box/organizer for <a href="https://en.wikipedia.org/wiki/AA_battery">AA</a> and <a href="https://en.wikipedia.org/wiki/AAA_battery">AAA</a> batteries in <a href="https://www.autodesk.com/products/fusion-360/">Autodesk Fusion</a>, making it parameterized so that by changing a few variables one could adjust the battery type/size, rows/columns, etc. This worked well, and after <a href="https://www.printables.com/model/1522509-simple-battery-holder-aa-and-aaa-w-parameterized-f">uploading it to Printables earlier today</a> I realized that reimplementing it would probably be a good way to learn the basics of <a href="https://openscad.org/">OpenSCAD</a>.</p>



<p>OpenSCAD is a rather different type of CAD tool, one in which you write code to generate objects. Because my battery holder is very simple (just a box with a pattern of cutouts) and uses input parameters, I figured it’d be a good intro to a new language / tool. And in the future might even be better than firing up Fusion for such simple designs.</p>



<p>After going through part of <a href="https://en.wikibooks.org/wiki/OpenSCAD_Tutorial">the tutorial</a> and an hour or so of poking, here’s the result: <a href="https://nuxx.net/files/3d_printing/battery_holder_generator.scad"><code>battery_holder_generator.scad</code></a></p>


<div>
<figure><a href="https://nuxx.net/blog/wp-content/uploads/2025/12/Screenshot-2025-12-20-at-12.30.03-PM-scaled.png"><img decoding="async" width="300" height="166" src="https://nuxx.net/blog/wp-content/uploads/2025/12/Screenshot-2025-12-20-at-12.30.03-PM-300x166.png" alt="" srcset="https://nuxx.net/blog/wp-content/uploads/2025/12/Screenshot-2025-12-20-at-12.30.03-PM-300x166.png 300w, https://nuxx.net/blog/wp-content/uploads/2025/12/Screenshot-2025-12-20-at-12.30.03-PM-1024x568.png 1024w, https://nuxx.net/blog/wp-content/uploads/2025/12/Screenshot-2025-12-20-at-12.30.03-PM-768x426.png 768w, https://nuxx.net/blog/wp-content/uploads/2025/12/Screenshot-2025-12-20-at-12.30.03-PM-1536x852.png 1536w, https://nuxx.net/blog/wp-content/uploads/2025/12/Screenshot-2025-12-20-at-12.30.03-PM-2048x1136.png 2048w" sizes="(max-width: 300px) 100vw, 300px"></a><figcaption>Slicer showing the Fusion model on top and OpenSCAD on bottom.</figcaption></figure>
</div>


<p>By changing just a few variables — <code>numRows</code> and <code>numColumns</code> and <code>batteryType</code> — one can render a customized battery holder which can then be plopped into a <a href="https://en.wikipedia.org/wiki/Slicer_(3D_printing)">slicer</a> and printed. No heavy/expensive CAD software needed and the output is effectively the same.</p>



<p>Without comments or informative output, this is the meat of the code:</p>



<pre><code>AA = 15;
AAA = 11;
heightCompartment = 19;
thicknessWall = 1;
numRows = 4;
numColumns = 10;
batteryType = AA;

widthBox = (numRows * batteryType) + ((numRows + 1) * thicknessWall);
lengthBox = (numColumns * batteryType) + ((numColumns + 1) * thicknessWall);
depthBox = heightCompartment + thicknessWall;

difference() {
    cube([lengthBox, widthBox, depthBox]);
    for (c = [ 1 : numColumns ])
        for (r = [ 1 : numRows ])
            let (
                startColumn = ((c * thicknessWall) + ((c - 1) * batteryType)),
                startRow = ((r * thicknessWall) + ((r - 1) * batteryType))
            )
            {
                translate([startColumn, startRow, thicknessWall])
                cube([batteryType, batteryType, heightCompartment + 1]);
            }
};</code></pre>



<p>Simply, it draws a box and cuts out the holes. (The first <code>cube()</code> draws the main box, then <code>difference()</code> subtracts the battery holes via the second <code>cube()</code> as their quantity and location (via <code>translate()</code>) is iterated.</p>



<p>That’s it. Pretty neat, eh?</p>



<p>(One part that confused me is how I needed to use <code><a href="https://en.wikibooks.org/wiki/OpenSCAD_User_Manual/List_Comprehensions#let">let()</a></code> to define <code>startColumn</code> and <code>startRow</code> inside the loop. I don’t understand this…)</p>



<p>While this probably won’t be very helpful for more complicated designs, I can see this being super useful for bearing drifts, spacers, and other similar simple (yet incredibly useful in real life) geometric shapes.</p>
											</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Pure Silicon Demo Coding: No CPU, No Memory, Just 4k Gates (213 pts)]]></title>
            <link>https://www.a1k0n.net/2025/12/19/tiny-tapeout-demo.html</link>
            <guid>46337438</guid>
            <pubDate>Sat, 20 Dec 2025 16:45:48 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.a1k0n.net/2025/12/19/tiny-tapeout-demo.html">https://www.a1k0n.net/2025/12/19/tiny-tapeout-demo.html</a>, See on <a href="https://news.ycombinator.com/item?id=46337438">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
        
        <p>Dec 19, 2025</p>
        <p>In addition to the <a href="https://www.a1k0n.net/2025/01/10/tiny-tapeout-donut.html">VGA
donut</a>, I submitted
two other entries in the <a href="https://tinytapeout.com/" target="_blank">Tiny Tapeout</a> 8 <a href="https://tinytapeout.com/competitions/demoscene-tt08-entries/" target="_blank">demo
competition</a>,
where you submit a "tiny" ASIC design (room for about 4000 logic gates)
that outputs 2-bit RGB to a VGA port and 1-bit audio to a speaker. One was a
an old school C64/Amiga intro type of thing, and <a href="#nyan-cat">the other</a> was a
nyan cat.</p>

<h2 id="tt08-intro">"TT08" intro</h2>

<p><video playsinline="" loop="" controls="" poster="https://www.a1k0n.net/img/tt08-vgademo.png"><source src="https://www.a1k0n.net/img/tt08-vgademo.mp4"> <i>video unavailable</i></video></p>
<p>Click to play -- video loops imperfectly but the hardware loop is seamless</p>

<p>The intro features a background starfield, a panning 3D checkerboard with
colorful tiles, and wavy scrolling text which casts a shadow onto the
checkerboard.  I was inspired by <a href="https://www.linusakesson.net/scene/craft/" target="_blank">lft's first AVR demo
Craft</a> to add a little cyan
oscilloscope to the side of the screen as well.</p>

<p>The size limit was two Tiny Tapeout "tiles" which is not a lot of space for
music, effects, and data; this is a very constrained platform for a demo: you
get no ROM, no RAM, and every bit of state is a flipflop which takes up a decent
chunk of space compared to combinational logic. Traditional "sizecoding" tricks
don't apply here -- data compression doesn't help you if you can't actually
store a ROM; you have no frame buffer so you must produce a pixel every clock
cycle. There's no CPU to exploit, just your own state machine.</p>

<h2 id="prototyping">Prototyping</h2>

<p>Like the VGA donut, this one used the weird custom video mode of 1220x480 and a
48MHz clock as it was easiest to prototype with given the <a href="https://orangecrab-fpga.github.io/orangecrab-hardware/" target="_blank">only FPGA hardware I
had on hand</a>, but in
retrospect I very much regret using this video mode. Most of the digital
captures of the demo look bad thanks to dithering and aliasing artifacts. It
does look great on a real CRT though!</p>

<p>The above video was made with a Verilator simulation, which compiles the Verilog
source down to C++ and allowed me to do cycle-by-cycle simulation of the design,
rendering to a SDL window / audio stream. This also allowed me to dump out
simulated frames to create the above video. I would later use this <a href="https://github.com/a1k0n/tt08-vgademo/blob/main/verilator/vgademo_tb.cpp" target="_blank">SDL VGA
verilator
testbench</a>
for the other projects.</p>

<p>The C++ simulation runs about half-realtime on my system, though, and most of
the time I synthesized it for the OrangeCrab's Lattice ECP5 FPGA strapped to an
ugly R-2R DAC (it's two bits per channel, so literally R and 2R, no ladder, for
RGB) hacked together on a perfboard.</p>

<p><img src="https://www.a1k0n.net/img/tt08-vgademo-fpgapcb.jpg" alt="prototype VGA FPGA board">
</p><p>orangecrab FPGA and my RGB222 VGA connector</p>

<p>Sound is output on a single pin through an RC filter; most people used PWM of
some kind, but I implemented sigma-delta conversion which is actually simpler
(with some tradeoffs; more <a href="#sigma-delta-dac">below</a>). The little solder blob on pin 13 of the
orangecrab is where I soldered an audio cable and plugged it into a portable
guitar amp for sound.</p>

<p>To get some more color fidelity out of RGB222, I used the same <a href="https://www.a1k0n.net/2025/01/10/tiny-tapeout-donut.html#tinytapeout-considerations">ordered
dithering code</a>
as in the donut.</p>

<h2 id="synthesizing-for-skywater-130nm">Synthesizing for Skywater 130nm</h2>

<p>Tiny Tapeout provides a basic workflow for taking your Verilog design and
"hardening it" -- laying out the GDS file (which is what goes to the fab) -- as
a GitHub action on commit, but there's also a <a href="https://tinytapeout.com/guides/local-hardening/" target="_blank">local
hardening</a> tool which was
absolutely necessary as I alternately added elements to the demo and optimized
it to fit. Either there would be too many cells to fit the area, or they would
fit but routing wires between them would fail (sometimes after an hour or
more!). Being able to dry run several experiments on my own PC was invaluable.</p>

<p><img src="https://www.a1k0n.net/img/tt08-vgademo-layout.png" alt="ASIC layout">
This design ended up using 3374 total cells (<a href="https://github.com/a1k0n/tt08-vgademo/actions/runs/20287352490" target="_blank">breakdown of cell use and 3D
viewer here</a>)
and filling just about every square nanometer. The sort of largish bluish areas
are mostly flip-flops, each representing a bit of state held by the circuit.
Flip-flops are relatively big, so minimizing state bits turned out to be
essential. I still ended up with 293 total flipflops.</p>



<p>The <a href="https://www.youtube.com/watch?v=tycS0vGcZIY" target="_blank">invitation intro</a> (which is
not a real ASIC demo, just a mockup!) that Matt Venn created for the competition
inspired me to do something in a similar vein, and for some reason, I was
fixated on using one of the fonts for my demo.  Encoding text in this font cost
a ton of gate area, and so everything else was highly constrained -- eventually
I had to give up encoding the color values in the font (but I kept the palette)
and go for a generic diagonal striped pattern.</p>

<p><img src="https://www.a1k0n.net/img/32X32-FI.png" alt="the font">
</p><p>the font used in the demo, from a <a href="https://github.com/ianhan/BitmapFonts/" target="_blank">large collection of ripped demo fonts</a></p>

<h3 id="encoding-data-in-an-asic">Encoding data in an ASIC</h3>

<p>You can think of a ROM as a circuit that has a huge truth table -- address
0000000 yields some value, 0000001 another value, etc. Usually this is laid out
in a big grid on a chip with some address decoders doing rows and colums and a
transistor for each bit encoding high or low values.</p>

<p>Sometimes these are encoded as Programmable Logic Arrays (PLAs) instead of a
fully laid out matrix of bits; one example of this is at the heart of the famous
Pentium FDIV bug which <a href="https://www.righto.com/2024/12/this-die-photo-of-pentium-shows.html" target="_blank">Ken Shirrif breaks down nicely
here</a>.</p>

<p>But you could also just encode the ROM as a bunch of logic gates specific to the
pattern of bits specified, e.g., maybe if address bit 7 is on, the result is
always 0. In fact part of what the synthesis pipeline<sup id="fnref:3"><a href="#fn:3">1</a></sup> does is to take an arbitrarily
large truth table and match it to the set of available logic cells (on an FPGA
this tends to be a bunch of 4-input lookup tables but Sky130 has all kinds of
assorted gates and combined logic
cells - <a href="https://skywater-pdk.readthedocs.io/en/main/contents/libraries/sky130_fd_sc_hd/cells/a2111o/README.html" target="_blank">random example</a>).
So I provided a <a href="https://github.com/a1k0n/tt08-vgademo/blob/main/data/charmask.hex" target="_blank">giant lookup
table</a> as a
hex file and the <a href="https://github.com/YosysHQ/yosys" target="_blank">yosys</a> synthesis pipeline
figured out a way to implement it with the standard cell library, effectively by
finding patterns in the data that match up with patterns in the addresses, and
then, instead of fitting them in a nice rectangle, sprayed those standard logic
cells all over my available die area in whatever shape made sense for the other
standard cells connected to them. This makes is very hard to predict how much
"data" will fit.</p>

<p>What this means for a limited gate area demo is that instead of minimizing the
size of data to store as lookup tables, it's better to limit the
<em>algorithmic complexity</em> of the data as a function of its address. Repeating the
same power-of-two-sized pattern is free; only variations need extra logic.
This is helpful to keep in mind when composing music, for example. So encoding
"TT08", if the width of a character cell is a power of two, means that second
copy of 'T' is basically free in terms of logic gates.</p>

<div>
<table>
<thead>
<tr>
<th>a1</th>
<th>a0</th>
<th>data</th>
</tr>
</thead>

<tbody>
<tr>
<td>0</td>
<td>0</td>
<td>'T'</td>
</tr>

<tr>
<td>0</td>
<td>1</td>
<td>'T'</td>
</tr>

<tr>
<td>1</td>
<td>0</td>
<td>'0'</td>
</tr>

<tr>
<td>1</td>
<td>1</td>
<td>'8'</td>
</tr>
</tbody>
</table>
<pre><span><span><span>a1</span> <span>=</span><span>=</span> <span>0</span> <span>-</span><span>&gt;</span> <span></span><span>'</span><span>T</span><span>'</span>
</span></span><span><span><span>a1</span> <span>=</span><span>=</span> <span>1</span> <span>&amp;</span><span>&amp;</span> <span>a0</span> <span>=</span><span>=</span> <span>0</span> <span>-</span><span>&gt;</span> <span></span><span>'</span><span>0</span><span>'</span>
</span></span><span><span><span>a1</span> <span>=</span><span>=</span> <span>1</span> <span>&amp;</span><span>&amp;</span> <span>a0</span> <span>=</span><span>=</span> <span>1</span> <span>-</span><span>&gt;</span> <span></span><span>'</span><span>8</span><span>'</span>
</span></span></pre></div>
<p>drastically simplified example</p>


<h3 id="sines-without-sine-tables">Sines without sine tables</h3>

<p>Usually in a sine scroller you'd expect to see a sine/cosine lookup table, but
given the above, it seems wise to avoid it if possible. Just like in <a href="https://www.a1k0n.net/2025/01/10/tiny-tapeout-donut.html">my donut
demo</a>, I instead rotate a vector on every
clock cycle. I don't need random access to the sine table, only <span data-katex="">\sin(x + o)</span>
for each <span data-katex="">x</span> coordinate on the screen which increments each cycle, with an
offset <span data-katex="">o</span> which increments each frame.</p>

<p>In fact I have a high-resolution sin/cos vector (<code>a_cos</code>, <code>a_sin</code>) that updates
slowly each frame, and a low-resolution one (<code>b_cos</code>, <code>b_sin</code>) initialized from
the high-resolution one at the start of each scanline that updates each clock
cycle.</p>

<p>Cutting bits out of the per-pixel sine generator was one of many hacks done late
in development to save on area (remember: flip-flops are pretty large so they
had to be trimmed aggressively), and there is visible jankiness in the sine
scroller as a result, if you watch closely.</p>

<p>This is the symplectic integrator which generates a perfect circle slightly
off-center in just a few simple shift/add operations, first described by
Minsky in HAKMEM 149.</p>

<div>
<pre><span><span><span>reg</span> <span>signed</span> <span>[</span><span>14</span><span>:</span><span>0</span><span>]</span> <span>a_cos</span><span>;</span>
</span></span><span><span><span>reg</span> <span>signed</span> <span>[</span><span>14</span><span>:</span><span>0</span><span>]</span> <span>a_sin</span><span>;</span>
</span></span><span><span><span>reg</span> <span>signed</span> <span>[</span><span>11</span><span>:</span><span>0</span><span>]</span> <span>b_cos</span><span>;</span>
</span></span><span><span><span>reg</span> <span>signed</span> <span>[</span><span>11</span><span>:</span><span>0</span><span>]</span> <span>b_sin</span><span>;</span>
</span></span><span><span>
</span></span><span><span><span>// on reset:
</span></span></span><span><span><span></span>  <span>a_cos</span> <span>&lt;</span><span>=</span> <span>15</span><span>'h2000</span><span>;</span>
</span></span><span><span>  <span>a_sin</span> <span>&lt;</span><span>=</span> <span>15</span><span>'h0000</span><span>;</span>
</span></span><span><span>
</span></span><span><span><span>// on new frame:
</span></span></span><span><span><span></span>  <span>wire</span> <span>signed</span> <span>[</span><span>14</span><span>:</span><span>0</span><span>]</span> <span>acos1</span> <span>=</span> <span>a_cos</span> <span>-</span> <span>(</span><span>a_sin</span> <span>&gt;</span><span>&gt;</span><span>&gt;</span> <span>6</span><span>)</span><span>;</span>
</span></span><span><span>  <span>wire</span> <span>signed</span> <span>[</span><span>14</span><span>:</span><span>0</span><span>]</span> <span>asin1</span> <span>=</span> <span>a_sin</span> <span>+</span> <span>(</span><span>acos1</span> <span>&gt;</span><span>&gt;</span><span>&gt;</span> <span>6</span><span>)</span><span>;</span>
</span></span><span><span>  <span>a_cos</span> <span>&lt;</span><span>=</span> <span>acos1</span><span>;</span>
</span></span><span><span>  <span>a_sin</span> <span>&lt;</span><span>=</span> <span>asin1</span><span>;</span>
</span></span><span><span>
</span></span><span><span><span>// on new line:
</span></span></span><span><span><span></span>  <span>b_cos</span> <span>&lt;</span><span>=</span> <span>a_cos</span> <span>&gt;</span><span>&gt;</span><span>&gt;</span> <span>3</span><span>;</span>
</span></span><span><span>  <span>b_sin</span> <span>&lt;</span><span>=</span> <span>a_sin</span> <span>&gt;</span><span>&gt;</span><span>&gt;</span> <span>3</span><span>;</span>
</span></span><span><span>
</span></span><span><span><span>// else on each clock:
</span></span></span><span><span><span></span>  <span>wire</span> <span>signed</span> <span>[</span><span>11</span><span>:</span><span>0</span><span>]</span> <span>bcos1</span> <span>=</span> <span>b_cos</span> <span>-</span> <span>(</span><span>b_sin</span> <span>&gt;</span><span>&gt;</span><span>&gt;</span> <span>7</span><span>)</span><span>;</span>
</span></span><span><span>  <span>wire</span> <span>signed</span> <span>[</span><span>11</span><span>:</span><span>0</span><span>]</span> <span>bsin1</span> <span>=</span> <span>b_sin</span> <span>+</span> <span>(</span><span>bcos1</span> <span>&gt;</span><span>&gt;</span><span>&gt;</span> <span>7</span><span>)</span><span>;</span>
</span></span><span><span>  <span>b_cos</span> <span>&lt;</span><span>=</span> <span>bcos1</span><span>;</span>
</span></span><span><span>  <span>b_sin</span> <span>&lt;</span><span>=</span> <span>bsin1</span><span>;</span>
</span></span></pre></div>
<p>Excerpt of Verilog code for generating the horizontal sine offset</p>


<h2 id="plane-checkerboard">Plane checkerboard</h2>

<p>To do the checkerboard, I do a perspective transform of the screen <span data-katex="">x,y</span>
coordinates onto the plane's coordinate system (which I will call <span data-katex="">u,v</span>). I use
the convention that the plane is parallel to the <span data-katex="">xz</span>-plane at a height of
<span data-katex="">y_p</span>.</p>

<p>I project a ray from the screen until it hits the plane, then recover the <span data-katex="">u,v</span>
coordinate hit. I actually want <span data-katex="">v</span> and <span data-katex="">\frac{du}{dx}</span> particularly, as they
are constants on each line when looking directly toward the <span data-katex="">z</span> axis.
<span data-katex="">\frac{du}{dx}</span> gives a fixed value to add to <span data-katex="">u</span> each clock cycle and I don't
need to do any complex math per pixel, and can just multiply that by half the
screen width to get <span data-katex="">u_0</span> at the left side of the screen.</p>

<p>A ray starts at the origin at <span data-katex="">t=0</span> and has 3D coordinates <span data-katex="">(xt,yt,t)</span>,
intersecting the plane when <span data-katex="">yt = y_p</span> for a plane height <span data-katex="">y_p</span>. Therefore
<span data-katex="">t=\frac{y_p}{y}</span>.</p>

<p>The <span data-katex="">(u,v)</span> coordinates of the plane are the <span data-katex="">x</span> and <span data-katex="">z</span> coordinates at the
intersection point, <span data-katex="">(u,v) = (xt, t) = (\frac{x y_p}{y}, \frac{y_p}{y})</span>.
Clearly, <span data-katex="">\frac{du}{dx}</span> is again just <span data-katex="">\frac{y_p}{y}</span>, so this expression is
the only thing that needs computing.</p>

<p>So I needed to pick an appropriate plane height scale <span data-katex="">y_p</span> that gives a field
of view that looks good and that I can easily divide by <span data-katex="">y</span> in hardware.
I also add an offset <span data-katex="">y_0</span> to <span data-katex="">y</span> to move the camera "down" a bit and also to
avoid dividing by 0 (and I don't render the plane when <span data-katex=""> y &lt; y_0 </span>).</p>

<p>Here's an early mockup in a Jupyter notebook I did working out the math for
this, trying to get sensible fixed point value ranges (i.e., number of bits I
needed to use in Verilog):</p>

<div>
<pre><span><span><span>def</span> <span>genboard2</span><span>(</span><span>w</span><span>,</span> <span>h</span><span>,</span> <span>y0</span><span>,</span> <span>k</span><span>)</span><span>:</span>
</span></span><span><span>    <span>M</span> <span>=</span> <span>(</span><span>1</span><span>&lt;&lt;</span><span>(</span><span>k</span><span>+</span><span>1</span><span>)</span><span>)</span><span>-</span><span>1</span>
</span></span><span><span>    <span>y</span> <span>=</span> <span>np</span><span>.</span><span>arange</span><span>(</span><span>h</span><span>)</span><span>+</span><span>y0</span>
</span></span><span><span>    <span>hw</span> <span>=</span> <span>w</span> <span>&lt;&lt;</span> <span>(</span><span>k</span><span>-</span><span>2</span><span>)</span>
</span></span><span><span>    <span>yx</span> <span>=</span> <span>np</span><span>.</span><span>mgrid</span><span>[</span><span>:</span><span>h</span><span>,</span><span>:</span><span>w</span><span>]</span>
</span></span><span><span>    <span>dx</span> <span>=</span> <span>(</span><span>1</span><span>&lt;&lt;</span><span>(</span><span>k</span><span>-</span><span>1</span><span>)</span><span>)</span><span>/</span><span>/</span><span>y</span>
</span></span><span><span>    <span>xl</span> <span>=</span> <span>(</span><span>-</span><span>dx</span><span>*</span><span>w</span><span>&gt;&gt;</span><span>1</span><span>)</span><span>&amp;</span><span>M</span>
</span></span><span><span>    <span>z</span> <span>=</span> <span>dx</span>
</span></span><span><span>    <span>print</span><span>(</span><span></span><span>'</span><span>k</span><span>'</span><span>,</span> <span>k</span><span>,</span> <span></span><span>'</span><span>M</span><span>'</span><span>,</span> <span>M</span><span>)</span>
</span></span><span><span>    <span>print</span><span>(</span><span></span><span>'</span><span>max dx</span><span>'</span><span>,</span> <span>dx</span><span>[</span><span>0</span><span>]</span><span>)</span>
</span></span><span><span>    <span>print</span><span>(</span><span></span><span>'</span><span>dx = z =</span><span>'</span><span>,</span> <span>(</span><span>1</span><span>&lt;&lt;</span><span>(</span><span>k</span><span>-</span><span>1</span><span>)</span><span>)</span><span>,</span> <span></span><span>'</span><span>/ y</span><span>'</span><span>)</span>
</span></span><span><span>    <span>print</span><span>(</span><span></span><span>'</span><span>x_left &lt;=</span><span>'</span><span>,</span> <span>M</span><span>+</span><span>1</span><span>,</span> <span></span><span>'</span><span>-</span><span>'</span><span>,</span> <span>w</span><span>/</span><span>/</span><span>2</span><span>,</span> <span></span><span>'</span><span>* dx &amp;</span><span>'</span><span>,</span> <span>M</span><span>)</span>
</span></span><span><span>    <span>px</span> <span>=</span> <span>(</span><span>yx</span><span>[</span><span>1</span><span>]</span><span>.</span><span>T</span><span>*</span><span>dx</span> <span>+</span> <span>xl</span><span>)</span><span>&gt;&gt;</span><span>10</span>
</span></span><span><span>    <span>img</span> <span>=</span> <span>px</span><span>.</span><span>T</span><span>.</span><span>astype</span><span>(</span><span>int</span><span>)</span> <span>^</span> <span>z</span><span>.</span><span>astype</span><span>(</span><span>int</span><span>)</span><span>[</span><span>:</span><span>,</span> <span>None</span><span>]</span>
</span></span><span><span>    <span>return</span> <span>img</span><span>&amp;</span><span>32</span>
</span></span><span><span>
</span></span><span><span><span>plt</span><span>.</span><span>figure</span><span>(</span><span>figsize</span><span>=</span><span>(</span><span>12</span><span>,</span><span>3</span><span>)</span><span>)</span>
</span></span><span><span><span>plt</span><span>.</span><span>imshow</span><span>(</span><span>genboard2</span><span>(</span><span>1220</span><span>,</span> <span>480</span><span>,</span> <span>128</span><span>,</span> <span>17</span><span>)</span><span>)</span>
</span></span></pre><pre><code>k 17 M 262143
max dx 512
dx = z = 65536 / y
x_left &lt;= 262144 - 610 * dx &amp; 262143
</code></pre>

<p><img src="https://www.a1k0n.net/img/tt08-vgademo-checkermockup.png" alt="jupyter notebook checkerboard"></p>
</div>


<p>This means we will either need to create a lookup table for each scanline, or
actually implement a division algorithm; I tried both, and implementing
<a href="https://en.wikipedia.org/wiki/Division_algorithm#Non-restoring_division" target="_blank">non-restoring
division</a>
is smaller.</p>

<p>Sixteen clocks before the end of each scanline, <a href="https://github.com/a1k0n/tt08-vgademo/blob/main/src/recip16.v" target="_blank">the recip16
module</a> gets a
<code>start</code> signal and begins dividing 65536 by the screen <span data-katex="">y</span> coordinate. This
yields a fixed point number we can use to scale the <span data-katex="">u</span> coordinate, and it also
gives the <span data-katex="">v</span> coordinate.</p>

<div>
<pre><span><span><span>reg</span> <span>[</span><span>21</span><span>:</span><span>0</span><span>]</span> <span>plane_u</span><span>;</span>
</span></span><span><span><span>reg</span> <span>[</span><span>10</span><span>:</span><span>0</span><span>]</span> <span>plane_du</span><span>;</span> <span>// latched current du/dx
</span></span></span><span><span><span></span><span>// simplification: the vertical component happens to be
</span></span></span><span><span><span></span><span>// equal to the horizontal step size
</span></span></span><span><span><span></span><span>wire</span> <span>[</span><span>10</span><span>:</span><span>0</span><span>]</span> <span>plane_v</span> <span>=</span> <span>plane_du</span><span>;</span>
</span></span><span><span><span>wire</span> <span>[</span><span>10</span><span>:</span><span>0</span><span>]</span> <span>plane_du_</span><span>;</span>  <span>// output of the divider, next du/dx to load
</span></span></span><span><span><span></span>
</span></span><span><span><span>// we can compute this at the end of the previous line during horizontal blank;
</span></span></span><span><span><span></span><span>// we'll latch the output value into plane_du at the start of the line.
</span></span></span><span><span><span></span><span>recip16</span> <span>plane_dx_div</span> <span>(</span>
</span></span><span><span>    <span>.</span><span>clk</span><span>(</span><span>clk48</span><span>)</span><span>,</span>
</span></span><span><span>    <span>.</span><span>start</span><span>(</span><span>h_count</span> <span>=</span><span>=</span> <span>H_DISPLAY</span> <span>-</span> <span>16</span><span>)</span><span>,</span>
</span></span><span><span>    <span>.</span><span>denom</span><span>(</span><span>plane_y</span><span>+</span><span>1</span><span>)</span><span>,</span>
</span></span><span><span>    <span>.</span><span>recip</span><span>(</span><span>plane_du_</span><span>)</span>
</span></span><span><span><span>)</span><span>;</span>
</span></span><span><span>
</span></span><span><span><span>// when x = 0:
</span></span></span><span><span><span></span>  <span>// to get plane_u at the left side of the screen, multiply plane_du_ by
</span></span></span><span><span><span></span>  <span>// -displaywidth/2, implemented here with shifts and adds
</span></span></span><span><span><span></span>  <span>plane_u</span> <span>&lt;</span><span>=</span> <span>-</span><span>(</span><span>(</span><span>plane_du_</span><span>&lt;</span><span>&lt;</span><span>1</span><span>)</span> <span>+</span> <span>(</span><span>plane_du_</span><span>&lt;</span><span>&lt;</span><span>5</span><span>)</span> <span>+</span> <span>(</span><span>plane_du_</span><span>&lt;</span><span>&lt;</span><span>6</span><span>)</span> <span>+</span> <span>(</span><span>plane_du_</span><span>&lt;</span><span>&lt;</span><span>9</span><span>)</span><span>)</span><span>;</span>
</span></span><span><span>  <span>plane_du</span> <span>&lt;</span><span>=</span> <span>plane_du_</span><span>;</span>
</span></span><span><span>
</span></span><span><span><span>// else:
</span></span></span><span><span><span></span>  <span>plane_u</span> <span>&lt;</span><span>=</span> <span>plane_u</span> <span>+</span> <span>plane_du</span><span>;</span>
</span></span></pre></div>
<p>Verilog code generating the u,v coordinates of the checkerboard plane</p>


<p>The checkerboard is created by picking out bits of this <span data-katex="">(u,v)</span> coordinate frame
and XORing them, and the RGB color is some mix of those bits too.</p>

<div>
<pre><span><span><span>// a_scrollx and y define the plane's checkerboard movement offset
</span></span></span><span><span><span></span><span>wire</span> <span>signed</span> <span>[</span><span>15</span><span>:</span><span>0</span><span>]</span> <span>a_scrollx</span> <span>=</span> <span>a_cos</span><span>&gt;</span><span>&gt;</span><span>&gt;</span><span>4</span><span>;</span> <span>// re-using the per-frame cosine defined above
</span></span></span><span><span><span></span><span>wire</span> <span>signed</span> <span>[</span><span>15</span><span>:</span><span>0</span><span>]</span> <span>a_scrolly</span> <span>=</span> <span>frame</span> <span>&lt;</span><span>&lt;</span> <span>3</span><span>;</span>
</span></span><span><span>
</span></span><span><span><span>wire</span> <span>[</span><span>11</span><span>:</span><span>0</span><span>]</span> <span>hscroll</span> <span>=</span> <span>plane_u</span><span>[</span><span>20</span><span>:</span><span>9</span><span>]</span> <span>+</span> <span>a_scrollx</span><span>[</span><span>11</span><span>:</span><span>0</span><span>]</span><span>;</span>
</span></span><span><span><span>wire</span> <span>[</span><span>10</span><span>:</span><span>0</span><span>]</span> <span>vscroll</span> <span>=</span> <span>plane_v</span><span>[</span><span>10</span><span>:</span><span>1</span><span>]</span> <span>+</span> <span>a_scrolly</span><span>[</span><span>10</span><span>:</span><span>0</span><span>]</span><span>;</span>
</span></span><span><span><span>wire</span> <span>checkerboard</span> <span>=</span> <span>hscroll</span><span>[</span><span>7</span><span>]</span> <span>^</span> <span>vscroll</span><span>[</span><span>6</span><span>]</span><span>;</span>
</span></span><span><span>
</span></span><span><span><span>wire</span> <span>[</span><span>5</span><span>:</span><span>0</span><span>]</span> <span>checker_raw_r</span> <span>=</span> <span>checkerboard</span> <span>?</span> <span>hscroll</span><span>[</span><span>8</span><span>:</span><span>3</span><span>]</span> <span>:</span> <span>0</span><span>;</span>
</span></span><span><span><span>wire</span> <span>[</span><span>5</span><span>:</span><span>0</span><span>]</span> <span>checker_raw_g</span> <span>=</span> <span>checkerboard</span> <span>?</span> <span>vscroll</span><span>[</span><span>8</span><span>:</span><span>3</span><span>]</span> <span>:</span> <span>0</span><span>;</span>
</span></span><span><span><span>wire</span> <span>[</span><span>5</span><span>:</span><span>0</span><span>]</span> <span>checker_raw_b</span> <span>=</span> <span>checkerboard</span> <span>?</span> <span>vscroll</span><span>[</span><span>7</span><span>:</span><span>2</span><span>]</span> <span>:</span> <span>0</span><span>;</span>
</span></span></pre></div>
<p>6-bit RGB rainbow checkerboard generator</p>


<p>It's subtle, but the kick drum in the song adds to the plane <span data-katex="">y_0</span> offset, so
you can see it "jumping" on every drum hit. And at certain points in the song,
random checkers start lighting up, before finally turning white in diagonal
stripes to the beat, panning the <code>plane_y</code> starting coordinate all the way to
the top of the screen, turning the entire screen white before fading to black
and looping.</p>

<h3 id="shadows">Shadows</h3>

<p>When drawing the plane, it also renders the scroll text<sup id="fnref:1"><a href="#fn:1">2</a></sup>, except using the
projected <span data-katex="">(u,v)</span> coordinates instead of the screen <span data-katex="">(x,y)</span> so that the shadow
of the text is projected onto the plane. However, as I mentioned above, the sine
wave is generated by rotating vectors each pixel and so there isn't random
access to <span data-katex="">\sin(u)</span> -- so instead of using the correct scroll height from the projected <span data-katex="">u</span>,
it uses whatever sine is currently available. This shortcut means the shadow
isn't really accurate, but it's good enough.</p>

<div>
<pre><span><span><span>wire</span> <span>shadow_active</span> <span>=</span> <span>char_active</span> <span>&amp;</span><span>&amp;</span> <span>(</span><span>plane_v</span> <span>is</span> <span>within</span> <span>scrolltext</span> <span>height</span><span>.</span><span>.</span><span>.</span><span>)</span><span>;</span>
</span></span><span><span>
</span></span><span><span><span>wire</span> <span>[</span><span>5</span><span>:</span><span>0</span><span>]</span> <span>checker_r</span> <span>=</span> <span>shadow_active</span> <span>?</span> <span>{</span><span>2</span><span>'b0</span><span>,</span> <span>checker_raw_r</span><span>[</span><span>5</span><span>:</span><span>2</span><span>]</span><span>}</span> <span>:</span> <span>checker_raw_r</span><span>;</span>
</span></span><span><span><span>wire</span> <span>[</span><span>5</span><span>:</span><span>0</span><span>]</span> <span>checker_g</span> <span>=</span> <span>shadow_active</span> <span>?</span> <span>{</span><span>2</span><span>'b0</span><span>,</span> <span>checker_raw_g</span><span>[</span><span>5</span><span>:</span><span>2</span><span>]</span><span>}</span> <span>:</span> <span>checker_raw_g</span><span>;</span>
</span></span><span><span><span>wire</span> <span>[</span><span>5</span><span>:</span><span>0</span><span>]</span> <span>checker_b</span> <span>=</span> <span>shadow_active</span> <span>?</span> <span>{</span><span>2</span><span>'b0</span><span>,</span> <span>checker_raw_b</span><span>[</span><span>5</span><span>:</span><span>2</span><span>]</span><span>}</span> <span>:</span> <span>checker_raw_b</span><span>;</span>
</span></span></pre></div>
<p>The shadow mask just shifts the checker color right two bits</p>


<h2 id="starfield">Starfield</h2>

<p>To do the horizontal scrolling starfield, I essentially needed a constant random
number sequence per scanline, so naturally I used an
<a href="https://en.wikipedia.org/wiki/Linear-feedback_shift_register" target="_blank">LFSR</a> that resets
at the top of the screen and updates at the start of each row; then bits of the
LFSR state are used to specify a star's horizontal offset and speed, and then
the global frame counter is added on, multiplied by speed. The stars also have
longer streaks in time with the snare drum in the music track.</p>
<pre><span><span><span>reg</span> <span>[</span><span>12</span><span>:</span><span>0</span><span>]</span> <span>linelfsr</span><span>;</span>
</span></span><span><span>
</span></span><span><span><span>// on new frame:
</span></span></span><span><span><span></span>  <span>linelfsr</span> <span>&lt;</span><span>=</span> <span>13</span><span>'h1AFA</span><span>;</span>
</span></span><span><span>
</span></span><span><span><span>// on new scanline:
</span></span></span><span><span><span></span>  <span>linelfsr</span> <span>&lt;</span><span>=</span> <span>linelfsr</span><span>[</span><span>0</span><span>]</span> <span>?</span> <span>(</span><span>linelfsr</span><span>&gt;</span><span>&gt;</span><span>1</span><span>)</span> <span>^</span> <span>13</span><span>'h1159</span> <span>:</span> <span>linelfsr</span><span>&gt;</span><span>&gt;</span><span>1</span><span>;</span>
</span></span><span><span>
</span></span><span><span><span>// define the x offset of the star on this scanline
</span></span></span><span><span><span></span><span>// bits [12:2] of the LFSR state are the random x offset
</span></span></span><span><span><span></span><span>// bits 1 and 0 boost the movement speed by 2x and 4x
</span></span></span><span><span><span></span><span>wire</span> <span>[</span><span>10</span><span>:</span><span>0</span><span>]</span> <span>starfield_x</span> <span>=</span> <span>linelfsr</span><span>[</span><span>12</span><span>:</span><span>2</span><span>]</span> <span>+</span> <span>(</span><span>frame</span><span>&lt;</span><span>&lt;</span><span>1</span><span>)</span> <span>+</span> <span>(</span><span>linelfsr</span><span>[</span><span>1</span><span>]</span> <span>?</span> <span>frame</span><span>&lt;</span><span>&lt;</span><span>2</span> <span>:</span> <span>0</span><span>)</span> <span>+</span> <span>(</span><span>linelfsr</span><span>[</span><span>0</span><span>]</span> <span>?</span> <span>frame</span><span>&lt;</span><span>&lt;</span><span>3</span> <span>:</span> <span>0</span><span>)</span><span>;</span>
</span></span><span><span><span>// define whether the current pixel (h_count) is actually a star, lengthened by the snare drum timer
</span></span></span><span><span><span></span><span>wire</span> <span>star_pixel</span> <span>=</span> <span>h_count</span> <span>&gt;</span><span>=</span> <span>starfield_x</span> <span>&amp;</span><span>&amp;</span> <span>h_count</span> <span>&lt;</span> <span>starfield_x</span> <span>+</span> <span>2</span> <span>+</span> <span>(</span><span>7</span><span>^</span><span>(</span><span>audio_snare_frames</span><span>[</span><span>3</span><span>:</span><span>1</span><span>]</span><span>)</span><span>)</span><span>;</span>
</span></span><span><span><span>// stars natually loop off the right side of the screen and re-emerge on the
</span></span></span><span><span><span></span><span>// left side as the starfield_x value overflows
</span></span></span></pre>
<h2 id="music">Music</h2>

<p>Keeping in mind the constraints on how data is stored, and using some simple
music composition ideas, I decided to structure each section of music in an
"ABAC" pattern (or ABACABAD). This works well with our logic gate based
encoding: The reduced logic will have something like "if measure bit 0 is 0,
then use pattern A". And B is just a variation of A, so it can find a lot of
redundancies, etc.</p>

<h3 id="synthesizer">Synthesizer</h3>

<p>I also needed some very simple-to-code instruments; a square wave arpeggio was a
given for this genre of intro, but for percussion I wanted to generate a nice
sounding kick drum and I settled on using a triangle wave synthesizer with an
exponentially decaying frequency. Then I could multiplex a smooth bassline with
the kick drum -- after the kick drum decays, just set the frequency back to the
current bassline. For a hihat/snare, add some LFSR noise modulated by an
exponential envelope for a hihat/snare kind of sound.</p>

<p>All the instruments were initially mocked up in a Jupyter notebook, as I tried
to find efficient ways to generate triangle-based kick drums, etc.</p>

<div>
<pre><span><span><span>def</span> <span>tri</span><span>(</span><span>x</span><span>)</span><span>:</span>
</span></span><span><span>    <span>return</span> <span>(</span><span>(</span><span>x</span><span>&amp;</span><span>65535</span><span>)</span> <span>^</span> <span>(</span><span>x</span><span>&amp;</span><span>32768</span> <span>and</span> <span>-</span><span>1</span> <span>or</span> <span>0</span><span>)</span> <span>&amp;</span> <span>65535</span><span>)</span> <span>-</span> <span>16384</span>
</span></span><span><span>
</span></span><span><span><span>def</span> <span>kick</span><span>(</span><span>n</span><span>)</span><span>:</span>
</span></span><span><span>    <span>osci</span> <span>=</span> <span>0x3fff</span> <span># 512*32 - 1</span>
</span></span><span><span>    <span>oscp</span> <span>=</span> <span>0x1235</span>
</span></span><span><span>    <span>out</span> <span>=</span> <span>np</span><span>.</span><span>zeros</span><span>(</span><span>n</span><span>,</span> <span>np</span><span>.</span><span>int16</span><span>)</span>
</span></span><span><span>    <span>y1</span> <span>=</span> <span>0</span>
</span></span><span><span>    <span>for</span> <span>i</span> <span>in</span> <span>range</span><span>(</span><span>n</span><span>)</span><span>:</span>
</span></span><span><span>        <span>out</span><span>[</span><span>i</span><span>]</span> <span>=</span> <span>tri</span><span>(</span><span>oscp</span><span>&gt;&gt;</span><span>5</span><span>)</span>
</span></span><span><span>        <span>oscp</span> <span>=</span> <span>(</span><span>oscp</span> <span>+</span> <span>osci</span><span>)</span><span>&amp;</span><span>(</span><span>(</span><span>1</span><span>&lt;&lt;</span><span>21</span><span>)</span><span>-</span><span>1</span><span>)</span>
</span></span><span><span>        <span>osci</span> <span>=</span> <span>(</span><span>osci</span> <span>-</span> <span>(</span><span>(</span><span>osci</span><span>+</span><span>2047</span><span>)</span><span>&gt;&gt;</span><span>11</span><span>)</span><span>)</span><span>&amp;</span><span>(</span><span>(</span><span>1</span><span>&lt;&lt;</span><span>14</span><span>)</span><span>-</span><span>1</span><span>)</span>
</span></span><span><span>
</span></span><span><span>    <span>return</span> <span>out</span>
</span></span><span><span>
</span></span><span><span><span>plt</span><span>.</span><span>figure</span><span>(</span><span>figsize</span><span>=</span><span>(</span><span>12</span><span>,</span><span>4</span><span>)</span><span>)</span>
</span></span><span><span><span>k</span> <span>=</span> <span>kick</span><span>(</span><span>4410</span><span>*</span><span>2</span><span>)</span>
</span></span><span><span><span>plt</span><span>.</span><span>plot</span><span>(</span><span>k</span><span>)</span>
</span></span><span><span><span>IPython</span><span>.</span><span>display</span><span>.</span><span>display</span><span>(</span><span>IPython</span><span>.</span><span>display</span><span>.</span><span>Audio</span><span>(</span><span>k</span><span>.</span><span>astype</span><span>(</span><span>np</span><span>.</span><span>float32</span><span>)</span><span>/</span><span>127.0</span><span>,</span> <span>rate</span><span>=</span><span>48000</span><span>)</span><span>)</span>
</span></span></pre><p><audio controls="controls">
  <source src="https://www.a1k0n.net/img/tt08-vgademo-kickdrum.wav" type="audio/wav">
  (audio playback widget)
</audio>
<img src="https://www.a1k0n.net/img/tt08-vgademo-kickdrum.png" alt="kickdrum plot"></p>
</div>


<p>There are three total channels:</p>

<ul>
<li>noise w/ exponential envelope (snare)</li>
<li>square wave with two-note arpeggio, exponential envelope (chords/melody).</li>
<li>constant-volume triangle w/ exponential pitch decay (kick)</li>
</ul>

<p>Exponential envelopes are simply implemented as right-shift counters, where
volume 0 is full volume and every few ticks that counter increments, and then
the final sample is right shifted by the volume.</p>

<p>As much as possible, I avoided storing state in registers (flipflops are
expensive, see above), and tried to make the music driven by a combinatorial
logic chain from a simple song position counter. So there is no register for the
pulse frequency increment; that's purely derived from the song position. The
triangle synth does need one, though, in order to implement the kick
exponential.</p>

<p>This led to a lot of off-by-one errors developing the code, as triggers are
defined for updating envelopes for the next song position, but the notes for the
pulse channel are already set for the current position, etc. Eventually I sorted
them all out though it does make the code quite confusing to read, as various
counter values differ from the Python version and yet it sounds the same.</p>

<p>A simple trick I found: For the pulse synth, we can also just pick different
bits out of the per-sample accmulator to raise the pitch by octaves. I decided
to constrain it to a two-octave range.</p>
<pre><span><span><span>// note this is signed, so it generates a (+0x4000 or -0x4000) &gt;&gt;&gt; volume
</span></span></span><span><span><span></span><span>wire</span> <span>signed</span> <span>[</span><span>15</span><span>:</span><span>0</span><span>]</span> <span>pulse_output</span> <span>=</span> <span>{</span><span>pulse_octave</span> <span>?</span> <span>pulse_osc_p</span><span>[</span><span>12</span><span>]</span> <span>:</span> <span>pulse_osc_p</span><span>[</span><span>13</span><span>]</span><span>,</span> <span>1</span><span>'h1</span><span>,</span> <span>14</span><span>'h0</span><span>}</span> <span>&gt;</span><span>&gt;</span><span>&gt;</span> <span>(</span><span>2</span><span>+</span><span>pulse_vol</span><span>)</span><span>;</span>
</span></span></pre>
<h3 id="sigma-delta-dac">Sigma-delta DAC</h3>

<p>Instead of PWM, I did the simplest sigma-delta scheme I could think of:</p>
<pre><span><span><span>reg</span> <span>[</span><span>15</span><span>:</span><span>0</span><span>]</span> <span>sigma_delta_accum</span><span>;</span>
</span></span><span><span><span>wire</span> <span>[</span><span>15</span><span>:</span><span>0</span><span>]</span> <span>audio_sample</span><span>;</span> <span>// assigned by synth
</span></span></span><span><span><span></span><span>wire</span> <span>[</span><span>16</span><span>:</span><span>0</span><span>]</span> <span>sigma_delta_accum_</span> <span>=</span> <span>sigma_delta_accum</span> <span>+</span> <span>audio_sample</span><span>;</span>
</span></span><span><span><span>reg</span> <span>audio_out</span><span>;</span> <span>// actual output pin
</span></span></span><span><span><span></span>
</span></span><span><span><span>always</span> <span>@</span><span>(</span><span>posedge</span> <span>clk48</span><span>)</span> <span>begin</span>
</span></span><span><span>  <span>sigma_delta_accum</span> <span>&lt;</span><span>=</span> <span>sigma_delta_accum_</span><span>[</span><span>15</span><span>:</span><span>0</span><span>]</span><span>;</span>
</span></span><span><span>  <span>audio_out</span> <span>&lt;</span><span>=</span> <span>sigma_delta_accum_</span><span>[</span><span>16</span><span>]</span><span>;</span>
</span></span><span><span><span>end</span>
</span></span></pre>
<p>We add the (unsigned) audio sample to the accumulator every clock, and the pin
gets the carry. So if the audio sample is at 50% (0x8000), then we get a full
clock rate square wave, and if the output sample is 0x0001, we get a constant 0
with a single 1 pulse every 65536 clock cycles and conversely for 0xfffe, we get
a constant 1 with a single 0 pulse every 65536 cycles. In general it creates a
dense pulse train with no specific period.</p>

<p>The problem with this is that the rising edges and falling edges happen at
different speeds on the Tiny Tapeout chip, which introduces a bit of harmonic
distortion.  I wasn't too worried about harmonic distortion in my
triangle/pulse/noise synth.</p>

<h3 id="composition">Composition</h3>

<p>I took a lot of inspiration from a C64 SID tune called Crooner by Drax/Vibrants,
that then later was adapted for AdLib and I had <a href="https://www.a1k0n.net/code/opl2/">made an AdLib OPL2 emulator for it</a>.
I decided to keep my tune very simple though, so there's no real melody, just
the same chord progression as Crooner in a repeating four bar pattern:</p>

<pre><code>| Am      | C       | D       | F   G   |
</code></pre>

<p>The D major isn't really in the Am/C scale (more of a secondary dominant) but
this meant there were a total of eight unique notes in the scale instead of the
usual seven: <code>C D E F F# G A B</code>, giving me a power of two-sized table of base
frequencies. This meant I could have a 3-bit wide table for notes, plus another
bit for octave, so each instrument has a total of 16 possible notes to play.</p>

<p>Using a two-note arpeggio is a departure from conventional three-note arpeggios
in most tracked music, but counting to 2 by slicing off a bit from the song tick
counter is easier than counting to 3 which would require an extra counter;
besides, the bass can play the root note of the chord and the melody can play
the thirds and fifths.</p>

<p>I also swung the tempo pretty strongly, swapping between 15 and 25 ticks per
beat which really improved the feel.</p>

<p>And then I literally wrote the song as a bunch of strings in Python, just typing
out the scale notes and using the # symbol for F#:</p>
<pre><span><span><span>snareA</span> <span>=</span> <span></span><span>'</span><span>..x..xx...x..xx.</span><span>'</span>
</span></span><span><span><span>kickA</span>  <span>=</span> <span></span><span>'</span><span>x...x...x...x...</span><span>'</span>
</span></span><span><span>
</span></span><span><span><span>snareB</span> <span>=</span> <span></span><span>'</span><span>..x...x..xx...x.</span><span>'</span>
</span></span><span><span><span>kickB</span>  <span>=</span> <span></span><span>'</span><span>x...x..x.x..x...</span><span>'</span>
</span></span><span><span>
</span></span><span><span><span>snareC</span> <span>=</span> <span></span><span>'</span><span>..x...x...x..xxx</span><span>'</span>
</span></span><span><span><span>kickC</span>  <span>=</span> <span></span><span>'</span><span>x...x..xx...x...</span><span>'</span>
</span></span><span><span>
</span></span><span><span><span>snareD</span> <span>=</span> <span></span><span>'</span><span>..x..xx...x...xx</span><span>'</span>
</span></span><span><span><span>kickD</span>  <span>=</span> <span></span><span>'</span><span>................</span><span>'</span>
</span></span><span><span>
</span></span><span><span><span># concatenate ABACABAD pattern</span>
</span></span><span><span><span>snare</span> <span>=</span> <span>snareA</span> <span>+</span> <span>snareB</span> <span>+</span> <span>snareA</span> <span>+</span> <span>snareC</span> <span>+</span> <span>snareA</span> <span>+</span> <span>snareB</span> <span>+</span> <span>snareA</span> <span>+</span> <span>snareD</span>
</span></span><span><span><span>kick</span> <span>=</span> <span>kickA</span> <span>+</span> <span>kickB</span> <span>+</span> <span>kickA</span> <span>+</span> <span>kickC</span> <span>+</span> <span>kickA</span> <span>+</span> <span>kickB</span> <span>+</span> <span>kickA</span> <span>+</span> <span>kickD</span>
</span></span><span><span>
</span></span><span><span><span># bassline which repeats throughout entire song</span>
</span></span><span><span><span>#                   1+2+3+4+1+2+3+4+1+2+3+4+1+2+3+4+</span>
</span></span><span><span><span>bass_chart_notes</span> <span>=</span> <span></span><span>'</span><span>AEAAAEAACCGCECCCDDD#D#DDFCFFGDGG</span><span>'</span>
</span></span><span><span><span>bass_chart_octs</span>  <span>=</span> <span></span><span>'</span><span>01100000000110100011010101100110</span><span>'</span>
</span></span><span><span>
</span></span><span><span><span># pulse aka square wave</span>
</span></span><span><span><span># the note and 'arp' note alternate in a rapid arpeggio; oct defines the octave</span>
</span></span><span><span><span># the envelopes are triggered by a non-blank entry in the note string</span>
</span></span><span><span><span># A section, basic</span>
</span></span><span><span><span>pulsAnot</span> <span>=</span> <span></span><span>'</span><span>A...A.....A...A.G...G.....G...G.#...#.....#...#.F...F...G...G...</span><span>'</span>
</span></span><span><span><span>pulsAoct</span> <span>=</span> <span></span><span>'</span><span>0000000000000000000000000000000000000000000000000000000000000000</span><span>'</span>
</span></span><span><span><span>pulsAarp</span> <span>=</span> <span></span><span>'</span><span>EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEAAAAAAAAAAAAAAAAAAAAAAAABBBBBBBB</span><span>'</span>
</span></span><span><span>
</span></span><span><span><span># B section, slight embellishments</span>
</span></span><span><span><span>pulsBnot</span> <span>=</span> <span></span><span>'</span><span>C...C.....A...C.G...C....CG...GG##..#.....#...#FFF..FF.FGG..GG..</span><span>'</span>
</span></span><span><span><span>pulsBoct</span> <span>=</span> <span></span><span>'</span><span>1000100000000000000000000100000001000000000000000100010101000100</span><span>'</span>
</span></span><span><span><span>pulsBarp</span> <span>=</span> <span></span><span>'</span><span>EEEEEEEEEEEEEEEEEEEEGEEEEGCEEEECAAAAAAAAAAAAAAACACAAAAAABDBBBDBB</span><span>'</span>
</span></span><span><span>
</span></span><span><span><span># C section, melodic finale</span>
</span></span><span><span><span>pulsCnot</span> <span>=</span> <span></span><span>'</span><span>CCA.CAA..ACACCCAGGCCGCGE..GGG.GG#DD###.#.D###.#DFF.FF.CFGG.GG.GD</span><span>'</span>
</span></span><span><span><span>pulsCoct</span> <span>=</span> <span></span><span>'</span><span>0000011001100100001000100001001000100100001010011001000001001001</span><span>'</span>
</span></span><span><span><span>pulsCarp</span> <span>=</span> <span></span><span>'</span><span>EEEEAEEEEEEEAAECEEEECEECEEEECECEAAADADAAAAADDAAAAACCAAFABBBBDBBB</span><span>'</span>
</span></span><span><span>
</span></span><span><span><span># ABAC sections concatenated</span>
</span></span><span><span><span>puls_chart_note</span> <span>=</span> <span>pulsAnot</span> <span>+</span> <span>pulsBnot</span> <span>+</span> <span>pulsAnot</span> <span>+</span> <span>pulsCnot</span>
</span></span><span><span><span>puls_chart_oct</span> <span>=</span>  <span>pulsAoct</span> <span>+</span> <span>pulsBoct</span> <span>+</span> <span>pulsAoct</span> <span>+</span> <span>pulsCoct</span>
</span></span><span><span><span>puls_chart_arp</span> <span>=</span>  <span>pulsAarp</span> <span>+</span> <span>pulsBarp</span> <span>+</span> <span>pulsAarp</span> <span>+</span> <span>pulsCarp</span>
</span></span></pre>
<p>The <a href="https://github.com/a1k0n/tt08-vgademo/blob/main/soundgen/s.py" target="_blank">full Python script</a>
emulates all the instruments exactly and plays the entire song, while also
dumping out the data tables used by the verilog code.</p>

<div>
<pre><code>notefreq: 5b 67 73 7a 81 89 9a ad
pulsmask:  1 0 0 0 1 0 0 0 0 0 1 0 0 0 1 0 1 0 0 0 1 0 0 0 0 0 1 0 0 0 1 0 1 0 0 0 1 0 0 0 0 0 1 0 0 0 1 0 1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 0 0 0 1 0 0 0 1 0 1 0 0 0 1 0 0 0 0 1 1 0 0 0 1 1 1 1 0 0 1 0 0 0 0 0 1 0 0 0 1 1 1 1 0 0 1 1 0 1 1 1 0 0 1 1 0 0 1 0 0 0 1 0 0 0 0 0 1 0 0 0 1 0 1 0 0 0 1 0 0 0 0 0 1 0 0 0 1 0 1 0 0 0 1 0 0 0 0 0 1 0 0 0 1 0 1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 0 1 1 1 0 1 1 1 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 1 1 1 0 1 1 1 1 1 1 1 1 0 1 0 1 1 1 1 0 1 1 1 1 0 1 1 0 1 1 1 1 0 1 1 0 1 1
pulsfreq1: 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 3 3 3 3 3 3 3 3 5 5 5 5 5 5 5 5 0 0 0 0 0 0 0 0 0 0 6 6 6 6 0 0 5 5 5 5 0 0 0 0 0 0 5 5 5 5 5 5 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 3 3 3 3 3 3 3 3 3 5 5 5 5 5 5 5 5 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 3 3 3 3 3 3 3 3 5 5 5 5 5 5 5 5 0 0 6 6 0 6 6 6 6 6 0 6 0 0 0 6 5 5 0 0 5 0 5 2 2 2 5 5 5 5 5 5 4 1 1 4 4 4 4 4 4 1 4 4 4 4 4 1 3 3 3 3 3 3 0 3 5 5 5 5 5 5 5 1
pulsfreq2: 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 7 7 7 7 7 7 7 7 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 5 5 5 5 5 5 0 0 0 0 2 0 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 0 6 0 0 0 6 6 6 6 7 1 1 1 7 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 7 7 7 7 7 7 7 7 2 2 2 2 6 2 2 2 2 2 2 2 6 6 2 0 2 2 2 2 0 2 2 0 0 0 2 2 0 0 0 2 6 6 6 1 6 1 1 6 6 6 6 1 1 1 6 6 6 6 6 0 6 6 3 6 7 7 7 7 1 1 7 7
pulsoct:   0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 0 1 1 1 0 1 1 1 0 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 0 0 1 0 0 0 0 1 0 0 0 1 0 0 0 0 1 0 0 1 0 0 0 1 0 0 1 1 0 0 0 1 0 1 1 0 1 1 0 0 1 0 0 0 0 0 1 1 0 1 1 0 1
bassfreq:  6 2 6 6 6 2 6 6 0 0 5 0 2 0 0 0 1 1 1 4 1 4 1 1 3 0 3 3 5 1 5 5
bassoct:   0 1 1 0 0 0 0 0 0 0 0 1 1 0 1 0 0 0 1 1 0 1 0 1 0 1 1 0 0 1 1 0
kick:   1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 1 0 1 0 0 1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 1 1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 1 0 1 0 0 1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
snare:  0 0 1 0 0 1 1 0 0 0 1 0 0 1 1 0 0 0 1 0 0 0 1 0 0 1 1 0 0 0 1 0 0 0 1 0 0 1 1 0 0 0 1 0 0 1 1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 1 1 1 0 0 1 0 0 1 1 0 0 0 1 0 0 1 1 0 0 0 1 0 0 0 1 0 0 1 1 0 0 0 1 0 0 0 1 0 0 1 1 0 0 0 1 0 0 1 1 0 0 0 1 0 0 1 1 0 0 0 1 0 0 0 1 1
</code></pre>
</div>
<p>all data needed to play the song</p>


<h2 id="retrospective">Retrospective</h2>

<p>There are a few design choices I made that I regret after finishing this intro.</p>

<p>First, the audio track has a completely independent clock from the visual
component. A lot of classic chiptune music was constrained by using 50Hz or 60Hz
frame timers, limiting the available tempo choices. Additionally I didn't want
to tie my sample rate to the VGA horizontal frequency (31.5kHz) which would have
been a natural choice. Instead I used a 48MHz / 1024 clock divider (46875Hz) and
used a tick rate asynchronous from the VGA frequency, and then I could better
control tempo, etc.</p>

<p>This seemed like a good idea, except when I tried to do simple music-sync
effects. Now at any given point on the screen, the music can tick over,
resulting in "tearing". There's a speckly checkerboard effect that's in sync
with the music, but it doesn't "pop" because it doesn't actually work correctly.
Additionally, the music loops about halfway through the last frame of the intro,
resulting in a checkerboard blinking in for half of a frame as some counter
overflows before it can be properly reset at the top of the next frame.</p>

<p>The 1220x480 video mode was also a huge mistake. In general, the people who can
test this design aren't going to do it on a CRT, so better to just sync up
properly with the LCD pixels and not rely on 90s era temporal dithering and CRT
smoothing.</p>

<h2 id="nyan-cat">Nyan cat</h2>

<p><video playsinline="" loop="" controls="" poster="https://www.a1k0n.net/img/tt08-nyan.png"><source src="https://www.a1k0n.net/img/tt08-nyan.mp4"> <i>video unavailable</i></video></p>
<p>nyan.cat demo; in the actual design the musical intro only plays once, and then loops seamlessly as the sunglasses scroll off the screen.</p>

<p>A couple days before the Tiny Tapeout 8 deadline, <a href="https://urish.org/" target="_blank">Uri</a>
threw down a challenge in the Discord to make a Nyan Cat, and so I decided to
take everything I learned from making the TT08 intro and the donut and put
together a design using ripped art and music. I'd reuse some code, avoid
previous mistakes, use 640x480 VGA, audio synced to video (31.5kHz sample rate,
60Hz tempo ticks), simpler dithering. Ideally, get it all to fit in one tile.</p>

<p>Well, it turns out the design I came up with worked and all the cells fit into
one tile -- but it was too crowded like that for detailed routing<sup id="fnref:2"><a href="#fn:2">3</a></sup> to
succeed. Without any workable ideas to cut down on space and without much time
left before the deadline, I just grew the design to two tiles and added a "deal
with it" sunglasses easter egg to consume some tiny portion of the expanded
space.</p>

<p><img src="https://www.a1k0n.net/img/tt08-nyan-gds.png" alt="nyan GDS">
</p><p>The layout. The red cells throughout the bottom half are actually just filler capacitors, essentially unused space. Alas, it didn't fit into one tile though.</p>

<h2 id="art">Art</h2>

<p>I started by grabbing the original animated .gif from <a href="https://nyan.cat/" target="_blank">nyan.cat</a> and
wrote a <a href="https://github.com/a1k0n/tt08-nyan/blob/main/scripts/extractcat.py" target="_blank">python
script</a> to
extract the individual frames, the palette, and generate a remapped data table
with all of the unique animation frames. I used a color picker to grab all the
original rainbow colors and background color, then converted them to their
closest match in RGB222 with a 2x2 dithering matrix.</p>

<p><img src="https://www.a1k0n.net/img/tt08-nyan-cat.gif" alt="original nyancat.gif"></p>
<p>original nyan.cat .gif</p>


<p>The cat smoothly shifts back and forth in the original animation, so I reused
the sine wave generator code to give him a little <span data-katex="">x</span>-offset.</p>

<p>Originally there are little exploding stars/fireworks? scrolling by in the
background, but I didn't get around to emulating those. Instead I just reused
the <a href="#starfield">LFSR-based starfield</a> from the TT08 demo except without random
star speeds. This leads to extremely visible artifacts where the star positions
are obviously being right-shifted from one line to the next near the bottom of
the screen.</p>

<h2 id="music-1">Music</h2>

<p>I found a <a href="https://onlinesequencer.net/95410" target="_blank">MIDI rendition of the nyan.cat
song</a> and wrote yet <a href="https://github.com/a1k0n/tt08-nyan/blob/main/scripts/ripmusic.py" target="_blank">another crappy Python
script</a> to
parse the MIDI, split out the melody and bass sections, remap note indices to a
minimal scale of notes (once again, only 8 notes are used in the scale), and
dump out tables that the Verilog code could read.</p>

<div>
<pre><code>Total length: 288 ticks
melodynotes ['C#', 'D ', 'D#', 'E ', 'F#', 'G#', 'A#', 'B ']
bassnotes ['C#', 'D#', 'E ', 'F#', 'G#', 'B ']
Remapped melody scale: ['C#', 'D ', 'D#', 'E ', 'F#', 'G#', 'A#', 'B ']
Number of unique notes after remapping: 8
melody increment table 48 4c 51 56 60 6c 79 81
bassnote 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 3 3 3 3 4 4 4 4 2 2 2 2 5 5 5 5 0 0 0 0 4 4 4 4 7 7 7 7 7 7 7 7 3 3 3 3 4 4 4 4 2 2 2 2 5 5 5 5 0 0 0 0 4 4 4 4 7 7 7 7 7 7 7 7 3 3 3 3 4 4 4 4 2 2 2 2 5 5 5 5 0 0 0 0 4 4 4 4 7 7 7 7 7 7 7 7 3 3 3 3 4 4 4 4 2 2 2 2 5 5 5 5 0 0 0 0 4 4 4 4 7 7 7 7 7 7 7 7 3 3 5 5 7 7 3 3 2 2 4 4 7 7 2 2 0 0 3 3 5 5 7 7 7 7 2 2 4 4 7 7 3 3 5 5 7 7 3 3 2 2 4 4 7 7 2 2 0 0 3 3 5 5 7 7 7 7 2 2 4 4 7 7 3 3 5 5 7 7 3 3 2 2 4 4 7 7 2 2 0 0 3 3 5 5 7 7 7 7 2 2 4 4 7 7 3 3 5 5 7 7 3 3 2 2 4 4 7 7 2 2 0 0 3 3 5 5 7 7 7 7 2 2 4 4 7 7
bassoct 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 1 1 2 2 1 1 2 2 1 1 2 2 1 1 2 2 1 1 2 2 1 1 2 2 0 0 1 1 0 0 1 1 1 1 2 2 1 1 2 2 1 1 2 2 1 1 2 2 1 1 2 2 1 1 2 2 0 0 1 1 0 0 1 1 1 1 2 2 1 1 2 2 1 1 2 2 1 1 2 2 1 1 2 2 1 1 2 2 0 0 1 1 0 0 1 1 1 1 2 2 1 1 2 2 1 1 2 2 1 1 2 2 1 1 2 2 1 1 2 2 0 0 1 1 0 0 1 1 2 2 2 2 2 2 3 3 2 2 2 2 2 2 3 3 2 2 2 2 2 2 2 2 1 1 2 2 2 2 2 2 2 2 2 2 2 2 3 3 2 2 2 2 2 2 3 3 2 2 2 2 2 2 2 2 1 1 2 2 2 2 2 2 2 2 2 2 2 2 3 3 2 2 2 2 2 2 3 3 2 2 2 2 2 2 2 2 1 1 2 2 2 2 2 2 2 2 2 2 2 2 3 3 2 2 2 2 2 2 3 3 2 2 2 2 2 2 2 2 1 1 2 2 2 2 2 2
basstrigger 1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0
melodynote 2 3 4 4 7 7 2 3 4 7 0 2 0 6 7 7 4 4 2 3 4 4 7 7 0 6 7 0 3 2 3 0 4 4 5 5 2 2 2 7 1 0 7 7 7 7 0 0 1 1 1 0 7 0 2 4 5 2 4 0 2 7 0 7 2 2 4 4 5 2 4 0 2 7 1 2 1 0 7 0 1 1 7 0 2 4 0 2 0 7 0 0 7 7 0 0 4 4 5 5 2 2 2 7 1 0 7 7 7 7 0 0 1 1 1 0 7 0 2 4 5 2 4 0 2 7 0 7 2 2 4 4 5 2 4 0 2 7 1 2 1 0 7 0 1 1 7 0 2 4 0 2 0 7 0 0 7 7 0 0 7 7 4 5 7 7 4 5 7 0 2 7 3 2 3 4 7 7 7 7 4 5 7 4 3 2 0 7 4 2 3 4 7 7 4 5 7 7 4 5 7 7 0 2 7 4 5 4 7 7 7 6 7 4 5 7 3 2 3 4 7 7 6 6 7 7 4 5 7 7 4 5 7 0 2 7 3 2 3 4 7 7 7 7 4 5 7 4 3 2 0 7 4 2 3 4 7 7 4 5 7 7 4 5 7 7 0 2 7 4 5 4 7 7 7 6 7 4 5 7 3 2 3 4 7 7 0 0
melodyoct 1 1 1 1 1 1 1 1 1 1 2 2 2 1 1 1 1 1 1 1 1 1 1 1 2 1 1 2 2 2 2 2 1 1 1 1 1 1 1 0 1 1 0 0 0 0 1 1 1 1 1 1 0 1 1 1 1 1 1 1 1 0 1 0 1 1 1 1 1 1 1 1 1 0 1 1 1 1 0 1 1 1 0 1 1 1 1 1 1 0 1 1 0 0 1 1 1 1 1 1 1 1 1 0 1 1 0 0 0 0 1 1 1 1 1 1 0 1 1 1 1 1 1 1 1 0 1 0 1 1 1 1 1 1 1 1 1 0 1 1 1 1 0 1 1 1 0 1 1 1 1 1 1 0 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 1 1 0 1 1 1 1 0 0 0 0 0 0 0 0 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 0 1 1 1 1 0 0 0 0 0 0 0 0 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 0 0 1 1
melodytrigger 1 1 1 0 1 0 1 1 1 1 1 1 1 1 1 0 1 0 1 1 1 0 1 0 1 1 1 1 1 1 1 1 1 0 1 0 1 1 0 1 1 1 1 0 1 0 1 0 1 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 1 0 1 1 1 1 1 1 1 1 1 1 1 1 1 0 1 1 1 1 1 1 1 1 1 0 1 0 1 0 1 0 1 0 1 1 0 1 1 1 1 0 1 0 1 0 1 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 1 0 1 1 1 1 1 1 1 1 1 1 1 1 1 0 1 1 1 1 1 1 1 1 1 0 1 0 1 0 1 0 1 1 1 0 1 1 1 1 1 1 1 1 1 1 1 0 1 0 1 1 1 1 1 1 1 1 1 1 1 1 1 0 1 1 1 0 1 1 1 1 1 1 1 1 1 1 1 0 1 1 1 1 1 1 1 1 1 1 1 0 1 0 1 0 1 1 1 0 1 1 1 1 1 1 1 1 1 1 1 0 1 0 1 1 1 1 1 1 1 1 1 1 1 1 1 0 1 1 1 0 1 1 1 1 1 1 1 1 1 1 1 0 1 1 1 1 1 1 1 1 1 1 1 0 1 0
</code></pre>
</div>
<p>output of the Python script containing the full song data extracted from MIDI</p>


<p>Then for kicks I added the kick drum (ha ha) to the bass track, same as the TT08
intro. I'm pretty sure I just wrote the
<a href="https://github.com/a1k0n/tt08-nyan/blob/main/data/kicktrigger.hex" target="_blank">triggers</a>
for that out by hand; there wasn't time to create any fancy tools.</p>

<p>This has just two audio channels:</p>

<ul>
<li>Bass/kick, pure square wave this time</li>
<li>Melody, 25% duty cycle pulse wave to add timbre</li>
</ul>

<p>Both bass and melody use per-tick exponential decay envelopes, with each tick
occurring at the start of a video frame (so 60Hz). The kick drum takes over the
bass channel for a few frames, exponentially decreasing its frequency before
returning to the original bass pitch/envelope.</p>

<div>
<p>All notes use the same increment table, but octaves are shifted by changing the
phase bits used. The "sqr" channel is actually 25% duty cycle pulse, turning on
only when both of the 2 MSBs are on.</p>
<pre><span><span><span>reg</span> <span>[</span><span>12</span><span>:</span><span>0</span><span>]</span> <span>sqr_pha</span><span>;</span>
</span></span><span><span><span>reg</span> <span>[</span><span>5</span><span>:</span><span>0</span><span>]</span> <span>sqr_vol</span><span>;</span>
</span></span><span><span>
</span></span><span><span><span>wire</span> <span>[</span><span>2</span><span>:</span><span>0</span><span>]</span> <span>cur_melody_note</span> <span>=</span> <span>melody_note</span><span>[</span><span>songpos</span><span>]</span><span>;</span>
</span></span><span><span><span>wire</span> <span>[</span><span>7</span><span>:</span><span>0</span><span>]</span> <span>sqr_inc</span> <span>=</span> <span>noteinctable</span><span>[</span><span>cur_melody_note</span><span>]</span><span>;</span>
</span></span><span><span>
</span></span><span><span><span>wire</span> <span>sqr_on</span> <span>=</span>
</span></span><span><span>  <span>cur_melody_oct</span> <span>=</span><span>=</span> <span>2</span> <span>?</span> <span>sqr_pha</span><span>[</span><span>10</span><span>]</span><span>&amp;</span><span>sqr_pha</span><span>[</span><span>9</span><span>]</span> <span>:</span>
</span></span><span><span>  <span>cur_melody_oct</span> <span>=</span><span>=</span> <span>1</span> <span>?</span> <span>sqr_pha</span><span>[</span><span>11</span><span>]</span><span>&amp;</span><span>sqr_pha</span><span>[</span><span>10</span><span>]</span> <span>:</span>
</span></span><span><span>  <span>sqr_pha</span><span>[</span><span>12</span><span>]</span><span>&amp;</span><span>sqr_pha</span><span>[</span><span>11</span><span>]</span><span>;</span>
</span></span><span><span>
</span></span><span><span><span>wire</span> <span>[</span><span>5</span><span>:</span><span>0</span><span>]</span> <span>sqr_sample</span> <span>=</span> <span>sqr_on</span> <span>?</span> <span>sqr_vol</span> <span>:</span> <span>6</span><span>'d0</span><span>;</span>
</span></span><span><span>
</span></span><span><span><span>// On each beat (6 ticks):
</span></span></span><span><span><span></span>  <span>if</span> <span>(</span><span>melody_trigger</span><span>[</span><span>songpos_next</span><span>]</span><span>)</span> <span>begin</span>
</span></span><span><span>    <span>sqr_vol</span> <span>&lt;</span><span>=</span> <span>63</span><span>;</span>
</span></span><span><span>  <span>end</span>
</span></span><span><span>
</span></span><span><span><span>// On each non-beat tick:
</span></span></span><span><span><span></span>  <span>sqr_vol</span> <span>&lt;</span><span>=</span> <span>sqr_vol</span> <span>-</span> <span>(</span><span>sqr_vol</span><span>&gt;</span><span>&gt;</span><span>3</span><span>)</span><span>;</span>
</span></span><span><span>
</span></span><span><span><span>// On each audio sample:
</span></span></span><span><span><span></span>  <span>sqr_pha</span> <span>&lt;</span><span>=</span> <span>sqr_pha</span> <span>+</span> <span>{</span><span>4</span><span>'b0</span><span>,</span> <span>sqr_inc</span><span>}</span><span>;</span>
</span></span><span><span>
</span></span></pre></div>
<p>Verilog code generating the pulse channel with envelopes</p>


<p>I also added a global low pass filter because the pulse melody was a bit
piercing. This turned out to dull the sound a lot more than I intended, though.</p>

<h2 id="manufacturing-tt08">Manufacturing TT08</h2>

<p>Tiny Tapeout 8 began manufacturing in September 2024, completing production of
wafers and dies. And then, in March 2025, we received the devastating news that
Efabless, the company supporting Tiny Tapeout, <a href="https://www.linkedin.com/posts/tinytapeout_were-very-sad-to-hear-that-efabless-corporation-activity-7301638170297720832-n7Ru" target="_blank">abruptly shut
down</a>,
leaving its assets, which included mid-production TT08 and TT09 chips, in an
uncertain state. TT08 was just being packaged at the time of the shutdown.</p>

<p>This was kind of a crushing blow for me, since I had put so much effort into the
designs on this chip in particular. It also meant that the judging for the demo
competition was indefinitely on hold, as it required the physical hardware to be
delivered to the judges.</p>

<p>And then, out of nowhere, the <code>#tt08-silicon</code> channel showed up on the
Tiny Tapeout discord server in late September 2025. It seems the chips were
acquired by a new company and turned over to the Tiny Tapeout team. Soon after, this arrived at my doorstep:</p>

<p><img src="https://www.a1k0n.net/img/tt08-devboard.jpg" alt="TT08 development board">
</p><p>Tiny Tapeout 8 development board, with audio and VGA Pmods attached</p>

<p>In fact all of my designs worked perfectly -- except it turns out I had relaxed
the timing on the donut a bit in order to reduce gate area (lower clock rates
require lower drive strength which means smaller transistors), so the donut
needs to run at 45MHz instead of 48MHz to avoid some glitches.</p>

<p><img src="https://www.a1k0n.net/img/tt08-running.jpg" alt="TT08 running nyan cat">
</p><p>Tiny Tapeout 8 running Nyan Cat on my LCD and a guitar amp for audio</p>

<h2 id="wrapping-up">Wrapping up</h2>

<p>Needless to say, I was elated when I saw my designs running perfectly on my desk
after a long year of waiting and expecting the worst.</p>

<p>I was holding out on doing this writeup until the judges had definitively seen
the hardware running. <a href="https://www.youtube.com/watch?v=A9BhSaqL7jg" target="_blank">bitluni showed them all off on a recent
livestream</a> with both LCD and CRTs,
so I figured it's finally time to post this.</p>

<p>Revisiting these designs over a year later, I had forgotten how involved they
were and how many intricacies I wanted to explain in this post.</p>

<p>I learned so many new low-level tricks building these demos and I have even
better tricks in store for the next one.</p>



    </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Over 40% of Deceased Drivers in Vehicle Crashes Test Positive for THC: Study (129 pts)]]></title>
            <link>https://www.facs.org/media-center/press-releases/2025/over-40-of-deceased-drivers-in-motor-vehicle-crashes-test-positive-for-thc-study-shows/</link>
            <guid>46337123</guid>
            <pubDate>Sat, 20 Dec 2025 16:07:24 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.facs.org/media-center/press-releases/2025/over-40-of-deceased-drivers-in-motor-vehicle-crashes-test-positive-for-thc-study-shows/">https://www.facs.org/media-center/press-releases/2025/over-40-of-deceased-drivers-in-motor-vehicle-crashes-test-positive-for-thc-study-shows/</a>, See on <a href="https://news.ycombinator.com/item?id=46337123">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><p>CHICAGO &nbsp;— New study findings show that over 40% of drivers who died in motor vehicle collisions tested positive for active delta-9-tetrahydrocannabinol (THC) in their system, with average blood levels far exceeding those considered to cause impairment. The research highlights a significant and persistent public health risk that is unchanged by the legalization of recreational cannabis, the authors said.&nbsp;</p>
<p>The research will be presented at the American College of Surgeons (ACS) <a rel="noopener" href="https://www.facs.org/for-medical-professionals/conferences-and-meetings/clinical-congress-2025/" target="_blank" title="Clinical Congress 2025">Clinical Congress 2025</a> in Chicago, October 4–7.&nbsp;</p>
<p>Researchers analyzed coroner records from Montgomery County in Ohio from January 2019 to September 2024, focusing on 246 deceased drivers who were tested for THC following a fatal crash. When autopsies are performed, drug screening is typically part of the process. The study period included the state’s legalization of recreational cannabis in 2023.&nbsp;</p>
<p>“I was surprised to see that level,” said lead author Akpofure P. Ekeh, MBBS, FACS, a professor of surgery at Wright State University in Dayton, Ohio. “An average level of 30.7 ng/mL generally means those people must have consumed marijuana at some time close to driving. This isn’t about residual use; it’s about recent consumption.”&nbsp;</p>
<h3>Key Study Findings&nbsp;</h3>
<ul>
<li><strong>High Prevalence:</strong> 103 drivers (41.9%) overall tested positive for THC, with yearly rates ranging from 25.7% to 48.9%.</li>
<li><strong>No Effect from Legalization:</strong> The rate of drivers who tested positive for THC did not change significantly before or after legalization (42.1% vs. 45.2%), indicating that legal status did not influence the behavior of those who chose to drive after use.&nbsp;</li>
<li><strong>Consistent Over Time:</strong> The high rate of THC positivity showed no significant change over the six-year study period.&nbsp;</li>
</ul>
<p>The study notes that blood THC levels are typically drawn by the coroner within hours of death, providing an accurate snapshot of a driver’s state at the time of the crash. Most states that have set legal limits for driving range from 2 to 5 nanograms per milliliter (ng/mL) — a threshold the average level in this study (30.7 ng/mL) far exceeded.&nbsp;</p>
<p>“The messaging over the last few years has been just the push towards recreational legalization,” Dr. Ekeh noted. “The problem is that from a public health standpoint, there has not been enough emphasis on some of the <a rel="noopener" href="https://www.facs.org/for-patients/preparing-for-surgery/marijuana-and-surgery/" target="_blank" title="Marijuana and Surgery">downsides and the dangers</a> that can occur. People should treat smoking marijuana just like they treat alcohol: don’t smoke and drive.”&nbsp;</p>
<p>Co-authors are Lois Nguapa, BS; Clara Mussin Phillips, BS; and Ann Cardosi, BS, MPH.&nbsp;</p>
<p><strong>Disclosures:</strong> The authors have no relevant disclosures. &nbsp;</p>
<p><strong>Citation:</strong> Ekeh A, et al. Cannabis Prevalence in Drivers Involved in Motor Vehicle Crash Fatalities over a 6-Year Period, Scientific Forum, American College of Surgeons (ACS) Clinical Congress 2025.&nbsp;</p>
<p><em><strong>Note: </strong>This research was presented as an abstract at the ACS Clinical Congress Scientific Forum. Research abstracts presented at the ACS Clinical Congress Scientific Forum are reviewed and selected by a program committee but are not yet peer reviewed.&nbsp;</em></p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Go ahead, self-host Postgres (326 pts)]]></title>
            <link>https://pierce.dev/notes/go-ahead-self-host-postgres#user-content-fn-1</link>
            <guid>46336947</guid>
            <pubDate>Sat, 20 Dec 2025 15:43:15 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://pierce.dev/notes/go-ahead-self-host-postgres#user-content-fn-1">https://pierce.dev/notes/go-ahead-self-host-postgres#user-content-fn-1</a>, See on <a href="https://news.ycombinator.com/item?id=46336947">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><p>Self-hosting a database sounds terrifying. That narrative has certainly been pushed over the last 10 years by the big cloud providers:</p>
<ul>
<li>Hosting your own database is dangerous</li>
<li>How are you going to get all the 9s of reliability doing it yourself?</li>
<li>You'll have access to dedicated database engineers that you couldn't (or wouldn't want to) hire yourself</li>
</ul>
<p>The rumors obscure the truth.</p>
<ul>
<li>Most cloud hosts are just running a slightly modified version of the open source Postgres server anyway<sup><a href="#user-content-fn-1" id="user-content-fnref-1" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup></li>
<li>Database engineering is not a silver bullet if your queries are sub-optimal. Abstracting away your engine too much from your code doesn't let you benchmark what's going on and work around the otherwise reasonable constraints of how the engine is actually querying your code.</li>
</ul>
<p>I've had data corruption when using a 3rd party vendor just the same as I've had when self-hosting. And with a serious markup, what's the point?</p>
<p>I've been running my own self-hosted postgres for the better part of two years now, serving thousands of users and tens of millions of queries daily<sup><a href="#user-content-fn-5" id="user-content-fnref-5" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup>. I expected it would give me much more trouble than it has. It's caused me exactly 30mins of stress during a manual migration and that's all. Aside from that it's been fast, stable, and much cheaper.</p>
<p>I sleep just fine at night thank you.</p>
<h2 id="blue-skies-and-the-white-cloud">Blue skies and the white cloud</h2>
<p>Let me rewind for a second. The "database as a service" narrative wasn't always the dominant one. From the 80s to the early 2000s, everyone ran their own databases because there wasn't really an alternative. You had your application server and your database server, often on the same physical machine. It was pretty dang fast<sup><a href="#user-content-fn-6" id="user-content-fnref-6" data-footnote-ref="true" aria-describedby="footnote-label">3</a></sup> because it was communicating over localhost before forwarding the final payload over the network.</p>
<p>Amazon launched RDS in 2009. The pitch was compelling: we'll handle backups, patching, high availability, and monitoring. You just connect and go. The early pricing was reasonable too - a small RDS instance cost about the same as a dedicated server, but with less operational overhead. If you had to scale your database specs independent from your web service, it made some sense.</p>
<p>The real shift happened around 2015 when cloud adoption accelerated. Companies started to view <em>any</em> infrastructure management as "undifferentiated heavy lifting"<sup><a href="#user-content-fn-2" id="user-content-fnref-2" data-footnote-ref="true" aria-describedby="footnote-label">4</a></sup>. Running your own database became associated with legacy thinking. The new orthodoxy emerged: focus on your application logic, let AWS handle the infrastructure.</p>
<p>Fast forward to 2025 and I hope the pendulum might be swinging back. RDS pricing has grown considerably more aggressive. A db.r6g.xlarge instance (4 vCPUs, 32GB RAM) now costs $328/month before you add storage, backups, or multi-AZ deployment. For that price, you could rent a dedicated server with 32 cores and 256GB of RAM.</p>
<h2 id="unpacking-the-cloud">Unpacking the cloud</h2>
<p>For the most part managed database services aren't running some magical proprietary technology. They're just running the same open-source Postgres you can download with some operational tooling wrapped around it.</p>
<p>Take AWS RDS. Under the hood, it's:</p>
<ul>
<li>Standard Postgres compiled with some AWS-specific monitoring hooks</li>
<li>A custom backup system using EBS <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWithAutomatedBackups.html" data-snapshot-id="4196c4ad50694776e515625faa7c1dc1" data-snapshot-url="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWithAutomatedBackups.html" data-snapshot-date="2025-07-02T08:55:01.569843">snapshots</a></li>
<li>Automated configuration management via Chef/Puppet/Ansible</li>
<li>Load balancers and connection pooling (PgBouncer)</li>
<li>Monitoring integration with CloudWatch</li>
<li>Automated failover scripting</li>
</ul>
<p>None of this is technically complex. The value proposition is operational: they handle the monitoring, alerting, backup verification, and incident response. It's also a production ready configuration at minute zero of your first deployment. But the actual database engine? It's the same Postgres running the same SQL queries with the same performance characteristics.</p>
<p>I helped proved this to myself when I migrated off RDS. I took a <code>pg_dump</code> of my RDS instance, restored it to a self-hosted server with identical specs, and ran my application's test suite. Performance was identical. In some cases, it was actually better because I could tune parameters that RDS locks down.</p>
<h2 id="my-self-hosting-journey">My self-hosting journey</h2>
<p>I spent a weekend migrating to a dedicated server from DigitalOcean<sup><a href="#user-content-fn-3" id="user-content-fnref-3" data-footnote-ref="true" aria-describedby="footnote-label">5</a></sup>: 16 vCPU / 32GB Memory / 400GB disk. The migration took about 4 hours of actual work:</p>
<ol>
<li>Hour 1: Provision server, install Postgres, configure basic settings (kamal makes this pretty easy)</li>
<li>Hour 2: Set up monitoring (Prometheus + Grafana), configure backups</li>
<li>Hour 3: Migrate data using <code>pg_dump</code> and <code>pg_restore</code></li>
<li>Hour 4: Update application connection strings, verify everything works</li>
</ol>
<p>The performance improvement was immediate. Query latency dropped by about 20% across the board. Why? Because I could tune the configuration for my specific workload instead of using RDS's conservative defaults.</p>
<h2 id="the-real-operational-complexity">The real operational complexity</h2>
<p>For my companies with high availability requirements, this stack takes me about half an hour per month. For the stacks that get less traffic I'm fully hands off - set it and forget it. This is roughly my cadence for my primary deploys:</p>
<p><strong>Weekly tasks</strong> (10 minutes):</p>
<ul>
<li>Check backup verification (automated, just reviewing alerts)</li>
<li>Review slow query logs</li>
<li>Check disk space trends</li>
</ul>
<p><strong>Monthly tasks</strong> (30 minutes):</p>
<ul>
<li>Apply Postgres security updates</li>
<li>Review and rotate backup retention</li>
<li>Capacity planning based on growth trends</li>
</ul>
<p><strong>Quarterly tasks (optional)</strong> (2 hours):</p>
<ul>
<li>Update monitoring dashboards</li>
<li>Review and optimize configuration parameters</li>
<li>Test disaster recovery procedures</li>
</ul>
<p>As far as I'm concerned this is roughly comparable to the time you spend debugging RDS connection limits, working around parameter groups you can't modify, or dealing with surprise maintenance windows.</p>
<p>The main operational difference is that you're responsible for incident response. If your database goes down at 3 AM, you need to fix it. But here's the thing: RDS goes down too<sup><a href="#user-content-fn-4" id="user-content-fnref-4" data-footnote-ref="true" aria-describedby="footnote-label">6</a></sup>. And when it does, you're still the one getting paged, you just have fewer tools to fix the problem.</p>
<p>For the most part I've found that unless I'm actively messing with the database, it's really stable. After all you're just renting some remote machine in a data center somewhere. All updates are up to you - so you have a good idea when to schedule the most risky windows.</p>
<h2 id="when-self-hosting-makes-sense">When self-hosting makes sense</h2>
<p>I'd argue self-hosting is the right choice for <em>basically</em> everyone, with the few exceptions at both ends of the extreme:</p>
<ol>
<li>If you're just starting out in software &amp; want to get something working quickly with vibe coding, it's easier to treat Postgres as just another remote API that you can call from your single deployed app</li>
<li>If you're a <em>really</em> big company and are reaching the scale where you need trained database engineers to just work on your stack, you might get economies of scale by just outsourcing that work to a cloud company that has guaranteed talent in that area. The second full freight salaries come into play, outsourcing looks a bit cheaper.</li>
<li>Regulated workloads (PCI-DSS, FedRAMP, HIPAA, etc.) sometimes require a managed platform with signed BAAs or explicit compliance attestations.</li>
</ol>
<h2 id="the-configuration-deep-dive">The configuration deep dive</h2>
<p>The things you really have to bear in mind when self-hosting:</p>
<p><strong>Memory Configuration</strong>: This is where most people mess up. Pulling the standard <code>postgres</code> docker image won't cut it. You have to configure memory bounds with static limits that correspond to hardware. I've <a href="https://github.com/piercefreeman/autopg" data-snapshot-id="b9fb9b474ce6673169887d1102a3e4bf" data-snapshot-url="https://github.com/piercefreeman/autopg" data-snapshot-date="2025-07-02T07:58:54.204846">automated</a> some of these configurations. But whether you do it manually or use some auto-config, tweaking these params is a must.</p>
<p>The key parameters:</p>
<ul>
<li><code>shared_buffers</code>: Start around 25 % of RAM; modern PG happily uses tens of GB.</li>
<li><code>effective_cache_size</code>: Set to 75% of system RAM (this tells Postgres how much memory the OS will use for caching)</li>
<li><code>work_mem</code>: Be conservative here. Set it to total RAM / max_connections / 2, or use a fixed value like 32MB</li>
<li><code>maintenance_work_mem</code>: Can be generous (1-2GB), only used during VACUUM and index operations</li>
</ul>
<p><strong>Connection Management</strong>: RDS enforces their own max connections, but when self hosting you get the opportunity to choose your own:</p>
<pre><code># Connection settings
max_connections = 200
shared_preload_libraries = 'pg_stat_statements'
log_connections = on
log_disconnections = on
</code></pre>
<p>Wahoo! More connections = more parallelism right?</p>
<p>No such free lunch I'm afraid. Making fresh connections in postgres has pretty expensive overhead, so you almost always want to put a load balancer on front of it. I'm using pgbouncer on all my projects by default - even when load might not call for it. Python asyncio applications just work better with a centralized connection pooler.</p>
<p>And yes, I've <a href="https://github.com/piercefreeman/autopg/tree/main/autopgpool" data-snapshot-id="023f5303f782c2b4c1bfd977bb401765" data-snapshot-url="https://github.com/piercefreeman/autopg/tree/main/autopgpool" data-snapshot-date="2025-07-02T08:25:51.770693">automated</a> some of the config there too.</p>
<p><strong>Storage Tuning</strong>: NVMe SSDs change the performance equation completely:</p>
<pre><code># Storage optimization for NVMe
random_page_cost = 1.1                 # Down from default 4.0
seq_page_cost = 1.0                    # Keep at default
effective_io_concurrency = 200         # Up from default 1
</code></pre>
<p>These settings tell Postgres that random reads are almost as fast as sequential reads on NVMe drives, which dramatically improves query planning.</p>
<p><strong>WAL Configuration</strong>: Write-Ahead Logging is critical for durability and performance:</p>
<pre><code># WAL settings
wal_level = replica                     # Enable streaming replication
max_wal_size = 2GB                     # Allow larger checkpoints
min_wal_size = 1GB                     # Prevent excessive recycling
checkpoint_completion_target = 0.9      # Spread checkpoint I/O over 90% of interval
</code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>I'm not advocating that everyone should self-host everything. But the pendulum has swung too far toward managed services. There's a large sweet spot where self-hosting makes perfect sense, and more teams should seriously consider it.</p>
<p>Start small. If you're paying more than $200/month for RDS, spin up a test server and migrate a non-critical database. You might be surprised by how straightforward it is.</p>
<p>The future of infrastructure is almost certainly more hybrid than it's been recently: managed services where they add genuine value, self-hosted where they're just expensive abstractions. Postgres often falls into the latter category.</p>
<section data-footnotes="true">
<ol>
<li id="user-content-fn-1">
<p>They're either just hosting a vanilla postgres instance that's tied to the deployed hardware config, or doing something opaque with edge deploys and sharding. In the latter case they near guarantee your DB will stay highly available but costs can quickly spiral out of control. <a href="#user-content-fnref-1" data-footnote-backref="" aria-label="Back to reference 1">↩</a></p>
</li>
<li id="user-content-fn-5">
<p>Maybe up to billions at this point. <a href="#user-content-fnref-5" data-footnote-backref="" aria-label="Back to reference 2">↩</a></p>
</li>
<li id="user-content-fn-6">
<p>Even on otherwise absolutely snail speed hardware. <a href="#user-content-fnref-6" data-footnote-backref="" aria-label="Back to reference 3">↩</a></p>
</li>
<li id="user-content-fn-2">
<p>This was Jeff Bezos's favorite phrase during the early AWS days, and it stuck. <a href="#user-content-fnref-2" data-footnote-backref="" aria-label="Back to reference 4">↩</a></p>
</li>
<li id="user-content-fn-3">
<p>Similar options include OVH, Hetzner dedicated instances, or even bare metal from providers like Equinix. <a href="#user-content-fnref-3" data-footnote-backref="" aria-label="Back to reference 5">↩</a></p>
</li>
<li id="user-content-fn-4">
<p>AWS RDS &amp; S3 has had several major outages over the years. The most memorable was the 2017 US-East-1 outage that took down half the internet. <a href="#user-content-fnref-4" data-footnote-backref="" aria-label="Back to reference 6">↩</a></p>
</li>
</ol>
</section></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Immersa: Open-source Web-based 3D Presentation Tool (113 pts)]]></title>
            <link>https://github.com/ertugrulcetin/immersa</link>
            <guid>46336097</guid>
            <pubDate>Sat, 20 Dec 2025 13:38:24 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/ertugrulcetin/immersa">https://github.com/ertugrulcetin/immersa</a>, See on <a href="https://news.ycombinator.com/item?id=46336097">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto"><h2 tabindex="-1" dir="auto">Immersa</h2><a id="user-content-immersa" aria-label="Permalink: Immersa" href="#immersa"></a></p>
<p dir="auto">
  <a target="_blank" rel="noopener noreferrer" href="https://github.com/ertugrulcetin/immersa/blob/master/resources/public/img/logo.png"><img src="https://github.com/ertugrulcetin/immersa/raw/master/resources/public/img/logo.png" alt="Immersa Logo" width="200"></a>
</p>
<p dir="auto"><strong>A Web-based 3D Presentation Tool</strong> - Create stunning 3D presentations with animated transitions between slides.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">🎥 Demo</h2><a id="user-content--demo" aria-label="Permalink: 🎥 Demo" href="#-demo"></a></p>
<p dir="auto">Watch Immersa in action: <a href="https://www.youtube.com/watch?v=1yjtpf59jv0" rel="nofollow">Demo Video</a></p>
<p dir="auto">
  <a target="_blank" rel="noopener noreferrer" href="https://github.com/ertugrulcetin/immersa/blob/master/resources/public/img/app.png"><img src="https://github.com/ertugrulcetin/immersa/raw/master/resources/public/img/app.png" alt="Immersa App Overview" width="800"></a>
</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">What is Immersa?</h2><a id="user-content-what-is-immersa" aria-label="Permalink: What is Immersa?" href="#what-is-immersa"></a></p>
<p dir="auto">Immersa is an innovative presentation tool that brings your presentations into the third dimension. Unlike traditional slide-based tools, Immersa allows you to:</p>
<ul dir="auto">
<li><strong>Load 3D Models</strong>: Import <code>.glb</code> 3D models into your presentation</li>
<li><strong>Add Images</strong>: Place 2D images in 3D space</li>
<li><strong>Create Text</strong>: Add 3D text elements to your slides</li>
<li><strong>Animate Transitions</strong>: When you move, rotate, or scale objects between slides, Immersa automatically creates smooth animated transitions</li>
</ul>
<p dir="auto"><h3 tabindex="-1" dir="auto">How Slide Animation Works</h3><a id="user-content-how-slide-animation-works" aria-label="Permalink: How Slide Animation Works" href="#how-slide-animation-works"></a></p>
<p dir="auto">The magic of Immersa lies in its interpolation system:</p>
<ol dir="auto">
<li><strong>Create Slide 1</strong>: Position your 3D models, images, and text where you want them</li>
<li><strong>Duplicate Slide</strong>: Create a new slide (which copies all objects)</li>
<li><strong>Reposition Objects</strong>: Move, rotate, or scale objects to new positions on the new slide</li>
<li><strong>Present</strong>: When presenting, Immersa smoothly interpolates between positions, creating fluid animations</li>
</ol>
<p dir="auto">This means if a car model is on the left in slide 1 and on the right in slide 2, it will smoothly animate from left to right during the transition!</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Features</h2><a id="user-content-features" aria-label="Permalink: Features" href="#features"></a></p>
<ul dir="auto">
<li><strong>3D Scene Editor</strong>: Full 3D viewport with camera controls</li>
<li><strong>GLB Model Support</strong>: Import any <code>.glb</code> 3D model</li>
<li><strong>Image Support</strong>: Add images (JPG, PNG) to your 3D scene</li>
<li><strong>3D Text</strong>: Create and style 3D text elements</li>
<li><strong>Animated Transitions</strong>: Automatic smooth animations between slides</li>
<li><strong>Presentation Mode</strong>: Full-screen presentation with progress bar</li>
<li><strong>Local Storage</strong>: All data stored locally in your browser (IndexedDB)</li>
<li><strong>Undo/Redo</strong>: Full undo/redo support</li>
<li><strong>Keyboard Shortcuts</strong>: Quick access to common actions</li>
<li><strong>Beautiful UI</strong>: Modern, dark-themed interface</li>
</ul>
<p dir="auto"><h2 tabindex="-1" dir="auto">Getting Started</h2><a id="user-content-getting-started" aria-label="Permalink: Getting Started" href="#getting-started"></a></p>
<p dir="auto"><h3 tabindex="-1" dir="auto">Prerequisites</h3><a id="user-content-prerequisites" aria-label="Permalink: Prerequisites" href="#prerequisites"></a></p>
<ul dir="auto">
<li><strong>Node.js</strong> (v16 or higher recommended)</li>
<li><strong>npm</strong> or <strong>yarn</strong></li>
<li><strong>Java</strong> (JDK 11 or higher) - Required for ClojureScript compilation</li>
</ul>
<p dir="auto"><h3 tabindex="-1" dir="auto">Installation</h3><a id="user-content-installation" aria-label="Permalink: Installation" href="#installation"></a></p>
<ol dir="auto">
<li>
<p dir="auto"><strong>Clone the repository</strong></p>
<div dir="auto" data-snippet-clipboard-copy-content="git clone https://github.com/ertugrulcetin/immersa.git
cd immersa"><pre>git clone https://github.com/ertugrulcetin/immersa.git
<span>cd</span> immersa</pre></div>
</li>
<li>
<p dir="auto"><strong>Install dependencies</strong></p>

</li>
<li>
<p dir="auto"><strong>Start the development server</strong></p>

</li>
<li>
<p dir="auto"><strong>Open in browser</strong>
Navigate to <a href="http://localhost:8280/" rel="nofollow">http://localhost:8280</a></p>
</li>
</ol>
<p dir="auto"><h3 tabindex="-1" dir="auto">Building for Production</h3><a id="user-content-building-for-production" aria-label="Permalink: Building for Production" href="#building-for-production"></a></p>

<p dir="auto">The production build will be in <code>resources/public/js/compiled/</code>.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Usage Guide</h2><a id="user-content-usage-guide" aria-label="Permalink: Usage Guide" href="#usage-guide"></a></p>
<p dir="auto"><h3 tabindex="-1" dir="auto">Editor Interface</h3><a id="user-content-editor-interface" aria-label="Permalink: Editor Interface" href="#editor-interface"></a></p>
<p dir="auto">The editor is divided into several panels:</p>
<ul dir="auto">
<li><strong>Left Panel</strong>: Slide thumbnails - click to navigate, drag to reorder</li>
<li><strong>Center</strong>: 3D viewport - interact with your scene</li>
<li><strong>Right Panel</strong>: Object properties - modify selected objects</li>
<li><strong>Top Bar</strong>: Tools and actions</li>
</ul>
<p dir="auto"><h3 tabindex="-1" dir="auto">Adding Content</h3><a id="user-content-adding-content" aria-label="Permalink: Adding Content" href="#adding-content"></a></p>
<ol dir="auto">
<li><strong>Add 3D Model</strong>: Click "3D Model" → "Add 3D model (.glb)" → Select your file</li>
<li><strong>Add Image</strong>: Click "Image" → "Add image" → Select your file</li>
<li><strong>Add Text</strong>: Click "Text" or press <code>T</code> to add 3D text</li>
</ol>
<p dir="auto"><h3 tabindex="-1" dir="auto">Manipulating Objects</h3><a id="user-content-manipulating-objects" aria-label="Permalink: Manipulating Objects" href="#manipulating-objects"></a></p>
<ul dir="auto">
<li><strong>Select</strong>: Click on any object in the viewport</li>
<li><strong>Move</strong>: Use the position gizmo or input values in the right panel</li>
<li><strong>Rotate</strong>: Use the rotation gizmo or input rotation values</li>
<li><strong>Scale</strong>: Use the scale gizmo or input scale values</li>
</ul>
<p dir="auto"><h3 tabindex="-1" dir="auto">Working with Slides</h3><a id="user-content-working-with-slides" aria-label="Permalink: Working with Slides" href="#working-with-slides"></a></p>
<ul dir="auto">
<li><strong>Add Slide</strong>: Press <code>D</code> or use the "+" button to duplicate current slide</li>
<li><strong>Blank Slide</strong>: Press <code>B</code> to add a blank slide</li>
<li><strong>Delete Slide</strong>: Right-click on slide thumbnail → Delete</li>
<li><strong>Navigate</strong>: Click thumbnails or use arrow keys in present mode</li>
</ul>
<p dir="auto"><h3 tabindex="-1" dir="auto">Keyboard Shortcuts</h3><a id="user-content-keyboard-shortcuts" aria-label="Permalink: Keyboard Shortcuts" href="#keyboard-shortcuts"></a></p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Shortcut</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>T</code></td>
<td>Add text</td>
</tr>
<tr>
<td><code>D</code></td>
<td>Duplicate slide</td>
</tr>
<tr>
<td><code>B</code></td>
<td>Add blank slide</td>
</tr>
<tr>
<td><code>Cmd/Ctrl + Z</code></td>
<td>Undo</td>
</tr>
<tr>
<td><code>Cmd/Ctrl + Shift + Z</code></td>
<td>Redo</td>
</tr>
<tr>
<td><code>Delete/Backspace</code></td>
<td>Delete selected object</td>
</tr>
<tr>
<td><code>Escape</code></td>
<td>Exit present mode</td>
</tr>
<tr>
<td><code>Arrow Keys</code></td>
<td>Navigate slides (in present mode)</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto"><h3 tabindex="-1" dir="auto">Presenting</h3><a id="user-content-presenting" aria-label="Permalink: Presenting" href="#presenting"></a></p>
<ol dir="auto">
<li>Click <strong>"Present"</strong> button to enter presentation mode</li>
<li>Use <strong>arrow keys</strong> or <strong>on-screen controls</strong> to navigate</li>
<li>Press <strong>Escape</strong> or click <strong>"Exit present mode"</strong> to return to editor</li>
</ol>
<p dir="auto"><h3 tabindex="-1" dir="auto">Exporting</h3><a id="user-content-exporting" aria-label="Permalink: Exporting" href="#exporting"></a></p>
<p dir="auto">Click <strong>"Export"</strong> to download your presentation as an <code>.edn</code> file. This file contains all slide data and can be loaded later.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Technical Details</h2><a id="user-content-technical-details" aria-label="Permalink: Technical Details" href="#technical-details"></a></p>
<p dir="auto"><h3 tabindex="-1" dir="auto">Technology Stack</h3><a id="user-content-technology-stack" aria-label="Permalink: Technology Stack" href="#technology-stack"></a></p>
<ul dir="auto">
<li><strong>ClojureScript</strong> - Primary programming language</li>
<li><strong>shadow-cljs</strong> - Build tool</li>
<li><strong>Reagent</strong> - React wrapper for ClojureScript</li>
<li><strong>Re-frame</strong> - State management</li>
<li><strong>Babylon.js</strong> - 3D rendering engine</li>
<li><strong>IndexedDB</strong> - Local data storage</li>
</ul>
<p dir="auto"><h3 tabindex="-1" dir="auto">Project Structure</h3><a id="user-content-project-structure" aria-label="Permalink: Project Structure" href="#project-structure"></a></p>
<div data-snippet-clipboard-copy-content="immersa/
├── src/immersa/
│   ├── common/           # Shared utilities
│   │   ├── local_storage.cljs  # IndexedDB storage
│   │   └── firebase.cljs       # Storage adapter
│   ├── scene/            # 3D scene management
│   │   ├── api/          # Babylon.js wrappers
│   │   ├── core.cljs     # Scene initialization
│   │   └── slide.cljs    # Slide/animation logic
│   ├── ui/               # User interface
│   │   ├── editor/       # Editor components
│   │   └── present/      # Presentation mode
│   └── presentations/    # Default presentations
├── resources/public/     # Static assets
│   ├── img/              # Images
│   ├── model/            # Sample 3D models
│   ├── shader/           # Custom shaders
│   └── index.html        # Entry point
└── shadow-cljs.edn       # Build configuration"><pre><code>immersa/
├── src/immersa/
│   ├── common/           # Shared utilities
│   │   ├── local_storage.cljs  # IndexedDB storage
│   │   └── firebase.cljs       # Storage adapter
│   ├── scene/            # 3D scene management
│   │   ├── api/          # Babylon.js wrappers
│   │   ├── core.cljs     # Scene initialization
│   │   └── slide.cljs    # Slide/animation logic
│   ├── ui/               # User interface
│   │   ├── editor/       # Editor components
│   │   └── present/      # Presentation mode
│   └── presentations/    # Default presentations
├── resources/public/     # Static assets
│   ├── img/              # Images
│   ├── model/            # Sample 3D models
│   ├── shader/           # Custom shaders
│   └── index.html        # Entry point
└── shadow-cljs.edn       # Build configuration
</code></pre></div>
<p dir="auto"><h3 tabindex="-1" dir="auto">Data Storage</h3><a id="user-content-data-storage" aria-label="Permalink: Data Storage" href="#data-storage"></a></p>
<p dir="auto">All data is stored locally in your browser using IndexedDB:</p>
<ul dir="auto">
<li><strong>Presentations</strong>: Slide data and structure</li>
<li><strong>Thumbnails</strong>: Slide preview images</li>
<li><strong>Files</strong>: Uploaded images and 3D models</li>
</ul>
<p dir="auto">Data persists across sessions. Clear browser data to reset.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">License</h2><a id="user-content-license" aria-label="Permalink: License" href="#license"></a></p>
<p dir="auto">This project is licensed under the MIT License - see the <a href="https://github.com/ertugrulcetin/immersa/blob/master/LICENSE">LICENSE</a> file for details.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Acknowledgments</h2><a id="user-content-acknowledgments" aria-label="Permalink: Acknowledgments" href="#acknowledgments"></a></p>
<ul dir="auto">
<li><a href="https://www.babylonjs.com/" rel="nofollow">Babylon.js</a> - Powerful 3D rendering engine</li>
<li><a href="https://reagent-project.github.io/" rel="nofollow">Reagent</a> - Minimalistic React interface for ClojureScript</li>
<li><a href="https://day8.github.io/re-frame/" rel="nofollow">Re-frame</a> - A pattern for writing SPAs in ClojureScript</li>
<li><a href="https://www.radix-ui.com/" rel="nofollow">Radix UI</a> - Unstyled, accessible components</li>
<li><a href="https://phosphoricons.com/" rel="nofollow">Phosphor Icons</a> - Beautiful icon set</li>
</ul>
<hr>
<p dir="auto">
  Made with ❤️ by <a href="https://github.com/ertugrulcetin">Ertuğrul Çetin</a>
</p>
</article></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[What Does a Database for SSDs Look Like? (127 pts)]]></title>
            <link>https://brooker.co.za/blog/2025/12/15/database-for-ssd.html</link>
            <guid>46334990</guid>
            <pubDate>Sat, 20 Dec 2025 10:13:33 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://brooker.co.za/blog/2025/12/15/database-for-ssd.html">https://brooker.co.za/blog/2025/12/15/database-for-ssd.html</a>, See on <a href="https://news.ycombinator.com/item?id=46334990">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="post">






<p>Maybe not what you think.</p>

<p>Over on X, <a href="https://x.com/BenjDicken/status/2000197741478384029">Ben Dicken asked</a>:</p>

<blockquote>
  <p>What does a relational database designed <em>specifically</em> for local SSDs look like?
Postgres, MySQL, SQLite and many others were invented in the 90s and 00s, the era of spinning disks. A local NVMe SSD has ~1000x improvement in both throughput and latency.
Design decisions like write-ahead logs, large page sizes, and buffering table writes in bulk were built around disks where I/O was SLOW, and where sequential I/O was order(s)-of-magnitude faster than random.
If we had to throw these databases away and begin from scratch in 2025, what would change and what would remain?</p>
</blockquote>

<p>How might we tackle this question quantitatively for the modern transaction-orientated database?</p>

<p>But first, the bigger picture. It’s not only SSDs that have come along since databases like Postgres were first designed. We also have the cloud, with deployments to excellent datacenter infrastructure, including multiple independent datacenters with great network connectivity between them, available to all. Datacenter networks offer 1000x (or more) increased throughput, along with latency in the microseconds. Servers with hundreds of cores and thousands of gigabytes of RAM are mainstream.</p>

<p>Applications have changed too. Companies are global, businesses are 24/7. Down time is expensive, and that expense can be measured. The security and compliance environment is much more demanding. Builders want to deploy in seconds, not days.</p>

<p><strong>Approach One: The Five Minute Rule</strong></p>

<p>Perhaps my single favorite systems paper, <a href="https://dsf.berkeley.edu/cs286/papers/fiveminute-tr1986.pdf">The 5 Minute Rule…</a> by Jim Gray and Franco Putzolu gives us a very simple way to answer one of the most important questions in systems: how big should caches be? The five minute rule is that, back in 1986, if you expected to read a page again within five minutes you should keep in in RAM. If not, you should keep it on disk. The basic logic is that you look at the page that’s least likely to be re-used. If it’s cheaper to keep around until it’s next expected re-use, then you should keep more. If it’s cheaper to reload from storage than keep around, then you should keep less<sup><a href="#foot1">1</a></sup>. Let’s update the numbers for 2025, assuming that pages are around 32kB<sup><a href="#foot2">2</a></sup> (this becomes important later).</p>

<p>The EC2 <code>i8g.48xlarge</code> <a href="https://docs.aws.amazon.com/ec2/latest/instancetypes/so.html">delivers about 1.8 million</a> read iops of this size, at a price of around $0.004576 per second, or \(10^{-9}\) dollars per transfer (assuming we’re allocating about 40% of the instance price to storage). About one dollar per billion reads. It also has enough RAM for about 50 million pages of this size, costing around \(3 \times 10^{-11}\) dollars to storage a page for one second.</p>

<p>So, on this instance type, we should size our RAM cache to store pages for about 30 seconds. Not too different from Gray and Putzolu’s result 40 years ago!</p>

<p>That’s answer number one: the database should have a cache sized so that the hot set contains pages expected to be accessed in the next 30 seconds, for optimal cost. For optimal latency, however, the cache may want to be considerably bigger.</p>

<p><strong>Approach Two: The Throughput/IOPS Breakeven Point</strong></p>

<p>The next question is what size accesses we want to send to our storage devices to take best advantage of their performance. In the days of spinning media, the answer to this was surprisingly big: a 100MB/s disk could generally do around 100 seeks a second, so if your transfers were less than around 1MB you were walking away from throughput. Give or take a factor of 2. What does it look like for modern SSDs?</p>

<p>SSDs are much faster on both throughput and iops. They’re less sensitive than spinning drives to workload patterns, but read/write ratios and the fullness of the drives still matter. Absent benchmarking on the actual hardware with the real workload, my <a href="https://brooker.co.za/blog/2022/12/15/thumb.html">rule of thumb</a> is that SSDs are throughput limited for transfers bigger than 32kB, and iops limited for transfers smaller than 32kB.</p>

<p>Making transfers bigger than 32kB doesn’t help throughput much, reduces IOPS, and probably makes the cache less effective because of <a href="https://en.wikipedia.org/wiki/False_sharing">false sharing</a> and related effects. This is especially important for workloads with poor <a href="https://brooker.co.za/blog/2025/10/22/uuidv7.html">spatial locality</a>.</p>

<p>So that’s answer number two: we want our transfers to disk not to be much smaller than 32kB on average, or we’re walking away from throughput.</p>

<p><strong>Approach Three: Durability and Replication</strong></p>

<p>Building reads on local SSDs is great: tons of throughput, tons of iops. Writes on local SSDs, on the other hand, have the distinct problem of only being durable on the local box, which is unacceptable for most workloads. Modern hardware is very reliable, but thinking through the business risks of losing data on failover isn’t very fun at all, so let’s assume that our modern database is going to replicate off-box, making at least one more synchronous copy. Ideally in a different availability zone (AZ).</p>

<p>That <code>i8g.48xlarge</code> we were using for our comparison earlier has 100Gb/s (or around 12GB/s) of network bandwidth. That puts a cap on how much write throughput we can have for a single-leader database. Cross-AZ latency in EC2 varies from a couple hundred microseconds to a millisecond or two, which puts a minimum on our commit latency.</p>

<p>That gives us answer number three: we want to incur cross-AZ latency only at commit time, and not during writes.</p>

<p>Which is where we run into one of my favorite topics: isolation. The <em>I</em> in <em>ACID</em>. A modern database design will avoid read-time coordination using multiversioning, but to offer isolation stronger than <code>READ COMMITTED</code> will need to coordinate either on each write or at commit time. It can do that like, say, Aurora Postgres does, having a single leader at a time running in a single AZ. This means great latency for clients in that zone, and higher latency for clients in different AZs. Given that most applications are hosted in multiple AZs, this can add up for latency-sensitive applications which makes a lot of round trips to the database. The alternative approach is the one Aurora DSQL takes, doing the cross-AZ round trip only at <code>COMMIT</code> time, saving round-trips.</p>

<p>Here’s me talking about the shape of that trade-off at re:Invent this year:</p>

<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/SNnUpYvBfow?si=hRTXS5kyHtyXW7zB&amp;start=3260" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen=""></iframe>

<p>There’s no clear answer here, because there are real trade-offs between the two approaches. But do make sure to ask your database vendor whether those impressive latency benchmarks are running where you application actually runs. In the spirit of the original question, though, the incredible bandwidth and latency availability in modern datacenter networks is as transformative as SSDs in database designs. Or should be.</p>

<p>While we’re incurring the latency cost of synchronous replication, we may as well get <a href="https://brooker.co.za/blog/2025/11/18/consistency.html">strongly consistent</a> scale-out reads for free. In DSQL, we do this using high-quality hardware clocks that <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/set-time.html">you can use too</a>. Another nice win from modern hardware. There are other approaches too.</p>

<p>That’s answer number four for me: The modern database uses high-quality clocks and knowledge of actual application architectures to optimize for real-world performance (like latency in multiple availability zones or regions) without compromising on strong consistency.</p>

<p><strong>Approach Four: What about that WAL?</strong></p>

<blockquote>
  <p>Design decisions like write-ahead logs, large page sizes, and buffering table writes in bulk were built around disks where I/O was SLOW, and where sequential I/O was order(s)-of-magnitude faster than random.</p>
</blockquote>

<p>WALs, and related low-level logging details, are critical for database systems that care deeply about durability on a single system. But the modern database isn’t like that: it doesn’t depend on commit-to-disk on a single system for its durability story. Commit-to-disk on a single system is both unnecessary (because we can replicate across storage on multiple systems) and inadequate (because we don’t want to lose writes even if a single system fails).</p>

<p>That’s answer number five: the modern database commits transactions to a distributed log, which provides multi-machine multi-AZ durability, and might provide other services like atomicity. Recovery is a replay from the distributed log, on any one of a number of peer replicas.</p>

<p><strong>What About Data Structures?</strong></p>

<p>B-Trees versus LSM-trees vs B-Tree variants versus LSM variants versus other data structures are trade-offs that have a lot to do with access patterns and workload patterns. Picking a winner would be a whole series of blog posts, so I’m going to chicken out and say <em>its complicated</em>.</p>

<p><strong>Conclusion</strong></p>

<blockquote>
  <p>If we had to throw these databases away and begin from scratch in 2025, what would change and what would remain?</p>
</blockquote>

<p>I’d keep the relational model, atomicity, isolation (but would probably pick <code>SNAPSHOT</code> as a default), strong consistency, SQL, interactive transactions, and the other core design decisions of relational databases. But I’d move durability, read and write scale, and high availability into being distributed rather than single system concerns. I think that helps with performance and cost, while making these properties easier to achieve. I’d mostly toss out local durability and recovery, and all the huge history of optimizations and data structures around that<sup><a href="#foot3">3</a></sup>, in favor of getting better properties in the distributed setting. I’d pay more attention to internal strong isolation (in the security sense) between clients and workloads. I’d size caches for a <a href="https://denninginstitute.com/pjd/PUBS/WSModel_1968.pdf">working set</a> of between 30 seconds and 5 minutes of accesses. I’d optimize for read transfers around that 32kB sweet spot from local SSD, and the around 8kB sweet spot for networks.</p>

<p>Probably more stuff too, but this is long enough as-is.</p>

<p>Other topics worth covering include avoiding copies on IO, co-design with virtualization (e.g. <a href="https://www.amazon.science/publications/resource-management-in-aurora-serverless">see our Aurora Serverless paper</a>), trade-offs of batching, how the relative performance of different isolation levels changes, what promises to give clients, encryption and authorization of data at rest and in motion, dealing with very hot single items, new workloads like vector, verifiable replication journals, handing off changes to analytics systems, access control, multi-tenancy, forking and merging, and even locales.</p>

<p><em>Footnotes</em></p>

<ol>
  <li><a name="foot1"></a> The reasoning is slightly smarter, thinking about the <em>marginal</em> page and <em>marginal</em> cost of memory, but this simplification works for our purposes here. The <em>marginal</em> cost of memory is particularly interesting in a provisioned system, because it varies between zero (you’ve paid for it already) and huge (you need a bigger instance size). One of the really nice things about serverless (like DSQL) and dynamic scaling (like Aurora Serverless) is that it makes the marginal cost constant, greatly simplifying the task of reasoning about cache size.</li>
  <li><a name="foot2"></a> Yes, I know that pages are typically 4kB or 2MB, but bear with me here.</li>
  <li><a name="foot3"></a> Sorry <a href="https://web.stanford.edu/class/cs345d-01/rl/aries.pdf">ARIES</a>.</li>
</ol>

</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Reflections on AI at the End of 2025 (175 pts)]]></title>
            <link>https://antirez.com/news/157</link>
            <guid>46334819</guid>
            <pubDate>Sat, 20 Dec 2025 09:38:51 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://antirez.com/news/157">https://antirez.com/news/157</a>, See on <a href="https://news.ycombinator.com/item?id=46334819">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="content">
<section id="newslist"><article data-news-id="157"></article></section><topcomment><article data-comment-id="157-" id="157-"><span><span><a href="https://antirez.com/user/antirez">antirez</a></span> 7 hours ago. 24344 views.  </span><pre>* For years, despite functional evidence and scientific hints accumulating, certain AI researchers continued to claim LLMs were stochastic parrots: probabilistic machines that would: 1. NOT have any representation about the meaning of the prompt. 2. NOT have any representation about what they were going to say. In 2025 finally almost everybody stopped saying so.

* Chain of thought is now a fundamental way to improve LLM output. But, what is CoT? Why it improves output? I believe it is two things: 1. Sampling in the model representations (that is, a form of internal search). After information and concepts relevant to the prompt topic is in the context window, the model can better reply. 2. But if you mix this to reinforcement learning, the model also learns to put one token after the other (each token will change the model state) in order to converge to some useful reply.

* The idea that scaling is limited to the number of tokens we have, is no longer true, because of reinforcement learning with verifiable rewards. We are still not at AlphaGo move 37 moment, but is this really impossible in the future? There are certain tasks, like improving a given program for speed, for instance, where in theory the model can continue to make progress with a very clear reward signal for a very long time. I believe improvements to RL applied to LLMs will be the next big thing in AI.

* Programmers resistance to AI assisted programming has lowered considerably. Even if LLMs make mistakes, the ability of LLMs to deliver useful code and hints improved to the point most skeptics started to use LLMs anyway: now the return on the investment is acceptable for many more folks. The programming world is still split among who uses LLMs as colleagues (for instance, all my interaction is via the web interface of Gemini, Claude, …), and who uses LLMs as independent coding agents.

* A few well known AI scientists believe that what happened with Transformers can happen again, and better, following different paths, and started to create teams, companies to investigate alternatives to Transformers and models with explicit symbolic representations or world models. I believe that LLMs are differentiable machine trained on a space able to approximate discrete reasoning steps, and it is not impossible they get us to AGI even without fundamentally new paradigms appearing. It is likely that AGI can be reached independently with many radically different architectures.

* There is who says chain of thought changed LLMs nature fundamentally, and this is why they, in the past, claimed LLMs were very limited, and now are changing their mind. They say, because of CoT, LLMs are now a different thing. They are lying. It is still the same architecture with the same next token target, and the CoT is created exactly like that, token after token.

* The ARC test today looks a lot less insurmountable than initially thought: there are small models optimized for the task at hand that perform decently well on ARC-AGI-1, and very large LLMs with extensive CoT achieving impressive results on ARC-AGI-2 with an architecture that, according to many folks, would not deliver such results. ARC, in some way, transitioned from being the anti-LLM test to a validation of LLMs.

* The fundamental challenge in AI for the next 20 years is avoiding extinction.</pre></article></topcomment>


<p><a href="https://disqus.com/">blog comments powered by <span>Disqus</span></a>

</p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Airbus to migrate critical apps to a sovereign Euro cloud (415 pts)]]></title>
            <link>https://www.theregister.com/2025/12/19/airbus_sovereign_cloud/</link>
            <guid>46334533</guid>
            <pubDate>Sat, 20 Dec 2025 08:36:52 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.theregister.com/2025/12/19/airbus_sovereign_cloud/">https://www.theregister.com/2025/12/19/airbus_sovereign_cloud/</a>, See on <a href="https://news.ycombinator.com/item?id=46334533">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="body">
<p><span>Exclusive</span> Airbus is preparing to tender a major contract to migrate mission-critical workloads to a digitally sovereign European cloud – but estimates only an 80/20 chance of finding a suitable provider.</p>
<div><p><img src="https://regmedia.co.uk/2016/11/25/airbus_a350_1000.jpg?x=174&amp;amp;y=115&amp;amp;crop=1" width="174" height="115" alt="Airbus A350-1000"></p><h2 title="Google Workspace switch drags on amid Excel dependencies, compliance requirements, and compatibility issues">Seven years later, Airbus is still trying to kick its Microsoft habit</h2>
<p><a href="https://www.theregister.com/2025/11/26/microsoft_airbus_migration/"><span>READ MORE</span></a></p></div>
<p>The aerospace manufacturer, which has already consolidated its datacenter estate and uses services like Google Workspace, now wants to move key on-premises applications including ERP, manufacturing execution systems, CRM, and product lifecycle management (aircraft designs) to the cloud.</p>
<p>"I need a sovereign cloud because part of the information is extremely sensitive from a national and European perspective," Catherine Jestin, Airbus's executive vice president of digital, told <em>The Register</em>. "We want to ensure this information remains under European control."</p>
<p>The driver is access to new software. Vendors like <a target="_blank" href="https://www.theregister.com/2023/08/03/sap_ceo_push_for_cloudonly/">SAP are developing innovations exclusively in the cloud</a>, pushing customers toward platforms like S/4HANA.</p>
<p>The request for proposals launches in early January, with a decision expected before summer. The contract – understood to be worth more than €50 million – will be long term (up to ten years), with price predictability over the period.</p>

    

<p>Digital sovereignty has become more critical since Donald Trump's return to the White House in January. His policies created <a target="_blank" href="https://www.theregister.com/2025/04/30/microsoft_getting_nervous_about_europes/">volatility in trade and geopolitical relations</a>, prompting <a target="_blank" href="https://www.theregister.com/2025/03/17/european_tech_sovereign_fund/">European customers to reduce reliance on US providers</a>.</p>

        


        

<p>While <a target="_blank" href="https://www.theregister.com/2025/11/07/microsoft_announces_strengthening_of_sovereignty/">Microsoft</a>, <a target="_blank" href="https://www.theregister.com/2025/06/03/aws_european_sovereign_cloud/">AWS</a>, and <a target="_blank" href="https://www.theregister.com/2025/05/21/google_sovereign_cloud_updates/">Google</a> have created solutions to address these concerns, fears persist about the US CLOUD Act, which allows authorities to request data held by American corporations in overseas datacenters.</p>
<ul>

<li><a href="https://www.theregister.com/2025/11/27/canada_court_ovh/">Canadian data order risks blowing a hole in EU sovereignty</a></li>

<li><a href="https://www.theregister.com/2025/11/24/nato_google_cloud/">NATO taps Google for air-gapped sovereign cloud</a></li>

<li><a href="https://www.theregister.com/2025/11/19/microsoft_sap_cloud_crisis/">Microsoft-SAP pact aims to keep Euro cloud running in a crisis</a></li>

<li><a href="https://www.theregister.com/2025/11/10/three_most_important_factors_in/">Big Tech's control freak era is breaking itself apart</a></li>
</ul>
<p>Microsoft admitted in French court last July it <a target="_blank" href="https://www.theregister.com/2025/07/25/microsoft_admits_it_cannot_guarantee/">couldn't guarantee data sovereignty</a> under this legislation.</p>
<p>Jestin is waiting for European regulators to clarify whether Airbus would truly be "immune to extraterritorial laws" – and whether services could be interrupted.</p>
<div><p><img src="https://regmedia.co.uk/2020/12/21/shutterstock_cloud_migration.jpg?x=174&amp;amp;y=115&amp;amp;crop=1" width="174" height="115" alt="Cloud migration"></p><h2 title="Aerospace giant faces 'massive work' to move legacy ERP systems to S/4HANA as support deadline looms">Airbus exec: Most CIOs in Europe will not finish SAP ECC6 migration by 2030</h2>
<p><a href="https://www.theregister.com/2025/12/11/airbus_exec_sap/"><span>READ MORE</span></a></p></div>
<p>The concern isn't theoretical. Chief Prosecutor of the International Criminal Court (ICC) Karim Khan reportedly <a target="_blank" href="https://www.theregister.com/2025/10/31/international_criminal_court_ditches_office/">lost access to his Microsoft email</a> after Trump sanctioned him for criticizing Israeli PM Benjamin Netanyahu, though Microsoft denies suspending ICC services.</p>
<p>Beyond US complications, Jestin questions whether European cloud providers have sufficient scale. "If you asked me today if we'll find a solution, I'd say 80/20."</p>
<p>This puts pressure on European providers to collaborate, though whether they can navigate such complexities in Airbus's timeframe remains uncertain. ®</p>                                
                    </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[A train-sized tunnel is now carrying electricity under South London (112 pts)]]></title>
            <link>https://www.ianvisits.co.uk/articles/a-train-sized-tunnel-is-now-carrying-electricity-under-south-london-86221/</link>
            <guid>46334483</guid>
            <pubDate>Sat, 20 Dec 2025 08:26:50 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.ianvisits.co.uk/articles/a-train-sized-tunnel-is-now-carrying-electricity-under-south-london-86221/">https://www.ianvisits.co.uk/articles/a-train-sized-tunnel-is-now-carrying-electricity-under-south-london-86221/</a>, See on <a href="https://news.ycombinator.com/item?id=46334483">Hacker News</a></p>
<div id="readability-page-1" class="page"><article id="post-86221" itemscope="" itemtype="https://schema.org/CreativeWork">

	
	<div itemprop="text">
	<p>Electricity has started flowing through a deep-level tube train sized tunnel running through South London.</p>
<figure id="attachment_86223" aria-describedby="caption-attachment-86223"><a href="https://8400e186.delivery.rocketcdn.me/articles/wp-content/uploads/sites/2/2025/12/National-Grid-London-Power-Tunnels-2-map.jpg"><img fetchpriority="high" decoding="async" src="https://8400e186.delivery.rocketcdn.me/articles/wp-content/uploads/sites/2/2025/12/National-Grid-London-Power-Tunnels-2-map-1024x644.jpg" alt="" width="605" height="380" srcset="https://8400e186.delivery.rocketcdn.me/articles/wp-content/uploads/sites/2/2025/12/National-Grid-London-Power-Tunnels-2-map-1024x644.jpg 1024w, https://8400e186.delivery.rocketcdn.me/articles/wp-content/uploads/sites/2/2025/12/National-Grid-London-Power-Tunnels-2-map-300x189.jpg 300w, https://8400e186.delivery.rocketcdn.me/articles/wp-content/uploads/sites/2/2025/12/National-Grid-London-Power-Tunnels-2-map-768x483.jpg 768w, https://8400e186.delivery.rocketcdn.me/articles/wp-content/uploads/sites/2/2025/12/National-Grid-London-Power-Tunnels-2-map-900x566.jpg 900w, https://8400e186.delivery.rocketcdn.me/articles/wp-content/uploads/sites/2/2025/12/National-Grid-London-Power-Tunnels-2-map.jpg 1800w" sizes="(max-width: 605px) 100vw, 605px"></a><figcaption id="caption-attachment-86223">New power cables map (c) National Rail</figcaption></figure>
<p>The first of two new circuits that connect National Grid’s New Cross substation in Southwark with its Hurst substation in Bexley is now live, running for 18km beneath South London through tunnels up to 50 metres deep.</p>
<p>This new link replaces one of two buried cables that have served the capital since the 1960s, with the other to be replaced when the second New Cross-Hurst circuit goes live in the new year.</p>
<p>While the old cables were buried in shallower trenches in the streets, the LPT2 network carries power in three metre wide tunnels deep beneath the road network.</p>
<p>In total, the £1 billion London Power Tunnels 2 (LPT2) project, which began in 2019, spans 32.5km across seven South London boroughs from Wimbledon to Hurst.</p>
<p>Construction of the tunnels began in March 2020, and tunnelling was carried out in three sections between existing National Grid substations:</p>
<ul>
<li aria-level="1">Wimbledon-New Cross (12km)</li>
<li aria-level="1">New Cross-Hurst (18km)</li>
<li aria-level="1">Hurst-Crayford (2.5km)</li>
</ul>
<figure id="attachment_86222" aria-describedby="caption-attachment-86222"><a href="https://8400e186.delivery.rocketcdn.me/articles/wp-content/uploads/sites/2/2025/12/National-Grid-London-Power-Tunnels-2_cropped.jpg"><img decoding="async" src="https://8400e186.delivery.rocketcdn.me/articles/wp-content/uploads/sites/2/2025/12/National-Grid-London-Power-Tunnels-2_cropped-1024x569.jpg" alt="" width="605" height="336" srcset="https://8400e186.delivery.rocketcdn.me/articles/wp-content/uploads/sites/2/2025/12/National-Grid-London-Power-Tunnels-2_cropped-1024x569.jpg 1024w, https://8400e186.delivery.rocketcdn.me/articles/wp-content/uploads/sites/2/2025/12/National-Grid-London-Power-Tunnels-2_cropped-300x167.jpg 300w, https://8400e186.delivery.rocketcdn.me/articles/wp-content/uploads/sites/2/2025/12/National-Grid-London-Power-Tunnels-2_cropped-768x427.jpg 768w, https://8400e186.delivery.rocketcdn.me/articles/wp-content/uploads/sites/2/2025/12/National-Grid-London-Power-Tunnels-2_cropped-900x500.jpg 900w, https://8400e186.delivery.rocketcdn.me/articles/wp-content/uploads/sites/2/2025/12/National-Grid-London-Power-Tunnels-2_cropped.jpg 1800w" sizes="(max-width: 605px) 100vw, 605px" data-old-src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20605%20336'%3E%3C/svg%3E" data-lazy-srcset="https://8400e186.delivery.rocketcdn.me/articles/wp-content/uploads/sites/2/2025/12/National-Grid-London-Power-Tunnels-2_cropped-1024x569.jpg 1024w, https://8400e186.delivery.rocketcdn.me/articles/wp-content/uploads/sites/2/2025/12/National-Grid-London-Power-Tunnels-2_cropped-300x167.jpg 300w, https://8400e186.delivery.rocketcdn.me/articles/wp-content/uploads/sites/2/2025/12/National-Grid-London-Power-Tunnels-2_cropped-768x427.jpg 768w, https://8400e186.delivery.rocketcdn.me/articles/wp-content/uploads/sites/2/2025/12/National-Grid-London-Power-Tunnels-2_cropped-900x500.jpg 900w, https://8400e186.delivery.rocketcdn.me/articles/wp-content/uploads/sites/2/2025/12/National-Grid-London-Power-Tunnels-2_cropped.jpg 1800w" data-lazy-src="https://8400e186.delivery.rocketcdn.me/articles/wp-content/uploads/sites/2/2025/12/National-Grid-London-Power-Tunnels-2_cropped-1024x569.jpg"></a><figcaption id="caption-attachment-86222">National Grid – London Power Tunnels 2</figcaption></figure>
<p>The current London Power Tunnels project through South London follows the completion in 2018 of the first phase – a seven-year, £1 billion project to construct 32km of tunnels and two new substations to rewire the network in North London.</p>
</div><!-- end of .post-entry -->

	</article></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Skills Officially Comes to Codex (210 pts)]]></title>
            <link>https://developers.openai.com/codex/skills/</link>
            <guid>46334424</guid>
            <pubDate>Sat, 20 Dec 2025 08:09:17 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://developers.openai.com/codex/skills/">https://developers.openai.com/codex/skills/</a>, See on <a href="https://news.ycombinator.com/item?id=46334424">Hacker News</a></p>
<div id="readability-page-1" class="page"><article id="mainContent"> <p>Agent Skills let you extend Codex with task-specific capabilities. A skill packages instructions, resources, and optional scripts so Codex can perform a specific workflow reliably. You can share skills across teams or the community, and they build on the <a href="http://agentskills.io/">open Agent Skills standard</a>.</p>
<p>Skills are available in both the Codex CLI and IDE extensions.</p>

<p>A skill captures a capability expressed through markdown instructions inside a <code>SKILL.md</code> file accompanied by optional scripts, resources, and assets that Codex uses to perform a specific task.</p>
<div data-astro-cid-cy6iooep="" data-file-tree=""> <ul role="tree" data-astro-cid-cy6iooep=""> <li data-depth="0" data-last="true" data-astro-cid-cy6iooep=""> <details open="" aria-label="my-skill/ directory" data-astro-cid-cy6iooep=""> <summary data-astro-cid-cy6iooep=""> <span data-astro-cid-cy6iooep=""> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" data-astro-cid-cy6iooep="true"><path fill-rule="evenodd" d="M8.293 4.293a1 1 0 0 1 1.414 0l7 7a1 1 0 0 1 0 1.414l-7 7a1 1 0 0 1-1.414-1.414L14.586 12 8.293 5.707a1 1 0 0 1 0-1.414Z" clip-rule="evenodd"></path></svg> </span> <span data-astro-cid-cy6iooep=""> <span data-astro-cid-cy6iooep=""> my-skill/ </span> </span>  </summary> <div data-astro-cid-cy6iooep=""> <ul role="group" data-astro-cid-cy6iooep=""> <li data-depth="1" data-astro-cid-cy6iooep=""> <p><span data-astro-cid-cy6iooep=""> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" data-astro-cid-cy6iooep="true"><path fill-rule="evenodd" d="M8 3.51v12.222c1.1.372 2.146 1.062 3 1.941V7.211c-.31-1.455-1.524-2.948-3-3.7Zm5 4.728v11.578c.767-.38 1.51-.68 2.287-.908 1.27-.372 2.585-.533 4.187-.558V6.514c-2.68.088-4.281.55-6.474 1.724ZM9.757 19.272c-.663-.745-1.513-1.348-2.406-1.648A1.987 1.987 0 0 1 6 15.738v-9.08a11.37 11.37 0 0 0-1.535-.143h-.004l-.002.001-.004.002V18.35c2.105.033 3.7.303 5.3.922ZM6 4.635V3.512c0-1.411 1.495-2.493 2.866-1.805 1.742.873 3.269 2.533 3.901 4.402 2.119-1.046 3.93-1.506 6.658-1.594 1.142-.037 2.05.895 2.05 1.999v11.837a1.996 1.996 0 0 1-1.96 1.999c-1.485.022-2.614.17-3.666.477-1.055.31-2.079.792-3.342 1.535a1 1 0 0 1-1.014 0c-2.465-1.45-4.169-1.968-7.078-2.012a1.995 1.995 0 0 1-1.959-1.998V6.515c0-1.147.958-2.036 2.077-1.998.601.02 1.045.06 1.467.118Z" clip-rule="evenodd"></path></svg> </span> <span data-astro-cid-cy6iooep=""> <span data-astro-cid-cy6iooep=""> SKILL.md </span> </span> <span data-astro-cid-cy6iooep=""> Required: instructions + metadata </span> </p> </li><li data-depth="1" data-astro-cid-cy6iooep=""> <p><span data-astro-cid-cy6iooep=""> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" data-astro-cid-cy6iooep="true"><path fill-rule="evenodd" d="M2 6a3 3 0 0 1 3-3h4.172a3 3 0 0 1 2.12.879l.83.828a1 1 0 0 0 .706.293H19a3 3 0 0 1 3 3v10a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V6Zm3-1a1 1 0 0 0-1 1v4h16V8a1 1 0 0 0-1-1h-6.172a3 3 0 0 1-2.12-.879l-.83-.828A1 1 0 0 0 9.173 5H5Zm15 7H4v6a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-6Z" clip-rule="evenodd"></path></svg> </span> <span data-astro-cid-cy6iooep=""> <span data-astro-cid-cy6iooep=""> scripts/ </span> </span> <span data-astro-cid-cy6iooep=""> Optional: executable code </span> </p> </li><li data-depth="1" data-astro-cid-cy6iooep=""> <p><span data-astro-cid-cy6iooep=""> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" data-astro-cid-cy6iooep="true"><path fill-rule="evenodd" d="M2 6a3 3 0 0 1 3-3h4.172a3 3 0 0 1 2.12.879l.83.828a1 1 0 0 0 .706.293H19a3 3 0 0 1 3 3v10a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V6Zm3-1a1 1 0 0 0-1 1v4h16V8a1 1 0 0 0-1-1h-6.172a3 3 0 0 1-2.12-.879l-.83-.828A1 1 0 0 0 9.173 5H5Zm15 7H4v6a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-6Z" clip-rule="evenodd"></path></svg> </span> <span data-astro-cid-cy6iooep=""> <span data-astro-cid-cy6iooep=""> references/ </span> </span> <span data-astro-cid-cy6iooep=""> Optional: documentation </span> </p> </li><li data-depth="1" data-last="true" data-astro-cid-cy6iooep=""> <p><span data-astro-cid-cy6iooep=""> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" data-astro-cid-cy6iooep="true"><path fill-rule="evenodd" d="M2 6a3 3 0 0 1 3-3h4.172a3 3 0 0 1 2.12.879l.83.828a1 1 0 0 0 .706.293H19a3 3 0 0 1 3 3v10a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V6Zm3-1a1 1 0 0 0-1 1v4h16V8a1 1 0 0 0-1-1h-6.172a3 3 0 0 1-2.12-.879l-.83-.828A1 1 0 0 0 9.173 5H5Zm15 7H4v6a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-6Z" clip-rule="evenodd"></path></svg> </span> <span data-astro-cid-cy6iooep=""> <span data-astro-cid-cy6iooep=""> assets/ </span> </span> <span data-astro-cid-cy6iooep=""> Optional: templates, resources </span> </p> </li> </ul> </div> </details> </li> </ul> </div> 
<p>Skills use <strong>progressive disclosure</strong> to manage context efficiently. At startup, Codex loads the name and description of each available skill. Codex can then activate and use a skill in two ways:</p>
<ol>
<li><strong>Explicit invocation:</strong> You can include skills directly as part of your prompt. To select one, run the <code>/skills</code> slash command, or start typing <code>$</code> to mention a skill. (Codex web and iOS don’t support explicit invocation yet, but you can still prompt Codex to use any skill checked into the repo.)</li>
</ol>

<ol start="2">
<li><strong>Implicit invocation:</strong> Codex can decide to use an available skill when the user’s task matches the skill’s description.</li>
</ol>
<p>In either method, Codex reads the full instructions of the invoked skills and any extra references checked into the skill.</p>

<p>Codex loads skills from these locations. A skill’s location defines its scope.</p>
<p>When Codex loads available skills from these locations, it overwrites skills with the same name from a scope of lower precedence. The list below shows skill scopes and locations in order of precedence (high to low):</p>








































<div><table><thead><tr><th>Skill Scope</th><th>Location</th><th>Suggested Use</th></tr></thead><tbody><tr><td><code>REPO</code></td><td><code>$CWD/.codex/skills</code> <br> Current Working Directory: where you launch Codex.</td><td>If in a repository or code environment, teams can check in skills most relevant to a working folder here. For instance, skills only relevant to a microservice or a code module.</td></tr><tr><td><code>REPO</code></td><td><code>$CWD/../.codex/skills</code> <br> A folder above CWD when you launch Codex inside a git repository.</td><td>If in a repository with nested folders, organizations can check in skills most relevant to a shared area in a parent folder.</td></tr><tr><td><code>REPO</code></td><td><code>$REPO_ROOT/.codex/skills</code> <br> The top-most root folder when you launch Codex inside a git repository.</td><td>If in a repository with nested folders, organizations can check in skills that are relevant to everyone using the repository. These serve as root skills that any subfolder in the repository can overwrite.</td></tr><tr><td><code>USER</code></td><td><code>$CODEX_HOME/skills</code> <br> <small>(Mac/Linux default: <code>~/.codex/skills</code>)</small> <br> Any skills checked into the user’s personal folder.</td><td>Use to curate skills relevant to a user that apply to any repository the user may work in.</td></tr><tr><td><code>ADMIN</code></td><td><code>/etc/codex/skills</code> <br> Any skills checked into the machine or container in a shared, system location.</td><td>Use for SDK scripts, automation, and for checking in default admin skills available to each user on the machine.</td></tr><tr><td><code>SYSTEM</code></td><td>Bundled with Codex.</td><td>Useful skills relevant to a broad audience such as the skill-creator and plan skills. Available to everyone when they start Codex and can be overwritten by any layer above.</td></tr></tbody></table></div>

<p>To create a new skill, use the built-in <code>$skill-creator</code> skill inside Codex. Describe what you want your skill to do, and Codex will start bootstrapping your skill. If you combine it with the <code>$plan</code> skill, Codex will first create a plan for your skill.</p>
<p>You can also create a skill manually by creating a folder with a <code>SKILL.md</code> file inside a valid skill location. A <code>SKILL.md</code> must contain a <code>name</code> and <code>description</code> to help Codex select the skill:</p>
<pre tabindex="0" data-language="md"><code><span><span>---</span></span>
<span><span>name: skill-name</span></span>
<span><span>description: Description that helps Codex select the skill</span></span>
<span><span>metadata:</span></span>
<span><span>  short-description: Optional user-facing description</span></span>
<span><span>---</span></span>
<span></span>
<span><span>Skill instructions for the Codex agent to follow when using this skill.</span></span></code></pre>
<p>Codex skills build on the <a href="https://agentskills.io/specification">Agent Skills specification</a>. Check out the documentation to learn more.</p>

<p>To expand on the list of built-in skills, you can download skills from a <a href="https://github.com/openai/skills">curated set of skills on GitHub</a> using the <code>$skill-installer</code> skill:</p>
<pre tabindex="0" data-language="plaintext"><code><span><span>$skill-installer linear</span></span></code></pre>
<p>You can also prompt the installer to download skills from other repositories.</p>

<h3 id="plan-a-new-feature"><span>Plan a new feature</span></h3>
<p>Codex ships with a built-in <code>$plan</code> skill that’s great to have Codex research and create a plan to build a new feature or solve a complex problem.</p>
<h3 id="access-linear-context-for-codex-tasks"><span>Access Linear context for Codex tasks</span></h3>
<pre tabindex="0" data-language="plaintext"><code><span><span>$skill-installer linear</span></span></code></pre>

<h3 id="have-codex-access-notion-for-more-context"><span>Have Codex access Notion for more context</span></h3>
<pre tabindex="0" data-language="plaintext"><code><span><span>$skill-installer notion-spec-to-implementation</span></span></code></pre>
  </article></div>]]></description>
        </item>
        <item>
            <title><![CDATA[NTP at NIST Boulder Has Lost Power (388 pts)]]></title>
            <link>https://lists.nanog.org/archives/list/nanog@lists.nanog.org/message/ACADD3NKOG2QRWZ56OSNNG7UIEKKTZXL/</link>
            <guid>46334299</guid>
            <pubDate>Sat, 20 Dec 2025 07:39:26 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://lists.nanog.org/archives/list/nanog@lists.nanog.org/message/ACADD3NKOG2QRWZ56OSNNG7UIEKKTZXL/">https://lists.nanog.org/archives/list/nanog@lists.nanog.org/message/ACADD3NKOG2QRWZ56OSNNG7UIEKKTZXL/</a>, See on <a href="https://news.ycombinator.com/item?id=46334299">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="thread-content">

     <!-- /email-header: gravatar, author-info, date, peramlink, changed_subject -->
    <p>reposting from the Internet time service list


jeff.s...@nist.gov &lt;jeff.sherman@nist.gov&gt;: Dec 19 05:18PM -0800

Dear colleagues,

In short, the atomic ensemble time scale at our Boulder campus has failed
due to a prolonged utility power outage. One impact is that the Boulder
Internet Time Services no longer have an accurate time reference. At time
of writing the Boulder servers are still available due a standby power
generator, but I will attempt to disable them to avoid disseminating
incorrect time.

The affected servers are:
time-a-b.nist.gov
time-b-b.nist.gov
time-c-b.nist.gov
time-d-b.nist.gov
time-e-b.nist.gov
ntp-b.nist.gov (authenticated NTP)

No time to repair estimate is available until we regain staff access and
power. Efforts are currently focused on obtaining an alternate source of
power so the hydrogen maser clocks survive beyond their battery backups.

More details follow.

Due to prolonged high wind gusts there have been a combination of utility
power line damage and preemptive utility shutdowns (in the interest of
wildfire prevention) in the Boulder, CO area. NIST's campus lost utility
power Wednesday (Dec. 17 2025) around 22:23 UTC. At time of writing utility
power is still off to the campus. Facility operators anticipated needing to
shutdown the heat-exchange infrastructure providing air cooling to many
parts of the building, including some internal networking closets. As a
result, many of these too were preemptively shutdown with the result that
our group lacks much of the monitoring and control capabilities we
ordinarily have. Also, the site has been closed to all but emergency
personnel Thursday and Friday, and at time of writing remains closed.

At initial power loss, there was no immediate impact to the NIST atomic
time scale or distribution services because the projects are afforded
standby power generators. However, we now have strong evidence one of the
crucial generators has failed. In the downstream path is the primary signal
distribution chain, including to the Boulder Internet Time Service. Another
campus building houses additional clocks backed up by a different power
generator; if these survive it will allow us to re-align the primary time
scale when site stability returns without making use of external clocks or
reference signals.

Best wishes,
-Jeff Sherman
project email: internet-time-service@nist.gov

AnneJ (watching from Edinburgh, UK)</p>

    

    

</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Contrails Map (115 pts)]]></title>
            <link>https://map.contrails.org/</link>
            <guid>46334296</guid>
            <pubDate>Sat, 20 Dec 2025 07:38:57 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://map.contrails.org/">https://map.contrails.org/</a>, See on <a href="https://news.ycombinator.com/item?id=46334296">Hacker News</a></p>
&lt;Unparsable&gt;]]></description>
        </item>
        <item>
            <title><![CDATA[Privacy doesn't mean anything anymore, anonymity does (329 pts)]]></title>
            <link>https://servury.com/blog/privacy-is-marketing-anonymity-is-architecture/</link>
            <guid>46334025</guid>
            <pubDate>Sat, 20 Dec 2025 06:21:05 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://servury.com/blog/privacy-is-marketing-anonymity-is-architecture/">https://servury.com/blog/privacy-is-marketing-anonymity-is-architecture/</a>, See on <a href="https://news.ycombinator.com/item?id=46334025">Hacker News</a></p>
Couldn't get https://servury.com/blog/privacy-is-marketing-anonymity-is-architecture/: Error: Request failed with status code 403]]></description>
        </item>
        <item>
            <title><![CDATA[Charles Proxy (277 pts)]]></title>
            <link>https://www.charlesproxy.com/</link>
            <guid>46333983</guid>
            <pubDate>Sat, 20 Dec 2025 06:09:17 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.charlesproxy.com/">https://www.charlesproxy.com/</a>, See on <a href="https://news.ycombinator.com/item?id=46333983">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
						
							
		<dt>11 Jun 2023</dt>
	


<dd><p>Charles 5 public beta 9 is now available for testing, featuring more UI improvements and bug fixes. <span><a href="https://www.charlesproxy.com/download/beta/">Read more.</a></span></p></dd>
						
							
		<dt>11 Apr 2023</dt>
	


<dd><p>Charles 5 public beta is now available for testing, featuring major UI improvements and technology upgrades. <span><a href="https://www.charlesproxy.com/download/beta/">Read more.</a></span></p></dd>
						
							
		<dt>4 Apr 2023</dt>
	


<dd><p>Charles 4.6.4 released with macOS crash fixed and Windows code signing updated. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>26 Sep 2022</dt>
	


<dd><p>Charles 4.6.3 released with minor bug fixes and Java 11 update <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>14 Dec 2021</dt>
	


<dd><p>In light of the current log4j2 vulnerabilities, we confirm that no version of Charles shipped or used any version of log4j and Charles is therefore thankfully unaffected by this issue. Our best wishes to the log4j developers and everyone affected by this.</p></dd>
						
							
		<dt>6 Jul 2021</dt>
	


<dd><p>Charles 4.6.2 released including bug fixes. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>15 Nov 2020</dt>
	


<dd><p>Charles 4.6.1 released to fix Dark Mode support on macOS <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>7 Nov 2020</dt>
	


<dd><p>Charles 4.6 released including new features and stability improvements. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>15 Jan 2020</dt>
	


<dd><p>Charles 4.5.6 released with minor bug fixes and patched security vulnerability. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>5 Dec 2019</dt>
	


<dd><p>Charles 4.5.5 released including bug fixes for SSL certificate imports. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>3 Nov 2019</dt>
	


<dd><p>Charles 4.5.2 released including new features, bug fixes and improvements. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>28 Feb 2019</dt>
	


<dd><p>Charles 4.2.8 released with minor bug fixes. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>14 Sep 2018</dt>
	


<dd><p>Charles 4.2.7 released with minor bug fixes and improvements. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>5 May 2018</dt>
	


<dd><p>Charles Security Bulletin for a local privilege escalation in Charles 4.2 and 3.12.1 and earlier. <span><a href="https://www.charlesproxy.com/documentation/security/">Read more.</a></span></p></dd>
						
							
		<dt>7 Apr 2018</dt>
	


<dd><p>Charles 4.2.5 released with major bug fixes and minor improvements. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>28 Mar 2018</dt>
	


<dd><p>Charles for iOS released. <span><a href="https://www.charlesproxy.com/ios/">Read more.</a></span></p></dd>
						
							
		<dt>22 Nov 2017</dt>
	


<dd><p>Charles 4.2.1 released with important bug fixes. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>30 Sep 2017</dt>
	


<dd><p>Charles 4.2 released with major new TLS debugging capability, minor improvements and bug fixes including macOS High Sierra support. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>10 Jul 2017</dt>
	


<dd><p>Charles 4.1.4 released with minor improvements and bug fixes. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>20 Jun 2017</dt>
	


<dd><p>Charles 4.1.3 released including Brotli compression support and other minor bug fixes and improvements. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>13 May 2017</dt>
	


<dd><p>Charles 4.1.2 released with bug fixes and minor improvements. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>21 Apr 2017</dt>
	


<dd><p>Charles 4.1.1 released with bug fixes. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>10 Apr 2017</dt>
	


<dd><p>Charles 4.1 released including major new features and bug fixes. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>19 Nov 2016</dt>
	


<dd><p>Charles 4.0.2 released including bug fixes and minor improvements. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>20 Sep 2016</dt>
	


<dd><p>Charles 4.0.1 released including bug fixes. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>16 Sep 2016</dt>
	


<dd><p>Charles 3.11.6 released with support for macOS Sierra and minor bug fixes. <span><a href="https://www.charlesproxy.com/download/previous-release/">Read more.</a></span></p></dd>
						
							
		<dt>1 Aug 2016</dt>
	


<dd><p>Charles 4 released featuring HTTP 2, IPv6 and improved look and feel. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>29 May 2016</dt>
	


<dd><p>Charles 3.11.5 released including minor bug fixes; especially fixes SSL certificate installation on Android. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>29 Feb 2016</dt>
	


<dd><p>Charles 3.11.4 released with support for ATS on iOS 9 and crash fixes for older versions of Mac OS X. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>15 Feb 2016</dt>
	


<dd><p>Charles v3.11.3 released including bug fixes and minor improvements. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>9 Nov 2015</dt>
	


<dd><p>Charles v3.11.2 released with SSL and Websockets improvements. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>4 Oct 2015</dt>
	


<dd><p>Charles 3.11 released including major new features. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>7 Jul 2015</dt>
	


<dd><p>Charles 3.10.2 released with bug fixes and improvements. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>31 Mar 2015</dt>
	


<dd><p>Charles 3.10.1 released with minor bug fixes. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>21 Mar 2015</dt>
	


<dd><p>Charles 3.10 released with improved SSL (new SSL CA certificate install required), major new features and improvements. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>22 Oct 2014</dt>
	


<dd><p>Charles v3.9.3 released with improvements to SSL support, Mac OS X Yosemite support and other minor bug fixes and improvements. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>26 May 2014</dt>
	


<dd><p>Charles v3.9.2 released with minor bug fixes. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>5 May 2014</dt>
	


<dd><p>Charles 3.9.1 released with minor bug fixes and improvements. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>25 Apr 2014</dt>
	


<dd><p>Charles 3.9 released with major new features and bug fixes, including the ability to "focus" on hosts so they are separated from the noise. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>23 Oct 2013</dt>
	


<dd><p>Charles 3.8.3 released with support for Mac OS X Mavericks and minor bug fixes. Happy Mavericks Day. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>21 Oct 2013</dt>
	


<dd><p>Charles 3.8.2 released with minor bug fixes. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>9 Sep 2013</dt>
	


<dd><p>Charles 3.8.1 released with minor bug fixes and improvements. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>4 Sep 2013</dt>
	


<dd><p>Charles 3.8 has been released with new features and bug fixes. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>12 Feb 2013</dt>
	


<dd><p>Charles 3.7 has been released. Includes new features, bundled Java runtime (so you don’t need to install Java anymore), and bug fixes. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>27 Jun 2012</dt>
	


<dd><p>Charles 3.7 beta 2 has been released. This changes the SSL signing for Charles on Mac OS X to use Apple's new Developer ID code-signing. <span><a href="http://www.charlesproxy.com/download/beta/" target="_blank" rel="noopener noreferrer">Read more.</a></span></p></dd>
						
							
		<dt>8 Dec 2011</dt>
	


<dd><p>Charles v3.6.5 released including bug fixes and minor changes. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>15 Nov 2011</dt>
	


<dd><p>Charles v3.6.4 released including major bug fixes and enhancements. <span><a href="https://www.charlesproxy.com/download/">Read more.</a></span></p></dd>
						
							
		<dt>5 Sep 2011</dt>
	


<dd><p>Charles v3.6.3 released including minor bug fixes. <span><a href="http://www.charlesproxy.com/download/" target="_blank" rel="noopener noreferrer">Read more.</a></span></p></dd>
						
							
		<dt>24 Aug 2011</dt>
	


<dd><p>Charles v3.6.1 released including minor enhancements and bug fixes. <span><a href="http://www.charlesproxy.com/download/" target="_blank" rel="noopener noreferrer">Read more.</a></span></p></dd>
						
							
		<dt>18 Aug 2011</dt>
	


<dd><p>Charles v3.6 released including new features, enhancements and bug fixes. New features include HAR and SAZ file import. <span><a href="http://www.charlesproxy.com/download/" target="_blank" rel="noopener noreferrer">Read more.</a></span></p></dd>
						
							
		<dt>17 Aug 2010</dt>
	


<dd><p>Charles v3.5.2 released including bug fixes and minor new features. <span><a href="http://www.charlesproxy.com/download/" target="_blank" rel="noopener noreferrer">Read more.</a></span></p></dd>
						
							
		<dt>1 Jan 2010</dt>
	


<dd><p>Charles 3.5.1 released. Minor bug fixes. <span><a href="http://www.charlesproxy.com/download/" target="_blank" rel="noopener noreferrer">Read more.</a></span></p></dd>
						
							
		<dt>23 Dec 2009</dt>
	


<dd><p>Charles 3.5 released. Major new features, bug fixes and enhancements.</p></dd>
						
							
		<dt>17 Oct 2009</dt>
	


<dd><p>Charles 3.4.1 released. Minor features and bug fixes.</p></dd>
						
							
		<dt>27 Sep 2009</dt>
	


<dd><p>Charles 3.4 released. Major changes especially to SSL.</p></dd>
						
							
		<dt>11 May 2009</dt>
	


<dd><p>New website launched. Follow <a href="http://twitter.com/charlesproxy" target="_blank" rel="noopener noreferrer">@charlesproxy</a> on Twitter. Say hi in San Francisco when I'm there for WWDC!</p></dd>
						
							
		<dt>7 Mar 2009</dt>
	


<dd><p>Charles 3.3.1 released. Minor new features and bug fixes. Experimental 64 bit Windows support. <span><a href="http://www.charlesproxy.com/" target="_blank" rel="noopener noreferrer">Read more.</a></span></p></dd>
						
							
		<dt>15 Feb 2009</dt>
	


<dd><p>Charles 3.3 released. Major new features. Download</p></dd>
						
							
		<dt>24 Sep 2008</dt>
	


<dd><p>Charles Autoconfiguration add-on for Mozilla Firefox adds support for Firefox 3.1</p></dd>
						
							
		<dt>23 Sep 2008</dt>
	


<dd><p>Charles 3.2.3 released. Minor new features and bug fixes.</p></dd>
						
							
		<dt>6 Sep 2008</dt>
	


<dd><p>Charles 3.2.2 released. Minor new features and bug fixes.</p></dd>
						
							
		<dt>17 Apr 2008</dt>
	


<dd><p>Charles 3.2.1 released. Minor new features and bug fixes.</p></dd>
						
							
		<dt>24 Mar 2008</dt>
	


<dd><p>Charles 3.2 released. Major new features. Release Notes</p></dd>
						
							
		<dt>28 Jan 2008</dt>
	


<dd><p>Charles 3.2 public beta released. Download and more information on my blog.</p></dd>
						
							
		<dt>19 Dec 2007</dt>
	


<dd><p>Charles 3.1.4 released. Bug fixes and minor new features.</p></dd>
						
							
		<dt>21 Nov 2007</dt>
	


<dd><p>Charles Mozilla Firefox add-on updated for compatibility with Firefox 3.0.</p></dd>
						
							
		<dt>12 Nov 2007</dt>
	


<dd><p>Charles 3.1.3 released. Minor bug fixes, minor new features.</p><ul><li>Chart tab now includes charts for sizes, durations and types</li><li>Request &amp; Response can now be displayed combined on one split-panel</li><li>SSL handshake and certificate errors are now displayed in the tree</li></ul></dd>
						
							
		<dt>29 Aug 2007</dt>
	


<dd><p>Charles 3.1.2 released. Minor bug fixes.</p></dd>
						
							
		<dt>27 Aug 2007</dt>
	


<dd><p>Charles 3.1.1 released. Minor bug fixes.</p></dd>
						
							
		<dt>13 Aug 2007</dt>
	


<dd><p>Charles 3.1 released.</p></dd>
						
							
		<dt>22 May 2007</dt>
	


<dd><p>Charles 3.0.4 released. Fixes SSL bug on Java 1.4.</p></dd>
						
							
		<dt>14 May 2007</dt>
	


<dd><p>Charles 3.0.3 re-released. Fixes launch bug on computers that haven't used Charles before.</p></dd>
						
							
		<dt>12 May 2007</dt>
	


<dd><p>Charles 3.0.3 released. Various improvements and minor bug fixes.</p></dd>
						
							
		<dt>23 Apr 2007</dt>
	


<dd><p>Charles 3.0.2 released. Minor bug fixes and improvements.</p></dd>
						
							
		<dt>28 Mar 2007</dt>
	


<dd><p>Charles 3.0.1 released. Minor bug fixes.</p></dd>
						
							
		<dt>24 Mar 2007</dt>
	


<dd><p>Charles 3.0 released. Major new features and improvements</p></dd>
						
							
		<dt>7 Mar 2007</dt>
	


<dd><p>Charles 3.0 public beta released.</p></dd>
						
							
		<dt>27 Feb 2007</dt>
	


<dd><p>Charles v2.6.4 release. Minor bug fixes:</p><ul><li>IBM JDK compatibility</li><li>Improved malformed Referer header support</li></ul></dd>
						
							
		<dt>17 Feb 2007</dt>
	


<dd><p>Charles v2.6.3 release. Minor bug fixes:</p><ul><li>Fixed Port Forwarding fault introduced in v2.6.2</li></ul></dd>
						
							
		<dt>1 Feb 2007</dt>
	


<dd><p>Charles v2.6.2 release. Major improvements and bug fixes including:</p><ul><li>No more recording limits. Large responses are now saved to temporary files, reducing memory usage.</li><li>MTU support in the throttle settings</li><li>AMF3 / Flex 2 bug fixes</li></ul></dd>
						
							
		<dt>2 Dec 2006</dt>
	


<dd><p>Charles v2.6.1 release. Minor bug fixes and improvements:</p><ul><li>SOAP information visible while response is still loading</li><li>AMF3 externalizable object parsing regression fixed</li><li>AMF view for AMF3/Flex messages simplified to hide Flex implementation details</li></ul></dd>
						
							
		<dt>27 Nov 2006</dt>
	


<dd><p>Charles v2.6 release. Major improvements and bug fixes including:</p><ul><li>Major UI overhaul</li><li>JSON and JSON-RPC support</li><li>SOAP support</li></ul></dd>
						
							
		<dt>20 Sep 2006</dt>
	


<dd><p>Charles v2.5 release. Major improvements and bug fixes including:</p><ul><li>Major UI improvements</li><li>Support for new filetypes including FLV</li><li>Major improvements to AMF / Flash remoting viewer</li><li>Thank you to everyone who made suggestions and participated in the long testing process.</li></ul></dd>
						
							
		<dt>1 Jun 2006</dt>
	


<dd><p>Charles v2.4.2 release. Minor improvements and bug fixes including:</p><ul><li>Support for request body compression (used by web services)</li><li>Fix for parsing of AMFPHP responses</li><li>Improvements to AMF viewer</li></ul></dd>
						
							
		<dt>6 May 2006</dt>
	


<dd><p>Charles v2.4.1 release. Minor improvements and bug fixes including:</p><ul><li>Firefox extension improved</li><li>AMF 0 and AMF 3 parsing improved</li><li>Look and Feel changes to give a greater (and more consistent) range of font sizes in the Charles look and feel</li><li>SSL error reporting improved when a connection cannot be made to a remote host</li><li>Port Forwarding tool and Reverse Proxy tool re-bind exception fixed</li></ul></dd>
						
							
		<dt>26 Apr 2006</dt>
	


<dd><p>Charles v2.4 release. Major new features, improvements and bug fixes including:</p><ul><li>AMF 3 support</li><li>SSL support for IBM JDK (thanks to Lance Bader for helping solve this)</li><li>Automatic Update Checking</li><li>Documentation wiki open to public</li></ul></dd>
						
							
		<dt>25 Mar 2006</dt>
	


<dd><p>Charles v2.3 release. Major improvements and bug fixes including:</p><ul><li>Proxy implementation improvements including better handling of keep-alive connections</li><li>SOCKS proxy added, so any SOCKSified application can now run through Charles</li><li>External proxies configuration improvements including authentication</li><li>Flash Remoting / AMF viewer improvements</li><li>Dynamic proxy port support, for multiuser systems</li></ul></dd>
						
							
		<dt>5 Nov 2005</dt>
	


<dd><p>Charles v2.2.1 release. Minor improvements and bug fixes including:</p><ul><li>Further improved Firefox proxy configuration</li><li>Port Forwarding enhancements including port ranges and UDP forwarding</li><li>Bug fixes for Reverse Proxy and AMF viewer</li></ul></dd>
						
							
		<dt>5 Oct 2005</dt>
	


<dd><p>Charles v2.2 released. Major enhancements and bug fixes including:</p><ul><li>Improved Firefox proxy configuration</li><li>XML viewer improvements</li><li>Line numbers displayed in ASCII viewer</li></ul></dd>
						
							
		<dt>2 Sep 2005</dt>
	


<dd><p>Charles v2.1 released. Major new features and enhancements including:</p><ul><li>Automatic Firefox proxy configuration</li><li>Formatted form posts and query string information</li><li>Parsing of SWF and AMF (Flash Remoting) binary formats</li></ul></dd>
						
							
		<dt>18 Jun 2005</dt>
	


<dd><p>Charles v2.0 released. Major enhancements and improvements.</p></dd>
						
					</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[The Deviancy Signal: Having "Nothing to Hide" Is a Threat to Us All (180 pts)]]></title>
            <link>https://thompson2026.com/blog/deviancy-signal/</link>
            <guid>46333830</guid>
            <pubDate>Sat, 20 Dec 2025 05:24:21 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://thompson2026.com/blog/deviancy-signal/">https://thompson2026.com/blog/deviancy-signal/</a>, See on <a href="https://news.ycombinator.com/item?id=46333830">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
            <p>There's a special kind of contempt I reserve for the person who says, "I have nothing to hide." It's not the gentle pity you'd have for the naive. It's the cold, hard anger you hold for a collaborator. Because these people aren't just surrendering their own liberty. They're instead actively forging the chains for the rest of us. They are a threat, and I think it's time they were told so.</p>
<p>Their argument is a "pathology of the present tense," a failure of imagination so profound it borders on a moral crime. What they fail to understand is that by living as an open book, they are creating the most dangerous weapon imaginable: a baseline of "normalcy." They are steadily creating a data profile for the State's machine, teaching its algorithms what a "good, transparent citizen" looks like. Every unencrypted text, every thoughtless search, every location-tagged post is another brick in the wall of their own cage.</p>
<p>And then comes the part they can't (or won't) fathom. The context shifts. The political winds change. The Overton window slams shut on a belief they once held. A book they read is declared subversive. A group they donated to is re-classified as extremist. A joke they told is now evidence of a thoughtcrime. Suddenly, for the first time, they have something to hide.</p>
<p>So they reach for the tools of privacy. They download the encrypted messenger. They fire up the VPN. They start to cover their tracks.</p>
<p>And in that single act, they trigger the <strong>Deviancy Signal</strong>.</p>
<p>Their first attempt at privacy, set against their own self-created history of total transparency, is a screaming alarm to the grown surveillance machine. It's the poker player with a perfect tell, or the nocturnal animal suddenly walking in daylight. Their very attempt to become private is the most public and suspicious act they could possibly commit. They have not built an effective shield, as they have painted a target on their own back. By the time they need privacy, their own history has made seeking it an admission of guilt.</p>
<p>But the damage doesn't end with your own self-incrimination. It radiates outward, undoing the careful work of everyone around you. Think of your friend who has practiced perfect operational security, who has spent years building a private life to ensure they have no baseline for the state to analyze. They are a ghost in the machine. Then they talk to you. Your unshielded phone becomes the listening device they never consented to. You take their disciplined effort to stay invisible and you shout it into a government microphone, tying their identity to yours in a permanent, searchable log. You don't just contrast with their diligence; you actively dismantle it.</p>
<p>On a societal scale, this inaction becomes a collective betrayal. The power of the <strong>Deviancy Signal</strong> is directly proportional to the number of people who live transparently. Every person who refuses to practice privacy adds another gallon of clean, clear water to the state's pool, making any ripple of dissent ... any deviation ... starkly visible. This is not a passive choice. By refusing to help create a chaotic, noisy baseline of universal privacy, you are actively making the system more effective. You are failing to do your part to make the baseline all deviant, and in doing so, you make us all more vulnerable.</p>
<p>There is only one way to disarm this weapon: we must destroy its premise. We must obliterate the baseline. The task is not merely to hide, but to make privacy the default, to make encryption a reflex, to make anonymity a universal right. We must create so much noise that a signal is impossible to find. Our collective goal must be to make a "normal" profile so rare that the watchers have nothing to compare us to. <strong>We must all become deviations</strong>.</p>

        </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Android introduces $2-4 install fee and 10–20% cut for US external content links (207 pts)]]></title>
            <link>https://support.google.com/googleplay/android-developer/answer/16470497?hl=en</link>
            <guid>46333734</guid>
            <pubDate>Sat, 20 Dec 2025 05:00:55 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://support.google.com/googleplay/android-developer/answer/16470497?hl=en">https://support.google.com/googleplay/android-developer/answer/16470497?hl=en</a>, See on <a href="https://news.ycombinator.com/item?id=46333734">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="hcfe-content" role="main">                   <article class="page" sc-render-smart-button="false" itemscope=""> <div data-stats-ve="35"><div>
  <p>Developers currently using links to app downloads or transactions need to enroll in this program and meet these requirements by January 28, 2026.</p>
</div>

<div>
  <p><a id="in_the_future" name="in_the_future"></a>In the future, Google intends to apply a service fee on successful transactions and downloads completed via external content links. At this time, however, Google is not assessing these fees and is therefore not requiring developers in this program to report these transactions or downloads to Google.</p>
</div>

<p>The external content links program allows developers of Google Play-distributed apps to link users in the United States to external content, including to purchase in-app digital items or to download an app whose install and updates are not managed by Google Play. Additionally, developers can offer external links to purchase in-app digital items in lieu of or alongside Google Play Billing.</p>

<p>Developers must meet the eligibility and requirements set out below, and successfully complete their enrollment in this program prior to using external content links.<br>
  &nbsp;</p>

<h2>Availability</h2>

<p>This program is available in the US in connection with the <a href="https://support.google.com/googleplay/android-developer/answer/15582165" rel="noopener">US District Court's order</a>. Google reserves the right to modify or terminate this program, including as a result of any changes to or termination of the US District Court's order.</p>

<h2><a id="ecl_requirements" name="ecl_requirements"></a>Requirements</h2>

<p>Developers participating in this program must comply with the following requirements:</p>

<ul>
  <li>Enroll and get approval for your app(s) and any linked external apps in the external content links program as explained below.</li>
  <li>Limit external content links to users in the US and its territories.</li>
  <li>Ensure all Play Apps enrolled in this program and any linked external apps comply with <a href="https://play.google/developer-content-policy/" rel="noopener" target="_blank">Play Developer Policies</a>, with the exception of policies that are not applicable to linked apps, such as the <a href="https://support.google.com/googleplay/android-developer/answer/9858738" rel="noopener">Payments policy</a>.</li>
  <li>If using Google Play Billing with this program, all users must be able to access Google Play Billing in a consistent and reliable manner.</li>
  <li>Integrate with the external content links APIs, which surface&nbsp;an information screen, enable parental controls, and facilitate transaction reporting once required.</li>
  <li>Provide customer support for users completing transactions or downloading apps outside of Play and provide a process to dispute unauthorized transactions.</li>
  <li>Offer refund methods for users completing transactions outside of Play, unless the user was clearly informed that the transaction is non-refundable before completing the purchase.</li>
  <li>All external content links must meet the <a href="#destination_requirements" rel="noopener">destination requirements</a> as outlined below.</li>
  <li><a href="#in_the_future" rel="noopener">Once required</a>, pay Google the applicable fees for qualifying transactions or app installs that are concluded outside the app following the external content link as outlined below.</li>
</ul>

<h2><a id="destination_requirements" name="destination_requirements"></a><span>Destination requirements</span></h2>

<div>
  <p>All external content destinations must meet the following requirements:</p>

  <div>
    <ul>
      <li>External content links to purchase in-app offers can be shown on a browser, in a webview or another app store already installed on the user’s device.</li>
      <li>For user safety, external content links to download apps can link to the download of apps on a browser or another app store already installed on the user’s device. The destination page cannot contain any downloads that have not been approved for the ECL program.</li>
      <li>External content links must inform the user about the destination page and its purpose in the app before linking out.</li>
      <li>External content URLs must not contain a user’s personally identifiable information without sufficient security or encryption techniques in order to protect the user’s data.</li>
      <li>External content links must not redirect or mislead users to a different destination page than presented in your external link, or present other false or deceptive information.</li>
    </ul>
  </div>
</div>

<div>
  <p>In addition, to ensure a good user experience and keep Play’s users safe, any destination for links to download need to:</p>

  <div>
      <ul>
        <li>Have the right to distribute the apps available at the destination.</li>
        <li>Clearly and visibly publish details for the app that is to be downloaded. The app details must include at least app name, app icon, app description, app version number, app download size, and information about the app developer.</li>
        <li>Only install an app with the user’s knowledge and at the explicit direction of the user for each app, through a clearly labeled UI component visible to the user.</li>
        <li>Provide direct, publicly accessible customer support to end users through readily accessible communication channels.</li>
        <li>Have user data policies for their users.</li>
        <li>Be responsible for adhering to all applicable local regulations, laws and ordinances.</li>
      </ul>
    </div>
</div>

<h2><span>Play Ser</span><span>vice Fees</span></h2>

<div>
  <p>In the future, Google intends to apply a service fee on successful transactions and downloads completed via external content links. At this time, however, Google is not assessing these fees and is therefore not requiring developers in this program to report these transactions or downloads to Google.</p>
</div>

<p>Like our standard service fees, the fees associated with the external content links program reflect the <a href="https://play.google/howplayworks/" rel="noopener" target="_blank">value provided by Android and Play and support our continued investments across Android and Play</a>. The following fees apply when a user completes any transactions or any app installs <strong>within 24 hours of following an external content link</strong>:</p>

<ul>
  <li><strong>In-app item purchases</strong>: 10% for auto-renewing subscriptions and 20% for other offers of in-app digital features and services. Transactions for the first $1M (USD) of total developer earnings annually will be charged at 10%.</li>
  <li><strong>App download event</strong>: A fixed fee (subject to periodic adjustments) per install based on the app category of the linked external app being installed. The linked app category must be declared as part of transaction reporting.
    <ul>
      <li>Games: $3.65</li>
      <li>Apps: $2.85</li>
    </ul>
  </li>
</ul>

<h2>Eligibility</h2>

<p>In order to be eligible for this program, your app(s) must be a mobile or tablet app or game serving users in the United States and its territories.</p>

<p>Please note that eligibility and requirements are subject to change.</p>

<h2>Enroll your app in the external content links program</h2>

<p>To enroll in the external content links program, you must complete the following steps:</p>

<ol>
  <li>Review the requirements on this page to determine if your app(s) meets all the eligibility criteria.</li>
  <li>Complete the <a href="https://support.google.com/googleplay/android-developer/contact/external_content_links" rel="noopener">external content links declaration form</a> and complete any onboarding steps required to enroll in the program through Google's support team.</li>
  <li>Integrate the <a href="https://developer.android.com/google/play/billing/externalcontentlinks" rel="noopener" target="_blank">external links APIs</a> in your app for external links prior to linking users out to purchase in-app digital items or to download an external app.</li>
  <li>Enroll your app(s) that will be using external content links through Play Console on the <strong>External</strong> <strong>content</strong> <strong>links</strong> page (<strong>Settings</strong> &gt; <strong>External</strong> <strong>content</strong> <strong>links</strong>).</li>
  <li>If you are using external content links to link users to download an app, complete the following steps in Play Console:
    <div>
      <h2>a. Register and submit all versions of the linked external app(s)</h2>

      <div>
        <p>i. Open <a href="https://play.google.com/console/developers" rel="noopener" target="_blank">Play Console</a> and go to the Register external apps page (<strong>Settings</strong> &gt; <strong>Register</strong> <strong>external</strong> <strong>apps</strong>).</p>

        <p>ii. External apps submitted for registration are processed as soon as possible, subject to our standard review processes, and may result in review times of up to 7 days or longer in exceptional cases.</p>
      </div>
    </div>

    <div>
      <p>b. Declare all external content links to external app(s) in your Play app(s)</p>

      <div>
          <p>i. Open <a href="https://play.google.com/console/developers" rel="noopener" target="_blank">Play Console</a> and go to the External apps declaration (<strong>Monitor and improve</strong> &gt; <strong>Policy and programs</strong> &gt; <strong>App Content</strong>).</p>

          <p>ii. Input the package name of the external app. Note: only external apps that have been successfully registered will show up in the drop-down list. See <a href="#why_cant_I_select_the_external_app_when_declaring_external_content_links" rel="noopener">this FAQ</a> for more information.</p>

          <p>iii. Provide all user facing landing page URLs for the external app downloads.</p>

          <p>iv. Provide all download links that are being used to distribute the external app APK to users.</p>
        </div>
    </div>

    <div>
      <h2>c. When your external app(s) are updated, submit all updated versions and APKs of the linked external app(s)</h2>

      <div>
          <p>i. Open <a href="https://play.google.com/console/developers" rel="noopener" target="_blank">Play Console</a> and go to the Register external apps page (<strong>Settings</strong> &gt; <strong>Register</strong> <strong>external</strong> <strong>apps</strong>).</p>

          <p>ii. Find the external app that is being updated and click <strong>Manage</strong> in the table.</p>

          <p>iii. Ensure the external app is approved before linking users to the updated versions or APKs.</p>
        </div>
    </div>
  </li>
  <li>
    <p><a href="#in_the_future" rel="noopener">Once required</a>, keep track of all transactions, including $0 transactions resulting from free trial purchases, and app installs completed through external content links for reporting through the <a href="https://developer.android.com/google/play/billing/externalcontentlinks" rel="noopener" target="_blank">external links APIs</a>.</p>
  </li>
</ol>

<p>If you have any additional questions, you can contact our support team <a href="https://support.google.com/googleplay/android-developer/contact/billing_and_linkouts_program_q" rel="noopener">here</a>.</p>

<p><a href="https://support.google.com/googleplay/android-developer/contact/external_content_links" target="_blank" rel="noopener">Open declaration form</a></p>

<h2><a id="ecl_program_faq" name="ecl_program_faq"></a>Frequently asked questions</h2>

<div>
  <p>Can I utilize external content links for users in other geographies beyond the US?</p>

  <div>
    <p>This program is limited to users in the United States and its territories. Developers from other regions can enroll in the program to offer external links to users in the United States and its territories. If you are looking to offer external content links for users in the EEA, you will need to enroll in the <a href="https://support.google.com/googleplay/android-developer/answer/12570971" rel="noopener">External Offers Program</a>.</p>
  </div>
</div>

<div>
  <p>Are game developers eligible for this program?</p>

  <div>
    <p>Yes, both game and app developers are eligible to apply and participate in the external content links program.</p>
  </div>
</div>

<div>
  <p>Are all developers required to enroll in the external content links program?</p>

  <div>
    <p>No, this is an optional program. If you do not wish to link users to external content for purchases or downloads, no action is required.</p>
  </div>
</div>

<div>
  <p>Is there a limit to the number of external content links I am allowed to have in my app?</p>

  <div>
    <p>No, there is no limit on the number of external content links in your app.</p>
  </div>
</div>

<div>
  <p>What types of transactions are we required to report when using external content links to link users to purchase in-app digital items?</p>

  <div>
    <p>Once required, you will need to report all transactions, including $0 transactions resulting from free trial purchases, that are concluded after following an external content link. This applies to all transactions, including new purchases, rentals, renewals, top-ups, upgrades, downgrades, and others. Please see the external links integration guide for how to report these transactions.</p>
  </div>
</div>

<div>
  <p><a id="why_cant_I_select_the_external_app_when_declaring_external_content_links" name="why_cant_I_select_the_external_app_when_declaring_external_content_links"></a>Why can’t I select the external app when declaring external content links in the Play Console?</p>

  <div>
    <p>External apps must be successfully registered before you can declare the external content links that link users to an external app download. Please make sure that the external app has been submitted for registration and addressed any issues that may have been identified during the registration and review process. You can check to see if there are any issues in <a href="https://play.google.com/console/developers" rel="noopener" target="_blank">Play Console</a> on the <strong>Publishing</strong> <strong>overview</strong> page before you submit your external app registration or on the <strong>Policy</strong> <strong>status</strong> page after you have submitted your external app for review.</p>
  </div>
</div>

<div>
  <p>Do I have to register the external apps that I link to?</p>

  <div>
    <p>Yes, registration of all external apps on the linked destination page is required. This process enables Google to check that all external apps linked to using external content links are compliant with <a href="https://play.google/developer-content-policy/" rel="noopener" target="_blank">Play Developer Policies</a>, with the exception of policies that are not applicable to linked apps, such as the <a href="https://support.google.com/googleplay/android-developer/answer/9858738" rel="noopener">Payment policies</a>.</p>
  </div>
</div>

<div>
  <p>Can I make external content links available for only some of my apps?</p>

  <div>
    <p>Yes, after successfully signing up to the external content links program, you can select which apps you want to enroll for external content links at any given time using the Play Console.</p>
  </div>
</div>

<div>
  <p>How can I notify Google of any changes to my app package enrollment selections?</p>

  <div>
    <p>You can change the external content link program enrollment for a given app package through your <a href="https://developer.android.com/google/play/billing/alternative#configuring-with-user-choice" rel="noopener" target="_blank">Play Console settings</a>. Any updates will be effective immediately, including changes to applicable service fees.</p>
  </div>
</div>

<div>
  <h2>What are the steps to integrate with the external links APIs?</h2>

  <div>
    <p>It is easy to extend your existing integration with Google Play’s billing system to utilize external links APIs. The APIs are built upon the same design patterns and principles as our Play Billing Library and Play Developer APIs. This means they are compatible with your existing designs and will be familiar to your teams. In our developer integration guide, we provide detailed guidelines and resources on how to get started. We welcome developer feedback on these APIs and any additional resources that would be helpful.</p>

    <p>If you have any questions or feedback about the external links APIs, please contact us <a href="https://support.google.com/googleplay/android-developer/contact/billing_and_linkouts_program_q" rel="noopener">here</a>.</p>
  </div>
</div>

<div>
  <p>If I am already participating in an alternative billing program, can I also participate in the external content links program?</p>

  <div>
    <p>Yes, developers can take advantage of both programs if they so choose and if they satisfy requirements of both programs and meet the eligibility criteria for both. To participate in the external content links program and start promoting external links, you need to successfully complete the signup process and comply with all the program requirements.</p>
  </div>
</div>

<div>
  <p>Can I use Google Play's billing system alongside external content links?</p>

  <div>
    <p>Yes, developers can take advantage of Google Play's billing system while also participating in the external content links program. To participate in the external content links program and start promoting external links, you need to successfully complete the signup process and comply with all the program requirements.</p>
  </div>
</div>
</div>         <div data-stats-id="16470497" data-stats-ve="20" data-stats-visible-imp="" id="article-survey-container"><h2 tabindex="-1">Was this helpful?</h2><p>How can we improve it?</p></div>    </article>            </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Build Your Own React (160 pts)]]></title>
            <link>https://pomb.us/build-your-own-react/</link>
            <guid>46332526</guid>
            <pubDate>Sat, 20 Dec 2025 00:16:13 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://pomb.us/build-your-own-react/">https://pomb.us/build-your-own-react/</a>, See on <a href="https://news.ycombinator.com/item?id=46332526">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><pre><code><div><p><span>function</span><span> </span><span>createElement</span><span>(</span><span>type</span><span>,</span><span> props</span><span>,</span><span> </span><span>...</span><span>children</span><span>)</span><span> </span><span>{</span></p></div><div><p><span>  </span><span>return</span><span> </span><span>{</span></p></div><div><p><span>    type</span><span>,</span></p></div><div><p><span>    </span><span>props</span><span>:</span><span> </span><span>{</span></p></div><div><p><span>      </span><span>...</span><span>props</span><span>,</span></p></div><div><p><span>      </span><span>children</span><span>:</span><span> children</span><span>.</span><span>map</span><span>(</span><span>child</span><span> </span><span>=&gt;</span></p></div><div><p><span>        </span><span>typeof</span><span> child </span><span>===</span><span> </span><span>"object"</span></p></div><div><p><span>          </span><span>?</span><span> child</span></p></div><div><p><span>          </span><span>:</span><span> </span><span>createTextElement</span><span>(</span><span>child</span><span>)</span></p></div><div><p><span>      </span><span>)</span><span>,</span></p></div><div><p><span>    </span><span>}</span><span>,</span></p></div><div><p><span>  </span><span>}</span></p></div><div><p><span>}</span></p></div><div><p><span>​</span></p></div><div><p><span>function</span><span> </span><span>createTextElement</span><span>(</span><span>text</span><span>)</span><span> </span><span>{</span></p></div><div><p><span>  </span><span>return</span><span> </span><span>{</span></p></div><div><p><span>    </span><span>type</span><span>:</span><span> </span><span>"TEXT_ELEMENT"</span><span>,</span></p></div><div><p><span>    </span><span>props</span><span>:</span><span> </span><span>{</span></p></div><div><p><span>      </span><span>nodeValue</span><span>:</span><span> text</span><span>,</span></p></div><div><p><span>      </span><span>children</span><span>:</span><span> </span><span>[</span><span>]</span><span>,</span></p></div><div><p><span>    </span><span>}</span><span>,</span></p></div><div><p><span>  </span><span>}</span></p></div><div><p><span>}</span></p></div><div><p><span>​</span></p></div><div><p><span>function</span><span> </span><span>createDom</span><span>(</span><span>fiber</span><span>)</span><span> </span><span>{</span></p></div><div><p><span>  </span><span>const</span><span> dom </span><span>=</span></p></div><div><p><span>    fiber</span><span>.</span><span>type </span><span>==</span><span> </span><span>"TEXT_ELEMENT"</span></p></div><div><p><span>      </span><span>?</span><span> document</span><span>.</span><span>createTextNode</span><span>(</span><span>""</span><span>)</span></p></div><div><p><span>      </span><span>:</span><span> document</span><span>.</span><span>createElement</span><span>(</span><span>fiber</span><span>.</span><span>type</span><span>)</span></p></div><div><p><span>​</span></p></div><div><p><span>  </span><span>updateDom</span><span>(</span><span>dom</span><span>,</span><span> </span><span>{</span><span>}</span><span>,</span><span> fiber</span><span>.</span><span>props</span><span>)</span></p></div><div><p><span>​</span></p></div><div><p><span>  </span><span>return</span><span> dom</span></p></div><div><p><span>}</span></p></div><div><p><span>​</span></p></div><div><p><span>const</span><span> </span><span>isEvent</span><span> </span><span>=</span><span> </span><span>key</span><span> </span><span>=&gt;</span><span> key</span><span>.</span><span>startsWith</span><span>(</span><span>"on"</span><span>)</span></p></div><div><p><span>const</span><span> </span><span>isProperty</span><span> </span><span>=</span><span> </span><span>key</span><span> </span><span>=&gt;</span></p></div><div><p><span>  key </span><span>!==</span><span> </span><span>"children"</span><span> </span><span>&amp;&amp;</span><span> </span><span>!</span><span>isEvent</span><span>(</span><span>key</span><span>)</span></p></div><div><p><span>const</span><span> </span><span>isNew</span><span> </span><span>=</span><span> </span><span>(</span><span>prev</span><span>,</span><span> next</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>key</span><span> </span><span>=&gt;</span></p></div><div><p><span>  prev</span><span>[</span><span>key</span><span>]</span><span> </span><span>!==</span><span> next</span><span>[</span><span>key</span><span>]</span></p></div><div><p><span>const</span><span> </span><span>isGone</span><span> </span><span>=</span><span> </span><span>(</span><span>prev</span><span>,</span><span> next</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>key</span><span> </span><span>=&gt;</span><span> </span><span>!</span><span>(</span><span>key </span><span>in</span><span> next</span><span>)</span></p></div><div><p><span>function</span><span> </span><span>updateDom</span><span>(</span><span>dom</span><span>,</span><span> prevProps</span><span>,</span><span> nextProps</span><span>)</span><span> </span><span>{</span></p></div><div><p><span>  </span><span>//Remove old or changed event listeners</span></p></div><div><p><span>  Object</span><span>.</span><span>keys</span><span>(</span><span>prevProps</span><span>)</span></p></div><div><p><span>    </span><span>.</span><span>filter</span><span>(</span><span>isEvent</span><span>)</span></p></div><div><p><span>    </span><span>.</span><span>filter</span><span>(</span></p></div><div><p><span>      </span><span>key</span><span> </span><span>=&gt;</span></p></div><div><p><span>        </span><span>!</span><span>(</span><span>key </span><span>in</span><span> nextProps</span><span>)</span><span> </span><span>||</span></p></div><div><p><span>        </span><span>isNew</span><span>(</span><span>prevProps</span><span>,</span><span> nextProps</span><span>)</span><span>(</span><span>key</span><span>)</span></p></div><div><p><span>    </span><span>)</span></p></div><div><p><span>    </span><span>.</span><span>forEach</span><span>(</span><span>name</span><span> </span><span>=&gt;</span><span> </span><span>{</span></p></div><div><p><span>      </span><span>const</span><span> eventType </span><span>=</span><span> name</span></p></div><div><p><span>        </span><span>.</span><span>toLowerCase</span><span>(</span><span>)</span></p></div><div><p><span>        </span><span>.</span><span>substring</span><span>(</span><span>2</span><span>)</span></p></div><div><p><span>      dom</span><span>.</span><span>removeEventListener</span><span>(</span></p></div><div><p><span>        eventType</span><span>,</span></p></div><div><p><span>        prevProps</span><span>[</span><span>name</span><span>]</span></p></div><div><p><span>      </span><span>)</span></p></div><div><p><span>    </span><span>}</span><span>)</span></p></div><div><p><span>​</span></p></div><div><p><span>  </span><span>// Remove old properties</span></p></div><div><p><span>  Object</span><span>.</span><span>keys</span><span>(</span><span>prevProps</span><span>)</span></p></div><div><p><span>    </span><span>.</span><span>filter</span><span>(</span><span>isProperty</span><span>)</span></p></div><div><p><span>    </span><span>.</span><span>filter</span><span>(</span><span>isGone</span><span>(</span><span>prevProps</span><span>,</span><span> nextProps</span><span>)</span><span>)</span></p></div><div><p><span>    </span><span>.</span><span>forEach</span><span>(</span><span>name</span><span> </span><span>=&gt;</span><span> </span><span>{</span></p></div><div><p><span>      dom</span><span>[</span><span>name</span><span>]</span><span> </span><span>=</span><span> </span><span>""</span></p></div><div><p><span>    </span><span>}</span><span>)</span></p></div><div><p><span>​</span></p></div><div><p><span>  </span><span>// Set new or changed properties</span></p></div><div><p><span>  Object</span><span>.</span><span>keys</span><span>(</span><span>nextProps</span><span>)</span></p></div><div><p><span>    </span><span>.</span><span>filter</span><span>(</span><span>isProperty</span><span>)</span></p></div><div><p><span>    </span><span>.</span><span>filter</span><span>(</span><span>isNew</span><span>(</span><span>prevProps</span><span>,</span><span> nextProps</span><span>)</span><span>)</span></p></div><div><p><span>    </span><span>.</span><span>forEach</span><span>(</span><span>name</span><span> </span><span>=&gt;</span><span> </span><span>{</span></p></div><div><p><span>      dom</span><span>[</span><span>name</span><span>]</span><span> </span><span>=</span><span> nextProps</span><span>[</span><span>name</span><span>]</span></p></div><div><p><span>    </span><span>}</span><span>)</span></p></div><div><p><span>​</span></p></div><div><p><span>  </span><span>// Add event listeners</span></p></div><div><p><span>  Object</span><span>.</span><span>keys</span><span>(</span><span>nextProps</span><span>)</span></p></div><div><p><span>    </span><span>.</span><span>filter</span><span>(</span><span>isEvent</span><span>)</span></p></div><div><p><span>    </span><span>.</span><span>filter</span><span>(</span><span>isNew</span><span>(</span><span>prevProps</span><span>,</span><span> nextProps</span><span>)</span><span>)</span></p></div><div><p><span>    </span><span>.</span><span>forEach</span><span>(</span><span>name</span><span> </span><span>=&gt;</span><span> </span><span>{</span></p></div><div><p><span>      </span><span>const</span><span> eventType </span><span>=</span><span> name</span></p></div><div><p><span>        </span><span>.</span><span>toLowerCase</span><span>(</span><span>)</span></p></div><div><p><span>        </span><span>.</span><span>substring</span><span>(</span><span>2</span><span>)</span></p></div><div><p><span>      dom</span><span>.</span><span>addEventListener</span><span>(</span></p></div><div><p><span>        eventType</span><span>,</span></p></div><div><p><span>        nextProps</span><span>[</span><span>name</span><span>]</span></p></div><div><p><span>      </span><span>)</span></p></div><div><p><span>    </span><span>}</span><span>)</span></p></div><div><p><span>}</span></p></div><div><p><span>​</span></p></div><div><p><span>function</span><span> </span><span>commitRoot</span><span>(</span><span>)</span><span> </span><span>{</span></p></div><div><p><span>  deletions</span><span>.</span><span>forEach</span><span>(</span><span>commitWork</span><span>)</span></p></div><div><p><span>  </span><span>commitWork</span><span>(</span><span>wipRoot</span><span>.</span><span>child</span><span>)</span></p></div><div><p><span>  currentRoot </span><span>=</span><span> wipRoot</span></p></div><div><p><span>  wipRoot </span><span>=</span><span> </span><span>null</span></p></div><div><p><span>}</span></p></div><div><p><span>​</span></p></div><div><p><span>function</span><span> </span><span>commitWork</span><span>(</span><span>fiber</span><span>)</span><span> </span><span>{</span></p></div><div><p><span>  </span><span>if</span><span> </span><span>(</span><span>!</span><span>fiber</span><span>)</span><span> </span><span>{</span></p></div><div><p><span>    </span><span>return</span></p></div><div><p><span>  </span><span>}</span></p></div><div><p><span>​</span></p></div><div><p><span>  </span><span>const</span><span> domParent </span><span>=</span><span> fiber</span><span>.</span><span>parent</span><span>.</span><span>dom</span></p></div><div><p><span>  </span><span>if</span><span> </span><span>(</span></p></div><div><p><span>    fiber</span><span>.</span><span>effectTag </span><span>===</span><span> </span><span>"PLACEMENT"</span><span> </span><span>&amp;&amp;</span></p></div><div><p><span>    fiber</span><span>.</span><span>dom </span><span>!=</span><span> </span><span>null</span></p></div><div><p><span>  </span><span>)</span><span> </span><span>{</span></p></div><div><p><span>    domParent</span><span>.</span><span>appendChild</span><span>(</span><span>fiber</span><span>.</span><span>dom</span><span>)</span></p></div><div><p><span>  </span><span>}</span><span> </span><span>else</span><span> </span><span>if</span><span> </span><span>(</span></p></div><div><p><span>    fiber</span><span>.</span><span>effectTag </span><span>===</span><span> </span><span>"UPDATE"</span><span> </span><span>&amp;&amp;</span></p></div><div><p><span>    fiber</span><span>.</span><span>dom </span><span>!=</span><span> </span><span>null</span></p></div><div><p><span>  </span><span>)</span><span> </span><span>{</span></p></div><div><p><span>    </span><span>updateDom</span><span>(</span></p></div><div><p><span>      fiber</span><span>.</span><span>dom</span><span>,</span></p></div><div><p><span>      fiber</span><span>.</span><span>alternate</span><span>.</span><span>props</span><span>,</span></p></div><div><p><span>      fiber</span><span>.</span><span>props</span></p></div><div><p><span>    </span><span>)</span></p></div><div><p><span>  </span><span>}</span><span> </span><span>else</span><span> </span><span>if</span><span> </span><span>(</span><span>fiber</span><span>.</span><span>effectTag </span><span>===</span><span> </span><span>"DELETION"</span><span>)</span><span> </span><span>{</span></p></div><div><p><span>    domParent</span><span>.</span><span>removeChild</span><span>(</span><span>fiber</span><span>.</span><span>dom</span><span>)</span></p></div><div><p><span>  </span><span>}</span></p></div><div><p><span>​</span></p></div><div><p><span>  </span><span>commitWork</span><span>(</span><span>fiber</span><span>.</span><span>child</span><span>)</span></p></div><div><p><span>  </span><span>commitWork</span><span>(</span><span>fiber</span><span>.</span><span>sibling</span><span>)</span></p></div><div><p><span>}</span></p></div><div><p><span>​</span></p></div><div><p><span>function</span><span> </span><span>render</span><span>(</span><span>element</span><span>,</span><span> container</span><span>)</span><span> </span><span>{</span></p></div><div><p><span>  wipRoot </span><span>=</span><span> </span><span>{</span></p></div><div><p><span>    </span><span>dom</span><span>:</span><span> container</span><span>,</span></p></div><div><p><span>    </span><span>props</span><span>:</span><span> </span><span>{</span></p></div><div><p><span>      </span><span>children</span><span>:</span><span> </span><span>[</span><span>element</span><span>]</span><span>,</span></p></div><div><p><span>    </span><span>}</span><span>,</span></p></div><div><p><span>    </span><span>alternate</span><span>:</span><span> currentRoot</span><span>,</span></p></div><div><p><span>  </span><span>}</span></p></div><div><p><span>  deletions </span><span>=</span><span> </span><span>[</span><span>]</span></p></div><div><p><span>  nextUnitOfWork </span><span>=</span><span> wipRoot</span></p></div><div><p><span>}</span></p></div><div><p><span>​</span></p></div><div><p><span>let</span><span> nextUnitOfWork </span><span>=</span><span> </span><span>null</span></p></div><div><p><span>let</span><span> currentRoot </span><span>=</span><span> </span><span>null</span></p></div><div><p><span>let</span><span> wipRoot </span><span>=</span><span> </span><span>null</span></p></div><div><p><span>let</span><span> deletions </span><span>=</span><span> </span><span>null</span></p></div><div><p><span>​</span></p></div><div><p><span>function</span><span> </span><span>workLoop</span><span>(</span><span>deadline</span><span>)</span><span> </span><span>{</span></p></div><div><p><span>  </span><span>let</span><span> shouldYield </span><span>=</span><span> </span><span>false</span></p></div><div><p><span>  </span><span>while</span><span> </span><span>(</span><span>nextUnitOfWork </span><span>&amp;&amp;</span><span> </span><span>!</span><span>shouldYield</span><span>)</span><span> </span><span>{</span></p></div><div><p><span>    nextUnitOfWork </span><span>=</span><span> </span><span>performUnitOfWork</span><span>(</span></p></div><div><p><span>      nextUnitOfWork</span></p></div><div><p><span>    </span><span>)</span></p></div><div><p><span>    shouldYield </span><span>=</span><span> deadline</span><span>.</span><span>timeRemaining</span><span>(</span><span>)</span><span> </span><span>&lt;</span><span> </span><span>1</span></p></div><div><p><span>  </span><span>}</span></p></div><div><p><span>​</span></p></div><div><p><span>  </span><span>if</span><span> </span><span>(</span><span>!</span><span>nextUnitOfWork </span><span>&amp;&amp;</span><span> wipRoot</span><span>)</span><span> </span><span>{</span></p></div><div><p><span>    </span><span>commitRoot</span><span>(</span><span>)</span></p></div><div><p><span>  </span><span>}</span></p></div><div><p><span>​</span></p></div><div><p><span>  </span><span>requestIdleCallback</span><span>(</span><span>workLoop</span><span>)</span></p></div><div><p><span>}</span></p></div><div><p><span>​</span></p></div><div><p><span>requestIdleCallback</span><span>(</span><span>workLoop</span><span>)</span></p></div><div><p><span>​</span></p></div><div><p><span>function</span><span> </span><span>performUnitOfWork</span><span>(</span><span>fiber</span><span>)</span><span> </span><span>{</span></p></div><div><p><span>  </span><span>if</span><span> </span><span>(</span><span>!</span><span>fiber</span><span>.</span><span>dom</span><span>)</span><span> </span><span>{</span></p></div><div><p><span>    fiber</span><span>.</span><span>dom </span><span>=</span><span> </span><span>createDom</span><span>(</span><span>fiber</span><span>)</span></p></div><div><p><span>  </span><span>}</span></p></div><div><p><span>​</span></p></div><div><p><span>  </span><span>const</span><span> elements </span><span>=</span><span> fiber</span><span>.</span><span>props</span><span>.</span><span>children</span></p></div><div><p><span>  </span><span>reconcileChildren</span><span>(</span><span>fiber</span><span>,</span><span> elements</span><span>)</span></p></div><div><p><span>​</span></p></div><div><p><span>  </span><span>if</span><span> </span><span>(</span><span>fiber</span><span>.</span><span>child</span><span>)</span><span> </span><span>{</span></p></div><div><p><span>    </span><span>return</span><span> fiber</span><span>.</span><span>child</span></p></div><div><p><span>  </span><span>}</span></p></div><div><p><span>  </span><span>let</span><span> nextFiber </span><span>=</span><span> fiber</span></p></div><div><p><span>  </span><span>while</span><span> </span><span>(</span><span>nextFiber</span><span>)</span><span> </span><span>{</span></p></div><div><p><span>    </span><span>if</span><span> </span><span>(</span><span>nextFiber</span><span>.</span><span>sibling</span><span>)</span><span> </span><span>{</span></p></div><div><p><span>      </span><span>return</span><span> nextFiber</span><span>.</span><span>sibling</span></p></div><div><p><span>    </span><span>}</span></p></div><div><p><span>    nextFiber </span><span>=</span><span> nextFiber</span><span>.</span><span>parent</span></p></div><div><p><span>  </span><span>}</span></p></div><div><p><span>}</span></p></div><div><p><span>​</span></p></div><div><p><span>function</span><span> </span><span>reconcileChildren</span><span>(</span><span>wipFiber</span><span>,</span><span> elements</span><span>)</span><span> </span><span>{</span></p></div><div><p><span>  </span><span>let</span><span> index </span><span>=</span><span> </span><span>0</span></p></div><div><p><span>  </span><span>let</span><span> oldFiber </span><span>=</span></p></div><div><p><span>    wipFiber</span><span>.</span><span>alternate </span><span>&amp;&amp;</span><span> wipFiber</span><span>.</span><span>alternate</span><span>.</span><span>child</span></p></div><div><p><span>  </span><span>let</span><span> prevSibling </span><span>=</span><span> </span><span>null</span></p></div><div><p><span>​</span></p></div><div><p><span>  </span><span>while</span><span> </span><span>(</span></p></div><div><p><span>    index </span><span>&lt;</span><span> elements</span><span>.</span><span>length </span><span>||</span></p></div><div><p><span>    oldFiber </span><span>!=</span><span> </span><span>null</span></p></div><div><p><span>  </span><span>)</span><span> </span><span>{</span></p></div><div><p><span>    </span><span>const</span><span> element </span><span>=</span><span> elements</span><span>[</span><span>index</span><span>]</span></p></div><div><p><span>    </span><span>let</span><span> newFiber </span><span>=</span><span> </span><span>null</span></p></div><div><p><span>​</span></p></div><div><p><span>    </span><span>const</span><span> sameType </span><span>=</span></p></div><div><p><span>      oldFiber </span><span>&amp;&amp;</span></p></div><div><p><span>      element </span><span>&amp;&amp;</span></p></div><div><p><span>      element</span><span>.</span><span>type </span><span>==</span><span> oldFiber</span><span>.</span><span>type</span></p></div><div><p><span>​</span></p></div><div><p><span>    </span><span>if</span><span> </span><span>(</span><span>sameType</span><span>)</span><span> </span><span>{</span></p></div><div><p><span>      newFiber </span><span>=</span><span> </span><span>{</span></p></div><div><p><span>        </span><span>type</span><span>:</span><span> oldFiber</span><span>.</span><span>type</span><span>,</span></p></div><div><p><span>        </span><span>props</span><span>:</span><span> element</span><span>.</span><span>props</span><span>,</span></p></div><div><p><span>        </span><span>dom</span><span>:</span><span> oldFiber</span><span>.</span><span>dom</span><span>,</span></p></div><div><p><span>        </span><span>parent</span><span>:</span><span> wipFiber</span><span>,</span></p></div><div><p><span>        </span><span>alternate</span><span>:</span><span> oldFiber</span><span>,</span></p></div><div><p><span>        </span><span>effectTag</span><span>:</span><span> </span><span>"UPDATE"</span><span>,</span></p></div><div><p><span>      </span><span>}</span></p></div><div><p><span>    </span><span>}</span></p></div><div><p><span>    </span><span>if</span><span> </span><span>(</span><span>element </span><span>&amp;&amp;</span><span> </span><span>!</span><span>sameType</span><span>)</span><span> </span><span>{</span></p></div><div><p><span>      newFiber </span><span>=</span><span> </span><span>{</span></p></div><div><p><span>        </span><span>type</span><span>:</span><span> element</span><span>.</span><span>type</span><span>,</span></p></div><div><p><span>        </span><span>props</span><span>:</span><span> element</span><span>.</span><span>props</span><span>,</span></p></div><div><p><span>        </span><span>dom</span><span>:</span><span> </span><span>null</span><span>,</span></p></div><div><p><span>        </span><span>parent</span><span>:</span><span> wipFiber</span><span>,</span></p></div><div><p><span>        </span><span>alternate</span><span>:</span><span> </span><span>null</span><span>,</span></p></div><div><p><span>        </span><span>effectTag</span><span>:</span><span> </span><span>"PLACEMENT"</span><span>,</span></p></div><div><p><span>      </span><span>}</span></p></div><div><p><span>    </span><span>}</span></p></div><div><p><span>    </span><span>if</span><span> </span><span>(</span><span>oldFiber </span><span>&amp;&amp;</span><span> </span><span>!</span><span>sameType</span><span>)</span><span> </span><span>{</span></p></div><div><p><span>      oldFiber</span><span>.</span><span>effectTag </span><span>=</span><span> </span><span>"DELETION"</span></p></div><div><p><span>      deletions</span><span>.</span><span>push</span><span>(</span><span>oldFiber</span><span>)</span></p></div><div><p><span>    </span><span>}</span></p></div><div><p><span>​</span></p></div><div><p><span>    </span><span>if</span><span> </span><span>(</span><span>oldFiber</span><span>)</span><span> </span><span>{</span></p></div><div><p><span>      oldFiber </span><span>=</span><span> oldFiber</span><span>.</span><span>sibling</span></p></div><div><p><span>    </span><span>}</span></p></div><div><p><span>​</span></p></div><div><p><span>    </span><span>if</span><span> </span><span>(</span><span>index </span><span>===</span><span> </span><span>0</span><span>)</span><span> </span><span>{</span></p></div><div><p><span>      wipFiber</span><span>.</span><span>child </span><span>=</span><span> newFiber</span></p></div><div><p><span>    </span><span>}</span><span> </span><span>else</span><span> </span><span>if</span><span> </span><span>(</span><span>element</span><span>)</span><span> </span><span>{</span></p></div><div><p><span>      prevSibling</span><span>.</span><span>sibling </span><span>=</span><span> newFiber</span></p></div><div><p><span>    </span><span>}</span></p></div><div><p><span>​</span></p></div><div><p><span>    prevSibling </span><span>=</span><span> newFiber</span></p></div><div><p><span>    index</span><span>++</span></p></div><div><p><span>  </span><span>}</span></p></div><div><p><span>}</span></p></div><div><p><span>​</span></p></div><div><p><span>const</span><span> Didact </span><span>=</span><span> </span><span>{</span></p></div><div><p><span>  createElement</span><span>,</span></p></div><div><p><span>  render</span><span>,</span></p></div><div><p><span>}</span></p></div><div><p><span>​</span></p></div><div><p><span>/** @jsx Didact.createElement */</span></p></div><div><p><span>function</span><span> </span><span>App</span><span>(</span><span>props</span><span>)</span><span> </span><span>{</span></p></div><div><p><span>  </span><span>return</span><span> </span><span>&lt;</span><span>h1</span><span>&gt;</span><span>Hi </span><span>{</span><span>props</span><span>.</span><span>name</span><span>}</span><span>&lt;/</span><span>h1</span><span>&gt;</span></p></div><div><p><span>}</span></p></div><div><p><span>const</span><span> element </span><span>=</span><span> </span><span>&lt;</span><span>App</span><span> </span><span>name</span><span>=</span><span>"</span><span>foo</span><span>"</span><span> </span><span>/&gt;</span></p></div><div><p><span>const</span><span> container </span><span>=</span><span> document</span><span>.</span><span>getElementById</span><span>(</span><span>"root"</span><span>)</span></p></div><div><p><span>Didact</span><span>.</span><span>render</span><span>(</span><span>element</span><span>,</span><span> container</span><span>)</span></p></div></code></pre></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[PBS News Hour West to go dark after ASU discontinues contract (148 pts)]]></title>
            <link>https://www.statepress.com/article/2025/12/politics-pbs-newshour-west-closure</link>
            <guid>46332400</guid>
            <pubDate>Fri, 19 Dec 2025 23:59:53 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.statepress.com/article/2025/12/politics-pbs-newshour-west-closure">https://www.statepress.com/article/2025/12/politics-pbs-newshour-west-closure</a>, See on <a href="https://news.ycombinator.com/item?id=46332400">Hacker News</a></p>
<div id="readability-page-1" class="page"><article>
                        <div>

                                                            <p>ASU's Walter Cronkite School of Journalism and Mass Communication will not renew its contract with <a href="https://www.pbs.org/newshour/about/newshour-west" target="_blank">PBS News Hour West</a>, ending a reporting hub that covered the western U.S. and updated the nightly news produced on the East Coast for West Coast viewers.&nbsp;</p>
<p>Located on the Downtown Phoenix campus, the bureau offered internship opportunities for journalism students at the University.</p>
<p>The bureau was created to help the national News Hour program, which is broadcast by <a href="https://weta.org/" target="_blank">WETA</a>, "work more closely with PBS stations and other media partners on the West Coast," according to an <a href="https://cronkite.asu.edu/news/2019/pbs-newshour-announces-launch-of-pbs-newshour-west-at-asus-cronkite-school" target="_blank">ASU News</a> article announcing the launch of the bureau in 2019. More than 20% of News Hour's audience resides in that region.</p>
<p>News Hour West will make its last contribution to the national broadcast on Dec. 19.</p>

                                

                                <p>Michael Rancilio, the general manager of News Hour Productions and WETA's executive vice president and chief content officer, said in an email to PBS News supporters that the decision was "based on Arizona State University's revised priorities," according to <a href="https://current.org/2025/11/weta-to-cut-staff-cancel-pbs-news-weekend-and-close-news-hour-west-bureau/" target="_blank">Current</a>.</p>
<p><strong>READ MORE: </strong><a href="https://www.statepress.com/article/2025/06/politics-public-media-arizona-pbs-executive-order" target="_blank">Federal funding cuts to public media may impact Arizona PBS, students</a></p>
<p>A spokesperson for the University declined to comment on the closing, referring The State Press to PBS.&nbsp;</p>
<p>Both PBS News and Arizona PBS responded to the news of the closure but did not provide any reasoning for the choice.</p>
<p>"We are grateful to our partners at ASU and the Cronkite School on our effort to launch PBS News Hour West back in 2019 and the important journalism our small but nimble team there has been able to produce," PBS News' executive director of communications, Nick Massella, said in a written statement.</p>
<p>Jeremy Cauthen, the senior director of brand engagement and marketing at Arizona PBS, said in a written statement that the ASU-News Hour West partnership benefited audiences in the western U.S. as well as University students.</p>
<p>"Even though the station will no longer be providing production support for 'PBS News Hour', we'll continue our nightly broadcast of PBS' flagship news program and our ongoing commitment to keeping Arizonans informed through local news and public affairs programs like 'Arizona Horizon' and 'Horizonte,'" Cauthen said in a written statement.</p>
<p>AJ Ceglia, a senior studying journalism and mass communication, is one of the broadcast production interns at News Hour West. The internship was one of her first professional experiences, she said.</p>
<p>"I was just so relieved to find out that they were so willing to take the time to teach everything that we needed to know to produce the news at night," Ceglia said. "It's very upsetting to hear that it was shut down."</p>
<p>Ceglia said she was told that ASU made the decision, not PBS. She was only told that the contract was not being renewed and did not know any of the logistics of the closure.</p>

                                
                                                                                                    <p>The agreement between News Hour West and the University was mutually beneficial, Ceglia said. PBS got a headquarters in the West at a school with reliable broadcasting equipment, and the University's contributions were rewarded with heightened visibility.</p>
<p>An aerial shot of the Cronkite building is shown at the end of the nightly News Hour broadcast, crediting the school for its support.</p>
<p><iframe width="560" height="315" src="https://www.youtube.com/embed/458RXqTPebc?si=LgSOEDxIkaL5tMPd" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen=""></iframe></p>
<p>Ceglia said News Hour West staff members will lose their jobs because of the closure.</p>
                                
                                <p>"It's just upsetting that they really enjoyed being able to support the students that did the program, and they really liked being able to share so much experience," Ceglia said.</p>
<p>Ceglia said she sympathizes with the interns who were set to work at News Hour West for the spring semester because "they're having it basically ripped out of their hands." To fulfill the internship requirement to graduate with a journalism and mass communication degree, they must now find another way to gain those credits.</p>
<p>"It's not anything my producers can control, but what (the producers are) doing is they are really trying to put those soon-to-be interns to another place to work," Ceglia said. "That is something they're very focused on right now."</p>
<p>Current interns are still able to get the internship credit, Ceglia said. Nonetheless, the closure has had a personal impact on her.</p>
<p>"I feel so strongly about it because it really was a great opportunity to learn and one of my first real professional ones," Ceglia said. "I'm sad to see it go."</p>
<p><em>Edited by Carsten Oyer, Henry Smardo, Sophia Braccio and Pippa Fung.</em></p>
<hr>
<p>Reach the reporter at elbradfo@asu.edu and follow <a href="https://twitter.com/emmalbradford__" rel="noopener noreferrer" target="_blank">@emmalbradford__</a> on X.</p>
                                <p>Like <a href="https://www.facebook.com/StatePress/" rel="noopener noreferrer" target="_blank">The State Press</a> on Facebook and follow <a href="https://twitter.com/statepress" rel="noopener noreferrer" target="_blank">@statepress</a> on X.</p>

                            
                            <div>
                                    
            <hr>
        <div><p><strong>Emma Bradford</strong><span>Lead Politics Reporter</span>
</p></div>
<div>
<p>Emma Bradford is a junior studying journalism and mass communication and political science with a minor in business. She has previously worked at the Cronkite News Washington, D.C. bureau as a Politics and Money Reporter. Bradford is in her fourth semester with The State Press and on the politics desk.&nbsp;</p>
<ul><li><a href="mailto:elbradfo@asu.edu">elbradfo@asu.edu</a></li></ul>
</div>
    
                            </div>

                            <hr>

                            <div><p>
                                Continue supporting student journalism and </p><a href="https://www.asufoundation.org/arts-and-community/the-state-press-CA124731.html" target="_blank"><u>donate</u></a><p> to The State Press today.
                            </p></div>

                            

                            <hr>
                            
                        </div>
                    </article></div>]]></description>
        </item>
        <item>
            <title><![CDATA[CSS Grid Lanes (685 pts)]]></title>
            <link>https://webkit.org/blog/17660/introducing-css-grid-lanes/</link>
            <guid>46331586</guid>
            <pubDate>Fri, 19 Dec 2025 22:13:06 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://webkit.org/blog/17660/introducing-css-grid-lanes/">https://webkit.org/blog/17660/introducing-css-grid-lanes/</a>, See on <a href="https://news.ycombinator.com/item?id=46331586">Hacker News</a></p>
<div id="readability-page-1" class="page"><article id="post-17660">
            
            

            <div>
                                
                <p>It’s here, the future of masonry layouts on the web! After the groundwork laid by Mozilla, years of effort by Apple’s WebKit team, and many rounds debate at the CSS Working Group with all the browsers, it’s now clear how it works.</p>
<p>Introducing CSS Grid Lanes.</p>
<pre><code><span>.container</span> {
  <span>display</span>: <span>grid-lanes</span>;
  <span>grid-template-columns</span>: <span>repeat</span>(<span>auto-fill</span>, <span>minmax</span>(<span>250px</span>, <span>1</span><span>fr</span>));
  <span>gap</span>: <span>16px</span>;
}
</code></pre>
<p>Try it today in Safari Technology Preview 234.</p>
<h2>How Grid Lanes work</h2>
<p>Let’s break down exactly how to create this classic layout.</p>
<figure><picture><source srcset="https://webkit.org/wp-content/uploads/Grid-Lanes-classic-dark.png" type="image/png" media="(prefers-color-scheme: dark)"><img fetchpriority="high" decoding="async" src="https://webkit.org/wp-content/uploads/Grid-Lanes-classic-light.png" alt="Classic masonry-style layout of photos of various aspect ratios, all the same width, aligned in six columns" width="2000" height="1311" srcset="https://webkit.org/wp-content/uploads/Grid-Lanes-classic-light.png 2000w, https://webkit.org/wp-content/uploads/Grid-Lanes-classic-light-300x197.png 300w, https://webkit.org/wp-content/uploads/Grid-Lanes-classic-light-1024x671.png 1024w, https://webkit.org/wp-content/uploads/Grid-Lanes-classic-light-768x503.png 768w, https://webkit.org/wp-content/uploads/Grid-Lanes-classic-light-1536x1007.png 1536w" sizes="(max-width: 2000px) 100vw, 2000px"></picture><figcaption>You can try out this <a href="https://webkit.org/demos/grid3/photos/">demo of photo gallery layouts</a> today in Safari Technology Preview.</figcaption></figure>
<p>First, the HTML.</p>
<pre><code><span>&lt;<span>main</span> <span>class</span>=<span>"container"</span>&gt;</span>
  <span>&lt;<span>figure</span>&gt;</span><span>&lt;<span>img</span> <span>src</span>=<span>"photo-1.jpg"</span>&gt;</span><span>&lt;/<span>figure</span>&gt;</span>
  <span>&lt;<span>figure</span>&gt;</span><span>&lt;<span>img</span> <span>src</span>=<span>"photo-2.jpg"</span>&gt;</span><span>&lt;/<span>figure</span>&gt;</span>
  <span>&lt;<span>figure</span>&gt;</span><span>&lt;<span>img</span> <span>src</span>=<span>"photo-3.jpg"</span>&gt;</span><span>&lt;/<span>figure</span>&gt;</span>
  <span>&lt;!-- etc --&gt;</span>
<span>&lt;/<span>main</span>&gt;</span>
</code></pre>
<p>Let’s start by applying <code>display: grid-lanes</code> to the <code>main</code> element to create a Grid container ready to make this kind of layout. Then we use <code>grid-template-columns</code> to create the “lanes” with the full power of CSS Grid.</p>
<p>In this case, we’ll use <code>repeat(auto-fill, minmax(250px, 1fr))</code> to create flexible columns at least 250 pixels wide. The browser will decide how many columns to make, filling all available space.</p>
<p>And then, <code>gap: 16px</code> gives us 16 pixel gaps between the lanes, and 16 pixel gaps between items within the lanes.</p>
<pre><code><span>.container</span> {
  <span>display</span>: <span>grid-lanes</span>;
  <span>grid-template-columns</span>: <span>repeat</span>(<span>auto-fill</span>, <span>minmax</span>(<span>250px</span>, <span>1</span><span>fr</span>));
  <span>gap</span>: <span>16px</span>;
}
</code></pre>
<p>That’s it! In three lines of CSS, with zero media queries or container queries, we created a flexible layout that works on all screen sizes.</p>
<p>Think of it like a highway of cars in bumper-to-bumper traffic.</p>
<figure><img decoding="async" src="https://webkit.org/wp-content/uploads/Grid-Lanes-in-STP234.png" alt="Cartoon drawing of a highway from above. Nine cars fill four lanes of traffic, bumper to bumper. Each car has a number labeling it, showing the order these would be in HTML." width="1920" height="1080" srcset="https://webkit.org/wp-content/uploads/Grid-Lanes-in-STP234.png 1920w, https://webkit.org/wp-content/uploads/Grid-Lanes-in-STP234-300x169.png 300w, https://webkit.org/wp-content/uploads/Grid-Lanes-in-STP234-1024x576.png 1024w, https://webkit.org/wp-content/uploads/Grid-Lanes-in-STP234-768x432.png 768w, https://webkit.org/wp-content/uploads/Grid-Lanes-in-STP234-1536x864.png 1536w" sizes="(max-width: 1920px) 100vw, 1920px"></figure>
<p>Just like the classic <a href="https://masonry.desandro.com/">Masonry library</a>, as the browser decides where to put each item, the next one is placed in whichever column gets it closest to the top of the window. Like traffic, each car “changes lanes” to end up in the lane that gets them “the furthest ahead”.</p>
<p>This layout makes it possible for users to tab across the lanes to all currently-visible content, (not down the first column below the fold to the very bottom, and then back to the top of the second column). It also makes it possible for you to build a site that keeps loading more content as the user scrolls, infinitely, without needing JavaScript to handle the layout.</p>
<h2>The power of Grid</h2>
<h3>Varying lane sizes</h3>
<p>Because Grid Lanes uses the full power of CSS Grid to define lanes using <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Reference/Properties/grid-template-columns"><code>grid-template-*</code></a>, it’s easy to create creative design variations.</p>
<p>For example, we can create a flexible layout with alternating narrow and wide columns — where both the first and last columns are always narrow, even as the number of columns changes with the viewport size. This is accomplished with <code>grid-template-columns: repeat(auto-fill, minmax(8rem, 1fr) minmax(16rem, 2fr)) minmax(8rem, 1fr)</code>.</p>
<figure><picture><source srcset="https://webkit.org/wp-content/uploads/Grid-Lanes-varying-widths-dark.png" type="image/png" media="(prefers-color-scheme: dark)"><img decoding="async" src="https://webkit.org/wp-content/uploads/Grid-Lanes-varying-widths-light.png" alt="Demo layout of photos, where the 1st, 3rd, 5th, and 7th column are narrow, while the 2nd, 4th and 6th columns are twice as wide. " width="2000" height="1311" srcset="https://webkit.org/wp-content/uploads/Grid-Lanes-varying-widths-light.png 2000w, https://webkit.org/wp-content/uploads/Grid-Lanes-varying-widths-light-300x197.png 300w, https://webkit.org/wp-content/uploads/Grid-Lanes-varying-widths-light-1024x671.png 1024w, https://webkit.org/wp-content/uploads/Grid-Lanes-varying-widths-light-768x503.png 768w, https://webkit.org/wp-content/uploads/Grid-Lanes-varying-widths-light-1536x1007.png 1536w" sizes="(max-width: 2000px) 100vw, 2000px"></picture><figcaption>Try out the <a href="https://webkit.org/demos/grid3/photos/">demo of photo gallery layouts</a> today in Safari Technology Preview.</figcaption></figure>
<p>There’s a whole world of possibilities using <code>grid-template-*</code> syntax.</p>
<h4>Spanning items</h4>
<p>Since we have the full power of Grid layout, we can also span lanes, of course.</p>
<figure><picture><source srcset="https://webkit.org/wp-content/uploads/Grid-Lanes-newspaper-demo-dark.png" type="image/png" media="(prefers-color-scheme: dark)"><img loading="lazy" decoding="async" src="https://webkit.org/wp-content/uploads/Grid-Lanes-newspaper-demo-light.png" alt="A complex layout of titles with teaser text for over two dozen articles — telling people what they'll experience if they open the article. The first teaser has a very large headline with text, and spans four columns. Five more teasers are medium-sized, bowl and next to the hero. The rest of the space available is filled in with small teasers. None of the teasers have the same amount of content as the rest. The heights of each box are random, and the layout tucks each box up against the one above it." width="2000" height="1394" srcset="https://webkit.org/wp-content/uploads/Grid-Lanes-newspaper-demo-light.png 2000w, https://webkit.org/wp-content/uploads/Grid-Lanes-newspaper-demo-light-300x209.png 300w, https://webkit.org/wp-content/uploads/Grid-Lanes-newspaper-demo-light-1024x714.png 1024w, https://webkit.org/wp-content/uploads/Grid-Lanes-newspaper-demo-light-768x535.png 768w, https://webkit.org/wp-content/uploads/Grid-Lanes-newspaper-demo-light-1536x1071.png 1536w" sizes="auto, (max-width: 2000px) 100vw, 2000px"></picture><figcaption>Try out the <a href="https://webkit.org/demos/grid3/newspaper/">demo of newspaper article layout</a> today in Safari Technology Preview.</figcaption></figure>
<pre><code><span>main</span> {
  <span>display</span>: <span>grid-lanes</span>;
  <span>grid-template-columns</span>: <span>repeat</span>(<span>auto-fill</span>, <span>minmax</span>(<span>20</span><span>ch</span>, <span>1</span><span>fr</span>));
  <span>gap</span>: <span>2</span><span>lh</span>;
}
<span>article</span> { 
  <span>grid-column</span>: <span>span</span> <span>1</span>; 
}
<span>@media</span> (1250<span>px</span> &lt; <span>width</span>) {
  <span>article</span>:<span>nth-child</span>(<span>1</span>) { 
    <span>grid-column</span>: <span>span</span> <span>4</span>;             
  }
  <span>article</span><span>:nth-child</span>(2), <span>article</span><span>:nth-child</span>(3), <span>article</span><span>:nth-child</span>(4), <span>article</span><span>:nth-child</span>(5), <span>article</span><span>:nth-child</span>(6), <span>article</span><span>:nth-child</span>(7), <span>article</span><span>:nth-child</span>(8) { 
    <span>grid-column</span>: <span>span</span> <span>2</span>; 
  }
}
</code></pre>
<p>All the article teasers are first set to span 1 column. Then the 1st item is specifically told to span 4 columns, while the 2nd – 8th to span 2 columns. This creates a far more dynamic graphic design than the typical symmetrical, everything the same-width, everything the same-height layout that’s dominated over the last decade.</p>
<h3>Placing items</h3>
<p>We can also explicitly place items while using Grid Lanes. Here, the header is always placed in the last column, no matter how many columns exist.</p>
<figure><img loading="lazy" decoding="async" src="https://webkit.org/wp-content/uploads/Grid-Lanes-museum.png" alt="A layout of paintings —&nbsp;each has a bit of text below the painting: title, etc. The paintings are laid out in 8 columns. Over on the right, spanning across two columns is the header of the website. " width="2000" height="1279" srcset="https://webkit.org/wp-content/uploads/Grid-Lanes-museum.png 2000w, https://webkit.org/wp-content/uploads/Grid-Lanes-museum-300x192.png 300w, https://webkit.org/wp-content/uploads/Grid-Lanes-museum-1024x655.png 1024w, https://webkit.org/wp-content/uploads/Grid-Lanes-museum-768x491.png 768w, https://webkit.org/wp-content/uploads/Grid-Lanes-museum-1536x982.png 1536w" sizes="auto, (max-width: 2000px) 100vw, 2000px"><figcaption>Try out the <a href="https://webkit.org/demos/grid3/museum/">demo of a museum website layout</a> today in Safari Technology Preview.</figcaption></figure>
<pre><code><span>main</span> {
  <span>display</span>: <span>grid-lanes</span>;
  <span>grid-template-columns</span>: <span>repeat</span>(<span>auto-fill</span>, <span>minmax</span>(<span>24</span><span>ch</span>, <span>1</span><span>fr</span>));
}
<span>header</span> {
  <span>grid-column</span>: <span>-3</span> / <span>-1</span>;
}
</code></pre>
<h2>Changing directions</h2>
<p>Yes, lanes can go either direction! All of the examples above happen to create a “waterfall” shape, where the content is laid out in columns. But Grid Lanes can be used to create a layout in the other direction, in a “brick” layout shape.</p>
<figure><img loading="lazy" decoding="async" src="https://webkit.org/wp-content/uploads/Grid-Lanes-waterfall-v-brick-layout.png" alt="Contrasting cartoon drawings: on the left, waterfall layout with boxes lined up in columns, falling down the page. And &quot;brick&quot; layout, with boxes flowing left to right, stacked like bricks in rows." width="1920" height="1080" srcset="https://webkit.org/wp-content/uploads/Grid-Lanes-waterfall-v-brick-layout.png 1920w, https://webkit.org/wp-content/uploads/Grid-Lanes-waterfall-v-brick-layout-300x169.png 300w, https://webkit.org/wp-content/uploads/Grid-Lanes-waterfall-v-brick-layout-1024x576.png 1024w, https://webkit.org/wp-content/uploads/Grid-Lanes-waterfall-v-brick-layout-768x432.png 768w, https://webkit.org/wp-content/uploads/Grid-Lanes-waterfall-v-brick-layout-1536x864.png 1536w" sizes="auto, (max-width: 1920px) 100vw, 1920px"></figure>
<p>The browser automatically creates a waterfall layout when you define columns with <code>grid-template-columns</code>, like this:</p>
<pre><code><span>.container</span> {
  <span>display</span>: <span>grid-lanes</span>;
  <span>grid-template-columns</span>: <span>1</span><span>fr</span> <span>1</span><span>fr</span> <span>1</span><span>fr</span> <span>1</span><span>fr</span>;
}
</code></pre>
<p>If you want a brick layout in the other direction, instead define the rows with <code>grid-template-rows</code>:</p>
<pre><code><span>.container</span> {
  <span>display</span>: <span>grid-lanes</span>;
  <span>grid-template-rows</span>: <span>1</span><span>fr</span> <span>1</span><span>fr</span> <span>1</span><span>fr</span>;
}
</code></pre>
<p>This works automatically thanks to a new default for<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Reference/Properties/grid-auto-flow"><code>grid-auto-flow</code></a>, the <code>normal</code> value.  It figures out whether to create columns or rows based on whether you defined the lanes using <code>grid-template-columns</code> or <code>grid-template-rows</code>.</p>
<p>The CSS Working Group is still discussing which property will explicitly control the flow orientation, and what its syntax will be. The debate is over whether to reuse <code>grid-auto-flow</code> or create new properties like <code>grid-lanes-direction</code>. If you’re interested in reading about the options being considered or chime in with your thoughts, see <a href="https://github.com/w3c/csswg-drafts/issues/12803#issuecomment-3643945412">this discussion</a>.</p>
<p>However, since <code>normal</code> will be the initial value either way, you don’t have to wait for this decision to learn Grid Lanes. When you define only one direction — <code>grid-template-rows</code> <em>or</em> <code>grid-template-columns</code> — it will Just Work™. (If it doesn’t, check if <code>grid-auto-flow</code> is set to a conflicting value. You can<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Reference/Values/unset"><code>unset</code></a> it if needed.)</p>
<h2>Placement sensitivity</h2>
<p>“Tolerance” is a new concept created for Grid Lanes. It lets you adjust just how picky the layout algorithm is when deciding where to place items.</p>
<p>Look at the next drawing. Notice that Car 4 is a tiny bit shorter than Car 1. When the “tolerance” is zero, Car 6 ends up in the right-most lane, while Car 7 is on the left. Car 6 ends up behind Car 4 on the right because that gets it a tiny bit closer “down the road” (closer to the top of the Grid container). Car 7 then takes the next-closest-to-the-top slot, and ends up behind Car 1 on the left. The end result? The first horizontal grouping of content is ordered 1, 2, 3, 4, and the next is 7, 5, 6.</p>
<figure><img loading="lazy" decoding="async" src="https://webkit.org/wp-content/uploads/Grid-Lanes-tolerance-1.png" alt="Same cartoon drawing of the highway of bumper to bumper traffic from above." width="1920" height="1080" srcset="https://webkit.org/wp-content/uploads/Grid-Lanes-tolerance-1.png 1920w, https://webkit.org/wp-content/uploads/Grid-Lanes-tolerance-1-300x169.png 300w, https://webkit.org/wp-content/uploads/Grid-Lanes-tolerance-1-1024x576.png 1024w, https://webkit.org/wp-content/uploads/Grid-Lanes-tolerance-1-768x432.png 768w, https://webkit.org/wp-content/uploads/Grid-Lanes-tolerance-1-1536x864.png 1536w" sizes="auto, (max-width: 1920px) 100vw, 1920px"></figure>
<p>But the difference in length between Car 1 and Car 4 is tiny. Car 6 isn’t meaningfully closer to the top of the page. And having item 6 on the right, with item 7 on the left is likely an unexpected experience — especially for users who are tabbing through content, or when the content order is somehow labeled.</p>
<p>These tiny differences in size don’t matter in any practical sense. Instead, the browser should consider item sizes like Car 1 and Car 4 to be a tie. That’s why the default for <code>item-tolerance</code> is <code>1em</code> — which means only differences in content length greater than 1 em will matter when figuring out where the next item goes.</p>
<p>If you’d like the layout of items to shuffle around less, you can set a higher value for <code>item-tolerance</code>. In the next digram, the tolerance is set to half-a-car, causing the cars to lay out basically from left to right and only moving to another lane to avoid the extra-long limo. Now, the horizontal groupings of content are 1, 2, 3, 4, and 5, 6, 7.</p>
<figure><img loading="lazy" decoding="async" src="https://webkit.org/wp-content/uploads/Grid-Lanes-tolerance-2.png" alt="Now the highway has the cars ordered in a fashion that's less chaotic." width="1920" height="1080" srcset="https://webkit.org/wp-content/uploads/Grid-Lanes-tolerance-2.png 1920w, https://webkit.org/wp-content/uploads/Grid-Lanes-tolerance-2-300x169.png 300w, https://webkit.org/wp-content/uploads/Grid-Lanes-tolerance-2-1024x576.png 1024w, https://webkit.org/wp-content/uploads/Grid-Lanes-tolerance-2-768x432.png 768w, https://webkit.org/wp-content/uploads/Grid-Lanes-tolerance-2-1536x864.png 1536w" sizes="auto, (max-width: 1920px) 100vw, 1920px"></figure>
<p>Think of tolerance as how chill you want the car drivers to be. Will they change lanes to get just a few inches ahead? Or will they only move if there’s a lot of space in the other lane? The amount of space you want them to care about is the amount you set in <code>item-tolerance</code>.</p>
<p>Remember that people tabbing through the page will see each item highlighted as it comes into focus, and may be experiencing the page through a screenreader. An item tolerance that’s set too high can create an awkward experience jumping up and down the layout. An item tolerance that’s too low can result in jumping back and forth across the layout more than necessary. Adjust <code>item-tolerance</code> to something appropriate for the sizes and size variations of your content.</p>
<p>Currently, this property is named <code>item-tolerance</code> in the <a href="https://www.w3.org/TR/css-grid-3/#placement-tolerance">specification</a> and in Safari Technology Preview 234. However, there is still a chance this name will change, perhaps to something like <code>flow-tolerance</code> or <code>pack-tolerance</code>. If you have a preference, or ideas for a better name, you can <a href="https://github.com/w3c/csswg-drafts/issues/10884#issuecomment-3658059682">chime in here</a>. Keep an eye out for updates about the final name before using this property on production websites.</p>
<h2>Try it out</h2>
<p>Try out Grid Lanes in Safari Technology Preview 234! All of the demos at  <a href="https://webkit.org/demos/grid3/">webkit.org/demos/grid3</a> have been updated with the new syntax, including other use cases for Grid Lanes. It’s not just for images! For example, a mega menu footer full of links suddenly becomes easy to layout.</p>
<figure><picture><source srcset="https://webkit.org/wp-content/uploads/Grid-Lanes-mega-menu-dark.png" type="image/png" media="(prefers-color-scheme: dark)"><img loading="lazy" decoding="async" src="https://webkit.org/wp-content/uploads/Grid-Lanes-mega-menu-light.png" alt="A layout of 15 groups of links. Each has between two and nine links in the group —&nbsp;so they are all very different heights from each other. The layout has five columns of these groups, where each group just comes right after the group above it. Without any regard for rows.  " width="2000" height="1164" srcset="https://webkit.org/wp-content/uploads/Grid-Lanes-mega-menu-light.png 2000w, https://webkit.org/wp-content/uploads/Grid-Lanes-mega-menu-light-300x175.png 300w, https://webkit.org/wp-content/uploads/Grid-Lanes-mega-menu-light-1024x596.png 1024w, https://webkit.org/wp-content/uploads/Grid-Lanes-mega-menu-light-768x447.png 768w, https://webkit.org/wp-content/uploads/Grid-Lanes-mega-menu-light-1536x894.png 1536w" sizes="auto, (max-width: 2000px) 100vw, 2000px"></picture><figcaption>Try out the <a href="https://webkit.org/demos/grid3/megamenu/">mega menu demo</a> today in Safari Technology Preview.</figcaption></figure>
<pre><code><span>.container</span> {
  <span>display</span>: <span>grid-lanes</span>;
  <span>grid-template-columns</span>: <span>repeat</span>(<span>auto-fill</span>, <span>minmax</span>(<span>max-content</span>, <span>24</span><span>ch</span>));
  <span>column-gap</span>: <span>4</span><span>lh</span>;
}
</code></pre>
<h2>What’s next?</h2>
<p>There are a few last decisions for the CSS Working Group to make. But overall, the feature as described in this article is ready to go. It’s time to try it out. And it’s finally safe to commit the basic syntax to memory!</p>
<p>We’d love for you to make some demos! Demonstrate what new use cases you can imagine. And let us know about any bugs or possible improvements you discover. Ping Jen Simmons on <a href="https://bsky.app/profile/jensimmons.bsky.social">Bluesky</a> or <a href="https://front-end.social/@jensimmons">Mastodon</a> with links, comments and ideas.</p>
<p>Our team has been working on this since mid-2022, implementing in WebKit and writing the web standard. We can’t wait to see what you will do with it.</p>

                            </div>
        </article></div>]]></description>
        </item>
        <item>
            <title><![CDATA[A Better Zip Bomb (167 pts)]]></title>
            <link>https://www.bamsoftware.com/hacks/zipbomb/</link>
            <guid>46331216</guid>
            <pubDate>Fri, 19 Dec 2025 21:34:10 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.bamsoftware.com/hacks/zipbomb/">https://www.bamsoftware.com/hacks/zipbomb/</a>, See on <a href="https://news.ycombinator.com/item?id=46331216">Hacker News</a></p>
<div id="readability-page-1" class="page"><article>

<header>


<address id="contact">
<p>
David Fifield<br>
<a href="mailto:david@bamsoftware.com">david@bamsoftware.com</a>
</p>
</address>

<p>
<time>2019-07-02</time>
<small>updated <time>2019-07-03</time>, <time>2019-07-05</time>, <time>2019-07-06</time>, <time>2019-07-08</time>,
<time>2019-07-18</time>, <time>2019-07-20</time>, <time>2019-07-22</time>, <time>2019-07-24</time>,
<time>2019-08-05</time>, <time>2019-08-19</time>, <time>2019-08-22</time>, <time>2019-10-14</time>,
<time>2019-10-18</time>, <time>2019-10-30</time>, <a href="#xfinity"><time>2019-11-28</time></a>,
<a href="#flytech"><time>2020-07-28</time></a>, <time>2021-01-21</time>, <time>2021-02-02</time>,
<a href="#ios"><time>2021-05-03</time></a>, <time>2021-07-29</time>,
<a href="#42.zip-tld"><time>2023-05-18</time></a>
</small>
</p>
</header>

<section id="summary">
<h2>Summary</h2>

<p>
This article shows how to construct a
<em>non-recursive</em> <a href="https://en.wikipedia.org/wiki/Zip_bomb">zip bomb</a>
that achieves a high compression ratio by
overlapping files inside the zip container.
"Non-recursive" means that it does not rely on
a decompressor's recursively unpacking zip files nested within zip files:
it expands fully after a single round of decompression.
The output size increases quadratically in the input size,
reaching a compression ratio of over <data value="28442385.9286689">28&nbsp;million</data>
(<data value="9893525">10&nbsp;<abbr title="megabyte">MB</abbr></data> → <data value="281395456244934">281&nbsp;<abbr title="terabyte">TB</abbr></data>)
at the limits of the zip format.
Even greater expansion is possible using
64-bit extensions.
The construction uses only the most common compression algorithm, DEFLATE,
and is compatible with most zip parsers.
</p>



<dl id="source">
<dt>Source code:</dt>
<dd>
<pre>git clone https://www.bamsoftware.com/git/zipbomb.git</pre>
<a href="https://www.bamsoftware.com/hacks/zipbomb/zipbomb-20210121.zip">zipbomb-20210121.zip</a>
</dd>
<dt>Data and source for figures:</dt>
<dd>
<pre>git clone https://www.bamsoftware.com/git/zipbomb-paper.git</pre>
</dd>
</dl>

<p>
<a href="https://www.bamsoftware.com/talks/woot19-zipbomb/">Presentation video</a>
</p>

<p>
<a href="https://habr.com/ru/post/459254/">Русский перевод</a> от <a href="https://habr.com/en/users/m1rko/">@m1rko</a>.
</p>
<p>
<a href="https://zerosun.top/2019/07/07/A-better-zip-bomb/">中文翻译</a>: 北岸冷若冰霜.
</p>
<!-- https://blog.csdn.net/u013469753/article/details/106298143 -->
</section>

<section id="introduction">

<table id="comparison">

<!--
Uncompressed size of 42.zip not including intermediate files, only final 0.dll:
>>> 16*16*16*16*16*4294967295
4503599626321920
Uncompressed size of 42.zip including all intermediate files:
>>> 16*(34902 + 16*(29446 + 16*(32150 + 16*(165302 + 16*(4168266 + 4294967295)))))
4507981343026016
-->

<caption id="42-note">
<ul>
<li>
There are two versions of 42.zip,
an <a href="https://web.archive.org/web/20120222083624/http://www.unforgettable.dk/">older version</a> of <data value="42374">42 374</data> bytes,
and a <a href="https://web.archive.org/web/20120301154142/http://www.unforgettable.dk/">newer version</a> of <data value="42838">42 838</data> bytes.
The difference is that the newer version requires a password before unzipping.
We compare only against the older version.
Here is a copy if you need it:
<a href="https://www.bamsoftware.com/hacks/zipbomb/42.zip" download="">42.zip</a>.
</li>
</ul>

</caption>

<thead>
<tr>
<td colspan="2"></td>
<th colspan="2">non-recursive</th>
<th colspan="2">recursive</th>
</tr>
<tr>
<td></td>
<th>zipped size</th>
<th>unzipped size</th>
<th>ratio</th>
<th>unzipped size</th>
<th>ratio</th>
</tr>
</thead>

<tbody>
<tr>
<th><a href="https://research.swtch.com/zip">Cox quine</a></th>
<td><data value="440">440</data></td>
<td><data value="440">440</data></td>
<td><data value="1.0">1.0</data></td>
<td><data value="∞">∞</data></td>
<td><data value="∞">∞</data></td>
</tr>

<tr>
<th><a href="https://web.archive.org/web/20160130230432/http://www.steike.com/code/useless/zip-file-quine/">Ellingsen quine</a></th>
<td><data value="28809">28 809</data></td>
<td><data value="42569">42 569</data></td>
<td><data value="1.4776285188656322">1.5</data></td>
<td><data value="∞">∞</data></td>
<td><data value="∞">∞</data></td>
</tr>

<tr>
<th><a href="https://www.unforgettable.dk/">42.zip</a></th>
<td><a href="#42-note">*</a><data value="42374">42 374</data></td>
<td><data value="558432">558 432</data></td>
<td><data value="13.17864728371171">13.2</data></td>
<td><data value="4507981343026016">4 507 981 343 026 016</data></td>
<td><data value="106385551116.86449">106 billion</data></td>
</tr>

<tr>
<th>this technique</th>
<td><data value="42374">42 374</data></td>
<td><data value="5461307620">5 461 307 620</data></td>
<td><data value="128883.45730872705">129 thousand</data></td>
<td><data value="5461307620">5 461 307 620</data></td>
<td><data value="128883.45730872705">129 thousand</data></td>
</tr>

<tr>
<th>this technique</th>
<td><data value="9893525">9 893 525</data></td>
<td><data value="281395456244934">281 395 456 244 934</data></td>
<td><data value="28442385.9286689">28 million</data></td>
<td><data value="281395456244934">281 395 456 244 934</data></td>
<td><data value="28442385.9286689">28 million</data></td>
</tr>

<tr>
<th>this technique <small>(Zip64)</small></th>
<td><data value="45876952">45 876 952</data></td>
<td><data value="4507981427706459">4 507 981 427 706 459</data></td>
<td><data value="98262444.01996146">98 million</data></td>
<td><data value="4507981427706459">4 507 981 427 706 459</data></td>
<td><data value="98262444.01996146">98 million</data></td>
</tr>

<!--
<tr>
<th>this technique<br><small>(Zip64, less compatible)</small></th>
<td><data value="2961656712">2 961 656 712</data></td>
<td class=nonrec><data value="18446744085437447493">18 446 744 085 437 447 493</data></td>
<td class=nonrec><data value="6228522033.190134">6 billion</data></td>
<td class=rec><data value="18446744085437447493">18 446 744 085 437 447 493</data></td>
<td class=rec><data value="6228522033.190134">6 billion</data></td>
</tr>
-->

</tbody>

</table>





<p>
Compression bombs that use the zip format
must cope with the fact that DEFLATE,
the compression algorithm most commonly supported by zip parsers,
<a href="https://www.zlib.net/zlib_tech.html">cannot achieve</a> a compression ratio greater than 1032.
For this reason, zip bombs typically rely on recursive decompression,
nesting zip files within zip files to get an extra factor of 1032 with each layer.
But the trick only works on implementations that
unzip recursively, and most do not.
The best-known zip bomb,
<a href="https://www.unforgettable.dk/">42.zip</a>,
expands to a formidable <data value="4507981343026016">4.5&nbsp;<abbr title="petabyte">PB</abbr></data>
if all six of its layers are recursively unzipped,
but a trifling <data value="558432">0.6&nbsp;<abbr title="megabyte">MB</abbr></data> at the top layer.
Zip quines,
like those of <a href="https://web.archive.org/web/20160130230432/http://www.steike.com/code/useless/zip-file-quine/">Ellingsen</a>
and <a href="https://research.swtch.com/zip">Cox</a>,
which contain a copy of themselves
and thus expand infinitely if recursively unzipped,
are likewise perfectly safe to unzip once.
</p>

<p>
This article shows how to construct a non-recursive zip bomb
whose compression ratio surpasses the DEFLATE limit of 1032.
It works by overlapping files inside the zip container,
in order to reference a "kernel" of highly compressed data
in multiple files,
without making multiple copies of it.
The zip bomb's output size grows quadratically in the input size; i.e.,
the compression ratio gets better as the bomb gets bigger.
The construction depends on features of both zip and DEFLATE—it
is not directly portable to other file formats or compression algorithms.
It is compatible with most zip parsers,
the exceptions being "streaming" parsers that
parse in one pass without first consulting the zip file's central directory.
We try to balance
two conflicting goals:
</p>

<ul>
<li>
Maximize the compression ratio.
We define the compression ratio as the the sum of the sizes
of all the files contained the in the zip file,
divided by the size of the zip file itself.
It does not count filenames or other filesystem metadata,
only contents.
</li>
<li>
Be compatible.
Zip is a tricky format and parsers differ, especially
around edge cases and optional features.
Avoid taking advantage of tricks that only work with certain parsers.
We will remark on certain ways to increase the efficiency of the zip bomb
that come with some loss of compatibility.
</li>
</ul>

</section>

<section id="zip">
<h2>Structure of a zip file</h2>

<p>
A&nbsp;zip file consists of
a <em>central directory</em> which references
<em>files</em>.
</p>

<figure id="fig-normal">
<picture>
<source srcset="https://www.bamsoftware.com/hacks/zipbomb/normal.svg" type="image/svg+xml">
<img src="https://www.bamsoftware.com/hacks/zipbomb/normal.png" alt="A block diagram of the structure of a zip file. The central directory header consists of three central directory headers labeled CDH[1] (README), CDH[1] (Makefile), and CDH[3] (demo.c). The central directory headers point backwards to three local file headers LFH[1] (README), LFH[2] (Makefile), and LFH[3] (demo.c). Each local file header is joined with file data. The three joined blocks of (local file header, file data) are labeled file 1, file 2, and file 3.">
</picture>
</figure>

<p>
The central directory is at the end of the zip file.
It is a list of <em>central directory headers</em>.
Each central directory header contains metadata for a single file,
like its filename and CRC-32 checksum,
and a backwards pointer to a local file header.
A&nbsp;central directory header is 46&nbsp;bytes long,
plus the length of the filename.
</p>

<p>
A&nbsp;file consists of a <em>local file header</em>
followed by compressed <em>file data</em>.
The local file header is 30&nbsp;bytes long,
plus the length of the filename.
It contains a redundant copy
of the metadata from the central directory header,
and the compressed and uncompressed sizes of the file data
that follows.
Zip is a container format, not a compression algorithm.
Each file's data is compressed
using an algorithm specified in the metadata—usually <a href="https://tools.ietf.org/html/rfc1951">DEFLATE</a>.
</p>



<p>
This description of the zip format omits many details that
are not needed for understanding the zip bomb.
For full information,
refer to
<a href="https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT">section&nbsp;4.3 of APPNOTE.TXT</a>
or <a href="https://users.cs.jmu.edu/buchhofp/forensics/formats/pkzip.html">The structure of a PKZip file</a> by Florian Buchholz,
or see the <a href="#source">source code</a>.
</p>

</section>

<section id="overlap">
<h2>The first insight: overlapping files</h2>

<p>
By compressing a long string of repeated bytes,
we can produce a <em>kernel</em>
of highly compressed data.
By itself, the kernel's compression ratio cannot
exceed the DEFLATE limit of 1032,
so we want a way to reuse the kernel in many files,
without making a separate copy of it in each file.
We can do it by overlapping files:
making many central directory headers point to
a single file, whose data is the kernel.
</p>

<figure id="fig-overlap">
<picture>
<source srcset="https://www.bamsoftware.com/hacks/zipbomb/overlap.svg" type="image/svg+xml">
<img src="https://www.bamsoftware.com/hacks/zipbomb/overlap.png" alt="A block diagram of a zip file with fully overlapping files. The central directory header consists of central directory headers CDH[1], CDH[2], ..., CDH[N−1], CDH[N], with filenames A, B, ..., Y, Z. There is a single local file header LFH[1] with filename A whose file data is a compressed kernel. Every one of the central directory headers points backwards to the same local file header, LFH[1]. The lone file is multiply labeled file 1, file 2, ..., file N−1, file N.">
</picture>
</figure>

<p>
Let's look at an example to see how this construction affects the compression ratio.
Suppose the kernel is <data value="1000">1000&nbsp;bytes</data> and
decompresses to <data value="1000000">1&nbsp;<abbr title="megabyte">MB</abbr></data>.
Then the first <data value="1000000"><abbr title="megabyte">MB</abbr></data> of output "costs"
<data value="1078">1078&nbsp;bytes</data> of input:
</p>
<ul>
<li><data value="31">31&nbsp;bytes</data> for a local file header (including a 1-byte filename)</li>
<li><data value="47">47&nbsp;bytes</data> for a central directory header (including a 1-byte filename)</li>
<li><data value="1000">1000&nbsp;bytes</data> for the kernel itself</li>
</ul>
<p>
But every <data value="1000000">1&nbsp;<abbr title="megabyte">MB</abbr></data> of output
after the first costs only <data value="47">47&nbsp;bytes</data>—we don't need another local file header or another copy of the kernel,
only an additional central directory header.
So while the first reference of the kernel has a compression ratio of
1 000 000&nbsp;/&nbsp;1078 ≈&nbsp;928,
each additional reference pulls the ratio closer to
1 000 000&nbsp;/&nbsp;47 ≈&nbsp;21 277.
A&nbsp;bigger kernel raises the ceiling.
</p>

<p>
The problem with this idea is a lack of compatibility.
Because many central directory headers point to a single local file header,
the metadata—specifically the filename—cannot match for every file.
Some parsers <a href="#compatibility">balk at that</a>.
<a href="http://infozip.sourceforge.net/UnZip.html">Info-ZIP UnZip</a>
(the standard Unix <code>unzip</code> program)
extracts the files, but with warnings:
</p>
<figure>
<pre>$ <kbd>unzip overlap.zip</kbd>
<samp>  inflating: A
B:  mismatching "local" filename (A),
         continuing with "central" filename version
  inflating: B
<i>...</i></samp>
</pre>
</figure>
<p>
And the Python <a href="https://docs.python.org/3/library/zipfile.html">zipfile</a> module
<a href="https://github.com/python/cpython/blob/v3.7.0/Lib/zipfile.py#L1486-L1489">throws an exception</a>:
</p>
<figure>
<pre>$ <kbd>python3 -m zipfile -e overlap.zip .</kbd>
<samp>Traceback (most recent call last):
<i>...</i>
__main__.BadZipFile: File name in directory 'B' and header b'A' differ.</samp>
</pre>
</figure>
<!--
<p>
We could make every central directory header have the same filename
as the local file header, but that too is unsatisfying
because it means that if extracted to disk,
all the files will just overwrite each other and not take up more space
than a single file.
</p>
-->

<p>
Next we will see how to modify the construction
for consistency of filenames,
while still retaining most of the advantage
of overlapping files.
</p>

</section>

<section id="quote">
<h2>The second insight: quoting local file headers</h2>

<p>
We need to separate the local file headers for each file,
while still reusing a single kernel.
Simply concatenating all the local file headers does not work,
because the zip parser will find a local file header
where it expects to find the beginning of a DEFLATE stream.
But the idea will work, with a minor modification.
We'll use a feature of DEFLATE, non-compressed blocks,
to "quote" local file headers
so that they appear to be part of the same DEFLATE stream
that terminates in the kernel.
Every local file header
(except the first)
will be interpreted in two ways:
as code (part of the structure of the zip file)
and as data (part of the contents of a file).
</p>

<figure id="fig-quote">
<picture>
<source srcset="https://www.bamsoftware.com/hacks/zipbomb/quote.svg" type="image/svg+xml">
<img src="https://www.bamsoftware.com/hacks/zipbomb/quote.png" alt="A block diagram of a zip file with quoted local file headers. The central directory header consists of central directory headers CDH[1], CDH[2], ..., CDH[N−1], CDH[N], with filenames A, B, ..., Y, Z. The central directory headers point to corresponding local file headers LFH[1], LFH[2], ..., LFH[N−1], LFH[N] with filenames A, B, ..., Y, Z. The files are drawn and labeled to show that file 1 does not end before file 2 begins; rather file 1 contains file 2, file 2 contains file 3, and so on. There is a small green-colored space between LFH[1] and LFH[2], and between LFH[2] and LFH[3], etc., to stand for quoting the following local file header using an uncompressed DEFLATE block. The file data of the final file, whose local file header is LFH[N] and whose filename is Z, does not contain any other files, only the compressed kernel.">
</picture>
</figure>

<p>
A DEFLATE stream is a sequence of
<a href="https://tools.ietf.org/html/rfc1951#section-3.2.3">blocks</a>,
where each block may be compressed or non-compressed.
Compressed blocks are what we usually think of;
for example the kernel is one big compressed block.
But there are also non-compressed blocks,
which start with a
<a href="https://tools.ietf.org/html/rfc1951#section-3.2.4">5-byte header</a>
with a length field that means simply, "output the next <var>n</var> bytes verbatim."
Decompressing a non-compressed block means only stripping the 5-byte header.
Compressed and non-compressed blocks may be intermixed freely
in a DEFLATE stream.
The output is the concatenation of
decompressing all the blocks in order.
The "non-compressed" notion only has meaning at the DEFLATE layer;
the file data still counts as "compressed" at the zip layer,
no matter what kind of blocks are used.
</p>

<p>
It is easiest to understand this quoted-overlap construction from the inside out,
beginning with the last file and working backwards to the first.
Start by inserting the kernel, which will form the end of file data for every file.
Prepend a local file header LFH<sub><var>N</var></sub>
and add a central directory header CDH<sub><var>N</var></sub> that points to it.
Set the "compressed size" metadata field in the LFH<sub><var>N</var></sub> and CDH<sub><var>N</var></sub> to the compressed size of the kernel.
Now prepend a 5-byte non-compressed block header (colored green in the diagram)
whose length field is equal to the size of LFH<sub><var>N</var></sub>.
Prepend a second local file header LFH<sub><var>N</var>−1</sub>
and add a central directory header CDH<sub><var>N</var>−1</sub> that points to it.
Set the "compressed size" metadata field in both of the new headers to the compressed size of the kernel
<em>plus</em> the size of the non-compressed block header (5&nbsp;bytes)
<em>plus</em> the size of LFH<sub><var>N</var></sub>.
</p>



<p>
At this point the zip file contains two files, named "Y" and "Z".
Let's walk through what a zip parser would see while parsing it.
Suppose the compressed size of the kernel is 1000&nbsp;bytes
and the size of LFH<sub><var>N</var></sub> is 31&nbsp;bytes.
We start at CDH<sub><var>N</var>−1</sub>
and follow the pointer to LFH<sub><var>N</var>−1</sub>.
The first file's filename is "Y" and
the compressed size of its file data is 1036&nbsp;bytes.
Interpreting the next 1036 bytes as a DEFLATE stream,
we first encounter the 5-byte header of a non-compressed block
that says to copy the next 31&nbsp;bytes.
We write the next 31&nbsp;bytes,
which are LFH<sub><var>N</var></sub>,
which we decompress and append to file "Y".
Moving on in the DEFLATE stream, we find a compressed block (the kernel),
which we decompress to file "Y".
Now we have reached the end of the compressed data and are done with file "Y".
Proceeding to the next file, we follow the pointer from CDH<sub><var>N</var></sub>
to LFH<sub><var>N</var></sub> and find a file named "Z"
whose compressed size is 1000&nbsp;bytes.
Interpreting those 1000&nbsp;bytes as a DEFLATE stream,
we immediately encounter a compressed block (the kernel again)
and decompress it to the file "Z".
Now we have reached the end of the final file and are done.
The output file "Z" contains the decompressed kernel;
the output file "Y" is the same, but additionally prefixed by
the 31&nbsp;bytes of
LFH<sub><var>N</var></sub>.
</p>

<p>
We complete the construction by repeating the quoting procedure
until the zip file contains the desired number of files.
Each new file adds a central directory header,
a local file header,
and a non-compressed block to quote the immediately succeeding local file header.
Compressed file data is generally a chain of DEFLATE non-compressed blocks
(the quoted local file headers)
followed by the compressed kernel.
Each byte in the kernel contributes about
1032 <var>N</var> to the output size,
because each byte is part of all <var>N</var> files.
The output files are not all the same size:
those that appear earlier in the zip file
are larger than those that appear later,
because they contain more quoted local file headers.
The contents of the output files are not particularly meaningful,
but no one said they had to make sense.
</p>

<p>
This quoted-overlap construction has better compatibility
than the full-overlap construction of the previous section,
but the compatibility comes at the expense of the compression ratio.
There, each added file cost only a central directory header;
here, it costs a central directory header,
a local file header,
and another 5&nbsp;bytes for the quoting header.
</p>

<!--
<figure>
<pre>
File "A": compressed size 1900, uncompressed size 1000775
Non-compressed block header for the next 31 bytes
...
File "X": compressed size 1072, uncompressed size 1000062
Non-compressed block header for the next 31 bytes
File "Y": compressed size 1036, uncompressed size 1000031
Non-compressed block header for the next 31 bytes
File "Z": compressed size 1000, uncompressed size 1000000
Kernel
Central Directory Header "A"
...
Central Directory Header "X"
Central Directory Header "Y"
Central Directory Header "Z"
</pre>
</figure>
-->

</section>

<section id="optimization">
<h2>Optimization</h2>

<p>
Now that we have the basic zip bomb construction,
we will try to make it as efficient as possible.
We want to answer two questions:
</p>
<ul>
<li>For a given zip file size, what is the maximum compression ratio?</li>
<li>What is the maximum compression ratio, given the limits of the zip format?</li>
</ul>

<section id="bulkdeflate">
<h3>Kernel compression</h3>

<p>
It pays to compress the kernel as densely as possible,
because every decompressed byte gets magnified by a factor of <var>N</var>.
To that end, we use a custom DEFLATE compressor
called bulk_deflate,
specialized for compressing
a string of repeated bytes.
</p>

<!--
         engine compressed_size max_uncompressed_size
1: bulk_deflate           21090              21749401
2:         zlib           21090              21723602
3:       zopfli           21090              21734018
-->

<p>
All decent DEFLATE compressors will approach a compression ratio of 1032
when given an infinite stream of repeating bytes,
but we care more about specific finite sizes
than asymptotics.
bulk_deflate compresses more data
into the same space than the general-purpose compressors:
about 26&nbsp;kB more than zlib and Info-ZIP,
and about 15&nbsp;kB more than
<a href="https://github.com/google/zopfli">Zopfli</a>,
a compressor that trades speed for density.
</p>

<figure id="max_uncompressed_size">
<picture>
<source srcset="https://www.bamsoftware.com/hacks/zipbomb/max_uncompressed_size.svg" type="image/svg+xml">
<img src="https://www.bamsoftware.com/hacks/zipbomb/max_uncompressed_size.png" alt="A scatterplot showing the maximum uncompressed data for a given DEFLATE stream size, for four compression engines: bulk_deflate, Zopfli, zlib, and Info-ZIP. The points form three lines because zlib and Info-ZIP were identical. All three lines have a slope of 1032. For a given DEFLATE stream size, bulk_deflate compresses about 15 kB more than Zopfli, and Zopfli compresses about 10 kB more than zlib/Info-ZIP.">
</picture>
</figure>

<p>
The price of bulk_deflate's high compression ratio is a lack of generality.
bulk_deflate can only compress strings of a single repeated byte,
and only those of specific lengths,
namely 517&nbsp;+&nbsp;258 <var>k</var> for integer <var>k</var>&nbsp;≥&nbsp;0.
Besides compressing densely, bulk_deflate is fast,
doing essentially constant work regardless of the input size,
aside from the work of actually writing out the compressed string.
</p>

</section>

<section id="filenames">
<h3>Filenames</h3>



<p>
For our purposes, filenames are mostly dead weight.
While filenames do contribute something to the output size
by virtue of being part of quoted local file headers,
a byte in a filename does not contribute nearly as much
as a byte in the kernel.
We want filenames to be as short as possible,
while keeping them all distinct,
and subject to compatibility considerations.
</p>



<p>
The first compatibility consideration is character encoding.
The zip format specification states that filenames
are to be interpreted as <a href="https://en.wikipedia.org/wiki/Code_page_437">CP&nbsp;437</a>,
or <a href="https://en.wikipedia.org/wiki/UTF-8">UTF-8</a> if a certain flag bit is set
(<a href="https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT">APPNOTE.TXT Appendix&nbsp;D</a>).
But this is a major point of incompatibility
across zip parsers,
which may interpret filenames as being in
some fixed or locale-specific encoding.
So for compatibility, we must limit ourselves to characters
that have the same encoding in both
CP&nbsp;437 and UTF-8;
namely, the 95 printable characters of US-ASCII.
</p>



<p>
We are further restricted by filesystem naming limitations.
Some filesystems are case-insensitive, so "a" and "A" do not count as distinct names.
Common filesystems like FAT32
<a href="https://en.wikipedia.org/wiki/Comparison_of_file_systems#Limits">prohibit certain characters</a>
like '*' and '?'.
</p>

<p>
As a safe but not necessarily optimal compromise,
our zip bomb will use filenames consisting of characters
drawn from a 36-character alphabet
that does not
rely on case distinctions
or use special characters:
</p>
<figure>
0
1
2
3
4
5
6
7
8
9
A
B
C
D
E
F
G
H
I
J
K
L
M
N
O
P
Q
R
S
T
U
V
W
X
Y
Z
</figure>
<p>
Filenames are generated in the obvious way,
cycling each position through the possible characters
and adding a position on overflow:
</p>
<figure>
"0", "1", "2", …, "Z",<br>
"00", "01", "02", …, "0Z",<br>
…,<br>
"Z0", "Z1", "Z2", …, "ZZ",<br>
"000", "001", "002", …
</figure>

<p>
There are 36 filenames of length&nbsp;1,
36<sup>2</sup> filenames of length&nbsp;2, and so on.
The length of the <var>n</var>th filename is
⌊log<sub>36</sub>((<var>n</var>&nbsp;+&nbsp;1)&nbsp;/&nbsp;(36 / 35))⌋&nbsp;+&nbsp;1.
<!--
The sum of the lengths of the first <var>n</var> filenames is
<var>d</var><var>n</var> − ((36<sup><var>d</var></sup> − 1) ⋅ (36 / 35<sup>2</sup>) − <var>d</var> / 35),
where <var>d</var> = &lfloor;log<sub>36</sub>(<var>n</var> / (36 / 35))&rfloor;.
-->
Four bytes are enough to represent
<data value="1727604">1 727 604</data> distinct filenames.
</p>

<p>
Given that the <var>N</var> filenames in the zip file
are generally not all of the same length,
which way should we order them,
shortest to longest or longest to shortest?
A&nbsp;little reflection shows that it is better to
put the longest names last, because those names are the most quoted.
Ordering filenames longest last
adds over <data value="929872440">900&nbsp;<abbr title="megabyte">MB</abbr></data> of output
to <a href="#allocation">zblg.zip</a>,
compared to ordering them longest first.
It is a minor optimization, though,
as those <data value="929872440">900&nbsp;<abbr title="megabyte">MB</abbr></data>
comprise only <data value="0.000003304504104">0.0003%</data>
of the total output size.
</p>

<!--
$ unzip -l zblg.zip | tail -n 1
281395456244934                     65534 files
$ unzip -l zblg.rev.zip | tail -n 1
281394526372494                     65534 files
$ python
>>> 281395456244934 - 281394526372494
929872440
>>> 929872440 / 281395456244934. * 100
0.00033045041039703735
-->

</section>

<section id="allocation">
<h3>Kernel size</h3>

<p>
The quoted-overlap construction
allows us to place a compressed kernel of data,
and then cheaply copy it many times.
For a given zip file size&nbsp;<var>X</var>,
how much space should we devote to storing the kernel,
and how much to making copies?
</p>

<p>
To find the optimum balance,
we only have to optimize the single variable <var>N</var>,
the number of files in the zip file.
Every value of <var>N</var> requires
a certain amount of overhead for
central directory headers,
local file headers,
quoting block headers, and filenames.
All the remaining space can be taken up by the kernel.
Because <var>N</var> has to be an integer,
and you can only fit so many files
before the kernel size drops to zero,
it suffices to test every possible value of <var>N</var>
and select the one that yields the most output.
</p>

<p>
Applying the optimization procedure to <var>X</var>&nbsp;=&nbsp;42 374,
the size of 42.zip,
finds a maximum at <var>N</var>&nbsp;=&nbsp;250.
Those 250 files require <data value="21195">21 195</data> bytes of overhead,
leaving <data value="21179">21 179</data> bytes for the kernel.
A&nbsp;kernel of that size decompresses to <data value="21841249">21 841 249</data> bytes
(a&nbsp;ratio of <data value="1031.2691345200435">1031.3</data>).
The 250 copies of the decompressed kernel,
plus the little bit extra that comes from the quoted local file headers,
produces an overall unzipped output of
5 461 307 620&nbsp;bytes
and a&nbsp;compression ratio of <data value="128883.45730872705">129&nbsp;thousand</data>.

</p><div id="download-zbsm">
<p><a href="https://www.bamsoftware.com/hacks/zipbomb/zbsm.zip" download=""><img src="https://www.bamsoftware.com/hacks/zipbomb/zip.png" alt=""> zbsm.zip</a>
<span><data value="42374">42&nbsp;<abbr title="kilobyte">kB</abbr></data>&nbsp;→&nbsp;<data value="5461307620">5.5&nbsp;<abbr title="gigabyte">GB</abbr></data></span></p><pre>zipbomb --mode=quoted_overlap --num-files=250 --compressed-size=21179 &gt; zbsm.zip</pre>
</div>

<p>
Optimization produced an almost even split
between the space allocated to the kernel
and the space allocated to file headers.
It is not a coincidence.
Let's look at a simplified model of the quoted-overlap construction.
In the simplified model,
we ignore filenames,
as well as the slight increase in output file size
due to quoting local file headers.
Analysis of the simplified model will show that the optimum
split between kernel and file headers is approximately even,
and that the output size grows quadratically
when allocation is optimal.
</p>

<p>
Define some constants and variables:
</p>

<figure>
<table>
<tbody><tr>
<td><var>X</var></td><td></td><td>zip file size (take as fixed)</td>
</tr>
<tr>
<td><var>N</var></td><td></td><td>number of files in the zip file (variable to optimize)</td>
</tr>
<tr>
<td>CDH</td><td>&nbsp;=&nbsp;46</td><td>size of a central directory header (without filename)</td>
</tr>
<tr>
<td>LFH</td><td>&nbsp;=&nbsp;30</td><td>size of a local file header (without filename)</td>
</tr>
<tr>
<td>Q</td><td>&nbsp;=&nbsp;5</td><td>the size of DEFLATE non-compressed block header</td>
</tr>
<tr>
<td>C</td><td>&nbsp;≈&nbsp;1032</td><td>compression ratio of the kernel</td>
</tr>
</tbody></table>
</figure>

<!--
JACAL session to do the algebra and calculus:

# S_X(N)
e1 : C * N * (X - (N * (LFH + CDH) + (N - 1) * Q)));
                                                  ^

                       2             2
e1: (- C CDH - C LFH) N  + (C N - C N ) Q + C N X

# S_X(N) as a polynomial in N
e2 : coeffs(e1, N);

e2: [0, C Q + C X, - C CDH - C LFH - C Q]

# S'_X(N)
e3 : diff(e1, N);

e3: (- 2 C CDH - 2 C LFH) N + (C - 2 C N) Q + C X

# S'_X(N) as a polynomial in N
e4 : coeffs(e3, N);

e4: [C Q + C X, - 2 C CDH - 2 C LFH - 2 C Q]

# Solve S'_X(N) = 0. e5 == N_OPT
e5 : suchthat(N, e3);

           Q + X
e5: - - - - - - - - - -
    2 CDH + 2 LFH + 2 Q

# H(N_OPT)
e6 : e5 * (LFH + CDH) + (e5 - 1) * Q;

    - Q + X
e6: - - - -
       2

# S_X(N_OPT)
e7 : -C * (CDH + LFH + Q) * e5^2 + C * (Q + X) * e5;

       2                2
    C Q  + 2 C Q X + C X
e7: - - - - - - - - - - -
     4 CDH + 4 LFH + 4 Q
-->

<p>
Let <var>H</var>(<var>N</var>)
be the amount of header overhead required by <var>N</var> files.
Refer to
<a href="#fig-quote">the diagram</a>
to understand where this formula comes from.
</p>

<figure>
<table>
<tbody><tr>
<td><var>H</var>(<var>N</var>)</td><td>&nbsp;= <var>N</var>&nbsp;⋅&nbsp;(CDH + LFH) + (<var>N</var>&nbsp;−&nbsp;1)&nbsp;⋅&nbsp;Q</td>
</tr>
</tbody></table>
</figure>

<p>
The space remaining for the kernel is
<var>X</var>&nbsp;−&nbsp;<var>H</var>(<var>N</var>).
The total unzipped size
<var>S</var><sub><var>X</var></sub>(<var>N</var>)
is the size of <var>N</var> copies
of the kernel,
decompressed at ratio&nbsp;C.
(In this simplified model we ignore
the minor additional expansion from quoted local file headers.)
</p>

<figure>
<table>
<tbody><tr>
<td><var>S</var><sub><var>X</var></sub>(<var>N</var>)</td><td>&nbsp;= (<var>X</var> − <var>H</var>(<var>N</var>)) C <var>N</var></td>
</tr>
<tr>
<td></td><td>&nbsp;= (<var>X</var> − (<var>N</var> ⋅ (CDH + LFH) + (<var>N</var> − 1) ⋅ Q)) C <var>N</var></td>
</tr>
<tr>
<td></td><td>&nbsp;= −(CDH + LFH + Q) C <var>N</var><sup>2</sup> + (<var>X</var> + Q) C <var>N</var></td>
</tr>
</tbody></table>
</figure>

<p>
<var>S</var><sub><var>X</var></sub>(<var>N</var>) is a polynomial in <var>N</var>,
so its maximum must be at a place where the derivative
<var>S</var>′<sub><var>X</var></sub>(<var>N</var>)
is zero.
Taking the derivative and finding the zero gives us
<var>N</var><sub>OPT</sub>,
the optimal number of files.
</p>

<figure>
<table>
<tbody><tr>
<td><var>S</var>′<sub><var>X</var></sub>(<var>N</var><sub>OPT</sub>)</td><td>&nbsp;= −2 (CDH + LFH + Q) C <var>N</var><sub>OPT</sub> + (<var>X</var> + Q) C</td>
</tr>
<tr>
<td>0</td><td>&nbsp;= −2 (CDH + LFH + Q) C <var>N</var><sub>OPT</sub> + (<var>X</var> + Q) C</td>
</tr>
<tr>
<td><var>N</var><sub>OPT</sub></td><td>&nbsp;= (<var>X</var> + Q) / (CDH + LFH + Q) / 2</td>
</tr>
</tbody></table>
</figure>

<p>
<var>H</var>(<var>N</var><sub>OPT</sub>)
gives the optimal amount of space to allocate for file headers.
It is independent of CDH, LFH, and C,
and is close to <var>X</var> / 2.
</p>

<figure>
<table>
<tbody><tr>
<td><var>H</var>(<var>N</var><sub>OPT</sub>)</td><td>&nbsp;= <var>N</var><sub>OPT</sub> ⋅ (CDH + LFH) + (<var>N</var><sub>OPT</sub> − 1) ⋅ Q</td>
</tr>
<tr>
<td></td><td>&nbsp;= (<var>X</var> − Q) / 2</td>
</tr>
</tbody></table>
</figure>

<p>
<var>S</var><sub><var>X</var></sub>(<var>N</var><sub>OPT</sub>)
is the total unzipped size
when the allocation is optimal.
From this we see that the output size grows quadratically
in the input size.
</p>

<figure id="eq-S_X_N_OPT">
<table>
<tbody><tr>
<td>
<var>S</var><sub><var>X</var></sub>(<var>N</var><sub>OPT</sub>)</td><td>&nbsp;= (<var>X</var> + Q)<sup>2</sup> C / (CDH + LFH + Q) / 4</td>
</tr>
</tbody></table>
</figure>



<p>
As we make the zip file larger,
eventually we run into the limits of the zip format.
A&nbsp;zip file can contain at most 2<sup>16</sup>&nbsp;−&nbsp;1 files,
and each file can have an uncompressed size of at most 2<sup>32</sup>&nbsp;−&nbsp;1 bytes.
Worse than that,
<a href="#compatibility">some implementations</a>
take the maximum possible values
as an indicator of the presence of <a href="#zip64">64-bit extensions</a>,
so our limits are actually 2<sup>16</sup>&nbsp;−&nbsp;2 and 2<sup>32</sup>&nbsp;−&nbsp;2.
<!--
https://github.com/golang/go/commit/4aedbf5be4631693f774063410707ef467ca78e7
https://github.com/golang/go/commit/b6c5edae7c0e9dd6d12dbb8f1c9638dea45f9464
-->
It happens that the first limit we hit is the one on uncompressed file size.
At a zip file size of 8 319 377&nbsp;bytes,
naive optimization would give us a file count of 47 837
and a largest file of
2<sup>32</sup>&nbsp;+&nbsp;311 bytes.
</p>

<!--
$compressed_size
[1] 4160277

$num_files
[1] 47837

[1] "zipped size" "8319377"
[1] "unzipped size"   "205420672417247"
[1] 4294967607
-->

<p>
Accepting that we cannot increase <var>N</var> nor the size of the kernel without bound,
we would like find the maximum compression ratio achievable
while remaining within the limits of the zip format.
The way to proceed is to make the kernel as large as possible,
and have the maximum number of files.
Even though we can no longer maintain the roughly even split
between kernel and file headers,
each added file <em>does</em> increase the compression ratio—just
not as fast as it would if we were able to keep growing the kernel, too.
In fact, as we add files we will need to <em>decrease</em> the size of the kernel
to make room for the maximum file size
that gets slightly larger with each added file.
</p>

<p>
The plan results in a zip file
that contains 2<sup>16</sup>&nbsp;−&nbsp;2 files and a kernel that decompresses
to 2<sup>32</sup>&nbsp;−&nbsp;2 178 825 bytes.
Files get longer towards the beginning of the zip file—the
first and largest file decompresses to
2<sup>32</sup>&nbsp;−&nbsp;56 bytes.
That is as close as we can get using the coarse
output sizes of bulk_deflate—encoding
the final 54&nbsp;bytes would cost more bytes than they are worth.
(The zip file as a whole has a compression ratio
of 28&nbsp;million, and the final 54&nbsp;bytes would gain
at most 54&nbsp;⋅&nbsp;1032&nbsp;⋅&nbsp;(2<sup>16</sup>&nbsp;−&nbsp;2) ≈ <data value="3652078752">36.5&nbsp;million bytes</data>,
so it only helps if the 54&nbsp;bytes can be encoded
in 1&nbsp;byte—I&nbsp;could not do it in less than&nbsp;2.)
The output size of this zip bomb, 281 395 456 244 934&nbsp;bytes,
is 99.97% of the theoretical maximum
(2<sup>32</sup>&nbsp;−&nbsp;1) ⋅ (2<sup>16</sup>&nbsp;−&nbsp;1).
<!-- 65 535 × 0xffffffff = <data value="281470681677825">281 470 681 677 825</data>. -->
Any major improvements to the compression ratio can only come
from reducing the input size,
not increasing the output size.
<!--
>>> (2**32-1)*65535 - 281399752637796
70929040029
>>> 70929040029. / ((2**32-1)*65535)
0.00025199441592352524
>>> 1 - _
0.9997480055840765
>>> _ * 100
99.97480055840765
-->
</p>

<div id="download-zblg">
<p><a href="https://www.bamsoftware.com/hacks/zipbomb/zblg.zip" download=""><img src="https://www.bamsoftware.com/hacks/zipbomb/zip.png" alt=""> zblg.zip</a>
<span><data value="9893525">10&nbsp;<abbr title="megabyte">MB</abbr></data>&nbsp;→&nbsp;<data value="281395456244934">281&nbsp;<abbr title="terabyte">TB</abbr></data></span></p><pre>zipbomb --mode=quoted_overlap --num-files=65534 --max-uncompressed-size=4292788525 &gt; zblg.zip</pre>
</div>

</section>

</section>

<section id="crc32">
<h2>Efficient CRC-32 computation</h2>

<p>
Among the metadata in the central directory header and local file header
is a
<a href="https://en.wikipedia.org/wiki/Cyclic_redundancy_check">CRC-32</a>
checksum of the uncompressed file data.
This poses a problem, because directly calculating the CRC-32 of each file
requires doing work proportional to the total <em>unzipped</em> size,
which is large by design. (It's a zip bomb, after all.)
We would prefer to do work that in the worst case is
proportional to the <em>zipped</em> size.
Two factors work in our advantage:
all files share a common suffix (the kernel),
and the uncompressed kernel is a string of repeated bytes.
We will represent CRC-32 as a matrix product—this
will allow us not only to compute the checksum of the kernel quickly,
but also to reuse computation across files.
The technique described in this section is a slight extension of the
<a href="https://github.com/madler/zlib/blob/v1.2.11/crc32.c#L372"><code>crc32_combine</code></a>
function in zlib,
which Mark Adler explains
<a href="https://stackoverflow.com/questions/23122312/crc-calculation-of-a-mostly-static-data-stream/23126768#23126768">here</a>.
</p>

<p>
You can model CRC-32 as a state machine that updates a 32-bit state register
for each incoming bit.
The basic update operations for a 0&nbsp;bit and a 1&nbsp;bit are:
</p>

<figure>
<pre><code>uint32 crc32_update_0(uint32 state) {
    // Shift out the least significant bit.
    bit b = state &amp; 1;
    state = state &gt;&gt; 1;
    // If the shifted-out bit was 1, XOR with the CRC-32 constant.
    if (b == 1)
        state = state ^ 0xedb88320;
    return state;
}

uint32 crc32_update_1(uint32 state) {
    // Do as for a 0 bit, then XOR with the CRC-32 constant.
    return crc32_update_0(state) ^ 0xedb88320;
}</code></pre>
</figure>

<p>
If you think of the state register as a 32-element binary vector,
and use XOR for addition and AND for multiplication, then
<code>crc32_update_0</code> is a
<a href="https://en.wikipedia.org/wiki/Linear_map">linear transformation</a>;
i.e., it can be represented as multiplication by a
32×32 binary
<a href="https://en.wikipedia.org/wiki/Transformation_matrix">transformation matrix</a>.
To see why, observe that multiplying a matrix by a vector
is just summing the columns of the matrix,
after multiplying each column by the corresponding element of the vector.
The shift operation <code>state&nbsp;&gt;&gt;&nbsp;1</code>
is just taking each bit&nbsp;<var>i</var> of the state vector
and multiplying it by a vector that is 0 everywhere except at bit <var>i</var>&nbsp;−&nbsp;1
(numbering the bits from right to left).
The conditional final XOR <code>state&nbsp;^&nbsp;0xedb88320</code>
that only happens when bit&nbsp;<code>b</code> is 1
can instead be represented as first multiplying
<code>b</code> by 0xedb88320
and then XORing it into the state.
</p>

<p>
Furthermore, <code>crc32_update_1</code> is just
<code>crc32_update_0</code> plus (XOR) a&nbsp;constant.
That makes <code>crc32_update_1</code> an
<a href="https://en.wikipedia.org/wiki/Affine_transformation">affine transformation</a>:
a&nbsp;matrix multiplication followed by a translation (i.e., vector addition).
We can represent both the matrix multiplication and the translation
in a single step
if we enlarge the dimensions of the transformation matrix to 33×33
and append an extra element to the state vector that is always&nbsp;1.
(This representation is called
<a href="https://en.wikipedia.org/wiki/Transformation_matrix#Affine_transformations">homogeneous coordinates</a>.)
</p>

<figure>

<table>
<caption><var>M</var><sub>0</sub></caption>
<tbody>
<tr><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td></tr>
</tbody>
</table><!--

--><table>
<caption><var>M</var><sub>1</sub></caption>
<tbody>
<tr><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>1</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>1</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>1</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td></tr>
<tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td></tr>
</tbody>
</table>
<figcaption>
The 33×33 transformation matrices <var>M</var><sub>0</sub> and <var>M</var><sub>1</sub> that compute
the CRC-32 state change effected by a 0&nbsp;bit and a 1&nbsp;bit respectively.
Column vectors are stored with the most significant bit at the bottom:
reading the first column from bottom to top, you see
the CRC-32 polynomial constant edb88320<sub>16</sub> =
<span>1</span><span>1</span><span>1</span><span>0</span><span>1</span><span>1</span><span>0</span><span>1</span><span>1</span><span>0</span><span>1</span><span>1</span><span>1</span><span>0</span><span>0</span><span>0</span><span>1</span><span>0</span><span>0</span><span>0</span><span>0</span><span>0</span><span>1</span><span>1</span><span>0</span><span>0</span><span>1</span><span>0</span><span>0</span><span>0</span><span>0</span><span>0</span><sub>2</sub>.
The two matrices differ only in the final column, which represents a translation vector
in homogeneous coordinates.
In <var>M</var><sub>0</sub> the translation is zero and
in <var>M</var><sub>1</sub> it is edb88320<sub>16</sub>, the CRC-32 polynomial constant.
The 1's just above the diagonal represent the
shift operation <code>state&nbsp;&gt;&gt;&nbsp;1</code>.
</figcaption>
</figure>

<p>
Both operations <code>crc32_update_0</code> and <code>crc32_update_1</code>
can be represented by a 33×33 transformation matrix.
The matrices <var>M</var><sub>0</sub> and <var>M</var><sub>1</sub> are shown.
The benefit of a matrix representation is that matrices compose.
Suppose we want to represent the state change effected by processing
the ASCII character 'a', whose binary representation is
01100001<sub>2</sub>.
We can represent the cumulative CRC-32 state change of those 8&nbsp;bits
in a single transformation matrix:
</p>
<figure>
<table>
<tbody><tr>
<td><var>M</var><sub>a</sub></td><td>&nbsp;= <var>M</var><sub>0</sub> <var>M</var><sub>1</sub>&nbsp;<var>M</var><sub>1</sub>&nbsp;<var>M</var><sub>0</sub>&nbsp;<var>M</var><sub>0</sub>&nbsp;<var>M</var><sub>0</sub>&nbsp;<var>M</var><sub>0</sub>&nbsp;<var>M</var><sub>1</sub></td>
</tr>
</tbody></table>
</figure>
<p>
And we can represent the state change of a string of repeated 'a's
by multiplying many copies of <var>M</var><sub>a</sub> together—matrix exponentiation.
We can do matrix exponentiation quickly
using a <a href="https://en.wikipedia.org/wiki/Exponentiation_by_squaring">square-and-multiply</a> algorithm,
which allows us to compute <var>M</var><sup><var>n</var></sup>
in only about log<sub>2</sub> <var>n</var> steps.
For example, the matrix representing the state change
of a string of 9&nbsp;'a's is
</p>
<figure>
<table>
<tbody><tr>
<td>(<var>M</var><sub><code>a</code></sub>)<sup>9</sup></td><td>&nbsp;= <var>M</var><sub><code>a</code></sub>&nbsp;<var>M</var><sub><code>a</code></sub>&nbsp;<var>M</var><sub><code>a</code></sub>&nbsp;<var>M</var><sub><code>a</code></sub>&nbsp;<var>M</var><sub><code>a</code></sub>&nbsp;<var>M</var><sub><code>a</code></sub>&nbsp;<var>M</var><sub><code>a</code></sub>&nbsp;<var>M</var><sub><code>a</code></sub>&nbsp;<var>M</var><sub><code>a</code></sub></td>
</tr>
<tr>
<td></td><td>&nbsp;= (<var>M</var><sub><code>a</code></sub>&nbsp;<var>M</var><sub><code>a</code></sub>&nbsp;<var>M</var><sub><code>a</code></sub>&nbsp;<var>M</var><sub><code>a</code></sub>)<sup>2</sup>&nbsp;<var>M</var><sub><code>a</code></sub></td>
</tr>
<tr>
<td></td><td>&nbsp;= ((<var>M</var><sub><code>a</code></sub>&nbsp;<var>M</var><sub><code>a</code></sub>)<sup>2</sup>)<sup>2</sup>&nbsp;<var>M</var><sub><code>a</code></sub></td>
</tr>
<tr>
<td></td><td>&nbsp;= (((<var>M</var><sub><code>a</code></sub>)<sup>2</sup>)<sup>2</sup>)<sup>2</sup>&nbsp;<var>M</var><sub><code>a</code></sub></td>
</tr>
</tbody></table>
</figure>

<p>
The square-and-multiply algorithm is useful
for computing <var>M</var><sub>kernel</sub>,
the matrix for the uncompressed kernel,
because the kernel is a string of repeated bytes.
To produce a CRC-32 checksum value from a matrix,
multiply the matrix by the zero vector.
(The zero vector in homogeneous coordinates, that is:
32&nbsp;0's followed by a&nbsp;1.
Here we omit the minor complication of pre- and post-conditioning the checksum.)
To compute the checksum for every file, we work backwards.
Start by initializing <var>M</var>&nbsp;:=&nbsp;<var>M</var><sub>kernel</sub>.
The checksum of the kernel is also the checksum
of the final file, file&nbsp;<var>N</var>,
so multiply <var>M</var> by the zero vector and store the resulting checksum in
CDH<sub><var>N</var></sub> and LFH<sub><var>N</var></sub>.
The file data of file&nbsp;<var>N</var>&nbsp;−&nbsp;1 is the same as the file data of file&nbsp;<var>N</var>,
but with an added prefix of LFH<sub><var>N</var></sub>.
So compute <var>M</var><sub>LFH<sub><var>N</var></sub></sub>,
the state change matrix for LFH<sub><var>N</var></sub>,
and update <var>M</var>&nbsp;:=&nbsp;<var>M</var>&nbsp;<var>M</var><sub>LFH<sub><var>N</var></sub></sub>.
Now <var>M</var> represents the cumulative state change from processing
LFH<sub><var>N</var></sub> followed by the kernel.
Compute the checksum for file <var>N</var>&nbsp;−&nbsp;1 by again multiplying <var>M</var> by the zero vector.
Continue the procedure, accumulating state change matrices into <var>M</var>,
until all the files have been processed.
</p>

<!--
<p>
The <a href=#source>source code</a> employs an additional
optimization on top of the conceptual scheme outlined in the previous paragraph.
Instead of updating
<var>M</var> := <var>M</var> <var>M</var><sub>LFH<sub><var>i</var></sub></sub>
after each file, we update
<var>M</var> := <var>M</var> (<var>M</var><sub>0</sub>)<sup>|LFH<sub><var>i</var></sub>|</sup>,
where |LFH<sub><var>i</var></sub>|
is the size of LFH<sub><var>i</var></sub> in bytes.
</p>
-->

</section>

<section id="zip64">
<h2>Extension: Zip64</h2>

<p>
<a href="#allocation">Earlier</a> we hit a wall on expansion
due to limits of the zip format—it was impossible
to produce more than about 281&nbsp;TB of output,
no matter how cleverly packed the zip file.
It is possible to surpass those limits
using <a href="https://en.wikipedia.org/wiki/Zip_(file_format)#ZIP64">Zip64</a>,
an extension to the zip format that increases
the size of certain header fields to 64&nbsp;bits.
Support for Zip64 is <a href="#compatibility">by no means universal</a>,
but it is one of the more commonly implemented extensions.
As regards the compression ratio,
the effect of Zip64 is to
increase the size of a central directory header from
46&nbsp;bytes to 58&nbsp;bytes,
and the size of a local directory header from
30&nbsp;bytes to 50&nbsp;bytes.
Referring to
<a href="#eq-S_X_N_OPT">the formula</a>
for optimal expansion in the simplified model,
we see that a zip bomb in Zip64 format
still grows quadratically,
but more slowly because of the larger denominator—this
is visible in
<a href="#zipped_size">the figure below</a>
in the Zip64 line's
slightly lower vertical placement.
In exchange for the loss of compatibility
and slower growth,
we get the removal of all practical file size limits.
</p>

<p>
Suppose we want a zip bomb that expands to
<data value="4507981343026016">4.5&nbsp;<abbr title="petabyte">PB</abbr></data>,
the same size that 42.zip recursively expands to.
How big must the zip file be?
Using binary search, we find that the smallest
zip file whose unzipped size exceeds the unzipped size of 42.zip
has a zipped size of
<data value="45876952">46&nbsp;<abbr title="megabyte">MB</abbr></data>.
</p>

<div id="download-zbxl">
<p><a href="https://www.bamsoftware.com/hacks/zipbomb/zbxl.zip" download=""><img src="https://www.bamsoftware.com/hacks/zipbomb/zip.png" alt=""> zbxl.zip</a>
<span><data value="45876952">46&nbsp;<abbr title="megabyte">MB</abbr></data>&nbsp;→&nbsp;<data value="4507981427706459">4.5&nbsp;<abbr title="petabyte">PB</abbr></data> (Zip64, less compatible)</span></p><pre>zipbomb --mode=quoted_overlap --num-files=190023 --compressed-size=22982788 --zip64 &gt; zbxl.zip</pre>
</div>

<p>
4.5&nbsp;<abbr title="petabyte">PB</abbr> is roughly
the size of the data captured by the Event Horizon Telescope
to make the
<a href="https://www.vice.com/en/article/597m7q/reddits-data-hoarders-are-freaking-out-over-all-that-black-hole-data">first image of a black hole</a>,
stacks and stacks of hard drives.
</p>

<p>
With Zip64, it's no longer practically interesting to
consider the maximum compression ratio,
because we can just keep increasing the zip file size,
and the compression ratio along with it,
until even the compressed zip file is prohibitively large.
An interesting threshold, though,
is
<data value="18446744073709551616">2<sup>64</sup>&nbsp;bytes</data>
(<data value="18446744073709551616">18&nbsp;<abbr title="exabyte">EB</abbr></data> or
<data value="18446744073709551616">16&nbsp;<abbr title="exbibyte">EiB</abbr></data>)—that
much data
<a href="https://en.wikipedia.org/wiki/Comparison_of_file_systems#Limits">will not fit on most filesystems</a>.
Binary search finds the smallest zip bomb that produces at least that much output:
it contains <data value="12056313">12&nbsp;million</data> files
and has a compressed kernel of <data value="1482284040">1.5&nbsp;<abbr title="gigabyte">GB</abbr></data>.
The total size of the zip file is
<data value="2961656712">2.9&nbsp;<abbr title="gigabyte">GB</abbr></data>
and it unzips to
<data value="18446744085437447493">2<sup>64</sup>&nbsp;+&nbsp;11 727 895 877 bytes</data>,
having a compression ratio of over <data value="6228522033.190134">6.2&nbsp;billion</data>.
I&nbsp;didn't make this one downloadable,
but you can generate it yourself using the <a href="#source">source code</a>.
It contains files so large that it uncovers
<a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=929502">a bug</a>
in Info-ZIP UnZip&nbsp;6.0.
</p>

<pre>zipbomb --mode=quoted_overlap --num-files=12056313 --compressed-size=1482284040 --zip64 &gt; zbxxl.zip
</pre>

<!--
# time python3 zipbomb - -mode=quoted_overlap - -num-files=12056313 - -compressed-size=1482284040 - -zip64 > zbxxl.zip

real    52m3.082s
user    51m50.728s
sys     0m11.940s
-->

</section>

<section id="bzip2">
<h2>Extension: bzip2</h2>



<p>
DEFLATE is the most common compression algorithm
used in the zip format, but it is only one of many options.
Probably the second most common algorithm is <a href="https://en.wikipedia.org/wiki/Bzip2">bzip2</a>,
while not as compatible as DEFLATE,
is probably the second most commonly supported compression algorithm.
Empirically, bzip2 has a maximum compression ratio of about 1.4&nbsp;million,
which allows for denser packing of the kernel.
Ignoring the loss of compatibility,
does bzip2 enable a more efficient zip bomb?
</p>

<p>
Yes—but only for small files.
The problem is that bzip2 does not have anything like the
<a href="#quote">non-compressed blocks</a> of DEFLATE
that we used to <a href="#quote">quote local file headers</a>.
So it is not possible to overlap files and reuse the kernel—each file must have
its own copy, and therefore the overall compression ratio
is no better than the ratio of any single file.
In <a href="#zipped_size">the figure</a> we see that
no-overlap bzip2 outperforms quoted DEFLATE
only for files under about a megabyte.
</p>

<p>
There is still hope for using bzip2—an
alternative means of local file header quoting
discussed in <a href="#extra">the next section</a>.
Additionally,
if you happen to know that a certain zip parser supports bzip2
<em>and</em> tolerates mismatched filenames,
then you can use the <a href="#overlap">full-overlap construction</a>,
which has no need for quoting.
</p>

<figure id="zipped_size">
<picture>
<source srcset="https://www.bamsoftware.com/hacks/zipbomb/zipped_size.svg" type="image/svg+xml">
<img src="https://www.bamsoftware.com/hacks/zipbomb/zipped_size.png" alt="Log–log plot of unzipped size versus zipped size for different zip file constructions: DEFLATE, bzip2, quoted DEFLATE, and 42.zip (recursive and non-recursive).">
</picture>
<figcaption>
Zipped size versus unzipped size for various zip bomb constructions.
Note the log–log scales.
Each construction is shown with and without Zip64.
The no-overlap constructions
have a linear rate of growth,
which is visible in the 1:1 slope of the lines.
The vertical offset of the bzip2 lines shows that the compression ratio
of bzip2 is about a thousand times greater than that of DEFLATE.
The quoted-DEFLATE constructions
have a quadratic rate of growth,
as evidenced by the 2:1 slope of the lines.
The Zip64 variant is slightly less efficient,
but permits output in excess of 281&nbsp;TB.
The lines for extra-field-quoted bzip2
transition from quadratic to linear
upon reaching either the maximum file size
(<data value="65534">2<sup>32</sup>&nbsp;−&nbsp;2 bytes</data>),
or the maximum number of files allowed by extra-field quoting.
</figcaption>
</figure>

</section>



<section id="discussion">
<h2>Discussion</h2>

<p>
In related work,
<a href="http://sar.informatik.hu-berlin.de/research/publications/index.htm#SAR-PR-2006-04">Plötz et&nbsp;al.</a>
used overlapping files to create a
near-self-replicating zip file.
Gynvael Coldwind
has <a href="https://gynvael.coldwind.pl/?id=682">previously suggested</a> (slide&nbsp;47)
overlapping files.
<a href="https://www.usenix.org/conference/usenixsecurity15/technical-sessions/presentation/pellegrino">Pellegrino et&nbsp;al.</a>
found systems vulnerable to compression bombs
and other resource exhaustion attacks
and listed common pitfalls in specification,
implementation, and configuration.
</p>

<p>
We have designed the quoted-overlap zip bomb construction for compatibility,
taking into consideration a number of implementation differences,
some of which are shown in <a href="#compatibility">the table below</a>.
The resulting construction is compatible with zip parsers that work
in the usual back-to-front way,
first consulting the central directory
and using it as an index of files.
Among these is the example
zip parser included in <a href="https://www.usenix.org/conference/osdi14/technical-sessions/presentation/bangert">Nail</a>,
which is automatically generated from a formal grammar.
The construction is not compatible, however,
with "streaming" parsers,
those that parse the zip file from beginning to end in one pass
without first reading the central directory.
By their nature, streaming parsers
do not permit any kind of file overlapping.
The most likely outcome is that they
will extract only the first file.
They may even raise an error besides,
as is the case with <a href="https://github.com/madler/sunzip">sunzip</a>,
which parses the central directory at the end and checks it for consistency
with the local file headers it has already seen.
</p>

<p>
If you need the extracted files to start with a certain prefix
(so that they will be identified as a certain file type, for example),
you can insert a data-carrying DEFLATE block just before the
block that quotes the next header.
Not every file has to participate in the bomb construction:
you can include ordinary files
alongside the bomb files
if you need the zip file to conform to some higher-level format.
(The <a href="#source">source code</a> has a <code>--template</code>
option to facilitate this use case.)
Many file formats use zip as a container;
examples are Java JAR, Android APK, and LibreOffice documents.
</p>

<p id="pdf">
<a href="https://en.wikipedia.org/wiki/PDF">PDF</a>
is in many ways similar to zip.
It has a cross-reference table at the end of the file
that points to objects earlier in the file,
and it supports DEFLATE compression of objects through
the FlateDecode filter.
Didier Stevens
<a href="https://blog.didierstevens.com/2008/05/19/pdf-stream-objects/">writes</a>
about having contained a 1&nbsp;GB stream inside a
<data value="2642">2.6&nbsp;kB</data> PDF file
by stacking FlateDecode filters.
If a PDF parser limits the amount of stacking,
then it is probably possible to use the DEFLATE quoting idea
to overlap PDF objects.
</p>



<p id="mitigation">
Detecting the specific class of zip bomb we have developed in this article is easy:
look for overlapping files.
Mark Adler has written <a href="https://github.com/madler/unzip/commits/6519bf0f8a896851d9708da11e1b63c818238c8f">a patch</a>
for Info-ZIP UnZip that does just that.
<!-- updated:
https://github.com/madler/unzip/commit/6d351831be705cc26d897db44f878a978f4138fc

https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=963996
https://github.com/madler/unzip/commit/5e2efcd633a4a1fb95a129a75508e7d769e767be
https://github.com/madler/unzip/commit/5c572555cf5d80309a07c30cf7a54b2501493720
-->
In general, though, rejecting overlapping files
does not by itself make it safe to handle untrusted zip files.
There are zip bombs that do not rely on overlapping files,
and there are malicious zip files that are not bombs.
Furthermore, any such detection logic must
be implemented inside the parser itself,
not as a separate prefilter.
One of the details
omitted from <a href="#zip">the description of the zip format</a> is that
there is no single well-defined algorithm for locating
the central directory in a zip file:
two parsers may find two different central directories
and therefore
<a href="https://gynvael.coldwind.pl/?id=682">may not even agree on what files a zip file contains</a>
(slides 67–80).
Predicting the total uncompressed size
by summing the sizes of all files
does not work, in general,
because the sizes stored in metadata
<a href="https://www.usenix.org/conference/usenixsecurity15/technical-sessions/presentation/pellegrino">may not match</a>
(§4.2.2)
the actual uncompressed sizes.
(See the "permits too-short file size" row in <a href="#compatibility">the compatibility table</a>.)
Robust protection against zip bombs
involves sandboxing the parser to limit
its use of time, memory, and disk space—just
as if you were processing image files,
or any other complex file format prone to parser bugs.
</p>

<table id="compatibility">

<caption>
<p>
Compatibility of selected zip parsers with various zip features,
edge cases,
and zip bomb constructions.
The background colors indicate a scale from <span>less restrictive to more restrictive</span>.
For best compatibility,
use DEFLATE compression without Zip64,
match names in central directory headers and local file headers,
compute correct CRCs,
and avoid the maximum values of 32-bit and 16-bit fields.
</p>
</caption>

<!--
Open Packaging Conventions:
DEFLATE: yes (Table (C-3)
Zip64: yes (Table C-1, Table C-3)
bzip2: no (Table C-3)
permits mismatched filenames: no (C.1 Archive File Header Consistency)
permits incorrect CRC-32: unknown
permits file size of 0xffffffff: unknown
permits file count of 0xffff: unknown
https://www.ecma-international.org/news/TC45_current_work/Office%20Open%20XML%20Part%202%20-%20Open%20Packaging%20Conventions.pdf
-->

<!--
$ git clone https://android.googlesource.com/platform/system/core
$ cd core
$ git checkout android-9.0.0_r1
$ g++ -o unzip -std=c++17 -Iinclude -Ibase/include -Iliblog/include -Ilibutils/include -Ilibziparchive/include libziparchive/{zip_archive.cc,unzip.cpp} base/{strings.cpp,file.cpp,logging.cpp,stringprintf.cpp} libutils/FileMap.cpp libunwindstack/tests/LogFake.cpp -lz
-->

<thead>
<tr>
<td></td>
<th><a href="http://infozip.sourceforge.net/UnZip.html">Info-ZIP<br>UnZip 6.0</a></th>
<th><a href="https://docs.python.org/3/library/zipfile.html">Python 3.7<br>zipfile</a></th>
<th><a href="https://golang.org/pkg/archive/zip/">Go 1.12<br>archive/zip</a></th>
<th><a href="https://github.com/thejoshwolfe/yauzl">yauzl 2.10.0<br>(Node.js)</a></th>
<th><a href="https://github.com/jbangert/nail/tree/4bd9cc29c4092abe7a77f8294aff2337bba02ec5/examples/zip">Nail<br>examples/zip</a></th>
<th><a href="https://android.googlesource.com/platform/system/core/+/refs/tags/android-9.0.0_r1/libziparchive">Android&nbsp;9.0.0&nbsp;r1<br>libziparchive</a></th>
<th><a href="https://github.com/madler/sunzip">sunzip 0.4</a><br>(streaming)</th>
</tr>
</thead>

<tbody>

<!--
<td class= title=></td>
<td class=y title=yes>✓</td>
<td class=n title=no>✖</td>
-->

<tr>
<th>DEFLATE</th>
<td title="yes">✓</td>
<td title="yes"><a href="https://github.com/python/cpython/blob/v3.7.0/Lib/zipfile.py#L57">✓</a></td>
<td title="yes"><a href="https://github.com/golang/go/blob/go1.12/src/archive/zip/struct.go#L31">✓</a></td>
<td title="yes"><a href="https://github.com/thejoshwolfe/yauzl/blob/2.10.0/index.js#L520-L521">✓</a></td>
<td title="yes"><a href="https://github.com/jbangert/nail/blob/4bd9cc29c4092abe7a77f8294aff2337bba02ec5/examples/zip/zip.c#L63">✓</a></td>
<td title="yes"><a href="https://android.googlesource.com/platform/system/core/+/refs/tags/android-9.0.0_r1/libziparchive/zip_archive.cc#1059">✓</a></td>
<td title="yes"><a href="https://github.com/madler/sunzip/blob/v0.4/sunzip.c#L1256">✓</a></td>
</tr>

<tr>
<th>Zip64</th>
<td title="yes"><a href="http://infozip.sourceforge.net/UnZip.html#Release">✓</a></td>
<td title="yes"><a href="https://github.com/python/cpython/blob/v3.7.0/Lib/zipfile.py#L186">✓</a></td>
<td title="yes"><a href="https://github.com/golang/go/blob/go1.12/src/archive/zip/reader.go#L519">✓</a></td>
<td title="limited to the range of IEEE doubles"><a href="https://github.com/thejoshwolfe/yauzl/tree/2.10.0#limitted-zip64-support">✓</a></td>
<td title="no"><a href="https://github.com/jbangert/nail/blob/4bd9cc29c4092abe7a77f8294aff2337bba02ec5/examples/zip/zip.c#L103-L125">✖</a></td>
<td title="no"><a href="https://android.googlesource.com/platform/system/core/+/refs/tags/android-9.0.0_r1/libziparchive/zip_archive.cc#168">✖</a></td>
<td title="yes"><a href="https://github.com/madler/sunzip/blob/v0.4/sunzip.c#L922">✓</a></td>
</tr>

<tr>
<th>bzip2</th>
<td title="yes"><a href="http://infozip.sourceforge.net/UnZip.html#Release">✓</a></td>
<td title="yes"><a href="https://github.com/python/cpython/blob/v3.7.0/Lib/zipfile.py#L58">✓</a></td>
<td title="unless you provide an implementation with RegisterDecompressor"><a href="https://github.com/golang/go/blob/go1.12/src/archive/zip/struct.go#L28-L32">✖</a></td>
<td title="no"><a href="https://github.com/thejoshwolfe/yauzl/blob/2.10.0/index.js#L517-L525">✖</a></td>
<td title="no"><a href="https://github.com/jbangert/nail/blob/4bd9cc29c4092abe7a77f8294aff2337bba02ec5/examples/zip/zip.c#L86">✖</a></td>
<td title="no"><a href="https://android.googlesource.com/platform/system/core/+/refs/tags/android-9.0.0_r1/libziparchive/zip_archive.cc#1061">✖</a></td>
<td title="yes"><a href="https://github.com/madler/sunzip/blob/v0.4/sunzip.c#L1256">✓</a></td>
</tr>

<tr>
<th>permits mismatched filenames</th>
<td title="warns, then takes name from central directory">warns</td>
<td><a href="https://github.com/python/cpython/blob/v3.7.0/Lib/zipfile.py#L1486-L1489"><abbr title="no">✖</abbr></a></td>
<td title="ignores local file header metadata"><a href="https://github.com/golang/go/blob/go1.12/src/archive/zip/reader.go#L244">✓</a></td>
<td title="ignores local file header metadata"><a href="https://github.com/thejoshwolfe/yauzl/tree/2.10.0#local-file-headers-are-ignored">✓</a></td>
<td title="with a TODO to add the check"><a href="https://github.com/jbangert/nail/blob/4bd9cc29c4092abe7a77f8294aff2337bba02ec5/examples/zip/zip.nail#L49">✓</a></td>
<td title="no"><a href="https://android.googlesource.com/platform/system/core/+/refs/tags/android-9.0.0_r1/libziparchive/zip_archive.cc#594">✖</a></td>
<td title="ignores local file header filename"><a href="https://github.com/madler/sunzip/blob/v0.4/sunzip.c#L1268-L1269">✓</a></td>
</tr>

<tr>
<th>permits incorrect CRC-32</th>
<td><abbr title="shows expected and actual CRC">warns</abbr></td>
<td title="no"><a href="https://github.com/python/cpython/blob/v3.7.0/Lib/zipfile.py#L893-L894">✖</a></td>
<td title="CRC-32 ignored if set to 0"><a href="https://github.com/golang/go/blob/go1.12/src/archive/zip/reader.go#L219-L224">if zero</a></td>
<td title="yes"><a href="https://github.com/thejoshwolfe/yauzl/tree/2.10.0#no-crc-32-checking">✓</a></td>
<td title="no"><a href="https://github.com/jbangert/nail/blob/4bd9cc29c4092abe7a77f8294aff2337bba02ec5/examples/zip/zip.nail#L41">✖</a></td>
<td title="with a compile-time bool to enable CRC checks; but does check for consistency between CDH CRC and data descriptor CRC"><a href="https://android.googlesource.com/platform/system/core/+/refs/tags/android-9.0.0_r1/libziparchive/zip_archive.cc#52">✓</a></td>
<td title="no"><a href="https://github.com/madler/sunzip/blob/v0.4/sunzip.c#L1113-L1124">✖</a></td>
</tr>

<tr>
<th>permits too-short file size</th>
<td title="yes">✓</td>
<td title="permits uncompressed size field to be longer, but not shorter, than the actual size"><a href="https://github.com/python/cpython/blob/v3.7.0/Lib/zipfile.py#L772">✖</a></td>
<td title="no"><a href="https://github.com/golang/go/blob/go1.12/src/archive/zip/reader.go#L205-L207">✖</a></td>
<td title="no"><a href="https://github.com/thejoshwolfe/yauzl/blob/2.10.0/index.js#L641-L655">✖</a></td>
<td title="no"><a href="https://github.com/jbangert/nail/blob/4bd9cc29c4092abe7a77f8294aff2337bba02ec5/examples/zip/zip.nail#L47">✖</a></td>
<td title="no"><a href="https://android.googlesource.com/platform/system/core/+/refs/tags/android-9.0.0_r1/libziparchive/zip_archive.cc#847">✖</a></td>
<td title="no"><a href="https://github.com/madler/sunzip/blob/v0.4/sunzip.c#L1113-L1124">✖</a></td>
</tr>

<tr>
<th>permits file size of 2<sup>32</sup>&nbsp;−&nbsp;1</th>
<td title="yes">✓</td>
<td title="0xffffffff not treated as special"><a href="https://github.com/python/cpython/blob/v3.7.0/Lib/zipfile.py#L1311-L1313">✓</a></td>
<td title="special case to allow file size of 0xffffffff, still disallows compressed size or local file header offset of 0xffffffff"><a href="https://github.com/golang/go/blob/go1.12/src/archive/zip/reader.go#L406-L414">✓</a></td>
<td title="requires Zip64 Extended Information extra field when file size is 0xffffffff"><a href="https://github.com/thejoshwolfe/yauzl/issues/109">✖</a></td>
<td title="no Zip64 support"><a href="https://github.com/jbangert/nail/blob/4bd9cc29c4092abe7a77f8294aff2337bba02ec5/examples/zip/zip.nail#L59">✓</a></td>
<td title="no Zip64 support"><a href="https://android.googlesource.com/platform/system/core/+/refs/tags/android-9.0.0_r1/libziparchive/zip_archive_common.h#95">✓</a></td>
<td title="checks for Zip64 Extended Information extra field if file size is 0xffffffff, but does not require it"><a href="https://github.com/madler/sunzip/blob/v0.4/sunzip.c#L1275-L1277">✓</a></td>
</tr>

<tr>
<th>permits file count of 2<sup>16</sup>&nbsp;−&nbsp;1</th>
<td title="checks for Zip64 end of central directory locator independent of file count">✓</td>
<td title="checks for Zip64 end of central directory locator independent of file count"><a href="https://github.com/python/cpython/blob/v3.7.0/Lib/zipfile.py#L258-L259">✓</a></td>
<td title="looks for Zip64 end of central directory locator, but continues if not present"><a href="https://github.com/golang/go/blob/go1.12/src/archive/zip/reader.go#L502-L511">✓</a></td>
<td title="no"><a href="https://github.com/thejoshwolfe/yauzl/issues/108">✖</a></td>
<td title="no Zip64 support"><a href="https://github.com/jbangert/nail/blob/4bd9cc29c4092abe7a77f8294aff2337bba02ec5/examples/zip/zip.nail#L79">✓</a></td>
<td title="no Zip64 support"><a href="https://android.googlesource.com/platform/system/core/+/refs/tags/android-9.0.0_r1/libziparchive/zip_archive_common.h#51">✓</a></td>
<td title="Zip64 end of central directory locator is optional"><a href="https://github.com/madler/sunzip/blob/v0.4/sunzip.c#L1139">✓</a></td>
</tr>
</tbody>

<tbody>
<!--
<tr>
<th>unzips recursively (42.zip)</th>
<td class=n title=no>✖</td>
<td class=n title=no>✖</td>
<td class=na title="is a library">N/A</td>
<td class=na title="is a library">N/A</td>
<td class=n title=no>✖</td>
<td class=n title=no>✖</td>
<td class=n title=no>✖</td>
</tr>
-->

<tr>
<th>unzips <a href="#overlap">overlap.zip</a></th>
<td>warns</td>
<td title="no">✖</td>
<td title="yes">✓</td>
<td title="yes">✓</td>
<td title="yes">✓</td>
<td title="no">✖</td>
<td title="no">✖</td>
</tr>

<tr>
<th>unzips <a href="#allocation">zbsm.zip and zblg.zip</a></th>
<td><abbr title="yes">✓</abbr></td>
<td><abbr title="yes">✓</abbr></td>
<td title="yes">✓</td>
<td title="yes">✓</td>
<td title="crashes because it tries to extract all into memory, but handles the construction">✓</td>
<td title="yes">✓</td>
<td title="no">✖</td>
</tr>

<tr>
<th>unzips <a href="#zip64">zbxl.zip</a></th>
<td><abbr title="yes">✓</abbr></td>
<td><abbr title="yes">✓</abbr></td>
<td title="yes">✓</td>
<td title="yes">✓</td>
<td title="no Zip64 support">✖</td>
<td title="no Zip64 support">✖</td>
<td title="no">✖</td>
</tr>
</tbody>

</table>

</section>

<section id="credits">
<h2>Credits</h2>

<p>
I&nbsp;thank
<a href="https://madler.net/madler/">Mark Adler</a>,
<a href="https://bburky.com/">Blake Burkhart</a>,
<a href="https://gynvael.coldwind.pl/">Gynvael Coldwind</a>,
<a href="https://swtch.com/~rsc/">Russ Cox</a>,
<a href="https://www.brandonenright.net/">Brandon Enright</a>,
<a href="https://github.com/jorangreef">Joran Dirk Greef</a>,
<a href="https://idea.popcount.org/">Marek Majkowski</a>,
<a href="https://wolfesoftware.com/">Josh Wolfe</a>,
and the <a href="https://www.usenix.org/conference/woot19/">USENIX WOOT 2019</a> reviewers
for comments on this article or a draft.
Caolán McNamara evaluated the security impact
of the zip bombs in LibreOffice.
<a href="https://habr.com/users/m1rko/">@m1rko</a>
wrote a <a href="https://habr.com/ru/post/459254/">Russian translation</a>.
<a href="https://zerosun.top/">北岸冷若冰霜</a>
wrote a <a href="https://zerosun.top/2019/07/07/A-better-zip-bomb/">Chinese translation</a>.
Daniel Ketterer reported that the <code>--template</code> option
was broken after the addition of <a href="#giant-steps"><code>--giant-steps</code></a>.
</p>

<p>
A&nbsp;version of this article
appeared at the
<a href="https://www.usenix.org/conference/woot19/presentation/fifield">USENIX WOOT 2019</a>
workshop.
The workshop talk
<a href="https://www.bamsoftware.com/talks/woot19-zipbomb/">video, slides, and transcript</a>
are available.
The <a href="#source">source code</a> of the paper is available.
The <a href="https://www.usenix.org/conference/woot19/call-for-artifacts">artifacts</a>
prepared for submission are <a href="https://www.bamsoftware.com/hacks/zipbomb/zipbomb-woot19.zip">zipbomb-woot19.zip</a>.
</p>

<p>
Did you find a system that chokes on one of these zip bombs?
Did they help you demonstrate a vulnerability or
win a bug bounty?
<a href="#contact">Let me know</a> and I'll try to mention it here.
</p>

<dl>
<dt id="libreoffice">LibreOffice 6.1.5.2</dt>
<dd>
<p>
zblg.zip renamed to zblg.odt or zblg.docx
will cause LibreOffice to
create and delete a number of ~4&nbsp;GB temporary files
as it attempts to determine the file format.
It does eventually finish, and it deletes
the temporary files as it goes,
so it's only a temporary DoS that doesn't fill up the disk.
Caolán McNamara replied to my bug report.
</p>
</dd>
<dt id="addons-server">Mozilla addons-server 2019.06.06</dt>
<dd>
<p>
I tried the zip bombs against a local installation of addons-server,
which is part of the software behind addons.mozilla.org.
The system handles it gracefully,
imposing a <a href="https://github.com/mozilla/addons-server/blob/2019.06.06/src/olympia/lib/settings_base.py#L1457-L1458">time limit</a>
of <time datetime="110s">110&nbsp;s</time> on extraction.
The zip bomb expands as fast as the disk will let it up to the time limit,
but after that point the process is killed and the unzipped files
are eventually automatically cleaned up.
</p>
</dd>
<dt id="unzip">UnZip 6.0</dt>
<dd>
<p>
Mark Adler wrote
<a href="https://github.com/madler/unzip/commits/6519bf0f8a896851d9708da11e1b63c818238c8f">a patch</a>
for UnZip to detect this class of zip bomb.
</p>
<p>
<time>2019-07-05</time>:
I noticed that <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-13232">CVE-2019-13232</a>
was assigned for UnZip.
Personally, I would dispute that UnZip's (or any zip parser's)
ability to process a zip bomb of the kind discussed here
necessarily represents a security vulnerability, or even a bug.
It's a natural implementation and does not violate the specification
in any way that I can tell.
The type discussed in this article is only one type of zip bomb,
and there are many ways in which zip parsing can go wrong that are not bombs.
If you want to defend against resource exhaustion attacks,
you should <em>not</em> try to enumerate, detect, and block
every individual known attack;
rather you should impose external limits on time and other resources
so that the parser cannot misbehave too much,
no matter what kind of attack it faces.
There is nothing wrong with attempting to detect and reject certain
constructions as a first-pass optimization,
but you can't stop there.
If you do not eventually isolate and limit
operations on untrusted data, your system is likely still vulnerable.
Consider an analogy with <a href="https://en.wikipedia.org/wiki/Cross-site_scripting">cross-site scripting</a> in HTML:
the right defense is not to try and filter out bytes that may be interpreted as code,
it's to escape everything properly.
</p>
<p>
Mark Adler's patch made its way into Debian in
<a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=931433">bug&nbsp;#931433</a>.
<!-- Debian 8 "Jessie" https://lists.debian.org/debian-lts-announce/2019/07/msg00005.html -->
There were some unanticipated consequences:
problems parsing certain Java JARs
(<a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=931895">bug #931895</a>)
and problems with the mutant zip format of Firefox's omni.ja file
(<a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=932404">bug #932404</a>).
SUSE decided
<a href="https://bugzilla.suse.com/show_bug.cgi?id=1140748#c2">not to do anything</a>
about CVE-2019-13232.
I think both Debian's and SUSE's choices are defensible.
</p>
<!-- https://bugzilla.redhat.com/show_bug.cgi?id=1727761 -->
<!-- https://bugs.gentoo.org/691566 -->
</dd>
<dt id="ronomon">ronomon/zip</dt>
<dd>
<p>
Shortly after the publication of this article,
Joran Dirk Greef published a
<a href="https://github.com/ronomon/zip">restrictive zip parser</a> (JavaScript)
that prohibits irregularities such as overlapping files
or unused space between files.
While it may thereby reject certain valid zip files,
the idea is to ensure that any downstream parsers
will receive only clean, easy-to-parse files.
</p>
</dd>
<dt id="antivirus">antivirus engines</dt>
<dd>
<p>
Overall, it seems that malware scanners have slowly begun
to recognize zip bombs of this kind
(or at least the specific samples available for download)
as malicious.
It would be interesting to see whether the detection is robust or brittle.
You could reverse the order of the entries in the central directory, for example,
and see whether the zip files are still detected.
In the <a href="#source">source code</a>,
there's a recipe for generating zbsm.extra.zip,
which is like zbsm.zip except that it uses
<a href="#extra">extra-field quoting</a> instead of
<a href="#quote">DEFLATE quoting</a>—if you are a customer
of an AV service that detects zbsm.zip but not zbsm.extra.zip,
you should ask for an explanation.
Another simple variant is
<a href="https://www.bamsoftware.com/hacks/zipbomb/spacer.txt">inserting spacer files between the bomb files</a>,
which may fool certain overlap-detection algorithms.
</p>
<p>
Twitter user @TVqQAAMAAAAEAAA
<a href="https://twitter.com/TVqQAAMAAAAEAAA/status/1146351962486476801">reports</a>
<!-- https://web.archive.org/web/20190703141828/https:/twitter.com/TVqQAAMAAAAEAAA/status/1146351962486476801 -->
"McAfee AV on my test machine just exploded."
I haven't independently confirmed it, nor do I have details such as a version number.
</p>
<p>
Tavis Ormandy <a href="https://twitter.com/taviso/status/1146477576132542466">points out</a>
<!-- https://web.archive.org/web/20190707044306/https://twitter.com/taviso/status/1146477576132542466 -->
that there are a number of "Timeout" results in
<a href="https://www.virustotal.com/gui/file/f1dc920869794df3e258f42f9b99157104cd3f8c14394c1b9d043d6fcda14c0a/detection">the VirusTotal for zblg.zip</a>
<small><a href="https://www.bamsoftware.com/hacks/zipbomb/vt-zblg-20190706.png">(screenshot <time>2019-07-06</time>)</a></small>.
<!-- Nor wayback machine nor archive.is worked on the virustotal site :(
https://web.archive.org/web/20190705165359/https://www.virustotal.com/gui/file/f1dc920869794df3e258f42f9b99157104cd3f8c14394c1b9d043d6fcda14c0a/detection
https://web.archive.org/web/20190705170818/https://www.virustotal.com/gui/file/fb4ff972d21189beec11e05109c4354d0cd6d3b629263d6c950cf8cc3f78bd99/detection
https://web.archive.org/web/20190705170924/https://www.virustotal.com/gui/file/eafd8f574ea7fd0f345eaa19eae8d0d78d5323c8154592c850a2d78a86817744/detection
-->
<!-- but the old-browsers mode kinda works
https://www.virustotal.com/old-browsers/file/fb4ff972d21189beec11e05109c4354d0cd6d3b629263d6c950cf8cc3f78bd99
http://archivecaslytosk.onion/sgvC9

https://www.virustotal.com/old-browsers/file/f1dc920869794df3e258f42f9b99157104cd3f8c14394c1b9d043d6fcda14c0a
http://archivecaslytosk.onion/ywtHj

https://www.virustotal.com/old-browsers/file/eafd8f574ea7fd0f345eaa19eae8d0d78d5323c8154592c850a2d78a86817744
http://archivecaslytosk.onion/Xz7q3
-->
AhnLab-V3, ClamAV, DrWeb, Endgame, F-Secure, GData, K7AntiVirus, K7GW, MaxSecure, McAfee, McAfee-GW-Edition, Panda, Qihoo-360, Sophos ML, VBA32.
<a href="https://www.virustotal.com/gui/file/fb4ff972d21189beec11e05109c4354d0cd6d3b629263d6c950cf8cc3f78bd99/detection">The results for zbsm.zip</a>
<small><a href="https://www.bamsoftware.com/hacks/zipbomb/vt-zbsm-20190706.png">(screenshot <time>2019-07-06</time>)</a></small>
are similar, though with a different set of timed-out engines:
Baido, Bkav, ClamAV, CMC, DrWeb, Endgame, ESET-NOD32, F-Secure, GData, Kingsoft, McAfee-GW-Edition, NANO-Antivirus, Acronis.
Interestingly, there are no timeouts in
<a href="https://www.virustotal.com/gui/file/eafd8f574ea7fd0f345eaa19eae8d0d78d5323c8154592c850a2d78a86817744/detection">the results for zbxl.zip</a>;
<small><a href="https://www.bamsoftware.com/hacks/zipbomb/vt-zbxl-20190706.png">(screenshot <time>2019-07-06</time>)</a></small>
perhaps this means that some antivirus doesn't support Zip64?
</p>
<p>
Forum user 100 <a href="https://forum.eset.com/topic/20123-zip-bombs-with-zip64-not-detected/">reported</a>
that a certain ESET product did not detect zbxl.zip, possibly because it uses Zip64.
An update in the thread three days later showed the product being updated to detect it.
</p>
<p>
In <a href="https://bugzilla.clamav.net/show_bug.cgi?id=12356">ClamAV bug 12356</a>,
Hanno Böck reported that zblg.zip caused high CPU usage
in clamscan.
<a href="https://bugzilla.clamav.net/show_bug.cgi?id=12356#c5">An initial patch</a>
to detect overlapping files
<a href="https://seclists.org/oss-sec/2019/q3/121">turned out to be incomplete</a>
because it only checked adjacent pairs of files.
(I personally mishandled this issue
by posting details of a workaround on the bug tracker,
instead of reporting it privately.)
<a href="https://bugzilla.clamav.net/show_bug.cgi?id=12356#c14">A later patch</a>
imposed a time limit on file analysis.
</p>
<p id="flytech">
<time>2020-07-28</time>: FlyTech Videos presented a
<a href="https://www.youtube.com/watch?v=peeYOqejWfg">video testing various zip bombs</a>,
including <a href="#zbxl">zbxl.zip</a>,
against Windows Defender, Windows Explorer, and 7-zip.
</p>
<p>
In my web server logs, I noticed a number of referers that
appear to point to bug trackers.
</p>
<ul>
<li>http://jira.athr.ru/browse/WEB-12882</li>
<li>https://project.avira.org/browse/ENGINE-2307</li>
<li>https://project.avira.org/browse/ENGINE-2363</li>
<li>https://topdesk-imp.cicapp.nl/tas/secure/mango/window/4</li>
<li>https://jira-eng-rtp3.cisco.com/jira/browse/AMP4E-4849</li>
<li>https://jira-eng-sjc1.cisco.com/jira/browse/CLAM-965</li>
<li>https://flightdataservices.atlassian.net/secure/RapidBoard.jspa?selectedIssue=FDS-136</li>
<li>https://projects.ucd.gpn.gov.uk/browse/VULN-1483</li>
<li>https://testrail-int.qa1.immunet.com/index.php?/cases/view/923720</li>
<li>http://redmine-int-prod.intranet.cnim.net/issues/5596</li>
<li>https://bugs.drweb.com/view.php?id=159759</li>
<li>https://dev-jira.dynatrace.org/browse/APM-188227</li>
<li>https://webgate.ec.europa.eu/CITnet/jira/browse/EPREL-2150</li>
<li>https://jira.egnyte-it.com/browse/IN-8480</li>
<li>https://jira.hq.eset.com/browse/CCDBL-1492</li>
<li>https://bugzilla.olympus.f5net.com/show_bug.cgi?id=819053</li>
<li>https://mantis.fortinet.com/bug_view_page.php?bug_id=0570222</li>
<li>https://redmine.joesecurity.org:64998/issues/4705</li>
<li>http://dev.maildev.jp/mantis/view.php?id=5839</li>
<li>https://confluence.managed.lu/pages/viewpage.action?pageId=47974242</li>
<li>https://jira-lvs.prod.mcafee.com/browse/TSWS-653</li>
<li>https://jira.modulbank.ru/browse/PV-33012</li>
<li>http://jira.netzwerk.intern:8080/browse/SALES-81</li>
<li>https://jira-hq.paloaltonetworks.local/browse/CON-43391</li>
<li>https://jira-hq.paloaltonetworks.local/browse/GSRT-11680</li>
<li>https://jira-hq.paloaltonetworks.local/browse/PAN-124201</li>
<li>https://paynearme.atlassian.net/browse/PNM-4494</li>
<li>https://jira.proofpoint.com/jira/browse/PE-29410</li>
<li>https://dev.pulsesecure.net/jira/browse/PRS-379163</li>
<li>https://qualtrics.atlassian.net/browse/APP-326</li>
<li>https://jira.sastdev.net/browse/CIS-2819</li>
<li>https://jira.sastdev.net/secure/RapidBoard.jspa?selectedIssue=EC-709</li>
<li>https://bugzilla.seeburger.de/show_bug.cgi?id=89294</li>
<li>https://svm.cert.siemens.com/auseno/create_edit_vulnerability.php?vulnid=48573</li>
<li>https://jira.sophos.net/browse/CPISSUE-6560</li>
<li>https://jira.vrt.sourcefire.com/browse/TT-1070</li>
<li>https://task.jarvis.trendmicro.com/browse/JPSE-10432</li>
<li>https://segjira.trendmicro.com:8443/browse/SEG-55636</li>
<li>https://segjira.trendmicro.com:8443/browse/SEG-58824</li>
<li>https://ucsc-cgl.atlassian.net/secure/RapidBoard.jspa?selectedIssue=SEAB-327</li>
<li>https://jira.withbc.com/browse/BC-43950</li>
<li>https://zscaler.zendesk.com/agent/tickets/849971</li>
</ul>
</dd>
<dt id="browsers">web browsers</dt>
<dd>
<p>
I didn't directly experience this myself,
but reports online say that Chrome and Safari may automatically unzip
files after downloading.
</p>
<ul>
<li><p><a href="https://habr.com/ru/post/459254/#comment_20369364">ittakir</a>: "Скачал самый маленький файл на 5GB, Chrome тут же начал его распаковывать, хотя его об этом не просили, ну и кушать процессор и диск." <i>"I downloaded the smallest file on 5GB, Chrome immediately began to unpack it, although it was not asked for it, well, to eat the processor and disk."</i></p></li>
<li><p><a href="https://old.reddit.com/r/programming/comments/c8ylxn/zblg_nonrecursive_zip_bomb_with_a_280000001_ratio/esrsxvi/">Rzah</a>: "Yet another reason why 'Open Safe files after downloading' is a stupid default setting for a web browser."</p></li>
</ul>
<p>
Chromium commit <a href="https://chromium.googlesource.com/chromium/src/+/f04d9b15bd1cba1433ad5453bc3ebff933d0e3bb">f04d9b15bd1cba1433ad5453bc3ebff933d0e3bb</a> is perhaps related:
</p>
<blockquote>
<p>
Add metrics detecting anomalously high ZIP compression ratios
</p>
<p>
It's possible for a single ZIP entry to be very large, even if we only
scan small ZIP archives. These metrics will measure how often that occurs.
</p>
</blockquote>
</dd>
<dt id="filesystems">filesystems</dt>
<dd>
<p>
Something I didn't anticipate:
unzipping one of the bombs on a compressed filesystem can be relatively safe.
</p>
<ul>
<li><p><a href="https://old.reddit.com/r/programming/comments/cbvqzu/the_most_clever_zip_bomb_ever_made_explodes_a/etkazxk/">flying_gel</a>:
"If I unzip this onto a compressed zfs dataset, will the resulting file be small? Edit: Just did a small test with a 42KB-&gt;5.5GB zip bomb. I ended up with 165MB worth of files so while just 3% of the full bomb, it's still a 4028 times inflation. ... I only have the standard LZ4 compression enabled, no dedup."</p></li>
</ul>
</dd>
<dt id="twitter">Twitter</dt>
<dd>
<p>
Links to this article had been widely shared on Twitter
since around <time>2019-07-02</time>,
but around <time>2019-07-20</time> it began showing
<a href="https://twitter.com/safety/unsafe_link_warning?unsafe_link=https://www.bamsoftware.com/hacks/zipbomb/">an "unsafe link" interstitial</a>
<small>(<a href="https://www.bamsoftware.com/hacks/zipbomb/twitter-unsafe.png">screenshot</a>, <a href="https://web.archive.org/web/20190721031831/https://twitter.com/safety/unsafe_link_warning?unsafe_link=https://www.bamsoftware.com/hacks/zipbomb/">archive</a>)</small>.
</p>
</dd>
<dt id="safebrowsing">Safe Browsing</dt>
<dd>
<p>
Sometime around <time>2019-07-23</time> it seems that this page,
and <em>every</em> page on a *.bamsoftware.com domain,
got added to the <a href="https://safebrowsing.google.com/">Safe Browsing</a>
service used by web browsers
to block malware and phishing sites.
<a href="https://transparencyreport.google.com/safe-browsing/search?url=bamsoftware.com">Site status check</a>,
<a href="https://www.bamsoftware.com/hacks/zipbomb/safebrowsing-www.bamsoftware.com-20190724.png">block page screenshot</a>.
From a few quick checks, it looks like pages on bamsoftware.com
have been demoted or delisted on the google.com search engine as well.
</p>
<p>
The Safe Browsing block is a bit annoying,
because it disrupted <a href="https://snowflake.torproject.org/">Snowflake</a>,
a completely unrelated service that happened to use the domain
snowflake-broker.bamsoftware.com, which did not even host any files
but was strictly a web API server.
See <a href="https://bugs.torproject.org/31230">#31230 Firefox addon blocked from agent by Google Safe Browsing service</a>.
</p>
<p>
The Safe Browsing block seemed to end
on or before
<a href="https://www.bamsoftware.com/hacks/zipbomb/transparencyreport.google-www.bamsoftware.com-20190816.png"><time>2019-08-16</time></a>.
</p>
</dd>
<dt id="xfinity">Xfinity xFi Protected Browsing</dt>
<dd>
<p>
On <time>2019-11-26</time>, I was informed
by Hooman Mohajeri Moghaddam
that the Comcast Xfinity xFi
<a href="https://www.vice.com/en_us/article/evm3qk/comcast-blocking-paypal-customers-say-forum-net-neutrality">"Protected Browsing"</a>
feature blocks the bamsoftware.com domain, including this page
(<a href="https://www.bamsoftware.com/hacks/zipbomb/xfinity-blockpage.png">screenshot</a>).
</p>
</dd>
<dt id="dlang">D std.zip</dt>
<dd>
<p>
The D programming language
<a href="https://issues.dlang.org/show_bug.cgi?id=20027">made a modification</a>
to the <a href="https://dlang.org/library/std/zip.html">std.zip module</a>
to detect overlapping files.
</p>
</dd>
<!-- https://issues.dlang.org/show_bug.cgi?id=20027 -->
<!-- https://github.com/golang/go/issues/33026 https://github.com/golang/go/issues/33036 -->

<dt id="ios">Apple iOS and iPadOS</dt>
<dd>
<p>
Dzmitry Plotnikau sent me a report saying that
a zip bomb could use up all cache storage
on iPhones running iOS 12 and 13, even if only opened using "Quick look."
The exhaustion of storage could have various side effects,
including misbehaving apps, deletion of local cloud files, and OS crashes,
in some cases requiring a factory reset to remedy.
The bug was mitigated in iOS 14.0
(and likely other, contemporaneous point release of iOS and iPadOS).
See <a href="https://support.apple.com/en-us/HT211850">HT211850</a>
under the "libarchive" heading.
</p>
</dd>
</dl>

</section>

<section id="plea">
<h2>A final plea</h2>

<p>
It's time to put an end to Facebook.
Working there is not ethically neutral:
every day that you go into work, you are doing something wrong.
If you have a Facebook account, delete it.
If you work at Facebook, quit.
</p>

<p>
And let us not forget that the National Security Agency
must be destroyed.
</p>

</section>

</article></div>]]></description>
        </item>
    </channel>
</rss>