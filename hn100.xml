<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
    <channel>
        <title>HN100 - Readable Contents</title>
        <link>https://hn.algolia.com/api/v1/search_by_date?tags=%28story,poll%29&amp;numericFilters=points%3E100</link>
        <description>Uses Readability to add bodies to the RSS feed</description>
        <lastBuildDate>Fri, 28 Nov 2025 01:30:04 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[250MWh 'Sand Battery' to start construction in Finland (112 pts)]]></title>
            <link>https://www.energy-storage.news/250mwh-sand-battery-to-start-construction-in-finland-for-both-heating-and-ancillary-services/</link>
            <guid>46073855</guid>
            <pubDate>Thu, 27 Nov 2025 22:48:44 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.energy-storage.news/250mwh-sand-battery-to-start-construction-in-finland-for-both-heating-and-ancillary-services/">https://www.energy-storage.news/250mwh-sand-battery-to-start-construction-in-finland-for-both-heating-and-ancillary-services/</a>, See on <a href="https://news.ycombinator.com/item?id=46073855">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-id="7673aec" data-element_type="section" data-settings="{&quot;jet_parallax_layout_list&quot;:[{&quot;jet_parallax_layout_image&quot;:{&quot;url&quot;:&quot;&quot;,&quot;id&quot;:&quot;&quot;,&quot;size&quot;:&quot;&quot;},&quot;_id&quot;:&quot;9297098&quot;,&quot;jet_parallax_layout_image_tablet&quot;:{&quot;url&quot;:&quot;&quot;,&quot;id&quot;:&quot;&quot;,&quot;size&quot;:&quot;&quot;},&quot;jet_parallax_layout_image_mobile&quot;:{&quot;url&quot;:&quot;&quot;,&quot;id&quot;:&quot;&quot;,&quot;size&quot;:&quot;&quot;},&quot;jet_parallax_layout_speed&quot;:{&quot;unit&quot;:&quot;%&quot;,&quot;size&quot;:50,&quot;sizes&quot;:[]},&quot;jet_parallax_layout_type&quot;:&quot;scroll&quot;,&quot;jet_parallax_layout_direction&quot;:&quot;1&quot;,&quot;jet_parallax_layout_fx_direction&quot;:null,&quot;jet_parallax_layout_z_index&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_x&quot;:50,&quot;jet_parallax_layout_bg_x_tablet&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_x_mobile&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_y&quot;:50,&quot;jet_parallax_layout_bg_y_tablet&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_y_mobile&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_size&quot;:&quot;auto&quot;,&quot;jet_parallax_layout_bg_size_tablet&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_size_mobile&quot;:&quot;&quot;,&quot;jet_parallax_layout_animation_prop&quot;:&quot;transform&quot;,&quot;jet_parallax_layout_on&quot;:[&quot;desktop&quot;,&quot;tablet&quot;]}]}" data-elementor-type="single-post" data-elementor-id="554" data-elementor-post-type="elementor_library">
					<div data-id="1305123" data-element_type="column">
						
				
				
				
				
				
				
				
				<div data-id="7d4060d" data-element_type="widget" data-widget_type="theme-post-content.default">
					<div>
<figure>
<figure><img fetchpriority="high" decoding="async" width="1024" height="632" data-id="91060" src="https://www.energy-storage.news/wp-content/uploads/2025/11/Screenshot-2025-11-26-110954-1024x632.jpg" alt="Polar Night Energy and Lahti Energia  are partnering on the Sand Battery project in Finland. Image: Polar Night Energy / Lahti Energia." srcset="https://www.energy-storage.news/wp-content/uploads/2025/11/Screenshot-2025-11-26-110954-1024x632.jpg 1024w, https://www.energy-storage.news/wp-content/uploads/2025/11/Screenshot-2025-11-26-110954-300x185.jpg 300w, https://www.energy-storage.news/wp-content/uploads/2025/11/Screenshot-2025-11-26-110954-768x474.jpg 768w, https://www.energy-storage.news/wp-content/uploads/2025/11/Screenshot-2025-11-26-110954.jpg 1278w" sizes="(max-width: 1024px) 100vw, 1024px"><figcaption>Polar Night Energy and Lahti Energia  are partnering on the Sand Battery project in Finland. Image: Polar Night Energy / Lahti Energia.</figcaption></figure>
</figure>



<p>Technology provider Polar Night Energy and utility Lahti Energia have partnered for a large-scale project using Polar’s ‘Sand Battery’ technology for the latter’s district heating network in Vääksy, Finland. </p>



<p>The project will have a heating power of 2MW and a thermal energy storage (TES) capacity of 250MW, making it a 125-hour system and the largest sand-based TES project once complete. </p>



<p>It will supply heat to Lahti Energia’s Vääksy district heating network but is also large enough to participate in Fingrid’s reserve and grid balancing markets. </p>



<p>Polar Night Energy’s technology works by heating a sand or a similar solid material using electricity, retaining that heat and then discharging that for industrial or heating use. </p></div><div><div><div>
<p>This article requires <span>Premium Subscription</span><span>Basic (FREE) Subscription</span></p>
<p>Already a subscriber? <a href="#">Sign In</a></p>
</div>
<div>
<h2>Try Premium for just $1</h2>
<ul>
<li><span></span><span>Full premium access for the first month at only $1</span></li>
<li><span></span><span>Converts to an annual rate after 30 days unless cancelled</span></li>
<li><span></span><span>Cancel anytime during the trial period</span></li>
</ul>

</div>
<div>
<h3>Premium Benefits</h3>
<ul>
<li><span></span><span>Expert industry analysis and interviews</span></li>
<li><span></span><span>Digital access to PV Tech Power journal</span></li>
<li><span></span><span>Exclusive event discounts</span></li>
</ul>

</div>
<div data-wk-call-status-user="guest">
<h3>Or continue reading this article for free</h3>

</div>
</div><div>



<p>The project will cut fossil-based emissions in the Vääksy district heating network by around 60% each year, by reducing natural gas use bu 80% and also decreasing wood chip consumption.</p>



<p>It follows Polar Night Energy <a href="https://www.energy-storage.news/100mwh-sand-battery-goes-into-commercial-operation-in-finland/">completing and putting a 1MW/100MWh Sand Battery TES project into commercial operations this summer</a>, for another utility&nbsp;Loviisan Lämpö. That project uses soapstone as its storage medium, a byproduct of ceramics production. </p>



<p>This latest project will use locally available natural sand, held in a container 14m high and 15m wide. Lahti Energia received a grant for the project from state body Business Finland.</p>



<p>Polar Night Energy will act as the main contractor for the construction project, with on-site work beginning in early 2026, and the Sand Battery will be completed in summer 2027.</p>



<p>“We want to offer our customers affordable district heating and make use of renewable energy in our heat production. The scale of this Sand Battery also enables us to participate in Fingrid’s reserve and grid balancing markets. As the share of weather-dependent energy grows in the grid, the Sand Battery will contribute to balancing electricity supply and demand”, says Jouni Haikarainen, CEO of Lahti Energia.</p>




</div></div>				</div>
				<div data-queried-id="91058|WP_Post" data-nav="{&quot;enabled&quot;:false,&quot;type&quot;:null,&quot;more_el&quot;:null,&quot;query&quot;:[],&quot;widget_settings&quot;:{&quot;lisitng_id&quot;:49216,&quot;posts_num&quot;:6,&quot;columns&quot;:1,&quot;columns_tablet&quot;:1,&quot;columns_mobile&quot;:1,&quot;column_min_width&quot;:240,&quot;column_min_width_tablet&quot;:240,&quot;column_min_width_mobile&quot;:240,&quot;inline_columns_css&quot;:false,&quot;is_archive_template&quot;:&quot;&quot;,&quot;post_status&quot;:[&quot;publish&quot;],&quot;use_random_posts_num&quot;:&quot;&quot;,&quot;max_posts_num&quot;:9,&quot;not_found_message&quot;:&quot;No data was found&quot;,&quot;is_masonry&quot;:false,&quot;equal_columns_height&quot;:&quot;&quot;,&quot;use_load_more&quot;:&quot;&quot;,&quot;load_more_id&quot;:&quot;&quot;,&quot;load_more_type&quot;:&quot;click&quot;,&quot;load_more_offset&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;size&quot;:0,&quot;sizes&quot;:[]},&quot;use_custom_post_types&quot;:&quot;&quot;,&quot;custom_post_types&quot;:[],&quot;hide_widget_if&quot;:&quot;empty_query&quot;,&quot;carousel_enabled&quot;:&quot;&quot;,&quot;slides_to_scroll&quot;:&quot;1&quot;,&quot;arrows&quot;:&quot;true&quot;,&quot;arrow_icon&quot;:&quot;fa fa-angle-left&quot;,&quot;dots&quot;:&quot;&quot;,&quot;autoplay&quot;:&quot;true&quot;,&quot;pause_on_hover&quot;:&quot;true&quot;,&quot;autoplay_speed&quot;:5000,&quot;infinite&quot;:&quot;true&quot;,&quot;center_mode&quot;:&quot;&quot;,&quot;effect&quot;:&quot;slide&quot;,&quot;speed&quot;:500,&quot;inject_alternative_items&quot;:&quot;&quot;,&quot;injection_items&quot;:[],&quot;scroll_slider_enabled&quot;:&quot;&quot;,&quot;scroll_slider_on&quot;:[&quot;desktop&quot;,&quot;tablet&quot;,&quot;mobile&quot;],&quot;custom_query&quot;:false,&quot;custom_query_id&quot;:&quot;&quot;,&quot;_element_id&quot;:&quot;&quot;,&quot;collapse_first_last_gap&quot;:false,&quot;list_tag_selection&quot;:&quot;&quot;,&quot;list_items_wrapper_tag&quot;:&quot;div&quot;,&quot;list_item_tag&quot;:&quot;div&quot;,&quot;empty_items_wrapper_tag&quot;:&quot;div&quot;}}" data-page="1" data-pages="1" data-listing-source="posts" data-listing-id="49216" data-query-id="" data-id="529fd35" data-element_type="widget" data-settings="{&quot;columns&quot;:&quot;1&quot;}" data-widget_type="jet-listing-grid.default"><div data-id="09bc75f" data-element_type="section" data-settings="{&quot;jet_parallax_layout_list&quot;:[]}" data-elementor-type="jet-listing-items" data-elementor-id="49216" data-elementor-post-type="jet-engine" data-post-id="67927">
						
				
				
				<div data-id="e1a93b6" data-element_type="widget" data-widget_type="jet-listing-dynamic-field.default"><p>NH Collection Vittorio Veneto, Rome, Italy</p></div>
				<div data-id="7188b76" data-element_type="widget" data-widget_type="text-editor.default">
				<p>
									Across two packed days, the Summit focused on three core themes: revenue &amp; trading, the lifecycle of the battery, and optimisation tools. Attendees explored innovative strategies for enhancing asset performance and longevity, with a spotlight on key markets like Germany, Italy, and the UK. Stay tuned for details on the 2025 edition of the Battery Asset Management Summit Europe, where we’ll continue to chart the path forward for energy storage asset management.								</p>
				</div>
				
					</div><div data-id="09bc75f" data-element_type="section" data-settings="{&quot;jet_parallax_layout_list&quot;:[]}" data-elementor-type="jet-listing-items" data-elementor-id="49216" data-elementor-post-type="jet-engine" data-post-id="49140">
						
				
				
				<div data-id="e1a93b6" data-element_type="widget" data-widget_type="jet-listing-dynamic-field.default"><p>InterContinental London - The O2, London, UK</p></div>
				<div data-id="7188b76" data-element_type="widget" data-widget_type="text-editor.default">
				<p>
									This isn’t just another summit – it’s our biggest and most exhilarating Summit yet! Picture this: immersive workshop spaces where ideas come to life, dedicated industry working groups igniting innovation, live podcasts sparking lively discussions, hard-hitting keynotes that will leave you inspired, and an abundance of networking opportunities that will take your connections to new heights!								</p>
				</div>
				
					</div></div>
				
				
				<div data-id="c456bdd" data-element_type="widget" data-widget_type="heading.default">
				<p>
					<h2>Read Next</h2>				</p>
				</div>
				<div data-queried-id="91058|WP_Post" data-nav="{&quot;enabled&quot;:false,&quot;type&quot;:null,&quot;more_el&quot;:null,&quot;query&quot;:[],&quot;widget_settings&quot;:{&quot;lisitng_id&quot;:513,&quot;posts_num&quot;:5,&quot;columns&quot;:1,&quot;columns_tablet&quot;:1,&quot;columns_mobile&quot;:1,&quot;column_min_width&quot;:240,&quot;column_min_width_tablet&quot;:240,&quot;column_min_width_mobile&quot;:240,&quot;inline_columns_css&quot;:false,&quot;is_archive_template&quot;:&quot;&quot;,&quot;post_status&quot;:[&quot;publish&quot;],&quot;use_random_posts_num&quot;:&quot;&quot;,&quot;max_posts_num&quot;:9,&quot;not_found_message&quot;:&quot;No data was found&quot;,&quot;is_masonry&quot;:false,&quot;equal_columns_height&quot;:&quot;&quot;,&quot;use_load_more&quot;:&quot;&quot;,&quot;load_more_id&quot;:&quot;&quot;,&quot;load_more_type&quot;:&quot;click&quot;,&quot;load_more_offset&quot;:{&quot;unit&quot;:&quot;px&quot;,&quot;size&quot;:0,&quot;sizes&quot;:[]},&quot;use_custom_post_types&quot;:&quot;&quot;,&quot;custom_post_types&quot;:[],&quot;hide_widget_if&quot;:&quot;&quot;,&quot;carousel_enabled&quot;:&quot;&quot;,&quot;slides_to_scroll&quot;:&quot;1&quot;,&quot;arrows&quot;:&quot;true&quot;,&quot;arrow_icon&quot;:&quot;fa fa-angle-left&quot;,&quot;dots&quot;:&quot;&quot;,&quot;autoplay&quot;:&quot;true&quot;,&quot;pause_on_hover&quot;:&quot;true&quot;,&quot;autoplay_speed&quot;:5000,&quot;infinite&quot;:&quot;true&quot;,&quot;center_mode&quot;:&quot;&quot;,&quot;effect&quot;:&quot;slide&quot;,&quot;speed&quot;:500,&quot;inject_alternative_items&quot;:&quot;&quot;,&quot;injection_items&quot;:[],&quot;scroll_slider_enabled&quot;:&quot;&quot;,&quot;scroll_slider_on&quot;:[&quot;desktop&quot;,&quot;tablet&quot;,&quot;mobile&quot;],&quot;custom_query&quot;:false,&quot;custom_query_id&quot;:&quot;&quot;,&quot;_element_id&quot;:&quot;&quot;,&quot;collapse_first_last_gap&quot;:false,&quot;list_tag_selection&quot;:&quot;&quot;,&quot;list_items_wrapper_tag&quot;:&quot;div&quot;,&quot;list_item_tag&quot;:&quot;div&quot;,&quot;empty_items_wrapper_tag&quot;:&quot;div&quot;}}" data-page="1" data-pages="131" data-listing-source="posts" data-listing-id="513" data-query-id="" data-id="58f2e59" data-element_type="widget" data-settings="{&quot;columns&quot;:&quot;1&quot;}" data-widget_type="jet-listing-grid.default"><div data-id="e6ad8cc" data-element_type="section" data-settings="{&quot;jet_parallax_layout_list&quot;:[{&quot;jet_parallax_layout_image&quot;:{&quot;url&quot;:&quot;&quot;,&quot;id&quot;:&quot;&quot;,&quot;size&quot;:&quot;&quot;},&quot;_id&quot;:&quot;8920bc9&quot;,&quot;jet_parallax_layout_image_tablet&quot;:{&quot;url&quot;:&quot;&quot;,&quot;id&quot;:&quot;&quot;,&quot;size&quot;:&quot;&quot;},&quot;jet_parallax_layout_image_mobile&quot;:{&quot;url&quot;:&quot;&quot;,&quot;id&quot;:&quot;&quot;,&quot;size&quot;:&quot;&quot;},&quot;jet_parallax_layout_speed&quot;:{&quot;unit&quot;:&quot;%&quot;,&quot;size&quot;:50,&quot;sizes&quot;:[]},&quot;jet_parallax_layout_type&quot;:&quot;scroll&quot;,&quot;jet_parallax_layout_direction&quot;:&quot;1&quot;,&quot;jet_parallax_layout_fx_direction&quot;:null,&quot;jet_parallax_layout_z_index&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_x&quot;:50,&quot;jet_parallax_layout_bg_x_tablet&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_x_mobile&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_y&quot;:50,&quot;jet_parallax_layout_bg_y_tablet&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_y_mobile&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_size&quot;:&quot;auto&quot;,&quot;jet_parallax_layout_bg_size_tablet&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_size_mobile&quot;:&quot;&quot;,&quot;jet_parallax_layout_animation_prop&quot;:&quot;transform&quot;,&quot;jet_parallax_layout_on&quot;:[&quot;desktop&quot;,&quot;tablet&quot;]}]}" data-elementor-type="jet-listing-items" data-elementor-id="513" data-elementor-post-type="jet-engine" data-post-id="91000">
					<div data-id="36443ab" data-element_type="column" data-widget_type="image.default">
				<p><a href="https://www.energy-storage.news/nostromos-thermal-ess-participates-in-caiso-energy-market/">
							<img src="https://www.energy-storage.news/wp-content/uploads/elementor/thumbs/Nostromo_600kWh_Icebrick_system_on_Medinol_rooftop-1-qybmzs80ci06an9t6yvrji91vk1x9m5sbfditmgix0.jpg" title="Nostromo IceBrick" alt="Nostromo IceBrick" loading="lazy">								</a>
															</p>
				</div>
				<div data-id="c8cccae" data-element_type="column" data-widget_type="text-editor.default">
				<p>
									Nostromo Energy’s IceBrick thermal energy storage (TES) technology will participate in the California Independent System Operator (CAISO) wholesale energy market. 								</p>
				</div>
					</div><div data-id="e6ad8cc" data-element_type="section" data-settings="{&quot;jet_parallax_layout_list&quot;:[{&quot;jet_parallax_layout_image&quot;:{&quot;url&quot;:&quot;&quot;,&quot;id&quot;:&quot;&quot;,&quot;size&quot;:&quot;&quot;},&quot;_id&quot;:&quot;8920bc9&quot;,&quot;jet_parallax_layout_image_tablet&quot;:{&quot;url&quot;:&quot;&quot;,&quot;id&quot;:&quot;&quot;,&quot;size&quot;:&quot;&quot;},&quot;jet_parallax_layout_image_mobile&quot;:{&quot;url&quot;:&quot;&quot;,&quot;id&quot;:&quot;&quot;,&quot;size&quot;:&quot;&quot;},&quot;jet_parallax_layout_speed&quot;:{&quot;unit&quot;:&quot;%&quot;,&quot;size&quot;:50,&quot;sizes&quot;:[]},&quot;jet_parallax_layout_type&quot;:&quot;scroll&quot;,&quot;jet_parallax_layout_direction&quot;:&quot;1&quot;,&quot;jet_parallax_layout_fx_direction&quot;:null,&quot;jet_parallax_layout_z_index&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_x&quot;:50,&quot;jet_parallax_layout_bg_x_tablet&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_x_mobile&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_y&quot;:50,&quot;jet_parallax_layout_bg_y_tablet&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_y_mobile&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_size&quot;:&quot;auto&quot;,&quot;jet_parallax_layout_bg_size_tablet&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_size_mobile&quot;:&quot;&quot;,&quot;jet_parallax_layout_animation_prop&quot;:&quot;transform&quot;,&quot;jet_parallax_layout_on&quot;:[&quot;desktop&quot;,&quot;tablet&quot;]}]}" data-elementor-type="jet-listing-items" data-elementor-id="513" data-elementor-post-type="jet-engine" data-post-id="91119">
					<div data-id="36443ab" data-element_type="column" data-widget_type="image.default">
				<p><a href="https://www.energy-storage.news/italian-battery-storage-market-pipeline-soars-developers-flock-from-around-europe/">
							<img src="https://www.energy-storage.news/wp-content/uploads/elementor/thumbs/Screenshot-2025-11-27-102310-rfbh454zzrkt475rfaurl9p6qvyckff55t8txbvv0k.png" title="Italy battery storage project database market research" alt="Italy battery storage project database market research" loading="lazy">								</a>
															</p>
				</div>
				<div data-id="c8cccae" data-element_type="column" data-widget_type="text-editor.default">
				<p>
									The utility-scale battery storage market in Italy is drawing huge interest and development activity, writes Solar Media Market Research analyst Josh Cornes.								</p>
				</div>
					</div><div data-id="e6ad8cc" data-element_type="section" data-settings="{&quot;jet_parallax_layout_list&quot;:[{&quot;jet_parallax_layout_image&quot;:{&quot;url&quot;:&quot;&quot;,&quot;id&quot;:&quot;&quot;,&quot;size&quot;:&quot;&quot;},&quot;_id&quot;:&quot;8920bc9&quot;,&quot;jet_parallax_layout_image_tablet&quot;:{&quot;url&quot;:&quot;&quot;,&quot;id&quot;:&quot;&quot;,&quot;size&quot;:&quot;&quot;},&quot;jet_parallax_layout_image_mobile&quot;:{&quot;url&quot;:&quot;&quot;,&quot;id&quot;:&quot;&quot;,&quot;size&quot;:&quot;&quot;},&quot;jet_parallax_layout_speed&quot;:{&quot;unit&quot;:&quot;%&quot;,&quot;size&quot;:50,&quot;sizes&quot;:[]},&quot;jet_parallax_layout_type&quot;:&quot;scroll&quot;,&quot;jet_parallax_layout_direction&quot;:&quot;1&quot;,&quot;jet_parallax_layout_fx_direction&quot;:null,&quot;jet_parallax_layout_z_index&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_x&quot;:50,&quot;jet_parallax_layout_bg_x_tablet&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_x_mobile&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_y&quot;:50,&quot;jet_parallax_layout_bg_y_tablet&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_y_mobile&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_size&quot;:&quot;auto&quot;,&quot;jet_parallax_layout_bg_size_tablet&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_size_mobile&quot;:&quot;&quot;,&quot;jet_parallax_layout_animation_prop&quot;:&quot;transform&quot;,&quot;jet_parallax_layout_on&quot;:[&quot;desktop&quot;,&quot;tablet&quot;]}]}" data-elementor-type="jet-listing-items" data-elementor-id="513" data-elementor-post-type="jet-engine" data-post-id="90899">
					<div data-id="36443ab" data-element_type="column" data-widget_type="image.default">
				<p><a href="https://www.energy-storage.news/germany-bess-firsts-integrated-software-multi-party-optimisation-privileged-permitting/">
							<img src="https://www.energy-storage.news/wp-content/uploads/elementor/thumbs/Tangermunde-rf80aaipu7u2pyq8ct5mv9yxxpkkin58nbfbxiymro.jpg" title="The Tangermünde BESS in Germany. Image: Dynamic." alt="The Tangermünde BESS in Germany. Image: Dynamic." loading="lazy">								</a>
															</p>
				</div>
				<div data-id="c8cccae" data-element_type="column" data-widget_type="text-editor.default">
				<p>
									A week of claimed first-of-their-kind advances in Germany’s BESS market, including the combination of monitoring, diagnostics and energy trading on one platform, an optimisation deal allowing multiple companies to trade one asset, and a law change accelerating permitting. 								</p>
				</div>
					</div><div data-id="e6ad8cc" data-element_type="section" data-settings="{&quot;jet_parallax_layout_list&quot;:[{&quot;jet_parallax_layout_image&quot;:{&quot;url&quot;:&quot;&quot;,&quot;id&quot;:&quot;&quot;,&quot;size&quot;:&quot;&quot;},&quot;_id&quot;:&quot;8920bc9&quot;,&quot;jet_parallax_layout_image_tablet&quot;:{&quot;url&quot;:&quot;&quot;,&quot;id&quot;:&quot;&quot;,&quot;size&quot;:&quot;&quot;},&quot;jet_parallax_layout_image_mobile&quot;:{&quot;url&quot;:&quot;&quot;,&quot;id&quot;:&quot;&quot;,&quot;size&quot;:&quot;&quot;},&quot;jet_parallax_layout_speed&quot;:{&quot;unit&quot;:&quot;%&quot;,&quot;size&quot;:50,&quot;sizes&quot;:[]},&quot;jet_parallax_layout_type&quot;:&quot;scroll&quot;,&quot;jet_parallax_layout_direction&quot;:&quot;1&quot;,&quot;jet_parallax_layout_fx_direction&quot;:null,&quot;jet_parallax_layout_z_index&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_x&quot;:50,&quot;jet_parallax_layout_bg_x_tablet&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_x_mobile&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_y&quot;:50,&quot;jet_parallax_layout_bg_y_tablet&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_y_mobile&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_size&quot;:&quot;auto&quot;,&quot;jet_parallax_layout_bg_size_tablet&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_size_mobile&quot;:&quot;&quot;,&quot;jet_parallax_layout_animation_prop&quot;:&quot;transform&quot;,&quot;jet_parallax_layout_on&quot;:[&quot;desktop&quot;,&quot;tablet&quot;]}]}" data-elementor-type="jet-listing-items" data-elementor-id="513" data-elementor-post-type="jet-engine" data-post-id="90745">
					<div data-id="36443ab" data-element_type="column" data-widget_type="image.default">
				<p><a href="https://www.energy-storage.news/european-bess-m-a-and-financings-totalling-over-1gw/">
							<img src="https://www.energy-storage.news/wp-content/uploads/elementor/thumbs/Poland-BESS-Rendering-rf15u8dcccnkafw1yba0olyzawtoeiolup5ugfniro.jpg" title="A render of a typical BESS that Northland provided when announcing its Poland acquisition. Image: Northland Power." alt="A render of a typical BESS that Northland provided when announcing its Poland acquisition. Image: Northland Power." loading="lazy">								</a>
															</p>
				</div>
				<div data-id="c8cccae" data-element_type="column" data-widget_type="text-editor.default">
				<p>
									In a major week for European BESS deal-making, project acquisition and financing deals have been done in the Poland, Germany, Finland, the UK and Romania for grid-scale projects totalling well over 1GW of capacity.								</p>
				</div>
					</div><div data-id="e6ad8cc" data-element_type="section" data-settings="{&quot;jet_parallax_layout_list&quot;:[{&quot;jet_parallax_layout_image&quot;:{&quot;url&quot;:&quot;&quot;,&quot;id&quot;:&quot;&quot;,&quot;size&quot;:&quot;&quot;},&quot;_id&quot;:&quot;8920bc9&quot;,&quot;jet_parallax_layout_image_tablet&quot;:{&quot;url&quot;:&quot;&quot;,&quot;id&quot;:&quot;&quot;,&quot;size&quot;:&quot;&quot;},&quot;jet_parallax_layout_image_mobile&quot;:{&quot;url&quot;:&quot;&quot;,&quot;id&quot;:&quot;&quot;,&quot;size&quot;:&quot;&quot;},&quot;jet_parallax_layout_speed&quot;:{&quot;unit&quot;:&quot;%&quot;,&quot;size&quot;:50,&quot;sizes&quot;:[]},&quot;jet_parallax_layout_type&quot;:&quot;scroll&quot;,&quot;jet_parallax_layout_direction&quot;:&quot;1&quot;,&quot;jet_parallax_layout_fx_direction&quot;:null,&quot;jet_parallax_layout_z_index&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_x&quot;:50,&quot;jet_parallax_layout_bg_x_tablet&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_x_mobile&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_y&quot;:50,&quot;jet_parallax_layout_bg_y_tablet&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_y_mobile&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_size&quot;:&quot;auto&quot;,&quot;jet_parallax_layout_bg_size_tablet&quot;:&quot;&quot;,&quot;jet_parallax_layout_bg_size_mobile&quot;:&quot;&quot;,&quot;jet_parallax_layout_animation_prop&quot;:&quot;transform&quot;,&quot;jet_parallax_layout_on&quot;:[&quot;desktop&quot;,&quot;tablet&quot;]}]}" data-elementor-type="jet-listing-items" data-elementor-id="513" data-elementor-post-type="jet-engine" data-post-id="90545">
					<div data-id="36443ab" data-element_type="column" data-widget_type="image.default">
				<p><a href="https://www.energy-storage.news/leag-enlists-hyperstrong-for-1-6gwh-germany-bess/">
							<img src="https://www.energy-storage.news/wp-content/uploads/elementor/thumbs/LEAG_Kraftwerk_Boxberg-rexk2hsmsjeaovummffnl09bbl86mv7fvqp9ughi2s.jpg" title="LEAG’s Boxberg power plant, where the BESS with HyperStrong will be built. Image: LEAG." alt="LEAG's Boxberg power plant, where the BESS with HyperStrong will be built. Image: LEAG." loading="lazy">								</a>
															</p>
				</div>
				<div data-id="c8cccae" data-element_type="column" data-widget_type="text-editor.default">
				<p>
									Utility and power firm LEAG has partnered with Chinese system integrator HyperStrong for a 400MW/1,600MWh BESS in Saxony, Germany. 								</p>
				</div>
					</div></div>
					</div>
				<div data-id="de27d08" data-element_type="column" data-widget_type="heading.default">
				<p>
					<h2>Most Popular</h2>				</p>
				</div>
					</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Underrated reasons to be thankful V (119 pts)]]></title>
            <link>https://dynomight.net/thanks-5/</link>
            <guid>46073033</guid>
            <pubDate>Thu, 27 Nov 2025 20:37:51 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://dynomight.net/thanks-5/">https://dynomight.net/thanks-5/</a>, See on <a href="https://news.ycombinator.com/item?id=46073033">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
<article>
  <header>
    <img src="https://dynomight.net/img/valley.jpg">
    

  </header>  

  <section>
    

    <ol>
  <li>
    <p>That your dog, while she appears to love you only because she’s been adapted by evolution to appear to love you, really does love you.</p>
  </li>
  <li>
    <p>That if you’re a life form and you cook up a baby and copy your genes to them, you’ll find that the genes have been degraded due to oxidative stress et al., which isn’t cause for celebration, but if you find some other hopefully-hot person and randomly swap in half of their genes, your baby will still be somewhat less fit compared to you and your hopefully-hot friend on average, but now there is variance, so if you cook up several babies, one of them might be as fit or even fitter than you, and that one will likely have more babies than your other babies have, and thus complex life can persist in a universe with increasing entropy.</p>
  </li>
  <li>
    <p>That if we wanted to, we surely <em>could</em> figure out which of the 300-ish strains of rhinovirus are circulating in a given area at a given time and rapidly vaccinate people to stop it and thereby finally “cure” the common cold, and though this is too annoying to pursue right now, it seems like it’s just a matter of time.</p>
  </li>
  <li>
    <p>That if you look back at history, you see that plagues went from Europe to the Americas but not the other way, which suggests that urbanization and travel are great allies for infectious disease, and these both continue today but are held in check by sanitation and vaccines even while we have lots of tricks like UVC light and high-frequency sound and air filtration and waste monitoring and paying people to stay home that we’ve barely even put in play.</p>
  </li>
  <li>
    <p>That while engineered infectious diseases loom ever-larger as a potential very big problem, we also have lots of crazier tricks we <em>could</em> pull out like panopticon viral screening or toilet monitors or daily individualized saliva sampling or engineered microbe-resistant surfaces or even dividing society into cells with rotating interlocks or having people walk around in little personal spacesuits, and while admittedly most of this doesn’t sound awesome, I see no reason this shouldn’t be a battle that we would win.</p>
  </li>
  <li>
    <p>That clean water, unlimited, almost free.</p>
  </li>
  <li>
    <p>That dentistry.</p>
  </li>
  <li>
    <p>That tongues.</p>
  </li>
  <li>
    <p>That radioactive atoms either release a ton of energy but also quickly stop existing—a gram of Rubidium-90 scattered around your kitchen emits as much energy as ~200,000 incandescent lightbulbs but after an hour only 0.000000113g is left—or don’t put out very much energy but keep existing for a long time—a gram of Carbon-14 only puts out the equivalent of 0.0000212 light bulbs but if you start with a gram, you’ll still have 0.999879g after a year—so it isn’t actually <em>that</em> easy to permanently poison the environment with radiation although Cobalt-60 with its medium energy output and medium half-life is unfortunate, medical applications notwithstanding I still wish Cobalt-60 didn’t exist, screw you Cobalt-60.</p>
  </li>
  <li>
    <p>That while curing all cancer would only increase life expectancy by ~3 years and curing all heart disease would only increase life expectancy by ~3 years, and preventing all accidents would only increase life expectancy by ~1.5 years, if we did all of these at the same time and then a lot of other stuff too, eventually the effects would go nonlinear, so trying to cure cancer isn’t actually a waste of time, thankfully.</p>
  </li>
  <li>
    <p>That the peroxisome, while the mitochondria and their stupid Krebs cycle get all the attention, when a fatty-acid that’s too long for them to catabolize comes along, who you gonna call.</p>
  </li>
  <li>
    <p>That we have preferences, that there’s no agreed ordering of how good different things are, which is neat, and not something that would obviously be true for an alien species, and given our limited resources probably makes us happier on net.</p>
  </li>
  <li>
    <p>That cardamom, it is cheap but tastes expensive, if cardamom cost 1000× more, people would brag about how they flew to Sri Lanka so they could taste chai made with fresh cardamom and swear that it changed their whole life.</p>
  </li>
  <li>
    <p>That Gregory of Nyssa, he was right.</p>
  </li>
  <li>
    <p>That Grandma Moses, it’s not too late.</p>
  </li>
  <li>
    <p>That sleep, that probably evolution first made a low-energy mode so we don’t starve so fast and then layered on some maintenance processes, but the effect is that we live in a cycle and when things aren’t going your way it’s comforting that reality doesn’t stretch out before you indefinitely but instead you can look forward to a reset and a pause that’s somehow neither experienced nor skipped.</p>
  </li>
  <li>
    <p>That, glamorous or not, comfortable or not, cheap or not, carbon emitting or not, air travel is very safe.</p>
  </li>
  <li>
    <p>That, for most of the things you’re worried about, the markets are less worried than you and they have the better track record, though not the issue of your mortality.</p>
  </li>
  <li>
    <p>That sexual attraction to romantic love to economic unit to reproduction, it’s a strange bundle, but who are we to argue with success.</p>
  </li>
  <li>
    <p>That every symbolic expression recursively built from differentiable elementary functions has a derivative that can also be written as a recursive combination of elementary functions, although the latter expression may require vastly more terms.</p>
  </li>
  <li>
    <p>That every expression graph built from differentiable elementary functions and producing a scalar output has a gradient that can itself be written as an expression graph, and furthermore that the latter expression graph is always the same size as the first one and is easy to find, and thus that it’s possible to fit very large expression graphs to data.</p>
  </li>
  <li>
    <p>That, eerily, biological life and biological intelligence does not appear to make use of that property of expression graphs.</p>
  </li>
  <li>
    <p>That if you look at something and move your head around, you observe the entire light field, which is a five-dimensional function of three spatial coordinates and two angles, and yet if you do something fancy with lasers, somehow that entire light field can be stored on a single piece of normal two-dimensional film and then replayed later.</p>
  </li>
  <li>
    <p>That, as far as I can tell, the reason five-dimensional light fields can be stored on two-dimensional film simply cannot be explained without quite a lot of wave mechanics, a vivid example of the strangeness of this place and proof that all those physicists with their diffractions and phase conjugations really are up to something.</p>
  </li>
  <li>
    <p>That disposable plastic, littered or not, harmless when consumed as thousands of small particles or not, is popular for a reason.</p>
  </li>
  <li>
    <p>That disposable plastic, when disposed of correctly, is literally carbon sequestration, and that if/when air-derived plastic replaces dead-plankton-derived plastic, this might be incredibly convenient, although it must be said that currently the carbon in disposable plastic only represents a single-digit percentage of total carbon emissions.</p>
  </li>
  <li>
    <p>That rocks can be broken into pieces and then you can’t un-break the pieces but you can check that they came from the same rock, it’s basically cryptography.</p>
  </li>
  <li>
    <p>That the deal society has made is that if you have kids then everyone you encounter is obligated to chip in a bit to assist you, and this seems to mostly work without the need for constant grimy negotiated transactions as Econ 101 would suggest, although the exact contours of this deal seem to be a bit murky.</p>
  </li>
  <li>
    <p>That of all the humans that have ever lived, the majority lived under some kind of autocracy, with the rest distributed among tribal bands, chiefdoms, failed states, and flawed democracies, and only something like 1% enjoyed free elections and the rule of law and civil liberties and minimal corruption, yet we endured and today that number is closer to 10%, and so if you find yourself outside that set, do not lose heart.</p>
  </li>
  <li>
    <p>That if you were in two dimensions and you tried to eat something then maybe your body would split into two pieces since the whole path from mouth to anus would have to be disconnected, so be thankful you’re in three dimensions, although maybe you could have some kind of jigsaw-shaped digestive tract so your two pieces would only jiggle around or maybe you could use the same orifice for both purposes, remember that if you ever find yourself in two dimensions, I guess.</p>
  </li>
</ol>

<p>(<a href="https://dynomight.net/thanks/">previously</a>, <a href="https://dynomight.net/thanks-2/">previously</a>, <a href="https://dynomight.net/thanks-3/">previously</a>, <a href="https://dynomight.net/thanks-4">previously</a>)</p>


  </section>

  <hr>

  

  <section>
    
    
    <p>Comments at
      
        <a href="https://lemmy.world/post/39398444">lemmy</a> or 
        <a href="https://dynomight.substack.com/p/thanks-5">substack</a>.
      
      

  </p></section>
  <hr>
  <section>

    <!-- <h3>related internet content opportunities</h3> -->

<span>Related</span>
<p>
    <a href="https://dynomight.net/arguments-3/">Things to argue about over the holidays instead of politics III</a> · 
    
          <a href="https://dynomight.net/#lists">lists</a>
    
    </p>

      <p>
    <a href="https://dynomight.net/thanks-4/">Underrated reasons to be thankful IV</a> · 
    
          <a href="https://dynomight.net/#lists">lists</a>
    
    </p>

      <p>
    <a href="https://dynomight.net/travel/">Obvious travel advice</a> · 
    
          <a href="https://dynomight.net/#life">life</a>
    
          <a href="https://dynomight.net/#lists">lists</a>
    
    </p>

      <p>
    <a href="https://dynomight.net/things/">Things that don't work</a> · 
    
          <a href="https://dynomight.net/#lists">lists</a>
    
    </p>

      

  </section>
  <hr>
  

</article>


</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[LinkedIn is loud, and corporate is hell (164 pts)]]></title>
            <link>https://ramones.dev/posts/linkedin-is-loud/</link>
            <guid>46072988</guid>
            <pubDate>Thu, 27 Nov 2025 20:30:21 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://ramones.dev/posts/linkedin-is-loud/">https://ramones.dev/posts/linkedin-is-loud/</a>, See on <a href="https://news.ycombinator.com/item?id=46072988">Hacker News</a></p>
<div id="readability-page-1" class="page"><section>
            <blockquote>
<p>Disclaimer: this is based on emotions and not much else</p>
</blockquote>
<p>I'm so tired of reading the same post 10x because everyone wants to be included.</p>
<p>What's hot right now is the CloudFlare outage. Everyone misses the actual issue which was that there were no (automated) tests/QA that were done to prevent this bug. Even a feature flag would've been sufficient so they could've seen the issue early-on.</p>
<p>This is what every LinkedIn poster does:</p>
<ul>
<li>Open ChatGPT</li>
<li>"Rewrite this linkedin post about the cloudflare outage"</li>
<li><em>AI steers towards the use of <code>.unwrap()</code></em></li>
<li><em>LinkedIn man doesn't fact check anything or reads the post-mortem</em></li>
</ul>
<p>Result:
"Le unwrap is le dangerous. Here's how the unwrap works"</p>
<p>I'm so fucking tired. I don't care about your company, nor do I care about you. I don't care because YOU don't care either about what you post. You don't care about your career, only how it looks. In hindsight, this is the perfect representation of how LLM's function, so I'm not surprised managers are best friends with ChatGPT.</p>
<p>I'm not surprised corporate social media is lifeless, but I'm surprised no one actually cares. How do these people stay motivated to do anything. It can't just be money, right?</p>
<p>I added a disclaimer because I do feel like this post is very short-sighted. This feeling roots into the fact I'm tired of corporate hell, and these feelings resulted in me not being very productive at work. This also resulted in me being let go soon (also known as a PIP!).</p>
<p>You can skip this part if you don't care about my career.</p>
<p>When I started out at $COMPANY, it was mostly building tools with, from time to time, a manager doing a check-up. This worked amazingly, as I had time to learn and improve, and I was able to deliver.</p>
<p>Fast-forward a few months, we now have 3 managers, 1 dev (hi), and a buttload of busywork that needs to be done yesterday. From what I understand, a manager is supposed to be your safetynet and keep the context switching to a minimum. Tickets should feel like little updates, yet they take up 40% of my work (which could've been spent on solutioning). Since I'm the lead dev, any busywork will move tickets further back. This also means I'm to blame, because I should've been way earlier with alerting <em>them</em> about the project's drift. I'M NOT A PM! It's my job to make the project and keep you up to date. If this isn't sufficient then go to the PM (oh wait, that's not me!). Another big issue I have with this workflow is that we're sometimes moving priorization mid-cycle due to client requests. This is fine if it wasn't low priority stuff a client <em>wants</em> but doesn't <em>need</em>.</p>
<p>I get almost nothing done and I've grown tired of living in Linear. I wouldn't say I'm burnt-out. Similarly to an orgasm, you'd know if you had one. The company has turned into a startup with only the shortcomings and all of the corporate hell I wanted to avoid.</p>
<p>As I mentioned before, I'm being let go in January (as well as other people at the company). 2026 is going to start interestingly, but I think it would be free-ing. I still wish everyone at the company the best, because there are some smart and kind people I will miss.</p>

        </section></div>]]></description>
        </item>
        <item>
            <title><![CDATA[DeepSeekMath-V2: Towards Self-Verifiable Mathematical Reasoning [pdf] (106 pts)]]></title>
            <link>https://github.com/deepseek-ai/DeepSeek-Math-V2/blob/main/DeepSeekMath_V2.pdf</link>
            <guid>46072786</guid>
            <pubDate>Thu, 27 Nov 2025 20:03:25 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/deepseek-ai/DeepSeek-Math-V2/blob/main/DeepSeekMath_V2.pdf">https://github.com/deepseek-ai/DeepSeek-Math-V2/blob/main/DeepSeekMath_V2.pdf</a>, See on <a href="https://news.ycombinator.com/item?id=46072786">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
            


<react-partial partial-name="marketing-navigation" data-ssr="true" data-attempted-ssr="true" data-react-profiling="false">
  
  
  <div data-target="react-partial.reactRoot"><nav aria-label="Global"><ul><li><div><ul><li><div><p><span>AI CODE CREATION</span></p><ul><li><a href="https://github.com/features/copilot" data-analytics-event="{&quot;action&quot;:&quot;github_copilot&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;platform&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;github_copilot_link_platform_navbar&quot;}"><div><p><span>GitHub Copilot</span><span>Write better code with AI</span></p></div></a></li><li><a href="https://github.com/features/spark" data-analytics-event="{&quot;action&quot;:&quot;github_spark&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;platform&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;github_spark_link_platform_navbar&quot;}"><div><p><span>GitHub Spark</span><span>Build and deploy intelligent apps</span></p></div></a></li><li><a href="https://github.com/features/models" data-analytics-event="{&quot;action&quot;:&quot;github_models&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;platform&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;github_models_link_platform_navbar&quot;}"><div><p><span>GitHub Models</span><span>Manage and compare prompts</span></p></div></a></li><li><a href="https://github.com/mcp" data-analytics-event="{&quot;action&quot;:&quot;mcp_registry&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;platform&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;mcp_registry_link_platform_navbar&quot;}"><div><p><span>MCP Registry<sup>New</sup></span><span>Integrate external tools</span></p></div></a></li></ul></div></li><li><div><p><span>DEVELOPER WORKFLOWS</span></p><ul><li><a href="https://github.com/features/actions" data-analytics-event="{&quot;action&quot;:&quot;actions&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;platform&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;actions_link_platform_navbar&quot;}"><div><p><span>Actions</span><span>Automate any workflow</span></p></div></a></li><li><a href="https://github.com/features/codespaces" data-analytics-event="{&quot;action&quot;:&quot;codespaces&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;platform&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;codespaces_link_platform_navbar&quot;}"><div><p><span>Codespaces</span><span>Instant dev environments</span></p></div></a></li><li><a href="https://github.com/features/issues" data-analytics-event="{&quot;action&quot;:&quot;issues&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;platform&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;issues_link_platform_navbar&quot;}"><div><p><span>Issues</span><span>Plan and track work</span></p></div></a></li><li><a href="https://github.com/features/code-review" data-analytics-event="{&quot;action&quot;:&quot;code_review&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;platform&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;code_review_link_platform_navbar&quot;}"><div><p><span>Code Review</span><span>Manage code changes</span></p></div></a></li></ul></div></li><li><div><p><span>APPLICATION SECURITY</span></p><ul><li><a href="https://github.com/security/advanced-security" data-analytics-event="{&quot;action&quot;:&quot;github_advanced_security&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;platform&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;github_advanced_security_link_platform_navbar&quot;}"><div><p><span>GitHub Advanced Security</span><span>Find and fix vulnerabilities</span></p></div></a></li><li><a href="https://github.com/security/advanced-security/code-security" data-analytics-event="{&quot;action&quot;:&quot;code_security&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;platform&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;code_security_link_platform_navbar&quot;}"><div><p><span>Code security</span><span>Secure your code as you build</span></p></div></a></li><li><a href="https://github.com/security/advanced-security/secret-protection" data-analytics-event="{&quot;action&quot;:&quot;secret_protection&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;platform&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;secret_protection_link_platform_navbar&quot;}"><div><p><span>Secret protection</span><span>Stop leaks before they start</span></p></div></a></li></ul></div></li><li><div><p><span>EXPLORE</span></p><ul><li><a href="https://github.com/why-github" data-analytics-event="{&quot;action&quot;:&quot;why_github&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;platform&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;why_github_link_platform_navbar&quot;}"><span>Why GitHub</span></a></li><li><a href="https://docs.github.com/" data-analytics-event="{&quot;action&quot;:&quot;documentation&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;platform&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;documentation_link_platform_navbar&quot;}" target="_blank" rel="noreferrer"><span>Documentation</span></a></li><li><a href="https://github.blog/" data-analytics-event="{&quot;action&quot;:&quot;blog&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;platform&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;blog_link_platform_navbar&quot;}" target="_blank" rel="noreferrer"><span>Blog</span></a></li><li><a href="https://github.blog/changelog" data-analytics-event="{&quot;action&quot;:&quot;changelog&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;platform&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;changelog_link_platform_navbar&quot;}" target="_blank" rel="noreferrer"><span>Changelog</span></a></li><li><a href="https://github.com/marketplace" data-analytics-event="{&quot;action&quot;:&quot;marketplace&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;platform&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;marketplace_link_platform_navbar&quot;}"><span>Marketplace</span></a></li></ul></div></li></ul><p><a href="https://github.com/features" data-analytics-event="{&quot;action&quot;:&quot;view_all_features&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;platform&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;view_all_features_link_platform_navbar&quot;}"><span>View all features</span></a></p></div></li><li><div><ul><li><div><p><span>BY COMPANY SIZE</span></p><ul><li><a href="https://github.com/enterprise" data-analytics-event="{&quot;action&quot;:&quot;enterprises&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;solutions&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;enterprises_link_solutions_navbar&quot;}"><span>Enterprises</span></a></li><li><a href="https://github.com/team" data-analytics-event="{&quot;action&quot;:&quot;small_and_medium_teams&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;solutions&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;small_and_medium_teams_link_solutions_navbar&quot;}"><span>Small and medium teams</span></a></li><li><a href="https://github.com/enterprise/startups" data-analytics-event="{&quot;action&quot;:&quot;startups&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;solutions&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;startups_link_solutions_navbar&quot;}"><span>Startups</span></a></li><li><a href="https://github.com/solutions/industry/nonprofits" data-analytics-event="{&quot;action&quot;:&quot;nonprofits&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;solutions&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;nonprofits_link_solutions_navbar&quot;}"><span>Nonprofits</span></a></li></ul></div></li><li><div><p><span>BY USE CASE</span></p><ul><li><a href="https://github.com/solutions/use-case/app-modernization" data-analytics-event="{&quot;action&quot;:&quot;app_modernization&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;solutions&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;app_modernization_link_solutions_navbar&quot;}"><span>App Modernization</span></a></li><li><a href="https://github.com/solutions/use-case/devsecops" data-analytics-event="{&quot;action&quot;:&quot;devsecops&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;solutions&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;devsecops_link_solutions_navbar&quot;}"><span>DevSecOps</span></a></li><li><a href="https://github.com/solutions/use-case/devops" data-analytics-event="{&quot;action&quot;:&quot;devops&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;solutions&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;devops_link_solutions_navbar&quot;}"><span>DevOps</span></a></li><li><a href="https://github.com/solutions/use-case/ci-cd" data-analytics-event="{&quot;action&quot;:&quot;ci/cd&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;solutions&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;ci/cd_link_solutions_navbar&quot;}"><span>CI/CD</span></a></li><li><a href="https://github.com/solutions/use-case" data-analytics-event="{&quot;action&quot;:&quot;view_all_use_cases&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;solutions&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;view_all_use_cases_link_solutions_navbar&quot;}"><span>View all use cases</span></a></li></ul></div></li><li><div><p><span>BY INDUSTRY</span></p><ul><li><a href="https://github.com/solutions/industry/healthcare" data-analytics-event="{&quot;action&quot;:&quot;healthcare&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;solutions&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;healthcare_link_solutions_navbar&quot;}"><span>Healthcare</span></a></li><li><a href="https://github.com/solutions/industry/financial-services" data-analytics-event="{&quot;action&quot;:&quot;financial_services&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;solutions&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;financial_services_link_solutions_navbar&quot;}"><span>Financial services</span></a></li><li><a href="https://github.com/solutions/industry/manufacturing" data-analytics-event="{&quot;action&quot;:&quot;manufacturing&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;solutions&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;manufacturing_link_solutions_navbar&quot;}"><span>Manufacturing</span></a></li><li><a href="https://github.com/solutions/industry/government" data-analytics-event="{&quot;action&quot;:&quot;government&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;solutions&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;government_link_solutions_navbar&quot;}"><span>Government</span></a></li><li><a href="https://github.com/solutions/industry" data-analytics-event="{&quot;action&quot;:&quot;view_all_industries&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;solutions&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;view_all_industries_link_solutions_navbar&quot;}"><span>View all industries</span></a></li></ul></div></li></ul><p><a href="https://github.com/solutions" data-analytics-event="{&quot;action&quot;:&quot;view_all_solutions&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;solutions&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;view_all_solutions_link_solutions_navbar&quot;}"><span>View all solutions</span></a></p></div></li><li><div><ul><li><div><p><span>EXPLORE BY TOPIC</span></p><ul><li><a href="https://github.com/resources/articles?topic=ai" data-analytics-event="{&quot;action&quot;:&quot;ai&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;resources&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;ai_link_resources_navbar&quot;}"><span>AI</span></a></li><li><a href="https://github.com/resources/articles?topic=software-development" data-analytics-event="{&quot;action&quot;:&quot;software_development&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;resources&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;software_development_link_resources_navbar&quot;}"><span>Software Development</span></a></li><li><a href="https://github.com/resources/articles?topic=devops" data-analytics-event="{&quot;action&quot;:&quot;devops&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;resources&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;devops_link_resources_navbar&quot;}"><span>DevOps</span></a></li><li><a href="https://github.com/resources/articles?topic=security" data-analytics-event="{&quot;action&quot;:&quot;security&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;resources&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;security_link_resources_navbar&quot;}"><span>Security</span></a></li><li><a href="https://github.com/resources/articles" data-analytics-event="{&quot;action&quot;:&quot;view_all_topics&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;resources&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;view_all_topics_link_resources_navbar&quot;}"><span>View all topics</span></a></li></ul></div></li><li><div><p><span>EXPLORE BY TYPE</span></p><ul><li><a href="https://github.com/customer-stories" data-analytics-event="{&quot;action&quot;:&quot;customer_stories&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;resources&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;customer_stories_link_resources_navbar&quot;}"><span>Customer stories</span></a></li><li><a href="https://github.com/resources/events" data-analytics-event="{&quot;action&quot;:&quot;events__webinars&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;resources&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;events__webinars_link_resources_navbar&quot;}"><span>Events &amp; webinars</span></a></li><li><a href="https://github.com/resources/whitepapers" data-analytics-event="{&quot;action&quot;:&quot;ebooks__reports&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;resources&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;ebooks__reports_link_resources_navbar&quot;}"><span>Ebooks &amp; reports</span></a></li><li><a href="https://github.com/solutions/executive-insights" data-analytics-event="{&quot;action&quot;:&quot;business_insights&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;resources&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;business_insights_link_resources_navbar&quot;}"><span>Business insights</span></a></li><li><a href="https://skills.github.com/" data-analytics-event="{&quot;action&quot;:&quot;github_skills&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;resources&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;github_skills_link_resources_navbar&quot;}" target="_blank" rel="noreferrer"><span>GitHub Skills</span></a></li></ul></div></li><li><div><p><span>SUPPORT &amp; SERVICES</span></p><ul><li><a href="https://docs.github.com/" data-analytics-event="{&quot;action&quot;:&quot;documentation&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;resources&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;documentation_link_resources_navbar&quot;}" target="_blank" rel="noreferrer"><span>Documentation</span></a></li><li><a href="https://support.github.com/" data-analytics-event="{&quot;action&quot;:&quot;customer_support&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;resources&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;customer_support_link_resources_navbar&quot;}" target="_blank" rel="noreferrer"><span>Customer support</span></a></li><li><a href="https://github.com/orgs/community/discussions" data-analytics-event="{&quot;action&quot;:&quot;community_forum&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;resources&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;community_forum_link_resources_navbar&quot;}"><span>Community forum</span></a></li><li><a href="https://github.com/trust-center" data-analytics-event="{&quot;action&quot;:&quot;trust_center&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;resources&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;trust_center_link_resources_navbar&quot;}"><span>Trust center</span></a></li><li><a href="https://github.com/partners" data-analytics-event="{&quot;action&quot;:&quot;partners&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;resources&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;partners_link_resources_navbar&quot;}"><span>Partners</span></a></li></ul></div></li></ul></div></li><li><div><ul><li><div><p><span>COMMUNITY</span></p><ul><li><a href="https://github.com/sponsors" data-analytics-event="{&quot;action&quot;:&quot;github_sponsors&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;open_source&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;github_sponsors_link_open_source_navbar&quot;}"><div><p><span>GitHub Sponsors</span><span>Fund open source developers</span></p></div></a></li></ul></div></li><li><div><p><span>PROGRAMS</span></p><ul><li><a href="https://securitylab.github.com/" data-analytics-event="{&quot;action&quot;:&quot;security_lab&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;open_source&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;security_lab_link_open_source_navbar&quot;}" target="_blank" rel="noreferrer"><span>Security Lab</span></a></li><li><a href="https://maintainers.github.com/" data-analytics-event="{&quot;action&quot;:&quot;maintainer_community&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;open_source&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;maintainer_community_link_open_source_navbar&quot;}" target="_blank" rel="noreferrer"><span>Maintainer Community</span></a></li><li><a href="https://github.com/accelerator" data-analytics-event="{&quot;action&quot;:&quot;accelerator&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;open_source&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;accelerator_link_open_source_navbar&quot;}"><span>Accelerator</span></a></li><li><a href="https://archiveprogram.github.com/" data-analytics-event="{&quot;action&quot;:&quot;archive_program&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;open_source&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;archive_program_link_open_source_navbar&quot;}" target="_blank" rel="noreferrer"><span>Archive Program</span></a></li></ul></div></li><li><div><p><span>REPOSITORIES</span></p><ul><li><a href="https://github.com/topics" data-analytics-event="{&quot;action&quot;:&quot;topics&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;open_source&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;topics_link_open_source_navbar&quot;}"><span>Topics</span></a></li><li><a href="https://github.com/trending" data-analytics-event="{&quot;action&quot;:&quot;trending&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;open_source&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;trending_link_open_source_navbar&quot;}"><span>Trending</span></a></li><li><a href="https://github.com/collections" data-analytics-event="{&quot;action&quot;:&quot;collections&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;open_source&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;collections_link_open_source_navbar&quot;}"><span>Collections</span></a></li></ul></div></li></ul></div></li><li><div><ul><li><div><p><span>ENTERPRISE SOLUTIONS</span></p><ul><li><a href="https://github.com/enterprise" data-analytics-event="{&quot;action&quot;:&quot;enterprise_platform&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;enterprise&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;enterprise_platform_link_enterprise_navbar&quot;}"><div><p><span>Enterprise platform</span><span>AI-powered developer platform</span></p></div></a></li></ul></div></li><li><div><p><span>AVAILABLE ADD-ONS</span></p><ul><li><a href="https://github.com/security/advanced-security" data-analytics-event="{&quot;action&quot;:&quot;github_advanced_security&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;enterprise&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;github_advanced_security_link_enterprise_navbar&quot;}"><div><p><span>GitHub Advanced Security</span><span>Enterprise-grade security features</span></p></div></a></li><li><a href="https://github.com/features/copilot/copilot-business" data-analytics-event="{&quot;action&quot;:&quot;copilot_for_business&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;enterprise&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;copilot_for_business_link_enterprise_navbar&quot;}"><div><p><span>Copilot for Business</span><span>Enterprise-grade AI features</span></p></div></a></li><li><a href="https://github.com/premium-support" data-analytics-event="{&quot;action&quot;:&quot;premium_support&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;enterprise&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;premium_support_link_enterprise_navbar&quot;}"><div><p><span>Premium Support</span><span>Enterprise-grade 24/7 support</span></p></div></a></li></ul></div></li></ul></div></li><li><a href="https://github.com/pricing" data-analytics-event="{&quot;action&quot;:&quot;pricing&quot;,&quot;tag&quot;:&quot;link&quot;,&quot;context&quot;:&quot;pricing&quot;,&quot;location&quot;:&quot;navbar&quot;,&quot;label&quot;:&quot;pricing_link_pricing_navbar&quot;}"><span>Pricing</span></a></li></ul></nav></div>
</react-partial>



        <div>
                


<qbsearch-input data-scope="repo:deepseek-ai/DeepSeek-Math-V2" data-custom-scopes-path="/search/custom_scopes" data-delete-custom-scopes-csrf="KkxTgK84NCfz5QEi2HNQCG4qDA5uRw2sJSfhdJkZsRKyGLvXmzqYxPerZKwOoIRG0Kr2yhAxIb4DeCoobreU0g" data-max-custom-scopes="10" data-header-redesign-enabled="false" data-initial-value="" data-blackbird-suggestions-path="/search/suggestions" data-jump-to-suggestions-path="/_graphql/GetSuggestedNavigationDestinations" data-current-repository="deepseek-ai/DeepSeek-Math-V2" data-current-org="deepseek-ai" data-current-owner="" data-logged-in="false" data-copilot-chat-enabled="false" data-nl-search-enabled="false" data-retain-scroll-position="true">
  <div data-modal-dialog-overlay="" data-action="click:qbsearch-input#searchInputContainerClicked">
  <modal-dialog data-action="close:qbsearch-input#handleClose cancel:qbsearch-input#handleClose" data-target="qbsearch-input.searchSuggestionsDialog" role="dialog" id="search-suggestions-dialog" aria-modal="true" aria-labelledby="search-suggestions-dialog-header" data-view-component="true">
      <h2 id="search-suggestions-dialog-header">Search code, repositories, users, issues, pull requests...</h2>
    
</modal-dialog></div>
  
  <div>
    
<dialog-helper>
  <dialog data-target="qbsearch-input.feedbackDialog" data-action="close:qbsearch-input#handleDialogClose cancel:qbsearch-input#handleDialogClose" id="feedback-dialog" aria-modal="true" aria-labelledby="feedback-dialog-title" aria-describedby="feedback-dialog-description" data-view-component="true">
    <div data-view-component="true">
    <p>
      <h2 id="feedback-dialog-title">
        Provide feedback
      </h2>
        
    </p>
    
  </div>
      <scrollable-region data-labelled-by="feedback-dialog-title">
        <div data-view-component="true">        <!-- '"` --><!-- </textarea></xmp> --><form id="code-search-feedback-form" data-turbo="false" action="/search/feedback" accept-charset="UTF-8" method="post">
          <p>We read every piece of feedback, and take your input very seriously.</p>
          
          
          <label for="include_email">Include my email address so I can be contacted</label>
</form></div>
      </scrollable-region>
      
</dialog></dialog-helper>

    <custom-scopes data-target="qbsearch-input.customScopesManager">
    
<dialog-helper>
  <dialog data-target="custom-scopes.customScopesModalDialog" data-action="close:qbsearch-input#handleDialogClose cancel:qbsearch-input#handleDialogClose" id="custom-scopes-dialog" aria-modal="true" aria-labelledby="custom-scopes-dialog-title" aria-describedby="custom-scopes-dialog-description" data-view-component="true">
    <div data-view-component="true">
    <p>
      <h2 id="custom-scopes-dialog-title">
        Saved searches
      </h2>
        <h2 id="custom-scopes-dialog-description">Use saved searches to filter your results more quickly</h2>
    </p>
    
  </div>
      <scrollable-region data-labelled-by="custom-scopes-dialog-title">
        
      </scrollable-region>
      
</dialog></dialog-helper>
    </custom-scopes>
  </div>
</qbsearch-input>


            <div>
              <p><a href="https://github.com/login?return_to=https%3A%2F%2Fgithub.com%2Fdeepseek-ai%2FDeepSeek-Math-V2%2Fblob%2Fmain%2FDeepSeekMath_V2.pdf" data-hydro-click="{&quot;event_type&quot;:&quot;authentication.click&quot;,&quot;payload&quot;:{&quot;location_in_page&quot;:&quot;site header menu&quot;,&quot;repository_id&quot;:null,&quot;auth_type&quot;:&quot;SIGN_UP&quot;,&quot;originating_url&quot;:&quot;https://github.com/deepseek-ai/DeepSeek-Math-V2/blob/main/DeepSeekMath_V2.pdf&quot;,&quot;user_id&quot;:null}}" data-hydro-click-hmac="2bfa6d81e1d65d4e56d7bb927010a0798471a3aa1e60971f9890cbb918c112ec" data-analytics-event="{&quot;category&quot;:&quot;Marketing nav&quot;,&quot;action&quot;:&quot;click to go to homepage&quot;,&quot;label&quot;:&quot;ref_page:Marketing;ref_cta:Sign in;ref_loc:Header&quot;}">
                Sign in
              </a>
            </p></div>

              <p><a href="https://github.com/signup?ref_cta=Sign+up&amp;ref_loc=header+logged+out&amp;ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&amp;source=header-repo&amp;source_repo=deepseek-ai%2FDeepSeek-Math-V2" data-hydro-click="{&quot;event_type&quot;:&quot;authentication.click&quot;,&quot;payload&quot;:{&quot;location_in_page&quot;:&quot;site header menu&quot;,&quot;repository_id&quot;:null,&quot;auth_type&quot;:&quot;SIGN_UP&quot;,&quot;originating_url&quot;:&quot;https://github.com/deepseek-ai/DeepSeek-Math-V2/blob/main/DeepSeekMath_V2.pdf&quot;,&quot;user_id&quot;:null}}" data-hydro-click-hmac="2bfa6d81e1d65d4e56d7bb927010a0798471a3aa1e60971f9890cbb918c112ec" data-analytics-event="{&quot;category&quot;:&quot;Sign up&quot;,&quot;action&quot;:&quot;click to sign up for account&quot;,&quot;label&quot;:&quot;ref_page:/<user-name>/<repo-name>/blob/show;ref_cta:Sign up;ref_loc:header logged out&quot;}">
                Sign up
              </a></p><p>
    <react-partial-anchor>
      <tool-tip id="tooltip-0d2917b0-4dfc-4410-bf17-b77e32b21b9e" for="icon-button-ac934fd2-a26a-4deb-87fd-edd042deff63" popover="manual" data-direction="s" data-type="label" data-view-component="true">Appearance settings</tool-tip>

      <template data-target="react-partial-anchor.template">
        <link crossorigin="anonymous" media="all" rel="stylesheet" href="https://github.githubassets.com/assets/primer-react.c918010dadb8d146d90b.module.css">
<link crossorigin="anonymous" media="all" rel="stylesheet" href="https://github.githubassets.com/assets/appearance-settings.753d458774a2f782559b.module.css">

<react-partial partial-name="appearance-settings" data-ssr="false" data-attempted-ssr="false" data-react-profiling="false">
  
  <script type="application/json" data-target="react-partial.embeddedData">{"props":{}}</script>
  <div data-target="react-partial.reactRoot"></div>
</react-partial>


      </template>
    </react-partial-anchor>
  </p>

          </div>
      </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[AI CEO – Replace your boss before they replace you (371 pts)]]></title>
            <link>https://replaceyourboss.ai/</link>
            <guid>46072002</guid>
            <pubDate>Thu, 27 Nov 2025 18:37:41 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://replaceyourboss.ai/">https://replaceyourboss.ai/</a>, See on <a href="https://news.ycombinator.com/item?id=46072002">Hacker News</a></p>
&lt;Unparsable&gt;]]></description>
        </item>
        <item>
            <title><![CDATA[The input stack on Linux: An end-to-end architecture overview (101 pts)]]></title>
            <link>https://venam.net/blog/unix/2025/11/27/input_devices_linux.html</link>
            <guid>46071030</guid>
            <pubDate>Thu, 27 Nov 2025 16:55:30 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://venam.net/blog/unix/2025/11/27/input_devices_linux.html">https://venam.net/blog/unix/2025/11/27/input_devices_linux.html</a>, See on <a href="https://news.ycombinator.com/item?id=46071030">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
  <article>
    <p><img src="https://venam.net/blog/assets/input_devices_linux/astrolabe_img.jpg" alt="An Astrolabe" title="Astrolabe"></p>

<h2 id="intro">Intro</h2>

<p>Let’s explore and deobfuscate the input stack on Linux. Our aim is to
understand its components and what each does. Input handling can be
divided into two parts, separated by a common layer:</p>

<ul>
  <li>Kernel-level handling: It deals with what happens in the kernel and how events are exposed to user-space
    <ul>
      <li>The actual hardware connected to the machine, along with the different buses and I/O/transport subsystems</li>
      <li>The input core subsystem, and the specific device drivers that register on it</li>
    </ul>
  </li>
  <li>Exposed layer (middle)
    <ul>
      <li>The event abstraction subsystem (evdev)</li>
      <li>devtmpfs for device nodes</li>
      <li>sysfs for kernel objects and device attributes</li>
      <li>procfs for an introspection interface of the input core</li>
    </ul>
  </li>
  <li>User-space handling:
    <ul>
      <li>The user-space device manager (udev) and hardware database (hwdb) for device management and setup</li>
      <li>The libinput library for general input, and other libraries such as
XKB for keyboards, to interpret the events and make them manageable</li>
      <li>The Widgets, X Server, X11 window managers, and Wayland compositors,
which rely on everything else</li>
    </ul>
  </li>
</ul>

<p>We’ll try to make sense of all this, one thing at a time, with a logical
and coherent approach.</p>

<p><em>NB: This article compiles my understand, for any correction please
contact me.</em></p>

<h2 id="the-kernels-input-core">The Kernel’s Input Core</h2>

<p>How are input devices and their events handled in the kernel? You might
think it is useless to know, but understanding some of the kernel logic
is what makes things click.<br>
The input core is the central piece of the kernel responsible for handling
input devices and their events. Most input devices go through it, although
some bypass it entirely but these are special use-cases. It provides
common abstract components that sit between the low-level hardware,
and the more useful features for user-space, along with a sort of
publish-subscribe system.</p>

<p>To follow along you can either download the kernel
source, or view it in any browser explorer (such as
<a href="https://github.com/torvalds/linux/blob/master/drivers/input/input.c">this</a>,
<a href="https://elixir.bootlin.com/linux/v6.17.9/source/drivers/input/input.c">this</a>,
or <a href="https://reverser.dev/linux-kernel-explorer">this</a>).</p>

<p>Practically, the input core is found in the kernel under
<code>drivers/input/input.c</code>, it defines the basic functionalities related
to the lifecycle of an input device, defined as a <code>struct input_dev</code>
(<code>input.h</code>). Namely:</p>

<ul>
  <li>Allocating the input device structure (<code>input_allocate_device</code> that
returns a <code>struct input_dev</code>)</li>
  <li>Registering and unregistering the input device in the system
along with setting sane default values
(<code>input_register_device</code> adds to <code>input_dev_list</code>). This also integrates with devtmpfs,
exposing the device, and with procfs, exposing debugging information
(<code>/proc/bus/input/</code>).</li>
  <li>Drivers push events to the input core using <code>input_event</code>. The core then
forwards the events to the registered handlers in
a fan-out fashion (<code>input_register_handler</code> adds an <code>input_handler</code> to <code>input_handler_list</code>). Then handlers forward
them to all clients in user-space (called <code>input_handle</code>) listening
for events on that handler. The clients are registered on
the handler with <code>input_register_handle</code> (similar confusing names).
The user-space client/handle can also grab the handler with exclusivity
through <code>input_grab_device</code> (ex: <code>EVIOCGRAB</code> in evdev).<br>
By default the evdev (event device) is attached as the default input
handler and exposes these events to user-space in a standardized way
via an evdev created character stream in devtmpfs (<code>/dev/input/eventX</code>).</li>
</ul>

<p>An input handler is an implementation of an abstract interface
(<code>include/linux/input.h</code>), which the input core will call. Particularly,
the <code>input_event</code> function in input core will invoke the implementation
of the input handler’s <code>events</code> function. Here’s the interface an input
handler should fulfil:</p>

<figure><pre><code data-lang="c"><span>struct</span> <span>input_handler</span> <span>{</span>
	<span>void</span> <span>(</span><span>*</span><span>event</span><span>)(</span><span>struct</span> <span>input_handle</span> <span>*</span><span>handle</span><span>,</span> <span>unsigned</span> <span>int</span> <span>type</span><span>,</span>
			        <span>unsigned</span> <span>int</span> <span>code</span><span>,</span> <span>int</span> <span>value</span><span>);</span>
	<span>unsigned</span> <span>int</span> <span>(</span><span>*</span><span>events</span><span>)(</span><span>struct</span> <span>input_handle</span> <span>*</span><span>handle</span><span>,</span>
			       <span>struct</span> <span>input_value</span> <span>*</span><span>vals</span><span>,</span> <span>unsigned</span> <span>int</span> <span>count</span><span>);</span>
	<span>bool</span> <span>(</span><span>*</span><span>filter</span><span>)(</span><span>struct</span> <span>input_handle</span> <span>*</span><span>handle</span><span>,</span> <span>unsigned</span> <span>int</span> <span>type</span><span>,</span>
			       <span>unsigned</span> <span>int</span> <span>code</span><span>,</span> <span>int</span> <span>value</span><span>);</span>
	<span>bool</span> <span>(</span><span>*</span><span>match</span><span>)(</span><span>struct</span> <span>input_handler</span> <span>*</span><span>handler</span><span>,</span>
			       <span>struct</span> <span>input_dev</span> <span>*</span><span>dev</span><span>);</span>
	<span>int</span> <span>(</span><span>*</span><span>connect</span><span>)(</span><span>struct</span> <span>input_handler</span> <span>*</span><span>handler</span><span>,</span>
			      <span>struct</span> <span>input_dev</span> <span>*</span><span>dev</span><span>,</span>
			      <span>const</span> <span>struct</span> <span>input_device_id</span> <span>*</span><span>id</span><span>);</span>
	<span>void</span> <span>(</span><span>*</span><span>disconnect</span><span>)(</span><span>struct</span> <span>input_handle</span> <span>*</span><span>handle</span><span>);</span>
	<span>void</span> <span>(</span><span>*</span><span>start</span><span>)(</span><span>struct</span> <span>input_handle</span> <span>*</span><span>handle</span><span>);</span>
	<span>/* …
	 */</span>
<span>};</span></code></pre></figure>

<p>In the same way, a handle list is simply a pointer to a device and a
handler, along with a function to process events:</p>

<figure><pre><code data-lang="c"><span>struct</span> <span>input_handle</span> <span>{</span>
	<span>void</span> <span>*</span><span>private</span><span>;</span>

	<span>int</span> <span>open</span><span>;</span>
	<span>const</span> <span>char</span> <span>*</span><span>name</span><span>;</span>

	<span>struct</span> <span>input_dev</span> <span>*</span><span>dev</span><span>;</span>
	<span>struct</span> <span>input_handler</span> <span>*</span><span>handler</span><span>;</span>

	<span>unsigned</span> <span>int</span> <span>(</span><span>*</span><span>handle_events</span><span>)(</span><span>struct</span> <span>input_handle</span> <span>*</span><span>handle</span><span>,</span>
				      <span>struct</span> <span>input_value</span> <span>*</span><span>vals</span><span>,</span>
				      <span>unsigned</span> <span>int</span> <span>count</span><span>);</span>

	<span>struct</span> <span>list_head</span>	<span>d_node</span><span>;</span>
	<span>struct</span> <span>list_head</span>	<span>h_node</span><span>;</span>
<span>};</span></code></pre></figure>

<p>And the <code>input_dev</code> abstraction returned by <code>input_allocate_device</code>
is a much biger structure:</p>

<figure><pre><code data-lang="c"><span>struct</span> <span>input_dev</span> <span>{</span>
	<span>const</span> <span>char</span> <span>*</span><span>name</span><span>;</span>
	<span>const</span> <span>char</span> <span>*</span><span>phys</span><span>;</span>
	<span>const</span> <span>char</span> <span>*</span><span>uniq</span><span>;</span>
	<span>struct</span> <span>input_id</span> <span>id</span><span>;</span>
<span>…</span>
	<span>unsigned</span> <span>int</span> <span>keycodemax</span><span>;</span>
	<span>unsigned</span> <span>int</span> <span>keycodesize</span><span>;</span>
	<span>void</span> <span>*</span><span>keycode</span><span>;</span>
<span>…</span>
	<span>int</span> <span>(</span><span>*</span><span>setkeycode</span><span>)(</span><span>struct</span> <span>input_dev</span> <span>*</span><span>dev</span><span>,</span>
			  <span>const</span> <span>struct</span> <span>input_keymap_entry</span> <span>*</span><span>ke</span><span>,</span>
			  <span>unsigned</span> <span>int</span> <span>*</span><span>old_keycode</span><span>);</span>
	<span>int</span> <span>(</span><span>*</span><span>getkeycode</span><span>)(</span><span>struct</span> <span>input_dev</span> <span>*</span><span>dev</span><span>,</span>
			  <span>struct</span> <span>input_keymap_entry</span> <span>*</span><span>ke</span><span>);</span>
<span>…</span>
	<span>int</span> <span>(</span><span>*</span><span>open</span><span>)(</span><span>struct</span> <span>input_dev</span> <span>*</span><span>dev</span><span>);</span>
	<span>void</span> <span>(</span><span>*</span><span>close</span><span>)(</span><span>struct</span> <span>input_dev</span> <span>*</span><span>dev</span><span>);</span>
	<span>int</span> <span>(</span><span>*</span><span>flush</span><span>)(</span><span>struct</span> <span>input_dev</span> <span>*</span><span>dev</span><span>,</span> <span>struct</span> <span>file</span> <span>*</span><span>file</span><span>);</span>
	<span>int</span> <span>(</span><span>*</span><span>event</span><span>)(</span><span>struct</span> <span>input_dev</span> <span>*</span><span>dev</span><span>,</span> <span>unsigned</span> <span>int</span> <span>type</span><span>,</span> <span>unsigned</span> <span>int</span> <span>code</span><span>,</span> <span>int</span> <span>value</span><span>);</span>
<span>…</span>
	<span>struct</span> <span>device</span> <span>dev</span><span>;</span>
<span>…</span>
	<span>struct</span> <span>list_head</span>	<span>h_list</span><span>;</span>
	<span>struct</span> <span>list_head</span>	<span>node</span><span>;</span>
<span>};</span></code></pre></figure>

<p>Each actual specific input device driver builds on top of the functions of the
input core in their internal code, adding their own specificities and
advertising what capabilities and features the device can generate. This
creates a polymorphic-like abstraction where common input core logic is
reused, and where input event handlers are abstracted away. In general,
the main role of input drivers is to translate the device specific
protocol to a more standardized protocol, such as evdev, so that it can
be useful in user-space. And additionally, as with most drivers way of
communicating with the rest of the system, they can possibly have extra
configuration through an ioctl interface.</p>

<p>Along with all this, the kernel has a mechanism called sysfs that is
used to expose its internal objects (kobject) to user-space. Anytime
a device is created, it is exposed in <code>/sys/</code> (usually mounted there)
with its properties (<code>/sys/devices/</code>). For the input core part, we can
find it in <code>/sys/class/input/inputN</code>, and within each sub-directories
we have the properties of the object.<br>
Furthermore, when a device is plugged or unplugged (<code>device_add</code>,
<code>device_remove</code> in <code>drivers/base/core.c</code>), the kernel also emits events,
called uevent, via netlink (<code>PF_NETLINK, NETLINK_KOBJECT_UEVENT</code>) which
can then be caught in user-space and acted upon. We’ll see later how
these are handled by udev.</p>

<p>The kobject structure looks like this:</p>

<figure><pre><code data-lang="c"><span>struct</span> <span>kobject</span> <span>{</span>
        <span>const</span> <span>char</span>              <span>*</span><span>name</span><span>;</span>
        <span>struct</span> <span>list_head</span>        <span>entry</span><span>;</span>
        <span>struct</span> <span>kobject</span>          <span>*</span><span>parent</span><span>;</span>
        <span>struct</span> <span>kset</span>             <span>*</span><span>kset</span><span>;</span>
        <span>struct</span> <span>kobj_type</span>        <span>*</span><span>ktype</span><span>;</span>
        <span>struct</span> <span>sysfs_dirent</span>     <span>*</span><span>sd</span><span>;</span>
        <span>struct</span> <span>kref</span>             <span>kref</span><span>;</span>
        <span>unsigned</span> <span>int</span> <span>state_initialized</span><span>:</span><span>1</span><span>;</span>
        <span>unsigned</span> <span>int</span> <span>state_in_sysfs</span><span>:</span><span>1</span><span>;</span>
        <span>unsigned</span> <span>int</span> <span>state_add_uevent_sent</span><span>:</span><span>1</span><span>;</span>
        <span>unsigned</span> <span>int</span> <span>state_remove_uevent_sent</span><span>:</span><span>1</span><span>;</span>
        <span>unsigned</span> <span>int</span> <span>uevent_suppress</span><span>:</span><span>1</span><span>;</span>
<span>};</span></code></pre></figure>

<p>This is a general overview of our understanding of the input core so far:</p>

<p><img src="https://venam.net/blog/assets/input_devices_linux/input_core.png" alt="Input Core Overview" title="Input Core Overview"></p>

<h2 id="the-logical-input-device-topological-path">The Logical Input Device Topological Path</h2>

<p>We may commonly say that devices are connected to a machine and magically
handled from there on. Yet, we know that it’s an abstraction and that
there’s more to it. What happens in reality is that the electrical
connection first passes over a bus/host controller, which then let’s the
data be transported. This data is formatted in a specific input protocol
that should be handled by a driver that speaks it and that subsequently
creates a related input device. In most input device cases, the driver
then translates the protocol into evdev <em>“common speech”</em>.<br>
That’s a whole layer of things before reaching the input core. Just like
in the world of networking, one thing wraps another. In this particular
case, devices have parents, a hierarchy, a stack of devices, drivers,
and helpers.</p>

<p>Here’s what that stack is like in theory, with in reality some lines
blurred together:</p>

<p><img src="https://venam.net/blog/assets/input_devices_linux/input_topological_path.png" alt="Topology Overview" title="Topology Overview"></p>

<p>In this section, let’s try to understand how the kernel uses
plug’n’play/hotplug to pick the right drivers in this stack, and how we
pass from electrical signal to evdev. To do that we’ll first look at
how the kernel pictures its internal objects, and how these together
somehow create the above hierarchy. Finally, we’ll see some concrete
examples of that, along with some command line tools that can clearly
display this encapsulating behavior.</p>

<p>As we said there’s a hierarchy of kobjects in the kernel from the bus
to its connected devices. These are stored in-memory as a linked list
hierarchy, which is also represented under sysfs as a file system tree.<br>
Specifically, in <code>drivers/base/core.c</code> this is what is used to create
the parent-child relationship:</p>

<figure><pre><code data-lang="c"><span>device_register</span><span>(</span><span>&amp;</span><span>child</span><span>-&gt;</span><span>dev</span><span>);</span>
<span>child</span><span>-&gt;</span><span>dev</span><span>.</span><span>parent</span> <span>=</span> <span>&amp;</span><span>parent</span><span>-&gt;</span><span>dev</span><span>;</span></code></pre></figure>

<p>For example, here’s the path that an input device data might take.</p>

<div><pre><code>/devices/pci0000:00/0000:00:14.0/usb1/1-1/1-1:1.0/
             0003:046D:C31C.0003/input/input6/event3
</code></pre></div>

<ul>
  <li><code>/devices/...</code> — root of the kernel’s sysfs device tree, showing all devices known to the kernel.</li>
  <li><code>pci0000:00/0000:00:14.0</code> — PCI bus and controller (the USB host controller here).</li>
  <li><code>usb1/1-1/1-1:1.0</code> — USB bus and port hierarchy (device 1-1, interface 1.0).</li>
  <li><code>0003:046D:C31C.0003</code> — HID device node (bus <code>0003</code> = USB HID, vendor <code>046D</code> = Logitech, product <code>C31C</code> = specific keyboard).</li>
  <li><code>input/input6</code> — input subsystem device registered under <code>/sys/class/input/input6</code>.</li>
  <li><code>event3</code> — the evdev interface, the character device exposed in <code>/dev/input/event3</code>.</li>
</ul>

<p>How did we end up with this long list, how did it get created? Let’s see
how the kernel stores this info, and what happens from its perpective.<br>
As far as its concerned, the device-related things it knows is summed
up in these types of objects:</p>

<ul>
  <li>bus - a device to which other devices can be attached</li>
  <li>device - a physical/logical device that is attached to a bus</li>
  <li>driver - a software entity that can be associated with a device and
performs operations with it</li>
  <li>class - a type of device that has similar behavior; There is a class
for disks, partitions, serial ports, input, etc.</li>
  <li>subsystem - a view on the structure of the system; Kernel subsystems
include devices (hierarchical view of all devices in the system), buses
(bus view of devices according to how they are attached to buses),
classes, input, etc. We care about the input subsystem.</li>
</ul>

<p>For example, there are different views of the same device. You’ll find
the physical USB device under <code>/sys/bus/usb/devices/</code> and the logical
device of the input class under <code>/sys/class/input/.</code></p>

<p>Let’s go over these objects, tracing the path, starting with buses.<br>
A hardware bus/host controler is a communication channel between the
processor and input/output device. But a kernel bus object is more
generic than this, it’s a logical function which role is to be a point
of connection of devices. All devices are connected to a kernel bus,
even if it needs to be a virtual one. So kernel buses are the root of
the hierarchy.<br>
The main buses are things such as PCI, USB, IDE, SCSI, platform,
ACPI, etc.</p>

<figure><pre><code data-lang="c"><span>struct</span> <span>bus_type</span> <span>{</span>
        <span>const</span> <span>char</span>              <span>*</span><span>name</span><span>;</span>
        <span>const</span> <span>char</span>              <span>*</span><span>dev_name</span><span>;</span>
        <span>struct</span> <span>device</span>           <span>*</span><span>dev_root</span><span>;</span>
        <span>struct</span> <span>bus_attribute</span>    <span>*</span><span>bus_attrs</span><span>;</span>
        <span>struct</span> <span>device_attribute</span> <span>*</span><span>dev_attrs</span><span>;</span>
        <span>struct</span> <span>driver_attribute</span> <span>*</span><span>drv_attrs</span><span>;</span>
        <span>struct</span> <span>subsys_private</span> <span>*</span><span>p</span><span>;</span>
        <span>int</span>   <span>(</span><span>*</span><span>match</span><span>)(</span><span>struct</span> <span>device</span> <span>*</span><span>dev</span><span>,</span> <span>struct</span> <span>device_driver</span> <span>*</span><span>drv</span><span>);</span>
        <span>int</span>   <span>(</span><span>*</span><span>uevent</span><span>)(</span><span>struct</span> <span>device</span> <span>*</span><span>dev</span><span>,</span> <span>struct</span> <span>kobj_uevent_env</span> <span>*</span><span>env</span><span>);</span>
        <span>int</span>   <span>(</span><span>*</span><span>probe</span><span>)(</span><span>struct</span> <span>device</span> <span>*</span><span>dev</span><span>);</span>
        <span>int</span>   <span>(</span><span>*</span><span>remove</span><span>)(</span><span>struct</span> <span>device</span> <span>*</span><span>dev</span><span>);</span>
        <span>//...</span>
<span>};</span></code></pre></figure>

<p>Kernel buses are the connective tissue of everything, the base of the
infrastructure. As you can see from the structure it’s responsible for
probing the device to get info about it, handling connected/disconnected
events, creating a new node for it, and sending uevent to notify
user-space and triggering a chain reaction.<br>
Yet, one of their most important role is to start the match between
devices and registered device drivers, as can be noted from the <code>match</code>
function. Keep in mind that the matched driver can be another bus, so
this initiates a cascade of different handlers, bubbling up the hierarchy.</p>

<p>A concrete example of this recursion:</p>

<ul>
  <li>A PCI bus controller (the host bridge) is a device on the platform bus.</li>
  <li>The USB bus (usbcore) is a device on the PCI bus (via xHCI controller).</li>
  <li>The HID bus is a device on the USB bus (via usbhid).</li>
  <li>The specific HID protocol driver is a device on the HID bus</li>
</ul>

<p>The low level kernel buses such as the hardware bus/host controlers
generally don’t handle input data directly, though there are some bus/host
controller drivers that do register input devices to the input core,
bypassing everything else in the stack and acting as event sources. These
exceptions are usually for brightness control hotkeys, lid sensors,
built-in special functions keys, etc.. We have for example the drivers
<code>acpi_video</code>, <code>thinkpad_acpi</code>, <code>asus_wmi</code>, etc..</p>

<p>To know how to handle the devices and whether a driver needs to be loaded
from a module, all devices and buses have specially formatted IDs, to
tell us what kind of devices they are. The ID, which we call MODALIAS,
consists of vendor and product ID with some other subsystem-specific
values. Each bus and device has its own scheme for these IDs.<br>
For a USB mouse, it looks something like this:</p>
<div><pre><code>MODALIAS=usb:v046DpC03Ed2000dc00dsc00dp00ic03isc01ip02
</code></pre></div>

<p>This is needed in case the driver isn’t built-in the kernel and instead
was an external module (<code>*.ko</code>). As a reminder, a driver is some piece
of code responsible for handling a type of device, and a module is a
piece of external kernel code that can be dynamically loaded at runtime
when needed. Depending on the distro choices, some drivers are set as
external modules that need to be loaded at runtime.</p>

<p>To achieve this, the kernel, after composing the MODALIAS string, sends
it within the uevent towards user-space. To complete this information,
each external kernel module comes with a list of known MODALIASes it can
handle, so that they can be loaded as needed. These lists are compiled
by programs such as <code>depmod</code> that creates files like <code>modules.alias</code>
in the kernel’s <code>/lib/modules</code> directory for all currently available
modules that aren’t built-in (<code>/lib/modules/VERSION</code>), and the built-in
ones (<code>modules.builtin</code>).</p>

<p>In theory that’s fine, this infrastructure model makes it easy to
dynamically load modules that are not already built-in, but we need
a piece of software in user-space to catch the events and perform the
actual loading. This is a role that udev embodies by calling <code>modprobe</code>
for every event that has a MODALIAS key, regardless of whether a module
needs loading or not. We’ll see more of udev but for now keep in mind
that its doing this hotplug mechanism.</p>

<p>If you’re curious, you can try this udev command to monitor the MODALIAS.</p>

<div><pre><code>devadm monitor --property
</code></pre></div>

<p>Yet, this doesn’t solve what happens to devices that were present at
boot and which need modules. The solution: there’s a file in the device
directory in sysfs with all the uevent generated at boot for every
devices in sysfs file system, appropriately named “uevent”. If you write
“add” to that file the kernel resends the same events as the one lost
during boot. So a simple loop over all uevent files in <code>/sys</code> triggers
all events again.</p>

<p>The MODALIAS value is also stored in sysfs along with the device
properties, here are a few commands to gather information on this:</p>

<div><pre><code>&gt; cat /sys/devices/pci0000:00/0000:00:10.0/modalias 
pci:v00001022d00007812sv00001025sd00000756bc0Csc03i30

&gt; modprobe --resolve-alias $(cat /sys/devices/\
 pci0000:00/0000:00:13.2/usb1/1-0:1.0/usb1-port3/modalias)
Not everything has an associated module

&gt; ls -l /sys/devices/pci0000:00/0000:00:10.0/driver
lrwxrwxrwx 1 root root 0 Oct 25 11:37 driver \
               -&gt; ../../../bus/pci/drivers/xhci_hcd

If the driver link exists, check which module implements it:
&gt; modprobe -R xhci_hcd
xhci_hcd

&gt; modinfo xhci_hcd
name:           xhci_hcd
filename:       (builtin)
license:        GPL
file:           drivers/usb/host/xhci-hcd
author:         Sarah Sharp
description:    'eXtensible' Host Controller (xHC) Driver
license:        GPL
file:           drivers/usb/host/xhci-hcd
description:    xHCI sideband driver for secondary interrupter management
parm:           link_quirk:Don't clear the chain bit on a link TRB (int)
parm:           quirks:Bit flags for quirks to be enabled as default (ullong)

For example that xhci_hcd module is builtin
</code></pre></div>

<p>So far we’ve learned two things: buses which devices are connected to,
and the MODALIAS mechanism to match modules and dynamically load drivers
that aren’t built-in. Let’s see the devices attached to buses as they
appear as kernel objects.</p>

<figure><pre><code data-lang="c"><span>struct</span> <span>device</span> <span>{</span>
        <span>// …</span>
        <span>struct</span> <span>device</span>           <span>*</span><span>parent</span><span>;</span>
        <span>struct</span> <span>device_private</span>   <span>*</span><span>p</span><span>;</span>
        <span>struct</span> <span>kobject</span>          <span>kobj</span><span>;</span>
        <span>const</span> <span>char</span>              <span>*</span><span>init_name</span><span>;</span> <span>/* initial name of the device */</span>
        <span>// …</span>
        <span>struct</span> <span>bus_type</span>         <span>*</span><span>bus</span><span>;</span>       <span>/* type of bus device is on */</span>
        <span>struct</span> <span>device_driver</span>    <span>*</span><span>driver</span><span>;</span>    <span>/* which driver has allocated this
                                             device */</span>
        <span>// …</span>
        <span>const</span> <span>struct</span> <span>class</span>  <span>*</span><span>class</span><span>;</span>
        <span>// …</span>
        <span>void</span>    <span>(</span><span>*</span><span>release</span><span>)(</span><span>struct</span> <span>device</span> <span>*</span><span>dev</span><span>);</span>
<span>};</span></code></pre></figure>

<p>Along with the related driver:</p>

<figure><pre><code data-lang="c"><span>struct</span> <span>device_driver</span> <span>{</span>
         <span>const</span> <span>char</span>              <span>*</span><span>name</span><span>;</span>
         <span>struct</span> <span>bus_type</span>         <span>*</span><span>bus</span><span>;</span>
         <span>struct</span> <span>driver_private</span>   <span>*</span><span>p</span><span>;</span>
         <span>struct</span> <span>module</span>           <span>*</span><span>owner</span><span>;</span>
         <span>const</span> <span>char</span>              <span>*</span><span>mod_name</span><span>;</span>     <span>/* used for built-in modules */</span>
         <span>int</span>     <span>(</span><span>*</span><span>probe</span><span>)</span>        <span>(</span><span>struct</span> <span>device</span> <span>*</span><span>dev</span><span>);</span>
         <span>int</span>     <span>(</span><span>*</span><span>remove</span><span>)</span>       <span>(</span><span>struct</span> <span>device</span> <span>*</span><span>dev</span><span>);</span>
         <span>void</span>    <span>(</span><span>*</span><span>shutdown</span><span>)</span>     <span>(</span><span>struct</span> <span>device</span> <span>*</span><span>dev</span><span>);</span>
         <span>int</span>     <span>(</span><span>*</span><span>suspend</span><span>)</span>      <span>(</span><span>struct</span> <span>device</span> <span>*</span><span>dev</span><span>,</span> <span>pm_message_t</span> <span>state</span><span>);</span>
         <span>int</span>     <span>(</span><span>*</span><span>resume</span><span>)</span>       <span>(</span><span>struct</span> <span>device</span> <span>*</span><span>dev</span><span>);</span>
<span>};</span></code></pre></figure>

<p>As you can notice, they also have a probing and lifecycle functions to
be implemented. We also have the registration/unregistration functions
(<code>input_register_device</code> and <code>input_unregister_device</code> in our case)
which will announce that the device is now available in the system (plus
a uevent and other user-space stuff). Each of the registered devices
have an entry in sysfs <code>/sys/devices</code>, along with the information about
its driver, and similar info in <code>/sys/class</code> and <code>/sys/bus</code>. The
device also creates files in devtmpfs that represent its interfaces. Let’s
note that devtmpfs is usually mounted by default to user-space as a virtual
filesystem on most distros.</p>

<p>To check whether devtmpfs is enabled, which is almost always the case today:</p>

<div><pre><code>&gt; zcat /proc/config.gz | grep DEVTMPFS
CONFIG_DEVTMPFS=y
CONFIG_DEVTMPFS_MOUNT=y
CONFIG_DEVTMPFS_SAFE=y

&gt; mount | grep devtmpfs
dev on /dev type devtmpfs (rw,nosuid,relatime,size=2720672k,\
   nr_inodes=680168,mode=755,inode64)

&gt; mount | grep sysfs
 sys on /sys type sysfs (rw,nosuid,nodev,noexec,relatime)
</code></pre></div>

<p>Devices are associated to classes and subsystems that handle them.
The subsystem we care about here is what we’ve seen in the earlier
section: the input core, the input device subsystem.</p>

<figure><pre><code data-lang="c"><span>subsys_initcall</span><span>(</span><span>input_init</span><span>);</span></code></pre></figure>

<p>As for the concept of a class, it’s a high-level view of the device
model, abstracting implementation details. For example there are drivers
for SCSI and ATA but both are in the disks class. Similarly, all input
devices are in the input class, which is what we care about. This is
a grouping mechanism, unrelated to how the devices are connected. They
can be found in sysfs <code>/sys/class/</code>.<br>
The <code>struct class</code> is instantiated in the <code>struct device</code> through
<code>class_register</code> and <code>class_unregister</code>. This will in turn also help
udev, as we’ll see later, better manage the devices in devtmpfs user-space
mapping <code>/dev/</code>, adding a filter for rules.</p>

<figure><pre><code data-lang="c"><span>struct</span> <span>class</span> <span>{</span>
         <span>const</span> <span>char</span>              <span>*</span><span>name</span><span>;</span>
         <span>struct</span> <span>module</span>           <span>*</span><span>owner</span><span>;</span>
         <span>struct</span> <span>kobject</span>          <span>*</span><span>dev_kobj</span><span>;</span>
         <span>struct</span> <span>subsys_private</span>   <span>*</span><span>p</span><span>;</span>
         <span>struct</span> <span>class_attribute</span>          <span>*</span><span>class_attrs</span><span>;</span>
         <span>struct</span> <span>class_device_attribute</span>   <span>*</span><span>class_dev_attrs</span><span>;</span>
         <span>struct</span> <span>device_attribute</span>         <span>*</span><span>dev_attrs</span><span>;</span>
         <span>int</span>     <span>(</span><span>*</span><span>dev_uevent</span><span>)(</span><span>struct</span> <span>device</span> <span>*</span><span>dev</span><span>,</span> <span>struct</span> <span>kobj_uevent_env</span> <span>*</span><span>env</span><span>);</span>
         <span>void</span>    <span>(</span><span>*</span><span>class_release</span><span>)(</span><span>struct</span> <span>class</span> <span>*</span><span>class</span><span>);</span>
         <span>void</span>    <span>(</span><span>*</span><span>dev_release</span><span>)(</span><span>struct</span> <span>device</span> <span>*</span><span>dev</span><span>);</span>
         <span>//...</span>
<span>};</span></code></pre></figure>

<p>In the input core:</p>

<figure><pre><code data-lang="c"><span>const</span> <span>struct</span> <span>class</span> <span>input_class</span> <span>=</span> <span>{</span>
    <span>.</span><span>name</span>       <span>=</span> <span>"input"</span><span>,</span>
    <span>.</span><span>devnode</span>    <span>=</span> <span>input_devnode</span><span>,</span>
<span>};</span></code></pre></figure>

<p>This completes our overview of the way the kernel perceives the different
types of objects it manages. However, that didn’t clarify how we ended
up with the example path above other than somehow having a kernel bus and
device hierarchy.<br>
We talked about hardware buses and host controllers drivers that aren’t
handling data and that they delegate this to an upper layer. In theory
this upper layer is split between a kernel bus&amp;device for the transport
layer, aka IO layer, and a kernel bus&amp;device for the protocol layer,
but in reality those might get mixed up (bus&amp;device because it’s both).</p>

<p>The IO layer is responsible for handling the physical electrical
communication with the device, it’s setup, and management. At this level
we have USB, Bluetooth, I2C, SPI, etc.. In drivers that means: <code>usbhid</code>
for HID devices over USB, <code>btusb</code> and <code>hidp</code> for HID over Bluetooth,
<code>i2c-hid</code> for touchpads and keyboards that are wired to the motherboard’s
I2C, <code>psmouse</code> and <code>serio</code> for PS2 mouse, etc..<br>
The protocol or function specific layer then takes over and has as role
to integrate with the input core and translate the raw transport data
into a common format, usually evdev. The evdev format is favored
as it provides a uniform API to represent input devices (via
<code>/dev/input/eventX</code>).</p>

<p>A few examples:</p>

<ul>
  <li>There’s a mouse communication protocol usin 9 pins DE-9 over the RS-232
standard for communication with UART</li>
  <li>The PS/2 mouse which uses a serial transport protocol with 6 pins (<code>serio</code>)</li>
  <li>The atkbd keyboard also over serial transport</li>
  <li>A gamepad that uses HID but the particular case of a sony joystick over USB</li>
  <li>A touchscreen specific driver using I²C or SPI</li>
</ul>

<p>Or as a hierarchical example:</p>

<div><pre><code>[PCI bus]
   └── probes -&gt; xhci_hcd (a PCI driver)
         └── registers usb_hcd with -&gt; [USB core]
                 └── enumerates and manages -&gt; [USB bus]
                        └── matches -&gt; usbhid (a USB driver)
                               └── registers -&gt; [HID bus]
                                      └── matches -&gt; hid-generic, hid-apple, ...
                                            └── registers -&gt; [Input bus]
                                                  └── matches -&gt; evdev, ...
</code></pre></div>

<p>There’s another component of complexity to add: we don’t have a
single protocol for a single transport over a single hardware bus/host
controller. Sometimes there’s a generic protocol layer which is reused
with different transport mechanisms. There can also be a delegation
mechanism for the more specific sub-protocol handlers for specific
devices or modes.<br>
For example, you can have an HID protocol over USB (<code>usbhid</code>), and the
particular part of the HID protocol used for input devices, and the more
specific sub-HID protocol of a type of device (<code>hid-generic</code> and others).</p>

<p>We’ll see an example of this by diving into the HID subsystem which is
the most popular input protocol these days, but first let’s check some
tools that can help us see all that we’ve learned thus far and make
sense of the hierarchy:</p>

<ul>
  <li><code>lspci -vn</code> list info about devices connected via PCI buses</li>
  <li><code>lsusb -v</code> or <code>usb-devices</code> list usb devices information in a more human readable form</li>
  <li><code>dmesg</code> the sys logs</li>
  <li><code>hwinfo --short</code> to probe hardware</li>
</ul>

<p>Yet the best way to get a lot of info about the bus and device hierarchy
is to rely on <code>udevadm</code>, a user-space tool that comes with udev. Here’s
how it looks for an input device:</p>

<figure><pre><code data-lang="shell"><span>&gt;</span> udevadm info <span>-a</span> <span>-p</span> <span>$(</span>udevadm info <span>-q</span> path <span>-n</span> /dev/input/event9<span>)</span>


looking at device <span>'/devices/.../input/input6/event9'</span>:
  <span>KERNEL</span><span>==</span><span>"event9"</span>
  <span>SUBSYSTEM</span><span>==</span><span>"input"</span>
  ATTR<span>{</span>name<span>}==</span><span>"Logitech USB Keyboard"</span>
  ...
looking at parent device <span>'/devices/.../input/input6'</span>:
  <span>KERNEL</span><span>==</span><span>"input6"</span>
  <span>SUBSYSTEM</span><span>==</span><span>"input"</span>
  ...
looking at parent device <span>'/devices/.../0003:046D:C31C.0003'</span>:
  <span>KERNELS</span><span>==</span><span>"0003:046D:C31C.0003"</span>
  <span>DRIVERS</span><span>==</span><span>"hid-generic"</span>
  <span>SUBSYSTEMS</span><span>==</span><span>"hid"</span>
  ...
looking at parent device <span>'/devices/.../1-1:1.0'</span>:
  <span>KERNELS</span><span>==</span><span>"1-1:1.0"</span>
  <span>SUBSYSTEMS</span><span>==</span><span>"usb"</span>
  <span>DRIVERS</span><span>==</span><span>"usbhid"</span>
  ...
looking at parent device <span>'/devices/.../1-1'</span>:
  <span>KERNELS</span><span>==</span><span>"1-1"</span>
  <span>SUBSYSTEMS</span><span>==</span><span>"usb"</span>
  <span>DRIVERS</span><span>==</span><span>"usb"</span>
  ...
looking at parent device <span>'/devices/.../0000:00:14.0'</span>:
  <span>KERNELS</span><span>==</span><span>"0000:00:14.0"</span>
  <span>SUBSYSTEMS</span><span>==</span><span>"pci"</span>
  <span>DRIVERS</span><span>==</span><span>"ohci-pci"</span>
  ...</code></pre></figure>

<p><em>NB</em>: It is also a bit more clearer, though for the moment confusing,
to also look at <code>udevadm info --tree</code>. Similarly, the <code>loginctl
seat-status</code> also clearly shows the hierarchy of devices in the current
session. We’ll talk more about the concept of seats later on.</p>

<p>We see the “looking at parent device” block that corresponds to one
<code>struct device</code> in the kernel kobject mapped in sysfs, along with the
driver, when it’s present, and other info it gathers at every step,
walking down the bus hierarchy. Let’s note that not everything has
an associated driver since the hardware topology might not match the
driver topology. That often means one kernel component handles multiple
parts of the stack. In the above trace, <code>hid-generic</code> handles the input
registering.</p>

<p>This example in particular shows:</p>

<div><pre><code>PCI → USB controller → USB device → HID interface → input device → evdev node
</code></pre></div>

<p>Another source of information that we briefly mentioned is the procfs
introspection interface (<code>/proc/bus/input/</code>), it can also help see the
handling of input devices more clearly as it’s a text-based view of what
the kernel input subsystem knows. It is more or less analogous to the
sysfs view but is meant for human-readable diagnostics. In conjunction
with what we’ve learned in the previous input core section, it should
clarify some of our understanding.  It has two files underneath: <code>devices</code>
and <code>handlers</code>.</p>

<p>The <code>devices</code> file contain all the current input devices and has entries
with these fields:</p>

<ul>
  <li><code>I</code>: basic info (bus type, vendor/product/version)</li>
  <li><code>N</code>: name</li>
  <li><code>P</code>: physical path (e.g., <code>isa0060/serio0/input0</code>)</li>
  <li><code>S</code>: sysfs path</li>
  <li><code>U</code>: unique identifier (if provided)</li>
  <li><code>H</code>: list of event handler interfaces bound (like <code>event3</code>, <code>js0</code>, etc.)</li>
  <li><code>B</code>: capability bitmaps (<code>EV</code>, <code>KEY</code>, <code>REL</code>, <code>ABS</code>, etc.) we’ll explore what
this means when looking at evdev</li>
</ul>

<p>For instance:</p>

<figure><pre><code data-lang="shell">I: <span>Bus</span><span>=</span>0003 <span>Vendor</span><span>=</span>1a2c <span>Product</span><span>=</span>6004 <span>Version</span><span>=</span>0110
N: <span>Name</span><span>=</span><span>"SEMICO USB Keyboard Consumer Control"</span>
P: <span>Phys</span><span>=</span>usb-0000:00:12.0-1/input1
S: <span>Sysfs</span><span>=</span>/devices/pci0000:00/0000:00:12.0/usb2/2-1/<span>\</span>
   2-1:1.1/0003:1A2C:6004.001E/input/input53
U: <span>Uniq</span><span>=</span>
H: <span>Handlers</span><span>=</span>kbd event7 
B: <span>PROP</span><span>=</span>0
B: <span>EV</span><span>=</span>1f
B: <span>KEY</span><span>=</span>33eff 0 0 483ffff17aff32d bfd4444600000000 1 <span>\</span>
   130c730b17c000 267bfad9415fed 9e168000004400 10000002
B: <span>REL</span><span>=</span>1040
B: <span>ABS</span><span>=</span>100000000
B: <span>MSC</span><span>=</span>10

I: <span>Bus</span><span>=</span>0003 <span>Vendor</span><span>=</span>1a2c <span>Product</span><span>=</span>6004 <span>Version</span><span>=</span>0110
N: <span>Name</span><span>=</span><span>"SEMICO USB Keyboard System Control"</span>
P: <span>Phys</span><span>=</span>usb-0000:00:12.0-1/input1
S: <span>Sysfs</span><span>=</span>/devices/pci0000:00/0000:00:12.0/usb2/2-1/<span>\</span>
   2-1:1.1/0003:1A2C:6004.001E/input/input54
U: <span>Uniq</span><span>=</span>
H: <span>Handlers</span><span>=</span>kbd event9 
B: <span>PROP</span><span>=</span>0
B: <span>EV</span><span>=</span>13
B: <span>KEY</span><span>=</span>c000 10000000000000 0
B: <span>MSC</span><span>=</span>10</code></pre></figure>

<p>Here you can see that a single physical device can possibly present
itself as multiple input devices with different handlers attached for
separate functions (here the keys of the System Control handler are
fewer). Here, <code>kbd</code> is console handler, and <code>eventN</code> is the evdev
user-space handler. Libinput, which we’ll cover later, uses groups
<code>LIBINPUT_DEVICE_GROUP</code> to logically combine the different devices that
are actually on the same hardware.</p>

<p>The handlers file is about instances of the <code>input_handler</code> that will
be called from input core’s <code>input_event</code> we mentioned before. As we
said most of it is handled by evdev, but there are exceptions such as:</p>

<figure><pre><code data-lang="shell">N: <span>Number</span><span>=</span>0 <span>Name</span><span>=</span>kbd
N: <span>Number</span><span>=</span>1 <span>Name</span><span>=</span>leds
N: <span>Number</span><span>=</span>2 <span>Name</span><span>=</span>evdev <span>Minor</span><span>=</span>64
N: <span>Number</span><span>=</span>3 <span>Name</span><span>=</span>sysrq <span>(</span>filter<span>)</span>
N: <span>Number</span><span>=</span>4 <span>Name</span><span>=</span>rfkill
N: <span>Number</span><span>=</span>5 <span>Name</span><span>=</span>mousedev <span>Minor</span><span>=</span>32
N: <span>Number</span><span>=</span>6 <span>Name</span><span>=</span>joydev <span>Minor</span><span>=</span>0</code></pre></figure>

<p>We’ll talk about joydev later on. As for mousedev, it is there only for
legacy compatibility of old <code>/dev/psaux</code>-style mouse interface.</p>

<p>Let’s now see the example of a dummy input driver, to get the idea across.</p>

<figure><pre><code data-lang="c"><span>// SPDX-License-Identifier: GPL-2.0</span>
<span>#include</span> <span>&lt;linux/module.h&gt;</span><span>
#include</span> <span>&lt;linux/init.h&gt;</span><span>
#include</span> <span>&lt;linux/input.h&gt;</span><span>
#include</span> <span>&lt;linux/timer.h&gt;</span><span>
</span>
<span>static</span> <span>struct</span> <span>input_dev</span> <span>*</span><span>dummy_input_dev</span><span>;</span>
<span>static</span> <span>struct</span> <span>timer_list</span> <span>dummy_timer</span><span>;</span>

<span>static</span> <span>void</span> <span>dummy_timer_func</span><span>(</span><span>struct</span> <span>timer_list</span> <span>*</span><span>t</span><span>)</span>
<span>{</span>
    <span>static</span> <span>bool</span> <span>key_down</span> <span>=</span> <span>false</span><span>;</span>

    <span>/* Simulate key press/release of KEY_A */</span>
    <span>key_down</span> <span>=</span> <span>!</span><span>key_down</span><span>;</span>
    <span>input_event</span><span>(</span><span>dummy_input_dev</span><span>,</span> <span>EV_KEY</span><span>,</span> <span>KEY_A</span><span>,</span> <span>key_down</span><span>);</span>
    <span>input_event</span><span>(</span><span>dummy_input_dev</span><span>,</span> <span>EV_SYN</span><span>,</span> <span>SYN_REPORT</span><span>,</span> <span>0</span><span>);</span>

    <span>/* Reschedule timer */</span>
    <span>mod_timer</span><span>(</span><span>&amp;</span><span>dummy_timer</span><span>,</span> <span>jiffies</span> <span>+</span> <span>msecs_to_jiffies</span><span>(</span><span>2000</span><span>));</span>
<span>}</span>

<span>static</span> <span>int</span> <span>__init</span> <span>dummy_input_init</span><span>(</span><span>void</span><span>)</span>
<span>{</span>
    <span>int</span> <span>err</span><span>;</span>

    <span>dummy_input_dev</span> <span>=</span> <span>input_allocate_device</span><span>();</span>
    <span>if</span> <span>(</span><span>!</span><span>dummy_input_dev</span><span>)</span>
        <span>return</span> <span>-</span><span>ENOMEM</span><span>;</span>

    <span>dummy_input_dev</span><span>-&gt;</span><span>name</span> <span>=</span> <span>"Dummy Input Device"</span><span>;</span>
    <span>dummy_input_dev</span><span>-&gt;</span><span>phys</span> <span>=</span> <span>"dummy/input0"</span><span>;</span>
    <span>dummy_input_dev</span><span>-&gt;</span><span>id</span><span>.</span><span>bustype</span> <span>=</span> <span>BUS_VIRTUAL</span><span>;</span>
    <span>dummy_input_dev</span><span>-&gt;</span><span>id</span><span>.</span><span>vendor</span>  <span>=</span> <span>0x0001</span><span>;</span>
    <span>dummy_input_dev</span><span>-&gt;</span><span>id</span><span>.</span><span>product</span> <span>=</span> <span>0x0001</span><span>;</span>
    <span>dummy_input_dev</span><span>-&gt;</span><span>id</span><span>.</span><span>version</span> <span>=</span> <span>0x0100</span><span>;</span>

    <span>/* Declare we can emit key events */</span>
    <span>__set_bit</span><span>(</span><span>EV_KEY</span><span>,</span> <span>dummy_input_dev</span><span>-&gt;</span><span>evbit</span><span>);</span>
    <span>__set_bit</span><span>(</span><span>KEY_A</span><span>,</span> <span>dummy_input_dev</span><span>-&gt;</span><span>keybit</span><span>);</span>

    <span>err</span> <span>=</span> <span>input_register_device</span><span>(</span><span>dummy_input_dev</span><span>);</span>
    <span>if</span> <span>(</span><span>err</span><span>)</span> <span>{</span>
        <span>input_free_device</span><span>(</span><span>dummy_input_dev</span><span>);</span>
        <span>return</span> <span>err</span><span>;</span>
    <span>}</span>

    <span>/* Setup a timer to inject key events periodically */</span>
    <span>timer_setup</span><span>(</span><span>&amp;</span><span>dummy_timer</span><span>,</span> <span>dummy_timer_func</span><span>,</span> <span>0</span><span>);</span>
    <span>mod_timer</span><span>(</span><span>&amp;</span><span>dummy_timer</span><span>,</span> <span>jiffies</span> <span>+</span> <span>msecs_to_jiffies</span><span>(</span><span>2000</span><span>));</span>

    <span>pr_info</span><span>(</span><span>"dummy_input: registered fake input device</span><span>\n</span><span>"</span><span>);</span>
    <span>return</span> <span>0</span><span>;</span>
<span>}</span>

<span>static</span> <span>void</span> <span>__exit</span> <span>dummy_input_exit</span><span>(</span><span>void</span><span>)</span>
<span>{</span>
    <span>del_timer_sync</span><span>(</span><span>&amp;</span><span>dummy_timer</span><span>);</span>
    <span>input_unregister_device</span><span>(</span><span>dummy_input_dev</span><span>);</span>
    <span>pr_info</span><span>(</span><span>"dummy_input: unregistered</span><span>\n</span><span>"</span><span>);</span>
<span>}</span>

<span>module_init</span><span>(</span><span>dummy_input_init</span><span>);</span>
<span>module_exit</span><span>(</span><span>dummy_input_exit</span><span>);</span>

<span>MODULE_AUTHOR</span><span>(</span><span>"Example Author"</span><span>);</span>
<span>MODULE_DESCRIPTION</span><span>(</span><span>"Minimal Dummy Input Device"</span><span>);</span>
<span>MODULE_LICENSE</span><span>(</span><span>"GPL"</span><span>);</span></code></pre></figure>

<p>That’s it, you should now somewhat have an idea of how we pass from
hardware events, to kernel objects, and end up within the input core
subsystem, which should prepare events for user-space. Let’s now dig on
and explore a few of the topics we’ve grazed in the past two sections.</p>

<h2 id="sysfs">sysfs</h2>

<p>We already covered a lot of ground in understanding sysfs, so let’s
continue and summarize everything we know and complete the full picture.</p>

<p>As we briefly said before, sysfs is a virtual file system representation in
user-space of the kernel objects and their attributes, it’s how the kernel
views the current state of the system, and also how the user can interface
with the parameters of the kernel in a centralized manner. It’s all done
in a very Unixy way by manipulating simple files.<br>
The file mapping happens as such: kernel objects are directories, their
attributes are regular files, and the relationship between objects is
represented as sub-directories and symbolic links.</p>

<p>The object information is categorized as one of the following. Each of
these is a sub-directory under <code>/sys/</code>.</p>

<ul>
  <li>block - all block devices available in the system (disks, partitions)</li>
  <li>bus - types of bus to which physical devices are connected (pci, ide, usb)</li>
  <li>class - drivers classes that are available in the system (net, sound, usb)</li>
  <li>devices - the hierarchical structure of devices connected to the system</li>
  <li>dev - Major and minor device identifier. It can be used to automatically
create entries in the <code>/dev</code> directory. It’s another categorization of
the devices directory</li>
  <li>firmware - information from system firmware (ACPI)</li>
  <li>fs - information about mounted file systems</li>
  <li>kernel - kernel status information (logged-in users, hotplug)</li>
  <li>module - the list of modules currently loaded</li>
  <li>power - information related to the power management subsystem
information is found in standard files that contain an attribute</li>
  <li>device (optionally) - a symbolic link to the directory containing devices; It can be used to discover the hardware devices that provide a particular service (for example, the ethi PCI card)</li>
  <li>driver (optionally) - a symbolic link to the driver directory (located in <code>/sys/bus/*/drivers</code> )</li>
</ul>

<p>As far as we’re concerned, when it comes to input devices, the
<code>/sys/devices/</code> directory is probably one of the most important. It’s
the representation of the hierarchy of devices we’ve talked about in
the previous section.<br>
Pasting the tree here would be cumbersome, but try <code>tree -L 5 | less</code>
within <code>/sys/devices</code> and you’ll clearly see how things fit together,
a direct hierarchical mapping of how devices are connected to each others.<br>
Within this directory we can find interesting information associated to
the device and its type. For usb devices, for example, we have info such
as the bus number, port number, the vendor and product id, manufacturer,
speed, and others.</p>

<p>Furthermore, the <code>/sys/bus</code> directory organizes devices by the type of
bus they are connected to. You can imagine that this isn’t a linear
view since buses can have buses as devices (<code>usb</code> and <code>hid</code> each have
their directory even though <code>hid</code> is probably under <code>usb</code>), but it it
helpful to perceive what is happening, an easy shortcut. Within each
bus directory there are two subdirectories: drivers, that contains the
driver registered for the bus, and devices, that contains symbolic links
to the devices connected to that bus in <code>/sys/devices</code>.</p>

<p>Similarly, the <code>/sys/class</code> directory has another view of the system
from a more functional/type perspective. It’s about what devices do and
not how they’re connected. As far as we’re concerned, the subdirectory
<code>/sys/class/input/</code> is where we’ll find symbolic links to all devices
that have the input class in <code>/sys/devices</code>.<br>
This directory contains both symlinks to input devices and evdev devices,
the latter are usually sub-directories of the former. A notable file in
the input directory is the “capabilities” file, which lists everything
that the device is capable, as far as input is concerned. We’ll revisit
this in the evdev section.</p>

<p>Finally, the last directory that is of interest to us in sysfs is
<code>/sys/module/</code> which provides information and settings for all loaded
kernel modules (the ones that show with <code>lsmod</code>), their dependencies
and parameters.</p>

<div><pre><code>├── hid_generic
│&nbsp;&nbsp; ├── drivers
│&nbsp;&nbsp; │&nbsp;&nbsp; └── hid:hid-generic -&gt; ../../../bus/hid/drivers/hid-generic
│&nbsp;&nbsp; └── uevent

&gt; modinfo hid_generic
name:           hid_generic
filename:       (builtin)
license:        GPL
file:           drivers/hid/hid-generic
description:    HID generic driver
author:         Henrik Rydberg
</code></pre></div>

<p>Lastly, and it might not need to be mentioned, but sysfs needs to be
enabled in the kernel confs. It always is these days since it’s expected
by many software.</p>



<h2 id="hid--human-interface-device">HID — Human Interface Device</h2>

<p>HID, or Human Interface Device, has been mentioned and sprinkled all
over the place in the last sections, we said it’s a device protocol but
what is it exactly?</p>

<p>HID is probably the most important input/output standard device protocol
these days, it’s literally everywhere and most new devices, from mice
to microphones, speak it over all types of transports such as USB, i2c,
Bluetooth, BLE, etc… It’s popular because it’s a universal way to let the
device first describe its capabilities (buttons, keys, axis, etc..),
what it can send/receive (Report Descriptor), and then send/receive them in
the expected way (Input/Output/Feature Reports).<br>
In sum, in the ideal case it would mean avoiding having a specific driver
for every new device out there and instead have a centralized generic way
to handle all categories of devices, all working out-of-the-box. Indeed, in
practice it has worked great and there have only been minor vendor or
hardware quirks fixes (<code>drivers/hid/hid-quirks.c</code> and others).<br>
For example, a HID Report Descriptor may specify that “in a report
with ID 3 the bits from 8 to 15 is the delta x coordinate of a mouse”.
The HID report itself then merely carries the actual data values without
any extra meta information.</p>

<p>The current list of HID devices can be found under the HID
bus in syfs, <code>/sys/bus/hid/devices/</code>. For each device, say
<code>/sys/bus/hid/devices/0003:1B3F:2008.003E/</code>, one can read the
corresponding report descriptor:</p>

<div><pre><code>&gt; hexdump -C /sys/bus/hid/devices/0003:1B3F:2008.003E/report_descriptor
00000000  05 0c 09 01 a1 01 15 00  25 01 09 e9 09 ea 75 01  |........%.....u.|
00000010  95 02 81 02 09 e2 09 cd  09 b5 09 b6 09 8c 95 05  |................|
00000020  81 06 09 00 95 01 81 02  c0                       |.........|
00000029
</code></pre></div>

<p>The raw HID reports can also be read from the <code>hidraw</code> file created by
hid core in devtmpfs <code>/dev/hidrawN</code>.</p>

<p>What does an input device HID Report and Report Descriptor look like?
We won’t go into too much details since the HID specifications are huge
but we’ll only do a tour to get an idea and be productive with what
we know. If you want to dive deeper, check the specifications
<a href="https://www.usb.org/hid">here</a>, it’s divided into a basic structure doc
“HID USB Device Class Definition”, and the HUT, “HID Usage Tables”, which
defines constants to be used by applications.</p>

<p>So as we said, the main logic of the protocol is that HID messages are
called Reports and that to parse them we need a Report Descriptor. The
Report Descriptor is a kind of hashmap stream, it contains Items, which
are 1B header followed by an optional payload of up-to 4B. The Items
don’t make sense by themselves, but do make sense together as a whole
when read as a full stream since each Item has a different meaning. Some
meaning apply locally and others globally.</p>

<p>The encapsulating and/or categorizing Items are the Usage Page, which
is a generic category of thing we’re describing, with its subset of
Usage, which is the specific thing we control within that Page. These
are defined in the “HID Usage Tables” doc. It’s things such as:</p>

<div><pre><code>Usage Page: Generic Desktop (0x01) Usage: Mouse (0x02)
Usage Page: Button (0x09)          Usage: Optional
Usage Page: Consumer Page (0x0C)   Usage: Numeric Key Pad (0x02)
</code></pre></div>

<p>It’s a couple of info to know how to better handle the HID internal data,
it tells you what is actually being handled.</p>

<p>Another grouping mechanism is the Collection, a broader category
to put together all that the device handles. Let’s say a mouse can
have both buttons, a scroll wheel, and axis it moves on, all within
a Collection. There are 3 types of collections that encapsulate each
others: Application (mandatory) the device-level group, Logical (optional)
sub-grouping for related controls, and Physical (optional) sub-grouping
for physical sensors.</p>

<p>Reports within Collections can also be grouped by IDs to facilitate
parsing.</p>

<p>Within all these, within the inner Collections, we finally have the
definition of what the Reports will actually look like. Here’s a subset
of what a Report Descriptor can look like:</p>

<div><pre><code>Report ID (01)
Usage Page (Button)
Usage Minimum (1)
Usage Maximum (5)
Report Count (5)
Report Size (1)
Input (Data,Var,Abs)

Report Size (3)
Report Count (1)
Input (Cnst,Arr,Abs)

Usage Page (Generic Desktop)
Usage (X)
Usage (Y)
Report Count (2)
Report Size (16)
Logical Minimum (-32767)
Logical Maximum (32767)
Input (Data,Var,Rel)
</code></pre></div>

<p>This is all a single report with ID <code>0x01</code>, and we see first that within
the Button page we have values ranging from 1 to 5, a count of fields
in the current report size of 5, for 5 buttons each having one bit. The
<code>Input</code> Item tells us to start processing the Report as input data (there’s
also <code>Output</code> and <code>Feature</code>). It also indicates that buttons have absolute
values, unlike the X/Y axis which are relative.</p>

<p>The <code>Cnst</code> of the following data in the stream stands for constant,
and it’s basically ignored, it’s padding.</p>

<p>And so on, we parse the data afterward, the X/Y relative movements.</p>

<p>One thing to note, is the scope of the meaning of the Items. Some apply
globally, such as the Usage Page, Logical Min/Max, Report Size, Report
Count, etc.. Meanwhile, Usage only apply locally and needs to be set
again. Other Items have special meaning such as Input, Output, Feature,
Collection and End Collection, and are about defining the structure of
data and when to process it.</p>

<p>Here’s a full real example with the Collection grouping mechanism:</p>

<div><pre><code>Usage Page (Generic Desktop)
Usage (Mouse)
Collection (Application)
 Usage Page (Generic Desktop)
 Usage (Mouse)
 Collection (Logical)
  Report ID (26)
  Usage (Pointer)
  Collection (Physical)

   Usage Page (Button)
   Usage Minimum (1)
   Usage Maximum (5)
   Report Count (5)
   Report Size (1)
   Logical Minimum (0)
   Logical Maximum (1)
   Input (Data,Var,Abs)

   Report Size (3)
   Report Count (1)
   Input (Cnst,Arr,Abs)

   Usage Page (Generic Desktop)
   Usage (X)
   Usage (Y)
   Report Count (2)
   Report Size (16)
   Logical Minimum (-32767)
   Logical Maximum (32767)
   Input (Data,Var,Rel)

   Usage (Wheel)
   Physical Minimum (0)
   Physical Maximum (0)
   Report Count (1)
   Report Size (16)
   Logical Minimum (-32767)
   Logical Maximum (32767)
   Input (Data,Var,Rel)
  End Collection
 End Collection
End Collection
</code></pre></div>

<p>As you can see, lots of it may seem redundant within the Logical and
Physical optional sub-collections but they’re often there by default
for hierarchical grouping. They’re not mandatory but common.<br>
Let’s also note that from hid-input’s perspective, one device is created
per top-level Application Collection, so in theory a device can have
many sub-devices.</p>

<p>From the kernel’s perspective, the transport bus notices that a device
is advertised as an HID class and then the data gets routed to the hid
core bus.</p>

<p>For example, this is what the USB transport might notice:</p>

<div><pre><code>bInterfaceClass    = 0x03   ← USB_CLASS_HID
bInterfaceSubClass = 0x01   ← Boot Interface Subclass (optional)
bInterfaceProtocol = 0x02   ← Mouse  (0x01 = Keyboard)
</code></pre></div>

<p>And you can clearly see similar ATTRS in the <code>udevadm</code> trace we took in
earlier in a previous section:</p>

<figure><pre><code data-lang="shell">looking at parent device <span>'/devices/pci0000:00/0000:00:12.0/usb2/2-4/2-4:1.3'</span>:
  <span>KERNELS</span><span>==</span><span>"2-4:1.3"</span>
  <span>SUBSYSTEMS</span><span>==</span><span>"usb"</span>
  <span>DRIVERS</span><span>==</span><span>"usbhid"</span>
  ATTRS<span>{</span>authorized<span>}==</span><span>"1"</span>
  ATTRS<span>{</span>bAlternateSetting<span>}==</span><span>" 0"</span>
  ATTRS<span>{</span>bInterfaceClass<span>}==</span><span>"03"</span>
  ATTRS<span>{</span>bInterfaceNumber<span>}==</span><span>"03"</span>
  ATTRS<span>{</span>bInterfaceProtocol<span>}==</span><span>"00"</span>
  ATTRS<span>{</span>bInterfaceSubClass<span>}==</span><span>"00"</span>
  ATTRS<span>{</span>bNumEndpoints<span>}==</span><span>"01"</span>
  ATTRS<span>{</span>supports_autosuspend<span>}==</span><span>"1"</span></code></pre></figure>

<p>The HID core subsystem is in charge of managing the lifecycle
(connect/disconnect/open/close), parsing the HID report descriptors
to understand the device capabilities. Once parsed, it dispatches
Reports to the HID drivers registered on the HID bus, each driver can
inspect the Usage Page and Usage to decide how and whether to handle
them. This is like a publish-subscribe mechanism. The most specific
registered driver (vendor specific) will match and handle Reports in
whatever way they see fit, otherwise the hid-generic driver is the
fallback.</p>

<p>Several <code>*_connect</code> hooks in the HID core subsystem allow attaching
handlers for different behavior that HID device provide. The most
important for us is the <code>hidinput_connect</code> for the <code>HID_CONNECT_HIDINPUT</code>,
to handle HID input devices. It’s default implementation lives in
<code>hid-input</code> (internally <code>hidinput_report_event</code>). Device specific drivers
can override this behavior if needed. The hid-input role is to bridge
with the input core, allocating and registering the input device via
<code>input_register_device</code>, which will in turn expose <code>/dev/input/eventN</code>,
as we’ve seen before, and translate HID Reports to evdev.<br>
Similarly, in this pub-sub fan-out fashion, another handler is the
default one registered for <code>HID_CONNECT_HIDRAW</code>, from <code>hidraw.c</code>
(<code>hidraw_report_event</code>). This driver will create a raw interface on
devtmpfs (<code>/dev/hidrawN</code>) to interface with raw HID events that aren’t
necessarily input-related.</p>

<p>This looks somewhat like this:</p>

<p><img src="https://venam.net/blog/assets/input_devices_linux/hid_core.png" alt="HID Core Overview" title="HID Core Overview"></p>

<p>This is all neat, let’s list a couple of tools that can help us debug
HID and inspect HID Reports Descriptors and Reports.</p>

<ul>
  <li><code>usbhid-dump</code> - will dump USB HID device report descriptors and streams</li>
  <li><a href="https://github.com/abend0c1/hidrdd">hidrdd</a> - verbose description of hid report descriptors</li>
  <li><code>hid-tools</code> - has many sub-tools such as replay, decode, and recording</li>
  <li><code>hid-replay</code> - to test and replay hid events</li>
  <li><a href="https://eleccelerator.com/usbdescreqparser">Online USB Descriptor and Request Parser</a></li>
</ul>

<p>The simplest one in my opinion is hid-tools, here’s an example of a
keyboard with consumer control and system control, the same one we’ve
seen in the procfs introspection interface earlier (<code>/proc/bus/input/</code>):</p>

<figure><pre><code data-lang="shell"><span>&gt;</span> hid-decode /sys/bus/hid/devices/0003:1A2C:6004.004F/report_descriptor

<span># device 0:0</span>

<span># 0x05, 0x0c,        // Usage Page (Consumer Devices)   0</span>
<span># 0x09, 0x01,        // Usage (Consumer Control)        2</span>
<span># 0xa1, 0x01,        // Collection (Application)        4</span>
<span># 0x85, 0x01,        //  Report ID (1)                  6</span>
<span># 0x19, 0x00,        //  Usage Minimum (0)              8</span>
<span># 0x2a, 0x3c, 0x02,  //  Usage Maximum (572)            10</span>
<span># 0x15, 0x00,        //  Logical Minimum (0)            13</span>
<span># 0x26, 0x3c, 0x02,  //  Logical Maximum (572)          15</span>
<span># 0x95, 0x01,        //  Report Count (1)               18</span>
<span># 0x75, 0x10,        //  Report Size (16)               20</span>
<span># 0x81, 0x00,        //  Input (Data,Arr,Abs)           22</span>
<span># 0xc0,              // End Collection                  24</span>

<span># 0x05, 0x01,        // Usage Page (Generic Desktop)    25</span>
<span># 0x09, 0x80,        // Usage (System Control)          27</span>
<span># 0xa1, 0x01,        // Collection (Application)        29</span>
<span># 0x85, 0x02,        //  Report ID (2)                  31</span>
<span># 0x19, 0x81,        //  Usage Minimum (129)            33</span>
<span># 0x29, 0x83,        //  Usage Maximum (131)            35</span>
<span># 0x25, 0x01,        //  Logical Maximum (1)            37</span>
<span># 0x75, 0x01,        //  Report Size (1)                39</span>
<span># 0x95, 0x03,        //  Report Count (3)               41</span>
<span># 0x81, 0x02,        //  Input (Data,Var,Abs)           43</span>
<span># 0x95, 0x05,        //  Report Count (5)               45</span>
<span># 0x81, 0x01,        //  Input (Cnst,Arr,Abs)           47</span>
<span># 0xc0,              // End Collection                  49</span>
<span># </span>
R: 50 05 0c 09 01 a1 01 85 01 19 00 2a 3c 02 15 00 26 3c <span>\</span>
   02 95 01 75 10 81 00 c0 05 01 09 80 a1 01 85 02 19 81 <span>\</span>
   29 83 25 01 75 01 95 03 81 02 95 05 81 01 c0
N: device 0:0
I: 3 0001 0001</code></pre></figure>

<p>You can see it has two Application Collections, so that’s why we had
two entries for the keyboard.</p>

<p>In some cases, the HID Device Descriptor is wrong
and needs some patching, which can either be done in a
special driver, or on a live system dynamically by relying on
<a href="https://libevdev.pages.freedesktop.org/udev-hid-bpf/"><code>udev-hid-bpf</code></a>
which will be invoked before the kernel handles HID.</p>

<h2 id="evdev--event-device">evdev — Event Device</h2>

<p>Let’s tackle the last piece of the exposed middle-layer that we didn’t
explain yet: The Event Device common protocol, the evdev layer.</p>

<p>From what we’ve seen, we know that evdev is a standardization interface,
it decouples and abstracts the underlying devices. It could be a USB
keyboard, a Bluetooth pointer, or PS/2 device, and all the user needs
is to read from the evdev interface, without worrying about their
differences.</p>

<p>It works because evdev registers itself as the default input handler in
the input core, and the main job of most input driver is to translate
to it:</p>

<figure><pre><code data-lang="c"><span>static</span> <span>struct</span> <span>input_handler</span> <span>evdev_handler</span> <span>=</span> <span>{</span>
	<span>.</span><span>events</span>		<span>=</span> <span>evdev_events</span><span>,</span>
	<span>.</span><span>connect</span>	<span>=</span> <span>evdev_connect</span><span>,</span>
	<span>.</span><span>disconnect</span>	<span>=</span> <span>evdev_disconnect</span><span>,</span>
	<span>.</span><span>legacy_minors</span>	<span>=</span> <span>true</span><span>,</span>
	<span>.</span><span>minor</span>		<span>=</span> <span>EVDEV_MINOR_BASE</span><span>,</span>
	<span>.</span><span>name</span>		<span>=</span> <span>"evdev"</span><span>,</span>
	<span>.</span><span>id_table</span>	<span>=</span> <span>evdev_ids</span><span>,</span>
<span>};</span></code></pre></figure>

<p>When its “connect” event is fired, it creates the corresponding evdev
node in <code>/dev/input/eventN</code>. Furthermore, the info is also reflected
in sysfs within the <code>/sys/class/input/eventN</code> directory along with its
related <code>/sys/class/input/inputN</code> device created by the input core, which
it is the children of (<code>eventN</code> within <code>inputN</code>).</p>

<p>The evdev driver also supports certain ioctl to query
its internal state, let a client handle exclusively grab a
device (<code>EVIOCGRAB</code>), or change certain values. The list of ioctl can be found
<a href="https://www.freedesktop.org/software/libevdev/doc/latest/ioctls.html">here</a>
within libevdev, though libevdev doesn’t support all of them (the list
can also be found in <code>include/linux/input.h</code>).</p>

<p>Let’s see what the evdev format is about, and how the input core
translates to it and generates the events.</p>

<p>The evdev protocol is stateful, it doesn’t forward everything to
user-space but only does when it notices a change. To inquire about
its current state one can rely on ioctl instead.</p>

<p>The format of evdev is composed of a series of <code>input_event</code> (from
<code>include/linux/input.h</code>) which look like the structure here under,
grouped in what’s called a sequence or a frame:</p>

<figure><pre><code data-lang="c"><span>struct</span> <span>input_event</span> <span>{</span>
 <span>struct</span> <span>timeval</span> <span>time</span><span>;</span>
 <span>__u16</span> <span>type</span><span>;</span>
 <span>__u16</span> <span>code</span><span>;</span>
 <span>__s32</span> <span>value</span><span>;</span>
<span>};</span></code></pre></figure>

<p>Basically a timestamp along with a type-code couple and an associated
value. The type is the general category to which this event is part of,
and the code the sub-category. For example it could be a relative movement
(type), on the x-axis (code), of 1 unit (value). The available types of
events and codes can be found under <code>include/linux/input-event-codes.h</code>.</p>

<p>The most common types are:</p>

<ul>
  <li><code>EV_KEY</code>: buttons and keyboards</li>
  <li><code>EV_REL</code>: relative events, on axis or others</li>
  <li><code>EV_ABS</code>: absolute axis value, coordinates, touchscreens</li>
</ul>

<p>Each frame ends whenever a synchronization event comes up, the most
common is of type.code(value) <code>EV_SYN.SYN_REPORT(0)</code>. It’s the marker
that it’s time to make sense of the stream, the whole frame.</p>

<p>An example snapshot of a frame of an “absolute touchpad” would look
like this:</p>

<div><pre><code>E: 30.920519 0003 0018 0031     # EV_ABS / ABS_PRESSURE         31
E: 30.920519 0000 0000 0000     # ------------ SYN_REPORT (0) ---------- +13ms
E: 30.933332 0003 0035 2103     # EV_ABS / ABS_MT_POSITION_X    2103
E: 30.933332 0003 0036 1876     # EV_ABS / ABS_MT_POSITION_Y    1876
E: 30.933332 0003 003a 0029     # EV_ABS / ABS_MT_PRESSURE      29
E: 30.933332 0003 0000 2103     # EV_ABS / ABS_X                2103
E: 30.933332 0003 0001 1876     # EV_ABS / ABS_Y                1876
E: 30.933332 0003 0018 0029     # EV_ABS / ABS_PRESSURE         29
E: 30.933332 0000 0000 0000     # ------------ SYN_REPORT (0) ---------- +13ms
E: 30.946156 0003 003a 0017     # EV_ABS / ABS_MT_PRESSURE      17
E: 30.946156 0003 0018 0017     # EV_ABS / ABS_PRESSURE         17
E: 30.946156 0000 0000 0000     # ------------ SYN_REPORT (0) ---------- +13ms
E: 30.959094 0003 0039 -001     # EV_ABS / ABS_MT_TRACKING_ID   -1
E: 30.959094 0001 014a 0000     # EV_KEY / BTN_TOUCH            0
E: 30.959094 0001 0145 0000     # EV_KEY / BTN_TOOL_FINGER      0
E: 30.959094 0003 0018 0000     # EV_ABS / ABS_PRESSURE         0
E: 30.959094 0000 0000 0000     # ------------ SYN_REPORT (0) ---------- +13ms
</code></pre></div>

<p>And of a keyboard:</p>

<div><pre><code>E: 0.000000 0004 0004 458792    # EV_MSC / MSC_SCAN             458792
E: 0.000000 0001 001c 0000      # EV_KEY / KEY_ENTER            0
E: 0.000000 0000 0000 0000      # ------------ SYN_REPORT (0) ----------
E: 0.560004 0004 0004 458976    # EV_MSC / MSC_SCAN             458976
E: 0.560004 0001 001d 0001      # EV_KEY / KEY_LEFTCTRL         1
E: 0.560004 0000 0000 0000      # ------------ SYN_REPORT (0) ----------
[....]
E: 1.172732 0001 001d 0002      # EV_KEY / KEY_LEFTCTRL         2
E: 1.172732 0000 0000 0001      # ------------ SYN_REPORT (1) ----------
E: 1.200004 0004 0004 458758    # EV_MSC / MSC_SCAN             458758
E: 1.200004 0001 002e 0001      # EV_KEY / KEY_C                1
E: 1.200004 0000 0000 0000      # ------------ SYN_REPORT (0) ----------
</code></pre></div>

<p>As we’ve said, it’s stateful, so the events are only sent when there is a
state change, even when the hardware keeps resending the same event. So
for example, if a key is kept pressed, it won’t resend the event until
it’s released.</p>

<p>These events might seem simple on their own but are in fact absolutely
complex to handle, especially touchpads. There are many features such as
pressure, multi-touch, and the tracking of different fingers, which needs an
upper layer to make sense of all this. This is where libinput shines, and
we’ll see that later on. For now just keep in mind it’s a series of event.</p>

<p>So how do drivers use evdev to send events, we’ve talked about
<code>input_event</code> before, but how does it work.</p>

<p>Well, first of before sending any event, the input driver needs at the
registration phase to advertise to the system what it’s capable of,
to say what kind of events it can generate. These event “capabilities”,
as they’re called, are a couple of different bits in sets that are also
inspectable in sysfs <code>/sys/class/input/inputN/capabilities/</code>.</p>

<p>You’ll find the following types of capabilities:</p>

<ul>
  <li><code>ev</code>, set in <code>input_dev-&gt;evbit</code>, Which event types the device can generate (<code>EV_KEY</code>, <code>EV_REL</code>, etc.)</li>
  <li><code>key</code>, set in <code>input_dev-&gt;keybit</code>, Which key/button codes it supports</li>
  <li><code>rel</code>, set in <code>input_dev-&gt;relbit</code>, Which relative axes (e.g., REL_X, REL_WHEEL)</li>
  <li><code>abs</code>, set in <code>input_dev-&gt;absbit</code>, Which absolute axes (e.g., ABS_X, ABS_Y)</li>
  <li><code>led</code>, set in <code>input_dev-&gt;ledbit</code>, LED indicators (e.g., keyboard LEDs)</li>
  <li><code>sw</code> , set in <code>input_dev-&gt;swbit</code>,  Switch states (e.g., lid switch)</li>
  <li><code>ff</code> , set in <code>input_dev-&gt;ffbit</code>,  Force feedback capabilities</li>
  <li><code>msc</code>, set in <code>input_dev-&gt;mscbit</code>, Miscellaneous events</li>
  <li><code>snd</code>, set in <code>input_dev-&gt;sndbit</code>, Sound events</li>
</ul>

<p>As you can see, it’s somewhat related the HID capabilities in a sense,
but applies to all devices.</p>

<p>We’ve also seen these capabilities bits during our inspection of the
input core procfs interface <code>/proc/bus/input/</code> in the <code>B</code> field:</p>

<figure><pre><code data-lang="shell">I: <span>Bus</span><span>=</span>0003 <span>Vendor</span><span>=</span>1a2c <span>Product</span><span>=</span>6004 <span>Version</span><span>=</span>0110
N: <span>Name</span><span>=</span><span>"SEMICO USB Keyboard Consumer Control"</span>
P: <span>Phys</span><span>=</span>usb-0000:00:12.0-1/input1
S: <span>Sysfs</span><span>=</span>/devices/pci0000:00/0000:00:12.0/usb2/<span>\</span>
   2-1/2-1:1.1/0003:1A2C:6004.001E/input/input53
U: <span>Uniq</span><span>=</span>
H: <span>Handlers</span><span>=</span>kbd event7 
B: <span>PROP</span><span>=</span>0
B: <span>EV</span><span>=</span>1f
B: <span>KEY</span><span>=</span>33eff 0 0 483ffff17aff32d bfd4444600000000 <span>\</span>
   1 130c730b17c000 267bfad9415fed 9e168000004400 10000002
B: <span>REL</span><span>=</span>1040
B: <span>ABS</span><span>=</span>100000000
B: <span>MSC</span><span>=</span>10

I: <span>Bus</span><span>=</span>0003 <span>Vendor</span><span>=</span>1a2c <span>Product</span><span>=</span>6004 <span>Version</span><span>=</span>0110
N: <span>Name</span><span>=</span><span>"SEMICO USB Keyboard System Control"</span>
P: <span>Phys</span><span>=</span>usb-0000:00:12.0-1/input1
S: <span>Sysfs</span><span>=</span>/devices/pci0000:00/0000:00:12.0/usb2/<span>\</span>
   2-1/2-1:1.1/0003:1A2C:6004.001E/input/input54
U: <span>Uniq</span><span>=</span>
H: <span>Handlers</span><span>=</span>kbd event9 
B: <span>PROP</span><span>=</span>0
B: <span>EV</span><span>=</span>13
B: <span>KEY</span><span>=</span>c000 10000000000000 0
B: <span>MSC</span><span>=</span>10</code></pre></figure>

<p>However, parsing the bits manually in procfs or sysfs would be cumbersome,
it’s better to rely on tools such as <code>libinput record</code>, check the
<strong>“Supported Events”</strong> section:</p>

<figure><pre><code data-lang="shell">devices:
- node: /dev/input/event5
  evdev:
    <span># Name: SEMICO USB Keyboard</span>
    <span># ID: bus 0x0003 (usb) vendor 0x1a2c \</span>
    <span>#         product 0x6004 version 0x0110</span>
    <span># Supported Events:</span>
    <span># Event type 0 (EV_SYN)</span>
    <span># Event type 1 (EV_KEY)</span>
    <span>#   Event code 1 (KEY_ESC)</span>
    <span>#   Event code 2 (KEY_1)</span>
    <span>#   Event code 3 (KEY_2)</span>
    <span>#   Event code 4 (KEY_3)</span>
    …
    <span>#   Event code 12 (KEY_MINUS)</span>
    <span>#   Event code 13 (KEY_EQUAL)</span>
    <span>#   Event code 14 (KEY_BACKSPACE)</span>
    <span>#   Event code 15 (KEY_TAB)</span>
    <span>#   Event code 16 (KEY_Q)</span>
    …
    <span># Event type 4 (EV_MSC)</span>
    <span>#   Event code 4 (MSC_SCAN)</span>
    <span># Event type 17 (EV_LED)</span>
    <span>#   Event code 0 (LED_NUML)</span>
    <span>#       State 0</span>
    <span>#   Event code 1 (LED_CAPSL)</span>
    <span>#       State 0</span>
    <span>#   Event code 2 (LED_SCROLLL)</span>
    <span>#       State 0</span>
    <span># Event type 20 (EV_REP)</span>
    <span>#   Event code 0 (REP_DELAY)</span>
    <span>#   Event code 1 (REP_PERIOD)</span>
    <span># Properties:</span>
    name: <span>"SEMICO USB Keyboard"</span>
    <span>id</span>: <span>[</span>3, 6700, 24580, 272]
    codes:
      0: <span>[</span>0, 1, 2, 3, 4,…, 13, 14, 15] <span># EV_SYN</span>
      1: <span>[</span>1, 2, 3, 4, 5, 6, 7, 8, 9 …]
      4: <span>[</span>4] <span># EV_MSC</span>
      17: <span>[</span>0, 1, 2] <span># EV_LED</span>
      20: <span>[</span>0, 1] <span># EV_REP</span>
    properties: <span>[]</span>
  hid: <span>[</span>
    0x05, 0x01, 0x09, 0x06, 0xa1, 0x01, 0x05, 0x08, 0x19, 0x01, 0x29,
    0x03, 0x15, 0x00, 0x25, 0x01, 0x75, 0x01, 0x95, 0x03, 0x91, 0x02,
    0x95, 0x05, 0x91, 0x01, 0x05, 0x07, 0x19, 0xe0, 0x29, 0xe7, 0x95,
    0x08, 0x81, 0x02, 0x75, 0x08, 0x95, 0x01, 0x81, 0x01, 0x19, 0x00,
    0x29, 0x91, 0x26, 0xff, 0x00, 0x95, 0x06, 0x81, 0x00, 0xc0
  <span>]</span>
  udev:
    properties:
    - <span>ID_INPUT</span><span>=</span>1
    - <span>ID_INPUT_KEY</span><span>=</span>1
    - <span>ID_INPUT_KEYBOARD</span><span>=</span>1
    - <span>LIBINPUT_DEVICE_GROUP</span><span>=</span>3/1a2c/6004:usb-0000:00:12.0-1
    - <span>DRIVER</span><span>=</span>hid-generic
    virtual: <span>false</span></code></pre></figure>

<p>As you can see it also dumps more information such as the HID Report
Descriptor and the attached udev properties.</p>

<p>Here’s what you can see from the much longer list that a touchpad
generates:</p>

<div><pre><code># Input device name: "SynPS/2 Synaptics TouchPad"
# Input device ID: bus 0x11 vendor 0x02 \
#            product 0x07 version 0x1b1
# Supported events:
#   Event type 0 (EV_SYN)
#     Event code 0 (SYN_REPORT)
#     Event code 1 (SYN_CONFIG)
#     Event code 2 (SYN_MT_REPORT)
#     Event code 3 (SYN_DROPPED)
#     Event code 4 ((null))
#     Event code 5 ((null))
#     Event code 6 ((null))
#     Event code 7 ((null))
#     Event code 8 ((null))
#     Event code 9 ((null))
#     Event code 10 ((null))
#     Event code 11 ((null))
#     Event code 12 ((null))
#     Event code 13 ((null))
#     Event code 14 ((null))
#   Event type 1 (EV_KEY)
#     Event code 272 (BTN_LEFT)
#     Event code 325 (BTN_TOOL_FINGER)
#     Event code 328 (BTN_TOOL_QUINTTAP)
#     Event code 330 (BTN_TOUCH)
#     Event code 333 (BTN_TOOL_DOUBLETAP)
#     Event code 334 (BTN_TOOL_TRIPLETAP)
#     Event code 335 (BTN_TOOL_QUADTAP)
#   Event type 3 (EV_ABS)
#     Event code 0 (ABS_X)
#       Value   2919
#       Min     1024
#       Max     5112
#       Fuzz       0
#       Flat       0
#       Resolution 42
#     Event code 1 (ABS_Y)
#       Value   3711
#       Min     2024
#       Max     4832
#       Fuzz       0
#       Flat       0
#       Resolution 42
#     Event code 24 (ABS_PRESSURE)
#       Value      0
#       Min        0
#       Max      255
#       Fuzz       0
#       Flat       0
#       Resolution 0
#     Event code 28 (ABS_TOOL_WIDTH)
#       Value      0
#       Min        0
#       Max       15
#       Fuzz       0
#       Flat       0
#       Resolution 0
# Properties:
#   Property  type 0 (INPUT_PROP_POINTER)
#   Property  type 2 (INPUT_PROP_BUTTONPAD)
#   Property  type 4 (INPUT_PROP_TOPBUTTONPAD)
</code></pre></div>

<p>As a note, the Properties can let us know whether we’re dealing with
a touchscreen <code>INPUT_PROP_DIRECT</code>, or a touchpad <code>INPUT_PROP_POINTER</code>,
and <code>INPUT_PROP_BUTTONPAD</code> also tells us that it’s a so-called clickpad
(no separate physical buttons but the whole touchpad clicks). These are
hints for libinput to properly handle different kinds of devices.</p>

<p>So after registering its capabilities, the input driver simply reports
its events by relying on the <code>input_event</code> function, or one of it’s
many wrappers:</p>

<figure><pre><code data-lang="c"><span>void</span> <span>input_event</span><span>(</span><span>struct</span> <span>input_dev</span> <span>*</span><span>dev</span><span>,</span> <span>unsigned</span> <span>int</span> <span>type</span><span>,</span> <span>unsigned</span> <span>int</span> <span>code</span><span>,</span> <span>int</span> <span>value</span><span>);</span>

<span>static</span> <span>inline</span> <span>void</span> <span>input_report_key</span><span>(</span><span>struct</span> <span>input_dev</span> <span>*</span><span>dev</span><span>,</span> <span>unsigned</span> <span>int</span> <span>code</span><span>,</span> <span>int</span> <span>value</span><span>)</span>
<span>{</span>
	<span>input_event</span><span>(</span><span>dev</span><span>,</span> <span>EV_KEY</span><span>,</span> <span>code</span><span>,</span> <span>!!</span><span>value</span><span>);</span>
<span>}</span>

<span>static</span> <span>inline</span> <span>void</span> <span>input_report_rel</span><span>(</span><span>struct</span> <span>input_dev</span> <span>*</span><span>dev</span><span>,</span> <span>unsigned</span> <span>int</span> <span>code</span><span>,</span> <span>int</span> <span>value</span><span>)</span>
<span>{</span>
	<span>input_event</span><span>(</span><span>dev</span><span>,</span> <span>EV_REL</span><span>,</span> <span>code</span><span>,</span> <span>value</span><span>);</span>
<span>}</span>

<span>static</span> <span>inline</span> <span>void</span> <span>input_report_abs</span><span>(</span><span>struct</span> <span>input_dev</span> <span>*</span><span>dev</span><span>,</span> <span>unsigned</span> <span>int</span> <span>code</span><span>,</span> <span>int</span> <span>value</span><span>)</span>
<span>{</span>
	<span>input_event</span><span>(</span><span>dev</span><span>,</span> <span>EV_ABS</span><span>,</span> <span>code</span><span>,</span> <span>value</span><span>);</span>
<span>}</span></code></pre></figure>

<p>That’s it mostly to understand evdev! There are multiple tools to help
debug evdev-related issues. We’ve seen <code>libinput record</code>. Similarly,
there’s the <code>evemu</code> suite with its record, device, play functions to
simulate and test devices, and <code>evtest</code>.<br>
There’s also <a href="https://github.com/KarsMulder/evsieve">evsieve</a>, a tool to
intercept and modify evdev events on the fly.<br>
Along with these, the library libevdev, in C and python, is the most
used to integrate with evdev-related things.</p>

<h2 id="udev--hwdb">udev &amp; hwdb</h2>

<p>After going through the kernel and exposed layers, we’re finally in
user-space!<br>
The first component we’ll see is udev, since we mentioned its role
countless times in the previous sections.</p>

<p>Udev, or the dynamic user-space device manager, implemented as the
udev daemon <code>systemd-udevd</code>, has as role to take actions whenever a
uevent (<code>PF_NETLINK, NETLINK_KOBJECT_UEVENT</code>) is sent from the kernel
to user-space. We’ve seen a few of the possible actions it performs,
here’s a summary of the kind of things it does:</p>

<ul>
  <li>Load kernel modules based on the uevent MODALIAS</li>
  <li>Set access rights on device nodes</li>
  <li>Attach properties to devices on detection</li>
  <li>Create symlinks so that devices have more predictable names</li>
  <li>Keep track internally of device info in its internal db</li>
  <li>Use its rule system to take any kind of action on plug/unplug of a device</li>
</ul>

<p>The most important part is the last point: udev has a set of rules against
which it can match devices and their attributes and take all sorts of
actions based on that. The fields it has access to not only come from the
uevents but also from all related info on the system.</p>

<p>These rules, as is the convention for pretty much all big daemons these
days, are read from system locations such as <code>/usr/lib/udev/rules.d</code>,
<code>/usr/local/lib/udev/rules.d</code>, and the volatile runtime in
<code>/run/udev/rules.d</code>, and from the local admin directory of
<code>/etc/udev/rules.d</code> which takes precedence over the other locations. The
directories contains files with a <code>.rules</code> extension and are processed and
ordered lexically (<code>01-example.rules</code> comes before <code>05-example.rules</code>).</p>

<p>Now the syntax of udev rules, which are mainly composed of matching
patterns and actions to perform or properties to set upon match, is
dense and complex (it even has branching). Only a deep study of <code>udev(7)</code>
man page will help. Yet, we can still learn the very basics of it to be
able to understand what’s happening.<br>
Our approach will consist of, first checking two examples, then have a
general overview of the possible components of the syntax, and finally
talking about the particularities of that system.</p>

<p>The first example is quite simple, it will run a script when a specific
keyboard is plugged/unplugged.</p>

<figure><pre><code data-lang="shell"><span>ACTION</span><span>==</span><span>"add"</span>, <span>SUBSYSTEM</span><span>==</span><span>"input"</span>,
  ATTRS<span>{</span><span>id</span>/product<span>}==</span><span>"6004"</span>,
  ATTRS<span>{</span><span>id</span>/vendor<span>}==</span><span>"1a2c"</span>,
  RUN+<span>=</span><span>"/bin/kbd_is_plugged"</span>

<span>ACTION</span><span>==</span><span>"remove"</span>, <span>SUBSYSTEM</span><span>==</span><span>"input"</span>,
  ATTRS<span>{</span><span>id</span>/product<span>}==</span><span>"6004"</span>,
  ATTRS<span>{</span><span>id</span>/vendor<span>}==</span><span>"1a2c"</span>,
  RUN+<span>=</span><span>"/bin/kbd_is_unplugged"</span></code></pre></figure>

<p>The rule is pretty clear about what it does, on “add” or “remove” action
for specific match it’ll execute a script. But you’ll also notice that the
match components such as SUBSYSTEM and ATTRS are things we’ve seen before
in previous traces of <code>udevadm info</code>, which is exactly the point. <code>udevadm
info</code> will show us certain components we can used to match.</p>

<p>The second example is a tad bit more complex, we will parse
<code>/usr/lib/udev/rules.d/60-persistent-input.rules</code>. That file creates
a more persistent naming scheme for input devices in devtmpfs under
<code>/dev/input/by-id</code> and <code>/dev/input/by-path/</code>. Here’s a simplified version
of it.</p>

<figure><pre><code data-lang="shell"><span>ACTION</span><span>==</span><span>"remove"</span>, <span>GOTO</span><span>=</span><span>"persistent_input_end"</span>
SUBSYSTEM!<span>=</span><span>"input"</span>, <span>GOTO</span><span>=</span><span>"persistent_input_end"</span>
<span># …</span>

<span># determine class name for persistent symlinks</span>
ENV<span>{</span>ID_INPUT_KEYBOARD<span>}==</span><span>"?*"</span>, ENV<span>{</span>.INPUT_CLASS<span>}=</span><span>"kbd"</span>
ENV<span>{</span>ID_INPUT_MOUSE<span>}==</span><span>"?*"</span>, ENV<span>{</span>.INPUT_CLASS<span>}=</span><span>"mouse"</span>
<span># …</span>

<span># by-id links</span>
<span>KERNEL</span><span>==</span><span>"event*"</span>, ENV<span>{</span>ID_BUS<span>}==</span><span>"?*"</span>, ENV<span>{</span>.INPUT_CLASS<span>}==</span><span>"?*"</span>,
  ATTRS<span>{</span>bInterfaceNumber<span>}==</span><span>"|00"</span>,
  SYMLINK+<span>=</span><span>"input/by-id/</span><span>$env</span><span>{ID_BUS}-</span><span>$env</span><span>{ID_SERIAL}-event-</span><span>$env</span><span>{.INPUT_CLASS}"</span>

<span># by-path</span>
ENV<span>{</span>.INPUT_CLASS<span>}==</span><span>"?*"</span>, <span>KERNEL</span><span>==</span><span>"event*"</span>,
  ENV<span>{</span>ID_PATH<span>}==</span><span>"?*"</span>, 
  SYMLINK+<span>=</span><span>"input/by-path/</span><span>$env</span><span>{ID_PATH}-event-</span><span>$env</span><span>{.INPUT_CLASS}"</span>

<span># …</span>

<span>LABEL</span><span>=</span><span>"persistent_input_end"</span></code></pre></figure>

<p>We can see multiple things from this short example. First of all,
the branching mechanism with its use of <code>GOTO</code> whenever certain matches
don’t fit the specific use-case. We can also see the standard comparison
operators such as <code>==</code> and <code>!=</code>.<br>
Then we see different variables/values that are either compared against
such as <code>SUBSYSTEM</code>, <code>ACTION</code>, <code>KERNEL</code>, <code>ATTRS{…}</code>, <code>ENV{}</code>, or
assigned such as <code>ENV{…}</code>, <code>GOTO</code>, or <code>SYMLINK</code>. The assignment seems
to either use <code>=</code> or <code>+=</code>.<br>
Furthermore, from this example we can also see some regex-like pattern
matching, and string substitution within assignment.</p>

<p>Yet, overall the idea makes sense. We create some string variable based
on what type of input device we’re dealing with (prepended with <code>.</code>
means it’s only temporary), which we found in <code>ENV{…}</code>, the device
properties. Then for event devices we create two symlink files in
different directories “by-id” and “by-path”. For the by-id it’s composed
of the bus name, followed by the device name, “-event-“, and the input
class we’ve stored in the temporary variable.</p>

<p>Let’s see how that would look for this device:</p>

<figure><pre><code data-lang="shell"><span>&gt;</span> udevadm info <span>-p</span> <span>$(</span>udevadm info <span>-q</span> path <span>-n</span> /dev/input/event7<span>)</span>
…
M: event7
…
N: input/event7
…
E: <span>DEVNAME</span><span>=</span>/dev/input/event7
E: <span>MAJOR</span><span>=</span>13
E: <span>MINOR</span><span>=</span>71
E: <span>SUBSYSTEM</span><span>=</span>input
…
E: <span>ID_INPUT</span><span>=</span>1
E: <span>ID_INPUT_KEY</span><span>=</span>1
E: <span>ID_BUS</span><span>=</span>usb
E: <span>ID_MODEL</span><span>=</span>USB_Keyboard
E: <span>ID_MODEL_ENC</span><span>=</span>USB<span>\x</span>20Keyboard
E: <span>ID_MODEL_ID</span><span>=</span>6004
E: <span>ID_SERIAL</span><span>=</span>SEMICO_USB_Keyboard
E: <span>ID_VENDOR</span><span>=</span>SEMICO
E: <span>ID_VENDOR_ENC</span><span>=</span>SEMICO
E: <span>ID_VENDOR_ID</span><span>=</span>1a2c
E: <span>ID_REVISION</span><span>=</span>0110
E: <span>ID_TYPE</span><span>=</span>hid
…</code></pre></figure>

<p>The lines starting with <code>E:</code> are device properties that are in <code>ENV{…}</code>,
the meaning can be found in <code>udevadm(8)</code> manpage, which we’ll see more
of in other examples.<br>
So from this, the device should be symlinked as
<code>/dev/input/by-id/usb-SEMICO_USB_Keyboard-event-kbd</code>, which it indeed is.</p>

<p>That’s a neat example, it gives us a generic idea of udev. Let’s continue
and try to get a more general idea of the udev syntax.</p>

<p>So far we’ve seen that the rules files contain key-value pairs, or
comments starting with <code>#</code> as is standard in most conf files, and
has operators that are either for comparison, <code>==</code> and <code>!=</code>, or for
assignment, we’ve seen <code>=</code> and <code>+=</code>.</p>

<p>The difference between these two assignment operators is that some
variables/keys are lists, and the <code>+=</code> appends to that list, while the
<code>=</code> operator would basically empty the list and set only the single
value in it. Additionally, there are two other assignment operators
we haven’t seen: the <code>-=</code> to remove a value from a list, and the <code>:=</code>
which sets a constant and disallow future change.</p>

<p>How to know if something is a list or a scalar value, and if the key can
be used in comparison or assignment. Well, it depends on the key itself,
which are listed in the man page <code>udev(7)</code>, we’ll see the most common
but first let’s talk about the values.</p>

<p>The values assigned are always strings within double quotes, and use
the usual same escape mechanism that C and other languages use. It also
allows case-insensitive comparison by having the string preceded by “i”,
such as <code>i"casedoesn't matter"</code>.<br>
The strings also allow internal substitution with variables/keys, some
that can be set on the fly, from the match, or from a set of global
ones. It’s similar to a lot of languages: <code>"hello $kernel $env{ID_PATH}"</code>.
This is what we’ve seen in one of our examples.<br>
Furthermore, if a string is used during matching, it can include
glob patterns, also the usual ones, such as <code>*</code> to match zero or more
characters, <code>?</code> to match a single characters, <code>|</code> for the or separator,
and <code>[]</code> to match a set of characters. Obviously, these special characters
will need to be escaped if used as-is.</p>

<p>Now, as we said there are keys used to do matching/searching, and keys
that allow assigning values (list or not), yet what’s confusing is that
lots of keys can be used for both, but not all of them. A quick look at
<code>udev(7)</code> to be sure doesn’t hurt.</p>

<p>Here are some common matching keys:</p>

<ul>
  <li><code>KERNEL</code>: kernel name</li>
  <li><code>SUBSYSTEM</code>: the kernel subsystem the device is associated to</li>
  <li><code>DRIVER</code>: the driver currently handling the device</li>
  <li><code>ACTION</code>: Represents what’s happening on a device. Either <code>add/remove</code>
when the device is created or removed, <code>bind/unbind</code> for the driver,
<code>change</code> when something happens on a device such as a state change (ex:
eject, power plug, brightness), <code>offline/online</code> for memory and cpu,
<code>move</code> when a device is renamed.</li>
  <li><code>ATTR{attributename}</code>: match any sysfs attribute of the device</li>
  <li><code>TAG</code>: arbitrary tags, mostly used for user-space special behavior</li>
  <li><code>ENV{property_name}</code>: Context info, device properties, added by the
kernel or other udev rules associated to device. They are not
environment variables, but do get passed as <code>env</code> to <code>RUN+=</code> commands.</li>
  <li><code>PROGRAM</code> and <code>RESULT</code>: The first executes an external program and
if it’s successful then the match is ok, the second checks the string
result of the last program and uses it as a comparator.</li>
</ul>

<p>Still, there are variants of some of the above to allow a match with any
of the parents of the devices in the topological hierarchy, these include
<code>KERNELS</code>, <code>SUBSYSTEMS</code>, <code>DRIVERS</code>, and <code>ATTRS</code>.</p>

<p>Now, we’ve dealt with the keys used for comparison, let’s see the common
assignment keys:</p>

<ul>
  <li><code>SYMLINK</code>: A list of symlinks to be created</li>
  <li><code>ATTR{attributename}</code>: Value that should be set in sysfs</li>
  <li><code>TAG</code>: A list of special attributes for user-space to act
upon. For example, systemd acts on <code>TAG+="systemd"</code> and will read
<code>ENV{SYSTEMD_WANTS}</code> and interpret it as a unit dependency for the
device. It can be used to automatically start services.</li>
  <li><code>ENV{property_name}</code>: Context info, device properties, of the device. If
the property name is prepended with a dot <code>.</code>, then it will only
temporarily be set.</li>
  <li><code>OWNER</code>, <code>GROUP</code>, <code>MODE</code>: Set permissions on the device</li>
  <li><code>RUN{type}</code>: A list of external programs to run. The type is optional
and defaults to “program”, but it can be “builtin”, which are
plugins. Beware that <code>RUN</code> will timeout, and so it’s always better to
dispatch long running process to starter scripts instead that will exit
directly. <code>systemd-run --user</code> is often used here to execute things
in a normal graphical session such as notifications.</li>
  <li><code>IMPORT{type}</code>: Similar to <code>RUN</code> but used to import a set of variables (<code>ENV</code>)
depending on the type, can be “program”, “builtin”, “file”, “db”,
“parent”, “cmdline”.</li>
  <li><code>LABEL</code>, <code>GOTO</code>: A label and goto to jump to it, creating branching.</li>
</ul>

<p>The <code>RUN{builtin}</code> is a bit of an edge-case within udev since there are
many builtin modules and most of them are blackboxes that are hardly
documented. We know from <code>udevadm test-builtin --help</code> that these exist:</p>

<div><pre><code>blkid           Filesystem and partition probing
btrfs           btrfs volume management
dissect_image   Dissect Disk Images
factory_reset   Factory Reset Mode
hwdb            Hardware database
input_id        Input device properties
keyboard        Keyboard scancode mapping and touchpad/pointingstick characteristics
kmod            Kernel module loader
net_driver      Set driver for network device
net_id          Network device properties
net_setup_link  Configure network link
path_id         Compose persistent device path
uaccess         Manage device node user ACL
usb_id          USB device properties
</code></pre></div>

<p>Unfortunately, what they do isn’t clear unless you step in the code of
<a href="https://github.com/systemd/systemd/blob/main/src/udev/udev-builtin.c">udev-builtin</a>.
For example,
<a href="https://github.com/systemd/systemd/blob/main/src/udev/udev-builtin-input_id.c"><code>input_id</code></a>
will set a series of <code>ENV</code> info on the device depending on what it thinks
it is. Here’s some relevant code snippet:</p>

<figure><pre><code data-lang="c"><span>if</span> <span>(</span><span>is_pointing_stick</span><span>)</span>
        <span>udev_builtin_add_property</span><span>(</span><span>event</span><span>,</span> <span>"ID_INPUT_POINTINGSTICK"</span><span>,</span> <span>"1"</span><span>);</span>
<span>if</span> <span>(</span><span>is_mouse</span> <span>||</span> <span>is_abs_mouse</span><span>)</span>
        <span>udev_builtin_add_property</span><span>(</span><span>event</span><span>,</span> <span>"ID_INPUT_MOUSE"</span><span>,</span> <span>"1"</span><span>);</span>
<span>if</span> <span>(</span><span>is_touchpad</span><span>)</span>
        <span>udev_builtin_add_property</span><span>(</span><span>event</span><span>,</span> <span>"ID_INPUT_TOUCHPAD"</span><span>,</span> <span>"1"</span><span>);</span>
<span>if</span> <span>(</span><span>is_touchscreen</span><span>)</span>
        <span>udev_builtin_add_property</span><span>(</span><span>event</span><span>,</span> <span>"ID_INPUT_TOUCHSCREEN"</span><span>,</span> <span>"1"</span><span>);</span>
<span>if</span> <span>(</span><span>is_joystick</span><span>)</span>
        <span>udev_builtin_add_property</span><span>(</span><span>event</span><span>,</span> <span>"ID_INPUT_JOYSTICK"</span><span>,</span> <span>"1"</span><span>);</span>
<span>if</span> <span>(</span><span>is_tablet</span><span>)</span>
        <span>udev_builtin_add_property</span><span>(</span><span>event</span><span>,</span> <span>"ID_INPUT_TABLET"</span><span>,</span> <span>"1"</span><span>);</span>
<span>if</span> <span>(</span><span>is_tablet_pad</span><span>)</span>
        <span>udev_builtin_add_property</span><span>(</span><span>event</span><span>,</span> <span>"ID_INPUT_TABLET_PAD"</span><span>,</span> <span>"1"</span><span>);</span></code></pre></figure>

<p>And, that’s the tip of the iceberg to understand udev rules. Yet, the ones on
a real system are a monstrously big patchup. The only way to visualize
all of them on your system, in the way they’ll be processed, is with
<code>systemd-analyze cat-config udev/rules.d</code>.</p>

<p>Before getting on with actual examples and tools, let’s take some time
to talk about one of the most important builtin module to udev: <code>hwdb</code>,
the harware db, or <code>systemd-hwdb</code>. Which is an extra mechanism to write
rules for udev to add device properties (<code>ENV{}</code>).</p>

<p>The hardware db is a lookup table that lives in files with the <code>.hwdb</code>
extension under the udev directory in the <code>hwdb.d</code> directory. These
key-values at <code>systemd-hwdb</code> start are compiled in a <code>hwdb.bin</code> file for
quick retrieval. They consist of matches of modalias-like keys and then
a series of assignment for properties. Something like:</p>

<div><pre><code>bluetooth:v0000*
 ID_VENDOR_FROM_DATABASE=Ericsson Technology Licensing
</code></pre></div>

<p>The format is a simple series of match strings, one or multiple, and then
assignment values following it on lines that start with a space. Match
strings can use glob for the match, they’re not really following any
specific format other than <code>prefix:search criteria</code>. Yet, the question is:
how are these modalias-like strings used. And the answer is obviously:
it’s used by udev via its <code>IMPORT</code> of the builtin hwdb to set certain
device properties based on the lookup. For example:</p>

<figure><pre><code data-lang="shell"><span>DRIVERS</span><span>==</span><span>"atkbd"</span>, <span>\</span>
  IMPORT<span>{</span><span>builtin</span><span>}=</span><span>"hwdb 'evdev:atkbd:</span><span>$attr</span><span>{[dmi/id]modalias}'"</span>, <span>\</span>
  ENV<span>{</span>.HAVE_HWDB_PROPERTIES<span>}=</span><span>"1"</span></code></pre></figure>

<p>So udev passes a set of parameters to hwdb, along with the device, and it
will return <code>ENV</code> properties to set. hwdb also has an accompanying command
line tool that works in a similar way and allows querying it. However, it
has no man page, as far as I can see, but the following args are allowed:</p>

<figure><pre><code data-lang="shell"><span>--filter</span> or <span>-f</span>: 
<span>--device</span> or <span>-d</span>:
<span>--subsystem</span> or <span>-s</span>:
<span>--lookup-prefix</span> <span>-p</span>:</code></pre></figure>

<p>So for example when passing <code>--subsystem=usb</code> and a device, hwdb will get
the actual <code>MODALIAS</code> of the device, or construct one from the <code>idVendor</code>,
<code>idProduct</code>, and <code>product</code>, then try to match it in its lookup table.</p>

<p>Anyhow, we won’t spend time breaking down the source code. Let’s just
add that since the <code>hwdb</code> lookup table is compiled at the start, then
when entries are added or modified <code>systemd-hwdb</code> needs to be updated
or notified via:</p>

<figure><pre><code data-lang="shell">systemd-hwdb update <span># compile the hwdb</span></code></pre></figure>

<p>Similarly, the same is also true of udev. However, udev has more granular
reload mechanism, either to reload rules or to re-emit events so that
they can be processed by the new rules:</p>

<figure><pre><code data-lang="shell">udevadm trigger <span># re-emits all the uevents</span>
udevadm trigger /sys/class/input/eventXYZ <span># only re-emit this device events</span>
udevadm control <span>--reload</span> <span># reload all rules but will only apply to new events</span></code></pre></figure>

<p>Let’s see more examples of <code>udevadm</code>, which is the main way to interface
with udev.</p>

<p><code>udevadm info</code> is used to gather information about devices, we’ve seen
it earlier in previous sections. It’s handy to write udev rules. You can
pass it either a devtmpfs path, a sysfs path, a device ID, or a systemd
unit name of <code>.device</code> type (these are the <code>TAG+="systemd"</code> devices to
automatically load other units).</p>

<p>For example, we can walk and find the attribute hierarchy of a certain
device.</p>

<figure><pre><code data-lang="shell"><span>&gt;</span> udevadm info <span>--attribute-walk</span> /dev/input/event5

  looking at device <span>'/devices/pci0000:00/0000:00:12.0/usb2\
      /2-4/2-4:1.0/0003:1A2C:6004.0069/input/input159/event5'</span>:
    <span>KERNEL</span><span>==</span><span>"event5"</span>
    <span>SUBSYSTEM</span><span>==</span><span>"input"</span>
    <span>DRIVER</span><span>==</span><span>""</span>
    ATTR<span>{</span>power/control<span>}==</span><span>"auto"</span>
    ATTR<span>{</span>power/runtime_active_time<span>}==</span><span>"0"</span>
    ATTR<span>{</span>power/runtime_status<span>}==</span><span>"unsupported"</span>
    ATTR<span>{</span>power/runtime_suspended_time<span>}==</span><span>"0"</span>


  looking at parent device <span>'/devices/pci0000:00/0000:00:12.0/usb\
      2/2-4/2-4:1.0/0003:1A2C:6004.0069/input/input159'</span>:
    <span>KERNELS</span><span>==</span><span>"input159"</span>
    <span>SUBSYSTEMS</span><span>==</span><span>"input"</span>
    <span>DRIVERS</span><span>==</span><span>""</span>
    ATTRS<span>{</span>capabilities/abs<span>}==</span><span>"0"</span>
    ATTRS<span>{</span>capabilities/ev<span>}==</span><span>"120013"</span>
    ATTRS<span>{</span>capabilities/ff<span>}==</span><span>"0"</span>
    ATTRS<span>{</span>capabilities/key<span>}==</span><span>"1000000000007 ff800000000007ff </span><span>\</span><span>
        febeffdff3cfffff fffffffffffffffe"</span>
    ATTRS<span>{</span>capabilities/led<span>}==</span><span>"7"</span>
    ATTRS<span>{</span>capabilities/msc<span>}==</span><span>"10"</span>
    ATTRS<span>{</span>capabilities/rel<span>}==</span><span>"0"</span>
    ATTRS<span>{</span>capabilities/snd<span>}==</span><span>"0"</span>
    ATTRS<span>{</span>capabilities/sw<span>}==</span><span>"0"</span>
    ATTRS<span>{</span><span>id</span>/bustype<span>}==</span><span>"0003"</span>
    ATTRS<span>{</span><span>id</span>/product<span>}==</span><span>"6004"</span>
    ATTRS<span>{</span><span>id</span>/vendor<span>}==</span><span>"1a2c"</span>
    ATTRS<span>{</span><span>id</span>/version<span>}==</span><span>"0110"</span>
    ATTRS<span>{</span>inhibited<span>}==</span><span>"0"</span>
    ATTRS<span>{</span>name<span>}==</span><span>"SEMICO USB Keyboard"</span>
    ATTRS<span>{</span>phys<span>}==</span><span>"usb-0000:00:12.0-4/input0"</span>
    ATTRS<span>{</span>power/control<span>}==</span><span>"auto"</span>
    ATTRS<span>{</span>power/runtime_active_time<span>}==</span><span>"0"</span>
    ATTRS<span>{</span>power/runtime_status<span>}==</span><span>"unsupported"</span>
    ATTRS<span>{</span>power/runtime_suspended_time<span>}==</span><span>"0"</span>
    ATTRS<span>{</span>properties<span>}==</span><span>"0"</span>
    ATTRS<span>{</span><span>uniq</span><span>}==</span><span>""</span>

  looking at parent device <span>'/devices/pci0000:00/0000:00:12.0/usb2\
      /2-4/2-4:1.0/0003:1A2C:6004.0069'</span>:
    <span>KERNELS</span><span>==</span><span>"0003:1A2C:6004.0069"</span>
    <span>SUBSYSTEMS</span><span>==</span><span>"hid"</span>
…</code></pre></figure>

<p>It’s something we’ve seen before.</p>

<p>Another option is to rely on <code>udevadm monitor</code>, which is a live trace
of all the uevent being sent.</p>

<p>Yet another option is <code>udevadm test</code> to print the rules that will get
triggered on a certain device uevent. This is useful to check whether
the rules make sense and will get executed.</p>

<p>A last tip to remember when writing udev rules is that <code>ATTR{}</code> is
anything in the files of sysfs. So we can simply match like this:</p>

<div><pre><code>&gt; cat /sys/class/input/event5/device/name
SEMICO USB Keyboard
</code></pre></div>

<p>And the rule would be <code>ATTR{name}=="SEMICO USB Keyboard"</code>.</p>

<p>Finally, let’s have a honorable mention to the mdev and eudev projects,
which are udev-like projects but more compatible with other init systems.</p>

<h2 id="libinput">libinput</h2>

<p>Libinput is a wrapper over udev and evdev. It provides a centralized way
to perform device detection, device event handling, input processing,
along with abstractions and common set of facilities to make the
practical, and user-expected, input handling easier. Today, libinput is
the major input library used by all graphical environments and toolkits,
it’s used by Xorg (through a driver) and Wayland compositors, so we’re
all probably using it indirectly.</p>

<p><img src="https://venam.net/blog/assets/input_devices_linux/libinput.png" alt="libinput Overview" title="libinput Overview"></p>

<p>Its basic mechanism works as you’d expect.<br>
As far as udev is concerned, it relies on <code>libudev/sd-device</code> to
enumerate devices and listen to kernel’s uevent. In particular, it
analyzes properties added by udev that helps categorize devices and
override settings (<code>ID_INPUT</code>, <code>ID_INPUT_*</code>, <code>LIBINPUT_*</code>), and filters
which devices it is allowed to handle by looking at which “seat” they’re
associated with. The whole udev part can be skipped by manually passing
events with <code>libinput_path_add_device</code>, but that’s a fallback scenario.<br>
And when it comes to evdev, it gets the handle to the corresponding
input stream devices then continuously read events and processes
them. This processing includes a lot of things such as scaling
touch coordinate, calculating pointer acceleration, debouncing
keys, etc.. Then finally, libinput returns these events in a unified
API as <code>LIBINPUT_EVENT_POINTER_BUTTON</code>, <code>LIBINPUT_EVENT_POINTER_MOTION</code>,
and <code>LIBINPUT_EVENT_POINTER_MOTION_ABSOLUTE</code>.</p>

<p>That also means it handles only the usual input devices such as mice,
keyboards, touchpads/clickpads, switches, trackpoints/pointing sticks,
touchscreens, and graphic tablets. It doesn’t handle joysticks, for
example, since these aren’t used for desktop environment but for games.</p>

<p>The main features handled by libinput are:</p>

<ul>
  <li>Button debouncing</li>
  <li>Clickpad software button behavior, Middle button emulation</li>
  <li>Touchpad pressure-based touch detection</li>
  <li>Palm and thumb detection</li>
  <li>Scrolling, Three-finger drag, and Tap-to-click behaviour</li>
  <li>Gestures</li>
</ul>

<p>We’ll see what these means, but first, why is libinput needed, can’t
udev and evdev be handled directly? Why have another layer of indirection?</p>

<p>The answer is twofold: to avoid having additional separate modules in the
upper stack such as in the X server, and because handling input devices
is messy and not as simple as taking evdev events as-is, they need a
bit more interpretation and cleanup.</p>

<p>Previously, before Wayland got traction, the X11 stack had specific
custom drivers, the xf86 input driver API, for each type of hardware and
use-case. Yet, these xf86 drivers could also have common functionalities
such as two-finger scrolling, which adds confusion. This was mostly a
hack for days before evdev existed, and there was a need for a library
independent of X11 that would centralize this responsibility, instead
of having it dispersed in different places. This makes it easier to
test each options, and have the features interact with one another,
cross-device communication.</p>

<p>Now why not handle it all directly, well because it’s messy. Multiple
devices have bad firmware and might send wrong capabilities and info
in their HID Report Descriptors, which will then be forwarded as-is
with evdev. Plus, having handling these in the driver would be even
more messy. For example, it could say that the size or resolution of
the touchpad is something while it’s something else. Or that the range
of valid inputs is 0 to 10 but that it’s 5-10. That’s why libinput
includes vendor-specific quirks handling in <code>/usr/share/libinput/</code>
along with the help of hwdb, which we’ve seen earlier, that has
<code>/usr/lib/udev/hwdb.d/60-evdev.hwdb</code>.</p>

<p>For example:</p>

<figure><pre><code data-lang="shell"><span>[</span>Aiptek 8000U pressure threshold]
<span>MatchUdevType</span><span>=</span>tablet
<span>MatchBus</span><span>=</span>usb
<span>MatchVendor</span><span>=</span>0x08CA
<span>MatchProduct</span><span>=</span>0x0010
<span>AttrPressureRange</span><span>=</span>70:50</code></pre></figure>

<p>This says that when a udev event is a usb tablet from a specific vendor,
that the pressure range should be change to <code>70:50</code>.</p>

<figure><pre><code data-lang="shell"><span>[</span>Bluetooth Keyboards]
<span>MatchUdevType</span><span>=</span>keyboard
<span>MatchBus</span><span>=</span>bluetooth
<span>AttrKeyboardIntegration</span><span>=</span>external</code></pre></figure>

<p>And this says that when a keyboard’s bus is over Bluetooth, it should
add the libinput attribute to say it’s an external keyboard.</p>

<p>The <code>60-evdev.hwdb</code> is mostly for touchpad’s axis, the device properties
set will look like this:</p>

<figure><pre><code data-lang="shell">EVDEV_ABS_&lt;axis&gt;<span>=</span>&lt;min&gt;:&lt;max&gt;:&lt;res&gt;:&lt;fuzz&gt;:&lt;flat&gt;
<span># where &lt;axis&gt; is the hexadecimal EV_ABS code as listed in linux/input.h and</span>
<span># min, max, res, fuzz, flat are the decimal values to the respective fields of</span>
<span># the struct input_absinfo as listed in linux/input.h. If a field is missing</span>
<span># the field will be left as-is. Not all fields need to be present. e.g. ::45</span>
<span># sets the resolution to 45 units/mm.</span>
<span># resolution: it is given in units per millimeter and thus tells us the</span>
<span># size of the device. in the above case: (5112 - 1024)/42 means the device</span>
<span># is 97mm wide. The resolution is quite commonly wrong, a lot of axis</span>
<span># overrides need the resolution changed to the correct value.</span></code></pre></figure>

<p>Furthermore, apart from quirks, there are hardware physical issues,
such as the fact that some touchpads send out events before the finger
even touches them, or how to handle the difference in pressure on them,
or what to do to track different fingers on multitouch (MT) hardware
which requires handling evdev tracking ID and slots.</p>

<p>Here’s a two-fingers scroll example, see how complex that is:</p>

<div><pre><code>E: 0.000001 0003 0039 0557 # EV_ABS / ABS_MT_TRACKING_ID   557
E: 0.000001 0003 0035 2589 # EV_ABS / ABS_MT_POSITION_X    2589
E: 0.000001 0003 0036 3363 # EV_ABS / ABS_MT_POSITION_Y    3363
E: 0.000001 0003 003a 0048 # EV_ABS / ABS_MT_PRESSURE      48
E: 0.000001 0003 002f 0001 # EV_ABS / ABS_MT_SLOT          1
E: 0.000001 0003 0039 0558 # EV_ABS / ABS_MT_TRACKING_ID   558
E: 0.000001 0003 0035 3512 # EV_ABS / ABS_MT_POSITION_X    3512
E: 0.000001 0003 0036 3028 # EV_ABS / ABS_MT_POSITION_Y    3028
E: 0.000001 0003 003a 0044 # EV_ABS / ABS_MT_PRESSURE      44
E: 0.000001 0001 014a 0001 # EV_KEY / BTN_TOUCH            1
E: 0.000001 0003 0000 2589 # EV_ABS / ABS_X                2589
E: 0.000001 0003 0001 3363 # EV_ABS / ABS_Y                3363
E: 0.000001 0003 0018 0048 # EV_ABS / ABS_PRESSURE         48
E: 0.000001 0001 014d 0001 # EV_KEY / BTN_TOOL_DOUBLETAP   1
E: 0.000001 0000 0000 0000 # ------------ SYN_REPORT (0) ---------- +0ms
E: 0.027960 0003 002f 0000 # EV_ABS / ABS_MT_SLOT          0
E: 0.027960 0003 0035 2590 # EV_ABS / ABS_MT_POSITION_X    2590
E: 0.027960 0003 0036 3395 # EV_ABS / ABS_MT_POSITION_Y    3395
E: 0.027960 0003 003a 0046 # EV_ABS / ABS_MT_PRESSURE      46
E: 0.027960 0003 002f 0001 # EV_ABS / ABS_MT_SLOT          1
E: 0.027960 0003 0035 3511 # EV_ABS / ABS_MT_POSITION_X    3511
E: 0.027960 0003 0036 3052 # EV_ABS / ABS_MT_POSITION_Y    3052
E: 0.027960 0003 0000 2590 # EV_ABS / ABS_X                2590
E: 0.027960 0003 0001 3395 # EV_ABS / ABS_Y                3395
E: 0.027960 0003 0018 0046 # EV_ABS / ABS_PRESSURE         46
E: 0.027960 0000 0000 0000 # ------------ SYN_REPORT (0) ---------- +27ms
E: 0.051720 0003 002f 0000 # EV_ABS / ABS_MT_SLOT          0
E: 0.051720 0003 0035 2609 # EV_ABS / ABS_MT_POSITION_X    2609
E: 0.051720 0003 0036 3447 # EV_ABS / ABS_MT_POSITION_Y    3447
E: 0.051720 0003 002f 0001 # EV_ABS / ABS_MT_SLOT          1
E: 0.051720 0003 0036 3080 # EV_ABS / ABS_MT_POSITION_Y    3080
E: 0.051720 0003 0000 2609 # EV_ABS / ABS_X                2609
E: 0.051720 0003 0001 3447 # EV_ABS / ABS_Y                3447
E: 0.051720 0000 0000 0000 # ------------ SYN_REPORT (0) ---------- +24ms
[...]
E: 0.272034 0003 002f 0000 # EV_ABS / ABS_MT_SLOT          0
E: 0.272034 0003 0039 -001 # EV_ABS / ABS_MT_TRACKING_ID   -1
E: 0.272034 0003 002f 0001 # EV_ABS / ABS_MT_SLOT          1
E: 0.272034 0003 0039 -001 # EV_ABS / ABS_MT_TRACKING_ID   -1
E: 0.272034 0001 014a 0000 # EV_KEY / BTN_TOUCH            0
E: 0.272034 0003 0018 0000 # EV_ABS / ABS_PRESSURE         0
E: 0.272034 0001 014d 0000 # EV_KEY / BTN_TOOL_DOUBLETAP   0
E: 0.272034 0000 0000 0000 # ------------ SYN_REPORT (0) ---------- +30ms
</code></pre></div>

<p>Additionally, you also have misbehaving keyboards, with bad
firmware, buttons that are old, that get stuck, or send the same
events multiple time (so-called contact bouncing or chatter). We
need a mechanism to decide whether the event is valid or not, that’s
called hardware debouncing, and libinput does it out-of-the-box for us
(<a href="https://wayland.freedesktop.org/libinput/doc/latest/button-debouncing.html">see</a>),
which is truly impressive. This feature, with the help of the upper stack,
may also help people that have certain disabilities with involuntary
muscle movement.</p>

<p>So, for many reasons, libinput is indispensable!<br>
We’ve already covered some of its features, let’s see more.</p>

<p>One of the interesting part of libinput is that it’s minimal in how
it decides to access external things. As we said, you can either opt
for events coming from udev, or manually pass them by path, both will
create libinput internal objects (pointer, keyboard, etc..). Furthermore,
libinput has no configuration files, it’s up to the caller to decide
how to configure each device, as we’ll see Wayland compositors and X11
have different ways. Similarly, it leaves the opening of evdev character
devices up to the caller implementation, usually either manually opening
it, which requires root privileges, or via <code>systemd-logind</code> or <code>seatd</code>, dbus
services which will automatically pass back the file descriptors of evdev
devices associated with the current “seat”.</p>

<p>A seat is a collection of input devices associated with a user
session. That seems redundant, since most machines have only one seat,
yet it only truly makes sense in multi-seat machines: one machine,
multiple input devices, with multiple users. Still, it takes this
particular use-case in consideration.</p>

<figure><pre><code data-lang="shell"><span>&gt;</span> libinput list-devices.
…
Device:           SEMICO USB Keyboard
Kernel:           /dev/input/event5
Id:               usb:1a2c:6004
Group:            6
Seat:             seat0, default
Capabilities:     keyboard 
…


<span>&gt;</span> loginctl seat status <span># will list all input in the hierarchy</span></code></pre></figure>

<p>As you would’ve guessed, the safest and most favored way to get access
to evdev event file descriptors is through the delegation that <code>systemd-logind</code>
provides. This is done in the code by implementing <code>open_restricted</code>
to call the dbus service.<br>
The seat is assigned with the <code>ENV{ID_SEAT}</code> udev property, which can be
controlled with the <code>loginctl</code> command. To permanently attach a device
to a seat.</p>

<div><pre><code>&gt; loginctl attach 'seat0' /sys/devices/…/input/input174
</code></pre></div>

<p>Then checking the device properties in udev:</p>

<figure><pre><code data-lang="shell">E: <span>ID_FOR_SEAT</span><span>=</span>input-pci-0000_00_12_0-usb-0_1_1_0
E: <span>ID_SEAT</span><span>=</span>seat0
E: <span>TAGS</span><span>=</span>:seat:seat0:
E: <span>CURRENT_TAGS</span><span>=</span>:seat:seat0:</code></pre></figure>

<p>There are alternatives to <code>logind</code> such as <code>elogind</code> and
<a href="https://sr.ht/~kennylevinsen/seatd/"><code>seatd</code></a> that don’t depend on
systemd.</p>

<p>Another detail is that we’ve seen that the same physical device can
appear as multiple input devices on the system. With the help of udev,
libinput gets the device property <code>LIBINPUT_DEVICE_GROUP</code> to group them,
like that we can have the whole group under a single seat, which is more
logical than giving access to only part of a physical hardware.</p>

<p>From <code>udevadm info</code>:</p>

<figure><pre><code data-lang="shell">E: <span>ID_PATH_TAG</span><span>=</span>pci-0000_00_12_0-usb-0_1_1_1
E: <span>ID_SEAT</span><span>=</span>seat0
E: <span>LIBINPUT_DEVICE_GROUP</span><span>=</span>3/1a2c/6004:usb-0000:00:12.0-1</code></pre></figure>

<p>And from <code>libinput list-devices</code>, look at the <code>Group</code> part:</p>

<div><pre><code>Device:           SEMICO USB Keyboard
Kernel:           /dev/input/event5
Id:               usb:1a2c:6004
Group:            6
Seat:             seat0, default
Capabilities:     keyboard 
…
Device:           SEMICO USB Keyboard Consumer Control
Kernel:           /dev/input/event6
Id:               usb:1a2c:6004
Group:            6
Seat:             seat0, default
Capabilities:     keyboard pointer 
…
Device:           SEMICO USB Keyboard System Control
Kernel:           /dev/input/event7
Id:               usb:1a2c:6004
Group:            6
Seat:             seat0, default
Capabilities:     keyboard 
</code></pre></div>

<p>You can get more info on this by checking the related udev rule in
<code>80-libinput-device-groups.rules</code>, which calls the built-in program
<code>libinput-device-group</code> with the sysfs mount point. The <code>IMPORT{program}</code>
basically uses a program right within <code>/usr/lib/udev/</code> directory.</p>

<figure><pre><code data-lang="shell"><span>&gt;</span> /usr/lib/udev/libinput-device-group /sys/class/input/input191
<span>LIBINPUT_DEVICE_GROUP</span><span>=</span>3/1a2c/6004:usb-0000:00:12.0-1</code></pre></figure>

<p>As far as the technical features are concerned, there are the ones which
we listed earlier, so let’s explain the rest of them.</p>

<p>It offers full clickpad management. A clickpad (<code>INPUT_PROP_BUTTONPAD</code>)
is basically a touchpad with a single button, which we might not notice at
first because depending on where we press in the “software button area”
at the bottom, we have different behavior. That’s exactly the behavior
that libinput facilitates. It also handles what happens when a finger
enters or exits that area, these sort of edge cases.</p>

<p>Furthermore, libinput handles tap to click, be it one-finger tap for
left click, two-fingers for right click, and three-fingers tap for
middle click. While that seems simple in theory, libinput has to draw
the line between what is considered a tap and what is considered a finger
drag/move; indeed, our fingers aren’t very stable in the real world.<br>
Unfortunately, by default libinput disables tapping when there are other
methods to trigger button clicks, but it can always be enabled again.</p>

<p>When talking about multiple fingers, the hardware needs to support
it obviously, but also libinput needs to track each one individually,
which is done via evdev tracking ID and slots, what we call multi-touch
handling or MT.<br>
Within multi-touch we have the concept of “gestures” and libinput supports
two standard ones: swiping, fingers going in the same direction, and
pinching when fingers move apart or towards each others.</p>

<p>Similarly, there’s also different scrolling use-cases that are supported
by libinput: two-fingers scrolling, similar to a swipe, edge scrolling,
when there’s a specific area on the trackpad used for scrolling, and
on-button scrolling, which scrolls while having a button pressed just by
moving the finger.<br>
The scrolling can either be horizontal or vertical. The user also has
a choice between natural scrolling an traditional scrolling; natural
scrolling matches the motion of the scroll like a phone, and traditional
scrolling matches the scroll bar directin so going downward will move
the page downward.<br>
One thing libinput doesn’t provide when it comes to scrolling is kinetic
scrolling. Basically, scrolling that is faster or slower depending on
the speed. However, it allows widget libraries to implement it by relying
on the <code>libinput_event_pointer_get_axis_source()</code> function.</p>

<p>With all these, libinput offers palm and thumb detection to disable
the clickpad/touchpad when typing, or ignore a thumb in the corner or
accidental touches while other fingers are moving. It achieves this by
detecting the different pressure, speed, or touch sizes reported by evdev,
along with where they are happening (exclusion zones).<br>
It’s also possible to automatically disable the touchpad when typing,
or when the lid is closed.</p>

<p>Lastly, libinput has lua plugins in <code>/usr/lib/libinput/plugins/</code> and
<code>/etc/libinput/plugins</code>. As with other quirk fixing mechanisms in
udev and the quirk directory, the plugins are there for the last few
unfixable issues. They can be used to override evdev events.</p>

<figure><pre><code data-lang="lua"><span>libinput</span><span>:</span><span>register</span><span>(</span><span>1</span><span>)</span> <span>-- register plugin version 1</span>
<span>libinput</span><span>:</span><span>connect</span><span>(</span><span>"new-evdev-device"</span><span>,</span> <span>function</span> <span>(</span><span>_</span><span>,</span> <span>device</span><span>)</span>
    <span>if</span> <span>device</span><span>:</span><span>vid</span><span>()</span> <span>==</span> <span>0x046D</span> <span>and</span> <span>device</span><span>:</span><span>pid</span><span>()</span> <span>==</span> <span>0xC548</span> <span>then</span>
        <span>device</span><span>:</span><span>connect</span><span>(</span><span>"evdev-frame"</span><span>,</span> <span>function</span> <span>(</span><span>_</span><span>,</span> <span>frame</span><span>)</span>
            <span>for</span> <span>_</span><span>,</span> <span>event</span> <span>in</span> <span>ipairs</span><span>(</span><span>frame</span><span>.</span><span>events</span><span>)</span> <span>do</span>
                <span>if</span> <span>event</span><span>.</span><span>type</span> <span>==</span> <span>evdev</span><span>.</span><span>EV_REL</span> <span>and</span> 
                   <span>(</span><span>event</span><span>.</span><span>code</span> <span>==</span> <span>evdev</span><span>.</span><span>REL_HWHEEL</span> <span>or</span> 
                    <span>event</span><span>.</span><span>code</span> <span>==</span> <span>evdev</span><span>.</span><span>REL_HWHEEL_HI_RES</span><span>)</span> <span>then</span>
                    <span>event</span><span>.</span><span>value</span> <span>=</span> <span>-</span><span>event</span><span>.</span><span>value</span>
                <span>end</span>
            <span>end</span>
            <span>return</span> <span>frame</span>
        <span>end</span><span>)</span>
    <span>end</span>
<span>end</span><span>)</span></code></pre></figure>

<p>For example, the above script will reverse the horizontal scroll wheel
(<code>EV_REL.REL_HWHEEL</code>) event value for a certain device vendor and
product ID.</p>

<p>We’ve covered most of the libinput features, now let’s see how to debug
and interface with it.</p>

<p>The main command line interface is <code>libinput</code>, as we’ve seen it can allow
to <code>list-devices</code>, which is a quick summary of the devices it knows about
and on which seat they are connected. Yet most other commands are there
for debugging and testing.</p>

<ul>
  <li><code>libinput debug-gui</code>: is a graphical tool mostly to debug touchpad</li>
  <li><code>libinput debug-events</code>: is a cli tool to debug all events as they are
interpreted by libinput, if you want it’s similar to <code>evtest</code> or <code>xev</code>
in Xorg</li>
  <li><code>libinput record</code> and <code>libinput replay</code>: Used to save and then simulate
again devices. This is amazing if you have a bug and want others to be
able to replicate it on their machines. This is similar to how
<code>hid-tools</code> work.</li>
  <li><code>libinput measure</code>: mostly used for touchpad, to measure things such
as pressure, touch size, tap to click time, etc..</li>
</ul>

<p>The other way to interface with libinput is programmatically. Here’s
the most simple complete example I could come up with:</p>

<figure><pre><code data-lang="c"><span>#include</span> <span>&lt;libinput.h&gt;</span><span>
#include</span> <span>&lt;libudev.h&gt;</span><span>
#include</span> <span>&lt;fcntl.h&gt;</span><span>
#include</span> <span>&lt;unistd.h&gt;</span><span>
#include</span> <span>&lt;stdio.h&gt;</span><span>
#include</span> <span>&lt;errno.h&gt;</span><span>
#include</span> <span>&lt;string.h&gt;</span><span>
</span>

<span>static</span> <span>int</span> <span>open_restricted</span><span>(</span><span>const</span> <span>char</span> <span>*</span><span>path</span><span>,</span> <span>int</span> <span>flags</span><span>,</span> <span>void</span> <span>*</span><span>user_data</span><span>)</span> <span>{</span>
	<span>int</span> <span>fd</span> <span>=</span> <span>open</span><span>(</span><span>path</span><span>,</span> <span>flags</span><span>);</span>
	<span>if</span> <span>(</span><span>fd</span> <span>&lt;</span> <span>0</span><span>)</span>
		<span>fprintf</span><span>(</span><span>stderr</span><span>,</span> <span>"Failed to open %s (%s)</span><span>\n</span><span>"</span><span>,</span> <span>path</span><span>,</span> <span>strerror</span><span>(</span><span>errno</span><span>));</span>
	<span>return</span> <span>fd</span><span>;</span>
<span>}</span>

<span>static</span> <span>void</span> <span>close_restricted</span><span>(</span><span>int</span> <span>fd</span><span>,</span> <span>void</span> <span>*</span><span>user_data</span><span>)</span> <span>{</span>
	<span>close</span><span>(</span><span>fd</span><span>);</span>
<span>}</span>

<span>static</span> <span>const</span> <span>struct</span> <span>libinput_interface</span> <span>interface</span> <span>=</span> <span>{</span>
	<span>.</span><span>open_restricted</span> <span>=</span> <span>open_restricted</span><span>,</span>
	<span>.</span><span>close_restricted</span> <span>=</span> <span>close_restricted</span><span>,</span>
<span>};</span>

<span>int</span> <span>main</span><span>(</span><span>void</span><span>)</span> <span>{</span>
    <span>struct</span> <span>udev</span> <span>*</span><span>udev</span> <span>=</span> <span>udev_new</span><span>();</span>
    <span>if</span> <span>(</span><span>!</span><span>udev</span><span>)</span> <span>{</span>
        <span>fprintf</span><span>(</span><span>stderr</span><span>,</span> <span>"Failed to create udev</span><span>\n</span><span>"</span><span>);</span>
        <span>return</span> <span>1</span><span>;</span>
    <span>}</span>

    <span>struct</span> <span>libinput</span> <span>*</span><span>li</span> <span>=</span> <span>libinput_udev_create_context</span><span>(</span><span>&amp;</span><span>interface</span><span>,</span> <span>NULL</span><span>,</span> <span>udev</span><span>);</span>
    <span>if</span> <span>(</span><span>!</span><span>li</span><span>)</span> <span>{</span>
        <span>fprintf</span><span>(</span><span>stderr</span><span>,</span> <span>"Failed to create libinput context</span><span>\n</span><span>"</span><span>);</span>
        <span>return</span> <span>1</span><span>;</span>
    <span>}</span>

    <span>if</span> <span>(</span><span>libinput_udev_assign_seat</span><span>(</span><span>li</span><span>,</span> <span>"seat0"</span><span>)</span> <span>!=</span> <span>0</span><span>)</span> <span>{</span>
        <span>fprintf</span><span>(</span><span>stderr</span><span>,</span> <span>"Failed to assign seat</span><span>\n</span><span>"</span><span>);</span>
        <span>return</span> <span>1</span><span>;</span>
    <span>}</span>

    <span>struct</span> <span>libinput_event</span> <span>*</span><span>event</span><span>;</span>
    <span>while</span> <span>(</span><span>1</span><span>)</span> <span>{</span>
        <span>libinput_dispatch</span><span>(</span><span>li</span><span>);</span>
        <span>event</span> <span>=</span> <span>libinput_get_event</span><span>(</span><span>li</span><span>);</span>
        <span>if</span> <span>(</span><span>!</span><span>event</span><span>)</span> <span>{</span>
            <span>usleep</span><span>(</span><span>10000</span><span>);</span>
            <span>continue</span><span>;</span>
        <span>}</span>

        <span>if</span> <span>(</span><span>libinput_event_get_type</span><span>(</span><span>event</span><span>)</span> <span>==</span> <span>LIBINPUT_EVENT_KEYBOARD_KEY</span><span>)</span> <span>{</span>
            <span>struct</span> <span>libinput_event_keyboard</span> <span>*</span><span>k</span> <span>=</span> <span>libinput_event_get_keyboard_event</span><span>(</span><span>event</span><span>);</span>
            <span>uint32_t</span> <span>key</span> <span>=</span> <span>libinput_event_keyboard_get_key</span><span>(</span><span>k</span><span>);</span>
            <span>enum</span> <span>libinput_key_state</span> <span>state</span> <span>=</span> <span>libinput_event_keyboard_get_key_state</span><span>(</span><span>k</span><span>);</span>

            <span>printf</span><span>(</span><span>"Key %u is %s</span><span>\n</span><span>"</span><span>,</span>
                   <span>key</span><span>,</span>
                   <span>state</span> <span>==</span> <span>LIBINPUT_KEY_STATE_PRESSED</span> <span>?</span> <span>"PRESSED"</span> <span>:</span> <span>"RELEASED"</span><span>);</span>
        <span>}</span>

        <span>libinput_event_destroy</span><span>(</span><span>event</span><span>);</span>
    <span>}</span>

    <span>libinput_unref</span><span>(</span><span>li</span><span>);</span>
    <span>udev_unref</span><span>(</span><span>udev</span><span>);</span>
    <span>return</span> <span>0</span><span>;</span>
<span>}</span></code></pre></figure>

<p>And to compile it:</p>

<figure><pre><code data-lang="shell">gcc <span>-o</span> key_state key_state.c <span>$(</span>pkg-config <span>--cflags</span> <span>--libs</span> libinput libudev<span>)</span></code></pre></figure>

<p>But what about configuring devices, setting up things that we want to
setup per device. Well, as we’ve said this is done in the upper stack
since libinput has no configuration files, and we’ll cover this later. For
now let’s just list a few of the things that can actually be configured.</p>

<ul>
  <li>tap-to-click related, such as how many fingers are supported</li>
  <li>three-finger drag</li>
  <li>pointer acceleration profiles</li>
  <li>scrolling method natural vs traditional</li>
  <li>left-hand mode</li>
  <li>middle button emulation</li>
  <li>click method</li>
  <li>disable while typing (DWT)</li>
  <li>disable while trackpointing (DWTP)</li>
  <li>direct-input device calibration</li>
  <li>rotation confs (if touchpad is sideways)</li>
  <li>area confs</li>
</ul>

<p>You can glimpse at these on X11 with the command <code>xinput --list-props &lt;device_id&gt;</code>
or at <code>libinput list-devices</code> which we’ve seen earlier that
should show the conf per-device:</p>

<div><pre><code>Device:                  SYNA801A:00 06CB:CEC6 Touchpad
…
Group:                   1
Seat:                    seat0, default
Size:                    122x69mm
Capabilities:            pointer gesture
Tap-to-click:            disabled
Tap-and-drag:            enabled
Tap button map:          left/right/middle
Tap drag lock:           disabled
Left-handed:             disabled
Nat.scrolling:           disabled
Middle emulation:        disabled
Calibration:             n/a
Scroll methods:          *two-finger edge
Scroll button:           n/a
Scroll button lock:      n/a
Click methods:           *button-areas clickfinger
Clickfinger button map:  left/right/middle
Disable-w-typing:        enabled
Disable-w-trackpointing: enabled
Accel profiles:          flat *adaptive custom
Rotation:                n/a
Area rectangle:          n/a

// or another touchpad
Device:                  ETPS/2 Elantech Touchpad
…
Seat:                    seat0, default
Size:                    102x74mm
Capabilities:            pointer gesture
Tap-to-click:            disabled
Tap-and-drag:            enabled
Tap button map:          left/right/middle
Tap drag lock:           disabled
Left-handed:             disabled
Nat.scrolling:           disabled
Middle emulation:        disabled
Calibration:             n/a
Scroll methods:          *two-finger edge 
Scroll button:           n/a
Scroll button lock:      n/a
Click methods:           *button-areas clickfinger 
Clickfinger button map:  left/right/middle
Disable-w-typing:        enabled
Disable-w-trackpointing: enabled
Accel profiles:          flat *adaptive custom
Rotation:                n/a
Area rectangle:          n/a
</code></pre></div>

<p>That’s about it when it comes to libinput. Now we can move to more
specific things in the upper stack.</p>

<h2 id="keyboard-specifics">Keyboard Specifics</h2>

<p>We’re pretty much done with the lower part of the user-space stack, but
before moving on to the graphical library widgets and desktop environments,
let’s take some time to see some of the specific device handling that
are good to know about, namely keyboards, mice, and gamepads.<br>
In this section we’ll see three important concepts related to keyboards:
scancodes to keycodes, console keyboard handling, and XKB.</p>

<h2 id="scancodes-to-keycodes">Scancodes to Keycodes</h2>

<p>Like other input drivers, the role of keyboard drivers is to translate
from raw hardware keys to events that can be normalized and interpreted by
user-space. We call the raw keys scancodes, and the events ones keycodes
(<code>/usr/include/linux/input-event-codes.h</code>). Keycodes are also mapped
to key symbols in user-space unrelated to their actual keycodes, which we
call keysyms.<br>
For example, a scancode can look like a random hex <code>0x1E</code>, a kernel-mapped
event as <code>KEY_A</code>, and a keysym will look like a symbol such as “a” or “A”.</p>

<p>We’ll talk more about keysyms mapping when we see XKB. But let’s focus
on the scancodes to keycode translation for now.</p>

<p>When a keyboard input device registers itself in the input core
(<code>input_register_device</code>) it has to report which keycodes it supports
in its capabilities (<code>keybit</code> capability). In general it has to set its
<code>keycode</code>, <code>keycodemax</code>, and <code>keycodesize</code> fields, which are a map of
the translation of scancodes to keycodes.<br>
These keymaps can either be full fledge dense keymap or sparse keymap,
which means they’re smaller and use less memory. The sparse keys are
mostly used when registering a few entries such as special keys that
don’t need huge arrays.</p>

<p>If a scancode isn’t found in these translation arrays, they’re often
either completely ignored, or the driver returns that it’s an unknown key.</p>

<p>Keyboard input devices can also optionally implement two important
functions: <code>getkeycode</code> and <code>setkeycode</code>, which will by default retrieve
the current keymap and alter the current keymap respectively. Most drivers
fallback to the default mechanism, so this can be taken for granted.</p>

<p>Importantly, the <code>evdev</code> and <code>kbd</code> (console) handlers offer ways to call
these via ioctl interfaces, which will be propagated to the devices
they’re currently handling. For <code>evdev</code> it’s through <code>EVIOCGKEYCODE</code> and
<code>EVIOCSKEYCODE</code>, to get and set keycodes respectively. For the console
handler it’s through <code>KDGETKEYCODE</code> and <code>KDSETKEYCODE</code>. The exception
is that the console driver will propagate it to all handlers, and thus
indirectly to all devices on the platform.</p>

<p>You can also do the runtime patching of scancode to keycode
mapping through udev and hwdb by setting a device property in
<code>ENV{KEYBOARD_KEY_&lt;hex scan code&gt;}=&lt;key code identifier&gt;</code> which will in
turn be caught by <code>systemd/src/udev/udev-builtin-keyboard.c</code> and also
call the same ioctl interfaces.</p>

<p>For example:</p>

<div><pre><code>ENV{KEYBOARD_KEY_b4}=dollar
</code></pre></div>

<p>To find out the actual scancodes the device is generating the <code>showkey(1)</code>
tool from the Linux Keyboard tools project, with the <code>--scancodes</code> flag,
will attach to the console handler and display them in raw mode. And the
<code>setkeycodes(8)</code> command from the same project will propagate it to the
driver via the console input handler.</p>

<p>There are multiple other tools used to do the keycode remapping such
as <code>evmapd</code>, <code>evremap</code>, <code>evdevremapkeys</code>, but these work at the evdev
layer and don’t know about scancodes. So for now, the simplest one to
do scancode to keycode mapping is obviously the built-in one: hwdb.</p>

<p>This mechanism for runtime modifications might save us time instead of
getting our hands dirty and having to modify kernel drivers.</p>

<h2 id="console-keyboard">Console Keyboard</h2>

<p>We’ve discussed the <code>evdev</code> handler extensively, however in the console
it’s the <code>kbd</code> input event handler (<code>drivers/tty/vt/keyboard.c</code>) that is
used, and it’s working in sync with the tty and line discipline mechanism.<br>
This particular handler exposes its devices as TTYs in the infamous
<code>/dev/ttyN</code> and <code>/dev/console</code> (system) and handles all the messiness
of console text-mode input.</p>

<p>The input handlers coexist. When switching from graphical environment
to console, the VT <code>kbd</code> handler takes over.</p>

<p><img src="https://venam.net/blog/assets/input_devices_linux/console.png" alt="Console Overview" title="Console Overview"></p>

<p>Obviously, as a console input handler, the <code>kbd</code> handler has much more
work to do, and it has a lot of special handling via ioctl too. From
bell and tone, leds, setting console key rate, modifiers, interpreting
special keys that have meanings for the TTY, switching to other modes
such as raw input mode or graphic (X11, Wayland session), all the push
towards line discipline, etc.. It’s handling things that are often
handled in user-space (key rate is handled in the graphical stack too
as we’ll see). The reason: historical entangling, the console existed
before the graphical stack.</p>

<p>For instance, <code>showkey(1)</code> which we’ve just seen, relies on changing the
mode of the terminal via ioctl <code>KDSKBMODE</code> to <code>K_RAW</code>.<br>
There are a bunch of commands to interface with the ioctl such as
<code>kbdrate(8)</code> to set the keyboard rate, <code>kbdinfo(1)</code> to get more info
about the kbd driver, and <code>kbd_mode(1)</code> to get the current keyboard mode
(raw, xlate, etc..)</p>

<div><pre><code>[Keyboard hardware]
   ↓
[input driver: atkbd, hid-input]
   ↓
[input core]
   ↓
[keyboard.c handler (kbd_event)]
   ↓
[TTY layer (virtual console, ttyN)]
   ↓
[N_TTY line discipline]
   ↓
[read() by shell, echo, canonical editing, etc.]
</code></pre></div>

<p>Furthermore, since it’s taking a bigger role on handling scancode to
keycode, it also somewhat does keycode interpretation via its internal
keymap. That means, the <code>kbd</code> handler can be responsible of handling the
difference in regional keyboard layouts and special keys. This is
something which usually happens in XKB, in user-space, which we’ll see
in the next section.</p>

<p>Thus it has two sets of ioctl: <code>KDSETKEYCODE</code> and <code>KDGETKEYCODE</code> for
low-level scancodes to keycodes, and <code>KDGKBENT</code> and <code>KDSKBENT</code> for the
keycode to symbol/action mapping (internally also confusingly called
<code>key_maps</code>, as you’ll see everyone uses the word “keymap”).</p>

<p>The format of the keymaps translating keycode to symbol (<code>keymaps(5)</code>)
is managed by the kernel for each console, but usually more
easily set with user-space tools also from the <a href="https://kbd-project.org/">Linux keyboard
tools</a> project. For example <code>loadkeys(1)</code> and
<code>dumpkeys(1)</code>. These can rely on files in <code>/usr/share/kbd/keymaps/</code>
for a predefined set of keymaps. Let’s also mention that the default
one is found in <code>/usr/src/linux/drivers/tty/vt/defkeymap.map</code>.</p>

<p>Before we end, let’s mention <code>systemd-localed.service(8)</code> and its
<code>localectl(1)</code> command. It is used to set the keyboard map for
both the console and the graphical environment (XKB in X11 as we’ll see)
based on the current locale. For example, it sets the keymap,
font, and others, of the console and X11 XKB to the value found in
<code>/etc/vconsole.conf</code> (see <code>vconsole.conf(5)</code>) through its service called
<code>systemd-vconsole-setup(8)</code>, which is also called when the console is
initialized with udev. It can also help in setting the same values in
both the console and graphical stack.</p>

<p>Here’s <code>vconsole.conf</code>:</p>

<figure><pre><code data-lang="shell"><span>KEYMAP</span><span>=</span>us
<span>XKBLAYOUT</span><span>=</span>us</code></pre></figure>

<div><pre><code>&gt; localectl
System Locale: LANG=en_US.UTF-8
    VC Keymap: us
   X11 Layout: us
</code></pre></div>

<p><em>NB: Terminal emulators don’t rely on the console input handler at all,
they use pseudo-terminals instead (PTYs). These don’t have VGA console,
nor plug to the kbd handler, nor screen, etc.. They are fed entirely by
user-space programs.</em><br>
Example:</p>

<div><pre><code>Line discipline &lt;-&gt; TTY driver (PTY slave side) &lt;-&gt; user process
 `-&gt; PTY master side &lt;-&gt; xterm process
</code></pre></div>

<p>See <a href="https://venam.net/blog/unix/2017/06/04/terminals.html#generic-arch">this old article</a>
for more details on that.</p>

<div><pre><code>&gt; cat /proc/consoles
tty0                 -WU (EC  p  )    4:2

&gt; cat /proc/tty/drivers

/proc/tty/drivers
/dev/tty             /dev/tty        5       0 system:/dev/tty
/dev/console         /dev/console    5       1 system:console
/dev/ptmx            /dev/ptmx       5       2 system
/dev/vc/0            /dev/vc/0       4       0 system:vtmaster
serial               /dev/ttyS       4 64-95 serial
pty_slave            /dev/pts      136 0-1048575 pty:slave
pty_master           /dev/ptm      128 0-1048575 pty:master
unknown              /dev/tty        4 1-63 console
</code></pre></div>

<p>Now let’s see how the keycode to keysym is done in user-space in the
graphical stack with XKB.</p>

<h2 id="xkb">XKB</h2>

<p>XKB, or X keyboard, is a common library (xkbcommon, xkbregistry,
xkbcompose) with a set of tools, an X11 protocol extension (X
Keyboard Extension), and a database collection of descriptions
(xkeyboard-config). Its role is to handle the keycode to keysym
translation in user-space.<br>
While the name includes “X”, the common library and database are not only
used by Xorg but by most software, including graphical widgets such as
GTK and Qt, and Wayland compositors. We won’t cover the older X protocol
extension here, yet the reason why there’s an “X” in the name is that
it started as an extension and then got separated into a common library.</p>

<p>The two things we’ll focus on are xkbcommon, the xkb core engine that
parse and executes XKB definitions, and the xkeyboard-config, which
is a project compiling a database of keyboard info, layouts, variants,
symbols, and rules. They work together.</p>

<p>As a word of notice, XKB is one of the most complex piece of software I’ve
encountered and its documentation is fiercely lacking and dispersed. It
has its own language, compiler, and the format is extremely convoluted
and inconsistent, often mixing camel case and snake case for no apparent
reasons.<br>
Even in the XKB documentation we find such comments:</p>

<blockquote>
  <p>Todo<br>
   Explain how to configure XKB, with examples</p>
</blockquote>

<blockquote>
  <p>Due to the complexity of the format, this document is still is
construction.</p>
</blockquote>

<p>And internally Xorg devs called it <em>“X Kitten Butcher”</em>.</p>

<p>We’ll try to make it approachable, and break the bad
spell. However, if you ever want more info check <a href="https://xkbcommon.org/doc/current/keymap-text-format-v1-v2.html">the official
format</a>.</p>

<p>In order to perform the translation from keycodes coming from event
handlers to actual symbols, XKB relies on something called an XKB keymap
(yes everything is called a keymap). This XKB keymap is a compilation
of different components coming from the xkeyboard-config database that
are chosen based on the abstract, and more coherent, concept of layout,
variants, models, and options the user pick: <strong>“RMLVO”</strong>.</p>

<p>After this is picked, the XKB client software just has to keep track of
what’s called a state, and then send it along with the received keycode
to receive back the keysym.<br>
A very basic example looks like this:</p>

<figure><pre><code data-lang="c"><span>// create a complete keymap from the xkeyboard-config db</span>
<span>struct</span> <span>xkb_keymap</span> <span>*</span><span>keymap</span><span>;</span>
<span>// .. and a state object to keep track of what special state we're in</span>
<span>//   that could affect the keysym output</span>
<span>struct</span> <span>xkb_state</span> <span>*</span><span>state</span><span>;</span>
<span>…</span>
<span>state</span> <span>=</span> <span>xkb_state_new</span><span>(</span><span>keymap</span><span>);</span>
<span>xkb_state_update_key</span><span>(</span><span>state</span><span>,</span> <span>keycode</span><span>,</span>
    <span>pressed</span> <span>?</span> <span>XKB_KEY_DOWN</span> <span>:</span> <span>XKB_KEY_UP</span><span>);</span>
<span>xkb_keysym_t</span> <span>sym</span> <span>=</span> <span>xkb_state_key_get_one_sym</span><span>(</span><span>state</span><span>,</span> <span>keycode</span><span>);</span></code></pre></figure>

<p>The XKB state object tracks what affects the output of keycode to keysym,
things like modifiers and groups. This example doesn’t mention the idea
of key composing, but we’ll come back to it.</p>

<p>This is important to understand, since you can either have XKB handle
what happens in a specific state when a key is pressed, or do it from
the client side. For example, a client can choose to catch all Ctrl keys
and interpret Ctrl+h as backspace, or leave it up to XKB with a custom
mechanism to know what Ctrl+h means, and the client will receive back
the keysym for backspace directly, with no special handling from its side.<br>
Yet, the downside is that this key combination will apply to everyone
that relies on this XKB keymap.</p>

<p>Before moving forward, we need a little baggage of definitions, and
understanding, otherwise nothing will make sense.</p>

<ul>
  <li>evdev keycodes: the events coming from evdev, the ones listed in
<code>/usr/include/linux/input-event-codes.h</code></li>
  <li>XKB keysyms: Actual symbols (or dead key), actions, and special keys
that XKB will return, they exist in
<code>/usr/include/xkbcommon/xkbcommon-keysyms.h</code></li>
  <li>Modifier Keys: Special keys that can affect other keys such as shift,
alt, ctrl, “win”, etc.. Modifiers are also keysyms.</li>
  <li>Geometry: The physical layout of a keyboard, what it looks like and
where the keys are</li>
  <li>Levels and Groups: Levels is another state a key could be in when you
press a modifier. For example, it’s expected that pressing shift with
“a” will output “A”, upper case “A” is the level 2 of what happens when
pressing the key. A Group is similar but it completely switches the
whole keyboard to another key mapping, as if you switched variants.</li>
</ul>

<p>As you can imagine, there’s a lot at play with levels, groups, modifiers,
and actions that can happen, and that’s apart from the basic idea of
keycodes to keysym.</p>

<p>Even when it comes to keysym, the translation isn’t straight away. XKB
relies on intermediary objects.<br>
XKB keycodes are not straight up evdev keycodes, but 
<code>evdev keycodes + 8</code>. Why 8, someone might ask. Well, the only answer
is backward compatibility from before evdev was a thing, and it’s
still there.</p>

<p>Furthermore, XKB converts these keycodes into physical key
positions values that are compatible with ISO/IEC 9995-1. So we
move from evdev keycodes, to XKB keycodes, to physical abstract
position on a keyboard layout. This is what happens in the keycode
component files under <code>/usr/share/xkeyboard-config-2/keycodes/</code>. Keycodes
have this form within <code>&lt;...&gt;</code> tags. For example:</p>

<div><pre><code>&lt;TLDE&gt; = 49;
&lt;AE01&gt; = 10;
&lt;AE02&gt; = 11;
&lt;AE03&gt; = 12;
&lt;AE04&gt; = 13;
&lt;AE05&gt; = 14;
&lt;AE06&gt; = 15;
&lt;AE07&gt; = 16;
&lt;AE08&gt; = 17;
&lt;AE09&gt; = 18;
&lt;AE10&gt; = 19;
&lt;AE11&gt; = 20;
&lt;AE12&gt; = 21;
&lt;BKSP&gt; = 22;
</code></pre></div>

<p>Remember “49”, “10”, “11” are equivalent to evdev:</p>

<div><pre><code>#define KEY_GRAVE		41
#define KEY_1			2
#define KEY_2			3
#define KEY_3			4
#define KEY_4			5
#define KEY_5			6
#define KEY_6			7
#define KEY_7			8
#define KEY_8			9
#define KEY_9			10
#define KEY_0			11
#define KEY_MINUS		12
#define KEY_EQUAL		13
#define KEY_BACKSPACE		14
</code></pre></div>

<p>Or basically the first row from ISO/IEC 9995-1 on a keyboard.</p>

<p>To make it easier for users to pick an XKB keymap, without
having to know much details, the idea of picking only RMLVO,
Rules-Model-Layout-Variant-Options, was invented. This is an abstraction
on top to pick the components that make up a keymap, and thus come up with
the right keyboard behavior expected by the user. This is managed by the
XKB registry, which graphical environments interact with, this is what
is shown to the user when they’re asked about picking their keyboard
layout, the list of possible layouts and variants on those layouts,
along with special options.</p>

<ul>
  <li>Model – the name of the model of your keyboard</li>
  <li>Layout – the layout(s) you intend to use (usually refer to country code)</li>
  <li>Variant – the variant(s) of the layout(s) you intend to use (minor
and national variants)</li>
  <li>Options – extra XKB configuration options to customize the standard
layout. For example to change modifier keys.</li>
</ul>

<p>To know what’s actually picked as the final keymap, what’s called KcCGST,
we can run <code>xkbcli</code>. For example, for a dvorak keyboard, or a normal
qwerty keyboard:</p>

<figure><pre><code data-lang="shell"><span>&gt;</span> xkbcli compile-keymap <span>--kccgst</span> <span>\</span>
  <span>--layout</span> us <span>\</span>
  <span>--variant</span> dvorak <span>\</span>
  <span>--options</span> terminate:ctrl_alt_bksp

xkb_keymap <span>{</span>
  xkb_keycodes <span>{</span> include <span>"evdev+aliases(qwerty)"</span> <span>}</span><span>;</span>
  xkb_types <span>{</span> include <span>"complete"</span> <span>}</span><span>;</span>
  xkb_compat <span>{</span> include <span>"complete"</span> <span>}</span><span>;</span>
  xkb_symbols <span>{</span> include <span>"pc+us(dvorak)+inet(evdev)+terminate(ctrl_alt_bksp)"</span> <span>}</span><span>;</span>
  xkb_geometry <span>{</span> include <span>"pc(pc105)"</span> <span>}</span><span>;</span>
<span>}</span><span>;</span>

<span>&gt;</span> xkbcli compile-keymap <span>--kccgst</span> <span>\</span>
  <span>--layout</span> us <span>\</span>
  <span>--variant</span> qwerty <span>\</span>
  <span>--options</span> terminate:ctrl_alt_bksp

xkb_keymap <span>{</span>
  xkb_keycodes <span>{</span> include <span>"evdev+aliases(qwerty)"</span> <span>}</span><span>;</span>
  xkb_types <span>{</span> include <span>"complete"</span> <span>}</span><span>;</span>
  xkb_compat <span>{</span> include <span>"complete"</span> <span>}</span><span>;</span>
  xkb_symbols <span>{</span> include <span>"pc+us(qwerty)+inet(evdev)+terminate(ctrl_alt_bksp)"</span> <span>}</span><span>;</span>
  xkb_geometry <span>{</span> include <span>"pc(pc105)"</span> <span>}</span><span>;</span>
<span>}</span><span>;</span></code></pre></figure>

<p>We’ll revisit the RMLVO, let’s just say it’s all about what the “rule”
part refers to: a lookup table with rules mapping the abstract names to
the components of the keymaps which are called KcCGST.</p>

<p>To find your layout and visualize it you can check the <a href="https://xkeyboard-config.freedesktop.org/layouts/gallery/#?model=iso-60&amp;language=tao">gallery here</a> and the <a href="https://xkeyboard-config.freedesktop.org/layouts/analyzer/#?model=iso-60&amp;layout=af">analyzer here</a>.</p>

<p>KcCGST, or the Keycodes, Compat, Geometry, Symbols, Types, are the
component parts of an XKB keymap. This is the actual functional XKB
configuration that is used behind the RMLVO easy facade. In general, XKB
considers it an implementation detail and pushes for users to favor
configuring XKB through RMLVO. Yet, it’s the core of XKB!</p>

<p>The resolution of the RMLVO will create a complete keymap, a self-contain
object that has all the related KcCGST components assembled together. This
complete XKB keymap is what is used by the clients.</p>

<p>To get a quick glimpse at what a full resolved keymap looks like, try
this command:</p>

<div><pre><code>&gt; xkbcli compile-keymap --layout us --rules evdev
</code></pre></div>

<p>Or for a more compact one, look again at the command such as the one we
just did before:</p>

<figure><pre><code data-lang="shell"><span>&gt;</span> xkbcli compile-keymap <span>--kccgst</span> <span>--layout</span> us <span>--options</span> terminate:ctrl_alt_bksp
xkb_keymap <span>{</span>
  xkb_keycodes <span>{</span> include <span>"evdev+aliases(qwerty)"</span> <span>}</span><span>;</span>
  xkb_types <span>{</span> include <span>"complete"</span> <span>}</span><span>;</span>
  xkb_compat <span>{</span> include <span>"complete"</span> <span>}</span><span>;</span>
  xkb_symbols <span>{</span> include <span>"pc+us+inet(evdev)+terminate(ctrl_alt_bksp)"</span> <span>}</span><span>;</span>
  xkb_geometry <span>{</span> include <span>"pc(pc105)"</span> <span>}</span><span>;</span>
<span>}</span><span>;</span></code></pre></figure>

<p>Let’s go over these components and explain them.</p>

<p>First of, the KcCGST configurations that come from the keyboard-config
project are often found in the following places in reverse order of
precedence, with the component bundled underneath:</p>

<ul>
  <li><code>/usr/share/X11/xkb</code>, <code>$XKB_CONFIG_ROOT</code>, <code>/usr/share/xkeyboard-config-2/</code></li>
  <li><code>/etc/xkb</code></li>
  <li><code>$XKB_CONFIG_EXTRA_PATH</code></li>
  <li><code>$HOME/.xkb</code></li>
  <li><code>$HOME/.config/xkb</code></li>
</ul>

<p>Most of the components have a useful utility. That’s apart from the
geometry, which is a complex file used to describe what a keyboard
physical layout looks like. It’s not used in the latest xkbcommon
mechanism though, so we’ll skip explaining it.</p>

<p>The XKB configuration format has types: string, numbers, key positions,
and keysym:</p>

<ul>
  <li><code>"hello"</code>, <code>"%S/pc"</code></li>
  <li><code>42</code>, <code>134</code></li>
  <li><code>&lt;AE12&gt;</code>, <code>&lt;BKSP&gt;</code></li>
  <li><code>percent</code>, <code>a</code>, <code>A</code></li>
</ul>

<p>It also has many special keywords, and some structure format. The main
structural format is called a component, basically the components of
the KcCGST. Each XKB conf file is an aggregation of multiple of these
components. They have the form:</p>

<figure><pre><code data-lang="c"><span>&lt;</span><span>generic_flags</span><span>&gt;</span> <span>&lt;</span><span>symbols_flags</span><span>&gt;</span> <span>&lt;</span><span>xkb_componentname</span><span>&gt;</span> <span>"&lt;name&gt;"</span> <span>{</span>

  <span>// body</span>

<span>};</span>

<span>// Example</span>

<span>default</span> <span>partial</span> <span>alphanumeric_keys</span> <span>modifier_keys</span>
<span>xkb_symbols</span> <span>"basic"</span> <span>{</span>
  <span>// body</span>
<span>};</span></code></pre></figure>

<p>The generic flags can be one or many of these:</p>

<ul>
  <li><code>default</code>: One of these “variant” per component file, the default
 values to be used</li>
  <li><code>partial</code>: To be used in another conf</li>
  <li><code>hidden</code>: Only used internally within the file’s scope</li>
</ul>

<p>And the symbols flags can be one or many of these:</p>

<ul>
  <li><code>alphanumeric_keys</code></li>
  <li><code>modifier_keys</code></li>
  <li><code>keypad_keys</code></li>
  <li><code>function_keys</code></li>
  <li><code>alternate_group</code></li>
</ul>

<p>The symbols flags are mostly metadata and don’t affect the XKB processing.
They’re indicators of what the component configuration covers, and if
none are present it’s assumed it covers a complete keyboard.</p>

<p>Let’s start with the most important keywords, the ones used to import
and merge files together, we’ve seen the <code>include</code>. It works by finding
the file of the same component with the specified name, if it exists
in any of the valid conf paths (or if explicitly mentioned with string
substitution shorthands), and then look for the variants inside or the
default value if none are passed: <code>include "file(variant)"</code>.<br>
The <code>include</code> will override any information that already exists:
that is if new values are undefined it will keep the old one, but new
defined values will always override old ones. To avoid this, the <code>augment
"file(variant)"</code> should be used instead, it will update the properties
that are undefined, but keep the defined ones (it’s the reverse). Another
option is the <code>replace "file(variant)"</code> which will, as the name implies,
completely replace the full properties, regardless if some elements are
defined or not.</p>

<p>This “merge resolution” mechanism also applies to values within the
components objects, which can be tagged with <code>augment</code>, <code>override</code>,
<code>replace</code>, too.</p>

<p>As for files, a shorthand exists to have a single statement with multiple
includes concatenated. In this case the following merge mode prefixes
are used:</p>

<ul>
  <li><code>+</code> selects the override merge mode (default).</li>
  <li><code>|</code> selects the augment merge mode.</li>
  <li><code>^</code> selects the replace merge mode.</li>
</ul>

<p>So you can now understand why the following line we’ve seen works, and
how it creates an inheritance mechanism, plugging multiple files together:</p>

<figure><pre><code data-lang="c"><span>xkb_symbols</span> <span>{</span> <span>include</span> <span>"pc+us+inet(evdev)+terminate(ctrl_alt_bksp)"</span> <span>};</span></code></pre></figure>

<p>Let’s now explain what each component does, and wrap up with how the
rules mechanism of the RMLVO then resolves them into an XKB full keymap.</p>

<p>The keycodes file is the most obvious one and the first entry-point
for XKB logic, it translates from XKB keycodes to the physical codes
ISO/IEC 9995-1. The syntax of the components looks something like this:</p>

<figure><pre><code data-lang="c"><span>default</span> <span>xkb_keycodes</span> <span>"mykeycode"</span> <span>{</span>
	<span>// defining the range</span>
	<span>minimum</span> <span>=</span> <span>8</span><span>;</span>
	<span>maximum</span> <span>=</span> <span>255</span><span>;</span>

	<span>// mapping of keycodes to layout keys</span>
	<span>&lt;</span><span>TAB</span><span>&gt;</span> <span>=</span> <span>23</span><span>;</span>
	<span>&lt;</span><span>AD01</span><span>&gt;</span> <span>=</span> <span>24</span><span>;</span>
	<span>&lt;</span><span>AD02</span><span>&gt;</span> <span>=</span> <span>25</span><span>;</span>
	<span>&lt;</span><span>AD03</span><span>&gt;</span> <span>=</span> <span>26</span><span>;</span>
	<span>&lt;</span><span>AD04</span><span>&gt;</span> <span>=</span> <span>27</span><span>;</span>
	<span>&lt;</span><span>AD05</span><span>&gt;</span> <span>=</span> <span>28</span><span>;</span>
	<span>&lt;</span><span>AD06</span><span>&gt;</span> <span>=</span> <span>29</span><span>;</span>
	<span>&lt;</span><span>BKSL</span><span>&gt;</span> <span>=</span> <span>51</span><span>;</span>
	<span>&lt;</span><span>RTRN</span><span>&gt;</span> <span>=</span> <span>36</span><span>;</span>

	<span>// making one physical key name equivalent to another</span>
	<span>alias</span> <span>&lt;</span><span>LatQ</span><span>&gt;</span> <span>=</span> <span>&lt;</span><span>AD01</span><span>&gt;</span><span>;</span>
	<span>alias</span> <span>&lt;</span><span>LatW</span><span>&gt;</span> <span>=</span> <span>&lt;</span><span>AD02</span><span>&gt;</span><span>;</span>
	<span>alias</span> <span>&lt;</span><span>LatE</span><span>&gt;</span> <span>=</span> <span>&lt;</span><span>AD03</span><span>&gt;</span><span>;</span>
	<span>alias</span> <span>&lt;</span><span>LatR</span><span>&gt;</span> <span>=</span> <span>&lt;</span><span>AD04</span><span>&gt;</span><span>;</span>
	<span>alias</span> <span>&lt;</span><span>LatT</span><span>&gt;</span> <span>=</span> <span>&lt;</span><span>AD05</span><span>&gt;</span><span>;</span>
	<span>alias</span> <span>&lt;</span><span>LatY</span><span>&gt;</span> <span>=</span> <span>&lt;</span><span>AD06</span><span>&gt;</span><span>;</span>

	<span>// these are for LEDs, not always used by clients</span>
	<span>indicator</span> <span>1</span>  <span>=</span> <span>"Caps Lock"</span><span>;</span>
	<span>indicator</span> <span>2</span>  <span>=</span> <span>"Num Lock"</span><span>;</span>
	<span>indicator</span> <span>3</span>  <span>=</span> <span>"Scroll Lock"</span><span>;</span>
<span>};</span></code></pre></figure>

<p>The syntax is straight forward, it’s a couple of assignment, with the
possibility to have aliases, and giving names to LEDs, indicators, which
aren’t really leds afaik but keys that lock or latch. By convention it
explicitly names special keys, but other keys as their ISO positions.</p>

<p>Here’s a standard keyboard with its key positions:</p>

<p><img src="https://venam.net/blog/assets/input_devices_linux/xkb_key_layout.png" alt="keypositions" title="XKB key positions layout">
Courtesy from <a href="https://www.charvolant.org/doug/xkb/html/img3.png">https://www.charvolant.org/doug/xkb/html/img3.png</a></p>

<p>Let’s move to the types component. This is where the information about
levels, and how to switch between them is defined.</p>

<figure><pre><code data-lang="c"><span>virtual_modifiers</span>  <span>NumLock</span><span>;</span>

<span>type</span> <span>"ONE_LEVEL"</span> <span>{</span>
	<span>modifiers</span> <span>=</span> <span>None</span><span>;</span>
	<span>map</span><span>[</span><span>None</span><span>]</span> <span>=</span> <span>Level1</span><span>;</span>
	<span>level_name</span><span>[</span><span>Level1</span><span>]</span> <span>=</span> <span>"Any"</span><span>;</span>
<span>};</span>

<span>type</span> <span>"TWO_LEVEL"</span> <span>{</span>
	<span>modifiers</span> <span>=</span> <span>Shift</span><span>;</span>
	<span>map</span><span>[</span><span>Shift</span><span>]</span> <span>=</span> <span>Level2</span><span>;</span>
	<span>level_name</span><span>[</span><span>Level1</span><span>]</span> <span>=</span> <span>"Base"</span><span>;</span>
	<span>level_name</span><span>[</span><span>Level2</span><span>]</span> <span>=</span> <span>"Shift"</span><span>;</span>
<span>};</span>

<span>type</span> <span>"ALPHABETIC"</span> <span>{</span>
	<span>modifiers</span> <span>=</span> <span>Shift</span> <span>+</span> <span>Lock</span><span>;</span>
	<span>map</span><span>[</span><span>Shift</span><span>]</span> <span>=</span> <span>Level2</span><span>;</span>
	<span>map</span><span>[</span><span>Lock</span><span>]</span> <span>=</span> <span>Level2</span><span>;</span>
	<span>level_name</span><span>[</span><span>Level1</span><span>]</span> <span>=</span> <span>"Base"</span><span>;</span>
	<span>level_name</span><span>[</span><span>Level2</span><span>]</span> <span>=</span> <span>"Caps"</span><span>;</span>
<span>};</span>

<span>// override ALPHABETIC Shift will cancel capslock</span>
<span>override</span> <span>type</span> <span>"ALPHABETIC"</span> <span>{</span>
	<span>modifiers</span> <span>=</span> <span>Shift</span> <span>+</span> <span>Lock</span><span>;</span>
	<span>map</span><span>[</span><span>Shift</span><span>]</span> <span>=</span> <span>Level2</span><span>;</span>
	<span>preserve</span><span>[</span><span>Lock</span><span>]</span> <span>=</span> <span>Lock</span><span>;</span>
	<span>level_name</span><span>[</span><span>Level1</span><span>]</span> <span>=</span> <span>"Base"</span><span>;</span>
	<span>level_name</span><span>[</span><span>Level2</span><span>]</span> <span>=</span> <span>"Caps"</span><span>;</span>
<span>};</span>

<span>// override ALPHABETIC, Shift will ignore capslock</span>
<span>override</span> <span>type</span> <span>"ALPHABETIC"</span> <span>{</span>
	<span>modifiers</span> <span>=</span> <span>Shift</span><span>;</span>
	<span>map</span><span>[</span><span>Shift</span><span>]</span> <span>=</span> <span>Level2</span><span>;</span>
	<span>level_name</span><span>[</span><span>Level1</span><span>]</span> <span>=</span> <span>"Base"</span><span>;</span>
	<span>level_name</span><span>[</span><span>Level2</span><span>]</span> <span>=</span> <span>"Caps"</span><span>;</span>
<span>};</span>

<span>// CapsLock acts as Shift with locking, Shift does not cancel CapsLock.</span>
<span>type</span> <span>"ALPHABETIC"</span> <span>{</span>
	<span>modifiers</span> <span>=</span> <span>Shift</span> <span>+</span> <span>Lock</span><span>;</span>
	<span>map</span><span>[</span><span>Shift</span><span>]</span> <span>=</span> <span>Level2</span><span>;</span>
	<span>map</span><span>[</span><span>Lock</span><span>]</span> <span>=</span> <span>Level2</span><span>;</span>
	<span>map</span><span>[</span><span>Shift</span><span>+</span><span>Lock</span><span>]</span> <span>=</span> <span>Level2</span><span>;</span>
	<span>level_name</span><span>[</span><span>Level1</span><span>]</span> <span>=</span> <span>"Base"</span><span>;</span>
	<span>level_name</span><span>[</span><span>Level2</span><span>]</span> <span>=</span> <span>"Caps"</span><span>;</span>
<span>};</span></code></pre></figure>

<p>The syntax here is more cumbersome. Firstly, there are some definition
lines. In each <code>type</code> entry (which can be prepended with merge syntax
like anything else in this syntax really) of the form <code>type "name"</code>,
we have to define the modifiers that will be used as such:</p>

<figure><pre><code data-lang="c"><span>modifiers</span> <span>=</span> <span>Shift</span> <span>+</span> <span>Lock</span><span>;</span></code></pre></figure>

<p>The <code>+</code>, is just a separator here.<br>
If the modifiers are not real keysym but virtual ones, then those virtual
modifiers also need to be defined earlier in the scope:</p>

<figure><pre><code data-lang="c"><span>virtual_modifiers</span>  <span>NumLock</span><span>;</span></code></pre></figure>

<p>After defining the modifiers that are used for that type, we have a series
of mapping to define the combination and what levels these will achieve.</p>

<figure><pre><code data-lang="c"><span>map</span><span>[</span><span>Shift</span><span>]</span> <span>=</span> <span>Level2</span><span>;</span>
<span>map</span><span>[</span><span>Lock</span><span>]</span> <span>=</span> <span>Level2</span><span>;</span>
<span>map</span><span>[</span><span>Shift</span><span>+</span><span>Lock</span><span>]</span> <span>=</span> <span>Level2</span><span>;</span></code></pre></figure>

<p>The syntax is also straight forward, it’s a list of mapping from a
combination of modifiers to the <code>LevelX</code> it will take the keysym to.</p>

<p>Afterward, we have a naming section, which is there only for the metadata
information, to give names to levels:</p>

<figure><pre><code data-lang="c"><span>level_name</span><span>[</span><span>Level1</span><span>]</span> <span>=</span> <span>"Base"</span><span>;</span>
<span>level_name</span><span>[</span><span>Level2</span><span>]</span> <span>=</span> <span>"Caps"</span><span>;</span></code></pre></figure>

<p>The only tricky part is the <code>preserve</code> keyword:</p>

<figure><pre><code data-lang="c"><span>preserve</span><span>[</span><span>Lock</span><span>]</span> <span>=</span> <span>Lock</span><span>;</span></code></pre></figure>

<p>This has to do with how XKB consumes modifiers as it processes types
and outputs keysyms, its internal list of effective modifiers. Simply
said, without the <code>preserve</code> when the keysym is sent back to the client
(<code>xkb_state_key_get_one_sym</code>) the state object doesn’t consume the
modifier, so the client can inspect it for further special handling.<br>
The logic within XKB clients looks something like this:</p>

<figure><pre><code data-lang="c"><span>xkb_mod_mask_t</span> <span>mods</span> <span>=</span> <span>xkb_state_serialize_mods</span><span>(</span><span>state</span><span>,</span> <span>XKB_STATE_MODS_EFFECTIVE</span><span>);</span>
<span>xkb_mod_mask_t</span> <span>consumed</span> <span>=</span> <span>xkb_state_key_get_consumed_mods2</span><span>(</span><span>state</span><span>,</span> <span>keycode</span><span>,</span> <span>XKB_CONSUMED_MODE_XKB</span><span>);</span>
<span>xkb_mod_mask_t</span> <span>unconsumed_mods</span> <span>=</span> <span>mods</span> <span>&amp;</span> <span>~</span><span>consumed</span><span>;</span></code></pre></figure>

<p>That’s useful for layout where you have, let’s say Greek letters for
Level1 and Level2, and at Level3 and Level4 there are the usual Latin
letters. So you’d want to preserve <code>Ctrl</code> and <code>Shift</code>, so that the
application can catch <code>Ctrl+c</code> for example, which would be in Level3
(Latin lower-case).</p>

<p>I’ve added different versions of the <code>ALPHABETIC</code> type in the example,
and how the capslock and shift combinations can affect letters.</p>

<p>Later on we’ll see how we assign the levels logic to symbols and
compatibility logic, but let’s just say that XKB will categorize keys
with a heuristic and assign them to default types if no other types were
explicitly chosen. These are:</p>

<ul>
  <li><code>"ONE_LEVEL"</code>: When there are only one level change for the keysym</li>
  <li><code>"TWO_LEVEL"</code>: When there are exacly two levels change for the keysym</li>
  <li><code>"ALPHABETIC"</code>: When the keysym is alphabetic and has two levels</li>
  <li><code>"KEYPAD"</code>: For keypad keys of any level (two usually)</li>
  <li><code>"FOUR_LEVEL_ALPHABETIC"</code>, <code>"FOUR_LEVEL_SEMIALPHABETIC"</code>, 3 to 4 keysym</li>
  <li><code>"FOUR_LEVEL"</code>: When nothing else matches</li>
</ul>

<p>The next component is the XKB compatibility, which is used to translate
key combinations into action statements. Actions can also be attached
directly in the XKB symbols component for each key, however it’s done in
the compatibility layer because it has a mechanism for generic pattern
matching of keysym combinations, so we don’t have to repeat the same
things in different places.<br>
The actions that can be done in the XKB compatibility are varied
from latching/unlatching/locking/unlocking modifiers, changing level,
switching group, etc.. Many of these actions, however, only make sense in
combination with the XKB symbols component, so keep that in mind for now.<br>
A compatibility map looks something like:</p>

<figure><pre><code data-lang="c"><span>default</span> <span>xkb_compatibility</span> <span>"basic"</span>  <span>{</span>
    <span>virtual_modifiers</span> <span>NumLock</span><span>,</span><span>AltGr</span><span>;</span>
<span>...</span>
    <span>interpret</span><span>.</span><span>repeat</span><span>=</span> <span>False</span><span>;</span>
    <span>setMods</span><span>.</span><span>clearLocks</span><span>=</span> <span>True</span><span>;</span>
<span>...</span>
    <span>interpret</span> <span>Shift_Lock</span><span>+</span><span>AnyOf</span><span>(</span><span>Shift</span><span>+</span><span>Lock</span><span>)</span> <span>{</span>
        <span>action</span><span>=</span> <span>LockMods</span><span>(</span><span>modifiers</span><span>=</span><span>Shift</span><span>);</span>
    <span>};</span>
<span>...</span>
    <span>group</span> <span>2</span> <span>=</span> <span>AltGr</span><span>;</span>
<span>...</span>
    <span>indicator</span><span>.</span><span>allowExplicit</span><span>=</span> <span>False</span><span>;</span>
<span>...</span>
    <span>indicator</span> <span>"Caps Lock"</span> <span>{</span>
        <span>whichModState</span><span>=</span> <span>Locked</span><span>;</span>
        <span>modifiers</span><span>=</span> <span>Lock</span><span>;</span>
    <span>};</span>
<span>...</span>
<span>};</span>

<span>default</span> <span>partial</span> <span>xkb_compatibility</span> <span>"pc"</span> <span>{</span>
    <span>// Sets the "Alt" virtual modifier.</span>
    <span>virtual_modifiers</span>  <span>Alt</span><span>;</span>
    <span>setMods</span><span>.</span><span>clearLocks</span><span>=</span> <span>True</span><span>;</span>

    <span>interpret</span> <span>Alt_L</span><span>+</span><span>Any</span> <span>{</span>
	<span>virtualModifier</span><span>=</span> <span>Alt</span><span>;</span>
	<span>action</span> <span>=</span> <span>SetMods</span><span>(</span><span>modifiers</span><span>=</span><span>modMapMods</span><span>);</span>
    <span>};</span>

    <span>interpret</span> <span>Alt_R</span><span>+</span><span>Any</span> <span>{</span>
	<span>virtualModifier</span><span>=</span> <span>Alt</span><span>;</span>
	<span>action</span> <span>=</span> <span>SetMods</span><span>(</span><span>modifiers</span><span>=</span><span>modMapMods</span><span>);</span>
    <span>};</span>
<span>};</span></code></pre></figure>

<p>This has many components, the <code>interpret</code> sections to map keys to actions,
the virtual modifier definitions, indicators, repeat behavior of keys,
and more. The important part is the <code>interpret</code> section which matches
keysym along with a modifier (<code>AnyOfOrNone</code>, <code>AnyOf</code>, <code>Any</code>, <code>NoneOf</code>,
<code>AllOf</code>, <code>Exactly</code>). The body of the interpret can also be more specific
by setting values of <code>useModMapMods</code> to match a certain level.<br>
Default values to params can be set globally such as <code>setMods.clearLocks</code>,
which affects how <code>SetMods</code> and other mods actions behave.<br>
The list of possibilities and actions within the compatibility is
too long to explain here, the list is extensive and can be found
<a href="https://xkbcommon.org/doc/current/keymap-text-format-v1-v2.html#key-actions">here</a>.</p>

<p>Let’s move to the keysym or symbol component, which as you would
have guessed, finally maps physical keys in ISO location format to
symbols. These files are often named after countries or languages or
specific features, <code>us</code>, <code>jp</code>, <code>group</code>.</p>

<figure><pre><code data-lang="c"><span>partial</span> <span>alphanumeric_keys</span>
<span>xkb_symbols</span> <span>"basic"</span> <span>{</span>

    <span>name</span><span>[</span><span>Group1</span><span>]</span><span>=</span> <span>"US/ASCII"</span><span>;</span>
    <span>key</span> <span>&lt;</span><span>ESC</span><span>&gt;</span>  <span>{</span>        <span>[</span> <span>Escape</span>                        <span>]</span>       <span>};</span>
<span>...</span>
    <span>key</span> <span>&lt;</span><span>TLDE</span><span>&gt;</span> <span>{</span>        <span>[</span> <span>quoteleft</span><span>,</span>    <span>asciitilde</span>      <span>]</span>       <span>};</span>
    <span>key</span> <span>&lt;</span><span>AE01</span><span>&gt;</span> <span>{</span>        <span>[</span>         <span>1</span><span>,</span>    <span>exclam</span>          <span>]</span>       <span>};</span>
<span>...</span>
    <span>modifier_map</span> <span>Shift</span>  <span>{</span> <span>Shift_L</span><span>,</span> <span>Shift_R</span> <span>};</span>
<span>...</span>
<span>};</span></code></pre></figure>

<p>It first has a metadata name in the <code>name[GroupX] = "Symbols Name"</code>
property, which can also be used to find which groups the symbols
belong to.<br>
This is also where virtual modifiers are mapped to actual keys with the
<code>modifier_map VIRTUAL_MOD { Symbol1, Symbol2}</code>.<br>
And obviously, that’s where the <code>key &lt;VAL&gt;</code> are mapped to list of groups
within <code>{}</code>, and levels within <code>[]</code>.</p>

<figure><pre><code data-lang="c"><span>key</span> <span>&lt;</span><span>TLDE</span><span>&gt;</span> <span>{</span>        <span>[</span> <span>quoteleft</span><span>,</span>    <span>asciitilde</span>      <span>]</span>       <span>};</span></code></pre></figure>

<p>This means the physical key <code>&lt;TLDE&gt;</code>, in level1 will output a left quote
(backtick), and in level2 will output the tilde character.</p>

<p>Additionally, we can also specify within the curly brackets whether a
specific type should be used instead of the default matching one:</p>

<figure><pre><code data-lang="c"><span>key</span> <span>&lt;</span><span>AE05</span><span>&gt;</span> <span>{</span> <span>[</span><span>parenleft</span><span>,</span> <span>1</span><span>,</span> <span>EuroSign</span><span>],</span> <span>type</span><span>[</span><span>Group1</span><span>]</span> <span>=</span> <span>"FOUR_LEVEL_ALPHABETIC"</span> <span>};</span></code></pre></figure>

<p>Similarly, the actions can be assigned here instead of in the
compatibility component, and the groups can also be explicitly expressed with
the syntax:</p>

<figure><pre><code data-lang="c"><span>key</span> <span>&lt;</span><span>LALT</span><span>&gt;</span> <span>{</span>
    <span>symbols</span><span>[</span><span>Group1</span><span>]</span><span>=</span><span>[</span><span>Alt_L</span><span>],</span>
    <span>actions</span><span>[</span><span>Group1</span><span>]</span><span>=</span><span>[</span><span>SetMods</span><span>(</span><span>modifiers</span><span>=</span><span>modMapMods</span><span>)]</span>
<span>};</span></code></pre></figure>

<p>That all should cover the KcCGST component syntax. It’s very long already,
I know, yet it barely covers the basics. Let’s see a few examples to
grasp the concepts.</p>

<p>In <code>symbol/group</code> we have:</p>

<figure><pre><code data-lang="c"><span>// The left Alt key (while pressed) chooses the next group.</span>
<span>partial</span> <span>modifier_keys</span>
<span>xkb_symbols</span> <span>"lswitch"</span> <span>{</span>
    <span>key</span> <span>&lt;</span><span>LALT</span><span>&gt;</span> <span>{[</span>  <span>Mode_switch</span><span>,</span>  <span>Multi_key</span>  <span>]};</span>
<span>};</span></code></pre></figure>

<p>And in <code>compat/basic</code> we have these <code>interpret</code>:</p>

<figure><pre><code data-lang="c"><span>interpret</span> <span>Mode_switch</span> <span>{</span>
	<span>action</span><span>=</span> <span>SetGroup</span><span>(</span><span>group</span><span>=+</span><span>1</span><span>);</span>
<span>};</span></code></pre></figure>

<p>The <code>Multi_key</code> maps to a compose key in <code>compat/ledcompose</code>:</p>

<figure><pre><code data-lang="c"><span>interpret</span> <span>Multi_key</span><span>+</span><span>Any</span> <span>{</span>
	<span>virtualModifier</span><span>=</span> <span>Compose</span><span>;</span>
	<span>action</span> <span>=</span> <span>LatchMods</span><span>(</span><span>modifiers</span><span>=</span><span>modMapMods</span><span>);</span>
<span>};</span>

<span>indicator</span> <span>"Compose"</span> <span>{</span>
	<span>allowExplicit</span><span>;</span>
	<span>whichModState</span><span>=</span> <span>Latched</span><span>;</span>
	<span>modifiers</span><span>=</span> <span>Compose</span><span>;</span>
<span>};</span></code></pre></figure>

<p>We’ll see in a bit how compose works.</p>

<p>Another example setting <code>&lt;LWIN&gt;</code> to <code>Super_L</code> which sets <code>Mod3</code> modifier.</p>

<figure><pre><code data-lang="c"><span>xkb_compatibility</span> <span>{</span>
   <span>interpret</span> <span>Super_L</span> <span>{</span> <span>action</span> <span>=</span> <span>SetMods</span><span>(</span><span>modifiers</span><span>=</span><span>Mod3</span><span>);</span> <span>};</span>
<span>}</span>

<span>xkb_symbols</span> <span>{</span>
   <span>key</span> <span>&lt;</span><span>LWIN</span><span>&gt;</span> <span>{</span> <span>[</span> <span>Super_L</span> <span>]</span> <span>};</span>
   <span>modifier_map</span> <span>Mod3</span> <span>{</span> <span>Super_L</span> <span>};</span>
<span>}</span></code></pre></figure>

<p>Here’s another example swapping the top row numbers on shift:</p>

<figure><pre><code data-lang="c"><span>default</span> <span>partial</span> <span>alphanumeric_keys</span>
<span>xkb_symbols</span> <span>"basic"</span> <span>{</span>
    <span>include</span> <span>"us(basic)"</span>
    <span>name</span><span>[</span><span>Group1</span><span>]</span><span>=</span> <span>"Banana (US)"</span><span>;</span>
 
    <span>key</span> <span>&lt;</span><span>AE01</span><span>&gt;</span> <span>{</span> <span>[</span> <span>exclam</span><span>,</span>          <span>1</span><span>]</span>     <span>};</span>
    <span>key</span> <span>&lt;</span><span>AE02</span><span>&gt;</span> <span>{</span> <span>[</span> <span>at</span><span>,</span>              <span>2</span><span>]</span>     <span>};</span>
    <span>key</span> <span>&lt;</span><span>AE03</span><span>&gt;</span> <span>{</span> <span>[</span> <span>numbersign</span><span>,</span>      <span>3</span><span>]</span>     <span>};</span>
    <span>key</span> <span>&lt;</span><span>AE04</span><span>&gt;</span> <span>{</span> <span>[</span> <span>dollar</span><span>,</span>          <span>4</span><span>]</span>     <span>};</span>
    <span>key</span> <span>&lt;</span><span>AE05</span><span>&gt;</span> <span>{</span> <span>[</span> <span>percent</span><span>,</span>         <span>5</span><span>]</span>     <span>};</span>
    <span>key</span> <span>&lt;</span><span>AE06</span><span>&gt;</span> <span>{</span> <span>[</span> <span>asciicircum</span><span>,</span>     <span>6</span><span>]</span>     <span>};</span>
    <span>key</span> <span>&lt;</span><span>AE07</span><span>&gt;</span> <span>{</span> <span>[</span> <span>ampersand</span><span>,</span>       <span>7</span><span>]</span>     <span>};</span>
    <span>key</span> <span>&lt;</span><span>AE08</span><span>&gt;</span> <span>{</span> <span>[</span> <span>asterisk</span><span>,</span>        <span>8</span><span>]</span>     <span>};</span>
    <span>key</span> <span>&lt;</span><span>AE09</span><span>&gt;</span> <span>{</span> <span>[</span> <span>parenleft</span><span>,</span>       <span>9</span><span>]</span>     <span>};</span>
    <span>key</span> <span>&lt;</span><span>AE10</span><span>&gt;</span> <span>{</span> <span>[</span> <span>parenright</span><span>,</span>      <span>0</span><span>]</span>     <span>};</span>
    <span>key</span> <span>&lt;</span><span>AE11</span><span>&gt;</span> <span>{</span> <span>[</span> <span>underscore</span><span>,</span>      <span>minus</span><span>]</span> <span>};</span>
    <span>key</span> <span>&lt;</span><span>AE12</span><span>&gt;</span> <span>{</span> <span>[</span> <span>plus</span><span>,</span>            <span>equal</span><span>]</span> <span>};</span>
<span>};</span>
 
<span>// Same as banana but map the euro sign to the 5 key</span>
<span>partial</span> <span>alphanumeric_keys</span>
<span>xkb_symbols</span> <span>"orange"</span> <span>{</span>
    <span>include</span> <span>"banana(basic)"</span>
    <span>name</span><span>[</span><span>Group1</span><span>]</span> <span>=</span> <span>"Banana (Eurosign on 5)"</span><span>;</span>
    <span>include</span> <span>"eurosign(5)"</span>
<span>};</span></code></pre></figure>

<p>Here’s a symbol component which replaces key “B” to have a third level
activated with the right alt to display a broccoli.</p>

<figure><pre><code data-lang="c"><span>partial</span> <span>alphanumeric_keys</span>
<span>xkb_symbols</span> <span>"broccoli"</span> <span>{</span>
    <span>include</span> <span>"us(basic)"</span>
    <span>name</span><span>[</span><span>Group1</span><span>]</span> <span>=</span> <span>"Broccoli"</span><span>;</span>
    <span>key</span> <span>&lt;</span><span>AD05</span><span>&gt;</span> <span>{</span> <span>[</span> <span>b</span><span>,</span> <span>B</span><span>,</span> <span>U1F966</span> <span>]};</span> <span>// 🥦</span>
    <span>include</span> <span>"level3(ralt_switch)"</span>
<span>};</span></code></pre></figure>

<p><em>NB</em>: XKB has keysym to allow controlling the mouse pointer from the
keyboard, this can be useful if clients actually understand these keysym
and act on them.</p>

<p>It’s fine and all but we need the RMLVO so that the users can actually
use the keymap properly without bothering with all that we’ve seen.<br>
The rules are in the <code>rules</code> directory as simple files without extensions,
and are accompanied with two listing files for GUI selectors: <code>*.lst</code>
and <code>*.xml</code> that follow the <code>xkb.dtd</code> in the same directory. The listing
files are simply listing all the models, variants, layouts, and options
available, nothing more, and are used by the XKB registry library. That’s
in turn used by GUI selectors.</p>

<p>The logic exists within the rules files, that have this sort syntax:</p>

<figure><pre><code data-lang="shell"><span>!</span> include %S/evdev
 
<span>!</span> option     <span>=</span> symbols
  custom:foo <span>=</span> +custom<span>(</span>bar<span>)</span>
  custom:baz <span>=</span> +other<span>(</span>baz<span>)</span>

// One may use multiple MLVO components on the LHS
<span>!</span> layout    option          <span>=</span> symbols
  be        caps:digits_row <span>=</span> +capslock<span>(</span>digits_row<span>)</span>
  fr        caps:digits_row <span>=</span> +capslock<span>(</span>digits_row<span>)</span></code></pre></figure>

<p>The full syntax grammar looks like this:</p>

<figure><pre><code data-lang="shell">File         ::<span>=</span> <span>{</span> <span>"!"</span> <span>(</span>Include | Group | RuleSet<span>)</span> <span>}</span>

Include      ::<span>=</span> <span>"include"</span> &lt;ident&gt;

Group        ::<span>=</span> GroupName <span>"="</span> <span>{</span> GroupElement <span>}</span> <span>"</span><span>\n</span><span>"</span>
GroupName    ::<span>=</span> <span>"$"</span>&lt;ident&gt;
GroupElement ::<span>=</span> &lt;ident&gt;

RuleSet      ::<span>=</span> Mapping <span>{</span> Rule <span>}</span>

Mapping      ::<span>=</span> <span>{</span> Mlvo <span>}</span> <span>"="</span> <span>{</span> Kccgst <span>}</span> <span>"</span><span>\n</span><span>"</span>
Mlvo         ::<span>=</span> <span>"model"</span> | <span>"option"</span> | <span>(</span><span>"layout"</span> | <span>"variant"</span><span>)</span> <span>[</span> Index <span>]</span>
Index        ::<span>=</span> <span>"["</span> <span>({</span> NumericIndex <span>}</span> | <span>{</span> SpecialIndex <span>})</span> <span>"]"</span>
NumericIndex ::<span>=</span> 1..XKB_MAX_GROUPS
SpecialIndex ::<span>=</span> <span>"single"</span> | <span>"first"</span> | <span>"later"</span> | <span>"any"</span>
Kccgst       ::<span>=</span> <span>"keycodes"</span> | <span>"symbols"</span> | <span>"types"</span> | <span>"compat"</span> | <span>"geometry"</span>

Rule         ::<span>=</span> <span>{</span> MlvoValue <span>}</span> <span>"="</span> <span>{</span> KccgstValue <span>}</span> <span>"</span><span>\n</span><span>"</span>
MlvoValue    ::<span>=</span> <span>"*"</span> | <span>"&lt;none&gt;"</span> | <span>"&lt;some&gt;"</span> | <span>"&lt;any&gt;"</span> | GroupName | &lt;ident&gt;
KccgstValue  ::<span>=</span> &lt;ident&gt; <span>[</span> <span>{</span> Qualifier <span>}</span> <span>]</span>
Qualifier    ::<span>=</span> <span>":"</span> <span>({</span> NumericIndex <span>}</span> | <span>"all"</span><span>)</span></code></pre></figure>

<p>We won’t go into details, but basically it has lines starting with <code>!</code>
that set certain MLVO values and then map them to KccgstValue specific
component values. There are also variable names that can be defined
as shorthand for multiple values with <code>$var = val1 val2</code>, and there
are string substitutions starting with <code>%</code>. More info can be found
<a href="https://xkbcommon.org/doc/current/rule-file-format.html">here</a>.</p>

<p>So we’ve got the full scope now of RMLVO to KcCGST, the big picture!</p>

<p>We didn’t discuss another sub-feature of XKB called composing, or the
compose key processor. We didn’t mention it because the configuration
doesn’t come with the xkeyboard-config project. It’s loaded independently
by clients that want to perform composition.<br>
For X11 the configuration is found under <code>/usr/share/X11/local/*/Compose</code>
and <code>compose.dir</code>, and the home directory in <code>~/.XCompose</code>. The
content of this directory is mostly deprecated apart from the compose
definitions, which follows the <code>XKB_COMPOSE_FORMAT_TEXT_V1</code> format (see
<code>Compose(5)</code>). It’s a simple format that looks like this:</p>

<div><pre><code>&lt;Multi_key&gt; &lt;e&gt; &lt;'&gt;       : "é"   U00E9
&lt;Multi_key&gt; &lt;'&gt; &lt;e&gt;       : "é"   U00E9
&lt;Multi_key&gt; &lt;o&gt; &lt;slash&gt;   : "ø"   U00F8
&lt;Multi_key&gt; &lt;s&gt; &lt;s&gt;       : "ß"   U00DF
</code></pre></div>

<p>As you can see, this is the <code>&lt;Multi_key&gt;</code> keysym we’ve talked about in
an earlier example, this is where it’s interpreted.</p>

<p>After editing any of the files, the syntax can be validated with <code>xkbcli
compile-compose</code>.</p>

<p>The way the file is used is that clients will pass it to the XKB compose
parser to get an in-memory table of it. Then the client keeps the compose
state, just like the modifier state, and plug it in the main interaction
with XKB we’ve seen earlier. Like this:</p>

<figure><pre><code data-lang="c"><span>// 1. Load compose table (locale-dependent)</span>
<span>struct</span> <span>xkb_compose_table</span> <span>*</span><span>table</span> <span>=</span>
    <span>xkb_compose_table_new_from_locale</span><span>(</span><span>ctx</span><span>,</span> <span>getenv</span><span>(</span><span>"LANG"</span><span>),</span>
                                      <span>XKB_COMPOSE_COMPILE_NO_FLAGS</span><span>);</span>

<span>// 2. Create a compose state</span>
<span>struct</span> <span>xkb_compose_state</span> <span>*</span><span>compose</span> <span>=</span>
    <span>xkb_compose_state_new</span><span>(</span><span>table</span><span>,</span> <span>XKB_COMPOSE_STATE_NO_FLAGS</span><span>);</span>

<span>// 3. For each key press:</span>
<span>xkb_keysym_t</span> <span>sym</span> <span>=</span> <span>xkb_state_key_get_one_sym</span><span>(</span><span>state</span><span>,</span> <span>keycode</span><span>);</span>
<span>xkb_compose_feed_result</span> <span>res</span> <span>=</span> <span>xkb_compose_state_feed</span><span>(</span><span>compose</span><span>,</span> <span>sym</span><span>);</span>

<span>// Feed all keysyms into the compose engine:</span>
<span>xkb_compose_state_feed</span><span>(</span><span>compose_state</span><span>,</span> <span>sym</span><span>);</span>

<span>// 4. Check compose status</span>
<span>switch</span> <span>(</span><span>xkb_compose_state_get_status</span><span>(</span><span>compose_state</span><span>))</span> <span>{</span>
    <span>case</span> <span>XKB_COMPOSE_COMPOSED</span><span>:</span>
        <span>composed_sym</span> <span>=</span> <span>xkb_compose_state_get_one_sym</span><span>(</span><span>compose_state</span><span>);</span>
        <span>// Use composed_sym; DO NOT use 'sym'</span>
        <span>// char buf[64];</span>
        <span>// xkb_compose_state_get_utf8(compose_state, buf, sizeof(buf));</span>
        <span>// printf("→ composed result: %s\n", buf);</span>
        <span>break</span><span>;</span>

    <span>case</span> <span>XKB_COMPOSE_CANCELLED</span><span>:</span>
        <span>// Typically fall back to original sym</span>
        <span>break</span><span>;</span>

    <span>case</span> <span>XKB_COMPOSE_COMPOSING</span><span>:</span>
        <span>// Wait for next key</span>
        <span>break</span><span>;</span>

    <span>case</span> <span>XKB_COMPOSE_NOTHING</span><span>:</span>
        <span>// No composition; use raw 'sym'</span>
        <span>break</span><span>;</span>
<span>}</span>

<span>// otherwise</span>
<span>// xkb_state_key_get_utf8</span></code></pre></figure>

<p>So, to make key composing work, it’s all dependent on the client, be
it in X11 or Wayland. In general widget/toolkit libraries, and Xlib,
does it out-of-the-box and/or easily for us.</p>

<p>Finally, let’s review how to interface with XKB from the command line.</p>

<p>There are a couple of X11 bound, and deprecated legacy, commands such as:</p>

<ul>
  <li><code>xmodmap</code> (pre-XKB even)</li>
  <li><code>setxkbmap</code></li>
  <li><code>xkbcomp</code></li>
  <li><code>xev</code></li>
  <li><code>xkbprint</code></li>
  <li><code>xkbevd</code></li>
</ul>

<p>They will not work on Wayland since they rely on the XKB X11 specific
proto (XKM binary format and others), but are still good to debug certain
behavior on X11, and to directly interface with X11 to configure XKB
interpretation on the fly, since obviously it’s these software that rely
on the library and load the appropriate configurations.</p>

<p>The main interaction these days should all pass through <code>xkbcli</code> and
its subcommands. It comes with a few handy man pages:</p>

<ul>
  <li><code>xkbcli</code></li>
  <li><code>xkbcli-list</code></li>
  <li><code>xkbcli-dump-keymap-x11</code></li>
  <li><code>xkbcli-dump-keymap-wayland</code></li>
  <li><code>xkbcli-interactive-x11</code></li>
  <li><code>xkbcli-interactive-wayland</code></li>
  <li><code>xkbcli-compile-compose</code></li>
  <li><code>xkbcli-how-to-type</code></li>
  <li><code>xkbcli-compile-keymap</code></li>
  <li><code>xkbcli-interactive-evdev</code></li>
</ul>

<div><pre><code>&gt; xkbcli how-to-type 'P'
keysym: P (0x0050)
KEYCODE  KEY NAME  LAYOUT   LAYOUT NAME          LEVEL#  MODIFIERS
33       AD10      1        English (US)         2       [ Shift ]
33       AD10      1        English (US)         2       [ Lock ]
</code></pre></div>

<figure><pre><code data-lang="shell"><span>&gt;</span> xkbcli compile-keymap <span>--kccgst</span> <span>--layout</span> us <span>--options</span> terminate:ctrl_alt_bksp
xkb_keymap <span>{</span>
  xkb_keycodes <span>{</span> include <span>"evdev+aliases(qwerty)"</span> <span>}</span><span>;</span>
  xkb_types <span>{</span> include <span>"complete"</span> <span>}</span><span>;</span>
  xkb_compat <span>{</span> include <span>"complete"</span> <span>}</span><span>;</span>
  xkb_symbols <span>{</span> include <span>"pc+us+inet(evdev)+terminate(ctrl_alt_bksp)"</span> <span>}</span><span>;</span>
  xkb_geometry <span>{</span> include <span>"pc(pc105)"</span> <span>}</span><span>;</span>
<span>}</span><span>;</span></code></pre></figure>

<p>To list the whole RMLVO possible values from the registry:</p>



<p>Print current RMLVO:</p>

<div><pre><code>&gt; xkbcli compile-keymap --rmlvo
rules: "evdev"
model: "pc105"
layout: "us"
variant: ""
options: ""
</code></pre></div>

<p>A nice debugging trace for a compose example <code>alt+'+e</code> that outputs “é”.</p>

<figure><pre><code data-lang="shell"><span>&gt;</span> xkbcli interactive-x11 <span>--enable-compose</span> <span>--multiline</span>
<span>------------</span>
key down: 0x06c &lt;RALT&gt;
    layout: depressed: 0
            latched:   0
            locked:    0 <span>"English (US)"</span>
            effective: 0 <span>"English (US)"</span>
            key:       0 <span>"English (US)"</span>
    modifiers: depressed: 0x00000000
               latched:   0x00000000
               locked:    0x00000010 Mod2 NumLock
               effective: 0x00000010 Mod2 NumLock
    level: 0
    raw keysyms: Multi_key
    compose: pending
    LEDs: 1 <span>"Num Lock"</span>
<span>------------</span>
key up:   0x06c &lt;RALT&gt;
<span>------------</span>
key down: 0x030 &lt;AC11&gt;
    layout: depressed: 0
            latched:   0
            locked:    0 <span>"English (US)"</span>
            effective: 0 <span>"English (US)"</span>
            key:       0 <span>"English (US)"</span>
    modifiers: depressed: 0x00000000
               latched:   0x00000000
               locked:    0x00000010 Mod2 NumLock
               effective: 0x00000010 Mod2 NumLock
    level: 0
    raw keysyms: apostrophe
    compose: pending
    LEDs: 1 <span>"Num Lock"</span>
<span>------------</span>
key up:   0x030 &lt;AC11&gt;
<span>------------</span>
key down: 0x01a &lt;AD03&gt;
    layout: depressed: 0
            latched:   0
            locked:    0 <span>"English (US)"</span>
            effective: 0 <span>"English (US)"</span>
            key:       0 <span>"English (US)"</span>
    modifiers: depressed: 0x00000000
               latched:   0x00000000
               locked:    0x00000010 Mod2 NumLock
               effective: 0x00000010 Mod2 NumLock
    level: 0
    raw keysyms: e
    composed: eacute <span>"é"</span> <span>(</span>U+00E9, 1 code point<span>)</span>
    LEDs: 1 <span>"Num Lock"</span>
<span>------------</span></code></pre></figure>

<p>Let’s note I have these confs:</p>

<figure><pre><code data-lang="c"><span>// in symbols</span>
<span>key</span> <span>&lt;</span><span>RALT</span><span>&gt;</span> <span>{</span>
  <span>type</span><span>=</span> <span>"TWO_LEVEL"</span><span>,</span>
  <span>symbols</span><span>[</span><span>1</span><span>]</span><span>=</span> <span>[</span>       <span>Multi_key</span><span>,</span>       <span>Multi_key</span> <span>]</span>
<span>};</span>

<span>// in Compose</span>
<span>&lt;</span><span>Multi_key</span><span>&gt;</span> <span>&lt;</span><span>apostrophe</span><span>&gt;</span> <span>&lt;</span><span>e</span><span>&gt;</span> <span>:</span> <span>"é"</span> <span>eacute</span> <span>#</span> <span>LATIN</span> <span>SMALL</span> <span>LETTER</span> <span>E</span> <span>WITH</span> <span>ACUTE</span></code></pre></figure>

<p>There are additional third party projects such as <code>klfcAUR</code> to compile
layouts from JSON.</p>

<p>Probably the most impressive is how you can rely on the geometry and
print it as a PDF, this only works with the legacy tools though:</p>

<div><pre><code>&gt; setxkbmap -print | xkbcomp -xkm - - | xkbprint - - | ps2pdf - mymap.pdf
</code></pre></div>

<p>Another thing that is interesting to know is that the XKB
keymap can be converted to Console keymap with scripts such as the
<a href="https://manpages.debian.org/testing/console-setup/setupcon.1.en.html"><code>setupcon(1)</code></a>
which relies on <code>ckbcomp</code> and others, and will read confs from <code>/etc/default/keyboard</code>.<br>
Obviously, let’s not forget to mention <code>localectl(1)</code> to interface with
<code>systemd-localed.service(8)</code> that is the newer version of
<code>setupcon(1)</code>. It’s sort of a big wrapper over other tools and behavior
to automate things.</p>

<div><pre><code>&gt; localectl
System Locale: LANG=en_US.UTF-8
    VC Keymap: us
   X11 Layout: us
</code></pre></div>

<p>We’ll see how it sets it in X11, but let’s just say it can be used to
list keymaps:</p>



<p>There are also the options <code>list-x11-keymap-models</code>,
<code>list-x11-keymap-layouts</code>, <code>list-x11-keymap-variants [LAYOUT]</code>,
<code>list-x11-keymap-options</code>.</p>

<p>And to set it with <code>set-x11-keymap</code>. However it always tries to convert
the XKB keymap to console keymap whenever it can, if you don’t want that
behavior, you should add this option:</p>

<div><pre><code>&gt; localectl set-x11-keymap --no-convert keymap
</code></pre></div>

<p>Let’s end on a funny note to wrap things up about XKB. Yubikeys work by
simulating keyboards, and thus they have to anticipate a very specific
layout and variant, otherwise inserting a Yubikey would output the
wrong values. To skip this, there are udev device properties (<code>ENV{}</code>
set from hwdb) called <code>XKB_FIXED_LAYOUT</code> and <code>XKB_FIXED_VARIANT</code> that
need to be set and respected by the clients of libxkbcommon.</p>

<p>From <code>60-keyboard.hwdb</code>:</p>

<div><pre><code># Yubico Yubico Yubikey II
evdev:input:b0003v1050p0010*
# Yubico Yubikey NEO OTP+CCID
evdev:input:b0003v1050p0111*
# Yubico Yubikey NEO OTP+U2F+CCID
evdev:input:b0003v1050p0116*
# OKE Electron Company USB barcode reader
evdev:input:b0003v05FEp1010*
 XKB_FIXED_LAYOUT=us
 XKB_FIXED_VARIANT=
</code></pre></div>

<p>Here’s a summary of what was discussed in the XKB stack:</p>

<p><img src="https://venam.net/blog/assets/input_devices_linux/xkb.png" alt="XKB Overview" title="XKB Overview"></p>

<h2 id="pointer-specifics">Pointer Specifics</h2>

<p>We’ve seen a lot of complex keyboard specific input behavior, let’s
dabble a bit with pointer devices now, from mice to touchpads.</p>

<h2 id="types-of-touchpads">Types of Touchpads</h2>

<p>Let’s mention a few definitions.<br>
In general we call a pointer the representation of the input device,
and the cursor the drawn icon representation.</p>

<p>We have clickpads, a touchpad that has no separate buttons, but
that is all clickable. The behavior then depends on where the click
happens. Meanwhile, forcepads are like clickpads but they don’t have
any buttons and instead will vibrate when pressed. Lastly, trackpoints
are the little balls/nudge in the middle of the keyboard of Thinkpads,
they’re tagged in udev/hwdb with <code>ID_INPUT_POINTINGSTICK</code> property.</p>

<figure><pre><code data-lang="shell">Device:                  TPPS/2 Elan TrackPoint
trackpoint: the nudge of thinkpads

    <span># Name: TPPS/2 Elan TrackPoint</span>
    <span># ID: bus 0x0011 vendor 0x0002 product 0x000a version 0x0063</span>
    <span># Supported Events:</span>
    <span># Event type 0 (EV_SYN)</span>
    <span># Event type 1 (EV_KEY)</span>
    <span>#   Event code 272 (BTN_LEFT)</span>
    <span>#   Event code 273 (BTN_RIGHT)</span>
    <span>#   Event code 274 (BTN_MIDDLE)</span>
    <span># Event type 2 (EV_REL)</span>
    <span>#   Event code 0 (REL_X)</span>
    <span>#   Event code 1 (REL_Y)</span>
    <span># Properties:</span>
    <span>#    Property 0 (INPUT_PROP_POINTER)</span>
    <span>#    Property 5 (INPUT_PROP_POINTING_STICK)</span>

    properties:
    - <span>ID_INPUT</span><span>=</span>1
    - <span>ID_INPUT_MOUSE</span><span>=</span>1
    - <span>ID_INPUT_POINTINGSTICK</span><span>=</span>1
driver:psmouse</code></pre></figure>

<p>As you can see from the above, the trackpoint also has attached to it
some physical buttons, they’re the ones above the Thinkpad touchpad. It’s
in between a mouse and a touchpad.</p>

<p>There are internal touchpads and external touchpads. The external
touchpads don’t get turned off when the lid is closed, nor disabled
while typing. A graphic tablet such as a wacom device is effectively an
external touchpad.<br>
This information can be embedded in a udev device property called
<code>ENV{ID_INPUT_TOUCHPAD_INTEGRATION}</code>, and set to either “external” or
“internal”. This is part of the hwdb, out-of-the-box:</p>

<figure><pre><code data-lang="shell"> ~ <span>&gt;</span> udevadm info /dev/input/event11  
P: /devices/platform/i8042/serio1/input/input11/event11
M: event11
….
N: input/event11
E: <span>DEVNAME</span><span>=</span>/dev/input/event11
…
E: <span>SUBSYSTEM</span><span>=</span>input
E: <span>ID_INPUT</span><span>=</span>1
E: <span>ID_INPUT_TOUCHPAD</span><span>=</span>1
E: <span>ID_INPUT_WIDTH_MM</span><span>=</span>101
E: <span>ID_INPUT_HEIGHT_MM</span><span>=</span>73
…
E: <span>ID_INPUT_TOUCHPAD_INTEGRATION</span><span>=</span>internal</code></pre></figure>

<p>Last interesting fact is that some touchpad can have capacitive touch,
that means they can detect the finger in a range above the touchpad,
hovering in proximity. This is the <code>BTN_TOOL_FINGER</code> in contrast to
<code>BTN_TOUCH</code>, but they often come together and so you have to discern if
it’s a real touchdown or not. For MT there’s also <code>ABS_MT_PRESSURE</code> and
<code>ABS_MT_DISTANCE</code> that can be used for this. That’s another job that
libinput is good at.</p>

<h2 id="mt--multitouch">MT — MultiTouch</h2>

<p>We quickly went over the concept of MT, or multitouch before, let’s add
a bit more info to that.</p>

<p>Multitouch are touchpads that support tracking more than one finger. They
speak evdev multitouch to user-space (type B), and most often are handled
by the hid-multitouch driver from the kernel side.</p>

<p>The capabilities of an MT touchpad should have something similar to this
(<code>libinput record</code> output or others):</p>

<div><pre><code>key: BTN_LEFT, BTN_TOOL_FINGER, BTN_TOOL_DOUBLETAP, BTN_TOUCH 
     (BTN_TOOL_DOUBLETAP up to BTN_TOOL_QUINTTAP)
abs: ABS_X, ABS_Y, ABS_MT_SLOT, ABS_MT_POSITION_X, ABS_MT_POSITION_Y,
     ABS_MT_TOOL_TYPE, ABS_MT_TRACKING_ID
</code></pre></div>

<p>There can also be <code>ABS_MT_TOUCH_MAJOR</code>, <code>ABS_MT_TOUCH_MINOR</code>,
<code>ABS_MT_WIDTH_MINOR</code>, and <code>ABS_MT_WIDTH_MAJOR</code>, that are used to provide
the size of the contact area in surface or absolute units. There’s
also <code>ABS_MT_ORIENTATION</code>, for the orientation of the touching ellipse
(finger).</p>

<p>For MT, the key events are simple, they tell us how many fingers are
tapping.<br>
Then, fingers are tracked in what’s called “slots” along with a new
unique tracking id each time a finger touchdown again, and like all
evdev it’s a stateful protocol.</p>

<p>So for example, slot 0 gets assigned tracking id 1 when the first finger
is down, then slot 1 gets assigned tracking id 2 when the second finger
is down, then the first finger is lifted and put back down again, and
slot 0 gets assigned tracking id 3.<br>
That can sound complex to track, and again that’s where libinput
shines. Here’s what it looks like in a simplified evdev trace:</p>

<div><pre><code>ABS_MT_SLOT 0
ABS_MT_TRACKING_ID 45
ABS_MT_POSITION_X x[0]
ABS_MT_POSITION_Y y[0]
ABS_MT_SLOT 1
ABS_MT_TRACKING_ID 46
ABS_MT_POSITION_X x[1]
ABS_MT_POSITION_Y y[1]
SYN_REPORT
// slot 0 moves in x position
ABS_MT_SLOT 0
ABS_MT_POSITION_X x[0]
SYN_REPORT
// lifting slot 0
ABS_MT_TRACKING_ID -1
SYN_REPORT
// lifting slot 1
ABS_MT_SLOT 1
ABS_MT_TRACKING_ID -1
SYN_REPORT
</code></pre></div>

<h2 id="synaptics">Synaptics</h2>

<p>Once upon a time everyone was bragging about their synaptics touchpad
confs, yet this is now deprecated in favor of libinput. What was that
all about?</p>

<p>Synaptics, unrelated to synaptics inc, was a complex X11 driver with
so many configurations. It was buggy and had lots of internal magic,
especially its acceleration profiles, which had logic split between the
X11 server and the driver.</p>

<div><pre><code> $ synclient -l
 Parameter settings:
 LeftEdge                = 1310
 RightEdge               = 4826
 TopEdge                 = 2220
 BottomEdge              = 4636
 FingerLow               = 25
 FingerHigh              = 30
 MaxTapTime              = 180
 ...
</code></pre></div>

<p>Synaptics was configured through the command line <code>synclient</code>. They
talked through a special interfaced with a custom protocol (shared memory
segment). That is before X11 had any standard way to dynamically be
configured (with <code>xinput</code>), and before evdev was a thing. This was hacky.</p>

<p>These days X11 and Wayland rely on libinput so this should be used
instead.</p>

<p>The only feature missing from libinput, which is implemented in user-space
by the widget libraries and DE, is non-linear acceleration and speed,
kinetic scrolling. That’s mostly a non-issue.</p>

<h2 id="acceleration-profile">Acceleration Profile</h2>

<p>Simply said, pointer acceleration is the function that multiplies the
movement deltas with a given factor:</p>



<p>One of the main role of libinput is to make pointer movement as precise
as possible on all devices. If the user intends and performs action,
the feedback should be that it’s what they expected to do.</p>

<p>An acceleration profile defines a series of points of the form <code>(x, f(x))</code>,
input to output speed, that are linearly interpolated (a curve is drawn
between them for deduction). For example, flat acceleration is 
<code>[(0.0, 0.0), (1.0, 1.0)]</code>.</p>

<p>The default acceleration, adaptive, is pretty smart, and differs per
device type and resolution, it already has these configured for touchpads
for example:</p>

<ul>
  <li>super-slow: deceleration</li>
  <li>slow: deceleration</li>
  <li>medium: adaptive+deceleration</li>
  <li>fast: adaptive+fast</li>
  <li>flick: fast</li>
</ul>

<p>In general, libinput allows to configure this behavior. We can pick
between 3 pointer acceleration profiles: adaptive (default), flat the
45° one we’ve seen, and custom profiles. Along with different types
of motions the profiles can apply to: motion, scroll, fallback. We can
configure points and steps for each one: the points are the x and y
creating the curve of the acceleration profile we talked about, and the
steps is how the interpolation granularity happens between the points
(a value of 0 will use the default).<br>
In most cases, not touching the acceleration profile provides better
results.</p>

<p>In <code>libinput list-devices</code> for a touchpad:</p>

<div><pre><code>Accel profiles:          flat *adaptive custom
</code></pre></div>

<h2 id="gestures">Gestures</h2>

<p>We’ve seen that libinput offers two types of gestures out-of-the-box:
swiping and pinching. For anything else, one has to rely on third party
libraries. Here are a few:</p>

<ul>
  <li><a href="https://github.com/iberianpig/fusuma">fusuma</a></li>
  <li><a href="https://github.com/bulletmark/libinput-gestures">libinput-gestures</a></li>
  <li><a href="https://github.com/Coffee2CodeNL/gebaar-libinput">gebaar-libinput</a></li>
</ul>

<p>YMMV while using them.</p>



<p>Let’s close this section with a few random details that don’t need
much discussion.</p>

<p>High-end gaming mice are finicky and often normal basic drivers are not
enough to configure their high precision, nor is libinput. That’s why the
<a href="https://libratbag.github.io/">libratbag</a> project exists.</p>

<p>The libwacom (not only wacom) and tools such as Tuhi are used to manage
information needed by libinput to handle drawing tablets. These tablets
come with a tool such as a pen/stylus, it’s specificities are handled too.
For example, pressing certain button to reverse the behavior and start
erasing. There are X11 tools such as <code>xsetwacom</code> that also help.</p>

<p>An interesting software is <code>gpm(8)</code> which is a mouse in
the console that relies on reading directly the mouse stream
character device and interfacing/translating them to <code>TIOCLINUX</code>
<code>TIOCL_SELMOUSEREPORT</code>, terminal ioctl, to draw it. The terminal
will then output specific mouse reporting escape codes (more info
<a href="https://man.archlinux.org/man/console_codes.4.en#Mouse_tracking">here</a>).</p>

<p>Finally, here’s a few pointer specific debug tools:</p>

<ul>
  <li><a href="https://github.com/canadaduane/cleartouch">cleartouch</a></li>
  <li><a href="https://github.com/whot/mtview">mtview</a></li>
  <li><a href="https://github.com/bentiss/mtdiag-qt">mtdiag-qt</a></li>
  <li>The <code>libinput debug-gui</code> and <code>libinput debug-tablet</code></li>
</ul>

<h2 id="gamepad-specifics">Gamepad Specifics</h2>

<p>Gamepads aren’t handled by libinput in user-space, nor do they rely on
the evdev handler in the kernel. Instead they rely on the joydev handler.</p>

<p>The gamepads get associated to their specific drivers, which
will consume all these events. The joydev handler then normalizes
and sends them to user-space in a format called <code>js_event</code> from
<code>include/uapi/linux/joystick.h</code>.<br>
The handler will listen to all devices that support <code>EV_KEY</code>
<code>BTN_JOYSTICK</code> or <code>BTN_GAMEPAD</code> and similar events, and create a stream
device in devtmpfs for it <code>/dev/input/jsN</code>.</p>

<p>The handler character device supports a bunch of standard ioctl calls
to get/set info:</p>

<ul>
  <li><code>JSIOCGVERSION</code>: get driver version</li>
  <li><code>JSIOCGAXES</code>: get number of axes</li>
  <li><code>JSIOCGBUTTONS</code>: get number of buttons</li>
  <li><code>JSIOCGNAME(len)</code>: get identifier string</li>
  <li><code>JSIOCSCORR</code>: set correction values</li>
  <li><code>JSIOCGCORR</code>: get correction values</li>
  <li><code>JSIOCSAXMAP</code>: set axis mapping</li>
  <li><code>JSIOCGAXMAP</code>: get axis mapping</li>
  <li><code>JSIOCSBTNMAP</code>: set button mapping</li>
  <li><code>JSIOCGBTNMAP</code>: get button mapping</li>
</ul>

<p>Obviously, it’s better to do this via tools such as:</p>

<ul>
  <li><code>jstest</code> and <code>jstest-gtk</code></li>
  <li><code>jscal</code></li>
  <li><code>joyful</code></li>
</ul>

<h2 id="upper-stack-x11--wayland">Upper Stack: X11 &amp; Wayland</h2>

<p>We’ve reached the graphical environment with desktop widget libraries such
as GNOME and Qt, and the XServer and Wayland Compositors. They’re
the ones that rely on all types of input events for concrete behavior,
from clicking buttons on the appropriate window, drawing a cursor
on screen, scrolling, and literally all interactions a user has with
a computer.<br>
This upper stack relies on libinput and XKB to make everything happen. As
far as these two are concerned, the role of the upper stack is to
initialize them with the right configurations, and then create the
handling for whatever they’re meant to do.</p>

<p>The big difference between the X11 stack and Wayland stack is related to
the protocol and where these libraries are included. There are no window
managers in Wayland, but compositors that fully implement the standard
protocol of both a display server and window manager at the same time. So
it’s not a two-process equation, the compositor is the one handling
libinput and implementing the desktop interface. Meanwhile, in X11, the
Xserver, which is quite old, has the abstract concept of input drivers,
of which the currently only useful one is <code>xf86-input-libinput</code>. The
X11 input are interfaced with through the X11 protocol with XInput
events shared to the WM and other clients so that they can use them,
and configure the server’s input devices. Similarly, in X11 all the
configurations happen over the X protocol and its extensions, meanwhile
for compositors there’s no agreed way to configure things, so each
compositor can implement their own thing.<br>
Here’s a general picture of the stack (<a href="https://who-t.blogspot.com/2014/09/libinput-common-input-stack-for-wayland.html">courtesy of
who-t, Peter Hutterer</a>):</p>

<p><img src="https://venam.net/blog/assets/input_devices_linux/xorg-input-stack.png" alt="Xorg Input stack" title="Xorg Input stack"></p>

<p><img src="https://venam.net/blog/assets/input_devices_linux/libinput-input-stack.png" alt="libinput Wayland Compositor Input Stack" title="libinput Wayland Compositor Input Stack"></p>

<p><img src="https://venam.net/blog/assets/input_devices_linux/Libinput_for_Wayland_compositors.png" alt="libinput Wayland Compositor Input Stack 2" title="libinput Wayland Compositor Input Stack 2"></p>

<p>Obviously, each have their own internal representation and ways of managing
the information they get from libinput, XKB, and others, but this is
outside the scope of this article (<code>wl_pointer</code> and <code>wl_keyboard</code> on
Wayland for example). Let’s focus more on how they configure the input
stack we’ve seen.</p>

<p>The X server has an internal store of information about input devices,
and their drivers, and will apply the default settings for each. To
apply specific configurations for certain devices, we can add snippets
in the X11 config directory, usually <code>/usr/share/X11/xorg.conf.d/</code>.
The <code>libinput(4)</code> driver settings can be passed there for a matching
device.</p>

<figure><pre><code data-lang="shell">Section <span>"InputClass"</span>
        Identifier <span>"libinput touchpad catchall"</span>
        MatchIsTouchpad <span>"on"</span>
        MatchDevicePath <span>"/dev/input/event*"</span>
        MatchProduct <span>"substring of the device name"</span>
        Driver <span>"libinput"</span>
        Option <span>"some option name"</span> <span>"the option value"</span>
EndSection</code></pre></figure>

<p>The “Identifier” is just a human-readable string for logging, meanwhile
the series of “Match” statements can be found in <code>xorg.conf(5)</code>, there’s
quite a few of them and they remind us of udev rules. The “Option”
part is what interests us, these are the settings to pass to libinput
and that can be found in <code>libinput(4)</code>. For example:</p>

<figure><pre><code data-lang="shell">Option <span>"AccelSpeed"</span> <span>"float"</span>
Option <span>"ButtonMapping"</span> <span>"string"</span>
Option <span>"DisableWhileTyping"</span> <span>"bool"</span>
Option <span>"ClickMethod"</span> <span>"string"</span>
Option <span>"Tapping"</span> <span>"on"</span></code></pre></figure>

<p>These should all be very familiar by now.</p>

<p>On the X11 stack, the server will initially set these values to override
the default ones, but afterward, during runtime, any caller can rely on
the X protocol to update them. The <code>xinput(1)</code> command can be used to
debug and test setting X input devices.</p>

<p>To list input devices that the X server is aware of:</p>

<div><pre><code>&gt; xinput list
⎡ Virtual core pointer                          id=2    [master pointer  (3)]
⎜   ↳ Virtual core XTEST pointer                id=4    [slave  pointer  (2)]
⎜   ↳ ETPS/2 Elantech Touchpad                  id=15   [slave  pointer  (2)]
⎜   ↳ SEMICO USB Keyboard Consumer Control      id=10   [slave  pointer  (2)]
⎣ Virtual core keyboard                         id=3    [master keyboard (2)]
    ↳ Virtual core XTEST keyboard               id=5    [slave  keyboard (3)]
    ↳ Power Button                              id=6    [slave  keyboard (3)]
    ↳ Video Bus                                 id=7    [slave  keyboard (3)]
    ↳ Power Button                              id=8    [slave  keyboard (3)]
    ↳ Sleep Button                              id=9    [slave  keyboard (3)]
    ↳ AT Translated Set 2 keyboard              id=14   [slave  keyboard (3)]
    ↳ Acer WMI hotkeys                          id=16   [slave  keyboard (3)]
    ↳ GeneralPlus USB Audio Device              id=17   [slave  keyboard (3)]
    ↳ SEMICO USB Keyboard Consumer Control      id=11   [slave  keyboard (3)]
    ↳ SEMICO USB Keyboard System Control        id=12   [slave  keyboard (3)]
    ↳ SEMICO USB Keyboard                       id=13   [slave  keyboard (3)]
</code></pre></div>

<p><em>NB</em>: Keep in mind the XTEST virtual devices, which only exist within
X11 internally and don’t appear in <code>libinput list-devices</code>, we’ll get
back to these in the next section.</p>

<p>Or list the properties of a particular device entry:</p>

<figure><pre><code data-lang="shell"><span>&gt;</span> xinput list-props 14
Device <span>'AT Translated Set 2 keyboard'</span>:
        Device Enabled <span>(</span>147<span>)</span>:   1
        libinput Rotation Angle <span>(</span>263<span>)</span>:  0.000000
        libinput Rotation Angle Default <span>(</span>264<span>)</span>:  0.000000
        libinput Send Events Modes Available <span>(</span>265<span>)</span>:     1, 0
        libinput Send Events Mode Enabled <span>(</span>266<span>)</span>:        0, 0
        libinput Send Events Mode Enabled Default <span>(</span>267<span>)</span>:        0, 0
        Device Node <span>(</span>268<span>)</span>:      <span>"/dev/input/event4"</span>
        Device Product ID <span>(</span>269<span>)</span>:        1, 1</code></pre></figure>

<p>Or setting particular properties:</p>

<figure><pre><code data-lang="shell"><span>&gt;</span> xinput set-prop <span>"the device name"</span> <span>"the property name"</span> value <span>[</span>value2]</code></pre></figure>

<p>For example:</p>

<figure><pre><code data-lang="shell"><span>&gt;</span> xinput set-prop <span>'ETPS/2 Elantech Touchpad'</span> <span>"libinput Tapping Enabled"</span> <span>'1'</span>
<span>&gt;</span> xinput set-prop <span>'ETPS/2 Elantech Touchpad'</span> <span>"libinput Accel Speed"</span> <span>'-0.1'</span></code></pre></figure>

<p>What happens here is that the client (<code>xinput</code>) talks to the X server
over the X protocol, then the X server talks to its libinput driver
<code>xf86-input-libinput</code> which in turn talks to libinput and updates its
configurations, and the X server keeps track of all this.</p>

<p>These all look somewhat redundant, as you can see, it’s like having an
intermediate layer. That’s why on Wayland there’s no intermediary, if
a client tells it, through whatever configuration means it exposes, to
set certain settings on an input device, it does it directly via libinput.<br>
Yet, the list of input devices is internal to Wayland, and not exposed
directly in the protocol, that’s why it differs in each compositor
implementation.</p>

<p>For instance, if we’re toggling a setting in GNOME, KDE, MATE, or others,
the behavior will be more direct. In GNOME, things happen through
<code>gsettings</code>:</p>

<div><pre><code>&gt; gsettings list-keys  org.gnome.desktop.peripherals.
org.gnome.desktop.peripherals.keyboard
org.gnome.desktop.peripherals.mouse
org.gnome.desktop.peripherals.trackball
org.gnome.desktop.peripherals.pointingstick
org.gnome.desktop.peripherals.touchpad
…
&gt; gsettings list-keys  org.gnome.desktop.peripherals.mouse
accel-profile
double-click
drag-threshold
left-handed
middle-click-emulation
natural-scroll
speed
&gt; gsettings get org.gnome.desktop.peripherals.mouse accel-profile
'default'
</code></pre></div>

<p>So that’s how you’d configure input devices on GNOME Wayland compositor
Mutter. Yet that’s annoying, isn’t there a common way to do this on
Wayland?<br>
There are workarounds such as
<a href="https://github.com/lz42/libinput-config">libinput-config</a> but it’s not
very well maintained.</p>

<p>So, clients in graphical environments need to get input events to
them. On X11 these are called X events, and they can be spied on with the
<code>xev(1)</code> tool, which can help debug issues. It shows events sent to the
particular window chosen.<br>
In theory on X11 one could catch all events on the “root window” is
subscribed to (<code>xev -root</code> does that) or of any other window. Events
conceptually travel down the window hierarchy, and clients only
receive the events for which they have selected an appropriate event
mask. However, the root window always sits at the top of this hierarchy
and can optionally subscribe to essentially all events before they
propagate to child windows, while grabs and higher-priority selections
(such as by the window manager) can intercept or redirect them. That’s
how WMs work, they’re the parent window and have an “event mask” to
catch certain events and input for itself, and is exclusively allowed
to do redirect of certain events such as mapping/moving/configuring
windows.<br>
Meanwhile, a sort of equivalent, but more simple, tool on Wayland is
called <a href="https://github.com/jwrdegoede/wev">wev</a>, we’ll do the comparison
in a bit to help us understand the differences. Here’s a trace of <code>xev</code></p>

<figure><pre><code data-lang="shell"><span>&gt;</span> xev <span>-event</span> keyboard
KeyRelease event, serial 28, synthetic NO, window 0x2e00001,
    root 0x3fa, subw 0x0, <span>time </span>465318306, <span>(</span>81,81<span>)</span>, root:<span>(</span>893,376<span>)</span>,
    state 0x10, keycode 108 <span>(</span>keysym 0xff20, Multi_key<span>)</span>, same_screen YES,
    XLookupString gives 0 bytes: 
    XFilterEvent returns: False
…
KeyRelease event, serial 28, synthetic NO, window 0x2e00001,
    root 0x3fa, subw 0x0, <span>time </span>465318602, <span>(</span>81,81<span>)</span>, root:<span>(</span>893,376<span>)</span>,
    state 0x10, keycode 48 <span>(</span>keysym 0x27, apostrophe<span>)</span>, same_screen YES,
    XLookupString gives 1 bytes: <span>(</span>27<span>)</span> <span>"'"</span>
    XFilterEvent returns: False
KeyPress event, serial 28, synthetic NO, window 0x2e00001,
    root 0x3fa, subw 0x0, <span>time </span>465318866, <span>(</span>81,81<span>)</span>, root:<span>(</span>893,376<span>)</span>,
    state 0x10, keycode 26 <span>(</span>keysym 0x65, e<span>)</span>, same_screen YES,
    XLookupString gives 1 bytes: <span>(</span>65<span>)</span> <span>"e"</span>
    XmbLookupString gives 1 bytes: <span>(</span>65<span>)</span> <span>"e"</span>
    XFilterEvent returns: True
KeyPress event, serial 28, synthetic NO, window 0x2e00001,
    root 0x3fa, subw 0x0, <span>time </span>465318866, <span>(</span>81,81<span>)</span>, root:<span>(</span>893,376<span>)</span>,
    state 0x10, keycode 0 <span>(</span>keysym 0xe9, eacute<span>)</span>, same_screen YES,
    XLookupString gives 0 bytes: 
    XmbLookupString gives 2 bytes: <span>(</span>c3 a9<span>)</span> <span>"é"</span>
    XFilterEvent returns: False</code></pre></figure>

<p>As you can observe here, The Xlib client does a lookup for keycode to
keysym translation by relying on functions such as <code>XLookupString</code> and
<code>XmbLookupString</code>. These particular functions use a keymap logic that
dates back to pre-XKB time, we’ll talk more about them in a bit. Yet,
internally now, the X server does rely on XKB in the backend, just like
for input device info, it keeps a keymap table internally, and it’s
shared over the X protocol with clients (they ask for it at connection,
or lazily when calling functions, and cache it) so that they perform
the translation with Xlib or XCB.<br>
There are two main formats for the shared X server keymap the clients
can rely on: the old “X core keymap”, and an XKB keymap. We’ll discuss
that old core keymap in a bit.<br>
In XCB, the old keymap translation is done via:</p>
<ul>
  <li><code>xcb_key_symbols_get_keycode</code></li>
  <li><code>xcb_key_symbols_get_keysym</code></li>
</ul>

<p>And in Xlib with functions such as:</p>

<ul>
  <li><code>XLookupString</code></li>
  <li><code>Xutf8LookupString</code></li>
  <li><code>XLookupKeysym</code></li>
  <li><code>XkbTranslateKeyCode</code></li>
  <li><code>XkbTranslateKeySym</code></li>
  <li><code>XStringToKeysym</code></li>
  <li><code>XKeysymToKeycode</code></li>
</ul>

<p>Meanwhile, with the newer XKB keymap it’s done via:</p>
<ul>
  <li><code>XkbTranslateKeyCode</code></li>
</ul>

<p>Or in XCB with the <code>xcb_xkb_*</code> functions (you have to do it manually).</p>

<p>In all cases, since XKB is the tech in the backend of the X server
that stores the keymap truth, it’s what needs to be configured. The XKB
configuration can be set statically, along with the usual input confs
we’ve seen earlier, with the Xkb options:</p>

<figure><pre><code data-lang="shell">Section <span>"InputClass"</span>
        Identifier <span>"system-keyboard"</span>
        MatchIsKeyboard <span>"on"</span>
        Option <span>"XkbLayout"</span> <span>"us"</span>
        Option <span>"XkbModel"</span> <span>"pc104"</span>
        Option <span>"XkbVariant"</span> <span>"dvorak"</span>
        Option <span>"XkbOptions"</span> <span>"terminate:ctrl_alt_bksp"</span>
EndSection</code></pre></figure>

<p>There are also two special options that get interpreted when certain
special keysym are generated, the <code>DontVTSwitch</code> which is there to disable
the <code>ctrl+alt+fn</code> sequence to switch virtual terminal, and the <code>DontZap</code>
which catches the <code>Terminate_Server</code> keysym of XKB and will kill the Xorg
server. Both are enabled by default and these options would turn them off.</p>

<p>To change the XKB options on a running X server on-the-fly, we need to
rely on two tools: <code>xkbcomp(1)</code> and <code>setxkbmap(1)</code>. The first one is
used to compile new KcCGST and upload it to the server as a full keymap
in XKM compiled format that the server understands, and the second one
to change the current value of the RMLVO.</p>

<div><pre><code>$ setxkbmap -model thinkpad60 -layout us,sk,de -variant altgr-intl,qwerty \
       -option -option grp:menu_toggle -option grp_led:caps -print
</code></pre></div>

<p>We can get the same info as with <code>xkbcli</code> too:</p>

<figure><pre><code data-lang="shell"><span>&gt;</span> setxkbmap <span>-print</span> <span>-verbose</span> 10
Setting verbose level to 10
locale is C
Trying to load rules file ./rules/evdev...
Trying to load rules file /usr/share/X11/xkb/rules/evdev...
Success.
Applied rules from evdev:
rules:      evdev
model:      pc105
layout:     us
options:    compose:ralt
Trying to build keymap using the following components:
keycodes:   evdev+aliases<span>(</span>qwerty<span>)</span>
types:      <span>complete
</span>compat:     <span>complete
</span>symbols:    pc+us+inet<span>(</span>evdev<span>)</span>+compose<span>(</span>ralt<span>)</span>
geometry:   pc<span>(</span>pc105<span>)</span>
xkb_keymap <span>{</span>
        xkb_keycodes  <span>{</span> include <span>"evdev+aliases(qwerty)"</span> <span>}</span><span>;</span>
        xkb_types     <span>{</span> include <span>"complete"</span>      <span>}</span><span>;</span>
        xkb_compat    <span>{</span> include <span>"complete"</span>      <span>}</span><span>;</span>
        xkb_symbols   <span>{</span> include <span>"pc+us+inet(evdev)+compose(ralt)"</span>       <span>}</span><span>;</span>
        xkb_geometry  <span>{</span> include <span>"pc(pc105)"</span>     <span>}</span><span>;</span>
<span>}</span><span>;</span></code></pre></figure>

<p>Now let’s talk about that pre-XKB logic with functions such as
<code>XLookupKeysym(3)</code> we’ve seen in the <code>xev</code> trace earlier. It’s currently
basically a wrapper over XKB, but that can also bypass it entirely. It
relies on the old “X core keymap table” in the X server, a facade on
the authoritative keymap that is XKB backed. The client asks for it
via a request, cache it, and use it for the mapping of X11 keycode
to X11 keysym. It’s own X11 keycodes are implementation dependent,
but nowadays it’s mostly <code>evdev + 8</code>, and its keysyms are found in
<code>/usr/include/X11/keysymdef.h</code>, which the newer XKB stack also relies
on in X11. So that old keymap is indeed initially filled with the XKB
keymap. The tool <code>xmodmap(1)</code> will help us explore and show some of the
things it handles.</p>

<p>To print its internal keymap table:</p>

<div><pre><code>&gt; xmodmap -pk
There are 7 KeySyms per KeyCode; KeyCodes range from 8 to 255.

    KeyCode Keysym (Keysym)   ...
    Value   Value   (Name)    ...

      8
      9     0xff1b (Escape)   0x0000 (NoSymbol) 0xff1b (Escape)
     10     0x0031 (1)  0x0021 (exclam)   0x0031 (1)  0x0021 (exclam)
     11     0x0032 (2)  0x0040 (at) 0x0032 (2)  0x0040 (at)
     12     0x0033 (3)  0x0023 (numbersign)  0x0033 (3)  0x0023 (numbersign)
     13     0x0034 (4)  0x0024 (dollar)   0x0034 (4)  0x0024 (dollar)
     14     0x0035 (5)  0x0025 (percent)  0x0035 (5)  0x0025 (percent)
     15     0x0036 (6)  0x005e (asciicircum) 0x0036 (6)  0x005e (asciicircum)
     16     0x0037 (7)  0x0026 (ampersand)   0x0037 (7)  0x0026 (ampersand)
     17     0x0038 (8)  0x002a (asterisk) 0x0038 (8)  0x002a (asterisk)
</code></pre></div>

<p>And print the modifiers:</p>

<div><pre><code>&gt; xmodmap -pm
xmodmap:  up to 3 keys per modifier, (keycodes in parentheses):

shift       Shift_L (0x32),  Shift_R (0x3e)
lock        Caps_Lock (0x42)
control     Control_L (0x25),  Control_R (0x69)
mod1        Alt_L (0x40),  Alt_L (0xcc),  Meta_L (0xcd)
mod2        Num_Lock (0x4d)
mod3        ISO_Level5_Shift (0xcb)
mod4        Super_L (0x85),  Super_R (0x86),  Super_L (0xce)
mod5        ISO_Level3_Shift (0x5c)
</code></pre></div>

<p>Or print the keymap as “expressions”:</p>

<figure><pre><code data-lang="shell">keycode   8 <span>=</span>
keycode   9 <span>=</span> Escape NoSymbol Escape
keycode  10 <span>=</span> 1 exclam 1 exclam
keycode  11 <span>=</span> 2 at 2 at
keycode  12 <span>=</span> 3 numbersign 3 numbersign
keycode  13 <span>=</span> 4 dollar 4 dollar
keycode  14 <span>=</span> 5 percent 5 percent
keycode  15 <span>=</span> 6 asciicircum 6 asciicircum
keycode  16 <span>=</span> 7 ampersand 7 ampersand
keycode  17 <span>=</span> 8 asterisk 8 asterisk</code></pre></figure>

<p>Yes, <code>xmodmap</code> has its own configuration in <code>~/.Xmodmap</code> and expression
grammar that looks something like a simplified version of XKB:</p>

<div><pre><code>! remove Caps Lock functionality
remove Lock = Caps_Lock

! make CapsLock (keycode 66) act as Tab
keycode 66 = Tab

! set Menu key (keycode 134) properly
keycode 134 = Menu

! Set Right Alt as Compose (Multi_key)
! Use keysym form so you don't need to know the numeric keycode:
keycode 108 = Multi_key

! ensure Right Alt is not still treated as an Alt modifier
remove Mod1 = Alt_R
</code></pre></div>

<p>Or on-the-fly with:</p>

<figure><pre><code data-lang="shell">xmodmap <span>-e</span> <span>"remove Lock = Caps_Lock"</span>
xmodmap <span>-e</span> <span>"keycode 66 = Tab"</span>
xmodmap <span>-e</span> <span>"keycode 134 = Menu"</span></code></pre></figure>

<p>There’s even the <code>xkeycaps</code> GUI around it, and wrappers like
<a href="https://github.com/alols/xcape"><code>xcape</code></a>.</p>

<p>Yet, GNOME and certain other toolkits and desktop environments
have stopped relying on the old core keymap a long time ago,
deprecating it in favor of the XKB related functions. Still, the
X server will internally reflect these changes in its XKB cache,
making them internally compatible, notifying X clients of teh
change, and it’ll work but temporarily
(mainly with <code>XChangeKeyboardMapping</code> which calls
<a href="https://gitlab.freedesktop.org/xorg/xserver/-/blob/master/xkb/xkbUtils.c#L549"><code>XkbApplyMappingChange</code></a>
in the X Server). It’s fragile and legacy. Also, changing the keymap with
<code>xmodmap</code> is flimsy since any time the XKB keymap is reloading the changes
to the old in-memory X keymap compatibility is lost. Those combined
together means that it isn’t reliable to use the old X11 core keymap.</p>

<p>As you can see yet again, this is quite confusing and redundant, and
obviously Wayland doesn’t have these old layers of indirection and
relies on XKB directly. It also doesn’t need a compiled forms like XKM
to upload keymaps to the server, but it doesn’t even include that upload
part in the protocol anyhow. The keycode to keysym translation is also
done in the client (with calls such as <code>xkb_state_key_get_one_sym</code>)
but the keymap is directly shared along the <code>wl_keyboard</code> object that
it gets accessed to when it wants input access on the seat, so there’s
no need for another round-trip.</p>

<p>Yet, again the configuration of XKB-related stuff on Wayland depends on
the compositor implementation.</p>

<p>For example
<a href="https://github.com/swaywm/wlroots/blob/4984ea49eeaa292d66be9e535d93a4d8185f3e18/examples/simple.c#L113">wlroots</a>
relies on environment variables to set the RMLVO.<br>
GNOME on <code>gsettings</code> with</p>
<div><pre><code>gsettings set org.gnome.desktop.input-sources sources "[('xkb', 'us'), ('xkb', 'fr')]"
</code></pre></div>
<p>Hyprland has</p>
<div><pre><code>hyprctl keyword input:kb_layout "us,fr"
</code></pre></div>
<p>And etc…</p>

<figure><pre><code data-lang="shell"><span>&gt;</span> gsettings list-recursively org.gnome.desktop.input-sources
org.gnome.desktop.input-sources current uint32 0
org.gnome.desktop.input-sources mru-sources @a<span>(</span>ss<span>)</span> <span>[]</span>
org.gnome.desktop.input-sources per-window <span>false
</span>org.gnome.desktop.input-sources show-all-sources <span>false
</span>org.gnome.desktop.input-sources sources <span>[(</span><span>'xkb'</span>, <span>'us'</span><span>)]</span>
org.gnome.desktop.input-sources xkb-model <span>'pc105+inet'</span>
org.gnome.desktop.input-sources xkb-options <span>[</span><span>'compose:ralt'</span><span>]</span></code></pre></figure>

<p>Let’s go back to the
<a href="https://github.com/jwrdegoede/wev/blob/master/wev.c"><code>wev</code></a> tool,
which displays input events on Wayland, it’ll help us understand a
huge difference in input handling on Wayland compared to X11. Unlike X
severs, a Wayland compositor doesn’t propagate and broadcast the events
globally to anyone listening. Instead, clients must explicitly register
a listener for the objects they care about. These are announced via the
global Wayland registry, which it has to register to (<code>wl_registry</code>).<br>
Afterward, a client has to bind and listen to the given seat (<code>wl_seat</code>)
of the given name by the registry (this is where the <code>ENV{ID_SEAT}</code> and
<code>loginctl</code> can help since they often map 1-to-1), and advertise the set of
“seat capabilities” it requires and wants to bind to, such as pointer,
keyboard, or touch. Once bound, the client can now fetch a handle to the
<code>wl_&lt;pointer/keyboard/touch&gt;</code> objects, and register listener handlers
for their events. Let’s note that a <code>wl_keyboard</code> is an abstraction
of all logical keyboard events. So clients aren’t aware of underlying
devices, it’s abstracted and aggregated in the compositor internally,
by its own logic. Plus, for extra security, <code>wl_&lt;pointer/keyboard/touch&gt;</code>
events are only forwarded to the currently focused client. All and all,
it’s very choreographed, unlike in X11.</p>

<p>Beyond the core protocol, there are more “unstable”
or “non-standard” extensions that allow clients to do
more things related to input. Here’s a non-exhaustive
<a href="https://wayland.app/protocols/pointer-constraints-unstable-v1">list</a>:</p>

<ul>
  <li>Repositioning the pointer (<code>wp_pointer_warp_v1</code>)</li>
  <li>Subscribing to high-def keyboard timestamps (<code>zwp_input_timestamps_manager_v1</code>)</li>
  <li>Ignoring keyboard shortcuts from a client (<code>zwp_keyboard_shortcuts_inhibit_manager_v1</code>)</li>
  <li>Adding constraints to pointer motion (<code>zwp_pointer_constraints_v1</code>)</li>
  <li>Register to handle gestures, swipe, pinch, and hold (<code>zwp_pointer_gestures_v1</code>)</li>
  <li>Specific XWayland grabbing of input, monopolizing it (<code>zwp_xwayland_keyboard_grab_manager_v1</code>)</li>
  <li>Grab hotkeys, usually not needed since the compositor do this (<code>hyprland_global_shortcuts_manager_v1</code>)</li>
  <li>Grab/Inhibit an input to a single surface such as lock screen (<code>zwlr_input_inhibit_manager_v1</code>, <code>hyprland_focus_grab_manager_v1</code>)</li>
  <li>Create virtual pointer/keyboard, fake input (<code>zwlr_virtual_pointer_manager_v1</code>, <code>org_kde_kwin_fake_input</code>, <code>zwp_virtual_keyboard_v1</code>)</li>
</ul>

<p>Notice too that nowhere in the protocol is there any interface
to list the compositor’s internal input devices in its registry,
it’s intentionally abstracted away. It’s up to each compositor
to choose if it wants to expose this info. To my knowledge,
there’s only Sway that offers an interface for this through
<a href="https://man.archlinux.org/man/sway-input.5">swaymsg</a>, it’s kind of
similar to <code>gsettings</code>.</p>



<p>The closest compositor-agnostic tools are external utilities such
as <code>libinput list-devices</code> or <code>loginctl seat-status</code>. However, these
enumerate kernel devices, not the compositor’s internal virtual devices,
so you will not see compositor-created synthetic devices there.</p>

<p>In short, which compositor implements which part of the “non-standard”
protocol varies a lot. GNOME uses almost none of the wlroots/WLR
extensions. KDE uses KDE-specific extensions. wlroots-based
compositors share WLR extensions. It’s a mix really, check
<a href="https://wayland.app/protocols/">this</a> for support and more info.</p>

<p>We mentioned before <code>localectl</code> too for setting keyboard keymap
setups that works across environments. Let’s add that when using
the <code>set-x11-keymap</code> option it will modify X11 configurations in
<code>/etc/X11/xorg.conf.d/00-keyboard.conf</code> and pre-fill them for you so
you won’t have to worry about editing anything with the options we’ve
listed. It doesn’t have this option for Wayland though.</p>

<div><pre><code>&gt; localectl [--no-convert] set-x11-keymap layout [model [variant [options]]]
</code></pre></div>

<p>Yet, what if someone on Wayland wants to remap just a specific
key without passing by the static XKB and its mess, just a
quick runtime change. There’s no real solution to that other
than what we’ve already mentioned in the scancode to keycode
section, namely tools that rely on evdev interception to remap events
such as <code>evmapd</code>, <code>evremap</code>, <code>evdevremapkeys</code>, <code>evsieve</code>,
<a href="https://github.com/rvaiya/keyd"><code>keyd</code></a> , <code>kbct</code>, <code>makima</code>,
<a href="https://github.com/sezanzeb/input-remapper/"><code>input-remapper</code></a>,
etc.. A true panoply of tools that are hacks. Most, if not all, of
these  work by intercepting evdev events, creating a new virtual device
(we’ll see how <code>uinput</code> works in the next section), and modifying the
events on-the-fly to write them to the virtual device. This adds a new
unnecessary layer of indirection, which you should obviously avoid if
you are doing anything speed sensitive with the keyboard. Furthermore,
some of these re-include the key composition and a semblance of XKB
logic within them, which creates a total mess.<br>
Let’s continue…</p>

<p>Contrary to everything else in the GUI stack, XKB composition is a
bit less cumbersome. Both Wayland clients, through their toolkits
(GTK, Qt, etc..) and X11, through Xlib with the functions we’ve seen
earlier that do it out-of-the-box (<code>XLookupString</code>), rely on the
same configuration files we’ve discussed in the XKB section. Namely,
<code>/usr/share/X11/locale/&lt;locale&gt;/Compose</code> and the home <code>~/.XCompose</code>. It
follows the simple format described in <code>Compose(5)</code>.</p>

<p>And lastly, one thing that isn’t handled neither in libinput nor XKB is
key repeat: how long when pressing a key will the client wait to print
it again.</p>

<p>In X11 this is configured in the X Server, either as a startup option
<code>-ardelay</code> and <code>-arinterval</code>, or dynamically via <code>xset(1)</code>. There’s the
option to set the delay and interval for a specific key too.</p>

<div><pre><code>&gt; xset r rate delay [rate]
&gt; xset r rate 210 50
</code></pre></div>

<p>If you inspect <code>xev</code> you’ll see that the server resends keys to the
client continuously.</p>

<p>Meanwhile, as with everything else on Wayland, it depends on the
compositor. The compositor sends to the clients the repeat parameters
<code>wl_keyboard.repeat_info(rate, delay)</code> and it’s up to them to respect
it. So, the compositor doesn’t keep forwarding the key to the client but
instead this is handled directly in the client.<br>
And similarly, these are configured in <code>gsettings</code> and other
compositor-specific configurations.</p>

<p>The repeat key rate and delay being delegated to
clients on Wayland has had its share of issues it created though
(<a href="https://www.csslayer.info/wordpress/linux/key-repetition-and-key-event-handling-issue-with-wayland-input-method-protocols/">see</a>)
and some people want to have it <a href="https://gitlab.freedesktop.org/wayland/wayland/-/merge_requests/368">back in the
compositor</a>.</p>

<p>That’s it, we’ve covered most of the things we wanted in the upper
graphical stack.</p>

<p><img src="https://venam.net/blog/assets/input_devices_linux/de_upper_stack.png" alt="DE/Upper Stack Overview" title="DE/Upper Stack Overview"></p>

<h2 id="virtual-input-automation-emulation-and-remote-desktop">Virtual Input, Automation, Emulation, and Remote Desktop</h2>

<p>We’ve grazed the topic of virtual inputs before, in this section we’ll
see what types exist and where they’re used, from automation, emulation,
and remote desktop.</p>

<p>The first layer where we can create virtual input devices is at the
kernel layer. It provides two modules that can be used for this:
<code>UHID</code>, User-space I/O driver support for HID subsystem, and uinput,
the User-space input emulation module.</p>

<p>The <a href="https://docs.kernel.org/5.10/hid/uhid.html">uhid module</a>,
as the name implies, allows simulating HID events from user-space
by reading/writing to a special character device in devtmpfs
<code>/dev/uhid</code>. The interface is quite simple as is shown in <a href="https://github.com/torvalds/linux/blob/master/samples/uhid/uhid-example.c">this
example</a>.
However, this is only used for emulating devices and debugging, not for
the average user’s virtual input. This is the underlying mechanism behind
<code>hid-record</code> and <code>hid-replay</code>, which can easily allow debugging hid
issues by reproducing the exact sequences of events on anyone’s machine.</p>

<p>While uhid acts in the HID layer, the uinput module
(<code>drivers/input/misc/uinput.c</code>) acts at the input core layer, which
makes it more approachable for basic input event virtualisation.<br>
It is also a character device in devtmpfs <code>/dev/uinput</code> that exposes
particular ioctl to create, manage, and configure capabilities of a
virtual device, and then allow writing to <code>/dev/uinput</code> file descriptor
to simulate the events of said device. The device will appear, like any
other input device, in devtmpfs and sysfs, since it’ll pass by the same
pipeline with <code>struct input_dev</code> and the default evdev event handler.</p>

<p>There are two main ways to use uinput in the code, via <code>&lt;linux/uinput.h&gt;</code>
or via <code>&lt;libevdev/libevdev-uinput.h&gt;</code>. The libevdev mechanism is simpler
and recommended.</p>

<p>Example 1:</p>

<figure><pre><code data-lang="c"><span>#include</span> <span>&lt;unistd.h&gt;</span><span>
#include</span> <span>&lt;linux/uinput.h&gt;</span><span>
#include</span> <span>&lt;fcntl.h&gt;</span><span>
#include</span> <span>&lt;string.h&gt;</span><span>
#include</span> <span>&lt;stdio.h&gt;</span><span>
#include</span> <span>&lt;errno.h&gt;</span><span>
#include</span> <span>&lt;linux/uinput.h&gt;</span><span>
</span>
<span>void</span> <span>emit</span><span>(</span><span>int</span> <span>fd</span><span>,</span> <span>int</span> <span>type</span><span>,</span> <span>int</span> <span>code</span><span>,</span> <span>int</span> <span>val</span><span>)</span>
<span>{</span>
   <span>struct</span> <span>input_event</span> <span>ie</span><span>;</span>

   <span>ie</span><span>.</span><span>type</span> <span>=</span> <span>type</span><span>;</span>
   <span>ie</span><span>.</span><span>code</span> <span>=</span> <span>code</span><span>;</span>
   <span>ie</span><span>.</span><span>value</span> <span>=</span> <span>val</span><span>;</span>
   <span>/* timestamp values below are ignored */</span>
   <span>ie</span><span>.</span><span>time</span><span>.</span><span>tv_sec</span> <span>=</span> <span>0</span><span>;</span>
   <span>ie</span><span>.</span><span>time</span><span>.</span><span>tv_usec</span> <span>=</span> <span>0</span><span>;</span>

   <span>write</span><span>(</span><span>fd</span><span>,</span> <span>&amp;</span><span>ie</span><span>,</span> <span>sizeof</span><span>(</span><span>ie</span><span>));</span>
<span>}</span>

<span>int</span> <span>main</span><span>(</span><span>void</span><span>)</span>
<span>{</span>
   <span>struct</span> <span>uinput_setup</span> <span>usetup</span><span>;</span>

   <span>int</span> <span>fd</span> <span>=</span> <span>open</span><span>(</span><span>"/dev/uinput"</span><span>,</span> <span>O_WRONLY</span> <span>|</span> <span>O_NONBLOCK</span><span>);</span>


   <span>/*
    * The ioctls below will enable the device that is about to be
    * created, to pass key events, in this case the space key.
    */</span>
   <span>ioctl</span><span>(</span><span>fd</span><span>,</span> <span>UI_SET_EVBIT</span><span>,</span> <span>EV_KEY</span><span>);</span>
   <span>ioctl</span><span>(</span><span>fd</span><span>,</span> <span>UI_SET_KEYBIT</span><span>,</span> <span>KEY_SPACE</span><span>);</span>

   <span>memset</span><span>(</span><span>&amp;</span><span>usetup</span><span>,</span> <span>0</span><span>,</span> <span>sizeof</span><span>(</span><span>usetup</span><span>));</span>
   <span>usetup</span><span>.</span><span>id</span><span>.</span><span>bustype</span> <span>=</span> <span>BUS_USB</span><span>;</span>
   <span>usetup</span><span>.</span><span>id</span><span>.</span><span>vendor</span> <span>=</span> <span>0x1234</span><span>;</span> <span>/* sample vendor */</span>
   <span>usetup</span><span>.</span><span>id</span><span>.</span><span>product</span> <span>=</span> <span>0x5678</span><span>;</span> <span>/* sample product */</span>
   <span>strcpy</span><span>(</span><span>usetup</span><span>.</span><span>name</span><span>,</span> <span>"Example device"</span><span>);</span>

   <span>ioctl</span><span>(</span><span>fd</span><span>,</span> <span>UI_DEV_SETUP</span><span>,</span> <span>&amp;</span><span>usetup</span><span>);</span>
   <span>ioctl</span><span>(</span><span>fd</span><span>,</span> <span>UI_DEV_CREATE</span><span>);</span>

   <span>/*
    * On UI_DEV_CREATE the kernel will create the device node for this
    * device. We are inserting a pause here so that user-space has time
    * to detect, initialize the new device, and can start listening to
    * the event, otherwise it will not notice the event we are about
    * to send. This pause is only needed in our example code!
    */</span>
   <span>sleep</span><span>(</span><span>60</span><span>);</span>

   <span>/* Key press, report the event, send key release, and report again */</span>
   <span>emit</span><span>(</span><span>fd</span><span>,</span> <span>EV_KEY</span><span>,</span> <span>KEY_SPACE</span><span>,</span> <span>1</span><span>);</span>
   <span>emit</span><span>(</span><span>fd</span><span>,</span> <span>EV_SYN</span><span>,</span> <span>SYN_REPORT</span><span>,</span> <span>0</span><span>);</span>
   <span>emit</span><span>(</span><span>fd</span><span>,</span> <span>EV_KEY</span><span>,</span> <span>KEY_SPACE</span><span>,</span> <span>0</span><span>);</span>
   <span>emit</span><span>(</span><span>fd</span><span>,</span> <span>EV_SYN</span><span>,</span> <span>SYN_REPORT</span><span>,</span> <span>0</span><span>);</span>

   <span>/*
    * Give user-space some time to read the events before we destroy the
    * device with UI_DEV_DESTROY.
    */</span>
   <span>sleep</span><span>(</span><span>100</span><span>);</span>

   <span>ioctl</span><span>(</span><span>fd</span><span>,</span> <span>UI_DEV_DESTROY</span><span>);</span>
   <span>close</span><span>(</span><span>fd</span><span>);</span>

   <span>return</span> <span>0</span><span>;</span>
<span>}</span></code></pre></figure>

<p>Compile with</p>

<div><pre><code>gcc -o uinput_test uinput_test.c -Wall -Wextra
</code></pre></div>

<p>And example 2 with libevdev:</p>

<figure><pre><code data-lang="c"><span>#include</span> <span>&lt;libevdev/libevdev.h&gt;</span><span>
#include</span> <span>&lt;libevdev/libevdev-uinput.h&gt;</span><span>
#include</span> <span>&lt;unistd.h&gt;</span><span>
#include</span> <span>&lt;stdio.h&gt;</span><span>
#include</span> <span>&lt;string.h&gt;</span><span>
#include</span> <span>&lt;errno.h&gt;</span><span>
</span>
<span>int</span> <span>main</span><span>(</span><span>void</span><span>)</span>
<span>{</span>
    <span>struct</span> <span>libevdev</span> <span>*</span><span>dev</span> <span>=</span> <span>NULL</span><span>;</span>
    <span>struct</span> <span>libevdev_uinput</span> <span>*</span><span>uidev</span> <span>=</span> <span>NULL</span><span>;</span>
    <span>int</span> <span>err</span><span>;</span>

    <span>/* Allocate and configure the virtual device */</span>
    <span>dev</span> <span>=</span> <span>libevdev_new</span><span>();</span>
    <span>if</span> <span>(</span><span>!</span><span>dev</span><span>)</span> <span>{</span>
        <span>fprintf</span><span>(</span><span>stderr</span><span>,</span> <span>"Failed to allocate libevdev device</span><span>\n</span><span>"</span><span>);</span>
        <span>return</span> <span>1</span><span>;</span>
    <span>}</span>

    <span>libevdev_set_name</span><span>(</span><span>dev</span><span>,</span> <span>"Example device (libevdev uinput)"</span><span>);</span>
    <span>libevdev_set_id_bustype</span><span>(</span><span>dev</span><span>,</span> <span>BUS_USB</span><span>);</span>
    <span>libevdev_set_id_vendor</span><span>(</span><span>dev</span><span>,</span> <span>0x1234</span><span>);</span>
    <span>libevdev_set_id_product</span><span>(</span><span>dev</span><span>,</span> <span>0x5678</span><span>);</span>

    <span>/* Enable only one key: KEY_SPACE */</span>
    <span>libevdev_enable_event_type</span><span>(</span><span>dev</span><span>,</span> <span>EV_KEY</span><span>);</span>
    <span>libevdev_enable_event_code</span><span>(</span><span>dev</span><span>,</span> <span>EV_KEY</span><span>,</span> <span>KEY_SPACE</span><span>,</span> <span>NULL</span><span>);</span>

    <span>/* Create the uinput device */</span>
    <span>err</span> <span>=</span> <span>libevdev_uinput_create_from_device</span><span>(</span><span>dev</span><span>,</span> <span>LIBEVDEV_UINPUT_OPEN_MANAGED</span><span>,</span> <span>&amp;</span><span>uidev</span><span>);</span>
    <span>if</span> <span>(</span><span>err</span> <span>!=</span> <span>0</span><span>)</span> <span>{</span>
        <span>fprintf</span><span>(</span><span>stderr</span><span>,</span> <span>"Failed to create uinput device: %s</span><span>\n</span><span>"</span><span>,</span> <span>strerror</span><span>(</span><span>-</span><span>err</span><span>));</span>
        <span>return</span> <span>1</span><span>;</span>
    <span>}</span>

    <span>/* A pause to allow the system (udev etc.) to register the device */</span>
    <span>sleep</span><span>(</span><span>100</span><span>);</span>

    <span>/* Emit a space key press */</span>
    <span>libevdev_uinput_write_event</span><span>(</span><span>uidev</span><span>,</span> <span>EV_KEY</span><span>,</span> <span>KEY_SPACE</span><span>,</span> <span>1</span><span>);</span>
    <span>libevdev_uinput_write_event</span><span>(</span><span>uidev</span><span>,</span> <span>EV_SYN</span><span>,</span> <span>SYN_REPORT</span><span>,</span> <span>0</span><span>);</span>

    <span>/* Emit the key release */</span>
    <span>libevdev_uinput_write_event</span><span>(</span><span>uidev</span><span>,</span> <span>EV_KEY</span><span>,</span> <span>KEY_SPACE</span><span>,</span> <span>0</span><span>);</span>
    <span>libevdev_uinput_write_event</span><span>(</span><span>uidev</span><span>,</span> <span>EV_SYN</span><span>,</span> <span>SYN_REPORT</span><span>,</span> <span>0</span><span>);</span>

    <span>/* Let user-space read the events before destruction (optional) */</span>
    <span>sleep</span><span>(</span><span>200</span><span>);</span>

    <span>libevdev_uinput_destroy</span><span>(</span><span>uidev</span><span>);</span>
    <span>libevdev_free</span><span>(</span><span>dev</span><span>);</span>

    <span>return</span> <span>0</span><span>;</span>
<span>}</span></code></pre></figure>

<p>Compile with</p>

<div><pre><code>gcc $(pkg-config --cflags --libs libevdev) -o libevdev_example example.c
</code></pre></div>

<p>The disadvantage of uhid and uinput is that, since they interface with
the kernel, they require root privilege and relying on HID or evdev might
not be practical for the average day-to-day usage. For example, if we
want to output a symbol, let’s say ‘p’, we have to know its keycode, and
for that we need to know the keymapping, which in turn requires XKB or
others. Thus, we’re back to square one and re-creating the upper input
stack from scratch.</p>

<p>What if we could directly say “send this keycode or keysym, it’s from this
virtual device”, without even needing extra permission if we’re already in
a desktop environment. Well, that’s exactly what the X11 XTEST extension
does, and what some Wayland extensions and mechanisms achieve too.</p>

<p>Remember when we used xinput to list some devices and some virtual ones
were listed:</p>

<div><pre><code>&gt; xinput list
Virtual core pointer                          id=2    [master pointer  (3)]
⎜   ↳ Virtual core XTEST pointer                id=4    [slave  pointer  (2)]
…
Virtual core keyboard                         id=3    [master keyboard (2)]
    ↳ Virtual core XTEST keyboard               id=5    [slave  keyboard (3)]
…
</code></pre></div>

<p>These were created by the XTest extension which was written to support
automated testing of X server. These days this can be used for remote
desktop, task automation, password managers (autofill), and others. When
clients interface through this extension they directly inject keyboard
and mouse events into the X server, bypassing the whole input stack,
and these events are propagated afterward to the X clients.<br>
Let’s see a simple programming example relying on <code>XTEST(3)</code> that will
send the keysym “a”:</p>

<figure><pre><code data-lang="c"><span>#include</span> <span>&lt;X11/Xlib.h&gt;</span><span>
#include</span> <span>&lt;X11/extensions/XTest.h&gt;</span><span>
#include</span> <span>&lt;X11/keysym.h&gt;</span><span>
</span>
<span>int</span> <span>main</span><span>()</span> <span>{</span>
    <span>Display</span> <span>*</span><span>dpy</span> <span>=</span> <span>XOpenDisplay</span><span>(</span><span>NULL</span><span>);</span>
    <span>if</span> <span>(</span><span>!</span><span>dpy</span><span>)</span> <span>return</span> <span>1</span><span>;</span>

    <span>KeyCode</span> <span>kc</span> <span>=</span> <span>XKeysymToKeycode</span><span>(</span><span>dpy</span><span>,</span> <span>XStringToKeysym</span><span>(</span><span>"a"</span><span>));</span>
    <span>XTestFakeKeyEvent</span><span>(</span><span>dpy</span><span>,</span> <span>kc</span><span>,</span> <span>True</span><span>,</span>  <span>0</span><span>);</span>
    <span>XTestFakeKeyEvent</span><span>(</span><span>dpy</span><span>,</span> <span>kc</span><span>,</span> <span>False</span><span>,</span> <span>0</span><span>);</span>

    <span>XFlush</span><span>(</span><span>dpy</span><span>);</span>
    <span>XCloseDisplay</span><span>(</span><span>dpy</span><span>);</span>
    <span>return</span> <span>0</span><span>;</span>
<span>}</span></code></pre></figure>

<p>Compile with:</p>

<div><pre><code>&gt; gcc xtest_min.c -o xtest_min -lX11 -lXtst
</code></pre></div>

<p>That’s clean and easy, now on Wayland the picture is a bit more complex
since the protocol doesn’t allow clients to randomly generate input
events. It was designed this way for security reasons.</p>

<p>As with anything Wayland, there are a few unstable extensions,
though deprecated now, such as <code>zwlr_virtual_pointer_v1</code> and
<code>zwp_virtual_keyboard_manager_v1</code>, mostly wlroots Wayland extensions.</p>

<p>An example of the <code>zwp_virtual_keyboard_manager_v1</code> extension would look
somewhat like this:</p>

<figure><pre><code data-lang="c"><span>#define _POSIX_C_SOURCE 200809L
#include</span> <span>&lt;wayland-client.h&gt;</span><span>
#include</span> <span>"virtual-keyboard-unstable-v1-client-protocol.h"</span><span>
</span>
<span>static</span> <span>struct</span> <span>zwp_virtual_keyboard_v1</span> <span>*</span><span>vk</span><span>;</span>

<span>static</span> <span>void</span> <span>global_add</span><span>(</span><span>void</span> <span>*</span><span>data</span><span>,</span> <span>struct</span> <span>wl_registry</span> <span>*</span><span>reg</span><span>,</span>
                       <span>uint32_t</span> <span>name</span><span>,</span> <span>const</span> <span>char</span> <span>*</span><span>iface</span><span>,</span> <span>uint32_t</span> <span>ver</span><span>)</span> <span>{</span>
    <span>if</span> <span>(</span><span>strcmp</span><span>(</span><span>iface</span><span>,</span> <span>zwp_virtual_keyboard_manager_v1_interface</span><span>.</span><span>name</span><span>)</span> <span>==</span> <span>0</span><span>)</span> <span>{</span>
        <span>auto</span> <span>*</span><span>mgr</span> <span>=</span> <span>wl_registry_bind</span><span>(</span><span>reg</span><span>,</span> <span>name</span><span>,</span>
            <span>&amp;</span><span>zwp_virtual_keyboard_manager_v1_interface</span><span>,</span> <span>1</span><span>);</span>
        <span>// NULL seat → compositor chooses default seat</span>
        <span>vk</span> <span>=</span> <span>zwp_virtual_keyboard_manager_v1_create_virtual_keyboard</span><span>(</span><span>mgr</span><span>,</span> <span>NULL</span><span>);</span>
    <span>}</span>
<span>}</span>

<span>static</span> <span>const</span> <span>struct</span> <span>wl_registry_listener</span> <span>reg_listener</span> <span>=</span> <span>{</span>
    <span>.</span><span>global</span> <span>=</span> <span>global_add</span><span>,</span>
    <span>.</span><span>global_remove</span> <span>=</span> <span>NULL</span>
<span>};</span>

<span>int</span> <span>main</span><span>()</span> <span>{</span>
    <span>struct</span> <span>wl_display</span> <span>*</span><span>d</span> <span>=</span> <span>wl_display_connect</span><span>(</span><span>NULL</span><span>);</span>
    <span>struct</span> <span>wl_registry</span> <span>*</span><span>reg</span> <span>=</span> <span>wl_display_get_registry</span><span>(</span><span>d</span><span>);</span>
    <span>wl_registry_add_listener</span><span>(</span><span>reg</span><span>,</span> <span>&amp;</span><span>reg_listener</span><span>,</span> <span>NULL</span><span>);</span>

    <span>wl_display_roundtrip</span><span>(</span><span>d</span><span>);</span> <span>// wait until vk is ready</span>

    <span>uint32_t</span> <span>keycode</span> <span>=</span> <span>30</span><span>;</span>   <span>// Linux evdev (KEY_A)</span>
    <span>uint32_t</span> <span>state_pressed</span>  <span>=</span> <span>1</span><span>;</span>
    <span>uint32_t</span> <span>state_released</span> <span>=</span> <span>0</span><span>;</span>

    <span>zwp_virtual_keyboard_v1_key</span><span>(</span><span>vk</span><span>,</span> <span>0</span><span>,</span> <span>keycode</span><span>,</span> <span>state_pressed</span><span>);</span>
    <span>zwp_virtual_keyboard_v1_key</span><span>(</span><span>vk</span><span>,</span> <span>0</span><span>,</span> <span>keycode</span><span>,</span> <span>state_released</span><span>);</span>
    <span>wl_display_flush</span><span>(</span><span>d</span><span>);</span>

    <span>return</span> <span>0</span><span>;</span>
<span>}</span></code></pre></figure>

<p>But for a better example check the source of
<a href="https://git.sr.ht/~brocellous/wlrctl/tree/master/item/keyboard.c#L171"><code>wlrctl</code></a>
that also relies on the <code>zwp_virtual_keyboard_manager_v1</code> extension.</p>

<p>Yet, these days, this isn’t the path that Wayland has taken, and none of
the compositors agree on these extensions, instead they rely on libei,
a library to consolidate Emulated Input. This is its architecture:</p>

<p><img src="https://venam.net/blog/assets/input_devices_linux/libei_arch.png" alt="libei architecture" title="libei architecture">
Courtesy from <a href="https://libinput.pages.freedesktop.org/libei/">https://libinput.pages.freedesktop.org/libei/</a></p>

<p>It has two pieces: a client side that creates virtual devices and
generates evdev events, and the server side called EIS that lives within
the compositor (but that isn’t limited to Wayland) and is responsible for
giving a file descriptor to the client to interface with, and dispatching
received events to where they need to go. The dispatching could be through
uinput devices, that’s an implementation detail, yet most compositors
just store it as an internal virtual device.</p>

<p>This allows compositor to be aware of who is currently emulating input,
which capabilities they require (keyboard, touch, pointer), and to
restrict and/or suspend devices at any time.</p>

<p>Optionally, the compositor may delegate the file descriptor mechanism to
a xdg-desktop-portal dbus service implemented by the desktop environment
so that it can check with polkit and others the allowed permissions
(<a href="https://flatpak.github.io/xdg-desktop-portal/docs/">see</a>). So it would
look like this:</p>

<div><pre><code>    +--------------------+
    | Wayland compositor |_
    +--------------------+  \
    | libinput | libeis  |   \_wayland______
    +----------+---------+                  \
        |     [eis-0.socket]                 \
 /dev/input/     /   \\       +-------+------------------+
                |      ======&gt;| libei | Wayland client A |
                |      after    +-------+------------------+
         initial|     handover   /
      connection|               / initial request
                |              /  dbus[org.freedesktop.portal.EmulatedInput]
                |              /  or dbus[org.freedesktop.portal.RemoteDesktop]
        +--------------------+
        | xdg-desktop-portal |
        +--------------------+
</code></pre></div>

<p>An example implementation of a client can be found
<a href="https://gitlab.freedesktop.org/libinput/libei/-/blob/main/tools/ei-demo-client.c">here</a>.
Or mixed with an XKB mess to translate from keysym to keycode, for the
pleasure of your eyes:</p>

<figure><pre><code data-lang="c"><span>#include</span> <span>&lt;ei.h&gt;</span><span>
#include</span> <span>&lt;xkbcommon/xkbcommon.h&gt;</span><span>
#include</span> <span>&lt;string.h&gt;</span><span>
</span>
<span>int</span> <span>main</span><span>()</span> <span>{</span>
    <span>// ----------------------------</span>
    <span>// 1. Create an XKB context</span>
    <span>// ----------------------------</span>
    <span>struct</span> <span>xkb_context</span> <span>*</span><span>ctx</span> <span>=</span> <span>xkb_context_new</span><span>(</span><span>XKB_CONTEXT_NO_FLAGS</span><span>);</span>

    <span>// load the default system keymap (XKB rules, model, layout, variant, options)</span>
    <span>struct</span> <span>xkb_keymap</span> <span>*</span><span>keymap</span> <span>=</span>
        <span>xkb_keymap_new_from_names</span><span>(</span><span>ctx</span><span>,</span> <span>NULL</span><span>,</span> <span>XKB_KEYMAP_COMPILE_NO_FLAGS</span><span>);</span>

    <span>if</span> <span>(</span><span>!</span><span>keymap</span><span>)</span> <span>{</span>
        <span>fprintf</span><span>(</span><span>stderr</span><span>,</span> <span>"failed to load xkb keymap</span><span>\n</span><span>"</span><span>);</span>
        <span>return</span> <span>1</span><span>;</span>
    <span>}</span>


    <span>// ----------------------------</span>
    <span>// 2. Convert keysym → evdev code but only for group 1 and level 1</span>
    <span>// ----------------------------</span>
    <span>xkb_keysym_t</span> <span>sym</span> <span>=</span> <span>xkb_keysym_from_name</span><span>(</span><span>"a"</span><span>,</span> <span>XKB_KEYSYM_NO_FLAGS</span><span>);</span>

    <span>// if we know the key by name it would be much easier</span>
    <span>// xkb_keycode_t code = xkb_keymap_key_by_name(keymap, "AD01"); </span>

    <span>// But better: find the keycode for the keysym</span>
    <span>xkb_keycode_t</span> <span>key</span> <span>=</span> <span>0</span><span>;</span>

    <span>// Iterate keycodes until we find the one producing this keysym</span>
    <span>// That's because keycodes-&gt;keysym is many-to-one</span>
    <span>xkb_keycode_t</span> <span>min</span> <span>=</span> <span>xkb_keymap_min_keycode</span><span>(</span><span>keymap</span><span>);</span>
    <span>xkb_keycode_t</span> <span>max</span> <span>=</span> <span>xkb_keymap_max_keycode</span><span>(</span><span>keymap</span><span>);</span>

    <span>for</span> <span>(</span><span>xkb_keycode_t</span> <span>k</span> <span>=</span> <span>min</span><span>;</span> <span>k</span> <span>&lt;=</span> <span>max</span><span>;</span> <span>k</span><span>++</span><span>)</span> <span>{</span>
        <span>if</span> <span>(</span><span>xkb_keymap_key_get_level</span><span>(</span><span>keymap</span><span>,</span> <span>k</span><span>,</span> <span>0</span><span>,</span> <span>0</span><span>)</span> <span>&gt;=</span> <span>0</span><span>)</span> <span>{</span>
            <span>int</span> <span>nsyms</span><span>;</span>
            <span>const</span> <span>xkb_keysym_t</span> <span>*</span><span>syms</span> <span>=</span> <span>xkb_keymap_key_get_syms_by_level</span><span>(</span><span>keymap</span><span>,</span> <span>k</span><span>,</span> <span>0</span><span>,</span> <span>0</span><span>,</span> <span>&amp;</span><span>nsyms</span><span>);</span>
            <span>for</span> <span>(</span><span>int</span> <span>i</span> <span>=</span> <span>0</span><span>;</span> <span>i</span> <span>&lt;</span> <span>nsyms</span><span>;</span> <span>i</span><span>++</span><span>)</span> <span>{</span>
                <span>if</span> <span>(</span><span>syms</span><span>[</span><span>i</span><span>]</span> <span>==</span> <span>sym</span><span>)</span> <span>{</span>
                    <span>key</span> <span>=</span> <span>k</span><span>;</span>
                    <span>break</span><span>;</span>
                <span>}</span>
            <span>}</span>
        <span>}</span>
    <span>}</span>

    <span>if</span> <span>(</span><span>!</span><span>key</span><span>)</span> <span>{</span>
        <span>fprintf</span><span>(</span><span>stderr</span><span>,</span> <span>"could not map keysym</span><span>\n</span><span>"</span><span>);</span>
        <span>return</span> <span>1</span><span>;</span>
    <span>}</span>

    <span>// IMPORTANT: xkbcommon keycodes are **+8** relative to evdev</span>
    <span>int</span> <span>evdev_code</span> <span>=</span> <span>key</span> <span>-</span> <span>8</span><span>;</span>

    <span>struct</span> <span>ei</span> <span>*</span><span>ei</span> <span>=</span> <span>ei_new</span><span>();</span>
    <span>// compositor socket, we'd need to get it through portal in real scenario</span>
    <span>ei_connect</span><span>(</span><span>ei</span><span>,</span> <span>"unix:path=/run/user/1000/ei_socket"</span><span>);</span>

    <span>struct</span> <span>ei_client</span> <span>*</span><span>client</span> <span>=</span> <span>ei_get_client</span><span>(</span><span>ei</span><span>);</span>
    <span>ei_client_set_name</span><span>(</span><span>client</span><span>,</span> <span>"xkb-sender"</span><span>);</span>

    <span>struct</span> <span>ei_device</span> <span>*</span><span>dev</span> <span>=</span> <span>ei_device_new</span><span>(</span><span>client</span><span>,</span> <span>"xkd-virt-keyboard0"</span><span>);</span>
    <span>ei_device_add_capability</span><span>(</span><span>dev</span><span>,</span> <span>EI_DEVICE_CAP_KEYBOARD</span><span>);</span>

    <span>ei_device_start_emulating</span><span>(</span><span>dev</span><span>);</span>


    <span>// press and release</span>
    <span>ei_key</span><span>(</span><span>dev</span><span>,</span> <span>evdev_code</span><span>,</span> <span>true</span><span>);</span>
    <span>ei_key</span><span>(</span><span>dev</span><span>,</span> <span>evdev_code</span><span>,</span> <span>false</span><span>);</span>

    <span>ei_flush</span><span>(</span><span>ei</span><span>);</span>
    <span>ei_disconnect</span><span>(</span><span>ei</span><span>);</span>
    <span>ei_free</span><span>(</span><span>ei</span><span>);</span>
    <span>return</span> <span>0</span><span>;</span>
<span>}</span></code></pre></figure>

<p>Then obviously the EIS side has to catch these events and handle
them. There’s also an example that creates uinput devices found
<a href="https://gitlab.freedesktop.org/libinput/libei/-/blob/main/tools/eis-demo-server.c">here</a>.</p>

<p>The main logic of an EIS is quite straight forward (from the official docs):</p>

<ul>
  <li>create a context with <code>eis_new()</code></li>
  <li>set up a backend with <code>eis_setup_backend_fd()</code> or <code>eis_setup_backend_socket()</code></li>
  <li>register the <code>eis_get_fd()</code> with its own event loop</li>
  <li>call <code>eis_dispatch()</code> whenever the fd triggers</li>
  <li>call <code>eis_get_event()</code> and process incoming events</li>
</ul>

<p>And whenever a new client connects:</p>

<ul>
  <li>accept new clients with <code>eis_client_connect()</code></li>
  <li>create one or more seats for the client with <code>eis_client_new_seat()</code></li>
  <li>wait for <code>EIS_EVENT_SEAT_BIND</code> and then</li>
  <li>create one or more devices with the bound capabilities, see <code>eis_seat_new_device()</code></li>
</ul>

<p>That’s kind of like network programming.</p>

<p>So far, most Wayland compositors implement this mechanism
along with portals. You can see the list of support
<a href="https://gitlab.freedesktop.org/libinput/libei/-/issues/1">here</a>, from
GNOME, KDE, XWayland, and more.</p>

<p>On that note, XWayland is both an X server, and a Wayland client. So it
understands XTest requests. Yet what happens when it receives them is
that internally it relies on libei client side to handle virtual device
events. That means xdotool can work on XWayland with libei context.</p>

<div><pre><code>    +--------------------+             +------------------+
    | Wayland compositor |---wayland---| Wayland client B |
    +--------------------+\            +------------------+
    | libinput | libeis  | \_wayland______
    +----------+---------+                \
        |          |           +-------+------------------+
 /dev/input/       +---brei----| libei |     XWayland     |
                               +-------+------------------+
                                                |
                                                | XTEST
                                                |
                                         +-----------+
                                         |  X client |
                                         +-----------+
</code></pre></div>

<p>This is summarized well
<a href="https://www.semicomplete.com/blog/xdotool-and-exploring-wayland-fragmentation/">here</a>,
I quote:</p>

<blockquote>
  <ul>
    <li>An X11 client sends a key event using XTEST (normal)</li>
    <li>XWayland receives it and initiates Remote Desktop XDG Portal session to … your own system (???)</li>
    <li>XDG Portal uses DBus in an odd way, with many method calls receiving responses via signals because DBus isn’t designed for long asynchronous methods.</li>
    <li>Once the Remote Desktop portal session is setup, Xwayland asks for a file descriptor to talk an libei server (emulated input server).</li>
    <li>After that, libei is used to send events, query the keyboard map, etc.</li>
    <li>You can ask libei for the keyboard mapping (keycodes to keysyms, etc), you get another file descriptor and process that with yet another library, libxkbcommon.</li>
  </ul>
</blockquote>

<p>The main issue is that if the libei client gets its file descriptor
via dbus portal, then every time it asks for it then the user will get
prompted to “Allow remote interaction?”. And most portal software don’t
have config or whitelist rule mechanisms to skip that (as far as I know),
which would make sense while keeping the same security level.</p>

<p>When it comes to remote desktop on Wayland, it’s quite similar, it
relies on the same libei mechanism. Yet, we need to add to the equation,
as far as input goes, a listener that captures input regardless of the
focused window.</p>

<p>The remote desktop is also achieved with libei and a dbus xdg-desktop-portal
either <code>org.freedesktop.portal.RemoteDesktop</code> or
<code>.InputCapture</code>, which will give back to the client
a special file descriptor for listening to the input stream.<br>
And similarly, it is always explicit about asking for
permission to share input or share the screen (or specific
window/surface), and there doesn’t seem to be a general
configuration to turn it off or whitelist certain clients (<a href="https://discourse.gnome.org/t/persistent-remote-desktop-access-api/19415/24">see
discussion</a>).</p>

<p>Let’s note that in the case of Wayland it is the compositor that usually
provides VNC/RDP servers, for example KWin and GNOME Mutter (apart from
<code>wayvnc</code> for wlroots compositors).<br>
Meanwhile, on X11 the remote desktop protocol was part of the X11 protocol
itself from the start, with full access, the whole events. The X server
can be on another machine and clients can communicate with it over the X11
protocol, or the events could be forwarded over ssh and others. VNC and
other remote desktop protocol can rely on how open it is too. Plus, XTEST is
there for injecting events too. There’s no limitation for apps to read the
screen framebuffer either, send it, and draw it in another X session,
but it’s often re-rendered when doing remote desktop. (x11vnc, TigerVNC,
etc..). There have been extensions over the years for security (XACE)
but nobody is relying on them.<br>
There’s also xrdp, but this creates a whole new virtual Xorg session,
so it’s another story.</p>

<p>Let’s now review a couple of tools used for automation.</p>

<p>We’ve already seen quite a lot of the ones that rely on evdev and uinput,
but now they will make more sense with our current context:</p>

<ul>
  <li><code>evemu</code> and <code>evtest</code></li>
  <li><code>libinput record</code> and <code>libinput replay</code></li>
  <li><a href="https://gitlab.freedesktop.org/whot/unplug"><code>unplug</code></a></li>
  <li><code>evsieve</code></li>
  <li><code>keyd</code> - creates a uinput device to remap keys</li>
  <li><code>evmux</code> and <code>inputattach</code> - multiplex multiple evdev devices into a
 single virtual stream</li>
</ul>

<p>The most popular tool that relies on XTEST (plus EWMH and others) is
<code>xdotool</code>.</p>

<p><em>NB</em>: the “toplevel-management” Wayland “unstable” extension somewhat
replaces some of the EWMH, but it’s not implemented by most compositor
for security reasons.</p>

<p>Similar tools to <code>xdotool</code> but that relies on uinput are <code>ydotool</code> and
<a href="https://git.sr.ht/~geb/dotool"><code>dotool</code></a>.</p>

<p>We’ve seen <code>wlrctl</code> that relies on the unstable wayland protocol for
wlroots-based compositors. There’s also <code>wtype</code> that also relies on the
unstable virtual keyboard protocol.</p>

<p>We can also possibly perform automation via very specific desktop
environment mechanisms. That means using something such as GNOME shell
extensions for example, which has a javascript API. KDE has that
concept and the utility <code>kdotool</code> relies on this.</p>

<p>As you’ve observed, the situation is a bit fragmented on Wayland when
it comes to automations, both in utilities and extensions.</p>

<p><img src="https://venam.net/blog/assets/input_devices_linux/emulation.png" alt="Emulation Overview" title="Emulation Overview"></p>

<h2 id="input-method">Input Method</h2>

<p>In this last section we’ll explore the concept of input method (IMF &amp;
IME), a mechanism to input keysym/characters that are not natively
available on the user’s input device. This is necessary for languages
that have more graphemes than there are keys on the keyboard.</p>

<p>There are two sides to the equation: the IMF, the input method framework,
and the IME, the input method engine which works within the framework. An
input method framework’s role is to pick the most appropriate way
to enter the text, shape it, and return it to the widget. The IME is
basically the place where input are interpreted in any way shape, form,
or logic, to produce the text that the IMF asked for.<br>
The IMF can also act as wrapper over XKB configs, to allow easily swapping
between keyboard layouts, it coexist with the idea of switching between
different IMEs.<br>
Simply said, the IME is a middleman between the keyboard and the actual
output text when relying on the toolkit/widget.</p>

<p><img src="https://venam.net/blog/assets/input_devices_linux/input_method_overview.png" alt="Input Method Overview 1" title="Input Method Overview 1">
Courtesy from <a href="https://nerufic.com/en/posts/how-input-methods-work-in-linux/">https://nerufic.com/en/posts/how-input-methods-work-in-linux/</a></p>

<p><img src="https://venam.net/blog/assets/input_devices_linux/input_method_arch.png" alt="Input Method Overview 2" title="Input Method Overview 2">
Courtesy from <a href="https://www.chromium.org/chromium-os/chromiumos-design-docs/text-input/basic-architecture2.png">https://www.chromium.org/chromium-os/chromiumos-design-docs/text-input/basic-architecture2.png</a></p>

<p>The way the input method plugs into the whole input stack is at the window
client side, within the widget/toolkit library framework in the input
handling event loop. After the client performs the keycode to keysym
translation and composing, it calls the toolkit specifically configured
input method, which will reroute it to the IM pipeline. Within the
pipeline, the IMF implementation will talk over its protocol to have
the IME interpret the input, and return preedit and committed text. This
will in turn be pushed back to the toolkit to display.<br>
That means that simply by relying on input widgets from a framework
such as GTK or Qt, it will automatically handle the integration with the
Input Method.</p>

<p>Some of these input frameworks are swappable, either because they talk
over the same protocol, be it the old deprecated XIM protocol for legacy
purpose (X Input Method over X protocol extension), or because they
plug straight as a module into the widget framework, which is mostly that
case today.</p>

<p>There are a lot of IMFs and IMEs implementations, and interoperability,
<a href="https://wiki.archlinux.org/title/Input_method#List_of_available_input_method_editors">see this list</a>.
These days the two major IMFs are IBus (Intelligent Input Bus, GTK-based like GNOME), and Fcitx5
(Qt-based like KDE).</p>

<p>To swap between them, if they are compatible with the toolkit, one can
set certain environment variables related to their toolkit:</p>

<div><pre><code>GTK_IM_MODULE=ibus
QT_IM_MODULE=ibus
XMODIFIERS=@im=ibus
</code></pre></div>

<p>For example the path that the text will take with Ibus looks like this:</p>

<div><pre><code>Application → GTK/Qt IM module → D-Bus → IBus/Fcitx
               →    IME      → D-Bus → GTK/Qt widget
</code></pre></div>

<p>As you can see, this bypasses all graphic servers, be it the X servers
or Wayland compositors.</p>

<p>Yet for it to work across the Wayland ecosystem, and not only on some
widgets like GTK and Qt (games, electron apps, java apps, sandboxed apps,
etc..), the IMF/IME stack needs to be able to listen to key events from
any application, provided it is focused, get the surrounding context,
take field focus, and inject text into clients. This is why some
“unstable” extensions were created, mostly “text-input-unstable-v3”
(<code>zwp_text_input_v3</code>) and “input-method-v2” (<code>zwp_input_methd_v2</code>)
protocol. With this, there’ll be consistent IM behavior across all
applications without compromising security.</p>

<p>On a side note, this same extension protocol for injecting text can be
used for the speech-to-text accessibility framework. In practice this
can either be done via a virtual input device, or a specific desktop
service mechanism integrated in the toolkits. We have a desktop service
catching voice input, a standalone voice recognizer to convert it to
text, and a virtual keyboard or feature to inject events. For example,
GNOME VoiceInput, Plasma Whisper Integration, QtSpeech, SpeechDispatcher,
Caribou, Onboard, or GNOME Accessibility Services (AT-SPI). We won’t
go into details on that, nor mention text-to-speech, since it’s outside
our scope.</p>

<p>One issue remains though, and it’s related to the key repeat rate
and delay, which on Wayland is implemented client-side. It’s
not implemented by IMs, and tough to handle apparently (<a href="https://www.csslayer.info/wordpress/linux/key-repetition-and-key-event-handling-issue-with-wayland-input-method-protocols/">see</a>).</p>

<p>And that it!</p>

<p><img src="https://venam.net/blog/assets/input_devices_linux/IM.png" alt="IM Overview" title="IM Overview"></p>

<h2 id="conclusion">Conclusion</h2>

<p>Congratulations for making it this far into the article!<br>
We’ve covered a lot of ground, literally from hardware to the very
abstract components of the graphical input stack.</p>

<p>I have some hope that in the future there’s going to be a more common
way to configure the Wayland input stack across compositors and have
fewer discrepancies and fragmentation. I also wish the XKB stack would
one day get cleanup up, but on this one my hopes are pretty low. It’s
fallen victim to entropy and chaos.</p>

<p>A huge gigantic thanks to “who-t” aka Peter Hutterer, whose <a href="https://who-t.blogspot.com/">blog</a> has
been my trusty companion for the past months.</p>

<p>We need more articles like this in the age of AI overlords, so please
share it if you’ve enjoyed it!</p>

<p>Thanks for reading, have a wonderful end of day!</p>

<pre>


</pre>

<p><em>NB: This article compiles my understand, for any correction please
contact me.</em></p>

<pre>




</pre>

<h2 id="diagrams-summary">Diagrams Summary</h2>

<p><img src="https://venam.net/blog/assets/input_devices_linux/input_topological_path.png" alt="Topology Overview" title="Topology Overview"></p>

<pre>

</pre>

<p><img src="https://venam.net/blog/assets/input_devices_linux/hid_core.png" alt="HID Core Overview" title="HID Core Overview"></p>
<pre>

</pre>

<p><img src="https://venam.net/blog/assets/input_devices_linux/input_core.png" alt="Input Core Overview" title="Input Core Overview"></p>
<pre>

</pre>

<p><img src="https://venam.net/blog/assets/input_devices_linux/libinput.png" alt="libinput Overview" title="libinput Overview"></p>
<pre>

</pre>

<p><img src="https://venam.net/blog/assets/input_devices_linux/console.png" alt="Console Overview" title="Console Overview"></p>
<pre>

</pre>

<p><img src="https://venam.net/blog/assets/input_devices_linux/xkb.png" alt="XKB Overview" title="XKB Overview"></p>
<pre>

</pre>

<p><img src="https://venam.net/blog/assets/input_devices_linux/de_upper_stack.png" alt="DE/Upper Stack Overview" title="DE/Upper Stack Overview"></p>
<pre>

</pre>

<p><img src="https://venam.net/blog/assets/input_devices_linux/emulation.png" alt="Emulation Overview" title="Emulation Overview"></p>
<pre>

</pre>

<p><img src="https://venam.net/blog/assets/input_devices_linux/IM.png" alt="IM Overview" title="IM Overview"></p>

<pre>




</pre>

<hr>

<h2 id="resources">Resources</h2>

<ul>
  <li>GENERIC, FULL STACK
    <ul>
      <li><a href="https://linuxtouchpad.org/docs/">https://linuxtouchpad.org/docs/</a></li>
      <li><a href="https://linuxtouchpad.org/resources/">https://linuxtouchpad.org/resources/</a></li>
      <li><a href="https://monroeclinton.com/pointing-devices-in-linux/">https://monroeclinton.com/pointing-devices-in-linux/</a></li>
      <li><a href="https://wiki.archlinux.org/title/Keyboard_input">https://wiki.archlinux.org/title/Keyboard_input</a></li>
      <li><a href="https://vkoskiv.com/first-linux-patch/">https://vkoskiv.com/first-linux-patch/</a></li>
      <li><a href="https://linux-kernel-labs.github.io/refs/heads/master/labs/device_model.html">https://linux-kernel-labs.github.io/refs/heads/master/labs/device_model.html</a></li>
      <li><a href="https://apexpenn.github.io/2025/02/13/linux-input-subsystem/">https://apexpenn.github.io/2025/02/13/linux-input-subsystem/</a></li>
    </ul>
  </li>
  <li>HARDWARE INTERFACE
    <ul>
      <li><a href="https://wiki.osdev.org/PS/2_Mouse">https://wiki.osdev.org/PS/2_Mouse</a></li>
      <li><a href="https://isdaman.com/alsos/hardware/mouse/ps2interface.htm">https://isdaman.com/alsos/hardware/mouse/ps2interface.htm</a></li>
      <li><a href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html">https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html</a></li>
      <li><a href="https://www.cpcwiki.eu/index.php/Serial_RS232_Mouse">https://www.cpcwiki.eu/index.php/Serial_RS232_Mouse</a></li>
      <li><a href="https://eleccelerator.com/usbdescreqparser/">https://eleccelerator.com/usbdescreqparser/</a></li>
    </ul>
  </li>
  <li>KERNEL, MODULES, HID AND OTHERS
    <ul>
      <li><a href="https://who-t.blogspot.com/2018/12/understanding-hid-report-descriptors.html">https://who-t.blogspot.com/2018/12/understanding-hid-report-descriptors.html</a></li>
      <li><a href="https://who-t.blogspot.com/2021/01/parsing-hid-unit-items.html">https://who-t.blogspot.com/2021/01/parsing-hid-unit-items.html</a></li>
      <li><a href="http://bentiss.github.io/hid-replay-docs/">http://bentiss.github.io/hid-replay-docs/</a></li>
      <li><a href="https://gitlab.freedesktop.org/libevdev/hid-tools/">https://gitlab.freedesktop.org/libevdev/hid-tools/</a></li>
      <li><a href="https://docs.kernel.org/hid/hidintro.html">https://docs.kernel.org/hid/hidintro.html</a></li>
      <li><a href="https://docs.kernel.org/hid/hid-transport.html">https://docs.kernel.org/hid/hid-transport.html</a></li>
      <li><a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/hid/">https://learn.microsoft.com/en-us/windows-hardware/drivers/hid/</a></li>
      <li><a href="https://www.kernel.org/doc/Documentation/hid/hiddev.txt">https://www.kernel.org/doc/Documentation/hid/hiddev.txt</a></li>
      <li><a href="https://www.man7.org/linux//man-pages/man8/usbhid-dump.8.html">https://www.man7.org/linux//man-pages/man8/usbhid-dump.8.html</a></li>
      <li><a href="https://www.kernel.org/doc/Documentation/input/input.txt">https://www.kernel.org/doc/Documentation/input/input.txt</a></li>
      <li><a href="https://www.kernel.org/doc/Documentation/input/input-programming.txt">https://www.kernel.org/doc/Documentation/input/input-programming.txt</a></li>
      <li><a href="https://www.kernel.org/doc/Documentation/input/joystick.txt">https://www.kernel.org/doc/Documentation/input/joystick.txt</a></li>
      <li><a href="https://github.com/libratbag/piper/">https://github.com/libratbag/piper/</a></li>
      <li><a href="https://git.annabunches.net/anna/joyful">https://git.annabunches.net/anna/joyful</a></li>
      <li><a href="https://docs.kernel.org/input/">https://docs.kernel.org/input/</a></li>
      <li><a href="https://www.kernel.org/doc/Documentation/input/">https://www.kernel.org/doc/Documentation/input/</a></li>
      <li><a href="https://www.kernel.org/doc/Documentation/input/event-codes.rst">https://www.kernel.org/doc/Documentation/input/event-codes.rst</a></li>
      <li><a href="https://www.kernel.org/doc/Documentation/input/appletouch.txt">https://www.kernel.org/doc/Documentation/input/appletouch.txt</a></li>
      <li><a href="https://www.kernel.org/doc/Documentation/input/gamepad.rst">https://www.kernel.org/doc/Documentation/input/gamepad.rst</a></li>
      <li><a href="https://www.kernel.org/doc/Documentation/input/multi-touch-protocol.rst">https://www.kernel.org/doc/Documentation/input/multi-touch-protocol.rst</a></li>
      <li><a href="https://github.com/torvalds/linux/blob/master/drivers/input/keyboard/atkbd.c">https://github.com/torvalds/linux/blob/master/drivers/input/keyboard/atkbd.c</a></li>
      <li><a href="https://www.kernel.org/doc/Documentation/laptops/thinkpad-acpi.txt">https://www.kernel.org/doc/Documentation/laptops/thinkpad-acpi.txt</a></li>
      <li><a href="https://www.kernel.org/doc/html/latest/driver-api/input.html">https://www.kernel.org/doc/html/latest/driver-api/input.html</a></li>
      <li><a href="https://www.kernelconfig.io/config_devtmpfs_safe">https://www.kernelconfig.io/config_devtmpfs_safe</a></li>
    </ul>
  </li>
  <li>SYSFS MAPPING
    <ul>
      <li><a href="https://www.kernel.org/pub/linux/kernel/people/mochel/doc/papers/ols-2005/mochel.pdf">https://www.kernel.org/pub/linux/kernel/people/mochel/doc/papers/ols-2005/mochel.pdf</a></li>
      <li><a href="https://www.man7.org/linux/man-pages/man5/sysfs.5.html">https://www.man7.org/linux/man-pages/man5/sysfs.5.html</a></li>
      <li><a href="https://www.kernel.org/doc/html/latest/filesystems/sysfs.html">https://www.kernel.org/doc/html/latest/filesystems/sysfs.html</a></li>
    </ul>
  </li>
  <li>UDEV, MDEV, SMDEV, HWDB
    <ul>
      <li><a href="https://codelucky.com/devtmpfs-linux/">https://codelucky.com/devtmpfs-linux/</a></li>
      <li><a href="https://who-t.blogspot.com/2019/02/adding-entries-to-udev-hwdb.html">https://who-t.blogspot.com/2019/02/adding-entries-to-udev-hwdb.html</a></li>
      <li><a href="https://who-t.blogspot.com/2024/04/udev-hid-bpf-quickstart-tooling-to-fix.html">https://who-t.blogspot.com/2024/04/udev-hid-bpf-quickstart-tooling-to-fix.html</a></li>
      <li><a href="https://libevdev.pages.freedesktop.org/udev-hid-bpf/index.html">https://libevdev.pages.freedesktop.org/udev-hid-bpf/index.html</a></li>
      <li><a href="https://lwn.net/Articles/970702/">https://lwn.net/Articles/970702/</a></li>
      <li><a href="https://wiki.archlinux.org/title/Udev">https://wiki.archlinux.org/title/Udev</a></li>
      <li><a href="https://www.man7.org/linux/man-pages/man5/udev.conf.5.html">https://www.man7.org/linux/man-pages/man5/udev.conf.5.html</a></li>
      <li><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd-udevd.service.html">https://www.freedesktop.org/software/systemd/man/latest/systemd-udevd.service.html</a></li>
      <li><a href="https://www.man7.org/linux/man-pages/man8/udevadm.8.html%20udevadm">https://www.man7.org/linux/man-pages/man8/udevadm.8.html udevadm</a></li>
      <li><a href="https://www.freedesktop.org/software/systemd/man/latest/udev.html#">https://www.freedesktop.org/software/systemd/man/latest/udev.html#</a></li>
      <li><a href="https://www.reactivated.net/writing_udev_rules.html">https://www.reactivated.net/writing_udev_rules.html</a></li>
      <li><a href="https://opensource.com/article/18/11/udev">https://opensource.com/article/18/11/udev</a></li>
      <li><a href="https://stackoverflow.com/questions/45987478/udev-rule-for-input-device">https://stackoverflow.com/questions/45987478/udev-rule-for-input-device</a></li>
      <li><a href="https://dataswamp.org/~solene/2025-05-31-linux-killswitch-on-power-disconnect.html">https://dataswamp.org/~solene/2025-05-31-linux-killswitch-on-power-disconnect.html</a></li>
      <li><a href="https://en.wikipedia.org/wiki/Udev">https://en.wikipedia.org/wiki/Udev</a></li>
      <li><a href="https://www.linuxfromscratch.org/lfs/view/12.3/chapter09/udev.html">https://www.linuxfromscratch.org/lfs/view/12.3/chapter09/udev.html</a></li>
      <li><a href="https://documentation.suse.com/sles/12-SP5/html/SLES-all/cha-udev.html">https://documentation.suse.com/sles/12-SP5/html/SLES-all/cha-udev.html</a></li>
      <li><a href="https://wiki.gentoo.org/wiki/Mdev">https://wiki.gentoo.org/wiki/Mdev</a></li>
      <li><a href="https://wiki.gentoo.org/wiki/Udev">https://wiki.gentoo.org/wiki/Udev</a></li>
      <li><a href="https://git.suckless.org/smdev/file/README.html">https://git.suckless.org/smdev/file/README.html</a></li>
      <li><a href="https://www.man7.org/linux/man-pages/man7/hwdb.7.html">https://www.man7.org/linux/man-pages/man7/hwdb.7.html</a></li>
      <li><a href="https://github.com/systemd/systemd/blob/main/hwdb.d/60-evdev.hwdb">https://github.com/systemd/systemd/blob/main/hwdb.d/60-evdev.hwdb</a></li>
      <li><a href="http://www.linux-usb.org/%20(deprecated)">http://www.linux-usb.org/ (deprecated)</a></li>
      <li><a href="https://web.archive.org/web/20160127215232/https://www.kernel.org/doc/pending/hotplug.txt">https://web.archive.org/web/20160127215232/https://www.kernel.org/doc/pending/hotplug.txt</a></li>
      <li><a href="https://elixir.bootlin.com/linux/v3.12.74/source/lib/kobject_uevent.c#L121">https://elixir.bootlin.com/linux/v3.12.74/source/lib/kobject_uevent.c#L121</a></li>
    </ul>
  </li>
  <li>EVDEV, LIBEVDEV, IOCTL
    <ul>
      <li><a href="https://en.wikipedia.org/wiki/Evdev#/media/File:Linux_API.svg">https://en.wikipedia.org/wiki/Evdev#/media/File:Linux_API.svg</a></li>
      <li><a href="https://en.wikipedia.org/wiki/Evdev">https://en.wikipedia.org/wiki/Evdev</a></li>
      <li><a href="https://www.kernel.org/doc/Documentation/input/uinput.rst">https://www.kernel.org/doc/Documentation/input/uinput.rst</a></li>
      <li><a href="https://www.freedesktop.org/software/libevdev/doc/latest/ioctls.html">https://www.freedesktop.org/software/libevdev/doc/latest/ioctls.html</a></li>
      <li><a href="https://gitlab.freedesktop.org/libevdev/libevdev">https://gitlab.freedesktop.org/libevdev/libevdev</a></li>
      <li><a href="https://www.freedesktop.org/software/libevdev/doc/latest/">https://www.freedesktop.org/software/libevdev/doc/latest/</a></li>
      <li><a href="https://who-t.blogspot.com/2016/09/understanding-evdev.html">https://who-t.blogspot.com/2016/09/understanding-evdev.html</a></li>
      <li><a href="https://who-t.blogspot.com/2018/07/why-its-not-good-idea-to-handle-evdev.html">https://who-t.blogspot.com/2018/07/why-its-not-good-idea-to-handle-evdev.html</a></li>
      <li><a href="https://who-t.blogspot.com/2018/01/libevdev-python.html">https://who-t.blogspot.com/2018/01/libevdev-python.html</a></li>
      <li><a href="https://gist.github.com/TriceHelix/de47ed38dcb4f7216b26291c47445d99">https://gist.github.com/TriceHelix/de47ed38dcb4f7216b26291c47445d99</a></li>
      <li><a href="https://who-t.blogspot.com/2014/11/analysing-input-events-with-evemu.html">https://who-t.blogspot.com/2014/11/analysing-input-events-with-evemu.html</a></li>
    </ul>
  </li>
  <li>LIBINPUT
    <ul>
      <li><a href="https://blog.martin-graesslin.com/blog/2016/12/how-input-works-creating-a-device/">https://blog.martin-graesslin.com/blog/2016/12/how-input-works-creating-a-device/</a></li>
      <li><a href="https://blog.martin-graesslin.com/blog/2016/12/how-input-works-keyboard-input/">https://blog.martin-graesslin.com/blog/2016/12/how-input-works-keyboard-input/</a></li>
      <li><a href="https://blog.martin-graesslin.com/blog/2016/12/how-input-works-pointer-input/">https://blog.martin-graesslin.com/blog/2016/12/how-input-works-pointer-input/</a></li>
      <li><a href="https://blog.martin-graesslin.com/blog/2017/02/how-input-works-touch-input/">https://blog.martin-graesslin.com/blog/2017/02/how-input-works-touch-input/</a></li>
      <li><a href="https://www.michaelminn.com/linux/peripherals/">https://www.michaelminn.com/linux/peripherals/</a></li>
      <li><a href="https://linuxtouchpad.org/news/2021/12/03/best-of-libinput-on-lwn.html">https://linuxtouchpad.org/news/2021/12/03/best-of-libinput-on-lwn.html</a></li>
      <li><a href="https://who-t.blogspot.com/2016/07/libinput-is-done.html">https://who-t.blogspot.com/2016/07/libinput-is-done.html</a></li>
      <li><a href="https://who-t.blogspot.com/2014/09/libinput-common-input-stack-for-wayland.html">https://who-t.blogspot.com/2014/09/libinput-common-input-stack-for-wayland.html</a></li>
      <li><a href="https://who-t.blogspot.com/2019/03/libinputs-internal-building-blocks.html">https://who-t.blogspot.com/2019/03/libinputs-internal-building-blocks.html</a></li>
      <li><a href="https://wiki.archlinux.org/title/Libinput">https://wiki.archlinux.org/title/Libinput</a></li>
      <li><a href="https://who-t.blogspot.com/2017/01/how-libinput-opens-device-nodes.html">https://who-t.blogspot.com/2017/01/how-libinput-opens-device-nodes.html</a></li>
      <li><a href="https://who-t.blogspot.com/2025/06/libinput-and-tablet-tool-eraser-buttons.html">https://who-t.blogspot.com/2025/06/libinput-and-tablet-tool-eraser-buttons.html</a></li>
      <li><a href="https://who-t.blogspot.com/2025/05/libinput-and-lua-plugins.html">https://who-t.blogspot.com/2025/05/libinput-and-lua-plugins.html</a></li>
      <li><a href="https://wayland.freedesktop.org/libinput/doc/latest/lua-plugins.html">https://wayland.freedesktop.org/libinput/doc/latest/lua-plugins.html</a></li>
      <li><a href="https://wayland.freedesktop.org/libinput/doc/latest/">https://wayland.freedesktop.org/libinput/doc/latest/</a></li>
      <li><a href="https://wayland.freedesktop.org/libinput/doc/latest/configuration.html">https://wayland.freedesktop.org/libinput/doc/latest/configuration.html</a></li>
      <li><a href="https://www.x.org/wiki/Events/XDC2014/XDC2014HuttererLibInput/">https://www.x.org/wiki/Events/XDC2014/XDC2014HuttererLibInput/</a></li>
      <li><a href="https://who-t.blogspot.com/2015/02/libinput-device-groups.html">https://who-t.blogspot.com/2015/02/libinput-device-groups.html</a></li>
      <li><a href="https://who-t.blogspot.com/2019/10/libinputs-bus-factor-is-1.html">https://who-t.blogspot.com/2019/10/libinputs-bus-factor-is-1.html</a></li>
      <li><a href="https://who-t.blogspot.com/2017/02/libinput-knows-about-internal-and.html">https://who-t.blogspot.com/2017/02/libinput-knows-about-internal-and.html</a></li>
      <li><a href="https://who-t.blogspot.com/2017/02/libinput-and-lid-switch-events.html">https://who-t.blogspot.com/2017/02/libinput-and-lid-switch-events.html</a></li>
    </ul>
  </li>
  <li>LIBINPUT AND POINTER SPECFICIS
    <ul>
      <li><a href="https://bitmath.se/org/code/mtdev/">https://bitmath.se/org/code/mtdev/</a></li>
      <li><a href="https://who-t.blogspot.com/2015/07/a-short-overview-of-touchpad-devices.html">https://who-t.blogspot.com/2015/07/a-short-overview-of-touchpad-devices.html</a></li>
      <li><a href="https://who-t.blogspot.com/2016/12/libinput-touchpad-pointer-acceleration.html">https://who-t.blogspot.com/2016/12/libinput-touchpad-pointer-acceleration.html</a></li>
      <li><a href="https://who-t.blogspot.com/2018/06/x-server-pointer-acceleration-analysis.html">https://who-t.blogspot.com/2018/06/x-server-pointer-acceleration-analysis.html</a></li>
      <li><a href="https://who-t.blogspot.com/2014/09/pointer-acceleration-in-libinput.html">https://who-t.blogspot.com/2014/09/pointer-acceleration-in-libinput.html</a></li>
      <li><a href="https://who-t.blogspot.com/2017/07/libinput-and-pressure-based-palm.html">https://who-t.blogspot.com/2017/07/libinput-and-pressure-based-palm.html</a></li>
      <li><a href="https://who-t.blogspot.com/2019/07/libinputs-new-thumb-detection-code.html">https://who-t.blogspot.com/2019/07/libinputs-new-thumb-detection-code.html</a></li>
      <li><a href="https://who-t.blogspot.com/2016/09/synaptics-pointer-acceleration.html">https://who-t.blogspot.com/2016/09/synaptics-pointer-acceleration.html</a></li>
      <li><a href="https://who-t.blogspot.com/2017/01/the-definitive-guide-to-synclient.html">https://who-t.blogspot.com/2017/01/the-definitive-guide-to-synclient.html</a></li>
      <li><a href="https://who-t.blogspot.com/2016/07/why-synclient-does-not-work-anymore.html">https://who-t.blogspot.com/2016/07/why-synclient-does-not-work-anymore.html</a></li>
      <li><a href="https://who-t.blogspot.com/2016/12/xf86-input-synaptics-is-not-synaptics.html">https://who-t.blogspot.com/2016/12/xf86-input-synaptics-is-not-synaptics.html</a></li>
      <li><a href="https://www.x.org/releases/X11R7.6-RC1/doc/man/man4/synaptics.4.xhtml">https://www.x.org/releases/X11R7.6-RC1/doc/man/man4/synaptics.4.xhtml</a></li>
      <li><a href="https://cookie.engineer/weblog/articles/synaptics-touchpad-on-linux.html">https://cookie.engineer/weblog/articles/synaptics-touchpad-on-linux.html</a></li>
      <li><a href="https://who-t.blogspot.com/2017/10/what-is-libwacom.html">https://who-t.blogspot.com/2017/10/what-is-libwacom.html</a></li>
      <li><a href="https://github.com/tuhiproject/tuhi/">https://github.com/tuhiproject/tuhi/</a></li>
      <li><a href="https://who-t.blogspot.com/2020/02/a-tale-of-missing-touches.html">https://who-t.blogspot.com/2020/02/a-tale-of-missing-touches.html</a></li>
      <li><a href="https://who-t.blogspot.com/2021/07/libinput-and-hold-gestures.html">https://who-t.blogspot.com/2021/07/libinput-and-hold-gestures.html</a></li>
      <li><a href="https://who-t.blogspot.com/2021/08/libinput-and-high-resolution-wheel.html">https://who-t.blogspot.com/2021/08/libinput-and-high-resolution-wheel.html</a></li>
      <li><a href="https://who-t.blogspot.com/2023/01/libinput-and-custom-pointer.html">https://who-t.blogspot.com/2023/01/libinput-and-custom-pointer.html</a></li>
      <li><a href="https://who-t.blogspot.com/2024/03/enforcing-touchscreen-mapping-in-gnome.html">https://who-t.blogspot.com/2024/03/enforcing-touchscreen-mapping-in-gnome.html</a></li>
      <li><a href="https://github.com/iberianpig/fusuma">https://github.com/iberianpig/fusuma</a></li>
      <li><a href="https://github.com/bulletmark/libinput-gestures">https://github.com/bulletmark/libinput-gestures</a></li>
      <li><a href="https://github.com/Coffee2CodeNL/gebaar-libinput">https://github.com/Coffee2CodeNL/gebaar-libinput</a></li>
      <li><a href="https://bill.harding.blog/2019/03/25/linux-touchpad-like-a-macbook-progress-and-a-call-for-help/">https://bill.harding.blog/2019/03/25/linux-touchpad-like-a-macbook-progress-and-a-call-for-help/</a></li>
      <li><a href="https://www.davidrevoy.com/article1002/how-a-kernel-developer-made-my-styluses-work-again">https://www.davidrevoy.com/article1002/how-a-kernel-developer-made-my-styluses-work-again</a></li>
      <li><a href="https://lwn.net/Articles/801767/">https://lwn.net/Articles/801767/</a></li>
      <li><a href="http://github.com/libratbag/libratbag">http://github.com/libratbag/libratbag</a></li>
      <li><a href="https://libratbag.github.io/">https://libratbag.github.io/</a></li>
      <li><a href="https://github.com/libratbag/ratbag-toolbox">https://github.com/libratbag/ratbag-toolbox</a></li>
      <li><a href="https://github.com/libratbag/ratbag-emu">https://github.com/libratbag/ratbag-emu</a></li>
    </ul>
  </li>
  <li>KEYBOARDS SCANCODES TO KEYCODES
    <ul>
      <li><a href="https://docs.kernel.org/input/event-codes.html">https://docs.kernel.org/input/event-codes.html</a></li>
      <li><a href="https://wiki.archlinux.org/title/Map_scancodes_to_keycodes">https://wiki.archlinux.org/title/Map_scancodes_to_keycodes</a></li>
    </ul>
  </li>
  <li>XKB
    <ul>
      <li><a href="https://xkbcommon.org/">https://xkbcommon.org/</a></li>
      <li><a href="https://web.archive.org/web/20170825051821/http://madduck.net:80/docs/extending-xkb/">https://web.archive.org/web/20170825051821/http://madduck.net:80/docs/extending-xkb/</a></li>
      <li><a href="https://man.archlinux.org/man/xkbcli.1%20xkbcli">https://man.archlinux.org/man/xkbcli.1 xkbcli</a></li>
      <li><a href="https://www.charvolant.org/doug/xkb/html/index.html">https://www.charvolant.org/doug/xkb/html/index.html</a></li>
      <li><a href="https://xkbcommon.org/doc/current/user-configuration.html">https://xkbcommon.org/doc/current/user-configuration.html</a></li>
      <li><a href="https://wiki.archlinux.org/title/X_keyboard_extension">https://wiki.archlinux.org/title/X_keyboard_extension</a></li>
      <li><a href="https://who-t.blogspot.com/2021/02/a-pre-supplied-custom-keyboard-layout.html">https://who-t.blogspot.com/2021/02/a-pre-supplied-custom-keyboard-layout.html</a></li>
      <li><a href="https://who-t.blogspot.com/2020/02/user-specific-xkb-configuration-part-1.html">https://who-t.blogspot.com/2020/02/user-specific-xkb-configuration-part-1.html</a></li>
      <li><a href="https://who-t.blogspot.com/2020/07/user-specific-xkb-configuration-part-2.html">https://who-t.blogspot.com/2020/07/user-specific-xkb-configuration-part-2.html</a></li>
      <li><a href="https://who-t.blogspot.com/2020/08/user-specific-xkb-configuration-part-3.html">https://who-t.blogspot.com/2020/08/user-specific-xkb-configuration-part-3.html</a></li>
      <li><a href="https://who-t.blogspot.com/2020/09/user-specific-xkb-configuration-putting.html">https://who-t.blogspot.com/2020/09/user-specific-xkb-configuration-putting.html</a></li>
      <li><a href="https://who-t.blogspot.com/2021/01/auto-updating-xkb-for-new-kernel.html">https://who-t.blogspot.com/2021/01/auto-updating-xkb-for-new-kernel.html</a></li>
      <li><a href="https://who-t.blogspot.com/2016/12/new-udev-property-xkbfixedlayout-for.html">https://who-t.blogspot.com/2016/12/new-udev-property-xkbfixedlayout-for.html</a></li>
      <li><a href="https://xkbcommon.org/doc/current/xkb-intro.html#md_doc_2introduction-to-xkb">https://xkbcommon.org/doc/current/xkb-intro.html#md_doc_2introduction-to-xkb</a></li>
      <li><a href="https://x.org/releases/current/doc/kbproto/xkbproto.pdf">https://x.org/releases/current/doc/kbproto/xkbproto.pdf</a></li>
      <li><a href="https://xkeyboard-config.freedesktop.org/">https://xkeyboard-config.freedesktop.org/</a></li>
      <li><a href="https://xkbcommon.org/doc/current/keymap-text-format-v1-v2.html">https://xkbcommon.org/doc/current/keymap-text-format-v1-v2.html</a></li>
      <li><a href="https://xkbcommon.org/doc/current/rule-file-format.html">https://xkbcommon.org/doc/current/rule-file-format.html</a></li>
      <li><a href="https://xkbcommon.org/doc/current/user-configuration.html">https://xkbcommon.org/doc/current/user-configuration.html</a></li>
      <li><a href="https://xkbcommon.org/doc/current/debugging.html">https://xkbcommon.org/doc/current/debugging.html</a></li>
      <li><a href="https://web.archive.org/web/20190718184358/http://pascal.tsu.ru/en/xkb/internals.html">https://web.archive.org/web/20190718184358/http://pascal.tsu.ru/en/xkb/internals.html</a></li>
      <li><a href="https://who-t.blogspot.com/2008/09/rmlvo-keyboard-configuration.html">https://who-t.blogspot.com/2008/09/rmlvo-keyboard-configuration.html</a></li>
      <li><a href="https://www.x.org/wiki/XKB/">https://www.x.org/wiki/XKB/</a></li>
      <li><a href="https://medium.com/@damko/a-simple-humble-but-comprehensive-guide-to-xkb-for-linux-6f1ad5e13450">https://medium.com/@damko/a-simple-humble-but-comprehensive-guide-to-xkb-for-linux-6f1ad5e13450</a></li>
    </ul>
  </li>
  <li>UPPER STACK, CONSOLE, XSERVER, WAYLAND
    <ul>
      <li><a href="https://wiki.archlinux.org/title/Input_remap_utilities">https://wiki.archlinux.org/title/Input_remap_utilities</a></li>
      <li><a href="https://who-t.blogspot.com/2016/12/the-future-of-xinput-xmodmap-setxkbmap.html">https://who-t.blogspot.com/2016/12/the-future-of-xinput-xmodmap-setxkbmap.html</a></li>
      <li><a href="https://wiki.archlinux.org/title/Xmodmap">https://wiki.archlinux.org/title/Xmodmap</a></li>
      <li><a href="https://who-t.blogspot.com/2016/01/xorg-project-vs-xorg-foundation.html">https://who-t.blogspot.com/2016/01/xorg-project-vs-xorg-foundation.html</a></li>
      <li><a href="https://who-t.blogspot.com/2015/01/xf86-input-libinput-compatibility-with.html">https://who-t.blogspot.com/2015/01/xf86-input-libinput-compatibility-with.html</a></li>
      <li><a href="https://who-t.blogspot.com/2016/12/xinput-is-not-configuration-ui.html">https://who-t.blogspot.com/2016/12/xinput-is-not-configuration-ui.html</a></li>
      <li><a href="https://who-t.blogspot.com/2018/06/x-server-pointer-acceleration-analysis.html%20Series">https://who-t.blogspot.com/2018/06/x-server-pointer-acceleration-analysis.html Series</a></li>
      <li><a href="https://who-t.blogspot.com/2021/09/an-xorg-release-without-xwayland.html">https://who-t.blogspot.com/2021/09/an-xorg-release-without-xwayland.html</a></li>
      <li><a href="https://en.wikipedia.org/wiki/X.Org_Server">https://en.wikipedia.org/wiki/X.Org_Server</a></li>
      <li><a href="https://en.wikipedia.org/wiki/Wayland_(protocol)">https://en.wikipedia.org/wiki/Wayland_(protocol)</a></li>
      <li><a href="https://mort.coffee/home/wayland-input-latency/">https://mort.coffee/home/wayland-input-latency/</a></li>
      <li><a href="https://drewdevault.com/2018/07/17/Input-handling-in-wlroots.html">https://drewdevault.com/2018/07/17/Input-handling-in-wlroots.html</a></li>
      <li><a href="https://fcitx-im.org/wiki/Input_method_related_environment_variables">https://fcitx-im.org/wiki/Input_method_related_environment_variables</a></li>
      <li><a href="https://gitlab.freedesktop.org/xorg/driver/xf86-input-libinput">https://gitlab.freedesktop.org/xorg/driver/xf86-input-libinput</a></li>
      <li><a href="https://gitlab.freedesktop.org/xorg/app/xmodmap">https://gitlab.freedesktop.org/xorg/app/xmodmap</a></li>
      <li><a href="https://en.wikipedia.org/wiki/Unicode_input#In_X11_and_Wayland_(Linux_and_other_Unix_variants_including_ChromeOS)">https://en.wikipedia.org/wiki/Unicode_input#In_X11_and_Wayland_(Linux_and_other_Unix_variants_including_ChromeOS)</a></li>
      <li><a href="https://nixers.net/showthread.php?tid=1970">https://nixers.net/showthread.php?tid=1970</a></li>
      <li><a href="https://wiki.archlinux.org/title/Xorg/Keyboard_configuration">https://wiki.archlinux.org/title/Xorg/Keyboard_configuration</a></li>
      <li><a href="https://wiki.archlinux.org/title/Linux_console/Keyboard_configuration">https://wiki.archlinux.org/title/Linux_console/Keyboard_configuration</a></li>
      <li><a href="https://manpages.debian.org/testing/console-setup/setupcon.1.en.html">https://manpages.debian.org/testing/console-setup/setupcon.1.en.html</a></li>
      <li><a href="https://github.com/pierre-labastie/blocaled">https://github.com/pierre-labastie/blocaled</a></li>
      <li><a href="http://www.freedesktop.org/wiki/Software/systemd/localed">http://www.freedesktop.org/wiki/Software/systemd/localed</a></li>
    </ul>
  </li>
  <li>AUTOMATION, LIBEI, INPUTFD, &amp; other protoc
    <ul>
      <li><a href="https://docs.kernel.org/5.10/hid/uhid.html">https://docs.kernel.org/5.10/hid/uhid.html</a></li>
      <li><a href="https://www.kernel.org/doc/html/v4.12/input/uinput.html">https://www.kernel.org/doc/html/v4.12/input/uinput.html</a></li>
      <li><a href="https://github.com/torvalds/linux/blob/2eba5e05d9bcf4cdea995ed51b0f07ba0275794a/drivers/hid/uhid.c#L4">https://github.com/torvalds/linux/blob/2eba5e05d9bcf4cdea995ed51b0f07ba0275794a/drivers/hid/uhid.c#L4</a></li>
      <li><a href="https://github.com/torvalds/linux/blob/master/samples/uhid/uhid-example.c">https://github.com/torvalds/linux/blob/master/samples/uhid/uhid-example.c</a></li>
      <li><a href="https://who-t.blogspot.com/2020/08/libei-library-to-support-emulated-input.html">https://who-t.blogspot.com/2020/08/libei-library-to-support-emulated-input.html</a></li>
      <li><a href="https://who-t.blogspot.com/2022/03/libei-adding-support-for-passive.html">https://who-t.blogspot.com/2022/03/libei-adding-support-for-passive.html</a></li>
      <li><a href="https://who-t.blogspot.com/2022/12/libei-opening-portal-doors.html">https://who-t.blogspot.com/2022/12/libei-opening-portal-doors.html</a></li>
      <li><a href="https://who-t.blogspot.com/2023/05/libei-and-fancy-protocol.html">https://who-t.blogspot.com/2023/05/libei-and-fancy-protocol.html</a></li>
      <li><a href="https://who-t.blogspot.com/2017/04/inputfd-protocol-for-direct-access-to.html">https://who-t.blogspot.com/2017/04/inputfd-protocol-for-direct-access-to.html</a></li>
      <li><a href="https://gitlab.freedesktop.org/libinput/libei/-/tree/main">https://gitlab.freedesktop.org/libinput/libei/-/tree/main</a></li>
      <li><a href="https://libinput.pages.freedesktop.org/libei/">https://libinput.pages.freedesktop.org/libei/</a></li>
      <li><a href="https://libinput.pages.freedesktop.org/libei/api/index.html">https://libinput.pages.freedesktop.org/libei/api/index.html</a></li>
      <li><a href="https://github.com/ReimuNotMoe/ydotool">https://github.com/ReimuNotMoe/ydotool</a></li>
      <li><a href="https://who-t.blogspot.com/2025/08/unplug-tool-to-test-input-devices-via.html">https://who-t.blogspot.com/2025/08/unplug-tool-to-test-input-devices-via.html</a></li>
      <li><a href="https://git.sr.ht/~brocellous/wlrctl">https://git.sr.ht/~brocellous/wlrctl</a></li>
      <li><a href="https://www.semicomplete.com/blog/xdotool-and-exploring-wayland-fragmentation/">https://www.semicomplete.com/blog/xdotool-and-exploring-wayland-fragmentation/</a></li>
    </ul>
  </li>
  <li>INPUT METHOD
    <ul>
      <li><a href="https://en.wikipedia.org/wiki/Input_method">https://en.wikipedia.org/wiki/Input_method</a></li>
      <li><a href="https://linuxcommandlibrary.com/man/scim">https://linuxcommandlibrary.com/man/scim</a></li>
      <li><a href="https://wiki.archlinux.org/title/Input_method">https://wiki.archlinux.org/title/Input_method</a></li>
      <li><a href="https://wiki.archlinux.org/title/IBus">https://wiki.archlinux.org/title/IBus</a></li>
      <li><a href="https://www.csslayer.info/wordpress/linux/key-repetition-and-key-event-handling-issue-with-wayland-input-method-protocols/">https://www.csslayer.info/wordpress/linux/key-repetition-and-key-event-handling-issue-with-wayland-input-method-protocols/</a></li>
      <li><a href="https://wayland.app/protocols/xx-input-method-v2">https://wayland.app/protocols/xx-input-method-v2</a></li>
      <li><a href="https://wiki.qt.io/QtCS2021_-_Wayland_text-input-unstable-v4_protocol">https://wiki.qt.io/QtCS2021_-_Wayland_text-input-unstable-v4_protocol</a></li>
      <li><a href="https://www.chromium.org/chromium-os/chromiumos-design-docs/text-input/">https://www.chromium.org/chromium-os/chromiumos-design-docs/text-input/</a></li>
      <li><a href="https://lwn.net/Articles/503320/">https://lwn.net/Articles/503320/</a></li>
      <li><a href="https://nerufic.com/en/posts/how-input-methods-work-in-linux/">https://nerufic.com/en/posts/how-input-methods-work-in-linux/</a></li>
      <li><a href="https://mail.gnome.org/archives/desktop-devel-list/2012-May/msg00093.html">https://mail.gnome.org/archives/desktop-devel-list/2012-May/msg00093.html</a></li>
      <li><a href="https://wiki.gnome.org/Design(2f)OS(2f)LanguageInput.html">https://wiki.gnome.org/Design(2f)OS(2f)LanguageInput.html</a></li>
      <li><a href="https://docs.gtk.org/gtk4/class.IMContext.html">https://docs.gtk.org/gtk4/class.IMContext.html</a></li>
      <li><a href="https://docs.gtk.org/gtk4/property.Settings.gtk-im-module.html">https://docs.gtk.org/gtk4/property.Settings.gtk-im-module.html</a></li>
    </ul>
  </li>
</ul>


	
<br>
<hr>

<p>
If you want to have a more in depth discussion I'm always available by <a href="https://venam.net/blog/about.html">email or irc</a>.
We can discuss and argue about what you like and dislike, about new ideas to consider, opinions, etc..<br>
If you don't feel like "having a discussion" or are intimidated by emails
then you can simply say something small in the comment sections below
and/or share it with your friends.
</p>
<br>






  </article>
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Pakistan says rooftop solar output to exceed grid demand in some hubs next year (202 pts)]]></title>
            <link>https://www.reuters.com/sustainability/boards-policy-regulation/pakistan-says-rooftop-solar-output-exceed-grid-demand-some-hubs-next-year-2025-11-22/</link>
            <guid>46070915</guid>
            <pubDate>Thu, 27 Nov 2025 16:42:40 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.reuters.com/sustainability/boards-policy-regulation/pakistan-says-rooftop-solar-output-exceed-grid-demand-some-hubs-next-year-2025-11-22/">https://www.reuters.com/sustainability/boards-policy-regulation/pakistan-says-rooftop-solar-output-exceed-grid-demand-some-hubs-next-year-2025-11-22/</a>, See on <a href="https://news.ycombinator.com/item?id=46070915">Hacker News</a></p>
Couldn't get https://www.reuters.com/sustainability/boards-policy-regulation/pakistan-says-rooftop-solar-output-exceed-grid-demand-some-hubs-next-year-2025-11-22/: Error: Request failed with status code 401]]></description>
        </item>
        <item>
            <title><![CDATA[Same-day upstream Linux support for Snapdragon 8 Elite Gen 5 (328 pts)]]></title>
            <link>https://www.qualcomm.com/developer/blog/2025/10/same-day-snapdragon-8-elite-gen-5-upstream-linux-support</link>
            <guid>46070668</guid>
            <pubDate>Thu, 27 Nov 2025 16:19:03 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.qualcomm.com/developer/blog/2025/10/same-day-snapdragon-8-elite-gen-5-upstream-linux-support">https://www.qualcomm.com/developer/blog/2025/10/same-day-snapdragon-8-elite-gen-5-upstream-linux-support</a>, See on <a href="https://news.ycombinator.com/item?id=46070668">Hacker News</a></p>
&lt;Unparsable&gt;]]></description>
        </item>
        <item>
            <title><![CDATA[We're Losing Our Voice to LLMs (330 pts)]]></title>
            <link>https://tonyalicea.dev/blog/were-losing-our-voice-to-llms/</link>
            <guid>46069771</guid>
            <pubDate>Thu, 27 Nov 2025 14:51:01 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://tonyalicea.dev/blog/were-losing-our-voice-to-llms/">https://tonyalicea.dev/blog/were-losing-our-voice-to-llms/</a>, See on <a href="https://news.ycombinator.com/item?id=46069771">Hacker News</a></p>
<div id="readability-page-1" class="page"><article>
  
  <p><img src="https://tonyalicea.dev/assets/blogimages/coloredpencils.png" alt="Colored pencils">
</p>

<p>Social media has become a reminder of something precious we are losing in the age of LLMs: <strong>unique voices</strong>.</p>
<p>Over time, it has become obvious just how many posts are being generated by an LLM. The tell is the voice. Every post sounds like it was posted by the same social media manager.</p>
<p>If you rely on an LLM to write all your posts, you are making a mistake.</p>
<p>Your voice is an asset. Not just what you want to say, but how you say it.</p>
<p>Your voice is unique. It is formed from your lifetime of lived experiences. No one's voice will be exactly like yours.</p>
<p>Your voice becomes recognizable. Over many posts it becomes something people subconsciously connect with, recognize, trust, and look forward to.</p>
<p>Your voice provides the framework for the impression you leave in a job interview, while networking at a meet-up, or with a co-worker.</p>
<p>Years ago I got a job thanks to my blog posts. A manager wanted my voice influencing their organization. Your voice is an asset.</p>
<p>Your voice matures and becomes even more unique with time and practice.</p>
<p>LLMs can rob you of that voice, and the rest of us lose something precious in the process.</p>
<p>Having an LLM write "in your voice" is not the same. Your voice is not static. It changes with the tides of your life and state of mind. Your most impactful message may come because it was the right moment and you were in the right frame of mind.</p>
<p>Let your voice grow with use. Let it be unique.</p>
<p>Do not let one of your greatest assets fade into atrophy, wilted by cognitive laziness.</p>
<p>Write in <em>your</em> voice.</p>
<p>I do not care what the linguistic remix machine juggles into being.</p>
<p>I care what you have to say.</p>

</article></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Show HN: Runprompt – run .prompt files from the command line (106 pts)]]></title>
            <link>https://github.com/chr15m/runprompt</link>
            <guid>46069556</guid>
            <pubDate>Thu, 27 Nov 2025 14:26:35 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/chr15m/runprompt">https://github.com/chr15m/runprompt</a>, See on <a href="https://news.ycombinator.com/item?id=46069556">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto"><h2 tabindex="-1" dir="auto">runprompt</h2><a id="user-content-runprompt" aria-label="Permalink: runprompt" href="#runprompt"></a></p>
<p dir="auto">A single-file Python script for running <a href="https://github.com/google/dotprompt">.prompt files</a>.</p>
<p dir="auto"><a href="#quick-start">Quick start</a> | <a href="#examples">Examples</a> | <a href="#configuration">Configuration</a> | <a href="#providers">Providers</a></p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Quick start</h2><a id="user-content-quick-start" aria-label="Permalink: Quick start" href="#quick-start"></a></p>
<div dir="auto" data-snippet-clipboard-copy-content="curl -O https://raw.githubusercontent.com/chr15m/runprompt/main/runprompt
chmod +x runprompt"><pre>curl -O https://raw.githubusercontent.com/chr15m/runprompt/main/runprompt
chmod +x runprompt</pre></div>
<p dir="auto">Create <code>hello.prompt</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="---
model: anthropic/claude-sonnet-4-20250514
---
Say hello to {{name}}!"><pre><span>---</span>
<span><span>model</span>: <span>anthropic/claude-sonnet-4-20250514</span></span>
<span>---</span>
Say hello to <span>{{</span><span>name</span><span>}}</span>!</pre></div>
<p dir="auto">Run it:</p>
<div dir="auto" data-snippet-clipboard-copy-content="export ANTHROPIC_API_KEY=&quot;your-key&quot;
echo '{&quot;name&quot;: &quot;World&quot;}' | ./runprompt hello.prompt"><pre><span>export</span> ANTHROPIC_API_KEY=<span><span>"</span>your-key<span>"</span></span>
<span>echo</span> <span><span>'</span>{"name": "World"}<span>'</span></span> <span>|</span> ./runprompt hello.prompt</pre></div>
<p dir="auto"><h2 tabindex="-1" dir="auto">Examples</h2><a id="user-content-examples" aria-label="Permalink: Examples" href="#examples"></a></p>
<p dir="auto">In addition to the following, see the <a href="https://github.com/chr15m/runprompt/blob/main/tests">tests folder</a> for more example <code>.prompt</code> files.</p>
<p dir="auto"><h3 tabindex="-1" dir="auto">Basic prompt with stdin</h3><a id="user-content-basic-prompt-with-stdin" aria-label="Permalink: Basic prompt with stdin" href="#basic-prompt-with-stdin"></a></p>
<div dir="auto" data-snippet-clipboard-copy-content="---
model: anthropic/claude-sonnet-4-20250514
---
Summarize this text: {{STDIN}}"><pre><span>---</span>
<span><span>model</span>: <span>anthropic/claude-sonnet-4-20250514</span></span>
<span>---</span>
Summarize this text: <span>{{</span><span>STDIN</span><span>}}</span></pre></div>
<div dir="auto" data-snippet-clipboard-copy-content="cat article.txt | ./runprompt summarize.prompt"><pre>cat article.txt <span>|</span> ./runprompt summarize.prompt</pre></div>
<p dir="auto">The special <code>{{STDIN}}</code> variable always contains the raw stdin as a string.</p>
<p dir="auto"><h3 tabindex="-1" dir="auto">Structured JSON output</h3><a id="user-content-structured-json-output" aria-label="Permalink: Structured JSON output" href="#structured-json-output"></a></p>
<p dir="auto">Extract structured data using an output schema:</p>
<div dir="auto" data-snippet-clipboard-copy-content="---
model: anthropic/claude-sonnet-4-20250514
input:
  schema:
    text: string
output:
  format: json
  schema:
    name?: string, the person's name
    age?: number, the person's age
    occupation?: string, the person's job
---
Extract info from: {{text}}"><pre><span>---</span>
<span><span>model</span>: <span>anthropic/claude-sonnet-4-20250514</span></span>
<span><span>input</span>:</span>
<span>  <span>schema</span>:</span>
<span>    <span>text</span>: <span>string</span></span>
<span><span>output</span>:</span>
<span>  <span>format</span>: <span>json</span></span>
<span>  <span>schema</span>:</span>
<span>    <span>name?</span>: <span>string, the person's name</span></span>
<span>    <span>age?</span>: <span>number, the person's age</span></span>
<span>    <span>occupation?</span>: <span>string, the person's job</span></span>
<span>---</span>
Extract info from: <span>{{</span><span>text</span><span>}}</span></pre></div>
<div dir="auto" data-snippet-clipboard-copy-content="echo &quot;John is a 30 year old teacher&quot; | ./runprompt extract.prompt
# {&quot;name&quot;: &quot;John&quot;, &quot;age&quot;: 30, &quot;occupation&quot;: &quot;teacher&quot;}"><pre><span>echo</span> <span><span>"</span>John is a 30 year old teacher<span>"</span></span> <span>|</span> ./runprompt extract.prompt
<span><span>#</span> {"name": "John", "age": 30, "occupation": "teacher"}</span></pre></div>
<p dir="auto">Fields ending with <code>?</code> are optional. The format is <code>field: type, description</code>.</p>
<p dir="auto"><h3 tabindex="-1" dir="auto">Chaining prompts</h3><a id="user-content-chaining-prompts" aria-label="Permalink: Chaining prompts" href="#chaining-prompts"></a></p>
<p dir="auto">Pipe structured output between prompts:</p>
<div dir="auto" data-snippet-clipboard-copy-content="echo &quot;John is 30&quot; | ./runprompt extract.prompt | ./runprompt generate-bio.prompt"><pre><span>echo</span> <span><span>"</span>John is 30<span>"</span></span> <span>|</span> ./runprompt extract.prompt <span>|</span> ./runprompt generate-bio.prompt</pre></div>
<p dir="auto">The JSON output from the first prompt becomes template variables in the second.</p>
<p dir="auto"><h3 tabindex="-1" dir="auto">CLI overrides</h3><a id="user-content-cli-overrides" aria-label="Permalink: CLI overrides" href="#cli-overrides"></a></p>
<p dir="auto">Override any frontmatter value from the command line:</p>
<div dir="auto" data-snippet-clipboard-copy-content="./runprompt --model anthropic/claude-haiku-4-20250514 hello.prompt
./runprompt --name &quot;Alice&quot; hello.prompt"><pre>./runprompt --model anthropic/claude-haiku-4-20250514 hello.prompt
./runprompt --name <span><span>"</span>Alice<span>"</span></span> hello.prompt</pre></div>
<p dir="auto"><h2 tabindex="-1" dir="auto">Configuration</h2><a id="user-content-configuration" aria-label="Permalink: Configuration" href="#configuration"></a></p>
<p dir="auto"><h3 tabindex="-1" dir="auto">Environment variables</h3><a id="user-content-environment-variables" aria-label="Permalink: Environment variables" href="#environment-variables"></a></p>
<p dir="auto">Set API keys for your providers:</p>
<div dir="auto" data-snippet-clipboard-copy-content="export ANTHROPIC_API_KEY=&quot;...&quot;
export OPENAI_API_KEY=&quot;...&quot;
export GOOGLE_API_KEY=&quot;...&quot;
export OPENROUTER_API_KEY=&quot;...&quot;"><pre><span>export</span> ANTHROPIC_API_KEY=<span><span>"</span>...<span>"</span></span>
<span>export</span> OPENAI_API_KEY=<span><span>"</span>...<span>"</span></span>
<span>export</span> GOOGLE_API_KEY=<span><span>"</span>...<span>"</span></span>
<span>export</span> OPENROUTER_API_KEY=<span><span>"</span>...<span>"</span></span></pre></div>
<p dir="auto"><h3 tabindex="-1" dir="auto">RUNPROMPT_* overrides</h3><a id="user-content-runprompt_-overrides" aria-label="Permalink: RUNPROMPT_* overrides" href="#runprompt_-overrides"></a></p>
<p dir="auto">Override any frontmatter value via environment variables prefixed with <code>RUNPROMPT_</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="export RUNPROMPT_MODEL=&quot;anthropic/claude-haiku-4-20250514&quot;
./runprompt hello.prompt"><pre><span>export</span> RUNPROMPT_MODEL=<span><span>"</span>anthropic/claude-haiku-4-20250514<span>"</span></span>
./runprompt hello.prompt</pre></div>
<p dir="auto">This is useful for setting defaults across multiple prompt runs.</p>
<p dir="auto"><h3 tabindex="-1" dir="auto">Verbose mode</h3><a id="user-content-verbose-mode" aria-label="Permalink: Verbose mode" href="#verbose-mode"></a></p>
<p dir="auto">Use <code>-v</code> to see request/response details:</p>
<div dir="auto" data-snippet-clipboard-copy-content="./runprompt -v hello.prompt"><pre>./runprompt -v hello.prompt</pre></div>
<p dir="auto"><h2 tabindex="-1" dir="auto">Providers</h2><a id="user-content-providers" aria-label="Permalink: Providers" href="#providers"></a></p>
<p dir="auto">Models are specified as <code>provider/model-name</code>:</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Provider</th>
<th>Model format</th>
<th>API key env var</th>
</tr>
</thead>
<tbody>
<tr>
<td>Anthropic</td>
<td><code>anthropic/claude-sonnet-4-20250514</code></td>
<td><code>ANTHROPIC_API_KEY</code></td>
</tr>
<tr>
<td>OpenAI</td>
<td><code>openai/gpt-4o</code></td>
<td><code>OPENAI_API_KEY</code></td>
</tr>
<tr>
<td>Google AI</td>
<td><code>googleai/gemini-1.5-pro</code></td>
<td><code>GOOGLE_API_KEY</code></td>
</tr>
<tr>
<td>OpenRouter</td>
<td><code>openrouter/anthropic/claude-sonnet-4-20250514</code></td>
<td><code>OPENROUTER_API_KEY</code></td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto"><a href="https://openrouter.ai/" rel="nofollow">OpenRouter</a> provides access to models from many providers (Anthropic, Google, Meta, etc.) through a single API key.</p>
</article></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[TPUs vs. GPUs and why Google is positioned to win AI race in the long term (253 pts)]]></title>
            <link>https://www.uncoveralpha.com/p/the-chip-made-for-the-ai-inference</link>
            <guid>46069048</guid>
            <pubDate>Thu, 27 Nov 2025 13:28:34 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.uncoveralpha.com/p/the-chip-made-for-the-ai-inference">https://www.uncoveralpha.com/p/the-chip-made-for-the-ai-inference</a>, See on <a href="https://news.ycombinator.com/item?id=46069048">Hacker News</a></p>
<div id="readability-page-1" class="page"><div dir="auto"><p>Hey everyone,</p><p>As I find the topic of Google TPUs extremely important, I am publishing a comprehensive deep dive, not just a technical overview, but also strategic and financial coverage of the Google TPU.</p><p>Topics covered:</p><ul><li><p>The history of the TPU and why it all even started?</p></li><li><p>The difference between a TPU and a GPU?</p></li><li><p>Performance numbers TPU vs GPU?</p></li><li><p>Where are the problems for the wider adoption of TPUs</p></li><li><p>Google’s TPU is the biggest competitive advantage of its cloud business for the next 10 years</p></li><li><p>How many TPUs does Google produce today, and how big can that get?</p></li><li><p>Gemini 3 and the aftermath of Gemini 3 on the whole chip industry</p></li></ul><p>Let’s dive into it.</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!H_F9!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fff173524-b98d-4a2b-9f77-7a130ad395a7_1024x1024.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!H_F9!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fff173524-b98d-4a2b-9f77-7a130ad395a7_1024x1024.png 424w, https://substackcdn.com/image/fetch/$s_!H_F9!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fff173524-b98d-4a2b-9f77-7a130ad395a7_1024x1024.png 848w, https://substackcdn.com/image/fetch/$s_!H_F9!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fff173524-b98d-4a2b-9f77-7a130ad395a7_1024x1024.png 1272w, https://substackcdn.com/image/fetch/$s_!H_F9!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fff173524-b98d-4a2b-9f77-7a130ad395a7_1024x1024.png 1456w" sizes="100vw"><img src="https://substackcdn.com/image/fetch/$s_!H_F9!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fff173524-b98d-4a2b-9f77-7a130ad395a7_1024x1024.png" width="1024" height="1024" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/ff173524-b98d-4a2b-9f77-7a130ad395a7_1024x1024.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1024,&quot;width&quot;:1024,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:1683293,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:false,&quot;topImage&quot;:true,&quot;internalRedirect&quot;:&quot;https://www.uncoveralpha.com/i/179815720?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fff173524-b98d-4a2b-9f77-7a130ad395a7_1024x1024.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt="" srcset="https://substackcdn.com/image/fetch/$s_!H_F9!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fff173524-b98d-4a2b-9f77-7a130ad395a7_1024x1024.png 424w, https://substackcdn.com/image/fetch/$s_!H_F9!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fff173524-b98d-4a2b-9f77-7a130ad395a7_1024x1024.png 848w, https://substackcdn.com/image/fetch/$s_!H_F9!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fff173524-b98d-4a2b-9f77-7a130ad395a7_1024x1024.png 1272w, https://substackcdn.com/image/fetch/$s_!H_F9!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fff173524-b98d-4a2b-9f77-7a130ad395a7_1024x1024.png 1456w" sizes="100vw" fetchpriority="high"></picture></div></a></figure></div><p><strong>The history of the TPU and why it all even started?</strong></p><p>The story of the Google Tensor Processing Unit (TPU) begins not with a breakthrough in chip manufacturing, but with a realization about math and logistics. Around 2013, Google’s leadership—specifically Jeff Dean, Jonathan Ross (the CEO of Groq), and the Google Brain team—ran a projection that alarmed them. They calculated that if every Android user utilized Google’s new voice search feature for just three minutes a day, the company would need to double its global data center capacity just to handle the compute load.</p><p>At the time, Google was relying on standard CPUs and GPUs for these tasks. While powerful, these general-purpose chips were inefficient for the specific heavy lifting required by Deep Learning: massive matrix multiplications. Scaling up with existing hardware would have been a financial and logistical nightmare.</p><p><span>This sparked a new project. Google decided to do something rare for a software company: build its own custom silicon. The goal was to create an </span><strong>ASIC (Application-Specific Integrated Circuit)</strong><span> designed for one job only: running TensorFlow neural networks.</span></p><p>Key Historical Milestones:</p><ul><li><p><span>2013-2014:</span><strong> </strong><span>The project moved really fast as Google both hired a very capable team and, to be honest, had some luck in their first steps. The team went from design concept to deploying silicon in data centers in just 15 months—a very short cycle for hardware engineering.</span></p></li><li><p><span>2015:</span><strong> </strong><span>Before the world knew they existed, TPUs were already powering Google’s most popular products. They were silently accelerating Google Maps navigation, Google Photos, and Google Translate.</span></p></li><li><p><span>2016</span><strong>:</strong><span> Google officially unveiled the TPU at Google I/O 2016.</span></p></li></ul><p>This urgency to solve the “data center doubling” problem is why the TPU exists. It wasn’t built to sell to gamers or render video; it was built to save Google from its own AI success. With that in mind, Google has been thinking about the »costly« AI inference problems for over a decade now. This is also one of the main reasons why the TPU is so good today compared to other ASIC projects.</p><p><strong>The difference between a TPU and a GPU?</strong></p><p>To understand the difference, it helps to look at what each chip was originally built to do. A GPU is a “general-purpose” parallel processor, while a TPU is a “domain-specific” architecture.</p><p>The GPUs were designed for graphics. They excel at parallel processing (doing many things at once), which is great for AI. However, because they are designed to handle everything from video game textures to scientific simulations, they carry “architectural baggage.” They spend significant energy and chip area on complex tasks like caching, branch prediction, and managing independent threads.</p><p>A TPU, on the other hand, strips away all that baggage. It has no hardware for rasterization or texture mapping. Instead, it uses a unique architecture called a Systolic Array.</p><p>The “Systolic Array” is the key differentiator. In a standard CPU or GPU, the chip moves data back and forth between the memory and the computing units for every calculation. This constant shuffling creates a bottleneck (the Von Neumann bottleneck).</p><p>In a TPU’s systolic array, data flows through the chip like blood through a heart (hence “systolic”).</p><ol><li><p>It loads data (weights) once.</p></li><li><p>It passes inputs through a massive grid of multipliers.</p></li><li><p>The data is passed directly to the next unit in the array without writing back to memory.</p></li></ol><p>What this means, in essence, is that a TPU, because of its systolic array, drastically reduces the number of memory reads and writes required from HBM. As a result, the TPU can spend its cycles computing rather than waiting for data.</p><p>Google’s new TPU design, also called Ironwood also addressed some of the key areas where a TPU was lacking:</p><ul><li><p>They enhanced the SparseCore for efficiently handling large embeddings (good for recommendation systems and LLMs)</p></li><li><p>It increased HBM capacity and bandwidth (up to 192 GB per chip). For a better understanding, Nvidia’s Blackwell B200 has 192GB per chip, while Blackwell Ultra, also known as the B300, has 288 GB per chip.</p></li><li><p>Improved the Inter-Chip Interconnect (ICI) for linking thousands of chips into massive clusters, also called TPU Pods (needed for AI training as well as some time test compute inference workloads). When it comes to ICI, it is important to note that it is very performant with a Peak Bandwidth of 1.2 TB/s vs Blackwell NVLink 5 at 1.8 TB/s. But Google’s ICI, together with its specialized compiler and software stack, still delivers superior performance on some specific AI tasks.</p></li></ul><p>The key thing to understand is that because the TPU doesn’t need to decode complex instructions or constantly access memory, it can deliver significantly higher Operations Per Joule.</p><p>For scale-out, Google uses Optical Circuit Switch (OCS) and its 3D torus network, which compete with Nvidia’s InfiniBand and Spectrum-X Ethernet. The main difference is that OCS is extremely cost-effective and power-efficient as it eliminates electrical switches and O-E-O conversions, but because of this, it is not as flexible as the other two. So again, the Google stack is extremely specialized for the task at hand and doesn’t offer the flexibility that GPUs do.</p><p><strong>Performance numbers TPU vs GPU?</strong></p><p>As we defined the differences, let’s look at real numbers showing how the TPU performs compared to the GPU. Since Google isn’t revealing these numbers, it is really hard to get details on performance. I studied many articles and alternative data sources, including interviews with industry insiders, and here are some of the key takeaways.</p><p>The first important thing is that there is very limited information on Google’s newest TPUv7 (Ironwood), as Google introduced it in April 2025 and is just now starting to become available to external clients (internally, it is said that Google has already been using Ironwood since April, possibly even for Gemini 3.0.). And why is this important if we, for example, compare TPUv7 with an older but still widely used version of TPUv5p based on Semianalysis data:</p><ul><li><p>TPUv7 produces 4,614 TFLOPS(BF16) vs 459 TFLOPS for TPUv5p</p></li><li><p>TPUv7 has 192GB of memory capacity vs TPUv5p 96GB</p></li><li><p>TPUv7 memory Bandwidth is 7,370 GB/s vs 2,765 for v5p</p></li></ul><p>We can see that the performance leaps between v5 and v7 are very significant. To put that in context, most of the comments that we will look at are more focused on TPUv6 or TPUv5 than v7.</p><p>Based on analyzing a ton of interviews with Former Google employees, customers, and competitors (people from AMD, NVDA &amp; others), the summary of the results is as follows.</p><p>Most agree that TPUs are more cost-effective compared to Nvidia GPUs, and most agree that the performance per watt for TPUs is better. This view is not applicable across all use cases tho.</p><p>A Former Google Cloud employee:</p><div><p>»If it is the right application, then they can deliver much better performance per dollar compared to GPUs. They also require much lesser energy and produces less heat compared to GPUs. They’re also more energy efficient and have a smaller environmental footprint, which is what makes them a desired outcome.</p><p>The use cases are slightly limited to a GPU, they’re not as generic, but for a specific application, they can offer as much as 1.4X better performance per dollar, which is pretty significant saving for a customer that might be trying to use GPU versus TPUs.«</p><p><span>source: </span><a href="https://www.alpha-sense.com/uncoveralpha/" rel="">AlphaSense</a></p></div><p>Similarly, a very insightful comment from a Former Unit Head at Google around TPUs materially lowering AI-search cost per query vs GPUs:</p><p>»TPU v6 is 60-65% more efficient than GPUs, prior generations 40-45%«</p><p>This interview was in November 2024, so the expert is probably comparing the v6 TPU with the Nvidia Hopper. Today, we already have Blackwell vs V7.</p><p>Many experts also mention the speed benefit that TPUs offer, with a Former Google Head saying that TPUs are 5x faster than GPUs for training dynamic models (like search-like workloads).</p><p>There was also a very eye-opening interview with a client who used both Nvidia GPUs and Google TPUs as he describes the economics in great detail:</p><div><p>»If I were to use eight H100s versus using one v5e pod, I would spend a lot less money on one v5e pod. In terms of price point money, performance per dollar, you will get more bang for TPU. If I already have a code, because of Google’s help or because of our own work, if I know it already is going to work on a TPU, then at that point it is beneficial for me to just stick with the TPU usage.</p><div><p><span>In the long run, if I am thinking I need to write a new code base, I need to do a lot more work, then it depends on how long I’m going to train. I would say there is still some, for example, of the workload we have already done on TPUs that in the future because as Google will add newer generation of TPU, they make older ones much cheaper.</span></p><p><span>For example, when they came out with v4, I remember the price of v2 came down so low that it was practically free to use compared to any NVIDIA GPUs.</span></p></div><p>Google has got a good promise so they keep supporting older TPUs and they’re making it a lot cheaper. If you don’t really need your model trained right away, if you’re willing to say, “I can wait one week,” even though the training is only three days, then you can reduce your cost 1/5.«</p><p><span>source: </span><a href="https://www.alpha-sense.com/uncoveralpha/" rel="">AlphaSense</a></p></div><p>Another valuable interview was with a current AMD employee, acknowledging the benefits of ASICs:</p><p>»I would expect that an AI accelerator could do about probably typically what we see in the industry. I’m using my experience at FPGAs. I could see a 30% reduction in size and maybe a 50% reduction in power vs a GPU.«</p><p>We also got some numbers from a Former Google employee who worked in the chip segment:</p><p>»When I look at the published numbers, they (TPUs) are anywhere from 25%-30% better to close to 2x better, depending on the use cases compared to Nvidia. Essentially, there’s a difference between a very custom design built to do one task perfectly versus a more general purpose design.«</p><p>What is also known is that the real edge of TPUs lies not in the hardware but in the software and in the way Google has optimized its ecosystem for the TPU.</p><p>A lot of people mention the problem that every Nvidia »competitor« like the TPU faces, which is the fast development of Nvidia and the constant »catching up« to Nvidia problem. This month a former Google Cloud employee addressed that concern head-on as he believes the rate at which TPUs are improving is faster than the rate at Nvidia:</p><p>»The amount of performance per dollar that a TPU can generate from a new generation versus the old generation is a much significant jump than Nvidia«</p><p>In addition, the recent data from Google’s presentation at the Hot Chips 2025 event backs that up, as Google stated that the TPUv7 is 100% better in performance per watt than their TPUv6e (Trillium).</p><p>Even for hard Nvidia advocates, TPUs are not to be shrugged off easily, as even Jensen thinks very highly of Google’s TPUs. In a podcast with Brad Gerstner, he mentioned that when it comes to ASICs, Google with TPUs is a »special case«. A few months ago, we also got an article from the WSJ saying that after the news publication The Information published a report that stated that OpenAI had begun renting Google TPUs for ChatGPT, Jensen called Altman, asking him if it was true, and signaled that he was open to getting the talks back on track (investment talks). Also worth noting was that Nvidia’s official X account posted a screenshot of an article in which OpenAI denied plans to use Google’s in-house chips. To say the least, Nvidia is watching TPUs very closely.</p><p>Ok, but after looking at some of these numbers, one might think, why aren’t more clients using TPUs?</p><p><strong>Where are the problems for the wider adoption of TPUs</strong></p><p><span>The main problem for TPUs adoption is the ecosystem. Nvidia’s CUDA is engraved in the minds of most AI engineers, as they have been learning CUDA in universities.</span><strong> </strong><span>Google has developed its ecosystem internally but not externally, as it has used TPUs only for its internal workloads until now. TPUs use a combination of JAX and TensorFlow, while the industry skews to CUDA and PyTorch (although TPUs also support PyTorch now). While Google is working hard to make its ecosystem more supportive and convertible with other stacks, it is also a matter of libraries and ecosystem formation that takes years to develop.</span></p><p>It is also important to note that, until recently, the GenAI industry’s focus has largely been on training workloads. In training workloads, CUDA is very important, but when it comes to inference, even reasoning inference, CUDA is not that important, so the chances of expanding the TPU footprint in inference are much higher than those in training (although TPUs do really well in training as well – Gemini 3 the prime example).</p><p>The fact that most clients are multi-cloud also poses a challenge for TPU adoption, as AI workloads are closely tied to data and its location (cloud data transfer is costly). Nvidia is accessible via all three hyperscalers, while TPUs are available only at GCP so far. A client who uses TPUs and Nvidia GPUs explains it well:</p><div><p>»Right now, the one biggest advantage of NVIDIA, and this has been true for past three companies I worked on is because AWS, Google Cloud and Microsoft Azure, these are the three major cloud companies.</p><p>Every company, every corporate, every customer we have will have data in one of these three. All these three clouds have NVIDIA GPUs. Sometimes the data is so big and in a different cloud that it is a lot cheaper to run our workload in whatever cloud the customer has data in.</p><p>I don’t know if you know about the egress cost that is moving data out of one cloud is one of the bigger cost. In that case, if you have NVIDIA workload, if you have a CUDA workload, we can just go to Microsoft Azure, get a VM that has NVIDIA GPU, same GPU in fact, no code change is required and just run it there.</p><p>With TPUs, once you are all relied on TPU and Google says, “You know what? Now you have to pay 10X more,” then we would be screwed, because then we’ll have to go back and rewrite everything. That’s why. That’s the only reason people are afraid of committing too much on TPUs. The same reason is for Amazon’s Trainium and Inferentia.«</p><p><span>source: </span><a href="https://www.alpha-sense.com/uncoveralpha/" rel="">AlphaSense</a></p></div><p>These problems are well known at Google, so it is no surprise that internally, the debate over keeping TPUs inside Google or starting to sell them externally is a constant topic. When keeping them internally, it enhances the GCP moat, but at the same time, many former Google employees believe that at some point, Google will start offering TPUs externally as well, maybe through some neoclouds, not necessarily with the biggest two competitors, Microsoft and Amazon. Opening up the ecosystem, providing support, etc., and making it more widely usable are the first steps toward making that possible.</p><p>A former Google employee also mentioned that Google last year formed a more sales-oriented team to push and sell TPUs, so it’s not like they have been pushing hard to sell TPUs for years; it is a fairly new dynamic in the organization.</p><p><strong>Google’s TPU is the biggest competitive advantage of its cloud business for the next 10 years</strong></p><p>The most valuable thing for me about TPUs is their impact on GCP. As we witness the transformation of cloud businesses from the pre-AI era to the AI era, the biggest takeaway is that the industry has gone from an oligopoly of AWS, Azure, and GCP to a more commoditized landscape, with Oracle, Coreweave, and many other neoclouds competing for AI workloads. The problem with AI workloads is the competition and Nvidia’s 75% gross margin, which also results in low margins for AI workloads. The cloud industry is moving from a 50-70% gross margin industry to a 20-35% gross margin industry. For cloud investors, this should be concerning, as the future profile of some of these companies is more like that of a utility than an attractive, high-margin business. But there is a solution to avoiding that future and returning to a normal margin: the ASIC.</p><p>The cloud providers who can control the hardware and are not beholden to Nvidia and its 75% gross margin will be able to return to the world of 50% gross margins. And there is no surprise that all three AWS, Azure, and GCP are developing their own ASICs. The most mature by far is Google’s TPU, followed by Amazon’s Trainum, and lastly Microsoft’s MAIA (although Microsoft owns the full IP of OpenAI’s custom ASICs, which could help them in the future).</p><p>While even with ASICs you are not 100% independent, as you still have to work with someone like Broadcom or Marvell, whose margins are lower than Nvidia’s but still not negligible, Google is again in a very good position. Over the years of developing TPUs, Google has managed to control much of the chip design process in-house. According to a current AMD employee, Broadcom no longer knows everything about the chip. At this point, Google is the front-end designer (the actual RTL of the design) while Broadcom is only the backend physical design partner. Google, on top of that, also, of course, owns the entire software optimization stack for the chip, which makes it as performant as it is. According to the AMD employee, based on this work split, he thinks Broadcom is lucky if it gets a 50-point gross margin on its part.</p><p>Without having to pay Nvidia for the accelerator, a cloud provider can either price its compute similarly to others and maintain a better margin profile or lower costs and gain market share. Of course, all of this depends on having a very capable ASIC that can compete with Nvidia. Unfortunately, it looks like Google is the only one that has achieved that, as the number one-performing model is Gemini 3 trained on TPUs. According to some former Google employees, internally, Google is also using TPUs for inference across its entire AI stack, including Gemini and models like Veo. Google buys Nvidia GPUs for GCP, as clients want them because they are familiar with them and the ecosystem, but internally, Google is full-on with TPUs.</p><p>As the complexity of each generation of ASICs increases, similar to the complexity and pace of Nvidia, I predict that not all ASIC programs will make it. I believe outside of TPUs, the only real hyperscaler shot right now is AWS Trainium, but even that faces much bigger uncertainties than the TPU. With that in mind, Google and its cloud business can come out of this AI era as a major beneficiary and market-share gainer.</p><p>Recently, we even got comments from the SemiAnalysis team praising the TPU:</p><div><p><span>»Google’s silicon supremacy among hyperscalers is unmatched, with their TPU 7</span><sup>th</sup><span> Gen arguably on par with Nvidia Blackwell. TPU powers the Gemini family of models which are improving in capability and sit close to the pareto frontier of $ per intelligence in some tasks«</span></p><p><span>source: </span><a href="https://semianalysis.com/" rel="">SemiAnalysis</a></p></div><p><strong>How many TPUs does Google produce today, and how big can that get?</strong></p><p>Here are the numbers that I researched:</p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[The State of GPL Propagation to AI Models (181 pts)]]></title>
            <link>https://shujisado.org/2025/11/27/gpl-propagates-to-ai-models-trained-on-gpl-code/</link>
            <guid>46068777</guid>
            <pubDate>Thu, 27 Nov 2025 12:48:12 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://shujisado.org/2025/11/27/gpl-propagates-to-ai-models-trained-on-gpl-code/">https://shujisado.org/2025/11/27/gpl-propagates-to-ai-models-trained-on-gpl-code/</a>, See on <a href="https://news.ycombinator.com/item?id=46068777">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
<p>When GitHub Copilot was launched in 2021, the fact that its training data included a vast amount of Open Source code publicly available on GitHub attracted significant attention, sparking lively debates regarding licensing. While there were issues concerning conditions such as attribution required by most licenses, there was a particularly high volume of discourse suggesting that the conditions of copyleft licenses, such as the GNU General Public License (GNU GPL), would propagate to the model itself, necessitating that the entire model be released under the same license. The propagation of the GPL is a concept that many modern software engineers have naturally accepted; thus, for an engineer with a straightforward sensibility, it is a perfectly natural progression to think that if GPL code is included in some form, copyleft applies and the license propagates.</p>



<p>However, as of 2025, the theory that the license of the source code propagates to AI models trained on Open Source code is not seen as frequently as it was back then. Although some ardent believers in software freedom still advocate for such theories, it appears they are being overwhelmed by the benefits of AI coding, which has overwhelmingly permeated the programming field. Amidst this trend, even I sometimes succumb to the illusion that such a theory never existed in the first place.</p>



<p>Has the theory that the license of training code propagates to such AI models been completely refuted?</p>



<p>Actually, it has not. This issue remains an indeterminate problem where lawsuits are still ongoing and the judgments of major national governments have not been made clear. In this article, I will explain the current situation of this license propagation theory, namely “GPL propagates to AI models trained on GPL code,” and connect it to points of discussion such as the legal positioning of models and the nature of the freedom we pursue in the AI domain.</p>



<ol><li><a href="https://shujisado.org/2025/11/27/gpl-propagates-to-ai-models-trained-on-gpl-code/#the-current-standing-in-two-lawsuits">The Current Standing in Two Lawsuits</a><ol><li><a href="https://shujisado.org/2025/11/27/gpl-propagates-to-ai-models-trained-on-gpl-code/#doe-v-github-copilot-class-action-the-persisting-claim-of-open-source-license-violation">Doe v. GitHub (Copilot Class Action): The Persisting Claim of Open Source License Violation</a></li><li><a href="https://shujisado.org/2025/11/27/gpl-propagates-to-ai-models-trained-on-gpl-code/#gema-v-openai-the-theory-treating-memory-in-models-as-legal-reproduction">GEMA v. OpenAI: The Theory Treating “Memory” in Models as Legal Reproduction</a></li><li><a href="https://shujisado.org/2025/11/27/gpl-propagates-to-ai-models-trained-on-gpl-code/#possibilities-derived-from-the-current-status-of-the-two-lawsuits">Possibilities Derived from the Current Status of the Two Lawsuits</a></li><li><a href="https://shujisado.org/2025/11/27/gpl-propagates-to-ai-models-trained-on-gpl-code/#treatment-under-japanese-law">Treatment under Japanese Law</a></li></ol></li><li><a href="https://shujisado.org/2025/11/27/gpl-propagates-to-ai-models-trained-on-gpl-code/#arguments-negating-the-theory-of-license-propagation-to-models">Arguments Negating the Theory of License Propagation to Models</a><ol><li><a href="https://shujisado.org/2025/11/27/gpl-propagates-to-ai-models-trained-on-gpl-code/#arguments-for-negation-at-the-copyright-law-layer">Arguments for Negation at the Copyright Law Layer</a></li><li><a href="https://shujisado.org/2025/11/27/gpl-propagates-to-ai-models-trained-on-gpl-code/#arguments-for-negation-at-the-gpl-text-layer">Arguments for Negation at the GPL Text Layer</a></li><li><a href="https://shujisado.org/2025/11/27/gpl-propagates-to-ai-models-trained-on-gpl-code/#arguments-for-negation-at-the-technical-layer">Arguments for Negation at the Technical Layer</a></li><li><a href="https://shujisado.org/2025/11/27/gpl-propagates-to-ai-models-trained-on-gpl-code/#practical-and-policy-arguments-for-negation">Practical and Policy Arguments for Negation</a></li></ol></li><li><a href="https://shujisado.org/2025/11/27/gpl-propagates-to-ai-models-trained-on-gpl-code/#the-stance-of-osi-and-fsf">The Stance of OSI and FSF</a></li><li><a href="https://shujisado.org/2025/11/27/gpl-propagates-to-ai-models-trained-on-gpl-code/#summary">Summary</a></li><li><a href="https://shujisado.org/2025/11/27/gpl-propagates-to-ai-models-trained-on-gpl-code/#references">References</a></li></ol>



<p><strong>Note:&nbsp;</strong>This article is an English translation of a post&nbsp;<a href="https://shujisado.com/2025/11/25/gpl_propagation_to_ai_models/">originally written in Japanese.</a>&nbsp;While it assumes a Japanese reader, I believe it may also be useful for an English-speaking audience.</p>



<hr>



<h2 id="the-current-standing-in-two-lawsuits">The Current Standing in Two Lawsuits</h2>



<p>First, let us organize what the “GPL propagation theory to AI models” entails. This is the idea that when an AI model ingests GPL code as training data, the model itself constitutes a derivative work (derivative) of the GPL code; therefore, when distributing the model, the copyleft conditions of the GPL, such as the obligation to disclose source code, apply. In other words, it is not a question of whether the output of the model is similar to the GPL code, but a theory that “since the model itself is a derivative containing GPL code, the GPL extends to the model.” While there were many voices supporting this theory around 2021, as mentioned earlier, it is no longer the mainstream of the discussion today. However, two major ongoing lawsuits can be cited as grounds that this theory has not been completely denied. These are <em>Doe v. GitHub</em> (the Copilot class action) filed in the United States and <em>GEMA v. OpenAI</em> filed in Germany. I will explain the history and current status of each lawsuit below.</p>



<h3 id="doe-v-github-copilot-class-action-the-persisting-claim-of-open-source-license-violation">Doe v. GitHub (Copilot Class Action): The Persisting Claim of Open Source License Violation</h3>



<p>In the Copilot class action filed at the end of 2022 in relation to GitHub Copilot, anonymous developers became plaintiffs and argued that GitHub, Microsoft, and OpenAI trained their models on source code from public repositories without permission, inviting massive license violations through Copilot. Specifically, they viewed it as problematic that when Copilot reproduces part of the code that served as the training source in its output, it does not perform the author attribution or copyright notice required by licenses such as MIT or Apache-2.0 at all, and furthermore, it indiscriminately trains on and outputs code under licenses that impose copyleft conditions like the GPL, thereby trampling on license clauses. The plaintiffs claimed this was a contractual violation of open source licenses and also sought damages and injunctions, asserting that it constituted a violation of the Digital Millennium Copyright Act (DMCA) under copyright law.</p>



<p>In this case, several decisions have already been handed down by the United States District Court for the Northern District of California, and many of the plaintiffs’ claims have been dismissed. What were dismissed were mainly peripheral claims such as DMCA clause violations, privacy policy violations, unjust enrichment, and torts, but some DMCA violations and the claim of “violation of open source licenses” (breach of contract) are still alive. Regarding the latter specifically, the argument is that despite the plaintiffs’ code being published under licenses like GPL or MIT, the defendants failed to comply with the author attribution or the obligation to publish derivatives under the same license, which constitutes a contractual violation. Although the court did not recognize claims for monetary damages because the plaintiffs could not demonstrate a specific amount of damage, it determined that there were sufficient grounds for the claim for injunctive relief against the license violation itself. As a result, the plaintiffs are permitted to continue the lawsuit seeking an order prohibiting the act of Copilot reproducing others’ code without appropriate license indications.</p>



<p>As is clear from the above history, “violation of open source licenses in training data” is still being contested in court in the Copilot litigation, and this is one of the reasons why the theory of license propagation to models has not been completely denied. The plaintiffs’ claim in this lawsuit does not directly demand the release of the model itself under the GPL, but it legally pursues the point that license conditions were ignored in the process of training and output; consequently, it suggests that “if the handling does not follow the license of the training data, the act of providing the model could be illegal.” Furthermore, the court has not clearly rejected this logic at this stage and has indicated a judgment that the use of open source code is accompanied by license obligations, and providing tools that ignore this could constitute a tort subject to injunction.</p>



<p>However, it is necessary to note that the claims in the Copilot litigation are legally framed as breach of contract (license) or DMCA violation, and are not a direct copyright argument that “the model is a derivative work of GPL code.” No judgment has been shown stepping so far as to mandate the disclosure of the entire model under the GPL license. The actual judgment is conservative, stating “monetary damages have not been shown, but there is room for future injunctive relief,” and does not mention the obligation to disclose the model itself. In other words, at present, there is no judicial precedent directly addressing the “GPL propagation theory to models,” and the situation is one where the issue raised regarding license violation of the source code remains alive in the judicial arena.</p>



<h3 id="gema-v-openai-the-theory-treating-memory-in-models-as-legal-reproduction">GEMA v. OpenAI: The Theory Treating “Memory” in Models as Legal Reproduction</h3>



<p>Another important lawsuit is the case where the German music copyright collective GEMA sued OpenAI. This is a copyright lawsuit concerning the unauthorized training and output of lyrics by an AI model, not AI code generation, but it carries significant theoretical implications related to “license propagation to models” even if not directly related to GPL.</p>



<p>In November 2025, the Munich I Regional Court handed down a judgment on this lawsuit, indicating regarding the matter where the ChatGPT model had memorized and reproduced the lyrics of 9 famous German songs, that the act of “memory” inside the model itself falls under the act of reproduction under copyright law. According to the judgment, the lyrics under the plaintiff’s management were “fixed” in the models of ChatGPT’s GPT-4 and 4o, and the situation was such that the lyrics were output almost verbatim just by the user giving a simple prompt. Based on this, the court determined that the model contains “parameters that memorized the work” internally, and if it is possible to reproduce an expression substantially identical to the original work for a human by means of an appropriate prompt, that memory itself falls under “reproduction” in Article 16 of the German Copyright Act. Furthermore, it determined that the act of actually outputting lyrics in response to a prompt is also a separate act of reproduction, and providing lyrics to the user falls under the act of making available to the public (public transmission). Also, it ruled that since all of these are done without the permission of the rights holder, they deviate from the scope justified by the TDM (Text and Data Mining) exception in the EU DSM Copyright Directive.</p>



<p>The important point of this judgment is that it clearly acknowledged that “if a work is recorded inside the model in a reproducible form, that state itself can constitute copyright infringement.” The court cited the text of the EU InfoSoc Directive that “reproduction includes copies in any form or manner, and does not need to be directly perceptible to humans,” and stated that in the spirit of this, even if the lyrics are encoded within the model’s parameters, it amounts to the creation of a reproduction. It went as far as to mention that “encoding in the form of probabilistic weights does not prevent it from being considered a copy,” showing a strong recognition that differences in technical formats cannot avoid the nature of reproduction under copyright law. Also, since the fact that the model could output the lyrics was not coincidental but highly consistent, it was factually found that “the direct incorporation of the essential part of the training data” occurred rather than the result of statistical learning. As a result, the Munich District Court recognized OpenAI’s liability for injunction and damages regarding the output act of the lyrics in question, and further ordered the provision of information regarding training data and output content for the future. However, this judgment is the first instance, and since OpenAI has indicated an intention to appeal, it is expected to be a continuing dispute.</p>



<p>The noteworthy theory shown by this GEMA judgment is the extension of the concept of reproduction under copyright law to the interior of the model. That is, if the work used as training data remains within the model and can be reproduced with a simple operation, it means the model already contains a reproduction of that work. This theory is groundbreaking in that it deems “the model contains the source work,” and indeed, in a commentary by Osborne Clarke, it is evaluated that “in contrast to the judgment of the English High Court in the <em>Getty v. Stability AI</em> case, the Munich District Court explicitly recognized the possibility that the AI model contains copies of the training material.” Standing on this view, the model is not merely a result of analysis, but depending on the case, can be evaluated as an aggregate of the training data itself.</p>



<p>However, it is necessary to keep in mind that this judgment is based on an extreme case where a complete match output was obtained with short text such as lyrics. The court itself stated, “Normally, temporary reproduction for learning remains within the purpose of analysis and does not infringe on the rights holder’s market, but in this case, the model holds the work in a restorable form and exceeds the scope of analysis,” emphasizing that the judgment is limited to “cases where the model performs complete reproduction.” Also, as the UK case shows, judicial decisions vary by country, and a legal consensus on this issue has not yet been formed.</p>



<p>Nevertheless, the judgment this time, which declared that the recording of a work inside a model is a reproduction, can become a major basis supporting the license propagation theory. This is because, while the premise for discussing GPL propagation is “whether the model can be said to be a reproduction or derivative work of the GPL code,” the logic of the Munich District Court legally certified exactly that “a model can be a reproduction of training data”.</p>



<h3 id="possibilities-derived-from-the-current-status-of-the-two-lawsuits">Possibilities Derived from the Current Status of the Two Lawsuits</h3>



<p>From the two lawsuits above, we can consider the path through which the theory of license propagation to AI models might be recognized in the future.</p>



<p>Let us assume the worst-case scenario from the perspective of AI operators, where these lawsuits are finalized with the plaintiffs winning. In the Copilot litigation, the judgment that “model providers must comply with the license conditions of the training source code” would be established, and in the GEMA litigation, the legal principle that “the model encompasses reproductions of the work” would be established. When these two intersect, the conclusion that “since an AI model containing GPL code is a reproduction or derivative work of the GPL code, the conditions of the GPL directly apply to its provision” is theoretically derived. That is, the possibility emerges that the theory of GPL propagation to models is effectively ratified by the judiciary.</p>



<p>Specifically, if the model memorizes and contains GPL code fragments internally, the act of distributing or providing that model to a third party may be regarded as the distribution of a reproduction of GPL code; in that case, the act of distribution under conditions other than GPL would be evaluated as a GPL license violation. If a GPL violation is established, there would be room to argue for remedies such as injunctions and claims for damages, as well as forced GPL compliance demanding the disclosure of the entire model under the same license, just as in the case of ordinary software. In fact, the remedies GEMA sought from OpenAI included disclosure regarding training data and output content, and although this is in the context of musical works, this can be said to be a type of disclosure request to make transparent “what the model learned and contains.” In the case of a GPL violation as well, the possibility cannot be denied that demands such as “disclosure of the GPL code parts contained inside the model” or “source disclosure in a form that allows reconstruction of the model” would emerge in seeking license compliance.</p>



<p>Even if not reaching such an extreme conclusion, an intermediate scenario could involve imposing certain restrictions on model providers. For example, the Copilot litigation might be settled or judged by taking measures such as “attaching a license and author attribution at the time of output if existing code of a certain length or more is included in the generated code,” or technically mandating the implementation of filters so that GPL code fragments are not extracted or reproduced from the model. In fact, GitHub, the developer of Copilot, has already introduced an optional feature that “excludes from suggestions if the candidate code matches existing code on large-scale repositories,” attempting to reduce litigation risk. Also regarding OpenAI, there are reports that it strengthened filters so that ChatGPT does not output copyrighted lyrics as they are, in response to the GEMA judgment.</p>



<p>While these are not license propagation itself legally, in practice, they indicate that the industry is steering in the direction of “ensuring the model does not potentially infringe license conditions.” In the future, there is a possibility that guidelines for excluding data with specific license terms like GPL at the model training stage, or mechanisms and systems to guarantee that there is no license-infringing output by conducting output inspections after training, will be established.</p>



<p>In any case, until these two lawsuits are completely settled and the subsequent legislative response is determined, the “theory of GPL propagation to models” has not completely disappeared. It is a scenario that could suddenly become realistic depending on future judgments, and even if the plaintiffs lose in the lawsuits, there is a possibility that support for this theory will reignite within the open source community. It is necessary to note that while it is currently an “undetermined theory not shouted as loudly as before,” that does not mean it has been legally completely denied and resolved. As our community, we need to carefully consider countermeasures while observing these trends and taking into account the legal systems of each country and opposing arguments described in the latter half of this article.</p>



<h3 id="treatment-under-japanese-law">Treatment under Japanese Law</h3>



<p>Based on the trends of the overseas lawsuits mentioned above, I will also organize the relationship between AI models, copyrighted works, and licenses under Japanese law. In Japan, Article 30-4 of the Copyright Act, introduced by the 2018 amendment, exists as a provision that comprehensively legalizes reproduction acts associated with machine learning. Furthermore, in March 2024, the Copyright Division of the Council for Cultural Affairs of the Agency for Cultural Affairs published a guideline-like document titled “Thought on AI and Copyright” (hereinafter “the Thought”), presenting a legal organization divided into the development/training stage and the generation/utilization stage of generative AI.</p>



<p>According to “the Thought,” reproduction performed basically for the purpose of AI training is legal as long as it satisfies “information analysis not for the purpose of enjoying the thoughts or sentiments expressed in the work” as defined in Article 30-4. Therefore, acts of collecting and reproducing a wide range of data from the internet to create a training dataset for research and development purposes can be done without the permission of the rights holders in principle. However, what is important is whether an “purpose of enjoyment” is mixed into that training act. “The Thought” states that if training is conducted with the purpose of “intentionally reproducing all or part of the creative expression of a specific work in the training data as the output of generative AI,” it is evaluated as having a concurrent purpose of enjoying the work rather than mere information analysis, and thus lacks the application of Article 30-4. As a typical example of this, “overfitting” is cited, and acts such as making a model memorize specific groups of works through additional training to cause it to output something similar to those works are judged to have a purpose of enjoyment.</p>



<p>Furthermore, “the Thought” also mentions the legal treatment of trained models, stating first that “trained models created by AI training cannot be said to be reproductions of the works used for training in many cases.” This is the view that since the model can generate outputs unrelated to the original in response to various inputs in a general-purpose manner, the model itself is not a copy of any specific work.</p>



<p>However, “the Thought” simultaneously acknowledges the possibility that, exceptionally, in cases where “the trained model is in a state of generating products with similarity to the work that was training data with high frequency,” the creative expression of the original work remains in the model, and it may be evaluated as a reproduction. It also points out that in such cases, the model is positioned as a machine for copyright infringement, and a claim for injunction may be recognized. In short, usually the model is merely statistical data and not the work itself, but if it has turned into a device for spewing out specific works almost as they are, it can be treated as an infringing item; this thinking shares parts with the content of the GEMA judgment.</p>



<p>It is necessary to note that the above organization is strictly a discussion of the scope of application of rights limitation provisions (exception provisions) under the Copyright Act, and does not touch upon the validity of contracts or license clauses. The Agency for Cultural Affairs document discusses from the perspective of “whether it is copyright infringement or not,” and does not deny that even if the training act is legal, contractual liability may arise if it violates terms of service or open source licenses separately. Also, no in-depth view has been shown regarding the propagation of copyleft clauses like the GPL. In Japan’s Copyright Act, there is no override provision where rights limitation provisions like Article 30-4 take precedence over contract conditions, and the “Contract Guidelines on Utilization of AI and Data” by the Ministry of Economy, Trade and Industry suggests the possibility that if there is a contract prohibiting data use between parties, that contract takes precedence.</p>



<p>Therefore, if the license is regarded as a valid contract, even if “training is legal” under Article 30-4 of the Copyright Act, the risk remains that it becomes a “violation of license conditions” under contract law, and it can be said that at least there is no official view organizing the theory of GPL propagation to models. In other words, currently, while the legality of model training acts is recognized quite broadly under the Copyright Act, license violation is left to general civil theory, and there is no clear guideline on, for example, “whether the act of publicly distributing a model trained on GPL code constitutes a GPL license violation.” Overall, the legal organization in Japan is in a situation of “safe in principle at the copyright layer, but blank at the contract layer.” Hence, the discussion in Japan regarding the theory of GPL propagation to models relies on future judicial judgments and legislative trends, and at present, there is no choice but to consider operational guidelines carefully following the organization by the Agency for Cultural Affairs.</p>



<hr>



<h2 id="arguments-negating-the-theory-of-license-propagation-to-models">Arguments Negating the Theory of License Propagation to Models</h2>



<p>As seen in the previous sections, the theory of GPL propagation to models is not legally zero. However, many legal experts and engineers point out that this theory has serious detrimental effects. Here, I present representative arguments negating the theory of license propagation to models from the layers of copyright law, GPL text, technology, and practical policy.</p>



<h3 id="arguments-for-negation-at-the-copyright-law-layer">Arguments for Negation at the Copyright Law Layer</h3>



<p>First, under copyright law, it is unreasonable to regard an AI model as a “derivative work” or “reproduction” of the training source works. In many cases, the expressions of specific works are not stored inside the model in a form recognizable to humans. The model merely holds statistical abstractions where text and code have been converted into weight parameters, and that itself is not a creative expression to humans at all. A “derivative work” under copyright law refers to a creation that incorporates the essential features of the expression of the original work in a form that can be directly perceived, but one cannot directly perceive the creativity of the original code from the model’s weights. In other words, the model does not show the nature of a work directly enough to be evaluated as encompassing the original code. For example, the High Court of Justice in the UK stated in the judgment of the <em>Getty v. Stability AI</em> case that “the Stable Diffusion model itself is not an infringing copy of the training images,” showing a negative view on regarding the model itself as a reproduction of works. Thus, there are many cautious positions internationally regarding regarding the model itself as an accumulation of works or a compilation work.</p>



<p>Also, the output generated by the model involves probabilistic and statistical transformations, and in many cases, things that do not resemble the training source at all are output. Even if a match or similarity occurs by chance, it is difficult to prove whether it is a reproduction relying on the original or an accidental similarity. It is not realistic to conduct the certification of reliance and similarity required to discuss copyright infringement for the entire model. Ultimately, in the framework of copyright law, there is no choice but to judge “whether the model relies on a specific work” on a work-by-work basis, and recognizing uniform copyrightability or infringing nature for the model itself is a large leap. As organized in Japanese law where the model is not considered a reproduction in most cases, the schematic of model equals work is considered unreasonable under copyright law.</p>



<h3 id="arguments-for-negation-at-the-gpl-text-layer">Arguments for Negation at the GPL Text Layer</h3>



<p>Next, looking at the license text and intent of the GPL itself, doubts are cast on the interpretation that GPL propagates to AI models. For example, in the text of GPLv2, the target of copyleft is limited to “derivative works” of the original code provided under GPL and “works that contain the Program.” Typically, this has been interpreted as software created by modifying or incorporating GPL code, or software combined (linked) with GPL code. In the case of an AI model, it is extremely unclear which part of the original GPL code the model “contains.” Even if the model could memorize fragments of the GPL code used for training, it is a tiny fraction when viewed from the entire model, and most parts are occupied by parameters unrelated to the GPL code. There is no clear assumption shown by the GPL drafters as to whether a statistical model that may partially encapsulate information derived from GPL code can be said to be “a work containing the Program”.</p>



<p>Furthermore, GPLv3 requires the provision of software source code in a “preferred form for modification.” If an AI model is a GPL derivative, the problem arises as to what that preferred form for modification would be. The model weights themselves have low readability and editability for humans, and are hard to call a “preferred form for modification.” If we ask whether the training data is the source code, the original trained GPL code itself cannot be said to be the source of the model, nor is it clear if it refers to the entire vast and heterogeneous training dataset. It is difficult to define what should be disclosed to redistribute the model under GPL compliance, and it could lead to an extreme conclusion that all code and data used for model training must be disclosed. While this is what some freedom believers aim for, it can only be said to be unrealistic in reality, and it deviates from the point of the GPL’s intent to enable users to modify and build from source. Thus, existing GPL provisions are not designed to directly cover products like AI models, and forcing their application causes discrepancies in both text and operation.</p>



<p>In fact, in the “Open Source AI Definition” compiled by the OSI (Open Source Initiative) in 2023, regarding “information necessary for modification” of the model, it stopped at stating that sufficiently detailed information about the training data should be disclosed, and did not require the provision of the training data itself in its entirety. Also, it states that model weights and training code should be published under OSI-approved licenses.</p>



<p>In addition, the FSF (Free Software Foundation) itself does not believe that the current GPL interpretation alone can guarantee freedom in the AI domain, and announced in 2024 that it has started formulating “conditions for machine learning applications to be free.” There, the directionality is shown that “the four freedoms should be guaranteed to users including not only software but also raw training data and model parameters,” but this conversely is a recognition that this is not guaranteed under current licenses. The FSF also points out that “since model parameters cannot be said to be source comprehensible to humans, modification through retraining is more realistic than direct editing,” and can be said to be cautious about treating models on the extension of existing GPL. Overall, claiming GPL propagation univocally to AI models that fall outside the wording and assumptions of GPL provisions is unreasonable from the perspective of interpretation.</p>



<h3 id="arguments-for-negation-at-the-technical-layer">Arguments for Negation at the Technical Layer</h3>



<p>There are also strong counterarguments from a technical perspective against the theory of GPL propagation to models. AI models, particularly those called large language models, basically hold huge statistical trends internally and do not store the original code or text as they are like a database. Returning a specific output for a specific input is merely generation according to a probability distribution, and it is not guaranteed that the same output as the training data is always obtained. If the model does not perform verbatim reproduction of training data except for a very small number of exceptional cases, evaluating it as “containing GPL code” within the model does not fit the technical reality. In fact, the OpenAI side argued in the GEMA lawsuit that “the model does not memorize individual training data, but merely reflects knowledge learned from the entire dataset in parameters.” This argument was not accepted by the Munich District Court, but that was because there was a clear example of lyric reproduction; conversely, unless there is a clear example of reproduction, the view would be that “the model is a lump of statistical knowledge”.</p>



<p>Furthermore, although it has been confirmed that models can output fragments of training data, that proportion is considered extremely limited when viewed from the whole. Regarding the whole as a reproduction based on the existence of partial memory is like claiming the whole is a reproduction of a photograph just because it contains a tiny mosaic-like fragment in an image, which is an excessive generalization. Technically, it is difficult to quantitatively measure how far specific parameters of the model retain the influence of the original data, and the correspondence between the model and training data remains statistical and difficult to draw a line. Therefore, criteria such as “how similar must it be for GPL to propagate?” cannot be established in the first place. The judgment of infringement or not has to be done on an individual output basis, and this would not be consistent with the idea of applying a single license to the entire model. From the technical aspect, since the model is basically a statistical transformation and the majority is unrelated to GPL code, applying GPL collectively can be said to be irrational.</p>



<h3 id="practical-and-policy-arguments-for-negation">Practical and Policy Arguments for Negation</h3>



<p>Finally, major demerits can be pointed out regarding the theory of license propagation to models from practical and policy perspectives. What would happen if this GPL propagation theory were legally recognized? As an extreme example, if 1 million code repositories were used for training a certain large-scale model, all the various licenses contained in them (GPL, MIT, Apache, proprietary, etc.) would “propagate” to the model, and the model provider would have to distribute the model in a form that complies with all 1 million license clauses. As a practical matter, there would be combinations where conditions contradict, such as GPLv2 and Apache-2.0, and attaching and managing a huge collection of copyright notices for one model is nothing but unrealistic. Applying all licenses to an AI model created from training data with mixed licenses is practically bankrupt, and eventually, the only thing that can be done to avoid it would be to exclude code with copyleft licenses like GPL from the training data from the start.</p>



<p>Is such a situation really desirable for our community? The spirit of the GPL is to promote the free sharing and development of software. However, if asserting excessive propagation to AI models causes companies to avoid using GPL code, and as a result, the value held by GPL software is not utilized in the AI era, it would be putting the cart before the horse. In the field of software development, many companies take a policy of not mixing GPL code into their own products, but similarly, if it becomes “do not include GPL in our AI training data,” GPL projects could lose value as data sources. Furthermore, the current legal battles surrounding AI are leaning more towards monetary compensation and regulatory rule-making, and the reality is that they are proceeding in a different vector from the direction of code sharing idealized by GPL. If only the theory of GPL propagation to models walks alone, in reality, only data exclusion and closing off to avoid litigation risks will progress, and there is a fear that it will not lead to the expansion of free software culture.</p>



<p>Policy-wise as well, governments of each country are carefully considering the use of copyrighted works in AI, but at present, there is no example establishing an explicit rule that “license violation of training data generates legal liability for the model.” Even in the EU AI Act, while there are provisions regarding the quality and transparency of training data, it does not demand compliance with open source licenses. Rather, from the perspective of promoting open science and innovation, the movement to allow text and data mining under rights limitations is strong. In Japan as well, as mentioned earlier, the direction is to broadly recognize information analysis use under Article 30-4, and the policy of forcibly applying licenses to AI models is not mainstream in current international discussions.</p>



<p>Based on the above, the theory of license propagation to models is highly likely to cause disadvantages to open source on both practical and policy fronts, and can be said not to be a realistic solution. What is important is how to realize the “freedom of software,” which is the philosophy of open source, in the AI era; the opinion that this should be attempted through realistic means such as ensuring transparency and promoting open model development rather than extreme legal interpretations is potent, and this is something I have consistently argued as well.</p>



<hr>



<h2 id="the-stance-of-osi-and-fsf">The Stance of OSI and FSF</h2>



<p>I will also organize what stance major organizations in the open source (and free software) community are currently taking in relation to the theory of GPL propagation to AI models. Representative organizations are the Open Source Initiative (OSI) and the Free Software Foundation (FSF); while they share the goal of software freedom, they do not necessarily take the same approach regarding AI models and training data.</p>



<p>First, the OSI formulated the “Open Source AI Definition” (OSAID) in 2024, defining the requirements for an AI system to be called open source. This definition states that the four freedoms (use, study, modify, redistribute) similar to software should be guaranteed for AI systems as well, and defines requirements regarding “forms necessary for modification” to realize that, requiring the disclosure of the following three elements.</p>



<ul>
<li>Data Information: Provide sufficiently detailed information about the data used for training so that a skilled person can reconstruct an equivalent model.
<ul>
<li>This does not make publishing the training data itself in its entirety mandatory, but requires disclosing the origin, scope, nature, and acquisition method if there is data that cannot be published, listing data that can be published, and providing information on data available from third parties.</li>
</ul>
</li>



<li>Code: Publish the complete set of source code for training and running the model under an OSI-approved license.</li>



<li>Parameters: Publish the model weights (parameters) under OSI-approved conditions.</li>
</ul>



<p>It should be noted that while OSI states that information regarding the code used for training and training data is indispensable in addition to model weights to realize “Open Source AI,” it does not require the complete disclosure of the training data itself. This is a flexible stance that, for example, if raw data cannot be published due to privacy or confidentiality, explaining the nature of the data by clarifying that fact can substitute. Also, the legal mechanism to ensure free use of model parameters is an issue to be clarified in the future, and at present, no conclusion has been reached on legal rights control (e.g., presence or absence of copyrightability) over parameters either.</p>



<p>As can be read from these, the OSI promotes opening up AI models at the level of the open source definition in principle, but keeps the handling of training data to requirements at the information disclosure level. Thereby, it can be said that the OSI avoids adopting the theory of license propagation to models to demand training data disclosure, and is exploring a realistic solution that first guarantees transparency and reproducibility. In principle, it could be said that the OSI denied the GPL propagation theory at the time of publishing the OSAID definition. Note that I am probably the one who sealed the mandatory argument for training data in the final stage of this definition’s formulation process, and I believe this was the correct judgment.</p>



<p>On the other hand, the FSF and FSF Europe (FSFE) take a stance more faithful to fundamental principles. FSFE declared as of 2021 that “for an AI application to be free, both its training code and training data must be published under a free software license.” That is, to modify or verify the model, one must be able to obtain it including the training data, and therefore both must be free. Also, the FSF itself stated in a 2024 statement, “Under current understanding, for an ML application to be called free, all training data and the scripts processing it must satisfy the four freedoms,” trying to extend the requirements of freedom to data. Thus, FSF/FSFE stands on the position that a model with undisclosed training data is unfree as a whole even if the software part is free.</p>



<p>However, the FSF simultaneously states to the effect that “whether a non-free machine learning application is ethically unjust depends on the case,” mentioning that there can be “legitimate moral reasons” for not being able to publish training data (personal information) of a medical diagnosis AI, for example. In that case, it implies that although that AI is non-free, its use might be ethically permitted due to social utility. One can see an attitude of seeking a compromise between the FSF’s ideal and reality here, but in any case, there is no mistake that the FSF ultimately aims for freedom including training data.</p>



<p>So, does the FSF support the theory of GPL propagation to AI models? Not necessarily. Their claim is closer to an ethical standard or ideal image rather than legal enforceability, and they are not arguing that it applies to models as an interpretation of the current GPL license. Rather, as mentioned before, they are at the stage of trying to create new standards and agreements. Even in the white paper on the Copilot issue funded by the FSF, while legal points such as copyright and license violation are discussed, substantially it has a strong aspect of being told as a GPL compliance problem for users (downstream developers) concerned that they bear the risk of GPL violation if Copilot’s output contains GPL code fragments. This is a caution to developers using AI coding tools rather than GPL application to the model itself, and is different from an approach forcing GPL compliance directly on model providers.</p>



<p>The Software Freedom Conservancy (SFC) naturally has a strong interest in this issue but is also cautious in some respects. The SFC started the protest campaign “Give Up GitHub” against GitHub in 2022, condemning Copilot’s methods as contrary to the philosophy of open source, and is also involved in the Copilot class action. However, in an SFC blog post, regarding this lawsuit, it showed concern about “the risk of interpretations deviating from the principles of the open source community being brought in,” and called on the plaintiffs’ side to comply with community-led GPL enforcement principles as well. The SFC also states that Copilot’s act is an “unprecedented license violation,” and while not fully denying the GPL propagation theory, it can be interpreted as fearing that a judicial precedent undesirable for the community might be created depending on the result of the legal battle. The SFC might be said to be carefully balancing between the aspect of pursuing GPL propagation and the risk of entrusting it to the judiciary.</p>



<p>Finally, what is concerned as the free software camp is that excessive propagation of licenses might conversely invite results that impair freedom. Both OSI and FSF ultimately want to make AI something open that anyone can utilize, but they are carefully assessing whether increasing the purity of legal theory in demands for full data disclosure really leads to achieving the objective. Considering the demerits such as the avoidance of open data due to excessive propagation interpretation or the atrophy effect due to a flurry of lawsuits, I feel that the major organizations share a commonality in that it is essential not to lose sight of the big picture of spreading freedom. Rather than inciting GPL application to models, the pursuit of realistic solutions such as how to make models and data open and which parts should be relaxed in line with reality will likely continue in the future.</p>



<hr>



<h2 id="summary">Summary</h2>



<p>I have looked at the current state of the theory of GPL propagation to AI models above, and as a conclusion, this theory is in a halfway position where “it is not touted as loudly as before, but it has not completely disappeared.” As a result of points such as license violation of training data and reproduction within the model beginning to be scrutinized in lawsuits like the Copilot class action and <em>GEMA v. OpenAI</em>, it even appears that the hurdle for infringement certification is lowering. In fact, the Munich District Court’s judgment deemed model memory as reproduction, and the claim of open source license violation survives in the Copilot litigation.</p>



<p>However, on the other hand, the hurdle for the propagation of licenses like GPL remains high. There is a large gap between infringement being recognized and the conclusion that the entire model must be disclosed under GPL etc. immediately. What the current lawsuits are seeking is also injunctions and damages, not the forced GPL-ization of the model. There are zero examples where the judiciary supported the theory of GPL propagation to models itself, and it is a legally uncharted territory. Even if that claim were attempted somewhere in the future, it would face the legal, technical, and practical counterarguments mentioned earlier.</p>



<p>However, the situation has fluid parts, and there is a possibility that the line will shift depending on the policies of each country and the trends of the community. For example, if pressure from rights holder groups strengthens in Europe, there is a possibility that guidelines including license compliance will be formulated. Also, if a consensus is formed within the community regarding the state of copyleft in the AI era, a new license might appear. If such changes occur, a phase where the theory of propagation to models is re-evaluated will also arrive.</p>



<p>To offer my personal opinion, what is important at this moment is the perspective of how to balance software freedom and freedom in the AI domain. Instead of blindly trying to apply the philosophy of copyleft to AI, it is necessary to think about what is best to maximize freedom while considering the technical nature and industrial structure peculiar to AI. Fortunately, solutions to practical problems such as the open publication of large-scale AI models, dataset cleaning methods, and automated attachment of license notices are already being explored by the open source community. Promoting such voluntary efforts and supporting them with legal frameworks as necessary will likely be the key to balancing freedom and development.</p>



<p>The theory of GPL propagation to models is a point where judgment is divided on whether it is an ideal to be pursued or a nightmare to be avoided. However, as stated in this article, seeing the situation in the current year of 2025, it is not a situation where it will become reality immediately, and the majority of the community is likely maintaining a cautious stance. Although it is speculated that trial and error will continue in the judicial, legislative, and technical aspects in the future, as our community, we need to continue exploring the point of compatibility between technological innovation and software freedom without jumping to hasty conclusions. That process itself can be said to be a new challenge in the AI era on the extension of the free software spirit.</p>



<h2 id="references">References</h2>



<ul>
<li>GitHub Copilot litigation: <a href="https://githubcopilotlitigation.com/">https://githubcopilotlitigation.com/</a></li>



<li>GEMA v. OpenAI Judgment text: <a href="https://aifray.com/wp-content/uploads/2025/11/42-O-14139-24-Endurteil.pdf">https://aifray.com/wp-content/uploads/2025/11/42-O-14139-24-Endurteil.pdf</a></li>



<li>GEMA vs. OpenAI | AI memorisation is a reproduction relevant to copyright law, and the TDM exception does not help in LLM training, Munich I Regional Court holds: <a href="https://www.osborneclarke.com/insights/gema-vs-openai-ai-memorisation-reproduction-relevant-copyright-law-and-tdm-exception-does">https://www.osborneclarke.com/insights/gema-vs-openai-ai-memorisation-reproduction-relevant-copyright-law-and-tdm-exception-does</a></li>



<li>Impressions on GEMA v. OpenAI (Munich I Regional Court) Judgment: <a href="https://shujisado.com/2025/11/15/gema-v-openai/">https://shujisado.com/2025/11/15/gema-v-openai/</a></li>



<li>Draft thought on AI and Copyright, Agency for Cultural Affairs: <a href="https://www.bunka.go.jp/seisaku/bunkashingikai/chosakuken/pdf/94037901_01.pdf">https://www.bunka.go.jp/seisaku/bunkashingikai/chosakuken/pdf/94037901_01.pdf</a></li>



<li>Contract Guidelines on Utilization of AI and Data: <a href="https://www.meti.go.jp/policy/mono_info_service/connected_industries/sharing_and_utilization/20180615001-1.pdf">https://www.meti.go.jp/policy/mono_info_service/connected_industries/sharing_and_utilization/20180615001-1.pdf</a></li>



<li>Open Source AI: <a href="https://opensource.org/ai">https://opensource.org/ai</a></li>



<li>Is publication of complete training data necessary for AI models to be Open Source?: <a href="https://shujisado.com/2025/02/18/need_for_training_data_in_opensource_ai/">https://shujisado.com/2025/02/18/need_for_training_data_in_opensource_ai/</a></li>



<li>Controlling technology at the age of Artificial Intelligence: a Free Software perspective: <a href="https://fsfe.org/freesoftware/artificial-intelligence.en.html">https://fsfe.org/freesoftware/artificial-intelligence.en.html</a></li>



<li>FSF is working on freedom in machine learning applications: <a href="https://www.fsf.org/news/fsf-is-working-on-freedom-in-machine-learning-applications">https://www.fsf.org/news/fsf-is-working-on-freedom-in-machine-learning-applications</a></li>



<li>Give Up GitHub!: <a href="https://sfconservancy.org/GiveUpGitHub/">https://sfconservancy.org/GiveUpGitHub/</a></li>



<li>On the filing of the Class Action Law Suit over GitHub’s Copilot: <a href="https://sfconservancy.org/news/2022/nov/04/class-action-lawsuit-filing-copilot/">https://sfconservancy.org/news/2022/nov/04/class-action-lawsuit-filing-copilot/</a></li>
</ul>



<figure><img data-attachment-id="252" data-permalink="https://shujisado.org/2025/11/27/gpl-propagates-to-ai-models-trained-on-gpl-code/chatgpt-image-2025%e5%b9%b411%e6%9c%8827%e6%97%a5-21_13_41/" data-orig-file="https://shujisado.org/wp-content/uploads/2025/11/chatgpt-image-2025e5b9b411e69c8827e697a5-21_13_41.png" data-orig-size="1536,1024" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="ChatGPT Image 2025年11月27日 21_13_41" data-image-description="" data-image-caption="" data-medium-file="https://shujisado.org/wp-content/uploads/2025/11/chatgpt-image-2025e5b9b411e69c8827e697a5-21_13_41.png?w=300" data-large-file="https://shujisado.org/wp-content/uploads/2025/11/chatgpt-image-2025e5b9b411e69c8827e697a5-21_13_41.png?w=1024" width="1024" height="682" src="https://shujisado.org/wp-content/uploads/2025/11/chatgpt-image-2025e5b9b411e69c8827e697a5-21_13_41.png?w=1024" alt="" srcset="https://shujisado.org/wp-content/uploads/2025/11/chatgpt-image-2025e5b9b411e69c8827e697a5-21_13_41.png?w=1024 1024w, https://shujisado.org/wp-content/uploads/2025/11/chatgpt-image-2025e5b9b411e69c8827e697a5-21_13_41.png?w=150 150w, https://shujisado.org/wp-content/uploads/2025/11/chatgpt-image-2025e5b9b411e69c8827e697a5-21_13_41.png?w=300 300w, https://shujisado.org/wp-content/uploads/2025/11/chatgpt-image-2025e5b9b411e69c8827e697a5-21_13_41.png?w=768 768w, https://shujisado.org/wp-content/uploads/2025/11/chatgpt-image-2025e5b9b411e69c8827e697a5-21_13_41.png?w=1440 1440w, https://shujisado.org/wp-content/uploads/2025/11/chatgpt-image-2025e5b9b411e69c8827e697a5-21_13_41.png 1536w" sizes="(max-width: 1024px) 100vw, 1024px"></figure>
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Arthur Conan Doyle explored men’s mental health through Sherlock Holmes (192 pts)]]></title>
            <link>https://scienceclock.com/arthur-conan-doyle-delved-into-mens-mental-health-through-his-sherlock-holmes-stories/</link>
            <guid>46068015</guid>
            <pubDate>Thu, 27 Nov 2025 10:54:02 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://scienceclock.com/arthur-conan-doyle-delved-into-mens-mental-health-through-his-sherlock-holmes-stories/">https://scienceclock.com/arthur-conan-doyle-delved-into-mens-mental-health-through-his-sherlock-holmes-stories/</a>, See on <a href="https://news.ycombinator.com/item?id=46068015">Hacker News</a></p>
<div id="readability-page-1" class="page"><div itemprop="articleBody">
<p><strong>Note:</strong> This article is republished from <em>The Conversation</em> under a Creative Commons license. It includes links to external sites that may earn a commission for purchases. We did not add these links and have kept the original content intact.</p>



<p>Arthur Conan Doyle was not just one of the world’s best crime fiction writers. He was a progressive wordsmith who brought light to controversial and taboo subjects. One of those taboo subjects was male vulnerability and mental health problems – a topic of personal significance to the author.</p>



<p>Doyle was a <a href="https://theconversation.com/topics/children-10" target="_blank" rel="noopener">vulnerable child</a>. His father, Charles, <a href="https://www.nationalgalleries.org/art-and-artists/artists/charles-altamont-doyle#:%7E:text=Doyle%20did%2C%20however%2C%20suffer%20from,the%20creator%20of%20Sherlock%20Holmes" target="_blank" rel="noopener">was an alcoholic</a>, which led to financial troubles in the family. Charles was admitted to an asylum in 1881 and spent the next 12 years in various <a href="https://www.cambridge.org/core/journals/advances-in-psychiatric-treatment/article/arthur-conan-doyle-the-many-faces-of-sherlock-holmes/3AEE8A3782A8F420740219E88A34FE53" target="_blank" rel="noopener">mental care establishments</a>. So began Doyle’s interest in male vulnerability and mental health.</p>



<p>The character of Sherlock Holmes is a true expression of male vulnerability that does not equate it with weakness. Doyle does not represent Holmes as infallible, but as a man others can relate to – he battles with drug addiction, loneliness and depression. His genius thrives in part because of these vulnerabilities, not despite them.</p>




<p>Many of Doyle’s Sherlock Holmes stories examine male characters facing emotional catastrophe, betrayal or moral dilemmas. In works such as <a href="https://uk.bookshop.org/a/15793/9781913603380" target="_blank" rel="noopener">The Man with the Twisted Lip</a> (1891), <a href="https://uk.bookshop.org/a/15793/9781913603403" target="_blank" rel="noopener">The Adventure of the Engineer’s Thumb</a> (1892) and <a href="https://uk.bookshop.org/a/15793/9781782266594" target="_blank" rel="noopener">The Stockbroker’s Clerk</a> (1894), Holmes’s male clients approach him with problems layered with emotional turmoil, fear and failure.</p>



<p>In The Man with the Twisted Lip, for example, a man named Neville St Clair hides his double life. He tells his family that he is a respectable entrepreneur going to London on business. In reality he is begging on the city streets. He lives this double life due to fear and shame over the inability to pay off his debts. “It was a long fight between my pride and the money,” he explains, “but the dollars won at last.”</p>



<p><strong>Also Read: </strong><a href="https://scienceclock.com/who-looks-smarter-the-quick-thinker-or-the-careful-thinker/"><strong>Who Looks Smarter: The Quick Thinker or the Careful Thinker?</strong></a></p>



<p>“I would have endured imprisonment, ay, even execution, rather than have left my miserable secret as a family blot to my children,” St Clair says. In having his character consider execution to protect his and his family’s reputation, Doyle explored the societal expectations of Victorian masculinity and how men struggled with such pressures.</p>




<p>The Stockbroker’s Clerk also examines male suicide, as well as economic and professional anxieties. When Holmes reveals the crimes of Harry Pinner, the man attempts suicide rather than face prison.</p>



<p>In The Engineer’s Thumb, hydraulic engineer Victor is treated physically by Watson and mentally by Holmes. As Doyle writes: “Round one of his hands he had a handkerchief wrapped, which was mottled all over with bloodstains. He was young, not more than five-and-twenty, I should say, with a strong masculine face; but he was exceedingly pale and gave me the impression of a man who was suffering from some strong agitation, which it took all his strength of mind to control.”</p>



<p>The physical injury marks Victor as a victim of physical violence. Watson suggests that Victor is using all his mental capabilities to keep calm about his severe pain. Holmes treats Victor’s mind as he listens to his story: “Pray lie down there and make yourself absolutely at home. Tell us what you can, but stop when you are tired, and keep up your strength with a little stimulant.”</p>



<p><strong>Also Read: <a href="https://scienceclock.com/study-of-3-million-finnish-adults-finds-non-voters-tend-to-die-earlier/">Study of 3 Million Finnish Adults Finds Non-Voters Tend to Die Earlier</a></strong></p>




<p>Holmes is a protector, a confidante and a comforter in this scene. He provides Victor with breakfast, induces him to lie down and offers him a stimulant (more than likely brandy).</p>



<p>The extremity of violence that Victor has endured has escalated to mental trauma. In having Holmes treat Victor’s mental trauma while Watson treats his physical pain, Doyle showed the importance psychological support for men of the age.</p>



<p>Holmes was a highly popular character. To contemporary readers, his drug use and dysfunctional clients were seen as markers of his genius rather than a reflection of the significant social issues that men faced during this period. But today, they offer a window into the mental struggles of Victorian men, and a point of connection between readers of the past and present.</p>



<hr>



<p><em>Looking for something good? Cut through the noise with a carefully curated selection of the latest releases, live events and exhibitions, straight to your inbox every fortnight, on Fridays. <a href="https://theconversation.com/uk/newsletters/something-good-156" target="_blank" rel="noopener">Sign up here</a>.</em></p>




<hr>



<p><em>This article features references to books that have been included for editorial reasons, and may contain links to <a href="http://bookshop.org/" target="_blank" rel="noopener">bookshop.org</a>. If you click on one of the links and go on to buy something from <a href="http://bookshop.org/" target="_blank" rel="noopener">bookshop.org</a> The Conversation UK may earn a commission.</em></p>



<p><a href="https://theconversation.com/profiles/emma-linford-1297058" target="_blank" rel="noopener">Emma Linford</a>, Honorary research associate, English literature, <em><a href="https://theconversation.com/institutions/university-of-hull-1191" target="_blank" rel="noopener">University of Hull</a></em></p>



<p><strong>This article is republished from <a href="https://theconversation.com/" target="_blank" rel="noopener">The Conversation</a> under a Creative Commons license. Read the <a href="https://theconversation.com/arthur-conan-doyle-explored-mens-mental-health-through-his-sherlock-holmes-stories-246728" target="_blank" rel="noopener">original article</a>.</strong></p>



<hr>







<!-- CONTENT END 1 -->
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Ray Marching Soft Shadows in 2D (2020) (177 pts)]]></title>
            <link>https://www.rykap.com/2020/09/23/distance-fields/</link>
            <guid>46066695</guid>
            <pubDate>Thu, 27 Nov 2025 07:31:24 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.rykap.com/2020/09/23/distance-fields/">https://www.rykap.com/2020/09/23/distance-fields/</a>, See on <a href="https://news.ycombinator.com/item?id=46066695">Hacker News</a></p>
<div id="readability-page-1" class="page"><div role="main">
        




<article>
  

<p><em>Disclaimer: the demos on this page use WebGL features that aren’t available on some mobile devices.</em></p>

<p>A couple of weeks ago I tweeted a video of a toy graphics project (below). It’s not done, but a lot of people liked it which was surprising and fun! A few people asked how it works, so that’s what this post is about.</p>



<p>Under the hood it uses something called a distance field. A distance field is an image like the one below that tells you how far each pixel is from your shape. Light grey pixels are close to the shape and dark grey pixels are far from it.</p>

<img src="https://www.rykap.com/images/ray-marching/distance-field.png">

<p>When the demo starts up, it draws some text on a 2D canvas and generates a distance field of it. It uses <a href="https://github.com/ryankaplan/gpu-distance-field">a library I wrote</a> that generates distance fields really quickly. If you’re curious how the library works, I wrote about that <a href="http://rykap.com/graphics/skew/2016/02/25/voronoi-diagrams/">here</a>.</p>

<p>Our lighting scheme works like this: when processing a particular pixel we consider a ray from it to the light, like so…</p>

<img src="https://www.rykap.com/images/ray-marching/ray-march-1.png">

<p>If the ray intersects a glyph, the pixel we’re shading must be in shadow because there’s something between it and the light.</p>

<p>The simplest way to check this would be to move along the ray in 1px increments, starting from the pixel we’re shading and ending at the light, repeatedly asking the distance field if we’re distance 0 from a shape. This would work, but it’d be really slow.</p>

<p>We could pick some specific length like 30px and move in increments of that size, but then we risk jumping over glyphs that are smaller than 30px. We might think we’re not in shadow when we should be.</p>

<p><strong>Ray marching’s core idea is this: the distance field tells you how far you are from the closest glyph. You can safely advance along your ray by that distance without skipping over any glyphs.</strong></p>

<p>Let’s walk through an example. We start as pictured above and ask the distance field how far we are from any glyph. Turns out in this case that the answer is 95px (pictured left). This means that we can move 95px along our ray without skipping over anything!</p>

<img src="https://www.rykap.com/images/ray-marching/ray-march-2.png">

<p>Now we’re a little closer to the light. We repeat the process until we hit the ascender of the b! If the b glyph weren’t there, we’d have kept going until we hit the light.</p>

<p>Below is a demo that shows the ray marching steps for a given pixel. The red box is the pixel we’re shading, and each circle along the ray represents a ray marching step and the distance from the scene at that step.</p>

<p>Try dragging the light and the pixel around to build an intuition for it.</p>



<p>Below is GLSL to implement this technique. It assumes you’ve defined a function <code>getDistance</code> that samples the distance field.</p>

<div><pre><code><span>vec2</span> <span>rayOrigin</span> <span>=</span> <span>...;</span>
<span>vec2</span> <span>rayDirection</span> <span>=</span> <span>...;</span>

<span>float</span> <span>rayProgress</span> <span>=</span> <span>0</span><span>;</span>
<span>while</span> <span>(</span><span>true</span><span>)</span> <span>{</span>
  <span>if</span> <span>(</span><span>rayProgress</span> <span>&gt;</span> <span>distance</span><span>(</span><span>rayOrigin</span><span>,</span> <span>lightPosition</span><span>))</span> <span>{</span>
    <span>// We hit the light! This pixel is not in shadow.</span>
    <span>return</span> <span>1</span><span>.;</span>
  <span>}</span>

  <span>float</span> <span>sceneDist</span> <span>=</span> <span>getDistance</span><span>(</span>
    <span>rayOrigin</span> <span>+</span> <span>rayProgress</span> <span>*</span> <span>rayDirection</span><span>);</span>
  <span>if</span> <span>(</span><span>sceneDist</span> <span>&lt;=</span> <span>0</span><span>.)</span> <span>{</span>
    <span>// We hit a shape! This pixel is in shadow.</span>
    <span>return</span> <span>0</span><span>.;</span>
  <span>}</span>

  <span>rayProgress</span> <span>+=</span> <span>sceneDist</span><span>;</span>
<span>}</span>
</code></pre></div>

<p>It turns out that some pixels are really expensive to process. So in practice we use a for-loop instead of a while loop – that way we bail out if we’ve done too many steps. A common “slow case” in ray marching is when a ray is parallel to the edge of a shape in the scene…</p>



<p>The approach I’ve described so far will get you a scene that looks like the one below.</p>



<p>It’s cool, but the shadows are sharp which doesn’t look very good. The shadows in the demo look more like this…</p>

<img src="https://www.rykap.com/images/ray-marching/desired-shadows.png">

<p>One big disclaimer is that they’re not physically realistic! Real shadows look like hard shadows where the edges have been fuzzed. This approach does something slightly different: all pixels that were previously in shadow are still fully in shadow. We’ve just added a penumbra of partially shaded pixels around them.</p>

<p>The upside is that they’re pretty and fast to compute, and that’s what I care about! There are three “rules” involved in computing them.</p>

<p><strong>Rule 1:</strong> The closer a ray gets to intersecting a shape, the more its pixel should be shadowed. In the image below there are two similar rays (their distances to the shape pictured in yellow and green). We want the one that gets closer to touching the corner to be more shadowed.</p>

<img src="https://www.rykap.com/images/ray-marching/rule-1.png">

<p>This is cheap to compute because the variable <code>sceneDist</code> tells us how far we are from the closest shape at each ray marching step. So the smallest value of <code>sceneDist</code> across all steps is a good approximation for the yellow and green lines in the image above.</p>

<p><strong>Rule 2:</strong> if the pixel we’re shading is far from the point where it almost intersects a shape, we want the shadow to spread out more.</p>

<img src="https://www.rykap.com/images/ray-marching/rule-2.png">

<p>Consider two pixels along the ray above. One is closer to the almost-intersection and is lighter (its distance is the green line). The other is farther and darker (its distance is the yellow line). In general: the further a pixel is from its almost intersection, the more “in shadow” we should make it.</p>

<p>This is cheap to compute because the variable <code>rayProgress</code> is the length of the green and yellow lines in the image above.</p>

<p>So: we previously returned <code>1.0</code> for pixels that weren’t in shadow. To implement rules 1 and 2, we compute <code>sceneDist / rayProgress</code> on each ray marching step, keep track of its minimum value, and return that instead.</p>

<div><pre><code><span>vec2</span> <span>rayOrigin</span> <span>=</span> <span>...;</span>
<span>vec2</span> <span>rayDirection</span> <span>=</span> <span>...;</span>
<span>float</span> <span>rayProgress</span> <span>=</span> <span>0</span><span>.;</span>
<span>float</span> <span>stopAt</span> <span>=</span> <span>distance</span><span>(</span><span>samplePt</span><span>,</span> <span>lightPosition</span><span>);</span>
<span>float</span> <span>lightContribution</span> <span>=</span> <span>1</span><span>.;</span>
<span>for</span> <span>(</span><span>int</span> <span>i</span> <span>=</span> <span>0</span><span>;</span> <span>i</span> <span>&lt;</span> <span>64</span><span>;</span> <span>i</span><span>++</span><span>)</span> <span>{</span>
  <span>if</span> <span>(</span><span>rayProgress</span> <span>&gt;</span> <span>stopAt</span><span>)</span> <span>{</span>
    <span>return</span> <span>lightContribution</span><span>;</span>
  <span>}</span>

  <span>// `getDistance` samples our distance field texture.</span>
  <span>float</span> <span>sceneDist</span> <span>=</span> <span>getDistance</span><span>(</span>
    <span>rayOrigin</span> <span>+</span> <span>rayProgress</span> <span>*</span> <span>rayDirection</span><span>);</span>
  <span>if</span> <span>(</span><span>sceneDist</span> <span>&lt;=</span> <span>0</span><span>.)</span> <span>{</span>
    <span>// We hit a shape! This pixel is in shadow.</span>
    <span>return</span> <span>0</span><span>.;</span>
  <span>}</span>

  <span>lightContribution</span> <span>=</span> <span>min</span><span>(</span>
    <span>lightContribution</span><span>,</span>
    <span>sceneDist</span> <span>/</span> <span>rayProgress</span>
  <span>);</span>

  <span>rayProgress</span> <span>+=</span> <span>sceneDist</span><span>;</span>
<span>}</span>

<span>// Ray-marching took more than 64 steps!</span>
<span>return</span> <span>0</span><span>.;</span>
</code></pre></div>

<p>This ratio feels kind of magical to me because it doesn’t correspond to any physical value. So let’s build some intuition for it by thinking through why it might take on particular values…</p>

<ul>
  <li>
    <p>If <code>sceneDist / rayProgress &gt;= 1</code>, then either <code>sceneDist</code> is big or <code>rayProgress</code> is small (relative to each other). In the former case we’re far from any shapes and we shouldn’t be in shadow, so a light value of <code>1</code> makes sense. In the latter case, the pixel we’re shadowing is really close to an object casting a shadow and the shadow isn’t fuzzy yet, so a light value of <code>1</code> makes sense.</p>
  </li>
  <li>
    <p>The ratio is <code>0</code> only when <code>sceneDist</code> is <code>0</code>. This corresponds to rays that intersect an object and whose pixels are in shadow.</p>
  </li>
</ul>

<p>And here’s a demo of what we have so far…</p>



<p><strong>Rule #3</strong> is the most straightforward one: light gets weaker the further you get from it.</p>

<p>Instead of returning the minimum value of <code>sceneDist / rayProgress</code> verbatim, we multiply it by a <code>distanceFactor</code> which is <code>1</code> right next to the light, <code>0</code> far away from it, and gets quadratically smaller as you move away from it.</p>

<p>All together, the code for the approach so far looks like this…</p>

<div><pre><code><span>vec2</span> <span>rayOrigin</span> <span>=</span> <span>...;</span>
<span>vec2</span> <span>rayDirection</span> <span>=</span> <span>...;</span>
<span>float</span> <span>rayProgress</span> <span>=</span> <span>0</span><span>.;</span>
<span>float</span> <span>stopAt</span> <span>=</span> <span>distance</span><span>(</span><span>samplePt</span><span>,</span> <span>lightPosition</span><span>);</span>
<span>float</span> <span>lightContribution</span> <span>=</span> <span>1</span><span>.;</span>
<span>for</span> <span>(</span><span>int</span> <span>i</span> <span>=</span> <span>0</span><span>;</span> <span>i</span> <span>&lt;</span> <span>64</span><span>;</span> <span>i</span><span>++</span><span>)</span> <span>{</span>
  <span>if</span> <span>(</span><span>rayProgress</span> <span>&gt;</span> <span>stopAt</span><span>)</span> <span>{</span>
    <span>// We hit the light!</span>
    <span>float</span> <span>LIGHT_RADIUS_PX</span> <span>=</span> <span>800</span><span>.;</span>

    <span>// fadeRatio is 1.0 next to the light and 0. at</span>
    <span>// LIGHT_RADIUS_PX away.</span>
    <span>float</span> <span>fadeRatio</span> <span>=</span>
      <span>1</span><span>.</span><span>0</span> <span>-</span> <span>clamp</span><span>(</span><span>stopAt</span> <span>/</span> <span>LIGHT_RADIUS_PX</span><span>,</span> <span>0</span><span>.,</span> <span>1</span><span>.);</span>

    <span>// We'd like the light to fade off quadratically instead of</span>
    <span>// linearly.</span>
    <span>float</span> <span>distanceFactor</span> <span>=</span> <span>pow</span><span>(</span><span>fadeRatio</span><span>,</span> <span>2</span><span>.);</span>
    <span>return</span> <span>lightContribution</span> <span>*</span> <span>distanceFactor</span><span>;</span>
  <span>}</span>

  <span>// `getDistance` samples our distance field texture.</span>
  <span>float</span> <span>sceneDist</span> <span>=</span> <span>getDistance</span><span>(</span><span>rayOrigin</span> <span>+</span> <span>rayProgress</span> <span>*</span> <span>rayDirection</span><span>);</span>
  <span>if</span> <span>(</span><span>sceneDist</span> <span>&lt;=</span> <span>0</span><span>.)</span> <span>{</span>
    <span>// We hit a shape! This pixel is in shadow.</span>
    <span>return</span> <span>0</span><span>.;</span>
  <span>}</span>

  <span>lightContribution</span> <span>=</span> <span>min</span><span>(</span>
    <span>lightContribution</span><span>,</span>
    <span>sceneDist</span> <span>/</span> <span>rayProgress</span>
  <span>);</span>

  <span>rayProgress</span> <span>+=</span> <span>sceneDist</span><span>;</span>
<span>}</span>

<span>// Ray-marching took more than 64 steps!</span>
<span>return</span> <span>0</span><span>.;</span>
</code></pre></div>

<p>I forget where I found this soft-shadow technique, but I definitely didn’t invent it. Inigo Quilez <a href="https://www.iquilezles.org/www/articles/rmshadows/rmshadows.htm">has a great post on it</a> where he talks about using it in 3D.</p>

<p>Inigo’s post also talks about a gotcha with this approach that you might have noticed in the demos above: it causes banding artifacts. This is because Rule 1 assumes that the smallest value of <code>sceneDist</code> across all steps is a good approximation for the distance from a ray to the scene. This is not always true because we sometimes take very few ray marching steps.</p>

<p>So in my demo I use an improved approximation that Inigo writes about in his post. I also use another trick that is more effective but less performant: instead of advancing by <code>sceneDist</code> on each ray marching step, I advance by something like <code>sceneDist * randomJitter</code> where <code>randomJitter</code> is between <code>0</code> and <code>1</code>.</p>

<p>This improves the approximation because we’re adding more steps to our ray march. But we could do that by advancing by <code>sceneDist * .3</code>. The random jitter ensures that pixels next to each other don’t end up in the same band. This makes the result a little grainy which isn’t great. But I think looks better than banding… This is an aspect of the demo that I’m still not satisfied with, so if you have ideas for how to improve it please tell me!</p>

<p>Overall my demo has a few extra tweaks that I might write about in future but this is the core of it. Thanks for reading! If you have questions or comments, let me know <a href="https://twitter.com/ryanjkaplan">on Twitter</a>.</p>

<p><em>Thank you to Jessica Liu, Susan Wang, Matt Nichols and Kenrick Rilee for giving feedback on early drafts of this post! Also, if you enjoyed this post you might enjoy working with me at <a href="https://www.figma.com/careers/">Figma</a>!</em></p>

</article>






  
  
  






      </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Mixpanel Security Breach (203 pts)]]></title>
            <link>https://mixpanel.com/blog/sms-security-incident/</link>
            <guid>46066522</guid>
            <pubDate>Thu, 27 Nov 2025 07:02:40 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://mixpanel.com/blog/sms-security-incident/">https://mixpanel.com/blog/sms-security-incident/</a>, See on <a href="https://news.ycombinator.com/item?id=46066522">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><div><p><span>Out of transparency and our desire to share with our community, this blog post contains key information about a recent security incident that impacted a limited number of our customers.&nbsp;On November 8th, 2025, Mixpanel detected a smishing campaign and promptly executed our incident response processes. We took comprehensive steps to contain and eradicate unauthorized access and secure impacted user accounts. We engaged external cybersecurity partners to remediate and respond to the incident.</span></p></div><div><p><span>We proactively communicated with all impacted customers.&nbsp;If you have not heard from us directly, you were not impacted. We continue to prioritize security as a core tenant of our company, products and services. We are committed to supporting our customers and communicating transparently about this incident.&nbsp;</span></p></div><div><p><h2><span><strong>What we did in response</strong></span></h2></p></div><div><ul><span><li>Secured affected accounts</li><li>Revoked all active sessions and sign-ins</li><li>Rotated compromised Mixpanel credentials for impacted accounts</li><li>Blocked malicious IP addresses</li><li>Registered IOCs in our SIEM platform</li><li>Performed global password resets for all Mixpanel employees</li><li>Engaged third-party forensics firm to advise on containment and eradication measures</li><li>Performed a forensic review of authentication, session, and export logs across impacted accounts</li><li>Implemented additional controls to detect and block similar activity going forward.</li><li>Engaged with law enforcement and external cybersecurity advisors</li></span></ul></div><div><p><h2><span><strong>What you should know</strong></span></h2></p></div><div><ul><span><li>If you received a communication from us, please review it for the steps we have taken to secure your account, as well as next steps.&nbsp;</li><li>If you did not receive a communication from us, no action is required. Your accounts were not impacted.</li></span></ul></div><div><p><span>If you have any questions about this incident, please contact support@mixpanel.com.</span></p></div></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[The Nerd Reich – Silicon Valley Fascism and the War on Democracy (258 pts)]]></title>
            <link>https://www.simonandschuster.com/books/The-Nerd-Reich/Gil-Duran/9781668221402</link>
            <guid>46066482</guid>
            <pubDate>Thu, 27 Nov 2025 06:53:17 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.simonandschuster.com/books/The-Nerd-Reich/Gil-Duran/9781668221402">https://www.simonandschuster.com/books/The-Nerd-Reich/Gil-Duran/9781668221402</a>, See on <a href="https://news.ycombinator.com/item?id=46066482">Hacker News</a></p>
Couldn't get https://www.simonandschuster.com/books/The-Nerd-Reich/Gil-Duran/9781668221402: Error: Request failed with status code 403]]></description>
        </item>
        <item>
            <title><![CDATA[Linux Kernel Explorer (531 pts)]]></title>
            <link>https://reverser.dev/linux-kernel-explorer</link>
            <guid>46066280</guid>
            <pubDate>Thu, 27 Nov 2025 06:17:37 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://reverser.dev/linux-kernel-explorer">https://reverser.dev/linux-kernel-explorer</a>, See on <a href="https://news.ycombinator.com/item?id=46066280">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><p>The kernel isn't a process—it's the system. It serves user processes, reacts to context, and enforces separation and control.</p><ul><li><strong>The Kernel Is Not a Process</strong>: It's the always-present authority bridging hardware and software.</li><li><strong>Serving the Process</strong>: Orchestrates syscalls, interrupts, and scheduling to keep user tasks running.</li><li><strong>System of Layers</strong>: Virtual, mapped, isolated, and controlled—structure at runtime.</li></ul><div><h4>📚 Study Files</h4><div><p><span>init/main.c</span></p><p><span>kernel/fork.c</span></p><p><span>include/linux/sched.h</span></p><p><span>arch/x86/kernel/entry_64.S</span></p></div></div><div><div><div><p>1</p><!-- --><p>. </p><!-- --><p>What is the fundamental difference between the kernel and a process?</p></div><div><p><span>A<!-- -->.</span><span>The kernel is a special process with elevated privileges</span></p><p><span>B<!-- -->.</span><span>The kernel is not a process—it's the system itself that serves processes</span></p><p><span>C<!-- -->.</span><span>The kernel is just a library that processes link against</span></p><p><span>D<!-- -->.</span><span>There is no difference; they are the same thing</span></p></div></div><div><div><p>2</p><!-- --><p>. </p><!-- --><p>How does the kernel primarily serve user processes?</p></div><div><p><span>A<!-- -->.</span><span>By running as a background daemon</span></p><p><span>B<!-- -->.</span><span>By orchestrating syscalls, interrupts, and scheduling</span></p><p><span>C<!-- -->.</span><span>By providing a GUI interface</span></p><p><span>D<!-- -->.</span><span>By compiling user code</span></p></div></div><div><div><p>3</p><!-- --><p>. </p><!-- --><p>What characterizes the kernel's system of layers?</p></div><div><p><span>A<!-- -->.</span><span>Physical, tangible, and direct</span></p><p><span>B<!-- -->.</span><span>Simple and flat with no hierarchy</span></p><p><span>C<!-- -->.</span><span>Virtual, mapped, isolated, and controlled</span></p><p><span>D<!-- -->.</span><span>User-accessible and modifiable</span></p></div></div></div></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[HNInternal: Tell HN: Happy Thanksgiving (504 pts)]]></title>
            <link>https://news.ycombinator.com/item?id=46065955</link>
            <guid>46065955</guid>
            <pubDate>Thu, 27 Nov 2025 05:21:16 GMT</pubDate>
            <description><![CDATA[<p>See on <a href="https://news.ycombinator.com/item?id=46065955">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><tbody><tr id="46072467"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46072467" href="https://news.ycombinator.com/vote?id=46072467&amp;how=up&amp;goto=item%3Fid%3D46065955"></a></center></td><td><br>
<div><p>Happy thanksgiving all. In an era where algorithms on other platforms seem optimized for outrage and engagement bait, I'm grateful for HN's optimization for curiosity. It's one of the few places left where I can open a thread on a topic I disagree with and actually expect to have my mind changes -- or at least understand the opposing view better -- by the top comment.</p></div></td></tr></tbody></table></td></tr><tr id="46072317"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46072317" href="https://news.ycombinator.com/vote?id=46072317&amp;how=up&amp;goto=item%3Fid%3D46065955"></a></center></td><td><br>
<div><p>^^7</p><p>cheers to all you glorious bastards. i disagree with you on most things and quibble over pettiest crap, but know it is all in good fun. we are prolly in the weirdest point in computer history and get to see it make it through ( or not.. either is fine ). its a secret, but those annual affirtation are one of my favorite traditions.</p><p>here is to all the fun convos yet to come.</p></div></td></tr></tbody></table></td></tr><tr id="46066132"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46066132" href="https://news.ycombinator.com/vote?id=46066132&amp;how=up&amp;goto=item%3Fid%3D46065955"></a></center></td><td><br>
<div><p>Sixteen years here, and the half-life decay of this community has been slower than anywhere else. That takes real, consistent work, and we have been lucky to have it. Through good times and rough ones, including the loss of Aaron Swartz (who I only knew of through HN), this has stayed a place for real conversation.</p><p>The grit, curiosity, and people building things have always been inspiring.</p><p>Thanks for all the discussions over the years.</p><p>Happy Thanksgiving!</p></div></td></tr></tbody></table></td></tr><tr id="46072221"><td></td></tr><tr id="46072382"><td></td></tr><tr id="46072019"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46072019" href="https://news.ycombinator.com/vote?id=46072019&amp;how=up&amp;goto=item%3Fid%3D46065955"></a></center></td><td><br>
<div><p>Just completed 7 years on HN. This is the only social network I'm active on (if you don't count whatsapp). Awesome folks and amazing discussions!!</p></div></td></tr></tbody></table></td></tr><tr id="46072142"><td></td></tr><tr id="46072254"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46072254" href="https://news.ycombinator.com/vote?id=46072254&amp;how=up&amp;goto=item%3Fid%3D46065955"></a></center></td><td><br>
<div><p>Eighteen years here. I am not American but I think this is a holiday that we can all celebrate as reminder that we should be grateful for what and specially for who we have, independently what we don't have.</p></div></td></tr></tbody></table></td></tr><tr id="46072172"><td></td></tr><tr id="46072146"><td></td></tr><tr id="46066891"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46066891" href="https://news.ycombinator.com/vote?id=46066891&amp;how=up&amp;goto=item%3Fid%3D46065955"></a></center></td><td><br>
<div><p>Seems weird to say, but I've been posting here for seventeen years now. And in that time, can I say that the quality of the discourse has slipped some? Well... if I'm being honest, probably yeah. A little. But at the same time, I can still honestly say that HN is still easily the best community of this sort on the 'net, at least that I'm aware of. OK, Lobste.rs has some merit, but the problem there is that  the community there is arguably still a little too small, and you just don't get the variety and volume of interesting discussion you get here. But the level of discourse is high there as well.</p><p>Anyway, I find HN to be a wonderful refuge from a lot of the absurdity that's "out there" and I will happily throw in my own "Thanks, guys!" to dang and tomhow. And to pg for starting this whole thing back in the day.</p><p>Happy Thanksgiving, everyone, and here's to more years to come!</p></div></td></tr></tbody></table></td></tr><tr id="46071937"><td></td></tr><tr id="46072246"><td></td></tr><tr id="46072326"><td></td></tr><tr id="46071922"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46071922" href="https://news.ycombinator.com/vote?id=46071922&amp;how=up&amp;goto=item%3Fid%3D46065955"></a></center></td><td><br>
<div><p>15 years here too. I turn 40 today. Grateful for this community. I quit social media years ago but still enjoy the discourse here.</p></div></td></tr></tbody></table></td></tr><tr id="46072139"><td></td></tr><tr id="46072186"><td></td></tr><tr id="46072366"><td></td></tr><tr id="46072165"><td></td></tr><tr id="46072070"><td></td></tr><tr id="46071945"><td></td></tr><tr id="46072225"><td></td></tr><tr id="46072033"><td></td></tr><tr id="46072212"><td></td></tr><tr id="46071798"><td></td></tr><tr id="46071940"><td></td></tr><tr id="46072195"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46072195" href="https://news.ycombinator.com/vote?id=46072195&amp;how=up&amp;goto=item%3Fid%3D46065955"></a></center></td><td><br>
<div><p>Been lurking since 2011 or so. Dare I say that the average level of discourse has finally fallen to a level where I feel comfortable participating after over ten years of just reading.</p><p>That being said HN was and continues to be one of the most valuable resources for geeks on the net.</p></div></td></tr></tbody></table></td></tr><tr id="46071944"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46071944" href="https://news.ycombinator.com/vote?id=46071944&amp;how=up&amp;goto=item%3Fid%3D46065955"></a></center></td><td><br>
<div><p>Hey, community! Thank you for this opportunity to connect and feel closeness to the best  parts and people in our industry.</p><p>Thank you for your open mindedness, smarts, stupid fun and lovable nerdiness.</p><p>I feel at home here.</p><p>One thing that makes me sad are dystopian fears. Not sure if this is warranted or not, but certainly get my dose of dread from HN. But thank you for being so sensitive and caring in this.</p><p>Happy thanksgiving.</p></div></td></tr></tbody></table></td></tr><tr id="46072312"><td></td></tr><tr id="46071964"><td></td></tr><tr id="46072102"><td></td></tr><tr id="46072141"><td></td></tr><tr id="46072030"><td></td></tr><tr id="46066119"><td></td></tr><tr id="46072075"><td></td></tr><tr id="46069702"><td></td></tr><tr id="46071046"><td><table><tbody><tr><td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td><center><a id="up_46071046" href="https://news.ycombinator.com/vote?id=46071046&amp;how=up&amp;goto=item%3Fid%3D46065955"></a></center></td><td><br>
<div><p>Happy Thanksgiving!</p><p>Use this day to eat good food, converse with relatives, and rest from the usual madness.  Peace on Earth.</p></div></td></tr></tbody></table></td></tr><tr id="46071853"><td></td></tr><tr id="46072201"><td></td></tr><tr id="46071917"><td><table><tbody><tr><td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td><center><a id="up_46071917" href="https://news.ycombinator.com/vote?id=46071917&amp;how=up&amp;goto=item%3Fid%3D46065955"></a></center></td><td><br>
<div><p>Wasn't Thanksgiving a practice before people came to the US? The US now does it, but they didn't start it. I only know it because I'm Dutch and I wanted to see if the Dutchies were somehow involved (because they are way more often than they should be). Here's a source I quickly found but there are many sources on it [1].</p><p>There's more to Thanksgiving than only the US.</p><p>[1] <a href="https://www.iamexpat.nl/lifestyle/lifestyle-news/how-netherlands-played-role-history-thanksgiving" rel="nofollow">https://www.iamexpat.nl/lifestyle/lifestyle-news/how-netherl...</a></p></div></td></tr></tbody></table></td></tr><tr id="46071864"><td></td></tr><tr id="46071885"><td><table><tbody><tr><td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td><center><a id="up_46071885" href="https://news.ycombinator.com/vote?id=46071885&amp;how=up&amp;goto=item%3Fid%3D46065955"></a></center></td><td><br>
<div><p>this always gets brought up, but realistically no one ever cares or brings this up from the perspective of celebrating American origins, but rather just a reminder to be thankful for things in your life that matter to you. I don't see the problem with this</p></div></td></tr></tbody></table></td></tr><tr id="46071902"><td><table><tbody><tr><td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td><center><a id="up_46071902" href="https://news.ycombinator.com/vote?id=46071902&amp;how=up&amp;goto=item%3Fid%3D46065955"></a></center></td><td><br>
<div><p>North American natives were exterminating and enslaving each other long before the Europeans got there.</p><p>Nobody has anything to be proud of.</p></div></td></tr></tbody></table></td></tr><tr id="46072239"><td><table><tbody><tr><td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td><center><a id="up_46072239" href="https://news.ycombinator.com/vote?id=46072239&amp;how=up&amp;goto=item%3Fid%3D46065955"></a></center></td><td><br>
<div><p>The term "slave" encompasses a lot of wildly different kinds of unfree labor. The racialized system most people think of from transatlantic slavery is a very recent thing.</p><p>Nothing resembling that was widespread in precolumbian North America. The earliest similar systems I'm aware of took root in the 17th and 18th centuries, well into the early colonial period.</p></div></td></tr></tbody></table></td></tr><tr id="46072304"><td><table><tbody><tr><td indent="3"><img src="https://news.ycombinator.com/s.gif" height="1" width="120"></td><td><center><a id="up_46072304" href="https://news.ycombinator.com/vote?id=46072304&amp;how=up&amp;goto=item%3Fid%3D46065955"></a></center></td><td><br>
<div><p>Research what the Iroquois did to the Huron people, what the Apache did to the Pueblos, and what the Aztecs did to everybody.</p><p>The continent what a slaughter show for thousands of years.</p></div></td></tr></tbody></table></td></tr><tr id="46072194"><td><table><tbody><tr><td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td><center><a id="up_46072194" href="https://news.ycombinator.com/vote?id=46072194&amp;how=up&amp;goto=item%3Fid%3D46065955"></a></center></td><td><br>
<div><p>While it was (mostly?) unintentional, the biological warfare committed by Europeans makes for a different story than anything that happened before they arrived. The Americas weren't a paradise, but neither were they a slaughterhouse.</p></div></td></tr></tbody></table></td></tr><tr id="46072059"><td></td></tr><tr id="46072219"><td></td></tr><tr id="46072232"><td></td></tr></tbody></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Music eases surgery and speeds recovery, study finds (194 pts)]]></title>
            <link>https://www.bbc.com/news/articles/c231dv9zpz3o</link>
            <guid>46065817</guid>
            <pubDate>Thu, 27 Nov 2025 04:55:57 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.bbc.com/news/articles/c231dv9zpz3o">https://www.bbc.com/news/articles/c231dv9zpz3o</a>, See on <a href="https://news.ycombinator.com/item?id=46065817">Hacker News</a></p>
<div id="readability-page-1" class="page"><article><p data-component="headline-block"><h2>Music eases surgery and speeds recovery, Indian study finds</h2></p><div data-testid="byline-new" data-component="byline-block"><p><span data-testid="byline-new-contributors"><div data-testid="byline-new-contributors-contributor-0"><p><span>Soutik Biswas</span><span data-testid="byline-new-contributors-contributor-0-role-location">India correspondent</span></p></div></span></p></div><figure><div data-component="image-block"><p><img src="https://static.files.bbci.co.uk/bbcdotcom/web/20251120-101800-81b2dab7dc-web-2.34.1-2/grey-placeholder.png" aria-label="image unavailable"><img sizes="(min-width: 1280px) 50vw, (min-width: 1008px) 66vw, 96vw" srcset="https://ichef.bbci.co.uk/news/240/cpsprodpb/6712/live/6ce97290-c89b-11f0-bd7c-1744b857cc58.jpg.webp 240w,https://ichef.bbci.co.uk/news/320/cpsprodpb/6712/live/6ce97290-c89b-11f0-bd7c-1744b857cc58.jpg.webp 320w,https://ichef.bbci.co.uk/news/480/cpsprodpb/6712/live/6ce97290-c89b-11f0-bd7c-1744b857cc58.jpg.webp 480w,https://ichef.bbci.co.uk/news/640/cpsprodpb/6712/live/6ce97290-c89b-11f0-bd7c-1744b857cc58.jpg.webp 640w,https://ichef.bbci.co.uk/news/800/cpsprodpb/6712/live/6ce97290-c89b-11f0-bd7c-1744b857cc58.jpg.webp 800w,https://ichef.bbci.co.uk/news/1024/cpsprodpb/6712/live/6ce97290-c89b-11f0-bd7c-1744b857cc58.jpg.webp 1024w,https://ichef.bbci.co.uk/news/1536/cpsprodpb/6712/live/6ce97290-c89b-11f0-bd7c-1744b857cc58.jpg.webp 1536w" src="https://ichef.bbci.co.uk/news/480/cpsprodpb/6712/live/6ce97290-c89b-11f0-bd7c-1744b857cc58.jpg.webp" loading="eager" alt="BBC A patient with headphones playing music during surgery in a hospital in Delhi"><span>BBC</span></p></div><p data-component="caption-block"><figcaption>A patient with headphones playing music during surgery in a hospital in Delhi</figcaption></p></figure><div data-component="text-block"><p>Under the harsh lights of an operating theatre in the Indian capital, Delhi, a woman lies motionless as surgeons prepare to remove her gallbladder.</p><p>She is under general anaesthesia: unconscious, insensate and rendered completely still by a blend of drugs that induce deep sleep, block memory, blunt pain and temporarily paralyse her muscles.</p><p>Yet, amid the hum of monitors and the steady rhythm of the surgical team, a gentle stream of flute music plays through the headphones placed over her ears.</p><p>Even as the drugs silence much of her brain, its auditory pathway remains partly active. When she wakes up, she will regain consciousness more quickly and clearly because she required lower doses of anaesthetic drugs such as propofol and opioid painkillers than patients who heard no music.</p><p>That, at least, is what a <a target="_blank" href="https://mmd.iammonline.com/index.php/musmed/article/view/1111">new peer-reviewed study</a> from Delhi's Maulana Azad Medical College and Lok Nayak Hospital suggests. The research, published in the journal Music and Medicine, offers some of the strongest evidence yet that music played during general anaesthesia can modestly but meaningfully reduce drug requirements and improve recovery.</p><p>The study focuses on patients undergoing laparoscopic cholecystectomy, the standard keyhole operation to remove the gallbladder. The procedure is short - usually under an hour - and demands a particularly swift, "clear-headed" recovery.</p><p>To understand why the researchers turned to music, it helps to decode the modern practice of anaesthesia.</p><p>"Our aim is early discharge after surgery," says Dr Farah Husain, senior specialist in anaesthesia and certified music therapist for the study. "Patients need to wake up clear-headed, alert and oriented, and ideally pain-free. With better pain management, the stress response is curtailed." </p><p>Achieving that requires a carefully balanced mix of five or six drugs that together keep the patient asleep, block pain, prevent memory of the surgery and relax the muscles.</p></div><figure><div data-component="image-block"><p><img src="https://static.files.bbci.co.uk/bbcdotcom/web/20251120-101800-81b2dab7dc-web-2.34.1-2/grey-placeholder.png" aria-label="image unavailable"><img sizes="(min-width: 1280px) 50vw, (min-width: 1008px) 66vw, 96vw" srcset="https://ichef.bbci.co.uk/news/240/cpsprodpb/1dd7/live/f3017100-c2c1-11f0-8669-5560f5c90fbe.jpg.webp 240w,https://ichef.bbci.co.uk/news/320/cpsprodpb/1dd7/live/f3017100-c2c1-11f0-8669-5560f5c90fbe.jpg.webp 320w,https://ichef.bbci.co.uk/news/480/cpsprodpb/1dd7/live/f3017100-c2c1-11f0-8669-5560f5c90fbe.jpg.webp 480w,https://ichef.bbci.co.uk/news/640/cpsprodpb/1dd7/live/f3017100-c2c1-11f0-8669-5560f5c90fbe.jpg.webp 640w,https://ichef.bbci.co.uk/news/800/cpsprodpb/1dd7/live/f3017100-c2c1-11f0-8669-5560f5c90fbe.jpg.webp 800w,https://ichef.bbci.co.uk/news/1024/cpsprodpb/1dd7/live/f3017100-c2c1-11f0-8669-5560f5c90fbe.jpg.webp 1024w,https://ichef.bbci.co.uk/news/1536/cpsprodpb/1dd7/live/f3017100-c2c1-11f0-8669-5560f5c90fbe.jpg.webp 1536w" src="https://ichef.bbci.co.uk/news/480/cpsprodpb/1dd7/live/f3017100-c2c1-11f0-8669-5560f5c90fbe.jpg.webp" loading="lazy" alt="Getty Images Indian surgeons medical team performing surgery in operation theater at hospital"><span>Getty Images</span></p></div><p data-component="caption-block"><figcaption>Patients need to wake up clear-headed and ideally pain-free after surgery</figcaption></p></figure><div data-component="text-block"><p>In procedures like laparoscopic gallbladder removal, anaesthesiologists now often supplement this drug regimen with regional "blocks" - ultrasound-guided injections that numb nerves in the abdominal wall. </p><p>"General anaesthesia plus blocks is the norm," says Dr Tanvi Goel, primary investigator and a former senior resident of Maulana Azad Medical College. "We've been doing this for decades."</p><p>But the body does not take to surgery easily. Even under anaesthesia, it reacts: heart rate rises, hormones surge, blood pressure spikes. Reducing and managing this cascade is one of the central goals of modern surgical care. Dr Husain explains that the stress response can slow recovery and worsen inflammation, highlighting why careful management is so important.</p><p>The stress starts even before the first cut, with intubation - the insertion of a breathing tube into the windpipe.</p><p>To do this, the anaesthesiologist uses a laryngoscope to lift the tongue and soft tissues at the base of the throat, obtain a clear view of the vocal cords, and guide the tube into the trachea. It's a routine step in general anaesthesia that keeps the airway open and allows precise control of the patient's breathing while they are unconscious.</p><p>"The laryngoscopy and intubation are considered the most stressful response during general anaesthesia," says Dr Sonia Wadhawan, director-professor of anaesthesia and intensive care at Maulana Azad Medical College and supervisor of the study.</p><p>"Although the patient is unconscious and will remember nothing, their body still reacts to the stress with changes in heart rate, blood pressure, and stress hormones."</p><p>To be sure, the drugs have evolved. The old ether masks have vanished. In their place are intravenous agents - most notably propofol, the hypnotic made infamous by <a target="_self" href="https://www.bbc.co.uk/news/newsbeat-15634083">Michael Jackson's death</a> but prized in operating theatres for its rapid onset and clean recovery. "Propofol acts within about 12 seconds," notes Dr Goel. "We prefer it for short surgeries like laparoscopic cholecystectomy because it avoids the 'hangover' caused by inhalational gases."</p><p>The team of researchers wanted to know whether music could reduce how much propofol and fentanyl (an opioid painkiller) patients required. Less drugs means faster awakening, steadier vital signs and reduced side effects.</p><p>So they designed a study. A pilot involving eight patients led to a full 11-month trial of 56 adults, aged roughly 20 to 45, randomly assigned to two groups. All received the same five-drug regimen: a drug that prevents nausea and vomiting, a sedative, fentanyl, propofol and a muscle relaxant. Both groups wore noise-cancelling headphones - but only one heard music.</p><p>"We asked patients to select from two calming instrumental pieces - soft flute or piano," says Dr Husain. "The unconscious mind still has areas that remain active. Even if the music isn't explicitly recalled, implicit awareness can lead to beneficial effects."</p></div><figure><div data-component="image-block"><p><img src="https://static.files.bbci.co.uk/bbcdotcom/web/20251120-101800-81b2dab7dc-web-2.34.1-2/grey-placeholder.png" aria-label="image unavailable"><img sizes="(min-width: 1280px) 50vw, (min-width: 1008px) 66vw, 96vw" srcset="https://ichef.bbci.co.uk/news/240/cpsprodpb/dd22/live/a51ebd90-c2c0-11f0-bd8a-f3f60edded8d.jpg.webp 240w,https://ichef.bbci.co.uk/news/320/cpsprodpb/dd22/live/a51ebd90-c2c0-11f0-bd8a-f3f60edded8d.jpg.webp 320w,https://ichef.bbci.co.uk/news/480/cpsprodpb/dd22/live/a51ebd90-c2c0-11f0-bd8a-f3f60edded8d.jpg.webp 480w,https://ichef.bbci.co.uk/news/640/cpsprodpb/dd22/live/a51ebd90-c2c0-11f0-bd8a-f3f60edded8d.jpg.webp 640w,https://ichef.bbci.co.uk/news/800/cpsprodpb/dd22/live/a51ebd90-c2c0-11f0-bd8a-f3f60edded8d.jpg.webp 800w,https://ichef.bbci.co.uk/news/1024/cpsprodpb/dd22/live/a51ebd90-c2c0-11f0-bd8a-f3f60edded8d.jpg.webp 1024w,https://ichef.bbci.co.uk/news/1536/cpsprodpb/dd22/live/a51ebd90-c2c0-11f0-bd8a-f3f60edded8d.jpg.webp 1536w" src="https://ichef.bbci.co.uk/news/480/cpsprodpb/dd22/live/a51ebd90-c2c0-11f0-bd8a-f3f60edded8d.jpg.webp" loading="lazy" alt="A pilot on eight patients led to a full trial of 56 adults randomly assigned to two groups "></p></div><p data-component="caption-block"><figcaption>A pilot involving eight patients led to a full trial of 56 adults randomly assigned to two groups </figcaption></p></figure><div data-component="text-block"><p>The results were striking.</p><p>Patients exposed to music required lower doses of propofol and fentanyl. They experienced smoother recoveries, lower cortisol or stress-hormone levels and a much better control of blood pressure during the surgery. "Since the ability to hear remains intact under anaesthesia," the researchers write, "music can still shape the brain's internal state."</p><p>Clearly, music seemed to quieten the internal storm. "The auditory pathway remains active even when you're unconscious," says Dr Wadhawan. "You may not remember the music, but the brain registers it."</p><p>The idea that the mind behind the anaesthetic veil is not entirely silent has long intrigued scientists. Rare cases of "intraoperative awareness" show patients recalling fragments of operating-room conversation. </p><p>If the brain is capable of picking up and remembering stressful experiences during surgery - even when a patient is unconscious - then it might also be able to register positive or comforting experiences, like music, even without conscious memory.</p><p>"We're only beginning to explore how the unconscious mind responds to non-pharmacological interventions like music," says Dr Husain. "It's a way of humanising the operating room."</p><p>Music therapy is not new to medicine; it has long been used in psychiatry, stroke rehabilitation and palliative care. But its entry into the intensely technical, machine-governed world of anaesthesia marks a quiet shift.</p><p>If such a simple intervention can reduce drug use and speed recovery - even modestly - it could reshape how hospitals think about surgical wellbeing.</p><p>As the research team prepares its next study exploring music-aided sedation, building on earlier findings, one truth is already humming through the data: even when the body is still and the mind asleep, it appears a few gentle notes can help the healing begin.</p></div></article></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Coq: The World's Best Macro Assembler? (2013) [pdf] (139 pts)]]></title>
            <link>https://nickbenton.name/coqasm.pdf</link>
            <guid>46065698</guid>
            <pubDate>Thu, 27 Nov 2025 04:34:56 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://nickbenton.name/coqasm.pdf">https://nickbenton.name/coqasm.pdf</a>, See on <a href="https://news.ycombinator.com/item?id=46065698">Hacker News</a></p>
&lt;Not HTML&gt;]]></description>
        </item>
        <item>
            <title><![CDATA[DIY NAS: 2026 Edition (385 pts)]]></title>
            <link>https://blog.briancmoses.com/2025/11/diy-nas-2026-edition.html</link>
            <guid>46065034</guid>
            <pubDate>Thu, 27 Nov 2025 02:54:23 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://blog.briancmoses.com/2025/11/diy-nas-2026-edition.html">https://blog.briancmoses.com/2025/11/diy-nas-2026-edition.html</a>, See on <a href="https://news.ycombinator.com/item?id=46065034">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><p>Fourteen years ago, my storage needs outpaced my capacity and I began to look into building a network attached storage server. I had a few criteria in mind and was curious to see if anyone had _ recently_ shared something similar, but I couldn’t find anything that was relevant.</p>

<p>In fact,  I found that the communities I was looking for answers in were actively hostile towards what I wanted to do.  This resulted in my decision <a href="https://blog.briancmoses.com/2012/01/do-it-yourself-network-attached-storage.html" title="My First DIY NAS: Building a NAS: Choosing Hardware">to build my own DIY NAS</a> and share that as one of my very first blogs.</p>

<p>Much to my surprise, people were very interested in that blog! Ever since, I’ve been building a similar DIY NAS machine almost every year trying to satisfy the curiosity of other prospective DIY NAS builders.</p>

<p>Here are those criteria:</p>

<ol>
  <li><strong>Small form factor</strong>: It’s not the case for me any more, but at the time the space was limited in my office. I always assume that space in everybody’s office is limited. As a result, I want my DIY NAS builds to occupy as little of that office space as I can.</li>
  <li><strong>At least six drive bays</strong>: Back when I built my NAS, it took about four drives’ worth of storage to meet my storage needs. Plus I desired two empty drive bays for future use. However, in the years since hard drive capacities have increased dramatically. At some point in the future, I may reduce this to four drive bays.</li>
  <li><strong>An integrated, low power CPU</strong>: I intend my DIY NAS to run 24 hours a day, 7 days a week, and 52 weeks a year. When it comes to power consumption, that can do some damage on your electric bill! Thankfully our electricity here isn’t as expensive as others’ in the United States, or even further outside its borders, but I try and keep power consumption in mind when picking components for a DIY NAS build.</li>
  <li><strong>Homelab potential</strong>: It does not take up a lot of CPU horsepower for a NAS to serve up files, which means that on modern hardware there’s a lot of untapped potential in a DIY NAS for virtual machines or containers to self-host services.</li>
</ol>

<p>It’s important to remember that <strong><em>these are my criteria</em></strong>, and not necessarily yours. Every DIY NAS builder should be making their own list of criteria and reconcile all of their component purchases against the criteria that’s important to them.</p>

<h2 id="is-it-even-a-good-time-to-build-a-nas">Is it even a good time to build a NAS?</h2>

<p>As I prepared to build this NAS, component prices disappointed me. Hard drives, SSDs, and RAM prices were all rising. Based on what I’ve been told, I expect Intel CPU prices to increase as well. My contact at Topton has been encouraging me to stock up on motherboards while they still have some in inventory. Based on what’s been explained to me, I expect the motherboard’s prices to rise and for their availability to potentially dwindle.</p>

<p><a href="https://blog.briancmoses.com/images/2026/diynas/ssd_prices.png" target="_blank"><img src="https://blog.briancmoses.com/images/2026/diynas/ssd_prices_600.png" alt="1TB NVMe SSD prices"></a></p>

<p>In short, the economy sucks and the price of DIY NAS components is a pretty good reflection of just how sucky things are becoming. I briefly considered not publishing a DIY NAS build this year hoping that things would improve a few months down the road. But then I asked myself, “What if it’s even worse in a few months?”</p>

<p>I sure hope things get better, but I fear and expect that they’ll get worse.</p>

<h2 id="motherboard-and-cpu">Motherboard and CPU</h2>
<p>I built <a href="https://blog.briancmoses.com/2023/03/diy-nas-2023-edition.html" title="DIY NAS: 2023 Edition">my first DIY NAS with a Topton motherboard in 2023</a>. Each DIY NAS since then has also featured a Topton motherboard. My only complaint about the motherboards has been that buying them from one of the Chinese e-tail sites like AliExpress is considered problematic by some. With every DIY NAS build, I try and go through all the motherboards that I can find  while searching for something with a better value proposition, but for each of the past three years I’ve landed on the latest offering from Topton.</p>

<p><a href="https://s.click.aliexpress.com/e/_c2zJj1aF" target="_blank" title="Topton N22 N355 Mini-ITX NAS Motherboard (8xSATA3, 2xM.2, 1x10Gbps, 2x2.5Gbps)"><img src="https://blog.briancmoses.com/images/2026/diynas/pp/topton_n22_175.png"></a>For the <em>DIY NAS: 2026 Edition</em>, I chose the <a href="https://s.click.aliexpress.com/e/_c2zJj1aF" title="Topton N22 N355 Mini-ITX NAS Motherboard (8xSATA3, 2xM.2, 1x10Gbps, 2x2.5Gbps)">Topton N22 motherboard</a> with the <a href="https://www.intel.com/content/www/us/en/products/sku/231803/intel-processor-n100-6m-cache-up-to-3-40-ghz/specifications.html" title="Intel® Processor N100">Intel Core 3 N355</a> CPU. The motherboard is similar to last year’s <a href="https://www.ebay.com/itm/127014563991" title="Topton N18 N100/N150/N305 Mini-ITX NAS Motherboard:6xSATA/2xM.2/2x2.5GbE/1x10GbE">Topton N18</a> but has incrementally more compelling features, particularly the extra 2 SATA ports, the PCI-e x1 slot, and the N355 CPU!</p>

<ul>
  <li>Mini-ITX Form Factor</li>
  <li><a href="https://www.intel.com/content/www/us/en/products/sku/231803/intel-processor-n100-6m-cache-up-to-3-40-ghz/specifications.html" target="_blank" title="Intel® Processor N100">Intel® Processor Core 3 N355</a>
    <ul>
      <li>8 cores / 8 threads / Max Turbo 3.9GHz</li>
      <li>15 W TDP</li>
      <li>Integrated GPU with Intel Quick Sync Video</li>
    </ul>
  </li>
  <li>1 x DDR5 SO-DIMM</li>
  <li>8 x SATA 3.0 Ports (Asmedia ASM1164)</li>
  <li>2 x M.2 NVMe Slots (PCIe 3.0 x1)</li>
  <li>1 x 10Gbps NIC (Marvell AQC113C)</li>
  <li>2 x 2.5Gbps NICs (Intel i226-V)</li>
  <li>1 x PCI-e x1 or M.2 E-Key slot</li>
</ul>

<p>I opted for the motherboard with the <a href="https://www.intel.com/content/www/us/en/products/sku/231803/intel-processor-n100-6m-cache-up-to-3-40-ghz/specifications.html" target="_blank" title="Intel® Processor N100">Intel Core 3 N355</a> CPU. This makes the server a more capable homelab machine than prior years’ DIY NAS builds. The extra cores and threads come in handy for streaming media, replacing your cloud storage, facilitating home automation, hosting game servers, etc.</p>

<h2 id="case">Case</h2>
<p>Just like Topton has been making great motherboards for DIY NAS machines, JONSBO has been steadily releasing great cases for DIY NAS machines. This year SilverStone Technology released a new case, the <a href="https://www.amazon.com/SilverStone-Technology-hot-swappable-Performance-SST-CS383/dp/B0FDPNRYG9?&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=61605bf99f3551af48cd50574aa64608&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank" title="SilverStone Technology CS383 8-Bay hot-swappable high Performance Full Tower NAS Chassis, SST-CS383">CS383</a> (<a href="https://www.silverstonetek.com/en/product/info/computer-chassis/cs383/" title="SilverStone Technology CS383 Specs">specs</a>) which I was <strong><em>very interested</em></strong> in buying one for the <em>DIY NAS: 2026 Edition</em>. Unfortunately it carries a pretty hefty price tag to go along with all of its incredible features!</p>

<p><a href="https://www.amazon.com/gp/product/B0D1YH7D3J?th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=5636db0ca3c62e86da5f02b641c0f283&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank" title="JONSBO N4 Black NAS Pc Case, Walnut Wood, 8-Drive Bay/6 x 3.5-inch HDD (4 hot-swap,2 Non hot-swap),2 x 2.5-inch SSD, Micro ATX Chassis"><img src="https://blog.briancmoses.com/images/2026/diynas/pp/jonsbo-n4_200.png"></a>The <a href="https://www.amazon.com/gp/product/B0D1YH7D3J?th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=5636db0ca3c62e86da5f02b641c0f283&amp;language=en_US&amp;ref_=as_li_ss_tl" title="JONSBO N4 Black NAS Pc Case, Walnut Wood, 8-Drive Bay/6 x 3.5-inch HDD (4 hot-swap,2 Non hot-swap),2 x 2.5-inch SSD, Micro ATX Chassis">JONSBO N4</a> (<a href="https://www.jonsbo.com/en/products/N4Black.html" title="JONSBO N4 Case specs">specs</a>) is a third the price, adheres to my “smaller footprint” criteria, and it is rather impressive on its own. It’s a <em>tiny</em> bit larger case than last year’s DIY NAS, but I really like that it has drive bays for six 3.5” drives and two 2.5” drives.</p>

<p>Although, it’s peculiar in that two of the 3.5” drive bays (and the two 2.5” drive bays) aren’t attached to a SATA backplane and can’t be swapped anywhere as easily as the other four 3.5” bays. However, this peculiar decision seems to have caused the JONSBO N4 to sell for a bit less ($20-$40) than similar offerings from JONSBO. At its price, it’s a compelling value proposition!</p>

<h3 id="case-fan">Case Fan</h3>
<p><a href="https://www.amazon.com/dp/B09C6DQDNT?th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=a917ad99ae5994be300a55a6e8fc8fe2&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank" title="Noctua NF-A12x25 PWM chromax.Black.swap, Premium Quiet Fan, 4-Pin (120mm, Black) "><img src="https://blog.briancmoses.com/images/2026/diynas/pp/NF-A12x25_175.png"></a>In the past, I’ve found that the fans which come with JONSBO cases are too noisy. They’ve been noisy for two reasons; the design quality of the fans make them  loud. And the fans are constantly running at their top speed because of the fan header they’re plugged into on the cases’ SATA backplanes.</p>

<p>I anticipated that fan efficiency and noise would be a problem, so I picked out the <a href="https://www.amazon.com/dp/B09C6DQDNT?th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=a917ad99ae5994be300a55a6e8fc8fe2&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank" title="Noctua NF-A12x25 PWM chromax.Black.swap, Premium Quiet Fan, 4-Pin (120mm, Black) ">Noctua NF-A12x25 PWM</a> to solve it. Firstly, swapping in a high-quality fan that pushes more air <strong><em>and</em></strong> generates less noise–especially at its top speed–is a good first step. Secondly, I’d address the problem by plugging the fan into the motherboard’s <code>SYS_FAN</code> header instead of on the SATA backplane. This provides the opportunity to tune the fan’s RPMs directly in the BIOS and generate far less noise.</p>

<h2 id="ram">RAM</h2>
<p><a href="https://www.amazon.com/Crucial-4800MHz-Laptop-Memory-CT32G48C40S5/dp/B09RVNMGFH?th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=8a98ba9480c4e010efbe51f71f992fbd&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank" title="Crucial 32GB DDR5 RAM 4800MHz (CT32G48C40S5)"><img src="https://blog.briancmoses.com/images/2026/diynas/pp/CT32G48C40S5-C16A1_175.png"></a>The first time I first asked myself, “Should I even build the <em>DIY NAS: 2026 Edition</em>?” came as I was checking prices on DDR5 memory. Thankfully for me I had leftover RAM after purchasing DDR5 4800MHz SODIMMs for the <a href="https://blog.briancmoses.com/2024/11/diy-nas-2025-edition.html" title="DIY NAS: 2025 Edition">DIY NAS: 2025 Edition</a>,  <a href="https://blog.briancmoses.com/2025/03/an-all-flash-diy-nas-that-fits-in-my-pocket.html" title="An all-flash DIY NAS that fits in my pocket!">the Pocket Mini NAS</a>, and then again for the <a href="https://blog.briancmoses.com/2025/09/diy-nas-2025-texas-linux-fest-edition.html" title="DIY NAS: 2025 Texas Linux Fest Edition">DIY NAS that I built and gave away at 2025’s Texas Linux Fest</a>. I was personally thankful that I had one brand new  32GB DDR5 4800MHz SODIMM laying around, but I was wildly disappointed for everybody who will try and follow this build when I saw the price of those same SODIMMs.</p>

<p>Regardless, I felt a <a href="https://www.amazon.com/Crucial-4800MHz-Laptop-Memory-CT32G48C40S5/dp/B09RVNMGFH?th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=8a98ba9480c4e010efbe51f71f992fbd&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank" title="Crucial 32GB DDR5 RAM 4800MHz (CT32G48C40S5)">Crucial 32GB DDR5 4800MHz SODIMM</a> (<a href="https://www.crucial.com/memory/ddr5/CT32G48C40S5" title="Crucial 32GB DDR5-4800 SODIMM specs">specs</a>) was the right amount of RAM to get started with for a DIY NAS build in 2025. Whether you just need storage or you wish to also host virtual machines, you will benefit from having more than the bare minimum recommendation of RAM. I really wanted to buy a <a href="https://www.amazon.com/Crucial-5600MT-5200MT-4800MT-CT48G56C46S5/dp/B0C79T2CP7?th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=36fd2ef6ac56fee00617824bfe0a0676&amp;language=en_US&amp;ref_=as_li_ss_tl" title="Crucial 48GB DDR5 RAM, 5600MHz (or 5200MHz or 4800MHz) Laptop Memory, SODIMM 262-Pin, Compatible with 13th Gen Intel Core and AMD Ryzen 6000 - CT48G56C46S5 ">48GB DDR5 4800MHZ SODIMM</a> for this DIY NAS build, but I couldn’t talk myself into spending the $250-$300 that it would’ve wound up costing.</p>

<h2 id="storage">Storage</h2>

<p>A quick disclaimer about all the drives that I purchased for the <em>DIY NAS: 2026 Edition</em>, I already had all of them! I tend to buy things when I see them on sale and as a result, I have a collection of brand new parts for machines in my homelab or for upcoming projects. I raided that collection of spare parts for the <em>DIY NAS: 2026 Edition</em>.</p>

<h3 id="boot-drive">Boot Drive</h3>

<p>If you ranked the drives in your DIY NAS in order of importance, the boot drive should be the least-important drive. That is <strong><em>not</em></strong> saying that boot drive isn’t performing an important function, but I am suggesting that you shouldn’t invest a bunch of energy and money into picking the optimal boot drive.</p>

<p><a href="https://www.amazon.com/dp/B0963SGYGF?&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=335ccbcac1cb1beb1ad0bbbe951f4cea&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank" title="Silicon Power 128GB A55 SATA SSD (SU128GBSS3A55S25AH)"><img src="https://blog.briancmoses.com/images/2026/diynas/pp/sp-a55-128gb_175.png"></a>Because the <a href="https://www.amazon.com/gp/product/B0D1YH7D3J?th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=5636db0ca3c62e86da5f02b641c0f283&amp;language=en_US&amp;ref_=as_li_ss_tl" title="JONSBO N4 Black NAS Pc Case, Walnut Wood, 8-Drive Bay/6 x 3.5-inch HDD (4 hot-swap,2 Non hot-swap),2 x 2.5-inch SSD, Micro ATX Chassis">JONSBO N4</a> has a pair of 2.5” drive bays, I decided that a 2.5” SATA SSD would be ideal for the boot drives. As a rule of thumb, I try and spend less than $30 per boot drive in my DIY NAS builds.</p>

<p>Ultimately I selected a pair of <a href="https://www.amazon.com/dp/B0963SGYGF?&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=335ccbcac1cb1beb1ad0bbbe951f4cea&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank" title="Silicon Power 128GB A55 SATA SSD (SU128GBSS3A55S25AH)">128GB Silicon Power A55 SSDs</a> (<a href="https://www.silicon-power.com/product-detail/ace_a55/" title="Silicon Power 128GB A55 SATA SSD specs">specs</a>). I’ve used these before, I’d use them again in the future, and I even have four of their higher capacity (1TB) SSDs in a pool in my own NAS.</p>

<h3 id="app-and-virtual-machine-nvme-ssds">App and Virtual Machine NVMe SSDs</h3>

<p>Self-hosting apps and virtual machines on your DIY NAS has really exploded in the past few years. The developers of NAS appliance packages have made it much easier and the self-hosted products themselves have become as good–or often better–than things you’re probably subscribing to today. Because of that, I saved the highest-performing storage options on the <a href="https://s.click.aliexpress.com/e/_c2zJj1aF" target="_blank" title="Topton N22 N355 Mini-ITX NAS Motherboard (8xSATA3, 2xM.2, 1x10Gbps, 2x2.5Gbps)">Topton N22 motherboard</a> for apps and VMs.</p>

<p><a href="https://www.amazon.com/dp/B07ZGJVTZK?&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=27613853bea52aac53f1068188e5c5e3&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank" title="Teamgroup MP44 1TB NVMe SSD"><img src="https://blog.briancmoses.com/images/2026/diynas/pp/SiliconPower-SSD-P34A60-Product_175.png"></a>However, it’s important to point out that these M.2 slots are PCI-e version 3 and capped at a single PCI-e lane. This is a consequence of the limited number of PCI-e lanes available for each of the CPU options available for  the <a href="https://s.click.aliexpress.com/e/_c2zJj1aF" title="Topton N22 N355 Mini-ITX NAS Motherboard (8xSATA3, 2xM.2, 1x10Gbps, 2x2.5Gbps)">Topton N22 motherboard</a> (N100, N150, N305, and N355).</p>

<p>I opted for a NVMe drive that was a good value rather than a high performer and chose two of the <a href="https://www.amazon.com/dp/B07ZGJVTZK?&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=27613853bea52aac53f1068188e5c5e3&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank" title="Teamgroup MP44 1TB NVMe SSD">Silicon Power 1TB M.2 NVMe SSDs (SP001TBP34A60M28)</a> (<a href="https://www.silicon-power.com/product-detail/PCIe_Gen_3x4_P34A60/">specs</a>).</p>

<h3 id="bulk-storage-hard-disk-drives">Bulk Storage Hard Disk Drives</h3>
<p><a href="https://serverpartdeals.com/collections/hard-drives" target="_blank" title="ServerPartDeas: One of Brian's favorite places to shop for hard drives."><img src="https://blog.briancmoses.com/images/2025/diynas/pp/ST18000NM003D_175.png"></a>Thanks to rising prices, I opted to do like I’ve done with past DIY NAS builds and skip buying hard drives for the <em>DIY NAS: 2026 Edition</em>.</p>

<p>When planning your DIY NAS, it is good to always remember that <strong><em>storage will ultimately be your costliest and most important expense</em></strong>.</p>

<p>Here’s a few things to consider when buying hard drives:</p>

<ol>
  <li>Determine your hardware redundancy preferences. I recommend having two hard disk drives’ worth of redundancy (RAIDZ2, RAID6, etc.)</li>
  <li>Focus on price-per-terabyte when comparing prices of drives.</li>
  <li>Do some <a href="https://github.com/Spearfoot/disk-burnin-and-testing" target="_blank" title="Spearfoot's disk-burnin-and-testing Script on GitHub">burn in testing</a> of your hard drives before putting them to use.</li>
  <li>When buying new drives of the same model, try and buy them from multiple vendors to increase the chances of buying drives manufactured in separate batches.</li>
  <li>Plan Ahead! Understand the rate that your storage grows so that you can craft a strategy to grow your storage down the road.</li>
  <li>Being cheap today can and will paint you into a corner that’s quite expensive to get out of.</li>
  <li>Understand that RAID is not a backup!</li>
</ol>

<p>Thankfully, I’ve collected a bunch of my own decomissioned hard drives which I used to thoroughly test this DIY NAS build.</p>

<h2 id="sata-cables">SATA Cables</h2>
<p><a href="https://www.amazon.com/gp/product/B08C2LJBLW?th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=18fa5e170ef32c966b38bd844a0b8b35&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank" title="OIKWAN SFF-8643 Host to 4 X SATA Breakout Cable"><img src="https://blog.briancmoses.com/images/2026/diynas/pp/sff-8643-cable_175.png"></a>One of the under-the-radar features of the <a href="https://s.click.aliexpress.com/e/_c2zJj1aF" title="Topton N22 N355 Mini-ITX NAS Motherboard (8xSATA3, 2xM.2, 1x10Gbps, 2x2.5Gbps)">Topton N22 motherboard</a> might be one of my favorite features! The motherboard’s Asmedia ASM1164 SATA controllers sit behind two SFF-8643 connectors. These connectors provide two advantages for these motherboards:</p>

<ol>
  <li>Saves room on the motherboard’s PCB.</li>
  <li><a href="https://www.amazon.com/gp/product/B08C2LJBLW?th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=18fa5e170ef32c966b38bd844a0b8b35&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank" title="OIKWAN SFF-8643 Host to 4 X SATA Breakout Cable">SFF-8643 to 4x SATA breakout cables</a> reduces the amount of cable management hassle.</li>
</ol>

<h2 id="power-supply">Power Supply</h2>
<p>The one thing that I have routinely disliked about building small form factor DIY NAS machines is the price tag that accompanies a small form factor power supply (SFX) like is required with the <a href="https://www.amazon.com/gp/product/B0D1YH7D3J?th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=5636db0ca3c62e86da5f02b641c0f283&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank" title="JONSBO N4 Black NAS Pc Case, Walnut Wood, 8-Drive Bay/6 x 3.5-inch HDD (4 hot-swap,2 Non hot-swap),2 x 2.5-inch SSD, Micro ATX Chassis">JONSBO N4</a>.</p>

<p><a href="https://www.amazon.com/gp/product/B075M5FRQS?th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=a8eca3bbe367f280660bd7085d88d1e0&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank" title="SilverStone Technology SX500-G 500W SFX Fully Modular 80 Plus Gold PSU"><img src="https://blog.briancmoses.com/images/2026/diynas/pp/SX500-G_175.png"></a>I wound up choosing the <a href="https://www.amazon.com/gp/product/B075M5FRQS?th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=a8eca3bbe367f280660bd7085d88d1e0&amp;language=en_US&amp;ref_=as_li_ss_tl" title="SilverStone Technology SX500-G 500W SFX Fully Modular 80 Plus Gold PSU">SilversStone Technology SX500-G</a> (<a href="https://www.silverstonetek.com/en/product/info/power-supplies/SX500-G/" title="SilverStone Technology SX500-G 500W specs">specs</a>) which I had used earlier in the year for the <a href="https://blog.briancmoses.com/2025/09/diy-nas-2025-texas-linux-fest-edition.html" title="DIY NAS: 2025 Texas Linux Fest Edition">DIY NAS I gave away at Texas Linux Fest</a>. Its 500W rating exceeds the needs of all the components that I’d picked out for the <em>DIY NAS: 2026 Edition</em>. Plus the power supply’s <a href="https://en.wikipedia.org/wiki/80_Plus">80 Plus Gold</a> rating aligns well with my criteria for power efficiency.</p>



<p>Regardless of whether it was called FreeNAS, TrueNAS, TrueNAS CORE, TrueNAS SCALE, or now <a href="https://www.truenas.com/truenas-community-edition/" target="_blank" title="TrueNAS Community Edition">TrueNAS Community Edition</a>, the storage appliance product(s) from iXSystems have always been my go-to choice. For each yearly DIY NAS build, I wander over to the <a href="https://www.truenas.com/software-status/">TrueNAS Software Status page</a> and look at the state of the current builds.</p>

<p>I’m conservative with my personal NAS setup. However, for these blog builds, I typically choose Early Adopter releases. This year that’s <a href="https://www.truenas.com/docs/scale/25.10/gettingstarted/versionnotes/" target="_blank" title="TrueNAS 25.10 (Goldeye) Version Notes">TrueNAS 25.10.0.1 (aka Goldeye)</a>. I enjoy being able to use these DIY NAS builds as a preview to the latest and greatest that TrueNAS has to offer.</p>

<p>I repeatedly choose TrueNAS because it’s what I’ve become accustomed to; it’s legitimately an enterprise-grade storage product, which is exactly the quality of solution that I want my data to depend on. At the same time it does not feel like you need a specialized certification and a truckload of enterprise storage experience to meet set up a NAS that exceeds your needs at home.</p>

<p><a href="https://www.truenas.com/truenas-community-edition/" target="_blank" title="TrueNAS Community Edition"><img src="https://blog.briancmoses.com/images/2026/diynas/truenas_open_storage-logo-full-color-rgb.png"></a></p>

<p>Many times I have been asked, “Why not <em>&lt;insert NAS appliance or OS here&gt;</em>?”  My answer to that question is, TrueNAS has always done everything that I need it to and they haven’t given me any reason to consider anything else. As a result, there’s never been a need for me to evaluate something else.</p>

<h2 id="partslist">Final Parts List</h2>

<table>
	<tbody><tr>
		<th>Component</th>
		<th colspan="2">Part Name</th>
		<th>Qty</th>
		<th>Cost</th>
	</tr>
	<tr>
		<td>Motherboard</td>	
		<td><a href="https://s.click.aliexpress.com/e/_c2zJj1aF" target="_blank">Topton N22 (w/ N355 CPU) NAS Motherboard</a></td>	
		<td><a href="https://www.toptonpc.com/product/intel-n100-6-bay-nas-motherboard-110g-2i226-v-2-5g-3lan-6sata3-0-2m-2-nvme-1ddr5-4800mhz-soft-router-firewall-itx-mainboard/" target="_blank">specs</a></td>	
		<td>1</td>	
		<td>$446.40</td>	
	</tr>
	<tr>
		<td>CPU</td>	
		<td>Intel Core 3 N355</td>	
		<td><a href="https://www.intel.com/content/www/us/en/products/sku/241639/intel-core-3-processor-n355-6m-cache-up-to-3-90-ghz/specifications.html" target="_blank">specs</a></td>	
		<td>1</td>	
		<td>N/A</td>	
	</tr>		
	<tr>
		<td>Memory</td>	
		<td><a href="https://www.amazon.com/Crucial-5200MHz-4800MHz-Laptop-CT32G52C42S5/dp/B0BNXYRR9Y?th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=acb7e10801bf0cf26d03423c185819cb&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank">
Crucial RAM 32GB DDR5 4800MHz SODIMM (CT32G48C40S5) </a></td>	
		<td><a href="https://www.crucial.com/memory/ddr5/CT32G48C40S5" target="_blank">specs</a></td>	
		<td>1</td>	
		<td>$172.96</td>	
	</tr>	
	<tr>
		<td>Case</td>	
		<td><a href="https://www.amazon.com/gp/product/B0D1YH7D3J?th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=5636db0ca3c62e86da5f02b641c0f283&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank">JONSBO N4</a></td>
		<td><a href="https://www.jonsbo.com/en/products/N2White.html" target="_blank">specs</a></td>	
		<td>1</td>	
		<td>$121.59</td>	
	</tr>
		<tr>
		<td>Case Fan</td>	
		<td><a href="https://www.amazon.com/dp/B09C6DQDNT?th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=a917ad99ae5994be300a55a6e8fc8fe2&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank">Noctua NF-A12x25 PWM chromax.Black.swap</a></td>
		<td><a href="https://www.noctua.at/en/products/nf-a12x25-pwm-chromax-black-swap" target="_blank">specs</a></td>	
		<td>1</td>	
		<td>$37.95</td>	
	</tr>
	<tr>
		<td>Power Supply</td>	
		<td><a href="https://www.amazon.com/gp/product/B075M5FRQS?th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=a8eca3bbe367f280660bd7085d88d1e0&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank">SilverStone 500W SFX Power Supply SST-SX500-G)</a></td>	
		<td><a href="https://www.silverstonetek.com/en/product/info/power-supplies/SX500-G/" target="_blank">specs</a></td>	
		<td>1</td>	
		<td>$142.34</td>	
	</tr>
	<tr>
		<td>Boot Drive</td>	
		<td><a href="https://www.amazon.com/dp/B0963SGYGF?&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=335ccbcac1cb1beb1ad0bbbe951f4cea&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank">Silicon Power 128GB A55 SATA SSD</a></td>	
		<td><a href="https://www.silicon-power.com/product-detail/ace_a55/" target="_blank">specs</a></td>	
		<td>2</td>	
		<td>$21.97</td>	
	</tr>
	<tr>
		<td>Apps/VM Drives</td>	
		<td><a href="https://www.amazon.com/dp/B07ZGJVTZK?&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=27613853bea52aac53f1068188e5c5e3&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank">Silicon Power 1TB - NVMe M.2 SSD (SP001TBP34A60M28) </a></td>	
		<td><a href="https://www.teamgroupinc.com/en/product-detail/ssd/TEAMGROUP/mp44/mp44-TM8FPW001T0C101/" target="_blank">specs</a></td>	
		<td>2</td>	
		<td>$99.99</td>	
	</tr>			
	<tr>
		<td>SATA Cables</td>	
		<td><a href="https://www.amazon.com/SATA-III-Cable-1M-Set-6Gbps-SATA-Replacement-Computer-Server/dp/B09Q359C7Z?th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=02df14f462c50c4b883f5daa8709f653&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank">OIKWAN SFF-8643 Host to 4 X SATA Breakout Cable</a></td>	
		<td>N/A</td>	
		<td>2</td>	
		<td>$11.99</td>	
	</tr>	
	<tr>
		<td colspan="4">Price <i>without</i> Storage: </td>
		<td>$989.36</td>
	</tr>		
	<tr>
		<td colspan="4">Total Price: </td>
		<td>$1,189.34</td>
	</tr>
</tbody></table>




<h2 id="hardware-assembly-bios-configuration-and-burn-in">Hardware Assembly, BIOS Configuration, and Burn-In</h2>

<h3 id="hardware-assembly">Hardware Assembly</h3>

<p>I wanted the smallest possible DIY NAS. The <a href="https://www.amazon.com/gp/product/B0D1YH7D3J?th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=5636db0ca3c62e86da5f02b641c0f283&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank" title="JONSBO N4 Black NAS Pc Case, Walnut Wood, 8-Drive Bay/6 x 3.5-inch HDD (4 hot-swap,2 Non hot-swap),2 x 2.5-inch SSD, Micro ATX Chassis">JONSBO N4</a> case initially felt too large since it accommodates Micro ATX motherboards. However, I grew to accept its slightly larger footprint. However, putting the <a href="https://s.click.aliexpress.com/e/_c2zJj1aF" title="Topton N22 N355 Mini-ITX NAS Motherboard (8xSATA3, 2xM.2, 1x10Gbps, 2x2.5Gbps)">Topton N22 motherboard</a> into the case felt roomy and luxurious. Building the <em>DIY NAS: 2026 Edition</em> compared to prior years’ felt a lot like coming home to put on sweatpants and a t-shirt after wearing a suit and tie all day long.</p>

<p>I wasn’t too fond of the cable-management of the power supply’s cables. The layout of the case pretty much makes the front of the power supply inaccessible once it is installed. One consequence of this is that the power cable which powered the SATA backplane initially prevented the 120mm case fan from spinning up. That issue was relatively minor and was resolved with zip ties.</p>

<p>Overall, I felt pretty good about the assembly of the <em>DIY NAS: 2026 Edition</em>, but things would take a turn for the worse when I decided to fill all the 3.5-inch drive bays up with some of my decommissioned 8TB HDDs. Now this is probably my fault, I wouldn’t be surprised at all that the manual of the <a href="https://www.amazon.com/gp/product/B0D1YH7D3J?th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=5636db0ca3c62e86da5f02b641c0f283&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank" title="JONSBO N4 Black NAS Pc Case, Walnut Wood, 8-Drive Bay/6 x 3.5-inch HDD (4 hot-swap,2 Non hot-swap),2 x 2.5-inch SSD, Micro ATX Chassis">JONSBO N4</a> warned me against this, but putting the drives in last turned out to be a major pain in the neck for each of the four drive bays <strong><em>without</em></strong> a SATA backplane.</p>

<p><img src="https://blog.briancmoses.com/images/2026/diynas/800/diynas2026_backwards.png" alt="DIY NAS: 2026 Edition with half its drives installed backwards!"></p>

<p>I had wrongly guessed that you accessed those drives’ power and data ports from the front of the case. I worked really hard to route the cables and even managed to install all of the drives before realizing my error and learning my lesson.  I’m understanding now why the <a href="https://www.amazon.com/gp/product/B0D1YH7D3J?th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=5636db0ca3c62e86da5f02b641c0f283&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank" title="JONSBO N4 Black NAS Pc Case, Walnut Wood, 8-Drive Bay/6 x 3.5-inch HDD (4 hot-swap,2 Non hot-swap),2 x 2.5-inch SSD, Micro ATX Chassis">JONSBO N4</a> is cheaper than all of its siblings. Partly because there’s a missing SATA backplane, but also because those other 4 drive bays’ layout is frustrating.</p>

<p>Don’t let my last couple paragraphs sour you on the <a href="https://www.amazon.com/gp/product/B0D1YH7D3J?th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=5636db0ca3c62e86da5f02b641c0f283&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank" title="JONSBO N4 Black NAS Pc Case, Walnut Wood, 8-Drive Bay/6 x 3.5-inch HDD (4 hot-swap,2 Non hot-swap),2 x 2.5-inch SSD, Micro ATX Chassis">JONSBO N4</a>, though. I still really like its size, it feels big when you’re working in it with a Mini ITX motherboard. If you wind up deciding to use the JONSBO N4, then I suggest that you put those four drives and their cables in first before you do anything else. That would’ve made a world of difference for me. Actually looking at the documentation before getting started might have saved me quite a bit of aggravation, too!</p>

<p>If I have ruined the JONSBO N4 for you, then check out the <a href="https://www.amazon.com/Mini-ITX-Chassis-Computer-Aluminum-Support/dp/B0CMVBMVHT?&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=9140995b2e4f34809c8202effd2750ac&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank" title="JONSBO N3 Mini-ITX NAS PC Chassis">JONSBO N3</a>. It’s <strong><em>eight</em></strong> 3.5-inch drive bays pair up really nicely with the <a href="https://s.click.aliexpress.com/e/_c2zJj1aF" title="Topton N22 N355 Mini-ITX NAS Motherboard (8xSATA3, 2xM.2, 1x10Gbps, 2x2.5Gbps)">Topton N22 motherboard</a>. You can see what I thought of the JONSBO N3 by reading the <a href="https://blog.briancmoses.com/2024/09/diy-nas-2024-edition-and-econonas.html" title="DIY NAS: 2024 Edition">DIY NAS: 2024 Edition</a> blog.</p>



<h3 id="bios-configuration">BIOS Configuration</h3>

<p>Generally speaking, I do as little as I possibly can in the BIOS. Normally I strive to only set the time and change the boot order. However, I did a bit more for the <em>DIY NAS: 2026 Edition</em> since I’m using the <code>SYS_FAN</code> header for the fan which is responsible for cooling the hard drives.  Here are the changes that I made in the BIOS:</p>

<ol>
  <li>Set the <strong>System Date</strong> and <strong>System Time</strong> to Greenwich Mean Time
    <ol>
      <li>Advanced
        <ol>
          <li>Hardware Monitor ( Advanced)
            <ol>
              <li>Set <strong>SYS SmartFan Mode</strong> to  <code>Disabled</code>.</li>
              <li>Set the <strong>Manual PWM Setting</strong> (for <code>SYS_FAN</code>) to 180.</li>
            </ol>
          </li>
        </ol>
      </li>
      <li>Set <strong>PWRON After Power Loss</strong> to <code>Always On</code></li>
      <li>Boot
        <ol>
          <li>Set <strong>Boot Option #1</strong> to the TrueNAS boot device.</li>
        </ol>
      </li>
    </ol>
  </li>
</ol>

<p>I’m not at all interested in venturing into the rabbit’s hole of trying to completely minimize how much power the NAS uses. However, I imagine there’s some opportunities for power savings lurking in the BIOS. I didn’t go looking for them myself, but if you’re intrepid enough to do so here’s a few suggestions that I have to save some additional power:</p>

<ul>
  <li>Disable the onboard audio.</li>
  <li>Disable any network interfaces that you don’t wind up using.</li>
  <li>Tinker with the CPU settings.</li>
  <li>Got other suggestions?  <em>Share them in the comments!</em></li>
</ul>

<h3 id="burn-in">Burn-In</h3>

<p>Because all of the hardware is brand-new to me brand-new components are not guaranteed to be free of defects, I always do a little bit of burn-in testing to establish some trust in the hardware that I’ve picked out for each DIY NAS build. While I think doing <em>some</em> burn-in testing critically important, I also think the value of subsequent burn-in testing drops the more that you do. Don’t get too carried away and do your own  burn-in testing in moderation!</p>

<h4 id="memtest86"><a href="https://www.memtest.org/" target="_blank" title="Memtest86+">Memtest86+</a></h4>

<p>I <em>always</em> use Memtest86+ to burn-in the RAM. I always run at least 3+ passes of Memtest86+. Typically, I run many more passes because I tend to let the system keep running additional passes overnight. Secondarily, running these many passes give the CPU a little bit of work to do and there’s enough information displayed by Memtest86+ to give me confidence in the CPU and its settings.</p>

<p><a href="https://blog.briancmoses.com/images/2026/diynas/diynas2026-memtest_1280.png"><img src="https://blog.briancmoses.com/images/2026/diynas/diynas2026-memtest_600.png" alt="Memtest86+"></a></p>

<h4 id="hard-drives">Hard Drives</h4>

<p>The failure rate of hard drives is highest when the drives are new and then again when they’re old. Regardless of type of hard drives that I buy or when I buy them, I always do some disk burn in. I tend to run <a href="https://github.com/Spearfoot/disk-burnin-and-testing" target="_blank" title="Spearfoot's disk-burnin-and-testing Script on GitHub">Spearfoot’s Disk Burn-in and Testing script</a> on all of my new drives. However executing this script against all of the drives can take quite a long time, even if you use something like  <code>tmux</code> to run the tests in parallel.</p>

<h2 id="initial-truenas-ce-setup">Initial TrueNAS CE Setup</h2>

<p>There’s always a little bit of setup that I do for a new TrueNAS machine. This isn’t intended to be an all inclusive step-by-step guide for all the things you should do with your DIY NAS. Instead, it’s more of a list of things I kept track of while I made sure that the <em>DIY NAS: 2026 Edition</em> was functional enough for me to finish writing this blog. That being said, I do think your NAS would be rather functional if you decided to do the same configuration.</p>

<ol>
  <li>Updated the hostname to <code>diynas2026</code>
    <ol>
      <li><em>Note:  This is only to avoid issues with another NAS on my network.</em></li>
    </ol>
  </li>
  <li>Updated the timezone.</li>
  <li>Enabled the following services and set them to start automatically.
    <ol>
      <li>SMB</li>
      <li>SSH</li>
      <li>NFS</li>
    </ol>
  </li>
  <li>Enabled password login for the <code>truenas_admin</code> user.
    <ul>
      <li><em>Note: If I were planning to use this DIY NAS long-term, I wouldn’t have done this. Using SSH keys for authentication is a better idea</em>.</li>
    </ul>
  </li>
  <li>Edited the TrueNAS Dashboard widgets to reflect the 10Gb interface (<code>enp1s0</code>).</li>
  <li>Created a pool named <code>flash</code> which consisted of mirrored vdev using the <a href="https://www.amazon.com/dp/B07ZGJVTZK?&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=27613853bea52aac53f1068188e5c5e3&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank" title="Teamgroup MP44 1TB NVMe SSD">Teamgroup MP44 1TB NVMe SSDs</a>.</li>
  <li>Created a pool named <code>rust</code> which consisted of a single RAID-Z2 vdev using eight hard drives that I had sitting on my shelf after they were decomissioned.</li>
  <li>Configured the Apps to use the <code>flash</code> pool for the apps’ dataset.</li>
  <li>Made sure that the System Dataset Pool was set to <code>flash</code>.</li>
  <li>Confirmed that there were Scrub Tasks set up for the <code>flash</code> and <code>rust</code> pools.</li>
  <li>Created a dataset on each pool for testing;  <code>flash-test</code> and <code>rust-test</code></li>
  <li>Installed the <a href="https://github.com/AnalogJ/scrutiny" target="_blank" title="Scrutiny: WebUI for smartd S.M.A.R.T monitoring">Scrutiny</a> app found in the App Catalog.</li>
</ol>

<p>If I were planning to keep this NAS and use it for my own purposes, I would also:</p>

<ol>
  <li>Set up a <a href="https://www.truenas.com/docs/scale/25.10/scaletutorials/credentials/certificates/settingupletsencryptcertificates/" target="_blank" title="Creating ACME Certificates">Let’s Encrypt certificate</a>.</li>
  <li>Hook up the NAS to <a href="https://networkupstools.org/stable-hcl.html" target="_blank" title="Network UPS Tools Hardware Compatability List">a compatible UPS</a>, enable the UPS service, and configure the UPS service to shut down the NAS before the battery runs out of juice.</li>
  <li><a href="https://www.truenas.com/docs/scale/25.10/scaleuireference/toptoolbar/alerts/alertsettingsscreen/" target="_blank" title="TrueNAS Scale Alert Settings Screens">Set up system email alert service</a>.</li>
  <li>Create <a href="https://www.truenas.com/docs/scale/25.10/scaletutorials/dataprotection/replication/" target="_blank" title="TrueNAS Replication Tasks">replication tasks</a> to back up critical data to my <a href="https://blog.briancmoses.com/2024/06/one-3d-printed-nas-wasn-t-enough-so-i-printed-two-more.html" title="One 3D-printed NAS wasn't enough, so I printed two more!">off-site NAS</a>.</li>
  <li>Add the new NAS to my Tailscale tailnet using the <a href="https://github.com/truenas/apps/tree/master/ix-dev/community/tailscale" target="_blank" title="Tailscale from the official TrueNAS App Catalog">Tailscale app from the official catalog</a>.</li>
  <li>As the NAS is seeded with data, create and maintain a suite of <a href="https://www.truenas.com/docs/scale/25.10/scaletutorials/dataprotection/periodicsnapshottasksscale/" target="_blank" title="Adding Periodic Snapshot Tasks">snapshot tasks</a> tailored to the importance of the different data being stored on the NAS.</li>
  <li>Set up S.M.A.R.T. tests for all of the drives:
    <ol>
      <li>Weekly Short Test</li>
      <li>Monthly Long Test</li>
    </ol>
  </li>
</ol>

<h2 id="benchmarks">Benchmarks</h2>

<p>Just about every year, I benchmark each DIY NAS build and almost always come to the same conclusion; the NAS will outperform your network at home. Your first bottleneck is almost always going to be the network and the overlwhelming majority of us have gigabit networks at home–but that’s slowly changing since 2.5Gbps and 10Gbps network hardware has started to get reasonable lately.</p>

<p>Even though I always come to the same conclusion, I still like to do the benchmarks for two reasons:</p>

<ol>
  <li>It helps me build confidence that the <em>DIY NAS: 2026 Edition</em> works well.</li>
  <li>People tend to enjoy consuming benchmarks <strong><em>and</em></strong> it’s fun for me to see the DIY NAS’ network card get saturated during the testing.</li>
</ol>

<h3 id="throughput">Throughput</h3>

<p>I like to do three categories of tests to measure the throughput of the NAS:</p>

<ol>
  <li>Use <a href="https://iperf.fr/" target="_blank" title="iPerf - The ultimate speed test tool for TCP, UDP and SCTP">iperf3</a> to benchmark throughput between my NAS and another machine on my network.</li>
  <li>Benchmark the throughput of the pool(s) locally on the NAS using <code>fio</code>.</li>
  <li>Set up SMB shares on each of the pools and then benchmark the throughput when using those shares.</li>
</ol>

<p>Every year I try and mention that Tom Lawrence from <a href="https://lawrencesystems.com/" target="_blank">Lawrence Systems</a> published <a href="https://youtu.be/TASYaWTkg0U">a great video about benchmarking storage with FIO</a> and shared <a href="https://forums.lawrencesystems.com/t/linux-benchmarking-with-fio/11122">the FIO commands from his video in their forums</a>. I use these FIO commands constantly as a reference point for testing ZFS pools’ throughput. Importantly I’d like to point out that, in that same video, Tom says something very wise:</p>

<blockquote>
  <p><a href="https://youtu.be/TASYaWTkg0U?t=53" target="_blank">There are lies, damn lies, and then there are benchmarks!</a></p>
</blockquote>

<table>
  <thead>
    <tr>
      <th><strong>Tool</strong></th>
      <th><strong>Pool</strong></th>
      <th><strong>Test<br>Size</strong></th>
      <th><strong>Random<br>Write<br>IOPS</strong></th>
      <th><strong>Random<br>Read<br>IOPS</strong></th>
      <th><strong>Sequential<br>Write<br>(MB/s)</strong></th>
      <th><strong>Sequential<br>Read<br>(MB/s)</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>FIO</td>
      <td><code>flash</code></td>
      <td>4G</td>
      <td>1906.00</td>
      <td>2200.00</td>
      <td>548.00</td>
      <td>1214.00</td>
    </tr>
    <tr>
      <td>FIO</td>
      <td><code>flash</code></td>
      <td>32G</td>
      <td>2132.00</td>
      <td>3012.00</td>
      <td>544.00</td>
      <td>1211.00</td>
    </tr>
    <tr>
      <td>FIO</td>
      <td><code>rust</code></td>
      <td>4G</td>
      <td>1352.00</td>
      <td>108.00</td>
      <td>367.00</td>
      <td>530.00</td>
    </tr>
    <tr>
      <td>FIO</td>
      <td><code>rust</code></td>
      <td>32G</td>
      <td>1474.00</td>
      <td>326.00</td>
      <td>368.00</td>
      <td>544.00</td>
    </tr>
    <tr>
      <td>CrystalDiskMark</td>
      <td><code>flash</code></td>
      <td>4GiB</td>
      <td>5858.89</td>
      <td>50409.91</td>
      <td>1104.64</td>
      <td>956.70</td>
    </tr>
    <tr>
      <td>CrystalDiskMark</td>
      <td><code>flash</code></td>
      <td>32GiB</td>
      <td>4193.36</td>
      <td>31047.36</td>
      <td>635.42</td>
      <td>946.20</td>
    </tr>
    <tr>
      <td>CrystalDiskMark</td>
      <td><code>rust</code></td>
      <td>4GiB</td>
      <td>5226.50</td>
      <td>46239.01</td>
      <td>756.23</td>
      <td>655.32</td>
    </tr>
    <tr>
      <td>CrystalDiskMark</td>
      <td><code>rust</code></td>
      <td>32GiB</td>
      <td>3794.43</td>
      <td>12809.33</td>
      <td>759.38</td>
      <td>677.02</td>
    </tr>
  </tbody>
</table>



<p>What do I think these benchmarks and my use of the <em>DIY NAS: 2026 Edition</em> tell me?  In the grand scheme of things, not a whole lot.</p>

<p>However, these benchmarks do back up what I expected, the <em>DIY NAS: 2026 Edition</em> is quite capable and more than ready to meet my storage needs. I especially like that the CrystalDiskMark benchmark of the SMB shares were <strong><em>both faster than a SATA SSD</em></strong>, and the throughput to the share on the <code>flash</code> pool practically saturated the NAS’ 10GbE network connection.</p>

<h4 id="fio-tests">FIO Tests</h4>

<p>Every time I benchmark a NAS, I seem to either be refining what I tried in prior years or completely reinventing the wheel. As a result, I wouldn’t recommend comparing these results with results that I shared in prior years’ DIY NAS build blogs. I haven’t really put a ton of effort into developing a standard suite of benchmarks. Things in my homelab change enough between DIY NAS blogs that trying to create and maintain an environment for a standard suite of benchmarks is beyond what my budget, spare time, and attention span will allow.</p>

<p>I’m going to paste these <code>fio</code> commands here in the blog for my own use in future DIY NAS build blogs. If you wind up building something similar, these <em>might</em> be helpful to measure your new NAS’ filesystem’s performance and compare it to mine!</p>

<div><pre><code>## Random Write IOPS
fio --randrepeat=1 --ioengine=libaio --direct=1 --name=test --filename=test --bs=128k --size=4G --readwrite=randwrite --ramp_time=10
fio --randrepeat=1 --ioengine=libaio --direct=1 --name=test --filename=test --bs=128k --size=32G --readwrite=randwrite --ramp_time=10

## Random Read IOPS
fio --randrepeat=1 --ioengine=libaio --direct=1 --name=test --filename=test --bs=128k --size=4G --readwrite=randread --ramp_time=10
fio --randrepeat=1 --ioengine=libaio --direct=1 --name=test --filename=test --bs=128k --size=32G --readwrite=randread --ramp_time=10

## Sequential Write (MB/s)
fio --randrepeat=1 --ioengine=libaio --direct=1 --name=test --filename=test --bs=4M --size=4G --readwrite=write --ramp_time=10
fio --randrepeat=1 --ioengine=libaio --direct=1 --name=test --filename=test --bs=4M --size=32G --readwrite=write --ramp_time=10

## Sequential Read (MB/s)
fio --randrepeat=1 --ioengine=libaio --direct=1  --name=test --filename=test --bs=4M --size=4G --readwrite=read --ramp_time=10
fio --randrepeat=1 --ioengine=libaio --direct=1  --name=test --filename=test --bs=4M --size=32G --readwrite=read --ramp_time=10
</code></pre></div>

<p><a href="https://blog.briancmoses.com/images/2026/diynas/combined-network-throughput.png"><img src="https://blog.briancmoses.com/images/2026/diynas/800/combined-network-throughput.png" alt="Perfmon of Networkthroughput for reading files over SMB and during iperf3 tests."></a></p>

<h3 id="power-consumption">Power Consumption</h3>

<p>One not-so-obvious cost of running a DIY NAS is how much power it consumes. While I specifically tried to pick items that were efficient in terms of power consumption, it’s also important to realize that all the other bells and whistles on the awesome <a href="https://s.click.aliexpress.com/e/_c2zJj1aF" target="_blank" title="Topton N22 N355 Mini-ITX NAS Motherboard (8xSATA3, 2xM.2, 1x10Gbps, 2x2.5Gbps)">Topton N18 NAS motherboard</a> consume power, too. And that the biggest consumer of power in a NAS is almost always the hard disk drives.</p>

<p>Thanks to my tinkering with <a href="https://blog.briancmoses.com/categories/home-automation/" title="Home Automation blogs">home automation</a>, I have a plethora of <a href="https://www.amazon.com/gp/product/B0CJR4QZ45?th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=331f4bd20d1cfe3c50b64077966b0ecc&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank" title="Minoston Z-Wave 800 Series Zwave Plug with Energy Monitoring, Power Meter Z-Wave Outlet Switch (MP31ZP)">smart outlets</a> which are capable of power monitoring. I used those smart outlets for most of my power monitoring. But I also have a <a href="https://www.amazon.com/P3-P4400-Electricity-Usage-Monitor/dp/B00009MDBU?crid=BQE7RDYQK9CM&amp;th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=c0efb3c2ef49e3049ce3e77825adedc0&amp;language=en_US&amp;ref_=as_li_ss_tl" title="P3 P4400 Kill A Watt Electricity Usage Monitor">Kill a Watt P400</a> that I also use for some of the shorter tests:</p>

<ul>
  <li>Power consumed during a handful of specific tasks:
    <ul>
      <li>Idle while running TrueNAS</li>
      <li>RAM Burn-in (~14 passes of Memtest86+)</li>
      <li>An 8-hour throughput benchmark copying randomly-sized files to the NAS using SMB.</li>
    </ul>
  </li>
  <li>Total consumed during the build, burn-in, and use of the <em>DIY NAS: 2026 Edition</em>.</li>
</ul>

<table>
  <thead>
    <tr>
      <th><strong>Task</strong></th>
      <th><strong>Duration</strong></th>
      <th><strong>Max Wattage</strong></th>
      <th><strong>Avg. Wattage</strong></th>
      <th><strong>Total Consumption</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Boot</td>
      <td>10 min.</td>
      <td>200.00 W</td>
      <td>120.00 W</td>
      <td>0.02 kWh</td>
    </tr>
    <tr>
      <td>Idle</td>
      <td>3 hr.</td>
      <td>90.00 W</td>
      <td>66.67 W</td>
      <td>0.20 kWh</td>
    </tr>
    <tr>
      <td>RAM Burn-in</td>
      <td>18 hr.</td>
      <td>104.00 W</td>
      <td>91.67 W</td>
      <td>1.65 kWh</td>
    </tr>
    <tr>
      <td>SMB Benchmark of HDDs</td>
      <td>8 hr.</td>
      <td>107.00 W</td>
      <td>85.00 W</td>
      <td>0.68 kWh</td>
    </tr>
    <tr>
      <td><strong>Total</strong></td>
      <td><strong>108 hr.</strong></td>
      <td><strong>237.80 W</strong></td>
      <td><strong>66.49 W</strong></td>
      <td><strong>7.17 kWh</strong></td>
    </tr>
  </tbody>
</table>



<h2 id="what-about-an-econonas">What about an EconoNAS?</h2>

<p><img src="https://blog.briancmoses.com/images/2026/diynas/ai-dollar-bill-sign.png">Shortly before prices skyrocketed, I decided I wasn’t very interested in doing a separate EconoNAS builds. Several months ago, I realized that there were several off-the-shelf NAS machines that were more-than-capable of running TrueNAS and they were selling at economical prices that couldn’t be topped by a DIY approach. I will dive deeper into this in a future blog, eventually … <strong><em>maybe</em></strong>?</p>

<p>All that being said–it’d be incredibly easy to make some compromises which result in the <em>DIY NAS: 2026 Edition</em> becoming quite a bit more economical. Here’s a list of changes that I would consider to be more budget-friendly:</p>

<ul>
  <li>Different motherboard/CPU combo: <a href="https://www.ebay.com/itm/127014563991" target="_blank" title="Topton N18 N100/N150/N305 Mini-ITX NAS Motherboard:6xSATA/2xM.2/2x2.5GbE/1x10GbE">N18 w/ N100 CPU</a> (-$224), <a href="https://www.ebay.com/itm/127014563991" title="Topton N18 N100/N150/N305 Mini-ITX NAS Motherboard:6xSATA/2xM.2/2x2.5GbE/1x10GbE">N18 w/ N150 CPU</a> (-$214), or <a href="https://www.ebay.com/itm/127525459090" title="Topton N22 Motherboard w/ N150 CPU on Brian's eBay Store">N22 w/ N150 CPU</a> (-$180)</li>
  <li><a href="https://amzn.to/4ai7M2V" target="_blank">16GB of DDR5 RAM</a> (-$39) instead of 32GB.</li>
  <li><a href="https://amzn.to/4qSQBLa" target="_blank">Thermal Right TL-C12015 Slim Fan</a> instead of the Noctua NF-A12x25 (-$26)</li>
  <li><a href="https://amzn.to/3LFJSnP" target="_blank">Apevia SFX-AP500W Power Supply</a> (-$104)</li>
  <li>Skip the redundancy for the boot pool (-$22)</li>
</ul>

<p>Altogether, these savings could add up to more than $400, which is pretty considerable!  If you made all of these changes, you’d have something that’s going to be nearly equivalent to the <em>DIY NAS: 2026 Edition</em> but at a fraction of the price.</p>

<p><a href="https://blog.briancmoses.com/images/2026/diynas/ai-brian-ock-buying-drives.png"><img src="https://blog.briancmoses.com/images/2026/diynas/ai-brian-ock-buying-drives_640.png" alt="Brian as a Super Villian shopping for economical DIY NAS deals!"></a></p>

<h2 id="what-am-i-going-to-do-with-the-diy-nas-2026-edition">What am I going to do with the DIY NAS: 2026 Edition?!</h2>

<p>My DIY NAS is aging quite gracefully, but I’ve recently been wondering about replacing it. Shortly before ordering all the parts for the <em>DIY NAS: 2026 Edition</em>, I briefly considered using this year’s DIY NAS build to replace my personal NAS. However, I decided not to do that. Then prices skyrocketed and I shelved the idea of building a replacement for my own NAS and I nearly shelved the idea of a DIY NAS in 2026!</p>

<p>So that begs the question, “What is Brian going to do with the <em>DIY NAS: 2026 Edition</em>?”</p>

<p>I’m going to auction it off on the <a href="https://www.ebay.com/str/briancmosesdotcom" target="_blank" title="briancmosesdotcom store on eBay">briancmosesdotcom store on eBay</a>! Shortly after publishing this blog, I’ll list it on eBay. In response to skyrocketing prices for PC components, I’m going to do a no-reserve auction. At the end of the auction, the highest bidder wins and hopefully they’ll get a pretty good deal!</p>

<p><a href="https://www.ebay.com/itm/127527163731" target="_blank"><img src="https://blog.briancmoses.com/images/2026/diynas/ebay-auction_800.png" alt="eBay auction of the DIY NAS: 2026 Edition"></a></p>

<h2 id="final-thoughts">Final Thoughts</h2>

<p>Overall, I’m pleased with the <em>DIY NAS: 2026 Edition</em>. The <a href="https://s.click.aliexpress.com/e/_c2zJj1aF" target="_blank" title="Topton N22 N355 Mini-ITX NAS Motherboard (8xSATA3, 2xM.2, 1x10Gbps, 2x2.5Gbps)">Topton N22 motherboard</a> is a significant improvement over last year’s <a href="https://www.ebay.com/itm/127014563991" title="Topton N18 N100/N150/N305 Mini-ITX NAS Motherboard:6xSATA/2xM.2/2x2.5GbE/1x10GbE">Topton N18 motherboard</a>, primarily due to its extra two SATA ports. This provides 33.3% more gross storage capacity.</p>

<p>While testing, I found the <a href="https://www.intel.com/content/www/us/en/products/sku/231803/intel-processor-n100-6m-cache-up-to-3-40-ghz/specifications.html" target="_blank" title="Intel® Processor N100">Intel Core 3 N355 CPU</a> somewhat excessive for basic NAS functions. However, the substantial untapped CPU horsepower offers luxurious performance potential. This makes the build compelling for anyone planning extensive self-hosting projects.</p>

<p>I have mixed feelings about the <a href="https://www.amazon.com/gp/product/B0D1YH7D3J?th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=5636db0ca3c62e86da5f02b641c0f283&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank" title="JONSBO N4 Black NAS Pc Case, Walnut Wood, 8-Drive Bay/6 x 3.5-inch HDD (4 hot-swap,2 Non hot-swap),2 x 2.5-inch SSD, Micro ATX Chassis">JONSBO N4 case</a>. The four right-side drive bays lack SATA backplane connectivity. Without creative cabling solutions, individual drive replacement becomes challenging. However, the case’s ~$125 price point compensates for this inconvenience. I anticipate that those the cost savings will justify the compromise for most builders. If I were to build the <em>DIY NAS: 2026 Edition</em> all over again, I’d be tempted to use the <a href="https://www.amazon.com/Mini-ITX-Chassis-Computer-Aluminum-Support/dp/B0CMVBMVHT?&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=9140995b2e4f34809c8202effd2750ac&amp;language=en_US&amp;ref_=as_li_ss_tl" title="JONSBO N3 Mini-ITX NAS PC Chassis">JONSBO N3 case</a> or even the <a href="https://www.jonsbo.com/en/products/N6Black.html" title="JONSBO N6">JONSBO N6</a> which isn’t quite obtainable, yet.</p>

<p>The DIY NAS: 2026 Edition delivers excellent performance and superior specifications. In my opinion, it represents better value than off-the-shelf alternatives:</p>

<ul>
  <li><a href="https://www.amazon.com/QNAP-TS-832PX-4G-High-Capacity-10GbE-2-5GbE/dp/B08P42JR89?th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=8d7e5630a6e8c1a01d6f791658a8652e&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank" title="QNAP TS-832PX-4G 8 Bay High-Capacity NAS with 10GbE SFP+ and 2.5GbE ">QNAP TS-832PX-4G</a> ($880)</li>
  <li><a href="https://www.amazon.com/Asustor-Lockerstor-Enterprise-Attached-Quad-Core/dp/B07Y2BJZKC?th=1&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=9ba0f3af9b719585c327dbf5b1d14c9a&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank" title="Asustor Lockerstor 8 AS6508T 8 Bay NAS - Network Storage Enclosure, Quad Core 2.1GHz CPU, 8GB RAM DDR4, M.2 NVMe SSD ">Asustor Lockerstor 8 AS6508T</a> ($960)</li>
  <li><a href="https://www.amazon.com/UGREEN-DXP8800-Plus-Attached-Diskless/dp/B0D22HGH4N?&amp;linkCode=ll1&amp;tag=diynas2026-20&amp;linkId=351f2f13b717fb8ca116986ad227ec9c&amp;language=en_US&amp;ref_=as_li_ss_tl" target="_blank" title="UGREEN NASync DXP8800 Plus 8-Bay Desktop NAS, Intel i5 1235u 10-Core CPU, 8GB DDR5 RAM, 128G SSD, 2X 10GbE, 2X M.2 NVMe Slots, 8K HDMI, 2X TBT4, Network Attached Storage (Diskless) ">UGREEN NASync DXP8800</a> ($1200)</li>
</ul>

<p>Building your own NAS provides significant advantages. Years later, you can upgrade RAM, motherboard, case, or add PCI-e (x1) expansion cards. These off-the-shelf alternatives offer severely limited upgrade paths.</p>

<p>Is 2026 finally the year that you decide to build your DIY NAS?  I hope that it is!  Share your experience building your NAS in the comments below or come tell us about it in the <a href="https://blog.briancmoses.com/discord" title="The Butter, What?! Discord Server">#diynas-and-homelab channel on the Butter, What?! Discord server</a>!</p>

<!-- Tiny Slider Script: diynas2026-->


<!-- Tiny Slider Script: diynas2026-assembly-->


</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Green Card Interviews End in Handcuffs for Spouses of U.S. Citizens (221 pts)]]></title>
            <link>https://www.nytimes.com/2025/11/26/us/trump-green-card-interview-arrests.html</link>
            <guid>46065015</guid>
            <pubDate>Thu, 27 Nov 2025 02:51:31 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.nytimes.com/2025/11/26/us/trump-green-card-interview-arrests.html">https://www.nytimes.com/2025/11/26/us/trump-green-card-interview-arrests.html</a>, See on <a href="https://news.ycombinator.com/item?id=46065015">Hacker News</a></p>
Couldn't get https://www.nytimes.com/2025/11/26/us/trump-green-card-interview-arrests.html: Error: Request failed with status code 403]]></description>
        </item>
        <item>
            <title><![CDATA[Penpot: The Open-Source Figma (684 pts)]]></title>
            <link>https://github.com/penpot/penpot</link>
            <guid>46064757</guid>
            <pubDate>Thu, 27 Nov 2025 02:14:36 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/penpot/penpot">https://github.com/penpot/penpot</a>, See on <a href="https://news.ycombinator.com/item?id=46064757">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><themed-picture data-catalyst-inline="true"><picture>
  <source media="(prefers-color-scheme: dark)" srcset="https://camo.githubusercontent.com/6f4a230c051d6c3d15a0286b0441f113c4baac20752ab4ec7e276e329f2273c0/68747470733a2f2f70656e706f742e6170702f696d616765732f726561646d652f6769746875622d6461726b2d6d6f64652e706e67" data-canonical-src="https://penpot.app/images/readme/github-dark-mode.png">
  <source media="(prefers-color-scheme: light)" srcset="https://camo.githubusercontent.com/c1fc85084a7b31db77a330977ca9b00c97390ee20b0aec50c70561657a554721/68747470733a2f2f70656e706f742e6170702f696d616765732f726561646d652f6769746875622d6c696768742d6d6f64652e706e67" data-canonical-src="https://penpot.app/images/readme/github-light-mode.png">
  <img alt="penpot header image" src="https://camo.githubusercontent.com/c1fc85084a7b31db77a330977ca9b00c97390ee20b0aec50c70561657a554721/68747470733a2f2f70656e706f742e6170702f696d616765732f726561646d652f6769746875622d6c696768742d6d6f64652e706e67" data-canonical-src="https://penpot.app/images/readme/github-light-mode.png">
</picture></themed-picture>
<p dir="auto">
<a href="https://www.mozilla.org/en-US/MPL/2.0" rel="nofollow"><img alt="License: MPL-2.0" src="https://camo.githubusercontent.com/0d433bf1013a998c8b0db6c4c9eefd9edae1111aad142e998918e179fdd5c54a/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4d504c2d322e302d626c75652e737667" data-canonical-src="https://img.shields.io/badge/MPL-2.0-blue.svg"></a>
<a href="https://community.penpot.app/" rel="nofollow"><img alt="Penpot Community" src="https://camo.githubusercontent.com/608d7ad63d5dd51331463cdcc583715033bf50f77ea52e68f94cb7ea26f95e1b/68747470733a2f2f696d672e736869656c64732e696f2f646973636f757273652f706f7374733f7365727665723d6874747073253341253246253246636f6d6d756e6974792e70656e706f742e617070" data-canonical-src="https://img.shields.io/discourse/posts?server=https%3A%2F%2Fcommunity.penpot.app"></a>
<a href="https://tree.taiga.io/project/penpot/" title="Managed with Taiga.io" rel="nofollow"><img alt="Managed with Taiga.io" src="https://camo.githubusercontent.com/3352207d59d443f294c31f36995ecedf5212b7e7b1ed4b7d4ca825f0c739e5c2/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6d616e61676564253230776974682d54414947412e696f2d3730396631342e737667" data-canonical-src="https://img.shields.io/badge/managed%20with-TAIGA.io-709f14.svg"></a>
<a href="https://gitpod.io/#https://github.com/penpot/penpot" rel="nofollow"><img alt="Gitpod ready-to-code" src="https://camo.githubusercontent.com/c01324668ea00cd2b02dc9fbf541676fb30543b69ef99a070d62a110917126d0/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f476974706f642d72656164792d2d746f2d2d636f64652d626c75653f6c6f676f3d676974706f64" data-canonical-src="https://img.shields.io/badge/Gitpod-ready--to--code-blue?logo=gitpod"></a>
</p>
<p dir="auto">
    <a href="https://penpot.app/" rel="nofollow"><b>Website</b></a>  •
    <a href="https://help.penpot.app/user-guide/" rel="nofollow"><b>User Guide</b></a>  •
    <a href="https://penpot.app/learning-center" rel="nofollow"><b>Learning Center</b></a>  •
    <a href="https://community.penpot.app/" rel="nofollow"><b>Community</b></a>
</p>
<p dir="auto">
    <a href="https://www.youtube.com/@Penpot" rel="nofollow"><b>Youtube</b></a>  •
    <a href="https://peertube.kaleidos.net/a/penpot_app/video-channels" rel="nofollow"><b>Peertube</b></a>  •
    <a href="https://www.linkedin.com/company/penpot/" rel="nofollow"><b>Linkedin</b></a>  •
    <a href="https://instagram.com/penpot.app" rel="nofollow"><b>Instagram</b></a>  •
    <a href="https://fosstodon.org/@penpot/" rel="nofollow"><b>Mastodon</b></a>  •
    <a href="https://bsky.app/profile/penpot.app" rel="nofollow"><b>Bluesky</b></a>  •
    <a href="https://twitter.com/penpotapp" rel="nofollow"><b>X</b></a>
</p>
<br>
<details open="">
  <summary>
    
    <span>Penpot_OpenYourEyes_.mp4</span>
    <span></span>
  </summary>

  <video src="https://private-user-images.githubusercontent.com/210353798/451453487-7c67fd7c-04d3-4c9b-88ec-b6f5e23f8332.mp4?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NjQyMjUzMDEsIm5iZiI6MTc2NDIyNTAwMSwicGF0aCI6Ii8yMTAzNTM3OTgvNDUxNDUzNDg3LTdjNjdmZDdjLTA0ZDMtNGM5Yi04OGVjLWI2ZjVlMjNmODMzMi5tcDQ_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjUxMTI3JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI1MTEyN1QwNjMwMDFaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT1mOTFiYjA4NDU1Mzk5OGFiZTY3ZGIwNjZlNzRhY2E0OGI5NmUxM2UxMmI3MzFjZDhhMjI0YWIzMDBmNGMyNDJlJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.JAjDN-7eHZr_4NbEoQTO4qnSCwwq2ptsgERx06UQVdc" data-canonical-src="https://private-user-images.githubusercontent.com/210353798/451453487-7c67fd7c-04d3-4c9b-88ec-b6f5e23f8332.mp4?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NjQyMjUzMDEsIm5iZiI6MTc2NDIyNTAwMSwicGF0aCI6Ii8yMTAzNTM3OTgvNDUxNDUzNDg3LTdjNjdmZDdjLTA0ZDMtNGM5Yi04OGVjLWI2ZjVlMjNmODMzMi5tcDQ_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjUxMTI3JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI1MTEyN1QwNjMwMDFaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT1mOTFiYjA4NDU1Mzk5OGFiZTY3ZGIwNjZlNzRhY2E0OGI5NmUxM2UxMmI3MzFjZDhhMjI0YWIzMDBmNGMyNDJlJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.JAjDN-7eHZr_4NbEoQTO4qnSCwwq2ptsgERx06UQVdc" controls="controls" muted="muted">

  </video>
</details>


<p dir="auto">Penpot is the first <strong>open-source</strong> design tool for design and code collaboration. Designers can create stunning designs, interactive prototypes, design systems at scale, while developers enjoy ready-to-use code and make their workflow easy and fast. And all of this with no handoff drama.</p>
<p dir="auto">Available on browser or self-hosted, Penpot works with open standards like SVG, CSS, HTML and JSON, and it’s free!</p>
<p dir="auto">The latest updates take Penpot even further. It’s the first design tool to integrate native <a href="https://penpot.dev/collaboration/design-tokens" rel="nofollow">design tokens</a>—a single source of truth to improve efficiency and collaboration between product design and development.
With the <a href="https://penpot.app/dev-diaries" rel="nofollow">huge 2.0 release</a>, Penpot took the platform to a whole new level. This update introduces the ground-breaking <a href="https://penpot.app/penpot-2.0" rel="nofollow">CSS Grid Layout feature</a>, a complete UI redesign, a new Components system, and much more.
For organizations that need extra service for its teams, <a href="https://cal.com/team/penpot/talk-to-us" rel="nofollow">get in touch</a></p>
<p dir="auto">🎇 Design, code, and Open Source meet at <a href="https://penpot.app/penpotfest" rel="nofollow">Penpot Fest</a>! Be part of the 2025 edition in Madrid, Spain, on October 9-10.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Table of contents</h2><a id="user-content-table-of-contents" aria-label="Permalink: Table of contents" href="#table-of-contents"></a></p>
<ul dir="auto">
<li><a href="#why-penpot">Why Penpot</a></li>
<li><a href="#getting-started">Getting Started</a></li>
<li><a href="#community">Community</a></li>
<li><a href="#contributing">Contributing</a></li>
<li><a href="#resources">Resources</a></li>
<li><a href="#license">License</a></li>
</ul>
<p dir="auto"><h2 tabindex="-1" dir="auto">Why Penpot</h2><a id="user-content-why-penpot" aria-label="Permalink: Why Penpot" href="#why-penpot"></a></p>
<p dir="auto">Penpot expresses designs as code. Designers can do their best work and see it will be beautifully implemented by developers in a two-way collaboration.</p>
<p dir="auto"><h3 tabindex="-1" dir="auto">Plugin system</h3><a id="user-content-plugin-system" aria-label="Permalink: Plugin system" href="#plugin-system"></a></p>
<p dir="auto"><a href="https://penpot.app/penpothub/plugins" rel="nofollow">Penpot plugins</a> let you expand the platform's capabilities, give you the flexibility to integrate it with other apps, and design custom solutions.</p>
<p dir="auto"><h3 tabindex="-1" dir="auto">Designed for developers</h3><a id="user-content-designed-for-developers" aria-label="Permalink: Designed for developers" href="#designed-for-developers"></a></p>
<p dir="auto">Penpot was built to serve both designers and developers and create a fluid design-code process. You have the choice to enjoy real-time collaboration or play "solo".</p>
<p dir="auto"><h3 tabindex="-1" dir="auto">Inspect mode</h3><a id="user-content-inspect-mode" aria-label="Permalink: Inspect mode" href="#inspect-mode"></a></p>
<p dir="auto">Work with ready-to-use code and make your workflow easy and fast. The inspect tab gives instant access to SVG, CSS and HTML code.</p>
<p dir="auto"><h3 tabindex="-1" dir="auto">Self host your own instance</h3><a id="user-content-self-host-your-own-instance" aria-label="Permalink: Self host your own instance" href="#self-host-your-own-instance"></a></p>
<p dir="auto">Provide your team or organization with a completely owned collaborative design tool. Use Penpot's cloud service or deploy your own Penpot server.</p>
<p dir="auto"><h3 tabindex="-1" dir="auto">Integrations</h3><a id="user-content-integrations" aria-label="Permalink: Integrations" href="#integrations"></a></p>
<p dir="auto">Penpot offers integration into the development toolchain, thanks to its support for webhooks and an API accessible through access tokens.</p>
<p dir="auto"><h3 tabindex="-1" dir="auto">Building Design Systems: design tokens, components and variants</h3><a id="user-content-building-design-systems-design-tokens-components-and-variants" aria-label="Permalink: Building Design Systems: design tokens, components and variants" href="#building-design-systems-design-tokens-components-and-variants"></a></p>
<p dir="auto">Penpot brings design systems to code-minded teams: a single source of truth with native Design Tokens, Components, and Variants for scalable, reusable, and consistent UI across projects and platforms.</p>

<p dir="auto">
 <a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/210353798/492141777-cce75ad6-f783-473f-8803-da9eb8255fef.jpg?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NjQyMjUzMDEsIm5iZiI6MTc2NDIyNTAwMSwicGF0aCI6Ii8yMTAzNTM3OTgvNDkyMTQxNzc3LWNjZTc1YWQ2LWY3ODMtNDczZi04ODAzLWRhOWViODI1NWZlZi5qcGc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjUxMTI3JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI1MTEyN1QwNjMwMDFaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT02YTIzZjUwNTM0ZDg1MGU0NWUyNzM1NjMyNDdlMThkZmMxMzQ0YzhjZDQ4MDNlMTU0MzA2Y2YzNGFmZjRiYTI3JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.NF2okr9Jy_WMyKYXacnLGLgmJSIbxJ3fEoFS7zRXFQI"><img src="https://private-user-images.githubusercontent.com/210353798/492141777-cce75ad6-f783-473f-8803-da9eb8255fef.jpg?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NjQyMjUzMDEsIm5iZiI6MTc2NDIyNTAwMSwicGF0aCI6Ii8yMTAzNTM3OTgvNDkyMTQxNzc3LWNjZTc1YWQ2LWY3ODMtNDczZi04ODAzLWRhOWViODI1NWZlZi5qcGc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjUxMTI3JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI1MTEyN1QwNjMwMDFaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT02YTIzZjUwNTM0ZDg1MGU0NWUyNzM1NjMyNDdlMThkZmMxMzQ0YzhjZDQ4MDNlMTU0MzA2Y2YzNGFmZjRiYTI3JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.NF2okr9Jy_WMyKYXacnLGLgmJSIbxJ3fEoFS7zRXFQI"></a>
</p>

<p dir="auto"><h2 tabindex="-1" dir="auto">Getting started</h2><a id="user-content-getting-started" aria-label="Permalink: Getting started" href="#getting-started"></a></p>
<p dir="auto">Penpot is the only design &amp; prototype platform that is deployment agnostic. You can use it in our <a href="https://design.penpot.app/" rel="nofollow">SAAS</a> or deploy it anywhere.</p>
<p dir="auto">Learn how to install it with Docker, Kubernetes, Elestio or other options on <a href="https://penpot.app/self-host" rel="nofollow">our website</a>.
<br></p>
<p dir="auto">
  <a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/2c5f051576d896757ae0630691a5067d45d1184b19adf4c4d995b87df72a1897/68747470733a2f2f736974652d6173736574732e706c61736d69632e6170702f32313638636635323464643534336361656666333233383465623965613061312e737667"><img src="https://camo.githubusercontent.com/2c5f051576d896757ae0630691a5067d45d1184b19adf4c4d995b87df72a1897/68747470733a2f2f736974652d6173736574732e706c61736d69632e6170702f32313638636635323464643534336361656666333233383465623965613061312e737667" alt="Open Source" data-canonical-src="https://site-assets.plasmic.app/2168cf524dd543caeff32384eb9ea0a1.svg"></a>
</p>

<p dir="auto"><h2 tabindex="-1" dir="auto">Community</h2><a id="user-content-community" aria-label="Permalink: Community" href="#community"></a></p>
<p dir="auto">We love the Open Source software community. Contributing is our passion and if it’s yours too, participate and <a href="https://community.penpot.app/c/help-us-improve-penpot/7" rel="nofollow">improve</a> Penpot. All your designs, code and ideas are welcome!</p>
<p dir="auto">If you need help or have any questions; if you’d like to share your experience using Penpot or get inspired; if you’d rather meet our community of developers and designers, <a href="https://community.penpot.app/" rel="nofollow">join our Community</a>!</p>
<p dir="auto">You will find the following categories:</p>
<ul dir="auto">
<li><a href="https://community.penpot.app/c/ask-for-help-using-penpot/6" rel="nofollow">Ask the Community</a></li>
<li><a href="https://community.penpot.app/c/technical/8" rel="nofollow">Troubleshooting</a></li>
<li><a href="https://community.penpot.app/c/help-us-improve-penpot/7" rel="nofollow">Help us Improve Penpot</a></li>
<li><a href="https://community.penpot.app/c/madewithpenpot/9" rel="nofollow">#MadeWithPenpot</a></li>
<li><a href="https://community.penpot.app/c/announcements/5" rel="nofollow">Events and Announcements</a></li>
<li><a href="https://community.penpot.app/c/inside-penpot/21" rel="nofollow">Inside Penpot</a></li>
<li><a href="https://community.penpot.app/c/penpot-in-your-language/12" rel="nofollow">Penpot in your language</a></li>
<li><a href="https://community.penpot.app/c/design-and-code-essentials/22" rel="nofollow">Design and Code Essentials</a></li>
</ul>

<p dir="auto">
  <a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/5446186/320413592-6ac62220-a16c-46c9-ab21-d24ae357ed03.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NjQyMjUzMDEsIm5iZiI6MTc2NDIyNTAwMSwicGF0aCI6Ii81NDQ2MTg2LzMyMDQxMzU5Mi02YWM2MjIyMC1hMTZjLTQ2YzktYWIyMS1kMjRhZTM1N2VkMDMucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MTEyNyUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTExMjdUMDYzMDAxWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9MDQ1ZGQxMGQ2NTExZTFjYjAwMDY5ZjFiNmNiNzllYWFjZmQwNzczNDRmZjY3NDE1MmEwZDY0MjYwODdkYjFjMyZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.imeTph-Hw-93Jq36UmxJwCiVVvB51q4m_8xkx00iJzk"><img src="https://private-user-images.githubusercontent.com/5446186/320413592-6ac62220-a16c-46c9-ab21-d24ae357ed03.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NjQyMjUzMDEsIm5iZiI6MTc2NDIyNTAwMSwicGF0aCI6Ii81NDQ2MTg2LzMyMDQxMzU5Mi02YWM2MjIyMC1hMTZjLTQ2YzktYWIyMS1kMjRhZTM1N2VkMDMucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MTEyNyUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTExMjdUMDYzMDAxWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9MDQ1ZGQxMGQ2NTExZTFjYjAwMDY5ZjFiNmNiNzllYWFjZmQwNzczNDRmZjY3NDE1MmEwZDY0MjYwODdkYjFjMyZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.imeTph-Hw-93Jq36UmxJwCiVVvB51q4m_8xkx00iJzk" alt="Community"></a>
</p>

<p dir="auto"><h3 tabindex="-1" dir="auto">Code of Conduct</h3><a id="user-content-code-of-conduct" aria-label="Permalink: Code of Conduct" href="#code-of-conduct"></a></p>
<p dir="auto">Anyone who contributes to Penpot, whether through code, in the community, or at an event, must adhere to the
<a href="https://help.penpot.app/contributing-guide/coc/" rel="nofollow">code of conduct</a> and foster a positive and safe environment.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Contributing</h2><a id="user-content-contributing" aria-label="Permalink: Contributing" href="#contributing"></a></p>
<p dir="auto">Any contribution will make a difference to improve Penpot. How can you get involved?</p>
<p dir="auto">Choose your way:</p>
<ul dir="auto">
<li>Create and <a href="https://penpot.app/libraries-templates.html" rel="nofollow">share Libraries &amp; Templates</a> that will be helpful for the community</li>
<li>Invite your <a href="https://design.penpot.app/#/auth/register" rel="nofollow">team to join</a></li>
<li>Give this repo a star and follow us on Social Media: <a href="https://fosstodon.org/@penpot/" rel="nofollow">Mastodon</a>, <a href="https://www.youtube.com/c/Penpot" rel="nofollow">Youtube</a>, <a href="https://instagram.com/penpot.app" rel="nofollow">Instagram</a>, <a href="https://www.linkedin.com/company/penpotdesign" rel="nofollow">Linkedin</a>,  <a href="https://peertube.kaleidos.net/a/penpot_app" rel="nofollow">Peertube</a>, <a href="https://twitter.com/penpotapp" rel="nofollow">X</a> and <a href="https://bsky.app/profile/penpot.app" rel="nofollow">BlueSky</a></li>
<li>Participate in the <a href="https://community.penpot.app/" rel="nofollow">Community</a> space by asking and answering questions; reacting to others’ articles;  opening your own conversations and following along on decisions affecting the project.</li>
<li>Report bugs with our easy <a href="https://help.penpot.app/contributing-guide/reporting-bugs/" rel="nofollow">guide for bugs hunting</a> or <a href="https://github.com/penpot/penpot/issues">GitHub issues</a></li>
<li>Become a <a href="https://help.penpot.app/contributing-guide/translations" rel="nofollow">translator</a></li>
<li>Give feedback: <a href="mailto:support@penpot.app">Email us</a></li>
<li><strong>Contribute to Penpot's code:</strong> <a href="https://www.youtube.com/watch?v=TpN0osiY-8k" rel="nofollow">Watch this video</a> by Alejandro Alonso, CIO and developer at Penpot, where he gives us a hands-on demo of how to use Penpot’s repository and make changes in both front and back end</li>
</ul>
<p dir="auto">To find (almost) everything you need to know on how to contribute to Penpot, refer to the <a href="https://help.penpot.app/contributing-guide/" rel="nofollow">contributing guide</a>.</p>

<p dir="auto">
  <a target="_blank" rel="noopener noreferrer" href="https://private-user-images.githubusercontent.com/5446186/320413622-fea18923-dc06-49be-86ad-c3496a7956e6.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NjQyMjUzMDEsIm5iZiI6MTc2NDIyNTAwMSwicGF0aCI6Ii81NDQ2MTg2LzMyMDQxMzYyMi1mZWExODkyMy1kYzA2LTQ5YmUtODZhZC1jMzQ5NmE3OTU2ZTYucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MTEyNyUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTExMjdUMDYzMDAxWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9MWIyY2Q2OGFjMTRmYzM2ZmRiMTkyZjExZWUzNTNlMmE5YTg4MzI3MzU1Zjg3OWE3NWQzMjI4YjE1NGU0Y2Q1YyZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.aexCcjmHLC-KhcY6cBBOcnx1zLRflqht7aOfy8uxjRE"><img src="https://private-user-images.githubusercontent.com/5446186/320413622-fea18923-dc06-49be-86ad-c3496a7956e6.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NjQyMjUzMDEsIm5iZiI6MTc2NDIyNTAwMSwicGF0aCI6Ii81NDQ2MTg2LzMyMDQxMzYyMi1mZWExODkyMy1kYzA2LTQ5YmUtODZhZC1jMzQ5NmE3OTU2ZTYucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MTEyNyUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTExMjdUMDYzMDAxWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9MWIyY2Q2OGFjMTRmYzM2ZmRiMTkyZjExZWUzNTNlMmE5YTg4MzI3MzU1Zjg3OWE3NWQzMjI4YjE1NGU0Y2Q1YyZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.aexCcjmHLC-KhcY6cBBOcnx1zLRflqht7aOfy8uxjRE" alt="Libraries and templates"></a>
</p>

<p dir="auto"><h2 tabindex="-1" dir="auto">Resources</h2><a id="user-content-resources" aria-label="Permalink: Resources" href="#resources"></a></p>
<p dir="auto">You can ask and answer questions, have open-ended conversations, and follow along on decisions affecting the project.</p>
<p dir="auto">💾 <a href="https://help.penpot.app/technical-guide/" rel="nofollow">Documentation</a></p>
<p dir="auto">🚀 <a href="https://help.penpot.app/technical-guide/getting-started/" rel="nofollow">Getting Started</a></p>
<p dir="auto">✏️ <a href="https://www.youtube.com/playlist?list=PLgcCPfOv5v54WpXhHmNO7T-YC7AE-SRsr" rel="nofollow">Tutorials</a></p>
<p dir="auto">🏘️ <a href="https://help.penpot.app/technical-guide/developer/architecture/" rel="nofollow">Architecture</a></p>
<p dir="auto">📚 <a href="https://penpot.app/dev-diaries.html" rel="nofollow">Dev Diaries</a></p>
<p dir="auto"><h2 tabindex="-1" dir="auto">License</h2><a id="user-content-license" aria-label="Permalink: License" href="#license"></a></p>
<div data-snippet-clipboard-copy-content="This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.

Copyright (c) KALEIDOS INC"><pre><code>This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.

Copyright (c) KALEIDOS INC
</code></pre></div>
<p dir="auto">Penpot is a Kaleidos’ <a href="https://kaleidos.net/" rel="nofollow">open source project</a></p>
</article></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Functional Data Structures and Algorithms: a Proof Assistant Approach (105 pts)]]></title>
            <link>https://fdsa-book.net/</link>
            <guid>46064680</guid>
            <pubDate>Thu, 27 Nov 2025 02:04:57 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://fdsa-book.net/">https://fdsa-book.net/</a>, See on <a href="https://news.ycombinator.com/item?id=46064680">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="wrapper">
  
  <h2>A Proof Assistant Approach</h2>
  <h3>
  <a href="https://www.proof.cit.tum.de/~nipkow/">Tobias Nipkow</a>,
  <a href="https://www.tcs.ifi.lmu.de/mitarbeiter/jasmin-blanchette_de.html">Jasmin
  Blanchette</a>,
  <a href="http://cl-informatik.uibk.ac.at/users/meberl/">Manuel Eberl</a>,
  <a href="https://se.linkedin.com/in/alejandro-g%C3%B3mez-londo%C3%B1o-001a1943">Alejandro
  Gómez-Londoño</a>,
  <a href="https://people.utwente.nl/p.lammich">Peter Lammich</a>,
  <a href="http://cl-informatik.uibk.ac.at/csternagel">Christian Sternagel</a>,
  <a href="https://home.in.tum.de/~wimmers">Simon Wimmer</a>,
  <a href="https://lcs.ios.ac.cn/~bzhan/">Bohua Zhan</a></h3>
  <h3><a href="https://dl.acm.org/doi/book/10.1145/3731369">Published by ACM Books</a></h3>

<p> This book is an introduction to data structures and algorithms for
functional languages, with a focus on proofs. It covers both
functional correctness and running time analysis. It does so in a
unified manner with inductive proofs about functional programs and
their running time functions.  All proofs have been
machine-checked by the proof assistant <a href="https://isabelle.in.tum.de/">Isabelle</a>. The pdf contains
links to the corresponding Isabelle theories.
</p>

<p>
Click on an image to download the pdf of the whole book:
</p>
<p>
<a href="https://fdsa-book.net/functional_data_structures_algorithms.pdf">
<img src="https://fdsa-book.net/cover.png" alt="Functional Data Structures
  and Algorithms">
</a>
</p>
<p>
<a href="https://fdsa-book.net/functional_data_structures_algorithms.pdf">
  <img src="https://fdsa-book.net/toc1.png" alt="Table of contents 1">
</a>
<a href="https://fdsa-book.net/functional_data_structures_algorithms.pdf">
  <img src="https://fdsa-book.net/toc2.png" alt="Table of contents 2">
</a>
</p>
<p>
This book is meant to evolve over time. If you would like to contribute, get in touch! 
</p>
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Migrating the Main Zig Repository from GitHub to Codeberg (850 pts)]]></title>
            <link>https://ziglang.org/news/migrating-from-github-to-codeberg/</link>
            <guid>46064571</guid>
            <pubDate>Thu, 27 Nov 2025 01:49:00 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://ziglang.org/news/migrating-from-github-to-codeberg/">https://ziglang.org/news/migrating-from-github-to-codeberg/</a>, See on <a href="https://news.ycombinator.com/item?id=46064571">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="content" role="main">
    
      <p><a id="back" href="https://ziglang.org/news/">
        ← Back to
        <b>News</b>
        page
      </a></p>
    <h3>November 26, 2025</h3>
    
    <p><a href="https://codeberg.org/ziglang/zig" target="_blank">https://codeberg.org/ziglang/zig</a></p><p>Ever since <a href="https://codeberg.org/ziglang/zig/src/commit/8e08cf4bec80b87a7a22a18086a3db5c2c0f1772" target="_blank"><code>git init</code> ten years ago</a>, Zig has been hosted on GitHub. Unfortunately, when it <a href="https://github.blog/news-insights/company-news/github-microsoft/" target="_blank">sold out to Microsoft</a>, the <a href="https://craphound.com/category/enshittification/" target="_blank">clock started ticking</a>. “Please just give me 5 years before everything goes to shit,” I thought to myself. And here we are, 7 years later, living on borrowed time.</p><p>Putting aside GitHub’s <a href="https://www.vox.com/recode/2019/10/9/20906605/github-ice-contract-immigration-ice-dan-friedman" target="_blank">relationship with ICE</a>, it’s abundantly clear that the talented folks who used to work on the product have moved on to bigger and better things, with the remaining losers eager to inflict some kind of bloated, buggy JavaScript framework on us in the name of progress. Stuff that used to be snappy is now sluggish and often entirely broken.</p><p>More importantly, Actions is <a href="https://github.com/actions/runner/issues/3792#issuecomment-3182746514" target="_blank">created by monkeys</a> and <a href="https://github.com/actions/runner/issues/385" target="_blank">completely neglected</a>. After the <a href="https://www.businessinsider.com/github-ceo-developers-embrace-ai-or-get-out-2025-8" target="_blank">CEO of GitHub said to “embrace AI or get out”</a>, it seems the lackeys at Microsoft took the hint, because GitHub Actions started “vibe-scheduling”; choosing jobs to run seemingly at random. Combined with other bugs and inability to manually intervene, this causes our CI system to get so backed up that not even master branch commits get checked.</p><p>Rather than wasting donation money on more CI hardware to work around this crumbling infrastructure, we’ve opted to switch Git hosting providers instead.</p><p>As a bonus, we look forward to fewer violations (exhibit <a href="https://github.com/ziglang/zig/pull/25974" target="_blank">A</a>, <a href="https://github.com/ziglang/zig/pull/24983" target="_blank">B</a>, <a href="https://github.com/ziglang/www.ziglang.org/pull/502" target="_blank">C</a>) of our <a href="https://ziglang.org/code-of-conduct/#strict-no-llm-no-ai-policy">strict no LLM / no AI policy</a>, which I believe are at least in part due to GitHub aggressively pushing the “file an issue with Copilot” feature in everyone’s face.</p><h2>GitHub Sponsors</h2><p>The only concern we have in leaving GitHub behind has to do with GitHub Sponsors. This product was key to Zig’s early fundraising success, and it <a href="https://ziglang.org/news/2025-financials/">remains a large portion of our revenue today</a>. I can’t thank <a href="https://devonzuegel.com/" target="_blank">Devon Zuegel</a> enough. She appeared like an angel from heaven and single-handedly made GitHub into a viable source of income for thousands of developers. Under her leadership, the future of GitHub Sponsors looked bright, but sadly for us, she, too, moved on to bigger and better things. Since she left, that product as well has been neglected and is already starting to decline.</p><p>Although GitHub Sponsors is a large fraction of Zig Software Foundation’s donation income, <strong>we consider it a liability</strong>. We humbly ask if you, reader, are currently donating through GitHub Sponsors, that you consider <a href="https://ziglang.org/zsf/">moving your recurring donation to Every.org</a>, which is itself a non-profit organization.</p><p>As part of this, we are sunsetting the GitHub Sponsors perks. These perks are things like getting your name onto the home page, and getting your name into the release notes, based on how much you donate monthly. We are working with the folks at Every.org so that we can offer the equivalent perks through that platform.</p><h2>Migration Plan</h2><p>Effective immediately, I have made <a href="https://github.com/ziglang/zig/" target="_blank">ziglang/zig on GitHub</a> read-only, and the canonical origin/master branch of the main Zig project repository is <code>https://codeberg.org/ziglang/zig.git</code>.</p><p>Thank you to the Forgejo contributors who helped us with our issues switching to the platform, as well as the Codeberg folks who worked with us on the migration - in particular <a href="https://codeberg.org/earl-warren" target="_blank">Earl Warren</a>, <a href="https://codeberg.org/fnetX" target="_blank">Otto</a>, <a href="https://codeberg.org/Gusted" target="_blank">Gusted</a>, and <a href="https://codeberg.org/mfenniak" target="_blank">Mathieu Fenniak</a>.</p><p>In the end, we opted for a simple strategy, sidestepping GitHub’s aggressive vendor lock-in: leave the existing issues open and unmigrated, but start counting issues at 30000 on Codeberg so that all issue numbers remain unambiguous. Let us please consider the GitHub issues that remain open as metaphorically “copy-on-write”. <strong>Please leave all your existing GitHub issues and pull requests alone</strong>. No need to move your stuff over to Codeberg unless you need to make edits, additional comments, or rebase. <strong>We’re still going to look at the already open pull requests and issues</strong>; don’t worry.</p><hr><p>In this modern era of acquisitions, weak antitrust regulations, and platform capitalism leading to extreme concentrations of wealth, non-profits remain a bastion defending what remains of the commons.</p><p>Happy hacking,</p><p>Andrew</p>
    
  </div></div>]]></description>
        </item>
    </channel>
</rss>