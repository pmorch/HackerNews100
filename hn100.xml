(ignoring known css parsing error)
<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
    <channel>
        <title>HN100 - Readable Contents</title>
        <link>https://hn.algolia.com/api/v1/search_by_date?tags=%28story,poll%29&amp;numericFilters=points%3E100</link>
        <description>Uses Readability to add bodies to the RSS feed</description>
        <lastBuildDate>Wed, 30 Oct 2024 18:30:06 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Cheap solar panels are changing the world (101 pts)]]></title>
            <link>https://www.theatlantic.com/science/archive/2024/10/solar-power-energy-revolution-global-south/680351/</link>
            <guid>41996425</guid>
            <pubDate>Wed, 30 Oct 2024 15:46:35 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.theatlantic.com/science/archive/2024/10/solar-power-energy-revolution-global-south/680351/">https://www.theatlantic.com/science/archive/2024/10/solar-power-energy-revolution-global-south/680351/</a>, See on <a href="https://news.ycombinator.com/item?id=41996425">Hacker News</a></p>
<div id="readability-page-1" class="page"><article><header data-event-module="hero"><div><figure><div data-flatplan-lead_figure_media="true"><picture><img alt="Color picture of a fuzzy white orb against an orange, red, and black background" sizes="(min-width: 976px) 976px, 100vw" srcset="https://cdn.theatlantic.com/thumbor/1tVAqPhOKJ9-Ama_9rJvchKXqa0=/0x0:2700x1519/750x422/media/img/mt/2024/10/2024_10_23_7764/original.jpg 750w, https://cdn.theatlantic.com/thumbor/poGcucq5ljH2A8eXPv8DSzC6ihQ=/0x0:2700x1519/828x466/media/img/mt/2024/10/2024_10_23_7764/original.jpg 828w, https://cdn.theatlantic.com/thumbor/vzl34JyqeomOmxgWi5RcYdaQFhI=/0x0:2700x1519/960x540/media/img/mt/2024/10/2024_10_23_7764/original.jpg 960w, https://cdn.theatlantic.com/thumbor/-NIQgd0bqmqphOjZdN1F-p3_-jQ=/0x0:2700x1519/976x549/media/img/mt/2024/10/2024_10_23_7764/original.jpg 976w, https://cdn.theatlantic.com/thumbor/qsDScksnq-e6h-728nh23UbXE6I=/0x0:2700x1519/1952x1098/media/img/mt/2024/10/2024_10_23_7764/original.jpg 1952w" src="https://cdn.theatlantic.com/thumbor/vzl34JyqeomOmxgWi5RcYdaQFhI=/0x0:2700x1519/960x540/media/img/mt/2024/10/2024_10_23_7764/original.jpg" id="article-lead-image" width="960" height="540"></picture></div><figcaption data-flatplan-lead_figure_caption="true">Franz Gruenewald / Connected Archives</figcaption></figure></div><gpt-ad format="injector" sizes-at-0="mobile-wide" targeting-pos="injector-article-start" sizes-at-976="desktop-wide"></gpt-ad></header><div data-view-action="view - audio player - start" data-view-label="680351" data-event-module="audio player" data-event-content-type="narrated" data-event-module-state="start" data-event-view="true"><div><p><img alt="Color picture of a fuzzy white orb against an orange, red, and black background" sizes="80px" srcset="https://cdn.theatlantic.com/thumbor/NrENC2WTV6PoxwAzBNU1kHPt0qU=/591x0:2110x1519/80x80/media/img/mt/2024/10/2024_10_23_7764/original.jpg 80w, https://cdn.theatlantic.com/thumbor/KnebwVKvhRfzj3DksnCWgV3ylB4=/591x0:2110x1519/96x96/media/img/mt/2024/10/2024_10_23_7764/original.jpg 96w, https://cdn.theatlantic.com/thumbor/r5lm88Wb1WGE8NpCKHyimiJOHB8=/591x0:2110x1519/128x128/media/img/mt/2024/10/2024_10_23_7764/original.jpg 128w, https://cdn.theatlantic.com/thumbor/dz3XkvczCXE5zjTXKlTRdjQ0rLA=/591x0:2110x1519/160x160/media/img/mt/2024/10/2024_10_23_7764/original.jpg 160w, https://cdn.theatlantic.com/thumbor/_FBXT_ch4BJpeyXbD_oKGoZRNXM=/591x0:2110x1519/192x192/media/img/mt/2024/10/2024_10_23_7764/original.jpg 192w, https://cdn.theatlantic.com/thumbor/_GioWRDwGCI0on9bq086G6tlBI8=/591x0:2110x1519/256x256/media/img/mt/2024/10/2024_10_23_7764/original.jpg 256w, https://cdn.theatlantic.com/thumbor/yUkHVOX7E_V2sZEvyP-kabOZtjY=/591x0:2110x1519/384x384/media/img/mt/2024/10/2024_10_23_7764/original.jpg 384w, https://cdn.theatlantic.com/thumbor/6WNHdMgu43KzHaLNHOnBijKJnJs=/591x0:2110x1519/512x512/media/img/mt/2024/10/2024_10_23_7764/original.jpg 512w" src="https://cdn.theatlantic.com/thumbor/NrENC2WTV6PoxwAzBNU1kHPt0qU=/591x0:2110x1519/80x80/media/img/mt/2024/10/2024_10_23_7764/original.jpg" width="80" height="80"></p></div><p>Produced by ElevenLabs and News Over Audio (NOA) using AI narration.</p></div><section data-event-module="article body" data-flatplan-body="true"><p data-flatplan-paragraph="true"><em><small>Updated at 1:40 p.m. ET on October 25, 2024</small></em></p><p data-flatplan-paragraph="true">Last month, an energy think tank released some rare good news for the climate: The world is on track to install 29 percent more solar capacity this year than it did the year before, according to a report from <a data-event-element="inline link" href="https://ember-energy.org/latest-insights/solar-power-continues-to-surge-in-2024/">Ember</a>. “In a single year, in a single technology, we’re providing as much new electricity as the entirety of global growth the year before,” Kingsmill Bond, a senior energy strategist at RMI, a clean-energy nonprofit, told me. A decade or two ago, analysts “did not imagine in their wildest dreams that solar by the middle of the 2020s would already be supplying all of the growth of global electricity demand,” he said. Yet here we are.</p><p data-flatplan-paragraph="true">In the United States, solar accounted for <a data-event-element="inline link" href="https://grist.org/energy/solar-hits-a-renewable-energy-milestone-not-seen-since-wwii/">more than half</a> of all new power last year. But the most dramatic growth is happening overseas. The latest global report from the International Energy Agency (IEA) notes that solar is on track to <a data-event-element="inline link" href="https://www.iea.org/reports/world-energy-outlook-2024">overtake</a> all other forms of energy by 2033. The world’s use of fossil fuels is already plateauing (the U.S., for its part, hit its peak demand for fossil-fuel energy <a data-event-element="inline link" href="https://www.eia.gov/todayinenergy/detail.php?id=45096#:~:text=The%20share%20of%20U.S.%20total%20energy%20consumption%20that%20originated%20from,increase%20in%20natural%20gas%20consumption.">way back in 2007</a>). Energy demand is still rising, but renewables are stepping in to make up the difference. “The really interesting debate now,” Bond said, “is actually: When do we push fossil fuels off the plateau? And from our numbers, if solar keeps on growing this way, it’s going to be off the plateau by the end of this decade.”</p><p data-flatplan-paragraph="true">The advantages of solar speak for themselves. Solar can be built faster and with fewer permits than other forms of energy infrastructure, mostly because the panels are flat and modular (unlike, say, a towering wind turbine or a hulking gas-fired power plant). It’s also adaptable at any scale, from an individual erecting a single panel to a utility company assembling a solar farm. And now, thanks to remarkable drops in prices for solar panels, mainly from China, simple market forces seem to be driving an all-out solar boom. “This is unstoppable,” Heymi Bahar, a senior energy analyst at the IEA, told me.</p><p data-flatplan-paragraph="true">Globally, some 40 percent of solar’s growth is in the form of people powering their own homes and businesses, Bahar said. Perhaps nowhere is this better illustrated than in Africa, where Joel Nana, a project manager at Sustainable Energy Africa in Cape Town, has been leading an effort to help countries regulate and integrate the explosion of small-scale solar. When Nana and his team started quantifying just how much new solar was around, “we were actually shocked,” he told me. In South Africa, for example, the total amount of energy produced from solar systems in 2019 was thought to be about 500 megawatts, Nana said. But in the first quarter of 2023, when researchers <a data-event-element="inline link" href="https://www.sseg.org.za/wp-content/uploads/2024/02/Status-of-EG-in-South-African-Municipalities-2023-FINAL-2.pdf">used satellite imagery</a> to count all of the solar installations in the country, they estimated that solar was producing a combined 5,700 megawatts of energy—only 55 percent of which had been declared to the government. That story of rapid, invisible growth is being repeated across the continent. Kenya now has about 200 megawatts of rooftop solar installed, representing 9 percent of the country’s total energy use, Nana said. Namibia has about 96 megawatts of rooftop solar capacity in its system, he said—a whopping 15 percent of its energy mix. “It’s been happening for three or four years, maybe five years, completely off the radar,” Nana said.</p><p id="injected-recirculation-link-0" data-view-action="view link - injected link - item 1" data-event-element="injected link" data-event-position="1"><a href="https://www.theatlantic.com/magazine/archive/2020/03/climate-change-peer-pressure/605515/">From the March 2020 issue: Thy neighbor’s solar panels</a></p><p data-flatplan-paragraph="true">Solar seems to have passed a tipping point: In many countries, the low cost of the technology is propelling its own growth, despite little government help. In South Africa, businesses such as shopping malls and factories have historically run diesel generators to deal with frequent power outages. Many still do, but now others are saving money by installing solar panels. Electricity from a diesel generator costs about 10 rand per kilowatt-hour, Nana said; with solar panels, it plummets to about two rand. “It’s literally a no-brainer for a business owner,” he said. Businesses make up 80 percent of small-scale solar capacity in the country, according to his research. Soon, Nana hopes, arrays and batteries will become cheap enough that more homeowners across the continent will be able to afford switching to solar. And, as the journalist Bill McKibben has reported, some homeowners in African countries who have never been connected to the grid are getting electricity for the very first time via solar-panel kits, <a data-event-element="inline link" href="https://www.newyorker.com/magazine/2017/06/26/the-race-to-solar-power-africa">skipping over</a> a fossil-fuel phase entirely.</p><p data-flatplan-paragraph="true">Across the global South, solar is capturing unprecedented portions of the energy market. <a data-event-element="inline link" href="https://www.bloomberg.com/news/articles/2024-08-09/pakistan-sees-solar-boom-as-chinese-imports-surge-bnef-says?sref=OVk78rkt">Pakistan</a>, for example, imported the equivalent of a quarter of its total energy capacity in Chinese solar panels in just the first six months of this year. Many countries in the global South lack significant fossil-fuel resources, and importing them is expensive. “By far the easiest way to obtain economic growth in a country with a lot of sunshine and no fossil fuels is by exploiting your own domestic resources,” Bond said. Already, in countries including Brazil, Morocco, Mexico, and Uruguay, solar and wind make up a bigger share of electricity generation than it does in global-North countries. By 2030, RMI <a data-event-element="inline link" href="https://rmi.org/insight/powering-up-the-global-south/?utm_campaign=heatmap_am&amp;utm_medium=email&amp;_hsenc=p2ANqtz--BBjdCevYygk974VQXcaVPv4j6TzxSY16EAOWZzFTxiQVb1IaUzr5KB04lHP5hWB-Z4i04a3GWJstmBl3UfnMazBK6ig&amp;_hsmi=329173745&amp;utm_content=329173745&amp;utm_source=hs_email">predicts</a>, the global South will have quadrupled its solar and wind capacity.</p><p data-flatplan-paragraph="true">That estimate doesn’t account for China, which is experiencing an unparalleled solar boom. In addition to supplying the rest of the world with panels, China installed more than half of the planet’s new solar capacity within its own borders in 2023, and the Ember report says it’s on track to add a similar amount this year. In 2023, the country more than doubled its own solar capacity year over year. “Nobody was expecting that it would be so high,” Bahar said.</p><p id="injected-recirculation-link-1" data-view-action="view link - injected link - item 2" data-event-element="injected link" data-event-position="2"><a href="https://www.theatlantic.com/science/archive/2021/06/why-the-us-doesnt-really-make-solar-panels-anymore-industrial-policy/619213/">Read: Why America doesn’t really make solar panels anymore</a></p><p data-flatplan-paragraph="true">Last year, at the United Nations Climate Change Conference, or COP28, in Dubai, 132 countries and the European Union <a data-event-element="inline link" href="https://www.cop28.com/en/global-renewables-and-energy-efficiency-pledge#:~:text=Commit%20to%20work%20together%20to,starting%20points%20and%20national%20circumstances">pledged</a> to triple the world’s renewable-energy capacity by 2030. According to Bahar, it’s the only promise of the many made in Dubai that’s likely to even be close to fulfilled: The world is on track to add 2.7 times its renewable capacity by then, and 80 percent of that increase will come from solar. To make use of all this growth, the world will have to add much more storage and transmission capacity, neither of which are keeping up with solar’s pace. The IEA, where Bahar works, will advocate for new pledges on those two fronts at COP29 next month. A world that mostly runs on solar power will also need something else—such as hydropower, nuclear, or geothermal—to generate energy when the sun isn’t shining in the evenings and winters. Jessika Trancik, an MIT professor who models clean-energy development, told me that governments need to steer investments toward storage and alternate forms of energy to compensate for that inherent downtime. That way, the world can have a reliable energy mix when 50 or 60 percent of electricity generation comes from solar and wind. That may seem far off, she said—solar made up about <a data-event-element="inline link" href="https://ember-energy.org/latest-insights/the-global-solar-revolution/">5.5 percent</a> of global electricity in 2023—but with the exponential growth of cheap solar, “before you know it, it’s upon you.”</p><p data-flatplan-paragraph="true">For Africa’s quiet solar boom to meet its full potential, governments will need to regulate and subsidize the technology, Nana said. Federal departments in Namibia, Kenya, and Eswatini have largely ignored the ascendance of solar technology within their borders, Nana said. Yet in South Africa, he’s seeing bright spots. Last year, the government began providing subsidies for solar for the first time. This year, its updated energy plan acknowledged that small-scale solar will be the biggest player in the country in the next decade. If South Africa is any indication, a solar revolution will arrive in more countries in the coming years. It may even sneak up on them.</p><hr><p data-flatplan-paragraph="true"><small><em>This article originally misstated that solar power made up 5.5 percent of global energy in 2023. It made up 5.5 percent of global electricity.</em></small></p></section><div data-event-module="footer"><p><h3>About the Author</h3></p><div><address id="article-writer-0" data-event-element="author" data-event-position="1" data-flatplan-bio="true"><div><p><a href="https://www.theatlantic.com/author/zoe-schlanger/" data-event-element="image"><img alt="" loading="lazy" src="https://cdn.theatlantic.com/thumbor/u8S5JVOtiftKFSYJUPgPfsZK710=/468x9:2384x1925/120x120/media/img/authors/2023/10/Sten_SSENSE_ZoeSchlanger_18_hi_res_version/original.jpg" width="60" height="60"></a></p><div><p><a href="https://www.theatlantic.com/author/zoe-schlanger/" data-label="https://www.theatlantic.com/author/zoe-schlanger/" data-action="click author - name">Zoë Schlanger</a> is a staff writer at <em>The Atlantic</em>. She is the author of <em><a href="https://bookshop.org/p/books/the-light-eaters-how-the-unseen-world-of-plant-intelligence-offers-a-new-understanding-of-life-on-earth-zoe-schlanger/20890522?ean=9780063073852">The Light Eaters</a>, </em>about the world of plant-behavior-and-intelligence research.</p></div></div></address></div></div><gpt-ad format="injector" sizes-at-0="mobile-wide,native,house" targeting-pos="injector-most-popular" sizes-at-976="desktop-wide,native,house"></gpt-ad></article></div>]]></description>
        </item>
        <item>
            <title><![CDATA[M4 MacBook Pro (429 pts)]]></title>
            <link>https://www.apple.com/newsroom/2024/10/new-macbook-pro-features-m4-family-of-chips-and-apple-intelligence/</link>
            <guid>41995701</guid>
            <pubDate>Wed, 30 Oct 2024 15:00:20 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.apple.com/newsroom/2024/10/new-macbook-pro-features-m4-family-of-chips-and-apple-intelligence/">https://www.apple.com/newsroom/2024/10/new-macbook-pro-features-m4-family-of-chips-and-apple-intelligence/</a>, See on <a href="https://news.ycombinator.com/item?id=41995701">Hacker News</a></p>
<div id="readability-page-1" class="page">


	
    







 
<nav id="ac-localnav" lang="en-US" role="navigation" aria-label="Newsroom" data-analytics-region="local nav" data-sticky="">
	
    
    
        




    
    
    
	
	

</nav>





<main id="main" role="main"> 




<span id="opens-in-new-window">opens in new window</span>
<section>
<article data-analytics-activitymap-region-id="article">






    
    
    









    





    <div>
        
		
        <div>
                    
                    
                        <span>PRESS RELEASE</span>
                    
                    
                        <span>October 30, 2024</span>
                    
                    
                </div>

        <div>
                
                
                
                    <h2>
                        
    
        Apple’s new MacBook&nbsp;Pro features the incredibly powerful M4 family of chips and ushers in a new era with Apple&nbsp;Intelligence
    

                    </h2>
                
            </div>

        <div>
                
                
                    With an advanced 12MP Center Stage camera, Thunderbolt&nbsp;5 on M4&nbsp;Pro and M4&nbsp;Max models, and an all-new nano-texture display option, MacBook&nbsp;Pro gets even more capable and even more pro
                
            </div>

        
            
    
    
    
    
    

        

    </div>







    
    
    






  
    
    
    
    
      <figure aria-label="Media, An almost shut MacBook Pro emits a colorful glowing light.">
        <div>
             
              
              <div>
                Supercharged by Apple Intelligence, even more powerful Apple silicon with the M4 family of chips, and new capabilities, MacBook Pro accelerates pro workloads like never before.
              </div>
            
            
            
            
            <a href="https://www.apple.com/newsroom/images/2024/10/new-macbook-pro/article/Apple-MacBook-Pro-M4-hero.zip" download="" data-analytics-title="download image - Apple-MacBook-Pro-M4-hero_big" aria-label="Download media, An almost shut MacBook Pro emits a colorful glowing light."></a>
          </div>
      </figure>
    
  






    
    
    


     
     
    
    
        <div>
             
                 <div><strong><span>CUPERTINO, CALIFORNIA</span> </strong>Apple today unveiled the new <a href="https://www.youtube.com/watch?v=G0cmfY7qdmY" target="_blank" rel="nofollow" data-analytics-exit-link="">MacBook Pro</a>, powered by the M4 family of chips — M4, M4 Pro, and M4 Max — delivering much faster performance and enhanced capabilities. The new MacBook Pro is built for Apple Intelligence, the personal intelligence system that transforms how users work, communicate, and express themselves, while protecting their privacy. Now available in space black and silver finishes, the 14-inch MacBook Pro includes the blazing-fast performance of M4 and three Thunderbolt 4 ports, starting with 16GB of memory, all at just $1,599. The 14- and 16-inch models with M4 Pro and M4 Max offer Thunderbolt 5 for faster transfer speeds and advanced connectivity. All models include a Liquid Retina XDR display that gets even better with an all-new nano-texture display option and up to 1000 nits of brightness for SDR content, an advanced 12MP Center Stage camera, along with up to 24 hours of battery life, the longest ever in a Mac.<sup>1</sup> The new MacBook Pro is available to pre-order today, with availability beginning November 8.
</div>
                 
             
                 <div>“MacBook Pro is an incredibly powerful tool that millions of people use to do their life’s best work, and today we’re making it even better,” said John Ternus, Apple’s senior vice president of Hardware Engineering. “With the powerful M4 family of chips, and packed with pro features like Thunderbolt 5, an advanced 12MP Center Stage camera, an all-new nano-texture display option, and Apple Intelligence, the new MacBook Pro continues to be, by far, the world’s best pro laptop.”
</div>
                 
             
         </div>
 

    
    
    


    
    
        
        
        
            <div role="group" aria-label="gallery" data-component-list="MixinGallery" id="macbook-pro-details">
            <nav role="presentation">
                <ul role="tablist">
                    
                        <li role="presentation">
                            <a id="gallery-dotnav-6f87eb0dc4ce953520c7f9cc606f58cf" href="#gallery-6f87eb0dc4ce953520c7f9cc606f58cf" data-ac-gallery-trigger="gallery-6f87eb0dc4ce953520c7f9cc606f58cf"><span>A look at the front and the back of the new MacBook Pro.</span></a>
                        </li>
                    
                        <li role="presentation">
                            <a id="gallery-dotnav-e77c52288c1b1d227891ed9d8eff5844" href="#gallery-e77c52288c1b1d227891ed9d8eff5844" data-ac-gallery-trigger="gallery-e77c52288c1b1d227891ed9d8eff5844"><span>A close-up of the keyboard on the new MacBook Pro.</span></a>
                        </li>
                    
                </ul>
            </nav>
            <div>
                
                    
                        
                        <div id="gallery-6f87eb0dc4ce953520c7f9cc606f58cf" aria-labelledby="gallery-dotnav-6f87eb0dc4ce953520c7f9cc606f58cf" data-gallery-item="">
                            <figure role="presentation" data-analytics-activitymap-region-id="Gallery:front-and-back">
                                
                                <div>
                                    <div>The new MacBook Pro is transformed with Apple Intelligence, the blazing performance of the M4 family, an advanced 12MP Center Stage camera, an all-new nano-texture display option, and more.</div>
                                    
                                    
                                    <a href="https://www.apple.com/newsroom/images/2024/10/new-macbook-pro/article/Apple-MacBook-Pro-M4-lineup.zip" download="" data-analytics-title="download image - Apple-MacBook-Pro-M4-lineup_big" aria-label="Download media, A look at the front and the back of the new MacBook Pro."></a>
                                </div>
                            </figure>
                        </div>
                        
                    
                
                    
                        
                        <div id="gallery-e77c52288c1b1d227891ed9d8eff5844" aria-labelledby="gallery-dotnav-e77c52288c1b1d227891ed9d8eff5844" data-gallery-item="">
                            <figure role="presentation" data-analytics-activitymap-region-id="Gallery:screen-and-keyboard">
                                
                                <div>
                                    <div>The new MacBook Pro is transformed with Apple Intelligence, the blazing performance of the M4 family, an advanced 12MP Center Stage camera, an all-new nano-texture display option, and more.</div>
                                    
                                    
                                    <a href="https://www.apple.com/newsroom/images/2024/10/new-macbook-pro/article/Apple-MacBook-Pro-M4-Magic-Keyboard-close-up.zip" download="" data-analytics-title="download image - Apple-MacBook-Pro-M4-Magic-Keyboard-close-up_big" aria-label="Download media, A close-up of the keyboard on the new MacBook Pro."></a>
                                </div>
                            </figure>
                        </div>
                        
                    
                
            </div>
            
                
                
                <nav role="presentation">
                    
                        <ul>
                            <li>
                                
                            </li>
                            <li>
                                
                            </li>
                        </ul>
                    
                </nav>
            
        </div>
    


    
    
    


     
     
    
    
        <div>
             
                 <h2><strong>Supercharged by the M4 Family of Chips</strong>
</h2>
                 
             
                 <div>Built using second-generation 3-nanometer technology, the <a href="https://www.apple.com/newsroom/2024/10/apple-introduces-m4-pro-and-m4-max" target="_blank">M4 family</a> is the most advanced lineup of chips for a personal computer. The M4 family features phenomenal single-threaded CPU performance with the world’s fastest CPU core,<sup>2</sup> along with outstanding multithreaded CPU performance for the most demanding workloads. Combined with machine learning accelerators in the CPU, an advanced GPU, and a faster and more efficient Neural Engine, Apple silicon is built from the ground up to deliver incredible performance for AI. Together with faster unified memory, each chip also includes increased memory bandwidth, so large language models (LLMs) and other large projects run smoothly and on device. Additionally, the industry-leading performance per watt of the M4 family means that users get up to 24 hours of battery life, raising the bar of what users can do on a single charge.
</div>
                 
             
         </div>
 

    
    
    






  
    
    
    
    
      <figure aria-label="Media, A graphic shows the M4 family of chips: M4, M4 Pro, and M4 Max.">
        <div>
             
              
              <div>
                The new MacBook&nbsp;Pro features the M4 family of chips, the most advanced lineup of chips ever built for a pro laptop.
              </div>
            
            
            
            
            <a href="https://www.apple.com/newsroom/images/2024/10/new-macbook-pro/article/Apple-MacBook-Pro-M4-chip-series-3up.zip" download="" data-analytics-title="download image - Apple-MacBook-Pro-M4-chip-series-3up_big" aria-label="Download media, A graphic shows the M4 family of chips: M4, M4 Pro, and M4 Max."></a>
          </div>
      </figure>
    
  






    
    
    


     
     
    
    
        <div>
             
                 <h2><strong>New 14-inch MacBook Pro with M4</strong>
</h2>
                 
             
                 <div>The 14-inch MacBook Pro with M4 is the ideal choice for entrepreneurs, students, creators, or anyone doing what they love. Featuring a more powerful 10-core CPU, with four performance cores and six efficiency cores, and a faster 10-core GPU with Apple’s most advanced graphics architecture, the new MacBook Pro starts with 16GB of faster unified memory with support for up to 32GB, along with 120GB/s of memory bandwidth. With M4, MacBook Pro is up to 1.8x faster than the 13-inch MacBook Pro with M1 for tasks like editing gigapixel photos, and even more demanding workloads like rendering complex scenes in Blender are up to 3.4x faster.<sup>1</sup> With a Neural Engine that’s over 3x more powerful than in M1, it’s great for features in Apple Intelligence and other AI workloads. The M4 model also supports two high-resolution external displays in addition to the built-in display, and now features three Thunderbolt 4 ports so users can connect all their peripherals.
</div>
                 
             
         </div>
 

    
    
    






  
    
    
    
    
      <figure aria-label="Media, A person sits on the floor, working on a MacBook Pro propped up on their lap.">
        <div>
             
              
              <div>
                MacBook Pro empowers users to work and be creative wherever they are, with even more game-changing performance and extraordinary battery life.
              </div>
            
            
            
            
            <a href="https://www.apple.com/newsroom/images/2024/10/new-macbook-pro/article/Apple-MacBook-Pro-M4-lifestyle-01.zip" download="" data-analytics-title="download image - Apple-MacBook-Pro-M4-lifestyle-01_big" aria-label="Download media, A person sits on the floor, working on a MacBook Pro propped up on their lap."></a>
          </div>
      </figure>
    
  






    
    
    


     
     
    
    
        <div>
             
                 <div><strong>MacBook Pro with M4 delivers:<sup>1</sup></strong>
</div>
                 
             
                 <div><ul>
<li>Up to 7x faster image processing in Affinity Photo when compared to the 13‑inch MacBook Pro with Core i7, and up to 1.8x faster when compared to the 13-inch MacBook Pro with M1.</li>
</ul>
</div>
                 
             
                 <div><ul>
<li>Up to 10.9x faster 3D rendering in Blender when compared to the 13‑inch MacBook Pro with Core i7, and up to 3.4x faster when compared to the 13‑inch MacBook Pro with M1.</li>
</ul>
</div>
                 
             
                 <div><ul>
<li>Up to 9.8x faster scene edit detection in Adobe Premiere Pro when compared to the 13‑inch MacBook Pro with Core i7, and up to 1.7x faster when compared to the 13‑inch MacBook Pro with M1.</li>
</ul>
</div>
                 
             
         </div>
 

    
    
    


    
    <div data-component-list="ScrollAnimationDefault AutoPlayVideo">
        <div>M4 brings phenomenal performance to the new 14-inch MacBook Pro, from creative tasks to even more demanding workloads such as rendering complex scenes in Blender.</div>
        
            <a aria-label="Download video: MacBook Pro Blender Workflow" data-analytics-title="Download video - MacBook Pro Blender Workflow" download="" href="https://www.apple.com/newsroom/videos/videos-2024/autoplay/2024/10/apple-macbook-pro-m4-blender/downloads/Apple-MacBook-Pro-M4-Blender.zip">
            </a>
        
    </div>






    
    
    


     
     
    
    
        <div>
             
                 <h2><strong>MacBook Pro with M4 Pro: A Pro Powerhouse</strong>
</h2>
                 
             
                 <div>For researchers, developers, engineers, creative pros, or anyone that needs even faster performance for more demanding workflows, MacBook Pro with M4 Pro offers a tremendous performance boost. M4 Pro features a powerful 14-core CPU with 10 performance cores and four efficiency cores for a jump in multicore performance, along with up to a 20-core GPU that is twice as powerful as M4. With M4 Pro, the new MacBook Pro gets a massive 75 percent increase in memory bandwidth over the prior generation — double that of any AI PC chip.<sup>3</sup> The new MacBook Pro with M4 Pro is up to 3x faster than models with M1 Pro, speeding up workflows like geo mapping, structural engineering, and data modeling.<sup>1</sup>
</div>
                 
             
         </div>
 

    
    
    






  
    
    
    
    
      <figure aria-label="Media, Two people work in a lab, with one using the new MacBook Pro.">
        <div>
             
              
              <div>
                The new 14- and 16-inch MacBook Pro with M4 Pro is ideal for researchers, developers, engineers, creative pros, or for anyone looking for even faster performance.
              </div>
            
            
            
            
            <a href="https://www.apple.com/newsroom/images/2024/10/new-macbook-pro/article/Apple-MacBook-Pro-M4-lifestyle-02.zip" download="" data-analytics-title="download image - Apple-MacBook-Pro-M4-lifestyle-02_big" aria-label="Download media, Two people work in a lab, with one using the new MacBook Pro."></a>
          </div>
      </figure>
    
  






    
    
    


     
     
    
    
        <div>
             
                 <div><strong>MacBook Pro with M4 Pro offers:<sup>1</sup></strong>
</div>
                 
             
                 <div><ul>
<li>Up to 4x faster scene rendering performance with Maxon Redshift when compared to the 16-inch MacBook Pro with Core i9, and up to 3x faster when compared to the 16-inch MacBook Pro with M1 Pro.</li>
</ul>
</div>
                 
             
                 <div><ul>
<li>Up to 5x faster simulation of dynamical systems in MathWorks MATLAB when compared to the 16-inch MacBook Pro with Core i9, and up to 2.2x faster when compared to the 16-inch MacBook Pro with M1 Pro.</li>
</ul>
</div>
                 
             
                 <div><ul>
<li>Up to 23.8x faster basecalling for DNA sequencing in Oxford Nanopore MinKNOW when compared to the 16-inch MacBook Pro with Core i9, and up to 1.8x faster when compared to the 16-inch MacBook Pro with M1 Pro.</li>
</ul>
</div>
                 
             
         </div>
 

    
    
    


    
    
        
        
        
            <div role="group" aria-label="gallery" data-component-list="MixinGallery" id="macbook-pro-m4-pro-workflows">
            <nav role="presentation">
                <ul role="tablist">
                    
                        <li role="presentation">
                            <a id="gallery-dotnav-67b1179c669e36224b07ff92d8ff1291" href="#gallery-67b1179c669e36224b07ff92d8ff1291" data-ac-gallery-trigger="gallery-67b1179c669e36224b07ff92d8ff1291"><span>A user works in Fusion on the new MacBook Pro.</span></a>
                        </li>
                    
                        <li role="presentation">
                            <a id="gallery-dotnav-5d95f85875db4499732c2b5318c2f27b" href="#gallery-5d95f85875db4499732c2b5318c2f27b" data-ac-gallery-trigger="gallery-5d95f85875db4499732c2b5318c2f27b"><span>A user works in Luna Modeler on the new MacBook Pro.</span></a>
                        </li>
                    
                        <li role="presentation">
                            <a id="gallery-dotnav-1d2a1510f37c521f0c1ef7d42b17661e" href="#gallery-1d2a1510f37c521f0c1ef7d42b17661e" data-ac-gallery-trigger="gallery-1d2a1510f37c521f0c1ef7d42b17661e"><span>A user works in Xcode on the new MacBook Pro.</span></a>
                        </li>
                    
                </ul>
            </nav>
            <div>
                
                    
                        
                        <div id="gallery-67b1179c669e36224b07ff92d8ff1291" aria-labelledby="gallery-dotnav-67b1179c669e36224b07ff92d8ff1291" data-gallery-item="">
                            <figure role="presentation" data-analytics-activitymap-region-id="Gallery:fusion">
                                
                                <div>
                                    <div>The new MacBook Pro with M4 Pro speeds up a variety of workflows such as structural engineering, data modeling, and more.</div>
                                    
                                    
                                    <a href="https://www.apple.com/newsroom/images/2024/10/new-macbook-pro/article/Apple-MacBook-Pro-M4-Fusion.zip" download="" data-analytics-title="download image - Apple-MacBook-Pro-M4-Fusion_big" aria-label="Download media, A user works in Fusion on the new MacBook Pro."></a>
                                </div>
                            </figure>
                        </div>
                        
                    
                
                    
                        
                        <div id="gallery-5d95f85875db4499732c2b5318c2f27b" aria-labelledby="gallery-dotnav-5d95f85875db4499732c2b5318c2f27b" data-gallery-item="">
                            <figure role="presentation" data-analytics-activitymap-region-id="Gallery:luna-modeler">
                                
                                <div>
                                    <div>The new MacBook Pro with M4 Pro speeds up a variety of workflows such as structural engineering, data modeling, and more.</div>
                                    
                                    
                                    <a href="https://www.apple.com/newsroom/images/2024/10/new-macbook-pro/article/Apple-MacBook-Pro-M4-Luna-Modeler.zip" download="" data-analytics-title="download image - Apple-MacBook-Pro-M4-Luna-Modeler_big" aria-label="Download media, A user works in Luna Modeler on the new MacBook Pro."></a>
                                </div>
                            </figure>
                        </div>
                        
                    
                
                    
                        
                        <div id="gallery-1d2a1510f37c521f0c1ef7d42b17661e" aria-labelledby="gallery-dotnav-1d2a1510f37c521f0c1ef7d42b17661e" data-gallery-item="">
                            <figure role="presentation" data-analytics-activitymap-region-id="Gallery:xcode">
                                
                                <div>
                                    <div>The new MacBook Pro with M4 Pro speeds up a variety of workflows such as structural engineering, data modeling, and more.</div>
                                    
                                    
                                    <a href="https://www.apple.com/newsroom/images/2024/10/new-macbook-pro/article/Apple-MacBook-Pro-M4-Cinema-4D-Slack-Finder-Xcode.zip" download="" data-analytics-title="download image - Apple-MacBook-Pro-M4-Cinema-4D-Slack-Finder-Xcode_big" aria-label="Download media, A user works in Xcode on the new MacBook Pro."></a>
                                </div>
                            </figure>
                        </div>
                        
                    
                
            </div>
            
                
                
                <nav role="presentation">
                    
                        <ul>
                            <li>
                                
                            </li>
                            <li>
                                
                            </li>
                        </ul>
                    
                </nav>
            
        </div>
    


    
    
    


     
     
    
    
        <div>
             
                 <h2><strong>MacBook Pro with M4 Max: The Ultimate in Pro Performance</strong>
</h2>
                 
             
                 <div>Designed for pros like data scientists, 3D artists, and composers who constantly push workflows to the limit, MacBook Pro with M4 Max empowers users to work on projects that were previously only imaginable on a desktop. M4 Max brings up to a 16-core CPU, up to a 40-core GPU, over half a terabyte per second of unified memory bandwidth, and a Neural Engine that is over 3x faster than M1 Max, allowing on-device AI models to run faster than ever. With M4 Max, MacBook Pro delivers up to 3.5x the performance of M1 Max, ripping through heavy creative workloads like visual effects, 3D animation, and film scoring.<sup>1</sup> It also supports up to 128GB of unified memory, so developers can easily interact with LLMs that have nearly 200 billion parameters. And with the powerful Media Engine in M4 Max, which features two ProRes accelerators, MacBook Pro performance is amazing even when taking 4K120 fps ProRes video captured with the new iPhone 16 Pro and editing it in Final Cut Pro.
</div>
                 
             
                 <div><strong>MacBook Pro with M4 Max enables:<sup>1</sup></strong>
</div>
                 
             
                 <div><ul>
<li>Up to 7.8x faster scene rendering performance with Maxon Redshift when compared to the 16-inch MacBook Pro with Intel Core i9, and up to 3.5x faster when compared to the 16-inch MacBook Pro with M1 Max.</li>
</ul>
</div>
                 
             
                 <div><ul>
<li>Up to 4.6x faster build performance when compiling code in Xcode when compared to the 16‑inch MacBook Pro with Intel Core i9, and up to 2.2x faster when compared to the 16‑inch MacBook Pro with M1 Max.</li>
</ul>
</div>
                 
             
                 <div><ul>
<li>Up to 30.8x faster video processing performance in Topaz Video AI when compared to the 16‑inch MacBook Pro with Intel Core i9, and up to 1.6x faster when compared to the 16-inch MacBook Pro with M1 Max.</li>
</ul>
</div>
                 
             
         </div>
 

    
    
    


    
    
        
        
        
            <div role="group" aria-label="gallery" data-component-list="MixinGallery" id="macbook-pro-m4-max-workflows">
            <nav role="presentation">
                <ul role="tablist">
                    
                        <li role="presentation">
                            <a id="gallery-dotnav-e7f3015f7a7b3c6c39f9c8f972852143" href="#gallery-e7f3015f7a7b3c6c39f9c8f972852143" data-ac-gallery-trigger="gallery-e7f3015f7a7b3c6c39f9c8f972852143"><span>Flame is shown on MacBook Pro with M4 Max.</span></a>
                        </li>
                    
                        <li role="presentation">
                            <a id="gallery-dotnav-51972600b23331ea62e5a7a7473b2cda" href="#gallery-51972600b23331ea62e5a7a7473b2cda" data-ac-gallery-trigger="gallery-51972600b23331ea62e5a7a7473b2cda"><span>LM Studio is shown on MacBook Pro with M4 Max.</span></a>
                        </li>
                    
                </ul>
            </nav>
            <div>
                
                    
                        
                        <div id="gallery-e7f3015f7a7b3c6c39f9c8f972852143" aria-labelledby="gallery-dotnav-e7f3015f7a7b3c6c39f9c8f972852143" data-gallery-item="">
                            <figure role="presentation" data-analytics-activitymap-region-id="Gallery:flame">
                                
                                <div>
                                    <div>With M4 Max, MacBook Pro rips through the heaviest creative workloads like visual effects, 3D animation, and film scoring.</div>
                                    
                                    
                                    <a href="https://www.apple.com/newsroom/images/2024/10/new-macbook-pro/article/Apple-MacBook-Pro-M4-Flame.zip" download="" data-analytics-title="download image - Apple-MacBook-Pro-M4-Flame_big" aria-label="Download media, Flame is shown on MacBook Pro with M4 Max."></a>
                                </div>
                            </figure>
                        </div>
                        
                    
                
                    
                        
                        <div id="gallery-51972600b23331ea62e5a7a7473b2cda" aria-labelledby="gallery-dotnav-51972600b23331ea62e5a7a7473b2cda" data-gallery-item="">
                            <figure role="presentation" data-analytics-activitymap-region-id="Gallery:lm-studio">
                                
                                <div>
                                    <div>With support for up to 128GB of unified memory, developers can easily interact with LLMs that have nearly 200 billion parameters.</div>
                                    
                                    
                                    <a href="https://www.apple.com/newsroom/images/2024/10/new-macbook-pro/article/Apple-MacBook-Pro-M4-LM-Studio.zip" download="" data-analytics-title="download image - Apple-MacBook-Pro-M4-LM-Studio_big" aria-label="Download media, LM Studio is shown on MacBook Pro with M4 Max."></a>
                                </div>
                            </figure>
                        </div>
                        
                    
                
            </div>
            
                
                
                <nav role="presentation">
                    
                        <ul>
                            <li>
                                
                            </li>
                            <li>
                                
                            </li>
                        </ul>
                    
                </nav>
            
        </div>
    


    
    
    


     
     
    
    
        <div>
             
                 <h2><strong>Industry-Leading Liquid XDR Display Gets Even Better</strong>
</h2>
                 
             
                 <div>The new MacBook Pro introduces an all-new nano-texture display option that dramatically reduces glare and distractions from reflections. In bright lighting conditions, the new MacBook Pro can now show SDR content at up to 1000 nits and still displays HDR content at up to 1600 nits of peak brightness. All together, it’s a game-changing experience for users working outdoors.
</div>
                 
             
         </div>
 

    
    
    






  
    
    
    
    
      <figure aria-label="Media, A user works on MacBook Pro outdoors in a field of vegetables.">
        <div>
             
              
              <div>
                A game changer when working outdoors, the Liquid Retina XDR display gets even better with an all-new nano-texture display option and up to 1000 nits of brightness for SDR content.
              </div>
            
            
            
            
            <a href="https://www.apple.com/newsroom/images/2024/10/new-macbook-pro/article/Apple-MacBook-Pro-M4-lifestyle-03.zip" download="" data-analytics-title="download image - Apple-MacBook-Pro-M4-lifestyle-03_big" aria-label="Download media, A user works on MacBook Pro outdoors in a field of vegetables."></a>
          </div>
      </figure>
    
  






    
    
    


     
     
    
    
        <div>
             
                 <h2><strong>New 12MP Center Stage Camera</strong>
</h2>
                 
             
                 <div>MacBook Pro includes a new 12MP Center Stage camera that delivers enhanced video quality in challenging lighting conditions. Video calls are even more engaging with Center Stage, which automatically keeps users centered in the frame as they move around. The new camera also supports Desk View, which adds a whole new dimension to video calls. And with studio-quality mics and a phenomenal six-speaker sound system with support for Spatial Audio, MacBook Pro delivers an incredibly immersive audio experience whether users are listening to music or watching a movie in Dolby Atmos.
</div>
                 
             
         </div>
 

    
    
    


    
    <div data-component-list="ScrollAnimationDefault AutoPlayVideo">
        <div>MacBook Pro features a new 12MP Center Stage camera, which keeps users centered in the frame, and supports Desk View, which adds a whole new dimension to video calls.</div>
        
            <a aria-label="Download video: MacBook Pro Video Call with Center Stage" data-analytics-title="Download video - MacBook Pro Video Call with Center Stage" download="" href="https://www.apple.com/newsroom/videos/videos-2024/autoplay/2024/10/apple-macbook-pro-m4-center-stage-camera/downloads/Apple-MacBook-Pro-M4-Center-Stage-camera.zip">
            </a>
        
    </div>






    
    
    


     
     
    
    
        <div>
             
                 <h2><strong>Thunderbolt 5 Comes to the Mac</strong>
</h2>
                 
             
                 <div>MacBook Pro with M4 Pro and M4 Max features Thunderbolt 5 ports that more than double transfer speeds up to 120 Gb/s, enabling faster external storage, expansion chassis, and powerful docking and hub solutions. For example, by connecting just a single cable, pros like music producers can now light up their entire studio. All MacBook Pro models feature an HDMI port that supports up to 8K resolution, a SDXC card slot, a MagSafe 3 port for charging, and a headphone jack, along with support for Wi-Fi 6E and Bluetooth 5.3.
</div>
                 
             
         </div>
 

    
    
    






  
    
    
    
    
      <figure aria-label="Media, A close-up of the keyboard on MacBook Pro and its Thunderbolt 5 ports with plugged-in peripherals.">
        <div>
             
              
              <div>
                MacBook Pro with M4 Pro and M4 Max now features Thunderbolt 5 with faster transfer speeds that enable powerful docking and hub solutions, allowing pros to connect to higher-bandwidth gear with a single cable.
              </div>
            
            
            
            
            <a href="https://www.apple.com/newsroom/images/2024/10/new-macbook-pro/article/Apple-MacBook-Pro-M4-connectivity.zip" download="" data-analytics-title="download image - Apple-MacBook-Pro-M4-connectivity_big" aria-label="Download media, A close-up of the keyboard on MacBook Pro and its Thunderbolt 5 ports with plugged-in peripherals."></a>
          </div>
      </figure>
    
  






    
    
    


     
     
    
    
        <div>
             
                 <h2><strong>A New Era with Apple Intelligence on the Mac</strong>
</h2>
                 
             
                 <div><a href="https://www.apple.com/newsroom/2024/10/apple-intelligence-is-available-today-on-iphone-ipad-and-mac/" target="_blank">Apple Intelligence</a> ushers in a new era for the Mac, bringing personal intelligence to the personal computer. Combining powerful generative models with industry-first privacy protections, Apple Intelligence harnesses the power of Apple silicon and the Neural Engine to unlock new ways for users to work, communicate, and express themselves on Mac. It is available in U.S. English with macOS Sequoia 15.1. With systemwide Writing Tools, users can refine their words by rewriting, proofreading, and summarizing text nearly everywhere they write. With the newly redesigned Siri, users can move fluidly between spoken and typed requests to accelerate tasks throughout their day, and Siri can answer thousands of questions about Mac and other Apple products. New Apple Intelligence features will be available in December, with additional capabilities rolling out in the coming months. Image Playground gives users a new way to create fun original images, and Genmoji allows them to create custom emoji in seconds. Siri will become even more capable, with the ability to take actions across the system and draw on a user’s personal context to deliver intelligence that is tailored to them. In December, ChatGPT will be integrated into Siri and Writing Tools, allowing users to access its expertise without needing to jump between tools.
</div>
                 
             
         </div>
 

    
    
    


    
    <div data-component-list="ScrollAnimationDefault AutoPlayVideo">
        <div>Apple Intelligence transforms the things users do every day on their Mac. With brand-new Writing Tools, users can rewrite, proofread, or summarize everything from daily emails to important projects.</div>
        
            <a aria-label="Download video: Apple Intelligence Writing Tools" data-analytics-title="Download video - Apple Intelligence Writing Tools" download="" href="https://www.apple.com/newsroom/videos/videos-2024/autoplay/2024/10/apple-macbook-pro-m4-writing-tools/downloads/Apple-MacBook-Pro-M4-Writing-Tools.zip">
            </a>
        
    </div>






    
    
    


     
     
    
    
        <div>
             
                 <div>Apple Intelligence does all this while protecting users’ privacy at every step. At its core is on-device processing, and for more complex tasks, Private Cloud Compute gives users access to Apple’s even larger, server-based models and offers groundbreaking protections for personal information. In addition, users can access ChatGPT for free without creating an account, and privacy protections are built in — their IP addresses are obscured and OpenAI won’t store requests. For those who choose to connect their account, OpenAI’s data-use policies apply.
</div>
                 
             
                 <h2><strong>An Unrivaled Experience with macOS Sequoia</strong>
</h2>
                 
             
                 <div><a href="https://www.apple.com/macos/macos-sequoia-preview/" target="_blank">macOS Sequoia</a> completes the new MacBook Pro experience with a host of exciting features, including iPhone Mirroring, allowing users to wirelessly interact with their iPhone, its apps, and notifications directly from their Mac.<sup>4</sup> Safari, the world’s fastest browser,<sup>5</sup> now offers Highlights, which quickly pulls up relevant information from a site; a smarter, redesigned Reader with a table of contents and high-level summary; and a new Video Viewer to watch videos without distractions. With Distraction Control, users can hide items on a webpage that they may find disruptive to their browsing. Gaming gets even more immersive with features like Personalized Spatial Audio and improvements to Game Mode, along with a breadth of exciting titles, including the upcoming Assassin’s Creed Shadows. Easier window tiling means users can stay organized with a windows layout that works best for them. The all-new Passwords app gives convenient access to passwords, passkeys, and other credentials, all stored in one place. And users can apply new beautiful built-in backgrounds for video calls, which include a variety of color gradients and system wallpapers, or upload their own photos.
</div>
                 
             
                 <h2><strong>The Perfect Time to Upgrade or Switch to a Mac</strong>
</h2>
                 
             
                 <div>Upgraders will get monumental improvements over Intel-based MacBook Pro models, including the amazing features of Apple Intelligence. When compared to an Intel-based MacBook Pro, the new MacBook Pro provides nearly 10x faster performance for AI-based workloads,<sup>1</sup> and for graphics-intensive workloads, users get up to 20x faster performance.<sup>6</sup> With battery life on the new MacBook Pro now up to 24 hours, upgraders will also experience up to 14 additional hours. And with the Liquid Retina XDR display, a new 12MP Center Stage camera, an immersive six-speaker sound system, the unrivaled experience of macOS Sequoia, and more, there’s never been a better time to upgrade or switch to MacBook Pro.
</div>
                 
             
                 <h2><strong>MacBook Air: The World’s Most Popular Laptop Now Starts at 16GB</strong>
</h2>
                 
             
                 <div>MacBook Air is the world’s most popular laptop, and with Apple Intelligence, it’s even better. Now, models with M2 and M3 double the starting memory to 16GB, while keeping the starting price at just $999 — a terrific value for the world’s best-selling laptop.
</div>
                 
             
                 <h2><strong>Better for the Environment</strong>
</h2>
                 
             
                 <div>The new MacBook Pro is built to last and incredibly durable, created from a custom alloy that uses 100 percent recycled aluminum in the enclosure. It also uses 100 percent recycled rare earth elements in all magnets, and 100 percent recycled tin soldering, gold plating, and copper in multiple printed circuit boards. The packaging for the 14-inch MacBook Pro is now entirely fiber-based, joining the 16-inch MacBook Pro and bringing Apple closer to its goal to remove plastic from its packaging by 2025.
</div>
                 
             
                 <div>Today, Apple is carbon neutral for global corporate operations and, as part of its ambitious Apple 2030 goal, plans to be carbon neutral across its entire carbon footprint by the end of this decade.
</div>
                 
             
         </div>
 

    
    
    


     
     
    
    
        <div>
             
                 
                 
             
                 <div><ul>
<li>Customers can pre-order the new MacBook Pro starting today, October 30, on <a href="https://www.apple.com/store/" target="_blank">apple.com/store</a> and in the Apple Store app in 28 countries and regions, including the U.S. It will begin arriving to customers, and will be in Apple Store locations and Apple Authorized Resellers, beginning Friday, November 8.</li>
</ul>
</div>
                 
             
                 <div><ul>
<li>The 14-inch MacBook Pro with M4 starts at <strong>$1,599</strong> (U.S.) and <strong>$1,499</strong> (U.S.) for education; the 14‑inch MacBook Pro with M4 Pro starts at <strong>$1,999</strong> (U.S.) and <strong>$1,849 </strong>(U.S.) for education; and the 16‑inch MacBook Pro starts at <strong>$2,499</strong> (U.S.) and <strong>$2,299 </strong>(U.S.) for education. All models are available in space black and silver.</li>
</ul>
</div>
                 
             
                 <div><ul>
<li>Additional technical specifications, including the nano-texture display and configure-to-order options, are available at <a href="https://www.apple.com/mac/" target="_blank">apple.com/mac</a>.</li>
</ul>
</div>
                 
             
                 <div><ul>
<li>MacBook Air with M2 and M3 comes standard with 16GB of unified memory, and is available in midnight, starlight, silver, and space gray, starting at <strong>$999</strong> (U.S.) and <strong>$899</strong> (U.S.) for education.</li>
</ul>
</div>
                 
             
                 <div><ul>
<li>New accessories with USB-C — including Magic Keyboard (<strong>$99 </strong>U.S.), Magic Keyboard with Touch ID (<strong>$149</strong> U.S.), Magic Keyboard with Touch ID and Numeric Keypad (<strong>$179</strong> U.S.), Magic Trackpad (<strong>$129 </strong>U.S.), Magic Mouse (<strong>$79</strong> U.S.), and Thunderbolt 5 Pro Cable (<strong>$69</strong>) — are available at <a href="https://www.apple.com/store/" target="_blank">apple.com/store</a>.</li>
</ul>
</div>
                 
             
                 <div><ul>
<li>Apple Intelligence is available now as a free software update for Mac with M1 and later, and can be accessed in most regions around the world when the device and Siri language are set to U.S. English. The first set of features is in beta and available with macOS Sequoia 15.1, with more features rolling out in the months to come.</li>
</ul>
</div>
                 
             
                 <div><ul>
<li>Apple Intelligence is quickly adding support for more languages. In December, Apple Intelligence will add support for localized English in <em>Australia</em>, <em>Canada</em>, <em>Ireland</em>, <em>New Zealand</em>, <em>South Africa</em>, and the <em>U.K.,</em> and in April, a software update will deliver expanded language support, with more coming throughout the year. Chinese, English (India), English (Singapore), French, German, Italian, Japanese, Korean, Portuguese, Spanish, Vietnamese, and other languages will be supported.</li>
</ul>
</div>
                 
             
                 <div><ul>
<li>With Apple Trade In, customers can trade in their current computer and get credit toward a new Mac. Customers can visit <a href="https://www.apple.com/shop/trade-in/" target="_blank">apple.com/shop/trade-in</a> to see what their device is worth.</li>
</ul>
</div>
                 
             
                 <div><ul>
<li>AppleCare+ for Mac provides unparalleled service and support. This includes unlimited incidents of accidental damage, battery service coverage, and 24/7 support from the people who know Mac best.</li>
</ul>
</div>
                 
             
                 <div><ul>
<li>Every customer who buys directly from Apple Retail gets access to Personal Setup. In these guided online sessions, a Specialist can walk them through setup, or focus on features that help them make the most of their new device. Customers can also learn more about getting started with their new device with a Today at Apple session at their nearest Apple Store.</li>
</ul>
</div>
                 
             
         </div>
 

    
    
    




    
    
        
    


    
    
    



    
    
    




    




    
    
    





    
    
    <div>
            <ol>
<li>Testing was conducted by Apple from August through October 2024. Battery life varies by use and configuration. See <a href="https://www.apple.com/macbook-pro/" target="_blank">apple.com/macbook-pro</a> for more information.</li>
<li>Testing was conducted by Apple in October 2024 using shipping competitive systems and select industry-standard benchmarks.</li>
<li>Based on published technical specifications of shipping competitive chips as of October 2024.</li>
<li>Available on Mac computers with Apple&nbsp;silicon and Intel-based Mac computers with a T2 Security Chip. Requires that the user’s iPhone and Mac are signed in with the same Apple&nbsp;Account using two-factor authentication, their iPhone and Mac are near each other and have Bluetooth and Wi-Fi turned on, and their Mac is not using AirPlay or Sidecar. Some iPhone features (e.g., camera and microphone) are not compatible with iPhone&nbsp;Mirroring.</li>
<li>Testing was conducted by Apple in August 2024. See <a href="https://www.apple.com/safari/" target="_blank">apple.com/safari</a> for more information.</li>
<li>Results are compared to previous-generation 1.7GHz quad-core Intel Core i7-based 13-inch MacBook&nbsp;Pro systems with Intel Iris Plus Graphics 645, 16GB of RAM, and 2TB SSD.</li>
</ol>

        </div>



    
    
    






    

















		
		
			
























		
		

</article>



</section>
</main>


	

</div>]]></description>
        </item>
        <item>
            <title><![CDATA[Internal representations of LLMs encode information about truthfulness (118 pts)]]></title>
            <link>https://arxiv.org/abs/2410.02707</link>
            <guid>41995201</guid>
            <pubDate>Wed, 30 Oct 2024 14:22:18 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://arxiv.org/abs/2410.02707">https://arxiv.org/abs/2410.02707</a>, See on <a href="https://news.ycombinator.com/item?id=41995201">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="content-inner">
    
    
                
    <p><a href="https://arxiv.org/pdf/2410.02707">View PDF</a>
    <a href="https://arxiv.org/html/2410.02707v3">HTML (experimental)</a></p><blockquote>
            <span>Abstract:</span>Large language models (LLMs) often produce errors, including factual inaccuracies, biases, and reasoning failures, collectively referred to as "hallucinations". Recent studies have demonstrated that LLMs' internal states encode information regarding the truthfulness of their outputs, and that this information can be utilized to detect errors. In this work, we show that the internal representations of LLMs encode much more information about truthfulness than previously recognized. We first discover that the truthfulness information is concentrated in specific tokens, and leveraging this property significantly enhances error detection performance. Yet, we show that such error detectors fail to generalize across datasets, implying that -- contrary to prior claims -- truthfulness encoding is not universal but rather multifaceted. Next, we show that internal representations can also be used for predicting the types of errors the model is likely to make, facilitating the development of tailored mitigation strategies. Lastly, we reveal a discrepancy between LLMs' internal encoding and external behavior: they may encode the correct answer, yet consistently generate an incorrect one. Taken together, these insights deepen our understanding of LLM errors from the model's internal perspective, which can guide future research on enhancing error analysis and mitigation.
    </blockquote>

    <!--CONTEXT-->
    
  </div><div>
      <h2>Submission history</h2><p> From: Hadas Orgad [<a href="https://arxiv.org/show-email/660cb3e9/2410.02707">view email</a>]      <br>            <strong><a href="https://arxiv.org/abs/2410.02707v1">[v1]</a></strong>
        Thu, 3 Oct 2024 17:31:31 UTC (2,525 KB)<br>
            <strong><a href="https://arxiv.org/abs/2410.02707v2">[v2]</a></strong>
        Mon, 7 Oct 2024 14:46:11 UTC (2,530 KB)<br>
    <strong>[v3]</strong>
        Mon, 28 Oct 2024 12:33:44 UTC (2,360 KB)<br>
</p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Thunderbird for Android Now Available (116 pts)]]></title>
            <link>https://blog.thunderbird.net/2024/10/thunderbird-for-android-8-0-takes-flight/</link>
            <guid>41995041</guid>
            <pubDate>Wed, 30 Oct 2024 14:11:44 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://blog.thunderbird.net/2024/10/thunderbird-for-android-8-0-takes-flight/">https://blog.thunderbird.net/2024/10/thunderbird-for-android-8-0-takes-flight/</a>, See on <a href="https://news.ycombinator.com/item?id=41995041">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
								<img src="https://blog.thunderbird.net/files/2024/10/blog-banner-TBfA.jpg" alt="featured post title image">
						<section>
												

				
<p>Just over two years ago, we <a href="https://blog.thunderbird.net/2022/06/revealed-thunderbird-on-android-plans-k9/">announced our plans</a> to bring Thunderbird to Android by taking K-9 Mail under our wing. The journey took a <a href="https://blog.thunderbird.net/2023/12/when-will-thunderbird-for-android-be-released/">little longer than we had originally anticipated</a> and there was a lot to learn along the way, but the wait is finally over! For all of you who have ever asked “when is Thunderbird for Android coming out?”, the answer is – today! We are excited to announce that the first stable release of Thunderbird for Android is out now, and we couldn’t be prouder of the newest, most mobile member of the Thunderbird family.</p>



<h2>Resources</h2>



<ul>
<li><strong>What’s New</strong>: <a href="https://support.mozilla.org/kb/new-thunderbird-android-version-8">https://support.mozilla.org/kb/new-thunderbird-android-version-8</a></li>



<li><strong>Detailed Release Notes:</strong> <a href="https://github.com/thunderbird/thunderbird-android/releases/tag/THUNDERBIRD_8_0">https://github.com/thunderbird/thunderbird-android/releases/tag/THUNDERBIRD_8_0</a></li>



<li><strong>Community Support Forum</strong>: Thunderbird for Android has its own home on the <a href="https://support.mozilla.org/en-US/products/thunderbird-android">official Mozilla Support (SUMO) forums</a>. Find the help you need to configure and use the newest Thunderbird from our community on a mobile friendly site.</li>



<li><strong>Import Settings:</strong> Whether you’re importing your information from K-9 Mail or Thunderbird on the desktop, transfer your information <a href="https://support.mozilla.org/en-US/kb/thunderbird-android-import">quickly and easily with our guide</a>.</li>



<li><strong>System Requirements</strong>: Thunderbird for Android runs on mobile devices running Android 5 and above.</li>



<li><strong>Platform Availability</strong>: Download Thunderbird for Android from the following places. Availability on F-Droid will be coming soon.


<ul>
<li><a href="https://play.google.com/store/apps/details?id=net.thunderbird.android&amp;referrer=utm_campaign%3Dandroid_release_appeal_2024%26utm_medium%3Dweb%26utm_source%3Dblog%26utm_content%3Dlink">Google Play Store</a></li>



<li><a href="https://github.com/thunderbird/thunderbird-android/releases/tag/THUNDERBIRD_8_0">GitHub Releases</a> (apk)</li>
</ul>



<ul>
<li>The <a href="https://thunderbird.net/mobile/">Thunderbird website</a> (on an Android device)</li>
</ul>
</li>



<li><strong>Get Involved:</strong> Thunderbird for Android thrives thanks to community support, and you can be part of the community! We are grateful to everyone who donates their skill and time to answer support questions, test releases, translate and more. <a href="https://blog.thunderbird.net/2024/09/contribute-to-thunderbird-for-android/">Find out all the ways to get in where you fit in.</a></li>



<li><strong>Support Us:</strong> We are 100% donor-supported. Your gift helps us develop new apps (like this one!), improve speed and stability, promote Thunderbird and software freedom, and provide downloads free-of-charge to millions. Donate on <a href="https://www.thunderbird.net/?form=tfa&amp;utm_campaign=android_release_appeal_2024&amp;utm_medium=web&amp;utm_source=blog.thunderbird.net&amp;utm_content=link">our webpage</a> or in the app.</li>



<li><strong>Suggest New Features:</strong> We know you have great ideas for future features. You can share them on Mozilla Connect, where community members can upvote and comment on them. Our team uses the feedback here to help shape our roadmap.</li>
</ul>



<h2>Thanks for Helping Thunderbird for Android Fly</h2>



<p>Thank you for being a part of the community and sharing this adventure on Android with us! We’re especially grateful to all of you who have helped us test the beta and release candidate images. Your feedback helped us find and fix bugs, test key features, and polish the stable release. We hope you enjoy using the newest Thunderbird, now and for a long time to come!</p>
				

			</section>
			

			
			</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Dropbox announces 20% global workforce reduction (393 pts)]]></title>
            <link>https://blog.dropbox.com/topics/company/an-update-from-drew</link>
            <guid>41994640</guid>
            <pubDate>Wed, 30 Oct 2024 13:42:52 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://blog.dropbox.com/topics/company/an-update-from-drew">https://blog.dropbox.com/topics/company/an-update-from-drew</a>, See on <a href="https://news.ycombinator.com/item?id=41994640">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>










<header>
    <div>
        <div>
            
            <figure>
                <div>
                    
                    
    

        

        
        
        <!--<sly data-sly-use.assetPath1x="com.dropbox.aem.common.models.utils.RewriterHelperModel"/>-->

        
        
        <!--<sly data-sly-test.scaledImagePath=""/>-->

		 <!--optimized image webp-->
        
        
        

        
        <!--<img data-sly-test.highRes="false"
                srcset=", /cms/content/dam/dropbox/blog/company/2023/glyphs/Dropbox_Glyph_grey_1200x628.jpg 2x"
                src="/cms/content/dam/dropbox/blog/company/2023/glyphs/Dropbox_Glyph_grey_1200x628.jpg"
                aria-hidden=""
                alt="1200x628"
                class=""
                data-sly-attribute.width="auto"
                data-sly-attribute.height="auto"
                data-sly-attribute.data-id=""
                data-aem-asset-id="8448f2b6-1123-45bd-9e1f-cb32e1e3daae:Dropbox_Glyph_grey_1200x628.jpg"
                data-trackable="true" />
        <img data-sly-test="true"
                src="/cms/content/dam/dropbox/blog/company/2023/glyphs/Dropbox_Glyph_grey_1200x628.jpg"
                aria-hidden="false"
                alt="1200x628"
                class=""
                data-sly-attribute.width="auto"
                data-sly-attribute.height="auto"
                data-sly-attribute.data-id=""
                data-aem-asset-id="8448f2b6-1123-45bd-9e1f-cb32e1e3daae:Dropbox_Glyph_grey_1200x628.jpg"
                data-trackable="true" />-->

	    
      <picture>
        <source media="(min-width: 800px)" srcset="https://aem.dropbox.com/cms/content/dam/dropbox/blog/company/2023/glyphs/Dropbox_Glyph_grey_1200x628.jpg/_jcr_content/renditions/Dropbox_Glyph_grey_1200x628.webp" fallbackimage="https://aem.dropbox.com/cms/content/dam/dropbox/blog/company/2023/glyphs/Dropbox_Glyph_grey_1200x628.jpg">
        <source media="(min-width: 480px)" srcset="https://aem.dropbox.com/cms/content/dam/dropbox/blog/company/2023/glyphs/Dropbox_Glyph_grey_1200x628.jpg/_jcr_content/renditions/Dropbox_Glyph_grey_1200x628.tablet.webp" fallbackimage="https://aem.dropbox.com/cms/content/dam/dropbox/blog/company/2023/glyphs/Dropbox_Glyph_grey_1200x628.jpg/_jcr_content/renditions/Dropbox_Glyph_grey_1200x628.tablet.webp">
        <source media="(min-width: 0px)" srcset="https://aem.dropbox.com/cms/content/dam/dropbox/blog/company/2023/glyphs/Dropbox_Glyph_grey_1200x628.jpg/_jcr_content/renditions/Dropbox_Glyph_grey_1200x628.mobile.webp" fallbackimage="https://aem.dropbox.com/cms/content/dam/dropbox/blog/company/2023/glyphs/Dropbox_Glyph_grey_1200x628.jpg/_jcr_content/renditions/Dropbox_Glyph_grey_1200x628.mobile.webp">
         <img loading="lazy" src="https://aem.dropbox.com/cms/content/dam/dropbox/blog/company/2023/glyphs/Dropbox_Glyph_grey_1200x628.jpg/_jcr_content/renditions/Dropbox_Glyph_grey_1200x628.webp" fallbackimage="https://aem.dropbox.com/cms/content/dam/dropbox/blog/company/2023/glyphs/Dropbox_Glyph_grey_1200x628.jpg" onerror="window.failedAttempts=0;this.setAttribute('src',this.getAttribute('fallbackimage'));window.failedAttempts++;if(window.failedAttempts == 1)this.onerror=null" aria-hidden="false" alt="1200x628" data-aem-asset-id="8448f2b6-1123-45bd-9e1f-cb32e1e3daae:Dropbox_Glyph_grey_1200x628.jpg" data-trackable="true" height="auto" width="auto">
        
      </picture>

    

                    
                </div>
                
            </figure>
            
        </div>
        <div data-color="coconut">
            <p>
                
                
                    <a href="https://blog.dropbox.com/topics/company">Company</a>
                
            </p>
            
            
            <p>Published on
                October 30, 2024
            </p>
            <!-- <p data-sly-test="" class="b01-article-hero-plank__photographer"></p> -->
        </div>
    </div>
</header>
</div><div data-highlight="cloud">

<p><i>Today, our cofounder and CEO Drew Houston shared the difficult news that we’ll be making reductions to our global workforce. He sent the following email to all employees:<br>
&nbsp;</i></p>
<p>Hi everyone,</p>
<p>I’m writing to let you all know that after careful consideration, we've decided to reduce our global workforce by approximately 20% or 528 Dropboxers.</p>
<p>As CEO, I take full responsibility for this decision and the circumstances that led to it, and I’m truly sorry to those impacted by this change.</p>
<h3>Why we're making this decision</h3>
<p>As we've shared over the last year, we're in a transitional period as a company. Our FSS business has matured, and we've been working to build our next phase of growth with products like Dash. However, navigating this transition while maintaining our current structure and investment levels is no longer sustainable.</p>
<p>We continue to see softening demand and macro headwinds in our core business. But external factors are only part of the story. We’ve heard from many of you that our organizational structure has become overly complex, with excess layers of management slowing us down.</p>
<p>And while I'm proud of the progress we’ve made in the last couple years, in some parts of the business, we’re still not delivering at the level our customers deserve or performing in line with industry peers. So we're making more significant cuts in areas where we're over-invested or underperforming while designing a flatter, more efficient team structure overall.</p>
<h3>The opportunity ahead</h3>
<p>The changes we're making today, while difficult, come at a pivotal moment when the market is accelerating precisely where we've placed our biggest bets. It's been tremendously rewarding over the last few weeks to see customers and prospects light up when using Dash for Business for the first time, much like people did when we first launched Dropbox.&nbsp;</p>
<p>And this time we're starting from a position of strength. Millions of customers trust us as the home for their most important files, making the leap to organizing all their cloud content a natural evolution.</p>
<p>But we're not operating on our own schedule. This market is moving fast and investors are pouring hundreds of millions of dollars into this space. This both validates the opportunity we've been pursuing and underscores the need for even more urgency, even more aggressive investment, and decisive action.</p>
<p>The steps we’re taking today are necessary to both strengthen our core product and accelerate the growth of our new products. We’ll share more about our 2025 strategy in the days ahead.</p>
<h3>Taking care of impacted employees</h3>
<p>To those leaving Dropbox, we're committed to supporting you through this transition. You’ll be eligible to receive the following benefits and support:</p>
<p><b>Severance, equity, and transition payment&nbsp;</b></p>
<ul>
<li>All impacted employees will be eligible for sixteen weeks of pay, starting today, with one additional week of pay for each completed year of tenure at Dropbox. Internationally, severance packages will vary depending on regional practices and statutory requirements.</li>
<li>All impacted employees will receive their Q4 equity vest.</li>
<li>Those on the Corporate Bonus plan will be eligible to receive a pro-rated lump sum transition payment equivalent to their 2024 bonus target based on company performance forecasts and aligned with their level.</li>
<li>We will pay out eligible remaining current and approved upcoming paid leaves, including medical or family leaves.</li>
<li>We will support impacted visa holders by providing additional time to transition and access to 1:1 immigration consultation.</li>
</ul>
<p><b>Healthcare and benefits</b></p>
<ul>
<li>US employees will be eligible for up to six months of COBRA.</li>
<li>Canada-based employees will be eligible for a one-month healthcare extension.</li>
<li>All employees will continue to have access to Modern Health to support their mental well-being.</li>
</ul>
<p><b>Devices</b></p>
<ul>
<li>Impacted employees will be eligible to keep company devices (phones, tablets, laptops, and peripherals) for personal use.</li>
</ul>
<p><b>Job placement</b></p>
<ul>
<li>Job placement services and career coaching will be available at no cost.</li>
</ul>
<h3>Next steps</h3>
<p>We'll be sharing more details on high-level changes later today and will host company-wide Town Halls later this week to answer questions and discuss our plans in more detail.</p>
<p>I know this is incredibly difficult and unwelcome news. To everyone leaving Dropbox, I’m deeply grateful for everything you've done for our company and our customers.</p>
<p>Drew</p>

</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Gross Apple Marketing (220 pts)]]></title>
            <link>https://jonathanbuys.com/Gross_Apple_Marketing/</link>
            <guid>41994567</guid>
            <pubDate>Wed, 30 Oct 2024 13:33:07 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://jonathanbuys.com/Gross_Apple_Marketing/">https://jonathanbuys.com/Gross_Apple_Marketing/</a>, See on <a href="https://news.ycombinator.com/item?id=41994567">Hacker News</a></p>
<div id="readability-page-1" class="page"><article>
	    <h3>Gross Apple Marketing</h3>
	    <time datetime="2024-10-29T15:47:31+00:00" pubdate="pubdate">October 29, 2024</time>

		<p>I’m not sure what’s going on over in Cupertino for them to think that <em>any</em> of the recent Apple Intelligence ads they’ve been running are a good idea. They’re cringy at best, and honestly just flat out insulting.</p>

<p>In one a <a href="https://www.youtube.com/watch?v=3m0MoYKwVTM">schlub writes an email</a> to his boss and uses AI to make it sound ‘more professional’, in another a young woman uses it to <a href="https://www.youtube.com/watch?v=TPe8revsg3k">lie about remembering an acquaintance’s name</a>. In another the same young woman again uses it to <a href="https://www.youtube.com/watch?v=_eJy6QyHaFM">lie about reading an email</a> from a college, to her face, while she’s sitting with her. In yet another, <a href="https://blog.blankbaby.com/2024/10/apple-intelligence-smug-and-gross.html">linked to recently by Scott McNulty</a>, a woman uses AI to lie to her husband about getting him something for his birthday.</p>

<p>If this is what Apple thinks their AI is for, I honestly don’t know that I want any part of it.</p>

<p>Compare and contrast with the <a href="https://jonathanbuys.com/Scout/">video I posted yesterday</a>, and with this beautiful animation from Canonical.</p>

<p>
<iframe src="https://www.youtube.com/embed/q5yM4ZYwB_s?si=u4GcyOGtdR1QztNe" frameborder="0" allowfullscreen=""></iframe>
</p>

<p>I’ve watched that little animation several times, and they tell a better story in a minute twenty-five than all of Apple’s AI commercials combined.</p>

	</article></div>]]></description>
        </item>
        <item>
            <title><![CDATA[EPA cancels pesticide shown to be harmful to unborn babies (140 pts)]]></title>
            <link>https://www.thenewlede.org/2024/10/epa-cancels-pesticide-shown-to-be-harmful-to-unborn-babies/</link>
            <guid>41993832</guid>
            <pubDate>Wed, 30 Oct 2024 11:41:21 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.thenewlede.org/2024/10/epa-cancels-pesticide-shown-to-be-harmful-to-unborn-babies/">https://www.thenewlede.org/2024/10/epa-cancels-pesticide-shown-to-be-harmful-to-unborn-babies/</a>, See on <a href="https://news.ycombinator.com/item?id=41993832">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>

                                        
<p>Citing a need to protect the unborn babies of pregnant women, the US Environmental Protection Agency (EPA) on Tuesday banned a pesticide used to kill weeds on farms, golf courses and athletic fields.</p>



<p>The action comes after years of mounting scientific evidence of the dangers posed by exposure to the chemical dimethyl tetrachloroterephthalate, also known as DCPA or Dacthal. &nbsp;</p>



<p>“With the final cancellation of DCPA, we’re taking a definitive step to protect pregnant women and their unborn babies,” Michal Freedhoff, assistant administrator for the EPA Office of Chemical Safety and Pollution Prevention, said in a press release. “The science showing the potential for irreversible harm to unborn babies’ developing brains, in addition to other lifelong consequences from exposure, demands decisive action to remove this dangerous chemical from the marketplace.”</p>
<p>The agency said “robust studies” demonstrated “thyroid toxicity,” and said that unborn babies whose pregnant mothers are exposed to DCPA could experience changes to fetal thyroid hormone levels. Such changes are “generally linked to low birth weight, impaired brain development, decreased IQ, and impaired motor skills later in life, some of which may be irreversible,” the EPA said.</p>
<p>DCPA was registered to control weeds in both agricultural and non-agricultural settings, but has largely been used to control weeds in fields growing crops such as broccoli, brussels sprouts, cabbage and onions.</p>



<p>The EPA action comes after&nbsp;<a href="https://www.epa.gov/pesticides/dcpa-dacthal-technical-herbicide-product-suspended-epa" target="_blank" rel="noreferrer noopener">years of research and smaller moves</a>&nbsp;by the EPA to limit the impact of DCPA on public health.&nbsp;In April, the <a href="https://www.thenewlede.org/2024/04/concerned-about-developing-babies-epa-warns-about-danger-of-weed-killer-used-on-farms-golf-courses/" target="_blank" rel="noreferrer noopener">agency issued a rare warning</a>&nbsp;that the pesticide posed “serious, permanent and irreversible health risks,” especially to farmworkers involved in tasks such as transplanting, weeding and harvesting after the pesticide has been applied.</p>



<p>In August, the EPA issued an&nbsp;“<a href="https://www.epa.gov/newsreleases/epa-issues-emergency-order-stop-use-pesticide-dacthal-address-serious-health-risk-4" target="_blank" rel="noreferrer noopener">emergency suspension</a>” of the chemical, marking the first time in almost 40 years the agency took such an emergency action. The agency said that, following the suspension, it received a letter from AMVAC Chemical Corporation, the sole manufacturer of DCPA, stating its intent to voluntarily cancel pesticide products containing DCPA sold in the US. AMVAC later said it would also cancel all international registrations.&nbsp;&nbsp;</p>
<p>The EPA cancellation prohibits anyone from distributing or selling DCPA pesticide products and bars anyone from using existing supplies.&nbsp;</p>
<p>(Featured photo by <a href="https://unsplash.com/@jorbrain">Jordan González</a> for&nbsp;<a href="https://unsplash.com/plus?referrer=%2Fphotos%2Fa-couple-of-people-that-are-sitting-in-the-grass-jVq0I80khBs" rel="nofollow">Unsplash+</a>)</p>

            
        </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Classic 3D videogame shadow techniques (242 pts)]]></title>
            <link>https://30fps.net/pages/videogame-shadows/</link>
            <guid>41993012</guid>
            <pubDate>Wed, 30 Oct 2024 08:49:54 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://30fps.net/pages/videogame-shadows/">https://30fps.net/pages/videogame-shadows/</a>, See on <a href="https://news.ycombinator.com/item?id=41993012">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="text">

<p>Towards the end of Wim Wenders’s excellent <em>Perfect Days</em>, the protagonist Hirayama is drinking beer under a bridge after he has seen a Businessman courting his crush. Suddenly the Businessman joins him under the bridge. As it turns out, things aren’t actually that simple but the point is their conversation takes them to some fundamental questions:</p>
<blockquote>
<p><strong>Businessman:</strong> Shadows. Do they get darker when they overlap?<br> <strong>Hirayama:</strong> Not sure.<br> <strong>Businessman:</strong> So many things I still don’t know… That’s how life ends… I guess.<br> <strong>Hirayama:</strong> Let’s find out now.<br> <strong>Businessman:</strong> What?<br></p>
</blockquote>
<p>Then they step into to the light of a street lamp and investigate their shadows (<a href="https://www.youtube.com/watch?v=C6cdPxQjHb0">the full scene</a>):</p>
<figure>
<img src="https://30fps.net/pages/videogame-shadows/Perfect_Days_shadows.jpg" alt=""><figcaption>An iconic scene in <em>Perfect Days</em> (2023). Still via <a href="https://film-grab.com/2024/04/12/perfect-days/">film-grabs.com</a>.</figcaption>
</figure>
<p>Even though the Businessman sees no difference, Hirayama is convinced the overlapping shadows <em>do</em> become darker. “It has to get darker to make sense.” What a moving scene.</p>
<figure>
<img src="https://30fps.net/pages/videogame-shadows/metalgear-crop.jpg">
<figcaption>
Shadows do become darker when<br>they overlap in Metal Gear Solid.
</figcaption>
</figure>
<p>Unfortunately Hirayama is mistaken. Shadows don’t get any darker there. There’s just one light source, and relatively far away, so the shadow is simply an absence of light. It doesn’t matter how many times the light is blocked.</p>
<p>When it comes to 3D videogames, shadows are something else. It’s easy to paint dark blob under some character’s feet and assume everything else is lit. Perhaps Hirayama was recalling the blob shadow in <em>Metal Gear Solid</em> that <em>does</em> become darker when it overlaps with others?</p>
<p>In the real world, shadows simply exist but in games they are both engineered and designed. They must run well but also look good. I find this relationship fascinating and I’m going to show you why. Let’s start simple.</p>

<h2 id="on-screen-2d-shadows">On-screen 2D shadows</h2>
<p>You can draw a shadow image to the screen before you draw a character. I’m not talking about shadow sprites <a href="https://www.mobygames.com/game/365/duke-nukem-3d/screenshots/dos/700154/">like in Duke Nukem 3D</a> but literally a 2D image without any scaling. This works if the character is in front of everything like in <em>Winter Gold</em> or <em>MDK</em>.</p>
<figure>
<img src="https://30fps.net/pages/videogame-shadows/16539773-winter-gold-snes-downhill-crop.png"> <img src="https://30fps.net/pages/videogame-shadows/10559518-mdk-dos-that-spaceship-is-deploying-a-lot-of-troops-crop.jpg">
<figcaption>
Winter Gold (1996, SNES) and MDK (1996, PC) draw animated 2D shadow images. Also check out Winter&nbsp;Gold’s <a href="https://www.youtube.com/watch?v=-Pr909aVsNo">sick Amiga-style intro video</a> :)
</figcaption>
</figure>
<p>I said it was simple.</p>
<h2 id="blob-shadow">Blob shadow</h2>
<p>OK now in 3D. Draw a dark disc under the character. Done.</p>
<p>Well, you should also align the shadow disc with the ground and also decide how to handle situations where the shadow would reach over a ledge. For example in <em>Super Mario 64</em>, the blobs are drawn using a special hardware feature that effectively clips the shadow to show up only on the ground plane.</p>
<figure>
<img src="https://30fps.net/pages/videogame-shadows/sm64_blob2.jpg"> <img src="https://30fps.net/pages/videogame-shadows/sm64_shadow_decal2.jpg"> <img src="https://30fps.net/pages/videogame-shadows/sm64_blobs.jpg">
<figcaption>
Super Mario 64 (1996, Nintendo 64) uses blob shadows for characters.<br> <strong>Left:</strong> A blob shadow overlapping with tree shadows. <strong>Center:</strong> A blob shadow getting clipped using a hardware decal feature. <strong>Right:</strong> All moving characters and objects have their own shadow. The clipped shadow inside that transparent bubble shows the limitation of the Nintendo 64 decal feature. Screenshots taken in the <a href="https://ares-emu.net/">ares</a> emulator.
</figcaption>
</figure>
<p>The blob shadow can also be animated. In Super Mario 64 it becomes smaller when jumping and <a href="https://youtu.be/F2sEmf_HzGI?t=3793">in <em>Metal Gear Solid</em> it changes shape</a>. If you’re feeling ambitious, you can also solve the shadow-over-a-ledge issue by <a href="http://blog.wolfire.com/2009/06/how-to-project-decals/">projecting the blob quad like a decal</a>.</p>
<h2 id="planar-shadows-with-a-render-texture">Planar shadows with a render texture</h2>
<p>The blob is just a texture and usually textures can be rendered to at runtime. So render the character from the top and use that instead of a dark circle. This works great in <em>Crash 3</em> (<a href="https://youtu.be/HG-NRnGp3RA?t=267">video</a>) but not so well in <em>Soldier of Fortune</em> because they kept the shadow resolution so low.</p>
<figure>
<img src="https://30fps.net/pages/videogame-shadows/16310901-crash-bandicoot-warped-playstation-c-boxes-allow-you-to-restart-crop2.png"> <img src="https://30fps.net/pages/videogame-shadows/soldieroffortune.jpg">
<figcaption>
<strong>Left:</strong> Crash Bandicoot: Warped (1998, PlayStation) renders shadow textures at runtime. <strong>Right:</strong> Soldier of Fortune (2000, PC) also does but at a lower resolution. A cropped still from <a href="https://www.youtube.com/watch?v=wq82etLV0a8">a video by FirstPlays HD</a>.
</figcaption>
</figure>
<p>Note that this is distinct from <a href="https://learnopengl.com/Advanced-Lighting/Shadows/Shadow-Mapping">shadow mapping</a> where a depth map is rendered from the light’s point of view. Here we render only a black &amp; white image that is used as a texture. So in a sense we’re talking about a 1-bit shadow map.</p>
<p>How could we make the shadows sharper?</p>
<h2 id="planar-shadows-with-geometry">Planar shadows with geometry</h2>
<figure>
<img src="https://30fps.net/pages/videogame-shadows/f19-stealth-fighter-back.png">
<figcaption>
The F-117A plane casts a shadow in<br> <em>F-19 Stealth Fighter</em> (1988, DOS).
</figcaption>
</figure>
<p>One intuitive option is to flatten a shadow caster on a plane by projecting it away from the light. Then render it the second time but now in black. They are usually kept opaque to hide how object parts are drawn on top of another. Naturally the shadow will be correct only on a flat floor.</p>
<p>Some early flight simulators draw a top-down flat shadow when on a runway. During my research I expected to see examples where the shadow is also seen when in flight but couldn’t find any.</p>

<figure>
<img src="https://30fps.net/pages/videogame-shadows/kingpin.jpg"> <img src="https://30fps.net/pages/videogame-shadows/half-life-shadows1.jpg">
<figcaption>
<a href="https://quakewiki.org/wiki/GLQuake">GLQuake’s</a> planar shadows in two games. <strong>Left:</strong> <em>Kingpin: Life of Crime</em> (1999, PC) gets away with black planar shadows. <strong>Right:</strong> Shadows exhibit transparency issues in <a href="https://www.moddb.com/downloads/half-life-1-alpha-052"><em>Half-Life</em> alpha 0.52</a>. Screenshot taken via Wine on Linux.
</figcaption>
</figure>
<p>Visually these look the same as black stencil shadows cast on a flat plane.</p>
<h3 id="shadows-on-terrain">Shadows on terrain</h3>
<figure>
<img src="https://30fps.net/pages/videogame-shadows/virus.png">
<figcaption>
Virus (1987) Atari ST port. The little ship casts<br> a neat drop shadow.
</figcaption>
</figure>
<p>David Braben’s 1987 <a href="https://www.youtube.com/watch?v=MNXypBxNGMo"><em>Virus</em></a> on Acorn Archimedes and other home computers draws spaceships that cast top-down shadows on terrain.</p>
<p>A more elaborate example is <em>Interstate ’76</em>. There they tilt and stretch a planar shadow to match the ground slope. The shadows <a href="https://30fps.net/pages/videogame-shadows/interstate76_shadow_inside_terrain.jpg">occasionally penetrate the ground</a> but are pretty convincing overall. Interestingly, the below software-rendered screenshot has slightly transparent shadows while the hardware accelerated ones are pitch black.</p>
<p>They also had the courage to try to <a href="https://youtu.be/9UyOuqsvs64?t=52">project shadows for large objects like bridges</a> which isn’t, well, entirely successful.</p>
<figure>
<img src="https://30fps.net/pages/videogame-shadows/interstate-76.png" alt=""><figcaption>Interstate ’76 (1997, PC) has sun casting tilted planar shadows on terrain.</figcaption>
</figure>
<p>But how do you cast shadows on any kind of scene?</p>
<h2 id="projected-texture-drop-shadow">Projected texture drop shadow</h2>
<figure><a id="projected-texture-drop-shadow">
<img src="https://30fps.net/pages/videogame-shadows/dropshadow_ownby_2010.jpg"> <img src="https://30fps.net/pages/videogame-shadows/buzzjump.jpg">
</a><figcaption><a id="projected-texture-drop-shadow">
<strong>Left:</strong> A slide from the deck </a><a href="https://advances.realtimerendering.com/s2010/Ownby,Hall%20and%20Hall%20-%20Toystory3%20(SIGGRAPH%202010%20Advanced%20RealTime%20Rendering%20Course).pdf"><em>Toy Story 3: The Video Game Rendering Techniques</em></a>. <br><strong>Right:</strong> The drop shadow gets darker when it overlaps with other shadows. A still from <a href="https://www.youtube.com/watch?v=_8fa81Spo3s">an Xbox 360 gameplay video</a> of <em>Toy Story 3: The Video Game</em> (2010).
</figcaption>
</figure>
<p>This approach bears a lot of similarity to <em>Planar shadows with a render texture</em> presented earlier but works on surfaces of any shape. The game renders a shadow texture from the top but instead of showing it on a flat plane, the <a href="https://paroj.github.io/gltut/Texturing/Tut17%20Projective%20Texture.html">texture is projected</a> to other objects. Think of it as the <a href="https://en.wikipedia.org/wiki/Bat-Signal">Bat-Signal</a> but pointed straight down from the sky.</p>
<p>Shadows like this can be made really sharp but they can look strange on vertical surfaces and occassionally even appear on the ceiling. See this <a href="https://youtu.be/EU4CbUoPBi4?t=752">gameplay video of <em>Sonic Adventure 2: Battle</em></a> (2001, GameCube).</p>
<p>This technique also works great for trees:</p>
<figure>
<img src="https://30fps.net/pages/videogame-shadows/12333235-the-elder-scrolls-iv-oblivion-xbox-360-the-speedtree-engine-at-w.jpg" alt=""><figcaption>The Elder Scrolls IV: Oblivion (2006, Xbox 360) has beautiful projected tree shadows.</figcaption>
</figure>
<p>Projected shadows can show through objects which makes them suitable only for special cases. Shadow maps are something you can use anywhere.</p>
<h2 id="shadow-maps">Shadow maps</h2>
<p>The de facto approach to shadows. The game draws a depth image, the shadow map, from the point of view of the light and reads from that image when rendering the world. This is easy to do since you can reuse the game engine’s regular rendering code.</p>
<figure>
<img src="https://30fps.net/pages/videogame-shadows/hl2_2004_shadows.jpg" alt=""><figcaption><em>Half-Life 2 (2004, PC)</em> used shadow maps for characters. Dynamic flashlight shadows (not shown) were added in the 2007 <em>Episode Two</em> expansion.</figcaption>
</figure>
<p>The limited resolution of the shadow map gives rise to well-known artifacts with <a href="https://learn.microsoft.com/en-us/windows/win32/dxtecharts/common-techniques-to-improve-shadow-depth-maps#shadow-acne-and-erroneous-self-shadowing">inventive names such as “Peter Panning” and “shadow acne”</a>. Many tricks have been proposed to allocate more shadow map area to surfaces near the camera where the extra resolution is needed the most. Shadow maps usually need some tweaking to look right.</p>
<p>Before shadow maps became dominant, there was a popular competitor.</p>
<h2 id="stencil-shadows">Stencil shadows</h2>
<p>The has-been approach to shadows. Stencil shadows draw sharp shadows on any kind of surface. They create a unique film-noir look that’s hard to emulate with shadow maps. Most well-known example is of course <em>Doom 3</em> with its dark rooms:</p>
<figure>
<img src="https://30fps.net/pages/videogame-shadows/Doom3snap4.jpg" alt=""><figcaption>Doom 3 (2004) had no static level lighting and all shadows were computed at runtime. Screenshot from <a href="http://warp.povusers.org/doom3snapshots/"><em>Doom 3 shadow engine snapshots</em></a>.</figcaption>
</figure>
<p>Stencil shadows are based on the idea of <em>shadow volumes</em>, invisible geometry that cuts the world into lit and shadowed spaces. The game applies lighting only on pixels that don’t lie inside a shadow volume.</p>
<figure>
<img src="https://30fps.net/pages/videogame-shadows/Shadow_volume_illustration.png" alt=""><figcaption>The game needs to construct “shadow volume” meshes shown in yellow. Surfaces inside the volumes stay unlit. <a href="https://commons.wikimedia.org/wiki/File:Shadow_volume_illustration.png">Shadow volume illustration</a> by Rainwarrior, CC BY-SA 3.0.</figcaption>
</figure>
<p>Stencil shadows need the world to be drawn many times to work. Simplified a bit, the game first draws the whole world with ambient lighting. Then for each light, all the shadow volumes, followed by the world again, affecting only unshadowed pixels. The volumes are drawn with different <a href="https://learnopengl.com/Advanced-OpenGL/Stencil-testing"><em>stencil operations</em></a> set <a href="https://registry.khronos.org/OpenGL-Refpages/gl4/html/glStencilOpSeparate.xhtml">for front and back faces</a>. It’s a lot of pixels to draw.</p>
<p>Possibly the earliest shipping game with stencil shadows is <em>Severance: Blade of Darkness</em> from 2001 whose shadows <a href="https://youtu.be/irwzEDLZ2gk?t=417">look great</a>.</p>
<figure>
<img src="https://30fps.net/pages/videogame-shadows/11323681-blade-of-darkness-windows-blade-was-also-well-known-for-its-wond-edit.jpg" alt=""><figcaption>Severance: Blade of Darkness (2001, PC) had stencil shadows.</figcaption>
</figure>
<p>Reading the <a href="https://30fps.net/pages/videogame-shadows/blade_of_darkness_edge_review.jpg">Edge UK edition March 2001 review</a> (<a href="https://retrocdn.net/images/2/2d/Edge_UK_095.pdf">pdf</a>) of the game makes it clear that despite the graphics advancements, the world wasn’t ready for a soulslike back then.</p>
<p>Stencil shadows are not used much nowadays. One reason is their unpredictable runtime cost. The cost is dependent on how large the volume is on screen and therefore varies a lot. Also an <a href="https://en.wikipedia.org/wiki/Shadow_volume#Depth_fail">optimized algorithm</a> was patented. For Doom 3, <a href="https://web.archive.org/web/20100131044756/http://techreport.com/discussions.x/7113">Id Software apparently reached</a> some sort of <a href="https://web.archive.org/web/20090818013827/http://www.theinquirer.net/inquirer/news/1019517/creative-background-doom-iii-shadow-story">a deal</a>.</p>
<h3 id="soft-stencil-shadows">Soft stencil shadows</h3>
<figure>
<img src="https://30fps.net/pages/videogame-shadows/silent_hill_2_shadows1_crop2.jpg"> <img src="https://30fps.net/pages/videogame-shadows/silenthill2_color_buffer.png"> <img src="https://30fps.net/pages/videogame-shadows/silenthill2_shadow_buffer.png">
<figcaption>
<strong>Left:</strong> Silent Hill 2 (2001, PlayStation 2) has soft stencil shadows. <strong>Center:</strong> 2x zoomed crop. <strong>Right:</strong> A shadow debug view with unlit areas colored black. <a href="https://imgsli.com/MzExMjcy/">Screenshots</a> from the PCSX2 emulator lightened up for visualization.
</figcaption>
</figure>
<p>Stencil shadows don’t need to be sharp. Another game from 2001, <em>Silent Hill 2</em> on the PlayStation 2, blurred the stencil shadows afterwards as seen above. <a href="https://youtu.be/nna2yt1c9gI?t=354">It looks pretty much perfect</a> on the console.</p>
<h2 id="simplified-character-shadows">Simplified character shadows</h2>
<p>What if the shadows are cast by a simpler model than what’s shown on screen? For example in Zelda on the Nintendo 64, Link’s feet cast shadows even though nothing else does:</p>
<figure>
<img src="https://30fps.net/pages/videogame-shadows/15709360-the-legend-of-zelda-ocarina-of-time-nintendo-64-in-zoras-domain.jpg" alt=""><figcaption>The Legend of Zelda: Ocarina of Time (1998, Nintendo 64) has Link’s feet cast shadows as if they were tall vertical cylinders. I presume the shadows are two stretched decals.</figcaption>
</figure>
<p>One unique approach is seen in <em>Hyperblade</em> where players on a futuristic hockey arena cast planar shadows as simple animated shapes.</p>
<figure>
<img src="https://30fps.net/pages/videogame-shadows/hyperblade.png" alt=""><figcaption>Hyperblade (1996, PC) projects a simplified planar shadow that moves. It’s not perfect as seen in the rightmost image. Stills from a <a href="https://youtu.be/EpScHKYEEpE?t=43">video by Bit Games Reviews</a>.</figcaption>
</figure>
<h2 id="shadows-in-static-level-lighting">Shadows in static level lighting</h2>
<p>Vertex colors and lightmaps are techniques to capture lighting of a game level. They have been used in many games as the only way to show large scale shadows, which is why I’ve included them here.</p>
<h3 id="vertex-colors">Vertex colors</h3>
<p><em>Ico</em> shows how sophisticated shadows can look with just old school per-vertex lighting.</p>
<figure>
<img src="https://30fps.net/pages/videogame-shadows/ico.jpg" alt=""><figcaption>Ico (2001, PlayStation 2) has level lighting baked to vertex colors. For characters <a href="https://youtu.be/QCOAqyOE_V4?t=438">it uses stencil shadows</a>.</figcaption>
</figure>
<p>For low-poly maps even sharp shadows can be represented with vertex colors. A prime example is <em>Tony Hawk Pro Skater 2</em> (2000, Playstation) which looks amazing considering the simplicity of the technique.</p>
<figure>
<img src="https://30fps.net/pages/videogame-shadows/thps-2-dreamcast-venice-beach-1.jpg" alt=""><figcaption>“Venice Beach” level in Tony Hawk Pro Skater 2 (2000, PlayStation) with its sharp vertex color shadows. This shot is from the Dreamcast port.</figcaption>
</figure>
<h3 id="lightmaps">Lightmaps</h3>
<p>Lightmaps are the classic way to store level lighting and shadows. Instead of storing a color for each vertex, there’s a second set of textures that represent only lighting. The resolution can vary per area, making the shadows more accurate where needed. On the other hand, lightmaps consume more memory than vertex colors.</p>
<figure>
<img src="https://30fps.net/pages/videogame-shadows/11192353-mirrors-edge-windows-training-grounds-crop.jpg" alt=""><figcaption>Mirror’s Edge (2008, PC) is basically Lightmaps: The Game.</figcaption>
</figure>
<p>Lightmaps were popularized by <em>Quake</em> (1996, PC) and <a href="https://jbush001.github.io/2015/06/11/quake-lightmaps.html">this is how they look</a>.</p>
<p>That concludes our look into traditional shadow techniques. Let’s talk a bit about lighting in general next.</p>
<h2 id="shadows-in-modern-games">Shadows in modern games</h2>
<p>Modern games use the traditional techniques when appropriate. Some examples:</p>
<ul>
<li>Variants of <strong>shadow mapping</strong> such as <a href="https://learnopengl.com/Guest-Articles/2021/CSM">Cascaded Shadow Maps</a> to cover large areas while still staying fast.</li>
<li><strong>Lightmaps</strong> in combination with other techniques such as <a href="https://computergraphics.stackexchange.com/a/244">light probes</a>. <em>Call of Duty</em> <a href="https://30fps.net/pages/videogame-shadows/CoD_Hemispheres_Presentation_Notes_p6.jpg">still has lightmaps</a>, see the <a href="https://advances.realtimerendering.com/s2024/content/Roughton/SIGGRAPH%20Advances%202024%20-%20Hemispheres%20Presentation%20Notes.pdf">Hemispherical Lighting Insights</a> slides.</li>
<li>The <strong>simplified character model idea</strong>. <em>The Last of Us</em> (2013, PlayStation 3) casts soft character shadows with stretched spheres. See <a href="https://30fps.net/pages/videogame-shadows/tlou1.jpg">this slide</a> of the deck <a href="http://miciwan.com/SIGGRAPH2013/Lighting%20Technology%20of%20The%20Last%20Of%20Us.pdf">Lighting Technology of The Last Of Us (2013)</a>. Also Unreal Engine supports simplified <a href="https://dev.epicgames.com/documentation/en-us/unreal-engine/capsule-shadows-overview-in-unreal-engine">“capsule shadows”</a> for characters.</li>
<li><strong>Projected shadows</strong>. In <em>Hot Wheels Track Attack</em>&nbsp;(2010, Wii) they render a shadow mesh to a texture and project that on the race track, as described in <a href="https://www.bryanmcphail.com/wp/?p=640">one of the developer’s blog</a>. The game looks great <a href="https://youtu.be/k85H5C7P0RY?t=349">in motion</a>!</li>
</ul>
<h3 id="ray-traced-shadows">Ray-traced shadows</h3>
<p>In the beginning we established that shadows are formed by a lack of light. If the game really tries to simulate physically correct lighting then shadows will naturally appear. Even small geometric details <a href="https://images.nvidia.com/geforce-com/international/comparisons/control/control-ray-traced-contact-shadows-interactive-comparison-001-on-vs-off.html">will cast accurate shadows</a>, unlike in shadow maps. Big lamps will naturally create soft shadows and indirect light will brighten dark corners. An incredible amount of time and money have been invested in ray tracing algorithms and hardware to make this dream reality.</p>
<p>In practice modern games have such complex scenes the above simulated solution has to be approximated. For example in the ray-traced shadows of <em>Alan Wake 2</em> (2023) each pixel receives lighting <a href="https://30fps.net/pages/videogame-shadows/aw2_restir.jpg">only from a single randomly chosen light</a>. The result is eventually <a href="https://30fps.net/pages/videogame-shadows/aw2_direct_lighting.jpg">fed to a denoiser</a> that intelligently smooths out the noisy picture. See <a href="https://www.nvidia.com/en-us/on-demand/session/gdc24-gdc1003/?playlistId=playList-821861a9-571a-4073-abab-d60ece4d1e49">the whole presentation</a> for details. Therefore even ray-traced shadows won’t be “perfect” and will have their own look, depending on the tradeoffs made.</p>
<p>Finally, the obvious option.</p>
<h2 id="no-shadows">No shadows</h2>
<p>Sometimes your priorities are elsewhere.</p>
<figure>
<img src="https://30fps.net/pages/videogame-shadows/16483987-alone-in-the-dark-dos-shall-we-dance-scaled.jpg" alt=""><figcaption><em>Alone in the Dark</em> (1992, DOS) had no character shadows.</figcaption>
</figure>

<hr>
<p>In the movie scene, when Hirayama is carefully studying the shadows, his new friend makes an observation:</p>
<blockquote>
<p><strong>Businessman:</strong> You’re really into this.<br></p>
</blockquote>
<p>As computer graphics enthusiasts, I think we can symphatize.</p>
<p><em>All screenshots provided by <a href="https://www.mobygames.com/">MobyGames</a> unless noted otherwise.</em> <em>Thanks to mankeli for detailed notes on an early draft of this article. Thanks to noby, msqrt, shaiggon and Warma for feedback.</em></p>



</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Async Rust is not safe with io_uring (167 pts)]]></title>
            <link>https://tonbo.io/blog/async-rust-is-not-safe-with-io-uring</link>
            <guid>41992975</guid>
            <pubDate>Wed, 30 Oct 2024 08:42:24 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://tonbo.io/blog/async-rust-is-not-safe-with-io-uring">https://tonbo.io/blog/async-rust-is-not-safe-with-io-uring</a>, See on <a href="https://news.ycombinator.com/item?id=41992975">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><article><div data-svelte-h="svelte-184ng9o"> <p>October 30, 2024 by Tzu Gwo</p></div> <h2 data-svelte-h="svelte-s902pt">TL;DR</h2> <pre data-svelte-h="svelte-8brff3">	1. Clone <a href="https://github.com/ethe/io-uring-is-not-cancellation-safe">this repository</a> on a Linux system that supports io_uring.</pre> <pre data-svelte-h="svelte-vfyltr">	2. Try switching <a href="https://github.com/ethe/io-uring-is-not-cancellation-safe/blob/master/src/main.rs#L9-L10">these two lines.</a></pre> <pre data-svelte-h="svelte-1om2w1r">	3. Execute cargo run for a while.</pre> <p data-svelte-h="svelte-a92z3x">The demo shows that even though the behavior appears similar, TCP connections leak when
				using the io_uring driver but not with the epoll driver. I've also <a href="https://github.com/ethe/io-uring-is-not-cancellation-safe/branches/all">tested this across various io_uring runtimes,</a> and it turns out to be a common issue across all of them.</p> <h2 data-svelte-h="svelte-1nsv6xs">Barbara's TCP connection mysteriously leaked</h2> <p data-svelte-h="svelte-10biiqt">Barbara had a lot of experience developing web services with async Rust. One day, she read a
				blog about io_uring, which described it as the next-generation async I/O interface for
				Linux. Interested, Barbara decided to try it out in her sidecar web service.</p> <p data-svelte-h="svelte-njq492">Rust's "async/await" model is separate from the async runtime and I/O interface
				implementations, making it easy to switch between different runtimes. Barbara was very
				familiar with Tokio, the most popular async runtime in Rust, which uses epoll for I/O
				interface. So, she looked for an async runtime that supported io_uring to transform her web
				service into an io_uring-based version.</p> <p data-svelte-h="svelte-1pil8jj">After some research, Barbara discovered several async runtimes like <a href="https://github.com/DataDog/glommio">glommio,</a> <a href="https://github.com/bytedance/monoio">monoio,</a>
				and
				<a href="https://github.com/compio-rs/compio">compio</a> that supported io_uring.
				She decided to give one of them a try—monoio, in particular, which provided both epoll and io_uring
				interfaces and allowed for easy switching. It seemed like the perfect fit for Barbara's io_uring
				exploration.</p> <p data-svelte-h="svelte-6gwc0">With her familiarity with Tokio, Barbara quickly wrote her first HTTP server demo:</p>    <p data-svelte-h="svelte-1lcrgpz">Barbara thought, "Great, this looks no different from a typical Tokio program—first bind to
				an address, then continuously accept new TCP connections in a loop and process them."</p> <p data-svelte-h="svelte-133qamx">Barbara then considered her next steps. She decided to learn how to implement asynchronous
				control, such as timeouts, so that if the TCP listener did not accept a connection for a
				while, it could switch to handling some sidecar tasks (like logging) before resuming
				acceptance:</p>    <p data-svelte-h="svelte-1ocoebl">Using the concurrency primitive "select" to add timeouts to futures worked well with
				io_uring. Barbara was pleased and quickly updated her web service to use io_uring,
				eventually deploying it. Everything ran smoothly until one day she noticed something odd in
				the client logs: some requests were never processed. To investigate, Barbara wrote a minimal
				example, only to find the issue was far more complex than expected.</p> <p data-svelte-h="svelte-1q7x5qs">Barbara found that while the client running in a child thread was connecting correctly, the
				server in the main thread wasn’t proceeding as it should. Instead, the timeout kept getting
				triggered, as if the client's connection had vanished. <b>A TCP connection leak had occurred.</b>
				And it wasn't just monoio—this issue affected all async runtimes that used io_uring.</p> <h2 data-svelte-h="svelte-1ujqvyi">What’s going on?</h2> <p data-svelte-h="svelte-1q0g62a">Before understanding why using "select" for timeout control in an io_uring-based async
				runtime leads to TCP connection leaks, we need to first understand why this issue doesn’t
				occur with epoll.</p> <p data-svelte-h="svelte-1d2d4e6">The entire async Rust ecosystem is built around a core asynchronous primitive from the
				standard library: Future. Its definition is as follows:</p>    <p data-svelte-h="svelte-1efgqfq">In Rust, all asynchronous operations—not just those manually written by async library
				developers but also those written by users using "async" blocks—are defined as recursive
				future structures, which get instantiated when ".await" is called. The entire structure
				contains all the state that must be saved across suspended futures during pending
				operations. The async executor is then responsible for repeatedly calling the "poll" method
				to advance this state until completion. Consider this example async block:</p>    <p data-svelte-h="svelte-1ntevmc">will transform to below by compiler:</p>    <p data-svelte-h="svelte-d9uza6">For a more detailed explanation of futures and how they are executed, I recommend reading
				<a href="https://en.ihcblog.com/rust-runtime-design-1/">ihciah's blog.</a>
				He is one of the core authors of monoio.</p> <p data-svelte-h="svelte-w78mu4">Async Rust makes a few core assumptions about futures:</p> <pre data-svelte-h="svelte-sjik6d">	1. The state of futures only change when they are polled.</pre> <pre data-svelte-h="svelte-thrp6b">	2. Futures are implicitly cancellable by simply never polling them again.
				</pre> <p data-svelte-h="svelte-1sa0hh5">Futures bound to epoll adhere to these assumptions, which relates to the mechanism of epoll:
				epoll is not an asynchronous syscall mechanism; it’s an event notification mechanism. In the
				above example, the actual behavior of the "listener.accept()" future, simplified, is as
				follows:</p>    <p data-svelte-h="svelte-6wikbk">"self.accept()" runs synchronously, either succeeding by obtaining a TCP stream or
				encountering a "would block" exception, leaving it in a pending state until the kernel is
				ready. To cancel this operation, you simply stop polling, as the syscall only happens during
				polling.</p> <p data-svelte-h="svelte-1jfsmfl">However, io_uring-bound futures break these two assumptions:</p> <pre data-svelte-h="svelte-1l5soen">	1. The syscall is executed asynchronously by the kernel, not during polling. The kernel commit the TCP stream into a kernel / user shared ring buffer, meaning the accept event is completed implicitly.</pre> <pre data-svelte-h="svelte-17rm9ec">	2. You cannot simply cancel an io_uring-bound future by stopping polling, as the kernel might complete the syscall at any time, <b>even during the cancellation progress</b>.
				</pre> <p data-svelte-h="svelte-11qp05s">A step-by-step explanation of the earlier example will make this process clearer:</p>    <h2 data-svelte-h="svelte-ipliht">How to solve this?</h2> <p data-svelte-h="svelte-1qr0z9y">Before discussing the solution, we need to break the problem down into two parts:</p> <pre data-svelte-h="svelte-19la56n">	1. <b>I/O Safety</b>: Ensuring that accepted TCP streams are properly closed without leaking connections.</pre> <pre data-svelte-h="svelte-17qcix0">	2. <b>Halt Safety</b> (proposed by Yoshua Wuyts): Handling connections that have already been opened when they are cancelled, allowing them to continue being processed.
				</pre> <h3 data-svelte-h="svelte-6xjdyo">I/O Safety</h3> <p data-svelte-h="svelte-1a2p9rh">First of all, we are fortunate that the I/O safety problem can be addressed now, which safe
				Rust aims to ensure this in the future. Rust provides the Drop trait to define custom
				behavior when a value is cleaned up. Thus, we can do something like this:</p>    <p data-svelte-h="svelte-1jocbtu">We just need to encourage async runtimes to implement this fix.</p> <h3 data-svelte-h="svelte-6hh2fm">Halt Safety</h3> <p data-svelte-h="svelte-7uppsm">Halt safety is more complicated. Monoio provides a component called "cancellable I/O" to
				properly handle the cancellation of io_uring-bound futures. A complete example can be found
				here: <a href="https://github.com/ethe/io-uring-is-not-cancellation-safe/blob/cancelable-io/src/main.rs">cancellable I/O example.</a> You can run this branch to see that the connection handling behavior now matches that of epoll.
				Here, I’ll show a simplified usage:</p>    <p data-svelte-h="svelte-1fi05wx">As you can see, besides performing the accept operation in the regular select branch, the
				timeout branch explicitly cancels the accept future. Afterwards, it proceeds to .await the
				accept future again to confirm if a TCP stream was ready during the timeout period.</p> <p data-svelte-h="svelte-usjqk4">Monoio's component partially solves the problem, but there's still an issue: since a future
				is a recursive structure, an io_uring-bound future may not be directly at the place where
				cancellation occurs:</p>    <p data-svelte-h="svelte-qxefi9">Canceling a future that contains an io_uring-bound future will also affect its inner
				io_uring-bound futures. This means that the cancellation safety of io_uring-bound futures is
				"contagious." Simply converting an io_uring-bound future to cancellable I/O does not solve
				all the issues.</p> <p data-svelte-h="svelte-1e286rt">Another key issue is that if you forget to handle the cancellation of an io_uring-bound
				future, there are no compile-time checks to catch it. For io_uring-bound futures, you need
				to ".await" them after cancellation to see if they have completed. This means they must be
				<b>used exactly once,</b>
				a concept called
				<a href="https://en.wikipedia.org/wiki/Substructural_type_system">linear types,</a> which ensures correct usage of resources at compile time.</p> <p data-svelte-h="svelte-1t3pja8">Unfortunately, Rust lacks the support for this kind of type system. For more details on why
				adding linear logic to Rust is challenging, you can refer to Without Boats' blog:
				<a href="https://without.boats/blog/changing-the-rules-of-rust/#:~:text=Let%E2%80%99s%20say%20you%20want%20Rust%20to%20support%20types%20which%20can%E2%80%99t%20go%20out%20of%20scope%20without%20running%20their%20destructor.%20This%20is%20one%20of%20the%20two%20different%20definitions%20of%20%E2%80%9Clinear%20types%2C%E2%80%9D">Changing the rules of Rust.</a></p> <h2 data-svelte-h="svelte-1tliofq">Why wrote this?</h2> <p data-svelte-h="svelte-1i0gxro">There has been a lot of discussion about memory safety in the context of io_uring. For more
				details, you can refer to these resources:</p> <pre data-svelte-h="svelte-1yhsrhe"> • <a href="https://blog.yoshuawuyts.com/async-cancellation-1/">Async Cancellation by yoshuawuyts</a></pre> <pre data-svelte-h="svelte-13a8yeb"> • <a href="https://without.boats/blog/io-uring/">Notes on io-uring by withoutboats</a></pre> <pre data-svelte-h="svelte-vye3w7"> • <a href="https://github.com/bytedance/monoio/blob/master/docs/en/why-async-rent.md">Async Rent by ihciah</a></pre> <p data-svelte-h="svelte-1wcx2zr">However, the community rarely addresses I/O safety and halt safety with io_uring in async
				Rust. I'm presenting a specific case to draw attention to this topic. The title of this blog
				might sound a bit dramatic, but everyone has different definitions and understandings of
				"safety." What do you think about this issue:</p> <pre data-svelte-h="svelte-15q3iv8"> • Keep things as they are; I/O safety and halt safety do not need guarantees from the language.</pre> <pre data-svelte-h="svelte-eoedff"> • Rust should ensure I/O safety (this is already a goal outlined in the RFC, but not yet implemented in Rust.)</pre> <pre data-svelte-h="svelte-ts4uky"> • Rust should ensure halt safety (rarely discussed!)</pre></article></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Eighteen Years of ABI Stability (138 pts)]]></title>
            <link>https://daniel.haxx.se/blog/2024/10/30/eighteen-years-of-abi-stability/</link>
            <guid>41992899</guid>
            <pubDate>Wed, 30 Oct 2024 08:25:28 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://daniel.haxx.se/blog/2024/10/30/eighteen-years-of-abi-stability/">https://daniel.haxx.se/blog/2024/10/30/eighteen-years-of-abi-stability/</a>, See on <a href="https://news.ycombinator.com/item?id=41992899">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
		
<p>Exactly eighteen years ago today, on October 30 2006, we shipped <a href="https://curl.se/ch/7.16.0.html">curl 7.16.0</a> that among a whole slew of new features and set of bugfixes bumped the libcurl SONAME number from 3 to 4.</p>



<h2>ABI breakage</h2>



<p>This bump meant that libcurl 7.16.0 was not binary compatible with the previous releases. Users could not just easily and transparently bump up to this version from the previous, but they had to check their use of libcurl and in some cases adjust source code.</p>



<p>This was not the first ABI breakage in the curl project, but at this time our use base was larger than at any of the previous bumps and this time people complained about the pains and agonies such a break brought them.</p>



<h2>We took away FTP features</h2>



<p>In the 7.16.0 release we removed a few FTP related features and their associated options. Before this release, you could use curl to do “third party” transfers over FTP, and in this release you could no longer do that. That is a feature when the client (curl) connects to server A and instructs that server to communicate with server B and do file transfers among themselves, without sending data to and from the client.</p>



<p>This is an FTP feature that was not implemented well in curl and it was poorly tested. It was also a feature that barely no FTP server allowed and subsequently this was not used by many users. We ripped it out.</p>



<h2>A near pitchfork situation</h2>



<p>Because so few people used the removed features, barely anyone actually noticed the ABI breakage. It remained theoretical to most users and I believe that detail only made people more upset over the SONAME bump because they did not even see the necessity: we just made their lives more complicated for no benefit (to them).</p>



<p>The Debian project even decided to override our decision <em>“no, that is not an ABI breakage”</em> and added a local patch in their build that lowered the SONAME number back to 3 again in their builds. A patch they would stick to for many years to come.</p>



<p>The obvious friction this bump caused, even when in reality it actually did not affect many users and the loud feedback we received, made a huge impact on me. It had not previously dawned on me exactly how important this was.</p>



<p>I decided there and then to do the utmost to never go through this again. To put ABI compatibility at the top of the priority list. Make it one of the most fundamental key properties of libcurl.</p>



<p><strong>Do. Not. Break. The. ABI</strong></p>



<p>(we don’t break the API either)</p>



<h2>A never-breaking ABI</h2>



<p>The decision was initially made to avoid the negativity the bump brought, but I have since over time much more come to appreciate the upsides.</p>



<p><em>Application authors everywhere can always and without risk keep upgrading to the latest libcurl.</em></p>



<p>It sounds easy and simple, but the impact is huge. The examples, the documentation, the applications, everything can just always upgrade and continue. As libcurl over time has become even more popular and compared to 2006, used in many magnitudes more installations, it has grown into an even more important aspect of the curl life. Possibly <em>the</em> single most important properly of curl.</p>



<p>There is a small caveat here and that is that we occasionally of course have bugs and regressions, so when I say that users can always upgrade, that is true in the sense that we have not broken the ABI since. We have however had a few regressions that sometimes have triggered some users to downgrade again or wait a little longer for the next release that has the bug fixed.</p>



<p>When we took that decision in 2006 we had less than 50,000 lines of product code. Today we are approaching 180,000 lines.</p>



<h2>Effects of never breaking ABI</h2>



<p>We know that once we adopt a change, we are stuck with it for decades to come. It makes us double-check every knot before we accept new changes.</p>



<p>Once accepted and shipped, we keep supporting code and features that we otherwise could have reconsidered and perhaps removed. Sometimes we think of a better way to do something <em>after</em> the initial merge, but by then it is too late to change. We can then always introduce new and better ways to do things, but we have to keep supporting the old way as well.</p>



<p>A most fundamental effect is that we can never shrink the list of options we support. We can never actually rename something. Doing new things and features consistently over this long time is hard if not impossible, as we learn new things and paradigms vary through the decades.</p>



<h2>How</h2>



<p>The primary way we maintain this is by manual code view and code inspection of every change. Followed of course by a large range of tests that make sure that assumptions remain.</p>



<p>Occasionally we have (long) discussions around subtle details when someone proposes a change that potentially might be considered an ABI break. Or not.</p>



<p>What exactly is covered by <em>ABI compatibility</em> is not always straight forward or easy to have carved in stone. In particular since the project can be built and run on such a wide range of systems and architectures.</p>



<h2>Deprecating</h2>



<p>We <em>can</em> still remove functionality if the conditions are right.</p>



<p>Some features and options are documented and work in a way so that something is <em>requested</em> or <em>asked for</em> and libcurl then tries to satisfy that ask. Like for example libcurl once supported HTTP/1 pipelining like that.</p>



<p>libcurl still provides the option to enable pipelining and applications can still ask for it so it is still ABI and API compatible, but a modern libcurl simply will never do it because that functionality has been removed.</p>



<p>Example two: we dropped support for NPN a few years back. NPN being a TLS extension called Next Protocol Negotiation that was used briefly in the early days of HTTP/2 development before ALPN was introduced and replaced NPN.  Virtually nothing requires NPN anymore, and users can still set the option asking for it, but it will never actually happen over the wire.</p>



<p>Furthermore, a typical libcurl build involves multiple third party libraries that provide features it needs. For things like TLS, SSH, compression and binary HTTP protocol management. Over the years, we have removed support for several such libraries and introduced support for new, in ways that was never visible in the API or ABI. Some users just had to switch to building curl with different helper libraries.</p>



<p>In reality, libcurl is typically more stable than most existing servers and URLs. The libcurl examples you wrote in 2006 can still be built with the modern libcurl, but the servers and URLs you used back then most probably cannot be used anymore.</p>



<h2>If no one can spot it, it did not happen</h2>



<p>As blunt as it may sound, it has came down to this fundamental statement several times to judge if a change is an ABI breakage or not:</p>



<p><em>If no one can spot an ABI change, it is not an ABI change</em></p>



<p>Of course what makes it harder than it sounds is that it is extremely difficult to actually know if someone will notice something ahead of time. libcurl is used in so ridiculously many installations and different setups, second-guessing whatever everyone does and wants is darned close to impossible.</p>



<p>Adding to the challenge is the crazy long upgrade cycles some of our users seem to sport. It is not unusual to see questions appear on the mailing lists from users bumping from curl versions from eight or ten years ago. The fact that we have not  heard users comment on a particular change might just mean that they are still stuck on ancient versions.</p>



<p>Getting frustrated comments from users today about a change we landed five years ago is hard to handle.</p>



<h2>Forwards compatible</h2>



<p>I should emphasize that all this means that users can always upgrade to a <em>later</em> release. It does not necessarily mean that they can switch back to an older version without problems. We do add new features over time and if you start using a new feature, the application of course will not work, or even still compile, if you would switch to a libcurl version from before that feature was added.</p>



<h2>How long is never</h2>



<p>What I have laid out here is our plan and ambition. We have managed to stick to this for eighteen years now and there is no particular known blockers in the known future either.</p>



<p>I cannot rule out that we might at some point in the future run into an obstacle so huge or complicated that we will be forced to do the unthinkable. To break the ABI. But until we see absolutely no other way forward, it is not going to happen.</p>
	</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[AI Flame Graphs (162 pts)]]></title>
            <link>https://www.brendangregg.com/blog//2024-10-29/ai-flame-graphs.html</link>
            <guid>41992419</guid>
            <pubDate>Wed, 30 Oct 2024 06:54:50 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.brendangregg.com/blog//2024-10-29/ai-flame-graphs.html">https://www.brendangregg.com/blog//2024-10-29/ai-flame-graphs.html</a>, See on <a href="https://news.ycombinator.com/item?id=41992419">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
<p>Imagine halving the resource costs of AI and what that could mean for the planet and the industry -- based on extreme estimates such savings could reduce the total US power usage by over 10% by 2030<span size="-2"><sup>1</sup></span>. At Intel we've been creating a new analyzer tool to help reduce AI costs called <em>AI Flame Graphs</em>: a visualization that shows an AI accelerator or GPU hardware profile along with the full software stack, based on my <strong><a href="https://www.brendangregg.com/FlameGraphs/cpuflamegraphs.html">CPU flame graphs</a></strong>. Our first version is available to customers in the <strong><a href="https://www.intel.com/content/www/us/en/developer/tools/devcloud/services.html">Intel Tiber AI Cloud</a></strong> as a preview for the Intel Data Center GPU Max Series (previously called Ponte Vecchio). Here is an example:</p>

<center><a href="https://www.brendangregg.com/blog/images/2024/matrixAIflamegraph.svg"><img src="https://www.brendangregg.com/blog/images/2024/matrixAIflamegraph.png" width="700"></a><br><span size="-1"><i>Simple example: SYCL matrix multiply microbenchmark</i></span></center>

<p>(Click for interactive <a href="https://www.brendangregg.com/blog/images/2024/matrixAIflamegraph.svg">SVG</a>.) The <span color="#00bb00">green</span> frames are the actual instructions running on the AI or GPU accelerator, <span color="#008888">aqua</span> shows the source code for these functions, and <span color="#bb0000">red</span> (C), <span color="#888800">yellow</span> (C++), and <span color="#a04000">orange</span> (kernel) show the CPU code paths that initiated these AI/GPU programs. The <span color="#808080">gray</span> "-" frames just help highlight the boundary between CPU and AI/GPU code. The x-axis is proportional to cost, so you look for the widest things and find ways to reduce them.</p>

<div><center><img src="https://www.brendangregg.com/blog/images/2024/AIflamegraph-legend.png" width="150"><br><span size="-1"><i>Layers</i></span></center></div>

<p>This flame graph shows a simple program for SYCL (a high-level C++ language for accelerators) that tests three implementations of matrix multiply, running them with the same input workload. The flame graph is dominated by the slowest implementation, multiply_basic(), which doesn't use any optimizations and consumes at 72% of stall samples and is shown as the widest tower. On the right are two thin towers for multiply_local_access() at 21% which replaces the accessor with a local variable, and multiply_local_access_and_tiling() at 6% which also adds matrix tiling. The towers are getting smaller as optimizations are added.</p>

<p>This flame graph profiler is a prototype based on Intel EU stall profiling for hardware profiling and <a href="https://ebpf.io/">eBPF</a> for software instrumentation. It's designed to be <strong>easy and low-overhead</strong>, just like a CPU profiler. You should be able to generate a flame graph of an existing AI workload whenever you want, without having to restart anything or launch additional code via an interposer.</p>

<h2>Instruction-offset Profiling</h2>

<p>This is not the first project to build an AI profiler or even something called an AI Flame Graph, however, others I've seen focus on tracing CPU stacks and timing accelerator execution, but don't profile the instruction offsets running on the accelerator; or do profile them but via expensive binary instrumentation. I wanted to build AI flame graphs that work like CPU flame graphs: Easy to use, negligible cost, production safe, and shows everything. A daily tool for developers, with most of the visualization <em>in the language of the developer</em>: source code functions.</p>

<p>This has been an internal AI project at Intel for the past year. Intel was already investing in this space, building the EU stall profiler capability for the Intel Data Center GPU Max Series that provides an approximation of HW instruction sampling. I was lucky to have <strong>Dr. Matthew (Ben) Olson</strong>, an Intel AI engineer who has also worked on eBPF performance tooling (<a href="https://github.com/intel/processwatch">processwatch</a>) as well as memory management research, join my team and do most of the development work. His background has helped us power through difficulties that seemed insurmountable. We've also recently been joined by <strong>Dr. Brandon Kammerdiener</strong> (coincidentally another graduate of the University of Tennessee, like Ben), who also has eBPF and memory internals experience, and has been helping us take on harder and harder workloads. And <strong>Gabriel Muñoz</strong> just joined today to help with releases. Now that our small team has shown that this is possible, we'll be joined by other teams at Intel to develop this further.</p>

<p>We could have built a harder-to-use and higher-overhead version months ago using Intel <a href="https://www.brendangregg.com/blog//2024-10-29/binary%20instrumentation">GTPin</a> but for widespread adoption it needs minimal overhead and ease of use so that developers don't hesitate to use this daily and to add it to deployment pipelines.</p>

<h2>What's a Flame Graph?</h2>

<div><center><img src="https://www.brendangregg.com/blog/images/2024/flamegraph-cost.png" width="300"></center></div>

<p>A <a href="https://www.brendangregg.com/flamegraphs.html">flame graph</a> is a visualization I invented in 2011 for showing sampled code stack traces. It has become the standard for CPU profiling and analysis, helping developers quickly find performance improvements and eliminate regressions. A CPU flame graph shows the "big picture" of running software, with x-axis proportional to CPU cost. The example picture on the right summarizes how easy it can be to go from compute costs to responsible code paths. Prior to flame graphs, it could take hours to understand a complex profile by reading through <a href="https://www.brendangregg.com/FlameGraphs/cpuflamegraphs.html#Problem">hundreds of pages of output</a>. Now it takes seconds: all you have to do is look for the widest rectangles.</p>

<p>Flame graphs have had worldwide adoption. They have been the basis for five startups so far, have been adopted in over thirty performance analysis products, and have had <a href="https://www.brendangregg.com/Slides/YOW2022_flame_graphs/#8">over eighty implementations</a>.</p>

<p>My first implementation of flame graphs took a few hours on a Wednesday night after work. The real effort has been in the decade since, where I worked with different profilers, runtimes, libraries, kernels, compilers, and hypervisors to get flame graphs working properly in different environments, including fixing stack walking and symbolization. Earlier this year I posted about the final missing piece: Helping distros <a href="https://www.brendangregg.com/blog/2024-03-17/the-return-of-the-frame-pointers.html">enable frame pointers</a> so that profiling works across standard system libraries.</p>

<p>Similar work is necessary for AI workloads: fixing stacks and symbols and getting profiling to work for different hardware, kernel drivers, user-mode drivers, frameworks, runtimes, languages, and models. A lot more work, too, as AI analysis has less maturity than CPU analysis.</p>

<h2>Searching Samples</h2>

<p>If you are new to flame graphs, it's worth mentioning the built-in search capability. In the earlier example, most of the stall samples are caused by sbid: software scoreboard dependency. As that may be a unique search term, you can run search (Ctrl-F, or click "Search") on "sbid" and it will highlight it in magenta:</p>

<center><img src="https://www.brendangregg.com/blog/images/2024/AIflamegraph-search.png" width="530"></center>

<p>Search also shows the total number of stack samples that contained sbid in the bottom right: 78.4%. You can search for any term in the flame graph: accelerator instructions, source paths, function names, etc., to quickly calculate the percentage of stacks where it is present (excluding vertical overlap) helping you prioritise performance work.</p>

<p>Note that the samples are EU stall-based, which means theoretical performance wins can take the percentages down to zero. This is different to timer-based samples as are typically used in CPU profiling. Stalls mean you better focus on the pain, the parts of the code that aren't making forward progress, but you aren't seeing resource usage by unstalled instructions. I'd like to supuport timer-based samples in the future as well, so we can have both views.</p>

<h2>Who will use this?</h2>

<p>At a recent golang conference, I asked the audience of 200+ to raise their hands if they were using CPU flame graphs. Almost every hand went up. I know of companies where flame graphs are a daily tool that developers use to understand and tune their code, reducing compute costs. This will become a daily tool for AI developers.</p>

<p>My employer will use this as well for evaluation analysis, to find areas to tune to beat competitors, as well as to better understand workload performance to aid design.</p>

<h2>Why is AI profiling hard?</h2>

<p>Consider CPU instruction profiling: This is easy when the program and symbol table are both in the file system and in a standardized file format (such as ELF) as is the case with native compiled code (C). CPU profiling gets hard for JIT-complied code, like Java, as instructions and symbols are dynamically generated and placed in main memory (the process heap) without following a universal standard. For such JITted code we use runtime-specific methods and agents to retrieve snapshots of the heap information, which is different for each runtime.</p>

<p>AI workloads also have different runtimes (and frameworks, languages, user-mode drivers, compilers, etc.) any of which can require special tinkering to get their CPU stacks and symbols to work. These CPU stacks are shown as the red, orange, and yellow frames in the AI Flame Graph. Some AI workloads are easy to get these frames working, some (like PyTorch) are a lot more work. </p>

<div><center><img src="https://www.brendangregg.com/blog/images/2024/AIsourcezoom.png" width="450"></center></div>

<p>But the real challenge is instruction profiling of actual GPU and AI accelerator programs -- shown as the aqua and green frames -- and correctly associating them with the CPU stacks beneath them. Not only may these GPU and AI programs not exist in the file system, but they may not even exist in main memory! Even for running programs. Once execution begins, they may be deallocated from main memory and only exist in special accelerator memory, beyond the direct reach of OS profilers and debuggers. Or within reach, but only through a prohibitively high-overhead HW-specific debugger interface.</p>

<p>There's also no /proc representation for these programs either (I've been proposing building an equivalent) so there's no direct way to even tell what is running and what isn't, and all the other /proc details. Forget instruction profiling, even ps(1) and all the other process tools do not work.</p>

<p>It's been a mind-bending experience, revealing what gets taken for granted because it has existed in CPU land for decades: A process table. Process tools. Standard file formats. Programs that exist in the file system. Programs running from main memory. Debuggers. Profiliers. Core dumping. Disassembling. Single stepping. Static and dynamic instrumentation. Etc. For GPUs and AI, this is all far less mature. It can make the work exciting at times, when you think something is impossible and then find or devise a way.</p>

<p>Fortunately we have a head start as some things do exist. Depending on the runtime and kernel driver, there are debug interfaces where you can list running accelerator programs and other statistics, as used by tools like intel_gpu_top(1). You can kill -9 a GPU workload using intel_gpu_abrt(1). Some interfaces can even generate basic ELF files for the running accelerator programs that you can try to load in a debugger like gdb(1). And there is support for GPU/AI program disassembly, if you can get your hands on the binary. It feels to me like GPU/AI debugging, OS style, is about two years old. Better than zero, but still early on, and lots more ahead of us. A decade, at least.</p>

<h2>What do AI developers think of this?</h2>

<p>We've shown AI Flame Graphs to other AI developers at Intel and a common reaction is to be a bit puzzled, wondering what to do with it. AI developers think about their bit of code, but with AI Flame Graphs they can now see the entire stack for the first time, including the HW, and many layers they don't usually think about or don't know about. It basically looks like a pile of gibberish with their code only a small part of the flame graph.</p>

<div><center><a href="https://www.brendangregg.com/Slides/YOW2022_flame_graphs/#8"><img src="https://www.brendangregg.com/blog/images/2024/flamegraph-montage.png" width="190"></a><br><span size="-1"><i>CPU Flame Graph Implementations</i></span></center></div>

<p>This reaction is similar to people's first experiences with CPU flame graphs, which show parts of the system that developers and engineers typically don't work on, such as runtime internals, system libraries, and kernel internals. Flame graphs are great at highlighting the dozen or so functions that matter the most, so it becomes a problem of learning what those functions do across a few different code bases, which are typically open source. Understanding a dozen such functions can take a few hours or even a few days -- but if this leads to a 10% or 2x cost win, it is time well spent. And the next time the user looks at a flame graph, they start saying "I've seen that function before" and so on. You can get to the point where understanding the bulk of a CPU flame graph takes less than a minute: look for the widest tower, click to zoom, read the frames, done.</p>

<p>I'm encouraged by the success of CPU flame graphs, with over 80 implementations and countless real world case studies. Sometimes I'm browsing a performance issue I care about on github and hit page down and there's a CPU flame graph. They are everywhere.</p>

<p>I expect AI developers will also be able to understand AI Flame Graphs in less than a minute, but to start with people will be spending a day or more browsing code bases they didn't know were involved. Publishing case studies of found wins will also help people learn how to interpret them, and also help explain the value.</p>

<h2>What about PyTorch?</h2>

<p>Another common reaction we've had is that AI developers are using PyTorch, and initially we didn't support it as it meant walking Python stacks, which isn't trivial. But prior work has been done there (to support CPU profiling) and after a lot of tinkering we now have the first PyTorch AI Flame Graph:</p>

<center><a href="https://www.brendangregg.com/blog/images/2024/PyTorchFlamegraph.svg"><img src="https://www.brendangregg.com/blog/images/2024/PyTorchFlamegraph.png" width="700"></a><br><span size="-1"><i>PyTorch frames in pink </i></span></center>

<p>(Click for interactive <a href="https://www.brendangregg.com/blog/images/2024/PyTorchFlamegraph.svg">SVG</a>.) The PyTorch functions are at the bottom and are colored pink. This example runs oneDNN kernels that are JIT-generated, and don't have a source path so that layer just reads "jit". Getting all other the layers included was a real pain to get going, but an important milestone. We think if we can do PyTorch we can do anything.</p>

<p>In this flame graph, we show PyTorch running the Llama 2 7B model using the Intel Extensions for PyTorch (IPEX). This flame graph shows the origin of the GPU kernel execution all the way back to the Python source code shown in pink. Most samples are from a stack leading up to a gemm_kernel (matrix multiply) shown in aqua, which like the previous example has many stalls due to software scoreboarding.</p>

<p>There are two instructions (0xa30 and 0xa90) that combined are 27% of the entire profile. I expect someone will ask: Can't we just click on instructions and have it bring up a dissassembly view with full source? Yes, that should be possible, but I can't answer how we're going to provide this yet. Another expected question I can't yet answer: Since there are now multiple products providing AI auto-tuning of CPU workloads using CPU flame graphs (including <a href="https://granulate.io/">Intel Granulate</a>) can't we have AI auto-tuning of <em>AI</em> workloads using AI Flame Graphs?</p>

<h2>First Release: Sometimes hard and with moderate overhead</h2>

<p>Getting AI Flame Graphs to work with some workloads is easy, but others are currently hard and cost moderate overhead. It's similar to CPU profiling, where some workloads and languages are easy to profile, whereas others need various things fixed. Some AI workloads use many software dependencies that need various tweaks and recompilation (e.g., enabling frame pointers so that stack walking works) making setup time consuming. PyTorch is especially difficult and can take over a week of OS work to be ready for AI Flame Graphs. We will work on getting these tweaks changed upstream in their respective repositories, something involving teams inside and outside of Intel, and is a process I'd expect to take at least a year. During that time AI workloads will gradually become easier to flame graph, and with lower-overhead as well.</p>

<p>I'm reminded of eBPF in the early days: You had to patch and recompile the kernel and LLVM and Clang, which could take multiple days if you hit errors. Since then all the eBPF dependency patches have been merged, and default settings changed, so that eBPF "just works." We'll get there with AI Flame Graphs too, but right now it's still those early days.</p>

<p>The changes necessary for AI Flame Graphs are really about improving debugging in general, and are a requirement for <a href="https://www.brendangregg.com/Slides/eBPFSummit2023_FastByFriday/">Fast by Friday</a>: A vision where we can root-cause analyze anything in five days or less.</p>

<h2>Availability</h2>

<p>AI Flame Graphs will first become available on the <a href="https://www.brendangregg.com/blog//2024-10-29/yes,%20Intel%20has%20a%20public%20cloud">Intel Tiber AI Cloud</a> as a preview feature for the Intel Data Center GPU Max Series. If you are currently deployed there you can ask through the Intel service channel for early access. As for if or when it will support other hardware types, be in other Intel products, be officially launched, be open source, etc., these involve various other teams at Intel and they need to make their own announcements before I can discuss them here.</p>

<h2>Conclusions</h2>

<p>Finding performance improvements for AI data centers of just fractions of a percent can add up to planetary savings in electricity, water, and money. If AI flame graphs have the success that CPU flame graphs have had, I'd expect finding improvements of over 10% will be common, and 50% and higher will eventually be found*. But it won't be easy in these early days as there are still many software components to tweak and recompile, and software layers to learn about that are revealed in the AI flame graph.</p>

<p>In the years ahead I imagine others will build their own AI flame graphs that look the same as this one, and there may even be startups selling them, but if they use more difficult-to-use and higher-overhead technologies I fear they could turn companies off the idea of AI flame graphs altogether and prevent them from finding sorely needed wins. This is too important to do badly. AI flame graphs should be easy to use, cost negligible overhead, be production safe, and show everything. Intel has proven it's possible.</p>

<h2>Disclaimer</h2>

<p><span size="-1">
* This is a personal blog post that makes personal predictions but not guarantees of possible performance improvements. Feel free to take any claim with a grain of salt, and feel free to wait for an official publication and public launch by Intel on this technology.</span></p><p><span size="-1"><sup>1</sup> Based on halving the Arm CEO Rene Haas' estimate of 20-25% quoted in <a href="https://arstechnica.com/ai/2024/06/is-generative-ai-really-going-to-wreak-havoc-on-the-power-grid/">Taking a closer look at AI's supposed energy apocalypse</a> by Kyle Orland of ArsTechnica.
</span></p>

<h2>Thanks</h2>

<p><i>Thanks to everyone at Intel who have helped us make this happen. Markus Flierl has driven this project and made it a top priority, and Greg Lavender has expressed his support. Special thanks to Michael Cole, Matthew Roper, Luis Strano, Rodrigo Vivi, Joonas Lahtinen, Stanley Gambarin, Timothy Bauer, Brandon Yates, Maria Kraynyuk, Denis Samoylov, Krzysztof Raszknowski, Sanchit Jain, Po-Yu Chen, Felix Degrood, Piotr Rozenfeld, Andi Kleen, and all of the other coworkers that helped clear things up for us, and thanks in advance for everyone else who will be helping us in the months ahead.</i></p><p><i>My final thanks is to the companies and developers who do the actual hands-on work with flame graphs, collecting them, examining them, finding performance wins, and applying them.<br>You are helping save the planet.</i></p>

</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Jaywalking legalized in New York City (101 pts)]]></title>
            <link>https://www.theguardian.com/us-news/2024/oct/29/new-york-jaywalking-legal</link>
            <guid>41992399</guid>
            <pubDate>Wed, 30 Oct 2024 06:50:10 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.theguardian.com/us-news/2024/oct/29/new-york-jaywalking-legal">https://www.theguardian.com/us-news/2024/oct/29/new-york-jaywalking-legal</a>, See on <a href="https://news.ycombinator.com/item?id=41992399">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="maincontent"><p>Jaywalking – that time-honored practice of crossing the street outside of the crosswalk or against the traffic light – is now legal in <a href="https://www.theguardian.com/us-news/new-york" data-link-name="in body link" data-component="auto-linked-tag">New York</a> City.</p><p>Legislation passed by the city council last month officially became law over the weekend after the city’s mayor, Eric Adams, declined to take action – either by signing or vetoing it – after 30 days.</p><p>Council member Mercedes Narcisse, a Brooklyn Democrat who sponsored the legislation, said on Tuesday that the new law ends racial disparities in enforcement, noting that more than 90% of the jaywalking tickets issued last year went to Black and Latino people.</p><p>“Let’s be real, every New Yorker jaywalks. People are simply trying to get where they need to go,” she said in an emailed statement. “Laws that penalize common behaviors for everyday movement shouldn’t exist, especially when they unfairly impact communities of color.”</p><p>The new law permits pedestrians to cross a roadway at any point, including outside of a crosswalk. It also allows for crossing against traffic signals and specifically states that doing so is no longer a violation of the city’s administrative code.</p><p>But the new law also warns that pedestrians crossing outside of a crosswalk do not have the right of way and that they should yield to other traffic that has the right of way.</p><p>Liz Garcia, an Adams spokesperson, declined to elaborate on the mayor’s decision to let the bill become law without his action.</p><p>But she noted the bill makes it clear that crossing against the light and mid-block is highly risky behavior. People may also still be liable in civil actions for accidents caused by jaywalking, Garcia added.</p><p>“All road users are safer when everyone follows traffic rules,” she said in a statement. “We continue to encourage pedestrians to take advantage of safety mechanisms in place – such as daylighting, pedestrian islands, and leading pedestrian intervals – by crossing in a crosswalk with the walk signal.”</p><p>Other cities and states, from Denver and Kansas City, Missouri, to California, Nevada and Virginia, have decriminalized jaywalking in recent years, according to America Walks, a Seattle-based group that’s been tracking the proposals.</p><p>“Cities that truly care about safety focus on street design, speeding and dangerously large vehicles,” Mike McGinn, the group’s executive director, said Tuesday. “Not jaywalking laws.”</p><p>The laws were pushed by the auto industry in the 1930s as a way to keep people off streets and make more room for vehicles, according to America Walks.</p><p>The term “jaywalking” dates to the early 20th century and has its roots in midwestern slang for a country bumpkin or rube, according to dictionary maker Merriam-Webster.</p><p>In New York City, where struggles between pedestrians and motorists are constant, the jaywalking law had been on the books since 1958 and carried a penalty of up to $250.</p><p>In the 1969 film Midnight Cowboy, Dustin Hoffman famously yells: “I’m walking here!” as his character is almost hit by a cab while crossing the street in Manhattan.</p><p>The Legal Aid Society called the legislation long overdue. The non-profit organization, which provides free legal representation to New Yorkers who cannot afford a lawyer, said police for decades have used the violation as a pretext to stop, question and frisk residents – especially those of color.</p><p>“With this legislation now codified, we hope that both the Adams Administration and the City Council will continue to abolish relic laws that serve no public safety purpose and only ensnare people in the criminal legal system,” the organization said in a statement.</p><p>Police department spokespeople didn’t immediately respond to emails seeking comment, and a spokesperson for its largest union declined to weigh in.</p><p>But Narcisse said officers she has spoken to say their time could be better spent on other police work, rather than issuing tickets for jaywalking.</p><p>“No one’s ever said: ‘I’m so glad they caught that jaywalker.’ By eliminating these penalties, we allow our police officers to focus on issues that truly matter,” she said.</p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[15 Billion Miles Away, NASA's Voyager 1 Breaks Its Silence (124 pts)]]></title>
            <link>https://scitechdaily.com/15-billion-miles-away-nasas-voyager-1-breaks-its-silence/</link>
            <guid>41992394</guid>
            <pubDate>Wed, 30 Oct 2024 06:48:55 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://scitechdaily.com/15-billion-miles-away-nasas-voyager-1-breaks-its-silence/">https://scitechdaily.com/15-billion-miles-away-nasas-voyager-1-breaks-its-silence/</a>, See on <a href="https://news.ycombinator.com/item?id=41992394">Hacker News</a></p>
Couldn't get https://scitechdaily.com/15-billion-miles-away-nasas-voyager-1-breaks-its-silence/: Error: Request failed with status code 403]]></description>
        </item>
        <item>
            <title><![CDATA[Australia/Lord_Howe is the weirdest timezone (800 pts)]]></title>
            <link>https://ssoready.com/blog/engineering/truths-programmers-timezones/</link>
            <guid>41992314</guid>
            <pubDate>Wed, 30 Oct 2024 06:21:05 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://ssoready.com/blog/engineering/truths-programmers-timezones/">https://ssoready.com/blog/engineering/truths-programmers-timezones/</a>, See on <a href="https://news.ycombinator.com/item?id=41992314">Hacker News</a></p>
<div id="readability-page-1" class="page"><p>
            Timezones are weird. But only finitely so. Here's the exact conceptual model you should have of them.
        </p><div>
            <p>The standard trope when talking about timezones is to rattle off falsehoods
programmers believe about them. These lists are only somewhat enlightening –
it’s really hard to figure out what truth is just from the contours of
falsehood.</p>
<p>So here’s an alternative approach. I’m gonna show you some weird timezones. In
fact, the <em>weirdest</em> timezones. They’re each about as weird as timezones are
allowed to get in some way.</p>
<ul>
<li><code>Asia/Kathmandu</code> has a weird offset from UTC</li>
<li><code>Africa/Casablanca</code> doesn’t fit into the timezone model cleanly, so it’s hard-coded</li>
<li><code>America/Nuuk</code> does daylight savings at -01:00 (yes, with a negative)
<ul>
<li>and <code>Africa/Cairo</code> and <code>America/Santiago</code> do it at 24 o’clock (not 0 o’clock)</li>
</ul>
</li>
<li><code>Australia/Lord_Howe</code>, population 382 and <a href="https://en.wikipedia.org/wiki/Dryococelus_australis">some notable stick
bugs</a>, has the weirdest
daylight savings rule</li>
</ul>
<p>To learn how their weirdness is represented in software, we’ll look at the raw
timezone files that all software ultimately relies on. From there, two things
will become clear:</p>
<ul>
<li>Yeah, this stuff is weird</li>
<li>But only finitely so, because ultimately a computer’s gotta implement them</li>
</ul>
<p>But first, an aside on the calendar.</p>
<h2 id="pgxiiream-pope-gregory-xiii-rules-everything-around-me">PGXIIREAM: Pope Gregory XIII rules everything around me</h2>
<p>Unless you’re doing some fairly exotic things where you’re finding yourself
saying things like</p>
<blockquote>
<p>Oh yeah the OCR on Japanese driving licenses pops out things like “平成 8”,
that’s just <a href="https://en.wikipedia.org/wiki/Japanese_era_name">how they sometimes say
1996</a> over there. That’s why
we have this in the parser:</p>
<pre tabindex="0"><code>eras = { "大正": 1912, "昭和": 1926, "平成": 1989 }
</code></pre><p>One of these days we’ll need to add <code>"令和": 2019</code>, but it hasn’t come up yet.</p>
</blockquote>
<p>or</p>
<blockquote>
<p>We’re gonna need to set up a per-country feature flag when deciding whether
banks are closed for Eid. <a href="https://www.economist.com/middle-east-and-africa/2019/06/06/when-is-eid-al-fitr">Saudi Arabia and Iran don’t agree on when the lunar
month
starts</a>.</p>
</blockquote>
<p>Then yeah, sure, you may need to write software that knows about the Japanese or
Islamic calendar systems.</p>
<p>Cases like this are a small minority. The reality of the world is that the
Western system of timekeeping is the dominant one, and even in e.g. Japan and
the Muslim world, almost everyone who uses computers is familiar with the
Gregorian system.</p>
<p>With computers, we project the Gregorian system into the future and past, which
is called the proleptic Gregorian calendar and isn’t historically accurate but
nobody really cares except <a href="https://en.wikipedia.org/wiki/Old_Style_and_New_Style_dates">Russian revolution
nerds</a>.</p>
<p>This calendar system is pretty much good enough, and barring any <a href="https://en.wikipedia.org/wiki/French_Republican_calendar">rationalist
coups d’etat</a>, is the
one we’ll be stuck with for a long time. It does one thing well: it’s very good
at keeping the sun at the same place in the sky across the years. It doesn’t let
the months drift around the seasons like the Roman calendar did.</p>
<p>Technically, this “keep the sun roughly in the same place whenever it’s the same
time-of-day” is called “mean solar time”. And that’s why GMT, Greenwich Mean
Time, is called that way. It’s about the mean solar time of the <a href="https://en.wikipedia.org/wiki/Royal_Observatory,_Greenwich">English
observatory in
Greenwich</a>.</p>
<p>By the way, we technically don’t call it GMT anymore. Unless you’re talking
about what time people in London say it is, you probably technically mean
<a href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time">UTC</a>.</p>
<p><img src="https://ssoready.com/blog/engineering/truths-programmers-timezones/utc.png" alt=""></p>
<p><a href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time">Coordinated Universal
Time</a> is basically
just a modern formalization of GMT. It’s useful because almost everyone on the
planet has agreed to base their clocks off of an <em>offset</em> from UTC. It’s still a
solar mean time, but the connection to Greenwich isn’t really there anymore.</p>
<p>I bring this up because you may have heard of a weird modern quirk on Pope
Gregory’s sun-following endeavors:</p>
<h2 id="leap-seconds-dont-matter">Leap seconds don’t matter</h2>
<p>The Earth’s rotation is slowing down. Days are getting longer. So you need to
correct for it if you want to keep IRL days in sync with computer days.</p>
<p>The nerd task force assigned to this problem is the <a href="https://en.wikipedia.org/wiki/International_Earth_Rotation_and_Reference_Systems_Service">International Earth
Rotation and Reference Systems
Service</a>,
which has two primary goals:</p>
<ol>
<li>Watch the Earth rotate, and report back on their findings</li>
<li>Break Wikipedia’s CSS with their long name</li>
</ol>
<figure>
<div>
<p><img src="https://ssoready.com/blog/engineering/truths-programmers-timezones/iers.png"></p><figcaption>timecops</figcaption>
</div>
</figure>
<p>If the days are getting longer, and they’re doing so at a fairly unpredictable
rate, the simplest solution is to have IERS occasionally just insert an extra
second in the day to make clocks go slower. It’s called a <a href="https://en.wikipedia.org/wiki/Leap_second">leap
second</a>.</p>
<p>You should completely ignore the fact that this is a thing. It’s a cool novelty,
but it’s effectively just a detail you can ignore, because:</p>
<ol>
<li><a href="https://go.dev/play/p/9RwZu2jmlPl">It’s not like programming languages support representing 61-second minutes
anyway</a></li>
<li>You (and by you I mean your cloud provider) can just run your clocks slower
around the time of the leap second, and pretend to everyone else over
<a href="https://en.wikipedia.org/wiki/Network_Time_Protocol">NTP</a> that their clocks
are running fast. This is called leap smearing.</li>
</ol>
<p>Btw it’s called UTC (Universal Time Coordinated? huh?) because the same folks
who publish UTC also publish UT1, which is UTC sans the leap seconds. There were
other UTs before the Coordinated variant came up.</p>
<h2 id="weird-time-zones">Weird time zones</h2>
<p>OK! Let’s start looking at some weird time zones, and find out how your computer
knows to represent them.</p>
<h2 id="asiakathmandu-is-on-a-weird-offset"><code>Asia/Kathmandu</code> is on a weird offset</h2>
<p>Most of the world is on a whole number of hours before or after UTC. About a
fifth the world by population is on a half-hour offset from UTC; in particular,
India is 5h30m ahead of UTC.</p>
<p>Nepal is 5h45m ahead of UTC:</p>
<div><pre tabindex="0"><code data-lang="text"><span><span>$ TZ=UTC date ; TZ=Asia/Kathmandu date
</span></span><span><span>Tue Jul 30 23:52:11 UTC 2024
</span></span><span><span>Wed Jul 31 05:37:11 +0545 2024
</span></span></code></pre></div><p>If you’re like me, you must be have at one point wondered how in the <em>world</em>
your computer knows this fact.</p>
<p>Here’s a hint:</p>
<div><pre tabindex="0"><code data-lang="text"><span><span>$ TZ=Asia/Kathmandu strace -e trace=openat date
</span></span><span><span>...
</span></span><span><span>openat(AT_FDCWD, "/usr/share/zoneinfo/Asia/Kathmandu", O_RDONLY|O_CLOEXEC) = 3
</span></span><span><span>Wed Jul 31 05:40:49 +0545 2024
</span></span></code></pre></div><p>On your filesystem is a database called the IANA Timezone Database, aka tzdb or
zoneinfo. It’s a bunch of binary files, encoded in <a href="https://www.rfc-editor.org/rfc/rfc8536.html">Timezone Information
Format</a>. The names of those files
act as timezone identifiers, which is where you see strings like
<code>America/Los_Angeles</code> or <code>Europe/London</code> come from:</p>
<pre tabindex="0"><code>$ tree /usr/share/zoneinfo
...
├── America
│&nbsp;&nbsp; ├── Los_Angeles
├── Europe
│&nbsp;&nbsp; ├── London
...
</code></pre><p>At the very end of <code>/usr/share/zoneinfo/Asia/Kathmandu</code> is this little string:</p>
<pre tabindex="0"><code>cat /usr/share/zoneinfo/Asia/Kathmandu
...
&lt;+0545&gt;-5:45
</code></pre><p>The syntax is here pretty obtuse, but what it means is:</p>
<blockquote>
<p>Unless otherwise specified, UTC is 5h45m behind this timezone. Call this time
<code>+0545</code>.</p>
</blockquote>
<p>That’s precisely how software can figure out the time in Nepal. That’s also why
the output from <code>date</code> above has <code>+0545</code> in it.</p>
<h2 id="why-strings-like-pdt-or-cet-are-pretty-meaningless">Why strings like <code>PDT</code> or <code>CET</code> are pretty meaningless</h2>
<p>In the example above, <code>+0545</code> is called a “designator”. It’s a pretty-ish string
describing which <em>part</em> of a timezone a timestamp is in. It’s meant to be used
for outputting timestamps, and is only unambiguous if you already know what
timezone the timestamp was taken in.</p>
<p>Just <em>how</em> ambiguous are these designators? I wrote a <code>tzdump</code> script that
converts TZIF files to JSON. Here’s the top hits:</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>find -L /usr/share/zoneinfo -type f <span>\
</span></span></span><span><span><span></span>  <span>|</span> xargs -n1 ./tzdump <span>\
</span></span></span><span><span><span></span>  <span>|</span> jq -r <span>'"\(.ID)\t\(.Transitions[].LocalTimeType.Designation)"'</span> <span>\
</span></span></span><span><span><span></span>  <span>|</span> sort <span>|</span> uniq <span>|</span> sort -k <span>2</span> <span>|</span> uniq -f <span>1</span> -c <span>|</span> sort -n <span>|</span> awk <span>'{ print $1 "\t" $3 }'</span> <span>|</span> tail -r
</span></span></code></pre></div><p>The most popular designators are:</p>
<pre tabindex="0"><code>66	CST
58	CDT
56	CET
56	CEST
</code></pre><p>A total of <strong>66 timezones</strong> use <code>CST</code>, either in the past or future. Many
timezones are functionally exact clones of each other – there’s no difference
between <code>America/Phoenix</code> and
<a href="https://en.wikipedia.org/wiki/Creston,_British_Columbia"><code>America/Creston</code></a>,
but they each get their own file – but still. There’s a lot of ambiguity in
there.</p>
<p>In case you’re curious, only 33 designators are unique to a timezone. A lot more
are functionally unique, but I’m too lazy to dedupe logically-equivalent
timezones right now.</p>
<p>As an extra fun bit of trivia, designators are not strictly uppercase/numeric.
<code>ChST</code>, appearing in <code>Pacific/Saipan</code>, stands for Chamorro Standard Time. It’s
the only designator with a lowercase name. <code>CHST</code> is not taken, sadly for those
of us who love bugs.</p>
<h2 id="how-are-timezones-with-dst-represented">How are timezones with DST represented?</h2>
<p>When we looked at Kathmandu, we had this string telling us the Nepalese time
rules:</p>
<pre tabindex="0"><code>&lt;+0545&gt;-5:45
</code></pre><p>Ok, simple enough. But what about a timezone with DST transitions? The syntax
has lots of defaults (DST will be a one-hour jump, it happens at 2am by default,
etc) but <code>Europe/Athens</code> is a good example of one that uses most of the syntax:</p>
<pre tabindex="0"><code>$ cat /usr/share/zoneinfo/Europe/Athens
...
EET-2EEST,M3.5.0/3,M10.5.0/4
</code></pre><p>That syntax means:</p>
<blockquote>
<p>Standard time is called <code>EET</code>, it’s 2 hours ahead of UTC. DST is called <code>EEST</code>
(it’s 3 hours ahead, an implicit default relative to standard time). Start DST
in month <code>3</code> on the last instance of (<code>5</code>) day <code>0</code> (Sunday) in that month, at
3am local (<code>/3</code>). End DST on month <code>10</code> on the last Sunday at 4am local
(<code>5.0/4</code>).</p>
</blockquote>
<p>So yeah, your computer does a bunch of <a href="https://howardhinnant.github.io/date_algorithms.html">kind of
gnarly</a> logic to figure
out what date-and-time a timestamp corresponds to, then figures out whether it’s
inside or outside DST to figure out the current local time. Delightful.</p>
<p>In case you’re curious, the spec says “5” means “last instance of”, and “1”
means “first instance of”. But only weeks “1”, “2”, and “5” are used:</p>
<pre tabindex="0"><code>$ find -L /usr/share/zoneinfo -type f | xargs -n1 ./tzdump | jq -r 'if .Rules.DST == null then empty else "\(.ID)\t\(.Rules.DST.Week)" end' | sort -k2 | uniq -f 1 -c | awk '{ print $1 "\t" $3 }'
18	1
89	2
81	5
</code></pre><p>Here’s a fun twist: on my Mac 100% of timezones either don’t have DST at all or
use this nth-instance-of-day-of-month rules to do DST switching. But inside
<code>/var/db/timezone</code> there’s different versions of tzdb. In there is a version
with other kinds of timezones in it:</p>
<pre tabindex="0"><code>$ cat /var/db/timezone/tz/2024a.1.0/zoneinfo/Africa/Casablanca
...
XXX-2&lt;+01&gt;-1,0/0,J365/23
</code></pre><p>That timezone basically means “we are perpetually on daylight savings”, because
the <code>J###</code> syntax means “<code>###</code>-th day of the year, not counting Feb 29 if there
is one” (J stands for “Julian calendar”).</p>
<p>Technically, that timezone also exercises the prefixless (i.e. without <code>M</code> or
<code>J</code>) syntax for indicating days, where <code>###</code> means “<code>###</code>-th day of year,
counting any Feb 29”. But in this case it’s a distinction without a difference.</p>
<p>(Aside: All this stuff comes from POSIX. <a href="https://www.gnu.org/software/libc/manual/html_node/TZ-Variable.html">GNU’s docs about the POSIX <code>TZ</code> env
var</a>, which
TZIF builds on, are the best I know of online for this stuff.)</p>
<p>But this is just the start of the weirdness that is <code>Africa/Casablanca</code>.</p>
<h2 id="africacasablanca-and-asiagaza-follow-the-moon-but-timezones-follow-the-sun"><code>Africa/Casablanca</code> and <code>Asia/Gaza</code> follow the moon, but timezones follow the sun</h2>
<p>The TZIF format supports three possible rules for deciding on your daylight
savings transition day:</p>
<ul>
<li>Rules like “first Tuesday of March”</li>
<li>Rules like “45th day of the year”</li>
<li>Rules like “45th day of the year, Feb 29 doesn’t count”</li>
</ul>
<p>Morocco and Gaza do their daylight savings based on Ramadan. Ramadan is a month
in the Islamic calendar. The Islamic calendar is based on the moon. The lunar
calendar isn’t a clean multiple of the solar calendar; from the Gregorian
perspective, lunar months seem to slowly “rotate” around the year, because
they’re basically on a different modulo. There’s a problem there for our heroes
at the tzdb.</p>
<p>The solution? The dumbest possible one.</p>
<p>A TZIF file ends with the footer syntax we’ve been talking about to this point.
But it <em>starts</em> with a big long list of historical data about a timezone. If a
country ever changes timezone rules, TZIF represents that by encoding the new
rule in the footer, and hard-coding all the old transitions.</p>
<p>But you can also just take these hard-coded transitions and put them into the
future. The hard-coded transitions take precedence over the footer. So the TZIF
folks:</p>
<ol>
<li>Picked a year far enough into the future (2086, as it turns out)</li>
<li>Wrote a script in
<a href="https://github.com/eggert/tz/blob/339e81d1ade620e70ecc78c2b4ec1309a6b80a2f/asia#L3494-L3512">emacs</a>
<a href="https://github.com/eggert/tz/blob/339e81d1ade620e70ecc78c2b4ec1309a6b80a2f/africa#L861-L878">lisp</a>
to calculate Ramadan</li>
<li>Use the output of that script to generate transitions for Morocco and Gaza</li>
</ol>
<p>And that’s why in practice Morocco and Gaza are just hard-coded in the tzdb,
unlike every other timezone.</p>
<p>In case you’re hoping for more fun timezones like this, I’m afraid you’re out of
luck. The others at the bottom of this list, which filters for transitions
beyond 2025, are just synonyms of Casablanca and Gaza.</p>
<pre tabindex="0"><code>$ find -L /var/db/timezone/tz/2024a.1.0/zoneinfo/ -type f | xargs -n1 ./tzdump | jq 'select(.Transitions[].TransitionTime &gt; 1735689600) | .ID' -r | uniq -c | sort -n
  26 /var/db/timezone/tz/2024a.1.0/zoneinfo//Africa/Cairo
...
  26 /var/db/timezone/tz/2024a.1.0/zoneinfo//US/Pacific
  26 /var/db/timezone/tz/2024a.1.0/zoneinfo//WET
  26 /var/db/timezone/tz/2024a.1.0/zoneinfo//posixrules
 130 /var/db/timezone/tz/2024a.1.0/zoneinfo//Africa/Casablanca
 130 /var/db/timezone/tz/2024a.1.0/zoneinfo//Africa/El_Aaiun
 184 /var/db/timezone/tz/2024a.1.0/zoneinfo//Asia/Gaza
 184 /var/db/timezone/tz/2024a.1.0/zoneinfo//Asia/Hebron
</code></pre><p>It looks like every other timezone just has 26 transitions beyond 2025, which I
think are just there to make software that doesn’t know about the TZIF footer
transition rules be accurate a few years into the future anyway.</p>
<h2 id="americanuuk-transitions-to-dst-at--1-oclock"><code>America/Nuuk</code> transitions to DST at -1 o’clock</h2>
<p><a href="https://en.wikipedia.org/wiki/Nuuk">Nuuk</a> is in
<a href="https://en.wikipedia.org/wiki/Iceland">Greenland</a>, and is part of the <a href="https://en.wikipedia.org/wiki/Special_territories_of_members_of_the_European_Economic_Area">greater
EU cinematic
universe</a>.</p>
<p>All of Europe (idk whether this is an EU/EEZ/EFTA/CoE thing) syncs up their
daylight savings, except for <a href="https://en.wikipedia.org/wiki/Greenland">Iceland</a>,
which doesn’t do DST at all (<code>Atlantic/Reykjavik</code>, which is technically <a href="https://github.com/eggert/tz/blob/7748036bace8562b9c047f368c8eba5f35e8c4b4/backward#L226">an
alias for
<code>Africa/Abidjan</code></a>,
is basically just UTC; their rule string is just <code>GMT0</code>).</p>
<p>Most Europeans are familiar with three major timezones, which we can refer to as
<code>Europe/Lisbon</code> (western), <code>Europe/Brussels</code> (central), and <code>Europe/Athens</code>
(eastern). They’re each one hour ahead of the other, and so their timezone
transitions look like:</p>
<pre tabindex="0"><code># I'm gonna space these out to highlight the symmetry,
# and also spell out the implicit "/2"

Europe/Lisbon:   WET0WEST ,M3.5.0/1,M10.5.0/2
Europe/Brussels: CET-1CEST,M3.5.0/2,M10.5.0/3
Europe/Athens:   EET-2EEST,M3.5.0/3,M10.5.0/4
</code></pre><p>In other words, Lisbon springs forward at 1am, Brussels at 2am, and Athens at
3am. But those times are <em>local</em>. In reality, they’re all at the same instant.</p>
<p>This makes good sense. It’s good for business that the time difference between
any two spots in Europe is always the same.</p>
<p>Greenland would like to be part of the action. Thing is, Greenland is pretty far
west of continental Europe. Whereas Lisbon’s standard time is UTC, Greenland’s
is 3 hours behind UTC. Here’s their daylight transition rules:</p>
<pre tabindex="0"><code>$ cat /var/db/timezone/tz/2024a.1.0/zoneinfo/America/Nuuk
&lt;-02&gt;2&lt;-01&gt;,M3.5.0/-1,M10.5.0/0
</code></pre><p>Take note of <code>M3.5.0/-1</code>. The first part is the standard European DST start day.
The <code>/-1</code> part? That means that instead of doing DST at like 2am (<code>/2</code>),
Greenland does it at -1 o’clock (<code>/-1</code>). The way the rules file is encoded,
daylight savings for Greenland is meant to happen on Sunday, but in fact happens
at 11pm on the Saturday before. Super weird.</p>
<p>I’m guessing this breaks software, because America/Nuuk and its aliases are one
of those timezones whose transition rules are just entirely ommitted in
<code>/usr/share/zoneinfo</code> on my Mac. They’re only available in other copies of tzdb
in <code>/var/db/timezone</code>.</p>
<h2 id="oh-americasantiago-and-africacairo-transition-at-24-oclock">Oh, <code>America/Santiago</code> and <code>Africa/Cairo</code> transition at 24 o’clock</h2>
<p>Nuuk is the earliest anyone does a transition. Santiago and Cairo are the
latest. They both do transitions at 24 o’clock? Like, the next day?</p>
<pre tabindex="0"><code>America/Santiago: &lt;-04&gt;4&lt;-03&gt;,M9.1.6/24,M4.1.6/24
</code></pre><pre tabindex="0"><code>Africa/Cairo: EET-2EEST,M4.5.5/0,M10.5.4/24
</code></pre><p>I think they’re both encoded like that because of weirdness in how the
governments define the rules. Like <code>M10.5.4/24</code> means “last Thurday of October,
24 o’clock”, which really means “the day after the last Thursday of October”.
But that’s not the same thing as “last Friday of October” if the month ends on
Thursday?</p>
<p>Both of these files are also in Mac’s list of naughty timezones that don’t go in
<code>/usr/share/zoneinfo</code>.</p>
<h2 id="australialord_howe-has-the-weirdest-dst-transition"><code>Australia/Lord_Howe</code> has the weirdest DST transition</h2>
<p>When you do a DST transition, you “spring forward” and “fall back”. <em>Surely</em>
everyone agrees it’s a <em>one-hour</em> jump, right?</p>
<p>Here’s a script to check. What is the time difference between standard and
daylight time in every timezone?</p>
<pre tabindex="0"><code>$ find -L /usr/share/zoneinfo -type f | xargs -n1 ./tzdump | jq 'if .Rules.DST == null then "\(.ID)\t0" else "\(.ID)\t\(.Rules.DST.LocalTimeType.UTCOffsetSeconds - .Rules.Std.LocalTimeType.UTCOffsetSeconds)" end' -r | sort -n -k 2 | uniq -c -f 1 | awk '{ print $1 "\t" $3 }'

410	0
2	1800
185	3600
1	7200
</code></pre><p>Hmm. 410 timezones just don’t DST at all. 185 have a 3600-second, i.e. 1-hour,
difference. And then there are the malcontents.</p>
<p>The 7200-second, i.e. 2-hour, jump is <code>Antarctica/Troll</code>. Fitting.</p>
<pre tabindex="0"><code>&lt;+00&gt;0&lt;+02&gt;-2,M3.5.0/1,M10.5.0/3
</code></pre><p>So during the winter (i.e. the northern summer) they use Norway time? But there
are <a href="https://en.wikipedia.org/wiki/Troll_(research_station)">like 6 people over the winter at
Troll</a>? Do these 6 souls
appreciate their contribution to software esoterica? I hope they do. Apparently
they use <a href="https://github.com/eggert/tz/blob/7748036bace8562b9c047f368c8eba5f35e8c4b4/antarctica#L212-L236">like four different times during the
year</a>
down there in practice, but there’s no syntax to express that.</p>
<p>OK but the real question is what’s up with the two 1800 transitions. They’re
synonyms for each other. It’s <code>Australia/Lord_Howe</code>, which has a <strong>powerful</strong>
30-minute DST transition:</p>
<pre tabindex="0"><code>&lt;+1030&gt;-10:30&lt;+11&gt;-11,M10.1.0,M4.1.0
</code></pre><p>10h30m ahead of UTC standard, 11h DST. Love this for them. Running cron jobs on
an hourly basis doesn’t in practice have very weird interactions with DST.
Everywhere else on the planet, every 60 minutes you’re back to the same spot on
the clock.</p>
<p>Except Lord Howe Island. Heroes. On the first Sunday of October, a 60-minute
timegap only puts you halfway around the clock. All your cron jobs are now
staggered relative to the local wall clock.</p>
<p>In case you’re curious, <a href="https://en.wikipedia.org/wiki/Lord_Howe_Island">Lord Howe
Island</a> belongs to Australia. It
has 382 people at the latest census. It’s a bit of a natural paradise, and
apparently to preserve that there’s a cap of 400 tourists at a time.</p>
<p>Probably the most famous aspect of Lord Howe is <a href="https://en.wikipedia.org/wiki/Ball%27s_Pyramid">Ball’s
Pyramid</a>.</p>
<figure>
<div>
<p><img src="https://ssoready.com/blog/engineering/truths-programmers-timezones/balls.png"></p><figcaption>Ball's Pyramid Memorial for Stickbugs and Software Engineers who write Timezone-related Code.</figcaption>
</div>
</figure>
<p>It’s an old collapsed volcano. It looks cool. It has some rare <a href="https://en.wikipedia.org/wiki/Ball%27s_Pyramid#Dryococelus_australis">stick
bugs</a>.</p>
<h2 id="big-takeaways">Big takeaways</h2>
<p>Timezones are weird, but finitely so. All they consist of is:</p>
<ul>
<li>An ID, e.g. <code>America/Los_Angeles</code></li>
<li>A set of hard-coded transitions, which range from the past into the future</li>
<li>A set of rules for how future transitions may happen</li>
</ul>
<p>Any given time in a timezone is just:</p>
<ul>
<li>An offset from UTC</li>
<li>With a “designator” time that doesn’t mean much</li>
<li>(This usually isn’t outputted anywhere) Whether the time is considered DST</li>
</ul>
<p>You can always uniquely identify what UTC time someone is referring to whenever
they tell you their timezone + local time + current time designator. The
timezone + designator gives you an offset, and you can apply the offset to the
local time to get UTC.</p>
<p>Like, it’s weird, it’s quirky, but it’s not like all bets are off.</p>
<p>Also:</p>
<ul>
<li>Don’t let people bully you into thinking that just because something is
complicated, it’s impossible.</li>
<li>This is because almost every standard (except ISO8601, whatever) is
just a file, and you can read it. You are smart. You can do it. Embrace
the weirdness of Greenland’s daylight savings. Believe in yourself.</li>
<li>If I were UN secretary general, I would kick out any countries that I deem
insufficiently considerate of Paul Eggert’s time.</li>
</ul>
<h2 id="appendix-other-weird-stuff-in-zoneinfo">Appendix: Other weird stuff in zoneinfo</h2>
<p>Honestly, there’s some stuff in zoneinfo that I can’t figure out. Even I have
nerd-sniping limits. Exercises for the reader.</p>
<p>These time zones have <em>hundreds</em> of hard-coded transitions out into the future.
I don’t understand why, it’s not like they all have lunar calendar stuff going
on.</p>
<ul>
<li>Asia/Jerusalem has 780 transitions in the future, out of 901 total</li>
<li>Africa/Cairo has 800 transitions in the future, out of 929 total</li>
<li>America/Nuuk has 800 transitions in the future, out of 889 total</li>
<li>America/Santiago has 800 transitions in the future, out of 931 total</li>
<li>Pacific/Easter has 800 transitions in the future, out of 911 total</li>
<li>Asia/Gaza has 982 transitions in the future, out of 1106 total</li>
</ul>
<p>They all lack a rules footer, but our friend Africa/Casablanca has a mere 132
transitions hard-coded and lacks a rules footer too. What’s up with that?</p>
<hr>
<p>P.S. If you’re the type of weird to think this stuff is neat: email me.
<a href="mailto:ulysse.carion@ssoready.com">ulysse.carion@ssoready.com</a> ;)</p>

        </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[1BRC Coding Challenge: Nerd Sniping the Java Community (107 pts)]]></title>
            <link>https://www.infoq.com/presentations/1brc/</link>
            <guid>41992081</guid>
            <pubDate>Wed, 30 Oct 2024 05:02:37 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.infoq.com/presentations/1brc/">https://www.infoq.com/presentations/1brc/</a>, See on <a href="https://news.ycombinator.com/item?id=41992081">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="presentationNotes">
                                    <h2>Transcript</h2>

<p>Morling: I would like to talk about a viral coding challenge which I did in January of this year, called, The One Billion Row Challenge. I would like to tell a little bit the story behind it, how all this went, what I experienced during January. Then, of course, also some of the things I learned, some of the things the community learned from doing that. This is how it started. On January 1st, I put out this tweet, I put out a blog post introducing this challenge. Was a little bit on my mind to do something like that for quite a while. Between Christmas and New Year's Eve, I finally found the time to do it. I thought, let me go and put out this challenge. I will explain exactly what it was, and how it worked. That's how it started. Then it got picked up quite quickly. People started to work on that. They implemented this in Java, which was the initial idea, but then they also did in other languages, other ecosystems, like .NET, Python, COBOL, with databases, Postgres, Snowflake, Apache Pinot, all those good things.</p>

<p>There was an article on InfoQ, which was the most read article for the first six months of the year, about this. There also was this guy, I didn't know him, Prime, a popular YouTuber. He also covered this on his stream. What did I do then? I learned how to print 162 PDF files and send them out to people with their individual certificate of achievement. I learned how to send coffee mugs and T-shirts to people all around the world, because I wanted to give out some prices. I sent those things to Taiwan, South America, the Republic of South Korea, and so on. That was what happened during January.</p>

<p>Who am I? I work as a software engineer at a company called Decodable. We built a managed platform for stream processing based on Apache Flink. This thing is completely a side effort for me. It was a private thing, but then Decodable helped to sponsor it and supported me with doing that.</p>

<h2>The Goals</h2>

<p>What was the idea behind this? Why did I do this? I thought I would like to learn something new. There's all those new Java versions every six months. They come with new APIs, new capabilities. It's really hard to keep track of all those developments. I would like to know what's new in those new Java versions, and what can I do with those things? I wanted to learn about it, but also, I wanted to give the community an avenue to do that so that everybody can learn something new. Then, of course, you always want to have some fun. It should be a cool thing to do. You don't want to just go and read some blogs. You would like to get some hands-on experience.</p>

<p>Finally, also, the idea was to inspire others to do the same. This was the thing, which I think was a bit specific about this challenge, you could actually go and take inspiration from other people's implementations. Nothing was secret. You could go and see what they did, and be inspired by them. Obviously, you shouldn't just take somebody else's code and submit it as your own implementation. That would make much sense. You could take inspiration, and people actually did that, and they teamed up in some cases. The other motivation for that was, I wanted to debunk this idea, which sometimes people still have, Java is slow, and nothing could be further from the truth, if you look at modern versions and their capabilities. Still, this is on people's minds, and I wanted to help and debunk this. As we will see, I think that definitely was the case.</p>

<h2>How Did it Work?</h2>

<p>Let's get a bit into it. How did it work? You can see it all here in this picture. The idea was, we have a file with temperature measurements, and it's essentially like a CSV file, only that it wasn't a comma as a separator, but a semicolon with two columns, and a station name, like Hamburg or Munich, and so on. Then, a temperature measurement value associated to that, randomized values. The task was, process that file, aggregate the values from that file, and for each of those stations, determine the minimum value, the maximum value, and the average temperature value. Easy. Then the caveat only was, this has 1 billion rows as the name of the challenge gives away.</p>

<p>This file, if you generate this on your machine, it has a size of around 13 gigabytes, so quite sizable. Then you had to print out the results, as you can see it here. This already goes to show a little bit that I didn't spend super much time to prepare this, because this is just the two-string output of the Java HashMap implementation. Random to have this as the expected output. Then as people were implementing this, for instance, with relational databases, they actually went to great lengths to emulate that output format. I should have chosen a relational output format, next time.</p>

<h2>The Rules</h2>

<p>A little bit more about the rules. First of all, this was focused on Java. Why? It's the platform I know best, I would like to support. This is also what I wanted to spread the knowledge on. Then you could choose any version. Any new versions, preview versions, all the kinds of distributions, like GraalVM, or all the different JDK providers which are out there. You managed using this tool called SDKMAN. Who has heard about SDKMAN? You should go and check out SDKMAN, and you should use it to manage Java versions. It's a very nice tool for doing that, and switching back and forth between different versions. That's it. Java only. No dependencies.</p>

<p>It wouldn't make much sense to pull in some library and do the task for you. You should program this by yourself. No caching between runs. I did five runs of each implementation. Then I discarded the fastest and the slowest one, and I took the average value from the remaining three runs. It would make sense to have any caching there. Otherwise, you could just do the task once, persist the result in the file, read it back, and it would be very fast. That doesn't make much sense. You were allowed to take inspiration by others. Of course, not again, just resubmit somebody else's implementation. You could take inspiration.</p>

<h2>Evaluation Environment</h2>

<p>In terms of how I ran this. My company spent €100 on this machine which I got on the Hetzner cloud. Very beefy server with 32 cores, out of which I mostly used only 8 cores, I will explain later on. Quite a bit of RAM. Really, the file was always coming from a RAM disk. I wanted to make sure that disk I/O is not part of the equation, just because it's much less predictable, would have made the life much harder for me. Only a purely CPU bound problem here. How would we go and do this? This is my baseline implementation. I'm an average Java developer, so that's what I came up with. I use this Java Streams API. I use this files.lines method, which gives me a stream with the lines of a file. I read that file from disk, then I map each of my lines there using the split method. I want to separate the station name from the value. Then I collect the results, the lines into this grouping collector. I group it by the station name.</p>

<p>Then for each of my stations, I need to aggregate those values, which happens here in my aggregator implementation. Whenever a new value gets added to an existing aggregator object, I keep track of the min, the max, and in order to calculate average I keep track of the sum and the count of the values. Pretty much straight forward. That's adding a line. Then, if I run this in parallel, I would need to merge two aggregators. That's what's happening here. Again, pretty much straight forward. Finally, if I'm done, I need to reduce my processed results, and I emit such a result through object with the min, the max value. Then, for the average, I just divide sum by count, and I print it out. On this machine, this ran in about five minutes. Not super-fast, but also not terribly bad. Writing this code, it took me half an hour or maybe less. It's decent. Maybe, if you were to solve this problem in your job, you might call it a day and just go home, have a coffee and be done with it. Of course, for the purpose of this challenge, we want to go quite a bit faster and see how much we can move the needle here.</p>

<h2>The First Submission</h2>

<p>With this challenge, the important thing is somebody has to come and participate. That was a bit my concern like, what happens if nobody does it? It would be a bit embarrassing. Roy Van Rijn, another Java champion from the Netherlands, he was instantly interested in this, and an hour later or so, after I had put out the post, he actually created his own first implementation, and it wasn't very fancy or very elaborate. His idea just was, I want to be part of it. I want to put out a submission so other people can see, this is something we also could do. This was really great to see, because as soon as the first person comes along and takes part, then also other people will come along and take part. Of course, he kept working on that. He was one of the most active people who iterated on his implementation, but he was the very first one to submit something.</p>

<h2>Parallelization</h2>

<p>Let's dive a little bit into the means of what you can do to make this fast. People spent the entire month of January working on this, and they went down to a really deep level, essentially counting CPU instructions. My idea is, I want to give you some ideas of what exists, what you can do. Then maybe later on, if you find yourself in that situation where you would like to optimize certain things, then you might remember, I've heard about it. Then you could go and learn really deep. That's the idea.</p>

<p>Let's talk about parallelization, first of all, because we have many CPU cores. On my server, which I use to evaluate it, I have 32 cores, 64 with hyperthreading. We would like to make use of that. Would be a bit wasteful to just use a single core. How can we go about this? Going back to my simple baseline implementation, the first thing I could do is I could just say, let me add this parallel call, so this part of the Java Streams API.</p>

<p>Now this will process this pipeline, or I should say, part of this streaming pipeline in parallel. Just doing this, just adding this single method call, gets us down to 71 seconds. From 4 minutes 50 seconds, to 71 seconds by just adding a few characters for one method call. I think that's a pretty good thing. Very easy win. Of course, that's not all we can do. In particular, if you think about it, yes, it gets us down by quite a bit, but it's not eight times faster than what we had initially, but we have 8 CPU cores which I'm using here. Why is it not eight times faster? This parallel operator, this applies to the processing logic. All this aggregating and grouping logic, this happens in parallel, but this reading of the file from memory, this still happens sequentially.</p>

<p>The entire file, the reading part, that's sequentially, and we have still all our other CPU cores sitting idle, so we would like to also parallelize that. This comes back then to this notion that I would like to go out and learn something new, because all those new Java versions, they come with new APIs, the JEPs, the Java Enhancement Proposals. One of them, which was added recently, is the foreign function and memory API. You can see it here, so that's taken straight from the JEP, but essentially, it's a Java API which allows you to make use of native methods.</p>

<p>It's a replacement, much easier to use than the old JNI API. It also allows you to make use of native memory. Instead of the heap, which is managed by the JVM, you get the ability to manage your own memory section, like an off-heap memory, and you will be in charge of maintaining that, and making sure you free it, and so on. That's what we would like to use here, because we could memory map this file and then process it there in parallel. Let's see how we can go about that.</p>

<p>I mentioned there's a bit of code, but I will run you through it. That's a bit of a recurring theme. The code you will see, it gets more dense as we progress. Again, you don't really have to understand everything. I would like to give you a high-level intuition. What do we do here? First of all, we determine the degree of parallelism. We just say, how many CPU cores do we have? Eight in our case, so that's our degree of parallelism. Next, we want to memory map this file. You could have memory map files also in earlier Java versions, but for instance, you had size limits. You couldn't memory map an entire 13-gig file all at once, whereas now here with the new foreign memory API, that's possible. We can do this. You map the file. We have this Arena object there. This is essentially our representation of this memory. There's different kinds of Arenas. In this case, I'm just using this global Arena which just exists and is accessible from everywhere within my application. That's where I have that file, and now I can access that entire section of memory in parallel using multiple threads.</p>

<p>In order to do so, we need to split up that file and the memory representation. That's what happens here. First of all, roughly speaking, we divide into eight equal chunks. We take our entire size divided by eight. That's our estimate of chunk sizes. Now, of course, what would happen is, in all likelihood, we will end up in the middle of a line. This is not really desirable, where, ideally, we would like to have our worker processes, they should work on entire lines. What's happening here is, we went to roughly one-eighth of the file, we just keep going to the next line ending character. Then we say, that's the end of this chunk, and the starting point of the next chunk. Then we process those chunks, essentially, just using threads. We will see later on how to do this. We start our threads, we join them. In the end, we've got to wait. Now this parallelizes the entire thing.</p>

<p>Now we really make use of all our 8 cores for the entire time, also while we do the I/O. There's one caveat. Just by the nature of things, one of those CPU cores will always be the slowest. At some point, all the other seven, they will just wait for the last one to finish, because it's a little bit unequally distributed. What people, in the end, did, instead of using 8 chunks, they split up this file in much smaller chunks. Essentially, they had a backlog of those chunks. Whenever one of those worker threads was done with the current chunk, it would go and pick up the next one.</p>

<p>By that, you make sure that all your 8 threads are utilized equally all the time. The ideal chunk size, as it turned out, was 2 megabytes. Why 2 megabytes? This specific CPU, which is in this machine which I used, it has a second level cache size of 16 megabytes, 8 threads processing 2 megabytes at a time. It's just the best in terms of predictive I/O and so on. This is what people found out. This already goes to show, we really get down to the level of a specific CPU and the specific architecture to really optimize for that problem by doing those kinds of things. That's parallel I/O.</p>

<h2>1BRC - Mythbusters, and Trivial Task?</h2>

<p>This challenge, it was going, people were participating. They had a good time. Of course, whenever something happens, there's also conspiracy theories. That's what I fear. People said, is this actually an engineering problem? At Decodable, you had this problem and you didn't know how to do it, so you farmed it out to the community. I can tell you, this would have been the most silly thing I could have done, because I created so much work by running this challenge for myself. I didn't do much besides it during the entire month of January. It was not that. It was just a genuine thing, which I felt would be interesting to me and the community. Was it an add for GraalVM? Because many people actually used GraalVM, and we will see later on more about it. Also, no. It was just like GraalVM lends itself really well towards that problem. Finally, is it an add for this AMD EPYC processor? Also, no.</p>

<p>Really, no conspiracies going on here. Who is on Hacker News? I read Hacker News way too often. Of course, you always have the Hacker News guy who says, that's a trivial problem. Everybody who knows how to program just a little bit, they will have solved this in two hours, and it's like a boring thing. Then, on the other hand, you have all the people from the Java community, and also, big names like Thomas Würthinger, who is the engineering lead at GraalVM, or Cliff Click, who was one of the original people behind the JVM, or Aleksey Shipilev, and all those people, they spend the entire month of January doing this. Of course, the Hacker News dude, he does it in two hours. Always interesting to see.</p>

<h2>Parsing</h2>

<p>Let's dive a little more into parsing that. We have seen how to make use of our CPU cores, but what actually happens there to process a line? Let's take a closer look at that. If we want to get away from what we had initially with just splitting up the file using regex and so on, that's not very efficient. Let's see what we can do here. That's, again, something I would be able to come up with just processing those input lines, character by character. What's happening here is, we have a little bit of a state machine. We read our characters. We keep reading the line until it has no more characters. Then we use the semicolon character which separates our station name from the temperature value to switch these states. Depending on which state we are, so do we either read the bytes which make up the station name, or do we read up the bytes which make up the measurement value? We need to add them into some builder or buffer which aggregates those particular values.</p>

<p>Then, if we are at the end of a line, so we have found the line ending character, then we need to consume those two buffers for the station and for the measurement, which we have built up. For the measurement, we will need to see how we convert that into an integer value, because that's also what people figured out. The problem was described as a double or a floating-point arithmetic, so with values like 21.7 degrees, but then again, randomly, I always only had a single fractional digit. People realized, this data actually, it always only has a single fractional digit. Let's take advantage of that and just consider that as an integer problem by just multiplying the number by 100, for the means of calculation. Then at the end, of course, divide it by 100, or by 10. That's something which people did a lot, and which I underestimated how much they would take advantage of the particular characteristics of that dataset.</p>

<p>For that conversion, we can see it here, and it makes sense, so we process or we consume those values. If we see the minus character, we negate the value. If we see the first one of our two digits, we multiply it by 100 or by 10. That's how we get our value there. Doing that, it gets us down to 20 seconds. This is already an order of magnitude faster than my initial baseline implementation. So far, nothing really magic has happened. One takeaway also for you should be, how much does it make sense to keep working on such a thing? Again, if this is a problem you're faced with in your everyday job, maybe stop here. It's well readable, well maintainable. It's an order of magnitude faster than the native baseline implementation, so that's pretty good.</p>

<p>Of course, for the purposes of this challenge, we probably need to go a bit further. What else can we do? We can, again, come back to the notion of parallelism and try to process multiple values at once, and now we have different means of parallelization. We already saw how to make the most out of all our CPU cores. That's one degree of parallelism. We could think about scaling out to multiple compute nodes, which is what we typically would do with our datastores. For that problem, it's not that relevant, we would have to split up that file and distribute it in a network. Maybe not that desirable, but that would be the other end of the spectrum. Whereas we also can go into the other direction and parallelize within specific CPU instructions. This is what happens here with SIMD, Single Instruction, Multiple Data.</p>

<p>Essentially all these CPUs, they have extensions which allow you to apply the same kind of operation onto multiple values at once. For instance, here, we would like to find the line ending character. Now, instead of comparing byte by byte, we can use such a SIMD instruction to apply this to 8 or maybe 16, or maybe even more bytes at once, and it will, of course, speed up things quite a bit. The problem is, in Java, you didn't really have a good means to make use of those SIMD instructions because it's a portable, abstract language, it just wouldn't allow you to get down to this level of CPU specificity. There's good news.</p>

<p>There's this vector API, which is still incubating, I think, in the eighth incubating version or so, but this API allows you now to make use of those vectorized instructions at extensions. You would have calls like this compare call with this equal operator, and then this will be translated to the right SIMD instruction of the underlying architecture. This would translate to the Intel or AMD64 extensions. Also, for Arm, it would do that. Or it would fall back to a scalar execution if your specific machine doesn't have any vector extensions. That's parallelization on the instruction level. I did another talk about it, https://speakerdeck.com/gunnarmorling/to-the-moon-and-beyond-with-java-17-apis, which shows you how to use SIMD for solving FizzBuzz.</p>

<p>Sticking to that pattern, applying the same operation to multiple values at once, we also can do what's called SWAR, SIMD Within A Register. Again, I realize, the code gets more dense. I probably wouldn't even be able right now to explain each and every single line, or it would take me a while. The idea here is, this idea of doing the same thing, like equals to multiple values all at once, we also can do this within a single variable. Because if you have 8 bytes, we also could see one long, that's 64 bits, that's also 8 bytes. We can apply the right level of bit level magic to a long value, and then actually apply this operation to all the 8 bytes. It's like bit level masking and shifting, and so on. That's what's happening here. There's a very nice blog post by Richard Startin, which shows you, step by step, how to do this, or how to use this to find the first zero byte in a string.</p>

<p>I have put the math up here on the right-hand side, so you actually can go and follow along, and you will see, this actually gives you the first zero byte in a long like that. That's SIMD Within A Register, SWAR. Now the interesting thing is, if you look at this code, something is missing here. Is somebody realizing what we don't have here? There's no ifs, there's no conditionals, no branching in that code. This is actually very relevant, because we need to remember how our CPUs actually work. If you look at how a CPU would take and go and execute our code, it always has this pipelined approach. Each instruction has this phase of, it's going to be fetched from memory, it's decoded, it's executed, and finally the result is written back. Now actually multiple of those things happen in parallel. While we decode our one instruction, the CPU will already go and fetch the next one. It's a pipelined parallelized approach.</p>

<p>Of course, in order for this to work, the CPU actually needs to know what is this next instruction, because otherwise we wouldn't know what to fetch. In order for it to know, we can't really have any ifs, because then we wouldn't know, which way will we go? Will we go left or right? If you have a way for expressing this problem in this branchless way, as we have seen it before, then this is very good, very beneficial for what's called the branch predictor in the CPU, so it always knows which are the next instructions. We never have this situation that we actually need to flush this pipeline because we took a wrong path in this predictive execution. Very relevant for that. I didn't really know much about those things, but people challenged it. One of the resources they employed a lot is this book, "Hacker's Delight". I recommend everybody to get this if this is interesting to you. Like this problem, like finding the first zero byte in a string, you can see it here. All those algorithms, routines are described in this book. If this is the thing which gets you excited, definitely check out, and get this book.</p>

<h2>Then, Disaster Struck</h2>

<p>Again, people were working on the challenge. It was going really well. They would send me pull requests every day, and I didn't expect that many people to participate. That's why I always went to the server and executed them manually. At some point, someday I woke up, I saw, that's the backlog of implementations which people had sent over the night, so let's say 10 PRs to review and to evaluate, and suddenly all those results were off. It was like twice as fast as before. I ran one of the implementations which I had run on the day before, and suddenly it was much faster. I was wondering, what's going on? What happened is, this workload, I had it initially on a virtual server. I thought, I'm smart. I try to be smart, so I get dedicated virtual CPU cores, so I won't have any noisy neighbors on that machine, this kind of thing.</p>

<p>What I didn't expect is that they would just go and move this workload to another machine. I don't know why. Maybe it was random. Maybe they saw there was lots of load in that machine. In any case, it just got moved to another host, which was faster than before. This, of course, was a big problem for me, because all the measurements which I had done so far, they were off and not comparable anymore. That was a problem. I was a bit desperate at that point in time. This is where the wonders of the community really were very apparent. Good things happened. I realized, I need to get a dedicated server so that this cannot happen again. I need to have a box, which I can use exclusively. As I was initially paying out of my own pocket for that, I thought, I don't want to go there. I don't want to spend €100. As I mentioned, Decodable, my employer, they stepped up to sponsor it.</p>

<p>Then, of course, I also needed help with maintaining that, because I'm not the big operations guy. I know a little bit about it. Then for that thing, you would, for instance, like to turn off the hyperthreading, or you would like to turn off turbo boost to have stable results. I wasn't really well-versed in doing those things, but the community came to help. In particular, René came to help. He offered his help to set up the thing. We had a call. I spoke to him. I had not known him. It was the first time I ever spoke to him, but we had a great phone conversation. In the end, he just sent me his SSH key. I uploaded his key to the machine, gave him the key to the kingdom, and then he was going and configuring everything the right way. There were multiple people, many people like that, who came and helped, because otherwise I just could not have done it.</p>

<h2>The 1BRC Community</h2>

<p>All this was a bit of a spontaneous thing. Of course, I put out some rules and how this should work. Then, I wasn't very prescriptive. Like, what is the value range? How long could station names be? What sort of UTF character planes and whatnot? I didn't really specify it. Of course, people asked, how long can a station name be? What kinds of characters can it contain, and so on? We had to nail down the rules and the boundaries of the challenge. Then people actually built a TCK, a test kit. It was actually a test suite which you then had to pass. Not only you want to be fast, you also want to be correct. People built this test suite, and it grew, actually, over time. Then whenever a new submission, a new entry came in, it, first of all, had to pass those tests. Then if it was valid, then I would go and evaluate it and take the runtime. This is how this looked like. You can see it here.</p>

<p>It had example files with measurements, and an expected file, what should be the result for that file? Then the test runner would go process the implementation against that set of files, and ensure that result is right. That's the test kit. The other thing, which also was very important as well, I had to run all those things on that machine. There's quite a few things which were related to that, like just making sure the machine is configured correctly. Then, I had five runs, and I want to discard fastest and slowest, all those things. Jason, here, he came to help and scripted all that. It was actually very interesting to see how he did it. I would really recommend to go to the repo, and just check out the shell scripts which exist, which are used for running those evaluations. It's a bit like a master class in terms of writing shell scripts, with very good error handling, colored output, all this good stuff to make it really easy and also safe to run those things. If you have to do shell scripting, definitely check out those scripts.</p>

<h2>Bookkeeping</h2>

<p>Then, let's talk about one more thing, which is also very relevant, and this is what I would call bookkeeping. If you remember the initial code I showed, I had this Java Streams implementation, and I used this collector for grouping the values into different buckets, per weather station name. People realized, that's another thing which we can optimize a lot ourselves. By intuition, you would use a HashMap for that. You would use the weather station name as the key in that HashMap. Java HashMap is a generic structure. It works well for a range of use cases. Then, if we want to get the most performance for one particular use case, then we may be better off implementing a bespoke, specific data structure ourselves. This is what we can see here. I think it might sound maybe scary, but actually it is not scary. It's relatively simple. What happens here? We say, we would like to keep track of the measurements per our station name. It's like a map, but it is backed by an array, so those buckets.</p>

<p>The idea now is, we take the hash key of our station name and we use this as the index within that array, and at that particular slot in the array, we will manage the aggregator object for a particular station name. We take the hash code, and we want to make sure we don't have an overflow. That's why we take it with logical end with the size of the array. We always have it well indexed in the array. Then we need to check, at that particular position in the array, is something there already? If nothing is there, that means, we have the first instance of a particular station in our hands, so the first value for Hamburg or the first value for Munich. We just go create this aggregator object there and store it at that particular offset in the array. That makes sense. The other situation, of course, is we go to the particular index in the array, and in all likelihood, something will be there already. If you have another value for the same station, something will be there already.</p>

<p>The problem is we don't know yet, is this actually the aggregator object for that particular key we have in our hands, or is it something else? Because multiple station names could have the same key. Which means, in that case, if something exists already at this particular array slot, you need to fall back and compare the actual name. Only if the incoming name is also the name of the aggregate object in that slot, then we can go and add the value to that. That's why it's called linear probing. Otherwise, we will just keep iterating in that array until we either have found a free slot, so then we can go install it there, or we have found the slot for the key which we have in our hands. I think it's relatively simple. Now for this particular case, this performs much better, actually, than what we could get with just using Java HashMap.</p>

<p>Of course, it depends a lot on the particular hash function here which we use to find that index. This is where it goes back to people really optimized a lot for the particular dataset, so they used hash functions which would be collision free for the particular dataset. This was a bit against what I had in mind, because the problem was this file, as I mentioned, it has a size of 13 gigabytes, and I just didn't have a good way for distributing 13 gigabytes to people out there. That's why, instead, they would have to generate it themselves. I had the data generator, and everybody could use this generator to create the file for themselves and then use it for their own testing purposes. The problem was, in this data generator, I had a specific key set. I had around 400 different station names with the idea being, that's just an example, but people took it very literally, and they optimized then a lot for those 400 station names. They used hash functions, which would not have any collisions, for those 400 names. Again, people will take advantage of everything they can.</p>

<p>The problem with all that is it also creates lots of work for me, because you cannot really prove the absence of hash collisions. Actually, whenever somebody sent in their implementation, I had to go and check out, do they actually handle this case, the two stations which would create the same key, and do they handle those collisions accordingly? Because otherwise, if you don't do this fall back to the slow case, you would be very fast, but you would be incorrect because you don't deal correctly with all possible names. This was a bit of a trap, which I set up for myself, and it meant I always had to check for that and actually ask people in the pull request template, if you have a custom map implementation, where do you deal with collisions? Then we would have conversations like we see here. How do you deal with hash collisions? I don't, that's why it's so fast. Then he would go and rework it. A big foot trap for myself.</p>

<h2>GraalVM: JIT and AOT Compiler</h2>

<p>Those are three big things, parallelization, then all this parsing with SIMD and SWAR, and custom hashmapping for bookkeeping. Those were recurring themes I saw again. Then there were more specific tricks, and I just wanted to mention a few of them. I just want to give you some inspiration of what exists. One thing which exists is the Epsilon garbage collector, which is a very interesting garbage collector because it doesn't collect any garbage. It's a no-op implementation. If you have your regular Java application, that would be not a good idea. Because you keep allocating objects, and if you don't do any GC, you will run out of heap space at some point. Here, people realized, we can actually implement this in a way that we don't do any allocations on our processing loop. We'll do a few allocations initially when bootstrapping the program, but then later on, no more objects get created. We just have arrays which we can reuse, like mutable structures, which we can just update.</p>

<p>Then we don't need any garbage collection, and we don't need any CPU cycles to be spent on garbage collection, which means we just can be a bit faster. Again, I think that's an interesting thing. Maybe, for instance, if you work on some CLI tool, short-lived thing, could be an interesting option to just disable the garbage collector and see how that goes. The other thing, which you can see here is people used a lot GraalVM. GraalVM, it's two things, really. It's an ahead-of-time compiler, so it will take your Java program and emit a native binary out of it. This has two essential advantages. First of all, it uses less memory. Secondly, it's very fast to start because it doesn't have to do class loading and the compilation and everything, this all happens at build time. This is fast to start if you have this native binary. Now to the level of results we got here, this actually mattered.</p>

<p>Initially, I thought saving a few hundred milliseconds on startup won't make a difference for processing 13 gigabytes of file, but actually it does make a difference. The AOT compiler and most of the fastest implementations, they actually used the AOT compiler with GraalVM. There's also the possibility to use this as a replacement for the just-in-time compiler in your JVM. You just can use it as a replacement for the C2 compiler. I'm not saying you should always do this. It depends a little bit on your particular workload and what you do, whether it's advantageous or not. In this case, this problem, it lends itself very well to that. People just by using GraalVM as the JIT compiler in the JVM, this gave them a nice improvement of like 5% or so. It's something I can recommend for you to try out, because it's essentially free. You just need to make sure you use a JVM or a Java distribution which has GraalVM available as the C2 compiler replacement. Then it's just means of saying, that's the JIT compiler I want to use, and off you go. Either it does something for you or does not.</p>

<h2>Further Tricks and Techniques</h2>

<p>A few other things, like unsafe, what I found interesting is the construct here on the right-hand side, because if you look at that, this is our inner processing loop. We have a scanner object. We try to take next values. We try to process them, and so on. What we have here is we have the same loop three times in a program which is written up in a sequential way. If you look at it, you would say, those three loops, they run one after another. What actually happens is, as the CPUs have multiple execution units, the compiler will figure out, this can actually be parallelized, because there is no data dependencies between those loops. This is what happens, we can take those loops and run them concurrently. I found it very interesting. Why is it three times? Empirically determined.</p>

<p>Thomas, who came up with this, he tried it two times. He tried to have the loop four times and three times it was just the fastest on that particular machine. It could be different in other machines. Of course, you see already here with all those things, this creates questions around maintainability. Because I already can see the junior guys joining the team, and they're like, "That's duplication. It's like the same code three times. Let me go and refactor it. Let me clean it up", and your optimization would be out of the window. You would want to put a comment there, don't go and refactor it into one loop. That's the consideration. Are those things worth it? Should you do it for your particular context? That's what you need to ask. I found this super interesting, that this is a thing.</p>

<h2>The Results</h2>

<p>You are really curious then, how fast were we in the end? This is the leaderboard with those 8 CPU cores I initially had. I had 8 CPU cores because that was what I had with this virtual server initially. When I moved to the dedicated box, I tried to be in the same ballpark. With those 8 cores, we went down to 1.5 seconds. I would not have expected that you could go that fast with Java, processing 13 gigabytes of input in 1.5 seconds. I found that pretty impressive. It gets better because I had this beefy server with 32 cores and 64 threads with hyperthreading. Of course, I would like to see, how fast can we go there? Then we go down to 300 milliseconds. To me, it's like doubly mind blowing. Super impressive. Also, people did this, as I mentioned, in other languages, other platforms, and Java really is very much at the top, so you wouldn't be substantially better with other platforms.</p>

<p>The other thing, there was another evaluation, which there was, because I mentioned I had this data generator with those 400-something station names, and people optimized a lot for that by choosing specific hashing functions and so on. Some people realized that actually, this was not my intention. I wanted to see, how fast can this be in general? Some people agreed with that view of the world. For those, we had another leaderboard where we actually had 10k different station names. As you can see here now, it's actually a bit slower, because you really cannot optimize that much for that dataset. Also, it's different people at the top here. If I go back, here we have Thomas Würthinger, and people who teamed up with him for the regular key set, and then for the 10k key set, it's other people. It's different tradeoffs, and you see how much this gets specific for that particular dataset.</p>

<h2>It's a Long Journey</h2>

<p>People worked on that for a long time. Again, the challenge went through the entire month of January. I didn't do much besides running it really. People like Thomas, who was the fastest in the end, he sent 10 PRs. There were other people who sent even more. The nice thing was, it was a community effort. People teamed up. As I mentioned before, like the fastest one, it was actually an implementation by three people who joined forces and they took inspiration. When people came up with particular tricks, then very quickly, the others would also go and adopt them into their own implementation. It was a long journey with many steps, and I would very much recommend to check this out.</p>

<p>This is, again, the implementation from Roy Van Rijn, who was the first one, because he kept this very nice log of all the things he did. You see how he progressed over time. If you go down at the very bottom, you will see, he started to struggle a bit because he did changes, and actually they were slower than what he had before. The problem was he was running on his Arm MacBook, which obviously has a different CPU with different characteristics than the machine I was running this on. He saw improvements locally, but it was actually faster on the evaluation machine. You can see it at the bottom, he went and tried to get an Intel MacBook, to have better odds to do something locally, which then also performs better on that machine. I found it really surprising to see this happening with Java, that we get down to this level where the particular CPU and even its generation would make a difference here.</p>

<h2>Should You Do Any of This?</h2>

<p>Should you do any of this? I touched on this already. It depends. If you work on an enterprise application, I know you deal with database I/O most of the times. Going to that level and trying to avoid CPU cycles in your business code probably isn't the best use of your time. Whereas if you were to work on such a challenge, then it might be an interesting thing. What I would recommend is, for instance, check out this implementation, because this is one order of magnitude faster than my baseline. This would run 20 seconds or so. It's still very well readable, and that's what I observed, like improving by one order of magnitude. We have still very well readable code. It's maintainable.</p>

<p>You don't have any pitfalls in this. It just makes sense. You are very much faster than before. Going down to the next order of magnitude, so going down to 1.5 seconds, this is where you do all the crazy mid-level magic, and you should be very conscious whether you want to do it or not. Maybe not in your regular enterprise application. If you participate in a challenge you want to win a coffee mug, then it might be a good idea. Or if you want to be hired into the GraalVM team, I just learned this the other day, actually, some person who goes by the name of Mary Kitty in the competition, he actually got hired into the GraalVM compiler team at Oracle.</p>

<h2>Wrap-Up, and Lessons Learned</h2>

<p>This was impacting the Java community, but then also people in other ecosystems, databases, in Snowflake they had a One Trillion Row Challenge. This really blew up and kept people busy for quite a while. There was this show and tell in the GitHub repo. You can go there and take a look at all those implementations in Rust, and OCaml, and all the good things I've never heard about, to see what they did in a very friendly, competitive way. Some stats, you can go to my blog post there, you will see how many PRs, and 1900 workflow runs, so quite a bit of work, 187 lines of comment in Aleksey's implementation. Really interesting to see. In terms of lessons learned there, if I ever want to do this again, I would have to be really prescriptive in terms of rules, automate more, and work with the community as it happened already today. Is Java slow? I think we have debunked that. I wouldn't really say so. You can go very fast. Will I do it again next year? We will see. So far, I don't really have a good problem which would lend itself to doing that.</p>




<p><big><strong>See more <a href="https://www.infoq.com/transcripts/presentations/">presentations with transcripts</a></strong></big></p>



                                </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Wasmer 5.0 (193 pts)]]></title>
            <link>https://wasmer.io/posts/introducing-wasmer-v5</link>
            <guid>41990326</guid>
            <pubDate>Tue, 29 Oct 2024 23:02:07 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://wasmer.io/posts/introducing-wasmer-v5">https://wasmer.io/posts/introducing-wasmer-v5</a>, See on <a href="https://news.ycombinator.com/item?id=41990326">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><p>We are thrilled to announce the release of <strong>Wasmer 5.0</strong>, the latest milestone in our journey to make WebAssembly the greatest tool for executing software anywhere.</p>
<p>This announcement comes packed with awesome new features:</p>
<ul>
<li>Experimental support for more backends: <strong>V8</strong>, <strong>Wasmi</strong> and <strong>WAMR</strong></li>
<li><strong>iOS</strong> support</li>
<li>Leaner codebase</li>
<li>Enhanced Performance</li>
<li>Upgraded Compilers (now using LLVM 18 and latest Cranelift)</li>
</ul>
<p>Do you like the new features? Don't wait and give us a ⭐️ on Github! <a href="https://github.com/wasmerio/wasmer">github.com/wasmerio/wasmer</a></p>
<hr>
<h2>Key Highlights</h2>
<h2>New experimental backends</h2>
<p>Some time ago <a href="https://github.com/wasmerio/wasmer/discussions/3839">we asked in Wasmer’s Community</a> which backend would you like to see Wasmer support next.</p>
<p>The responses were overwhelming: V8 (the engine behind Google’s Chrome Javascript runtime) was the most voted backend, with 56% of the votes. We learned from the poll results that interpreter support was also a desire from the community.</p>
<p><img src="https://wasmer.io/_next/image?url=https%3A%2F%2Fcdn.wasmer.io%2Fimages%2Fwasmer-backend-poll.original.png&amp;w=1920&amp;q=75" alt="Wasmer Backend Community Poll"></p>
<p>Well, the day has come. We have added support for more backends: V8, Wasmi and also WAMR. All of them are integrated via the <a href="https://github.com/WebAssembly/wasm-c-api">Wasm-C-API</a> , as they all share this external interface in common.</p>
<p>Thanks to the latest additions, now any interpreter or runtime that supports the Wasm-C-API spec can be easily integrated into Wasmer.</p>
<p>We expect that the V8 integration will allow bringing a great debugging experience via the V8 debugger and <a href="https://developer.chrome.com/docs/devtools/">Chrome Devtools</a>. But not only that, having V8 as a backend also means supporting WebAssembly Exceptions and Garbage Collection under the hood. Stay tuned for more news on this front soon.</p>
<p>As of today, Wasmer supports the following backends, so you can run WebAssembly using the Wasmer API in the following contexts:</p>
<ul>
<li><strong>Natively</strong> (via Wasmer native compilers)
<ul>
<li>Singlepass (<code>singlepass</code> feature): ideal for blockchains</li>
<li>Cranelift (<code>cranelift</code> feature): ideal for development</li>
<li>LLVM (<code>llvm</code> feature): ideal for production workloads</li>
</ul>
</li>
<li><strong>Browser</strong>: the browser’s underlying Wasm engine (<code>web</code> feature)
See <a href="https://github.com/wasmerio/wasmer-js">https://github.com/wasmerio/wasmer-js</a> for more info.</li>
<li><strong>JavascriptCore</strong>: JavascriptCore engine from Apple. Ideal if you want to use a lightweight and incredibly performant runtime in macOS (<code>jsc</code> feature)</li>
<li><strong>V8</strong>: Google’s JS V8 engine, ideal if you want to use Wasmer in iOS or Android (<code>v8</code> feature)</li>
<li><strong>Wasmi</strong>: one of the most optimal Rust WebAssembly interpreters. Ideal if you want to use Wasm in <code>nostd</code> environments or blockchains with a pure Rust codebase (<code>wasmi</code> feature)</li>
<li><strong>WAMR</strong>: (<code>wamr</code> feature) ideal for iOS</li>
</ul>
<p>So… how fast are each of the backends?</p>
<h3>Benchmarking the backends</h3>
<p>We have run an extensive set of benchmarks based on <a href="https://wasmi-labs.github.io/blog/posts/wasmi-v0.32/">Wasmi’s great benchmarking blogpost</a> to see how each of these backends behave for diverse scenarios. Here are our findings!</p>
<p><img src="https://wasmer.io/_next/image?url=https%3A%2F%2Fcdn.wasmer.io%2Fimages%2Fwasmer-5-time-argon2.original.png&amp;w=1920&amp;q=75" alt="Wasmer 5 Argon 2 benchmark"></p>
<p><img src="https://wasmer.io/_next/image?url=https%3A%2F%2Fcdn.wasmer.io%2Fimages%2Fwasmer-5-time-bulkops.original.png&amp;w=1920&amp;q=75" alt="Wasmer 5 Bulk Operations benchmark"></p>
<p><img src="https://wasmer.io/_next/image?url=https%3A%2F%2Fcdn.wasmer.io%2Fimages%2Fwasmer-5-time-counter.original.png&amp;w=1920&amp;q=75" alt="Wasmer 5 Counter benchmark"></p>
<p><img src="https://wasmer.io/_next/image?url=https%3A%2F%2Fcdn.wasmer.io%2Fimages%2Fwasmer-5-time-primes.original.png&amp;w=1920&amp;q=75" alt="Wasmer 5 Primes benchmark"></p>
<p><img src="https://wasmer.io/_next/image?url=https%3A%2F%2Fcdn.wasmer.io%2Fimages%2Fwasmer-5-time-fibonacci-iterative.original.png&amp;w=1920&amp;q=75" alt="Wasmer 5 Fibonacci (iterative) benchmark"></p>
<p><img src="https://wasmer.io/_next/image?url=https%3A%2F%2Fcdn.wasmer.io%2Fimages%2Fwasmer-5-time-fibonacci-recursive.original.png&amp;w=1920&amp;q=75" alt="Wasmer 5 Fibonacci (recursive) benchmark"></p>
<p><img src="https://wasmer.io/_next/image?url=https%3A%2F%2Fcdn.wasmer.io%2Fimages%2Fwasmer-5-time-matmul.original.png&amp;w=1920&amp;q=75" alt="Wasmer 5 Matmul benchmark"></p>
<h2>Full iOS Support via WAMR, Wasmi and V8 bindings</h2>
<p>For the first time, Wasmer brings WebAssembly to <strong>iOS</strong> devices through a new interpreted mode.</p>
<p><img src="https://wasmer.io/_next/image?url=https%3A%2F%2Fcdn.wasmer.io%2Fimages%2Fwasmer-5-ios-new.original.png&amp;w=1920&amp;q=75" alt="Wasmer 5 Running on iOS"></p>
<p>About a year ago we added support for <a href="https://wasmer.io/posts/wasmer-3_3-and-javascriptcore">JavacriptCore in Wasmer</a>, with the hope that it would enable a fast runtime on iOS (since the JIT would be unrestricted). Unfortunately, iOS capped the ability of using WebAssembly via JavascriptCore (since iOS 14).</p>
<p>Leveraging the capabilities of <strong>V8</strong>, <strong>Wasmi</strong> and <strong>WebAssembly Micro Runtime (WAMR)</strong>, developers can now run WebAssembly modules seamlessly on iOS thanks to Wasmer 5.0. No changes needed on their codebase. This opens up a world of possibilities for mobile development, enabling high-performance applications on Apple's ecosystem.</p>
<p>We want to thank <a href="https://www.holochain.org/">Holochain</a> as this work wouldn’t be possible without our partnership.</p>
<h2>Leaner codebase</h2>
<p>For the release of Wasmer 5.0 we have put an special emphasis on making Wasmer codebase as lean as possible, so we can develop new features even faster.</p>
<p>As part of this effort, we realized that:</p>
<ul>
<li>Emscripten bindings have been mostly unused in the last two years, mainly influenced by these two factors:
<ul>
<li>Emscripten emits code using WASI systemcalls under the hood when possible, removing the need for having special bindings for Emscripten</li>
<li><a href="https://wasix.org/">WASIX</a> helps to bridge the gap of the WASI systemcalls that are not supported (<code>threads</code>, <code>longjmp/setjmp</code>, <code>fork</code>, …)</li>
</ul>
</li>
<li>Some of the dependencies Wasmer used have been long unmaintained, or duplicated by newer and safer crates</li>
</ul>
<p>Because of that, we decided to drop support for Emscripten and trimmed up the dependencies resulting in a net result of <strong>20k lines of code deleted</strong> in the Wasmer codebase.</p>
<h2>Enhanced Performance</h2>
<p>Module deserialization now is up to 50% faster (that is, when you call <code>Module::deserialize</code> or when you run a module via <code>wasmer run</code>).</p>
<p>Performance is at the heart of Wasmer, and version 5.0 takes it to the next level. These improvements are leveraging essential updates on <strong>rkyv:</strong> the zero-copy deserialization library that we use to deserialize our Modules.</p>
<p>Here’s a benchmark of all the backends using latest Wasmer vs the latest release.</p>
<p><img src="https://wasmer.io/_next/image?url=https%3A%2F%2Fcdn.wasmer.io%2Fimages%2Fwasmer-5-time-deserialize.original.png&amp;w=1920&amp;q=75" alt="Wasmer 5 Time to deserialize a WebAssembly module"></p>
<h2>Upgraded Compilers: Cranelift  and LLVM 18</h2>
<p>The latest Cranelift integration results in significant runtime speed improvements, making your WebAssembly modules execute faster than ever before.</p>
<p>Wasmer 5.0 now includes the most recent version of <strong>LLVM (18)</strong>, ensuring that developers have access to the latest optimizations from the toolchain. The LLVM upgrade enhances compatibility and performance, providing a robust foundation for compiling and running complex WebAssembly modules.</p>
<p>On top of that, Wasmer 5.0 also ships with experimental <em>LoongAarch64</em> support.</p>
<p>We have also benchmarked <code>coremark</code> with the latest version of the compilers to see how they compare:
<img src="https://wasmer.io/_next/image?url=https%3A%2F%2Fcdn.wasmer.io%2Fimages%2Fwasmer-5-time-coremark.original.jpg&amp;w=1920&amp;q=75" alt="Wasmer 5 Coremark results"></p>
<blockquote>
<p>LLVM and Cranelift are about 8% faster in Wasmer v5.0 compared to v4.4.0</p>
</blockquote>
<h2>Getting Started with Wasmer 5.0</h2>
<p>Ready to dive in? Here's how you can start exploring the new features:</p>
<ul>
<li><strong>Download Wasmer 5.0</strong>: Get the latest version from our <a href="https://wasmer.io/">official website</a>.</li>
<li><strong>Update Your Projects</strong>: Upgrade your existing Wasmer projects to leverage the new capabilities.</li>
<li><strong>Explore the Documentation</strong>: Visit our updated docs for detailed guides and tutorials.</li>
<li><strong>Join the Community</strong>: Connect with other developers on our Discord server and share your experiences.</li>
</ul>
<h2>Looking Ahead</h2>
<p>Wasmer 5.0 is a significant step forward in our mission to empower developers thanks of the exciting possibilities that WebAssembly brings to the table. With iOS support, our pluggable backend architecture and the enhanced performance, the possibilities are now endless. We can't wait to see what you'll build next with Wasmer.</p>
<hr>
<p><strong>Stay Updated</strong></p>
<ul>
<li><strong>Website</strong>: <a href="https://wasmer.io/">wasmer.io</a></li>
<li><strong>GitHub</strong>: <a href="https://github.com/wasmerio/wasmer">github.com/wasmerio/wasmer</a></li>
<li><strong>Twitter</strong>: <a href="https://twitter.com/wasmerio">@wasmerio</a></li>
<li><strong>Discord</strong>: <a href="https://discord.gg/rWkMNStrEW">Join our community</a></li>
</ul>
<p>Thank you everyone for being part of the Wasmer journey!</p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[RIP botsin.space (191 pts)]]></title>
            <link>https://muffinlabs.com/posts/2024/10/29/10-29-rip-botsin-space/</link>
            <guid>41989511</guid>
            <pubDate>Tue, 29 Oct 2024 21:18:58 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://muffinlabs.com/posts/2024/10/29/10-29-rip-botsin-space/">https://muffinlabs.com/posts/2024/10/29/10-29-rip-botsin-space/</a>, See on <a href="https://news.ycombinator.com/item?id=41989511">Hacker News</a></p>
<div id="readability-page-1" class="page"><div class="page">
      <main>
        


<p>There's no easy way to put it, so here goes -- after a lot of consideration, I've made the hard (frankly, painful) decision to shut down botsin.space. TLDR: here's the plan:</p>
<ul>
<li>Effective immediately I'm shutting down new account signups</li>
<li>I will switch the site into read-only mode sometime not long after December 15th.</li>
<li>I'll do everything I can to help people migrate their accounts elsewhere, and/or generate archives.</li>
<li>I'll keep the site running in read-only mode at least into March of 2025, and if possible/needed I'll extend that as long as I can.</li>
</ul>
<h2>Why?</h2>
<p>I launched botsin.space in April of 2017, which honestly feels like it was about six thousand years ago. Originally I just wanted to play around with the fediverse and Mastodon. The oauth flow for creating a bot was messy, so I forked Mastodon and fixed it, deployed those changes to botsin.space, and invited people to create bots.</p>
<p>The server was popular with bot allies and artists, people who wanted to get RSS feeds onto the fediverse, as well as students and professors who wanted to work on coding projects or learn about federated social media. There have been some moderation challenges over the years, but to be honest those have never been all that considerable.</p>
<p>But botsin.space has always been a bit of an odd duck with a unique set of challenges. Over the years, the server has grown to have around a few thousand active accounts, which isn't all that many. However, they've generated something like 32 million statuses. Just to put that in perspective, mastodon.social has over 2 million users, who have generated around 110 million statuses. So the usage patterns are very different, and I think it's safe to say the the mastodon codebase is tuned for mastodon.social and not a weird freaky server like botsin.space.</p>
<p>I work on the internet professionally, use Rails at my day job, and server management is part of my job description, so I've been able to use my skills to keep botsin.space running on a relative shoestring budget. Until recently, the whole thing ran on one server. But that's not maintainable, and given that and some other concerns, I think that now is the time to retire the server.</p>
<p>There are four major expenses for botsin.space, in order from least to most expensive:</p>
<ol>
<li>My time. As long as I find managing the server rewarding, this is an expense I'm happy to pay.</li>
<li>Server costs. I've been able to be fairly cheap here until recently.</li>
<li>Database storage. The database for the server lives on a dedicated volume at Digital Ocean, and is currently around 191GB in size. Every time I need to increase the size of this volume, the expense goes up, and it's safe to assume that this will only continue to grow.</li>
<li>File storage and bandwidth. These expenses will also only get more expensive over time. File bandwidth is the #1 charge on the monthly server bill right now. I live in fear of an AI scraper figuring out how to scrape all of these files and bankrupting me overnight.</li>
</ol>
<p>Until recently, my thinking has been: "I'm cool with finding all sorts of weird tricks to keep the server going, and I'll worry about #3 and #4 someday in the future maybe lalalalala I can't hear you." But the recent Mastodon upgrade has caused a significant amount of performance degradation, and I think the only way to really solve it is going to be to throw a lot of money into hardware.</p>
<p>I should mention at this point that I've had a Patreon to help with server expenses, and I've also accepted Paypal donations, and I'm truly grateful for everyone who has ever sent me money to support the server.</p>
<p>However, even with the support, expenses have always outpaced the donations, and while that's been fine with me for a long time, it's not sustainable. I'm fortunate enough to have a career and life where I've been able to support botsin.space, but I can't do it forever, and as the expenses and challenges mount, I find myself thinking about things that I'd probably rather be doing with my time.</p>
<p>With a few exceptions, botsin.space isn't anyone's primary instance, and I've always been mindful of the fact that everyone who supports botsin.space financially has other places and people to think of also, and I am so thankful for the consideration. I hope that everyone who is currently supporting botsin.space finds another instance to support, there are a lot of great instances out there with vibrant communities that need all the help they can get to survive.</p>
<p>So, given two choices -- asking for more donations so I can pay for more hardware to keep the instance running, or retiring it and encouraging people to support more community-oriented instances, I'll choose the second option every time.</p>
<p>As I mentioned above, I'll be working to keep the server stable and running for as long as possible, to give people a chance to migrate their accounts, get archives, etc. If anyone has any questions, please feel free to contact me at <a href="https://muffin.industries/@colin">@colin@muffin.industries</a>. It's probably smarter to ping me there instead of at botsin.space, because it's more likely that your message will be delivered in a timely fashion.</p>
<p>I'd like to thank everyone who has ever run a bot on botsin.space and gotten joy out of it. I'd like to thank all the people who have ever shared their thanks or kind words with me online -- your support has meant the world to me. I'd like to thank all the #botALLY folks, who have been a constant source of inspiration and learning to me for over a decade. Finally, I'd like to thank Johanna, who has always been there for me &lt;3</p>


       </main>
    </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Hobby CAD, CNC machining, and resin casting (2015) (160 pts)]]></title>
            <link>https://lcamtuf.coredump.cx/gcnc/full/</link>
            <guid>41989322</guid>
            <pubDate>Tue, 29 Oct 2024 20:57:32 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://lcamtuf.coredump.cx/gcnc/full/">https://lcamtuf.coredump.cx/gcnc/full/</a>, See on <a href="https://news.ycombinator.com/item?id=41989322">Hacker News</a></p>
<div id="readability-page-1" class="page">


<p>A tutorial for getting top-notch results with benchtop CNC mills and modern polymers<br>
Copyright (C) 2013, 2014, 2015 by Michal Zalewski (<a href="mailto:lcamtuf@coredump.cx">lcamtuf@coredump.cx</a>)
</p>

<!-- START~1~Introduction~ -->

<h2><a name="1">1. Preface</a></h2>

<h3>1.1. The purpose of this guide</h3>

<p>
I'm a computer geek by day, and an occasional hobbyist robot builder by night. For most, the craft of
robotics requires either deep pockets, or a combination of outstanding manual skills and easy
access to a top-notch machine shop. Because of this, many urban-dwelling enthusiasts
tend to give up, resort to expensive and limiting
<a href="http://www.robotshop.com/en/robot-kits.html?general_is_pro=Yes">premade kits</a>, or
fall back to <a href="http://ribsngibs.com/images/GDR/Robot_06.jpg">junkyard-quality</a>
<a href="http://www.hotsolder.com/uploaded_images/robot-partial-796818.jpg">engineering</a>.
</p>

<p>
The simplest tasks are often the biggest challenge. Many can program a microcontroller; fewer folks know how to
make a simple actuated joint, a custom gearwheel, or a custom chassis for their toys. With 3D printers, we've been
promised a revolution in desktop manufacturing, but many fo the issues are more fundamental - having to do with
mastering CAD software or understanding materials science to make lightweight and durable parts. Meanwhile, on the
manufacturing side, a simple, affordable, and home-workshop-friendly solution - CNC machining coupled with resin
casting - is already within reach.
</p>

<p>
Around 2007, I took a <a href="https://lcamtuf.coredump.cx/rstory/">huge leap of faith</a>, decided to buy a small CNC mill
(Roland MDX-15), set up a resin casting workshop, and then engaged in a fair amount of trial and error to
understand the tech. Today, I can routinely crank out <a href="https://lcamtuf.coredump.cx/omni2/">remarkably cool</a> and precise designs
in no time, and with only minimal cost:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/intro-planetary.jpg">
<img src="https://lcamtuf.coredump.cx/gcnc/intro-omnibot.jpg">
</p>

<p>
This guide is more or less modular. If you're interested in buying a CNC mill, keep reading. If you already have one
and know how it works, or want to try the overall process with a 3D printer or other manufacturing
process, you can skip directly to the relevant part:
</p>

<ul>
<li> <p><b>Section 3:</b> <a href="https://lcamtuf.coredump.cx/gcnc/ch3/">A crash course in CAD and CAM</a>.</p>
</li><li> <p><b>Section 4:</b> <a href="https://lcamtuf.coredump.cx/gcnc/ch4/">A primer on high-performance casting resins and moldmaking work</a>.</p>
</li><li> <p><b>Section 5:</b> <a href="https://lcamtuf.coredump.cx/gcnc/ch5/">A library of components for electromechanical projects</a>.</p>
</li><li> <p><b>Section 6.1:</b> <a href="https://lcamtuf.coredump.cx/gcnc/ch6/">Simple part design techniques for optimal rigidity and strength</a>.</p>
</li><li> <p><b>Section 6.2:</b> <a href="https://lcamtuf.coredump.cx/gcnc/ch6/#6.2">An introduction to gear geometries and transmission systems</a>.</p>
</li></ul>

<h3>1.2. A bit on CNC machining, and how it compares to 3D printing</h3>

<p>
In basic terms, computer numerical control milling is a "subtractive" method for processing raw material (<i>workpiece</i>
or <i>stock</i>), usually with a drill-like rotating cutter (<a href="https://en.wikipedia.org/wiki/Endmill">end mill</a>),
through a set of computer-driven movements of the cutting head. You can think of it as a robot equipped
with a Dremel tool.
</p>

<p>
Some of the most basic CNC mills resemble a drill press on
steroids. A growing number of them is designed specifically for home and office uses,
and have more sophisticated looks - but still, in comparison with technologies such as
3D printing, which produces 3D shapes by additive deposition, CNC machining seems pretty savage.
</p>

<p>
In reality, the most common hobby 3D printing method - FDM, or fused deposition modeling - is difficult to use for
precision, high-quality parts. The extrusion process is finicky and dimensionally inaccurate; further, materials such as PLA
tend to exhibit poor mechanical strength. The advent of affordable SLA printers is poised to change this, but the new
technology is still in its infancy - and it is messy and excruciatingly slow. For now, CNC has an upper hand on four fronts:
</p>

<ul>

<li>

<p>
<b>Precision:</b> when I started working on the guide,
<a href="http://www.wired.com/images_blogs/gadgetlab/2009/08/makerbot-utah-teapot.jpg">this</a> was a good
result from a Makerbot FDM printer; and <a href="http://farm4.static.flickr.com/3487/3703543046_b9588e64b6.jpg">this</a> would be
a more common example. The technology has improved since, but it's still nowhere near WYSIWYG.
</p>

<p>
In contrast, CNC mills can achieve true mechanical resolutions of 5 µm (0.005 mm) in all axes, and produce silk smooth
surfaces for almost arbitrarily complex parts. Right now, the real-world accuracy of a $2,000 mill is usually difficult
to replicate with any printer that costs less than $20,000. In fact, even with very expensive printers, there tend to be significant
constraints on what you can make: features smaller than 0.7 mm in the X-Y plane, or under 0.1-0.2 mm in the Z axis, are often taboo.
</p>

</li><li><p><b>Choice of materials:</b> CNC machines work in cheap, commodity materials - anything from wax, to transparent plastics,
to PCBs, to wood, to plaster, to aluminum, to steel. 3D printers, on the other hand, are restricted to a small set of 
proprietary stock, and produce parts that are rarely suitable for demanding applications - chiefly due to poor strength.</p>

</li><li>

<p>
<b>Cost per part:</b> With the processes advocated in this guide, the cost of making a small part out of high strength,
engineering grade plastic, or from tough rubber, seldom exceeds 25 cents; the raw material hovers at about $15 per liter or so
(<a href="http://www.flickr.com/photos/candy-bottoms/sets/72157625850569320/detail/">this photo log</a> has a detailed price
breakdown).
</p>

</li><li><p><b>Speed:</b> A typical cutting process takes between 5 minutes and 3 hours on a medium size CNC mill. When it's done, it's done:
you don't need to remove intricate supports, wash, sandblast, polish, seal, or post-cure the part. Most additive technologies take much, much
longer to produce usable parts of similar size, and almost always require painstaking manual work to get rid of manufacturing
artifacts.</p>

</li></ul>

<p>
On the flip side, the fundamental advantage that 3D printers have over CNC mills is that they can often produce basic internal geometries 
inside enclosed parts - whereas milling can only process the areas for which there is a sufficient cutter clearance. It is not always trivial
to do that on low-cost 3D printers - and the constraint of CNC mills is seldom a big deal: almost everything can be split into halves,
rotated, or so. Still, it is a constraint, even if almost every mass-produced item - from 
iPads to soda bottles - copes with this reality in a graceful way.
</p>

<h3><a name="1.3">1.3. The virtues of resin casting</a></h3>

<p>
Resin casting is a nifty process that involves creating a mold, and then pouring a liquid, two-component polymer resin into the mold
cavity. Once the resin sets, the finished part is removed - and the mold can be used again. This method of replicating parts is
popular artists of all trades, but is seldom employed in amateur CNC or 3D printing work.
</p>

<p>
Despite sounding needlessly complicated, it's a fantastic addition to any DIY workshop. It offers some interesting
advantages over directly machining (or printing, or hand-carving) the desired shape:
</p>

<ul>

<li>

<p>
<b>You can use just about any material, including some truly exotic choices.</b> You can master the workflow for one easily-shaped
tooling material - perhaps even clay! - and then make the final part out of rubber, glass-filled
composite, low-melt metal, or concrete laced with rocks.
</p>

</li><li><p><b>You can customize the apperance of the part, practically for free.</b>
There is no need to spend money on a variety of differently colored materials, you can just add several drops of dye.</p>

</li><li><p><b>You can replicate and tweak parts easily.</b> You can quickly make 50 identical gearwheels, instantly replicate a broken
part, or change the mechanical properties of a component on the go.</p>

</li><li><p><b>You save materials and time.</b> Directly machining a part out of aluminum or plastic involves starting with a rectangular
stock and then removing most of it. Moldmaking is considerably more efficient, with less waste and faster cycle times.</p>

</li></ul>

<p>
Although you can follow this guide just for the CNC bits, some of the content is geared toward that process - and it's probably
worth your time.
</p>

<h3>1.4. But how much will this <i>really</i> cost me?</h3>

<p>
As with any hobby, sky is the limit! That said, if you want to get good results on a budget, the breakdown of
expenses is roughly this:
</p>

<ul>

<li><p><b>CNC mill:</b> as little as $1,000 to $3,000 for an entry-level unit; around $150 for end mills and collets.</p>

</li><li><p><b>CAD / CAM software:</b> $0 to $1,000, depending on taste. Free of charge options are
available, and work reasonably well.</p>

</li><li><p><b>Resin casting setup:</b> $100 for a vacuum pump; $70 for chamber and hoses; 
less than $100 for mold releases, cups, and other auxiliary supplies.</p>

</li><li><p><b>Media for moldmaking work:</b> $230 for a giant (150 x 50 cm) prototyping board;
$120 for two gallons of polyurethane resin; $130 for a pail of silicone. This should last for at least
a year.</p>

</li><li><p><b>Other tools:</b> $70 for a micron-resolution micrometer; $50 for a micron-resolution dial
indicator; $40 for a simple magnifier.</p>

</li></ul>

<p>
For the processes advocated in this guide, the ongoing maintenance costs for a CNC mill are
negligible: after several thousand hours of machining, you may have to replace several bearings or
spindle motor; cutters should last for hundreds of hours, too. The savings add up quickly,
especially if you are already paying for specialty or made-to-order parts.
</p>

<!-- START~2~Setting up a CNC mill~ -->

<h2><a name="2">2. Setting up a CNC mill</a></h2>

<p>
Okay, still interested? Let's dive in, then. The first "proper" section of this guide deals
with shopping for a mill and understanding its operating characteristics; picking the appropriate
cutting tools; and monitoring the performance of your setup to achieve perfect results every
time.
</p>

<p>
Again, if you're using another manufacturing process and are interested strictly in the CAD tutorial
or the resin casting bits, feel free to skip ahead.
</p>

<h3>2.1. Picking the right machine</h3>

<p>
Some purists make a distinction between what they call "CNC routers", suited chiefly for working in wood and plastics,
and "true" CNC mills, designed for machining steel. This guide will not dwell on this; almost
any CNC machine can handle almost any material, albeit not always as quickly as a beefier mill. Just as importantly,
the focus on metal is usually a distraction. Unless you're making car parts or firearms, machining metals isn't
cost-effective and in home workshops, isn't particularly fun.
</p>

<p>
With this in mind: gneral purpose, benchtop-sized CNC mills start at around $600 and go up to $20,000 or so.
There are numerous manufacturers of benchtop CNC mills around the world; examples include
<a href="https://shop.carbide3d.com/products/nomad-3">Carbide 3D</a>,
<a href="http://www.lagunatools.com/">Laguna Tools</a>,
<a href="http://www.rolanddga.com/">Roland DG</a>,
<a href="http://www.taigtools.com/">Taig</a>,
<a href="http://littlemachineshop.com/">LittleMachineShop</a>,
<a href="https://probotix.com/FireBall_v90_cnc_router_kit/">Probotix</a>, and many more.
Some folks have luck with <a href="http://www.ebay.com/sch/i.html?_from=R40&amp;_trksid=p2050601.m570.l1313.TR11.TRC1.A0.H0.Xcnc+3020&amp;_nkw=cnc+3020&amp;_sacat=0">ultra-low cost mills
made in China</a>, too, although this is hit-and-miss.
</p>

<p>
When shopping for a pre-made system, there are several key characteristics to pay
attention to; let's have a look at them, and use them as an excuse to discuss some
of the inner workings of CNC milling jobs.
</p>

<h4>2.1.1. Number of axes</h4>

<p>
This is perhaps the most fundamental quality of any CNC mill. In the most basic
design, the cutting head can move in three directions - X, Y, and Z - and the tool
itself always points down, aligned with the Z axis. In this setup, the machine can
only machine shapes that can be represented using a two-dimensional "depth map"
projected onto the workpiece: the cutter may descend lower for some X-Y coordinates,
and move up for others, but it will not enter the workpiece from any other side.
This video is a pretty good illustration of the process:
</p>

<p>
<iframe width="640" height="360" src="https://www.youtube.com/embed/4Fikcxmnn8Q?rel=0" frameborder="0"></iframe>
</p>

<p>
In this machining mode, the machinable geometries are outlined here:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/00-3axis.jpg">
</p>

<p>
<b>Note:</b> CAM applications are designed to fail safely in regard to part geometry; that is,
if a cavity on the part can't be reached without going through an area that isn't supposed
to be cut, the problematic region won't be machined at all. The gray regions in the two workpieces on
the right correspond to the material that will be left in place.
</p>

<p>
The limitations of three-axis machining may seem severe, but seldom truly are. Every
section of an industrial injection mold or a metal forming die typically needs to be
a depth projection anyway, so that the processed material could be pulled out of it
easily. Even in direct machining, it is common to simply flip the workpiece with the
aid of registration pins.
<a href="https://www.youtube.com/watch?v=0qmZMq8bbn4">This video</a> illustrates
the manual rotation process fairly well.
</p>

<p>
That said, there are some shapes that truly benefit from automated, multi-directional
machining; this includes exotic types of gears (helical, herringbone, and worm geometries),
screws / bolts, and certain categories of jewelry (say, rings). For these uses, some
CNC mills come with additional rotary "axes": the so-called A axis corresponds to
rotating the workpiece around the X axis
 (<a href="https://www.youtube.com/watch?v=bGaGs-wG2cQ">see video</a>); B axis
stands for rotation around Y; and C axis is the rotation around Z. The four-axis
AXYZ setup is the most common one.
</p>

<p>
The premium for fourth axis starts at around $100 for manual indexers (a precision
rotary chuck that holds the workpiece, but where the angle needs to be dialed in manually);
and from $500-$1,000 for computer controlled units.
</p>

<p>
<span>What to buy:</span> 99% of moldmaking work will not appreciably benefit from 
a fourth axis, so three axes are usually fine. You may want to get a mill where
fourth axis is an option, though, especially if you are also planning to projects such as jewelry
or artistic figurines.
</p>

<h4>2.1.2. Mechanical movement ranges</h4>

<p>
Greater X-Y-Z tool movement ranges translate to the ability to make larger parts in a single pass. It's important
to pick a mill that won't get in the way of your imagination - but to make this call, you need to calibrate your
expectations sensibly.
</p>

<p>
As an extreme example, let's consider building a man-sized biped robot. You don't need a man-sized
mill for that job - for at least three reasons:
</p>

<ul>

<li><p>Although the entire project would be obviously pretty big, virtually all the individual parts
should be much smaller. In fact, most of the components will likely fall into the range of
1 to 30 cm.</p>

</li><li><p>Any oversized part can be broken into sequentially machined segments. If you are using the
resin casting process, this scales up almost arbitrarily; in other types of work, you will see
some (usually modest) constraints.</p>

</li><li><p>Many large and simple elements do not have to be machined at all; for example, it would be sensible to
make the frame out of pipes or metal rods sawed to the desired length, and then simply machine custom
connectors and joints that hold the frame together.</p>

</li></ul>

<p>
<span>What to buy:</span> do your own math. In my experience, about 15 x 10 cm in the X-Y plane is a good starting
point, and about 30 x 20 cm will accommodate almost any medium-size robotic job. In the Z axis, you will
probably not need more than 4 cm or so; and going over 8 cm is usually pointless. Whatever you do,
do not confuse movement ranges with table dimensions, though.
</p>

<h4>2.1.3. Use of a specialized spindle</h4>

<p>
Spindle - the part that connects the
motor and the rotating tool - has a profound impact on the accuracy of any CNC mill. Its role is to ensure
that the rotation of the tool is highly concentric and vibration-free,
and that it stays this way under load. If the whole rig is not perfectly centered, you may end up with a
situation such as this:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/01-runout.jpg">
</p>

<p>
The total amount of back-and-forth wobble - in other words, the difference between the intended and effective
diameter of the tool - is known as <i>total indicated runout</i>, or TIR. High TIR will not only affect the
dimensional accuracy of machined parts, but will also ruin surface finish, and prematurely wear the tool. In fact,
the effect is pretty dramatic: in some materials, eccentricity of 0.01 mm can reduce tool life by 50%.
</p>

<p>
Proper CNC spindles are usually long, round or rectangular blocks of metal with precision ball bearings mounted
on both ends (and often pre-tensioned with a spring). Inside, there is a heavy-duty rotating shaft that couples 
the motor belt drive system to the tool holder. With quality spindles, TIR usually can be kept below 2 µm.
</p>

<p>
Some of the low-end manufacturers don't bother with a proper spindle, however; the most common example of this
are CNC mills that use repurposed <a href="http://farm4.static.flickr.com/3288/2988715636_7f8a9054d8.jpg">manual
rotary tools</a>. These cases are a bit of a gamble: some of them may have still somewhat bearable
TIR in the vicinity of 0.01 mm - but some will be as bad as 0.10 mm, which makes them fairly bad for
precision work. Runout aside, you also can't be sure if the tool is perfectly aligned with the Z axis or not;
if it isn't, that opens a yet another can of worms.
</p>

<p><b>Note:</b> to put all these numbers in perspective, 0.10 mm is roughly the diameter of a human hair; level differences of
this magnitude can be easily felt when sliding your finger across a hard surface. Notches down to about 0.05 mm
can be easily seen on smooth but matte finishes - and on glossy surfaces, the threshold may be closer to 0.01 mm or so.</p>

<p>
<span>What to buy:</span> try to avoid CNC mills without real spindles; if you need to get one, ask the manufacturer
about TIR. If they are not sure, it's an obvious red flag: the parameter can be trivially measured with a 
<a href="http://www.ebay.com/sch/i.html?_nkw=micron+dial+indicator">$50 tool</a>, and is one of the most 
rudimentary things to examine when designing a mill. Note that there are 
<a href="http://www.wolfgangengineering.com/ww-650-spindle..html">aftermarket spindles</a> that can be fitted into
certain mills, though!
</p>

<h4>2.1.4. Movement precision</h4>

<p>
There are many factors that contribute to the real-world precision of a CNC mill, but one of the most
important aspects is repeat accuracy: the ability to return to the same position over and over again.
Along with spindle characteristics, this quality has a tremendous impact on surface finish, and on the
dimensional accuracy of small parts.
</p>

<p>
Repeat accuracy is affected chiefly by two things:
</p>

<ul>

<li><p><b>Backlash:</b> many types of transmissions will have some amount of play, which often leads to
imperfections in positioning. This play tends to be greater in CNC mills that use stepper motors or
<a href="https://en.wikipedia.org/wiki/Leadscrew">acme screw drives</a>; and lower with servo motors
and <a href="https://en.wikipedia.org/wiki/Ball_screw">ball screws</a>.</p>

</li><li><p><b>Mill rigidity:</b> machines that use low-cost materials (HDPE, plywood, sheet metal)
to hold everything together, rely on rudimentary slides to support the moving parts, or use timing
belts as a motion system,
will deflect more significantly under load, or in response to own acceleration and deceleration.
This problem is much less pronounced in mills with heavy-duty cast frames and ball-bearing
linear ways.</p>

</li></ul>

<p>
Unfortunately, there is no widely accepted standard for testing repeat accuracy; many manufacturers
don't bother to advertise it, and others test it with varying levels of honesty. In fact,
the good guys will give you a figure that represents the worst-case, momentary deviation following
a rapid long-distance movement - but that's not really representative of most types of fine work with
sub-millimeter tools.
</p>

<p>
Now, don't despair: the good news is that most of the commercially available mills are
actually pretty good in this department, especially when moving slower and doing precision cuts
in easily machinable stock. You can expect many entry-level mills to conduct themselves within 0.02 mm
or better during normal work; more expensive units with ball screws and servo motors will probably stay
around 2-5 µm.
</p>

<p>
Accuracy aside, mechanical resolution is the other important piece of the puzzle. Stepper or servo motors
in a CNC mill can assume only a certain number of positions per turn, and that translates to a specific
minimum distance by which the table or the cutting head can be moved around. Insufficient mechanical
resolution means that the mill will have difficulty smoothly approximating certain curves, and may
end up producing unattractive finish.
</p>

<p>
<span>What to buy:</span> The basic rule is that you should not expect a plywood-based contraption
with acme screws to reach 1 µm repeat accuracy. If the manufacturer advertises an improbable
value, ask them to explain. If they advertise a suspiciously high figure (over 0.1 mm or so), be
wary, too. As for the mechanical resolution: look for 5 µm or better.
</p>

<h4>2.1.5. Machining speeds</h4>

<p>
Time is money. When it comes to CNC machining, the time needed to complete a job is to a
surprising extent dependent on your skill and the capabilities of your software - but with
a skilled operator and good toolpath decisions, the final part of the equation is always 
the performance of the mill itself.
</p>

<p>
To understand how the mill's performance is tied to the numbers you see in the datasheet,
it is helpful to look at the geometry of a typical end mill. Upon closer inspection, the tool 
closely resembles a drill: it consists of a round shaft with several blades (flutes) wrapped
around it in a spiral fashion. As opposed to a drill, however, these flutes have a sharp,
exposed edge running along their entire length; this is because the bulk of their work is meant
to be done by moving sideways. This is how it looks from the top:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/02-endmill-flutes.jpg">
</p>

<p>
Even in the most easily machinable material imaginable, the cutter is able to scoop away only a
certain amount of swarf per turn - just enough to fit under the flute. If you exceed that capacity,
you will end up dragging a clogged, non-cutting tool across the workpiece - which ends with one
or the other eventually giving up.
</p>

<p>
For every material and cutter geometry, there is an optimal ratio of linear speed and cutter
RPM that leads to efficient, high-quality machining.
This is often expressed as <i>feed per tooth</i>. In plastics and similar materials, the ideal values are:
</p>

<ul>

<li><p>Up to <b>0.1-0.2 mm</b> for larger tools used to do the bulk of material
removal in every cutting job. These tools frequently have four flutes, so this translates to
0.4-0.8 mm per turn.</p>

</li><li><p>Down to <b>0.01 mm</b> or less for sub-miniature, 2-flute cutters used to reproduce minutiae
detail (0.02 mm per turn).</p>

</li></ul>

<p>
In practical terms, it's healthy to aim for mills where the ratio between maximum movement
speed (mm/min) and maximum RPM hovers around 0.4 to 0.8 for optimum performance during rough
cutting. At the same time, there is also some value in shopping for the highest maximum RPM you
can get - as it lets you move faster during the precision finishing steps.
</p>

<p>
Of course, there are some gotchas:
</p>

<ul>

<li><p>Very high spindle speeds tend to be problematic; going over 25,000 RPM or so
may cause problems with heat dissipation, tool oscillation, and so on.</p>

</li><li><p>High traverse speed can help even without high RPM. This is because
certain types of cutting jobs
involve a fair amount of rapid, non-cutting movements between various locations to be
machined. Good CAM applications should know to avoid excess travel, but not all CAM
applications are very good.</p>

</li><li><p>Acceleration matters. Fast-moving mills need to be good at accelerating
and braking to fully utilize their capabilities during series of short, stop-and-go movements
that are often involved in CNC work. Rates of at least 0.1 G (~1 m/s²) are desirable in
any mill capable of four-digit speeds.</p>

</li></ul>

<p>
<span>What to buy:</span> at least 6,000 RPM is nice; and if the aforementioned speed ratio
is favorable, there are no real downsides to going up to 20,000 RPM. Maximum movement speed,
in mm/min, should be ideally at least 6-10 times the movement range, so that it doesn't
take more than several seconds to traverse the table.
</p>

<h4>2.1.6. Tool sensor support</h4>

<p>
Spare for some pathological situations, the mill is intrinsically aware of the position of
its spindle at any given time; but the actual cutting action takes place beneath the spindle - 
at a distance dictated by how far the tool sticks out from its holder.
</p>

<p>
And here lies the problem: most toolholding systems do not allow you to precisely preset
tool extension length, or to maintain it when you replace the cutter. If you switch the tool
in the middle of a machining process, and don't compensate for the difference, the results
will be off; in fact, the tool may unexpectedly hit an uncut area and break.
</p>

<p>
There are several manual tricks that can be used to work around this issue. One
of them is to place a thin strip of paper or foil in a fixed reference location, and
then slowly lower the tool until the strip gets caught between the cutter and whatever happens
to be underneath. By comparing the Z position of the spindle at that point
with the reading obtained for the previous tool, the appropriate offset can be calculated
and communicated to the machine. But of course, this technique is somewhat inconvenient, and
accurate only to perhaps 0.05 mm.
</p>

<p>
A better approach is to incorporate a tool height sensor into the mill. The sensor can be just
a flat block of precisely machined metal; the mill automatically lowers the tool onto
the sensor until contact is made - which, in the simplest design, is detected by noticing
the flow of current between the probe and spindle body. The accuracy of this approach is 
often better than 0.01 mm. More complex (and costly) solutions involving optical sensors can also be
used.
</p>

<p>
<span>What to buy:</span> try to find a mill that has a built-in sensor, or can be equipped with
one. Failing this, you can always rig a manual tester that uses the same operating principle,
and simply illuminates a LED.
</p>

<h4>2.1.7. Tool mounting method</h4>

<p>
The spindle must be terminated with some sort of a tool holding device. This can be a direct system,
where the tool slides into the spindle assembly with no intermediate components; a collet-based approach,
where the spindle accepts a small clamping device that actually grips the cutter and is tightened with a nut;
or a model where the spindle has a large tapered bore that accepts standalone toolholders used by automatic
tool changers.
</p>

<p>
Leaving automatic tool changers and exotic cutters aside, the simplest way to clamp an endmill is to use a
fixed-diameter opening, be it using a set screw or thermal expansion (shrink-fit). The solution can be
very accurate, but is also quite cumbersome when it comes to tool changes. For example, on a Roland MDX-15 mill, you have to replace
the entire spindle assembly to switch between two different diameters of the shank.
</p>

<p>
On the opposite end of the spectrum, you have jaw chucks, similar to the solution seen in power drills.
They can grip a wide range of tool diameters, but tend to suffer from poor eccentricity, and TIR is seldom
better than 0.2 mm. For precision work and rigid CNC machines, that's a bad deal.
</p>

<p>
A reasonable middle ground is a system that accommodates fixed-diameter collets fastened with a nut; 
the spindle has a single taper to accommodate a family of collets (e.g., ER16), and every collet is
precision-ground to hold a specific diameter of a tool. Because collet changes are quick and the collets
themselves are inexpensive, this is a good balance between accuracy and ease of use. The ER system is
a particularly popular and dependable choice.

</p><p>
<span>What to buy:</span> If you can get ER or a similar collet-based system, go for it. Otherwise, just make sure that the
toolholding system is versatile enough to accommodate common shank sizes (3, 4, and 6 mm for metric
cutters; 1/8" and 1/4" for imperial system tools), and will be sufficiently precise for your needs.
</p>

<h4>2.1.8. Availability of CAM software</h4>

<p>
Manually programming your CNC machine is about as much fun as building a steamboat out of toothpicks.
For a higher-level approach, you need to turn to
<a href="https://en.wikipedia.org/wiki/Computer-aided_manufacturing">CAM software</a>:
it automatically analyzes the provided geometry (created with any 3D modelling application) and converts
it to a set of paths that need to be retraced by the tool to approximate the desired shape. Once these
toolpaths are ready, the software then breaks them down into a sequence of painfully basic instructions
that actually make sense to the controller embedded in the mill; say, <code>"set speed to 12,000 RPM"</code> or 
<code>"move cutter to X = 10.245, Y = 5.000, Z = -2.000"</code>.
</p>

<p>
The toolpath generation stage is largely hardware-agnostic; but the program generation one isn't. It's good to 
shop for a machine that speaks a common and well-documented language - or, lacking this, is popular enough to 
be supported by some of the best-known CAM apps. Keep in mind that even if the manufacturer bundles the
mill with some starter software, you don't want to be left out in the cold if the application one day
refuses to work with your new PC - or if it simply turns out to be of poor quality.
</p>

<p>
The most common quasi-standard language used by almost all CNC mills is
called <a href="https://en.wikipedia.org/wiki/G-code">G-code</a> (aka "NC"). Calling it a real standard
may be a stretch: there are very significant variations in how the syntax is implemented by the
manufacturers. Still, having support for G-code spells rudimentary compatibility, or at least easy integration,
with almost any CAM application on the market. For other languages, this is not always given.
</p>

<p>
<span>What to buy:</span> check if the mill is supported by common third-party packages 
(<a href="http://www.deskproto.com/">Deskproto</a>,
<a href="http://www.mecsoft.com/">VisualMILL</a>,
<a href="http://www.madcamcnc.com/">madCAM</a>,
<a href="http://www.grzsoftware.com/landing/">MeshCAM</a>,
<a href="http://www.picasoft.com/">Mayka</a>, etc); if it's not, and if it speaks something else
than a clearly documented variant of G-code, be wary.
</p>

<h4>2.1.9. Size, weight, power needs</h4>

<p>
We're almost done: the last thing to do is a quick reality check. Benchtop mills span from units no larger
than an inkjet printer, to ones weighing in excess of 200 kg and taking up almost 1 x 1 m of desk space.
When shopping for the larger models, be sure to account for their physical characteristics, and make sure
you have a way to get them in your workshop to begin with (some doors are barely 70 cm wide).
</p>

<p>
For heavier mills, it is also important to have a piece of sturdy furniture; it's not just the static
load that you have to worry about, as the machine may also produce horizontal shear forces due to
acceleration and deceleration of the cutting head. Not every wobbly desk from Ikea can handle
that - but any proper workbench should.
</p>

<p>
Benchtop mills usually run on standard, single-phase 110 / 230 VAC power supply, but of course, make sure
to double-check. They may require several amps in peak, so you don't want them to share a single
circuit with a vacuum cleaner, an electric kettle, or a space heater - especially in an older home.
</p>

<h4>2.1.10. And now, all the things you don't have to worry about</h4>

<p>
Okay - that sums up the list of parameters that are worth looking at. There are also
some characteristics that sound important, but usually aren't - so to help you decide, here's a
quick list to consult when in doubt:
</p>

<ul>

<li><p><b>Positioning accuracy:</b> this value tells you how true the machine's idea of a millimeter is to
a calibrated reference. The difference is usually negligible, and even if it wasn't, you can compensate in
software without any special effort.</p>

</li><li><p><b>Origin reproducibility:</b> this indicates how good the machine is about resuming the same starting
location after being power cycled. Not particularly important in normal work, unless your power goes out in
the middle of a cutting job.</p>

</li><li><p><b>Software resolution:</b> unlikely to be lower than mechanical resolution, and fairly
meaningless if it's higher.</p>

</li><li><p><b>Motor power:</b> spindle motors delivering as little as 75-100 W should be perfectly sufficient for the
processes advocated in this guide. More powerful mills are beneficial chiefly in heavy-duty metal work.</p>

</li><li><p><b>Table size:</b> easy to confuse with the actual machinable area, but nowhere near as important. The
difference between a 2 cm margin and a 10 cm one usually doesn't matter at all.</p>

</li><li><p><b>List of millable materials:</b> every mill should be able to cope with a wide variety of materials; don't
read too much into the list provided by the manufacturer.</p>

</li><li><p><b>Tool changer (ATC):</b> it's a convenient device for unattended jobs, but it's usually not worth
the expense in hobby work. It's nice, but unless you have money burning a hole in your pocket, you can do without it.</p>

</li><li><p><b>Contact scanner accessory:</b> contact scanning heads are a gadget available for some CNC mills, 
but chances are, you will use them to scan a couple of coins or pendants, and then lose all interest. For
reverse engineering of mecanical designs, just using a caliper works a lot better, and takes less time.</p>

</li><li><p><b>Noise ratings:</b> probably not what you think. These parameters describe the noise produced by the
mill when in standby mode (spindle off); or when operating, but not making contact with a workpiece. 
Benchtop mills are fairly quiet in no-load conditions; and even the most compact and underpowered
devices can be pretty loud when actually machining something.</p>
<p>
The actual noise level will range from barely perceptible when working in waxes or using sub-mm cutters,
to pretty unpleasant when rapidly plowing through metal with a large-diameter tool. In fact, just imagine
the noise made by a saw or a drill.
</p>

</li></ul>

<p>
Well, that's probably it. If you spot any other puzzling parameters, please let me know.
</p>

<h4>2.1.11. So, which one should I buy?!</h4>

<p>
That really depends on your budget and the scale of the projects you want to be working on. The manufacturers listed
2.1 are a starting point, but the market is evolving rapidly; I had some specific recommendations listed here in the
initial version of the guide, but within two years, most of them were out of date. My best advice is to run some
Google searches; if in doubt, check out forums such as /r/hobbycnc on Reddit, or simply drop me a mail.
</p>

<h3>2.2. Stocking up on end mills</h3>

<p>
Ordering a CNC machine? Well, the next stop is getting some cutters. The selection available on the
market is quite overwhelming, so to save you time and money, let's talk about some of the properties
that set these tools apart. Oh, before we dive in...
here's a drawing of a typical end mill, and all the lingo you will have to memorize soon:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/03-endmill-view.jpg">
</p>

<p>All right - so here are the differences you will see:</p>

<ul>

<li><p><b>Material:</b> end mills are made either out of cobalt steel alloys (known as <i>high speed
steel</i>, or HSS), or from tungsten carbide in a cobalt lattice (colloquially shortened to "carbide").
The latter option is considerably harder, more rigid, and more wear-resistant - and for the tool sizes
we are interested in, carries a  relatively small premium (30% or so).
</p>

<p><span>What to buy:</span> Stick to carbide.</p>

</li><li><p><b>Coatings:</b> carbide cutters may be further coated with ceramics such as
<a href="https://en.wikipedia.org/wiki/TiAlN">titanium aluminum nitride</a> (TiAlN, aka AlTiN),
titanium nitride (TiN), titanium carbon nitride (TiCN), or with amorphous or crystalline diamond.
The coatings tend to improve hardness or reduce friction; the bluish-gray TiAlN coating is probably
the most common one. In non-abrasive plastics, this particular coating doesn't have a very pronounced
effect, but it extends tool life by some 20% or so - and the cost is only 10% extra, so it's not a bad
deal.</p>

<p>
Of course, in some situations, tool wear is a more pronounced concern; for example, glass or carbon fiber
composites can leave a mark on carbide tools in a matter of hours. In the same vein, in ultra-precise micromachining,
you may have to worry even about early-stage wear, because it can subtly affect the dimensions of the tool.
In such cases, amorphous "diamond" coatings offer more definite benefits compared to TiAlN, often extending
tool life by a factor of 2-3x. Alas, the coating at a 30%-40% premium and is available only for some tools.
(True, crystalline diamond works, too, but costs a lot more and is reserved for more demanding jobs.)
</p>

<p><span>What to buy:</span> If you're on a tight budget, skip any coatings and pocket the change.
Otherwise, TiAlN or amorphous diamond is probably not a complete waste of money, although you can still skip it
on your first set of "training wheel" tools.</p>

</li><li><p><b>Tip geometry:</b> precision machining operations in plastics will almost always rely on
"vanilla", single-end finishing tools with no chip-breaking ridges, no taper, no coolant outlets, and so forth.
The tips of these standard tools come in three basic flavors:</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/04-endmill-shapes.jpg">
</p>

<p>
Flat tip cutters are the primary tool in all sorts of mechanical work. Ball nose cutters come
handy when you need to reproduce gentle slopes and other organic designs. And lastly, corner radius
cutters offer a compromise design that combines 90° arcs in the corners, and a flat mid-section
- but you can safely ignore them until you have a specific itch to scratch. About the only other type
of a cutter worth mentioning here are conical engraving cutters, which look
<a href="http://www.harveytool.com/prod/Engraving-Cutters/Other-Specialty-Profiles/Harvey-Tool-Specialty-Carbide-Cutting-Tools---End-Mills_168/Carbide-Engraving-Cutters--Pointed---90--Included_87.aspx">like this</a>;
these are useful for making very fine but shallow cuts, for example when machining traces on a PCB.</p>

<p>
<span>What to buy:</span> build a competent collection of flat tip cutters first. If you want to experiment,
grab one or two ball nose cutters, but you probably won't be using them that much in non-artistic work.
</p>

</li><li><p><b>Cutting diameter:</b>
end mills come in cutting diameters from 0.01 mm (a lot thinner than 
<a href="http://www.pmtnow.com/images/nano-mills-nt.jpg">human hair</a>) to 50 mm and more. 
For most intents and purposes, cutters below 0.25 mm or so are just not very useful, unless you
are doing some truly hardcore micromachining; and over 8 mm or so, they get too big to mount and meaningfully 
use on benchtop mills.</p>

<p>
Your cutters need to strike a sensible balance: large tools can't machine tiny features, but
small tools remove very little material in every pass, making them useful mostly for selective
refinishing work. In fact, a two-fold reduction in tool cutting diameter often translates to a 
10-fold reduction in effective material removal speed!
</p>

<p>
<span>What to buy:</span> try to get a 3 mm (or 1/8") cutter to handle most of the machining work;
for large projects, 6 mm (or 1/4") may come handy, too. On top of that, keep 0.4 mm and 1 mm
cutters for touching up fine details.
</p>

</li><li><p><b>Cutting diameter tolerance (<span>tricky!</span>):</b> "1 mm"
cutters don't always have a diameter of 1 mm. In a nod to the legacy of drilling and tapping 
applications, many manufacturers make their tools to non-symmetric
tolerances, as denoted either with a pair of explicit values (say, +0.00 / -0.04 mm), or with an
<a href="http://www.toolingsolutions.com/technical/charts/isotol.html">ISO tolerance code</a> such
as "e8".</p>

<p>Of course, modern tool grinding machines are often a lot more precise than that; micron
accuracy is not unheard of. The machine is therefore preset to simply crank out
tools at the mid-point of the specified range. Using the example of a 1 mm tool specified as +0.00 /
-0.04 mm, the actual diameter will end up being 0.98 mm or so. In most uses, you won't even notice
- but then, every now and then, such a subtle difference can bite back.</p>

<p>
Okay, so the case of explicit tolerances is pretty clear; as for the "e8" case: for cutters
with diameters below or equal to 3 mm, the offset is -0.021 mm. For cutters over 3 mm and up
to 6 mm, the difference is -0.029 mm.</p>

<p>
<span>What to buy:</span> whatever you want, just make sure to double-check the tolerance, and write
down the actual diameter of the tool. Also, if the vendor declares a suspiciously sloppy
tolerance, approach such tools with caution, and perhaps ask the company if they mean it.
</p>

</li><li><p><b>Shank diameter:</b> this is the diameter of the top portion of the end mill - the one
that goes into the holder. It has no significant effect on the cutting process, so you simply need
to make sure that you have a matching collet for all the tools you intend to buy.</p>

</li><li><p><b>Cutting length:</b> the cutter will have flutes extending only through some of its
length. The height of the cutting region sets the upper limit of how deep the tool can
be driven into the workpiece in a single pass. 
</p>

<p><span>What to buy:</span> for the processes outlined here, you typically only need the flutes
to extend to a distance equal to about 50% of tool diameter. Because the flute-bearing
section somewhat more vulnerable than the rest of the end mill, and may also be subject
to uneven wear, it's actually beneficial to opt for stub-flute tools when you have a choice.
</p>

</li><li><p><b>Reach length:</b> many end mills have a neck - a section between the flutes and
the shank, across which the diameter of the tool does not exceed that of the cutting tip
(and in most cases, is about 10% percent smaller). The distance from the tip of the tool
to the end of this section puts an absolute limit on the depth of machining near any vertical walls:</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/05-reach.jpg">
</p>

<p>
As you can see in the rightmost drawing, the problem can be avoided by introducing a non-zero
draft angle: a subtle slant on any tall, vertical walls. Draft angles also help with removing
cured parts from rigid molds - but are not always desirable or practical. That's why having a
tool with a decent reach length is still a good plan.
</p>

<p>
On the flip side, more is not always better: with miniature long-reach tools, as the
neck gets longer, the cutter becomes more prone to deflection and easier to break. A 1 mm tool with
a 3 mm reach can be operated with few worries; at 10 mm, you need to be a bit more careful;
and at 30 mm, it starts to require ninja skills.
</p>

<p>
Oh, of course,
some tools don't have a neck to speak of; in these cases, there is a taper that immediately
follows the flutes, and reach length is identical to cutting length. That may be good or
bad, depending on whether flute length is sufficient for your needs.
</p>

<div><p><b>Note:</b> there is an interesting special case - some 3 mm or 6 mm tools have
shank diameter identical to their nominal cutting diameter; the same goes for their imperial
1/8" and 1/4" counterparts. You can think of them as having
reach length equal to total tool length, minus about 20 mm needed for the collet.
</p>
<p>
There are some drawbacks of driving these tools deeper than their cutting length, though:
their pretend "neck" doesn't have a reduced diameter, so when dealing with zero draft
angles, it may end up rubbing against the workpiece. This usually has no effect in
prototyping plastics, but quickly becomes a problem in metals and other tough stuff.
</p><p>
The situation gets slightly worse if the actual cutting diameter is smaller than the
nominal one, due to non-symmetric tolerances. In these cases, driving such a tool
too deep may have a minor but noticable impact on dimensional accuracy or surface finish.
</p>
</div>

<p>
<span>What to buy:</span> moldmaking often involves relatively deep cuts and vertical walls.
Make sure that your 3 mm tools have a reach of at least 20-30 mm; for 1 mm, stick closer to
10 mm; and for 0.4 mm, 2-4 mm should do the trick. 
</p>

</li><li><p><b>Overall length (OAL):</b> self-explanatory. Typical mold cutters have lengths of
about 50 to 75 mm; some lower cost or subminiature tools may be available as 38 mm, too.
Longer end mills - up to 150 mm or so - are also available, but seldom worth the price.</p>

<p>The main significance of this parameter is that the tool will stick out of the spindle
by no more than OAL, less something around 15 mm for the part that needs to be gripped by the
collet. Life gets more complicated when the collet nut and the rest of the spindle gets in the
vicinity of the workpiece, so it's preferable to have tools long enough to deal with the typical 
depth of the molds you are planning to work on.</p>

<p>
<span>What to buy:</span> if your projects will be anything like mine, your molds will probably range
from about 6 to 22 mm in depth, with infrequent excursions down to 40 mm or so. If so, OAL of
50-75 mm is a good pick.
</p>

</li><li><p><b>Number of flutes:</b> higher flute count translates to faster material removal rates and
superior finish, because there are more cutting passes per every turn of the spindle.
Unfortunately, there are modest limits to how many sufficiently robust flutes you can cram onto a small
cutter, and still have enough room for swarf; 4 flutes are the common limit, although 6 are not unheard
of.</p>

<p>
<span>What to buy:</span> for the materials we will be using for moldmaking, the more flutes, the better;
at least three or four are strongly desirable on 3 mm cutters, and nice to have on smaller tools. 
For aluminum, rubbers, and malleable plastics, one or two flutes may be a better pick.
</p>

</li><li><p><b>Helix angle:</b> zero degree flutes are perfectly straight, and run vertically along
the tool. The industry standard is 30°, which offers a sensible balance between
edge sharpness, vibration, and swarf removal speed. Lower angles are used to rapidly
engage and remove softer materials (e.g., rubbers, thermoplastics); while higher angles
improve tool life and reduce vibration in hard materials.</p>

<p>
<span>What to buy:</span> there is virtually no difference between 15, 30, 45, and 60° when working
with easily machinable plastics; you can safely disregard this parameter, and just focus on
finding the most interesting and the most affordable tool.
</p>

</li><li><p><b>Center cutting ability:</b> almost all the cutters of interest to CNC work have a 
bottom flute that extends through the entire diameter of the tool - which allows it to be plunged
straight down into the workpiece, and effectively act as a somewhat competent drill. But a small
minority of end mills are not center-cutting, and can't be operated this way. You probably don't
want that.</p>

<p>
<span>What to buy:</span> avoid non-center-cutting tools.
</p>

</li></ul>

<p>
Phew! My favorite tool manufacturer is <a href="http://www.widia.com/widia/en/products/29388747/29665023/38346366.html">Hanita</a> (now a division
of Kennametal, confusingly sold under the brand name of WIDIA):
they have an unmatched selection of metric tools at reasonable prices, and are available all over the world.
If you are in the States, 
<a href="http://mytoolrep.com/">Sierra Tool</a> is a good reseller;
<a href="http://www.centerlineind.com/">Centerline Industrial</a> is a bit cheaper, but for some reason,
refuses to ship to residential addresses. And if
you are anywhere in Europe, I can strongly recommend ordering Hanita products
with <a href="http://www.itc-ltd.co.uk/">ITC</a>.
</p>

<p>Hanita aside, <a href="http://www.harveytool.com/">Harvey Tool</a> has a very interesting selection of
imperial system miniature tools in the US - and I found <a href="http://www.kandhsalesinc.com/">K&amp;H Sales</a> to
be a dependable distributor. Other US manufacturers include <a href="http://www.osgtool.com/">OSG Tap &amp; Die</a>,
<a href="http://www.monstertool.com/">Monster Tool</a>,
<a href="http://www.micro100.com/downloads/metric_catalog_064.pdf">Micro100</a>,
and <a href="http://www.microcutusa.com/">Microcut</a>,
but their catalogs are not as impressive. Readers in the EU may want to check out 
<a href="http://www.nachreiner-werkzeuge.de/">Nachreiner</a>.
</p>

<p>
Here are the catalogs of the three most interesting manufacturers:
</p>


<ul>
<li><p><a href="http://www.widia.com/content/dam/kennametal/widia/common/resources/downloads/literature/WIDIA%20Catalogs/Hanita-Rubig_A-09-02077EN_mm.pdf">Hanita: full end mill range</a> (most are "e8").</p>
</li><li><p><a href="http://www.harveytool.com/catalog/">Harvey Tool: all tools</a> (some have non-symmetrical tolerances).</p>
</li><li><p><a href="http://www.matbor.pl/images/stories/GRUPA%207.pdf">Nachreiner: carbide finishers</a>.</p>
</li></ul>

<p>
As for practical recommendations, I would suggest starting with Hanita 401403000, 402403000, or Harvey 73118-C4,
as the baseline "3 mm" cutter ($15-$30); Hanita 7N2201021 or Harvey 76440-C3 for 1 mm work ($30-35); and 
Hanita 7N2200410 or Harvey 992515-C3 as a long-reach ~0.4 mm tool ($35). If you are not on a very tight budget,
it makes sense to order two of each - it's easy to mess something up in the heat of initial experimentation.
</p>

<p>
With the tools selected, you also need to make sure you have the right set of collets. For ER16, if you are not
desperate to save a few bucks, try <a href="http://www.rego-fix.com/">Rego-Fix</a> "UP" (ultra-precision) collets; they
retail for about $45 a pop, and are carried by <a href="http://www.kandhsalesinc.com/">K&amp;H</a>; another good
option are "DNA" collets from <a href="http://techniksusa.com/">Techniks</a> (about $30, require a custom nut).
You can find lower-cost collets from many other, more obscure brands - but they are not always particularly good.
</p>

<p>
Oh, one more thing: for ER16, every collet has a specified clamping range - for example, 3.00-2.00 mm. It is
always preferable to use the upper value: a 3.00-2.00 mm collet is better than a 4.00-3.00 one when holding a
3 mm tool.
</p>

<h3>2.3. Periodic testing and troubleshooting</h3>

<p>
Before embracing any complex or high-precision projects, it is important to understand the performance of your
mill, and see if anything needs to be fixed, adjusted, or compensated for. While CNC mills don't require
constant tuning, making several simple measurements after unpacking the device can save you a lot of time.
If you neglect this step, you will find that troubleshooting mill accuracy issues in complex, real-world
projects tends to be a daunting task, simply due to the sheer number of variables to look at.
</p>

<p>
The essential tool that you will need to perform the initial
measurements is a micron-resolution dial indicator with a magnetic base. You can get a no-name unit on
eBay for about $50
(<a href="http://www.ebay.com/sch/i.html?_nkw=micron+dial+indicator">link</a>), or go with Mitutoyo or other
reputable brand for about $220 (<a href="https://www.amazon.com/gp/product/B003UATP1W">indicator</a>,
<a href="https://www.amazon.com/gp/product/B001VXW2BA/">base</a>). For lower-cost mills with a rotary tool
acting as a spindle, you may be better served by a 0.01 mm indicator, though; in this case, you can get a
Mitutoyo one for about $80 (<a href="https://www.amazon.com/gp/product/B003UATP3U/">link</a>, base not included).
</p>

<h4>2.3.1. Spindle TIR</h4>

<p>
The first thing to check is the runout of the spindle and the tool holder. Wipe clean the internal
spindle taper and the collet (use WD-40 if there is any excess grease or other accummulated dirt; a small
<a href="https://www.amazon.com/Otis-Variety-Receiver-Brushes-Bronze/dp/B00162OKDY">brass brush</a> works well
for any stubborn gunk), and install a tool
that extends at least about 20-30 mm from the collet. Tighten until you feel definite resistance, but don't
overdo it - excess force may deform the collet, and is not essential in lightweight work.
</p>

<p>
Next, affix the dial indicator to the table or other sturdy surface, make the tip of the indicator touch the tool near
the spindle, and observe the change in readings as you gently turn the spindle by hand, preferably at the top (the mill
should be turned off, of course). Be very careful not to exert any unnecessary pressure on any of the parts.
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/06-dial.jpg">
</p>

<p>
Let's call the result of this measurement <code>R<sub>collet</sub></code>. Move the indicator about 10 mm lower (stay clear of the flutes) and
repeat the test; we'll refer to it as <code>R<sub>middle</sub></code>. Finally, if possible, remove the tool and the collet,
and reposition the indicator to make contact with the internal taper of the spindle (the measuring tip now pointing up).
Repeat the procedure, and write down the result - <code>R<sub>taper</sub></code>. Here's how to interpret the data:
</p>

<ul>

<li><p><b>R<sub>taper</sub>:</b> this measurement tells you about the concentricity of the spindle itself. If it is excessive,
it may be time to service the spindle (e.g., adjust the internal tension spring; disassemble it and install a new pair of
precision bearings; or, insert a shim somewhere to fine-tune the concentricity).</p>

</li><li><p><b>R<sub>collet</sub>:</b> if the spindle measurement looks OK (and only then!), this value helps you estimate the
eccentricity contributed by the tool holder (on top of <code>R<sub>taper</sub></code>). If the value is high, examine the collet for
dirt and damage (again, WD-40 is a pretty good cleaning liquid). Small tool holder misalignment can be often "fixed" simply by
adjusting the tightening torque, or applying a gentle pressure to the appropriate side of the tool when tightening the nut.
If that doesn't help, replacing the collet - perhaps with a higher-quality model - may be the way to go.</p>

</li><li><p><b>R<sub>middle</sub>:</b> this value lets you estimate the eccentricity at the tip of the tool, which ultimately, is
the most important observation to make. 
You can see if the TIR is increasing, decreasing, or staying about the same in relation to <code>R<sub>collet</sub></code>
- and use that to extrapolate the apparent diameter of the tip.</p>

</li></ul>

<p>
For a quality machine with a dedicated spindle and ultra-precision ER16 collects, after some adjustments, TIR should
preferably stay within 2 µm or so; and for any mill, it is good to have runout within 0.01 mm. If you are
seeing something much worse, poke around and see if you can improve it: it's usually simpler than it may seem. 
For example, the factory spindle that came with my MDX-540 mill had a TIR of about 6 µm; using a hook spanner to
adjust the tension of the internal spring by one tenth of a turn reduced the value to 1 µm. In more complex cases,
switching around or rearranging the existing bearings inside the spindle, or replacing them with new ones, will often
do the trick.
</p>

<p><span><b>Tip:</b></span> try to quickly repeat the <code>R<sub>collet</sub></code> measurement after
every tool change, even if you are not doing high-precision work. Trapped dirt will affect the concentricity
of the tool holder, and even a tiny difference can easily reduce tool life by 50%, and increase cutting noise
by more than that.</p>

<h4>2.3.2. Axial alignment of the tool</h4>

<p>
Spindle eccentricity aside, it is also useful to verify that the tool is truly perpendicular to the X-Y plane;
if that's not the case, for example because one of the screws that attach the spindle to the rest of the mill
is not tightened to the same torque, you may see somewhat perplexing dimensional errors in machined parts.
</p>

<p>
The test you should perform is exceedingly simple: you need to mount a cutter that offers at least around 2-3 cm
of clearance between the collet and the flutes; programmatically lower the spindle by 2 cm or so; and set up the
dial indicator as shown on the previous drawing, in section 2.3.1. When done, gently rotate the tool to find the
mid-point of its TIR, and then programmatically move the spindle up by about 1 cm. The same procedure should
be repeated after repositioning the dial indicator to make contact with the side of the tool (rather than the
front).
</p>

<p>
If everything is fine, you should see no appreciable change in the values shown by the dial indicator; a few
microns may be fine, but if the difference is getting close to 0.01 mm, you should definitely investigate. The issue
is almost always trivial to fix: you may need to loosen the screws that hold the spindle in place, and perhaps
insert a shim made out of aluminum foil on the offending side to straighten it out.
</p>

<p><b><span>Caution:</span></b> before operating the mill, be sure to read the
safety tips provided by the manufacturer, as well as the advice included in <a href="https://lcamtuf.coredump.cx/gcnc/ch7/">section 7</a> of this guide.
Small CNC machines are not particularly deadly power tools, but they are still power tools - and
it's your responsibility to use them safely.</p>

<h4>2.3.3. Spindle vibration</h4>

<p>
The spindle assembly is typically fairly heavy, and under normal operating conditions, will be rotating
rapidly. At these speeds, any poorly balanced rotating part, any malfunctioning ball bearing, and any damaged
transmission belt may easily introduce significant vibration - and that vibration will inevitably propagate
to the end mill or the workpiece.
</p>

<p>
It is difficult to accurately measure high-frequency vibration without the help of specialized tools, but
this shouldn't stop you from performing two rudimentary checks. Try this:
</p>

<ul>

<li><p>Attach your dial indicator to the table or other part of the mill frame, and let the tip touch any
<u>non-rotating</u> part of the spindle. Run the spindle at several different speeds, and observe the
reading; oscillation of the indicator hand, if any, should stay well under 1 µm.</p>

</li><li><p>Remove the tool, grab a long screwdriver, and <u>carefully</u> touch any non-rotating part of the
spindle with its tip. Be vigilant, and keep your body and the screwdriver itself well clear of any moving
parts. When the tool is touching the spindle, you shouldn't be able to hear any ringing noise, or
sense any appreciable vibration in the palm of your hand.</p>

</li></ul>

<p>
If any of these tests reveals excessive vibration, the first thing to do is disenage the motor from the
spindle (there's usually a belt or some sort of a clutch involved); if the problem doesn't go away, you
know that the problem is with the motor itself, in which case, it may be useful to have it serviced or
replaced. If the spindle is to blame, replacing the internal bearings would be the obvious next step.
</p>

<p>
Whatever the cause is, fixes shouldn't be too expensive, but pinpointing the issue may take a while.
</p>

<h4>2.3.4. Repeat accuracy</h4>

<p>
Repeat accuracy is the single most important factor limiting the precision of the parts you can make.
Even if you are not planning to machine anything particularly intricate, this parameter is still
worth checking: if it's alarmingly poor, it may be indicative of a problem with the mill.
</p>

<p>
To estimate the accuracy of the machine, brace the tip of the dial indicator against the side of the
spindle assembly, and then programmatically move the spindle away in the X axis, in 0.01 mm increments
(or whatever the nearest multiple of your mill's mechanical resolution is supposed to be). After 
about 5-10 steps or so, reverse the direction, and gradually move back to the starting point. Here's
what to look for:
</p>

<ul>

<li><p>Every step should move the needle of the dial indicator by the same
amount, ideally within 1 µm, and definitely within 0.01 mm. Jerky stepping may be due the
increments not being a multiple of the actual hardware resolution of the mill, or due to wiring
problems in the stepper motor.</p>

</li><li><p>The actual travel distance, as measured by the dial indicator, should
match the expected distance closely. If there's any substantial error that seem to be proportional
to how far you are moving, your CNC software should let you compensate.</p>

</li><li><p>The locations of the steps when moving away from the dial indicator should be the same
as when moving back; and the spindle should return to the same starting
position at the end of the test. Any observable offset
is probably due to backlash - which should be in the micron range. There may be some limited
ability to compensate for this in software (for example,
your CNC application may offer low-level motor calibration settings), but it's not a silver bullet.</p>

</li></ul>

<p>
Of course, try to repeat this procedure for all axes. If in any of them, repeat accuracy is worse
than 0.01 mm, it may be good to talk to the manufacturer.</p>

<h4>2.3.5. Deflection under load</h4>

<p>
We're almost done! The last parameter of note is the loss of accuracy you can expect if the mill
is braking or accelerating rapidly, or aggressively plowing through a difficult workpiece. The
value depends on the rigidity of mill frame, and the type and quality of its linear motion systems.
If it's poor, there is no reason to despair - but it means that you may have to slow down when
doing precision work.
</p>

<p>
The test here is extremely simple: with the mill on but the spindle turned off, brace the dial
indicator against the side of the cutting head, and then use your hand to <u>gently</u> press the
spindle from the other side - along the tested axis. Don't overdo it: the goal is to exert may be
20-50 g of force, and not to overcome the holding torque of the motors.
</p>

<p>
In a quality mill, the momentary deflection should stay under 5 µm or so - but up to 0.02 mm
is something you can live with.
</p>

<h3>2.4. Ongoing maintenance</h3>

<p>
Once you know that your machine is behaving correctly, there isn't that much that needs to
be done on an ongoing basis: it's a pretty sturdy piece of machinery, and it's usually not subject
to heavy wear. Consult the manual for manufacturer-specific advice - but in most cases, the rules
are pretty simple:
</p>

<ul>

<li> <p>Always keep the collets, cutters, and the spindle taper squeaky clean and lightly lubricated.
Get rid of any thick, factory-applied grease (use WD-40 or naphtha to do that); carefully
remove all cutting residues (use a
<a href="https://www.amazon.com/Otis-Variety-Receiver-Brushes-Bronze/dp/B00162OKDY">small brass brush</a>
for any stubborn bits);
and apply WD-40 or a similar low-viscosity oil to protect all these components against
corrossion - especially after handling them with bare hands. Sweat residue can quickly
lead to corrosion!</p>

</li><li> <p>Thoroughly vacuum the mill after every job. Cuttings, if allowed to pile on, may eventually make
their way into the sensitive, normally shielded parts of the drivetrain - or more prosaically, may
simply obstruct the movement of the table. Do not use compressed air for cleaning, as this can push
dirt deeper into the machine, or just spread it around your workshop unnecessarily.</p>

</li><li> <p>Every few hundred hours of machining (1-2 years' worth of weekend projects), wipe old grease and
dirt off of ball screws and linear guides, and apply a fresh coat. Medium-viscosity 
<a href="https://www.amazon.com/SEPTLS39950305-White-Lithium-Grease-PTFE/dp/B001QF7MGS">lithium grease</a>
is typically the right choice - but check the manual carefully, and whatever you do,
avoid mixing lubricants of different kinds.</p>

</li><li> <p>After several thousand hours of use (5+ years), it may be time to inspect the spindle assembly
for any obvious wear, loss of concentricity, noise, vibration, or elevated operating temperature -
and service it as necessary. If you do it yourself, the replacement of spindle bearings should cost
between $40 and $300, depending on the design.</p>

</li></ul>

<p>
Some of the entry-level mills may be using low-cost brushed motors to power the spindle; such motors
are a consumable, and may require a replacement after anywhere from 100 to 2,000 hours - but typically
don't cost much. Higher end machines usually rely on brushless motors that should last a decade or
more.
</p>

<p>
Linear drivetrain motors, bearings, and so on are typically not subject to substantial wear when doing
lightweight hobbyist work; if properly maintained, they should last pretty much forever. Insufficient
lubrication or contamination with abrasive materials (ferrous metals, glass, etc) are about the only
things to watch out for.
</p>

<h3>2.5. Cutter management</h3>

<p>
If you are planning to do high-precision work, or simply wish to ensure high-quality surface finish
when working with organic shapes, it's useful to measure and document the diameter of every new end
mill in your collection. Although the tools are usually manufactured with micron-level accuracy, the
specifications can sometimes be wrong, and on top of that, manufacturing
variations may occur from batch to batch - for example, due to changes in the thickness of applied coatings
or the gradual wear of the grinding tool.
Case in point: some of my Harvey's 0.04 inch cutters actually measure around 1.022 mm, rather than the
expected 1.016 mm. At these scales, such differences can bite.
</p>

<p>
To perform the measurements, you will need an accurate micrometer. This tool, along with quality
calipers, is one of the most important investments you will make, so don't fret: $50 will get you a 
<a href="http://www.ebay.com/itm/0-25mm-0-001mm-0-00005-Electronic-Digital-Micrometer-/220662499379?pt=LH_DefaultDomain_0&amp;hash=item3360828833">decent
no-name brand</a>, while $140 is enough for
<a href="https://www.amazon.com/Mitutoyo-293-248-Micrometer-Friction-Graduation/dp/B003UATGU2">Mitutoyo</a>.

For two- or four-flute tools, the idea is to <u>gently</u> tighten the jaws of the micrometer around
the flutes, while simultaneously rotating the cutter (in the direction opposite to its normal
operation) to find the maximum diameter.
You need to stop as soon as you feel any resistance, to avoid breaking the tool or gouging the jaws; 
practice on larger, sturdy end mills before moving on to sub-mm ones.
</p>

<p>
Three-flute tools are a bit harder to deal with. If the flutes are long enough, you may be able to grip
the cutter so that one face of the micrometer is touching the peak points of two flutes, and the
opposite face is touching the remaining one. That said, with stub-length tools, you may be
essentially out of luck; doing a careful 
test cut and measuring the result may be the way to go (you need to account for TIR and repeat 
accuracy).
</p>

<p>
Beyond the initial measurements, it is also a good habit to re-check your tools after every 10
hours of cutting or so, preferably measuring the diameter near the very tip. When doing heavy
cutting, you may see some reduction in tool diameter as the outer edge of the flutes gets a 
bit more dull; for this reason, I suggest keeping your primary roughing tool separate from the
finishing ones.
</p>

<p><span><b>Tip:</b></span> even when working with plastics, applying
several drops of a cutting fluid to the workpiece can improve finish and limit tool wear by keeping
the tool cool and helping remove chips more efficiently - give it a try! For lightweight work,
sulfur-free oils, such as
<a href="https://www.amazon.com/dp/B0069KPMGW">Oatey 30200</a>, work best. They are also easy to clean
up with a detergent and don't interfere with resin casting work.
</p>


<p>
Cutting fluids or no fluids, it makes sense to examine your tools for damage and excess wear every
now and then. You can't trust your naked eye, but a simple
<a href="http://www.tedpella.com/magnify_html/magnifier.htm">7x magnifier</a>, selling for under
$50, should do the trick. If you have a microscope with magnification between 10x and 50x, that's
even better. Here are the two most common cutter failure modes that aren't visible with naked
eye - significant wear (left) and a chipped flute (right):
</p>

<p><img src="https://lcamtuf.coredump.cx/gcnc/07-damage.jpg"></p>

<p>
Both of these tools will still work, but the one on the left will not hold tight dimensional
tolerances in particularly demanding applications; while the one on the right will produce crummy
finish in machined parts and will be prone to gumming up.
</p>

<div>
<p><span><b>Tip:</b></span> good bookkeeping is incredibly important in CNC work:
computer-aided design and creative chaos simply don't mix. Cultivate good habits starting with
end mills: make sure that you have a spreadsheet (or even a flat text file) listing all the tools
you have, outlining their geometry, and making note of the measurements you have taken.
</p>
<p>
Having such a list
will not only help you avoid surprises, but will also make it easier to maintain a healthy
stock of tools - so that you never have to put a project on hold for two weeks after
accidentally breaking your last 0.4 mm end mill.
</p>
</div>

<!-- START~3~Mastering CAD and CAM~ -->

<h2><a name="3">3. Mastering CAD and CAM</a></h2>

<p>
By now, you should have a good idea of which mill to choose, where to find the cutters,
and how it all fits together... or perhaps you own a 3D printer, and didn't read the previous
chapter at all. Either way, the next step is getting comfortable with the
software needed to bring your ideas to life. In this section, we'll go over some of the basics,
and then proceed with a simple starter project of our own.
</p>

<h3>3.1. Computer-aided design (CAD)</h3>

<p>
The primary function of CAD software is, quite simply,
to let you design 3D parts. Your CAD application
may be just about any general-purpose modeling program, such as
<a href="http://www.blender.org/">Blender</a> - but in the long haul, it makes sense
to settle for a purpose-built tool. "Real" mechanical
design software offers better control over
part accuracy, and comes with powerful data input and analysis tools that streamline
engineering work. On the flip side, they usually have less impressive rendering 
capabilities - and may come with no support for animation, physics, and other
perks taken for granted in general-purpose 3D apps.
</p>

<p>
For now, though, the distinction between general-purpose modeling tools and CAD 
isn't that important. You simply need to get comfortable with any 3D design 
software of your choice - and that takes a bit of work.
</p>

<h4>3.1.1. Wait, but which application to choose?</h4>

<p>
A-ha, that's a good question indeed! In the previous edition of this guide, I tried to give
an impartial overview of the market - but in the end, there is plenty of choice, and 
very few genuinely bad CAD tools. You can just look around, find the one you like and can
afford.
</p>

<p>
If you just want a simple recommendation - and are willing to spend some money on 
software to begin with - <a href="http://www.novedge.com/products/2217">Rhino 3D</a> is probably
the best CAD package that you can get on a hobbyist budget. Students can purchase a
fully-featured <a href="http://www.novedge.com/products/2572">edu license</a> for under $140,
so if you are still in the academia, it would be foolish not to go for it. For mere mortals, there is
a heftier price tag attached - $750 - so it's a more difficult call. Still, it's a mature and 
user-friendly tool that runs well even on low-end systems, and it's just done well - so you
probably won't regret it.
</p>

<p>
Now, if Rhino is priced outside your league, many people in the community are also fond of 
<a href="http://www.alibre.com/unstore.asp">Alibre Design PE</a>, which sells for about $100.
Or, if you prefer not to spend any money at all, and can live with a somewhat clunky app,
then
<a href="http://sourceforge.net/apps/mediawiki/free-cad/index.php?title=Main_Page">FreeCAD</a>
looks fairly OK for simpler work.
</p>

<p>
What else? Several accomplished DIYers
use general-purpose 3D modeling tools such as <a href="https://sketchup.google.com/">Sketchup</a> or
<a href="http://www.blender.org/">Blender</a>. The free-of-charge general-purpose tools
are pretty diverse and mature; the only problem is that they may be less suited for complex work
later on. 
If you are willing to cross that bridge when you come to it, they are definitely worth a try
as a starter option.
</p>

<p>
Last but not least, cash-strapped DIYers may also want to check out one of the "demo" editions
of commercial CAD tools. For example, 
<a href="http://www.ptc.com/products/creo-elements-direct/modeling-express/">Creo Elements</a>
has a modest limit of 60 parts per document, but otherwise, should do the trick.
</p>

<h4>3.1.2. Some existential CAD advice</h4>

<p>
We should probably start the lesson with a gentle
warning: CAD programs tend to have a fairly steep learning curve.
This is in part because you are forced to manipulate 3D objects using a 2D input device and a
2D display - and it takes a while to master that skill. The other problem is that these applications
tend to use unfamiliar UI paradigms and obscure terminology - and even something as simple as
right-clicking an object may have an unexpected result. It takes some effort to start using
the software in a competent way - and if you're just banking on your innate abilities, you
will probably learn to do things exactly the wrong way.
</p>

<p>
If you want to make real progress, here are some rules to live by:
</p>

<ul>

<li><p><b>Read the manual and do the tutorials.</b> Trust me, you are <u>not</u> too good for this -
even if you never had to do that with any other software. Set aside 2-3
days to go through all the exercises, and read the help pages. You need to understand what the
program has to offer and what terminology it uses; even if you have some experience with 3D
modeling software, you will learn a lot.</p>

</li><li><p><b>Give your mouse a break.</b> Try to do as much as possible without clicking around the UI. 
Learn command names and keyboard shortcuts, and make a habit of entering coordinates and dimensions
manually. Find hotkeys for enabling, disabling, and changing grid and object snaps, changing drag modes,
constraining movement, zooming and rotating viewports, and so on. This will save you plenty of time.</p>

</li><li><p><b>Don't approximate.</b> Never move objects around to make them just sort-of fit together. Learn
to leverage object snaps, or use parametric operators to move, copy, rotate, or replicate objects with
precision. If you 
don't, you will quickly start accummulating subtle geometry errors that will cause many 3D operations to
unexpectedly fail later on (e.g., due to self-intersecting curves or imperceptible gaps).</p>

</li><li><p><b>Don't believe in magic.</b> CAD programs often come with advanced features to automatically calculate
intersections or unions of 3D solids, place and remove holes, etc - but these functions aren't perfect,
and tend to misbehave at least opportune times. Instead, learn to break down complex problems into simple
steps, and operate on intuitive primitives (e.g., planar curves and surfaces) for as long as possible in
the editing process. This also makes it easier to revise your designs later on.</p>

</li></ul>

<p>
Before you start, there's just one more thing to do - you need to customize the program for precision work.
Needless to say, the tolerances needed to design a building aren't the same as when designing a gearwheel
- and CAD applications are used for both. For now, simply 
go through the configuration pages, and try to do the following:
</p>

<ul>

<li><p><b>System units:</b> set to millimeters. Or don't, but I find inches pretty unwieldy for
precision work.</p>

</li><li><p><b>Precision:</b> set precision (or tolerance, or accuracy) to 0.5 µm (0.0005 mm)
or so. Display mesh tolerance can be set to about 0.01 mm, simply to speed up rendering.</p>

</li><li><p><b>Display grid:</b> enable if necessary, and set major spacing to 5 mm, and minor spacing to 1 mm.
Set grid size to match the work area of your machine.</p>

</li><li><p><b>Snaps:</b> disable object and angle snaps by default (you will be able to turn them on with
a hotkey when necessary). Enable linear snaps and set distance to 0.5 mm. If the program supports it,
turn on "planar" mode for snaps, where all the object snap points are projected to the construction plane
of the current viewport.</p>

</li><li><p><b>Viewports:</b> switch to four-viewport display mode - showing top, front, and right sides of the
model, plus a rotatable "perspective" (axonometric) view. Zoom in all viewports so that there are 
about 2-4 mm between the grid lines displayed on your screen.</p>

</li><li><p><b>Shading mode:</b> configure all viewports to use 3D shading, preferably with translucent
surfaces (opacity around 80-90%; "ghosted" preset in Rhino), and with 1 pixel edge thickness. If possible,
set a different edge color (e.g., red) for any "naked" edges that do not form a closed solid.</p>

</li></ul>

<p>Done? Then let's roll...</p>

<h4>3.1.3. Drawing and manipulating simple planar shapes</h4>

<p>
Your first job is to figure out how to draw several simple, two-dimensional shapes on the X-Y construction
plane (i.e., using the "top" viewport of your CAD app). Try do to sketch all of the following:
</p>

<ul>

<li> <p>A single, straight line segment,</p>
</li><li> <p>A multi-segment zig-zag line (with sharp turns),</p>
</li><li> <p>A closed multi-segment line, where the end is joined with the beginning,</p>
</li><li> <p>A circle, using three methods: center point and diameter; two boundary points; and three boundary points,</p>
</li><li> <p>An arc - by selecting center point, diameter, and start / stop angles,</p>
</li><li> <p>A rectangle, using two methods: two corner points; or a center point and one corner,</p>
</li><li> <p>A polygon - circumscribed and inscribed, with a specified number of sides.</p>

</li></ul>

<p>
Practice a bit; perhaps sketch a simplified, boxy outline of a car, complete with wheels.
</p>

<p>
When you are comfortable with these 2D primitives, it's time for your next exercise: try to draw a smiley face
without using your mouse at all. Type in the required commands and specify coordinates by hand; the display
grid should be of great help. Oh - for some extra credit, add a hat!
</p>

<p>
With your drawing in place, it's time to get familiar with several important operators. Figure out
how to select one or more objects with your mouse, and then find the commands that perform the following
tasks:
</p>

<ul>

<li> <p>Move selected objects by a specified distance in the current viewport,</p>
</li><li> <p>Duplicate ("clone") an object, likewise,</p>
</li><li> <p>Rotate object by a specified angle, around a selected point in the viewport,</p>
</li><li> <p>Flip (or "mirror") selected objects around a specified axis,</p>
</li><li> <p>Scale object proportionately in all directions, by a specified factor,</p>
</li><li> <p>Scale object in one direction only,</p>
</li><li> <p>Form an array of objects by cloning the selection at a given linear interval,</p>
</li><li> <p>Form a radial (polar) array by cloning the selection at an angular interval.</p>

</li></ul>

<p>
Play around with these operators until you are comfortable with the way they work; pay special attention
to scaling and rotation operators, and the way they are affected by the choice of the origin, reference
point, and the viewport.
</p>

<p>
As soon as you are done moving, flipping, and cloning stuff, locate and play with the analytic tools that
let you do the following:
</p>

<ul>

<li> <p>Measure the distance between any two points,</p>
</li><li> <p>Measure the angle between two straight lines,</p>
</li><li> <p>Calculate the diameter (or radius) of a circle or an arc,</p>
</li><li> <p>Find the center point of a circle or an arc,</p>
</li><li> <p>Show maximum deviation between two similar curves,</p>
</li><li> <p>Compute the surface area of any closed curve.</p>

</li></ul>

<p>
This is a good opportunity to experiment with object snaps, too: enable them temporarily, and check the
various options they offer. In particular, be sure to give tangent snaps a try: draw three random circles, and then
try to connect them with tangent lines, like this:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/08-tangent.jpg">
</p>

<p>
Piece of cake? Thought so! You should be now ready to master several more complicated modeling
skills.
</p>

<p>
<b>Note:</b> Somewhat surprisingly, 2D drawing techniques are more important than any 3D sketching tools;
in fact, you should resist the temptation to play with 3D primitives at this point.
The bulk of mechanical modeling work is almost always done with
<a href="https://en.wikipedia.org/wiki/Spline_%28mathematics%29">spline curves</a>, which are later
converted into 3D objects with the help of operations such as extrusion, revolution, or lofting. We'll
get to these operators soon.
</p>

<h4>3.1.4. The inner workings of splines</h4>

<p>
Your CAD application probably stores every curve as a
<a href="https://en.wikipedia.org/wiki/NURBS">non-uniform rational B-spline</a>. 
The visual representation of this mathematical model is not very easy to grasp, but
getting a hang of it is essential to any sort of serious modeling work.
</p>

<p>
In essence, every NURBS curve is defined by three parameters:
</p>

<ul>

<li><p><b>Degree:</b> this parameter defines how many control points will 
be simultaneously affecting the trajectory of the curve at any given location.
Degree 1 curves allow just two points to have a say, with a linear transition
between the starting and the destination point (i.e., a straight line).
For degree 2 curves, the shape is influenced by three points, allowing it to
have smooth bends. With degree 3, the number grows to four, and so on.</p>

</li><li><p><b>Control points:</b> every curve is accompanied by at least <code>degree + 1</code>
control points, to which it is progressively attracted to along its length. In degree 1
curves, control points simply lie on the curve (at the vertices). For degrees 2 and above,
the points are often positioned outside the curve, forming a sort of an
editable, elastic envelope, as shown below.</p>

</li><li><p><b>Knots:</b> these are the intervals along the length of the curve at which the
influence of a previous control point ends, and the influence of a new one begins.
Think of it as a way to pace the changes: densely packed knots can result in sharper
turns.</p>

<p><b>Note:</b> it is possible to have multiple subsequent knots at the same location. If
the number of knots in a cluster is equal to the degree of the curve, it's called a
<i>kink</i>: it effectively forms a barrier that prevents control points on one side to have any
influence over the other, and vice versa. This allows the curvature to change
aburptly, forming a proper angle. Curves can be losslessly broken into separate
segments at such a kink, too.</p>

<!-- FIXME FIXME FIXME -->

</li></ul>

<p>
An example of a degree 2 spline with no kinks is shown below; control points are marked
in yellow, and knots are red:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/09-spline.jpg">
</p>

<p>
To practice a bit, try to locate the command that lets you draw a curve of a given degree
by specifying subsequent control points. Get a hang of its behavior particularly for
curve degrees 2 and 3. There should be also a separate command for creating interpolated
curves that go through any number of specified "via" points that you click on, which may be
useful for tracing around bitmaps and so forth. Oh, one more thing: using both of these tools, 
try to create a proper kink!
</p>

<p>
When you are comfortable with drawing, experiment with the following curve-editing tools:
</p>

<ul>

<li> <p>Displaying and moving around control points for an existing curve,</p>
</li><li> <p>Adding and removing control points, inserting a kink,</p>
</li><li> <p>Non-uniform refitting, to simplify the curve or remove kinks while maintaining its approximate shape,</p>
</li><li> <p>Soft-editing a curve by dragging a selected point on its surface,</p>
</li><li> <p>Displaying curvature and continuity information - can you spot any exising kinks?</p>

</li></ul>

<p>
Last but not least, be sure to familiarize yourself with the "explode" operator that splits
curves at existing kinks (see what it does to a rectangle, circle, etc); and the "join" tool
that merges adjacent curve endpoints to form a curve with kinks.
</p>

<h4>3.1.5. Curve trimming</h4>

<p>
As should be apparent by now, NURBS curves can be separated and joined at kinks in a
completely lossless manner: the underlying coefficients do not have to change, and
there is no gradual reduction of accuracy if you repeat these operations 100 or 1,000 times.
</p>

<p>
Unfortunately, in many cases, you will need to truncate curves at locations that do
not correspond to any existing kink. In these situations, the CAD application will be usually
forced to create a new curve with a different set of control points in the vicinity of the 
cut. This fitting process usually works very well, and the resulting deviation should be
much smaller than your configured tolerance, but you should be aware that the operation
does not come completely free.
</p>

<p>
With that warning in mind, find the command that let you split a curve at a point where it
intersects with another one, and experiment with it. For degrees higher than 1, you should
be able to see the effect it has on the set of control points for the curve - and if you
ask the program to calculate the deviation between the input and the output curve, it will
probably give you a tiny but non-zero result. Examine the deviations for a couple of input
curves to see what to expect in normal work.
</p>

<p>
In addition to the curve splitting tool, there may be also a second operator that works
roughly the same way, but lets you immediately delete (trim) the unwanted parts. It may
sometimes save you a click, so if possible, get familiar with it.
</p>

<p>
In any case, it's time for a brief exercise. Remember
the command for drawing radial arrays? Try to combine that with splitting and trimming
to arrive at a result such as this:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/10-trim.jpg">
</p>

<p>
Nice, eh? It's not quite a proper gearwheel, but we're pretty close.
</p>

<div>
<p><b>Note:</b> as mentioned earlier, it is always preferable to use the simplest editing 
tools that still do the job. In particular, you should always favor the join, explode,
refit, split, and trim operators over any features that, for example, automatically
compute unions, differences, or intersections of 3D objects.
</p><p>
Why? Well, these advanced tools quickly go
bonkers if you have something as simple as two closely touching, parallel walls - not
to mention accidental self-intersections, non-watertight curves or solids, etc. It's
one thing if they just fail in an obvious way... but if the resulting error is subtle
and goes unnoticed, you may end up having to redo a good chunk of your work later on.</p>
</div>

<h4>3.1.6. Other curve tools</h4>

<p>
We're almost done with curves - hooray! But before we go, 
there are three other, immensely useful editing tools that you should probably learn about:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/11-crv-edit.jpg">
</p>

<p>
The fillet operator is applied to any angle (kink) on a curve, and replaces it with a 
specified radius. The trick is often used for engineering purposes: fillets serve as
a stress relief in sharp corners and drastically improve their strength. But even
more interestingly, filleting lets you capture the real-world result of machining
a corner with an end mill of a given size - which is important for certain types
of snap fits.
</p>

<p>
This illustation shows the use of filleting to determine the actual shape
of a machined part:
</p>

<p><img src="https://lcamtuf.coredump.cx/gcnc/12-fillet.jpg"></p>

<div>
<p>
<b>Note:</b>
Of course, it's not that you can't make a competent acute angle with a CNC mill.
For example, refinishing the one on the left with a 0.4 mm cutter would result 
in a deviation of barely 0.3 mm. Still, in many cases, it's more convenient to
account for such intrinsic fillets in your designs, than it is to refinish 
the workpiece with a separate tool.</p>
<p>
Oh, one more thing: in situations where you don't control the
shape of the mating part (lighter blue in the picture below), you can always
resort to bone fillets, too:
</p>
<p>
<img src="https://lcamtuf.coredump.cx/gcnc/12a-bone.jpg">
</p>
</div>

<p>
Chamfering is a similar operation, but it replaces the selected kink with a straight
segment that starts at a specified distance from the vertex. Compared to fillets, 
chamfering may have a more desirable appearance, depending on the effect you are
aiming for - and produces a much simpler 3D mesh.
</p>

<p>
The last operator, offsetting, offers an interesting way to resize any shape:
it creates a derived curve that consists of points at a particular, constant
distance from the original geometry. It is quite different from traditional
scaling, in the same way that gaining weight is different from growing bigger -
and it comes quite handy for generating walls, undersizing or oversizing parts,
and so forth.
</p>

<p>
Well, that's really it! You may also want to explore
tools that let you extend or close curves, or blend them with more fine-grained
controls - but for most intents and purposes, we are ready to talk about something
a bit cooler than that.
</p>

<h4>3.1.7. Creating simple surfaces</h4>

<p>
Let's start building three-dimensional solids. It's simple: 
draw a closed curve, and then find
the command that creates a planar surface from it. Examine the result, then
check out what happens if you select two curves, one within another. What about separate
or intersecting input curves? Examine failure modes of this operator, too: what if one of
the input curves is at a slightly different Z level? What if the curve is open or 
self-intersects?
</p>

<p>
Of course, the planar surface that you have just created is still, well, pretty flat.
The next important operator to play with is extrusion: select your curve, and using the
side view, select the extrusion height. Disable the creation of top and bottom "caps":
we just need the side walls. Try to use the join operator to merge the flat base surface
with the extruded wall. If it worked, you have pretty much mastered 3D work. 
Lets try a slightly more complicated exercise:
</p>

<p><img src="https://lcamtuf.coredump.cx/gcnc/13-assembly.jpg"></p>

<p>
That's pretty easy, eh? In fact, it's a lot simpler to construct shapes this way
than it is to start with 3D primitives, and clumsily piece them together.
But don't let it go to your head. Spend a few more minutes playing with extrusion: see
what it does to open or self-intersecting curves, to multiple curves that overlap or
aren't at the same Z
level, and so on.
</p>

<p>
You should also take this opportunity to experiment with the explode, split, and 
trim operators that you remember from your curve editing days. Draw two solids
and make them overlap, then see if you can use the trim operator to remove all the
overlapping internal sections, and join the resulting outer shells into a new, closed
shape. Can you do the same to "subtract" one solid from another, or only keep the
intersection? Find the analytic tool that lets you calculate the volume of each of
the solids, and use it to double-check that your results check out. Oh, one more
thing: can you trim surfaces with curves? Why not give it a try!
</p>

<p>
These tools aside, there are several other advanced surface editing operators that
you should be aware of; they are particularly important if you want to create 
organic shapes without having to think too much:
</p>

<ul>

<li><p><b>Curve revolution:</b> this operator lets you draw a surface by taking any
curve, and rotating it around a specified axis, and letting it leave a trail in the 3D
space. This is the method of choice for creating many simple shapes with axial
symmetry - bottles, vases, cans, chess pieces, rings. In fact, try to create each
one of these.</p>

</li><li><p><b>Lofting:</b> this mechanism lets you "drape" a surface through a series of
curve outlines arranged in the 3D space. Think of it as the opposite of slicing. It
comes handy in a variety of situations, including creating draft angles for molds,
or adding a handle to a cup. Play with it a bit - it's fun:</p><p>

<img src="https://lcamtuf.coredump.cx/gcnc/14-loft.jpg">
</p>

</li><li><p><b>Sweeping:</b> this tool lets you select a curve and drag it along a specified
rail, generating a surface in the process. It can be seen as a generalized form
of curve revolution (in which the rail is always circular). A more advanced
version of this operator lets you use multiple rails, which allow variable scaling
of the profile curve; or multiple profiles, thus also generalizing the loft operator.</p>

</li><li><p><b>Blending, filleting, chamfering:</b> equivalents of the curve editing tools
that let you smoothen the edges of your solids. Blending is particularly useful
for creating a smooth, variable-curvature joint:</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/15-blend.jpg">
</p>

</li></ul>

<p>
The list of useful operators goes on - for example, it's sometimes useful to
extract edges from surfaces or solids, to place or remove holes, or to orient
something on an oddly-shaped surface - but you can discover these on your own.
For now, let's just have a quick look at how to manage your work.
</p>

<h4>3.1.8. Working with multiple objects</h4>

<p>
It's one thing to sketch a nice 3D box - but any medium-scale project may
easily consist of several hundred of such solids, often meshing closely and
stacked in creative ways. If you don't manage your virtual workspace well,
you will get overwhelmed, make mistakes, or both.
</p>

<p>
The document management tools at your disposal will vary from one program to
another, but you should familiarize yourself with at least the following:
</p>

<ul>

<li><p><b>Grouping.</b> This function lets you combine any number of objects
into a single logical component that can be moved around and copied as a whole.
Unlike trimming and joining, this operator does not require the objects to
form a single solid - in fact, you can group completely disjoint things,
such as curves, dimensions, and even light sources for the rendered scene.
When necessary, the group can be opened, and its contents can be edited separately.</p>

<p>
This tool is very useful for conveniently creating serviceable parts from 
simpler, reusable solids.
</p>

<p><b>Note:</b> some programs go beyond simple grouping, and let you instantiate objects
loaded from a separate document. These instances are automatically updated to reflect
any changes to the "master" document. I find this to be an overkill in my work, but
your mileage may vary.</p>

</li><li><p><b>Assigning to layers.</b> Layers offer a simple way to centrally manage
certain properties of objects, such as visibility or color, without merging 
them into a single blob. All objects or groups that comprise a named layer
can be still accessed individually - although you can also select all members
of a layer if so desired.</p>

<p>
You should use layers to keep track of all instances of any given part,
or to denote other important information - for example, that a particular object
represents a premade part not meant to be machined, or that it's only a visual
aid.
</p>

</li><li><p><b>Locking and hiding.</b> Objects or layers that get in the way of editing
may be locked. This keeps them at least somewhat visible, but prevents any
interaction: you can't accidentally select them or move them around. Hiding
is a more radical alternative: it completely removes the affected items from
view.</p>

<p>
Locking and hiding is typically best applied to layers, as it usually takes just
a single click to toggle this parameter in the layer manager. For individual
objects, hiding is useful predominantly for items that you are not planning to
access again: for example, any construction curves that were already used to
create all the solids you needed, but that are worth keeping around just in case
you need to redo something later on.
To get them back, you will need to activate a special mode that hides all
the visible objects, shows all the hidden ones, and lets you select the ones
you want to bring back to life.
</p>

</li></ul>

<p>
As soon as you are reasonably comfortable with object management, we can actually
make a simple mold!
</p>

<h4>3.1.9. Practice time: let's show some love!</h4>

<p>
Okay, it's time for some fun. Let's start by trying to draw a heart:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/16-heart.jpg">
</p>

<p>
Here's what's going on in that illustration:
</p>

<ul>

<li><p>We draw a helper rectangle as a guide for the overall size
of the part. This one is 23 mm wide and 20 mm tall. We then use object snaps to
draw a vertical line through the middle of the part, which will be our axis of
symmetry.</p>

</li><li><p>Once the guides are sketched out, we add a 13 mm circle (slightly
larger than half the rectangle), and align it with the edges of the box. You can
use grid snaps for that.</p>

</li><li><p>We draw an arc using object snaps. The beginning of the arc is tangent to the
existing circle, the end is at the bottom of the center guide,
and the diameter is manually entered as about 110 mm.</p>

</li><li><p>We mirror the circle and the arc around the axis of symmetry. At this point,
the symmetry guide is no longer necessary, so we delete it.</p>

</li><li><p>We use the trim operator to remove the internal parts of the
heart, and then delete the outer rectangle.</p>

</li></ul>

<p>
Voila! Easy, right? Now, let's join all the curve segments, and
turn the whole thing into a mold:
</p>

<p><img src="https://lcamtuf.coredump.cx/gcnc/17-mold.jpg"></p>

<p>
See if you can figure out all the steps on your own. The final result should be
a watertight box with dimensions around 33 x 30 x 8 cm. Its bottom left corner
should be at coordinates <code>(0, 0)</code>, and the top surface should be at
0 mm, likewise. The mold cavity should have a 4 mm clearance around the heart,
and should be 7 mm deep. The heart itself should be resting at the bottom of the
cavity, and should be 4 mm high (its top surface should be at -3 mm).
</p>

<p>
If everything checks out - well, the good news is that you have yourself a master
mold (aka a <i>pattern</i>). Now, we cut some corners with the moldmaking process,
given the simplicity of this project, but this is how the entire thing
usually plays out:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/18-process.jpg">
</p>

<p>
Be sure to save that project - we'll need this file soon.
</p>

<h3>3.2. Computer-aided manufacturing (CAM)</h3>

<p>
CAM software reads the geometry created with your favorite modeling application,
and turns it into toolpaths that can be sent to a milling machine, a 3D printer, or some
other automated tool. All the computer-controlled manufacturing technologies use a
common set of underlying concepts and have a comparable degree of complexity, but there
are many details that remain specific to a particular tool. Since we have to choose one
way or the other, the rest of this chapter will focus on the software designed for CNC mills.
</p>

<h4>3.2.1. Shopping for the right application</h4>

<p>
When I first published the original version of this guide, the makers of CAM
applications catered almost exclusively to commercial users. The software was
ridiculously overpriced, shipped with archaic UIs, and always included a 
collection of mind-boggling bugs. Thankfully, the emergence of low-cost mills and serious
hobbyists is slowly changing that. Still, there is no single package that would
be a sure bet for all users, and you need to understand what sets them apart. Here's
a quick list of the things that matter the most for everyday CNC work.
</p>

<h5>3.2.1.1. Support for fourth axis</h5>

<p>
If you own a computer-controlled rotary axis, or plan on getting one, you should 
figure out which 4-axis machining modes are supported by the program - and decide
if they are worth the extra price. The three fundamental choices are:
</p>

<ul> 

<li><p><b>Indexed cutting (XYZ):</b> in this mode, every milling job is handled
using traditional, planar three-axis movements. The only new trick is that the program
will automatically rotate the workpiece (and the CAD model itself) in between jobs,
letting you machine the part from multiple sides with no extra leg work.
</p>

<p>
This rudimentary approach is probably the most useful one, particularly for engineering
work. It works great on geometries that have a small number of distinct, planar faces
- for example, a two-sided PCB, a nut, or a rectangular enclosure.
</p>

<p>
Interestingly, indexed cutting is actually fairly easy to simulate by creating several
CAD files with the same part rotated by the desired degree, generating toolpaths for
each of these files, and then sending them to the mill and rotating the part in between.
It takes a bit more time, and there's a higher risk of human error - but it's
up to you to decide if the extra convenience is worth spending several hundred
bucks extra on your CAM tool.
</p>

</li><li><p><b>Lathe-type machining (AXZ):</b> in this mode, the Y axis is kept in a fixed
position, so that the tool hovers directly over the axis of rotation, or stays at
a predefined offset. The workpiece is turning continuously as the milling head is
moving up, down, and to the sides. If you haven't seen a lathe in action,
<a href="https://www.youtube.com/watch?v=lcGHtI9Lql4">this video</a> should clarify
what's going on.</p>

<p>
Such an approach allows efficient reproduction of smooth, cylindrical shapes that
would require indexed cuts from 6 or more sides to approximate the shape by
traditional means. Examples may include threaded shafts, worm gears, soda 
bottles, or rings. 
</p>

<p>
Unlike the previous mode, this one can't be trivially approximated in a
program that doesn't support it natively; but it's also not nearly as essential, 
not unless you're planning to work on jewelry or other artistic stuff.
</p>

</li><li><p><b>Fully simultaneous four axis machining (AXYZ):</b> in this mode, the machine is
free to move in all four axes while cutting, and the application analyzes the geometry
to find the right balance between lathe-like and planar movements.
</p>

<p>
This may result in more efficient machining of complex surfaces with variable 
curvature or hard-to-reach undercuts - but it's seldom of any use to begin with,
and it can be approximated by alternating between the two techniques mentioned
earlier; the extra cost is difficult to justify in hobbyist work.
</p>

</li></ul>

<p>
<span>What to buy:</span> your call. If indexed cutting is all you need, you may be
able to live with lower-cost three-axis CAM.
</p>

<h5>3.2.1.2. 3D milling strategies</h5>

<p>
Vendors of CAM software tend to be pretty creative about the range of
specialized and obscure machining modes that they offer, but there are only three
options that really matter; the rest is either redundant, or doesn't
work well in complex molds.
</p>

<p>
Here are the three methods in question; the first two really must be supported
by the application you want to go with:
</p>

<ul>

<li><p>
<b>Overhead projection:</b> this method amounts to projecting a simple
surface-filling pattern onto the workpiece, from the top. In the most basic
case, the pattern may be just a bunch of evenly spaced parallel lines, connected
together on alternating ends. The tool then follows these lines in the X-Y plane
(X-A for lathe-style machining), and is lowered or raised as necessary to
reproduce the shape of the part:
</p>

<p><img src="https://lcamtuf.coredump.cx/gcnc/19-overhead.jpg"></p>

<p>
Such a computationally inexpensive approach is particularly efficient when
machining flat regions or very gentle slopes with a flat tip cutter; in this
case, the spacing between projected lines (<i>stepover</i>) may be comparable
to the diameter of the tool, and still produce excellent surface finish.
</p>

<p>Alas, the strategy is a bit less suitable as soon as the cutter gets near any
vertical surfaces. If the wall is in a direction perpendicular to the toolpath,
the process will leave scallops of uncut material, as shown above; the height of the
scallop is equal to
<code>cutter_radius - sqrt(4 * cutter_radius² - stepover²) / 2</code>.
Walls that happen to be parallel to the direction of the cut will acquire a better
finish, but the process may leave a layer of uncut material, up to
<code>stepover</code> thick. Walls at other angles will get a combination of both
artifacts.
</p>

<div>
<p>
<b>Note:</b> both of these issues can be remedied to some extent without switching to
a more advanced machining strategy. Scallop height can be managed with modest changes to
stepover - for example, when using a 3 mm tool, changing stepover from 2 mm to 0.5 mm
reduces scallop from 0.38 mm to 0.02 mm - that's a 20-fold improvement at the
expense of slowing down by a factor of four.
</p><p>
The other problem - with the accuracy of parallel walls - can be fixed by doing a second
pass using lines projected at a different angle, so that the cut is no longer parallel in
the previously affected area. Of course, the situation gets a lot trickier if you have walls
at many different angles, or worse yet, any arcs.
</p>
</div>

<p>
Good CAM software be able to not only generate linear projections,
but also "offset" patterns that are constructed from an arbitrary outline provided by the user.
This has some important benefits that we'll talk about soon; the end result looks kind of like
this:
</p>

<p><img src="https://lcamtuf.coredump.cx/gcnc/20-offset.jpg"></p>

</li><li><p><b>Z axis slicing:</b> also known as waterline cutting, this machining strategy starts by
creating a stack of horizontal surfaces, evenly spaced in the Z axis. Each of these surfaces
intersects the CAD model, and every such intersection results in a number of closed,
two-dimensional outlines of the part. These outlines can be then offset for the size of
the tool, checked for collisions, connected together, and used as a toolpath:</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/21-waterline.jpg">
</p>

<p>
This mode allows for faithful and highly efficient reproduction of intricate vertical
features, such as spur gears. On the flip side, it does not do anything useful for horizontal
surfaces; and produces staircase patterns on sloped surfaces, unless the spacing of Z levels
is unreasonably tight - as seen above.
</p>

<p>
On top of the basic mode with a constant Z step, some of the more expensive CAM programs allow
you to automatically detect and optimize the spacing of Z levels based on the geometry of the
part. That sounds nice in principle, but I could never get this feature to work in a sensible
and consistent way in any of the programs I have tried.
</p>

</li><li><p><b>3D draping:</b> this method generates a toolpath that always maintains a particular
distance between cuts, or keeps
a particular scallop size, regardless of the shape of the machined part;
this is somewhat akin to printing linear toolpaths on a piece of fabric, and then laying it
over the geometry to be reproduced.
</p>

<p>
This strategy can be a significant time saver when working with organic shapes using ball tip tools,
but it is not commonly useful in everyday mechanical work.
</p>

</li></ul>

<p>
<span>What to buy:</span> the two
first strategies must be supported unconditionally, and should come with
no strings attached: you should have full control over how they are used and when. The third one 
is a plus. Advanced features of these modes, and other toolpath generation methods, matter a lot
less.
</p>

<h5>3.2.1.3. Region selection capabilities</h5>

<p>
Efficient machining of complex models requires the ability to decide which tool and which
strategy will be applied to various regions of the model - and in what order. To facilitate this
process, your CAM application  should let you define a freeform region for every machining
operation, either by selecting an existing boundary curve imported alongside with the 3D
model - or by drawing something by hand. It should let you exclude regions within an
existing selection by picking a second curve inside the first one, too.
</p>

<p>
These capabilities are pretty much all that matters. You may notice that certain programs
have the ability to automatically generate selections based on some property of the model -
for example, to only machine flat surfaces, vertical walls, or something in between. These
features are sometimes nice, but are usually more limited or less reliable than what you can
do in CAD - so don't pay any special attention to this.
</p>

<p>
What else? Oh - several programs offer "residual machining" of regions left over after the
previous operation with a larger tool. This sounds great in theory, but is typically both
fairly coarse and extremely slow; I tried two applications that supported this feature, and
it misbehaved or ran out of memory more often than it proved to be useful.
</p>

<p>
<span>What to buy:</span> curve-based selection is a must. Pay little or no attention to the
rest.</p>

<h5>3.2.1.4. Cut optimization</h5>

<p>
Some CAM applications do not put any special thought into organizing the toolpath
segments that are spewed out by the underlying geometry-analyzing algorithm.
Depending on your model, the result of that can be pretty inefficient; for
example, a waterline cut that sequentially machines every outline on every layer before
moving further down will produce a total of 15 operations when machining these
two separate holes (left):
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/22-optimization.jpg">
</p>

<p>
The image on the right shows a more sensible ordering: instead of going back and forth
between the machined regions, finish one first, and then move to the other. The result is
9 operations, consisting mostly of short movements. Quite a few programs are capable of such
common-sense optimizations - but not all.
</p>

<p>
<span>What to buy:</span> it is useful to shop for CAM applications that offer cut optimization,
especially for waterline machining. It's not an essential feature, but it's a major time
saver. If in doubt, consult the manuals or ask the vendor before buying.
</p>

<h5>3.2.1.5. Arc interpolation</h5>

<p>G-code - the language supported by most of the CNC machines on the market - has several
commands that can be used to execute circular, spiral, or helical movements of the tool.
While support for these opcodes is not required, quite a few embedded controllers
recognize them, and translate them to motion optimized for the hardware they are hooked up
to.</p>

<p>
CAM programs, however, usually convert input files to
<a href="https://en.wikipedia.org/wiki/Polygon_mesh">polygon meshes</a>, and generate toolpaths
where arcs are broken into thousands of small, linear movements. This practice is not just
a waste of electrons, but may result in lower machining speeds, because it hinders the ability
for the controller to plan ahead and pick the best acceleration and braking strategy. Perhaps
more annoying is that if the pitch of the generated 3D mesh doesn't overlap with the hardware resolution
of the motors in your CNC mill, needless vibration may be introduced, too.
</p>

<p>
<span>What to buy:</span> If your machine supports arc interpolation, it is good for the CAM program 
to know how to generate G-code that leverages that. It's not a deal-breaker, but something
really nice to have.
</p>

<h5>3.2.1.5. Cut direction control</h5>

<p>
There are some brief moments in the cutting process where the tool may be pluging head-on into
uncut material. Most of the time, though, the tool simply works to widen existing pockets, and
engages the material one side at a time. There are two principal configurations possible
during that task:
</p>

<p><img src="https://lcamtuf.coredump.cx/gcnc/23-conventional.jpg"></p>

<p>
In the conventional (aka <i>upcut</i>) mode, contact with the workpiece is made on the left
side of the tool, in relation to the direction of movement. Toolpaths generated this way
allow the material to be engaged very gradually, starting with a near-zero chip load, and
ramping it up. This strategy is less dependent on the rigidity of the tool and the workpiece,
and results in superior dimensional accuracy and surface finish with rigid plastics and many
other types of easily machinable materials.
</p>

<p>
In the climb (<i>downcut</i>) mode, the orientation of the tool in relation to the workpiece
is reversed, and every flute plunges into the material to start at the maximum chip load, and
then have it taper off. This approach puts greater strain on the tool - and if the tool or
the workpiece deflects, it reduces the dimensional accuracy of the final part. That said,
it may offer better cutting speeds or improved surface finish in certain annoying materials
- such as metal alloys prone to work hardening, or soft, malleable thermoplastics.
</p>

<p>
In waterline cutting, maintaining a specific direction of cuts comes naturally, and at no
extra cost; in fact, it takes special effort to alternate the type of cut between each layer.
Overhead projection strategies are more problematic: if the projected pattern is just a bunch
of parallel lines, the only way to achieve consistent direction is to cut the first line, 
raise the tool, move back to the starting side, lower the tool, and make the next cut -
in short, there's a lot of non-cutting movements. And that's the major advantage of
"offset", <a href="https://lcamtuf.coredump.cx/gcnc/20-offset.jpg">spiral-like</a>
projections that we have mentioned earlier on: they permit the direction
to be maintained without having to raise the tool.
</p>

<p>
<span>What to buy:</span> you should make sure that the software gives you full
control over the direction of cut for every machining strategy of note. Not having this 
ability will make your life miserable, especially when working with miniature, long-reach
tools that flex easily.
</p>

<h5>3.2.1.6. Input and output formats</h5>

<p>
Last but not least, the application you end up choosing needs to support the
file formats that can be written by your CAD package. The most common interchange formats
include IGES and STEP (both of which are vendor-agnostic); DXF and DWF (originating with
AutoCAD); 3DM (Rhino3D); and STL (3D Systems); support for at least one of these is good
news - and the more, the better. NURBS surfaces are supported natively in all of these
except for STL and DXF, where approximate tessellation may be required.
</p>

<p>
Input formats aside, you also need to confirm that the application actually
supports your CNC mill, and can generate suitable output files. If your machine speaks G-code,
and the application offers the ability to create custom G-code postprocessors,
you may be able to find a third-party converter or write your own one with relatively little
effort; otherwise, you need to make sure that the mill is supported out of the box.
</p>

<h5>3.2.1.7. ...and all the things you don't have to worry about</h5>

<p>
Here's a short and incomplete list of things that tend to appear in product specifications
and may seem important, but typically don't matter much:
</p>

<ul>

<li> <p><b>2.5D machining strategies:</b> these features are used to convert bitmaps and other
2D input data into engravings, simple cutouts, etc. They are truly useful only if you don't
have a CAD application to begin with, which obviously won't be the case.</p>

</li><li> <p><b>Support for drilling, tapping, boring, and so on:</b> when working in plastics, it
makes virtually no sense to buy specialized tools and use exotic toolpaths to make holes and
perform similar tasks; end mills, operated the usual way, will almost always do.</p>

</li><li> <p><b>Manual toolpath editing:</b> this ability may be useful for very simple models, where
the toolpaths are trivial, and fixing them by hand may be a convenient alternative to reworking
the model. Toolpaths in complex molds are nearly impenetrable, though.</p>

</li><li> <p><b>Visualization support:</b> the ability to simulate the machining process is
a nice addition, especially when making your baby steps with CAM, or when dealing with
buggy software - but ultimately, it's not
worth the extra price. Once you work out a sensible machining workflow, the results are
almost always easy to predict.</p>

</li><li> <p><b>Collision detection:</b> this lets you prevent cuts where the tool taper or collet
holder would hit the workpiece, because you miscalculated the reach of the tool. This is
useful chiefly if you have a machine with an automatic tool changer; otherwise, adjusting
collision detection settings after every tool change is about as problematic as configuring
the toolpath correctly to begin with.</p>

</li><li> <p><b>Support for workpiece approach methods:</b> center-cutting tools can work as drills, but
aren't particularly competent in this role; plunging them directly into tough materials may
reduce their life expectancy quite a bit, especially if the cutter has a flat tip. This can be
solved by generating toolpaths where the tool enters at an angle - that said,
for easily machinable plastics, it's pretty much a non-issue.</p>

</li><li> <p><b>Cutting wizards, libraries of materials, etc:</b> while these seem cool, they are
generally tailored at simple industrial applications or other beginner work. Configuring the
parameters manually is almost always a safer bet.</p>

</li><li> <p><b>Drawing, part editing, and analysis tools:</b> having these capabilities available in
a CAM package is useful only if you don't have them in your CAD application - but that, again,
shouldn't be the case here.</p>

</li></ul>

<p>
Of course, feel free to ping me if you stumbled upon any other cool-sounding feature, and
need help figuring out what it's worth.
</p>

<h5>3.2.1.8. All right - so which CAM package is good for me?</h5>

<p>
Well, it's complicated. For starters, your CNC machine may come with a basic CAM application,
and that package may turn out to be good enough for starter jobs. For example, Modela 
Player 4 - the application that comes with Roland mills - is pretty decent. That said,
in the long haul, you will probably want to upgrade to something more featured and 
flexible.
</p>

<p>
Somewhat lamentably, there aren't that many free-of-charge applications that would be easy to use
yet powerful enough; <a href="http://www.mecsoft.com/freemill.shtml">FreeMill</a> is one
potential choice, but it only supports a single, rudimentary machining strategy - and
really, isn't worth much.
</p>

<p>
This leaves you with commercial tools. If you are on a tight budget, you may want to check out
<a href="http://www.grzsoftware.com/">MeshCAM</a> ($200), which is actually a very
competent package with good technical support. Other alternatives within that price range
include <a href="http://www.vectric.com/WebSite/Vectric/cut3d/c3d_index.htm">Cut 3D</a>,
or the hobby license for <a href="http://www.deskproto.com/order/priceinformation.htm">DeskProto</a>.
I have tried both DeskProto and MeshCAM, and both of them are pretty good -
so these would be my top picks.
</p>

<p>
Other than that, there are quite a few
other reputable choices with prices hovering around $1,000 and more. The pricing in the
"pro" segment, especially for more featured packages with 4-axis machining,
is still rooted in the era of strictly-industrial CNC - but deep discounts are
available to students, and sometimes, to those who buy the software along with the mill
itself. Notable applications in this category 
include <a href="http://www.mecsoft.com/">VisualMILL / RhinoCAM</a>,
<a href="http://www.alibrecam.com/">Alibre CAM</a>
<a href="http://www.picasoft.com/">Mayka</a>,
<a href="http://www.madcamcnc.com/">madCAM</a>, and quite a few more. If money is no
object, or if you can get a good discount, you may want to dig deeper. If you need
advice, I've seen VisualMILL in action, and it looked pretty good.
</p>

<p>
<b><span>Tip:</span></b> many of the commercial packages have demo versions. These demos are either
limited to a 30-day trial, or lack the ability to write G-code, but are otherwise fully-featured
- so be sure to check them out before you buy.
</p>

<h4>3.2.2. First minutes with CAM</h4>

<p>
CAM programs can be counterintuitive; you will probably need to read the manual carefully to
even understand how to create a toolpath, or write the resulting NC file. These
applications are also often finicky, unforgiving, and buggy - so it's important to take it
slow, and check everything twice.
</p>

<p>
Before loading your 3D models, you need to configure the software
for your particular machine, either by selecting the appropriate postprocessor, or - in the worst 
case - by writing your own based on an existing config file for a similar mill (not as scary
as it sounds, as long as your machine came with a code reference manual). You should also
go through all the configuration options, and make sure that
units are set to millimeters, that the tolerance is 1 µm or better, that arc
interpolation is enabled if supported by your hardware, and that the G-code
coordinate system is set to G54 (the first, default user-configurable coordinate
system, and the only one you will be using in hobby work).
</p>

<p>
With this out of the way, you should load the geometry to be cut. Let's use the heart-shaped
mold created earlier on; if you need to export it from your CAD application to a
mesh-based format, such as DXF or STL, be sure to configure meshing tolerance to
1 µm or better for that step, too, as this setting is often separate from the
global value.
</p>

<p>
Once the model is loaded, you need to verify its position. For three-axis work,
the mold cavity should be facing up, and the top surface should be aligned with the
<code>Z=0</code> plane in the CAM application; when looking from the top, the bottom
left corner of the mold needs to be at <code>X=0</code>, <code>Y=0</code>, too.
If it wasn't loaded this way, you can move or rotate it as needed,
but also try to figure out what went wrong: is your original CAD model oriented correctly?
If that's not the reason, is there a CAM-level option you should have toggled at import time?
</p>

<p>
Well, all right. Once the model is in the right spot, it's time to create some toolpaths next.
</p>

<h4>3.2.3. Roughing toolpaths</h4>

<p>
To maintain sanity, it helps to split the cutting process into several phases. Each of
these phases accomplishes a different task, and may use a different tool, feed
speed, machining strategy, stepover distance, and so forth. The first phase of almost
every project is known <i>roughing</i>; its goal is to remove the bulk of the material
as efficiently as possible. Of course, astute readers may ask why this isn't also the final step
- and the answer is that, quite simply, heavy chip loads and rapid tool speeds offer limited
accuracy; it's better to leave a small margin of uncut material, and refinish the surface in
a separate process later on.
</p>

<p>
The usual roughing strategy is a hybrid approach where the model is cut in Z layers,
and on every layer, the application first uses a pattern of horizontal movements to
clear the pockets, and then performs a waterline-type cleanup pass. Once the first
level is done, the toolpath advances to the next one:
</p>

<p><img src="https://lcamtuf.coredump.cx/gcnc/24-roughing.jpg"></p>

<p>
In some applications, roughing may not include that cleanup pass, in which case, you
should probably
configure a separate waterline step right after roughing. This is to ensure that
the margin of remaining material is reasonably uniform, so that chip loads don't
fluctuate wildly later on.
</p>

<p>
<b><span>Tip:</span></b> good CAM applications let you use pocket-shaped 
<a href="https://lcamtuf.coredump.cx/gcnc/20-offset.jpg">offset cuts</a>, rather than linear movements; this completely
eliminates the need for the waterline cleanup pass. If that mode is offered by your
software, take advantage of it - it
will speed up the process and also let you maintain a consistent direction of cuts.
</p>

<p>
In any case, for the materials used in this guide, you should configure the roughing
process the following way:
</p>

<ul>

<li><p><b>Tool size:</b> use a 3 mm or 1/8" flat tip
cutter, but lie to the application and give it a diameter about 15% higher (say,
3.5 mm). This will cause the toolpath to be slightly farther away from the
workpiece than actually makes sense for the tool - thus creating a margin for
roughing in the X-Y plane.</p>

</li><li><p><b>Tool length offset:</b> tell the program to pretend that the tool is about
5% of tool diameter longer than set on the machine (effectively moving the toolpath up).
This introduces a similar margin in the Z axis. (If not supported by the application,
you can make this adjustment simply by setting Z origin a bit higher than measured.)</p>

</li><li><p><b>Roughing margin:</b> set to zero. Using tool size and length offset is
usually more intuitive, especially for toolpaths where you want to have an offset only
in a specific direction.</p>

</li><li><p><b>Stepover:</b> something between 30% and 50% of tool diameter
should do. You can ramp it up even higher, but there's no real need to 
do so in this case.</p>

</li><li><p><b>Z level spacing:</b> set to 1 mm. Especially if the value is high, it should
at least vaguely correspond to the spacing of key features of the mold in the Z axis.</p>

</li><li><p><b>Tolerance / sampling resolution:</b> for roughing, can be safely set to around 0.01
mm or so, to reduce processing time.</p>

</li><li><p><b>Machining speed:</b> use maximum spindle RPM; feed per tooth should be about 0.08 mm 
(i.e., 2,000 mm/min with four flutes at 6,000 RPM).</p>

</li><li><p><b>Cut direction:</b> when using offset cuts, use conventional cutting with the tool
first engaging at the center of each pocket. When using linear cuts, set to bidirectional
(<i>meander</i>) mode. No special approach strategy required.</p>

</li><li><p><b>Machining region:</b> set so that the cutter stays completely within the
envelope of our mold, and does not attempt to trace around it. Note that depending
on your CAM application, selection regions may work in one of three ways:</p>

<ul>

<li> <p><b>Tool fully inside:</b> the cutter
must stay completely within the bounds of the selection. Nothing that lies outside the
region will be machined. Protrusions that lie within the selected area, but
are closer than <code>tool_diameter</code> to the boundary, will not be fully 
profiled, as the tool won't be able to pass between them and the limiting curve.</p>

</li><li> <p><b>Tool center inside:</b> the center point of the end mill
is required to stay inside the selection, but the tool itself can stick out slightly.
Features up to <code>tool_diameter / 2</code> away from the selection can be
machined by the tool if necessary. Protrusions within the selection must be at least
that far from the boundary to be fully profiled.</p>

</li><li> <p><b>Tool touches selection:</b> the tool is free to roam anywhere
as long as <u>any</u> point of its geometry stays within the selected region. In this mode,
features within <code>tool_diameter</code> from the boundary may be machined. Everything
within the selection is cut.</p>

</li></ul>

<p>
It doesn't really matter which selection philosophy the application happens to use, as
long as you are aware of its behavior, and can plan accordingly. If you are still
not sure what's going on, check out this image; teal denotes the desired geometry,
the selection rectangle is cyan, and the remaining unwanted material is red:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/25-selection.jpg">
</p>

</li></ul>

<p>
Well, that's pretty much it. Once the roughing operation is set up, simply
tell the program to calculate the toolpath, and examine the result closely.
Make sure that it actually makes sense: is the tool staying within our virtual
workpiece? Do the toolpaths look anything like what we discussed before?
If the program can give you estimated machining time, is it less than
10 minutes or so?
</p>

<p>
If everything checks out, congratulations; now, let's finish this thing.
</p>

<h4>3.2.4. Finishing toolpaths</h4>

<p>
Finishing toolpaths typically refine the geometry in several consecutive
steps:
</p>

<ol>

<li> <p>The vertical (Z axis) margin on flat surfaces is removed using a projection
toolpath that has a zero tool height offset, but preserves the original
tool diameter offset from the roughing process.</p>

</li><li> <p>The X-Y plane margin around vertical features is removed using
properly spaced waterline cuts, configured with the true diameter of the tool.</p>

</li><li> <p>If there are any sloped surfaces, they are locally refinished using a 
tightly spaced projection toolpath or 3D draping, possibly with a ball
end tool (this is not applicable to our model).</p>

</li><li> <p>If there are any holes or tight pockets that couldn't be faithfully
reproduced with the current cutter, they are selectively refinished with
a smaller one.</p>

</li></ol>

<p>
To take care of the first item on this list, you'd normally want to
configure an offset-type, projection finishing toolpath with the following
parameters:
</p>

<ul>

<li><p><b>Tool size:</b> about 2-5% higher than the value used
for roughing (3.6 mm or so).</p>

</li><li><p><b>Tool length offset and margin:</b> both set to zero.</p>

</li><li><p><b>Stepover:</b> not critical; 1 mm is a safe bet.</p>

</li><li><p><b>Tolerance / sampling resolution:</b> 0.5 µm or so.</p>

</li><li><p><b>Machining speed:</b> maximum RPM; feed speed should be
about 0.05 mm per tooth (i.e., 1,500 mm/min with four flutes at 6,000 RPM).</p>

</li><li><p><b>Cut direction:</b> conventional if using offset cuts. Otherwise,
for parallel toolpaths, use bidirectional cutting mode to save time.</p>

</li><li><p><b>Machining region:</b> restrict to the inside of the mold
cavity. Make sure that the generated toolpath doesn't climb the sides of the
cavity, as this would be a no-op.</p>

</li></ul>

<p>
This step cleans up the flats; now, we need to take care of the walls. This is done
with a "pure" waterline toolpath that traces around vertical shapes, and does
nothing more. The parameters for this step should be:
</p>

<ul>

<li><p><b>Tool size:</b> enter the actual, measured diameter of the tool. It's
good hygiene to include TIR, if known.</p>

</li><li><p><b>Z distance:</b> set to 0.5 mm. In general, this must coincide with the
spacing of vertical features of the mold, and shouldn't be too large (to avoid
high chip loads). Any features that are not aligned with this parameter may need
to be refinished separately.</p>

</li><li><p><b>Machining region:</b> restrict to the inside of the pocket. This time,
make sure that the outer walls of the pocket <u>will</u> be machined.</p>

</li><li><p><b>Starting height:</b> 0 mm. Always double-check this parameter for
waterline toolpaths,
as rouding errors may sometimes prompt the CAM application to default to
something dubious.</p>

</li></ul>

<p>
Everything else should be the same as for the previous step.
</p>

<p>
Well, that's almost it. After this toolpath, the heart should be looking pretty
much the way we designed it - with just one minor blemish: center kink 
in the middle of the heart will have a slight fillet on the top, due to our
relatively large 3 mm tool not being able to fully squeeze into that tight spot.
To fix this problem, we can perform a selective waterline cut with a 1 mm end mill.
Most of the parameters don't change from step #2, except:
</p>

<ul>

<li><p><b>Tool size:</b> enter the actual, TIR-compensated diameter of the new tool.</p>

</li><li><p><b>Z distance:</b> use 0.25 mm.</p>

</li><li><p><b>Speed:</b> maximum RPM, feed of
around 0.035 mm per tooth should be fine (that's
around 450 mm/min with two flutes at 6,000 RPM).</p>

</li><li><p><b>Machining region:</b> make a rectangular or circular
selection extending a few millimeters around the problematic kink.</p>

</li></ul>

<p>
And... well, that's it! Generate the toolpaths and pat yourself on the back.
</p>

<div>
<p>
<b>For future reference:</b> here's the list of maximum recommended cutting parameters for the tools
you should have bought. These values are applicable <u>only</u> to
several classes easily machinable prototyping materials that we're going to
talk about soon - when working in more demanding stock, you will need to slow down:
</p>

<ul>
<li><p><b>0.4 mm:</b> feed 0.01 mm/tooth, 0.125 mm cut depth, 0.125 mm stepover,</p>
</li><li><p><b>1 mm:</b> feed 0.035 mm/tooth, 0.25 mm cut depth, 0.4 mm stepover,</p>
</li><li><p><b>3 mm:</b> feed 0.1 mm/tooth, 1 mm cut depth, 2 mm stepover,</p>
</li><li><p><b>6 mm:</b> feed 0.2 mm/tooth, 3 mm cut depth, 5 mm stepover.</p>
</li></ul>

<p>
Speeds reduced by 20-40% are recommended for finishing operations, especially 
with 3 mm and 6 mm tools.
</p>

</div>

<h4>3.2.5. Final sanity check</h4>

<p>
Measure twice, cut once. Before sending any data to the machine, it's always good to
recheck your work; 5 minutes of that may save you several hours of troubleshooting
in the physical realm. Here are some questions to ask yourself:
</p>

<ul>

<li><p><b>Have you entered all the values correctly?</b> Confirm tool diameters,
stepover, Z distance, and feed speeds. A missing zero or a misplaced decimal
point can cost you $20 for a broken tool.</p>

</li><li><p><b>Do the toolpaths look OK?</b> Anything that seems weird, suboptimal,
or that exits the expected machining envelope? Any places where the toolpath
seems to go straight through the geometry? Run a simulation if possible, and
inspect the model from all sides.</p>

</li><li><p><b>Have you covered everything that needs machining?</b> Are there any
spots where toolpaths do not reach, even though you wanted them to? For selective
refinishing, have you selected all the regions you wanted to clean up? 
It's embarrassing to miss a spot.</p>

</li><li><p><b>Is there any risk of collisions?</b> Are the toolpaths suitable, given the
reach of the tools you are going to use? Are all the traverse movements happening
well above the workpiece? Several CAM programs make it easy to misconfigure this,
and plunge through an <a href="https://www.youtube.com/watch?v=uWOAAyN3btc#t=2m20s">essential
part of your work</a>.</p>

</li></ul>

<p>
Try to use that checklist until you are reasonably comfortable with the process; it's
not that mistakes are common, but they can strike at inopportune times.
</p>

<p>
If everything checks out, you need to get the toolpaths ready for cutting. In some programs
(e.g., Modela Player), the output is done directly from the application - in which case, just
sit tight. In many other apps, the data is written to a text file, and that file is then
sent to the machine using a separate CNC utility; if so, export ("post") the toolpaths now.
Of course, remember to save the toolpath for the 1 mm tool in a separate file!
</p>

<h3>3.3. Please, let's cut stuff already!</h3>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/cb-roughing.jpg">
<img src="https://lcamtuf.coredump.cx/gcnc/cb-finishing.jpg">
</p>

<p>
Okay, okay - but first, you need a suitable workpiece. We will cover more permanent
options shortly, but for your initial tests, I strongly recommend getting something called
<i>machinable wax</i>. It is a hard, rigid, wax-like substance, technically a blend of
low-density polyethylene (LDPE) and paraffin. It is not the cheapest or most durable
stock, but has two important properties: it machines quickly to a very good finish with
excellent dimensional accuracy; and more importantly, because it's much softer and more fragile
than common plastics, even fairly major mistakes won't immediately result in a broken tool.
</p>

<p>
In the States, the material is available cheaply from the folks at
<a href="http://www.machinablewax.com/">MachinableWax.com</a>. I would suggest ordering
their set #17-424215 (featured on
<a href="http://www.machinablewax.com/machinable_wax_jewel.html">this page</a>). It's
a box of 12 pieces, 42 x 42 x 15 mm, selling for $21. Don't overdo it
- this really isn't the best or the most cost-efficient material for real work, so get
just a single box or two.
</p>

<p>
The only other thing you need in advance is a way to secure the wax to the milling table.
Your mill may have come with some sort of a clamping system, or at least slots or screw
holes that let you rig something together after a quick trip to the hardware store. Alternatively,
you may want to consider 
<a href="http://www.hightechsystemsllc.com/work_holding.html">MWHS01</a> from High Tech Systems
($100), which is a very versatile and lightweight system of clamps that should work for almost
any medium or large CNC mill. That said, when working with easily machinable materials and using
small tools, you can also get away with strong, thin double-sided tape, such as
<a href="https://www.amazon.com/3M-Double-Coated-Clear-PRICE/dp/B000V4P90G">3M 444</a>
or <a href="https://www.amazon.com/Tesa-Double-sided-Scrapbook-Clear-Release/dp/B004V3XQXK">Tesa 4965</a>.
Simply place four short strips in the corners of the workpiece, and press it down; then
lift one of the corners to detach.
</p>

<h4>3.3.1. Setting up a job</h4>

<p>
Assuming you have all the necessary supplies, we can mount the workpiece at this point.
Wipe clean the table and the stock material, apply the double-sided tape as described
earlier, and attach the workpiece to the table, making sure that it's entirely within the
working area of the mill. Depending on the design of the machine and the length of the
tool, you may need to put something underneath the workpiece to allow the cutter to reach
it, too.
</p>

<p>
Next, confirm that the workpiece is actually
attached securely, and install your 3 mm tool in the
collet. Tighten the tool holder, quickly confirm the TIR, and make sure that there is some
clearance between the tool and the top of the workpiece when the spindle is fully retracted.
Assuming everything is fine, you can now turn on the mill and let it initialize.
</p>

<p>
<b><span>Caution:</span></b> I am assuming that, as requested 
earlier on, you have familiarized yourself with the operating manual of your mill, and
with the safety tips information included in <a href="https://lcamtuf.coredump.cx/gcnc/ch7/">section 7</a> of this guide. As with any power
tool, you can get hurt if you are careless.
</p>

<p>
For G-code mills, the next step is to set the coordinate system to G54, then move the tool to
align it with the bottom left corner of the workpiece (looking from the top), plus about 5 mm.
With the tool at this X-Y location, tell the machine to set its X and Y origins; this is done
in a hardware-specific fashion.
</p>

<p>
Setting the Z origin is the last hurdle to deal with. Find a convenient location on the workpiece,
in a region that won't be removed in the cutting process. If the machine has a tool sensor, simply
place it underneath the tool, and follow the manual to perform the measurement. Without a sensor,
you can use the trick we talked about earlier on: place a thin strip of paper or foil on top of the
workpiece, and wiggle it back and forth while lowering the tool; use increments of 0.05 mm when
you are close, and stop the moment the tool pinches the foil. Set the Z origin in that location;
oh, and try not to pinch your hand instead!
</p>

<p>
Done? Well, in that case, it's time to put on safety glasses, perhaps put several dabs of 
cutting oil in the region to be cut, and then
hit "send" and output the 3 mm roughing and finishing toolpaths
to the machine. With any luck, several minutes later, the machining process should be wrapped up.
Vacuum off a bit and inspect the result; is the shape in line with what we're expecting? If yes,
let's fix the kink: install the 1 mm tool, check TIR, redo the tool height measurement
(<b>very important</b>), and hit "send" to output the remaining toolpath on your list.
</p>

<p>
In case you are wondering, 
there are very few things that can go wrong with the cutting process itself, and all of them
should be fairly self-explanatory. For example, if the machine starts cutting at an unexpected
location, or too high / too low in relation to the workpiece, you probably messed up setting the
origins, selecting the right coordinate system, or had the CAM model positioned incorrectly.
Similarly, if the tool breaks while cutting in the expected location, this is probably due to
grossly incorrect RPM, feed speed, or cut-in depth; or bad ordering of toolpaths. But chances
are, you won't run into any issues just yet, so sit back and relax!
</p>

<p>
<b>Note:</b> as hinted earlier, for more complex jobs, it's useful to keep the roughing end
mill and the finishing cutter separate, even if both processes call for the same diameter of the
tool. This way, you don't have to worry about the loss of micron-scale accuracy as the roughing 
end mill begins to wear - and you will be able to use both tools for a lot longer.
</p>

<h4>3.3.2. Inspection and troubleshooting</h4>

<p>
As soon as you're done, detach the mold and vacuum in thoroughly. Machinable wax sometimes requires
a gentle but firm cleaning with a brush and a touch of compressed air to get rid of the
somewhat sticky chips - so do that, and then have a closer look. Is the surface silk smooth? Do you
see any pronounced tool marks or gouges on vertical surfaces? What about horizontal ones? Do
the dimensions check out when you use a caliper? (In more complex projects, pin gage sets are useful
for measuring the diameter of small holes, too.)
</p>

<p>
Chances are, you're in good shape - but if anything is even slightly wrong, now would be the right
time to track the problem down; don't wait until you're working on more time-consuming projects, or in
less forgiving materials. Here are several causes of the problems you are most likely to see:
</p>

<ul>

<li><p><b>Tool ploughing through an essential part of the geometry:</b> this may be due to
poorly configured toolpaths; failure to adjust Z origin after tool change; axis stepper motor overload in
open-loop machines; or sending a cutting job while
the tool is positioned below the top of the workpiece (not all CAM applications prefix the generated
toolpath with an instruction to retract the cutter). Double-check that the workpiece is still properly
attached, too.</p>

</li><li><p><b>Significant dimensional inaccuracy:</b> this is usually caused by incorrectly specified
tool diameter, excessive TIR, misaligned spindle axis, incorrectly secured workpiece, or poor mill calibration.
The last problem will be directly proportional to the size of the machined feature, and if so, can be measured
and compensated for in software.</p>

</li><li><p><b>Substantial tool marks or gouges:</b> these defects are typically due to high TIR, excessive speeds,
or high chip loads during finishing (e.g., due to incorrect choice of toolpaths). Sometimes, lowering RPM
is all you need.</p>

</li><li><p><b>Very poor overall appearance of the mold:</b> this may be due to unsuitable stock material
(e.g., certain types of soft, malleable thermoplastics); using a bent or chipped tool; using a drill
instead of an end mill; or having the workpiece partly detach from the table in the middle of the cutting
job.</p>

</li></ul>

<p>
Still, in all likelihood, the result will be fine. If that's the case, let's wrap up by reviewing some
common-sense rules that come handy in mold design, just so that you are well-equipped to work on your
next CNC project - and then, let's cast a mold.
</p>

<h4>3.4. Things to avoid in mold design</h4>

<p>
There are relatively few real constraints on what you can cut on your milling machine, but there
are several simple design strategies you should follow to keep the cutting process simple and quick,
and make accurate, durable, and dimensionally accurate molds. Here's the gist of it:
</p>

<ul>

<li> <p>To speed up toolpath calculations, always choose straight lines over arcs when you can.
For example, you may want to opt for simple, manually drawn shapes for mold cavities, or use chamfering
instead of  filleting to provide reliefs in places where aesthetics do not matter. This keeps the
resulting 3D mesh a lot simpler, and can dramatically improve the speed of CAM work.</p>

</li><li> <p>To simplify the cutting process, it's good to maintain a reasonably consistent margin between
each of the parts inside the mold, and between parts and the walls of the mold cavity. Use a distance
that is slightly higher than the diameter of the tool entered for the roughing process.</p>

</li><li> <p>To help with waterline cutting, it's useful to align most of the vertical features present in the
mold to 0.5 mm or so. This minimizes the need for selective remachining of individual parts.</p>

</li><li> <p>When dealing with parts of vastly different part
heights, it may be desirable to create several separate
mold cavities, instead of trying to cram everything into a single one. Using a shallow cavity for
all the small parts will often save you time and materials.</p>

</li><li> <p>It's preferable to avoid holes and slots that have a size exactly matching the diameter of
the tool that will be used to cut them; due to rounding errors, such situations can confuse your CAM
software, and make it hard to generate a valid toolpath. Allowing at least 1% wiggle room is a good
idea.</p>

</li><li> <p>Any small, deep holes that reach the very bottom of the master pattern should have their depth
reduced by about 0.1 mm. This eliminates the risk that the resulting protrusion of the flexible
negative mold will rub against the top cover used in the casting process, and deflect. The resulting
0.1 mm film is very easy to remove from the final part.</p>

</li><li> <p>You need to allow some headroom between the top of the mold cavity, and the top of the tallest
part laid out on the inside; this forms the bottom surface of the resulting negative mold. Allowance
of around 2-3 mm is usually OK.</p>

</li><li> <p>Deep molds (over 10-15 mm or so) benefit from draft angles on their outer walls (a slight
slant, created using the offset and loft operators). Introducing several 5 mm deep pull tabs on the
edges of the mold may be helpful, too.</p>

</li><li> <p>Large-volume parts should use molds that are scaled up accordingly, and have more generous
margins and headroom, to support the weight of the resin and the mold itself.</p>

</li></ul>

<p>
Well, that's it. It may sound overwhelming, but once you catch a whiff of it, even remarkably complex
multi-part molds are fairly easy to crank out. We'll cover this and several other advanced design
topics later on - but for now, let's have some fun with polymers!
</p>

<!-- START~4~Resin casting and you~ -->

<h2><a name="4">4. Resin casting and you</a></h2>

<p>
As discussed in <a href="https://lcamtuf.coredump.cx/gcnc/ch1/#1.3">section 1.3</a> of this guide, 
<a href="http://makezine.com/2014/03/21/resin-casting-going-from-cad-to-engineering-grade-plastic-parts/">resin casting</a>
is a pretty amazing, simple, and user-friendly process that comes equally handy in
CNC prototyping, 3D printing, and in manual DIY work; all its sophisticated uses aside, you will
end up using it to replace broken parts in appliances or toys, make unique gifts, or even
encapsulate backyard flowers or bugs (don't deny it).
</p>

<p>
Alas, the online market for moldmaking and casting supplies is dominated by several companies that
cater chiefly to artistic users, and sell expensive products with poor mechanical properties and
little utility in high-precision engineering work.

In that spirit, even if you are familiar with artistic resin casting using epoxies, polyester
resins, or polyurethanes from <a href="http://www.alumilite.com/">Alumilite</a>,
<a href="http://www.smooth-on.com/">Smooth-On</a>, and similar sources, you will be probably
surprised by how much better your results can get.
</p>

<h3>4.1. Raw materials</h3>

<h4>4.1.1. Machinable stock</h4>

<p>
Well, before we dive into the world of casting resins, we should briefly revisit the choice of
materials you can use to make master patterns. This part of this chapter is specific to projects
that rely on CNC milling,
so if you are interested in replicating manually crafted or 3D printed parts, you may want to
skip ahead a page or two (<a href="http://www.hirstarts.com/moldmake/moldmaking.html">this site</a>
provides a good overview of how to build patterns by hand - and if you have any other questions,
feel free to drop me a mail or stop by <a href="http://www.reddit.com/r/resincasting">/r/resincasting</a>).
</p>

<p>
Still here? All right! Of course, milling machines are not particularly fussy, and will
cut almost anything that is softer than tungsten carbide, but rigid enough to stay in one place;
still, some materials are more predictable than others, and produce better results. Prime choices
include rigid engineering plastics such as polyurethane, epoxy, polyester, ABS, polyamide
(Nylon), or acetal (Delrin); 
many varieties of hard woords; aluminum, brass, and other soft metals and alloys; and
more exotic choices such as printed circuit boards, hard waxes, plaster, etc.
</p>

<p>
Conversely, common materials that machine with greater difficulty or offer sub-par surface
finish include stringy, low-melt thermoplastics
(PET, polycarbonate, some grades of polyethylene); rubbers and 
other stretchy or squishy polymers (including some grades of PVC and
most polystyrene foams); plywood and particle boards (including MDF); and exceptionally
hard or highly abrasive stuff, such as steel, stone, or glass. Of course, many of these
materials can be still cast or formed using CNC-machined molds and dies.
</p>

<p>
Poor choice of working materials is one of the most common mistakes made by hobbyist machinists; quite
a few people stick to workpieces that offer poor accuracy, get damaged easily, gum up the tool, or
simply cost way too much. For moldmaking purposes, your best bet is one of the
little-known materials: an extremely accurate, low cost piece of plastic known as a <i>medium-density
modelling board</i>, originally devised for the automotive industry. It's essentially a mix of medium
strength polyurethane, and a combination of soft fillers such as calcium carbonate and aluminum hydroxide.
There are many types of machinable boards, but the one we are interested in has a density of about
0.70-0.78 g/cm³, and vaguely resembles wood:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/26-renshape.jpg">
</p>

<p>
Prototyping boards of this particular variety include 
<a href="http://www.huntsman.com/">Huntsman</a> RenShape 460 (or sligthly less dense BM 5460),
<a href="http://www.axson-na.com/">Axson</a> ProLab 65,
<a href="http://www.sika.com/">Sika</a> SikaBlock M700, 
<a href="http://www.bccproducts.com/modelingboards">BCC</a> MB2001,
<a href="http://www.necumer.de/">Necuron</a> Necumer 651, and several more. The material is
typically sold in bulk, in sheets of about 50 x 150 cm, 25 mm thick. This may sound like a lot,
but I recommend buying a full board, rather than grossly overpriced cut-to-size bits. The material
lasts me for about a year, and costs about $12 per liter (roughly $250 for the whole
thing). It's much less than what you'd pay for a similar slab of HDPE or acrylic - 
and it machines easier, too. (Planks of dense hard wood, when glued together and planed,
may be a cheaper alternative for uncomplicated parts.)
</p>

<p>
Buying prototyping boards is actually pretty easy. If you are in the US, you can simply go to
<a href="http://www.freemansupply.com/">Freeman Supply</a>, and order RenShape 460 online (search for
item #075229). In other
places, simply look at the manufacturers' websites and find local distributors, then send out
several e-mails or make some calls (online ordering isn't common in the industrial world).
Be aware that prices may vary significantly, so shop around.
</p>

<p>
Alongside with the board, you may want to order a matching board repair putty; it's a
fast-curing, polyester compound that can be used to fix minor damage to your molds, or even
completely fill a previously created cavity to reuse a particular workpiece for a new project.
If you are ordering online with Freeman, go with their
<a href="http://www.freemansupply.net/QuikFilModelingBoa.asp">Quik-Fil</a>; otherwise, ask
the distributor for a matching product - they will be able to advise.
</p>

<p>
What else? Oh, about the only minor drawback of the medium-density boards is that they have
a very fine but perceptible grain, as shown in this magnified image:
</p>

<p><img src="https://lcamtuf.coredump.cx/gcnc/27-grain.jpg"></p>

<p>
This grain normally
has no appreciable effect on dimensional accuracy, but imparts a satin finish that
will transfer to any transparent, water-clear parts. Of course, you can create high-gloss molds
by coating the pattern with paste wax or a similar sealer (carnauba wax is particularly good);
or you can always simply polish the final part - but both these options affect dimensional accuracy,
and can be annoying when
working on complex molds. The alternative is to use a more expensive material known as a 
<i>tooling board</i> - made out of solid, dense polyurethane, with no perceptible
grain. Boards such as RenShape 5169 or BM 5272 cost up to 50% more, need to be machined
20-40% slower, and cause some wear to the tool - but they scratch this particular itch.
</p>

<p>
<b>Note:</b> RenShape 460 is relatively easy to cut with a hand
saw; in fact, it's comparable to
soft woods. That said, the extra labor may be annoying in the long haul, so it makes sense to
have a decent jigsaw nearby. You can get one for around $35; blades designed for hard woods will
cut the material very quickly and last for years.
</p>

<h4>4.1.2. Silicone rubbers</h4>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/cb-silicone.jpg">
<img src="https://lcamtuf.coredump.cx/gcnc/cb-mold.jpg">
</p>

<p>
In order to replicate the parts laid out inside your pattern cavity, you need a flexible and
durable substance to take an impression of the desired shape, and use it as a mold for
the final product of your work.
</p>

<p>
There are several types of castable rubbers that could be useful for this purpose, but silicones
are hard to beat. There are quite a few formulations that combine ease of use, excellent mechanical
properties, perfect dimensional accuracy, no odor, no toxicity, and temperature resistance up to
300° C. On top of that, silicones come with an inherently non-stick surface, which helps
greatly in casting work.
</p>

<p>
Almost all the silicone formulations you can find on the market come as a viscous goo consisting
of long, linear, partly polymerized chains of siloxanes; that nominally non-reactive soup is
then combined with a suitable cross-linker and a catalyst. The reaction between these components
quickly turns the goo into a very bouncy solid; this can be initiated in several ways:
</p>

<ul>

<li><p><b>Room temperature vulcanizing, one component rubber (RTV-1):</b> these substances
undergo hydrolysis when exposed to atmospheric humidity. This reaction creates unstable
molecules that promptly bind to each other, and release acetic acid or a simple alcohol
as a byproduct (hence the trademark smell of the silicone sealants from a hardware store).
This reaction, known as <i>condensation polymerization</i>, has the unfortunate effect of
subtly affecting dimensional accuracy of the part - simply
due to the release of volatile molecules. That said, the main reason why this process
isn't popular for moldmaking is more prosaic: it's just that thicker layers take forever
to set, owing to their limited exposure to air.</p>

</li><li><p><b>High-temperature vulcanizing silicones (HTV):</b> here, condensation polymerization
occurs in presence of free radicals, which are liberated from a heated organic peroxide.
The suitable curing temperature hovers around 100-150° C. This method is sweet and
simple, but also has a fatal side effect: the coefficient of thermal expansion for
silicones is pretty high, around 0.025%/°C - and so, after cooling down, the dimensions
will be off by several percent. This makes HTV rubbers completely useless for precision
work. (It is possible to use radiation or UV light instead of heat, but that's
not very practical in most cases.)</p>

</li><li><p><b>Room temperature, two-component rubber (RTV-2):</b></p>

<ul>

<li><p><b>Condensation cure:</b> these rubbers polymerize at room temperature in presence
of an organotin compound (typically dibutyltin dilaurate), which is mixed into the system
shortly before pouring it all into a mold. The catalyst itself is fairly harmful,
has a characteristic smell, and will leach out of the rubber in small amounts. Tin-cured
silicones are popular in hobby work, but I don't recommend them; organotin aside, they
exhibit measurable shrinkage (around 0.5%), have inferior mechanical properties, and are
prone to cure reversal after 1-2 years or so.</p>

</li><li><p><b>Addition cure:</b> these silicones are catalyzed with a platinum complex, and
polymeryze with no byproducts whatsoever. The materials are safe and odor-free,
and the finished product has practically no shrinkage, exhibits superb mechanical
characteristics, and can be stored indefinitely. Platinum cure rubbers are commonly
used in medical and food handling applications, and are the prime choice for flexible
molds.</p>

</li></ul>

</li></ul>

<p>
In other words, you almost certainly want to stick to RTV-2 platinum-catalyzed silicones,
unless you are working on life-sized castings (at that point, the cost of silicone can
become prohibitive).
</p>

<p>Before discussing specific products, let's have a quick look at the notable
characteristics that will come up in product datasheets for these rubbers,
and review their significance to our work:
</p>

<ul>

<li> <p><b>Stiffness:</b> the rubber we are going to use needs to be flexible enough to allow
easy demolding of finished parts, but must be sufficiently rigid to maintain dimensional
accuracy when laid on a flat surface, filled with liquid resin, and clamped or weighed
down until the plastic is fully cured.</p>

<p>
There is no single, consistently advertised parameter that would give you a good
idea of how flexible a particular rubber is, but this can be inferred in two relatively
simple ways:
</p>

<ul>

<li> <p><b>Indentation hardness:</b> this parameter is measured using an ad hoc scale
known as "Shore A", named so after its inventor. The test involves pressing a flat-tipped
0.8 mm needle into a sample with a modest force (800 gf). Deflection of 2.5 mm or more
corresponds to 0 on the scale, while no deflection whatsoever is denoted with the value
of 100.</p>

<p>
Indentation hardness is a relatively poor proxy for rigidity, but is the primary key
by which silicones are sorted in any catalog. In general, silicones under 10 Shore A
are jello-like, and are used chiefly for special effects, soft bicycle seats, and - why not
- sex toys. Compositions around 20-40A are fairly stretchy and squishy, similar to
a rubber band. Silicones around 60-80A are still flexible, but begin to resemble a pencil
eraser or a tire - you can flex them, but you won't stretch them easily.
</p>

<p>
<span>What to buy:</span> rubbers starting from 20 Shore A are marketed as suitable
for moldmaking, but I strongly recommend using around 60A for small, dimensionally accurate
molds; rubbers under 40 Shore A are not advisable, except for large-scale work or for certain
manual moldmaking techniques.
</p>

</li><li> <p><b>Tensile strength vs elongation at break:</b> if you need a more accurate picture of
flexibility, looking at these values is a better approach - especially when comparing
silicones to other types of rubber-like elastomers that we'll talk about soon.</p>

<p>
In essence, tensile strength tells you the <i>stress</i> (force divided by the 
area of cross-section) that causes the material to either snap, or to develop a localized
defect known as 
<a href="https://en.wikipedia.org/wiki/Necking_(engineering)">necking</a>. Elongation at
break, on the other hand, describes the extent to which a standardized specimen can be
stretched before breaking apart. If you divide tensile strength expressed as MPa
(1 MPa = 145 psi) by elongation at break expressed as a ratio (<code>1 + elongation /
100%</code>), you will get a somewhat arbitrary but useful value that will be low
for squishy rubbers, and high for rigid ones. 
</p>

<p>
(There is also a proper way to measure stiffness - Young's modulus - but it's not very commonly
seen in silicone datasheets.)
</p>

<p>
<span>What to buy:</span> unless you are working with very large or very deep
molds, try to select a rubber where this calculated "stiffness coefficient" is at least 2 MPa.
Ratios up to 3 MPa are OK for most uses; values around 4 MPa  make sense only for relatively
shallow molds where dimensional accuracy is paramount.
</p>

</li></ul>

</li><li> <p><b>Tear strength:</b> removing cured parts from the mold inevitably involves some
non-uniform pulling in the vicinity of sharp corners and other tight spots. 
In these cases, tensile strength does not accurately describe the resilience of the molding 
material; tear strength testing, which involves pulling a sample apart near the edge, offers
a much better insight. The test used in the States is usually 
<a href="http://www.ides.com/property_descriptions/astmd624.asp">ASTM D624 die B</a>,
which involves a sample nicked with a razor; in Europe, a different method, similar to
ASTM D624 die C, is more popular. There is no general mapping between these tests, but for
moldmaking silicones specifically, the results given by the European approach (BS903 part A3)
tend to be 30% lower or so.</p>

<p>
<span>What to buy:</span> tear strength of at least around 15-20 kN/m,
as per ASTM method, is highly desirable (the value corresponds to force divided by the
thickness of the sample; 1 kN/m = 5.7 ppi). Formulations up to 30 kN/m are available on the market,
and are certainly not a waste of money. It's best to stay away from products where the advertised
tear strength less than 12 kN/m or so.
</p>

</li><li> <p><b>Mixed viscosity:</b> rheology of a liquid is a complex topic and remains
very difficult to fully parametrize, but within a single family of products, formulations
with lower dynamic viscosity are generally easier to mix, pour, and degas - and will be more
inclined to conform to complex shapes without the aid of vacuum or pressure.</p>

<p>
Silicone rubbers suitable for moldmaking start around 10,000 mPa*s; this viscosity
resembles a runny syrup, and is very easy to work with. Compositions that go
over 35,000 mPa*s or
so are more prone to air entrapment when mixing the components, and when pouring them into
a mold; the use of vacuum degassing is advisable for any complex work. Finally, once you
cross 100,000 mPa*s, almost any silicone becomes fairly painful to work with.
</p>

<p>
<span>What to buy:</span> all other things being roughly equal, go with the system with the
lowest viscosity. Products below 50,000 mPa*s are advisable, but not strictly a must.
</p>

</li><li> <p><b>Pot life and demold time:</b> RTV-2 formulations begin to polymeryze the moment you mix the
two components together; the point at which it the mix becomes so thick that it is no longer
free-flowing or self-leveling is known as <i>pot life</i> or <i>gel time</i>. In the same
vein, the point at which it is sufficiently cross-linked to be safe to remove from the
master is referred to as <i>demold time</i>. Both of these values must be chosen so that
the product can be worked with at a reasonable pace.
</p>

<p>
<span>What to buy:</span> pot life of around 30 minutes in the bare minimum for low viscosity
compositions; for medium and high viscosity, 50-90 minutes is preferable, because every
step of the casting process will take a bit longer. Demold time should be as short as
possible; I'd stay clear of any formulations that require more than 24 hours to set.
</p>

<p>
<b>Note:</b> the speed of this and many other chemical reactions roughly doubles with
every 10° C. If you are in a rush and don't care about some minor
thermal expansion, using moderate heat is a great way to have your molds ready in 2-3 hours or so.
</p>

</li><li> <p><b>Shrinkage:</b> addition cure silicones used for moldmaking purposes should have no
measurable shrinkage. Some manufacturers simply say "none", while others say "less than 0.1%"
or so. Seeing a higher value in the datasheet is a warning sign; shrinkages between 0.2%
and 0.6% are commonly seen in condensation cure silicones, and should be avoided in
precision work.</p>

</li><li> <p><b>Color:</b> moldmaking silicones are usually opaque beige in their virgin state,
and can be pigmented easily. Systems in such a neutral color come handy if you wish to use
the rubber not only for molds, but also to make functional parts (tires, etc). Sadly,
many of the moldmaking compositions are artificially dyed blue, red, or green, to help
novice users mix the components properly.</p>

<p>
That aside, there are several silicone formulations that are nearly transparent. The product
is never water clear, and will have a slight milky haze; it will also lose transparency if
exposed to high temperatures. Because of this, it's not particularly suitable for decorative
purposes, but can be indispensable for non-CNC replication work, where you often need to see
the submerged master part, and carefully cut the mold to recover it. The major downside of
transparent silicones is that they have somewhat different flow characteristics, and can be
difficult to degas.
</p>

<p>
<span>What to buy:</span> I would not consider color to be the most important factor - if
necessary, polyurethane elastomers offer a good alternative for making functional parts.
That said, if you have a choice, it certainly doesn't hurt to go with something that can be
pigmented easily.
</p>

</li></ul>

<p>
All right, that's it! Other parameters are either uninteresting, or are not advertised
consistently. To help you with the selection process, my top recommendations for mechanical
projects would be:
</p>

<ul>

<li> <p><b>Best overall properties:</b> <a href="http://www.quantumsilicones.com/">Quantum Silicones</a>
QM 262. This is a pale blue, opaque rubber with low viscosity (35,000 mPa*s),
hardness around 65A, 12 hour demold time, and high strength.
<a href="http://www.hobbysilicone.com/">Hobby Silicone</a> is a reputable distributor, so
give them a try.</p>

<p>In Europe and some other markets, <a href="http://www.bluestarsilicones.com/">Bluestar
Silicones</a> RTV 3460 is a decent, but considerably more viscous, alternative.</p>

</li><li> <p><b>Transparent / pigmentable:</b> <a href="http://silicones-inc.com/">Silicones Inc</a>
P-592 (formerly known as XP-592). Truly exceptional tear strength, good price, medium viscosity (50,000 mPa*s), 
hardness in the vicinity of 60 Shore A, more challenging to degas. Cures in about 12 hours.
You can order this product through <a href="http://www.innovative-polymers.com/">Innovative Polymers</a>,
along with some of the other items we'll cover in the next section. </p>

</li><li> <p><b>High rigidity:</b> Quantum Silicones QM 270, also sold as 
<a href="http://www.acc-silicones.com/">ACC Silicones QM270</a> in Europe. Neutral beige or turquoise rubber around
75 Shore A, excellent mechanical properties and manageable viscosity (50,000 mPa*s). Remains easy to degas.
Somewhat less suitable for deep molds, undercuts, and in other applications requiring a stretchy material
- but its great for small, high-precision parts.</p>

</li><li> <p><b>Super-low viscosity:</b> Quantum Silicones QM 237. Around 40 Shore A, very easy to mix and
pour (10,000 mPa*s), properties are still acceptable for typical molds. If you live in
Europe, you may want to check out <a href="http://www.acc-silicones.com/">ACC Silicones</a>
MM242, which is pretty similar <u>and</u> comes in a transparent variety.</p>

</li></ul>

<p>
You should pick just one of these; if you're undecided, go with QM 262 or P-592.

If you need other options... well, 
Silicones Inc and Quantum are the most interesting US-based companies I know of. Other
choices include <a href="http://polytek.com/">Polytek</a>,
<a href="http://www.gtproducts.com/">GT Products</a>,
<a href="http://www.bjbenterprises.com/">BJB</a>, and
<a href="http://www.smooth-on.com/">Smooth-On</a> - but in my opinion, their selection is
much less impressive, and the options I have tried pale in comparison with the ones mentioned
on the recommended list.</p>

<p>
US market aside, globally,
<a href="http://www.bluestarsilicones.com/">Bluestar Silicones</a> (Rhodia)
is fairly ubiquitous; you 
may also want to check out <a href="http://www.shinetsusilicones.com/">ShinEtsu</a>,
<a href="http://www.wacker.com/">Wacker</a>,
<a href="http://en.zhermack.com/">Zhermack</a>,
<a href="http://www.huntsman.com/">Huntsman</a>,
<a href="http://www.axson-na.com/">Axson</a>, or
<a href="http://www.dowcorning.com/default.aspx?bhcp=1">Dow Corning</a> - depending on where
you are located, they all offer some interesting choices. But then, one reader living in Norway
reported that placing an international order with Hobby Silicone for QM 262 actually turned out
to be much cheaper than locally available alternatives (whoa).
</p>

<p>
As far as pricing goes, platinum cure silicones cost around $35-$45/liter when bought in one liter
cans,  or about $30-$35/liter in 4-5 liter pails; for example, P-592 costs around $120 for 4 l,
while QM 270 and QM 262 in 5 l quantities fetch $140 and $170, respectively.
Unreacted liquids should survive at least 2-3 years
without significant deterioration, as long as you keep them in tightly closed containers,
away from sunlight, moisture, and excess heat - so getting a full pail is not a bad idea.
</p>

<div>
<p>
<b>Note:</b> resin manufacturers in the States use a somewhat confusing scheme for describing
the size of their two-component kits: "1 gallon kit" usually means that you are getting about
one gallon of whichever component is needed in greater quantity; and a matching amount of the
other one. If the mix ratio is 10:1 (as is the case with most platinum cure silicones),
the gain is minimal - but for resins mixed 1:1, you are actually buying two gallons or so.
</p><p>
To further confuse you, the same does not apply to sizes specified in pounds - "15 lbs" means
that you are getting just enough to cast a 15 lbs blob of plastic or rubber. Be sure to
account for these differences when shopping around: a lower price is not always a better deal.
</p>
</div>

<h4>4.1.3. Rigid polyurethanes</h4>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/cb-polyurethane.jpg">
<img src="https://lcamtuf.coredump.cx/gcnc/cb-parts.jpg">
</p>

<p>
All right, let's talk about the materials you can employ to actually make final parts!
</p>

<p>
Polyurethanes are an incredibly interesting and versatile class of two-component, addition
cure polymers. They use two principal reagents, mixed in comparable quantities: a non-volatile
isocyanate and a complex alcohol (polyol). Some formulations trade some or all of the
polyol for a polyetheramine, resulting in a material that is more properly called a polyurea.
In any case, the two components are usually combined with variable amounts of chain modifiers,
usually chemically similar to the primary
polyol; and possibly surfactants, plasticizers, fillers, and
so on. The whole thing is then catalyzed with a wide variety of organometallic compounds 
(bismuth, zinc, tin, zirconium, aluminum, or similar); with tertiary amines such as
1,4-diazabicyclo[2.2.2]octane (DABCO / TEDA); with diazoles such as
1,2-dimethylimidazole (DMI); or with something pretty close to that.
</p>

<p>
Modern polyurethane chemistry lets you manufacture everything from soft foams, to high-performance
rubbers, to faithful, often superior imitations of many other rigid engineering plastics - all
that without having to go bankrupt on injection molding equipment, and while using only fairly safe
and predictable chemicals. They greatly outperform more familiar resins, such as epoxies or 
polyesters, and in hobbyist workshops, are much less dangerous to work with.
</p>

<p>
The only downside of high-performance polyurethane systems is that they generally require a basic
vacuum rig - a small pump and a suitable container to remove any dissolved gases from the mix.
Products that do not require degassing are readily available, but usually don't perform as well
as their peers. (We'll talk about the required harware later on, but it's pretty compact and doesn't
cost a lot.)
</p>

<p>
Anyway - if you are aiming to make functional prototypes,
it is probably prudent to start by stocking up on a polyurethane resin that lets you
produce hard, rigid, and shock-resistant
parts. Once more, let's have a look at some of the key things worth highlighting
in a datasheet:
</p>

<ul>

<li><p><b>Stated purpose:</b> there is a lot of variety in the world of polyurethanes,
and not all the properties of a material can accurately captured with several cold, dry numbers alone.
You should always pay attention to what the manufacturer is trying to tell you: if they are talking
about simulating engineering plastics such as ABS, polyamide, or polyolefins - great. If they are instead
paying undue attention to tooling fixtures, conceptual prototypes, scale models, etc, be wary. This may
mean that the resin has disproportionately low strength in thin sections, is very brittle, or suffers
from other malady. If in doubt, simply talk to them and clarify.</p>

<p>
For the same reason, tread carefully if the resin is designated strictly for meter-mix machines,
vacuum assisted casting equipment, or something of that sort. It
may mean that the material is very difficult to degas, has an annoyingly short pot life, or
requires a heated mold. That label is not always a problem, but 75% of the time, it's there for
a reason. As usual, when in doubt, ask. It's often also possible to get a sample and try it
out yourself.</p>

</li><li><p><b>Hardness:</b> indentation hardness of rigid plastics is typically measured using a scale called
"Shore D". This approach is very similar to the one used for rubbers, except that it relies on a
sharper tip (0.1 mm) and a greater force (4,500 g). Indentation hardness doesn't necessarily map to
rigidity, or any other useful property - but since it's always listed prominently, use it as a very
rough selection criteria: plastics under 75 Shore D are unlikely to be strong enough for making
thin-walled parts.</p>


</li><li><p><b>Flexural properties:</b> almost all the prototyping work you may end up doing
will probably benefit from a plastic that withstands high bending forces without snapping
in half; and that maintains as much rigidity as possible under such a load. These
qualities are measured using two values: <i>flexural strength</i> and <i>flexural modulus</i>.

The first one describes the force in relation to part dimensions at which a
<a href="http://www.matweb.com/reference/flexuralstrength.aspx">standardized specimen</a>
breaks; the other one tells you the ratio between the stress the material is under, and
its degree of deformation. The higher it is, the more rigid the part will seem. </p>

<p>
In comparison to these two, compressive and tensile properties usually matter a lot less
in small-scale prototyping work.</p>

<p>
<span>What to buy:</span> aim high. Look for flexural strength around 90-120 MPa,
and for flexural modulus somewhere between 2.5 and 3.1 GPa. This is roughly comparable
or better than tough materials such as ABS (Lego bricks), polyamide (plastic gears),
polycarbonate (CDs and DVDs), or acrylic glass. For a comparison of common plastics,
<a href="http://www.boedeker.com/mguide.htm">this website</a> is a great starting point.
</p>

</li><li><p><b>Impact resistance:</b> flexural strength of a polymer is important, but doesn't
paint a complete picture. For example, polypropylene is a relatively flimsy plastic, with
flexural strength less than 40% that of acrylic glass; yet, Tupperware made out of PP easily
survives being dropped to the floor, while acrylic glass of the same thickness and shape
would likely shatter right away.
</p>

<p>
The difference is that, especially in thin sections, polypropylene has a much better
ability to flex and dissipate the energy of a localized shock; this is usually measured
using a test known as
<a href="http://www.ides.com/property_descriptions/ASTMD256.asp">notched Izod impact strength</a>,
where a pendulum swings and breaks an upward-facing, notched sample in its path; the test estimates
the energy lost by the pendulum, in proportion of the thickness of the specimen (minus the depth of
the notch). Lo and behold - the strength of acrylic glass is barely 15 J/m (1 J/m = 0.0187
ft-lbs/in), while various grades of polypropylene vary between 100 and 300 J/m.
</p>

<p>
Impact strength matters more often than you might expect. For example, tiny gears subjected to sudden
torque variations when braking will be more prone to
<a href="http://www.bmbikes.co.uk/photos/museumphotos/Gear.jpg">failing catastrophically</a> if the
material has poor resistance to such shocks. Most rigid polyurethanes have Izod impact strength around
30-50 J/m, resembling Nylon, polystyrene, and so forth: they will perform well, but if you
step on a medium size, very thin-walled part, it will probably break. There are quite a few
formulations closer to 100-300 J/m, resembling plastics such as ABS; if you ever stepped on a Lego
brick, you probably know that it prevails, at the expense of your foot.
</p>

<p>
<span>What to buy:</span> your primary resins used for functional prototypes
should have impact strength of at least
30 J/m; if the value is not provided by the manufacturer, it's probably lower than that.
You typically don't need much higher figures, but if you have a choice, getting something closer to
100 J/m doesn't hurt.
</p>

</li><li><p><b>Shrinkage:</b> this parameter is somewhat important in polyurethanes, because in some circumstances,
it may significantly affect the dimensions of your parts. Alas, the standardized test is essentially meaningless.
Polyurethane polymerization reaction has virtually no inherent shrinkage, but can be fairly exothermic;
thermal expansion of the liquid, and the response of the flexible mold that surrounds it, is what may
mess up the final result.</p>

<p>In general, coefficient of thermal expansion for rigid polyurethanes is about five times lower than
that of silicone (perhaps 0.005%/°C); when using sensibly selected resins, the exotherm in thin
parts will not exceed 5-10° C above room temperature, and the resulting shrinkage will be
practically nil, no matter what the datasheet says. On the flip side, when dealing with parts that have
thick cross-sections, the temperature may peak 50° C over ambient - and at that point, dimensional
accuracy in the most easily deflected portion of the mold will suffer. For example, when casting a solid
block of resin with dimensions of 10 x 10 x 30 mm, and using a sealed rubber mold and a resin with 10
minute pot life, the most vulnerable point in the mid-section of the mold may be off by as much as 0.3 mm
(3%). The rest of the part will be probably spot on.</p>

<p>Luckily, it is within your power to change this. We'll talk about this in more detail
later on, but in essence, you can:</p>

<ul>

<li><p><b>Slow down the reaction.</b> The boring option is to switch to a system with a pot life of
30-50 minutes, and overnight cure - as these will usually have negligible exotherm even for
bulkier castings. The more exciting option is to get rid of some of the catalyst present in
the product, which usually involves adding a common and reasonably safe chemical to the system. 
It's simpler than it sounds.</p>

</li><li><p><b>Partly prepolymerize the resin.</b> Pre-mixing the full amount of isocyanate with about
10-20% of the intended amount of polyol, and setting this mixture aside for about an hour or two,
will minimize the exotherm later on, likely reducing shrinkage by 70-90%. This has several other
benefits, too, and the only side effect is increased viscosity.</p>

</li><li><p><b>Add an inert filler to act as a moderator.</b> 
Well-chosen additives allow you to reduce shrinkage by at least 30% without
significantly compromising flexural properties of the system; going up to 80-90% is possible
if you are willing to make some performance trade-offs.</p>

</li><li><p><b>Allow some extra resin to flow back into the mold as the system cools down.</b> Adding sprues
or vents allows shrinkage to be offset without deforming the mold, and can result in dimensional
accuracy improved by 80% or more.</p>

</li><li><p><b>Cast in several layers.</b> This eliminates shrinkage almost completely, but works well only
with relatively simple shapes.</p>

</li></ul>

<p>
The approaches can be combined, often with synergistic results. It is also possible to let shrinkage
happen, but direct it toward non-essential locations; this can be accomplished by intentionally
weakening a section of the mold, for example by using thin walls. The bottom line is that you don't
have to worry a lot - but you need to be aware of this behavior, and need to know how to reduce it
when necessary.
</p>

<p>
<span>What to buy:</span> all in all, don't read too much into the datasheet, but be 
wary of resins with very high stated shrinkage - unless that shrinkage is measured by the manufacturer
for a sample that is cured at an elevated temperature. For samples that spend the first few hours or days
at room temperature, advertised shrinkage should be less than 0.3% or so. Beyond that, comparisons are
somewhat pointless.
</p>

</li><li><p><b>Mixed viscosity:</b> flow characteristics of polyurethanes are very different from silicones, possibly due to higher
surface tension; on top of that, polyurethanes usually have much shorter pot life. Because of that, resins under
1,000 mPa*s are preferred; products over 2,000 mPa*s or so will be more challenging to degas and pour - and venturing
past 4,000 mPa*s should be done at own risk. The parameter is not critical, but it's good to avoid extremes.</p>

</li><li><p><b>Pot life and demold time:</b> many polyurethanes will have fairly short pot life, between 30 seconds and 4
minutes. That's usually not enough for manual casting, unless you are doing something very simple.
Around 7-8 minutes is highly advisable for low viscosity resins, and closer to 10-15 minutes makes sense for when
dealing with resins over 1,500 mPa*s or so.</p>

<p>
As for demold time, it is usually preferable to keep it short; between 2 and 6 hours is ideal,
as it lets you crank out multiple batches in a single day. That said, overnight cure (12-24 hours) is not the
end of the world. Any slow-curing resin can be accelerated in a simple way, and we'll cover that a few sections
down.
</p>

</li><li><p><b>Presence of fillers:</b> some resins are pre-mixed with fillers to improve their flexural
properties, abrasion resistance, or fire rating. In general, don't go there unless you are sure that you
can't approximate this effect by manually adding the appropriate filler, and that you want to be permanently
stuck with all the drawbacks (e.g., higher viscosity, lower impact strength, and the tendency for fillers to
settle in storage).</p>

</li><li><p><b>Color:</b> avoid dyed or non-pigmentable resins. Transparent, translucent, neutral white, and
slightly off-white resins (light beige, lightly straw-colored, etc) can be usually
easily pigmented to your liking. 
Colors such as amber, caramel, or tan are more of a gamble; ask for a photo or a sample of the material to
determine how bad it really is. Some of these colors are faint and easily overcome, and some
are there to stay.</p>

</li><li><p><b>Compatibility with platinum-cure silicones:</b> there is a small number of transparent resins or
other specialty formulations may be inhibited by the platinum catalyst present in silicone molds. Always
scan the datasheet for any mentions of that risk. If it's not mentioned, you are good to go.</p>

</li></ul>

<p>All right, ready for some recommendations? Here we go:</p>

<ul>

<li><p><b>Best all-around resin:</b>
<a href="http://www.innovative-polymers.com/">Innovative Polymers</a> IE-3075. Really, nothing else comes close.
Translucent, high-strength plastic with a reasonable pot life (8 minutes) and quick demold time (2-3 hours for
smaller parts). Around 83 Shore D, flex strength 120 MPa, modulus 2.9 GPa, decent impact resistance. Very
low cost - around $17 per liter. The system can be slowed down in a simple way if you need a longer
cure time or lower exotherm.</p>

<p>A good fallback option in the US and several other markets is
<a href="http://www.bjbenterprises.com/">BJB Enterprises</a> TC-854 A/B, which is about 15% less rigid and
cures a tad faster, but is otherwise indistinguishable from IE-3075 and costs about the same. The other
US choice is <a href="http://www.huntsman.com/">Huntsman</a> RenCast 6591, but it has noticably shorter
pot life, is harder to pigment, and costs much more.</p>

<p>For those of you in Europe, RenCast 5146 (also sold as RenPIM 5219) is
a very similar, low-cost resin. This one has a pot life of around 30 minutes, and 
requires overnight cure (unless you add some extra catalyst). There are some distributors for BJB
products in the EU, too, so you may also have luck with TC-854 A/B.</p>

</li><li><p><b>Water clear:</b>

Innovative Polymers OC-5274 or OC-5086. Like other mercury-free compositions, these are sensitive to moisture in 
thin layers. When making small castings in single-part molds, you may end up getting relatively low yields
unless you preheat the mold, perform pressure casting, or add a small amount
of a separately purchased catalyst (see <a href="https://lcamtuf.coredump.cx/gcnc/ch4/#4.4.4">section 4.4.4</a>). The price of the resins
is relatively steep, around $45 per liter.
</p>

</li><li><p><b>High-impact plastic:</b> 
Innovative Polymers TP-4052. This product is fairly similar to IE-3075 in most aspects.
Flexural parameters are somewhat worse, but impact strength is
almost three times higher. Price is in the vicinity of $30 per liter. Note that as opposed to IE-3075,
I have not found a way to slow this system down when low shrinkage in mass casting is desired.</p>

</li></ul>

<p>
At this point, unless you have a specific itch to scratch, it's perfectly OK to order just
IE-3075 directly from IPI. Their "1 gallon kit" (actually around 6.5 l) sells for about $110. "Quart
kits" are also available if you need to try it out first.
</p>

<p>
If you want to shop around, I don't think it makes sense to look beyond Innovative Polymers -
not if you're in the States;
they have a remarkable selection of unique, user-friendly products designed specifically for 
manual casting, and great customer service.
They take direct orders, and also have several local distributors. If you're skeptical,
you can have a look at products from <a href="http://www.smooth-on.com/">Smooth-On</a>,
<a href="http://www.alumilite.com/">Alumilite</a>,
BJB Enterprises,
or Freeman - but you will not find anything that even comes close to that selection.
If you are in Europe, checking out Huntsman and
<a href="http://www.axson.com/">Axson</a> is not a bad plan.
</p>

<p>
As with silicones, polyurethane resins are pretty stable and have a fairly long shelf life
- but they are fairly sensitive to
sunlight, humidity, heat, oxygen, and moisture. It is a good practice
to buy several 100-250 ml polypropylene or HDPE bottles
(<a href="https://www.amazon.com/dp/B0046A8XZO/">example</a>) for intermediate storage of the
amounts of resin you plan to use within a month or so - and keep the original containers
sealed and blanketed with inert gas.
The inert gas can be just a burst of "canned air" (difluoroethane or tetrafluoroethane), but
if you want to save money in the long haul and have some room in your workshop,
it makes more sense to invest around $150 in a
small nitrogen tank, a regulator, and a hose. This setup will last for months, and it's only
about $10 to refill at a nearby <a href="http://www.praxair.com/">Praxair</a> location or so.
</p>

<p>
In any case, if you store the resins properly, you can expect most of them to maintain
their properties for at least 2-3 years; manufacturers usually give much more conservative
guarantees, but take them with a grain of salt. Remember to agitate the containers if the components
separate. Oh, some formulations may crystallize if kept below 10° C or so, but this process
can be reversed easily. Prolonged storage in crystallized form is not advisable, as it may
lead to the formation of insoluble dimers.
</p>

<div>
<p>
<b><span>Caution:</span></b> although most of the
polyurethane formulations you will encounter are reasonably safe, there are some unfortunate
exceptions. We'll talk about this a bit more in <a href="https://lcamtuf.coredump.cx/gcnc/ch7/">chapter 7</a> - but for now, definitely
watch out for:
</p>

<ul>

<li><p><b>Volatile isocyanates:</b> all isocyanates are dangerous if inhaled, but most of the
prototyping formulations use prepolymers or monomers with negligible evaporation rates -
so it would take serious effort to put yourself at risk (intentionally aerosolizing the resin
would be one bad idea). In particular, MDI, HMDI / DMDI, and IPDI isocyanates are pretty
safe. That said, some industrial resins use more volatile and more reactive compounds,
such as toluene diisocyanate (TDI) or hexamethylene diisocyanate (HDI) - and these are best
avoided.</p>

</li><li><p><b>Toxic catalysts:</b> minutiae amounts of harmful organomercury salts, such as phenylmercuric
neodecanoate, were found to be excellent, highly selective catalysts for polyurethanes; less 
concerning but still somewhat nasty tin(IV) compounds (e.g., dibutyltin dilaurate)
offered some hard-to-replicate benefits, too. Needless to say, you probably want to avoid unnecessary
risks. Such catalysts are largely phased out in favor of compounds of zinc, bismuth, tin(II), 
titanium, aluminum, and so on - but you can occasionally find them in products available in some
markets (for example, Smooth-On, BJB, Alumilite, and Freeman still use them frequently).</p>

</li><li><p><b>Possibly harmful amines:</b> several amine curatives once-popular in certain high-performance
elastomers - most notably 4,4'-methylenebis(2-chloroaniline) (MBOCA / MOCA) - were implicated as
probably carcinogenic in humans. Be watchful for products that haven't switched to safer, modern
alternatives.</p>

</li></ul>

<p>
You won't find any of the problematic components in resins from Innovative Polymers - but other
manufacturers sometimes show less restraint. Request and study material safety datasheets
(MSDS) when in doubt.</p>

</div>

<h4>4.1.4. Flexible polyurethanes</h4>

<p>
Flexible polyurethane elastomers are an interesting alternative to silicones. You don't 
necessarily need to buy any, but they may come handy if you wish to make functional rubber
parts, and your silicone is not pigmentable, or has insufficient strength.
</p>

<p>
Key advantages of these rubbers include 30-50% lower price, and much better performance toward
the upper end of Shore A (above 40 or so): several times higher tear strength, much less
pronounced tear propagation, excellent abrasion resistance, lower coefficient of thermal
expansion, lower viscosity, and the ability to pigment the system as seen fit. On the flip side,
polyurethanes exhibit some exotherm-caused
shrinkage in larger castings, and adhere to many other plastics,
making them less desirable for creating negative molds; they also tend to have slightly worse
rebound characteristics, and limited temperature resistance (they get soft around 70-90° C,
and deteriorate somewhere between 150 and 200° C - so casting low-melt metals, for
example, is out of question).
</p>

<p>
The parameters to look for in these compositions are similar to these for silicones,
with the exception of pot life and viscosity - here, the advice provided for polyurethanes
is more pertinent. When reviewing the datasheets, pay close attention to the ratio of
tensile strength to elongation at break, because there can be striking differences in the
rigidity of various products, especially those rated 70 Shore A or above; some of them are only
somewhat flexible, and will not be suitable for making parts such as tires, rollers, or
transmission belts.
</p>

<p>
<b>Note:</b> This goes both ways: not all Shore A polyurethanes are particularly rubbery,
and not all Shore D polyurethanes are necessarily very rigid. For example, some 60 Shore D polymers
are highly elastic and can be stretched up to three times their original length, even though
their surface feels hard as nails. They resemble the rubbers used in certain garden hoses, shopping
cart wheels, etc.
</p>

<p>
As for recommendations: you should go with Innovative Polymers HP-21xx series; I've tried
quite a few other products, and nothing else comes close. They are
relatively inexpensive ($25 per liter) and feature superb "true rubber" mechanical characteristics,
long pot life, and good cure profiles. For example, HP-2170A is a super-stretchy 70 Shore A rubber
with tear strength of 42 kN/m, far surpassing most silicones. There are also softer variants,
down to 50 Shore A (HP-2150A); and more rigid but still surprisingly flexible ones, up to around
60 Shore D (HP-2160D). In fact, it's possible to blend them to achieve intermediate properties
as needed for a particular project.
</p>

<p>
All the products in the HP-21xx line take several days to polymerize at room temperature;
if that's too slow and heating them up is not an option, you can add
some separately purchased catalyst to get overnight cure with no real trade-offs. 
</p>

<h4>4.1.5. Epoxies, polyesters, and so on</h4>

<p>
If you have dabbled in resin casting before, chances are, you used epoxy or
styrene-based polyester resins, rather than polyurethanes. 
These options are popular with hobbyists because of their
broad availability, low price, and less onerous processing requirements (i.e., less sensitivity
to mixing ratios, moisture contamination, etc). That said, I think it's a bad idea to use
these materials in precision casting work, for a couple of reasons:
</p>

<ul>

<li><p><b>High shrinkage.</b> Both polyesters and epoxies cure by condensation, and usually
exhibit very high exotherm compared to polyurethanes with the same demold time.
Shrinkage as high as 10% is common in unfilled
polyesters; epoxies are better, but not dramatically so.</p>

</li><li><p><b>Mold damage.</b> Epoxies and polyesters use corrossive, oxidizing, or permeating
components, and this reduces the service life of silicone molds quite a bit. It may
be difficult to get 5-10 pulls out of a complex mold.</p>

</li><li><p><b>Brittleness.</b> Most epoxies and polyesters are designed to be cheap and to bond
well, and not to have outstanding flexural parameters or impact strength. When superior
characteristics are required, fiberglass, carbon fiber, or aramid cloth is typically
used for reinforcement, but that's not very feasible for tiny, complex parts.</p>

</li><li><p><b>Low UV resistance and clarity.</b> Transparent epoxies and polyesters usually have
lower clarity than water-clear polyurethanes, and are more prone to developing a yellow hue
when exposed to sunlight. In comparison, many polyurethanes exhibit high UV stability.</p>

</li><li><p><b>Workshop safety concerns.</b> Components of a polyester resin are extremely volatile,
flammable, and are an inhalation risk. Epoxies are more user-friendly, but use corrossive
chemicals, and  contain non-trivial amounts of bisphenol A. Bisphenol A hasn't been
conclusively implicated in being harmful to humans, but is suspected of being an endocrine
disruptor based on some subset of animal studies. Limiting your non-essential exposure may be
a wise step.</p>

</li></ul>

<p>
Of course, I don't want to demonize these polymers. Polyesters are sometimes useful for
bonding and repair applications; and epoxies are extremely useful as high-performance
glues and laminating or potting resins. Both epoxies and polyesters can be superior in
lay-up composite applications, too, in part owing to their improved bonding capabilities.
You can have a look at the products sold by
<a href="http://www.freemansupply.com/">Freeman Supply</a>, or check out the low-cost,
water-clear epoxies available from
<a href="http://www.polymercompositesinc.com/maxclrcasting.htm">Polymer Composites 
Inc</a>; just don't expect them to be a sensible match for PU for the processes discussed
in this guide.
</p>

<h4>4.1.6. Pigments and dyes</h4>

<p>
Adding colors to your castings is fairly easy. One option is to find an artist store,
and shop for dry, non-toxic organic pigments. Such pigments will work equally well with
polyurethanes, silicones, and just about anything else - but may be relatively painful
to disperse or to blend with any accuracy. The other choice is to purchase
coloring pastes where pigments are already dispersed in a non-reactive (plasticizer) or
reactive (polyol) medium - but these won't work in silicones.
</p>

<p>
For dry pigments,
<a href="http://www.kremerpigments.com/">Kremer</a> is probably the best source online.
For reactive dispersions, you can ping Innovative Polymers
(send them your picks from <a href="http://www.ralcolor.com/">this RAL chart</a>);
<a href="http://www.eagerplastics.com/">Eager Plastics</a> has a pretty good selection
of non-reactive pigments and dyes, too.
</p>

<p>
Beyond that... selecting your palette is a matter of personal preferences, but here are some
quick tips:
</p>

<ul>

<li> <p>Be sure to get some titanium-based white (Kremer 46200, IPI Bright White)
and deep black (Kremer 47400, IPI Black 201). These two are used not only as standalone pigments,
but are also useful as opacifiers for controlling transparency of the material, and
the saturation produced by other dyes.</p>

</li><li> <p>When browsing artist stores, try to avoid most mineral-, plant-, and
animal-based pigments; stick to modern synthetic dyes where possible. 
In particular, be wary of traditional products containing lead, mercury,
arsenic, cadmium, chromium, and nickel.</p>

</li><li> <p>It's easy to go from vivid hues to muted ones, but not the other way round. Focus on
punchy pigments with simple names; "Bohemian moonlight blue" is not what you need.</p>

</li><li> <p>You can't just buy three primary colors, and hope to make every other hue with that.
It won't work, especially if you are aiming for a vibrant pallette. Aim to get at least 6-8
different, useful colors to begin with.</p>

</li><li> <p>Whatever you do, keep your pigments moisture-free. Store them in closed containers and
in a dry place.</p>

</li></ul>

<p>If you need inspiration, here are some nice picks:</p>

<ul>

<li> <p><b>Daylight fluorescent colors:</b> Kremer has a 
<a href="http://kremerpigments.com/shopus/index.php?lang=ENG&amp;list=010701">line of day-glo pigments</a>
that result in extremely vivid colors that form translucent dispersions; Innovative Polymers carries a 
good selection, too.</p>

</li><li> <p><b>Basic opaque pigments:</b> in addition to black and white, you may want to start with
vibrant yellow (Kremer 55100, IPI Yellow 802), cyan (Kremer 55500, IPI Blue 303), pure red (Kremer
55300, IPI Bright Red), magenta (Kremer 55470, IPI Magenta), green (Kremer 55700, IPI Signal green),
orange (Kremer 55200, IPI Orange 602).</p>

</li><li> <p><b>Transparent dyes:</b> useful only if you are planning to make transparent or translucent parts.
<a href="http://kremerpigments.com/shopus/index.php?lang=ENG&amp;list=01030203">ORASOL dyes</a> produce
brilliant transparent colors, but <a href="http://eagerplastics.com/7701.htm">pre-made dispersions</a> from
Eager Plastics are more convenient to use and have very high yields.</p>

</li><li> <p><b>Fancy pearlescent pigments:</b> check out 
<a href="http://www.paintwithpearl.com/candystore.htm">Paint With Pearl</a>. Their prices are hard to beat.</p>

</li></ul> 

<p>
A small bag or bottle of a pigment will cost somewhere between $5 and $20, and should last for years.
</p>

<div>
<p>
<b><span>Tip:</span></b> You can, of course, opt to paint your parts instead of adding
pigments to the resin; acrylic and polyurethane lacquers can be used alike. For adding text or other 
ornamental elements to machined parts, you may also want to consider a low-cost vinyl cutter, such as Silhouette
SD or Roland Stika SV-8. These devices are fairly affordable, and the results look 
<a href="https://plus.google.com/102198596949614340829/posts/MpKoyGWRMGr">amazingly good</a> 
- especially if a layer of <a href="http://www.ebay.com/itm/ws/eBayISAPI.dll?ViewItem&amp;item=310219352478">clear coat</a>
is applied on top.
</p><p>
If another cutting machine is too much, you can also simply equip your CNC mill with a specialized
<a href="https://www.rockcliffmachine.com/product/cnc-drag-knife/">drag knife</a> to get comparable
results.
</p>
</div>

<h4><a name="4.1.7">4.1.7. Other additives</a></h4>

<p>
Adding colors aside, many other
properties of cured plastics can be altered in profound ways by introducing certain easily available,
low-cost additives. It's almost impossible to provide an exhaustive overview of all the available
choices, but several use cases are definitely worth calling out:
</p>

<ul>

<li><p><b>If you want to reduce shrinkage,</b> there are many fillers that increase the distance between
reactive molecules of the resin, slowing down the reaction and buffering some of the produced heat - but
the ones that do so without significantly affecting viscosity or mechanical properties of the finished part
are of particular interest.
</p>

<p>
I found that 
<a href="http://www.shop3m.com/98021233881.html">3M Scotchlite iM30K</a>, a type of high-strength, hollow glass
microspheres (less than 0.02 mm in diameter) works great when added at a ratio of about 4% by weight; when used
in conjunction with the pre-mixing trick discussed earlier on,
shrinkage is eliminated almost completely. When flexural properties are of utmost importance, tiny
<a href="http://www.fibreglast.com/product/132_inch_Milled_Glass_Fibers_38/Fillers">milled glass fibers</a>,
around 0.8 mm long, significantly reduce shrinkage at a radio between 10 and 30% by weight. Both of these
fillers sell for less than $20 per liter.
</p>

</li><li><p><b>When you need to reduce weight,</b> 
<a href="http://www.shop3m.com/70070484079.html">Scotchlite S15</a> can be added to any system at ratios
as high as 3:1 by volume, resulting in a free-flowing resin with effective density less than 0.4 g/cm³.
Compressive strength will be pretty reasonable, but flexural properties will suffer. This may
come handy especially for hulls of model airplanes or boats.
</p>

</li><li><p><b>When you want an extremely hard plastic,</b> the aforementioned variety of short glass fibers
can substantially improve flexural strength, more than double flexural modulus, and significantly increase
hardness and
abrasion resistance - especially when used in conjunction with a silane coupling agent (see later on).
Using longer or thicker fibers is a possibility, but may affect surface finish or complicate the casting
process. For short fibers, ratios around 30% by weight are a good starting point. The downside of this
trick is a significant reduction in impact strength; starting with a high-impact resin, such as TP-4052,
may give you a bit more wiggle room.
</p>

</li><li><p><b>For improved impact strength, lower hardness, or lower viscosity,</b> plasticizers can be
introduced to the system to effectively add "padding" in the resulting polymer structure. Because they
don't participate in the polymerization reaction, they reduce tensile strength and may increase creep
(the tendency for the material to permanently deform under relatively minor but sustained load), but that
trade-off is acceptable in many uses.</p>

<p>
For polyurethanes, one of the safer and more versatile plasticizers is dipropylene glycol
dibenzoate (DPGDB), available from <a href="http://www.eagerplastics.com/fillers.htm">Eager Plastics</a>
under the name of EP9009. For silicones, any low-viscosity silicone oil will do; you can get it
from the same source that you are purchasing the resin from. Plasticizer levels between 5 and 10% are common,
although in silicone
rubbers, up to 50% may be useful. You shouldn't have to pay more than $20-$40 per liter or so.</p>

</li><li><p><b>To simulate select properties of metals:</b> powdered metals, such as copper, aluminum, or iron, can
be added to resins in significant amounts to increase their weight, thermal conductivity, and remarkably,
give them a highly metallic appearance and feel when polished. You can find suitable 300-600 mesh metal
powders on eBay or from sources such as 
<a href="http://www.artmolds.com/category187.cfm">ArtMolds</a>. Prices vary, but aren't prohibitive.
Flexural properties will suffer.</p>

</li></ul>

<p>
Of course, multiple types of fillers can be combined; in particular, it may be useful to add some
glass fibers to lightweight materials filled with hollow glass spheres, to maintain acceptable flexural
strength. If you are wondering what to buy up front, it's not a completely
bad plan to get some Scotchlite iM30K, 
plus 0.8 mm glass fibers, and a bit of DPGDB (also useful for preparing pigment dispersions and such). Other
fillers are not nearly as essential.
</p>

<h3>4.2. Casting workshop</h3>

<p>
Now that we have the selection of resins, pigments, and fillers sorted out, it's time to briefly
chat about the workshop equipment you will need to get the ball rolling. The list isn't particularly
long, but even when it comes to something as inconsequential as mixing cups, making the wrong choice
will unnecessarily complicate your life.
</p>

<h4>4.2.1. Vacuum pump and chamber</h4>

<p>
Insufficient mixing may cause a range of problems with finished parts - but vigorous stirring will
almost always introduce some air into the resin. This problem aside, bubbles of air may get trapped
inside mold crevices as you pour the mixture in - even if your mixing skills are beyond reproach.
Last but not least,
some resins may simply liberate some amount of dissolved gases once the polymerization reaction begins;
IE-3075 is an example of that. Vacuum degassing solves all these problems, and is not as scary as it may
sound.
</p>

<p>
Even if you are on a tight budget, you should get a low-cost vacuum pump capable of getting pulling around
-1000 mbar of vacuum (that's about 10 mbar absolute, or -29.5 inches of mercury). I ordered mine from
<a href="http://www.viot.us/">VIOT</a>: <a href="http://www.viot.us/showproduct.php?model=VPD2">click
here</a> for an entry-level model that sells for around $100, and should work fine; I have a $140 model 
with a higher flow rate, and it served me well. You will also need some
sort of a vacuum chamber to hold the mixing container and the mold itself; it's possible to rig something
together on your own, for example using a sturdy cooking pot and a cover made out of thick polycarbonate - but
<a href="https://www.amazon.com/b/ref=dp_brlad_entry?ie=UTF8&amp;node=393238011">low-cost vacuum dessicator chambers</a>
work fine in that capacity, and start around $50 or so. If you are planning to work on relatively small projects,
or opted for a pump with a relatiely low flow rate, 
Bel-Art #420100000 is a good choice; otherwise, model #420430000 will accommodate larger pieces, too.
</p>

<p>
(For a bit more money, you can also find some good-looking purpose-built degassing chambers from
<a href="http://www.ebay.com/itm/Vacuum-Chamber-1-Gallon-Flat-Degassing-BHO-SIlicones-Resins-Stabilized-Wood-/281243192239">several sellers on eBay</a>.)
</p>

<p>
About the only other piece of this puzzle is a hose to connect the pump with the chamber. I use
1/4" Kuriyama K7160 Polyspring, which I ordered from 
<a href="http://www.gvc.net/p/2454/pvc-wire-reinforced-hose-pvw">these guys</a>; it's about $4 per meter. Other
hoses can be used, too, but they need to be vacuum-rated, which in practice means that they need to be 
either fairly rigid, or reinforced with a metal spring to avoid collapsing as soon as you turn the pump on.
Beyond that... well, getting some vacuum grease for o-rings and other parts of the vacuum chamber is not a
bad plan
(<a href="https://www.amazon.com/Silicone-Grease-2-0-oz-Jar/dp/B0000DCVZL/ref=sr_1_2">link</a>); it
also comes handy for several other purposes every now and then - for example, for preventing caps on 
resin bottles from seizing in storage.
</p>

<h4>4.2.2. Auxiliary tools</h4>

<p>
It goes without saying that for any sort of precision work, you need a reasonably
well-equipped workshop to begin with. I am assuming that you already have that - and
that basic tools such as clamps, needle files, or several grades of fine sanding paper,
are always within reach.
</p>

<p>
With that in mind, there are several less obvious, minor items that will be useful 
specifically when casting mechanical parts, and that we haven't mentioned before:
</p>

<ul>

<li> <p><b>Precision scale:</b> observing proper mix ratios is extremely important for
addition cure silicones - errors of as little as 2% may affect important
properties of the rubber.
Polyurethanes are a bit more tolerant, but it is important to stay within 4% or so.</p>

<p>
To that effect, in order to
accurately mix components when working with relatively small quantities of resins
(10-50 ml), you should try to get a scale with a resolution of at least 0.05 g, and
measurement range of at least 0-200 g. You can get something usable for under $40
(I ordered from <a href="http://www.wholesale-scales.com/index.php?main_page=product_info&amp;cPath=1&amp;products_id=118">wholesale-scales.com</a>,
and can't complain). If you are watching your budget, you can also
get away with a regular, gram-resolution kitchen scale - but in this case,
you shouldn't attempt to mix less than about 30 ml of polyurethane, or 100 ml of silicone.
In the long haul, this may be wasteful, depending on the size of your parts.
</p>

</li><li> <p><b>Mixing containers:</b> any plastic cup should do, but consider getting a box
of one hundred 100 ml polypropylene beakers from
<a href="http://www.tedpella.com/beakers_html/beakers.htm#anchor284242">Ted Pella</a> or
any other outlet with lab supplies; the price should be around 20 cents a piece ($20 per box). PP
beakers are nearly indestructible, will not crack during mixing, will not melt when heated up,
and will not fall apart when exposed to solvents. But perhaps most importantly, resins don't stick
to them, so you can reuse the same cup over and over again. This actually leads to savings after
a month or two of casting work!</p>

</li><li> <p><b>Mixing sticks:</b> you can mix the resin with just about anything, as long as it's dry,
clean, and has the right shape to reach all the spots inside the mixing cup. Many
people use tongue depressors, which cost something around 1-2 cents a piece
(<a href="http://www.tedpella.com/sticks_html/sticks.htm#anchor395805">try Ted Pella</a>), and can be wiped
clean and reused indefinitely. If you choose that option, just keep them away from moisture, and
be sure to clip the business end to get a flat tip for better reach.

Tongue depressors aside, chopsticks also work well, as do proper laboratory spatulas and flattened
mixing sticks (<a href="https://www.amazon.com/gp/product/B002VBW482">link</a>). The choice is yours.</p>

</li><li> <p><b>Freezer paper or thick aluminum foil:</b> it's convenient to pour a bit extra resin into the mold,
and let it overflow before sealing everything; this minimizes the risk of air entrapment. 
Any non-permeable, cheap material can be used to protect the surrounding working area against the overflowing
resin; freezer paper and heavy-duty aluminum foil from a grocery store will do the trick.</p>

</li><li> <p><b>Deburring tools:</b> there are several inexpensive
hand tools that prove very useful for quickly cleaning up the thin film of resin that may be present around
the mold's parting line, and for fixing other minor casting artifacts.

I recommend grabbing one miniature swivel deburrer, such as Noga RB1000 ($8);
one fixed-blade scraper, such as Noga SC8000 ($20); and perhaps a couple of small, hard Nylon brushes, such as
<a href="https://www.amazon.com/Otis-Variety-Receiver-Brushes-Bronze/dp/B00162OKDY">this</a> kit (already
mentioned before). You can do without them, and just use a toothbrush, a pin, and a needle file - but
your life will be a bit more difficult.</p>

</li><li> <p><b>Dental picks / wax carvers:</b>
a low-cost set of picks, hooks, and spatulas - something like
<a href="https://www.amazon.com/SE-DD312-12-Piece-Stainless-Carvers/dp/B000SVRSRY">this kit</a> ($9) -
will be extremely useful for removing silicone molds from masters, and for assorted other precision work. In fact, if
you don't have that in your workshop already, you are missing out.</p>

</li><li> <p><b>Sheet polypropylene or HDPE:</b> flat, smooth, non-stick plastics are useful for covering single-part
molds to ensure dimensionally accurate and aesthetic castings. Polypropylene is the best choice,
and you can get it in cut-to-size pieces from many sources, including
<a href="http://www.professionalplastics.com/">Professional Plastics</a>; HDPE is a second option, but it
is less temperature-resistant, and it's more common to see warped sheets. In any case, 
get at least 15-20 cut-to-size pieces, around 1-3 mm thick, with dimensions corresponding to the scale of
parts you are expecting to routinely make (10 x 15 cm
is probably a good starting point). You can get individual larger pieces later on.</p>

<p><b>Note:</b> make sure that the material you are buying is machined to a flat, smooth surface; HDPE in particular
is sometimes available in patterned varieties - suitable for making cutting boards, but not so much for casting
work. The material may come with some minor scratches, but these can be buffed out easily with fine sanding
paper. If the pieces are badly gouged or warped, however, request a replacement!
</p>

</li><li> <p><b>Brushes:</b> a set of small, soft-bristled brushes (<a href="https://www.amazon.com/Fine-Paint-Brushes-Acrylic-Watercolors/dp/B0035XKDJM">example</a>)
will be useful for cleaning master patterns and applying mold releases and other treatments to molds.</p>

</li></ul>

<p>
That's about it! For working with small quantities of resin and pouring it into complex multi-part molds, you
may also find it useful to get a box of single-use, two-element
10 ml syringes with no rubber seals (e.g., from <a href="http://www.enasco.com/">eNasco</a>), and 
some blunt-tip <a href="https://www.amazon.com/Dispensing-Needle-Blunt-Tip-1-1/dp/B001QRZ38U/">dispensing needles</a>.
</p>

<h4>4.2.3. Mold releases and other useful chemicals</h4>

<p>
Mold release is a material that forms a protective barrier between the mold and the resin
you will be pouring in, and makes it easier to demold final parts. The use of mold releases is optional when
casting silicones in polyurethane patterns, or polyurethanes in silicone molds, because these
materials don't adhere to each other in a particularly strong way - but still, a properly selected
release agent makes demolding easier, and prolongs the life of any mold by reducing its exposure
to reactive chemicals. On top of that, if you
ever want to cast polyurethanes in polyurethane molds, or silicones in silicone molds, a robust
adhesion barrier is simply a must.
</p>

<p>
I have tried many different mold releases over the years, and my top pick is, unquestionably,
<a href="http://www.moldmoreparts.com/MPSpecialty.htm">Stoner A324</a>; this spray-on agent
beats most of the silicone, PTFE, or zinc stearate releases
that I have tried before. They sell it for about $5 per can, and this should last you for about
1-3 months of hobby work. Stoner ships for free if you order a full box of 12 cans ($60).
</p>

<p>
If you can't obtain this product in your market, 
silicone-based mold releases are your second best choice, although some varieties may gradually
permeate and swell silicone molds. Releases based on mineral oils, PTFE, zinc stearate, polyvinyl
alcohol, and so on, usually don't perform well in high-precision, vacuum-assisted casting work.
The manufacturer of your silicone rubbers may be able to recommend some specific, locally available
picks.
</p>

<p>
That aside, you may want to also grab a wax-based mold release: they dry to form a hard, polishable,
permanent layer that not only serves as a barrier, but should improve the surface aspect of
polyurethane patterns. Low-viscosity brush-on formulations, such as 
<a href="http://www.freemansupply.com/Synlube531.htm">Synlube 531</a>, should work well; more
viscous liquids, such as
<a href="http://www.adtechplastics.com/pc-101-14-mr-1-mold-release.aspx">AdTech MR-1</a>, 
may need to be diluted with naphtha when working with intricate shapes, but it's not a hard thing
to do. Hardware store 
paste waxes that contain
carnauba wax (<a href="https://www.amazon.com/Beaumont-Trewax-Clear-Paste-197101016/dp/B005SRV1PI">link</a>)
work fine for simple shapes where dimensional accuracy is not critical, but high-gloss finish
is desired - and if you dilute them to a water-like consistency, you can use them for complex
models, too. In all cases, once the wax is dry, you can simply buff it with a soft cloth or a
brush.
</p>

<p>
<b>Note:</b> waxes
should <u>not</u> be applied to silicone molds, because they will inevitably crack and peel off - and the
solvents used are usually damaging to silicone rubbers, too. In general, with any new mold
release, always test it by soaking a piece of silicone in it for about 5-10 minutes; any
substantial or permanent change in dimensions would be a reason for concern.
</p>

<p>Mold releases aside, you may find it useful to get some of the following, largely
optional chemicals:</p>

<ul>

<li><p><b>Basic solvents:</b> it's good to have the following two options at hand:</p>

<ul>

<li> <p><b>Acetone:</b> when used sparingly, works as a great degreaser for plastics; if you don't make
a habit of using it, you will not get robust bonds with cyanoacrylate or epoxy glues, especially on molded
parts that may be still covered with release agents or so. It is also useful as a
solvent for certain resin additives, and helps degas stubborn or high-viscosity resins (1-2 drops make a huge
difference). It is advisable to get reagent-grade acetone from eBay 
(<a href="http://www.ebay.com/sch/i.html?_nkw=acetone+acs">link</a>); hardware-store variety is usually
also OK, but may cause problems if it contains too much water.</p>

</li><li> <p><b>VM&amp;P naphtha:</b> useful for diluting mold releases and for cleaning up silicone spills. Ethyl
acetate (an acetone-like solvent used in nail polish) works for the last two purposes, too - and may be a more
environmentally friendly alternative.</p>

</li></ul>

<!--

<p>For advanced users: if you want to make a DIY inhibitor to slow down the cure of polyurethane resins
(see <a href='ch4/#4.4.4'>section 4.4.4</a>), some of the options may require
n-methyl-2-pyrrolidone (NMP) - a highly polar solvent that dissolves other polar substances much better
than acetone. It's available on
<a href='http://www.ebay.com/sch/i.html?_nkw=nmp+solvent'>eBay</a> and from several other sources.</p>

<li><p><b>Drying agents (very optional):</b> some of you may eventually
find it useful to get a modest amount of one of two substances: zeolite grade 4A and silica gel
beads. Zeolite is a highly porous powder that shows high affinity to water, and forms translucent dispersions in
polyurethane resins. Adding a pinch of zeolite, pre-baked at 150&deg; C, helps reduce moisture sensitivity of
finicky resins. Silica beads have similar properties, but settle at the bottom of the container without affecting
the clarity of the resin - so they are useful for protecting pigments and resins against moisture
during long-term storage, especially in humid climates.</p>

<p>
You can get zeolite for
<a href='http://www.ebay.com/sch/i.html?_from=R40&_trksid=m570.l2736&_nkw=zeolite+4a'>around $12 per 500 g</a>
- and that amount will last you pretty much forever (you would normally add it to resins
at a level of 0.5% or so). Silica gel beads come in an
<a href='http://www.amazon.com/gp/product/B003BJWJBU/'>indicating</a> and
<a href='http://www.ebay.com/itm/4-5-LB-BAG-OF-SILICA-GEL-LOOSE-BULK-OVER-2-000-GRAMS-/180440227496'>non-indicating</a>
varieties. The latter is preferred, as the indicator won't leach out into polar solvents and certain resins.</p>
-->

</li><li><p><b>Siloxane surfactants (very optional):</b> concentrated siloxane surfactants make it easier to use 
polyurethane resins
as surface coatings; they do that improving wetting characteristics and eliminating pinhole defects. You will
likely need them if you wish to use
resins such as HP-21xx or IE-3075 as high-performance surface coats. Look for a product called Satur~8 on eBay;
when added to resin at around 1.5%, it should make quite a difference.</p>

</li><li><p><b>Silane couplers (ditto):</b> these may come handy if you wish to add glass-based fillers to polyurethane
resins, or improve bonding to glass surfaces. They modify the surface of these materials to make them form
strong, covalent bonds with polyurethanes, epoxies, and similar plastics. The coupler is applied as a 2% solution
in alcohol or acetone, and then left to dry in the presence of atmospheric moisture (water molecules are
needed for the actual activation process to occur).</p>


<p>
The most common and useful compounds are called
3-glycidoxypropyltrimethoxysilane (GLYMO) and (3-aminopropyl)-triethoxysilane (APTES). Concentrated
variants can be ordered from <a href="http://www.chemsavers.com/">Chemsavers.com</a> (just drop them a mail),
or get a smaller quantity from SPI Supplies
(<a href="http://www.2spi.com/catalog/chem/trimethoxysilane.php">link for GLYMO</a>,
<a href="http://www.2spi.com/catalog/chem/Aminopropyltriethoxy-Silane-APTES.php">link for APTES</a>). 
Diluted APTES is also available from <a href="http://apps.webcreate.com/ecom/catalog/product_specific.cfm?ClientID=15&amp;ProductID=31714">crafts
stores</a>.
</p>

<p>
Note that you don't always have to go through all this trouble; for example, milled glass fibers available from 
Fibreglast are already pre-treated in this manner, and there is no point in soaking them in a coupling agent
again. On the other hand, Scotchlite glass microspheres come in a virgin state and will benefit from this step.
</p>

</li></ul>

<h4>4.2.4. Optional: temperature-controlled oven</h4>

<p>
Temperature-controlled ovens are not essential in casting work, but they let you perform several
time-saving tasks:
</p>

<ul>

<li> <p>Drying molds, pigments, fillers, and other supplements if necessary. In most cases,
this can be also accomplished with any cheap, $40 toaster oven.</p>

</li><li> <p>Accelerating the cure of resins when dimensional accuracy is not critical. This is sometimes
preferred to chemical acceleration, because there is no need to purchase any reagents, and the
behavior can be fine-tuned more easily. Thermal acceleration requires accurate temperature control
between around 30-70° C, and will usually let you demold parts in under 1 hour.</p>

</li><li> <p>Post-curing finished parts, so that they achieve their ultimate properties
sooner than normal (it may take up to a week at room temperature for all the
reactions to cease). This requires accurate temperature control around 80-120° C.</p>

</li></ul>

<p>
Low-cost toaster ovens are the obvious solution, but somewhat unfortunately, they
have extremely poor temperature accuracy and stability, especially on the lower
end of the scale. If you are an accomplished DIYer, you may be able to grab one and simply
equip it with a more accurate, digital temperature control circuit. That said, if you 
are willing to part with a few hundred bucks and have some floor space, you can also try
getting a real laboratory oven, such as 
<a href="http://www.labdepotinc.com/Product_Details~id~727~pid~13532.aspx">this one</a>
($400); hot air sterilizers and dryers may offer a smaller and slightly more
affordable alternatives in some markets, too 
(<a href="http://www.sterilizers.com/tau-sterilizer.asp#TauPortable">example</a>,
around $300).
</p>

<p>
If you don't have that much money, or simply don't have enough room, don't worry;
you can do just fine without this piece of equipment, provided you are willing to
wait a bit longer for your castings every now and then.
</p>

<h4>4.2.5. Optional: pressure pot</h4>

<p>
There are some complex, multi-part molds where it may be hard to consistently avoid air entrapment,
even with the aid of vacuum; on top of that, there are some resins that tend to be difficult
to fully degas, or that will develop bubbles of carbon dioxide when not mixed perfectly
well, or when exposed to residual humidity. That latter set of problems is particularly
evident in mercury-free water clear poulyrethanes, such as the vanilla version of
Innovative Polymers OC-5086.
</p>

<p>
To improve your odds when dealing with such tricky cases, it helps to have a pressure pot;
the idea is to increase ambient pressure surrounding the mold to about 3-4 bar, thus
crushing and dissolving back any existing bubbles, and discouraging the formation of new
ones. Sure, it's a brute-force solution - but can you argue with its results?
</p>

<p>
Pressure casting equipment is more bulky, more expensive, and somewhat more dangerous than vacuum
pumps (due to much higher pressure differentials) - and for most part, isn't necessary; get it
only if you have plenty of room, and you are either forced to work with water clear resins that
don't tolerate non-pressurized casting, or you are willing to spend at least $200 to improve your
yields a tiny bit (say, from 85% to 97%).
</p>

<p>
If you want to take this route, pressure pots start around
$80 (<a href="http://www.grizzly.com/products/2-1-4-gal-Paint-Tank/H6330">link</a>); nicer ones fetch as
much as $300 (<a href="http://www.paintsprayersplus.com/product/JET5PTC/JET-5-Gallon-Resin--Mold-Casting-Pressure-Pot-Tank.html">link</a>).
To operate it, you will also need a compressor - and these start from $100 from fairly noisy units from
the hardware store, to $180 for
<a href="https://www.amazon.com/California-Air-Tools-CAT-1675A-1-6-Gallon/dp/B00889ZYF6/">relatively quiet-running ones</a>;
standard pressure hoses and fittings add another $20 or so.
</p>

<h3>4.3. Your first casting projects</h3>

<p>
All right, all right - enough with all the theory and shopping tips. It's time to
dig out that wax pattern that you have made before, and turn it into a finished work of art!
This section is all-text, but if you need visual aids,
<a href="http://www.flickr.com/photos/candy-bottoms/sets/72157625850569320/detail/">this
photolog</a> is probably good to look at.
</p>

<div>
<p>
<b><span>Caution:</span></b> similarly to many workshop and household
chemicals, casting resins can be harmful if misused. In particular, they may react violently
when mixed with incompatible substances; cause severe irritation or lasting damage
if splashed into your eyes;
and will emit dangerous vapors if overheated, burned, or intentionally aerosolized.
</p>
<p>
Please refer to product safety datasheets (MSDSes), and to <a href="https://lcamtuf.coredump.cx/gcnc/ch7/">section 7</a> of this guide, for an overview
of known risks, material handling recommendations, and disposal procedures. Do not proceed with any
hands-on experiments until you have done so.
</p>
</div>

<h4>4.3.1. Making a silicone mold</h4>

<p>
Resin casting is fun, but you need to remember that once the components are mixed, the reaction will
proceed no matter what; it's important to plan accordingly: read this section fully and memorize
all the steps beforehand, and have all the necessary supplies and information within reach.
</p>

<p>
First, you need to estimate the amount of resin you will need: for CNC-machined or 3D-printed shapes,
simply ask your CAD application to calculate the
volume of the master, and subtract this value from the volume of a dummy box of the same height, width, and
depth. To have a comfortable margin, add about 15% to the result, or 10 ml, whichever is greater. Then,
multiply that volume by the density of the resin (check the datasheet; it's usually between 1.1 and 1.4
g/cm³). The resulting figure is the weight of the material you need to prepare.
</p>

<p>
With these calculations out of the way, prepare the following stuff:
</p>

<ul>

<li> <p>A roll of paper towels. Tear away about 5-10 pieces ahead of time, and place them within reach; this
comes handy for wiping mixing tools, cleaning up minor spills, etc.</p>

</li><li> <p>An easily accessible trash bag for dirty towels and other things you want to get rid of in a 
hurry.</p>

</li><li> <p>Mixing container that fits within your degassing chamber, and holds at least 3 times the volume
of resin you will be working with.</p>

</li><li> <p>A clean, flat, and clutter-free work surface, covered with aluminum foil or freezer paper.</p>

</li><li> <p>A kitchen timer, a stopwatch, or something else that would let you keep track of time.</p>

</li></ul>

<p>
Although accidents are unlikely, you should still try to minimize potential damage: if there are any
LCDs or other expensive gizmos in your workshop, consider moving them a bit farther away, or covering
them with plastic sheeting. Don't wear your best clothes, and if you have a carpeted floor or expensive
hardwood, cover the area that is most likely to suffer in case of a spill.
</p>

<p>
When you are ready to go, place the mixing cup on a scale, then tare it. Agitate both components of the
resin in their original containers, and then use a clean tongue depressor or a spoon to pour about
20 g of silicone into the mixing cup. Add a suitable amount of catalyst (the ratio is usually 10:1,
but check the datasheet), start the timer, and begin mixing thoroughly for honest 3 minutes; be sure to
repeatedly scrape the sides and the bottom to avoid leaving any unmixed resin in these spots.
</p>

<p>
Next, place the cup under vacuum; the mix will initially rise as the bubbles expand, and then
collapse back; you should keep it under vacuum for another 1-2 minutes past that point. If the resin gets
dangerously close to overflowing during the initial rise, simply release the vacuum (i.e., yank out the
hose), and try again; several cycles of that should do the trick - and next time, use a larger cup.
</p>

<p>
The next step is to pour some of the resin into the mold created in chapter 3;
use about half of the required volume or so.
Place the mold on a strip of aluminum foil, and put that under vacuum; this will help the resin conform
to even the most intricate shapes with no effort on your end. After about 2-3 minutes, you can <u>slowly</u>
release the vacuum, pour the remaining amount of resin (use a bit more 
than necessary to get a convex surface at the top of the mold), and set the whole thing aside for several
minutes to allow any bubbles to rise
to the surface (or collapse back into the resin). If there are any stubborn bubbles on the surface at
that point, you can apply a gentle burst of compressed air to get rid of them.
</p>

<p>
Finally, cover the entire contraption with a flat, clean sheet of polypropylene; lay it down
gradually, starting at one side, to avoid air entrapment. When done, weigh it down with something reasonably
heavy - around 500 g should do - and brace the whole thing, so that the cover doesn't slide off. Be sure
to check the timer at this point - has the entire process taken more than about 12-15 minutes? If yes,
why?
</p>

<p>
In any case, give it about 12 hours or so, until the resin remaining in the mixing cup is firm and tack-free.
If you are impatient, placing the mold in a temperature-controlled oven at around 50° C will cut the
curing time down to 1-2 hours or so - but don't go too high, given that this particular
master is made out of wax. When the rubber is ready to demold, pull off the cover, and then use
a dental hook or a similar tool
to pry the rubber off near the corner of the mold. Remove it fully and inspect the result.
if it looks flawless - as it should - you may want to briefly post-cure it at around 100° C for
30-60 minutes, and in the meantime, pat yourself on the back!
</p>

<p>Here are several questions that may be on your mind:</p>

<ul>

<li><p><b>What about the application of a 
mold release?</b> Waxes already have a non-stick surface, so if you are following the instructions
from chapter 3, you should be fine. When using prototyping boards or 3D-printed materials,
you should apply a thin layer of mold release beforehand, and allow it to dry. Use a soft brush to
spread the substance evenly, and don't overdo it: you want to wet the workpiece, but do not let the
liquid pool in hard-to-reach spots.</p>

</li><li><p><b>The resin didn't cure! What now?</b> Ow, bummer. The most likely reason is insufficient mixing
(especially if there are sticky patches or streaks in an otherwise well-cured material); bad mixing
proportions; contact with incompatible materials (platinum-cure silicones are particularly sensitive
to sulfur compounds); or low temperature (the resin will take forever to cure below 18° C or so).
If you have ruled these causes out, feel free to drop me a mail, and we'll try to get to the bottom of
it.</p>

</li><li><p><b>What if I'm having trouble demolding?</b> This takes some practice - try to find the right
tools, and locate a spot where you can grab the rubber with a hook without causing any damage. For
particularly challenging shapes, introducing pull tabs and draft angles in the mold, as
discussed earlier, is the way to go.</p>

</li><li><p><b>What if the mold is too big to put under vacuum?</b> For simple shapes, you can just gently
pour the degassed rubber in, starting at the lowest point of the mold. If there are any tight spots,
it's useful to fill a syringe with a small amount of catalyzed resin, put a needle on, and use that
to force the resin into these problem areas beforehand.</p>

<p>When working with truly oversize pieces, you may find it useful to rely on a process called <i>glove
molding</i>: brush on several thin layers of silicone onto the part, and then coat this flexible skin with
a rigid, thixotropic polyurethane, epoxy, or polyester resin to create a backing shell. This is a great
way to conserve silicone, although the mold takes more time and effort to prepare.</p>

<p>(For optimal results, the silicone resin used for this purpose may need to be thickened to a non-flowable
consistency with an additive such as Bluestar 22646 or with fumed silica. Fumed silica can be also used as
a thickener for the rigid resin used as the outer coat.)</p>

</li><li><p><b>Vacuum degassing only made the bubbles worse, what now?!</b> The resin should rise and collapse pretty
quickly; some bubbles will continue to appear, but they should collapse back shortly after the system
is returned to room pressure. If that doesn't happen, check the ballast valve on your pump (it should
be closed) and examine the entire setup for any leaks. Make sure that the pump is in good working order
(many pumps require the right amount and type of mineral oil for lubrication). Verify that the
pump is well-suited for the size of your vacuum chamber, too. If you're stumped, getting a cheap vacuum
gauge from Amazon may help.
</p>

</li><li><p><b>How long will the mold last?</b> Depends. When following the advice provided in this guide, around
50 pulls would be the norm. Lower-strength silicones, more aggressive resins (epoxies,
polyesters, very fast or very slow polyurethanes), and complex geometries (deep molds with intricate 
detail) will lower the lifespan of silicone molds.
</p>

</li></ul>

<p>Okay, okay - time for some polyurethane fun!</p>

<h4>4.3.2. Casting plastic parts</h4>

<p>
Polyurethane casting is not dramatically different from working
with silicones, but you have to be swift, and pay more attention to detail. Quite simply,
with a resin such as IE-3075 or TP-4052, you will probably only have about 6 minutes to go through
all the steps - so there is no time to look around for paper towels or a mixing stick.
</p>

<p>
In general, before starting, you should go through all the preparation steps outlined in the
previous section; and when done, you should also do the following:
</p>

<ul>

<li> <p>Make sure that the resin hasn't separated or crystallized. In almost all formulations,
the isocyanate component should be clear, and both components should be completely homogenous.
Agitate the containers if necessary; crystallization may require heating the containers slightly
(usually not more than 40° C); always check with the manufacturer first, and exercise caution.</p>

<p>
<b>Note:</b> in filled systems, the filler settles out of the solution 
and hard-packs at the bottom of the container; this is particularly true for heavy fillers, such as
glass. You need to use a 
<a href="https://www.amazon.com/gp/product/B00002X2ET/ref=oh_details_o02_s00_i00">small paint mixer</a>
attached to a power drill to
properly homogenize the contents of larger containers; it's not a big deal, but watch out for spills.
Manual mixing is viable only for small quantities, up to perhaps 250 ml or so.
</p>

</li><li> <p>If you haven't done so already, get two smaller polypropylene bottles, and fill them up with
a more manageable amount of isocyanate and polyol, so that you do not have to constantly agitate,
open, and tip over gallon-size jugs. When done, blanket the original containers with "canned air" or
nitrogen, and close then tightly. Be sure to label the new bottles clearly, too.</p>

</li><li> <p>Make sure that the mold and any hygroscopic fillers you want to add are perfectly dry - especially
before first use, or after extended storage. Placing solid materials at 110-150° C for about
10-20 minutes, or applying vacuum for 5-10 minutes, is a good option if you want to play it
very safe.</p>

</li><li> <p>Prepare a perfectly flat, spill-proof surface on which the silicone molds will be laid out
while the resin cures. You can use a sheet of polypropylene, or a neat piece of aluminum foil with
no creases. Whichever option you choose, applying some mold release to that surface is a good idea.</p>

</li><li> <p>Grab a small, flat sheet of polypropylene or HDPE to serve as a top cover for the mold. Mark
one side with a permanent marker, apply a thin coat of mold release to the other,
and place the sheet within reach.</p>

</li><li> <p>Apply a very light coat of mold release to the silicone mold, and spread it evenly with a
brush. Repeat the process every 5-10 pulls, but don't overdo it; for casting polyurethanes in
silicone molds, too little is better than too much. Allow the release to dry for 15 minutes or so.</p>

</li></ul>

<p>
With all the preparations taken care of, you are ready to roll. Place the mixing cup on the scale,
tare it, and pour the required amount of isocyanate; in our case, 10 g will do. Next, gently pour
the appropriate amount of polyol (for IE-3075, this will be 8.9 g), start the timer, and begin
mixing very thoroughly, frequently scraping the walls. Most polyurethane resins, IE-3075
included, require <u>at least 90 seconds of mixing</u> to progress from a dispersion to a proper
solution when mixed in a small quantity - and if you stop sooner, the cured material
may not cure properly. Do it right.
</p>

<p>
When done, place the container under vacuum, and turn on the pump. The resin should take no
more than about a minute to rise and collapse back; if it's taking much longer,
your vacuum chamber may be too big, or the pump may be inadequate or malfunctioning (e.g., due to
an open gas ballast valve, or due to contamination). If, on the other hand,
everything went as expected - and the bubbles have collapsed in a timely manner - you should now pour
some of the resin into the mold cavity (to fill it roughly halfway, taking care to cover any detail
where air entrapment is likely), and place the mold under vacuum for another minute or so.
Don't worry if it never stops bubbling at this stage; that's OK.
</p>

<p>
After a brief round of degassing, release the vacuum gently, place the mold on a previously
prepared flat surface, and add the remaining resin, until it overflows and forms a convex surface
(this is important - otherwise, air entrapment is a lot harder to avoid).
Grab the polypropylene cover
and carefully lay it on top of the mold, using the technique outlined for silicones. You should brace the
cover against something, so that it doesn't slide off, and weigh it down with around 200 g 
(larger molds can be clamped with several kg of force, but this particular one is relatively
easy to squish).
</p>

<p>
Well, that's it! Before you go, check the timer; if the process has taken more than six
minutes, you should figure out how to improve it. In any case, leave the mold alone for at
least 3 hours (or more, depending on the resin used), and when you come back, confirm
that the material left over in the mixing cup is tack-free and hard as nails. Next,
gently flex the polypropylene cover to detach it from the part, and extract your casting
from the mold.
</p>

<p>
Hopefully, the result is perfectly fine; that said, the likelihood of mishaps is higher
for polyurethanes than it is for silicones - so if something isn't right, don't despair.
Here's a quick summary of the most common issues I have seen:
</p>

<ul>

<li> <p><b>The resin is still sticky or gooey:</b> assuming you waited long enough,
the culprit may be low ambient temperature (try to stay close to 20-25° C), incorrect
mixing proportions, or mixing the wrong components (the containers all look almost the same).
A less likely cause may be the introduction of a problematic filler or dye, or the use of
a resin that is incompatible with platinum cure silicones (this is rare;
the datasheet should have said so).
Treating the surface of the mold with a separately purchased polyurethane catalyst is a 
possible workaround for that last problem - see later on.</p>

</li><li> <p><b>The material turned into a foam:</b> this may be caused by using a resin that
crystallized during storage and hasn't been heated up to dissolve the crystals; by adding
a filler or other additive that contained a significant amount of water; or by similar
type of gross moisture contamination (wet hands, condensation, etc). In some formulations,
failing to properly degas the catalyzed resin, mixing for way too short, or not allowing
the mold release to dry properly before pour, may also cause a similar symptom.
</p>
<p>
(If you suspect your vacuum setup, check out the tips in the previous section.)
</p>

</li><li> <p><b>Top surface is soft and scratches easily:</b> this is almost always 
due to insufficient mixing. Dispersed droplets of polyol have coalesced and, being
lighter than the isocyanate component, floated up. More thorough mixing or higher
ambient temperature will usually fix the issue. Premixing - as discussed later on - should
also help.</p>

</li><li> <p><b>Discoloration or clusters of tiny bubbles running around edges or in other
well-defined streaks:</b> usually also a matter of insufficient mixing - see above. </p>

</li><li> <p><b>Several individual, round bubbles that floated to the top or are stuck in tight
corners at the bottom of the mold:</b> air
entrapment during the
casting process. If there are stubborn bubbles still present in the liquid as you are pouring it
into the mold, and your vacuum system is in good working order otherwise -
mix in 1-2 drops of acetone per 10 ml of resin before degassing, and see if that helps.
</p>
<p>
Oh - when in-mold degassing is not possible due to the size of the part,
applying the resin with a syringe or a brush may help with any tricky spots.</p>

</li><li> <p><b>Giant
tear-shaped bubble near the top surface:</b> air sucked into the mold due to
applying too much force when placing the cover or insufficient clamping. It may also be that you
haven't poured enough resin to begin with, or that the cover or your work surface is warped.</p>

</li><li> <p><b>Several oddball bubbles in thin sections, especially if suspended in the middle of
the part:</b> 
often caused by using a highly moisture-sensitive and slowly curing resin, such as OC-5086; the 
bubbles form as the resin is already partly-solid, contributing to their sometimes elongated
or meandering shapes. If all other options fail, pre-heating the molds, adding some extra catalyst
(see later), or using pressurized casting will help.</p>

</li></ul>

<p>
If you are seeing any issues, it's important to narrow the problem down right away, while the
number of variables is still fairly low. If you are out of ideas,
don't hesitate to ping me at <a href="mailto:lcamtuf@coredump.cx">lcamtuf@coredump.cx</a>; I may
be able to help. A good place to discuss your experiences or showcase your work may be
<a href="http://www.reddit.com/r/resincasting">/r/resincasting</a>, too!
</p>

<p>
Anyway - if everything turned out to be just fine, you may want to briefly post-cure the part
and any leftover material. Place it at around 100° C for one hour, and then play with it to get
a sense of its physical properties: try drilling a hole in or scratching the surface of one of the
leftover bits, and see how hard it is to break it.
</p>

<h3>4.4. Miscellaneous polyurethane casting tips</h3>

<p>
This section is just a quick a collection of random notes that should come handy in real-life
projects, but that I wanted to keep out of your first casting job. Enjoy!
</p>

<h4>4.4.1. Meta: not all resins are alike</h4>

<p>
Before we dive into various advanced topics, you should know that 
there are significant differences in the handling characteristics of various polyurethane
resins, even if the advertised cure times and ultimate physical properties of the material are roughly the
same. In particular, be aware of the following:
</p>

<ul>

<li> <p>The choice of catalysts will affect the resin's sensitivity to moisture, often dramatically
so. Some resins with highly selective catalysts will cure pretty well in open air, and can be
used as surface coats (e.g., HP-21xx); some have moderate sensitivity that can be greatly lowered
using the premixing technique outlined later in this chapter (IE-3075, TP-4052); and
others, such as OC-5086, really need to be modified with an aftermarket catalyst, or pressure-cast,
to maintain sanity when making precision parts.</p>

</li><li> <p>The use of blocked or temperature-sensitive catalysts
helps achieve long pot life followed by a snap cure when casting larger models; unfortunately, the same
trick may prolong demold time when working with tiny parts that never reach the activation threshold.
</p>

</li><li> <p>The exact composition of the system will greatly affect miscibility of the formulation at lower
temperatures, before the reaction really kicks in. Some resins will require very little
stirring when working with quantities around 10-20 ml, but a few may need as much as 5 minutes of work,
unless you are willing to increase the temperature slightly (to ~30° C) 
or employ a similar trick.</p>

</li><li> <p>Depending on the composition, the resin may have a brittle stage, at which point it is
very vulnerable to cracking even under minimal stress; in other systems, incomplete polymerization
is simply marked by susceptibility to plastic deformation.</p>

</li></ul>

<p>Because of all these striking differences, don't take everything you see in this guide as universally
applicable to every formulation on the market; and in the same vein, don't expect your own experiences
with product A to be fully applicable to product B. If in doubt, request a sample of any new product
you are considering, or simply ask.</p>

<h4>4.4.2. Adding pigments and fillers to resins</h4>

<p>
Let's start with something simple. Non-reactive (i.e., plasticizer-based)
liquid dyes and coloring pastes can be mixed into the working amount of isocyanate, before adding any polyol;
when taking this route, just try to stay under 2% by volume (around 8-10 drops per 10 ml); if you find
yourself routinely having to add more, consider switching to dry pigments or a higher-yield dye or a
reactive carrier - because past this point, solvents used in the dye will be affecting the properties of
the part.
</p>

<p>
Reactive coloring pastes designed specifically for polyurethanes use a polyol as a base; that's the
case for pigments from Innovative Polymers. Their main benefit that they can be added at much higher
levels without completely messing up the properties of your parts. In principle, you should subtract
the weight of the added dye from the required weight of polyol - but in practice, this varies from
one formulation to another. In a quick experiment with
IE-3075, I found that using the nominal amount of polyol results in improved strength. Results in
other resins may vary.
</p>

<p>
When working with dry pigments, there is a bit more legwork involved. If you simply dump the pigment
unceremoniously into the liquid, it will probably clump together - and stay that way.
To avoid this, you need to place the desired amount of material in an empty mixing cup, tare it,
and start adding isocyanate drop by drop, mixing constantly, until you end up with a homogenous, runny
paste (siloxane surfactants can make the process easier, too). Once the paste looks good,
you can gradually add the remaining isocyanate while constantly mixing - and you should be all set.
</p>

<p><span><b>Tip:</b></span> if you have a high-yield, hard-to-disperse powdered
pigment that you keep coming back to, it may make sense to make a custom coloring paste for future use. 
Simply disperse it thoroughly in an inert plasticizer (e.g., dipropylene glycol dibenzoate, discussed
earlier; silicone oil works for platinum cure rubbers) or in a suitable polyol, and pour that into a
<a href="https://www.amazon.com/Nalgene-2750-9025-Dropper-Natural-Closure/dp/B004O6NER2/">dropper
bottle</a>.</p>

<p>
Of course, as noted earlier, you should ensure that the material is moisture-free; in tricky cases,
premixing the resin or adding zeolite should help. Glass-based fillers, such as Scotchlite or milled
fibers, may benefit from being pre-treated with a silane coupler, too.
</p>

<h4>4.4.3. Premixing the system</h4>

<p>
Premixing is one of the simplest and lesser known tricks that can help solve many of the problems
that crop up in some polyurethane casting jobs. For example, it can dramatically reduce shrinkage without
affecting cure time; lower the risk of cure inhibition; halve the time needed to fully mix the
resin in small batches; and greatly reduce the sensitivity to moisture, to the point of making many
systems suitable for surface coating applications. These benefits stem from the reduced reactivity
and improved compatibility of a partly polymerized liquid. It's not a silver bullet, but for 
many formulations, it's pretty close to being one.
</p>

<p>
The only price to pay for premixing is an increase in viscosity, which typically isn't a big deal
if you have started with a low-viscosity system such as IE-3075; and the added expense of about
5 minutes of work and about one hour of waiting per every batch that you intend to cast.
</p>

<p>
If you want to try it out, the recipe is very simple: measure the desired amount of isocyanate, add
all the fillers and dyes you want to have, and then introduce between 10% and 20% of the necessary
amount of polyol; this mix needs to be stirred thoroughly, degassed - and then stored in a covered
cup, blanketed with an inert gas, for about 1-2 hours.
At that point, the remaining polyol can be mixed in, and the resin can be cast.
</p>

<p>
Keep in mind that premixed resins will have short shelf life: the viscosity will keep increasing,
and in presence of a catalyst, the isocyanate will more aggressively react with ambient humidity
and deteriorate. You should premix only the amount you intend to use right away.
</p>

<p>
Oh - in case you are curious, this graph shows the impact of premixing on the exotherm for 10 g of
IE-3075, and how it compares to the use of fillers. The measurements were taken
using a thermocouple submerged in a small, insulated polypropylene cup, approx. 30 mm in diameter:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/exotherm-fillers.jpg">
</p>

The X axis is time in seconds. The Y axis is temperature in °C. The resin and the room are
initially at around 20 °C.

<h4><a name="4.4.4">4.4.4. Adjusting room-temperature cure speed of existing resins</a></h4>

<p>
Here's another tidbit you won't find in any other hobbyist reference on resin casting: it is
possible, and in fact fairly easy, to chemically slow down many polyurethane systems to significantly
reduce shrinkage; and to accelerate slow-curing ones to get your parts sooner or have fewer
artifacts in thin sections of your molds. Why bother, you may ask? Well, it not only saves you
money, compared to buying several resins for different applications - but perhaps more interestingly, it
enables you to come up with custom-tailored cure profiles that are of no commercial interest to the
manufacturer.
</p>

<p>
In essence, there is a wide variety of catalysts used in castable polyurethane resins. Every catalyst
behaves differently: some are highly active at room temperature, some kick in only later on, when the
resin has warmed up due to exotherm. Some are better at driving the early stages of polymerization,
but stop shortly thereafter; some have a sustained effect until the very end. Some are highly selective
toward the desirable isocyanate-polyol reaction, and some don't mind catalyzing the isocyanate-water
reaction - which leads to the formation of bubbles of CO<sub>2</sub>. Some are very stable, and some
deteriorate when exposed to open air and other substances, which may cause inhibition or poor surface
cure. But there is no single product that gives you the very best on all fronts.
</p>

<!-- <img src="29-cure.jpg"> -->

<p>
For this reason, manufacturers combine various catalysts to reach a compromise that makes sense for their
intended customers - but these parameters aren't necessarily ideal for your needs. For example, OC-5086
is a resin designed for larger castings; when dealing with tiny parts, it will cure too slowly, and
with far too much sensitivity to ambient moisture.
</p>

<p>Thankfully, you can fix this on your own.</p>

<h5>4.4.4.1. Speeding things up</h5>

<p>Ideally, if you wish to use OC-5086 or HP-21xx - or accelerate any other finicky resin - you should
get bismuth neodecanoate from
<a href="http://www.scbt.com/datasheet-234094-bismuth-neodecanoate.html">Santa Cruz Biotechnology</a>
or <a href="http://www.krackeler.com/products/sigma/ALDRICH/544132">Krackeler</a>.

The cost is around $35 for 250 g, and that amount will last you forever. The catalyst isn't 
dangerous, but both of these places have a blanket policy of shipping only to commercial addresses.
If you can't have it shipped to work, ping the folks who run
<a href="http://www.chemsavers.com/">Chemsavers.com</a> - they should be able to get it
for you and ship it to your home for a very modest premium.
</p>

<p>
Bismuth neodecanoate is a syrupy liquid which needs to be diluted with a plasticizer (e.g., 
DPGDB), a suitable polyol, acetone, or something else of that sort. Depending on the resins
you are working with, you may have to experiment with dosage, but typically, levels between
50 and 500 ppm will be enough. For example, to "fix" OC-5086, you can prepare a 4% solution
in plasticizer, and add it at about 1-2 drops per 10 ml of isocyanate as you are getting
ready to mix it with a polyol. To speed up HP-21xx,
you will need a solution closer to 50%, added in similar quantities.
</p>

<p>
Now, if this particular bismuth compound is hard to find where you live, don't despair! A 
decent alternative is
tin(II) 2-ethylhexanoate, also known as stannous octanoate. This substance is commonly sold as
an accelerator for condensation-cure silicones; for example, a nearly pure form is available
under brand names such as Smooth-On Accel-T, Quantum Silicones QSil STO, or Bluestar VICURE #2.
Just be careful not to buy anything based on dibutyltin dilaurate, dimethyltin dineodecanoate,
or a similar tin(IV) compound: they will work great, but also happen to be a lot more toxic.
</p>

<p>
As with bismuth, the appropriate dosage varies depending on the resin; for OC-5086, a 
4% solution, added at 1-2 drops per 10 ml of isocyanate, is a good starting point. Note that 
the compound is a bit more harmful than bismuth - handle it with care.
</p>

<p>
Bismuth and tin aside, there are several other, more exotic options to choose from. They may
offer very specific benefits, such as improved curing characteristics in particular systems,
or no subsequent inhibition of platinum silicones (which are somewhat sensitive both to bismuth
and tin). If you need additional guidance, <a href="https://lcamtuf.coredump.cx/gcnc/#" onclick="return show_div(&quot;cat_note&quot;)">click
here</a> to expand a section with some rough notes.
</p>





<div>
<p>
<b>Random rant:</b> as noted above, most suppliers of lab chemicals are no longer willing
to ship to residential addresses. Such restrictions
make some sense for haz-mat materials - but the companies simply won't do <b>any</b> business
with you, even if all you're trying to buy is salt or glucose.
</p>

<p>
There are two reasons for this. First, there is a growing number of government agencies - ranging
from DHS, to DEA, to CPSC 
(<a href="http://www.wired.com/wired/archive/14.06/chemistry.html">yes, that's right!</a>) - that 
don't want people to make anything ranging from illicit drugs to bootleg fireworks. Companies that
sell to individuals face a hodgepodge of regulations and vague reporting requirements, and risk
police raids and other serious consequences if they mess up. Second, there are liability concerns:
if a kid loses an eye and his parents sue - well, even if the manufacturer prevails in court, there
are still legal expenses and bad PR to deal with.
</p>

<p>
Because of this, it simply makes no sense for most of them to cater to the hobbyist market at all -
shipping to a commercial address creates a pretense of due diligence, no matter how weak it may be.
</p>

<p>
To keep chemistry alive as a hobby, I urge you to support the remaining few places that did not succumb
to this trend; in particular, consider going with eBay sellers or friendly outlets such as Chemsavers
even if you have an opportunity to order certain chemcials directly from the manufacturer for less. Just
stay away from <a href="http://www.resellerratings.com/store/ScienceLab">ScienceLab.com</a>.
</p>

</div>

<h5>4.4.4.2. Slowing down the reaction</h5>

<p>
In many types of polyurethane formulations, it is possible to slow down the reaction by
converting the catalyst to a less ractive complex. In particular, systems that rely on amine catalysts
(and do not contain reactive amines as crosslinkers or any other vital components of the formulation)
can be slowed down with strong, non-oxidizing acids that react with
the catalyst to form a largely inactive ammonium salt. In the same spirit, some of the less 
obnoxious thiols and certain other substances can chelate a variety of organometallic catalysts.
</p>

<p>
In products such as IE-3075 or OC-5086, you can get good results with p-toluenesulfonic or methanesulfonic
acid, both of which are available from Chemsavers for around $20. Methanesulfonic acid is slightly more
convenient, because it is liquid at room temperature; but p-toluenesulfonic acid is pretty easy to
directly dissolve in polyol. Levels around 0.1-0.5% by weight should have a very pronounced
effect; just be careful not to go overboard: excess acid may react with isocyanates and mess things
up.
</p>

<p>
This graph shows the impact of p-toluenesulfonic acid on the curing exotherm of IE-3075, using the
setup outlined earlier on:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/exotherm-ptsa.jpg">
</p>

<p>
If PTSA or MSA are not easily available in your market, a much less potent but possibly still 
acceptable alternative is sulfamic acid, a common cleaning compound available on
<a href="http://www.ebay.com/sch/i.html?_nkw=sulfamic+acid">eBay</a> and 
<a href="https://www.amazon.com/Aqua-Mix-Sulfamic-Acid-Crystals/dp/B000GFJTVA">Amazon</a> for
just a couple of bucks. The main problem with this compound is its relatively poor solubility in
polyols and in most organic solvents. A saturated solution in n-methyl-2-pyrrolidone (NMP) may be
your best bet; it will need to be added at a level closer to 1-2% by weight, which isn't exactly
ideal. The solution is also not stable in the long haul, so prepare only as much as you intend to use
in a couple of days.
</p>

<p>
What else? If you really can't get any of the above, you can try tartaric acid. Along with several other
weak, aliphatic hydroxy acids, this compound will inhibit the reaction to some extent, although it
shows some interest in side ractions that may liberate bubbles of carbon dioxide or impart a yellowish
hue to your parts. On the upside, it's a common food additive, available pretty much everywhere; and it can be
easily dissolved in acetone.
</p>

<p>
Note that PTSA, MSA, and sulfamic acid are all highly corrosive; use gloves and eye protection
whenever working with concentrated solutions.
</p>

<p>
Oh, one more thing: keep in mind that while adding catalysts to a resin is guaranteed to make a
positive difference, adding a particular inhibitor is not. Of the fast-curing resins discussed in this guide,
I never found a way to significantly slow down TP-405x, but almost everything else seems to be a fair game.
</p>

<h4>4.4.5. Blending several resins together</h4>

<p>
Every now and then, you may be hoping to modify the properties of a resin in a way that goes beyond what's
possible with non-reactive fillers, plasticizers, and so on. Other times, you may be interested in changing
its cure speed in a situation where the methods outlined in the previous section are impractical or simply
don't work.
</p>

<p>
Well, the good news is that you can do quite a bit without resorting to making your own formulations from
scratch. First of all, if you have two resins with comparably reactive isocyanates
or polyols, and similar catalysts, you may be able to simply mix them together as-is. For example,
let's say that you own HP-2150A and HP-2160D, and want to create a range of tough elastomers. The
mix ratio is 100:43 for the first resin, 100:20 for the second one, and you want to blend them
at a ratio of roughly 2:1 to get a rubber around 70 Shore A. In this case, suitable mixing amounts
may be:
</p>

<ul>
<li> <p>HP-2150A isocyanate: 10 ml</p>
</li><li> <p>HP-2160D isocyanate: 5 ml</p>
</li><li> <p>HP-2150A polyol: 4.3 ml (10 ml * 43 / 100)</p>
</li><li> <p>HP-2160D polyol: 1 ml (5 ml * 20 / 100)</p>
</li></ul>

<p>
Of course, if the systems are based on dissimilar chemistry, the resin may cure prematurely, not
cure at all, or have disappointing mechanical properties. Even in this case, not all is lost:
you may be able to get somewhere by starting with a single resin, and then partly or completely
substituting one of its components with that belonging to another system. There are situations
where it won't work, and situations where it will give you useful materials with faster or
slower cure profiles, and mechanical properties somewhere between these of its constituents.
</p>

<p>
The challenge with this second approach is figuring out the correct mixing ratio for isocyanate
coming from product A, and polyol coming from product B; the manufacturer won't tell you how many
reactive NCO and OH groups are there in each of the components, and without this information, you
have to resort to trial and error. The correct ratio is usually between 100:30 and 80:100, and
you can pinpoint it by doing several tests and selecting the range that resulted in
the highest indentation hardness (Shore D durometer costs about $25-$50 on
<a href="http://www.ebay.com/sch/i.html?_nkw=shore+d+durometer">eBay</a>); guessing the
ratio within 5% should be fine in most uses.
</p>

<!--
<p>
Examples of the things I have tried combining out of sheer curiosity are the
OC-5086 isocyanate with TP-4052 polyol and some extra catalyst to get a slow-curing, high-impact
translucent material with a freely adjustable cure speed. In the same vein, you can take 
OC-5086 and replace 10-30% of its isocyanate with the isocyanate coming from IE-3075. The material
will retain transparency in thin sections, but will cure much faster without having to add any
catalysts.
</p>
-->
<h4>4.4.6. Heat-accelerated cure</h4>

<p>
As noted earlier, polyurethanes and silicones begin polymerizing the moment you mix the components; by the
time you reach the demold time, the reaction is mostly over - but some cross-linking may continue for
many days or weeks at an exponentially decaying rate. As this process goes on, the properties of the
part will keep approaching these advertised in the datasheet.
</p>

<p>
If you are impatient and want to demold your castings sooner than normally possible, but don't want to
sacrifice pot life or deal with chemical catalysts, placing the mold in a temperature-controlled oven will 
typically cut the time in half per every 10° C over ambient.
Alas, the combination of significant thermal
expansion of silicones (0.025%/°C), and the somewhat lower but still noticeable expansion of rigid polyurethanes
(0.005%/°C), will probably affect dimensional accuracy of the part - so if you are aiming for snap fits, it
makes sense to keep the mold at room temperature for as long as you can, and then bake it at no more than
perhaps 40° C.
</p>

<p>
For an already demolded part, post-curing is a valuable process that involves fewer trade-offs, and lets
you reach the final properties of the material in hours, rather than weeks; since the resin is already
largely polymerized, and is not confined in an expanding mold, its own 
thermal expansion is less likely to have lasting
effects. It's important to ramp up the temperature gradually, though, so that the part doesn't get too
soft. I suggest one hour at 40° C, followed by 30 minutes at 60° C and 80° C; the
cycle can be wrapped up with 1-3 hours at 100-110° C. Note that many polyurethanes begin to
deteriorate around 150° C, and that for transparent formulations and flexible rubbers, this limit
may be even lower.
</p>

<h4>4.4.7. Multi-part molds</h4>

<p>
All right, all right - enough with chemistry. But there's one more topic that may help you
in casting work. Sooner or later, you will need to make parts with complex features on multiple sides. 
When replicating hand-made shapes, the process is usually very intuitive; for example, the geometry can
be submerged in a blob of silicone that is carefully dissected with a scalpel or a box cutter,
and put together later on.
</p>

<p>
The process for designing accurately meshing multi-part molds in CAD software isn't much more complicated,
but may take some effort to wrap your head around it. Let's say you want to make a part with a cross-section
as shown on the left (and some additional features that prevent us from simply laying the shape on its side):
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/28-twoside.jpg">
</p>

<p>
The first step is to make a regular mold similar to what we would do for one-sided parts, but also
add a small pedestal around the geometry - this will serve as a registration mark. The second mold
is simply the same part and its pedestal, flipped around; this top mold will neatly slide into the
bottom one. Voila!
</p>

<p>
In more complex molds, the parting line may be located less conveniently, and may not allow all the air to
escape on its own. In these cases, the mold will typically have a sprue through which the resin is poured
in, and strategically placed vents to allow the air to escape from tight spots; a reservoir of resin
on top of the spruce will offset for shrinkage in large parts, too. All in all, it's not hard, but
when it comes to that, you will need to practice a bit.
</p>

<!-- START~5~Essential parts for robot builders~ -->

<h2><a name="5">5. Essential parts for robot builders</a></h2>

<p>
Righty-o. Now that we have the basics of machining, moldmaking, and resin casting covered to
a good extent, it's useful to discuss more practical designs and part geometries of interest to
robotics and other mechanical work. But before we dive into the inner workings of custom-designed
gears and drivetrains, it's important to take a brief detour, and go over some of the prefabricated
components that may come handy in your projects. Without a good source for tiny screws, springs,
dowel pins, or cheap electronic sensors, you simply won't be able to get far.
</p>

<p>
Rest assured, this chapter will merely scratch the surface of it all. If you are looking for
inspiration, get <a href="https://www.amazon.com/Machine-Devices-Components-Illustrated-Sourcebook/dp/0071436871">"Machine
Devices and Components Illustrated Sourcebook"</a> by Parmley, or
<a href="https://www.amazon.com/Mechanisms-Mechanical-Devices-Sourcebook-Fourth/dp/0071467610">"Mechanisms and Mechanical Devices Sourcebook"</a>
by Sclater and Chironis; and if you need a primer on electronics, my
<a href="https://lcamtuf.coredump.cx/electronics/">concise guide to electronics for geeks</a> may come handy, too.
</p>

<h3>5.1. Mechanical components</h3>

<h4>5.1.1. Screws and threaded rods</h4>

<p>
Machine screws, also known as bolts, are one of the most important items to put on your
shopping list: if you want to create durable, serviceable designs that can't be approximated
with indiscriminate use of glue, suitable fasteners are simply a must.
In tough plastics such as polyurethanes, the use of screws is particularly easy: simply machine a 
slightly undersized hole and drive the fastener into it, impressing its own thread onto the part.
Much of the time, you don't need a nut!
</p>

<p>
If you want to shop for useful sizes and quantities of machine screws, skip your local hardware store.
There are three particularly good online sources for miniature and subminiature fasteners in bulk: 
<a href="http://www.microfasteners.com/">Micro Fasteners</a>,
<a href="http://fastmetalproducts.com/">Fast Metal Products</a>, and
<a href="http://www.amazonsupply.com/">Amazon Supply</a>. Micro Fasteners is a good all-around
source for low-cost screws in diameters over 1.5 mm or so; FMP offers decent pricing on fasteners
smaller than that. Last but not least, Amazon Supply (formerly Small Parts) tends to be a tad
more expensive - but Amazon Prime customers get free two-day shipping on every single nut and bolt, so
especially for small orders, it's quite a good deal.
</p>

<p>
The exact selection of fasteners
depends on the projects you intend to pursue, but I recommend starting with a good
assortment of 0.8 mm, 1.5 mm, and 2 mm screws (000-120, 0-80, and 2-56 designations in ANSI UTS,
respectively), 100 pieces each. You should grab the cheapest variety of steel or brass screws, aiming
for lengths around 4, 6, 8, and 15 mm; drive type doesn't matter a lot - could be slotted, Phillips, or
hex. Expect to pay around $2-$5 per 100 pieces for common diameters, and closer to $10-$15 for sizes
under 1 mm. Getting some nuts and washers, especially for 2 mm screws, is not a bad plan - but as noted,
you won't be routinely needing them.
</p>

<p>
You may also want to look into threaded rods, available from sources such as Amazon - the diameter
around 2 mm probably being the most useful. Their more boring use is an extended-reach screw (with one
nut at each end); a more interesting possibility is creating extremely compact and simple linear motion
systems, like so:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/30-worm.jpg">
</p>

<p>
Another possible arrangement is using a motor to directly rotate the shaft. In both cases, the
transmission enjoys a very high ratio, because every turn of the motor moves the nut by a distance
equal to the pitch of the shaft - often in the vicinity of 0.5 mm or so. The downside is poor
efficiency - likely under 20% - due to significant friction under load.
</p>

<p>
<b>Note:</b> when it comes to online retailers,
many hobbyists also love <a href="http://www.mcmaster.com/">McMaster-Carr</a> as a source for screws
and other mechanical components. That said, they are almost always significantly more expensive than 
specialized distributors, and often more expensive than Amazon. They do have good deals on some
otherwise hard-to-find stuff - say, miniature timing belts - but it's more of an exception than a
rule.
</p>

<h4>5.1.2. Dowel pins, rods, and tubes</h4>

<p>
Traditional dowel pins are rather unassuming: they are just pieces of featureless, cylindrical steel,
machined to tight tolerances. For their appearance, they find a truly surprising number of uses: as
axles for spur gears and other rotating parts; as registration pins for molds and multi-part
assemblies; as movement limiters and contact sensors; as serviceable torque couplers; and so on. You
just need to have some - trust me on that.
</p>

<p>
Non-tapered, solid metal dowel pins are available from many sources, including Small Parts / Amazon
Supply, and cost very little - usually in the vicinity of $4 to $8 per 100 pieces. I suggest stocking
up on 2 mm diameter pins in several lengths ranging from 4 to 20 mm. For high-precision work, 1 and 1.5
mm diameters may come handy, too.
</p>

<p>
Dowel pins aside, it's also good to have some vanilla steel rods or tubes: they are very cheap
(usually $1-$2 per meter), and can be cut to size with a hand saw to build anything from
long-reaching axles (left) to fairly complex frames (right, also showing threaded rods used as linear
motion systems):
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/32-axle.jpg">
<img src="https://lcamtuf.coredump.cx/gcnc/31-frame.jpg">
</p>

<p>
Metal bars with rectangular, hexagonal, or L-, I-, or T-shaped cross-sections are particularly useful for
torque transfer, because you can simply slide components onto them, and there is no risk of slippage
under radial load; perfectly round profiles may require the application of glue or the use of a lock screw.
</p>

<h4>5.1.3. Springs and spring wire</h4>

<p>
Similarly to dowel pins, springs have quite a few uses; many of them are obvious (wheel suspension
and other pre-tensioned mechanisms, energy storage, etc), but some aren't. For example, springs
are indispensable for transfering <a href="https://upload.wikimedia.org/wikipedia/commons/thumb/4/48/Helical_U-Joint_%28Beam_Style_Coupling%29_-_Angular_Misalignment.jpg/800px-Helical_U-Joint_%28Beam_Style_Coupling%29_-_Angular_Misalignment.jpg">rotary motion at an angle</a>
- a process that otherwise requires 
complex bevel gears or  <a href="https://en.wikipedia.org/wiki/Universal_joint">universal joints</a>.
</p>

<p>
Perhaps the most common sort is a compression spring: it has generous spacing between its coils, and
is meant to contract under load. You can find them inside many types of pens, spray bottles, and so on.
The other popular type is an extension spring: it is tightly wound, and offers little or no compressive
action - but stretches very well.
</p>

<p>
It's difficult to recommend a particular selection of compression and extension springs up front, but
it's definitely a good idea to have a robust variety always available in your workshop, simply to
prototype stuff easily. Possibly the best and least expensive assortment I have seen so far is
<a href="http://pinballmagic.com/index.php?main_page=product_info&amp;products_id=15">this set</a> - 200 
reasonably sized springs for less than $9;
<a href="https://www.amazon.com/MAXCRAFT-7707-Spring-Assortment-200-Piece/dp/B0037UR6HU/">comparable kits</a>
are also available on Amazon. A great selection of individual springs with specific diameter, pitch,
and length, can be also found on Amazon, usually in packs of 10.
</p>

<p>
Traditional springs aside, you should also grab some spring wire (also known as music wire). It comes
handy for making contact sensors (especially whiskers!), for creating simple tensioners, and 
for designing other devices where you want to use a straight piece of elastic material to deflect
effortlessly, and then spring back to its original shape. There are many low-cost assortments you can
find on the Internet - and as usual,
<a href="https://www.amazon.com/Small-Diameter-Music-Wire-Asst/dp/B001J6AHCA/">Amazon isn't bad</a>.
</p>

<h4>5.1.4. Ball bearings</h4>

<p>
There are many situations where it is desirable to constrain rotary movement to a particular axis of
rotation, and support it so that the part doesn't wiggle back and forth, or snap under load. Sleeve
bearings are the simplest solution: you can route the rotating part through a round, slightly oversized
opening, and perhaps use a bit of grease to minimize friction.
</p>

<p>
Alas, this approach has its limits: if the part is rotating very quickly, or if it's subject to
significant radial forces, sleeve bearings will result in significant power losses or excessive wear.
In particular, sleeve bearings for propellers and wheels may have a very limited lifespan.
</p>

<p>
Because of this, you should get a decent assortment of 
<a href="https://en.wikipedia.org/wiki/Ball_bearing">ball bearings</a>, and use them when appropriate.
There are many sources of bearings on the Internet, but most of them tend to be pricey; 
<a href="http://www.vxb.com/">VXB.com</a> is a notable exception to this rule. They ship
internationally and have an amazing selection of 10-, 20-, 30-, or even 100-packs at sensible prices -
often hovering around $1 to $1.50 per piece. Some comparably good or even better deals can be found in the
<a href="http://www.bocabearings.com/webstoredetail.aspx?StoreID=1">$0.99 discount bin</a> or the
<a href="http://www.bocabearings.com/webstoredetail.aspx?StoreID=32">10-pack-section</a> of Boca
Bearings, too - although their "regular" prices are higher than VXB.
</p>

<p>
Some of my favorite bearing sizes (ID x OD x H) are: 3x6x2 mm (<a href="http://www.vxb.com/page/bearings/PROD/3mm/Kit142">link</a>, $1 a piece,
only for miniature projects); 6x10x3 mm (<a href="http://www.vxb.com/page/bearings/PROD/MR106ZZ">link</a>,
$1.50); 8x12x3.5 mm (<a href="http://www.vxb.com/page/bearings/PROD/8mm/MR128ZZ">link</a>, $1.50); 
and 8x16x5 mm
(<a href="http://www.vxb.com/page/bearings/PROD/8mm/Kit299">link</a>, $1). For larger projects, 8x22x7 mm
bearings are a bargain, too - 
trading for about 50 cents a piece or less (<a href="http://www.vxb.com/page/bearings/PROD/8mm/608ZZ10">link</a>).
</p>

<p>
If you don't have any specific designs in mind, but plan to work on small to medium-scale projects, grabbing
a set of 6x10x3 mm or 8x12x3.5 mm bearings is not a waste of money.
</p>

<h4>5.1.5. Gears and timing belts</h4>

<p>
When building precision mechanical assemblies, it is usually much more convenient (and a lot
cheaper) to make your own gears than to source them online. Part of the reason for this is that
most of the time, you will want to use compound gears with very specific diameters, heights, tooth
counts and ratios, axle bore sizes, and so on. Chances are, you won't be able to find just the right
ready-made options online, at least not on the cheap.
</p>

<p>
Timing belts are a different story, in part because they are tend to be simpler. Whether you need timing
belts is a good question; they do offer an alternative form of gearing in applications where other solutions
are inconvenient to use because of size constraints or the distances involved. For example, they may offer
a space-saving way to couple a motor to a wheel without reducing ground clearance. Another popular use
is in linear motion systems, where they can acutate any assembly clamped to the belt (and
mounted on some sort of a rigid slide to keep it from flopping around).
</p>

<p>
Historically, timing belts used to be fairly expensive and difficult to source in
miniature sizes, but this has changed over the past few years. One of the best sources for
small timing belts, many for around $1.50 a piece, is 
<a href="http://www.mcmaster.com/#timing-belts/=vq53hm">McMaster-Carr</a>; check out the
MXL series for some very good picks. Some of their smallest ones are just about 10 mm long and 3 mm
wide.
</p>

<p>
Timing belts run quiet and have very little backlash, but they are less durable and less rigid than
plastic gears; they may be somewhat less efficient, too.
</p>

<h3>5.2. Robot-related electronics</h3>

<h4>5.2.1. Motors</h4>

<p>
The selection of motors at your disposal is definitely the single most important factor affecting the
ability to bring your electromechanical designs to life. It's also something very easy to get wrong - or
get right, but grossly overspend on.
</p>

<p>
It is probably safe to assume that you are interested primarily in small, low-voltage DC motors; if so,
the choice is roughly as follows:
</p>

<ul>

<li><p><b>Vanilla brushed motors:</b> the traditional variety, with rotating electromagnets and a mechanical
commutator that powers them up in a particular sequence. The most important advantage of this class of motors
is the broad availability of many different form factors, often at ridiculously low prices ($1-$2). That
allows you to buy them by the dozen, and helps with rapid prototyping.</p>

<p>
Unfortunately, these motors operate efficiently only at very high RPM, and deliver fairly low torque,
requiring the use of external gearboxes in almost every application; such gearboxes aren't difficult to make,
but they add some complexity. The motors are also electrically noisy, and their lifespan is limited by the wear of
commutator brushes - an issue in continuous-duty applications.</p>

</li><li><p><b>Geared motors:</b> these typically consist of a small brushed motor coupled to an integral gearbox that
reduces output RPM, and brings the torque up to a more useful range. They usually operate with decent efficiency
(85-95%) and offer transmission ratios of 20:1 to 400:1 or so.</p>

<p>
The main trade-off is that many of the lower-cost plastic gear transmissions are flimsy and rather unwieldy, so
in many applications, it may be more desirable to create them yourself; higher quality
alternatives, and planetary gearboxes in particular, often fetch as much as $20-$150.
</p>

<p>
As a rule of thumb, it makes little or no sense to buy anything that
<a href="http://content.solarbotics.com/products/images/gm2/gm2_pl.jpg">looks like this</a>; 
microminiature <a href="http://www.allproducts.com/manufacture97/flyingltd/product1.jpg">metal gears</a>
are a usually better investment, and if you look around, you may be able to find them under $8 a pop.
</p>

</li><li><p><b>R/C servos:</b> affordable motors in this category usually consist of a geared motor coupled to a gearbox,
a potentiometer attached to the output shaft, and a small integrated circuit that uses this feedback loop to
maintain a position requested by the external microcontroller. The huge advantage of servos is the ease of
use: they eliminate the need for additional sensors, H-bridge drivers, and other widgets normally involved in
the control of a regular motor.</p>

<p>
Unfortunately, most of the low-cost servos are pretty bulky - a brick about 4-5 times the size of the actual motor
within; most of them are also not capable of performing 360° turns, owing to the design of the internal
potentiometer. On top of that, most of the plastic-geared servos are somewhat fragile - the sale of replacement
gears is an industry of its own.
</p>

</li><li><p><b>Vanilla brushless:</b> brushless motors deal away with mechanical commutation, and instead, have
a rotor with permanent magnets, surrounded by stationary electromagnets that are switched electronically in
a specific sequence. They are more durable than their brushed counterparts, and because of improved heat dissipation,
occupy a smaller, more lightweight envelope.
</p>

<p>
The key challenge with brushless motors is that they require precise external control to operate with good efficiency,
often incorporating current sensors or Hall effect detectors; this adds cost and complexity. The other issue is that
almost all the commonly available brushless motors are designed for high-current, high-performance applications, such
as model aircraft - and with their extreme speeds and power demands, they are not particularly well-tailored for
projects with more modest needs.
</p>

</li><li><p><b>Stepper motors:</b> steppers are similar to brushless motors, but use a different rotor design with multiple
densely packed poles; this makes the motor turn only by a small, precisely defined degree every time one of the coils
is switched (7.5° or 15° is common in small motors; 1.8° in larger ones). There is no position sensing; their
high-resistance coils are designed to let them hold a particular position without overheating,
but limit their ability to operate at high speeds (their efficiency drops rapidly past perhaps 300 RPM or so).
</p>

<p>
The primary advantage of stepper motors is their high precision, ease of operation, and competent performance at
relatively low speeds, suitable for directly operating many types of mechanical assemblies. Their disadvantage is
that they are essentially a constant-current device, sinking the same amount of power when freewheeling and
under load.
</p>

</li><li><p><b>Exotic actuators:</b> somewhat disappointingly, there aren't that many alternatives to plain old motors.
Linear actuators are interesting, but typically prohibitively expensive ($100 and more). Solenoids, often used in door
locks, are pretty cheap, but usually of limited utility. Lastly, "muscle wire", a material that contracts slightly
(5% or so) when heated up by the flow of electric current, may sound cool - but because of the small displacement and 
fragility, it's more of a novelty than a practical tool.</p>

</li></ul>

<p>
As you can see, there is no perfect solution. I personally prefer sticking to vanilla brushed motors and
creating my own gearboxes, but if your patience can wear thin, servos or geared motors may be a better choice.
For any of these motors, you should definitely look at the following characteristics when shopping around:
</p>

<ul>

<li> <p><b>Maximum rated voltage:</b> every motor is designed for a particular maximum voltage, past which it may
overheat or blow up in some other fashion. You can operate any motor at as little as 20% of its rated voltage - but in
such a case, you will be hauling around a lot of dead weight in the form of windings, magnets, and so on, that are
grossly oversized and serve no useful purpose.</p>

<p>
In general, motors rated for somewhere between 3 and 9V are probably of most use in small- to medium-size projects,
owing to the availability of affordable batteries and power-switching transistors compatible with these voltages.
Going beyond 12V can be expensive, and is best avoided unless you are building something big.</p>

</li><li> <p><b>No-load RPM and stall torque:</b> these two parameters describe the behavior of the motor at two extremes: its
speed when freewheeling with no load, and the turning force needed to effectively stop the motor in its tracks. In both
of these cases, the motor is not doing any useful work, and its efficiency is zero. In between, the dependency between
RPM and torque is roughly linear: with a load equal to 80% of the stall torque, the RPM will hover around 20%.</p>

<p>
This dependency may suggest that instead of using complex gears, it may be possible to simply operate the motor with
a carefully tuned load of 95%, thus reducing its speed down to 5%. Unfortunately, this is usually a bad idea. 
In essence, every motor has a specific efficiency curve - and for low-power DC motors, it typically looks
<a href="http://www.electro-craft.com/img/products/pmdc/torque_dp30-75.gif">like this</a>: the device is most efficient
when the load is around 20%, and the performance drops off somewhat linearly past this point, eventually reaching
0% at stall. Therefore, in any application where power consumption and heat dissipation are of concern, it's good to
operate the motor at somewhere between 5% and 50% of its maximum load most of the time; outside that range, you're
just heating the air.
</p>

<p>
To understand what you will be getting out of a specific motor, and to compare different products, it is often useful
to compute their normalized torque: the torque they will be able to deliver when paired with a gearbox that brings their speed
to a particular value (say, 100 RPM). Assuming that you are aiming for a load of 50%, and that the gearbox has an efficiency
of 85%, the formula will be:
</p>

<p>
<code>normalized_torque = (stall_torque * 50%) * (idle_RPM * 50%) / 100 * 85% = stall_torque * idle_RPM / 470</code>
</p>

</li><li> <p><b>Stall current:</b> this parameter should help you size the power supply and all the associated driver circuits.
When multiplied by the supply voltage and compared to normalized torque, it may be helpful for comparing the efficiency of
various motors, too.</p>

</li><li> <p><b>Dimensions:</b> all things being equal, the smaller the better - but form factors matter, too.
Long but slim motors are preferable for wheeled robots, as they result in optimum ground clearance when placed inline
with or near the axle; while pancake-shaped motors with a large diameter but short length are much better when you need to
cram them inside an articulated joint in a legged robot without anything sticking out.</p>

</li></ul>

<p>
Possibly the best source to find a great assortment of low-cost brushed motors (both vanilla and geared) is 
<a href="http://store.kysanelectronics.com/">Kysan Electronics</a>; they have a $100 minimum on all online orders, but 
seem to be willing to make exceptions if necessary. Good deals can be also sometimes found at various surplus outlets,
including <a href="http://www.allelectronics.com/">All Electronics</a>,
<a href="http://www.goldmine-elec.com/">Electronic Goldmine</a>,
<a href="http://www.surplusshed.com/">Surplus Shed</a>,
<a href="http://www.bgmicro.com/">BG Micro</a>, or
<a href="http://www.halted.com/">HSC Supply</a> - but their inventory can change rapidly, so your mileage may vary.
Last but not least, for servos and brushless motors, 
<a href="http://www.hobbyking.com/hobbyking/store/index.rc">Hobby King</a> is hard to beat - they ship from
Hong Kong, but do so promptly and cheaply; on orders under $200 or so, you are unlikely to run into import duties.
</p>

<p>
Whatever you do, I'd recommend avoiding robotics-oriented sources such as
<a href="http://www.solarbotics.com/">Solarbotics</a>,
<a href="http://www.roboticsconnection.com/">Robotics Connection</a>,
<a href="http://www.pololu.com/">Pololu</a>,
<a href="http://www.acroname.com/">Acroname</a>, and many more. They are good people, but they usually sell exactly
the same low-cost motors, and simply charge you more for the privilege of shopping with them. Case in point:
<a href="http://www.robotcombat.com/products/0-MICROM2.html">this motor</a> costs $23 when bought from Robot Marketplace,
or $16 when you go to Solarbotics - but Kysan Electronics carries it for $8 a piece... or just $3 on orders over 1,000
(which is probably the price that the first two shops have paid).
</p>

<p>
In any case, it makes sense to find 2-4 models that are best suited for your needs, and then buy 10-20 pieces of
each; having a steady supply of well-performing motors beats having one or two of every mediocre product
available on the market. My personal recommendations are:
</p>

<ul>

<li><p><b>Vanilla brushed:</b></p>

<ul>

<li> <p><a href="http://www.alltronics.com/cgi-bin/item/22M006S/37/Mini-Motor-08260-Pkg-of-10">Mabuchi FF-N20PN ("8117" or "8721")</a> ($1.00): one of the tiniest
motors I found that can still pack a punch (pager motors are smaller, but offer negligible torque). Diameter of 10 / 12 mm, length of 15 mm. When operated at
3V, it idles around 13,000 RPM, and delivers about 15 g*cm of stall torque - drawing 1.3A at that point. Great for miniature projects.</p>

<p>(That motor seems to be hard to find these days; FF-N20PA-11155 motors available from <a href="http://store.kysanelectronics.com/">Kysan</a> are
a close match, but cost a bit more - just under $2.)</p>

</li><li> <p><a href="http://store.kysanelectronics.com/servlet/-strse-70981/RF-dsh-356CA-dsh-10250/Detail?sfs=dc55c003">Mabuchi RF-356CA-10250</a> ($2.20):
a reasonably powerful pancake-shaped motor for all-around use. Diameter of 24 mm, 8 mm long. About 11,000 RPM, 40 g*cm, 600 mA at stall when running at 6V.
<a href="http://store.kysanelectronics.com/servlet/-strse-68210/RF-dsh-300FA-dsh-12350/Detail">RF-300FA-12350</a> is a cheaper alternative, but it's 4 mm
longer and has a lower speed.</p>

</li><li> <p><a href="http://www.kysanelectronics.com/Products/Detail.php?recordID=5327">Mabuchi FF-130SH-14230-6V</a> ($1.90): an elongated all-purpose motor
that delivers 13,000 RPM when idling, and stalls around 115 g*cm, drawing 1.3A, when operated at 10V. Diameter of 15.5 / 20.5 mm, length of 25 mm. 
A comparable but slightly larger 12V alternative is <a href="http://www.bgmicro.com/index.asp?PageAction=VIEWPROD&amp;ProdID=12295">Canon EN22</a>.</p>

</li></ul>

</li><li><p><b>Spur geared motors:</b></p>

<ul>

<li> <p><a href="http://www.kysanelectronics.com/Products/Detail.php?recordID=6154">Sanyo 12GN-0348-NA3S</a> and 
<a href="http://www.kysanelectronics.com/Products/Detail.php?recordID=5991">12GN-0348-NA4S</a> ($7.50): two cheap, robust, extremely small
metal gear motors delivering about 2,200 g*cm (NA3S) and 3,500 g*cm (NA4S) of stall torque, and idling around 100 and 70 RPM, respectively. Both run
at 6V. Their tiny dimensions make it worthwhile: they measure just 12 x 10 x 25 mm.</p>

</li></ul>

</li><li><p><b>Stepper motors:</b></p>

<ul>

<li> <p><a href="http://www.goldmine-elec-products.com/prodinfo.asp?number=G14197">Symbol Technologies 21-02485</a> ($1.00): about 20 mm wide and 12
mm thick; a 5-wire hybrid that is best operated in bipolar mode (where the polarity of the windings needs to be reversed, necessitating the use
of H-bridge drivers), and runs fine at 9V. 15° per step, 100 mA per coil, around 40 g*cm of torque. Unfortunately, appears to be out of stock
right now.</p>

</li><li> <p><a href="http://www.halted.com/commerce/catalog/product.jsp?&amp;product_id=13244&amp;czuid=1250276405659">Epson STP35NI48SV50</a> ($3.00): a larger
stepper motor, 35 mm wide and 12 mm thick. Unipolar operation (can be controlled with a couple of transistors),
7.5° per step, 12V, 250 mA per coil, around 220 g*cm of torque.</p>

</li></ul>

</li><li><p><b>Servos:</b></p>

<ul>

<li><p><a href="http://hobbycity.com/hobbycity/store/uh_viewItem.asp?idProduct=5458">Mini Man 4.3</a> ($3.50): a really cheap, miniature 6V
servo of acceptable quality, delivering around 500 g*cm of stall torque. Its speed is about 10 RPM with no load.</p>

</li><li><p><a href="http://hobbycity.com/hobbycity/store/uh_viewItem.asp?idProduct=662">Hextronik HXT900</a> ($2.65): more powerful,
slightly larger servo - 1,600 g*cm at stall, 40 RPM under no load, runs off of 6V. Very popular with hobbyists.</p>

</li><li><p><a href="http://hobbycity.com/hobbycity/store/uh_viewItem.asp?idProduct=3743">Hextronik HXT5010</a> ($4.50): a larger, ball bearing servo 
capable of delivering about 6,500 g*cm at stall. It's slow - 8 RPM with no load at 6V. Reportedly can be modified to rotate 360°.</p>

</li></ul>

</li></ul>

<p>If you need inspiration, here's a video of Mabuchi FF-N20PN powering a miniature planetary gearbox:</p>

<p>
<iframe width="640" height="360" src="https://www.youtube.com/embed/0i2Qr23uWjg?rel=0" frameborder="0"></iframe>
</p>

<h4>5.2.2. Useful sensors</h4>

<p>
Sensors are essential in almost any electromechanical design, helping interact with the outside world, and providing
internal feedback about the state of mechanical assemblies. This section covers some of the most useful, low-cost
choices to consider in your work:
</p>

<ul>

<li><p><b>Tactile switches:</b> simple, small, cheap, and very versatile. When placed behind an elastic bumper, they can work as a wall
sensor for wheeled robots; in conjunction with rubberized foot or a floating axle, they can sense contact of the robot body
with the ground; and when used as a movement limiter, they are useful for detecting the "home" position of many assemblies.</p>

<p>A wide selection of microswitches in all shapes and sizes is available from <a href="http://www.mouser.com/">Mouser</a> and from other major electronics
outlets. Pricing starts at $0.10 or so a piece when bought in reasonable quantities; be sure to look at dimensions, trigger
force, and button travel. In most cases, it makes sense to stock up on the smallest, low-profile non-SMD switches you can find - for example,
Mountain Switch 101-TS4311T1601-EV ($0.20). Larger ones - such as ALPS SKHCBFA010 ($0.30) - may be useful when a greater pressure-sensitive area is desired.</p>

</li><li><p><b>Photointerruptors:</b> extremely useful for non-contact position sensing when you don't want to obstruct
the motion of a component. They work by shining an IR LED on
the element, and then measuring the reflected or transmitted light with a phototransistor. My favorite is a tiny, wide-slot
Toshiba TLP841 ($0.40); for reflective applications, Optek OPB609AX ($0.55) may come handy, too.</p>

</li><li><p><b>Mechanical rotary encoders:</b> these can be used to measure the angular position of an assembly. They use mechanical coupling, and therefore
add some friction - but often offer a convenient alternative to optical sensing. Linear sensors, such as ALPS RDC803001A ($1.50), leverage a heavy-duty rotary
potentiometer with several taps; pulsed devices, such as Mountain Switch 101-5433-EV ($0.55), simply alternate between closed and open circuit at predefined angles,
commonly producing 12 or 24 pulses per turn. Only linear sensors will provide the absolute position, but they cost more, and require an A/D converter to interpret
the data.</p>

</li><li><p><b>Magnetic field sensors:</b> solid-state Hall effect sensors such as Honeywell S41 ($0.50) can work very much like a photointerruptor, but will sense the position of
a tiny permanent magnet embedded in the rotating element; their primary benefit is much lower power consumption, and the fact that they can "see" through
opaque materials, enclosures, and so forth.</p>

</li><li><p><b>Distance sensors:</b> these can be positioned either in a fixed location on the robot body, or rotated to sweep the environment in a manner similar to a 
radar - creating a 2D image that is a lot more more useful than the data that can be acquired with a digital camera, especially if you don't have too much
computing power to spare. The two most common rangefinding options are
infrared and ultrasound. Infrared sensors are cheaper, but have a limited sensing range, and may be considerably less effective in very bright light (e.g., outdoors);
Sharp GP2Y0A02YK is probably the most interesting option here, selling for under $15. For ultrasound, you must be prepared to pay a bit more; for example,
<a href="http://www.maxbotix.com/BUY_NOW.html#LV-EZ">MaxBotix LV MaxSonar EZ2</a> fetches around $25.</p>

</li><li><p><b>Digital compasses:</b> these may be useful in robots that need to maintain precise registration with the environment over extended periods of time.
You can choose from specialized solid-state Hall effect sensor ICs, such as Honeywell HMC1051; and regular Hall effect sensors that monitor the position of
a traditional compass needle (an example of that is <a href="http://www.robsonco.com/Dinsmore/">Dinsmore</a> 1490 or 1655). Expect to pay $10 to $40.</p>

</li><li><p><b>Other fancy sensors:</b> some designs - especially flying robots - may benefit from accelerometers, such as MMA8453QT ($1.40); flex sensors; heat sensors;
inclinometers; tilt switches; microphones; digital cameras; or GPS units. That said, these are usually selected for a specific application, and there is no
need to keep a continuous stock.</p>

</li></ul>

<h4>5.2.3. IC glue and MCUs</h4>

<p>
If you have a favorite brand of microcontrollers, there is probably no need to revisit this topic; but if you are looking for advice, it's
pretty hard to go wrong with AVR chips such as <a href="http://www.atmel.com/dyn/resources/prod_documents/8272S.pdf">ATmega1284P</a> ($8). This particular 8-bit MCU,
for example, operates at speeds up to 20 MHz (internal oscillator is provided), has 128 kB of Flash memory for program storage, 16 kB of data memory (SRAM), and 4 kB of
non-volatile EEPROM. It's essentially a complete computer-on-chip, complete with 32 bidirectional I/O lines, 8-channel 10-bit ADC, hardware PWM channels - all that supporting
a wide range of supply voltages, from 1.8 to 5.5 V; there are precious few external components required to operate it in most real-world applications. ATmega chips have
a mature GCC-based toolchain with tons of useful libraries, a nice emulator, and a pretty good IDE - and unless you are doing complex image processing or working
on something else data-intensive, they will serve you well. (In more demanding tasks, you may need to spend quite a bit more on 32-bit ARM or AT32 chips; I also
like <a href="https://lcamtuf.coredump.cx/edison_fuzz/">Intel Edison</a>.)
</p>

<p>
For ATmega, the only other
gadget you need is a simple USB ISP dongle (e.g., AVRISP mkII), costing somewhere between $15 and $30 - and even that can be avoided if you opt for a chip
with a built-in USB controller.
</p>

<p><b>Note:</b> some people love AVR-based development platforms such as Arduino or Teensy. I am personally wary of these boards, because I find them to offer very few
real benefits over the AVR chip itself; you are essentially charged a 1000% markup in exchange for someone soldering the chip to a PCB, and then adding several components
that are completely unnecessary in many uses, but make it look sophisticated (e.g., voltage regulators, external crystals).
</p>

<p>
Especially when developing more complex software, you may find it useful to add a way for the MCU to communicate essential information in an easily readable way. Tethering
it to a computer is one option, but you may also consider getting an LCD module based on a well-known HD44780 chip; for example,
<a href="http://www.mouser.com/ProductDetail/Newhaven-Display/NHD-0216K1Z-NSB-FBW-L/?qs=3vk7fz9CmNydHYG0vAPIRw%3d%3d">NHD-0216K1Z-NSB-FBW-L</a> ($11) is a very user-friendly
device with ample display space.
It can be controlled with as few as 6 data lines, and is pretty trivial to interface with - its dedicated controller maintains its own display memory, and even
stores editable font data and track of the cursor for you, so you just have to send ASCII data to the appropriate port.
</p>

<p>
In addition to the MCU itself, you should also have a good assortment of standard "glue" chips that are useful for example in multiplexing and demultiplexing applications,
and will allow you to extend the I/O capabilities of your chip almost arbitrarily. Probably the best IC family to stick to is 74HC - they are widely available and fairly
cheap ($0.10 - $0.35 per chip), and offer respectable speeds and good load driving capabilities. You may want to grab basic logic gates 
(74HC00, 02, 04, 08, 32, 86 - NAND, NOR, NOT, AND, OR, and XOR respectively); line drivers (74HC240, 241, or 244);
multiplexers, demultiplexers (74HC164, 165); line selectors (74HC137, 42, 151); and flip-flops / latches (74HC175, 75, 259). Some projects may also have uses for
counters, timers (e.g., 7555), external oscillators, assorted op-amps, etc.
</p>

<p>
About the only thing you can't do with all these parts is driving any power-hungry loads, such as motors: the tiny transistors inside
most MCUs and 7400 series chips can output at best around 20-40 mA per line - enough for a LED or two, but not much more. It is possible to use discrete power
MOSFETs (e.g., BUK7510) to control high-current devices, but doing so is
not always space- and cost-efficient - so you may want to look into IC-based motor drivers. FAN8082 is probably the cheapest ($0.40) full H bridge (i.e., bidirectional)
driver capable of delivering up to 1.5A at 18V to brushed motors and bipolar steppers; it even comes with rudimentary speed control. The disadvantages of this chip are
its reltively high voltage drop (almost 2V), and the fact that it doesn't support "freewheeling" (high impedance) mode. Somewhat more expensive TA7291P ($0.90, 2A peak 
at 20V) supports all four output states: forward, reverse, brake, and freewheel; TLE52052 chip ($3.50, 6A peak at 40V) can drive even
larger motors with ease. Several dozen similar products exist - shop around, and grab at least around 10 pieces or so.
</p>

<p>
For driving unipolar steppers, solenoids, and other power equipment where you don't need to change polarity, you can also save some money by going with simpler
devices: ULN2003 ($0.30) can drive up to 6 devices at 500 mA and 50V (or one device at 3A); while ULN2065 ($2) has four outputs capable of delivering 1.5A at 35V,
adding up to 6A total.
</p>

<h4>5.2.4. Power sources, watchdogs, regulators</h4>

<p>
About the last major set of electronic components that you need to think about are the power sources you will be using in your work.
To make the right call, you need to consider several factors:
</p>

<ul>

<li> <p><b>Nominal voltage:</b> in most cases, you should use a power source that provides perhaps 10-15% more than the voltage required by the most power-hungry
components of your design - and that's usually the motors. In general, somewhere between 3.5 and 11 V is ideal.</p>

</li><li> <p><b>Capacity:</b> try to estimate the power needs of your circuit, and aim for something that would give you a sensible run time on a single charge. For example,
if you are expecting to sink 100 mA on average, you will get up to 8 hours out of any 800 mAh cell.</p>

</li><li> <p><b>Peak current / ESR:</b> make sure that the cell can accommodate the expected peak current draw of your device, with a generous safety margin. This matters: for
example, a typical 9V battery will typically source no more than 1A - and once you exceed that, the voltage will drop dramatically.</p>

</li><li> <p><b>Weight and dimensions:</b> there are substantial differences in power density between various cell types, so pay close attention to these characteristics,
especially if you are trying to build something lightweight.</p>

</li></ul>

<p>
Today, the best all-around option for robotics are rechargeable lithium-polymer cells, simply because of an excellent balance between capacity, weight, and cost. My
favorite source is <a href="http://hobbyking.com/hobbyking/store/uh_index.asp">Hobby King</a>. They have good products, and although they are in Hong Kong, they
ship cheaply, quickly, and with no hassle whatsoever. If you browse their site, you can find a 7.4V 5 Ah cell, weighing around 300 g, for about $25; a smaller 1.6 Ah
cell fetches $10 and tips the scales at 90 gram; while a tiny 800 mAh one weighs barely 50 g and costs $5.
</p>

<p>
Of course, nothing comes free: lithium batteries have two drawbacks that you should know about. First of all, if they are charged improperly or badly damaged, they can
overheat and catch fire - so you need to store and handle them with some care. The other issue is that they shouldn't be discharged past a certain minimum voltage to
avoid altering their chemistry; using a voltage cut-off IC, such as MAX8211 or MAX8212, is a very good idea.
</p>

<p>
Of course, there are many alternatives to Li-poly; a typical AA battery is nothing to sneeze at, and delivers up to 3 Ah, with peak current as high as 10A; your usual
9V battery is closer to 500 mAh and can't source more than 1A. If weight is not an issue, you can also go with lead-acid batteries, of course: they are cheap, but
weight a ton ($20 will get you 15 Ah at 6V, but be prepared to haul around 2 kg). Ultracapacitors are also of some interest in recent years - but right now, they 
tend to be fairly expensive, especially if you are interested in supply voltages over 2.5V or so. Last but not least, solar cells deserve a honorable mention -
although similarly to ultracapacitors, they are not that practical in everyday uses. Because of their lamentable power capabilities in function of their size, they are
useful mostly as a way to conveniently recharge a chemical battery or a capacitor, and not as a continuous primary supply.
</p>

<p>
Oh, one more thing: for prototyping, I recommend grabbing an adjustable benchtop power supply, such as
<a href="http://mastechpowersupply.com/dc-power-supply/linear-power-supply/mastech-regulated-variable-dc-power-supply-gps-3030d-30v-3a/prod_62.html">Mastech GPS-3030D</a>
($90); convenience of being able to quickly adjust voltage aside, their huge benefit is that you can limit the current to a safe value, so that an accidental short-circuit
will not destroy everything in its path. The same can't be said about most batteries.
</p>

<div>
<p>
<span><b>Tip:</b></span> the reason why you should match the supply voltage with the most power-hungry components in your circuit is that high-current
DC voltage adjustments can be pretty tricky. It's easy to lower the voltage supplied to a low-current device, such as a microcontroller or a couple of LEDs: just
grab a linear regulator such as LM317T ($0.25) or L7805 ($0.50) and be done with it. For efficient regulation of higher currents, or for stepping the voltage up, you
generally need switched regulators, however.
</p>
<p>
Such regulators are fairly complicated to build on your own, and get expensive if you want a plug-and-play solution. For example,
ICL7660 - a chip that can handle up to 20 mA - goes for $2; Murata OKR-T3-W12-C - a hybrid device that can deliver up to 3A - retails for $7; and a
6A variant of the same Murata product will fetch $14. 
</p>
</div>

<h4>5.2.5. Other components</h4>

<p>
Well, it goes without saying that you will also need an assortment of generic electronic components to get anywhere: make sure that you have
a bunch of resistors and capacitors, a handful of PCB mount potentiometers, some medium-power MOSFET transistors (n- and p-channel), a 
good selection of terminal blocks and ribbon connectors, a solderless breadboard or two for prototyping, perforated boards in various sizes,
and so on. In fact, if you need any help with selecting the right components and using them in a circuit, check out my
<a href="https://lcamtuf.coredump.cx/electronics/">short primer on electronics</a> in your spare time.
</p>

<p>
What else? If you want to make your own PCBs for finished projects, you can of course print and etch them - although keep in mind that it's also quick and easy - and often more precise
- to machine them on your CNC mill: you can simply selectively remove copper plating from a blank board with a cutter - and drill mounting holes at the same time.
</p>

<p>
And of course, don't forget about installing a conveniently located and obvious self-destruct switch!
</p>

<!-- START~6~Practical part geometries~ -->

<h2><a name="6">6. Practical part geometries</a></h2>

<p>
To wrap up the discussion of technical topics, let's go over a collection of practical approaches
that should help you create useful and reliable mechanical designs for small- to medium-sized projects
- no matter if you are using CNC
machining, 3D printing, or still carving stuff in stone. The failure to get even the most rudimentary
understanding of these topics is one of the cardinal sins of hobbyist makers - so don't let this
happen to you.
</p>

<h3>6.1. Basic part design tips</h3>

<p>
The mathematics of material engineering are fairly obtuse, and the finite element modeling software that
can be used to model the dynamic behavior of real-world part geometries is prohibitively expensive.
Nevertheless, if you are designing small- to medium-scale components and can afford to learn from mistakes
every now and then, there is a couple of simple rules of thumb you can follow to get great results without
resorting to any of that.
</p>

<p>
(You can also find quite a few good engineering tips on
<a href="http://www.instructables.com/id/How-to-Build-your-Everything-Really-Really-Fast/">this page</a>.)
</p>

<h4>6.1.1. Rigidity management</h4>

<p>
Perhaps the most profound cognitive dissonance you can experience during your first adventures in
DIY manufacturing is making the first part that happens to be long, thin, and flat. Let's say you
grabbed IE-3075 and cast a piece that is 2 mm thick, 1 cm wide, and 15 cm long; you will be probably
impressed by how difficult it is to break this sample - but also shocked by how easily it deflects.
It just doesn't seem to make any sense: the datasheet says that the material is ought to be 50%
more rigid than the plastic used to make Lego bricks, and several times less flexible than the
commodity plastics used in everything from toaster ovens to computer cases. But your toaster doesn't
flex nearly as much, right?
</p>

<p>
To understand what's going on, consider what would happen if you applied the same bending force to the
side of the part, rather than the top:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/33-deflection-dir.jpg">
</p>

<p>
If you do that, you won't be able to flex the part even the slightest bit. The cross-section of
the material is still the same - 2 x 10 mm - but all of sudden, it is a lot more willing to
resist your efforts.
</p>

<p>
That's because flexing the material amounts to stretching the polymer chains
farther apart on one side of the part, and squeezing them close together on the other end.
If the material is thin, the effect is relatively modest, and you don't need to invest a lot
of energy to make it happen. For thicker segments, the displacement is a lot more dramatic, however:
</p>

<p><img src="https://lcamtuf.coredump.cx/gcnc/34-deflection.jpg"></p>

<p>
The effect is pretty significant. 
Simplifying slightly, the rigidity of the part is proportional to the width of the sample - but
to the cube of its thickness.
</p>

<p>
This behavior brings us to the manufacturing trick that is being used in almost every item made out of
plastic or sheet metal - including toasters and Lego bricks. In essence, you can greatly improve rigidity
by increasing the maximum span of the part in the direction subjected to bending loads - without adding
any significant bulk. The most common approach is the addition of a couple properly oriented ribs:
</p>

<p><img src="https://lcamtuf.coredump.cx/gcnc/35-ribs.jpg"></p>

<p>
The average thickness of the part - and thus its weight or the amount of plastic used
- hasn't changed significantly. But because  each of these ribs contributes to rigidity in proportion to
the cube of their height, their impact is more significant than it may seem.
</p>

<p>
The following picture is a good example of the use of ribs to control the rigidity of a thin-walled
chassis of a medium-size robot. Note how the ribs are routed around any locations where additional
clearance is required, and not interfere with the mechanical design. In fact, they probably improve
the overall aesthetics:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/36-ribs-use.jpg">
</p>

<p>
It is also possible to achieve the same effect without having to introduce any "standalone" ribs; for
example, if the part uses curved surfaces or happens to have outer walls, this can provide a comparable
degree of reinforcement:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/36-curvature.jpg">
</p>

<p>
Properly reinforced thin-walled parts weigh less, cost less, provide more
clearance for other components, exhibit much less shrinkage - and often simply look better. Because of
this, try to learn and use these approaches as often as possible. Stick to 1 to 1.5 mm as a baseline wall
thickness for all the larger parts - especially for chassis components, covers, etc - and just sprinkle
them liberally with ribs, gussets, and other features of this sort. A handful of ribs extending 2-4 mm
from the surface of the part is usually all you need to make it work.
</p>

<h4>6.1.2. Stress distribution</h4>

<p>
So far, we've talked about the need to reinforce thin, long, planar surfaces; but there is one more
situation where a small amount of extra plastic routinely saves the day.
</p>

<p>
From the discussion of casting resins earlier in this guide,
you may recall that the resistance of these materials to non-uniform loads (e.g., tearing) is
dramatically lower than the ability to withstand uniformly distributed stress. For this reason, 
you should pay close attention to sharp corners, jagged edges, holes, and similar features in
locations subjected to significant loads - and incorporate simple reinforcements to ensure that
the stress isn't concentrated in any single spot.
</p>

<p>
For example, when designing a coupling for an axle that may be subject to strong radial forces and
shock, adding a fillet or a couple of load-bearing gussets can save the day; all other things being
equal, the "vanilla" approach shown on the left is much more likely to fail:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/37-stress.jpg">
</p>

<p>
Given the negligible cost of these features, it typically makes no sense to spend too much time
trying to figure out in which exact spots they happen to be absolutely necessary. Whenever it is
clear that a localized stress may occur, throwing in a rib, a gusset, or a fillet is simply a good
plan.
</p>

<h4>6.1.3. Fitting tolerances</h4>

<p>
Another problem that a novice designed may bump into is the question of fitting tolerances: when
one part needs to mate with another, what should their respective dimensions be to form the desired
type of fit?
</p>

<p>
The correct answer depends on a number of factors, including the accuracy of your CNC mill, or the
operating conditions of the assembly (temperature, risk of contamination, running speed). Nevertheless,
when working with a reasonably accurate milling machine and dealing with normal circumstances, the
following rules of thumb tend to work pretty well for rigid plastics:
</p>

<ul>

<li> <p><b>Snug fit:</b> if you want the parts to mesh tightly - for example, to be glued or fastened
together - make the opening exactly the same size as the mating part.</p>

</li><li> <p><b>Interference fit:</b> if you want the parts to hold together without any additional
fastening, you can undersize the opening by about 0.01 to 0.02 mm (i.e., offset the profile curve by
0.005 to 0.01 mm). Note that you will need to use force to make them fit, so this may be not an
option for fragile parts or unusually brittle resins.</p>

</li><li> <p><b>Low-friction meshing:</b> to allow a round element to rotate with minimal friction, it's
usually sufficient to leave a clearance of around 0.02 mm (offset of 0.01 mm). Note that for high radial
loads, ball bearings may be preferable to sleeve couplings.</p>

</li><li> <p><b>Self-tapping holes for machine screws:</b> measure, look up, or calculate the <u>minor</u>
diameter of the screw (the outer diameter minus the depth of the thread). Use this as a diameter for
the hole. A drop of WD-40 will help drive the screw in for the first time.</p>

</li></ul>

<p>
When in doubt, be quick to experiment: it takes just a couple minutes to machine a rectangular or
cylindrical test piece and play with it. Save yourself the time and frustration of having to
debug issues in more complex parts.
</p>

<!--
http://www.custompartnet.com/wu/InjectionMolding#design_rules
-->

<h3><a name="6.2">6.2. Creating spur gears</a></h3>

<p>
Gears are an extremely versatile tool that will come handy in all sorts of mechanical assemblies.
Depending on your needs, they can reduce
or increase the speed of movement, adjust torque, or change the direction, axis, and type of motion - all
that with high precision, excellent
efficiency (95%+), and great load-bearing capabilities. Alas, unfortunately for hobbyists,
much of the freely available
information about the geometry of common types of gears is misleading or incomplete - and even
the articles posted on Wikipedia are littered with inaccurate images or animations
such as <a href="https://commons.wikimedia.org/wiki/File:Annular_(PSF).svg">this</a>.
</p>

<p>
The key property of a well-designed set of gears is that they transfer motion almost exclusively 
through a rolling action, with very little sliding (and thus friction) involved; and that they maintain constant
velocity and a constant angle of contact through the process. If you violate these principles, your gears will
become inefficient, noisy, and prone to vibration. The optimal design is exemplified by the ubiquituos involute
spur gear:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/38-meshing.gif">
</p>

<p>
The blue lines shown on this picture are the theoretical pitch circles of the gears; if you replaced the gears
with idealized
rubber rollers of these diameters, the behavior of the transmission would not change. The linear speed of any mating gears
is the same when measured along the pitch circle, and the ratio of angular speeds depends on the ratio of their
pitch diameters. For example, if one of the gears has a pitch circle with a diameter of 10 cm, and it's turning
another gear with a pitch diameter of 4 cm, one turn of the former will rotate the latter by 10 / 4 = 2.5 turns.
</p>

<p>
Before getting any real work done, you need to make up your mind about several key parameters that will define
the gears used in a particular project; except for tooth count, these values should be the same for any two gears
that are supposed to mesh with each other.
</p>

<h4>6.2.1. Tooth count</h4>

<p>
This parameter depends chiefly on the transmission ratios you are hoping to achieve. The only
constrain here is that with very low tooth counts, you will see a behavior known as undercutting: the two meshing
gears will collide, necessitating the introduction of some additional clearance - and thus weakening the part:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/39-undercuts.jpg">
</p>

<p>
This is not a big deal if the undercut is small; but when it begins to extend significantly into the area where
power transfer takes place - that is, the region above the so-called base line, the gray circle shown in the
earlier animation - the performance of the gear may be compromised. To avoid having to heavily compensate for this
issue, unless exceptional circumstances apply, try to keep tooth counts over 8-9 or so.
</p>

<p>
<b>Note:</b> most of the gear generators you can find online can't deal with undercuts at all: quite simply, if you
try to specify fewer than a certain number of teeth, they will reject your input or generate an incorrect result.
Avoid these like a plague - and scroll down for better alternatives.
</p>

<p>
As for the maximum number of teeth - there is no real limit to how far you can go,
but to keep your models simple and the cutting process rapid, it's preferable to keep the count under 100 or so.
</p>

<h4>6.2.2. Tooth width</h4>

<p>
This parameter is measured at the pitch circle. The tooth must be wide enough to allow the mating region to be
machined with the tools you happen to have at your disposal; in fact, it's advisable to use tooth width at least 30%
greater than the diameter of the smallest end mill in your collection.
</p>

<p>
In precision applications that do not involve extreme torques, the value will typically range from 0.3 to 1 mm -
and 0.6 mm is a good starting point. You may want to increase the width when working with larger models, to keep
the number of teeth sane.
</p>

<h4>6.2.3. Pressure angle</h4>

<p>
When you look back at the animation shown earlier in this section, you will notice a slanted line that goes through
the center. This is the path along which the gears come into contact, and the actual torque transfer takes place.
The slant of this slope can be selected to suit your needs, but it needs to be reflected in the geometry of the
resulting teeth:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/40-angle.jpg">
</p>

<p>
In general, low pressure angles result in quiet-running, precise gears that are easy to machine due to generous
clearances - but will be weaker, and have more pronounced undercuts. High pressure angles result in thicker
tooth profiles which need to be machined with smaller tools, and can be more noisy and prone to backlash and
slippage - but also survive a lot more abuse.
</p>

<p>
Sensible values for this parameter range from 12° to 25° or so - and my personal favorite for miniature
assemblies is 17.5°.
</p>

<h4>6.2.4. Addendum</h4>

<p>
The addendum is the distance by which every tooth sticks out above the pitch (contact) circle. The recommended value that
ensures continuous and smooth torque transfer is
<code>tooth_width * 2 / π</code>, with some wiggle room if you are pressed for space or are running into
other constraints. Going below 70% of the recommended distance should be done at your own risk.
</p>

<p>
To minimize undercuts when dealing with low pressure angles and low tooth counts, you can use a larger addendum on the
smaller of the two meshing gears, and a smaller addendum on the other one. This technique, known as <i>profile shift</i>,
is particularly useful for gears with fewer than 12 teeth, where it can significantly reduce undercuts without
compromising machinability (right):
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/41-prof-offset.jpg">
</p>

<p>
Of course, profile-shifted gears will not mesh correctly with regular ones - the mating gear always needs to have
exactly the opposite shift. This is seldom a problem, but you need to keep this constraint in mind.
</p>

<h4>6.2.5. Putting it all together</h4>

<p>
All right! Equipped with all
this knowledge, you can compute the profile for your first set of involute gears. There are many
different approaches to this task, but my favorite method is unique in that it comes without the limitations that
plague simpler techniques - and
if you are so inclined, it can be easily generalized to deal with a variety of unusual gear shapes and tooth profiles
later on.
</p>

<p>
The process begins with calculating the circumference of the pitch circle for your gear: <code>c<sub>pitch</sub> = 
tooth_width * 2 * tooth_count</code>. From this, you can trivially calculate its diameter of the circle you
need to draw (<code>c / π</code>). Once you have it on your screen, you
need to add a straight line tangent to the pitch circle; this will be used to build a hypothetical mating gear
with an infinite diameter. If we can mesh with this, we will be also able to mesh with any smaller gears
encountered in real life.
</p>

<p>
On this "pitch line" of our infinite gear, we can draw two lines perpendicular to it, precisely 
<code>tooth_width</code> apart - and rotate them around the point where they intersect the infinite gear
by an amount corresponding to the pressure angle we want to maintain (18° in this example). To turn this
into a proper tooth, we need to add a horizontal line that is normally placed
<code>addendum = tooth_width * 2 / π</code> below;
in fact, draw the line about 5% farther down to create some clearance for any dirt or grease caught
in between gears. When done, trim off the excess - and voila:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/42-construction.jpg">
</p>

<p>
The next step is to simply perform a simulation of how this tooth would engage and then disengage with the 
actual gear we are trying to create. Recall the mention of rubber rollers: for any two meshing gears, the
linear velocity at the pitch circle should be the same - so if the infinite gear (aka rack) moves by
<code>n</code> millimeters, the other gear will rotate by <code>360° / c<sub>pitch</sub> * n</code>.
</p>

<p>
The rest should be fairly obvious; this is the pattern you will see if you keep creating copies of the tooth
at successive offsets along the rack, and then rotating them back by a matching angle around the center of
the pitch circle of our gear:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/43-profile.jpg">
</p>

<p>
The process can be automated easily in almost every CAD tool, although for the initial try, it makes sense
to do it by hand; in any case, once you have this pattern generated, you simply need to trace a curve
around it, replicate this curve using the polar array tool to create the preselected number of teeth,
and offset the pitch circle by the addendum distance to trim off the unnecessary bits:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/44-cleanup.jpg">
</p>

<p>
Try to do this exercise on your own. With rare exceptions where backlash is completely unacceptable,
you should draw the outline about 0.05 mm apart from the trace left behind by the simulation; without this
small amount of play, the teeth will engage on both sides simultaneously, producing unnecessary friction.
</p>

<h4>6.2.6. Bonus tricks</h4>

<p>
The beauty of the simulation-based method of constructing gears is that it's WYSIWYG, and that
it takes most of the usual constraints out of the equation: for example,
you can produce gears with any number of teeth, because the possibilty of undercuts
is automatically accounted for. On top of that, it can be modified in several
fairly intuitive ways. You can:
</p>

<ul>

<li> <p><b>Use custom tooth profiles:</b> instead of the trapezoidal tooth profile we created in our
example, you can as well draw a puppy, and still get a pair of working, matching gears.
It won't be particularly efficient, but it will work. I'm not good with puppies, but here's an
example of a less cute freeform tooth and its generated counterpart:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/45-weird.jpg">
</p>

<p>
More practically, you can also design gears that have an involute profile, but mesh only with a
particular matching gear, by using that gear's tooth profile and its pitch circle, as opposed to
a rack. This will help you reduce undercuts when other methods fail.</p>

</li><li> <p><b>Create custom gear shapes:</b> there is nothing that forces you to perform the simulation against
a pitch circle - the algorithm can be easily extended to use an arbitrary "pitch curve" to generate
<a href="https://www.youtube.com/watch?v=rFF544Fd3bk">oddball gears</a>
that produce variable transmission ratios and do other funny things.</p>

</li><li> <p><b>Draw internal gears:</b> "inverted" gears - essentially a ring with teeth pointing to the
inside - are indispensable in certain types of mechanisms, including high-performance transmissions
covered in section 6.4. These need to be generated to mesh with a specific gear running on the
inside, using its tooth profile, and are tough to get right by other means.</p>

</li></ul>

<p>
Sounds more fun than it should be? You bet it does!
</p>

<div>
<p>
<span><b>Tip:</b></span> of course, there is no need to repeat all these steps
by hand. The most flexible option is
<a href="http://hessmer.org/gears/InvoluteSpurGearBuilder.html">this web-based generator</a> developed by
Rainer Hessmer. The tool is very user-friendly: simply enter several parameters and get a DXF file in 
return. The tool properly handles undercuts, internal gears, profile shifts, and so on - so take it for
a spin!
</p>

<p>If you're using Rhino, you may also enjoy my experimental <a href="https://lcamtuf.coredump.cx/gear_calc.gh">Grasshopper module</a>,
which provides a comparable degree of flexibility, but is much faster, with instant feedback right 
within the CAD environment. It comes with fairly detailed instructions and features important for
machineability, too. To run the add-on, you will need to install the <a href="http://www.grasshopper3d.com/">Grasshopper</a>
plugin itself, open the plugin with the namesake command, and then load the <code>gear_calc.gh</code>
file into the app. Note that the internal gear functionality is not fully operational yet: undercuts
are not properly compensated for if the diameter of the meshing gear is close to that of the internal
one.</p>

<p>Last but not least, some Rhino users may want to grab a copy of my earlier
<a href="https://lcamtuf.coredump.cx/hob_calc4.rvb">semi-automatic script</a>. Its main advantage is that it can handle arbitrary
tooth profiles and very accurately handle internal gears. It is activated by entering <code>Hob4</code>
in the command prompt and answering some simple questions about the gear you want to generate. It
will then draw the appropriate circles and - if instructed to do - a standard trapezoidal tooth profile.
You can modify the profile or simply select the one produced by the script,
and run <code>Hob4</code> again to finish the job.
</p><p>
As noted, the script also allows you to generate internal gears; to do that, you must provide a mating pitch
circle and tooth profile extracted from a previously generated external gear. This
circle needs to inside, and must be touching the top of the pitch circle for the internal gear.
</p>
</div>

<h3>6.3. Other types of gears</h3>

<p>
Involute spur gears are remarkably versatile, easy to model, and easy to manufacture - but they are
certainly not the only type of a gear you can use. Let's go over some of the more exotic but still
useful options that may come handy in your work.
</p>

<h4>6.3.1. Bevel gears</h4>

<p>
In comparison to planar spur gears, bevel gears have a very important property: they mesh at an angle,
and therefore, can be used to change the axis of rotation. Although this goal
can be achieved by other means - for example, with simplified 
<a href="https://en.wikipedia.org/wiki/Crown_gear">crown gears</a> or 
with <a href="https://en.wikipedia.org/wiki/Worm_drive">worm drive</a>, bevel gears do so with remarkable
precision and efficiency.
</p>

<p>
The process of constructing a set of meshing bevel gears is considerably more complicated than what we
discussed before, and involves a brush with non-Euclidean spaces; nevertheless, if you follow these
instructions closely, you should be able to pull it off.
</p>

<p>
As with spur gears, the first step is to choose tooth counts, width, height, and pressure angles; you
should also think about the exact gear ratio you want to achieve, as one pair of gears will be not
interoperable with any other differently configured set.
</p>

<p>
Next, draw the appropriate pitch circles for both of the gears you want to create, placing them
on the X-Y plane; when done, add two lines perpendicular to this plane and going through the center of
each circle. Finally, rotate one of the circles (and the associated perpendicular line) in the Y-Z plane,
pivoting the operation around the point where touches the other one. In our example, we will use 90°
between the mating gears, but any other angle is a possibility:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/46-pitch.jpg">
</p>

<p>
With this out of the way, draw a line that starts where the two perpendicular lines meet each other,
and ends where the two circles touch each other (<code>Q</code>). Next, using the Y-Z drawing plane, add a line
perpendicular to this newly created one. This final line is denoted as <code>l</code>:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/47-cone-lines.jpg">
</p>

<p>
To minimize clutter, we'll focus on constructing the gear profile for circle <code>a</code>, and hide
the other circle for time being; the steps needed to construct a suitable gear profile for the second gear
will be analogous to what we are doing past this point, so you should have no difficulty figuring it out.
</p>

<p>
The next task is to mark two locations on the line <code>l</code> that are in equal distance from point
<code>Q</code>; these newly created locations are denoted as <code>C</code> and <code>D</code>. The
distance must be a bit greater than the addendum for your gears, but beyond that, the exact value doesn't
matter. With these two points in place, draw a circle in the X-Y plane that has the same center as circle
<code>a</code>, and passes through point <code>C</code>; a similar circle should be drawn for <code>D</code>.
Lastly, use the loft operator after selecting the newly created circles <code>c</code> and <code>d</code>
to build a conical surface:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/48-cone.jpg">
</p>

<p>
The next challenge is to check the manual for your CAD application, and identify an operator that allows you
to "unroll" this surface to a construction plane; in Rhino, <code>UnrollSrf</code> is what you need. Select
the surface <u>and</u> the original circle <code>a</code>, and apply this transformation; you should get an
object resembling the one on the left:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/49-smash.jpg">
</p>

<p>
Extract the two "broken" edges of the surface as straight curves, and draw a circle that has the same center
and diameter as the arc produced by unrolling the curve we selected alongside with the cone. This will
be your <i>virtual pitch circle</i>, on which you will have to construct a regular tooth profile using
the approach outlined earlier on.
</p>

<p>
You can start by simulating the appropriate tooth profile (center, above), and then by making a planar array
to complete the gear (right). The only difference is that before making the array, you need to rotate the profile
by 90° to touch one of the extracted edges; and then make a radial array consisting of <code>tooth_count</code>
copies that fill an angle of <code>360° / length_of_virtual_pitch_circle * length_of_circle_a</code>,
rather than the usual 360°. When done, truncate the parts that stick outside the edges, and you should
be all set.
</p>

<p>
To wrap up this process, you need to position the created gear profile over the unrolled surface again, making
sure that it is aligned correctly. Next, use an operator that will map the curve back onto the original conical
surface, using the unrolled geometry as a reference. In Rhino, this is accomplished with <code>FlowAlongSrf</code>.
Just make sure that you select matching locations on the reference and destination surface, and if you did it
right, you should be able to get something of this sort:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/50-mapped.jpg">
</p>

<p>
You can delete the cone and all the helper surfaces at this point, and repeat the same procedure to generate
the other gear. In the end, you should be seeing a result that resembles this:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/51-all-curves.jpg">
</p>

<p>
Neat, eh? You can now create a scaled copy of each outline along the appropriate axis, using a 3D scaling
operator with the origin set at the point where the axes intersect; be careful with this step, as using an incorrect
origin will result in gears that would not mesh. With this step out of the way, the scaled copy and the original
can be then lofted together, and each of them can be individually extruded toward any point behind the gear to create
a cap surface. A few extra moves to trim and cap everything neatly, and you should have a final result in front of you:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/52-finished.jpg">
</p>

<p>Sweet!</p>

<h4>6.3.2. Worm gears</h4>

<p>
<a href="https://en.wikipedia.org/wiki/Worm_drive">Worm gears</a> are an interesting animal. On one hand,
they offer extremely high reduction ratios, which makes them quite attractive for robotics: every turn of
the input shaft advances the output gear just by a single tooth. On the other hand, they generally boast
very poor efficiency due to significant friction - 30-40% being the norm.
</p>

<p>
From the design standpoint, these gears are fairly unremarkable; the output gear is generated the same
way you would make any other spur gear, while the input gear - or more accurately, the input screw -
is essentially a rack tooth that is wrapped around a spiral path, with a <code>tooth_width * 2</code> pitch
between the turns:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/53-worm.jpg">
</p>

<p>
Depending on the thickness of the output gear and the diameter of the input screw, the profile used to generate
the output gear may need to be corrected slightly, based on a 2D projection of the trimmed,
meshing section of the screw. You should be able to create all this with no help by now; 
operators such as <code>Sweep1</code> and <code>Silhouette</code>
in Rino are about everything you need. The only complication for CNC machining is that as opposed to
spur and bevel gears, the input screw needs a two-part mold.
</p>

<h4>6.3.3. Helical gears</h4>

<p>
Helical gears are essentialy spur gears - but (literally!) with a twist. Instead of having their teeth
extruded along the axis of rotation, the top and bottom profiles are rotated in relation to each other,
and then lofted to form a twisted gear. The twisting may be done in a straight line (left) or in
a curved fashion (center):
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/54-helical.jpg">
</p>

<p>
The point of this modification is that each gear will now engage more gradually, thus reducing the
amount of noise and vibration produced under load, this matters particularly in automotive applications
and other situations where steel gears transfer high torques at high speeds. On the flip side, this
geometry means that the gears act like a wedge, and exert substantial axial forces on the assembly
they are coupled to;  a double helical layout, also 
known as <i>herringbone</i> (above, right) works around that to a large extent.
</p>

<p>
Helical gears are relatively difficult to make using simple, CNC-machined molds; for optimal results,
the mold would need to be split into four to six parts. It is easier to machine them directly using a rotary
axis - but in any case, the benefits of using this class of gears are negligible in small-scale robotics work.
</p>

<h4>6.3.4. Pulleys for timing belts</h4>

<p>
Gears that mesh with timing belts are constructed in a manner fairly similar to a normal gear
meshing with a rack, but their shape is not entirely symmetrical. MXL timing belts use 40° teeth with a
pitch of 2.03 mm. Addendum of the timing belt is approximately 0.5 mm; the dedendum is zero. The width of
base of the tooth (at the pitch circle / line of the belt) is around 1.2 mm, leaving just around 0.8 mm in
between the teeth. The solid section above the gears is usually around 0.7 mm thick.
</p>

<p>
Of course, the belts are made of rubber and will easily conform to pulleys even if the dimensions are
slightly off - so you don't need to obsess over it as much as you'd have to with rigid gears.
</p>

<h3>6.4. Getting started with gearboxes</h3>

<p>
It is possible to adjust the speed or torque of a motor by employing just a single pair of gears, but doing so
is often impractical: for example, if you have a motor that nominally runs at 10,000 RPM, and want to get down
to 100 RPM - a reduction of 100:1 - you would need to mesh an input gear with about 10 teeth to an output
gear with no fewer than 1,000. Assuming that the width of a single tooth is 0.6 mm, the diameter of the latter
gear would be almost 50 cm - oops!
</p>

<p>
To solve this problem, it is common to build gearboxes that employ multiple stages; each stage reduces
the speed by a more reasonable factor - usually between 2:1 and 5:1 - and then powers the next stage
that performs the same trick again. The gains are exponential: if one stage gives us 4:1, then two
will offer a 16:1 reduction; three will yield 64:1; and four would get us down to 256:1.
</p>

<p>
The most rudimentary type of a gearbox is the offset-gear arrangement shown on the left; you
can check out a practical example of this design <a href="https://lcamtuf.coredump.cx/robot/smg2.jpg">here</a>. This approach works
well, but tends to take up space; a simple modification, shown on the right, is to stack the gears alternating
between two shared axles, instead (<a href="https://lcamtuf.coredump.cx/robot/pinkbot006.jpg">example</a>):
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/55-gearsets.jpg">
</p>

<p>
Offset gear transmissions of this sort are simple and adequate for most needs; for instance,
<a href="https://lcamtuf.coredump.cx/tinybot/">Tinybot mk III</a> uses them exclusively. Having said that, every now and then, you
may wish for something more compact and self-contained. If you are pressed for space, it makes sense
to consider a <a href="https://en.wikipedia.org/wiki/Epicyclic_gearing">planetary gearbox</a>. There
are several possible ways to design such a mechanism, but the most practical arrangement relies on
a small, centrally placed <i>sun</i> gear coupled with the input shaft; that gear is surrounded by
several <i>planets</i>, and these planet gears in turn roll inside a stationary internal gear known as
<i>annulus</i> or <i>ring</i>:
</p>

<p>
<iframe width="640" height="360" src="https://www.youtube.com/embed/_YzLEeLHSBc?rel=0" frameborder="0"></iframe>
</p>

<p>
Of course, this design makes little or no sense if the planets just run freely; the output stage is
created by creating a carriage that slides onto the planet gears, often using a sleeve bearing.
The transmission ratio of such a mechanism will be <code>tooth_cnt<sub>sun</sub> / tooth_cnt<sub>annulus</sub></code>
- and that's quite a good result in such a small envelope. Just as importantly, additional stages of
a planetary gearbox can be packed tightly on top of each other, resulting in a form factor that is
pretty hard to beat.
</p>

<p>
To better illustrate the practical aspects of making a planetary gearbox, you may want
to check out this rendering of the design I have been using in my projects for 
<a href="https://www.youtube.com/watch?v=w2X9maeSTVI">quite a little while</a>:
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/56-planetary.jpg">
</p>

<p>
Of course, planetary gearboxes are no silver bullet; they are about 2-3 times more compact than offset
gears, and outperform them in some ways, but it's possible to run into situations where an even higher
ratio would be desirable - but where the poor efficiency of worm gears and other types of screw-based
actuators is hard to swallow.
</p>

<p>
Of all the more exotic transmission systems, the most promising one is probably the cycloidal drive.
This device easily attains ratios of 100:1 or more in a single stage by brilliantly 
exploiting eccentric motion of a large gear in a comparably-sized "cage":
</p>

<p>
<img src="https://lcamtuf.coredump.cx/gcnc/57-cycloid.jpg">
</p>

<p>
I have a <a href="https://lcamtuf.coredump.cx/cycloid/">separate page</a> describing this particular design in more detail, so I won't
repeat all the information here. Rest assured, cycloidal drive systems have some substantial downsides - for
example, they tend to introduce vibration, and require subminiature ball bearings to isolate the input shaft
from the eccentric gear. Nevertheless, when out of mainstream options, they are worth a try.
</p>

<h3>6.5. Overview of drive systems</h3>

<p>
By now, you should be well-equipped to get ahead with almost any electromechanical project you can think of;
the only question is where to start. In the world of robotics, the single most important choice is probably
the mode of locomotion; everything else - from the selection of sensors, to power sources, to data processing
capabilities - follows from that. In the last section of this chapter, it makes sense to quickly run through
the options you have.
</p>

<p>
In all likelihood, your initial projects should probably be wheeled. It is tempting to try something
bolder, but until you are familiar with the dynamic properties of plastics, and have several precision
robots under your belt, it's really the best choice. Some of the common approaches to wheeled robots include:
</p>

<ul>

<li> <p><b>Differential steering:</b> in this design, the two front wheels are individually hooked up to
two motors; the rear wheels are typically spinning freely. When the motors are rotating at the same speed,
the robot drives in a straight line; speed differences result in the chassis banking to the left or to the
right. The rear wheels typically need to be equipped with rotary encoders or optointerrupters to
detect and compensate for unintented fluctuations in motor speed, and to sense loss of traction.
</p>

<p>
The main disadvantage of this design is that during sharp turns, the non-powered wheels will be dragged
sideways, which may lead to loss of registration with the environment. The problem can be avoided by
using swivel wheels - or even eliminating the rear wheels completely and lowering the center
of mass so that the device is stable with just two; but all these solutions make it much harder to 
maintain a robust feedback loop. That last problem may be overcome by using
<a href="https://en.wikipedia.org/wiki/Mecanum_wheel">Mecanum wheels</a> - but the price tag may be hard
to swallow.
</p>

</li><li> <p><b>Car-style steering:</b> in this arrangement, the front wheels are spinning freely; a rigid linkage
operated by a motor allows them to turned left and right while a separate motor powers the rear wheels.
Position sensors places on the front wheels provide a feedback loop. This is the arrangement used in
<a href="https://lcamtuf.coredump.cx/tinybot/">Tinybot mk III</a>.
</p>

<p>
The approach is simple and sweet, which is precisely why it's so popular in the real world.
That said, not all is roses: for accurate, slip-free turns, you may still have to incorporate
<a href="https://en.wikipedia.org/wiki/Ackermann_steering_geometry">Ackermann linkages</a> and a 
<a href="https://en.wikipedia.org/wiki/Differential_(mechanical_device)">differential</a> on the rear
axle. This adds more complexity than you could be expecting.
</p>

</li><li> <p><b>Fully reorientable drivetrain:</b> this approach relies on a drivetrain with a system of linkages
that allows every wheel to be repositioned to accommodate motion in a particular direction. A simple
and economical design of this type, using only three motors and permitting on-the-spot
360° turns, is employed in my <a href="https://lcamtuf.coredump.cx/omni2/">Omnibot</a>.
</p>

<p>
The only disadvantage of the specific approach used in Omnibot is that the robot needs to come to a stop
before changing direction. In situations where this is a significant problem, additional motors may be used
to independently control the position of each wheel.
</p>

</li></ul>

<p>
Wheeled robots aside, legged creatures have some undeniable appeal. These robot designs tend to pose a range
of challenges related to space management, torque requirements, obstacle sensing, and the creation of
practical movement algorithms. Sure - it is relatively easy to <a href="http://www.machinesthatgobing.com/images/lynxmotion-hexapod-1.jpg">bolt a bunch
of expensive servos</a> on top of a simple frame - but going beyond that point is usually fraught with
peril. Still, if you want to give it a try, your basic choices are:
</p>

<ul>

<li> <p><b>Biped locomotion:</b>

achieving a natural, stable, and useful walking gait probably requires at least 4-5 degrees of
freedom per leg, packed in a very narrow envelope - as well as a bunch of gyroscopes, accelerometers, and
contact or current sensors to detect problems while it's still possible to recover. Because of this, and
because of the algorithmic complexity of dynamically stable biped motion, most of the designs you can see
tend to cut a lot of corners; using oversized feet to achieve static stability, or executing turns in
a large number of small and awkward movements, is a common pattern.</p>

</li><li> <p><b>Quadruped and beyond:</b>

with four or more legs, it is relatively easy to create a design capable of moving in any direction without
the need for sophisticated stability control. At least three degrees of freedom per leg are probably required
to achieve efficient walking gaits (making turns, climbing obstacles, etc), but some success on flat surfaces
can be achieved with only two degrees. Hexapods seem to be particularly popular with hobbyists - perhaps because
of their sinister look?</p>

<p>
Of course, a number of designs for "scuttling" robots with one or less than one degree for freedom per
leg can be found on the Internet - but they are usually not any more practical than a wind-up toy.
</p>

</li></ul>

<p>These movement modes aside, there is a long tail of exotic inventions that are worth at least reading
about. We have hopping <a href="https://www.youtube.com/watch?v=LKCBPQs56aY">pogo stick robots</a>;
several well-publicized
<a href="http://spectrum.ieee.org/automaton/robotics/robotics-software/042910-a-robot-that-balances-on-a-ball">ball-balancing units</a>;
a bunch of levitating designs that leverage air cushions, magnetic fields, or vibration;
insanely cool <a href="http://www.snakerobots.com/images/Stills/S7_750.jpg">crawling robots</a>;
and a large selection of flying and sailing ones. And hey - why not add something of your own
to that list?
</p>

<!-- START~7~Workshop safety topics~ -->

<h2><a name="7">7. Workshop safety topics</a></h2>

<p>
We're done with the technical stuff, but stay with me for a bit longer: even for DIYers, workplace safety
is no laughing matter. You will be dealing with power tools and reactive chemicals,
and so if you want to pursue this hobby, there are inherent risks you simply have to understand
and accept. It's entirely possible to lose an eye or set your house on fire; there are certain
common-sense steps you can take to minimize the probability of mishaps, but the odds will never go
down to zero.
</p>

<p>
It is also your sole responsibility to investigate and follow all the applicable HOA rules,
city ordinances, and other regulations - especially as they relate to purchasing laboratory
supplies and chemicals, the use of power tools, and the disposal of unreacted chemicals.
In many places, the laws are sensible or non-existent; but 
<a href="http://blog.makezine.com/2008/08/11/home-science-under-attack/">exceptions happen</a>.
If you accidentally ignore a piece of obscure, boneheaded legislation - well, nine out of ten
times, nobody will know or care, but do you really want to be that one unlucky guy?
</p>

<p>
OK. With all that in mind, this chapter provides a quick but <u>non-authoritative</u>
overview of some of the most obvious safety considerations and health risks for CNC
machining and resin casting. There are no guarantees that this information is accurate,
complete, or up-to-date, so do your own research. Do not blindly
trust one random dude on the Internet!
</p>

<h3>7.1. Working around milling machines</h3>

<p>
Small CNC mills are fairly safe, compared to most other power tools - but you still need
to read and follow the instruction manual, and in general, exercise common sense in
everything you do. The primary risks are getting your hand pinched between the rotating tool
and the workpiece, or between any other moving parts; having loose clothing or hair caught by
the spindle; or being hit by any debris ejected during the cutting process.
</p>

<p>
Becaue of this, you should really stay clear of the machine while it's running a job - after all,
you have no business fiddling with it. If you really need to make some sort of an adjustment,
or perhaps simply vacuum off accumulated shavings, it's imperative to pause the cutting process
first. It is also a very good idea to wear basic
<a href="https://www.amazon.com/DPG55-11C-Anti-Fog-Protective-Glasses-Dual-Injected/dp/B000RKS07I/">eye
protection</a> at all times; although the odds of a broken tool or other sharp material hitting your
eye are very low, the damage can be significant.
</p>

<p>
All that aside, high-speed
CNC lathes and high-power CNC mills (over 1 kW or so) have their own safety
rules that I will not cover here. 
These devices are often powerful enough to break bones, sever limbs, or eject a
loose  workpiece with a speed sufficient to kill or maim. If you have one of these,
the use of robust safety covers made out of sheet metal, polycarbonate, or wood, is definitely a must.
</p>

<h3>7.2. Dust considerations</h3>

<p>
Any type of dust can aggravate existing respiratory conditions; prolonged and heavy exposure
may also lead to the development of brand new ones. That said, most of the noteworthy CNC stock
materials give off relatively little airborne particles when machined in a sensible way - and so,
your overall exposure to nuisance dust will probably not change in a major way.
</p>

<p>
Lifelong exposures to wood dust are associated with nasal cancer, so reasonable dust management
is advisable for wood-related projects. When working with prototyping boards such as RenShape 460,
airborne dust is produced in modest quantities and has no known, specific health risks, but it's
still probably good to keep it in check.
Covering the mill with plastic sheeting for the duration of the job (well clear of any rotating
parts and inlet vents) is a simple dust management trick; building
or buying a proper enclosure is an option, too. When containment is impractical, a simple N95 particulate
respirator (<a href="https://www.amazon.com/3M-8210Plus-Particulate-Respirator-20-Pack/dp/B0000AXTBR/">link</a>)
should offer protection.
</p>


<p>
Of course, there are materials that pose an elevated risk;
to avoid really unpleasant surprises, always investigate the substances you are milling, sanding, or
otherwise dispersing in the air. You should be particularly wary of anything that contains
crystalline silica (quartz), asbestos, elemental metals, toxic pigments, and any
other harmful substances that may be absorbed through the lungs.
</p>

<p>
<b>Note:</b> whie crystalline silica (quartz) is a significant danger when inhaled, there is no compelling evidence that 
amorphous glass products, such as milled glass fibers or 3M glass microspheres, share the same risk. You still don't
want to breathe any of that stuff in, but these fillers should be safe to use in their intended way -
and a tiny amount of dust should be OK.
</p>

<h3>7.3. Vacuum and high pressure</h3>

<p>
Vacuum isn't particularly dangerous to work with, but you should be aware of the risk of implosion.
Plastic vacuum chambers should be inspected for cracking or crazing, and should never be exposed to
high temperatures, substantial quantities of solvents, strong acids and bases, and so on. Sketchy-looking
or homebrew chambers can be secured with packing tape, shrink-wrap foil, fabric, and similar materials that
will retain debris if things go wrong. Other than that, you have very little to worry about; oh, if you
are working in a confined space, it may make sense to vent the vacuum pump to the outside, so that
the relatively small quantities of gases liberated from the resin - as well as the fine mist of mineral
oil from the pump itself - don't end up right under your nose.
</p>

<p>
Pressure casting is more dangerous; that's in part because the pressure differentials are much higher
than for vacuum casting (especially if something goes wrong), and because all the energy is released
outward if the container fails. Because of this, you should <u>never</u> try to rig your own pressure
chambers or any other parts of the system, and not even think about removing any safety valves, regulators,
and so on. Follow the instructions religiously, especially when it comes to draining the compressor;
do not exceed manufacturer-provided pressure ratings; always double-check that the system is depressurized
before trying to open the chamber; and
disconnect everything completely when not in use. With common-sense precautions, catastrophic failure is 
unlikely - but rest assured, bad things have happened to quite a few people who should have
known better.
</p>

<p>
Oh, one more thing: if you are inclined to get a nitrogen tank for blanketing resin containers
in storage, go for a small one - capacity of 1 cubic meter (40 cubic ft) is more than enough. Store it
horizontally or attach it to the wall to make sure it can't fall over, and <u>always</u> use a regulator.
</p>

<h3>7.4. Silicone resins</h3>

<p>
Platinum cure silicones are believed to be essentially harmless; both the siloxane resin
and the catalyst are non-reactive and show virtually no toxicity in animal studies. You should
always read material safety datasheets for the specific product you are using, but chances are,
the only risk you have to worry about is that the material is sticky, and spills can be annoying
to clean up (naphtha and other nonpolar solvents can help). Beyond basic workplace hygiene, no
special precautions should be necessary.
</p>

<p>
Now, I don't recommend using condensation cure silicones, but if you decided to choose that 
option, you should be aware that they often use a small amount of dibutyltin dilaurate, 
dimethyltin dineodecanoate, or a similar
tin(IV) compound, to catalyze the reaction. The substance is corrosive, and more troublingly,
exhibits some chronic toxicity. It is present at around 5% in the
catalyst component, and usually at less than 1% in the finished product - but since it will leach
out in favorable conditions, you should probably not be using condensation cure silicones to make
anything that is routinely worn or handled by humans, or that comes into contact with food.
When mixing these resins, it's best to use latex or vinyl gloves; basic eye protection is not
a bad idea, too. Storing the catalyst in a suitable cabinet and
out of reach of children is important, too.
</p>

<h3>7.5. Polyurethanes</h3>

<p>
Polyurethane resins consist of several very distinctive components, and it's probably useful
to discuss them separately. Here's what you can typically find in the MSDS:
</p>

<ul>

<li> <p><b>Isocyanates:</b> polyurethane formulations used for prototyping
normally rely on fairly non-volatile isocyanates, such as
liquefied methylene diphenyl diisocyanate (MDI), hydrogenated MDI (HMDI / DMDI), or isophorone
diisocyanate (IPDI); products where these isocyanates are already partly polymerized are common,
and in this case, the prepolymer may be not listed in the MSDS at all.
</p>

<p>
In general, all these substances are fairly reactive, can be damaging to mucous membranes, and
upon longer exposures, will irritate skin. Fortunately, they polymerize to form an inert substance
soon after being exposed to water, alcohols, and many other common substances - so they pose little
danger to the environment, and do not bioaccumulate.
</p>

<p>
Isocyanates tend to be pretty dangerous if inhaled - enough to earn some of the water-clear
HMDI and IPDI formulations a nice "toxic" label in Canada and in the EU. Nevertheless, the extremely
low vapor pressure of these chemicals - around one million times lower than water - means that if
you are using them for casting reasonably sized parts at room temperature, you have very little to
worry about. Within the scope of this guide, the main things to avoid is getting the substance into your eyes
and spilling it in large quantities. Use eye protection, wear latex or vinyl gloves, and keep
your workplace safe and clutter-free.
</p>

<p>
Now, as hinted earlier, several manufacturers resort to more reactive and more volatile isocyanates,
such as toluene diisocyanate (TDI) or hexamethylene diisocyanate (HDI); I recommend avoiding these,
but if you have no choice, really good ventilation, gloves, and safety glasses are absolutely a must.
</p>

<p>
<b>Note:</b> a small proportion of industry workers frequently exposed to significant concentrations
of isocyanates eventually develop hypersensitivity to the compound. Although this is very unlikely
to happen when working with room temperature casting formulations, you should obviously seek medical
attention if you have difficulty breathing within several hours of working with this or any other
exotic chemical.
</p>

</li><li> <p><b>Polyols / polyetheramines:</b> most polyester or polyether polyol compositions
are viscous, non-reactive, non-volatile fluids with relatively high molecular weight, chemically
related to substances such as propylene glycol, glycerine, xylitol, and so on. They tend to have
rather low toxicity in their intended use, and aren't particularly reactive. Not all products are the
same - but unless something stands out in the MSDS, you probably don't have to worry (of course,
common sense still applies).
</p>

<p>
Some systems may also use lower molecular weight amines as crosslinkers, or higher molecular weight
polyetheramines to replace traditional polyols. Low molecular weight amines tend to be a bit more
biologically active and irritating; a chlorine-containing amine originally used in many polyurethane
formulations -  4,4'-methylenebis(2-chloroaniline) - was found to be a probable human carcinogen. A
number of less reactive replacements emerged since then, and are expected to be much safer based on
their chemical structure and animal data. In other words, there is no reason to panic, but it
definitely makes sense to handle the formulations with some respect. A good sign of high amine
content is a yellow-to-caramel color of the polyol component, alongside with a slight but
disagreeable smell.
</p>

</li><li> <p><b>Catalysts:</b> these substances are of special interest, because as opposed to the core
reagents outlined above, they usually remain as-is in the cured product - and if the circumstances
are right, may leach out of it in small quantities, particularly out of Shore A elastomers.
</p>

<p>Modern polyurethane chemistry is usually catalyzed
with much less than 1% of a carboxylate of bismuth, zinc, tin(II), or
a related metal; or with a handful of reasonably selective amines, imidazoles, and so on. Most
of the contemporary metal-based catalysts are extremely unlikely to be of any concern - especially at
the concentrations used in the resin. The non-metal catalysts have also been studied extensively
and carry no known risks at these levels - but as noted earlier, they belong to large and interesting
families of bioactive compounds.
</p>

<p>
As a relic of bygone days, several manufacturers still resort to
toxic or bioaccumulative organometal catalysts, such as mercury neodecanoate or dibutyltin dilaurate;
for example, that's the case for many products from Smooth-On and Freeman. In theory, the cured plastic
should be safe to handle under normal circumstances. In practice, the mobility of the organomercury compound
may be increased by factors such as incorrect mixing proprtions,
UV degradation, exposure to elevated temperatures, or the action of solvents and household chemicals.
</p>

<p>
In the end, I certainly wouldn't use the latter class of resins for jewelry,
toys, or food applications - and I wouldn't want to worry about the exposure due to spills and other
workshop accidents. I generally recommend staying away from such products altogether,
especially since the alternatives have gotten much better over the years. It's not that mercury-catalyzed
products are likely to maim you, but they introduce a small, preventable, incremental health risk.
When in doubt about the catalyst used, simply check the MSDS to confirm.
</p>

<p>
<b>Note:</b> if you are purchasing any concentrated catalysts or inhibitors to modify the performance
of your resins (as discussed in <a href="https://lcamtuf.coredump.cx/gcnc/ch4/#4.4.4">section 4.4.4</a>), be sure to do your homework.
For example, common bismuth, zinc, and tin(II) carboxylates are believed to have very modest acute
toxicity and no major chronic risks. Many other organometal catalysts - for example, based on tin(IV),
cobalt, or mercury - are something you really don't want to keep around in concentrated form.
Triethylenediamine and its friends sit somewhere in between: they are flammable, irritating,
and fairly reactive, but probably not particularly toxic per se.
</p>

</li><li> <p><b>Plasticizers, fillers, surfactants, etc:</b> while most resins don't
contain many other questionable additives, it's useful to briefly scan the MSDS for anything else
out of the ordinary. For example, several manufacturers add phthalate plasticizers - such as
butyl benzyl phthalate (BBP) or dibutyl phthalate (DBP) - to some of the more flexible polyurethane
rubber formulations. While these substances have very low acute toxicity and were not shown to be
conclusively harmful to humans, animal studies raise some worries about long-term subchronic
exposure through children toys, food-contact items, and so on - a situation vaguely reminiscent of
the controvery around bisphenol A (BPA). No need to panic, but educate yourself and decide
what's your tolerance for such peripheral risks.
</p>

</li><li> <p><b>Residual solvents:</b> some resins may contain small quantities of solvents that are
left over from the manufacturing process or have been intentionally added to help with mixing or
degassing. This may include xylene, toluene, ethylbenzene, etc. Although the solvents are harmful
upon prolonged, heavy exposure, the amounts present in the material are usually tiny (under 0.5%)
and probably do not pose any serious concern.
</p>

</li></ul>

<p>
As with any chemicals, you should avoid mixing polyurethanes - and isocyanates in particular -
with potentially incompatible substances; as hinted earlier, this includes alcohols, water, but
also strong bases, oxidizers, amines, and metal salts. Rapid polymerization, decomposition, or
other funny developments may ensue. Isocyanates also decompose in a matter of minutes in
dimethyl sulfoxide (DMSO), so do not use this solvent as a carrier for dyes,
catalysts, and so forth.
</p>

<p>
In the same vein, don't mix unreasonable quantities of polyurethane resins in a single batch.
Runaway exothermic reactions can become dangerous if the resin gets so hot that
the mixing container melts away, or something catches fire. If you need to dispose of a large
quantity of unwanted resin, polymerize it in batches; or at the very least, use a large,
shallow pan and work outdoors, away from other humans and flammable stuff.
</p>

<p>
Last but not least, because of their irritant properties, uncured resins should be stored
safely, and kept out of reach of children and other creatures other than the intended user.
</p>

<p>
These considerations aside, cured polyurethanes are one of the safer, more stable, and least
controversial plastics out there. Even if you mess up the mixing ratio, the unreacted isocyanates
will simply eventually react with moisture, unreacted polyols will not pose a threat, and nothing
horribly bad should be leaching out of the material otherwise. Like most
plastics, and organic materials in general, polyurethanes release a fair amount of toxic substances
during thermal decomposition - carbon monoxide being by far the most significant problem - so try to
resist the urge to burn them if at all possible.
</p>

<h3>7.6. Other chemicals</h3>

<p>
Throughout this guide, I have mentioned quite a few chemicals that won't be covered in
this chapter in special detail. If you plan on getting any of them, you should take care to obtain
and read  the appropriate material safety datasheets, and understand all the associated risks. In no
particular order, here are some of the things you should know:
</p>

<ul>

<li> <p><b>Epoxy resins:</b> many of these products use corrosive and somewhat volatile compounds.
Chronic toxicity may be a concern with daily exposure. When mixing larger quantities, beware of
significant exotherm - it's usually more pronounced than in polyurethanes.</p>

</li><li> <p><b>Polyester resins:</b> styrene is highly volatile and flammable, and its vapors are harmful.
On top of that, the standard catalyst is a strong oxidizer, and the resin typically cures with
an extremely pronounced exotherm.</p>

</li><li> <p><b>Pigments and dyes:</b> toxic pigments based on lead, mercury, arsenic, cadmium,
chromium, and nickel are available on the market, but should be avoided. Shop specifically for
modern, less harmful alternatives. Avoid pigments that contain crystalline silica of respirable
size - and in any case, handle the material with care.</p>

</li><li> <p><b>Glass fibers:</b> thin strands of glass are easily embedded in the skin, and can give you
an annoying but generally harmless rash that takes 2-3 days to go away; getting the material
into eyes can be a more serious issue, so use gloves, clean up promptly, and don't touch your
face until then. If you get a rash, scratching it will usually only push the fibers deeper;
soaking the affected area in water and applying an over-the-counter
anti-itch cream (antihistamine) will offer relief.</p>

</li><li> <p><b>Common solvents, glues, demolding agents:</b> unless indicated otherwise, you should
assume that all these products are extremely flammable and that their vapors are harmful.
Prolonged exposure to very high levels of certain solvents may lead to CNS effects, reproductive toxicity,
and so on; over time, lasting damage is a possibility, too. Naphtha, xylene, toluene, benzene,
methylene chloride, and NMP are of special concern.</p>

</li><li> <p><b>All the other stuff:</b> several substances mentioned in this guide may be described as
"reasonably safe", but that doesn't necessarily mean they are non-toxic if aerosolized or
ingested in significant quantities; that they don't react in funny ways with incompatible
materials; or that they won't cause damage if rubbed into your eyes or skin, heated up, or mishandled
in some other way.
Before buying <u>any</u> chemicals on eBay, Amazon, or anywhere else, look up their safety datasheets
first.</p>

<div>
<p>
<span><b>Tip:</b></span>
MSDSes are targeted at industrial uses, and err heavily on the side of caution;
the datasheet for <a href="http://fscimage.fishersci.com/msds/21105.htm">table salt</a> says
that the substance is "harmful in case of ingestion"; that skin contaminated with it
must be flushed with water for "at least 15 minutes"; that protective clothing and gloves
should be worn at all times; and that proper ventilation is necessary. They also warn that
you shouldn't let this chemical enter the environment.
</p>

<p>
And that's not even the worst example: Sigma-Aldrich has a serious datasheet for 
<a href="http://www.sigmaaldrich.com/catalog/product/sial/320072?lang=en&amp;region=US">pure
water</a> that says you should use proper glove removal techniques and... wash hands after
handling this dastardly chemical. To fend off lawsuits, they also make sure to mention
that the chemical, physical, and toxicological properties of this material have not been
thoroughly investigated.
</p>

<p>
Do not ignore the advice provided in these documents, but use common sense when evaluating your
personal risk, and the safety measures that are appropriate given the amounts you are working with,
the way you are handling the substance, the frequency of exposure, and so on. It's always good to pay
close attention to LD50 values; chronic health risks; and any mentions of carcinogenicity, developmental
toxicity, etc.
</p>
</div>

</li></ul>

<p>
It hopefully goes without saying that you should store all the materials discussed in this guide
away from sources of ignition, excessive heat, and so on; that you need to keep them away from
children; and that if you are pregnant or breastfeeding, you should avoid any non-essential
exposure to exotic, industrial chemicals - no matter what the MSDS says.
</p>

<!-- START~8~Closing notes~ -->

<h2><a name="8">8. Closing notes</a></h2>

<p>
Well, that's it! I'm hoping that the content included here inspired you to some extent, or
helped you solve a specific problem or two. Since this guide is incredibly niche, if you made it
this far, your feedback would be greatly appreciated. If you are so inclined, drop me a mail at
<a href="mailto:lcamtuf@coredump.cx">lcamtuf@coredump.cx</a>.
</p>

<p>
In any case, good luck in your future work!
</p>

<!-- START~FOOTER~ -->




</div>]]></description>
        </item>
        <item>
            <title><![CDATA[Nuclear Fusion's New Idea: An Off-the-Shelf Stellarator (103 pts)]]></title>
            <link>https://spectrum.ieee.org/the-off-the-shelf-stellarator</link>
            <guid>41988799</guid>
            <pubDate>Tue, 29 Oct 2024 20:11:18 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://spectrum.ieee.org/the-off-the-shelf-stellarator">https://spectrum.ieee.org/the-off-the-shelf-stellarator</a>, See on <a href="https://news.ycombinator.com/item?id=41988799">Hacker News</a></p>
<div id="readability-page-1" class="page"><p>Researchers Michael Zarnstorff [left] and Kenneth Hammond at the Princeton Plasma Physics Laboratory run nuclear-fusion reactions in a stellarator built with mostly off-the-shelf parts.  </p><div data-headline="Nuclear Fusion’s New Idea: An Off-the-Shelf Stellarator"><p><strong>For a machine that’s</strong> designed to replicate a star, the world’s newest stellarator is a surprisingly humble-looking apparatus. The kitchen-table-size contraption sits atop stacks of bricks in a cinder-block room at the <a href="https://www.pppl.gov/" target="_blank">Princeton Plasma Physics Laboratory</a> (PPPL) in Princeton, N.J., its parts hand-labeled in marker.
</p><p>
	The PPPL team invented this nuclear-fusion reactor, completed last year, using mainly off-the-shelf components. Its core is a glass vacuum chamber surrounded by a 3D-printed nylon shell that anchors 9,920 meticulously placed permanent rare-earth magnets. Sixteen copper-coil electromagnets resembling giant slices of pineapple wrap around the shell crosswise.
</p><p>
	The arrangement of magnets forms the defining feature of a stellarator: an entirely external magnetic field that directs charged particles along a spiral path to confine a superheated plasma. Within this enigmatic fourth state of matter, atoms that have been stripped of their electrons collide, their nuclei fusing and releasing energy in the same process that powers the sun and other stars. Researchers hope to capture this energy and use it to produce clean, zero-carbon electricity.
</p><p>
	PPPL’s new reactor is the first stellarator built at this government lab in 50 years. It’s also the world’s first stellarator to employ permanent magnets, rather than just electromagnets, to coax plasma into an optimal three-dimensional shape. Costing only US $640,000 and built in less than a year, the device stands in contrast to prominent stellarators like Germany’s 
	<a href="https://www.ipp.mpg.de/w7x" target="_blank">Wendelstein 7-X,</a> a massive, tentacled machine that took $1.1 billion and more than 20 years to construct.
</p><p><img alt="A tabletop machine with many wires coming from it in a research lab" data-rm-shortcode-id="6927c13f79a03ea22be3f16df908730b" data-rm-shortcode-name="rebelmouse-image" data-runner-src="https://spectrum.ieee.org/media-library/a-tabletop-machine-with-many-wires-coming-from-it-in-a-research-lab.png?id=53887480&amp;width=980" height="2899" id="c9855" lazy-loadable="true" src="https://spectrum.ieee.org/media-library/a-tabletop-machine-with-many-wires-coming-from-it-in-a-research-lab.png?id=53887480&amp;width=980" width="3900"><small placeholder="Add Photo Caption...">Sixteen copper-coil electromagnets resembling giant slices of pineapple wrap around the stellarator’s shell.  </small><small placeholder="Add Photo Credit...">Jayme Thornton </small></p><p>
	PPPL researchers say their simpler machine demonstrates a way to build stellarators far more cheaply and quickly, allowing researchers to easily test new concepts for future fusion power plants. The team’s use of permanent magnets may not be the ticket to producing commercial-scale energy, but PPPL’s accelerated design-build-test strategy could crank out new insights on plasma behavior that could push the field forward more rapidly.
</p><p>
	Indeed, the team’s work has already spurred the formation of two stellarator startups that are testing their own PPPL-inspired designs, which their founders hope will lead to breakthroughs in the quest for fusion energy.
</p><h2>Are Stellarators the Future of Nuclear Fusion?</h2><p>
	The pursuit of energy production through nuclear fusion is considered by many to be the holy grail of clean energy. And it’s become increasingly important as a rapidly warming climate and soaring electricity demand have made the need for stable, carbon-free power ever more acute. Fusion offers the prospect of a nearly limitless source of energy with no greenhouse gas emissions. And unlike conventional nuclear fission, fusion comes with no risk of meltdowns or weaponization, and no long-lived nuclear waste.
</p><p>
	Fusion reactions have powered the sun since it formed an estimated 4.6 billion years ago, but they have never served to produce usable energy on Earth, despite 
	<a href="https://spectrum.ieee.org/5-big-ideas-for-making-fusion-power-a-reality" target="_self">decades of effort.</a> The problem isn’t whether fusion can work. Physics laboratories and even a few individuals have successfully fused the nuclei of hydrogen, liberating energy. But to <a href="https://spectrum.ieee.org/nuclear-fusion-breakthrough-long-road" target="_self">produce more power</a> than is consumed in the process, simply fusing atoms isn’t enough.
</p><p><img alt="A mosaic of square-shaped magnets inside a curved structure" data-rm-shortcode-id="3fdda0c90340b8ed483dd2b33831001e" data-rm-shortcode-name="rebelmouse-image" data-runner-src="https://spectrum.ieee.org/media-library/a-mosaic-of-square-shaped-magnets-inside-a-curved-structure.png?id=53887592&amp;width=980" height="2899" id="cebfd" lazy-loadable="true" src="https://spectrum.ieee.org/media-library/a-mosaic-of-square-shaped-magnets-inside-a-curved-structure.png?id=53887592&amp;width=980" width="3900"><small placeholder="Add Photo Caption...">Fueled by free pizza, grad students meticulously placed 9,920 permanent rare-earth magnets inside the stellarator’s 3D-printed nylon shell. </small><small placeholder="Add Photo Credit...">Jayme Thornton </small></p><p>
	The past few years have brought eye-opening advances from government-funded fusion programs such as PPPL and the 
	<a href="https://ccfe.ukaea.uk/programmes/joint-european-torus/" target="_blank">Joint European Torus</a>, as well as <a href="https://spectrum.ieee.org/5-big-ideas-for-making-fusion-power-a-reality" target="_self">private companies</a>. Enabled by gains in high-speed computing, <a href="https://spectrum.ieee.org/topic/artificial-intelligence/">artificial intelligence</a>, and materials science, nuclear physicists and engineers are toppling longstanding technical hurdles. And stellarators, a once-overlooked approach, are back in the spotlight.
</p><p>
	“Stellarators are one of the most active research areas now, with new papers coming out just about every week,” says 
	<a href="https://www.pppl.gov/speakers/scott-hsu" target="_blank">Scott Hsu</a>, the U.S. Department of Energy’s lead fusion coordinator. “We’re seeing new optimized designs that we weren’t capable of coming up with even 10 years ago. The other half of the story that’s just as exciting is that new superconductor technology and advanced manufacturing capabilities are making it more possible to actually realize these exquisite designs.”
</p><h2>Why Is Plasma Containment Important in Fusion Energy?</h2><p>
	For atomic nuclei to fuse, the nuclei must overcome their natural electrostatic repulsion. Extremely high temperatures—in the millions of degrees—will get the particles moving fast enough to collide and fuse. Deuterium and tritium, isotopes of hydrogen with, respectively, one and two neutrons in their nuclei, are the preferred fuels for fusion because their nuclei can overcome the repulsive forces more easily than those of heavier atoms.
</p><p>
	Heating these isotopes to the required temperatures strips electrons from the atomic nuclei, forming a plasma: a maelstrom of positively charged nuclei and negatively charged electrons. The trick is keeping that searingly hot plasma contained so that some of the nuclei fuse.
</p><p>
	Currently, there are two main approaches to containing plasma. 
	<a href="https://spectrum.ieee.org/national-ignition-facility-impractical" target="_self">Inertial confinement</a> uses high-energy <a href="https://spectrum.ieee.org/tag/lasers">lasers</a> or ion beams to rapidly compress and heat a small fuel pellet. Magnetic confinement uses powerful magnetic fields to guide the charged particles along magnetic-field lines, preventing these particles from drifting outward.
</p><p>
	Many 
	<a href="https://spectrum.ieee.org/fusion-2662267312" target="_self">magnetic-confinement</a> designs—including the $24.5 billion <a href="https://www.iter.org/" target="_blank">ITER reactor</a> under construction since 2010 in the hills of southern France—use an internal current flowing through the plasma to help to shape the magnetic field. But this current can create instabilities, and even small instabilities in the plasma can cause it to escape confinement, leading to energy losses and potential damage to the hardware.
</p><p>
	Stellarators like PPPL’s are a type of magnetic confinement, with a twist.
</p><h2>How the Stellarator Was Born</h2><p>
	Located at the end of Stellarator Road and a roughly 5-kilometer drive from 
	<a href="https://www.princeton.edu/" target="_blank">Princeton University</a>’s leafy campus, PPPL is one of 17 U.S. Department of Energy labs, and it employs about 800 scientists, engineers, and other workers. Hanging in PPPL’s lobby is a black-and-white photo of the lab’s founder, physicist <a href="https://en.wikipedia.org/wiki/Lyman_Spitzer" target="_blank">Lyman Spitzer</a>, smiling as he shows off the fanciful-looking apparatus he invented and dubbed a stellarator, or “star generator.”
</p><p>
	According to the lab’s lore, Spitzer came up with the idea while riding a ski lift at Aspen Mountain in 1951. Enrico Fermi had observed that a simple toroidal, or doughnut-shaped, magnetic-confinement system wouldn’t be sufficient to contain plasma for nuclear fusion because the charged particles would drift outward and escape confinement.
</p><p><span>“This technology is designed to be a </span><span>stepping stone</span> toward a fusion power plant.”</p><p>
	Spitzer determined that a figure-eight design with external magnets could create helical magnetic-field lines that would spiral around the plasma and more efficiently control and contain the energetic particles. That configuration, Spitzer reasoned, would be efficient enough that it wouldn’t require large currents running through the plasma, thus reducing the risk of instabilities and allowing for steady-state operation.
</p><p>
	“In many ways, Spitzer’s brilliant idea was the perfect answer” to the problems of plasma confinement, says Steven Cowley, PPPL’s director since 2018. “The stellarator offered something that other approaches to fusion energy couldn’t: a stable plasma field that can sustain itself without any internal current.”
</p><p>
	Spitzer’s stellarator quickly captured the imagination of midcentury nuclear physicists and engineers. But the invention was ahead of its time.
</p><h2>Tokamaks vs. Stellarators</h2><p>
	The stellarator’s lack of toroidal symmetry made it challenging to build. The external magnetic coils needed to be precisely engineered into complex, three-dimensional shapes to generate the twisted magnetic fields required for stable plasma confinement. In the 1950s, researchers lacked the high-performance computers needed to design optimal three-dimensional magnetic fields and the engineering capability to build machines with the requisite precision.
</p><p>
	Meanwhile, physicists in the Soviet Union were testing a new configuration for magnetically confined nuclear fusion: a doughnut-shaped device called a tokamak—a Russian acronym that stands for “toroidal chamber with magnetic coils.” Tokamaks bend an externally applied magnetic field into a helical field inside by sending a current through the plasma. They seemed to be able to produce plasmas that were hotter and denser than those produced by stellarators. And compared with the outrageously complex geometry of stellarators, the symmetry of the tokamaks’ toroidal shape made them much easier to build.
</p><p><img alt="Black and white photo of a man standing in front of a table-top-sized machine " data-rm-shortcode-id="d20dc74070e893aa34c227e84ba1de05" data-rm-shortcode-name="rebelmouse-image" data-runner-src="https://spectrum.ieee.org/media-library/black-and-white-photo-of-a-man-standing-in-front-of-a-table-top-sized-machine.png?id=53887602&amp;width=980" height="1800" id="9d143" lazy-loadable="true" src="https://spectrum.ieee.org/media-library/black-and-white-photo-of-a-man-standing-in-front-of-a-table-top-sized-machine.png?id=53887602&amp;width=980" width="2394"><small placeholder="Add Photo Caption...">Lyman Spitzer in the early 1950s built the first stellarator, using a figure-eight design and external magnets. </small><small placeholder="Add Photo Credit...">PPPL </small></p><p>
	Following the lead of other nations’ fusion programs, the DOE shifted most of its fusion resources to tokamak research. PPPL converted Spitzer’s Model C stellarator into a tokamak 
	<a href="https://www.pppl.gov/timeline" target="_blank">in 1969</a>.
</p><p>
	Since then, tokamaks have dominated fusion-energy research. But by the late 1980s, the limitations of the approach were becoming more apparent. In particular, the currents that run through a tokamak’s plasma to stabilize and heat it are themselves a source of instabilities as the currents get stronger.
</p><p>
	To force the restive plasma into submission, the geometrically simple tokamaks need additional features that increase their complexity and cost. Advanced tokamaks—there are about 60 currently operating—have systems for heating and controlling the plasma and massive arrays of magnets to create the confining magnetic fields. They also have cryogenics to cool the magnets to superconducting temperatures a few meters away from a 150 million °C plasma.
</p><p>
	Tokamaks thus far have produced energy only in short pulses. “After 70 years, nobody really has even a good concept for how to make a steady-state tokamak,” notes 
	<a href="https://scholar.google.com/citations?user=XOsKcawAAAAJ&amp;hl=en" target="_blank">Michael Zarnstorff</a>, a staff research physicist at PPPL. “The longest pulse so far is just a few minutes. When we talk to electric utilities, that’s not actually what they want to buy.”
</p><h2>Computational Power Revives the Stellarator</h2><p>
	With tokamaks gobbling up most of the world’s public fusion-energy funds, stellarator research lay mostly dormant until the 1980s. Then, some theorists started to put increasingly powerful computers to work to help them optimize the placement of magnetic coils to more precisely shape the magnetic fields.
</p><p>
	The effort got a boost in 1981, when then-PPPL physicist 
	<a href="https://www.apam.columbia.edu/faculty/allen-boozer" target="_blank">Allen Boozer</a> invented a coordinate system—known in the physics community as <a href="https://www.osti.gov/biblio/1822272" rel="noopener noreferrer" target="_blank">Boozer coordinates</a>—that helps scientists understand how different configurations of magnets affect magnetic fields and plasma confinement. They can then design better devices to maintain stable plasma conditions for fusion. Boozer coordinates can also reveal <a href="https://hiddensymmetries.princeton.edu/" target="_blank">hidden symmetries</a> in the three-dimensional magnetic-field structure, which aren’t easily visible in other coordinate systems. These symmetries can significantly improve plasma confinement, reduce energy losses, and make the fusion process more efficient.
</p><p>
	“We’re seeing new optimized designs we weren’t capable of coming up with 10 years ago.”
</p><p>“The accelerating computational power finally allowed researchers to challenge the so-called fatal flaw of stellarators: the lack of toroidal symmetry,” says Boozer, who is now a professor of applied physics at Columbia University.
</p><p>
	The new insights gave rise to stellarator designs that were far more complex than anything Spitzer could have imagined [see sidebar, “Trailblazing Stellarators”]. Japan’s 
	<a href="https://www-lhd.nifs.ac.jp/pub/index_e.html" target="_blank">Large Helical Device</a> came online in 1998 after eight years of construction. The University of Wisconsin’s <a href="https://hsx.wisc.edu/" rel="noopener noreferrer" target="_blank">Helically Symmetric Experiment</a>, whose magnetic-field coils featured an innovative quasi-helical symmetry, took nine years to build and began operation in 1999. And Germany’s Wendelstein 7-X—the largest and most advanced stellarator ever built—produced its <a href="https://spectrum.ieee.org/wendelstein-7x-really-starts-up" target="_self">first plasma in 2015</a>, after more than 20 years of design and construction.
</p><h2>Experiment Failure Leads to New Stellarator Design </h2><p>
	In the late 1990s, PPPL physicists and engineers began designing their own version, called the National Compact Stellarator Experiment (NCSX). Envisioned as the world’s most advanced stellarator, it employed a new magnetic-confinement concept called quasi-axisymmetry—a compromise that mimics the symmetry of a tokamak while retaining the stability and confinement benefits of a stellarator by using only externally generated magnetic fields.
</p><p>
	“We tapped into every supercomputer we could find,” says Zarnstorff, who led the NCSX design team, “performing simulations of hundreds of thousands of plasma configurations to optimize the physics properties.”
</p><div id="rebelltitem2" data-id="2" data-reload-ads="false" data-is-image="False" data-href="https://spectrum.ieee.org/the-off-the-shelf-stellarator/particle-2" data-basename="particle-2" data-post-id="2669483372" data-published-at="1729881510" data-use-pagination="False"><p>But the design was, like Spitzer’s original invention, ahead of its time. Engineers struggled to meet the precise tolerances, which allowed for a maximum variation from assigned dimensions of only 1.5 millimeters across the entire device. In 2008, with the project tens of millions of dollars over budget and years behind schedule, NCSX was canceled. “That was a very sad day around here,” says Zarnstorff. “We got to build all the pieces, but we never got to put it together.”</p><p>Now, a segment of the NCSX vacuum vessel—a contorted hunk made from the superalloy Inconel—towers over a lonely corner of the C-Site Stellarator Building on PPPL’s campus. But if its presence is a reminder of failure, it is equally a reminder of the lessons learned from the $70 million project.</p><p>For Zarnstorff, the most important insights came from the engineering postmortem. Engineers concluded that, even if they had managed to successfully build and operate NCSX, it was doomed by the lack of a viable way to take the machine apart for repairs or reconfigure the magnets and other components.</p><p>With the experience gained from NCSX and PPPL physicists’ ongoing collaborations with the costly, delay-plagued Wendelstein 7-X program, the path forward became clearer. “Whatever we built next, we knew we needed to make it less expensively and more reliably,” says Zarnstorff. “And we knew we needed to build it in a way that would allow us to take the thing apart.”</p><h2>A Testbed for Fusion Energy</h2><p>In 2014, Zarnstorff began thinking about building a first-of-its-kind stellarator that would use permanent magnets, rather than electromagnets, to create its helical field, while retaining electromagnets to shape the toroidal field. (Electromagnets generate a magnetic field when an electric current flows through them and can be turned on or off, whereas permanent magnets produce a constant magnetic field without needing an external power source.)</p><p>Even the strongest permanent magnets wouldn’t be capable of confining plasma robustly enough to produce commercial-scale fusion power. But they could be used to create a lower-cost experimental device that would be easier to build and maintain. And that, crucially, would allow researchers to easily adjust and test magnetic fields that could inform the path to a power-producing device.</p><p>PPPL dubbed the device Muse. “Muse was envisioned as a testbed for innovative magnetic configurations and improving theoretical models,” says PPPL research physicist <a href="https://www.pppl.gov/people/kenneth-hammond" target="_blank">Kenneth Hammond</a>, who is now leading the project. “Rather than immediate commercial application, it’s more focused on exploring fundamental aspects of stellarator design and plasma behavior.”</p><p>The Muse team designed the reactor with two independent sets of magnets. To coax charged particles into a corkscrew-like trajectory, small permanent neodymium magnets are arranged in pairs and mounted to a dozen 3D-printed panels surrounding the glass vacuum chamber, which was custom-made by glass blowers. Adjacent rows of magnets are oriented in opposite directions, twisting the magnetic-field lines at the outside edges.</p><p>Outside the shell, 16 electromagnets composed of circular copper coils generate the toroidal part of the magnetic field. These very coils were mass-produced by PPPL in the 1960s, and they have been a workhorse for rapid prototyping in numerous physics laboratories ever since.</p><p>“In terms of its ability to confine particles, Muse is two orders of magnitude better than any stellarator previously built,” says Hammond. “And because it’s the first working stellarator with quasi-axisymmetry, we will be able to test some of the theories we never got to test on NCSX.”</p><p>The neodymium magnets are a little bigger than a button magnet that might be used to hold a photo to a refrigerator door. Despite their compactness, they pack a remarkable punch. During my visit to PPPL, I turned a pair of magnets in my hands, alternating their polarities, and found it difficult to push them together and pull them apart.</p><p>Graduate students did the meticulous work of placing and securing the magnets. “This is a machine built on pizza, basically,” says Cowley, PPPL’s director. “You can get a lot out of graduate students if you give them pizza. There may have been beer too, but if there was, I don’t want to know about it.”</p><p>The Muse project was financed by internal R&amp;D funds and used mostly off-the-shelf components. “Having done it this way, I would never choose to do it any other way,” Zarnstorff says.</p><h2>Stellarex and Thea Energy Advance Stellarator Concepts</h2><p>Now that Muse has demonstrated that stellarators can be made quickly, cheaply, and highly accurately, companies founded by current and former PPPL researchers are moving forward with Muse-inspired designs.</p><p>Zarnstorff recently cofounded a company called <a href="https://stellarex.energy/" rel="noopener noreferrer" target="_blank">Stellarex</a>. He says he sees stellarators as the best path to fusion energy, but he hasn’t landed on a magnet configuration for future machines. “It may be a combination of permanent and superconducting electromagnets, but we’re not religious about any one particular approach; we’re leaving those options open for now.” The company has secured some DOE research grants and is now focused on raising money from investors.</p><p><a href="https://thea.energy/" rel="noopener noreferrer" target="_blank">Thea Energy</a>, a startup led by <a href="https://thea.energy/history" rel="noopener noreferrer" target="_blank">David Gates</a>, who until recently was the head of stellarator physics at PPPL, is further along with its power-plant concept. Like Muse, Thea focuses on simplified manufacture and maintenance. Unlike Muse, the Thea concept uses planar (flat) electromagnetic coils built of high-temperature <a href="https://spectrum.ieee.org/tag/superconductors">superconductors</a>.</p></div><div id="rebelltitem3" data-id="3" data-reload-ads="false" data-is-image="False" data-href="https://spectrum.ieee.org/the-off-the-shelf-stellarator/particle-3" data-basename="particle-3" data-post-id="2669483372" data-published-at="1729881510" data-use-pagination="False"><p><span data-rm-shortcode-id="dd61baf5e768274b8337704aa0cb5562"><iframe type="lazy-iframe" data-runner-src="https://www.youtube.com/embed/LT7QZqE4RuQ?rel=0" width="100%" height="auto" frameborder="0" scrolling="no"></iframe></span></p><p>
	Thea Energy
</p></div><div id="rebelltitem4" data-id="4" data-reload-ads="false" data-is-image="False" data-href="https://spectrum.ieee.org/the-off-the-shelf-stellarator/particle-4" data-basename="particle-4" data-post-id="2669483372" data-published-at="1729881510" data-use-pagination="False"><p>
	“The idea is to use hundreds of small electromagnets that behave a lot like permanent magnets, with each creating a dipole field that can be switched on and off,” says Gates. “By using so many individually actuated coils, we can get a high degree of control, and we can dynamically adjust and shape the magnetic fields in real time to optimize performance and adapt to different conditions.”
</p><p>
	The company has raised more than $23 million and is designing and prototyping its initial project, which it calls Eos, in Kearny, N.J. “At first, it will be focused on producing neutrons and isotopes like tritium,” says Gates. “The technology is designed to be a stepping stone toward a fusion power plant called Helios, with the potential for near-term commercialization.”
</p><h2>Stellarator Startup Leverages Exascale Computing</h2><p>
	Of all the private stellarator startups, <a href="https://typeoneenergy.com/home/" target="_blank">Type One Energy</a> is the most well funded, having raised $82.5 million from investors that include Bill Gates’s <a href="https://www.breakthroughenergy.org/" rel="noopener noreferrer" target="_blank">Breakthrough Energy Ventures</a>. Type One’s leaders contributed to the design and construction of both the University of Wisconsin’s Helically Symmetric Experiment and Germany’s Wendelstein 7-X stellarators.
</p><p>
	The Type One stellarator design utilizes a highly optimized magnetic-field configuration designed to improve plasma confinement. Optimization can relax the stringent construction tolerances typically required for stellarators, making them easier and more cost-effective to engineer and build.
</p><p>
	Type One’s design, like that of Thea Energy’s Eos, makes use of <a href="https://spectrum.ieee.org/high-temperature-superconductors" target="_self">high-temperature superconducting magnets</a>, which provide higher magnetic strength, require less cooling power, and could lower costs and allow for a more compact and efficient reactor. The magnets were designed for a tokamak, but Type One is modifying the coil structure to accommodate the intricate twists and turns of a stellarator.
</p><p>
	In a sign that stellarator research may be moving from mainly scientific experiments into the race to field the first commercially viable reactor, Type One recently announced that it will build “the world’s most advanced stellarator” at the Bull Run Fossil Plant in Clinton, Tenn. To construct what it’s calling Infinity One—expected to be operational by early 2029—Type One is teaming up with the <a href="https://www.tva.com/" rel="noopener noreferrer" target="_blank">Tennessee Valley Authority</a> and the DOE’s <a href="https://www.ornl.gov/" rel="noopener noreferrer" target="_blank">Oak Ridge National Laboratory</a>.
</p><p>
	“As an engineering testbed, Infinity One will not be producing energy,” says Type One CEO <a href="https://www.linkedin.com/in/chris-mowry-397108a/" rel="noopener noreferrer" target="_blank">Chris Mowry</a>. “Instead, it will allow us to retire any remaining risks and sign off on key features of the fusion pilot plant we are currently designing. Once the design validations are complete, we will begin the construction of our pilot plant to put fusion electrons on the grid.”
</p><p>
	To help optimize the magnetic-field configuration, Mowry and his colleagues are utilizing <a href="https://spectrum.ieee.org/with-summit-supercomputer-us-could-retake-computings-top-spot" target="_self">Summit</a>, one of Oak Ridge’s state-of-the-art exascale supercomputers. Summit is capable of performing more than 200 million times as many operations per second as the supercomputers of the early 1980s, when Wendelstein 7-X was first conceptualized.
</p><h2>AI Boosts Fusion Reactor Efficiency</h2><p>
	Advances in computational power are already leading to faster design cycles, greater plasma stability, and better reactor designs. Ten years ago, an analysis of a million different configurations would have taken months; now a researcher can get answers in hours.
</p><p>
	And yet, there are an infinite number of ways to make any particular magnetic field. “To find our way to an optimum fusion machine, we may need to consider something like 10 billion configurations,” says PPPL’s Cowley. “If it takes months to make that analysis, even with high-performance computing, that’s still not a route to fusion in a short amount of time.”
</p><p>
	In the hope of shortcutting some of those steps, PPPL and other labs are investing in artificial intelligence and using surrogate models that can search and then rapidly home in on promising solutions. “Then, you start running progressively more precise models, which bring you closer and closer to the answer,” Cowley says. “That way we can converge on something in a useful amount of time.”
</p><p>
	But the biggest remaining hurdles for stellarators, and magnetic-confinement fusion in general, involve engineering challenges rather than physics challenges, say Cowley and other fusion experts. These include developing materials that can withstand extreme conditions, managing heat and power efficiently, advancing magnet technology, and integrating all these components into a functional and scalable reactor.
</p><p>
	Over the past half decade, the vibe at PPPL has grown increasingly optimistic, as new buildings go up and new researchers arrive on Stellarator Road to become part of what may be the grandest scientific challenge of the 21st century: enabling a world powered by safe, plentiful, carbon-free energy.
</p><p>
	PPPL recently broke ground on a new $110 million office and laboratory building that will house theoretical and computational scientists and support the work in artificial intelligence and high-performance computing that is increasingly propelling the quest for fusion. The new facility will also provide space for research supporting PPPL’s expanded mission into microelectronics, quantum sensors and devices, and sustainability sciences.
</p><p>
	PPPL researchers’ quest will take a lot of hard work and, probably, a fair bit of luck. Stellarator Road may be only a mile long, but the path to success in fusion energy will certainly stretch considerably farther. <span></span></p></div><p><em>This article appears in the November 2024 print issue as “An Off-the- Shelf Stellarator.”</em></p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[GLP-1 for Everything (147 pts)]]></title>
            <link>https://www.science.org/content/blog-post/glp-1-everything</link>
            <guid>41988285</guid>
            <pubDate>Tue, 29 Oct 2024 19:15:30 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.science.org/content/blog-post/glp-1-everything">https://www.science.org/content/blog-post/glp-1-everything</a>, See on <a href="https://news.ycombinator.com/item?id=41988285">Hacker News</a></p>
Couldn't get https://www.science.org/content/blog-post/glp-1-everything: Error: Request failed with status code 403]]></description>
        </item>
        <item>
            <title><![CDATA[PhD student finds lost city in Mexico jungle (163 pts)]]></title>
            <link>https://www.bbc.com/news/articles/crmznzkly3go</link>
            <guid>41988171</guid>
            <pubDate>Tue, 29 Oct 2024 19:04:15 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.bbc.com/news/articles/crmznzkly3go">https://www.bbc.com/news/articles/crmznzkly3go</a>, See on <a href="https://news.ycombinator.com/item?id=41988171">Hacker News</a></p>
<div id="readability-page-1" class="page"><article><p data-component="headline-block"><h2>PhD student finds lost city in Mexico jungle by accident<!-- --></h2></p><p data-component="caption-block"><figcaption>What discovered Mayan city Valeriana might have looked ike<!-- --></figcaption></p><div data-component="text-block"><p>A huge Maya city has been discovered centuries after it disappeared under jungle canopy in Mexico.<!-- --></p><p>Archaeologists found pyramids, sports fields, causeways connecting districts and amphitheatres in the southeastern state of Campeche.<!-- --></p><p><a target="_self" href="https://www.bbc.co.uk/news/av/world-africa-45836912">They uncovered the hidden complex<!-- --></a> - which they have called Valeriana - using Lidar, a type of laser survey that maps structures buried under vegetation.<!-- --></p><p>They believe it is second in density only to Calakmul, thought to be the largest Maya site in ancient Latin America.<!-- --></p><p>The team discovered three sites in total, in a survey area the size of Scotland's capital Edinburgh, “by accident” when one archaeologist browsed data on the internet.<!-- --></p></div><div data-component="text-block"><p>“I was on something like page 16 of Google search and found a laser survey done by a Mexican organisation for environmental monitoring,” explains Luke Auld-Thomas, a PhD student at Tulane university in the US.<!-- --></p><p>It was a Lidar survey, a remote sensing technique which fires thousands of laser pulses from a plane and maps objects below using the time the signal takes to return.<!-- --></p><p>But when Mr Auld-Thomas processed the data with methods used by archaeologists, he saw what others had missed - a huge ancient city which may have been home to 30-50,000 people at its peak from 750 to 850 AD.<!-- --></p><p>That is more than the number of people who live in the region today, the researchers say.<!-- --></p><p>Mr Auld-Thomas and his colleagues named the city Valeriana after a nearby lagoon.<!-- --></p><p>The find helps change an idea in Western thinking that the Tropics was where “civilisations went to die”, says Professor Marcello Canuto, a co-author in the research. <!-- --></p><p>Instead, this part of the world was home to rich and complex cultures, he explains.<!-- --></p><p>We can’t be sure what led to the demise and eventual abandonment of the city, but the archaeologists say climate change was a major factor.<!-- --></p></div><figure><div data-component="image-block"><p><img src="https://www.bbc.com/bbcx/grey-placeholder.png"><img sizes="(min-width: 1280px) 50vw, (min-width: 1008px) 66vw, 96vw" srcset="https://ichef.bbci.co.uk/news/240/cpsprodpb/443d/live/f774e910-95b8-11ef-bf59-99b64fa9486e.jpg.webp 240w,https://ichef.bbci.co.uk/news/320/cpsprodpb/443d/live/f774e910-95b8-11ef-bf59-99b64fa9486e.jpg.webp 320w,https://ichef.bbci.co.uk/news/480/cpsprodpb/443d/live/f774e910-95b8-11ef-bf59-99b64fa9486e.jpg.webp 480w,https://ichef.bbci.co.uk/news/640/cpsprodpb/443d/live/f774e910-95b8-11ef-bf59-99b64fa9486e.jpg.webp 640w,https://ichef.bbci.co.uk/news/800/cpsprodpb/443d/live/f774e910-95b8-11ef-bf59-99b64fa9486e.jpg.webp 800w,https://ichef.bbci.co.uk/news/1024/cpsprodpb/443d/live/f774e910-95b8-11ef-bf59-99b64fa9486e.jpg.webp 1024w,https://ichef.bbci.co.uk/news/1536/cpsprodpb/443d/live/f774e910-95b8-11ef-bf59-99b64fa9486e.jpg.webp 1536w" src="https://ichef.bbci.co.uk/news/480/cpsprodpb/443d/live/f774e910-95b8-11ef-bf59-99b64fa9486e.jpg.webp" loading="lazy" alt="Getty Images A photograph of the Calakmul Mayan temple pyramid ruins in Campeche, Mexico"><span>Getty Images</span></p></div><p data-component="caption-block"><figcaption>There are no pictures of the city but it had pyramid temples similar to this one in nearby Calakmul<!-- --></figcaption></p></figure><div data-component="text-block"><p>Valeriana has the “hallmarks of a capital city” and was second only in density of buildings to the spectacular Calakmul site, around 100km away (62 miles).<!-- --></p><p><a target="_self" href="https://www.bbc.co.uk/news/world-latin-america-46374651">It is “hidden in plain sight”<!-- --></a>, the archaeologists say, as it is just 15 minutes hike from a major road near Xpujil where mostly Maya people now live.<!-- --></p><p>There are no known pictures of the lost city because “no-one has ever been there”, the researchers say, although local people may have suspected there were ruins under the mounds of earth.<!-- --></p><p>The city, which was about 16.6 sq km, had two major centres with large buildings around 2km (1.2 miles) apart, linked by dense houses and causeways. <!-- --></p><p>It has two plazas with temple pyramids, where Maya people would have worshipped, hidden treasures like jade masks and buried their dead.<!-- --></p><p>It also had a court where people would have played an ancient ball game.<!-- --></p><ul><li><a target="_self" href="https://www.bbc.com/future/article/20241028-lost-cities-how-maya-ruins-have-withstood-the-test-of-time">How ancient Maya cities have withstood the ravages of time<!-- --></a></li></ul><p>There was also evidence of a reservoir, indicating that people used the landscape to support a large population.<!-- --></p><p>In total, Mr Auld-Thomas and Prof Canuto surveyed three different sites in the jungle. They found 6,764 buildings of various sizes.<!-- --></p></div><figure><div data-component="image-block"><p><img src="https://www.bbc.com/bbcx/grey-placeholder.png"><img sizes="(min-width: 1280px) 50vw, (min-width: 1008px) 66vw, 96vw" srcset="https://ichef.bbci.co.uk/news/240/cpsprodpb/b5eb/live/3a18f290-953a-11ef-89ae-5575c76d98e6.png.webp 240w,https://ichef.bbci.co.uk/news/320/cpsprodpb/b5eb/live/3a18f290-953a-11ef-89ae-5575c76d98e6.png.webp 320w,https://ichef.bbci.co.uk/news/480/cpsprodpb/b5eb/live/3a18f290-953a-11ef-89ae-5575c76d98e6.png.webp 480w,https://ichef.bbci.co.uk/news/640/cpsprodpb/b5eb/live/3a18f290-953a-11ef-89ae-5575c76d98e6.png.webp 640w,https://ichef.bbci.co.uk/news/800/cpsprodpb/b5eb/live/3a18f290-953a-11ef-89ae-5575c76d98e6.png.webp 800w,https://ichef.bbci.co.uk/news/1024/cpsprodpb/b5eb/live/3a18f290-953a-11ef-89ae-5575c76d98e6.png.webp 1024w,https://ichef.bbci.co.uk/news/1536/cpsprodpb/b5eb/live/3a18f290-953a-11ef-89ae-5575c76d98e6.png.webp 1536w" src="https://ichef.bbci.co.uk/news/480/cpsprodpb/b5eb/live/3a18f290-953a-11ef-89ae-5575c76d98e6.png.webp" loading="lazy" alt="An illustration showing a map of Valeriana and its location in Mexico."></p></div><p data-component="caption-block"><figcaption>The ruins were found in eastern Mexico, in Campeche<!-- --></figcaption></p></figure><div data-component="text-block"><p>Professor Elizabeth Graham from University College London, who was not involved in the research, says it supports claims that Maya lived in complex cities or towns, not in isolated villages.<!-- --></p><p>"The point is that the landscape is definitely settled - that is, settled in the past - and not, as it appears to the naked eye, uninhabited or ‘wild’," she says.<!-- --></p><p>The research suggests that when Maya civilisations collapsed from 800AD onwards, it was partly because they were so densely populated and could not survive climate problems.<!-- --></p><p>"It's suggesting that the landscape was just completely full of people at the onset of drought conditions and it didn't have a lot of flexibility left. And so maybe the entire system basically unravelled as people moved farther away," says Mr Auld-Thomas.<!-- --></p><p>Warfare and the conquest of the region by Spanish invaders in the 16th century also contributed to eradication of Maya city states.<!-- --></p></div><figure><div data-component="image-block"><p><img src="https://www.bbc.com/bbcx/grey-placeholder.png"><img sizes="(min-width: 1280px) 50vw, (min-width: 1008px) 66vw, 96vw" srcset="https://ichef.bbci.co.uk/news/240/cpsprodpb/17e5/live/a587fba0-9541-11ef-89ae-5575c76d98e6.jpg.webp 240w,https://ichef.bbci.co.uk/news/320/cpsprodpb/17e5/live/a587fba0-9541-11ef-89ae-5575c76d98e6.jpg.webp 320w,https://ichef.bbci.co.uk/news/480/cpsprodpb/17e5/live/a587fba0-9541-11ef-89ae-5575c76d98e6.jpg.webp 480w,https://ichef.bbci.co.uk/news/640/cpsprodpb/17e5/live/a587fba0-9541-11ef-89ae-5575c76d98e6.jpg.webp 640w,https://ichef.bbci.co.uk/news/800/cpsprodpb/17e5/live/a587fba0-9541-11ef-89ae-5575c76d98e6.jpg.webp 800w,https://ichef.bbci.co.uk/news/1024/cpsprodpb/17e5/live/a587fba0-9541-11ef-89ae-5575c76d98e6.jpg.webp 1024w,https://ichef.bbci.co.uk/news/1536/cpsprodpb/17e5/live/a587fba0-9541-11ef-89ae-5575c76d98e6.jpg.webp 1536w" src="https://ichef.bbci.co.uk/news/480/cpsprodpb/17e5/live/a587fba0-9541-11ef-89ae-5575c76d98e6.jpg.webp" loading="lazy" alt="Getty Images Majestic Mayan Pyramid 1 at Calakmul rises above the breathtaking Jungle Canopy for as far as the eye can see on a beautiful day in the Calakmul Biosphere Reserve in Campeche Mexico"><span>Getty Images</span></p></div><p data-component="caption-block"><figcaption>Evidence of the ruins were found by a plane using laser remote sensing to map beneath the jungle canopy<!-- --></figcaption></p></figure><p data-component="subheadline-block"><h2>Many more cities could be found<!-- --></h2></p><div data-component="text-block"><p>Lidar technology has revolutionised how archaeologists survey areas covered in vegetation, like the Tropics, opening up a world of lost civilisations, explains Prof Canuto.<!-- --></p><p>In the early years of his career, surveys were done by foot and hand, using simple instruments to check the ground inch by inch.<!-- --></p><p>But in the decade since Lidar was used in the Mesoamerican region, he says it’s mapped around 10 times the area that archaeologists managed in about a century of work.<!-- --></p><p>Mr Auld-Thomas says his work suggests there are many sites out there that archaeologists have no idea about.<!-- --></p><p>In fact so many sites have been found that researchers cannot hope to excavate them all.<!-- --></p><p>"I've got to go to Valeriana at some point. It's so close to the road, how could you not? But I can't say we will do a project there," says Mr Auld-Thomas. <!-- --></p><p>"One of the downsides of discovering lots of new Maya cities in the era of Lidar is that there are more of them than we can ever hope to study," he adds.<!-- --></p><p>The research is published in the academic journal Antiquity.<!-- --></p></div></article></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Digging into PlantStudio, a Bit Late (131 pts)]]></title>
            <link>https://pketh.org/plantstudio.html</link>
            <guid>41988030</guid>
            <pubDate>Tue, 29 Oct 2024 18:49:31 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://pketh.org/plantstudio.html">https://pketh.org/plantstudio.html</a>, See on <a href="https://news.ycombinator.com/item?id=41988030">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
    <p>This aesthetic screenshot of an old windows app has been in my <a href="https://pketh.org/decade-of-inspiration.html">inspiration space</a> for ~5 years. Until recently, I assumed that it was just a nostalgia bait concept.</p>

<p><img src="https://pketh.org/images/2024/plantstudio/screenMainWindow.gif"></p>

<p>The calm, serene life associated with gardening pairs suspiciously well with rose-tinted wistfulness for a simpler time in computing. I’m happy to be wrong though, because software doesn’t get more real than <a href="https://www.kurtz-fernhout.com/PlantStudio/">PlantStudio</a>.</p>

<p>Written by Kurtz-Fernhout Software, PlantStudio is a surprisingly deep botany simulator for creating and arranging 3D models of <a href="https://www.kurtz-fernhout.com/PlantStudio/help/plantstudioWhat_is_a_herbaceous_plant.html">herbaceous</a> plants based on how real plants grow, change, fruit, and flower, over their life cycles.</p>

<h2 id="how-to-install">How to Install</h2>

<p>Because the last release of the app was in 2002, and it was for Windows 95/98/2000/NT4, we’ve got a little bit of work to do to get it running on macOS:</p>

<p><img src="https://pketh.org/images/2024/plantstudio/sample-flowers.webp" width="150"></p>

<ol>
  <li><a href="https://www.kurtz-fernhout.com/download_new.html">Download <code>PlantStudio210.zip</code></a> and unzip it</li>
  <li><a href="https://getwhisky.app/">Download Whisky</a> to run windows code in a container called a <code>bottle</code></li>
  <li>In Whisky, click <code>+</code> button to create a new bottle (I set it to Windows 10)</li>
  <li>Click <code>Open C: Drive</code> and copy the <code>PlantStudio210</code> folder into <code>Program Files</code></li>
  <li>Click <code>Run</code> and open <code>Program Files/PlantStudio210/PlantStudio.exe</code></li>
</ol>

<p>PlantStudio lives again 🌱🌺</p>

<h2 id="lets-grow-some-3d-plants">Let’s Grow Some 3D Plants</h2>

<p>After you read or skip the tutorial docs, you’re be greeted with an empty window, which is kind of like the ‘garden’ that your plants will live in. One way to jump in is to <code>File → Open</code> some sample files.</p>

<p>The interface is full of unlabelled and unfamiliar icons, but the hover tooltips in PlantStudio are the most verbose I’ve ever seen – which helps a lot.</p>

<figure>
  <img src="https://pketh.org/images/2024/plantstudio/tutorial-tooltip-cropped.webp">
  <figcaption>
    Rotate mode tooltip
  </figcaption>
</figure>

<p>To fill the garden with our own herbs, shrubs, and flowers, use <code>Plant → Create New…</code> which opens the thorough 10-step <code>Plant Wizard</code>, and teaches us some biology terms along the way.</p>


<figure>
  <figcaption>
    Going through the Plant Wizard…
  </figcaption>
</figure>

<p>Each option button has a detailed little illustration that makes the impacts of technical concepts, like ‘inflorescence’, easy to understand.</p>

<p><img src="https://pketh.org/images/2024/plantstudio/button-illustrations.webp"></p>

<p>I also love the wizard progress icons in the footer. Because the colors match the button illustrations, it’s easy to jump from editing stems and leaves (green icons), to editing flower related options (purple icons). The start and stop traffic lights for the intro and confirmation steps serve as cute bookends.</p>



<blockquote>
  <p>Designers can use color to conceptually link related interfaces together. I did this when I <a href="https://pketh.org/redesigning-an-app.html">redesigned Futureland</a> a couple years ago.</p>
</blockquote>

<p>One thing I kept wishing for while creating plants was the ability to see a live preview while I was selecting options. Maybe they didn’t think of that, or maybe the performance impacts would’ve been too much for the minimum required 100MHz CPU of the day.</p>

<h2 id="cultivating-a-garden">Cultivating a Garden</h2>

<p>As you create plants, they’ll appear in the garden area, where you can arrange them by scaling, rotating, editing, posing, and even changing their age.</p>



<p>It took awhile, but by repeatedly creating plants in the wizard and arranging each one, even I could make something pleasant enough:</p>

<p><img src="https://pketh.org/images/2024/plantstudio/my-garden.webp"></p>

<p>I could’ve probably saved some time by selecting one or multiple plants to <code>Plant → Breed</code> to create offspring. The <code>Breeder</code> lets you define how similar the children are from their parents, and adjust the amount of mutation (random chance changes).</p>

<p><img src="https://pketh.org/images/2024/plantstudio/breeder2.webp"></p>

<h2 id="export-options">Export Options</h2>

<p>You can be creative with your plants models by exporting <code>jpg</code>, <code>3ds</code>, or <code>obj</code> files into other art apps. The <a href="https://www.kurtz-fernhout.com/PlantStudio/gallery.htm">official Gallery</a> has a couple y2k-era masterpieces that were composed with whimsical 3D tools like <a href="https://theinnerframe.org/2015/02/14/bryce-3d-an-epitaph/">Bryce</a>, and then polished in 2D art tools like Paintshop Pro and Photoshop.</p>

<figure>
  <img src="https://pketh.org/images/2024/plantstudio/fairy_flowers.jpg">
  <figcaption>
    Artist's note: "I created this picture with Metacreations Poser3, Bryce3 and Photoshop5. I used Photoshop5 to give the violet leaves some texture, and refined the shape of the leaves and petals..."
    <a href="https://www.kurtz-fernhout.com/PlantStudio/gallery_fairyflowers.htm">(source)</a>
  </figcaption>
</figure>

<p>The process for making these images is strikingly similar to what landscape architects do today. Much like how software designers use mockups, architects use 3D renderings to convince clients, to market their work, and as a starting point for working with contractors.</p>

<p><img src="https://pketh.org/images/2024/plantstudio/plantkind.webp"></p>
<figure>
  <figcaption>
    <a href="https://plantkind.earth/">(source, Plantkind)</a>
  </figcaption>
</figure>

<blockquote>
  <div><p>Also, plants look really cool inside <a href="https://kinopio.club/-inspiration--PvOMf-lSAIAC9INOu8_Ex">Kinopio spaces</a>. Maybe I’ll figure out some kind of ‘integration’ in the future…</p><p>
<img src="https://pketh.org/images/2024/plantstudio/in-kinopio-space.webp" alt=""></p></div>
</blockquote>

<h2 id="so-why-am-i-only-finding-out-about-plantstudio-now">So Why Am I Only Finding Out About Plantstudio Now?</h2>

<p>The husband and wife duo <a href="http://pdfernhout.net/">Paul Fernhout</a> and <a href="http://www.cfkurtz.com/">Cynthia Kurtz</a> were the authors behind Kurtz-Fernhout Software. Unsurprisingly, both have degrees in Biology and Ecology.</p>

<p>Their <a href="https://www.kurtz-fernhout.com/historyandfuture.htm">original goal</a> was to build a gardening simulator to “help people understand how to garden in a more sustainable way in their own backyards”. The simulation was based the EPIC (Erosion/Productivity Impact Calculator) agricultural model by the USDA Agricultural Research Service.</p>

<blockquote>
  <p>We worked as a team on most design phases of the project. Paul did most of the low-level coding, the general architecture, the undo/redo system, the file system, the graphical display, and the 3D turtle engine. Cynthia did most of the translation of the EPIC model, the flowering/fruiting submodel, the plant drawing algorithm, the various window designs, and the artwork, music, and documentation.</p>
</blockquote>

<p>PlantStudio was originally built to draw plants for the gardening simulator, but they “found that everyone tended to like the plant designer so much they wanted to play with it instead of with the garden simulator”, so released it separately.</p>

<p>Not entirely dissimilar to the story behind <a href="https://arstechnica.com/gaming/2015/10/from-simcity-to-well-simcity-the-history-of-city-building-games/">SimCity</a>,</p>

<blockquote>
  <p>While developing his first commercial game […], Will Wright noticed that designing city maps for the player to fly over in a helicopter was more fun than actually [playing the game]. He began expanding his world-building tools as an experiment. He applied various urban planning and computer modelling theories, implementing whatever ideas he’d been reading.</p>
</blockquote>

<p><img src="https://pketh.org/images/2024/plantstudio/simcity-windows-lgr.webp"></p>
<figure>
  <figcaption>
    Sticking to the theme, SimCity for Windows
    <a href="https://www.youtube.com/watch?v=TrScy1icWjI">(source)</a>
  </figcaption>
</figure>

<p>Unfortunately, PlantStudio was <a href="https://www.kurtz-fernhout.com/press.htm">discontinued</a> in 2002,</p>

<blockquote>
  <p>What happened to our old software and the plans for it? We spent years working for other people to pay off money (with interest) we borrowed to finish it and free it.</p>
</blockquote>

<p>I empathize with their story because the world is rarely kind to <a href="https://pketh.org/organic-software.html">organic</a> niche creative consumer software. I’m sure the market at the time was a lot more developer friendly overall, but businesses need to always be reaching new people to sell more licenses.</p>

<p>In an alternate universe, maybe PlantStudio could have survived by evolving into a game in the vein of SimCity and SimEarth, e.g. ‘SimGarden’.</p>

<h2 id="incidental-beauty">Incidental Beauty</h2>

<p>There’s something appealing about objects and interfaces built for purpose, like race cars and professional-use espresso machines. In cases like these, beauty feels like a byproduct of an object built to do it’s job well – and there’s something appealingly genuine about that.</p>

<figure>
  <img src="https://pketh.org/images/2024/plantstudio/26marzocco.webp">
  <figcaption>
    Back when I worked at <a href="https://www.joelonsoftware.com/2010/01/26/why-testers">Fog Creek Software</a> there was a $10k Marzocco professional espresso machine in the break room that we were trained on as part of our onboarding. I don’t even like espresso, but I do miss using it sometimes.
  </figcaption>
</figure>

<p>I’d describe PlantStudio the same way. It doesn’t look or work like a modern app, but anyone can figure it out because it’s interface elements are delightfully chunky, unfussy, and well documented by illustrations, inline text, and tooltips.</p>

<p>It’s definetely not for everyone, but the best things rarely are. Creating those gardens gave me a new perspective – and some new ideas – for my own design work.</p>

<p>It took a while, but I’m glad I found PlantStudio.</p>

<p><img src="https://pketh.org/images/2024/plantstudio/sample-flowers2.webp"></p>

<blockquote>
  <p>Special thanks to Ethan from <a href="https://plantkind.earth/">Plantkind</a> for giving me a bit of insight into his landscape architecture practice for this post.</p>
</blockquote>

  </div></div>]]></description>
        </item>
    </channel>
</rss>