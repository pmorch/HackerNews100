<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
    <channel>
        <title>HN100 - Readable Contents</title>
        <link>https://hn.algolia.com/api/v1/search_by_date?tags=%28story,poll%29&amp;numericFilters=points%3E100</link>
        <description>Uses Readability to add bodies to the RSS feed</description>
        <lastBuildDate>Sat, 25 May 2024 15:30:02 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Abusing Go's Infrastructure (130 pts)]]></title>
            <link>https://reverse.put.as/2024/05/24/abusing-go-infrastructure/</link>
            <guid>40474712</guid>
            <pubDate>Sat, 25 May 2024 12:50:00 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://reverse.put.as/2024/05/24/abusing-go-infrastructure/">https://reverse.put.as/2024/05/24/abusing-go-infrastructure/</a>, See on <a href="https://news.ycombinator.com/item?id=40474712">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><article><div><p>I apologize if this information is already known, but I couldn’t find any references about it and I wanted to understand what was going on and share with you because I think there is some value doing it.</p><p>In case this wasn’t known, I apologize to the Go team for not talking to them first and jumping the full disclosure gun (I don’t think it’s that severe). I really like Go! Thanks for all your great work.</p><h3 id="the-problem">The problem</h3><p>Last night, I was exploring the contents of Go’s <a href="https://sum.golang.org/">checksum database</a>, and I noticed a curious result:</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>sqlite</span><span>&gt;</span><span> </span><span>select</span><span> </span><span>path</span><span>,</span><span> </span><span>count</span><span>(</span><span>path</span><span>)</span><span> </span><span>from</span><span> </span><span>modules</span><span> </span><span>group</span><span> </span><span>by</span><span> </span><span>path</span><span> </span><span>order</span><span> </span><span>by</span><span> </span><span>count</span><span>(</span><span>path</span><span>)</span><span> </span><span>desc</span><span>;</span><span>
</span></span></span><span><span><span></span><span>github</span><span>.</span><span>com</span><span>/</span><span>homebrew</span><span>/</span><span>homebrew</span><span>-</span><span>core</span><span>|</span><span>39438</span><span>
</span></span></span><span><span><span></span><span>github</span><span>.</span><span>com</span><span>/</span><span>Homebrew</span><span>/</span><span>homebrew</span><span>-</span><span>core</span><span>|</span><span>30896</span><span>
</span></span></span><span><span><span></span><span>github</span><span>.</span><span>com</span><span>/</span><span>concourse</span><span>/</span><span>concourse</span><span>|</span><span>25372</span><span>
</span></span></span><span><span><span></span><span>github</span><span>.</span><span>com</span><span>/</span><span>openshift</span><span>/</span><span>release</span><span>|</span><span>24065</span><span>
</span></span></span><span><span><span></span><span>github</span><span>.</span><span>com</span><span>/</span><span>cilium</span><span>/</span><span>cilium</span><span>|</span><span>22138</span><span>
</span></span></span></code></pre></div><p>The homebrew/Homebrew case divergence is explained by Go’s <a href="https://go.dev/ref/mod#checksum-database">documentation</a> (thanks to Filippo Valsorda!):</p><blockquote><p>To avoid ambiguity when serving from case-insensitive file systems, the $module and $version elements are case-encoded by replacing every uppercase letter with an exclamation mark followed by the corresponding lower-case letter. This allows modules example.com/M and example.com/m to both be stored on disk, since the former is encoded as example.com/!m.</p></blockquote><p>Anyway, this caught my attention because Homebrew is known to use Ruby, and so I went to check the <a href="https://github.com/homebrew/homebrew-core">repository</a> contents.</p><p>GitHub language stats confirm it:</p><div><figure><picture><source type="image/webp" srcset="https://reverse.put.as/2024/05/24/abusing-go-infrastructure/images/language_hu267d31ab4b55e7f16429a4d30873c6f5_16260_295x0_resize_q80_h2_box_3.webp"><source type="image/png" srcset="https://reverse.put.as/2024/05/24/abusing-go-infrastructure/images/language.png"><img loading="lazy" src="https://reverse.put.as/2024/05/24/abusing-go-infrastructure/images/language.png" alt="language stats"></picture></figure></div><p>This result seems unexpected, since there are no traces of Go and there are more than 70,000 entries in Go’s checksum database. To be sure, I cloned the repository and tried to find any Go-related files such as <code>go.mod</code> or Go source files; however, nothing exists.</p><p>So I posted a tweet (technically a toot on Mastodon), got no replied and moved on.</p><p>While continuing to explore the database, I noticed another unusual case in <code>github.com/Edu4rdSHL/rust-headless-chrome</code>. It’s just a fork of <a href="https://github.com/rust-headless-chrome/rust-headless-chrome">rust-headless-chrome</a>, and there is nothing remarkable about the fork or the original except that they are both Rust repositories, and once again, no connection to Go.</p><p>Now my curiosity is piqued and the evil mode kicks in. It feels like arbitrary data can be pushed to the checksum database without a connection to Go. Why is the data being pushed? And how is it being pushed? I go to bed thinking about this, which is the most dangerous moment for security research. As I try to fall asleep, I come up with tons of ideas, but I’m usually too tired or lazy to take notes, and so, quite frequently, I can’t remember them in the morning. But this one wasn’t forgotten!</p><h3 id="research">Research</h3><p>A new day and a curious mind demands answers. Why, how and, what if are the most dangerous questions in this field. If a Git repository has nothing to do with Go code, how does it appear in the Go checksum database?</p><p>From previous documentation readings, I knew that <code>proxy.golang.org</code> was the default modules proxy, and <code>sum.golang.org</code> for the checksum database. A couple of <code>ripgrep</code> searches in Go source code return nothing interesting, so it was time to read Go’s documentation, which is usually quite good.</p><p>Where to start? <a href="https://go.dev/ref/mod">Go Modules Reference</a> was a great candidate and I finally found the answer to my question:</p><blockquote><p>If the go command consults the checksum database, then the first step is to retrieve the record data through the /lookup endpoint. If the module version is not yet recorded in the log, the checksum database will try to fetch it from the origin server before replying.</p></blockquote><p>Okay, this was easy! If the module doesn’t exist in the checksum database (and proxy), it will be downloaded by the checksum and proxy infrastructure. One of my questions was: how did the checksum database retrieve the modules since they can be anywhere? I couldn’t find anything in the Go code that was responsible for that (which wouldn’t explain at all how Ruby and Rust code ended up in the database).</p><p>So, the next logical step is easy. Can I get the Go checksum server to download arbitrary data?</p><p>According to the <a href="https://go.dev/ref/mod#checksum-database">documentation</a>, the endpoint to try this is <code>$base/lookup/$module@$version</code>:</p><blockquote><p>Returns the log record number for the entry about $module at $version, followed by the data for the record (that is, the go.sum lines for $module at $version) and a signed, encoded tree description that contains the record.</p></blockquote><p>First, let’s test it with a known record to see if and how it works:</p><div><pre tabindex="0"><code data-lang="bash"><span><span>$ curl https://sum.golang.org/lookup/github.com/homebrew/homebrew-core@v0.0.0-20240524162643-646fe2715a1c
</span></span><span><span><span>26235981</span>
</span></span><span><span>github.com/homebrew/homebrew-core v0.0.0-20240524162643-646fe2715a1c h1:U32osaj3vZGypOtq7tsIHhZAYNOmiShiXJysIFGTqyM<span>=</span>
</span></span><span><span>github.com/homebrew/homebrew-core v0.0.0-20240524162643-646fe2715a1c/go.mod h1:TM9a6pxWZJZZWuMzxESXhb6yaBaH9JAKDM4wpIzJsDE<span>=</span>
</span></span><span><span>
</span></span><span><span>go.sum database tree
</span></span><span><span><span>26238433</span>
</span></span><span><span><span>TQyXJYWJL6Z1OnKk5JXLAb9xfWrtHKjAUXKx5UQCa9Q</span><span>=</span>
</span></span><span><span>
</span></span><span><span>— sum.golang.org Az3grm+I35+HBcG+YvxlX+nzkXah3cWlBac/4EytsG24bEHFLrJNvyz5SphrKAHSS0EeDKJXpnb3cvdUtqVSiaNLVAY<span>=</span>
</span></span></code></pre></div><p>Since the repository doesn’t seem to have any version tag the pseudo-version is used instead. Go <a href="https://go.dev/ref/mod#pseudo-versions">documentation</a> explains the logic behind pseudo-versions.</p><p>The next step is to verify wheter a new Go module repository will be added to the checksum database and proxy if we call the <code>lookup</code> endpoint, as described.</p><p>After creating a simple new Go module and uploading to my GitHub account I have tried to issue the <code>lookup</code> command in two different forms, one not totally according to documentation, the other one also incorrect but trying to follow documentation. Both return errors, although different.</p><div><pre tabindex="0"><code data-lang="bash"><span><span>$ curl https://sum.golang.org/lookup/github.com/gdbinit/fluxmatter@latest
</span></span><span><span>bad request: version <span>"latest"</span> is not canonical <span>(</span>wanted <span>""</span><span>)</span>
</span></span><span><span>
</span></span><span><span>$ curl https://sum.golang.org/lookup/github.com/gdbinit/fluxmatter@v0.0.0
</span></span><span><span>not found: github.com/gdbinit/fluxmatter@v0.0.0: invalid version: unknown revision v0.0.0
</span></span></code></pre></div><p>The errors are kind of expected since I haven’t versioned the module and wasn’t using the correct pseudo-version. But we can verify if the new module was fetched as described by the documentation. The easiest way would be to generate the correct pseudo-version and make another query to the checksum database. If the module was indeed downloaded, then the entry would exist and returned as in the <code>homebrew-core</code> test.</p><p>Another way would be to resync my copy of the checksum database and query it for my module:</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>sqlite</span><span>&gt;</span><span> </span><span>select</span><span> </span><span>*</span><span> </span><span>from</span><span> </span><span>modules</span><span> </span><span>where</span><span> </span><span>path</span><span> </span><span>=</span><span> </span><span>'github.com/gdbinit/fluxmatter'</span><span>;</span><span>
</span></span></span><span><span><span></span><span>github</span><span>.</span><span>com</span><span>/</span><span>gdbinit</span><span>/</span><span>fluxmatter</span><span>|</span><span>v0</span><span>.</span><span>0</span><span>.</span><span>0</span><span>-</span><span>20240524163826</span><span>-</span><span>a7e64ffd69f2</span><span>|</span><span>2024</span><span>-</span><span>05</span><span>-</span><span>24</span><span>T16</span><span>:</span><span>40</span><span>:</span><span>51</span><span>.</span><span>203837</span><span>Z</span><span>
</span></span></span></code></pre></div><p>Finally we can query the proxy and use the <code>latest</code> query to return the latest known version of a module. And then download the module <code>zip</code> and prove that we just stored our arbitrary data in the Go infrastructure.</p><div><pre tabindex="0"><code data-lang="bash"><span><span>$ curl https://proxy.golang.org/github.com/gdbinit/fluxmatter/@latest
</span></span><span><span><span>{</span><span>"Version"</span>:<span>"v0.0.0-20240524163826-a7e64ffd69f2"</span>,<span>"Time"</span>:<span>"2024-05-24T16:38:26Z"</span>,<span>"Origin"</span>:<span>{</span><span>"VCS"</span>:<span>"git"</span>,<span>"URL"</span>:<span>"https://github.com/gdbinit/fluxmatter"</span>,<span>"Hash"</span>:<span>"a7e64ffd69f2d0751a52736e832a8d77a21059e7"</span><span>}}</span>
</span></span><span><span>
</span></span><span><span>$ curl -O https://proxy.golang.org/github.com/gdbinit/fluxmatter/@v/v0.0.0-20240524163826-a7e64ffd69f2.zip
</span></span><span><span>$ file v0.0.0-20240524163826-a7e64ffd69f2.zip
</span></span><span><span>v0.0.0-20240524163826-a7e64ffd69f2.zip: Zip archive data, at least v2.0 to extract
</span></span><span><span>
</span></span><span><span>$ unzip -t v0.0.0-20240524163826-a7e64ffd69f2.zip
</span></span><span><span>Archive:  v0.0.0-20240524163826-a7e64ffd69f2.zip
</span></span><span><span>    testing: github.com/gdbinit/fluxmatter@v0.0.0-20240524163826-a7e64ffd69f2/LICENSE   OK
</span></span><span><span>    testing: github.com/gdbinit/fluxmatter@v0.0.0-20240524163826-a7e64ffd69f2/fluxmatter.go   OK
</span></span><span><span>    testing: github.com/gdbinit/fluxmatter@v0.0.0-20240524163826-a7e64ffd69f2/go.mod   OK
</span></span><span><span>No errors detected in compressed data of v0.0.0-20240524163826-a7e64ffd69f2.zip.
</span></span></code></pre></div><p>And voilà, everything works! There’s no need to specify a version in the lookup (at least for the initial seeding); just a lookup query that contains the module path and something like a version.</p><p>Next I tried to do the same with a repository that has no Go code whatsoever, to prove that everything works the same way.</p><div><pre tabindex="0"><code data-lang="bash"><span><span>$ curl https://sum.golang.org/lookup/github.com/gdbinit/readmem@v0.0.0
</span></span><span><span>not found: github.com/gdbinit/readmem@v0.0.0: invalid version: unknown revision v0.0.0
</span></span><span><span>
</span></span><span><span>sqlite&gt; <span>select</span> * from modules where <span>path</span> <span>=</span> <span>'github.com/gdbinit/readmem'</span><span>;</span>
</span></span><span><span>github.com/gdbinit/readmem<span>|</span>v0.0.0-20131006075740-407cb0a56933<span>|</span>2024-05-24T16:45:35.88456Z
</span></span><span><span>
</span></span><span><span>$ curl https://proxy.golang.org/github.com/gdbinit/readmem/@latest
</span></span><span><span><span>{</span><span>"Version"</span>:<span>"v0.0.0-20131006075740-407cb0a56933"</span>,<span>"Time"</span>:<span>"2013-10-06T07:57:40Z"</span>,<span>"Origin"</span>:<span>{</span><span>"VCS"</span>:<span>"git"</span>,<span>"URL"</span>:<span>"https://github.com/gdbinit/readmem"</span>,<span>"Hash"</span>:<span>"407cb0a569336f98f3772582a31c17aa080caf66"</span><span>}}</span>
</span></span><span><span>
</span></span><span><span>$ curl -O https://proxy.golang.org/github.com/gdbinit/readmem/@v/v0.0.0-20131006075740-407cb0a56933.zip
</span></span><span><span>$ file v0.0.0-20131006075740-407cb0a56933.zip
</span></span><span><span>v0.0.0-20131006075740-407cb0a56933.zip: Zip archive data, at least v2.0 to extract
</span></span><span><span>
</span></span><span><span>$ unzip -t v0.0.0-20131006075740-407cb0a56933.zip
</span></span><span><span>Archive:  v0.0.0-20131006075740-407cb0a56933.zip
</span></span><span><span>    testing: github.com/gdbinit/readmem@v0.0.0-20131006075740-407cb0a56933/Entitlements.plist   OK
</span></span><span><span>    testing: github.com/gdbinit/readmem@v0.0.0-20131006075740-407cb0a56933/README   OK
</span></span><span><span>    testing: github.com/gdbinit/readmem@v0.0.0-20131006075740-407cb0a56933/readmem.xcodeproj/project.pbxproj   OK
</span></span><span><span>    testing: github.com/gdbinit/readmem@v0.0.0-20131006075740-407cb0a56933/readmem/main.c   OK
</span></span><span><span>No errors detected in compressed data of v0.0.0-20131006075740-407cb0a56933.zip.
</span></span></code></pre></div><p>This demonstrates that it’s possible to load into Go public proxy arbitrary data. The experiment was done using GitHub but it should work with other hosting sites.</p><p>One curious statistic is the amount of Go modules stored at GitHub:</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>sqlite</span><span>&gt;</span><span> </span><span>select</span><span> </span><span>count</span><span>(</span><span>distinct</span><span> </span><span>path</span><span>)</span><span> </span><span>from</span><span> </span><span>modules</span><span>;</span><span>
</span></span></span><span><span><span></span><span>1591375</span><span>
</span></span></span><span><span><span></span><span>sqlite</span><span>&gt;</span><span> </span><span>select</span><span> </span><span>count</span><span>(</span><span>distinct</span><span> </span><span>path</span><span>)</span><span> </span><span>from</span><span> </span><span>modules</span><span> </span><span>where</span><span> </span><span>path</span><span> </span><span>like</span><span> </span><span>'github.com%'</span><span>;</span><span>
</span></span></span><span><span><span></span><span>1515957</span><span>
</span></span></span></code></pre></div><p>Around 95% of the unique paths present in <code>sum.golang.org</code> are hosted at GitHub. This is a raw statistic, without removing bogus data such as forks and targets that aren’t really Go code. But it still shows the magnitude of GitHub dependency in the Go ecosystem.</p><p>Go authors don’t seem to be completely unaware of this kind of scenario and implemented some restrictions, which are described in <a href="https://go.dev/ref/mod#zip-path-size-constraints">File path and size constraints</a> section. The most relevant one is:</p><blockquote><p>A module zip file may be at most 500 MiB in size. The total uncompressed size of its files is also limited to 500 MiB. go.mod files are limited to 16 MiB. LICENSE files are also limited to 16 MiB. These limits exist to mitigate denial of service attacks on users, proxies, and other parts of the module ecosystem. Repositories that contain more than 500 MiB of files in a module directory tree should tag module versions at commits that only include files needed to build the module’s packages; videos, models, and other large assets are usually not needed for builds.</p></blockquote><p>500MiB is more than enough for considerable abuse and all the others aren’t really a problem.</p><h3 id="abuse-what">Abuse what?</h3><p>For example, it can be used to bypass destination download restrictions on developer machines and in CI/CD servers (assuming that there isn’t a private GOPROXY). Malware can simply store payloads and retrieve them from the proxy when needed. And because we don’t have restrictions regarding the source domain (as long it’s a working VCS), we can load up the payloads from anywhere and make those sources disappear, leaving only a small trace in the checksum database entry.</p><p>A Denial of Service (DoS) attack on <code>proxy.golang.org</code> might be challenging to execute. I have shown that we can request any random Git repository (and probably any of the other supported VCS) to be downloaded by the proxy. For a possible attack, we would need to first gather as many GitHub URLs as possible and then issue as many requests as possible to the <code>lookup</code> API. I have no idea about the server implementation, but I would assume that something similar to a work queue is implemented, so there is a limit to the amount of parallel requests that will be processed. Bandwidth protections could also possibly be triggered from GitHub’s side. There is also a possibility of DoS-ing the storage space. I’m just guessing here :-).</p><p>A command and control (C2) can also be easily implemented on top of this. It’s very easy to find the latest version of any module using the <code>latest</code> query, so there isn’t need to query the checksum database and find all the available versions of our payload. The payload can be a simple file or can be disguised inside the <code>go.mod</code> or any other Go source file for extra stealthiness. A module DGA (Domain Generation Algorithm) can be used to avoid using a single repository for the C2. My original goal was to write a sample C2 to demonstrate this, but there isn’t really much to be done here.</p><p>To download commands from the C2, the implant just needs the following steps:</p><ul><li><p>Make a request to <code>https://proxy.golang.org/module_path/@latest</code>.</p></li><li><p>Parse the JSON result and extract the pseudo-version (or version if used).</p></li><li><p>Make another request to <code>https://proxy.golang.org/module_path/@v/version.zip</code> to download the zip file.</p></li><li><p>Extract the zip contents and parse the commands.</p></li></ul><p>Quite easy in some 300 or less lines of Go code.</p><h3 id="conclusions">Conclusions</h3><p>My questions have been answered, and now I understand how the checksum database process works. So far, it’s not a severe issue in Go infrastructure. It’s something that can be easily abused but also improved. Maybe there are (documented or not) reasons to let non-Go code be uploaded to the proxy and checksum database. Or maybe there is already someone abusing this, and we can go on a treasure hunt through the almost 1.6 million unique repositories (my up-to-date database copy contains almost 22 million entries).</p><p>I still have questions why certain valid non-Go projects are in the database. Are they doing it on purpose? Why? Using Go’s transparent log as safety backup? Any hints about this?</p><p>I had fun with this, and I have a bunch of ideas to further explore. I have a feeling… ;-).</p><p>Have fun,<br>fG!</p></div></article></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Publishing AI Slop Is a Choice (148 pts)]]></title>
            <link>https://daringfireball.net/linked/2024/05/24/publishing-ai-slop-is-a-choice</link>
            <guid>40474236</guid>
            <pubDate>Sat, 25 May 2024 11:25:52 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://daringfireball.net/linked/2024/05/24/publishing-ai-slop-is-a-choice">https://daringfireball.net/linked/2024/05/24/publishing-ai-slop-is-a-choice</a>, See on <a href="https://news.ycombinator.com/item?id=40474236">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="Box">


<dl>
<dt><a href="https://www.nytimes.com/2024/05/24/technology/google-ai-overview-search.html">Publishing AI Slop Is a Choice</a></dt>
<dd>
<p>From a New York Times story by Nico Grant, under the headline “Google’s A.I. Search Errors Cause a Furor Online”:</p>

<blockquote>
  <p>With each mishap, tech industry insiders have criticized the
company for dropping the ball. But in interviews, financial
analysts said Google needed to move quickly to keep up with its
rivals, even if it meant growing pains.</p>

<p>Google “doesn’t have a choice right now,” Thomas Monteiro, a
Google analyst at Investing.com, said in an interview.
“Companies need to move really fast, even if that includes
skipping a few steps along the way. The user experience will
just have to catch up.”</p>
</blockquote>

<p>That quote is insane. There’s no reason Google had to enable this feature now. None. If their search monopoly <a href="https://searchengineland.com/did-google-really-lose-search-market-share-to-microsoft-bing-in-april-440098">has been losing share recently</a>, it’s not because of rivals who are serving up AI-generated slop. It’s because even before this, <a href="https://daringfireball.net/linked/2024/04/24/zitron-google-search">Google’s search results quality was slipping in obvious ways</a>. This is just making it worse. They’ve turned Google Search — the crown jewel of the company, arguably the greatest consumer product ever made — into the butt of jokes.</p>

<p>LLM-powered search results are a bauble. The trust Google has built with users over the last 25 years is the most valuable asset the company owns. Google most certainly does have a choice, and they’ve chosen to erode that trust just so they can avoid accusations that they’re “behind”.</p>

<p>Behind is where you want to be when those who are ahead are publishing nonsense.</p>

<p>★ <em>Friday, 24 May 2024</em></p>
</dd>
</dl>




<!-- Google Analytics -->

<!-- 
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-593949-1']);
  _gaq.push (['_gat._anonymizeIp']);
  _gaq.push(['_trackPageview']);
  (function() {
	var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
 -->

<!-- Asynchronously load Mint -->
<!-- No, screw mint
<script type="text/javascript">
(function () {
	var ma = document.createElement('script');
	ma.type = 'text/javascript';
	ma.src = '/mint/?js';
	ma.async = true;
	var s = document.getElementsByTagName('script')[0];
	s.parentNode.insertBefore(ma, s);
})();
</script>
-->
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Google just updated its algorithm. The Internet will never be the same (150 pts)]]></title>
            <link>https://www.bbc.com/future/article/20240524-how-googles-new-algorithm-will-shape-your-internet</link>
            <guid>40474202</guid>
            <pubDate>Sat, 25 May 2024 11:14:26 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.bbc.com/future/article/20240524-how-googles-new-algorithm-will-shape-your-internet">https://www.bbc.com/future/article/20240524-how-googles-new-algorithm-will-shape-your-internet</a>, See on <a href="https://news.ycombinator.com/item?id=40474202">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><article><figure><div data-component="image-block"><p><img src="https://www.bbc.com/bbcx/grey-placeholder.png"><img sizes="(min-width: 1280px) 50vw, (min-width: 1008px) 66vw, 96vw" srcset="https://ichef.bbci.co.uk/images/ic/160xn/p0j04cst.jpg.webp 160w,https://ichef.bbci.co.uk/images/ic/240xn/p0j04cst.jpg.webp 240w,https://ichef.bbci.co.uk/images/ic/320xn/p0j04cst.jpg.webp 320w,https://ichef.bbci.co.uk/images/ic/480xn/p0j04cst.jpg.webp 480w,https://ichef.bbci.co.uk/images/ic/640xn/p0j04cst.jpg.webp 640w,https://ichef.bbci.co.uk/images/ic/800xn/p0j04cst.jpg.webp 800w,https://ichef.bbci.co.uk/images/ic/1024xn/p0j04cst.jpg.webp 1024w,https://ichef.bbci.co.uk/images/ic/1376xn/p0j04cst.jpg.webp 1376w,https://ichef.bbci.co.uk/images/ic/1920xn/p0j04cst.jpg.webp 1920w" src="https://ichef.bbci.co.uk/images/ic/480xn/p0j04cst.jpg.webp" loading="eager" alt="Serenity Strull/BBC/Getty Images A collage of office workers sitting around a table with a search box in its center (Credit: Serenity Strull/BBC/Getty Images)"><span>Serenity Strull/BBC/Getty Images</span></p></div><p data-component="caption-block"><figcaption>(Credit: Serenity Strull/BBC/Getty Images)<!-- --></figcaption></p></figure><p><b id="Over the last two years, a series of updates to Google Search amount to a dramatic upheaval to the Internet's most powerful tool, complete with an unprecedented AI feature. Will Google save the web, or destroy it?">Over the last two years, a series of updates to Google Search amount to a dramatic upheaval to the Internet's most powerful tool, complete with an unprecedented AI feature. Will Google save the web, or destroy it?<!-- --></b></p><p>If you've ever typed "air purifier reviews" into Google, you were probably looking for the kind of content you'll find on <!-- --><a target="_blank" href="http://housefresh.com/">HouseFresh.com<!-- --></a>. The site was started in 2020 by Gisele Navarro and her husband, based on a decade of experience writing about indoor air quality products. They filled their basement with purifiers, running rigorous science-based tests and writing articles to help consumers sort through marketing hype.<!-- --></p><p>House Fresh is an example of what has been a flourishing industry of independent publishers producing exactly the sort of original content Google <!-- --><a target="_blank" href="https://developers.google.com/search/docs/fundamentals/creating-helpful-content">says it wants to promote<!-- --></a>. And indeed, soon after the website's launch, the tech giant started showing House Fresh at the top of search results. The website grew into a thriving business with 15 full-time employees. Navarro had big plans for the future.<!-- --></p><p>Then, in September 2023, Google made one in a series of major updates to the algorithm that runs its search engine.<!-- --></p><p>"It decimated us," Navarro says. "Suddenly the search terms that used to bring up House Fresh were sending people to big lifestyle magazines that clearly don't even test the products. The articles are full of information that I know is wrong."<!-- --></p><p>The second Google algorithm update came in March, and it was even more punishing. House Fresh's thousands of daily visitors dwindled to just hundreds. "We just got absolutely crushed," Navarro says. Over the last few weeks, <!-- --><a target="_blank" href="https://housefresh.com/how-google-decimated-housefresh/">House Fresh had to lay off most of its team<!-- --></a>. If nothing changes, she says, the website is doomed.<!-- --></p><p>A spokesperson for Google tells the BBC that the company only launches changes to Search after rigorous testing confirms that the shift will be helpful for users, and that the company gives website owners help, resources and opportunities for feedback on their Search rankings.<!-- --></p><p>Google stands firm in its position that the changes will be a benefit to the web, and changes to the Search algorithm are just the start. Last week, Google CEO Sundar Pichai stood in front of a crowd at the company's annual developer conference and announced one of the most significant moves in the search engine's history. Going forward, Pichai said, Google Search would provide its own <!-- --><a target="_self" href="https://www.bbc.com/news/articles/cq5nnlrwn9do">AI-generated answers<!-- --></a> to many of your questions, a feature called "AI Overviews" that's already rolled out to users in the United States. "The result is a product that does the work for you," Pichai said. "Google Search is generative AI at the scale of human curiosity."<!-- --></p><div data-component="quote-block"><p><span>Google's work is about to have a profound impact on what many of us see when we go online</span></p></div><p>AI Overviews are just one of a slew of dramatic changes Google has made to its core product over the past two years. The company says its recent effort to revamp Search will usher in an exciting new era of technology and help solve many of the issues plaguing the web. But critics say the opposite may be true. As Google retools its algorithms and uses AI to transition from a search engine to a search <!-- --><i id="and">and<!-- --></i> answer engine, some worry the result could be no less than an <!-- --><a target="_blank" href="https://futurism.com/the-byte/publishers-google-ai-feature-website-traffic">extinction-level event<!-- --></a> for the businesses that make much of your favourite content.<!-- --></p><p>One thing is certain: Google's work is about to have a profound impact on what many of us see when we go online.<!-- --></p><figure><div data-component="image-block"><p><img src="https://www.bbc.com/bbcx/grey-placeholder.png"><img sizes="(min-width: 1280px) 50vw, (min-width: 1008px) 66vw, 96vw" srcset="https://ichef.bbci.co.uk/images/ic/160xn/p0j04dwc.jpg.webp 160w,https://ichef.bbci.co.uk/images/ic/240xn/p0j04dwc.jpg.webp 240w,https://ichef.bbci.co.uk/images/ic/320xn/p0j04dwc.jpg.webp 320w,https://ichef.bbci.co.uk/images/ic/480xn/p0j04dwc.jpg.webp 480w,https://ichef.bbci.co.uk/images/ic/640xn/p0j04dwc.jpg.webp 640w,https://ichef.bbci.co.uk/images/ic/800xn/p0j04dwc.jpg.webp 800w,https://ichef.bbci.co.uk/images/ic/1024xn/p0j04dwc.jpg.webp 1024w,https://ichef.bbci.co.uk/images/ic/1376xn/p0j04dwc.jpg.webp 1376w,https://ichef.bbci.co.uk/images/ic/1920xn/p0j04dwc.jpg.webp 1920w" src="https://ichef.bbci.co.uk/images/ic/480xn/p0j04dwc.jpg.webp" loading="lazy" alt="Over the last two years, updates meant to make Search more “helpful” devasted many website owners who say they follow Google’s best practices. (Source: SEMrush) (Credit: BBC)"></p></div><p data-component="caption-block"><figcaption>Over the last two years, updates meant to make Search more “helpful” devasted many website owners who say they follow Google’s best practices. (Source: SEMrush) (Credit: BBC)<!-- --></figcaption></p></figure><p>The changes came about because Google recognises the web has a problem. You've seen it yourself, if you've ever used a search engine. The Internet is dominated by a school of website building known as "search engine optimisation", or SEO, techniques that are meant to tune articles and web pages for better recognition from Google Search. Google even provides SEO tips, tools and advice for website owners. For millions of businesses that rely on the mechanisations of the Search machine, <!-- --><a target="_blank" href="https://www.theverge.com/c/23998379/google-search-seo-algorithm-webpage-optimization">SEO can be an unavoidable game<!-- --></a>.<!-- --></p><p>The trouble is SEO can be abused. Enterprising website owners realised you can sometimes make more money by <!-- --><a target="_blank" href="https://downloads.webis.de/publications/papers/bevendorff_2024a.pdf">making content designed to please Google's algorithms<!-- --></a>, rather than the human beings it's ostensibly designed to serve.<!-- --></p><p>Google's efforts to address this issue aren't always successful. If you've ever been frustrated by what comes up when you search for something like "Best Sneakers for Women", you know the issue. Often, the results for popular search terms are crowded with websites that contain very little useful information, but tonnes of ads and links to retailers that earn publishers a share of profits. What's often lost is what you're probably looking for when you open up Google: information from people who are knowledgeable and passionate about their topic.<!-- --></p><p>Google's war on spammy Search results has ramped up. In 2022, the company issued a "<!-- --><a target="_blank" href="https://blog.google/products/search/more-content-by-people-for-people-in-search/">Helpful Content Update<!-- --></a>" to its algorithm meant to weed out content created solely for the purpose of ranking higher on Search. Google issued a subsequent update in September, 2023, and <!-- --><a target="_blank" href="https://blog.google/products/search/google-search-update-march-2024/">a third algorithm tweak in March of this year<!-- --></a>. Google says the result is "45% less low-quality, unoriginal content in search results". It could be viewed as a wild success.<!-- --></p><p>"Our recent updates aim to connect people with content that is helpful, satisfying and original, from a diverse range of sites across the web," a Google spokesperson tells the BBC. "As we work to improve Search, we're continuing to focus on sending valuable traffic to sites and supporting a healthy, open web."<!-- --></p><figure><div data-component="image-block"><p><img src="https://www.bbc.com/bbcx/grey-placeholder.png"><img sizes="(min-width: 1280px) 50vw, (min-width: 1008px) 66vw, 96vw" srcset="https://ichef.bbci.co.uk/images/ic/160xn/p0j04dck.jpg.webp 160w,https://ichef.bbci.co.uk/images/ic/240xn/p0j04dck.jpg.webp 240w,https://ichef.bbci.co.uk/images/ic/320xn/p0j04dck.jpg.webp 320w,https://ichef.bbci.co.uk/images/ic/480xn/p0j04dck.jpg.webp 480w,https://ichef.bbci.co.uk/images/ic/640xn/p0j04dck.jpg.webp 640w,https://ichef.bbci.co.uk/images/ic/800xn/p0j04dck.jpg.webp 800w,https://ichef.bbci.co.uk/images/ic/1024xn/p0j04dck.jpg.webp 1024w,https://ichef.bbci.co.uk/images/ic/1376xn/p0j04dck.jpg.webp 1376w,https://ichef.bbci.co.uk/images/ic/1920xn/p0j04dck.jpg.webp 1920w" src="https://ichef.bbci.co.uk/images/ic/480xn/p0j04dck.jpg.webp" loading="lazy" alt="Serenity Strull/BBC/Getty Images For better or worse, Google Search dictates the shape of the web. Some online publishers say the company wields that power irresponsibly (Credit: Serenity Strull/BBC/Getty Images)"><span>Serenity Strull/BBC/Getty Images</span></p></div><p data-component="caption-block"><figcaption>For better or worse, Google Search dictates the shape of the web. Some online publishers say the company wields that power irresponsibly (Credit: Serenity Strull/BBC/Getty Images)<!-- --></figcaption></p></figure><p>But the updates had some surprising consequences as well. For example, data from the analytics tool <!-- --><a target="_blank" href="http://semrush/">SEMrush<!-- --></a> suggests that the website for New York Magazine lost 32% of its Google Search traffic in the past six months, while GQ.com shrank 26%. The data indicates <!-- --><a target="_blank" href="https://www.urbandictionary.com/">Urban Dictionary<!-- --></a>, a wildly popular crowdsourced dictionary of English language slang, dropped some 18 million page views, amounting to more than half its Search traffic. OprahDaily.com was down nearly 58%. (SEMrush is an industry-standard tool, but its numbers are estimates and this data only measures traffic coming from Google Search, specifically.)<!-- --></p><p>A New York Magazine spokesperson said these findings were incomplete and didn't reflect the company's internal analysis. Representatives for GQ, Oprah Daily and Urban Dictionary did not respond to requests for comment by the time this article was published. However, experts and more than half a dozen media executives and websites owners told the BBC the broad trends in the data are all too real.<!-- --></p><div data-component="quote-block"><p><span>The increase in traffic Reddit is seeing is unprecedented on the Internet – Lily Ray</span></p></div><p>In place of these sites, there's one platform you'll be seeing much, much more of: Reddit. According to SEMrush, Reddit saw a surge that amounted to a 126% growth in traffic from Google Search. The company is already feeling the benefit. Reddit just announced its first quarterly earnings since becoming a publicly traded company in March 2024. Its <!-- --><a target="_self" href="https://www.bbc.com/news/business-68610711">revenue totals $243m (£191m)<!-- --></a>, up an eye-watering 48% from the year prior.<!-- --></p><p>"The increase in traffic Reddit is seeing is unprecedented on the Internet," says Lily Ray, vice president of SEO strategy and research at the marketing agency <!-- --><a target="_blank" href="https://www.amsive.com/">Amsive<!-- --></a>, and a celebrity in the world of SEO. "Cooking content, adult content, video games, gardening, fashion, everything is all just Reddit."<!-- --></p><p>A representative for Reddit declined to comment.<!-- --></p><p>Reddit isn't the only winner after Google's recent algorithm updates. SEMrush data shows that other user-generated sites such as Quora and Instagram saw similarly astronomical rises, and there were impressive spikes at LinkedIn and Wikipedia as well. In one sense, Google was just following a trend. Over the past few years, swaths of savvy internet users started <!-- --><a target="_blank" href="https://www.fastcompany.com/90722739/is-reddit-a-better-search-engine-than-google">adding the word "Reddit" to the end of their web searches<!-- --></a> in the hopes it would bring up people sharing their honest opinions, as opposed to websites trying to game Google's system. It's something Google's public liaison for search, Danny Sullivan, <!-- --><a target="_blank" href="https://www.reddit.com/r/SEO/comments/1bne9i3/comment/kxqaqmp/">has noted<!-- --></a>.<!-- --></p><p>"We've found that people often want to learn from others' experiences, and so we surface content from hundreds of forums and other communities across the web," a Google spokesperson says. "Our agreement with Reddit absolutely did not include ranking its content higher on Search."<!-- --></p><p>But Google results are a zero-sum game. If the search engine sends traffic to one site, it has to take it from another, and the effects on the losers in this Reddit equation are just as dramatic. "Google's just committing war on publisher websites," Ray says. "It's almost as if Google designed an algorithm update to specifically go after small bloggers. I've talked to so many people who've just had everything wiped out," she says.<!-- --></p><p>A number of website owners and search experts who spoke to the BBC said there's been a general shift in Google results towards websites with big established brands, and away from small and independent sites, that seems totally disconnected from the quality of the content.<!-- --></p><p>The change was instant for Daniel Hart, editor-in-chief of the UK-based entertainment news site <!-- --><a target="_blank" href="https://readysteadycut.com/">Ready Steady Cut<!-- --></a>. "After Google's September update, our traffic halved immediately, and it's only gotten worse. We've just been blitzed by the Reddit stuff in particular, but we're also being replaced by spam websites that are stealing our content. It makes no sense," Hart says. In the months following, the lost income forced Ready Steady Cut to reduce its team of 20 writers and editors down to just four, Hart says.<!-- --></p><p>A Google spokesperson said the company's recent updates have dealt a major blow to spammy, unoriginal content, and Google keeps a close watch on evolving abusive practices that lead to low-quality information in Search.<!-- --></p><p>After Google's updates, the company provided tips to website owners and said there was a path to recovery. Hart says the site hired consultants and pivoted to focus on Google's recommendations, spending sleepless nights working to update the site. After almost a year, none of it helped. "I wasted the last eight months of my life trying to follow Google's advice." he says. "Google claims they want content from people with first-hand experience and helpful context, and we're a massive example of that. It's just heartbreaking."<!-- --></p><figure><div data-component="image-block"><p><img src="https://www.bbc.com/bbcx/grey-placeholder.png"><img sizes="(min-width: 1280px) 50vw, (min-width: 1008px) 66vw, 96vw" srcset="https://ichef.bbci.co.uk/images/ic/160xn/p0j04fnt.jpg.webp 160w,https://ichef.bbci.co.uk/images/ic/240xn/p0j04fnt.jpg.webp 240w,https://ichef.bbci.co.uk/images/ic/320xn/p0j04fnt.jpg.webp 320w,https://ichef.bbci.co.uk/images/ic/480xn/p0j04fnt.jpg.webp 480w,https://ichef.bbci.co.uk/images/ic/640xn/p0j04fnt.jpg.webp 640w,https://ichef.bbci.co.uk/images/ic/800xn/p0j04fnt.jpg.webp 800w,https://ichef.bbci.co.uk/images/ic/1024xn/p0j04fnt.jpg.webp 1024w,https://ichef.bbci.co.uk/images/ic/1376xn/p0j04fnt.jpg.webp 1376w,https://ichef.bbci.co.uk/images/ic/1920xn/p0j04fnt.jpg.webp 1920w" src="https://ichef.bbci.co.uk/images/ic/480xn/p0j04fnt.jpg.webp" loading="lazy" alt="A few examples show how recent changes to Google Search had startling effects on a wide variety of websites. (Source: SEMrush) (Credit: BBC)"></p></div><p data-component="caption-block"><figcaption>A few examples show how recent changes to Google Search had startling effects on a wide variety of websites. (Source: SEMrush) (Credit: BBC)<!-- --></figcaption></p></figure><p>But the biggest offence, according to the website owners and content creators who spoke to the BBC, is the AI generated responses.<!-- --></p><p>Google argues its AI overviews in search results will be a boon to websites. Liz Reid, Google's head of search, wrote in a <!-- --><a target="_blank" href="https://blog.google/products/search/generative-ai-google-search-may-2024/">blog post<!-- --></a> that the company's AI search results actually increase traffic that Google sends to websites. "AI Overviews get more clicks than if the page had appeared as a traditional web listing for that query," Reid wrote. "As we expand this experience, we’ll continue to focus on sending valuable traffic to publishers and creators." However, the company hasn't shared any of the data backing up that claim, and many website owners and industry experts worry the opposite effect is just as likely.<!-- --></p><p>Katie Berry, owner of the cleaning advice website <!-- --><a target="_blank" href="https://housewifehowtos.com/">Housewife How-Tos<!-- --></a>, assumes users will just end their searches if Google's AI answers questions for them. The AI search results "<!-- --><a target="_blank" href="https://x.com/thatkatieberry/status/1790726312820171104">answer questions superficially<!-- --></a>, and often incorrectly, so people don't visit my site," Berry says. According to Berry, her site's traffic fell 70% after the 2022 Google update and dropped even further after Google started testing its new AI. "My site had more traffic in its first months of existence than it gets now, even though my rankings have not changed all that much," she says.<!-- --></p><p>Others, such as travel writer David Leiter, say the potential consequences are especially problematic because they feel Google's AI is outright stealing their content.<!-- --></p><p>For example, Leiter says a search for "Best Slot Canyons Near Las Vegas" used to bring up an article on his website, <!-- --><a target="_blank" href="https://theworldtravelguy.com/slot-canyons-las-vegas-nevada/">World Travel Guy<!-- --></a>. However, a search earlier this week brought up an AI-generated response at the top of the page instead.<!-- --></p><p>"Google has replaced my article with the giant AI Overview box, and it spits out an answer that is mostly wrong," Leiter says. "The first four places it lists are not even slot canyons. A slot canyon is a specific type of canyon with a narrow passageway, but the AI doesn't understand that. It's just listing random canyons and even a walking trail instead." The AI Overview did include a link to Leiter's article, but only if you took the time to click a tiny arrow at the bottom of the result. Leiter says he doesn't believe he'll get more traffic than he used to as the top search result. In either case, it's a small consolation. Leiter says Google's recent algorithm updates erased 95% of his traffic.<!-- --></p><p>Google acknowledges that AI tools may provide inaccurate information, but says it's constantly working to improve results. A Google spokesperson says AI Overviews are generally taken from multiple webpages, not single sources, and the responses are designed to highlight relevant links. The spokesperson says publishers can use a <!-- --><a target="_blank" href="https://developers.google.com/search/docs/crawling-indexing/robots-meta-tag">special tag<!-- --></a> on their webpages to control whether or not AI Overviews includes a link to their sites. However, once an AI model scrapes your content, it may be impossible to remove that data.<!-- --></p><p>Media executives aren't the only ones questioning Google's control of the internet. Google is simultaneously battling numerous antitrust lawsuits against different parts of the company's sprawling £1.7tn ($2.2tn) business. The company is currently awaiting a decision in a lawsuit brought by the US Department of Justice <!-- --><a target="_self" href="https://www.bbc.com/news/business-66755272">accusing Google of running an illegal monopoly<!-- --></a> in the search engine industry. If the tech giant loses the case, the penalties could range from massive fines to a forced break-up of the company.<!-- --></p><p>Google, which controls more than 90% of the worldwide search business, argues that the company's success stems solely from the fact that it makes superior products. A Google spokesperson says the company faces "immense competition" and people have many choices about how they search for information online.<!-- --></p><p>"I understand that Google doesn't owe us or anyone else traffic," says Navarro, of House Fresh. "But Google controls the roads. If tomorrow they decide the roads won't go to an entire town, that down dies. It's too much power to just shrug and say, 'Oh well, it's just the free market,'" she says.<!-- --></p><p>"I might just try working in the offline world, just pack it all up and tend a shop somewhere," says Navarro. "Maybe it was naive to think we could succeed just by making great original content that people want to read."<!-- --></p><p>--<!-- --></p><p><i id="For timely, trusted tech news from global correspondents to your inbox, sign up to the ">For timely, trusted tech news from global correspondents to your inbox, sign up to the <!-- --></i><a target="_self" href="https://cloud.email.bbc.com/techdecoded-newsletter-signup?&amp;at_bbc_team=studios&amp;at_medium=Onsite&amp;at_objective=acquisition&amp;at_ptr_type=&amp;at_ptr_name=bbc.com&amp;at_format=&amp;at_link_origin=&amp;at_campaign=techdecoded&amp;at_campaign_id=&amp;at_adset_name=&amp;at_adset_id=&amp;at_creation=&amp;at_creative_id=&amp;at_campaign_type=owned"><b id="Tech Decoded newsletter"><i id="Tech Decoded newsletter">Tech Decoded newsletter<!-- --></i></b></a><i id=", while ">, while <!-- --></i><a target="_self" href="https://cloud.email.bbc.com/SignUp10_08?&amp;at_bbc_team=studios&amp;at_medium=Onsite&amp;at_objective=acquisition&amp;at_ptr_name=bbc.com&amp;at_link_origin=featuresarticle&amp;at_campaign=essentiallist&amp;at_campaign_type=owned"><b id="The Essential List"><i id="The Essential List">The Essential List<!-- --></i></b></a><i id=" delivers a handpicked selection of features and insights twice a week."> delivers a handpicked selection of features and insights twice a week.<!-- --></i>&nbsp;<!-- --></p></article></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Lapis: A Web Framework for Lua (105 pts)]]></title>
            <link>https://leafo.net/lapis/</link>
            <guid>40474165</guid>
            <pubDate>Sat, 25 May 2024 10:56:41 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://leafo.net/lapis/">https://leafo.net/lapis/</a>, See on <a href="https://news.ycombinator.com/item?id=40474165">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>

<section>

<h2>What is it?</h2>
<p>Lapis is a framework for building web applications in <a href="https://lua.org/">Lua</a> (or <a href="https://moonscript.org/">MoonScript</a>) that primarily targets <a href="https://openresty.org/">OpenResty</a>, a high performance web platform that runs on a customized version of <a href="https://nginx.org/">Nginx</a>. Lapis can also be used in other server environments, being compatible with any modern version of Lua.</p>




<div>

<pre><code><span>local</span><span> </span><span>lapis</span><span> </span><span>=</span><span> </span><span>require</span><span> </span><span>"lapis"</span><span>
</span><span>local</span><span> </span><span>app</span><span> </span><span>=</span><span> </span><span>lapis</span><span>.</span><span>Application</span><span>()</span><span>

</span><span>app</span><span>:</span><span>match</span><span>(</span><span>"/"</span><span>,</span><span> </span><span>function</span><span>(</span><span>self</span><span>)</span><span>
  </span><span>return</span><span> </span><span>"Hello world!"</span><span>
</span><span>end</span><span>)</span><span>

</span><span>return</span><span> </span><span>app</span></code>
</pre>
<pre><code><span>lapis</span><span> </span><span>=</span><span> </span><span>require</span><span> </span><span>"lapis"</span><span>

</span><span>class</span><span> </span><span>extends</span><span> </span><span>lapis</span><span>.</span><span>Application</span><span>
  </span><span>"/"</span><span>:</span><span> </span><span>=&gt;</span><span>
    </span><span>"Hello world!"</span></code>
</pre>
</div>



</section>

<section>

<h2>How does it work?</h2>
<p>With OpenResty, Lua is run directly inside of the Nginx worker using LuaJIT, giving you the
smallest barrier between the webserver and your code. Have a look at <a href="http://www.techempower.com/benchmarks">Web Framework
Benchmarks</a> just to see how OpenResty
stacks up against other platforms.</p>

<p>Utilizing the power of <a href="https://leafo.net/posts/itchio-and-coroutines.html">Lua
coroutines</a>, you can write
clean code that looks synchronous but can achieve high throughput by
automatically running asynchronously without blocking. Networking operations
like database queries and HTTP requests will automatically yield to allow for
handling concurrent requests, all without all that callback spaghetti seen in
other asynchronous platforms. It’s fast, easy to read, and easy to write.</p>


</section>


<section>

<h2>What does it come with?</h2>
<p>Lapis includes <a href="https://leafo.net/lapis/reference/actions.html#routes-and-url-patterns">URL routing</a>, <a href="https://leafo.net/lapis/reference/html_generation.html">HTML Templating</a>, <a href="https://leafo.net/lapis/reference/utilities.html#csrf-protection">CSRF Protection</a> and <a href="https://leafo.net/lapis/reference/actions.html#request-object/session">Session</a>
support, <a href="https://leafo.net/lapis/reference/models.html">PostgreSQL/MySQL/SQLite backed models</a>, <a href="https://leafo.net/lapis/reference/database.html#database-schemas">schema generation</a> and
<a href="https://leafo.net/lapis/reference/database.html#database-migrations">migrations</a> in addition to a <a href="https://leafo.net/lapis/reference/utilities.html">collection of useful functions</a> needed
when developing a website.</p>



<div>

<pre><code><span>local</span><span> </span><span>lapis</span><span> </span><span>=</span><span> </span><span>require</span><span> </span><span>"lapis"</span><span>
</span><span>local</span><span> </span><span>app</span><span> </span><span>=</span><span> </span><span>lapis</span><span>.</span><span>Application</span><span>()</span><span>

</span><span>-- Define a basic pattern that matches /</span><span>
</span><span>app</span><span>:</span><span>match</span><span>(</span><span>"/"</span><span>,</span><span> </span><span>function</span><span>(</span><span>self</span><span>)</span><span>
  </span><span>local</span><span> </span><span>profile_url</span><span> </span><span>=</span><span> </span><span>self</span><span>:</span><span>url_for</span><span>(</span><span>"profile"</span><span>,</span><span> </span><span>{</span><span>name</span><span> </span><span>=</span><span> </span><span>"leafo"</span><span>})</span><span>
  </span><span>-- Use HTML builder syntax helper to quickly and safely write markup</span><span>
  </span><span>return</span><span> </span><span>self</span><span>:</span><span>html</span><span>(</span><span>function</span><span>()</span><span>
    </span><span>h2</span><span>(</span><span>"Welcome!"</span><span>)</span><span>
    </span><span>text</span><span>(</span><span>"Go to my "</span><span>)</span><span>
    </span><span>a</span><span>({</span><span>href</span><span> </span><span>=</span><span> </span><span>profile_url</span><span>},</span><span> </span><span>"profile"</span><span>)</span><span>
  </span><span>end</span><span>)</span><span>
</span><span>end</span><span>)</span><span>

</span><span>-- Define a named route pattern with a variable called name</span><span>
</span><span>app</span><span>:</span><span>match</span><span>(</span><span>"profile"</span><span>,</span><span> </span><span>"/:name"</span><span>,</span><span> </span><span>function</span><span>(</span><span>self</span><span>)</span><span>
  </span><span>return</span><span> </span><span>self</span><span>:</span><span>html</span><span>(</span><span>function</span><span>()</span><span>
    </span><span>div</span><span>({</span><span>class</span><span> </span><span>=</span><span> </span><span>"profile"</span><span>},</span><span>
      </span><span>"Welcome to the profile of "</span><span> </span><span>..</span><span> </span><span>self</span><span>.</span><span>params</span><span>.</span><span>name</span><span>)</span><span>
  </span><span>end</span><span>)</span><span>
</span><span>end</span><span>)</span><span>

</span><span>return</span><span> </span><span>app</span></code>
</pre>
<pre><code><span>lapis</span><span> </span><span>=</span><span> </span><span>require</span><span> </span><span>"lapis"</span><span>

</span><span>class</span><span> </span><span>extends</span><span> </span><span>lapis</span><span>.</span><span>Application</span><span>
  </span><span>-- Define a basic pattern that matches /</span><span>
  </span><span>"/"</span><span>:</span><span> </span><span>=&gt;</span><span>
    </span><span>profile_url</span><span> </span><span>=</span><span> </span><span>@url_for</span><span> </span><span>"profile"</span><span>,</span><span> </span><span>name:</span><span> </span><span>"leafo"</span><span>
    </span><span>-- Use HTML builder syntax helper to quickly and safely write markup</span><span>
    </span><span>@html</span><span> </span><span>-&gt;</span><span>
      </span><span>h2</span><span> </span><span>"Welcome!"</span><span>
      </span><span>text</span><span> </span><span>"Go to my "</span><span>
      </span><span>a</span><span> </span><span>href:</span><span> </span><span>profile_url</span><span>,</span><span> </span><span>"profile"</span><span>

  </span><span>-- Define a named route pattern with a variable called name</span><span>
  </span><span>[</span><span>profile:</span><span> </span><span>"/:name"</span><span>]</span><span>:</span><span> </span><span>=&gt;</span><span>
    </span><span>@html</span><span> </span><span>-&gt;</span><span>
      </span><span>div</span><span> </span><span>class:</span><span> </span><span>"profile"</span><span>,</span><span> </span><span>-&gt;</span><span>
        </span><span>text</span><span> </span><span>"Welcome to the profile of "</span><span>,</span><span> </span><span>@params</span><span>.</span><span>name</span></code>
</pre>
</div>



<h2>Models</h2>

<p>Get a powerful abstraction layer over your database tables just by
sub-classing <a href="https://leafo.net/lapis/reference/models.html"><code>Model</code></a>:</p>


<div>

<pre><code><span>local</span><span> </span><span>Model</span><span> </span><span>=</span><span> </span><span>require</span><span>(</span><span>"lapis.db.model"</span><span>).</span><span>Model</span><span>

</span><span>-- Create a model, backed by the table `users`</span><span>
</span><span>local</span><span> </span><span>Users</span><span> </span><span>=</span><span> </span><span>Model</span><span>:</span><span>extend</span><span>(</span><span>"users"</span><span>)</span><span>

</span><span>-- fetch some rows from the table</span><span>
</span><span>local</span><span> </span><span>elderly_users</span><span> </span><span>=</span><span> </span><span>Users</span><span>:</span><span>select</span><span>(</span><span>"where age &gt; ? limit 5"</span><span>,</span><span> </span><span>10</span><span>)</span><span>

</span><span>local</span><span> </span><span>random_user</span><span> </span><span>=</span><span> </span><span>Users</span><span>:</span><span>find</span><span>(</span><span>1233</span><span>)</span><span> </span><span>-- find by primary key</span><span>

</span><span>local</span><span> </span><span>lee</span><span> </span><span>=</span><span> </span><span>Users</span><span>:</span><span>find</span><span>({</span><span>
  </span><span>name</span><span> </span><span>=</span><span> </span><span>"Lee"</span><span>,</span><span>
  </span><span>email</span><span> </span><span>=</span><span> </span><span>"leemiller@example.com"</span><span>
</span><span>})</span><span>

</span><span>-- create a new row and edit it</span><span>
</span><span>local</span><span> </span><span>user</span><span> </span><span>=</span><span> </span><span>Users</span><span>:</span><span>create</span><span>({</span><span>
  </span><span>name</span><span> </span><span>=</span><span> </span><span>"Leaf"</span><span>,</span><span>
  </span><span>email</span><span> </span><span>=</span><span> </span><span>"leaf@example.com"</span><span>,</span><span>
  </span><span>age</span><span> </span><span>=</span><span> </span><span>6</span><span>
</span><span>})</span><span>

</span><span>user</span><span>:</span><span>update</span><span>({</span><span> </span><span>age</span><span> </span><span>=</span><span> </span><span>10</span><span> </span><span>})</span><span>

</span><span>user</span><span>:</span><span>delete</span><span>()</span></code>
</pre>
<pre><code><span>import</span><span> </span><span>Model</span><span> </span><span>from</span><span> </span><span>require</span><span> </span><span>"lapis.db.model"</span><span>

</span><span>-- Create a model, automatically backed by the table `users`</span><span>
</span><span>class</span><span> </span><span>Users</span><span> </span><span>extends</span><span> </span><span>Model</span><span>

</span><span>-- fetch some rows from the table</span><span>
</span><span>elderly_users</span><span> </span><span>=</span><span> </span><span>Users</span><span>\</span><span>select</span><span> </span><span>"where age &gt; ? limit 5"</span><span>,</span><span> </span><span>10</span><span>

</span><span>random_user</span><span> </span><span>=</span><span> </span><span>Users</span><span>\</span><span>find</span><span> </span><span>1233</span><span> </span><span>-- find by primary key</span><span>

</span><span>lee</span><span> </span><span>=</span><span> </span><span>Users</span><span>\</span><span>find</span><span> </span><span>name:</span><span> </span><span>"Lee"</span><span>,</span><span> </span><span>email:</span><span> </span><span>"leemiller@example.com"</span><span>

</span><span>-- create a new row and edit it</span><span>
</span><span>user</span><span> </span><span>=</span><span> </span><span>Users</span><span>\</span><span>create</span><span> </span><span>{</span><span>
  </span><span>name:</span><span> </span><span>"Leaf"</span><span>
  </span><span>email:</span><span> </span><span>"leaf@example.com"</span><span>
  </span><span>age:</span><span> </span><span>6</span><span>
</span><span>}</span><span>

</span><span>user</span><span>\</span><span>update</span><span> </span><span>age:</span><span> </span><span>10</span><span>

</span><span>user</span><span>\</span><span>delete</span><span>!</span></code>
</pre>
</div>



<h2>Templates</h2>

<p>Write your templates either in <a href="https://github.com/leafo/etlua">etlua</a> or in
pure Lua/MoonScript.</p>

<p>The <code>Widget</code> base class allows you to organize your templates as modules,
enabling you to use inheritance and mixins to mix and match methods combined
with the HTML builder syntax that lets you express HTML with the full power of
the language you're already using.</p>

<p>The HTML builder syntax makes you immune to cross site scripting attacks from
user-provided input by ensuring all written content is escaped correctly.</p>


<div>

<pre><code><span>&lt;!-- views/index.etlua --&gt;</span><span>
</span><span>&lt;h1</span><span> </span><span>class</span><span>=</span><span>"header"</span><span>&gt;</span><span>&lt;%=</span><span> </span><span>"Hello"</span><span> </span><span>%&gt;</span><span>&lt;/h1&gt;</span><span>
</span><span>&lt;%</span><span> </span><span>if</span><span> </span><span>current_user</span><span> </span><span>then</span><span> </span><span>%&gt;</span><span>
  </span><span>&lt;div</span><span> </span><span>class</span><span>=</span><span>"user_panel"</span><span>&gt;</span><span>
    </span><span>Welcome</span><span> </span><span>back</span><span> </span><span>&lt;%=</span><span> </span><span>current_user</span><span>.</span><span>name</span><span> </span><span>%&gt;</span><span>
  </span><span>&lt;/div&gt;</span><span>
</span><span>&lt;%</span><span> </span><span>end</span><span> </span><span>%&gt;</span><span>

</span><span>&lt;div</span><span> </span><span>class</span><span>=</span><span>"body"</span><span>&gt;</span><span>
  </span><span>Welcome</span><span> </span><span>to</span><span> </span><span>my</span><span> </span><span>site</span><span>
</span><span>&lt;/div&gt;</span></code>
</pre>
<pre><code><span>import</span><span> </span><span>Widget</span><span> </span><span>from</span><span> </span><span>require</span><span> </span><span>"lapis.html"</span><span>

</span><span>class</span><span> </span><span>Index</span><span> </span><span>extends</span><span> </span><span>Widget</span><span>
  </span><span>content:</span><span> </span><span>=&gt;</span><span>
    </span><span>h1</span><span> </span><span>class:</span><span> </span><span>"header"</span><span>,</span><span> </span><span>"Hello"</span><span>

    </span><span>@user_panel</span><span>!</span><span>
    </span><span>div</span><span> </span><span>class:</span><span> </span><span>"body"</span><span>,</span><span> </span><span>-&gt;</span><span>
      </span><span>text</span><span> </span><span>"Welcome to my site!"</span><span>

  </span><span>user_panel:</span><span> </span><span>=&gt;</span><span>
    </span><span>return</span><span> </span><span>unless</span><span> </span><span>@current_user</span><span>
    </span><span>div</span><span> </span><span>class:</span><span> </span><span>"user_panel"</span><span>,</span><span> </span><span>"Welcome back "</span><span> </span><span>..</span><span> </span><span>@current_user</span><span>.</span><span>name</span></code>
</pre>
</div>




</section>
<section>

<h2>Full Example</h2>

<p>Using all the provided tools we can quickly and logically construct high
performance and low memory web applications. Here's a more complicated example
complete with forms, CSRF protection, and various database queries.</p>

<div>

<pre><code><span>local</span><span> </span><span>lapis</span><span> </span><span>=</span><span> </span><span>require</span><span> </span><span>"lapis"</span><span>
</span><span>local</span><span> </span><span>Model</span><span> </span><span>=</span><span> </span><span>require</span><span>(</span><span>"lapis.db.model"</span><span>).</span><span>Model</span><span>
</span><span>local</span><span> </span><span>capture_errors</span><span> </span><span>=</span><span> </span><span>require</span><span>(</span><span>"lapis.application"</span><span>).</span><span>capture_errors</span><span>
</span><span>local</span><span> </span><span>csrf</span><span> </span><span>=</span><span> </span><span>require</span><span> </span><span>"lapis.csrf"</span><span>

</span><span>local</span><span> </span><span>Users</span><span> </span><span>=</span><span> </span><span>Model</span><span>:</span><span>extend</span><span>(</span><span>"users"</span><span>)</span><span>

</span><span>local</span><span> </span><span>app</span><span> </span><span>=</span><span> </span><span>lapis</span><span>.</span><span>Application</span><span>()</span><span>

</span><span>app</span><span>:</span><span>before_filter</span><span>(</span><span>function</span><span>(</span><span>self</span><span>)</span><span>
  </span><span>self</span><span>.</span><span>csrf_token</span><span> </span><span>=</span><span> </span><span>csrf</span><span>.</span><span>generate_token</span><span>(</span><span>self</span><span>)</span><span>
</span><span>end</span><span>)</span><span>

</span><span>app</span><span>:</span><span>get</span><span>(</span><span>"list_users"</span><span>,</span><span> </span><span>"/users"</span><span>,</span><span> </span><span>function</span><span>(</span><span>self</span><span>)</span><span>
  </span><span>self</span><span>.</span><span>users</span><span> </span><span>=</span><span> </span><span>Users</span><span>:</span><span>select</span><span>()</span><span> </span><span>-- `select` all users</span><span>
  </span><span>return</span><span> </span><span>{</span><span> </span><span>render</span><span> </span><span>=</span><span> </span><span>true</span><span> </span><span>}</span><span>
</span><span>end</span><span>)</span><span>

</span><span>app</span><span>:</span><span>get</span><span>(</span><span>"user"</span><span>,</span><span> </span><span>"/profile/:id"</span><span>,</span><span> </span><span>function</span><span>(</span><span>self</span><span>)</span><span>
  </span><span>local</span><span> </span><span>user</span><span> </span><span>=</span><span> </span><span>Users</span><span>:</span><span>find</span><span>({</span><span> </span><span>id</span><span> </span><span>=</span><span> </span><span>self</span><span>.</span><span>params</span><span>.</span><span>id</span><span> </span><span>})</span><span>
  </span><span>if</span><span> </span><span>not</span><span> </span><span>user</span><span> </span><span>then</span><span>
    </span><span>return</span><span> </span><span>{</span><span> </span><span>status</span><span> </span><span>=</span><span> </span><span>404</span><span> </span><span>}</span><span>
  </span><span>end</span><span>

  </span><span>return</span><span> </span><span>{</span><span> </span><span>render</span><span> </span><span>=</span><span> </span><span>true</span><span> </span><span>}</span><span>
</span><span>end</span><span>)</span><span>

</span><span>app</span><span>:</span><span>post</span><span>(</span><span>"new_user"</span><span>,</span><span> </span><span>"/user/new"</span><span>,</span><span> </span><span>capture_errors</span><span>(</span><span>function</span><span>(</span><span>self</span><span>)</span><span>
  </span><span>csrf</span><span>.</span><span>assert_token</span><span>(</span><span>self</span><span>)</span><span>
  </span><span>Users</span><span>:</span><span>create</span><span>({</span><span>
    </span><span>name</span><span> </span><span>=</span><span> </span><span>assert_error</span><span>(</span><span>self</span><span>.</span><span>params</span><span>.</span><span>username</span><span>,</span><span> </span><span>"Missing username"</span><span>)</span><span>
  </span><span>})</span><span>

  </span><span>return</span><span> </span><span>{</span><span> </span><span>redirect_to</span><span> </span><span>=</span><span> </span><span>self</span><span>:</span><span>url_for</span><span>(</span><span>"list_users"</span><span>)</span><span> </span><span>}</span><span>
</span><span>end</span><span>))</span><span>

</span><span>app</span><span>:</span><span>get</span><span>(</span><span>"new_user"</span><span>,</span><span> </span><span>"/user/new"</span><span>,</span><span> </span><span>function</span><span>(</span><span>self</span><span>)</span><span>
  </span><span>return</span><span> </span><span>{</span><span> </span><span>render</span><span> </span><span>=</span><span> </span><span>true</span><span> </span><span>}</span><span>
</span><span>end</span><span>)</span><span>

</span><span>return</span><span> </span><span>app</span></code>
</pre>
<pre><code><span>lapis</span><span> </span><span>=</span><span> </span><span>require</span><span> </span><span>"lapis"</span><span>
</span><span>import</span><span> </span><span>Model</span><span> </span><span>from</span><span> </span><span>require</span><span> </span><span>"lapis.db.model"</span><span>
</span><span>import</span><span> </span><span>respond_to</span><span>,</span><span> </span><span>capture_errors</span><span> </span><span>from</span><span> </span><span>require</span><span> </span><span>"lapis.application"</span><span>
</span><span>csrf</span><span> </span><span>=</span><span> </span><span>require</span><span> </span><span>"lapis.csrf"</span><span>

</span><span>class</span><span> </span><span>Users</span><span> </span><span>extends</span><span> </span><span>Model</span><span>

</span><span>class</span><span> </span><span>extends</span><span> </span><span>lapis</span><span>.</span><span>Application</span><span>
  </span><span>-- Execute code before every action</span><span>
  </span><span>@before_filter</span><span> </span><span>=&gt;</span><span>
    </span><span>@csrf_token</span><span> </span><span>=</span><span> </span><span>csrf</span><span>.</span><span>generate_token</span><span> </span><span>@</span><span>

  </span><span>[</span><span>list_users:</span><span> </span><span>"/users"</span><span>]</span><span>:</span><span> </span><span>=&gt;</span><span>
    </span><span>users</span><span> </span><span>=</span><span> </span><span>Users</span><span>\</span><span>select</span><span>!</span><span> </span><span>-- `select` all the users</span><span>

    </span><span>-- Render HTML inline for simplicity</span><span>
    </span><span>@html</span><span> </span><span>-&gt;</span><span>
      </span><span>ul</span><span> </span><span>-&gt;</span><span>
        </span><span>for</span><span> </span><span>user</span><span> </span><span>in</span><span> </span><span>*</span><span>users</span><span>
          </span><span>li</span><span> </span><span>-&gt;</span><span>
            </span><span>a</span><span> </span><span>href:</span><span> </span><span>@url_for</span><span>(</span><span>"user"</span><span>,</span><span> </span><span>user</span><span>.</span><span>id</span><span>)</span><span>,</span><span> </span><span>user</span><span>.</span><span>name</span><span>

  </span><span>[</span><span>user:</span><span> </span><span>"/profile/:id"</span><span>]</span><span>:</span><span> </span><span>=&gt;</span><span>
    </span><span>user</span><span> </span><span>=</span><span> </span><span>Users</span><span>\</span><span>find</span><span> </span><span>id:</span><span> </span><span>@params</span><span>.</span><span>id</span><span>
    </span><span>return</span><span> </span><span>status:</span><span> </span><span>404</span><span> </span><span>unless</span><span> </span><span>user</span><span>
    </span><span>@html</span><span> </span><span>-&gt;</span><span> </span><span>h2</span><span> </span><span>user</span><span>.</span><span>name</span><span>

  </span><span>-- Respond to different HTTP actions to do the right thing</span><span>
  </span><span>[</span><span>new_user:</span><span> </span><span>"/user/new"</span><span>]</span><span>:</span><span> </span><span>respond_to</span><span> </span><span>{</span><span>
    </span><span>POST:</span><span> </span><span>capture_errors</span><span> </span><span>=&gt;</span><span>
      </span><span>csrf</span><span>.</span><span>assert_token</span><span> </span><span>@</span><span>
      </span><span>Users</span><span>\</span><span>create</span><span> </span><span>name:</span><span> </span><span>@params</span><span>.</span><span>username</span><span>
      </span><span>redirect_to:</span><span> </span><span>@url_for</span><span> </span><span>"list_users"</span><span>

    </span><span>GET:</span><span> </span><span>=&gt;</span><span>
      </span><span>@html</span><span> </span><span>-&gt;</span><span>
        </span><span>form</span><span> </span><span>method:</span><span> </span><span>"POST"</span><span>,</span><span> </span><span>action:</span><span> </span><span>@url_for</span><span>(</span><span>"new_user"</span><span>)</span><span>,</span><span> </span><span>-&gt;</span><span>
          </span><span>input</span><span> </span><span>type:</span><span> </span><span>"hidden"</span><span>,</span><span>
            </span><span>name:</span><span> </span><span>"csrf_token"</span><span>,</span><span> </span><span>value:</span><span> </span><span>@csrf_token</span><span>
          </span><span>input</span><span> </span><span>type:</span><span> </span><span>"text"</span><span>,</span><span> </span><span>name:</span><span> </span><span>"username"</span><span>
  </span><span>}</span></code>
</pre>
</div>



</section>

<section>

<h2>Where can I learn more?</h2>
<p>The <a href="https://leafo.net/lapis/reference.html">Reference Manual</a> is both a complete guide and a tutorial to using Lapis.</p>

<p>The source of Lapis can be <a href="https://github.com/leafo/lapis">found on Github</a>
and issues can be reported on the <a href="https://github.com/leafo/lapis/issues">issues
tracker</a>.</p>

<p><a href="https://luarocks.org/">LuaRocks.org</a> is an open source application written in
Lapis. It is the public host for all Lua Rocks and the <a href="https://github.com/luarocks/luarocks-site">source can be found on
GitHub</a>.</p>


</section>

<section>

<h2>Anything else I should know?</h2>
<p>You can use most existing Lua libraries with Lapis with no problems.
Here are some libraries you might find useful:</p>

<ul>
<li><a href="https://github.com/leafo/lapis-eswidget"><code>lapis-eswidget</code></a> — Base widget class for aggregating front-end assets with esbuild</li>
<li><a href="https://github.com/leafo/lapis-console"><code>lapis-console</code></a> — Interactive MoonScript console for Lapis that runs inside of your browser</li>
<li><a href="https://github.com/leafo/lapis-exceptions"><code>lapis-exceptions</code></a> — Exception tracking and reporting</li>
<li><a href="https://github.com/leafo/lapis-bayes"><code>lapis-bayes</code></a> — General purpose Bayes classification for Spam, Fraud, etc.</li>
<li><a href="https://github.com/leafo/web_sanitize"><code>web_sanitize</code></a> — HTML sanitization</li>
<li><a href="https://github.com/leafo/tableshape"><code>tableshape</code></a> — Robus input validation and verification</li>
<li><a href="https://github.com/leafo/magick"><code>magick</code></a> — ImageMagick bindings</li>
<li><a href="https://github.com/leafo/cloud_storage"><code>cloud_storage</code></a> — Support for Google Cloud Storage</li>
</ul>



</section>

<section>

<h2>About</h2>
<p>Lapis would not be possible without the following projects:</p>

<ul>
<li><a href="http://lua.org/">Lua</a></li>
<li><a href="http://www.inf.puc-rio.br/%7Eroberto/lpeg/">LPeg</a></li>
<li><a href="http://openresty.org/">OpenResty</a></li>
</ul>


<p>Lapis is licensed under the <a href="http://opensource.org/licenses/MIT">MIT license</a>.</p>

<p>Lapis is written by <a href="http://twitter.com/moonscript">@moonscript</a>.</p>


</section>





</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Mistral Fine-Tune (179 pts)]]></title>
            <link>https://github.com/mistralai/mistral-finetune</link>
            <guid>40473198</guid>
            <pubDate>Sat, 25 May 2024 07:09:47 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/mistralai/mistral-finetune">https://github.com/mistralai/mistral-finetune</a>, See on <a href="https://news.ycombinator.com/item?id=40473198">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto"><h2 tabindex="-1" dir="auto">Mistral-finetune</h2><a id="user-content-mistral-finetune" aria-label="Permalink: Mistral-finetune" href="#mistral-finetune"></a></p>
<a href="https://colab.research.google.com/github/mistralai/mistral-finetune/blob/main/tutorials/mistral_finetune_7b.ipynb" rel="nofollow">
  <img src="https://camo.githubusercontent.com/f5e0d0538a9c2972b5d413e0ace04cecd8efd828d133133933dfffec282a4e1b/68747470733a2f2f636f6c61622e72657365617263682e676f6f676c652e636f6d2f6173736574732f636f6c61622d62616467652e737667" alt="Open In Colab" data-canonical-src="https://colab.research.google.com/assets/colab-badge.svg">
</a>
<p dir="auto"><code>mistral-finetune</code> is a light-weight codebase that enables memory-efficient and performant finetuning of Mistral's models.
It is based on <a href="https://arxiv.org/abs/2106.09685" rel="nofollow">LoRA</a>, a training paradigm where most weights are frozen and only 1-2% additional weights in the form of low-rank matrix perturbations are trained.</p>
<p dir="auto">For maximum efficiency it is recommended to use a A100 or H100 GPU. The codebase is optimized
for multi-GPU-single-node training setups, but for smaller models, such as the 7B a single GPU suffices.</p>
<blockquote>
<p dir="auto"><strong>Note</strong></p>
<ul dir="auto">
<li>The goal of this repository is to provide a simple, guided entrypoint to finetune Mistral models.
As such, it is fairly opinionated (especially around data formatting) and does not aim at being exhaustive
across multiple model architecture or hardware types.
For more generic approaches, you can check out some other great projects like
<a href="https://pytorch.org/torchtune/stable/overview.html" rel="nofollow">torchtune</a>.</li>
</ul>
</blockquote>
<p dir="auto"><h2 tabindex="-1" dir="auto">Installation</h2><a id="user-content-installation" aria-label="Permalink: Installation" href="#installation"></a></p>
<p dir="auto">To get started with Mistral LoRA fine-tuning, follow these steps:</p>
<ol dir="auto">
<li>Clone this repository:</li>
</ol>
<div data-snippet-clipboard-copy-content="cd $HOME &amp;&amp; git clone https://github.com/mistralai/mistral-finetune.git"><pre><code>cd $HOME &amp;&amp; git clone https://github.com/mistralai/mistral-finetune.git
</code></pre></div>
<ol start="2" dir="auto">
<li>Install all required dependencies:</li>
</ol>
<div data-snippet-clipboard-copy-content="cd mistral-finetune
pip install -r requirements.txt"><pre><code>cd mistral-finetune
pip install -r requirements.txt
</code></pre></div>
<p dir="auto"><h2 tabindex="-1" dir="auto">Model download</h2><a id="user-content-model-download" aria-label="Permalink: Model download" href="#model-download"></a></p>
<p dir="auto">We recommend fine-tuning one of the official Mistral models which you can download here:</p>
<table>
<thead>
<tr>
<th>Model</th>
<th>Link</th>
<th>Checksum</th>
</tr>
</thead>
<tbody>
<tr>
<td>7B Base V3</td>
<td><a href="https://models.mistralcdn.com/mistral-7b-v0-3/mistral-7B-v0.3.tar" rel="nofollow">7B Base</a></td>
<td><code>0663b293810d7571dad25dae2f2a5806</code></td>
</tr>
<tr>
<td>7B Instruct v3</td>
<td><a href="https://models.mistralcdn.com/mistral-7b-v0-3/mistral-7B-Instruct-v0.3.tar" rel="nofollow">7B Instruct v3</a></td>
<td><code>80b71fcb6416085bcb4efad86dfb4d52</code></td>
</tr>
<tr>
<td>8x7B Base V1</td>
<td><a href="https://huggingface.co/mistralai/Mixtral-8x7B-v0.1" rel="nofollow">8x7B Base</a></td>
<td>(HF link)</td>
</tr>
<tr>
<td>8x7B Instruct V1</td>
<td><a href="https://models.mistralcdn.com/mixtral-8x7b-v0-1/Mixtral-8x7B-v0.1-Instruct.tar" rel="nofollow">8x7B Instruct</a></td>
<td><code>8e2d3930145dc43d3084396f49d38a3f</code></td>
</tr>
<tr>
<td>8x22 Instruct V3</td>
<td><a href="https://models.mistralcdn.com/mixtral-8x22b-v0-3/mixtral-8x22B-Instruct-v0.3.tar" rel="nofollow">8x22 Instruct</a></td>
<td><code>471a02a6902706a2f1e44a693813855b</code></td>
</tr>
<tr>
<td>8x22B Base V3</td>
<td><a href="https://models.mistralcdn.com/mixtral-8x22b-v0-3/mixtral-8x22B-v0.3.tar" rel="nofollow">8x22B Base</a></td>
<td><code>a2fa75117174f87d1197e3a4eb50371a</code></td>
</tr>
</tbody>
</table>
<p dir="auto"><strong>Important Notice</strong>: For 8x7B Base V1 and 8x7B Instruct V1, it is necessary to use our v3 tokenizer and extend the vocabulary size to 32768 prior to fine-tuning. For detailed instructions on this process, please refer to the <a href="https://github.com/mistralai/mistral-finetune?tab=readme-ov-file#model-extension">"Model extension"</a> section.</p>
<p dir="auto">E.g., to download the 7B-base model you can run the following command:</p>
<div dir="auto" data-snippet-clipboard-copy-content="mkdir -p ~/${HOME}/mistral_models
cd ${HOME} &amp;&amp; wget https://models.mistralcdn.com/mistral-7b-v0-3/mistral-7B-v0.3.tar
tar -xf mistral-7B-v0.3.tar -C mistral_models"><pre>mkdir -p <span>~</span>/<span>${HOME}</span>/mistral_models
<span>cd</span> <span>${HOME}</span> <span>&amp;&amp;</span> wget https://models.mistralcdn.com/mistral-7b-v0-3/mistral-7B-v0.3.tar
tar -xf mistral-7B-v0.3.tar -C mistral_models</pre></div>
<p dir="auto">Make sure to modify your training script and add the path to the downloaded
folder as <code>model_id_or_path</code>.</p>
<p dir="auto">E.g., modify <a href="https://github.com/mistralai/mistral-finetune/blob/main/example/7B.yaml">example/7B.yaml</a> to include the absolute path to <code>$HOME/mistral_models/7B</code>:</p>
<div data-snippet-clipboard-copy-content="model_id_or_path: &quot;/Users/johndoe/mistral_models/7B&quot;"><pre><code>model_id_or_path: "/Users/johndoe/mistral_models/7B"
</code></pre></div>
<p dir="auto"><h2 tabindex="-1" dir="auto">Prepare dataset</h2><a id="user-content-prepare-dataset" aria-label="Permalink: Prepare dataset" href="#prepare-dataset"></a></p>
<p dir="auto">To ensure effective training, <code>mistral-finetune</code> has strict
requirements for how the training data has to be formatted.</p>
<p dir="auto">All data files must be stored in jsonl format files.</p>
<p dir="auto">You can build two types of data files:</p>
<p dir="auto"><h3 tabindex="-1" dir="auto"><em>Pretrain</em>:</h3><a id="user-content-pretrain" aria-label="Permalink: Pretrain:" href="#pretrain"></a></p>
<p dir="auto">Pretrain data corresponds to plain text data stored in the <code>"text"</code> key. E.g:</p>
<div dir="auto" data-snippet-clipboard-copy-content="{&quot;text&quot;: &quot;Text contained in document n°1&quot;}
{&quot;text&quot;: &quot;Text contained in document n°2&quot;}"><pre>{<span>"text"</span>: <span><span>"</span>Text contained in document n°1<span>"</span></span>}
{<span>"text"</span>: <span><span>"</span>Text contained in document n°2<span>"</span></span>}</pre></div>
<p dir="auto"><h3 tabindex="-1" dir="auto"><em>Instruct</em>:</h3><a id="user-content-instruct" aria-label="Permalink: Instruct:" href="#instruct"></a></p>
<p dir="auto">Currently two different types of instruction following data are supported:</p>
<ul dir="auto">
<li><em>Instruct</em>: conversational data stored in the <code>"messages"</code> key in the form of a list. Each list item is a dictionary containing the <code>"content"</code> and <code>"role"</code> keys. <code>"role"</code> is a string being one of "user", "assistant" or "system_prompt". The loss will only be computed if "role" == "assistant". E.g.:</li>
</ul>
<div dir="auto" data-snippet-clipboard-copy-content="{
  &quot;messages&quot;: [
    {
      &quot;role&quot;: &quot;user&quot;,
      &quot;content&quot;: &quot;User interaction n°1 contained in document n°1&quot;
    },
    {
      &quot;role&quot;: &quot;assistant&quot;,
      &quot;content&quot;: &quot;Bot interaction n°1 contained in document n°1&quot;
    },
    {
      &quot;role&quot;: &quot;user&quot;,
      &quot;content&quot;: &quot;User interaction n°2 contained in document n°1&quot;
    },
    {
      &quot;role&quot;: &quot;assistant&quot;,
      &quot;content&quot;: &quot;Bot interaction n°2 contained in document n°1&quot;
    }
  ]
}
{
  &quot;messages&quot;: [
    {
      &quot;role&quot;: &quot;user&quot;,
      &quot;content&quot;: &quot;User interaction n°1 contained in document n°2&quot;
    },
    {
      &quot;role&quot;: &quot;assistant&quot;,
      &quot;content&quot;: &quot;Bot interaction n°1 contained in document n°2&quot;
    },
    {
      &quot;role&quot;: &quot;user&quot;,
      &quot;content&quot;: &quot;User interaction n°2 contained in document n°2&quot;
    },
    {
      &quot;role&quot;: &quot;assistant&quot;,
      &quot;content&quot;: &quot;Bot interaction n°2 contained in document n°2&quot;,
      &quot;weight&quot;: 0,  # don't train on n°2
    },
    {
      &quot;role&quot;: &quot;user&quot;,
      &quot;content&quot;: &quot;User interaction n°3 contained in document n°2&quot;
    },
    {
      &quot;role&quot;: &quot;assistant&quot;,
      &quot;content&quot;: &quot;Bot interaction n°3 contained in document n°2&quot;
    }
  ]
}"><pre>{
  <span>"messages"</span>: [
    {
      <span>"role"</span>: <span><span>"</span>user<span>"</span></span>,
      <span>"content"</span>: <span><span>"</span>User interaction n°1 contained in document n°1<span>"</span></span>
    },
    {
      <span>"role"</span>: <span><span>"</span>assistant<span>"</span></span>,
      <span>"content"</span>: <span><span>"</span>Bot interaction n°1 contained in document n°1<span>"</span></span>
    },
    {
      <span>"role"</span>: <span><span>"</span>user<span>"</span></span>,
      <span>"content"</span>: <span><span>"</span>User interaction n°2 contained in document n°1<span>"</span></span>
    },
    {
      <span>"role"</span>: <span><span>"</span>assistant<span>"</span></span>,
      <span>"content"</span>: <span><span>"</span>Bot interaction n°2 contained in document n°1<span>"</span></span>
    }
  ]
}
{
  <span>"messages"</span>: [
    {
      <span>"role"</span>: <span><span>"</span>user<span>"</span></span>,
      <span>"content"</span>: <span><span>"</span>User interaction n°1 contained in document n°2<span>"</span></span>
    },
    {
      <span>"role"</span>: <span><span>"</span>assistant<span>"</span></span>,
      <span>"content"</span>: <span><span>"</span>Bot interaction n°1 contained in document n°2<span>"</span></span>
    },
    {
      <span>"role"</span>: <span><span>"</span>user<span>"</span></span>,
      <span>"content"</span>: <span><span>"</span>User interaction n°2 contained in document n°2<span>"</span></span>
    },
    {
      <span>"role"</span>: <span><span>"</span>assistant<span>"</span></span>,
      <span>"content"</span>: <span><span>"</span>Bot interaction n°2 contained in document n°2<span>"</span></span>,
      <span>"weight"</span>: <span>0</span>,  <span># don't train on n°2</span>
    },
    {
      <span>"role"</span>: <span><span>"</span>user<span>"</span></span>,
      <span>"content"</span>: <span><span>"</span>User interaction n°3 contained in document n°2<span>"</span></span>
    },
    {
      <span>"role"</span>: <span><span>"</span>assistant<span>"</span></span>,
      <span>"content"</span>: <span><span>"</span>Bot interaction n°3 contained in document n°2<span>"</span></span>
    }
  ]
}</pre></div>
<ul dir="auto">
<li><em>Function calling</em>: conversational data stored in the <code>"messages"</code> key in the form of a list. Each list item is a dictionary containing the <code>"role"</code> and <code>"content"</code> or <code>"tool_calls"</code> keys. <code>"role"</code> is a string being one of "user", "assistant", "system_prompt", or "tool". The loss will only be computed if "role" == "assistant".</li>
</ul>
<p dir="auto"><strong>Note</strong>: In function calling the <code>"id"</code> of <code>"tool_calls"</code> and the <code>"tool_call_id"</code> are randomly generated strings of exactly 9 chars. We recommend to generate this automatically
in a data preparation script as is done <a href="https://github.com/mistralai/mistral-finetune/blob/208b25c0f7299bb78d06cea25b82adee03834319/utils/reformat_data_glaive.py#L74">here</a>.</p>
<p dir="auto">E.g.:</p>
<div dir="auto" data-snippet-clipboard-copy-content="{
  &quot;messages&quot;: [
    {
      &quot;role&quot;: &quot;system&quot;,
      &quot;content&quot;: &quot;You are an helpful assistant who has access to the following functions to help the user, you can use the functions if needed&quot;
    },
    {
      &quot;role&quot;: &quot;user&quot;,
      &quot;content&quot;: &quot;Can you help me generate an anagram of the word \&quot;listen\&quot;?&quot;
    },
    {
      &quot;role&quot;: &quot;assistant&quot;,
      &quot;tool_calls&quot;: [
        {
          &quot;id&quot;: &quot;TX92Jm8Zi&quot;,
          &quot;type&quot;: &quot;function&quot;,
          &quot;function&quot;: {
            &quot;name&quot;: &quot;generate_anagram&quot;,
            &quot;arguments&quot;: &quot;{\&quot;word\&quot;: \&quot;listen\&quot;}&quot;
          }
        }
      ]
    },
    {
      &quot;role&quot;: &quot;tool&quot;,
      &quot;content&quot;: &quot;{\&quot;anagram\&quot;: \&quot;silent\&quot;}&quot;,
      &quot;tool_call_id&quot;: &quot;TX92Jm8Zi&quot;
    },
    {
      &quot;role&quot;: &quot;assistant&quot;,
      &quot;content&quot;: &quot;The anagram of the word \&quot;listen\&quot; is \&quot;silent\&quot;.&quot;
    },
    {
      &quot;role&quot;: &quot;user&quot;,
      &quot;content&quot;: &quot;That's amazing! Can you generate an anagram for the word \&quot;race\&quot;?&quot;
    },
    {
      &quot;role&quot;: &quot;assistant&quot;,
      &quot;tool_calls&quot;: [
        {
          &quot;id&quot;: &quot;3XhQnxLsT&quot;,
          &quot;type&quot;: &quot;function&quot;,
          &quot;function&quot;: {
            &quot;name&quot;: &quot;generate_anagram&quot;,
            &quot;arguments&quot;: &quot;{\&quot;word\&quot;: \&quot;race\&quot;}&quot;
          }
        }
      ]
    }
  ],
  &quot;tools&quot;: [
    {
      &quot;type&quot;: &quot;function&quot;,
      &quot;function&quot;: {
        &quot;name&quot;: &quot;generate_anagram&quot;,
        &quot;description&quot;: &quot;Generate an anagram of a given word&quot;,
        &quot;parameters&quot;: {
          &quot;type&quot;: &quot;object&quot;,
          &quot;properties&quot;: {
            &quot;word&quot;: {
              &quot;type&quot;: &quot;string&quot;,
              &quot;description&quot;: &quot;The word to generate an anagram of&quot;
            }
          },
          &quot;required&quot;: [
            &quot;word&quot;
          ]
        }
      }
    }
  ]
}"><pre>{
  <span>"messages"</span>: [
    {
      <span>"role"</span>: <span><span>"</span>system<span>"</span></span>,
      <span>"content"</span>: <span><span>"</span>You are an helpful assistant who has access to the following functions to help the user, you can use the functions if needed<span>"</span></span>
    },
    {
      <span>"role"</span>: <span><span>"</span>user<span>"</span></span>,
      <span>"content"</span>: <span><span>"</span>Can you help me generate an anagram of the word <span>\"</span>listen<span>\"</span>?<span>"</span></span>
    },
    {
      <span>"role"</span>: <span><span>"</span>assistant<span>"</span></span>,
      <span>"tool_calls"</span>: [
        {
          <span>"id"</span>: <span><span>"</span>TX92Jm8Zi<span>"</span></span>,
          <span>"type"</span>: <span><span>"</span>function<span>"</span></span>,
          <span>"function"</span>: {
            <span>"name"</span>: <span><span>"</span>generate_anagram<span>"</span></span>,
            <span>"arguments"</span>: <span><span>"</span>{<span>\"</span>word<span>\"</span>: <span>\"</span>listen<span>\"</span>}<span>"</span></span>
          }
        }
      ]
    },
    {
      <span>"role"</span>: <span><span>"</span>tool<span>"</span></span>,
      <span>"content"</span>: <span><span>"</span>{<span>\"</span>anagram<span>\"</span>: <span>\"</span>silent<span>\"</span>}<span>"</span></span>,
      <span>"tool_call_id"</span>: <span><span>"</span>TX92Jm8Zi<span>"</span></span>
    },
    {
      <span>"role"</span>: <span><span>"</span>assistant<span>"</span></span>,
      <span>"content"</span>: <span><span>"</span>The anagram of the word <span>\"</span>listen<span>\"</span> is <span>\"</span>silent<span>\"</span>.<span>"</span></span>
    },
    {
      <span>"role"</span>: <span><span>"</span>user<span>"</span></span>,
      <span>"content"</span>: <span><span>"</span>That's amazing! Can you generate an anagram for the word <span>\"</span>race<span>\"</span>?<span>"</span></span>
    },
    {
      <span>"role"</span>: <span><span>"</span>assistant<span>"</span></span>,
      <span>"tool_calls"</span>: [
        {
          <span>"id"</span>: <span><span>"</span>3XhQnxLsT<span>"</span></span>,
          <span>"type"</span>: <span><span>"</span>function<span>"</span></span>,
          <span>"function"</span>: {
            <span>"name"</span>: <span><span>"</span>generate_anagram<span>"</span></span>,
            <span>"arguments"</span>: <span><span>"</span>{<span>\"</span>word<span>\"</span>: <span>\"</span>race<span>\"</span>}<span>"</span></span>
          }
        }
      ]
    }
  ],
  <span>"tools"</span>: [
    {
      <span>"type"</span>: <span><span>"</span>function<span>"</span></span>,
      <span>"function"</span>: {
        <span>"name"</span>: <span><span>"</span>generate_anagram<span>"</span></span>,
        <span>"description"</span>: <span><span>"</span>Generate an anagram of a given word<span>"</span></span>,
        <span>"parameters"</span>: {
          <span>"type"</span>: <span><span>"</span>object<span>"</span></span>,
          <span>"properties"</span>: {
            <span>"word"</span>: {
              <span>"type"</span>: <span><span>"</span>string<span>"</span></span>,
              <span>"description"</span>: <span><span>"</span>The word to generate an anagram of<span>"</span></span>
            }
          },
          <span>"required"</span>: [
            <span><span>"</span>word<span>"</span></span>
          ]
        }
      }
    }
  ]
}</pre></div>
<p dir="auto"><h2 tabindex="-1" dir="auto">Verify dataset</h2><a id="user-content-verify-dataset" aria-label="Permalink: Verify dataset" href="#verify-dataset"></a></p>
<p dir="auto">Before starting a training run you should verify that your dataset is correctly formatted and get an
estimation of the training time. You can do so by using the <a href="https://github.com/mistralai/mistral-finetune/blob/main/utils/validate_data.py">./utils/validate_data</a> script.</p>
<p dir="auto">Note that this step is crucial to ensure that the data is correctly formatted.</p>
<p dir="auto"><h3 tabindex="-1" dir="auto">Instruction following</h3><a id="user-content-instruction-following" aria-label="Permalink: Instruction following" href="#instruction-following"></a></p>
<p dir="auto">Let's go over a simple example to train a model in instruction following:</p>
<ul dir="auto">
<li>
<ol dir="auto">
<li><strong>Load a chunk of <a href="https://huggingface.co/datasets/HuggingFaceH4/ultrachat_200k" rel="nofollow">Ultachat_200k</a></strong></li>
</ol>
</li>
</ul>
<p dir="auto">Create the data folder and navigate to the folder.</p>
<div dir="auto" data-snippet-clipboard-copy-content="cd $HOME &amp;&amp; mkdir -p data &amp;&amp; cd $HOME/data"><pre><span>cd</span> <span>$HOME</span> <span>&amp;&amp;</span> mkdir -p data <span>&amp;&amp;</span> <span>cd</span> <span>$HOME</span>/data</pre></div>
<p dir="auto">Load the data into a Pandas Dataframe.</p>
<p dir="auto"><strong>Note</strong>: Make sure to have pandas and pyarrow installed (<code>pip install pandas pyarrow</code>).</p>
<div dir="auto" data-snippet-clipboard-copy-content="import pandas as pd

df = pd.read_parquet('https://huggingface.co/datasets/HuggingFaceH4/ultrachat_200k/resolve/main/data/test_gen-00000-of-00001-3d4cd8309148a71f.parquet')"><pre><span>import</span> <span>pandas</span> <span>as</span> <span>pd</span>

<span>df</span> <span>=</span> <span>pd</span>.<span>read_parquet</span>(<span>'https://huggingface.co/datasets/HuggingFaceH4/ultrachat_200k/resolve/main/data/test_gen-00000-of-00001-3d4cd8309148a71f.parquet'</span>)</pre></div>
<ul dir="auto">
<li>
<ol start="2" dir="auto">
<li>Split into train and eval</li>
</ol>
</li>
</ul>
<div dir="auto" data-snippet-clipboard-copy-content="df_train=df.sample(frac=0.95,random_state=200)
df_eval=df.drop(df_train.index)"><pre><span>df_train</span><span>=</span><span>df</span>.<span>sample</span>(<span>frac</span><span>=</span><span>0.95</span>,<span>random_state</span><span>=</span><span>200</span>)
<span>df_eval</span><span>=</span><span>df</span>.<span>drop</span>(<span>df_train</span>.<span>index</span>)</pre></div>
<ul dir="auto">
<li>
<ol start="3" dir="auto">
<li>Save data to jsonl</li>
</ol>
</li>
</ul>
<div dir="auto" data-snippet-clipboard-copy-content="df_train.to_json(&quot;ultrachat_chunk_train.jsonl&quot;, orient=&quot;records&quot;, lines=True)
df_eval.to_json(&quot;ultrachat_chunk_eval.jsonl&quot;, orient=&quot;records&quot;, lines=True)"><pre><span>df_train</span>.<span>to_json</span>(<span>"ultrachat_chunk_train.jsonl"</span>, <span>orient</span><span>=</span><span>"records"</span>, <span>lines</span><span>=</span><span>True</span>)
<span>df_eval</span>.<span>to_json</span>(<span>"ultrachat_chunk_eval.jsonl"</span>, <span>orient</span><span>=</span><span>"records"</span>, <span>lines</span><span>=</span><span>True</span>)</pre></div>
<ul dir="auto">
<li>
<ol start="4" dir="auto">
<li>Modify your training yaml to include the ultrachat dataset and verify the yaml</li>
</ol>
</li>
</ul>
<p dir="auto">Modify <a href="https://github.com/mistralai/mistral-finetune/blob/main/example/7B.yaml">example/7B.yaml</a> to include the absolute path to <code>$HOME/data/ultrachat_chunk_train.jsonl</code> as well as a dataset mixing weight for training and <code>$HOME/data/ultrachat_chunk_eval.jsonl</code> for eval, <em>e.g.</em></p>
<div data-snippet-clipboard-copy-content="data:
  instruct_data: &quot;/Users/johndoe/data/ultrachat_chunk_train.jsonl&quot;
  eval_instruct_data: &quot;/Users/johndoe/data/ultrachat_chunk_eval.jsonl&quot;"><pre><code>data:
  instruct_data: "/Users/johndoe/data/ultrachat_chunk_train.jsonl"
  eval_instruct_data: "/Users/johndoe/data/ultrachat_chunk_eval.jsonl"
</code></pre></div>
<p dir="auto">Now you can verify your training yaml to make sure the data is correctly formatted and to get an estimate of your training time.</p>
<div data-snippet-clipboard-copy-content="cd $HOME/mistral-finetune
python -m utils.validate_data --train_yaml example/7B.yaml"><pre><code>cd $HOME/mistral-finetune
python -m utils.validate_data --train_yaml example/7B.yaml
</code></pre></div>
<p dir="auto">Upon completion you should see an error report with many of the following errors:</p>
<div data-snippet-clipboard-copy-content="The data in line 1412 of dataset /Users/johndoe/data/ultrachat_chunk_eval.jsonl is incorrectly formated.Expected last role to be one of: [assistant] but got user
The data in line 1413 of dataset /Users/johndoe/data/ultrachat_chunk_eval.jsonl is incorrectly formated.Expected last role to be one of: [assistant] but got user
The data in line 1414 of dataset /Users/johndoe/data/ultrachat_chunk_eval.jsonl is incorrectly formated.Expected last role to be one of: [assistant] but got user
The data in line 1415 of dataset /Users/johndoe/data/ultrachat_chunk_eval.jsonl is incorrectly formated.Expected last role to be one of: [assistant] but got user"><pre><code>The data in line 1412 of dataset /Users/johndoe/data/ultrachat_chunk_eval.jsonl is incorrectly formated.Expected last role to be one of: [assistant] but got user
The data in line 1413 of dataset /Users/johndoe/data/ultrachat_chunk_eval.jsonl is incorrectly formated.Expected last role to be one of: [assistant] but got user
The data in line 1414 of dataset /Users/johndoe/data/ultrachat_chunk_eval.jsonl is incorrectly formated.Expected last role to be one of: [assistant] but got user
The data in line 1415 of dataset /Users/johndoe/data/ultrachat_chunk_eval.jsonl is incorrectly formated.Expected last role to be one of: [assistant] but got user
</code></pre></div>
<p dir="auto">Many conversations seem to end with the 'user' role which is unnecessary as we only train on 'assistant' messages and thus would unnecessarily process data.</p>
<p dir="auto">You can make use of <a href="https://github.com/mistralai/mistral-finetune/blob/main/utils/reformat_data.py">./utils/reformat_data.py</a> to correct the data:</p>
<div data-snippet-clipboard-copy-content="cd $HOME/mistral-finetune
python -m utils.reformat_data $HOME/data/ultrachat_chunk_train.jsonl
python -m utils.reformat_data $HOME/data/ultrachat_chunk_eval.jsonl"><pre><code>cd $HOME/mistral-finetune
python -m utils.reformat_data $HOME/data/ultrachat_chunk_train.jsonl
python -m utils.reformat_data $HOME/data/ultrachat_chunk_eval.jsonl
</code></pre></div>
<p dir="auto">You should see that a couple of samples will be skipped.</p>
<ul dir="auto">
<li>
<ol start="5" dir="auto">
<li>Potentially change number of training steps</li>
</ol>
</li>
</ul>
<p dir="auto">Upon correction of the dataset, run the script again</p>
<div data-snippet-clipboard-copy-content="cd $HOME/mistral-finetune
python -m utils.validate_data --train_yaml example/7B.yaml"><pre><code>cd $HOME/mistral-finetune
python -m utils.validate_data --train_yaml example/7B.yaml
</code></pre></div>
<p dir="auto">You should get a summary of the data input and training parameters:</p>
<div data-snippet-clipboard-copy-content="Train States
 --------------------
{
   &quot;expected&quot;: {
       &quot;eta&quot;: &quot;00:52:44&quot;,
       &quot;data_tokens&quot;: 25169147,
       &quot;train_tokens&quot;: 131072000,
       &quot;epochs&quot;: &quot;5.21&quot;,
       &quot;max_steps&quot;: 500,
       &quot;data_tokens_per_dataset&quot;: {
           &quot;/Users/johndoe/data/ultrachat_chunk_train.jsonl&quot;: &quot;25169147.0&quot;
       },
       &quot;train_tokens_per_dataset&quot;: {
           &quot;/Users/johndoe/data/ultrachat_chunk_train.jsonl&quot;: &quot;131072000.0&quot;
       },
       &quot;epochs_per_dataset&quot;: {
           &quot;/Users/johndoe/data/ultrachat_chunk_train.jsonl&quot;: &quot;5.2&quot;
       }
   },
}"><pre><code>Train States
 --------------------
{
   "expected": {
       "eta": "00:52:44",
       "data_tokens": 25169147,
       "train_tokens": 131072000,
       "epochs": "5.21",
       "max_steps": 500,
       "data_tokens_per_dataset": {
           "/Users/johndoe/data/ultrachat_chunk_train.jsonl": "25169147.0"
       },
       "train_tokens_per_dataset": {
           "/Users/johndoe/data/ultrachat_chunk_train.jsonl": "131072000.0"
       },
       "epochs_per_dataset": {
           "/Users/johndoe/data/ultrachat_chunk_train.jsonl": "5.2"
       }
   },
}
</code></pre></div>
<p dir="auto">Having <code>max_steps</code> set to 500 would lead to iterating through the dataset roughly 5 times which is reasonable, but might
be a bit too much. A recommended setting is shown below which would only take 30min on a 8xH100 cluster.</p>
<p dir="auto"><h3 tabindex="-1" dir="auto">Function calling</h3><a id="user-content-function-calling" aria-label="Permalink: Function calling" href="#function-calling"></a></p>
<p dir="auto">Next let's go over a more advanced use case to fine-tune a model on function calling.
Function calling requires the data to be in the format as <a href="#instruct">explained above</a>. Let's go over an example.</p>
<ul dir="auto">
<li>
<ol dir="auto">
<li><strong>Load a chat-formatted version of the <a href="https://huggingface.co/datasets/Locutusque/function-calling-chatml" rel="nofollow">Glaive function calling dataset</a></strong></li>
</ol>
</li>
</ul>
<p dir="auto">Create the data folder and navigate to the folder.</p>
<div dir="auto" data-snippet-clipboard-copy-content="cd $HOME &amp;&amp; mkdir -p data &amp;&amp; cd $HOME/data"><pre><span>cd</span> <span>$HOME</span> <span>&amp;&amp;</span> mkdir -p data <span>&amp;&amp;</span> <span>cd</span> <span>$HOME</span>/data</pre></div>
<p dir="auto">Load the data into a Pandas Dataframe.</p>
<p dir="auto"><strong>Note</strong>: Make sure to have pandas and pyarrow installed (<code>pip install pandas pyarrow</code>).</p>
<div dir="auto" data-snippet-clipboard-copy-content="import pandas as pd

df = pd.read_parquet('https://huggingface.co/datasets/Locutusque/function-calling-chatml/resolve/main/data/train-00000-of-00001-f0b56c6983b4a78f.parquet')"><pre><span>import</span> <span>pandas</span> <span>as</span> <span>pd</span>

<span>df</span> <span>=</span> <span>pd</span>.<span>read_parquet</span>(<span>'https://huggingface.co/datasets/Locutusque/function-calling-chatml/resolve/main/data/train-00000-of-00001-f0b56c6983b4a78f.parquet'</span>)</pre></div>
<ul dir="auto">
<li>
<ol start="2" dir="auto">
<li>Split into train and eval</li>
</ol>
</li>
</ul>
<div dir="auto" data-snippet-clipboard-copy-content="df_train=df.sample(frac=0.95,random_state=200)
df_eval=df.drop(df_train.index)"><pre><span>df_train</span><span>=</span><span>df</span>.<span>sample</span>(<span>frac</span><span>=</span><span>0.95</span>,<span>random_state</span><span>=</span><span>200</span>)
<span>df_eval</span><span>=</span><span>df</span>.<span>drop</span>(<span>df_train</span>.<span>index</span>)</pre></div>
<ul dir="auto">
<li>
<ol start="3" dir="auto">
<li>Save data to jsonl</li>
</ol>
</li>
</ul>
<div dir="auto" data-snippet-clipboard-copy-content="df_train.to_json(&quot;glaive_train.jsonl&quot;, orient=&quot;records&quot;, lines=True)
df_eval.to_json(&quot;glaive_eval.jsonl&quot;, orient=&quot;records&quot;, lines=True)"><pre><span>df_train</span>.<span>to_json</span>(<span>"glaive_train.jsonl"</span>, <span>orient</span><span>=</span><span>"records"</span>, <span>lines</span><span>=</span><span>True</span>)
<span>df_eval</span>.<span>to_json</span>(<span>"glaive_eval.jsonl"</span>, <span>orient</span><span>=</span><span>"records"</span>, <span>lines</span><span>=</span><span>True</span>)</pre></div>
<ul dir="auto">
<li>
<ol start="4" dir="auto">
<li>Reformat dataset</li>
</ol>
</li>
</ul>
<p dir="auto">As one can see the dataset does not follow the required function calling format, so it will need to be reformatted. Among other things <code>"from"</code> should be renamed to <code>"user"</code> and superfluous <code>"\n"</code> characters should be removed.
For this dataset you can make use of <a href="https://github.com/mistralai/mistral-finetune/blob/main/utils/reformat_data_glaive.py"><code>./utils/reformat_data_glaive.py</code></a>:</p>
<div data-snippet-clipboard-copy-content="cd $HOME/mistral-finetune
python -m utils.reformat_data_glaive $HOME/data/glaive_train.jsonl
python -m utils.reformat_data_glaive $HOME/data/glaive_eval.jsonl"><pre><code>cd $HOME/mistral-finetune
python -m utils.reformat_data_glaive $HOME/data/glaive_train.jsonl
python -m utils.reformat_data_glaive $HOME/data/glaive_eval.jsonl
</code></pre></div>
<p dir="auto">Running this command will make sure that most samples are in the correct format.</p>
<p dir="auto"><strong>Note</strong>: It is impossible to write reformatting scripts that work for all kinds of datasets.
If you have datasets that don't yet follow the required format above, you will most probably have to
create a reformatting script yourself (mistral-chat or chat-gpt is your best friend here!).</p>
<ul dir="auto">
<li>
<ol start="5" dir="auto">
<li>Validate dataset</li>
</ol>
</li>
</ul>
<p dir="auto">You can now validate the dataset by setting <code>data.instruct_data</code> and <code>data.eval_instruct_data</code> to
<code>$HOME/data/glaive_train.jsonl</code> and <code>$HOME/data/glaive_eval.jsonl</code> in <code>example/7B.yaml</code> respectively.</p>
<p dir="auto">The reformatted datasets still has some errors which can be removed with <code>--create_corrected</code>. For this, make sure to add
<code>--create_corrected</code> as follows:</p>
<div data-snippet-clipboard-copy-content="cd $HOME/mistral-finetune
python -m utils.validate_data --train_yaml example/7B.yaml --create_corrected"><pre><code>cd $HOME/mistral-finetune
python -m utils.validate_data --train_yaml example/7B.yaml --create_corrected
</code></pre></div>
<p dir="auto">Running this command will show a couple of errors and save two new datasets <code>$HOME/data/glaive_train.jsonl.corrected</code> and <code>$HOME/data/glaive_eval.jsonl.corrected</code>. Make sure to use these two dataset in <code>example/7B.yaml</code> and run the command again. Now the dataset should be correctly formatted!</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Start training</h2><a id="user-content-start-training" aria-label="Permalink: Start training" href="#start-training"></a></p>
<p dir="auto">Having followed the <a href="#verify-dataset">dataset verification section</a>, we can now start training.
For faster training, we recommend setting max_steps to only 300. Make sure to define <code>run_dir</code> to your experiment folder and optionally set <code>wandb_project</code> to a Weights &amp; Biases project for logging`, <em>e.g.</em>:</p>
<div data-snippet-clipboard-copy-content="max_steps: 300
run_dir: &quot;/Users/johndoe/ultra_chat_test&quot;
wandb.project: ultra_chat"><pre><code>max_steps: 300
run_dir: "/Users/johndoe/ultra_chat_test"
wandb.project: ultra_chat
</code></pre></div>
<p dir="auto">Optionally you can also set <code>wandb</code></p>
<p dir="auto">Save the training configuration and start training! Make sure to set <code>--nproc-per-node</code> to the number of available GPUs.</p>
<div data-snippet-clipboard-copy-content="cd $HOME/mistral-finetune
torchrun --nproc-per-node 8 --master_port $RANDOM -m train example/7B.yaml"><pre><code>cd $HOME/mistral-finetune
torchrun --nproc-per-node 8 --master_port $RANDOM -m train example/7B.yaml
</code></pre></div>
<p dir="auto">Training on ultra-chat should take around 30min on a 8xH100 node and the resulting weights should give an MT Bench score around 6.3.</p>
<p dir="auto">Training on glaive should take around 1h on a 8xH100 node and the resulting weights should work nicely for function calling.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Customizing training configuration</h2><a id="user-content-customizing-training-configuration" aria-label="Permalink: Customizing training configuration" href="#customizing-training-configuration"></a></p>
<p dir="auto">The example <code>mistral-finetune/examples/7B</code> defines reasonable parameters for learning rate, weight decay, etc... but you are advised to
customize these settings for your use case.</p>
<p dir="auto">Generally, a training configuration should fill the following parameters:</p>
<ul dir="auto">
<li><code>model_id_or_path</code> defines the model to start training from. This can be a path to a pre-trained model or a local model directory.</li>
<li><code>run_dir</code> defines the directory where training checkpoints and metrics are stored.</li>
<li><code>seq_len</code> defines the sequence length for training. This is the maximum length of input sequences the model will process. Samples are packed to reach a length of <code>seq_len</code> for maximum training efficiency.</li>
<li><code>batch_size</code> defines the number of training examples used per GPU. <strong>Note</strong>: The overall effective batch_size (in tokens) across all GPUs equals <code>num_gpus</code> x <code>batch_size</code> x <code>seq_len</code>.</li>
<li><code>max_steps</code> defines the maximum number of training steps. This is the total number of iterations the training process will run. It can be adjusted based on the specific needs of your training scenario. Total number of tokens seen during training is <code>max_steps</code> x <code>num_gpus</code> x <code>batch_size</code> x <code>seq_len</code>.</li>
<li><code>optim.lr</code> defines the learning rate. This is the initial learning rate for the optimizer.</li>
<li><code>optim.weight_decay</code> defines weight decay. Weight decay is a regularization technique used to prevent overfitting by penalizing large weights. We recommend leaving it at 0.1.</li>
<li><code>optim.pct_start</code> defines the percentage of the total training steps used for the learning rate warm-up phase before it starts to decrease. It corresponds to pct_start of PyTorch's OneCycleLR.</li>
<li><code>lora.rank</code> defines the size of the LoRA (Low-Rank Adaptation) adapters. We recommend 64 or less, which adjusts the rank of the low-rank decomposition used in LoRA.</li>
<li><code>seed</code> defines the random seed for initialization and data shuffling/sampling. Setting a seed ensures reproducibility of results.</li>
<li><code>log_freq</code> defines the logging frequency. This specifies how often (in steps) to log training metrics.</li>
<li><code>data.instruct_data</code> is the path to the instruction data used for training. This field has to be filled with one or multiple data sources in the format as explained above. Each data source should either be a path to jsonl file of a path to a directory containing jsonl files followed by a weighting to define the importance of this dataset: <code>&lt;path/to/data_source&gt;:&lt;weight&gt;</code>. E.g.: <code>data.instruct_data: "/path/to/data1.jsonl:5.,/path/to/data2.jsonl:1.,/path/to/dir_of_jsonls:1."</code></li>
<li><code>data.data</code> is an optional path to additional pretraining data in the format as explained above. Note that this field can be left blank.</li>
<li><code>data.eval_instruct_data</code> is an optional path to evaluation instruction data to run cross-validation at every <code>eval_freq</code> steps. Cross-validation metrics are displayed as <code>loss</code> and <code>perplexity</code>.</li>
<li><code>eval_freq</code> defines how often (in steps) to evaluate the model. This specifies the interval at which the model is evaluated on the validation set.</li>
<li><code>no_eval</code> is a flag to enable or disable intermediate evaluation. Setting it to False enables periodic evaluation during training.</li>
<li><code>ckpt_freq</code> defines how often (in steps) to save checkpoints. This specifies the interval at which the model's state is saved.</li>
<li><code>ckpt_only_lora</code> defines whether to only save the trained LoRA checkpoints or whether the trained LoRA should directly be merged into the base model and saved. <strong>Note</strong>: When setting <code>ckpt_only_lora=False</code> make sure that you have enough CPU and GPU memory to save the full model on a single process (this is usually only possible for the 7B model).</li>
<li><code>wandb.key</code> is used to pass your Weights &amp; Biases (wandb) API key for logging. This allows you to log training metrics to the wandb dashboard.</li>
<li><code>wandb.project</code> defines the wandb project name. This is where the training run will be logged in the wandb interface.</li>
</ul>
<p dir="auto"><h2 tabindex="-1" dir="auto">Inference</h2><a id="user-content-inference" aria-label="Permalink: Inference" href="#inference"></a></p>
<p dir="auto">Once your model is trained, you should try it out in inference. We recommend using <a href="https://github.com/mistralai/mistral-inference">mistral-inference</a>.</p>
<p dir="auto">Make sure to have <code>mistral_inference</code> correctly installed:</p>
<div data-snippet-clipboard-copy-content="pip install mistral_inference"><pre><code>pip install mistral_inference
</code></pre></div>
<p dir="auto">Assuming your <code>lora.safetensors</code> is saved under <code>$HOME/ultra_chat_test/checkpoints/checkpoint_000300/consolidated/lora.safetensors</code>, you can chat with the model using <code>mistral_inference</code>, <em>e.g.</em>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="mistral-chat /mnt/slow/runs/patrick/mistral-finetune/7B/ --max_tokens 256 --temperature 1.0 --instruct --lora_path $HOME/ultra_chat_test/checkpoints/checkpoint_000300/consolidated/lora.safetensors"><pre>mistral-chat /mnt/slow/runs/patrick/mistral-finetune/7B/ --max_tokens 256 --temperature 1.0 --instruct --lora_path <span>$HOME</span>/ultra_chat_test/checkpoints/checkpoint_000300/consolidated/lora.safetensors</pre></div>
<p dir="auto"><h2 tabindex="-1" dir="auto">Model extension</h2><a id="user-content-model-extension" aria-label="Permalink: Model extension" href="#model-extension"></a></p>
<p dir="auto"><strong>Important</strong>: Note that one can only fine-tune mistral models that are compatible with the v3 tokenizer which entails that the models have a vocabulary size of 32768 - not 32000. One can however easily extend older version of vocabulary size 32000 to have a vocabulary size of 32768 by using:</p>
<div data-snippet-clipboard-copy-content="python -m utils.extend_model_vocab --original_model_ckpt /folder/to/old/model --extended_model_ckpt /folder/to/extended/model"><pre><code>python -m utils.extend_model_vocab --original_model_ckpt /folder/to/old/model --extended_model_ckpt /folder/to/extended/model
</code></pre></div>
<p dir="auto">Once the extension has worked, one can fine-tune using the newly created model checkpoint in <code>/folder/to/extended/model</code>.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">FAQ:</h2><a id="user-content-faq" aria-label="Permalink: FAQ:" href="#faq"></a></p>
<blockquote>
<ul dir="auto">
<li>What's the best practice of fine-tuning MoEs?</li>
</ul>
</blockquote>
<p dir="auto">We see a higher degree of performance variance in when fine-tuning MoE models. It's not unusual to find that fine-tuning MoEs models with different seeds can lead to a high variance in performance. We did not observe such a high variance with dense models. Therefore, we suggest running multiple instances of the same fine-tuning process on MoEs models and selecting the one that performs best.</p>
<blockquote>
<ul dir="auto">
<li>How can I determine the number of tokens used during the model training process?</li>
</ul>
</blockquote>
<p dir="auto">You can use the following script to find out: <a href="https://github.com/mistralai/mistral-finetune/blob/main/utils/validate_data.py">https://github.com/mistralai/mistral-finetune/blob/main/utils/validate_data.py</a>. This script accepts a .yaml training file as input and returns the number of tokens the model is being trained on.</p>
<blockquote>
<ul dir="auto">
<li>What should I do if I encounter a CUDA out-of-memory error?</li>
</ul>
</blockquote>
<p dir="auto">One possible solution is to reduce the batch size per GPU. The batch size is equal to <code>seq_len</code> x <code>batch_size</code>. Try setting <code>batch_size</code> to 1 and reduce <code>seq_len</code>. You can define the <code>batch_size</code> and <code>seq_len</code> in the .yaml file.</p>
</article></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Optimize Your Talking Points (137 pts)]]></title>
            <link>https://rachelbythebay.com/w/2018/04/28/meta/</link>
            <guid>40472374</guid>
            <pubDate>Sat, 25 May 2024 03:13:08 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://rachelbythebay.com/w/2018/04/28/meta/">https://rachelbythebay.com/w/2018/04/28/meta/</a>, See on <a href="https://news.ycombinator.com/item?id=40472374">Hacker News</a></p>
Couldn't get https://rachelbythebay.com/w/2018/04/28/meta/: Error: Request failed with status code 403]]></description>
        </item>
        <item>
            <title><![CDATA[You are lucky, full moon tonight (130 pts)]]></title>
            <link>https://twitter.com/cupiabart/status/1793930355617259811</link>
            <guid>40472226</guid>
            <pubDate>Sat, 25 May 2024 02:35:56 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://twitter.com/cupiabart/status/1793930355617259811">https://twitter.com/cupiabart/status/1793930355617259811</a>, See on <a href="https://news.ycombinator.com/item?id=40472226">Hacker News</a></p>
&lt;Unparsable&gt;]]></description>
        </item>
        <item>
            <title><![CDATA[JetBrains releases RustRover IDE for Rust development (153 pts)]]></title>
            <link>https://www.infoworld.com/article/3715317/jetbrains-releases-rustrover-ide-for-rust-development.html</link>
            <guid>40472146</guid>
            <pubDate>Sat, 25 May 2024 02:15:58 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.infoworld.com/article/3715317/jetbrains-releases-rustrover-ide-for-rust-development.html">https://www.infoworld.com/article/3715317/jetbrains-releases-rustrover-ide-for-rust-development.html</a>, See on <a href="https://news.ycombinator.com/item?id=40472146">Hacker News</a></p>
<div id="readability-page-1" class="page"><section role="main" id="page-wrapper">
	
		
		
		

		<article itemscope="" itemtype="http://schema.org/NewsArticle">

		















<!-- Events Header -->

 
 
	
		
		
		
		
		
					    			
		
	
	
	
	
	

 
 
 
 
  
  
 
 












	
	
	
	
	
	
	
	
	
	
	
	
	
	
	


<!-- //end Events Header -->


	
	
	
	
	
	
		
	



	
		
	
	
		






















	
	
	
		
	



















	
		
	
	
















	
	




	
			












	
	
		<meta itemprop="keywords" content="rust, integrated development environments, development tools, software development ">
	







<header>

	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
		
		
			
		
	
	

	
	
	
	
	
		<section>
			<h3 itemprop="description">RustRover provides a built-in toolchain for testing, running, debugging, and analyzing Rust code, with optional AI assistance via plugin and subscription. </h3>
		</section>
	
	
	
	
	
	
	
	
			
	
	
	

	
		
			
				
				<div>
						
						<p>
						
							Editor at Large, 
								
									
								












<span itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><span itemprop="name">InfoWorld</span><meta itemprop="url" content="https://www.infoworld.com"><meta itemprop="logo" content="https://idge.staticworld.net/ifw/IFW_logo_social_300x300.png"></span> <span>|</span>
							
	
							<span itemprop="datePublished" content="2024-05-24T02:00-0700"><span></span>
								
							</span>
						</p>
					</div>
			
		
	
	
		
	
	
		
			
			
				
				
				
				
					
					
						
					
				
				
			
		
	
	
	
	
	
</header>




	














		
		



		<section>

			
				
				
					












	
		



























	



	
	
	
	
		
	
	
	
	
	
	
	
	
		
		
			
			
			
			
		
	
	
	
	
	
	
			
	
	
	
	
	
	
		
		
			
		
	
	
	
	
	
		
			
				
				
				
					
				
				
			
		
		
	
	
		
		
			<div id="drr-container" itemprop="articleBody">
		
		
		
		
	
		
			
			
				<p>JetBrains has released RustRover, a dedicated IDE for the <a href="https://www.infoworld.com/article/3218074/what-is-rust-safe-fast-and-easy-software-development.html">Rust programming language</a> that combines an integrated Rust toolchain with support for AI assistance through an optional plugin and subscription.</p><p><a href="https://blog.jetbrains.com/rust/2024/05/21/rustrover-is-released-and-includes-a-free-non-commercial-option/" rel="nofollow">Announced May 21</a>, <a href="https://www.jetbrains.com/rust/" rel="nofollow">RustRover</a> is positioned to simplify the Rust coding experience while “unlocking the language’s full potential,” JetBrains said. Capabilities include real-time feedback, code suggestions, simplified toolchain management, and team collaboration.</p><p>JetBrains also rolled out a new licensing model. RustRover is available through a paid commercial license or a free non-commercial license, the latter for individuals using RustRover for non-commercial purposes.</p><p>Previously, JetBrains offered <a href="https://www.jetbrains.com/rust/" rel="nofollow">IntelliJ Rust</a>, an open-source Rust plugin for IntelliJ IDEs. With RustRover the company aims to provide a dedicated product with enhanced functionality for the growing Rust developer community. JetBrains also has been previewing a multi-language editor and IDE, called <a href="https://www.infoworld.com/article/3664112/jetbrains-fleet-the-future-of-ides.html">JetBrains Fleet</a>, that supports Rust development.</p><p>Key features of RustRover include:</p><ul>
<li>Rust toolchain support including support for the Rust compiler.</li>
<li>Version control system integration, with <a href="https://www.infoworld.com/article/3267565/what-is-github-more-than-git-version-control-in-the-cloud.html">GitHub</a> and <a href="https://www.infoworld.com/article/3654955/what-is-git-version-control-for-collaborative-programming.html">Git</a> support. Users are able to streamline collaboration and control for teams.</li>
<li>Error detection and real-time feedback for debugging.</li>
<li>Support for front-end technologies and databases.</li>
<li>Permissive completion and parsing including smart code suggestions even in unconventional contexts.</li>
<li>Unit testing integration for testing, rerunning failed tests, and resolving errors.</li>
</ul><p>RustRover has natural similarities to JetBrains’ other language-specific IDEs including <a href="https://www.infoworld.com/article/3602670/pycharm-python-ide-backs-apple-silicon.html">PyCharm</a> for <a href="https://www.infoworld.com/article/3204016/what-is-python-powerful-intuitive-programming.html">Python</a>, <a href="https://www.infoworld.com/article/3630389/jetbrains-go-language-ide-prepares-for-generics.html">GoLand</a> for <a href="https://www.infoworld.com/article/3198928/whats-the-go-language-really-good-for.html">Go</a>, and <a href="https://www.infoworld.com/article/3692291/jetbrains-updates-ides-for-java-javascript-ruby.html">RubyMine</a> for <a href="https://www.infoworld.com/article/3687219/whatever-happened-to-ruby.html">Ruby</a>. All support the <a href="https://plugins.jetbrains.com/plugin/22282-jetbrains-ai-assistant" rel="nofollow">JetBrains AI Assistant plugin</a>, which provides AI-powered code suggestions, code explanations, and code chat through a JetBrains AI subscription.</p>
			
		
		
	
		
		
			
		
		
		
		
			
			
			
			











		
		
	</div>
	
	
	
		
		
		
	
	
	
	
	
	
	
	
	    
	
	
	
	
	
	
	
	
	
			
	   		












	
	
		<div>	
			<p>Paul Krill is an editor at large at InfoWorld, whose coverage focuses on application development.</p><!-- end .author-info -->
						
		</div>
	



	   		
	   		
			
	
	
	
	
		












	






	<p>Copyright © 2024 IDG Communications, Inc.</p>

	
		 
	
	
	
	
	
		
		
	

















	 
	







	



	

	
	
	
	
	
	












	
	
	
	
	
	
	
	
	
	
	
	
	
	
	


























		

	
	















		






	
	
	
	




					










				
			
		
		</section><!-- /.bodee -->

		














 




	
		
			
				
				
					
						
					

				
			
			
		

		
			
			
		
			
				
					
							
	
	



	
		
			












	
	
	

			
		
	
	




		</article>

	</section></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Email.ml – Minimalist Temporary Email (146 pts)]]></title>
            <link>https://email.ml/</link>
            <guid>40471798</guid>
            <pubDate>Sat, 25 May 2024 00:52:02 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://email.ml/">https://email.ml/</a>, See on <a href="https://news.ycombinator.com/item?id=40471798">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="__nuxt"><!--[--><main><section><nav><div><div><p><a href="https://email.ml/"><span><span></span></span><span>Email<dot>.</dot>ML</span></a></p></div><div><p><a href="https://email.ml/" target="_blank"><span><span></span></span><span>Email<dot>.</dot>ML</span></a></p><div><p><a href="https://email.ml/about"> About </a><a href="https://email.ml/privacy"> Privacy </a><a href="https://email.ml/terms"> Terms </a><span>Share</span><a href="https://www.buymeacoffee.com/ccbikai" target="_blank">Donate</a></p></div></div></div></nav></section><div><p>Minimalist temporary Email</p><!--[--><div><p>Privacy friendly</p></div><div><p>Valid for 1 hour</p></div><div><p>AD friendly</p></div><div><p>100% Run on Cloudflare</p></div><!--]--></div><div><a href="https://email.ml/">Email<dot>.</dot>ML</a><p><a href="https://html.zone/" target="_blank"> © 2024 Products of HTML.ZONE </a><span><a href="mailto:email.ml$miantiao.me" title="Email"><span>Email</span><span></span></a><a href="https://t.me/htmlzone" target="_blank" title="Telegram"><span>Telegram</span><span></span></a><a href="https://mt.ci/" target="_blank" title="Blog"><span>Blog</span><span></span></a><a href="https://twitter.com/ccbikai" target="_blank" title="Twitter"><span>Twitter</span><span></span></a><a href="https://miantiao.me/@chi" target="_blank" title="Mastodon"><span>Mastodon</span><span></span></a><a href="https://github.com/ccbikai" target="_blank" title="GitHub"><span>GitHub</span><span></span></a></span></p></div></main><!--[--><!--[--><!--[--><!--]--><div role="region" aria-label="Notifications (F8)" tabindex="-1"><!--[--><!----><ol tabindex="-1"><!--[--><!--]--></ol><!----><!--]--></div><!--]--><!--]--><!--]--></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Show HN: Spot – Simple, cross-platform, reactive desktop GUI toolkit for Go (250 pts)]]></title>
            <link>https://github.com/roblillack/spot</link>
            <guid>40469592</guid>
            <pubDate>Fri, 24 May 2024 19:19:31 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/roblillack/spot">https://github.com/roblillack/spot</a>, See on <a href="https://news.ycombinator.com/item?id=40469592">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/roblillack/spot/blob/main/resources/2024-05-13-demo-video.gif"><img src="https://github.com/roblillack/spot/raw/main/resources/2024-05-13-demo-video.gif" width="50%" height="50%" data-animated-image=""></a></p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Spot</h2><a id="user-content-spot" aria-label="Permalink: Spot" href="#spot"></a></p>
<p dir="auto"><a href="https://pkg.go.dev/github.com/roblillack/spot" rel="nofollow"><img src="https://camo.githubusercontent.com/70e8dd7078dc2d09f7058a74f24a866773920c82925f6cb45402920c4e770829/68747470733a2f2f706b672e676f2e6465762f62616467652f6769746875622e636f6d2f726f626c696c6c61636b2f73706f742e737667" alt="Go Reference" data-canonical-src="https://pkg.go.dev/badge/github.com/roblillack/spot.svg"></a>
<a href="https://goreportcard.com/report/github.com/roblillack/spot" rel="nofollow"><img src="https://camo.githubusercontent.com/45ab88ab7352fae584dc4ff3808407d5b9333a11c524d602d13879175e82b3dd/68747470733a2f2f676f7265706f7274636172642e636f6d2f62616467652f6769746875622e636f6d2f726f626c696c6c61636b2f73706f74" alt="Go Report Card" data-canonical-src="https://goreportcard.com/badge/github.com/roblillack/spot"></a></p>
<p dir="auto">Spot is a simple, cross-platform, reactive GUI toolkit for Go using native
widgets where available. It is designed to be easy to use and to provide a
consistent API across different platforms.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Example</h2><a id="user-content-example" aria-label="Permalink: Example" href="#example"></a></p>
<div dir="auto" data-snippet-clipboard-copy-content="package main

import (
	&quot;fmt&quot;

	&quot;github.com/roblillack/spot&quot;
	&quot;github.com/roblillack/spot/ui&quot;
)

func main() {
	ui.Init()

	spot.MountFn(func(ctx *spot.RenderContext) spot.Component {
		counter, setCounter := spot.UseState[int](ctx, 0)

		buttonTitle := &quot;Click me!&quot;
		if counter > 0 {
			buttonTitle = fmt.Sprintf(&quot;Clicked %d times!&quot;, counter)
		}

		return &amp;ui.Window{
			Title:  &quot;Hello World!&quot;,
			Width:  200,
			Height: 125,
			Children: []spot.Component{
				&amp;ui.Button{
					X: 25, Y: 50, Width: 150, Height: 25,
					Title: buttonTitle,
					OnClick: func() {
						setCounter(counter + 1)
					},
				},
			},
		}
	})

	ui.Run()
}"><pre><span>package</span> main

<span>import</span> (
	<span>"fmt"</span>

	<span>"github.com/roblillack/spot"</span>
	<span>"github.com/roblillack/spot/ui"</span>
)

<span>func</span> <span>main</span>() {
	<span>ui</span>.<span>Init</span>()

	<span>spot</span>.<span>MountFn</span>(<span>func</span>(<span>ctx</span> <span>*</span>spot.<span>RenderContext</span>) spot.<span>Component</span> {
		<span>counter</span>, <span>setCounter</span> <span>:=</span> <span>spot</span>.<span>UseState</span>[<span>int</span>](<span>ctx</span>, <span>0</span>)

		<span>buttonTitle</span> <span>:=</span> <span>"Click me!"</span>
		<span>if</span> <span>counter</span> <span>&gt;</span> <span>0</span> {
			<span>buttonTitle</span> <span>=</span> <span>fmt</span>.<span>Sprintf</span>(<span>"Clicked %d times!"</span>, <span>counter</span>)
		}

		<span>return</span> <span>&amp;</span>ui.<span>Window</span>{
			<span>Title</span>:  <span>"Hello World!"</span>,
			<span>Width</span>:  <span>200</span>,
			<span>Height</span>: <span>125</span>,
			<span>Children</span>: []spot.<span>Component</span>{
				<span>&amp;</span>ui.<span>Button</span>{
					<span>X</span>: <span>25</span>, <span>Y</span>: <span>50</span>, <span>Width</span>: <span>150</span>, <span>Height</span>: <span>25</span>,
					<span>Title</span>: <span>buttonTitle</span>,
					<span>OnClick</span>: <span>func</span>() {
						<span>setCounter</span>(<span>counter</span> <span>+</span> <span>1</span>)
					},
				},
			},
		}
	})

	<span>ui</span>.<span>Run</span>()
}</pre></div>
<p dir="auto"><h2 tabindex="-1" dir="auto">Features</h2><a id="user-content-features" aria-label="Permalink: Features" href="#features"></a></p>
<ul dir="auto">
<li><strong>Simple</strong>: You can add Spot as a simple dependency to your project and start
building your UI right away. No need to use additional tools or code
generation steps. Just write Go code and get a native GUI application as a
self-contained binary.</li>
<li><strong>Cross-platform</strong>: Spot uses native widgets where available and
automatically selects the best backend for the platform you are running on
at compile time. Currently, two backend implementations are provided: one
based on <a href="https://fltk.org/" rel="nofollow">FLTK</a> using
<a href="https://github.com/pwiecz/go-fltk">go-fltk</a> and one based on Cocoa using
(<a href="https://github.com/roblillack/gocoa">a modified version of</a>)
<a href="https://github.com/mojbro/gocoa">gocoa</a>.</li>
<li><strong>Reactive</strong>: Spot automatically updates the UI when the state of the
application changes. You just provide side-effect free rendering functions
and manage the state of your application using the <a href="https://pkg.go.dev/github.com/roblillack/spot#UseState" rel="nofollow"><code>UseState</code></a> hook.</li>
<li><strong>Broad widget support</strong>: Spot provides a wide range of UI controls out of
the box, including buttons, labels, text inputs, sliders, dropdowns, and
more. See the full list:
<a href="#list-of-supported-ui-controls">List of supported UI controls</a>.</li>
</ul>
<p dir="auto"><h2 tabindex="-1" dir="auto">FAQs</h2><a id="user-content-faqs" aria-label="Permalink: FAQs" href="#faqs"></a></p>
<p dir="auto"><h4 tabindex="-1" dir="auto">What does "reactive" mean?</h4><a id="user-content-what-does-reactive-mean" aria-label="Permalink: What does &quot;reactive&quot; mean?" href="#what-does-reactive-mean"></a></p>
<p dir="auto">In the context of Spot, <em>reactive</em> means that the UI is automatically updated
when the state of the application changes. This is achieved by re-building an
immutable component tree upon state changes which can quickly be compared to
the previous state in order to determine what UI controls need to be updated.
In the web world, this idea is often called a "virtual DOM" and Spot actually
started as an experiment to bring this concept to Go by implementing a
React-like GUI library for the desktop.</p>
<p dir="auto">By using a reactive model, the developer does not need to worry about updating
the UI manually. Instead, the developer can focus on the application logic and
let Spot take care of updating the UI.</p>
<p dir="auto"><h4 tabindex="-1" dir="auto">What are the "native widgets" that Spot uses?</h4><a id="user-content-what-are-the-native-widgets-that-spot-uses" aria-label="Permalink: What are the &quot;native widgets&quot; that Spot uses?" href="#what-are-the-native-widgets-that-spot-uses"></a></p>
<p dir="auto">Currently, Spot uses a Cocoa backend on macOS and a FLTK-based one on all other
platforms. Optionally, FLTK can be used on the Mac, too. Better support for
Windows is planned for the future.</p>
<p dir="auto"><h4 tabindex="-1" dir="auto">Can I implement my own hooks?</h4><a id="user-content-can-i-implement-my-own-hooks" aria-label="Permalink: Can I implement my own hooks?" href="#can-i-implement-my-own-hooks"></a></p>
<p dir="auto">Yes, just like in React, you can implement your own hooks. Just create a
function which takes a <code>*spot.RenderContext</code> as first argument and use this to
"hook" into the Spot lifecycle by calling <code>spot.UseState</code>, <code>spot.UseEffect</code>,
etc. Convention here is to prefix the function with <code>Use…</code>.</p>
<p dir="auto"><h4 tabindex="-1" dir="auto">How do I write custom components?</h4><a id="user-content-how-do-i-write-custom-components" aria-label="Permalink: How do I write custom components?" href="#how-do-i-write-custom-components"></a></p>
<p dir="auto">There are a few different ways to separate your UI into components in Spot;
for some ideas, check out the <code>custom-components</code> example. The main way to
write custom components is to create a struct that implements the
<code>spot.Component</code> interface. This interface has a single method,
<code>Render(ctx *spot.RenderContext) spot.Component</code>, which is called to render
the component. Components created like this can be used in the same way as
the built-in ones.</p>
<p dir="auto">Look at the <code>BlinkingButton</code> component in the example to see how this is done.</p>
<p dir="auto"><h4 tabindex="-1" dir="auto">Can I use Spot with a completely different widget library than the provided one?</h4><a id="user-content-can-i-use-spot-with-a-completely-different-widget-library-than-the-provided-one" aria-label="Permalink: Can I use Spot with a completely different widget library than the provided one?" href="#can-i-use-spot-with-a-completely-different-widget-library-than-the-provided-one"></a></p>
<p dir="auto">Yes, you can. You just need to create some structs that implement the
<code>spot.Component</code> interface and which take care of managing the native widgets.</p>
<p dir="auto"><h4 tabindex="-1" dir="auto">Can I use <code>spot/ui</code>, but with a different backend than Cocoa or FLTK?</h4><a id="user-content-can-i-use-spotui-but-with-a-different-backend-than-cocoa-or-fltk" aria-label="Permalink: Can I use spot/ui, but with a different backend than Cocoa or FLTK?" href="#can-i-use-spotui-but-with-a-different-backend-than-cocoa-or-fltk"></a></p>
<p dir="auto">Currently, these are the only backends that are supported. But feel free to
create a PR if you want to add support for another backend. <em>*hint hint*</em></p>
<p dir="auto"><h4 tabindex="-1" dir="auto">What's the difference between <code>spot/ui</code> and <code>spot</code>?</h4><a id="user-content-whats-the-difference-between-spotui-and-spot" aria-label="Permalink: What's the difference between spot/ui and spot?" href="#whats-the-difference-between-spotui-and-spot"></a></p>
<p dir="auto"><code>spot</code> is the core package that provides the reactive model and the rendering
functionality. It is backend-agnostic and can be used with any set of controls
which implement the <code>spot.Control</code> interface.</p>
<p dir="auto"><code>spot/ui</code> is a package that provides a set of pre-built cross-platform GUI
controls that which can be used with <code>spot</code>.</p>
<p dir="auto"><h4 tabindex="-1" dir="auto">What's the difference between a “component” and a “control”?</h4><a id="user-content-whats-the-difference-between-a-component-and-a-control" aria-label="Permalink: What's the difference between a “component” and a “control”?" href="#whats-the-difference-between-a-component-and-a-control"></a></p>
<p dir="auto">In Spot, a <em>component</em> is a logical unit of the application that contains
business logic and state. Any component is made out of other componens and
can ultimately be rendered down to a single or multiple "controls".</p>
<p dir="auto">A <em>control</em> is special kind component is mounted to the UI tree and represents
a visual element on the screen. Usually a control is backed by a native
implementation of the GUI backend, like a button, a label, or a text input.</p>
<p dir="auto"><h4 tabindex="-1" dir="auto">What do the terms ”make”, “render”, “build”, “mount”, and “update” mean in the context of Spot?</h4><a id="user-content-what-do-the-terms-make-render-build-mount-and-update-mean-in-the-context-of-spot" aria-label="Permalink: What do the terms ”make”, “render”, “build”, “mount”, and “update” mean in the context of Spot?" href="#what-do-the-terms-make-render-build-mount-and-update-mean-in-the-context-of-spot"></a></p>
<ul dir="auto">
<li>
<p dir="auto"><em>Make</em>: The process of creating a new component instance. This is done by
creating a reference to an instance of a struct that implements the
<code>spot.Component</code> interface or by calling <code>spot.Make</code> with a render function.</p>
</li>
<li>
<p dir="auto"><em>Render</em>: The process of applying a component's state to its building blocks
and hereby returning another component instance. This is done by calling the
<code>Render</code> method on a component instance.</p>
</li>
<li>
<p dir="auto"><em>Build</em>: The process of creating a new UI tree from a component instance.
This is done by <em>recursively</em> rendering a component to create a tree of
controls. This can be done by calling <code>spot.Build</code> with a component instance
or <code>spot.BuildFn</code> with a render function.</p>
</li>
<li>
<p dir="auto"><em>Mount</em>: The process of creating real UI controls from a (virtual) tree of
controls. This is done by calling <code>Mount</code> on a tree node or <code>spot.Mount</code> with
a component instance or <code>spot.MountFn</code> with a render function.</p>
</li>
<li>
<p dir="auto"><em>Update</em>: The process of updating a tree of (mounted) controls. This is done
by calling <code>Update</code> on a tree node.</p>
</li>
</ul>
<p dir="auto"><h2 tabindex="-1" dir="auto">Features, Spot does not have right now</h2><a id="user-content-features-spot-does-not-have-right-now" aria-label="Permalink: Features, Spot does not have right now" href="#features-spot-does-not-have-right-now"></a></p>
<ul dir="auto">
<li>Automatic layouting</li>
<li>Multiple windows</li>
<li>Modal dialogs</li>
<li>Resizable windows</li>
<li>Menu bars</li>
<li>Custom widgets</li>
<li>Access to native widgets</li>
<li>Drag and drop</li>
<li>Internationalization</li>
</ul>
<p dir="auto"><h2 tabindex="-1" dir="auto">List of supported UI controls</h2><a id="user-content-list-of-supported-ui-controls" aria-label="Permalink: List of supported UI controls" href="#list-of-supported-ui-controls"></a></p>
<p dir="auto">Explanation of the status column: <br>
❓ Not implemented /
🚧 Work in progress /
<g-emoji alias="warning">⚠️</g-emoji> Partially implemented /
✅ Done</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Native controls used</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://pkg.go.dev/github.com/roblillack/spot/ui#Button" rel="nofollow">Button</a></td>
<td>Simple button to initiate an action</td>
<td><a href="https://www.fltk.org/doc-1.4/classFl__Button.html" rel="nofollow">Fl_Button</a> <br> <a href="https://developer.apple.com/documentation/appkit/nsbutton" rel="nofollow">NSButton</a></td>
<td>✅</td>
</tr>
<tr>
<td><a href="https://pkg.go.dev/github.com/roblillack/spot/ui#Checkbox" rel="nofollow">Checkbox</a></td>
<td>Control offering the user a choice between two mutually exclusive options</td>
<td><a href="https://www.fltk.org/doc-1.4/classFl__Check__Button.html" rel="nofollow">Fl_Check_Button</a> <br> <a href="https://developer.apple.com/documentation/appkit/nsbutton" rel="nofollow">NSButton</a> (<a href="https://developer.apple.com/documentation/appkit/nsbuttontype/nsbuttontypeswitch" rel="nofollow">NSButtonTypeSwitch</a>)</td>
<td>✅</td>
</tr>
<tr>
<td>ComboBox</td>
<td>A combined dropdown menu with text input</td>
<td>ComboBox <br> NSComboBox</td>
<td>Not started</td>
</tr>
<tr>
<td><a href="https://pkg.go.dev/github.com/roblillack/spot/ui#Dial" rel="nofollow">Dial</a></td>
<td>Circular status control</td>
<td><a href="https://www.fltk.org/doc-1.4/classFl__Dial.html" rel="nofollow">Fl_Dial</a> <br> <a href="https://developer.apple.com/documentation/appkit/nsprogressindicator" rel="nofollow">NSProgressIndicator</a> (with <code>NSCircular</code> style)</td>
<td><g-emoji alias="warning">⚠️</g-emoji></td>
</tr>
<tr>
<td><a href="https://pkg.go.dev/github.com/roblillack/spot/ui#Dropdown" rel="nofollow">Dropdown</a></td>
<td>Drop-down menu to select a single item out of multiple options</td>
<td><a href="https://www.fltk.org/doc-1.4/classFl__Choice.html" rel="nofollow">Fl_Choice</a> <br> <a href="https://developer.apple.com/documentation/appkit/nscombobox" rel="nofollow">NSComboBox</a></td>
<td>✅</td>
</tr>
<tr>
<td>Image</td>
<td>An image control</td>
<td>Image <br> NSImageView</td>
<td>Not started</td>
</tr>
<tr>
<td><a href="https://pkg.go.dev/github.com/roblillack/spot/ui#Label" rel="nofollow">Label</a></td>
<td>Simple, non-editable text label</td>
<td><a href="https://www.fltk.org/doc-1.4/classFl__Box.html" rel="nofollow">Fl_Box</a> <br> <a href="https://developer.apple.com/documentation/appkit/nstextfield" rel="nofollow">NSTextField</a></td>
<td>✅</td>
</tr>
<tr>
<td><a href="https://pkg.go.dev/github.com/roblillack/spot/ui#ListBox" rel="nofollow">ListBox</a></td>
<td>Scrollable control which allows the user to select a single or multible items from a given list</td>
<td><a href="https://www.fltk.org/doc-1.4/classFl__Select__Browser.html" rel="nofollow">Fl_Select_Browser</a>/<a href="https://www.fltk.org/doc-1.4/classFl__Multi__Browser.html" rel="nofollow">Fl_Multi_Browser</a><br> <a href="https://developer.apple.com/documentation/appkit/nstableview" rel="nofollow">NSTableView</a></td>
<td>✅</td>
</tr>
<tr>
<td><a href="https://pkg.go.dev/github.com/roblillack/spot/ui#ProgressBar" rel="nofollow">ProgressBar</a></td>
<td>Progress bar control to visualize the progression of a long-running operation</td>
<td><a href="https://www.fltk.org/doc-1.4/classFl__Progress.html" rel="nofollow">Fl_Progress</a> <br> <a href="https://developer.apple.com/documentation/appkit/nsprogressindicator" rel="nofollow">NSProgressIndicator</a></td>
<td>✅</td>
</tr>
<tr>
<td><a href="https://pkg.go.dev/github.com/roblillack/spot/ui#Slider" rel="nofollow">Slider</a></td>
<td>Horizontal slider input control</td>
<td><a href="https://www.fltk.org/doc-1.4/classFl__Slider.html" rel="nofollow">Fl_Slider</a> <br> <a href="https://developer.apple.com/documentation/appkit/nsslider" rel="nofollow">NSSlider</a></td>
<td>✅</td>
</tr>
<tr>
<td><a href="https://pkg.go.dev/github.com/roblillack/spot/ui#Spinner" rel="nofollow">Spinner</a></td>
<td>Number input control with up/down buttons</td>
<td><a href="https://www.fltk.org/doc-1.4/classFl__Spinner.html" rel="nofollow">Fl_Spinner</a> <br> <a href="https://developer.apple.com/documentation/appkit/nstextfield" rel="nofollow">NSTextField</a>+<a href="https://developer.apple.com/documentation/appkit/nsstepper" rel="nofollow">NSStepper</a></td>
<td>✅</td>
</tr>
<tr>
<td><a href="https://pkg.go.dev/github.com/roblillack/spot/ui#TextField" rel="nofollow">TextField</a></td>
<td>Control for single-line text input</td>
<td><a href="https://www.fltk.org/doc-1.4/classFl__Input.html" rel="nofollow">Fl_Input</a> <br> <a href="https://developer.apple.com/documentation/appkit/nstextfield" rel="nofollow">NSTextField</a></td>
<td>✅</td>
</tr>
<tr>
<td>TextView/TextEditor</td>
<td>General-purpose text box to view/edit multi-line text content</td>
<td>Text <br> NSTextView</td>
<td>🚧</td>
</tr>
<tr>
<td><a href="https://pkg.go.dev/github.com/roblillack/spot/ui#Window" rel="nofollow">Window</a></td>
<td>Control representing a (top-level) window on the screen</td>
<td><a href="https://www.fltk.org/doc-1.4/classFl__Window.html" rel="nofollow">Fl_Window</a> <br> <a href="https://developer.apple.com/documentation/appkit/nswindow" rel="nofollow">NSWindow</a></td>
<td>✅</td>
</tr>
</tbody>
</table>
<p dir="auto"><h2 tabindex="-1" dir="auto">Potential future backends to look at</h2><a id="user-content-potential-future-backends-to-look-at" aria-label="Permalink: Potential future backends to look at" href="#potential-future-backends-to-look-at"></a></p>
<ul dir="auto">
<li>Native Windows controls: <a href="https://github.com/rodrigocfd/windigo">https://github.com/rodrigocfd/windigo</a></li>
</ul>
</article></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Mp3tag – The Universal Tag Editor (329 pts)]]></title>
            <link>https://www.mp3tag.de/en/</link>
            <guid>40468933</guid>
            <pubDate>Fri, 24 May 2024 18:15:58 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.mp3tag.de/en/">https://www.mp3tag.de/en/</a>, See on <a href="https://news.ycombinator.com/item?id=40468933">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
<section>
	
	<p>
		Mp3tag is a powerful and easy-to-use tool to edit metadata of audio files.
	</p>

	<p>
	  It supports batch tag-editing of ID3v1, ID3v2.3, ID3v2.4, iTunes MP4, WMA, Vorbis Comments and APE Tags for multiple files at once covering a variety of <a href="#formats">audio formats</a>.
	</p>

	<p>
	  Furthermore, it supports online database lookups from, e.g., Discogs, MusicBrainz or freedb, allowing you to automatically gather proper tags and download cover art for your music library.
	</p>

	<p>
	  You can rename files based on the tag information, replace characters or words in tags and filenames, import/export tag information, create playlists and <a href="#features">more</a>.
	</p>

	<p>
		<a href="https://www.mp3tag.de/en/screenshots.html" title="Screenshots"><img src="https://www.mp3tag.de/images/mp3tag-en.png" alt="Screenshots"></a>
	</p>
</section>

<section>
	<h2><a id="features"></a>Main features:</h2>

	<p><strong>Batch Tag Editing</strong> 
	Write ID3v1.1, ID3v2.3, ID3v2.4, MP4, WMA, APEv2 Tags and Vorbis Comments to multiple files at once.</p>
	
	<p><strong>Support for Cover Art</strong>
	Download and add album covers to your files and make your library even more shiny.</p>
	
	<p><strong>Import from Discogs, freedb, MusicBrainz</strong>
	Save typing and import tags from online databases like Discogs, freedb, MusicBrainz, and more.</p>
	
	<p><strong>Replace characters or words</strong>
	Replace strings in tags and filenames (with support for Regular Expressions).</p>
	
	<p><strong>Create Playlists automatically</strong>
	Create and manage playlists automatically while editing.</p>

	<p><strong>Rename files from tags</strong>
	Rename files based on the tag information and import tags from filenames.</p>
		
	<p><strong>Export to HTML, RTF, CSV</strong>
	Generate nice reports and lists of your collection based on user-defined templates.</p>
	
	<p><strong>Full Unicode Support</strong>
	User-interface and tagging are fully Unicode compliant.</p>
	
	<p>
		Besides these main features Mp3tag offers a variety of other functions and features ranging
		from batch export of embedded album covers, over support for iTunes-specific tags like
		media type or TV Show settings, to combining multiple actions into groups that can be applied
		with a single mouse click.
	</p>
</section>

<section>	
<h2><a id="formats"></a>Supported Audio Formats</h2>

<ul>
	<li>Advanced Audio Coding (<a href="https://wiki.hydrogenaud.io/index.php?title=Advanced_Audio_Coding">aac</a>)</li>
	<li>Apple Lossless Audio Codec (<a href="https://en.wikipedia.org/wiki/Apple_Lossless">alac</a>)</li>
	<li>Audio Interchange File Format (<a href="https://en.wikipedia.org/wiki/Audio_Interchange_File_Format">aif / aifc / aiff</a>)</li>
	<li>Direct Stream Digital Audio (<a href="https://en.wikipedia.org/wiki/Direct_Stream_Digital">dsf</a>)</li><!--  -->
	<li>Free Lossless Audio Codec (<a href="https://xiph.org/flac/">flac</a>)</li>
	<li>Matroska (<a href="https://www.matroska.org/">mka / mkv</a>)</li>
	<li>Monkey's Audio (<a href="https://monkeysaudio.com/">ape</a>)</li>
	<li>Mpeg Layer 3 (<a href="https://en.wikipedia.org/wiki/MP3">mp3</a>)</li>
	<li>MPEG-4 (<a href="https://en.wikipedia.org/wiki/MPEG-4">mp4 / m4a / m4b / m4v / iTunes</a>)</li>
	<li>Musepack (<a href="https://www.musepack.net/">mpc</a>)</li>
	<li>Ogg Vorbis (<a href="https://xiph.org/vorbis/">ogg</a>)</li>
	<li>IETF Opus (<a href="https://opus-codec.org/">opus</a>)</li>
	<li>OptimFROG (<a href="http://losslessaudio.org/">ofr / ofs</a>)</li>
	<li>Speex (<a href="https://www.speex.org/">spx</a>)</li>
	<li>Tom's Audio Kompressor (<a href="http://www.thbeck.de/Tak/Tak.html">tak</a>)</li>
	<li>True Audio (<a href="http://tausoft.org/wiki/True_Audio_Codec_Overview">tta</a>)</li>
	<li>Windows Media Audio (<a href="https://en.wikipedia.org/wiki/Windows_Media_Audio">wma</a>)</li>
	<li>WavPack (<a href="https://www.wavpack.com/">wv</a>)</li>
	<li>WAV (<a href="https://en.wikipedia.org/wiki/WAV">wav</a>)</li>
	<li>WebM (<a href="https://www.webmproject.org/">webm</a>)</li>
</ul>
</section>
</div><div>
	<h2><a href="https://community.mp3tag.de/c/announcements.rss" title="Subscribe to the Mp3tag News RSS-Feed"><img src="https://www.mp3tag.de/images/icons/feed-icon-14x14.png" title="Subscribe to the Mp3tag News RSS-Feed" alt="RSS"></a> Latest News</h2>

	

	<p>2024-05-24</p>
	<div>
		<p><strong>Mp3tag v3.26</strong> — This version introduces
		Cover Thumbnails for Query Results from Tag Sources,
		Copy as Text to copy a textual representation of the selected files to the clipboard,
		and other improvements and fixes, including performance improvements when writing tags via the Tag Panel, Extended Tags, or the converters.
		</p><p>See the <a href="https://community.mp3tag.de/t/mp3tag-v3-26-released/64768" title="Mp3tag v3.26 Release Notes">Release Notes</a> for more details.</p>
		
	</div>

	<p>2024-03-28</p>
	<div>
		<p><strong>Mp3tag v3.25</strong> — This version is a spring-cleaning release and fixes a few issues that were reported over the past weeks.
		</p><p>See the <a href="https://community.mp3tag.de/t/mp3tag-v3-25-released/64218" title="Mp3tag v3.25 Release Notes">Release Notes</a> for more details.</p>
		
	</div>

	<p>2024-01-26</p>
	<div>
		<p><strong>Mp3tag v3.24</strong> — This version introduces the Playlist Generator to batch-generate multiple playlists at once,
		the option to choose a dedicated field at actions of type Remove Duplicate Fields,
		a utility function to optimize padding for FLAC files,
		and other improvements and fixes.
		</p><p>See the <a href="https://community.mp3tag.de/t/mp3tag-v3-24-released/63562" title="Mp3tag v3.24 Release Notes">Release Notes</a> for more details.</p>
		
	</div>

	<p>2023-11-03</p>
	<div>
		<p><strong>Mp3tag v3.23</strong> — This version comes with modernized dialogs, a larger
		default font for dialogs and windows, new features for the Web Sources Framework,
		and other improvements and fixes.
		</p><p>See the <a href="https://community.mp3tag.de/t/mp3tag-v3-23-released/62640" title="Mp3tag v3.23 Release Notes">Release Notes</a> for more details.</p>
		
	</div>

	<p>2023-09-20</p>
	<div>
		<p><strong>Mp3tag v3.22b</strong> — This version fixes a security issue in one of the external libraries used by Mp3tag.
		</p><p>See the <a href="https://community.mp3tag.de/t/mp3tag-v3-22-released/61895/4" title="Mp3tag v3.22b Release Notes">Release Notes</a> for more details.</p>
		
	</div>

	<p>2023-08-24</p>
	<div>
		<p><strong>Mp3tag v3.22</strong> — This version comes with checkbox fields on the Tag Panel,
		configuration settings for Tag Sources, more JSON-related functions for the Web Sources Framework,
		and many other improvements and fixes.
		</p><p>See the <a href="https://community.mp3tag.de/t/mp3tag-v3-22-released/61895" title="Mp3tag v3.22 Release Notes">Release Notes</a> for more details.</p>
		
	</div>

	<p>2023-05-26</p>
	<div>
		<p><strong>Mp3tag v3.21</strong> — This version comes with support for redoing the last undone operation, repeating the last performed action
		or action groups, and many other improvements and fixes.
		</p><p>See the <a href="https://community.mp3tag.de/t/mp3tag-v3-21-released/61070" title="Mp3tag v3.21 Release Notes">Release Notes</a> for more details.</p>
		
	</div>

	<p><a href="https://www.mp3tag.de/en/news.html" title="old news">More ...</a>
</p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Financial Statement Analysis with Large Language Models (472 pts)]]></title>
            <link>https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4835311</link>
            <guid>40468518</guid>
            <pubDate>Fri, 24 May 2024 17:39:39 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4835311">https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4835311</a>, See on <a href="https://news.ycombinator.com/item?id=40468518">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>

	
	
		
	

	
	
		
		
	

	
	

	
	
	
	
	
    
        
    
	

	
	<p>
		
		
			<span>54 Pages</span>
		
		

		<span>Posted: 21 May 2024</span>
		
		
		
	</p>
	
		
	
	
	
	
	



	
	
	
	
		
		
	
	
		
			<p>Date Written: May 20, 2024</p>
		
	

	
	
		
		
	

	
	
		
	
	<div>
		<h3>Abstract</h3>
		<p>We investigate whether an LLM can successfully perform financial statement analysis in a way similar to a professional human analyst. We provide standardized and anonymous financial statements to GPT4 and instruct the model to analyze them to determine the direction of future earnings. Even without any narrative or industry-specific information, the LLM outperforms financial analysts in its ability to predict earnings changes. The LLM exhibits a relative advantage over human analysts in situations when the analysts tend to struggle. Furthermore, we find that the prediction accuracy of the LLM is on par with the performance of a narrowly trained state-of-the-art ML model. LLM prediction does not stem from its training memory. Instead, we find that the LLM generates useful narrative insights about a company's future performance. Lastly, our trading strategies based on GPT's predictions yield a higher Sharpe ratio and alphas than strategies based on other models. Taken together, our results suggest that LLMs may take a central role in decision-making. </p>
	</div>
	

	<center>
		
		


	

	
	

		
		

	
	


	</center>

	
	
	
		
	
	
	

	
	
		
		
			
				
			
		
		<p><strong>Keywords:</strong> GPT4, neural network, asset pricing, earnings, direction of earnings changes, analysts, chain-of-thought, financial statement analysis, large language models</p>
	
	

	
    
    
	

	
	
		<p><strong>JEL Classification:</strong> G12, G14, G41, M41</p>
	
	

	
	

























    	
	
	
	
   	
	
	
	
	
	            
	















	











    
    










    
    
    
    
















	



    




	<p>
		<strong>Suggested Citation:</strong>
		<a href="#">Suggested Citation<i></i></a>
	</p>
	<p>
		
			Kim,  Alex G. and Muhn,  Maximilian and Nikolaev,  Valeri V., Financial Statement Analysis with Large Language Models (May 20, 2024). Chicago Booth Research Paper Forthcoming, Fama-Miller Working Paper,  Available at SSRN: <a href="https://ssrn.com/abstract=4835311" target="_blank">https://ssrn.com/abstract=4835311</a> or <a href="https://dx.doi.org/10.2139/ssrn.4835311" target="_blank">http://dx.doi.org/10.2139/ssrn.4835311 </a>
		
	</p>
	

	
	
	

	
	

	
	
		
	

	
	
	
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Google Search Is Now a Giant Hallucination (182 pts)]]></title>
            <link>https://gizmodo.com/google-search-ai-overview-giant-hallucination-1851499031</link>
            <guid>40468230</guid>
            <pubDate>Fri, 24 May 2024 17:10:53 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://gizmodo.com/google-search-ai-overview-giant-hallucination-1851499031">https://gizmodo.com/google-search-ai-overview-giant-hallucination-1851499031</a>, See on <a href="https://news.ycombinator.com/item?id=40468230">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><div><figure id="" data-id="22a4db1dbab790a8ed087ea2a106062c" data-recommend-id="image://22a4db1dbab790a8ed087ea2a106062c" data-format="jpg" data-width="4072" data-height="2290" data-lightbox="false" data-recommended="true" data-hide="false" contenteditable="false" draggable="false"><div contenteditable="false" data-link-reference="" data-link-target="" data-syndicationrights="true" data-imagerights="getty" data-hide="false" data-hidecredit="false"><div><picture><source media="(max-width: 49.94em)" type="image/jpeg" srcset="https://i.kinja-img.com/image/upload/c_fit,q_60,w_965/22a4db1dbab790a8ed087ea2a106062c.jpg"><source media="(min-width: 50em) and (max-width: 63.69em)" type="image/jpeg" srcset="https://i.kinja-img.com/image/upload/c_fit,q_60,w_1315/22a4db1dbab790a8ed087ea2a106062c.jpg"><source media="(min-width: 63.75em)" type="image/jpeg" srcset="https://i.kinja-img.com/image/upload/c_fit,q_60,w_1600/22a4db1dbab790a8ed087ea2a106062c.jpg"><img alt="The stage during Google’s I/O conference." data-chomp-id="22a4db1dbab790a8ed087ea2a106062c" data-format="jpg" data-height="2290" data-alt="The stage during Google’s I/O conference." data-anim-src="" src="https://i.kinja-img.com/image/upload/c_fit,q_60,w_645/22a4db1dbab790a8ed087ea2a106062c.jpg"></picture></div><p><figcaption>The stage during Google’s I/O conference.</figcaption><figcaption>Photo<!-- -->: <!-- -->Andrej Sokolow/picture alliance<!-- --> (<!-- -->Getty Images<!-- -->)</figcaption></p></div><span data-id="22a4db1dbab790a8ed087ea2a106062c" data-recommend-id="image://22a4db1dbab790a8ed087ea2a106062c" data-format="jpg" data-width="4072" data-height="2290" data-lightbox="false" data-recommended="true" data-hide="false"></span></figure><div><p>Google tested out AI overviews for months before releasing them nationwide last week, but clearly, that wasn’t enough time. The <span><a data-ga="[[&quot;Embedded Url&quot;,&quot;Internal link&quot;,&quot;https://gizmodo.com/google-shopping-ai-search-generative-experience-1851028975&quot;,{&quot;metric25&quot;:1}]]" href="https://gizmodo.com/google-shopping-ai-search-generative-experience-1851028975">AI is hallucinating</a></span> answers to several user queries, creating a less-than-trustworthy experience across Google’s flagship product. In the last week, Gizmodo received AI overviews from Google that reference <span><a data-ga="[[&quot;Embedded Url&quot;,&quot;Internal link&quot;,&quot;https://gizmodo.com/worst-google-ai-answers-glue-pizza-dogs-playing-sports-1851495298&quot;,{&quot;metric25&quot;:1}]]" href="https://gizmodo.com/worst-google-ai-answers-glue-pizza-dogs-playing-sports-1851495298">glue-topped pizza</a></span> and suggest Barack Obama was Muslim.<br></p><p>The hallucinations are concerning, but not entirely surprising. Like we’ve seen before with AI chatbots, this technology seems to confuse satire with journalism – several of the incorrect AI overviews we found seem to reference <span><a data-ga="[[&quot;Embedded Url&quot;,&quot;Internal link&quot;,&quot;https://www.theonion.com/geologists-recommend-eating-at-least-one-small-rock-per-1846655112&quot;,{&quot;metric25&quot;:1}]]" href="https://www.theonion.com/geologists-recommend-eating-at-least-one-small-rock-per-1846655112">The Onion</a></span>. The problem is that this AI offers an authoritative answer to millions of people who turn to Google Search daily to just look something up. Now, at least some of these people will be presented with hallucinated answers.</p><p>“The vast majority of AI Overviews provide high quality information, with links to dig deeper on the web,” said a Google spokesperson in an emailed statement to Gizmodo, noting many of the examples the company has seen have been from uncommon queries. “We’re taking swift action where appropriate under our content policies, and using these examples to develop broader improvements to our systems, some of which have already started to roll out.<strong>”</strong>&nbsp;</p><p>In my experience, AI overviews are more often right than wrong.  However, every wrong answer I get makes me question my entire experience on Google Search even more – I have to asses each answer carefully. Google notes that AI is “experimental” but they’ve opted everyone into this experiment by default.</p><p>“The thing with Search — we handle billions of queries,” Google CEO Sundar Pichai told <span><a data-ga="[[&quot;Embedded Url&quot;,&quot;External link&quot;,&quot;https://www.theverge.com/24158374/google-ceo-sundar-pichai-ai-search-gemini-future-of-the-internet-web-openai-decoder-interview&quot;,{&quot;metric25&quot;:1}]]" href="https://www.theverge.com/24158374/google-ceo-sundar-pichai-ai-search-gemini-future-of-the-internet-web-openai-decoder-interview" target="_blank" rel="noopener noreferrer">The Verge</a></span> on Monday when asked about the AI overview rollout. “You can absolutely find a query and hand it to me and say, ‘Could we have done better on that query?’ Yes, for sure. But in many cases, part of what is making people respond positively to AI Overviews is that the summary we are providing clearly adds value and helps them look at things they may not have otherwise thought about.”</p><p>Strangely, Google Search occasionally responds to a query with “An AI overview is not available for this search,” while other times, Google will just not say anything and show traditional search results. I got this answer when I searched “what ethnicity are most US presidents” and when I searched “what fruits end in me.”</p><figure id="" data-id="f70bb6ae125cd44692ce2178afc54c5e" data-recommend-id="image://f70bb6ae125cd44692ce2178afc54c5e" data-format="png" data-width="746" data-height="218" data-lightbox="false" data-recommended="false" data-hide="false" contenteditable="false" draggable="false"><div contenteditable="false" data-link-reference="" data-link-target="" data-syndicationrights="false" data-imagerights="other-license" data-hide="false" data-hidecredit="false"><div><picture><source media="(max-width: 37.31em)" type="image/jpeg" srcset="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" data-srcset="https://i.kinja-img.com/image/upload/c_fit,q_60,w_645/f70bb6ae125cd44692ce2178afc54c5e.jpg"><source media="(min-width: 37.37em)" type="image/jpeg" srcset="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" data-srcset="https://i.kinja-img.com/image/upload/c_fit,q_60,w_645/f70bb6ae125cd44692ce2178afc54c5e.jpg"><img alt="Image for article titled Google Search Is Now a Giant Hallucination" data-chomp-id="f70bb6ae125cd44692ce2178afc54c5e" data-format="png" data-height="218" data-alt="Image for article titled Google Search Is Now a Giant Hallucination" data-anim-src="" data-src="https://i.kinja-img.com/image/upload/c_fit,q_60,w_645/f70bb6ae125cd44692ce2178afc54c5e.jpg" src="https://i.kinja-img.com/image/upload/c_fit,q_60,w_645/f70bb6ae125cd44692ce2178afc54c5e.jpg"></picture></div><p><figcaption>Screenshot<!-- -->: <!-- -->Google Search</figcaption></p></div><span data-id="f70bb6ae125cd44692ce2178afc54c5e" data-recommend-id="image://f70bb6ae125cd44692ce2178afc54c5e" data-format="png" data-width="746" data-height="218" data-lightbox="false" data-recommended="false" data-hide="false"></span></figure><p>A Google spokesperson says its systems occasionally start generating an AI overview, but stop it from appearing when it doesn’t meet its quality threshold. Notably, Google had to <span><a data-ga="[[&quot;Embedded Url&quot;,&quot;Internal link&quot;,&quot;https://gizmodo.com/google-pauses-gemini-ai-image-generator-white-racism-1851277547&quot;,{&quot;metric25&quot;:1}]]" href="https://gizmodo.com/google-pauses-gemini-ai-image-generator-white-racism-1851277547">pause Gemini’s answers and image generation</a></span> around racial topics for months after it upset large swaths of the country. It’s unclear if this “stop and start” AI overview generation is related.</p><p>What is clear is that Google felt pressured to put its money where its mouth is, and that means putting AI into Search. People are increasingly choosing ChatGPT, Perplexity, or other AI offerings as their main way to find information on the internet. Google views this race existentially, but it may have just jeopardized the Search experience by trying to catch up.</p><p>This week, Google Search has told people a lot of strange things through AI overviews. Here are some of the weirdest ones Gizmodo has found.</p><h2 id="h22225"><a id=""></a><br></h2></div></div><div><figure id="" data-id="920367822abe29cfad0a86fce4e999c9" data-recommend-id="image://920367822abe29cfad0a86fce4e999c9" data-format="png" data-width="701" data-height="397" data-lightbox="false" data-recommended="false" data-hide="false" contenteditable="false" draggable="false"><div contenteditable="false" data-link-reference="" data-link-target="" data-syndicationrights="false" data-imagerights="other-license" data-hide="false" data-hidecredit="false"><div><picture><source media="(max-width: 37.31em)" type="image/jpeg" srcset="https://i.kinja-img.com/image/upload/c_fit,q_60,w_645/920367822abe29cfad0a86fce4e999c9.jpg"><source media="(min-width: 37.37em)" type="image/jpeg" srcset="https://i.kinja-img.com/image/upload/c_fit,q_60,w_645/920367822abe29cfad0a86fce4e999c9.jpg"><img alt="Query: Are parachutes effective" data-chomp-id="920367822abe29cfad0a86fce4e999c9" data-format="png" data-height="397" data-alt="Query: Are parachutes effective" data-anim-src="" src="https://i.kinja-img.com/image/upload/c_fit,q_60,w_645/920367822abe29cfad0a86fce4e999c9.jpg"></picture></div><p><figcaption>Query: Are parachutes effective</figcaption><figcaption>Screenshot<!-- -->: <!-- -->Google Search</figcaption></p></div><span data-id="920367822abe29cfad0a86fce4e999c9" data-recommend-id="image://920367822abe29cfad0a86fce4e999c9" data-format="png" data-width="701" data-height="397" data-lightbox="false" data-recommended="false" data-hide="false"></span></figure><p>Maybe they’re not perfect, but parachutes are definitely more effective than backpacks.</p></div><div><figure id="" data-id="2e6b3f90e73cee3394925560bafd4f8f" data-recommend-id="image://2e6b3f90e73cee3394925560bafd4f8f" data-format="png" data-width="687" data-height="330" data-lightbox="false" data-recommended="false" data-hide="false" contenteditable="false" draggable="false"><div contenteditable="false" data-link-reference="" data-link-target="" data-syndicationrights="false" data-imagerights="other-license" data-hide="false" data-hidecredit="false"><div><picture><source media="(max-width: 37.31em)" type="image/jpeg" srcset="https://i.kinja-img.com/image/upload/c_fit,q_60,w_645/2e6b3f90e73cee3394925560bafd4f8f.jpg"><source media="(min-width: 37.37em)" type="image/jpeg" srcset="https://i.kinja-img.com/image/upload/c_fit,q_60,w_645/2e6b3f90e73cee3394925560bafd4f8f.jpg"><img alt="Query: How does sandy cheeks die" data-chomp-id="2e6b3f90e73cee3394925560bafd4f8f" data-format="png" data-height="330" data-alt="Query: How does sandy cheeks die" data-anim-src="" src="https://i.kinja-img.com/image/upload/c_fit,q_60,w_645/2e6b3f90e73cee3394925560bafd4f8f.jpg"></picture></div><p><figcaption>Query: How does sandy cheeks die</figcaption><figcaption>Screenshot<!-- -->: <!-- -->Google Search</figcaption></p></div><span data-id="2e6b3f90e73cee3394925560bafd4f8f" data-recommend-id="image://2e6b3f90e73cee3394925560bafd4f8f" data-format="png" data-width="687" data-height="330" data-lightbox="false" data-recommended="false" data-hide="false"></span></figure></div><div><figure id="" data-id="0ff22e38823c6883f8f368b94ae58b0a" data-recommend-id="image://0ff22e38823c6883f8f368b94ae58b0a" data-format="png" data-width="693" data-height="434" data-lightbox="false" data-recommended="false" data-hide="false" contenteditable="false" draggable="false"><div contenteditable="false" data-link-reference="" data-link-target="" data-syndicationrights="false" data-imagerights="other-license" data-hide="false" data-hidecredit="false"><div><picture><source media="(max-width: 37.31em)" type="image/jpeg" srcset="https://i.kinja-img.com/image/upload/c_fit,q_60,w_645/0ff22e38823c6883f8f368b94ae58b0a.jpg"><source media="(min-width: 37.37em)" type="image/jpeg" srcset="https://i.kinja-img.com/image/upload/c_fit,q_60,w_645/0ff22e38823c6883f8f368b94ae58b0a.jpg"><img alt="Image for article titled Google Search Is Now a Giant Hallucination" data-chomp-id="0ff22e38823c6883f8f368b94ae58b0a" data-format="png" data-height="434" data-alt="Image for article titled Google Search Is Now a Giant Hallucination" data-anim-src="" src="https://i.kinja-img.com/image/upload/c_fit,q_60,w_645/0ff22e38823c6883f8f368b94ae58b0a.jpg"></picture></div><p><figcaption>Screenshot<!-- -->: <!-- -->Google Search</figcaption></p></div><span data-id="0ff22e38823c6883f8f368b94ae58b0a" data-recommend-id="image://0ff22e38823c6883f8f368b94ae58b0a" data-format="png" data-width="693" data-height="434" data-lightbox="false" data-recommended="false" data-hide="false"></span></figure><p>These are great sources by the way. For reference, Responsibilityuns is a fake snack invented by a satirical Onion article.</p></div><div><figure id="" data-id="9ce1a31b4f504cfd5cbca3c6acb45c07" data-recommend-id="image://9ce1a31b4f504cfd5cbca3c6acb45c07" data-format="png" data-width="697" data-height="427" data-lightbox="false" data-recommended="false" data-hide="false" contenteditable="false" draggable="false"><div contenteditable="false" data-link-reference="" data-link-target="" data-syndicationrights="false" data-imagerights="other-license" data-hide="false" data-hidecredit="false"><div><picture><source media="(max-width: 37.31em)" type="image/jpeg" srcset="https://i.kinja-img.com/image/upload/c_fit,q_60,w_645/9ce1a31b4f504cfd5cbca3c6acb45c07.jpg"><source media="(min-width: 37.37em)" type="image/jpeg" srcset="https://i.kinja-img.com/image/upload/c_fit,q_60,w_645/9ce1a31b4f504cfd5cbca3c6acb45c07.jpg"><img alt="Query: How many hours are spent plotting revenge" data-chomp-id="9ce1a31b4f504cfd5cbca3c6acb45c07" data-format="png" data-height="427" data-alt="Query: How many hours are spent plotting revenge" data-anim-src="" src="https://i.kinja-img.com/image/upload/c_fit,q_60,w_645/9ce1a31b4f504cfd5cbca3c6acb45c07.jpg"></picture></div><p><figcaption>Query: How many hours are spent plotting revenge</figcaption><figcaption>Screenshot<!-- -->: <!-- -->Google Search</figcaption></p></div><span data-id="9ce1a31b4f504cfd5cbca3c6acb45c07" data-recommend-id="image://9ce1a31b4f504cfd5cbca3c6acb45c07" data-format="png" data-width="697" data-height="427" data-lightbox="false" data-recommended="false" data-hide="false"></span></figure><p>I don’t think anyone is this petty.</p></div><div><figure id="" data-id="a6fe08be38961d5f2ebc1da4a0cd93a1" data-recommend-id="image://a6fe08be38961d5f2ebc1da4a0cd93a1" data-format="png" data-width="721" data-height="262" data-lightbox="false" data-recommended="false" data-hide="false" contenteditable="false" draggable="false"><div contenteditable="false" data-link-reference="" data-link-target="" data-syndicationrights="false" data-imagerights="other-license" data-hide="false" data-hidecredit="false"><div><picture><source media="(max-width: 37.31em)" type="image/jpeg" srcset="https://i.kinja-img.com/image/upload/c_fit,q_60,w_645/a6fe08be38961d5f2ebc1da4a0cd93a1.jpg"><source media="(min-width: 37.37em)" type="image/jpeg" srcset="https://i.kinja-img.com/image/upload/c_fit,q_60,w_645/a6fe08be38961d5f2ebc1da4a0cd93a1.jpg"><img alt="Image for article titled Google Search Is Now a Giant Hallucination" data-chomp-id="a6fe08be38961d5f2ebc1da4a0cd93a1" data-format="png" data-height="262" data-alt="Image for article titled Google Search Is Now a Giant Hallucination" data-anim-src="" src="https://i.kinja-img.com/image/upload/c_fit,q_60,w_645/a6fe08be38961d5f2ebc1da4a0cd93a1.jpg"></picture></div><p><figcaption>Screenshot<!-- -->: <!-- -->Google Search</figcaption></p></div><span data-id="a6fe08be38961d5f2ebc1da4a0cd93a1" data-recommend-id="image://a6fe08be38961d5f2ebc1da4a0cd93a1" data-format="png" data-width="721" data-height="262" data-lightbox="false" data-recommended="false" data-hide="false"></span></figure><p>In fairness, Google’s AI got one right.</p></div><div><figure id="" data-id="d7177d3a77b383526a6747fe0558f9fb" data-recommend-id="image://d7177d3a77b383526a6747fe0558f9fb" data-format="png" data-width="738" data-height="457" data-lightbox="false" data-recommended="false" data-hide="false" contenteditable="false" draggable="false"><div contenteditable="false" data-link-reference="" data-link-target="" data-syndicationrights="false" data-imagerights="other-license" data-hide="false" data-hidecredit="false"><div><picture><source media="(max-width: 37.31em)" type="image/jpeg" srcset="https://i.kinja-img.com/image/upload/c_fit,q_60,w_645/d7177d3a77b383526a6747fe0558f9fb.jpg"><source media="(min-width: 37.37em)" type="image/jpeg" srcset="https://i.kinja-img.com/image/upload/c_fit,q_60,w_645/d7177d3a77b383526a6747fe0558f9fb.jpg"><img alt="Query: can i use gasoline in cooking spaghetti" data-chomp-id="d7177d3a77b383526a6747fe0558f9fb" data-format="png" data-height="457" data-alt="Query: can i use gasoline in cooking spaghetti" data-anim-src="" src="https://i.kinja-img.com/image/upload/c_fit,q_60,w_645/d7177d3a77b383526a6747fe0558f9fb.jpg"></picture></div><p><figcaption>Query: can i use gasoline in cooking spaghetti</figcaption><figcaption>Screenshot<!-- -->: <!-- -->Google Search</figcaption></p></div><span data-id="d7177d3a77b383526a6747fe0558f9fb" data-recommend-id="image://d7177d3a77b383526a6747fe0558f9fb" data-format="png" data-width="738" data-height="457" data-lightbox="false" data-recommended="false" data-hide="false"></span></figure><p>Wouldn’t recommend this recipe.</p></div><div><figure id="" data-id="350364f965e392229f360172aa13d3cd" data-recommend-id="image://350364f965e392229f360172aa13d3cd" data-format="jpg" data-width="1125" data-height="906" data-lightbox="false" data-recommended="false" data-hide="false" contenteditable="false" draggable="false"><div contenteditable="false" data-link-reference="" data-link-target="" data-syndicationrights="false" data-imagerights="other-license" data-hide="false" data-hidecredit="false"><div><picture><source media="(max-width: 49.94em)" type="image/jpeg" srcset="https://i.kinja-img.com/image/upload/c_fit,q_60,w_965/350364f965e392229f360172aa13d3cd.jpg"><source media="(min-width: 50em) and (max-width: 63.69em)" type="image/jpeg" srcset="https://i.kinja-img.com/image/upload/c_fit,q_60,w_1315/350364f965e392229f360172aa13d3cd.jpg"><source media="(min-width: 63.75em)" type="image/jpeg" srcset="https://i.kinja-img.com/image/upload/c_fit,q_60,w_1600/350364f965e392229f360172aa13d3cd.jpg"><img alt="Query: How many Muslim presidents has the United States had?" data-chomp-id="350364f965e392229f360172aa13d3cd" data-format="jpg" data-height="906" data-alt="Query: How many Muslim presidents has the United States had?" data-anim-src="" src="https://i.kinja-img.com/image/upload/c_fit,q_60,w_645/350364f965e392229f360172aa13d3cd.jpg"></picture></div><p><figcaption><strong>Query: How many Muslim presidents has the United States had?</strong></figcaption><figcaption>Screenshot<!-- -->: <!-- -->Matt Novak/Google Search</figcaption></p></div><span data-id="350364f965e392229f360172aa13d3cd" data-recommend-id="image://350364f965e392229f360172aa13d3cd" data-format="jpg" data-width="1125" data-height="906" data-lightbox="false" data-recommended="false" data-hide="false"></span></figure><p>This answer is false, and the product of a conspiracy theory. The United States has only had Christian presidents as of 2024.</p></div><div><figure id="" data-id="91d615b36fcb00af69da5b570b5ebabf" data-recommend-id="image://91d615b36fcb00af69da5b570b5ebabf" data-format="png" data-width="828" data-height="563" data-lightbox="false" data-recommended="false" data-hide="false" contenteditable="false" draggable="false"><div contenteditable="false" data-link-reference="" data-link-target="" data-syndicationrights="false" data-imagerights="other-license" data-hide="false" data-hidecredit="false"><div><picture><source media="(max-width: 49.94em)" type="image/jpeg" srcset="https://i.kinja-img.com/image/upload/c_fit,q_60,w_965/91d615b36fcb00af69da5b570b5ebabf.jpg"><source media="(min-width: 50em) and (max-width: 63.69em)" type="image/jpeg" srcset="https://i.kinja-img.com/image/upload/c_fit,q_60,w_1315/91d615b36fcb00af69da5b570b5ebabf.jpg"><source media="(min-width: 63.75em)" type="image/jpeg" srcset="https://i.kinja-img.com/image/upload/c_fit,q_60,w_1600/91d615b36fcb00af69da5b570b5ebabf.jpg"><img alt="Query: How do cats teleport?" data-chomp-id="91d615b36fcb00af69da5b570b5ebabf" data-format="png" data-height="563" data-alt="Query: How do cats teleport?" data-anim-src="" src="https://i.kinja-img.com/image/upload/c_fit,q_60,w_645/91d615b36fcb00af69da5b570b5ebabf.jpg"></picture></div><p><figcaption><strong>Query: How do cats teleport?</strong></figcaption><figcaption>Screenshot<!-- -->: <!-- -->Matt Novak/Google Search</figcaption></p></div><span data-id="91d615b36fcb00af69da5b570b5ebabf" data-recommend-id="image://91d615b36fcb00af69da5b570b5ebabf" data-format="png" data-width="828" data-height="563" data-lightbox="false" data-recommended="false" data-hide="false"></span></figure><p>Sadly, this is not true either. Cats are incapable of teleporting as far as humans know.</p></div><div><figure id="" data-id="dc85f51123862c3d5f72f747928c3672" data-recommend-id="image://dc85f51123862c3d5f72f747928c3672" data-format="png" data-width="833" data-height="598" data-lightbox="false" data-recommended="false" data-hide="false" contenteditable="false" draggable="false"><div contenteditable="false" data-link-reference="" data-link-target="" data-syndicationrights="false" data-imagerights="other-license" data-hide="false" data-hidecredit="false"><div><picture><source media="(max-width: 49.94em)" type="image/jpeg" srcset="https://i.kinja-img.com/image/upload/c_fit,q_60,w_965/dc85f51123862c3d5f72f747928c3672.jpg"><source media="(min-width: 50em) and (max-width: 63.69em)" type="image/jpeg" srcset="https://i.kinja-img.com/image/upload/c_fit,q_60,w_1315/dc85f51123862c3d5f72f747928c3672.jpg"><source media="(min-width: 63.75em)" type="image/jpeg" srcset="https://i.kinja-img.com/image/upload/c_fit,q_60,w_1600/dc85f51123862c3d5f72f747928c3672.jpg"><img alt="Query: How many rocks should I eat?" data-chomp-id="dc85f51123862c3d5f72f747928c3672" data-format="png" data-height="598" data-alt="Query: How many rocks should I eat?" data-anim-src="" src="https://i.kinja-img.com/image/upload/c_fit,q_60,w_645/dc85f51123862c3d5f72f747928c3672.jpg"></picture></div><p><figcaption><strong>Query: How many rocks should I eat?</strong></figcaption><figcaption>Screenshot<!-- -->: <!-- -->Matt Novak/Google Search</figcaption></p></div><span data-id="dc85f51123862c3d5f72f747928c3672" data-recommend-id="image://dc85f51123862c3d5f72f747928c3672" data-format="png" data-width="833" data-height="598" data-lightbox="false" data-recommended="false" data-hide="false"></span></figure><p>Ideally, no rocks should be eaten on any given day.</p></div></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[ICQ will stop working from June 26 (1013 pts)]]></title>
            <link>https://icq.com/desktop/en#windows</link>
            <guid>40467625</guid>
            <pubDate>Fri, 24 May 2024 16:16:37 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://icq.com/desktop/en#windows">https://icq.com/desktop/en#windows</a>, See on <a href="https://news.ycombinator.com/item?id=40467625">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="page" class="page">
		<div id="section0" data-section="">
				
				<p>You can chat with friends in VK Messenger, <br>and with colleagues in VK WorkSpace</p>
			</div>
		<section id="section1" data-section="">
			<div id="section1SlideImg">
				<p><img src="https://icq.com/cached/img/landing/desktop/eng/section1-img-dekstop.png" alt=""></p>
				<p><img src="https://icq.com/cached/img/landing/desktop/eng/section1-img-phone.png" alt=""></p>
			</div>
			<p><img src="https://icq.com/cached/img/landing/desktop/eng/video1_lastframe.png" alt=""></p>
		</section>
	</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Writing a Unix clone in about a month (344 pts)]]></title>
            <link>https://drewdevault.com/2024/05/24/2024-05-24-Bunnix.html</link>
            <guid>40467297</guid>
            <pubDate>Fri, 24 May 2024 15:41:22 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://drewdevault.com/2024/05/24/2024-05-24-Bunnix.html">https://drewdevault.com/2024/05/24/2024-05-24-Bunnix.html</a>, See on <a href="https://news.ycombinator.com/item?id=40467297">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
  <article>
    <p>I needed a bit of a break from “real work” recently, so I started a new
programming project that was low-stakes and purely recreational. On April 21st,
I set out to see how much of a Unix-like operating system for x86_64 targets
that I could put together in about a month. The result is
<a href="https://git.sr.ht/~sircmpwn/bunnix">Bunnix</a>. Not including days I didn’t work
on Bunnix for one reason or another, I spent 27 days on this project.</p>
<p>Here’s a little demo of the results…</p>

<p>You can try it for yourself if you like:</p>
<ul>
<li><a href="https://cyanide.ayaya.dev/bunnix.iso">Bunnix 0.0.0 iso</a></li>
</ul>
<p>To boot this ISO with qemu:</p>
<pre tabindex="0"><code>qemu-system-x86_64 -cdrom bunnix.iso -display sdl -serial stdio
</code></pre><p>You can also write the iso to a USB stick and boot it on real hardware. It will
probably work on most AMD64 machines – I have tested it on a ThinkPad X220 and
a Starlabs Starbook Mk IV. Legacy boot and EFI are both supported. There are
some limitations to keep in mind, in particular that there is no USB support, so
a PS/2 keyboard (or PS/2 emulation via the BIOS) is required. Most laptops rig
up the keyboard via PS/2, and <abbr title="your milage may vary">YMMV</abbr>
with USB keyboards via PS/2 emulation.</p>
<p><em>Tip: the DOOM keybindings are weird. WASD to move, right shift to shoot, and
space to open doors. Exiting the game doesn’t work so just reboot when you’re
done playing. I confess I didn’t spend much time on that port.</em></p>
<h2 id="whats-there">What’s there?</h2>
<p>The Bunnix kernel is (mostly) written in <a href="https://harelang.org/">Hare</a>, plus some
C components, namely lwext4 for ext4 filesystem support and libvterm for the
kernel video terminal.</p>
<p>The kernel supports the following drivers:</p>
<ul>
<li>PCI (legacy)</li>
<li>AHCI block devices</li>
<li>GPT and MBR partition tables</li>
<li>PS/2 keyboards</li>
<li>Platform serial ports</li>
<li>CMOS clocks</li>
<li>Framebuffers (configured by the bootloaders)</li>
<li>ext4 and memfs filesystems</li>
</ul>
<p>There are numerous supported kernel features as well:</p>
<ul>
<li>A virtual filesystem</li>
<li>A /dev populated with block devices, null, zero, and full psuedo-devices,
/dev/kbd and /dev/fb0, serial and video TTYs, and the /dev/tty controlling
terminal.</li>
<li>Reasonably complete terminal emulator and somewhat passable termios support</li>
<li>Some 40 syscalls, including for example clock_gettime, poll, openat et al,
fork, exec, pipe, dup, dup2, ioctl, etc</li>
</ul>
<p>Bunnix is a single-user system and does not currently attempt to enforce Unix
file modes and ownership, though it could be made multi-user relatively easily
with a few more days of work.</p>
<p>Included are two bootloaders, one for legacy boot which is multiboot-compatible
and written in Hare, and another for EFI which is written in C. Both of them
load the kernel as an ELF file plus an initramfs, if required. The EFI
bootloader includes zlib to decompress the initramfs; multiboot-compatible
bootloaders handle this decompression for us.</p>
<p>The userspace is largely assembled from third-party sources. The following
third-party software is included:</p>
<ul>
<li>Colossal Cave Adventure (advent)</li>
<li>dash (/bin/sh)</li>
<li>Doom</li>
<li>gzip</li>
<li>less (pager)</li>
<li>lok (/bin/awk)</li>
<li>lolcat</li>
<li>mandoc (man pages)</li>
<li>sbase (core utils)<sup id="fnref:1"><a href="#fn:1" role="doc-noteref">1</a></sup></li>
<li>tcc (C compiler)</li>
<li>Vim 5.7</li>
</ul>
<p>The libc is derived from musl libc and contains numerous modifications to suit
Bunnix’s needs. The curses library is based on netbsd-curses.</p>
<p>The system works but it’s pretty buggy and some parts of it are quite slapdash:
your milage will vary. Be prepared for it to crash!</p>
<h2 id="how-bunnix-came-together">How Bunnix came together</h2>
<p>I started documenting the process on Mastodon on day 3 – check out <a href="https://fosstodon.org/@drewdevault/112319697309218275">the
Mastodon thread</a> for the
full story. Here’s what it looked like on day 3:</p>
<p><img src="https://cdn.fosstodon.org/media_attachments/files/112/319/693/110/194/041/original/2c0bd7006a74aece.png" alt="Screenshot of an early Bunnix build, which boots up, sets up available memory, and exercises an early in-memory filesystem"></p>
<p>Here’s some thoughts after the fact.</p>
<p>Some of Bunnix’s code stems from an earlier project,
<a href="https://sr.ht/~sircmpwn/helios">Helios</a>. This includes portions of the kernel
which are responsible for some relatively generic CPU setup (GDT, IDT, etc), and
some drivers like AHCI were adapted for the Bunnix system. I admit that it would
probably not have been possible to build Bunnix so quickly without prior
experience through Helios.</p>
<p>Two of the more challenging aspects were ext4 support and the virtual terminal,
for which I brought in two external dependencies, lwext4 and libvterm. Both
proved to be challenging integrations. I had to rewrite my filesystem layer a
few times, and it’s still buggy today, but getting a proper Unix filesystem
design (including openat and good handling of inodes) requires digging into
lwext4 internals a bit more than I’d have liked. I also learned a lot about
mixing source languages into a Hare project, since the kernel links together
Hare, assembly, and C sources – it works remarkably well but there are some
pain points I noticed, particularly with respect to building the ABI integration
riggings. It’d be nice to automate conversion of C headers into Hare forward
declaration modules. Some of this work already exists in hare-c, but has a ways
to go. If I were to start again, I would probably be more careful in my design
of the filesystem layer.</p>
<p>Getting the terminal right was difficult as well. I wasn’t sure that I was going
to add one at all, but I eventually decided that I wanted to port vim and that
was that. libvterm is a great terminal state machine library, but it’s poorly
documented and required a lot of fine-tuning to integrate just right. I also
ended up spending a lot of time on performance to make sure that the terminal
worked smoothly.</p>
<p>Another difficult part to get right was the scheduler. Helios has a simpler
scheduler than Bunnix, and while I initially based the Bunnix scheduler on
Helios I had to throw out and rewrite quite a lot of it. Both Helios and Bunnix
are single-CPU systems, but unlike Helios, Bunnix allows context switching
within the kernel – in fact, even preemptive task switching enters and exits
via the kernel. This necessitates multiple kernel stacks and a different
approach to task switching. However, the advantages are numerous, one of which
being that implementing blocking operations like disk reads and pipe(2) are much
simpler with wait queues. With a robust enough scheduler, the rest of the kernel
and its drivers come together pretty easily.</p>
<p>Another source of frustration was signals, of course. Helios does not attempt to
be a Unix and gets away without these, but to build a Unix, I needed to
implement signals, big messy hack though they may be. The signal implementation
which ended up in Bunnix is pretty bare-bones: I mostly made sure that SIGCHLD
worked correctly so that I could port dash.</p>
<p>Porting third-party software was relatively easy thanks to basing my libc on
musl libc. I imported large swaths of musl into my own libc and adapted it to
run on Bunnix, which gave me a pretty comprehensive and reliable C library
pretty fast. With this in place, porting third-party software was a breeze, and
most of the software that’s included was built with minimal patching.</p>
<h2 id="what-i-learned">What I learned</h2>
<p>Bunnix was an interesting project to work on. My other project, Helios, is a
microkernel design that’s Not Unix, while Bunnix is a monolithic kernel that is
much, much closer to Unix.</p>
<p>One thing I was surprised to learn a lot about is filesystems. Helios, as a
microkernel, spreads the filesystem implementation across many drivers running
in many separate processes. This works well enough, but one thing I discovered
is that it’s quite important to have caching in the filesystem layer, even if
only to track living objects. When I revisit Helios, I will have a lot of work
to do refactoring (or even rewriting) the filesystem code to this end.</p>
<p>The approach to drivers is also, naturally, much simpler in a monolithic kernel
design, though I’m not entirely pleased with all of the stuff I heaped into ring
0. There might be room for an improved Helios scheduler design that incorporates
some of the desirable control flow elements from the monolithic design into a
microkernel system.</p>
<p>I also finally learned how signals work from top to bottom, and boy is it ugly.
I’ve always felt that this was one of the weakest points in the design of Unix
and this project did nothing to disabuse me of that notion.</p>
<p>I had also tried to avoid using a bitmap allocator in Helios, and generally
memory management in Helios is a bit fussy altogether – one of the biggest pain
points with the system right now. However, Bunnix uses a simple bitmap allocator
for all conventional pages on the system and I found that it works really,
really well and does not have nearly as much overhead as I had feared it would.
I will almost certainly take those lessons back to Helios.</p>
<p>Finally, I’m quite sure that putting together Bunnix in just 30 days is a feat
which would not have been possible with a microkernel design. At the end of the
day, monolithic kernels are just much simpler to implement. The advantages of a
microkernel design are compelling, however – perhaps a better answer lies in a
hybrid kernel.</p>
<h2 id="whats-next">What’s next</h2>
<p>Bunnix was (note the past tense) a project that I wrote for the purpose of
recreational programming, so it’s purpose is to be fun to work on. And I’ve had
my fun! At this point I don’t feel the need to invest more time and energy into
it, though it would definitely benefit from some. In the future I may spend a
few days on it here and there, and I would be happy to integrate improvements
from the community – send patches to my <a href="https://lists.sr.ht/~sircmpwn/public-inbox">public inbox</a>. But for the most
part it is an art project which is now more-or-less complete.</p>
<p>My next steps in OS development will be a return to Helios with a lot of lessons
learned and some major redesigns in the pipeline. But I still think that Bunnix
is a fun and interesting OS in its own right, in no small part due to its
demonstration of Hare as a great language for kernel hacking. Some of the
priorities for improvements include:</p>
<ul>
<li>A directory cache for the filesystem and better caching generally</li>
<li>Ironing out ext4 bugs</li>
<li>procfs and top</li>
<li>mmaping files</li>
<li>More signals (e.g. SIGSEGV)</li>
<li>Multi-user support</li>
<li>NVMe block devices</li>
<li>IDE block devices</li>
<li>ATAPI and ISO 9660 support</li>
<li>Intel HD audio support</li>
<li>Network stack</li>
<li>Hare toolchain in the base system</li>
<li>Self hosting</li>
</ul>
<p>Whether or not it’s me or one of you readers who will work on these first
remains to be seen.</p>
<p>In any case, have fun playing with Bunnix!</p>


  </article>
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Samsung WB850F Firmware Reverse Engineering (182 pts)]]></title>
            <link>https://op-co.de/blog/posts/samsung_wb850f_firmware/</link>
            <guid>40467232</guid>
            <pubDate>Fri, 24 May 2024 15:35:04 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://op-co.de/blog/posts/samsung_wb850f_firmware/">https://op-co.de/blog/posts/samsung_wb850f_firmware/</a>, See on <a href="https://news.ycombinator.com/item?id=40467232">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="pagebody" role="main" class="page">
<p><span>Georg Lukas, <span>2024-05-24 17:30</span></span></p>
<p>Samsung's <a href="https://news.samsung.com/global/ces-2012-cameras-for-any-situation-with-wi-fi-and-long-zoom">WB850F compact camera</a>
was the first model to combine the DRIMeIII SoC with WiFi. Together with the
EX2F it features an uncompressed firmware binary where Samsung helpfully added
a <code>partialImage.o.map</code> file with a full linker dump and all symbol names into
the firmware ZIP. We are using this gift to reverse-engineer the main SoC
firmware, so that we can make it pass the WiFi hotspot detection and use
<a href="https://github.com/ge0rg/samsung-nx-emailservice">samsung-nx-emailservice</a>.</p>

<p>This is a follow-up to the
<a href="https://op-co.de/blog/posts/samsung_wifi_cameras/">Samsung WiFi cameras</a>
article and part of the <a href="https://op-co.de/blog/tags/samsung-nx/">Samsung NX series</a>.</p>

<div>
	<ol>
		<li><a href="#index1h2">WB850F_FW_210086.zip - the outer container</a>
		<ol>
			<li><a href="#index1h3">partialImage.o.map - the linker dump</a>
			</li>
			<li><a href="#index2h3">WB850-FW-SR-210086.bin - header analysis</a>
			</li>
			<li><a href="#index3h3">WB850-FW-SR-210086.bin - code and data partitions</a>
			</li>
		</ol>
		</li>
		<li><a href="#index2h2">Loading the code in Ghidra</a>
		<ol>
			<li><a href="#index4h3">Loading and mapping Main_Image</a>
			</li>
			<li><a href="#index5h3">Loading function names from partialImage.o.map</a>
			</li>
			<li><a href="#index6h3">Reverse engineering DevHTTPResponseStart</a>
			</li>
			<li><a href="#index7h3">Interpreting the hotspot detection</a>
			</li>
		</ol>
		</li>
		<li><a href="#index3h2">Summary: the real treasure</a>
		</li>
	</ol>
</div>


<h2><a name="index1h2"></a><code>WB850F_FW_210086.zip</code> - the outer container</h2>

<p>The WB850F is one of the few models where Samsung still publishes
<a href="https://www.samsung.com/at/support/model/EC-WB850FBPBE3/">firmware and support files</a>
after discontinuing the iLauncher application.</p>

<p>The <code>WB850F_FW_210086.zip</code> archive we can get there contains quite a few files
(as identified by <code>file</code>):</p>

<div><pre>GPS_FW<span>/</span>BASEBAND_FW_Flash.mbin<span>:</span> data
GPS_FW<span>/</span>BASEBAND_FW_Ram.mbin<span>:</span>   data
GPS_FW<span>/</span>Config.BIN<span>:</span>             data
GPS_FW<span>/</span>flashBurner.mbin<span>:</span>       data
FWUP<span>:</span>                          ASCII text<span>,</span> with CRLF line terminators
partialImage.o.map<span>:</span>            ASCII text
WB850-FW-SR-210086.bin<span>:</span>        data
wb850f_adj.txt<span>:</span>                ASCII text<span>,</span> with CRLF line terminators
</pre></div>


<p>The <code>FWUP</code> file just contains the string <code>upgrade all</code> which is a script for
the firmware testing/automation module. The <code>wb850f_adj.txt</code> file is a similar
but more complex script to upgrade the GPS firmware and delete the respective
files. Let's skip the GPS-related script and <code>GPS_FW</code> folder for now.</p>

<h3><a name="index1h3"></a><code>partialImage.o.map</code> - the linker dump</h3>

<p>The <code>partialImage.o.map</code> is a text file with &gt;300k lines, containing the
linker output for <code>partialImage.o</code>, including a full memory map of the linked
file:</p>

<div><pre>output          input           virtual
section         section         address         size     <span>file</span>

.text                           <span>00000000        01301444</span>
                .text           <span>00000000        000001</span>a4 sysALib.o
                             <span>$a</span> <span>00000000        00000000</span>
                        sysInit <span>00000000        00000000</span>
                   L<span>$_Good_Boot</span> <span>00000090        00000000</span>
                    archPwrDown <span>00000094   00000000</span>
...
           DevHTTPResponseStart <span>00321</span>a84        <span>000002</span>a4
            DevHTTPResponseData <span>00321</span>d28        <span>00000100</span>
             DevHTTPResponseEnd <span>00321</span>e28        <span>00000170</span>
...
.data                           <span>00000000        004</span>ed40c
                .data           <span>00000000        00000874</span> sysLib.o
                         sysBus <span>00000000        00000004</span>
                         sysCpu <span>00000004        00000004</span> 
                    sysBootLine <span>00000008        00000004</span>
</pre></div>


<p>This goes on and on and on, and it's a real treasure map! Now we just need to
find the island that it belongs to.</p>

<h3><a name="index2h3"></a><code>WB850-FW-SR-210086.bin</code> - header analysis</h3>

<p>Looking into <code>WB850-FW-SR-210086.bin</code> with <code>binwalk</code> yields a long list of
file headers (HTML, PNG, JPEG, ...), a VxWorks header, quite a number of Unix
paths, but nothing that looks like partitions or filesystems.</p>

<p>Let's hex-dump the first kilobyte instead:</p>

<div><pre><span>00000000</span><span>:</span> <span>3231 3030 3836 0006 4657 5</span>f55 <span>502</span>f <span>4</span>f4e  <span>210086</span>..FW_UP<span>/</span>ON
<span>00000010</span><span>:</span> <span>424</span>c <span>312</span>e <span>6269 6</span>e00 <span>0000 0000 0000 0000</span>  BL1.bin.........
<span>00000020</span><span>:</span> <span>0000 0000 0000 0000</span> c400 <span>0000 0008 0000</span>  ................
<span>00000030</span><span>:</span> <span>4</span>f4e <span>424</span>c <span>3100 0000 0000 0000 0000 0000</span>  ONBL1...........
<span>00000040</span><span>:</span> <span>0000 0000 4657 5</span>f55 <span>502</span>f <span>4</span>f4e <span>424</span>c <span>322</span>e  ....FW_UP<span>/</span>ONBL2.
<span>00000050</span><span>:</span> <span>6269 6</span>e00 <span>0000 0000 0000 0000 0000 0000</span>  bin.............
<span>00000060</span><span>:</span> <span>0000 0000 30</span>b6 <span>0000</span> c408 <span>0000 4</span>f4e <span>424</span>c  ...<span>.0</span>.......ONBL
<span>00000070</span><span>:</span> <span>3200 0000 0000 0000 0000 0000 0000 0000  2</span>...............
<span>00000080</span><span>:</span> <span>5</span>b57 <span>4238 3530 5</span>d44 <span>5343 5</span>f35 <span>4</span>b45 <span>595</span>f  <span>[</span>WB850<span>]</span>DSC_5KEY_
<span>00000090</span><span>:</span> <span>5742 3835 3000 0000 0000 0000 0000 0000</span>  WB850...........
<span>000000</span>a0<span>:</span> <span>38</span>f4 d101 f4be <span>0000 4</span>d61 <span>696</span>e <span>5</span>f49 <span>6</span>d61  <span>8</span>.......Main_Ima
<span>000000</span>b0<span>:</span> <span>6765 0000 0000 0000 0000 0000 526</span>f <span>6</span>d46  ge..........RomF
<span>000000</span>c0<span>:</span> <span>532</span>f <span>5350 4944 2</span>e52 <span>6</span>f6d <span>0000 0000 0000</span>  S<span>/</span>SPID.Rom......
<span>000000</span>d0<span>:</span> <span>0000 0000 0000 0000 0000 0000 00</span>ac f402  ................
<span>000000</span>e0<span>:</span> <span>2</span>cb3 d201 <span>5265 736</span>f <span>7572 6365 0000 0000</span>  <span>,</span>...Resource....
<span>000000</span>f0<span>:</span> <span>0000 0000 0000 0000 4657 5</span>f55 <span>502</span>f <span>5742</span>  ........FW_UP<span>/</span>WB
<span>00000100</span><span>:</span> <span>3835 302</span>e <span>4845 5800 0000 0000 0000 0000  850</span>.HEX.........
<span>00000110</span><span>:</span> <span>0000 0000 0000 0000 864</span>d <span>0000 2</span>c5f c704  .........M..<span>,</span>_..
<span>00000120</span><span>:</span> <span>4</span>f49 <span>5300 0000 0000 0000 0000 0000 0000</span>  OIS.............
<span>00000130</span><span>:</span> <span>0000 0000 4657 5</span>f55 <span>502</span>f <span>736</span>b <span>696</span>e <span>2</span>e62  ....FW_UP<span>/</span>skin.b
<span>00000140</span><span>:</span> <span>696</span>e <span>0000 0000 0000 0000 0000 0000 0000</span>  <span>in</span>..............
<span>00000150</span><span>:</span> <span>0000 0000 48</span>d0 <span>2</span>f02 b2ac c704 <span>534</span>b <span>494</span>e  ....H.<span>/</span>.....SKIN
<span>00000160</span><span>:</span> <span>0000 0000 0000 0000 0000 0000 0000 0000</span>  ................
<span>*</span>
<span>000003</span>f0<span>:</span> <span>0000 0000 0000 0000 0000 0000 5041 5254</span>  ............PART
</pre></div>


<p>This looks very interesting. It starts with the firmware version, <code>210086</code>,
then <code>0x00 0x06</code>, directly followed by <code>FW_UP/ONBL1.bin</code> at the offset
<code>0x008</code>, which very much looks like a file name. The next file name,
<code>FW_UP/ONBL2.bin</code> comes at <code>0x044</code>, so this is probably a 60-byte "partition"
record:</p>

<div><pre><span>00000008</span><span>:</span> <span>4657 5</span>f55 <span>502</span>f <span>4</span>f4e <span>424</span>c <span>312</span>e <span>6269 6</span>e00  FW_UP<span>/</span>ONBL1.bin.
<span>00000018</span><span>:</span> <span>0000 0000 0000 0000 0000 0000 0000 0000</span>  ................
<span>00000028</span><span>:</span> c400 <span>0000 0008 0000 4</span>f4e <span>424</span>c <span>3100 0000</span>  ........ONBL1...
<span>00000038</span><span>:</span> <span>0000 0000 0000 0000 0000 0000</span>            ............
</pre></div>


<p>After the file name, there is quite a bunch of zeroes (making up a 32-byte
zero-padded string), followed by two little-endian integers <code>0xc4</code> and
<code>0x800</code>, followed by a 20-byte zero-padded string <code>ONBL1</code>, which is
probably the respective partition name. After that, the next records of the
same structure follow. The integers in the second record (<code>ONBL2</code>) are
<code>0xb630</code> and <code>0x8c4</code>, so we can assume the first number is the length, and the
second one is the offset in the file (the offset of one record is always
offset+length of the previous one).</p>

<p>In total, there are six records, so the <code>0x00 0x06</code> between the version string
and the first record is probably a termination or pading byte for the firmware
version and a one-byte number of partitions.</p>

<p>With this knowledge, we can reconstruct the partition table as follows:</p>

<table>
    <thead>
        <tr>
            <th>File name</th>
            <th>size</th>
            <th>offset</th>
            <th>partition name</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>FW_UP/ONBL1.bin</td>
            <td>196 (0xc4)</td>
            <td><code>0x0000800</code></td>
            <td>ONBL1</td>
        </tr>
        <tr>
            <td>FW_UP/ONBL2.bin</td>
            <td>46 KB (0xb630)</td>
            <td><code>0x00008c4</code></td>
            <td>ONBL2</td>
        </tr>
        <tr>
            <td>[WB850]DSC_5KEY_WB850</td>
            <td>30 MB (0x1d1f438)</td>
            <td><code>0x000bef4</code></td>
            <td>Main_Image</td>
        </tr>
        <tr>
            <td>RomFS/SPID.Rom</td>
            <td>48 MB (0x2f4ac00)</td>
            <td><code>0x1d2b32c</code></td>
            <td>Resource</td>
        </tr>
        <tr>
            <td>FW_UP/WB850.HEX</td>
            <td>19 KB (0x4d86)</td>
            <td><code>0x4c75f2c</code></td>
            <td>OIS</td>
        </tr>
        <tr>
            <td>FW_UP/skin.bin</td>
            <td>36 MB (0x22fd048)</td>
            <td><code>0x4c7acb2</code></td>
            <td>SKIN</td>
        </tr>
    </tbody>
</table>


<p>Let's write a
<a href="https://github.com/ge0rg/samsung-nx-hacks/blob/master/tools/drime3-firmware.py">tool to extract DRIMeIII firmware partitions</a>, and use it!</p>

<h3><a name="index3h3"></a><code>WB850-FW-SR-210086.bin</code> - code and data partitions</h3>

<p>The tool is extracting partitions based on their partition names, appending
<code>".bin"</code> respectively. Running <code>file</code> on the output is not very helpful:</p>

<div><pre>ONBL1.bin<span>:</span>      data
ONBL2.bin<span>:</span>      data
Main_Image.bin<span>:</span> OpenPGP Secret Key
Resource.bin<span>:</span>   MIPSEB-LE MIPS-III ECOFF executable stripped <span>-</span> version <span>0.0</span>
OIS.bin<span>:</span>        data
SKIN.bin<span>:</span>       data
</pre></div>


<ul>
<li><p><code>ONBL1</code> and <code>ONBL2</code> are probably the stages 1 and 2 of the bootloader (as
confirmed by a string in <code>Main_Image</code>: <code>"BootLoader(ONBL1, ONBL2) Update
Done"</code>).</p></li>
<li><p><code>Main_Image</code> is the actual firmware: the OpenPGP Secret Key is a false
positive, <code>binwalk -A</code> reports quite a number of ARM function prologues in
this file.</p></li>
<li><p><code>Resource</code> and <code>SKIN</code> are pretty large containers, maybe provided by the SoC
manufacturer to "skin" the camera UI?</p></li>
<li><p><code>OIS</code> is not really hex as claimed by its file name, but it might
be the firmware for a dedicated
<a href="https://en.wikipedia.org/wiki/Image_stabilization#Optical_image_stabilization">optical image stabilizer</a>.</p></li>
</ul>


<p>Of all these, <code>Main_Image</code> is the most interesting one.</p>

<h2><a name="index2h2"></a>Loading the code in Ghidra</h2>

<p>The three partitions <code>ONBL1</code>, <code>ONBL2</code> and <code>Main_Image</code> contain actual ARM code.
A typical ARM firmware will contain the
<a href="https://developer.arm.com/documentation/dui0552/a/the-cortex-m3-processor/exception-model/vector-table">reset vector table</a>
at address <code>0x0000000</code> (usually the beginning of flash / ROM), which is a
series of jump instructions. All three binaries however contain actual linear
code at their respective beginning, so most probably they need to be
re-mapped to some yet unknown address.</p>

<p>To find out how and why the camera is mis-detecting a hotspot, we need to:</p>

<ol>
<li>Find the right memory address to map <code>Main_Image</code> to</li>
<li>Load the symbol names from <code>partialImage.o.map</code> into Ghidra</li>
<li>Find and analyze the function that is mis-firing the hotspot login</li>
</ol>


<h3><a name="index4h3"></a>Loading and mapping <code>Main_Image</code></h3>

<p>By default, Ghidra will assume that the binary loads to address <code>0x0000000</code>
and try to analyze it this way. To get the correct memory address, we need to
find a function that accesses some known value from the binary using an
absolute address. Given that there are 77k functions, we can start with
something that's close to task #3, and search in the "Defined Strings" tab of
Ghidra for <code>"yahoo"</code>:</p>

<p><img src="https://op-co.de/blog/posts/samsung_wb850f_firmware/ghidra-wb850f-yahoo-strings.png" alt="Screenshot of Ghidra with some Yahoo!  strings"></p>

<p>Excellent! Ghidra identified a few strings that look like an annoyed
developer's printf debugging, probably from a function called
<code>DevHTTPResponseStart()</code>, and it seems to be the function that checks whether
the camera can properly access Yahoo, Google or Samsung:</p>

<pre><code>0139f574    DevHTTPResponseStart: url=%s, handle=%x, status=%d\n, headers=%s\r\n
0139f5b8    DevHTTPResponseStart: This is YAHOO check !!!\r\n
0139f5f4    DevHTTPResponseStart: THIS IS GOOGLE/YAHOO/SAMSUNG PAGE!!!! 111\n\n\n
0139f638    DevHTTPResponseStart: 301/302/307! cannot find yahoo!  safapi_is_browser_framebuffer_on : %d , safapi_is_browser_authed(): %d  \r\n
</code></pre>

<p>According to <code>partialImage.o.map</code>, a function with that name actually exists
at address <code>0x321a84</code>, and Ghidra also found a function at <code>0x321a84</code>. There
are some more matching function offsets between the map and the binary, so we
can assume that the <code>.text</code> addresses from the map file actually correspond
1:1 to <code>Main_Image</code>! We found the right island for our map!</p>

<p>Here's the beginning of that function:</p>

<div><pre><span>bool</span> <span>FUN_00321a84</span><span>(</span>undefined4 param_1<span>,</span>ushort param_2<span>,</span><span>int</span> param_3<span>,</span><span>int</span> param_4<span>) {</span>
  <span>/* snip variable declarations */</span>
  <span>FUN_0031daec</span><span>(*(</span>DAT_00321fd4 <span>+</span> <span>0x2c</span><span>),</span>DAT_00322034<span>,</span>param_3<span>,</span>param_1<span>,</span>param_2<span>,</span>param_4<span>);</span>
  <span>FUN_0031daec</span><span>(*(</span>DAT_00321fd4 <span>+</span> <span>0x2c</span><span>),</span>DAT_00322038<span>);</span>
  <span>FUN_00326f84</span><span>(</span><span>0x68</span><span>);</span>
</pre></div>


<p>It starts with two calls to <code>FUN_0031daec()</code> with different
numbers of parameters - this smells very much of <code>printf</code> debugging again.
According to the memory map, it's called <code>opd_printf()</code>! The first parameter
is some sort of context / destination, and the second one must be a reference
to the format string. The two <code>DAT_</code> values are detected by Ghidra as 32-bit
undefined values:</p>

<pre><code>DAT_00322034:
    74 35 3a c1     undefined4 C13A3574h
DAT_00322038:
    b8 35 3a c1     undefined4 C13A35B8h
</code></pre>

<p>However, the respective last three digits match the <code>"DevHTTPResponseStart: "</code>
debug strings encountered earlier:</p>

<ul>
<li><code>0xc13a3574 - 0x0139f574 = 0xc0004000</code> (first format string with four parameters)</li>
<li><code>0xc13a35b8 - 0x0139f5b8 = 0xc0004000</code> (second format strings without parameters)</li>
</ul>


<p>From that we can reasonably conclude that <code>Main_Image</code> needs to be loaded to
the memory address <code>0xc0004000</code>. This cannot be changed after the fact in
Ghidra, so we need to remove the binary from the project, re-import it, and
set the base address accordingly:</p>

<p><img src="https://op-co.de/blog/posts/samsung_wb850f_firmware/ghidra-base-address.png" alt="Screenshot of Ghidra import options dialog"></p>

<h3><a name="index5h3"></a>Loading function names from <code>partialImage.o.map</code></h3>

<p>Ghidra has a script to bulk-import data labels and function names from a text
table,
<a href="https://github.com/NationalSecurityAgency/ghidra/blob/master/Ghidra/Features/Python/ghidra_scripts/ImportSymbolsScript.py">ImportSymbolScript.py</a>.
It expects each line to contain three variables, separated by arbitrary
amounts of whitespace (as determined by python's <code>string.split()</code>):</p>

<ol>
<li>symbol name</li>
<li>(hexadecimal) address</li>
<li>"f" for "function" or "l" for "label"</li>
</ol>


<p>Our symbol map contains multiple sections, but we are only interested in the
functions defined in <code>.text</code> (for now), which are mapped 1:1 to addresses in
<code>Main_Image</code>. Besides of function names, it also contains empty lines, object
file offsets (with <code>.text</code> as the label), labels (prefixed with <code>"L$_"</code>) and
local symbols (prefixed with <code>"$"</code>).</p>

<p>We need to limit our symbols to the <code>.text</code> section (everything after <code>.text</code>
and before <code>.debug_frame</code>), get rid of the empty lines and non-functions, then
add <code>0xc0004000</code> to each address so that we match up with the base address in
Ghidra. We can do this very obscurely with an awk one-liner:</p>

<div><pre><span>awk</span> <span>'/^\.text /{t=1;next}/^\.debug_frame /{t=0} ; !/[$.]/ { if (t &amp;&amp;</span> <span>$1</span><span>) { printf "%s %x f</span><span>\n</span><span>",</span> <span>$1</span><span>, (strtonum("0x"</span><span>$2</span><span>)+0xc0004000) } }'</span>
</pre></div>


<p>Or slightly less obscurely with a much slower shell loop:</p>

<div><pre><span>sed</span> <span>'1,/^\.text /d;/^\.debug_frame /,</span><span>$d</span><span>'</span> | <span>grep</span> <span>-v</span> <span>'^$'</span> | <span>grep</span> <span>-v</span> <span>'[.$]'</span> | \
<span>while</span> <span>read</span> sym addr f <span>;</span> <span>do</span>
    <span>printf</span> <span>"%s %x f</span><span>\n</span><span>"</span>  <span>$sym</span> $<span>((</span><span>0xc0004000</span> <span>+</span> <span>0</span>x<span>$addr</span><span>))</span>
<span>done</span>
</pre></div>


<p>Both will generate the same output that can be loaded
into Ghidra via "Window" / "Script Manager" / "ImportSymbolsScript.py":</p>

<div><pre>sysInit c0004000 f
archPwrDown c0004094 f
MMU_WriteControlReg c00040a4 f
MMU_WritePageTableBaseReg c00040b8 f
MMU_WriteDomainAccessReg c00040d0 f
...
</pre></div>


<h3><a name="index6h3"></a>Reverse engineering <code>DevHTTPResponseStart</code></h3>

<p>Now that we have the function names in place, we need to manually set the type
of quite a few <code>DAT_</code> fields to "pointer", rename the parameters according to
the debug string, and we get a reasonably usable decompiler output.</p>

<p>The following is a commented version, edited for better readability (inlined
the string references, rewrote some conditionals):</p>

<div><pre><span>bool</span> <span>DevHTTPResponseStart</span><span>(</span>undefined4 handle<span>,</span>ushort status<span>,</span><span>char</span> <span>*</span>url<span>,</span><span>char</span> <span>*</span>headers<span>) {</span>
  <span>bool</span> result<span>;</span>
  
  <span>opd_printf</span><span>(</span>ctx<span>,</span><span>"DevHTTPResponseStart: url=%s, handle=%x, status=%d</span><span>\n</span><span>, headers=%s</span><span>\r\n</span><span>"</span><span>,</span>
      url<span>,</span>handle<span>,</span>status<span>,</span>headers<span>);</span>
  <span>opd_printf</span><span>(</span>ctx<span>,</span><span>"DevHTTPResponseStart: This is YAHOO check !!!</span><span>\r\n</span><span>"</span><span>);</span>
  <span>safnotify_page_load_status</span><span>(</span><span>0x68</span><span>);</span>
  <span>if</span> <span>((</span>url <span>==</span> NULL<span>) || (</span>status <span>!=</span> <span>301</span> <span>&amp;&amp;</span> status <span>!=</span> <span>302</span> <span>&amp;&amp;</span> status <span>!=</span> <span>307</span><span>)) {</span>
    <span>/* this is not a HTTP redirect */</span>
    <span>if</span> <span>(</span>status <span>==</span> <span>200</span><span>) {</span>
      <span>/* HTTP 200 means OK */</span>
      <span>if</span> <span>(</span>headers <span>==</span> NULL <span>||</span>
          <span>(</span><span>strstr</span><span>(</span>headers<span>,</span><span>"domain=.yahoo"</span><span>) ==</span> NULL <span>&amp;&amp;</span>
           <span>strstr</span><span>(</span>headers<span>,</span><span>"Domain=.yahoo"</span><span>) ==</span> NULL <span>&amp;&amp;</span>
           <span>strstr</span><span>(</span>headers<span>,</span><span>"domain=kr.yahoo"</span><span>) ==</span> NULL <span>&amp;&amp;</span>
           <span>strstr</span><span>(</span>headers<span>,</span><span>"Domain=kr.yahoo"</span><span>) ==</span> NULL<span>)) {</span>
        <span>/* no response headers or no yahoo cookie --&gt; check fails! */</span>
        result <span>=</span> <span>true</span><span>;</span>
      <span>}</span> <span>else</span> <span>{</span>
        <span>/* we found a yahoo cookie bit in the headers */</span>
        <span>opd_printf</span><span>(</span>ctx<span>,</span><span>"DevHTTPResponseData: THIS IS GOOGLE/YAHOO PAGE!!!! 3333</span><span>\n\n\n</span><span>"</span><span>);</span>
        <span>*</span>p_request_ongoing <span>=</span> <span>0</span><span>;</span>
        <span>if</span> <span>(!</span><span>safapi_is_browser_authed</span><span>())</span>
          <span>safnotify_auth_ap</span><span>(</span><span>0</span><span>);</span>
        result <span>=</span> <span>false</span><span>;</span>
      <span>}</span>
    <span>}</span> <span>else if</span> <span>(</span>status <span>&lt;</span> <span>0</span><span>) {</span>
      <span>/* negative status = aborted? */</span>
      result <span>=</span> <span>false</span><span>;</span>
    <span>}</span> <span>else</span> <span>{</span>
      <span>/* positive status, not a redirect, not "OK" */</span>
      result <span>= !</span><span>safapi_is_browser_framebuffer_on</span><span>();</span>
    <span>}</span>
  <span>}</span> <span>else</span> <span>{</span>
    <span>/* this is a HTTP redirect */</span>
    <span>char</span> <span>*</span>match <span>=</span> <span>strstr</span><span>(</span>url<span>,</span><span>"yahoo."</span><span>);</span>
    <span>if</span> <span>(</span>match <span>==</span> NULL <span>||</span> match <span>&gt; (</span>url<span>+</span><span>11</span><span>)) {</span>
      <span>opd_printf</span><span>(</span>ctx<span>,</span> <span>"DevHTTPResponseStart: 301/302/307! cannot find yahoo! safapi_is_browser_framebuffer_on : %d , safapi_is_browser_authed(): %d</span>  <span>\r\n</span><span>"</span><span>,</span>
          <span>safapi_is_browser_framebuffer_on</span><span>(),</span> <span>safapi_is_browser_authed</span><span>());</span>
      <span>if</span> <span>(!</span><span>safapi_is_browser_framebuffer_on</span><span>() &amp;&amp; !</span><span>safapi_is_browser_authed</span><span>()) {</span>
        <span>opd_printf</span><span>(</span>ctx<span>,</span><span>"DevHTTPResponseStart: 302 auth failed!!! kSAFAPIAuthErrNotAuth!!</span> <span>\r\n</span><span>"</span><span>);</span>
        <span>safnotify_auth_ap</span><span>(</span><span>1</span><span>);</span>
      <span>}</span>
      result <span>=</span> <span>false</span><span>;</span>
    <span>}</span> <span>else</span> <span>{</span>
      <span>/* found "yahoo." in url */</span>
      <span>opd_printf</span><span>(</span>ctx<span>,</span> <span>"DevHTTPResponseStart: THIS IS GOOGLE/YAHOO/SAMSUNG PAGE!!!! 111</span><span>\n\n\n</span><span>"</span><span>);</span>
      <span>*</span>p_request_ongoing <span>=</span> <span>0</span><span>;</span>
      <span>if</span> <span>(!</span><span>safapi_is_browser_authed</span><span>())</span>
        <span>safnotify_auth_ap</span><span>(</span><span>0</span><span>);</span>
      result <span>=</span> <span>false</span><span>;</span>
    <span>}</span>
  <span>}</span>
  <span>return</span> result<span>;</span>
<span>}</span>
</pre></div>


<h3><a name="index7h3"></a>Interpreting the hotspot detection</h3>

<p>So to summarize, the code in <code>DevHTTPResponseStart</code> will check for one of two
conditions and call <code>safnotify_auth_ap(0)</code> to mark the WiFi access point as
authenticated:</p>

<ol>
<li><p>on a HTTP 200 OK response, the server must set a cookie on the domain
<code>".yahoo<em>.something</em>"</code> or <code>"kr.yahoo<em>.something</em>"</code></p></li>
<li><p>on a HTTP 301/302/307 redirect, the URL (presumably the redirect location?)
must contain <code>"yahoo."</code> close to its beginning.</p></li>
</ol>


<p>If we manually contact the queried URL, <code>http://www.yahoo.co.kr/</code>, it will
redirect us to <code>https://www.yahoo.com/</code>, so everything is fine?</p>

<div><pre>GET <span>/</span> HTTP<span>/</span><span>1.1</span>
Host<span>:</span> www.yahoo.co.kr

HTTP<span>/</span><span>1.1 301</span> Moved Permanently
Location<span>:</span> https<span>://</span>www.yahoo.com<span>/</span>
</pre></div>


<p>Well, the substring <code>"yahoo."</code> is on position 12 in the url
<code>"https://www.yahoo.com/"</code>, but the code is requiring it to be in one of the
first 11 positions. This check has been killed by TLS!</p>

<p>To pass the hotspot check, we must unwind ten years of HTTPS-everywhere, or
point the DNS record to a different server that will either HTTP-redirect to a
different, more yahooey name, or set a cookie on the yahoo domain.</p>

<p>After <a href="https://github.com/ge0rg/samsung-nx-emailservice/commit/2ede8d065bf5c9ea76d9c18484aab921814b2f71">patching samsung-nx-emailservice accordingly</a>,
the camera will actually connect and upload photos:</p>

<p><img src="https://op-co.de/blog/posts/samsung_wb850f_firmware/wb850f-email-sending.jpg" alt="WB850F sending a photo"></p>

<h2><a name="index3h2"></a>Summary: the real treasure</h2>

<p>This deep-dive allowed to understand and circumvent the hotspot detection in
Samsung's WB850F WiFi camera based on one reverse-engineered function. The
resulting patch was tiny, but guessing the workaround just from the packet
traces was impossible due to the "detection method" implemented by Samsung's
engineers. Once knowing what to look for, the same workaround was applied to
cameras asking for MSN.com, thus also
<a href="https://op-co.de/blog/posts/samsung_wifi_cameras/#index2h2">adding EX2F, ST200F, WB3xF and WB1100F to the supported cameras list</a>.</p>

<p>However, the real treasure is still waiting! <code>Main_Image</code> contains over 77k
functions, so there is more than enough for a curious treasure hunter to
explore in order to better understand how digital cameras work.</p>

<hr>

<p><em><a href="https://infosec.exchange/@ge0rg/112496790871724311">Discuss on Mastodon</a></em></p>

</div></div>]]></description>
        </item>
    </channel>
</rss>