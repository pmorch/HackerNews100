<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
    <channel>
        <title>HN100 - Readable Contents</title>
        <link>https://hn.algolia.com/api/v1/search_by_date?tags=%28story,poll%29&amp;numericFilters=points%3E100</link>
        <description>Uses Readability to add bodies to the RSS feed</description>
        <lastBuildDate>Mon, 18 Nov 2024 16:30:02 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Bhutan, after prioritizing happiness, now faces an existential crisis (119 pts)]]></title>
            <link>https://www.cbsnews.com/news/bhutan-emigration-crisis-60-minutes/</link>
            <guid>42172281</guid>
            <pubDate>Mon, 18 Nov 2024 13:53:07 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.cbsnews.com/news/bhutan-emigration-crisis-60-minutes/">https://www.cbsnews.com/news/bhutan-emigration-crisis-60-minutes/</a>, See on <a href="https://news.ycombinator.com/item?id=42172281">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
                    
                                                                
                                                        
<article id="article-0" data-index="0" data-path="/news/bhutan-emigration-crisis-60-minutes/">

  <div id="article-header" data-sort-time="1731890395000" data-update-time="1731890395000">
    <header>

      
      <div>

        <!-- show SVG here -->
                            <p><a href="https://www.cbsnews.com/60-minutes/overtime">
            <img width="60" height="60" alt="60-minutes-overtime" src="https://www.cbsnews.com/assets/show/60-minutes-overtime/logo-square-32.svg" loading="lazy"></a></p><!-- end show SVG -->

              <p>
    By
                        
                      , 
                              
                      <a href="https://www.cbsnews.com/team/aliza-chasan/" data-invalid-url-rewritten-http="">Aliza Chasan</a>, 
                              
              <span>Shari Finkelstein, Collette Richards</span>
              </p>
  
          

        <p>
          <time datetime="2024-11-17T19:35:00-0500">November 17, 2024 / 7:35 PM EST</time>
          / CBS News
        </p>
        


</div>

          </header></div>

      




  
  
      
        
  <figure data-ads="{&quot;extraWordCount&quot;:50}"><div>
      
      
                      



  <svg xmlns="http://www.w3.org/2000/svg" style="position:absolute;width:0;height:0"><defs><symbol id="player-icon-pause" viewBox="0 0 32 32"><path d="M4 4h10v24h-10zM18 4h10v24h-10z"></path></symbol><symbol id="player-icon-play" viewBox="0 0 32 32"><path d="M6 4l20 12-20 12z"></path></symbol><symbol id="player-icon-close" viewBox="0 0 32 32"><line stroke-width="6" x1="3" y1="3" x2="29" y2="29"></line><line stroke-width="6" x1="29" y1="3" x2="3" y2="29"></line></symbol><symbol id="player-icon-fullscreen" viewBox="0 0 32 32"><path d="M32 0h-13l5 5-6 6 3 3 6-6 5 5z"></path><path d="M32 32v-13l-5 5-6-6-3 3 6 6-5 5z"></path><path d="M0 32h13l-5-5 6-6-3-3-6 6-5-5z"></path><path d="M0 0v13l5-5 6 6 3-3-6-6 5-5z"></path></symbol><symbol id="player-icon-drag" viewBox="0 0 40 55"><g fill="#f5f5f5"><circle cx="5" cy="5" r="5"></circle><circle cx="20" cy="5" r="5"></circle><circle cx="35" cy="5" r="5"></circle><circle cx="5" cy="20" r="5"></circle><circle cx="20" cy="20" r="5"></circle><circle cx="35" cy="20" r="5"></circle><circle cx="5" cy="35" r="5"></circle><circle cx="20" cy="35" r="5"></circle><circle cx="35" cy="35" r="5"></circle><circle cx="5" cy="50" r="5"></circle><circle cx="20" cy="50" r="5"></circle><circle cx="35" cy="50" r="5"></circle></g></symbol></defs></svg><div data-theme="default" data-component="viewability" data-viewability-options="true">
                  <svg><use xlink:href="#player-icon-drag"></use></svg><p><span>Bhutan building Mindfulness City </span>
        
        

      </p></div>
          </div>
          <figcaption><a href="https://www.cbsnews.com/video/bhutan-mindfulness-city-60-minutes-video-2024-11-17/" data-invalid-url-rewritten-http="">
          
          <span>
            </span>

          <span>Bhutan building Mindfulness City to create jobs, lure young Bhutanese home from abroad</span>

          <span>22:16</span>

                      </a>
                  
        
        
              </figcaption></figure><section><p>Bhutan, the tiny kingdom that introduced Gross National Happiness to the world, has a problem: young people are leaving the country in record numbers.&nbsp;</p><p>The country boasts free health care, free education, a rising life expectancy and an economy that's grown over the last 30 years — still, people are leaving.&nbsp;</p><p>Prime Minister Tshering Tobgay believes it is ironically the success of Gross National Happiness that has made young Bhutanese so sought after abroad.</p>    
  <p>"It is an existential crisis," he said.&nbsp;</p><h2>Holding the outside world at bay&nbsp;</h2><p><span><a href="https://www.cbsnews.com/news/when-morley-safer-visited-a-fairy-tale-kingdom/" target="_blank" data-invalid-url-rewritten-http="">Bhutan</a></span>, which is about the size of Maryland, was largely isolated from the rest of the world for centuries. The kingdom was so protective of its unique Buddhist culture that it only started allowing foreign tourists to visit in the 1970s and didn't introduce television until 1999.&nbsp;</p>

    

<p>Buddhism is the country's national religion. Bhutanese, especially older men and women, spend hours spinning prayer wheels full of Buddhist scriptures. Prayer flags flutter on hillsides and in forests, turning nature itself into a shrine.&nbsp;</p><p>Bhutan's capital city of Thimpu still has no traffic lights. The nation's roads are shared by cars and cows.</p><p>Dasho Kinley Dorji, who ran Bhutan's first newspaper before serving as the government's minister of information and communications, describes the population as nervous, surrounded as it is by India and China, and lacking military might or economic power.&nbsp;</p><figure><span><img src="https://assets2.cbsnewsstatic.com/hub/i/r/2024/11/15/f15b6214-c8b0-4f8b-b800-08ea711e9c7c/thumbnail/620x349/b10cb5312d6b8dc4e86817671f3dbf32/dasho-kinley-dorji.jpg?v=cc5700e8049ccc64c4e0272313675898#" alt="Dasho Kinley Dorji speaks with Lesley Stahl " height="349" width="620" data-srcset="https://assets2.cbsnewsstatic.com/hub/i/r/2024/11/15/f15b6214-c8b0-4f8b-b800-08ea711e9c7c/thumbnail/620x349/b10cb5312d6b8dc4e86817671f3dbf32/dasho-kinley-dorji.jpg?v=cc5700e8049ccc64c4e0272313675898 1x, https://assets2.cbsnewsstatic.com/hub/i/r/2024/11/15/f15b6214-c8b0-4f8b-b800-08ea711e9c7c/thumbnail/1240x698/6f066d1bcaac64f3a10874e2e794dae7/dasho-kinley-dorji.jpg?v=cc5700e8049ccc64c4e0272313675898 2x" srcset="data:image/svg+xml,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%20620%20349'%2F%3E"></span>

      
          <figcaption><span>Dasho Kinley Dorji during an interview with Lesley Stahl</span>
        
                  <span>
            
                60 Minutes

                          </span>
              </figcaption></figure><p>"Bhutan's strength was going to be our identity, to be different from everyone around us," he said.&nbsp;</p>

    
    

<p>Bhutanese wear different clothes and construct buildings in a traditional architectural style. The culture remains strong today.&nbsp;</p><p>"We came to realize that, you know, that what we had in the past, what is old, is actually very valuable," Dorji said.&nbsp;</p><p>Bhutan was, and is today, largely a subsistence agricultural society. Many families still live in multigenerational farmhouses.&nbsp;</p><p>The country was unified by the man who became its first king in 1907. His sons and grandsons — who are referred to in Bhutan as the second, third, fourth and today, fifth, kings — have reigned since.&nbsp;</p><h2>Bhutan's unique path to modernity&nbsp;</h2><p>It was Bhutan's fourth king who, as a young, newly-crowned ruler in the 1970s, set Bhutan onto its path toward modernity. Jigme Singye Wangchuck, on his way home from a summit of nonaligned nations in Cuba, landed at an airport in India, where journalists asked him what Bhutan's gross national product was.&nbsp;</p><p>"And the king said, 'Actually, in Bhutan, gross national happiness is much more important to us than gross national product,'" Dorji recounted.&nbsp;</p><p>The phrase stuck and attracted international attention. Maximizing Gross National Happiness became a primary responsibility of Bhutan's government, led today by Prime Minister Tshering Tobgay.&nbsp;</p><figure><span><img src="https://assets3.cbsnewsstatic.com/hub/i/r/2024/11/15/727e4435-f3d3-4a51-809e-3cf4e292c734/thumbnail/620x349/8f087cf03f1f013345d8d653f7746036/tshering-tobgay.jpg?v=cc5700e8049ccc64c4e0272313675898#" alt="Prime Minister Tshering Tobgay " height="349" width="620" data-srcset="https://assets3.cbsnewsstatic.com/hub/i/r/2024/11/15/727e4435-f3d3-4a51-809e-3cf4e292c734/thumbnail/620x349/8f087cf03f1f013345d8d653f7746036/tshering-tobgay.jpg?v=cc5700e8049ccc64c4e0272313675898 1x, https://assets2.cbsnewsstatic.com/hub/i/r/2024/11/15/727e4435-f3d3-4a51-809e-3cf4e292c734/thumbnail/1240x698/79d51679c662135e7f143e3f82dc1a2a/tshering-tobgay.jpg?v=cc5700e8049ccc64c4e0272313675898 2x" srcset="data:image/svg+xml,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%20620%20349'%2F%3E"></span>

      
          <figcaption><span>Prime Minister Tshering Tobgay</span>
        
                  <span>
            
                60 Minutes

                          </span>
              </figcaption></figure><p>"Gross National Happiness acknowledges that economic growth is important, but that growth must be sustainable. It must… be balanced by the preservation of our unique culture," Tobgay said. "People matter. Our happiness, our well-being matters. Everything should serve that."</p>

    
    

<p>Every five years, surveyors fan out across Bhutan measuring the nation's happiness. The results are analyzed and factored into public policy.&nbsp;</p><p>"Gross National Happiness does not directly equate to happiness in the moment. One happiness is fleeting, it is emotion, it is joy," Tobgay said.&nbsp;</p><ul><li><a href="https://www.cbsnews.com/news/ancient-traditions-of-bhutan-60-minutes/" target="_blank" rel="nofollow" data-invalid-url-rewritten-http="">Experiencing Bhutan's ancient and wondrous traditions</a></li></ul><p>The other — the kind Bhutan is focused on, Tobgay said — is contentment, being happy with life and oneself.&nbsp;</p><p>It's also about nature. By law, at least 60% of the country must remain under forest cover. And with most of its energy coming from hydroelectric power, Bhutan was the first and remains today one of the only countries in the world to be carbon negative.&nbsp;</p><p>It earns foreign revenue selling excess hydropower to India and from tourism, but there are limits. The country is full of gorgeous mountains, but summiting mountain peaks isn't allowed.&nbsp;</p><p>"For a Bhutanese, it's very easy to understand: You know, the mountains are sacred," Dorji said.&nbsp;</p><p>School is taught in English and it's free, as is health care.&nbsp;</p>

    
    

<p>And though the country has a king, Bhutan is also a democracy.&nbsp;</p><h2>Introducing Bhutan to democracy</h2><p>A quarter century after introducing Gross National Happiness, the fourth king decided the best thing for his country would be to have an elected parliament and a prime minister.&nbsp;</p><p>"[It's] the only country where<span><a href="https://www.cbsnews.com/news/bhutans-reluctant-road-to-democracy/" target="_blank" data-invalid-url-rewritten-http=""> democracy was introduced</a></span> in a time of peace and stability, where democracy was literally gifted, imposed on the people, not just gifted, because the people didn't want it," Tobgay said.&nbsp;</p><p>As a reporter, Dorji covered the king's travels throughout Bhutan as he held meetings called consultations to discuss the idea with his subjects. Dorji remembers people begging the king not to institute a democracy.&nbsp;</p><figure><span><img src="https://assets1.cbsnewsstatic.com/hub/i/r/2024/11/15/b2cae4c3-688f-43f7-8e18-40853ca5c714/thumbnail/620x349/59c32fa71bd725415ffa8d50e8c1daf9/bhutan-king.jpg?v=cc5700e8049ccc64c4e0272313675898#" alt="Bhutan's king with Lesley Stahl " height="349" width="620" data-srcset="https://assets1.cbsnewsstatic.com/hub/i/r/2024/11/15/b2cae4c3-688f-43f7-8e18-40853ca5c714/thumbnail/620x349/59c32fa71bd725415ffa8d50e8c1daf9/bhutan-king.jpg?v=cc5700e8049ccc64c4e0272313675898 1x, https://assets1.cbsnewsstatic.com/hub/i/r/2024/11/15/b2cae4c3-688f-43f7-8e18-40853ca5c714/thumbnail/1240x698/4f57142cc6e241bc794c077fd92af141/bhutan-king.jpg?v=cc5700e8049ccc64c4e0272313675898 2x" srcset="data:image/svg+xml,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%20620%20349'%2F%3E"></span>

      
          <figcaption><span>Bhutan's king walks with Lesley Stahl</span>
        
                  <span>
            
                60 Minutes

                          </span>
              </figcaption></figure><p>"Because when they looked around the world, their horizon was India, Nepal, Bangladesh, Pakistan: Democracy," Dorji said. "Which is really synonymous with violence, with corruption. So they said, 'No, thank you. We don't really need that. We are fine.'"</p><p>The king was not swayed by their arguments, arguing in response that a leader chosen by birth and not by merit might one day lead the country to disaster. Then, at just 51, he abdicated and passed the crown to his 26-year-old son, the fifth and current king. Bhutanese headed to the polls for the first time ever in 2008.</p><p>Today the fifth king is 44. He is adored in the country and works closely with the prime minister.&nbsp;</p>

    
    

<h2>So why are young Bhutanese leaving the country in record numbers?</h2><p>Bhutan is currently facing what is known in the country as a crisis of outmigration. The COVID-19 pandemic hit Bhutan's economy hard, shutting down tourism. Recovery has been slow.&nbsp;</p><p>Many Bhutanese, with their excellent English, found higher-paying jobs in Australia, even doing menial labor. Word of opportunities spread fast on social media and now a devastating 9% of the country's population, most of them young people, have left.&nbsp;</p><p>"This is a very difficult situation for Bhutan," Tobgay said.&nbsp;</p><h2>Luring people back with a City of Mindfulness&nbsp;</h2><p>Bhutan's government has mobilized, with the king launching a bold, high-stakes plan to lure people back. Prime Minister Tobgay is trying to attract more business and tourists to Bhutan, highlighting landmarks like a centuries-old suspension bridge, part of an ancient 250-mile trail from one end of the country to the other that is now open to trekking tourists.&nbsp;</p><p>But tourism can only do so much and Bhutan's king knows it, so he has decided to create a new city in southern Bhutan with different rules from the rest of the country. It will be an attempt at a new model of robust economic development, while still holding true to Bhutanese values.&nbsp;</p><p>The king is calling it the Gelephu Mindfulness City.&nbsp;</p><p>He turned to Danish architect <span><a href="https://www.cbsnews.com/news/60-minutes-architect-bjarke-ingels-billion-dollar-designs/" target="_blank" data-invalid-url-rewritten-http="">Bjarke Ingels</a></span> to design it. The new city will have neighborhoods nestled between the area's many rivers, connected by a series of unusual bridges. The bridges will also act as public buildings, with one home to a Buddhist center, another to health care facilities and yet another a university. There won't be any skyscrapers, and everything will be built with local materials.&nbsp;</p><figure><span><img src="https://assets3.cbsnewsstatic.com/hub/i/r/2024/11/15/83e9902a-0af2-4703-ba66-aa05a79e22fa/thumbnail/620x349/37163192d257b344a8547e5e1f3fd5b4/bjarke-ingels.jpg?v=cc5700e8049ccc64c4e0272313675898#" alt="Danish architect Bjarke Ingels " height="349" width="620" data-srcset="https://assets3.cbsnewsstatic.com/hub/i/r/2024/11/15/83e9902a-0af2-4703-ba66-aa05a79e22fa/thumbnail/620x349/37163192d257b344a8547e5e1f3fd5b4/bjarke-ingels.jpg?v=cc5700e8049ccc64c4e0272313675898 1x, https://assets3.cbsnewsstatic.com/hub/i/r/2024/11/15/83e9902a-0af2-4703-ba66-aa05a79e22fa/thumbnail/1240x698/39653bcb18ca41cea483029b47028571/bjarke-ingels.jpg?v=cc5700e8049ccc64c4e0272313675898 2x" srcset="data:image/svg+xml,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%20620%20349'%2F%3E"></span>

      
          <figcaption><span>Danish architect Bjarke Ingels&nbsp;</span>
        
                  <span>
            
                60 Minutes

                          </span>
              </figcaption></figure><p>Right now, the area — located in Bhutan's lowlands — is largely undeveloped. Dr. Lotay Tshering, a former prime minister whom the king has tapped to lead the new city, said it will be built in phases over the next two decades, with no polluting industries allowed.&nbsp;</p>

    
    

<p>The area is also home to a lot of wildlife, including elephants. The new city will have wildlife corridors to protect the animals.&nbsp;</p><p>The king has said the success of the project will shape the future of Bhutan.&nbsp;</p><p>"When we say we follow the principles of Gross National Happiness, we do not mean we are happy with less… We also want to be rich. We also want to be technologically high standard," Dr. Tshering said. "We want Bhutanese to be heading multi-million dollar companies, multinational companies."</p><p>A Bhutanese team is collaborating with experts around the world, seeking investors to help build the city, the cost of which is likely to run in the billions. The city will have its own legal framework modeled on Singapore's and will run on clean hydroelectric power, with the hope of drawing technology companies, especially AI.</p><h2>Deciding to stay</h2><p>Ingels presented his plans to the king, and the king then presented them to the nation, last December.&nbsp;</p><p>Namgay Zam, a journalist who used to anchor Bhutan's nightly newscast, was in attendance. She'd been in the middle of planning a move to Australia with her family when she went to hear the king that day at a packed stadium.</p><p>"He did what no king had done before. He asked the people to help him directly. And he said, 'Will you help me?' And there was shocked silence," Zam said. "Even for me, I froze. And I was like, 'Did he just ask us to help him?' And then he said, 'Will you help me,' a second time."</p><figure><span><img src="https://assets1.cbsnewsstatic.com/hub/i/r/2024/11/15/e84f401b-809e-4d11-9999-78b317954be7/thumbnail/620x349/7c2e479d49acdca1e85261eee9a228f6/namgay-zam.jpg?v=cc5700e8049ccc64c4e0272313675898#" alt="Namgay Zam " height="349" width="620" data-srcset="https://assets1.cbsnewsstatic.com/hub/i/r/2024/11/15/e84f401b-809e-4d11-9999-78b317954be7/thumbnail/620x349/7c2e479d49acdca1e85261eee9a228f6/namgay-zam.jpg?v=cc5700e8049ccc64c4e0272313675898 1x, https://assets3.cbsnewsstatic.com/hub/i/r/2024/11/15/e84f401b-809e-4d11-9999-78b317954be7/thumbnail/1240x698/67661abb73cbb1500e9f4defac53f065/namgay-zam.jpg?v=cc5700e8049ccc64c4e0272313675898 2x" srcset="data:image/svg+xml,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%20620%20349'%2F%3E"></span>

      
          <figcaption><span>Namgay Zam</span>
        
                  <span>
            
                60 Minutes

                          </span>
              </figcaption></figure><p>For Zam, it was a yes.&nbsp;</p>

    
    

<p>"I came home and I told my husband, 'We can't leave,'" Zam said. "And he said, 'Why?' And I said, 'I've signed a social contract with his majesty, because I said yes.'"</p><p>Zam and her husband did not go to Australia, but the king and his family did. He visited the country last month to bring his vision for the new Gelephu Mindfulness City and the future of Bhutan to packed stadiums of more than 20,000 Bhutanese who live in Australia now, all in the hopes of one day luring them back home.&nbsp;</p><p>"If we succeed, we can show that you can create a city that does not displace nature, that is anchored and rooted in the local heritage and culture, and that still allows for growth and prosperity to happen," Ingels said. "That is a struggle a lot of places in the world are struggling with."</p>

      

                  
        
      
                  
    <!-- data-recirc-source="queryly" -->

    <!-- tags --><div>
      <p><a href="https://www.cbsnews.com/team/lesley-stahl/" data-invalid-url-rewritten-http="">Lesley Stahl</a></p><div>
                  <p><a href="https://www.cbsnews.com/team/lesley-stahl/" data-invalid-url-rewritten-http="">
              <span><img src="https://www.cbsnews.com/news/bhutan-emigration-crisis-60-minutes/headshot-600-lesley-stahl.jpg" alt="headshot-600-lesley-stahl.jpg " height="80" width="80" data-srcset="https://assets3.cbsnewsstatic.com/hub/i/r/2024/05/17/493fefbc-c34d-4ed2-bc71-6ffcc5da0dd2/thumbnail/80x80/114b7c4d288ca1ae18415c9fecb6f005/headshot-600-lesley-stahl.jpg?v=cc5700e8049ccc64c4e0272313675898 1x, https://assets3.cbsnewsstatic.com/hub/i/r/2024/05/17/493fefbc-c34d-4ed2-bc71-6ffcc5da0dd2/thumbnail/160x160/6b512c6bca2461cb921eef4435443ef4/headshot-600-lesley-stahl.jpg?v=cc5700e8049ccc64c4e0272313675898 2x" srcset="data:image/svg+xml,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%2080%2080'%2F%3E"></span>
            </a>
          </p>
                  <div>
            <p>One of America's most recognized and experienced broadcast journalists, Lesley Stahl has been a "60 Minutes" correspondent since 1991.</p>
                          
                </div>
      </div>
    </div>
        </section></article></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[I was banned from the hCaptcha accessibility account for not being blind (2023) (190 pts)]]></title>
            <link>https://michaels.world/2023/11/i-was-banned-from-the-hcaptcha-accessibility-account-for-not-being-blind/</link>
            <guid>42171164</guid>
            <pubDate>Mon, 18 Nov 2024 10:13:28 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://michaels.world/2023/11/i-was-banned-from-the-hcaptcha-accessibility-account-for-not-being-blind/">https://michaels.world/2023/11/i-was-banned-from-the-hcaptcha-accessibility-account-for-not-being-blind/</a>, See on <a href="https://news.ycombinator.com/item?id=42171164">Hacker News</a></p>
<div id="readability-page-1" class="page"><div itemprop="text">
	<p><a href="https://4mt.me/linode">Need a blazing fast and reliable server? Get one here!</a></p>
<p><a href="https://4mt.me/pb">Get an awesome price on domains!</a></p>
<h2>Also known as: why you shouldn’t trust a company who makes their product intensionally inaccessible with allowing you an accessibility workaround</h2>



<p>Update: I’ve been informed that hCaptcha now has a text captcha option. The bulk of this blog post still stands. Thanks to D Hamlin for the correction. Also thanks to T Spivey for pointing out my capitalization error causing eloquence users to just hear captcha. This has also been fixed. It’s been a while, hasn’t it? Well I’m back again with a long overdue blog post. Once again, it’s a warning of something crazy. Seems I’m good at coming up with blog posts for those lol. Anyway, let’s get on with it</p>



<p>I’m sure you’ve seen the hCaptcha captcha service, where you check a box and then need to select all images of a house or whatever. If you’re not aware, they intensionally do not provide an audio captcha version for the blind since they say this would make it easier for bots to get through. Instead, they provide a special account for blind people that allows them to get a cookie which lets them get past the captcha without a challenge…</p>



<p>This should be warning sign umber one. If they’re intensionally making their captcha inaccessible, then why should you trust them with an accessibility workaround. What happens when they decide that the accessibility workaround is causing too much of a headache? What happens when bots start using it to get past the captcha for free? We’ll be partially discussing that today, though in a slightly different context.</p>



<p>Anyway, I mainly use brave browser for my browsing needs, and for about a year, my accessibility account just wouldn’t set the cookie on brave. I followed all the steps, third party cookies were allowed, etc, but the cookie just would not set. It worked great on firefox, chromium, and everything else I tried. The message just said that if this keeps occurring that I should email support. So finally I did email support.</p>



<p>They walked me through basic troubleshooting steps, most of which I had already tried, and in an attempt to isolate the problem and help out their technical staff, I mentioned that the call to their set cookie endpoint seemed to be returning a 401 unauthorized code in brave, looking at the javascript console. This, I think, made them a little suspicious, even though I was only trying to help them out.</p>



<p>So imagine my surprise, when out of nowhere in the middle of my conversation with a support rep named Gemma, another rep named Mel sends a reply and says</p>



<pre>Hello,
                                                                                                                                
This is not a supported use, and you are not being credited for accessibility passes.
                                                                                                                                
All accounts being used in this way will be deleted from hCaptcha, and the users banned if they attempt to sign up again for
accessibility.
                                                                                                                                
Thanks,
hCaptcha Support
</pre>



<p>I was obviously very confused, as I wasn’t doing anything they didn’t allow, I was just trying to get it working under brave. So I emailed back, and they clarified that since I wasn’t blind, I shouldn’t be using the accessibility account.</p>



<p>Excuse me? I’m not blind? Are you serious?</p>



<p>I have no idea what got that idea through their heads, but I verified that my account had indeed been banned. I emailed back a day or so later, requesting an unban because, y’know, I *actually* am blind, but they gave a pretty canned response of no, your account is remaining banned.</p>



<p>So the end result is that, irony of all ironies, if I want to get past hCaptcha, I have to break their terms of service and use an automated solving program to solve the captcha, all because they decided, randomly, that I wasn’t blind, so can’t use their accessibility account.</p>



<p>Consider this a warning that, if you rely on a workaround to an intensionally inaccessible system to make it useable, you’re just waiting for something to go wrong.</p>



<p>I can’t stress this enough. Don’t trust a company that makes their product intensionally inaccessible to provide an accessibility work around. That’s like a zebra trusting a lion who eats zebras to not eat them out of the kindness of their heart. It’s a ticking timebomb.</p>



<p>Please share this post with your friends, and if you know any webmasters who use hCaptcha, consider forwarding this to them. It’s not ok what they’re doing, and it’s affecting real people. I was going to reach out to Cloudflare to share my experience in an attempt to get them to drop hCaptcha, but apparently they’re using an in house system now anyway. Good riddance, I say.</p>



<p>Anyway, consider this a warning, and maybe I won’t wait 5 years before my next blog post! Lol.</p>



<p>Michael.</p>


</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Reactive HTML Notebooks (168 pts)]]></title>
            <link>https://maxbo.me/a-html-file-is-all-you-need.html</link>
            <guid>42170740</guid>
            <pubDate>Mon, 18 Nov 2024 08:33:32 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://maxbo.me/a-html-file-is-all-you-need.html">https://maxbo.me/a-html-file-is-all-you-need.html</a>, See on <a href="https://news.ycombinator.com/item?id=42170740">Hacker News</a></p>
<div id="readability-page-1" class="page"><p>
  I've packaged this article up and released a library, <a href="https://maxbo.me/celine">@celine/celine</a>. It has a slightly nicer API too. Check it out! (o˘◡˘o)
</p><div>
<p>
<header>
  <nav>
    <h2>
      <marquee>
        <a href="https://maxbo.me/index.html">← Max Bo</a>
      </marquee>
    </h2>
  </nav>
  Published <time datetime="2024-05-06">May 6, 2024</time>
  <br>
  Modified <time datetime="2024-05-06">September 9, 2024</time>
  
</header>
</p>

<div><p>

Before I start, why am I doing this?
</p><p>

<b>I don't think HTML is being used enough as a platform for scientific publishing.</b></p><p>

Instead, people will:
</p><ol>
  <li>Use an interactive notebook like <a href="https://jupyter.org/">Jupyter</a>, <a href="https://rmarkdown.rstudio.com/lesson-10.html">RStudio</a>, <a href="https://plutojl.org/">Pluto.jl</a> or <a href="https://observablehq.com/">Observable</a> to do data exploration, analysis and visualisation,</li>
  <li>Move to a publishing platform like <a href="https://typst.app/">Typst</a>, <a href="https://overleaf.com/">Overleaf</a>, pure <a href="https://www.latex-project.org/">LaTeX</a>, or a <a href="https://en.wikipedia.org/wiki/WYSIWYG">WYSIWYG</a> editor to typeset their work,</li>
  <li>Export to <code>.pdf</code> for distribution.</li>
</ol>
<p>
I think a HTML file can be used for all 3 of these stages, and prevent a lot of faffing around with manual processes, CLI tooling, CI steps and 3rd-party platforms.
</p><p>

HTML's typesetting capabilities are well documented, but its capabilities as a platform for data exploration, analysis and visualisation are not.
</p>
<p>
I'll try and demonstrate these capabilities, literate programming style.
</p><p><img src="https://maxbo.me/img/document.png" alt="A computer displays an open book">
</p>

</div>



<p>

We also want <code>contenteditable</code> <code>script</code>s to be re-evaluated on blur by building a clone of the <code>script</code> and then removing the original.
<br>



</p>



<div><p>

Now we'll declare a cell called <code>counter</code> that emits a number every second.
<b>The <code>script</code>'s <code>id</code> attribute is the same as the <code>name</code> parameter passed to <code>cell</code></b>.

</p><p>


<i>Try changing the initial counter value <code>i</code> above to a much bigger number, and then defocus the <code>script</code>.</i></p></div>
<p>

Now that we've created a our <code>counter</code> cell, we can create other cells that depend on it.

<br>

We'll import <a href="https://observablehq.com/@observablehq/htl">Hypertext Literal</a> and use it to format the
<code>counter</code> value. <code>htl</code> implements a full-blown HTML5 parser that performs automatic escaping and 
interpolation of non-serializable values, such as event listeners, style objects, and other DOM nodes.



</p>


<p>
We can still observe the output of a cell without needing to show its definition. Just don't add the <code>echo</code> class. 
This makes them useful as a rendering primitive.


<i>(There's a hidden cell above ^)</i>

</p>

<p>

Alternatively, we can create a cell type that doesn't display its output at all.
<br>
We can use these cells to store intermediate values or datastructures.




Also note that cells can be declared out of order.





</p>



<p>

We can use cell values in more complex outputs. We'll import <a href="https://observablehq.com/plot/what-is-plot">Observable Plot</a> and use the <code>counter</code> value in a plot.



</p>

<p><img src="https://maxbo.me/img/up.png" alt="A computer displays a graph in the upward direction">
</p>

<div>

<h2>TeX, Markdown, Graphviz</h2><p>

We can return any type of DOM element from a cell. 
<br>
In this case, the <code>tex</code>, <code>md</code>, and <code>dot</code> cells return <code>span</code>, <code>table</code> and <code>svg</code> elements respectively.
</p><p>

<i>Try editing any of the following cells.</i></p></div>




<!-- <div class="slide">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/wypst@0.0.8/dist/wypst.min.js" crossorigin="anonymous"></script>
  
<script type="module" class="echo" id="typst" contenteditable="true">
cell("typst", [], async () => {
  const div = document.createElement("div");
  await wypst.initialize()
  wypst.render("sum_(k=1)^n k = (n(n+1)) / 2", div);
  return div
});
</script> -->

<p><img src="https://maxbo.me/img/data.png" alt="A computer with an open CD tray is surrounded by data">
</p>

<div>

<h2>Cell status</h2><p>

We can also return a <code>Promise</code>, or throw an <code>Error</code>, from a cell.

Observable's <code>Inspector</code> will apply an <code>observablehq--running</code> or
<code>observablehq--error</code> class to the cell's outer <code>div</code> element respectively.
We'll style them appropriately:



</p></div>


<div>
<h2>Python</h2><p>

The <a href="http://pyodide.org/">Pyodide</a> CPython WASM distribution includes <a href="https://numpy.org/">NumPy</a>, <a href="https://pandas.pydata.org/">Pandas</a>, <a href="https://matplotlib.org/">Matplotlib</a>, <a href="https://scikit-learn.org/">scikit-learn</a>, and <a href="https://scipy.org/">Scipy</a>.
We'll rebuild the plot seen above, but using Matplotlib and Python's <code>sqlite3</code> module instead.

</p><p>

<i>Try editing one of the plot labels!</i></p></div>
<div>
<h2>R</h2><p>

You know the drill. It's R, using <a href="https://docs.r-wasm.org/webr/latest/">WebR</a>. 
I didn't figure out how to get <a href="https://ggplot2.tidyverse.org/">ggplot2</a> <a href="https://docs.r-wasm.org/webr/latest/plotting.html">rendering</a> working, but I assume it's possible.

<i>I must disclose that this cell seems to be a bit flaky on iOS. I have not had a chance to investigate further, nor will I.</i>



</p></div>
<div>

<h2>Inputs</h2><p>

We'll create a new cell type <code>viewof</code> that works specifically with <a href="https://github.com/observablehq/inputs">Observable Inputs</a>.

It declares 2 reactive cells: <code>NAME</code> and <code>viewof NAME</code> - one for the value, and one for the DOM element itself.



</p></div>
<div><p>

To display the input above the cell, we set the cell <code>id</code> to <code>viewof NAME</code>.
</p><p>

<i>Wiggle the range input and see another dependent cell update.</i></p>




<p><i>NB: The way Observable Inputs work is a bit arcane. This demo of <a href="https://observablehq.com/@observablehq/synchronized-inputs">Synchronized Inputs</a> may shed some light.</i>

</p></div>
<div>

<h2>Mutability</h2><p>

Purely functional dataflow is great, but sometimes you just need to mutate state.
We'll create a new helper function <code>mutable</code>. It registers a <code>Mutable</code> - an object that yields new <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Generator"><code>Generator</code></a> values when the value is mutated - in the runtime.



</p></div>
<p><i>Try editing the initial state of the <code>mutable</code>.</i>



<i>Try editing the button labels.</i>





</p>


<!-- <h2>3D models</h2>

We can use Google's <a href="https://modelviewer.dev/"><code>&lt;model-viewer&gt;</code></a> <a href="https://www.webcomponents.org/introduction">Web Component</a> to display 3D models.

<script type="module" class="echo" id="model">
import 'https://ajax.googleapis.com/ajax/libs/model-viewer/3.5.0/model-viewer.min.js';

cell("model", async () => {
  return htl.html`
    <model-viewer 
      style="width: 100%; height: 400px"
      src="/models/NeilArmstrong.glb" 
      poster="/models/NeilArmstrong.webp" 
      alt="Neil Armstrong's Spacesuit from the Smithsonian Digitization Programs Office and National Air and Space Museum" 
      ar 
      auto-rotate
      shadow-intensity="1" 
      camera-controls 
      touch-action="pan-y">
  </model-viewer>
  `;
});
</script> -->

<!-- <div class="slide"> -->

<!-- <h2>Saving contenteditable changes</h2>

Taking a note out of <a href="https://cristobal.space/">Cristóbal Sciutto</a>'s <a href="https://cristobal.space/note">Self-modifying HTML notes</a>,
it's very easy to save a modified version of our document to disk. -->

<!-- <script type="module" class="echo" id="download">
function download (html) {
  // Write data into self-contained html file
  const data = new Blob([html], {type: 'text/plain'});

  // Download the file
  const url = window.URL.createObjectURL(data);
  const a = document.createElement("a");
  a.href = url;
  a.download = "a-html-file-is-all-you-need.html";
  a.click();
}

cell("download", () => {
  return Inputs.button([["Download", () => download(document.documentElement.outerHTML)]]);
});
</script> -->


<!-- </div> -->
<div>

<h2>What's next?</h2>

<s>I will try and cram all of this into a library with some proper documentation.</s>

<br>
<s>I initially thought it should be called <code>incel</code> (short for <i>inline cell</i>), but I'll probably call it <code>celine</code> instead.</s>
<p>


I've released a library! It's called <a href="https://maxbo.me/celine">@celine/celine</a>!

</p><p><img src="https://maxbo.me/img/typing.gif" alt="A computer terminal receives text">
</p>

</div>
<div>

<h2>Slide infrastructure</h2><p>


I demo'd this article at <a href="https://www.youtube.com/@SydJSMeetup">SydJS</a>. This is the code I used to turn the article into a slideshow.

</p><ul>
  <li><kbd>Shift</kbd> + <kbd>N</kbd> - Start slideshow / next slide</li>
  <li><kbd>Shift</kbd> + <kbd>B</kbd> - Previous slide</li>
  <li><kbd>Shift</kbd> + <kbd>E</kbd> - End slideshow</li>
</ul>

<br>







</div></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[We are shutting down the Ondsel FreeCAD business (283 pts)]]></title>
            <link>https://ondsel.com/blog/goodbye/</link>
            <guid>42169998</guid>
            <pubDate>Mon, 18 Nov 2024 05:40:58 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://ondsel.com/blog/goodbye/">https://ondsel.com/blog/goodbye/</a>, See on <a href="https://news.ycombinator.com/item?id=42169998">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="__blog-post-container" itemprop="articleBody"><p>After operating for almost two years, Ondsel has made the difficult decision to cease operations and close down. We are incredibly thankful for the support we’ve received from the FreeCAD community and the larger engineering CAD communities.</p><h2 id="why-ondsel-is-closing-down">Why Ondsel is closing down<a href="#why-ondsel-is-closing-down" aria-label="Direct link to Why Ondsel is closing down" title="Direct link to Why Ondsel is closing down">​</a></h2><p>From the beginning, we knew competing with commercial CAD would be tough. Closed-source CAD is taught in schools and is deeply entrenched in established industry use. We knew that to be successful, we would have to find a way to provide real value and coexist in environments where other tools are already used.</p><p>While seeking a scalable and repeatable business model, we conducted numerous surveys and interviewed nearly a hundred mechanical engineers, service engineers, tinkerers, inventors, workshop owners, and other users. While we found support among independent and hobbyist users who genuinely wanted us to succeed, we failed to find commercial adoption to justify a venture-capitalized startup. Ultimately, we could not find a product-market fit and ran out of runway to continue the search.</p><h2 id="things-we-are-proud-of">Things we are proud of<a href="#things-we-are-proud-of" aria-label="Direct link to Things we are proud of" title="Direct link to Things we are proud of">​</a></h2><p>While we have failed to build a sustainable commercial business around FreeCAD, we have accomplished many things.</p><h3 id="a-better-freecad-application">A better FreeCAD application<a href="#a-better-freecad-application" aria-label="Direct link to A better FreeCAD application" title="Direct link to A better FreeCAD application">​</a></h3><ul><li>We contributed a new integrated assembly workbench that was sorely missing in the program and a 3D constraints solver on which the workbench relies.</li><li>We also contributed significant improvements to the usability of Sketcher and TechDraw.</li><li>We introduced VarSets — a brand-new custom properties system.</li><li>We introduced new features to TechDraw and CAM workbenches.</li><li>Beyond FreeCAD itself, we contributed to third-party addons like SheetMetal.</li></ul><h3 id="lens-as-a-service-for-connected-cad">Lens as a service for connected CAD<a href="#lens-as-a-service-for-connected-cad" aria-label="Direct link to Lens as a service for connected CAD" title="Direct link to Lens as a service for connected CAD">​</a></h3><ul><li>We demonstrated what a connected CAD experience could look like with open source at its core.</li><li>We built a service that enabled teams to organize iterated development of hardware products.</li><li>We built a simple way to share your models publicly or privately, including PIN protection for share links.</li><li>We made it possible to publish parametric models online that you can modify and download.</li></ul><p>Between our May release (2024.2) and today alone, 145 pull requests by the Ondsel team have been merged into the upstream codebase, making FreeCAD 1.0 a more featureful and polished release than we all hoped it would be.</p><p>Having a commercial partner working on FreeCAD also meant that the project had to adapt. Our presence and cooperation affected how the FreeCAD project operates. Our blog brought attention to missing features and helped the project establish priorities. Working with the core maintainers, we improved the contribution process, sped up the merge process, and helped form the Design Working Group and the new CAD Advisory Group. These are significant advances that will benefit the community for a long time.  </p><p>Most of all, we showed that a commercial partner can be an asset to the project. We hope many more entrepreneurs will build around FreeCAD in the spirit of cooperation to establish a robust ecosystem that benefits the world and is profitable. </p><h2 id="what-happens-to-ondsel-es">What happens to Ondsel ES<a href="#what-happens-to-ondsel-es" aria-label="Direct link to What happens to Ondsel ES" title="Direct link to What happens to Ondsel ES">​</a></h2><p>OES was designed to be our flavor of FreeCAD with more pleasing UX/UI, frequent releases, and added value.</p><p>Part of the better UX/UI was our improvements to Sketcher and TechDraw—all users of FreeCAD 1.0 will enjoy those. We owe much of the praise for the UI to Joe Sardos, who designed OpenTheme. We didn’t fund that project, but we pushed it on our users, and they loved it. So we think Joe did a spectacular job, and we cannot thank him enough for that. </p><p>The added value we shipped as part of OES is all available as free and open-source code, and most of it will be part of FreeCAD.</p><p>As such, there is no point in releasing v2024.3. However, we are not abandoning the FreeCAD community. Brad will continue hacking in the CAM workbench, Pierre will likely continue working on Assembly and Sketcher, and Pieter will keep working on varsets and variant parts thanks to grants issued by the FreeCAD Project Association. All future contributions to FreeCAD by our former team members will now go directly to the upstream project.</p><p>We have yet to submit a few improvements to FreeCAD, namely the reloadable objects feature, which we strongly believe should be a core feature. We will submit this as a PR to upstream.</p><h2 id="what-happens-to-the-user-base">What happens to the user base<a href="#what-happens-to-the-user-base" aria-label="Direct link to What happens to the user base" title="Direct link to What happens to the user base">​</a></h2><p>We will notify customers and users of the shutdown. The server will continue running for a reasonable period to give users time to download their data. If you have any projects on Lens that you haven’t backed up anywhere else, please download them as soon as possible.</p><p>Paying customers will be reimbursed for any remaining time on their subscription.</p><p>For questions or comments please email us at <a href="mailto:support@ondsel.com" target="_blank" rel="noopener noreferrer">support@ondsel.com</a>.</p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[How Japanese Black Companies Oppress Workers and Ruin Lives[2014] (162 pts)]]></title>
            <link>https://www.tofugu.com/japan/japanese-black-companies/</link>
            <guid>42169615</guid>
            <pubDate>Mon, 18 Nov 2024 04:02:13 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.tofugu.com/japan/japanese-black-companies/">https://www.tofugu.com/japan/japanese-black-companies/</a>, See on <a href="https://news.ycombinator.com/item?id=42169615">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
<p><img width="100%" src="https://files.tofugu.com/articles/japan/2014-04-25-japanese-black-companies/header-640x.jpg" alt="Header 640x">
</p>
<h2>
<span>
How Japanese Black Companies Oppress Workers <span>and</span> Ruin Lives
</span>
<small>
<span>
Welcome to the team…and the nightmare
</span>
</small>
</h2>
<p>
<span>
<time datetime="2014-04-25T00:00:00Z">April 25, 2014</time>
•
<span></span>
words written by

•
Art by
<a href="https://www.tofugu.com/about/people/aya-francisco/">Aya Francisco</a>
<a href="https://files.tofugu.com/articles/japan/2014-04-25-japanese-black-companies/header-5120x.jpg" title="Download header wallpaper" target="_blank"><i></i>
</a></span>
</p>
</div><div>
<article>
<div>
<p>If you hear the term "black company", what kind of company do you imagine? As we all know, black is the darkest color, so if you pictured an evil company with a dark side then you would be on the right track. A black company (aka "black corporation" or "black business") is <i>buraku kigyō</i> <ruby>ブラック<rp>（</rp><rt></rt><rp>）</rp></ruby><i></i> <ruby>企業<rp>（</rp><rt>きぎょう</rt><rp>）</rp></ruby> in Japanese. In general, it is a term used to refer to an unacceptably exploitative employment system.</p>

<p>Now, maybe you're thinking this is a word to describe a factory somewhere in China, but you'd be wrong. The term is actually usually associated with white-collar industries rather than blue-collar ones. It was coined by young IT workers in the early 2000's and, being the IT workers that they were, spread this nickname around the internet as an internet meme. Now, thanks to its fame, it is a term that can be used for other industries that are not IT.</p>

<h2 id="the-black-company-and-a-film">The Black Company And A Film</h2>

<p>As the popularity of the term grew, the black company problem received more and more attention in Japan. In 2009, a drama film called "A man on the verge at a BLACK company" was released. It was based on an office worker who started a 2ch thread about the black company he worked at. This company's ruthless and unethical work environment was duplicated in the film.</p>

<p><iframe width="200" height="113" src="https://www.youtube.com/embed/ebxD-KJNFwk?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen="" title="ブラック会社に勤めてるんだが、もう俺は限界かもしれない"></iframe></p>

<p>As you can see in the film clip, the workers are being pushed to their limit and obviously not in good shape. Can you imagine working someplace like that for real? Well, bad (black) companies are really out there and this sparked a move towards calling them out. Still, there was a long way to go to bring about public awareness.</p>

<h2 id="the-black-company-awards">The Black Company Awards</h2>

<figure><img alt="A skyscraper housing a Japanese Black Company" src="https://files.tofugu.com/articles/japan/2014-04-25-japanese-black-companies/black-company-building.jpg"><figcaption>  </figcaption> Source: <a href="https://www.flickr.com/photos/sharif/3299531471" title="Visit source's website" target="_blank">Beshef</a></figure>

<p>In 2012, a group of people that included journalists, activists, and university professors formed a special committee to create the "Black Corporations Award" where the public could vote on "the most evil corporations of the year." The award name may sound silly, but its creators were not joking. They were hoping to raise awareness of black company issues as well as expose some of the evil abusers of employees. This is now an annual award.</p>

<figure><img alt="Graphic with Japanese text saying Most Evil Corporation Award" src="https://files.tofugu.com/articles/japan/2014-04-25-japanese-black-companies/most-evil-corporation-award.jpg"></figure>

<p>The most recent award, which took place on June 17th of 2013, nominated eight companies:</p>

<ol>
  <li>Watami Foodservice Co., Ltd (Restaurant Chain)</li>
  <li>Cross Company Inc. (Clothing Retailer)</li>
  <li>Benesse Corporation (Education and Publishing)</li>
  <li>Sun Challenge Corporation (Steak Restaurant Chain)</li>
  <li>Ohsho Food Service Corporation (Restaurant Chain)</li>
  <li>Seino Transportation Co., Ltd (Transportation Service)</li>
  <li>Tokyu Hands Inc. (Department Store)</li>
  <li>Tohoku University</li>
</ol>

<p>All nominations were made on the following basis:</p>

<ol>
  <li>Actual public records on occupational problems such as a long work time, sexual harassment, or abuse of power.</li>
  <li>Long intense work hours.</li>
  <li>Low pay.</li>
  <li>Compliance violations.</li>
  <li>Flaws in the system, such as lack of childcare leave or maternity leave.</li>
  <li>Hostility to unions.</li>
  <li>Discrimination against temporary workers.</li>
  <li>Temporary worker dependance.</li>
  <li>npaid overtime (and lies about paid overtime in the job advertisements).</li>
</ol>

<p>Most black companies already have the above problems, so the nominees were chosen for being especially bad. After the nominations, there was a period in which people could vote. The winner? Watami Foodservice Co., and by a wide margin. They got 21,899 votes, 72% of the total. This was followed by Tohoku University (3,475 votes), Benesse Corporation (1,258 votes), Cross Company Inc (1,220 votes), Seino Transportation Co., Ltd (1,000 votes), Ohsho Food Service Corporation (744 votes), Sun Challenge Corporation (649 votes), and Tokyu Hands Inc (346 votes). Watami has won this award for two years in a row so far.</p>

<figure><img alt="A chart displaying the worst Japanese black companies" src="https://files.tofugu.com/articles/japan/2014-04-25-japanese-black-companies/notorious-black-companies-chart.png"></figure>

<p>Watami's winning streak is due to its notoriously abysmal mistreatment of young workers. In 2008, Mina Mori, a female employee of Watami, committed suicide at the age of 26 after reportedly working 141 hours of overtime in one month. It happened just two months after joining the restaurant chain. Some people may think committing suicide is an individual matter and that a company cannot be held responsible. However, it is reasonable to assume Mori would not have chosen suicide for herself had she not been forced into such a desperate situation. Furthermore, it is apparent just how "black" the Watami company is simply by the cold reaction of Watami founder Miki Watanabe's reaction to the case. He not only refused to meet with her family but also refused to apologize to them until last month. He finally did offer an apology in court on March 27, 2014, though he still has denied liability.</p>

<p>According to an interview with a former Watami restaurant manager conducted by Takarajima magazine (September 2013 edition), upon hearing the news of Ms. Mori's suicide, the ex-manager wondered if it was really <em>just</em> 141 hours. During his time at Watami, he regularly worked from 7am to 12am with almost no break, making his monthly overtime over 300 hours. He also revealed that Miki Watanabe gives extreme messages to workers on every payday, such as: "Regret as hard as you die!" He even received a personal letter from the evil president in his paycheck envelope saying: "you should reflect on your sales this month by killing yourself."</p>

<figure><img alt="The exterior of a Watami Bar during the evening" src="https://files.tofugu.com/articles/japan/2014-04-25-japanese-black-companies/watami-bar-at-night.jpg"><figcaption>  </figcaption> Source: <a href="https://www.flickr.com/photos/miyo/2473313816" title="Visit source's website" target="_blank">Miyo Sekimoto</a></figure>

<p>There was also an illegal but mandatory 1,000 yen deduction from every payment and workers were told that it was for "social contribution." When Watanabe published his own book, the price of the book was automatically deducted from the payment and workers were forced to buy them as well. Although there wasn't any physical violence, he remembered that there was much verbal violence, often relating to "killing himself."</p>

<p>That sounds pretty awful, right? These workers were not treated like human beings… more like robots. Though even robots shouldn't have to work this hard. Obviously a lot of other people felt the same way and anti-Watami movements have risen. On the same day that Watami apologized to Ms. Mori's family, Watami decided to temporarily close 60 restaurants (about 10% of the total) to improve their work environment. I hope this will really be the start of some reform so that others won't have to endure the same mistreatment.</p>

<p>Perhaps thanks to this and the awareness brought about by the Black Company Awards, the term <i>buraku kigyō</i> <ruby>ブラック<rp>（</rp><rt></rt><rp>）</rp></ruby><i></i> <ruby>企業<rp>（</rp><rt>きぎょう</rt><rp>）</rp></ruby> made the final 10 of the most popular or influential Japanese buzzwords in 2013! So, consider the checkbox of "raising awareness" filled in, though there's still much work to be done.</p>

<h2 id="what-colors-a-company-black">What Colors A Company Black?</h2>

<figure><img alt="Black paint chipping off a wall" src="https://files.tofugu.com/articles/japan/2014-04-25-japanese-black-companies/black-wall.jpg"><figcaption>  </figcaption> Source: <a href="https://www.flickr.com/photos/dg_pics/3938829378" title="Visit source's website" target="_blank">David Gunter</a></figure>

<p>So what are the exact qualifications for a company to be considered a black company? You can get some idea from the stories of Watami, but a lawyer named Yoshiyuki Iwasa, who is also the author of <a href="http://www.amazon.co.jp/o/ASIN/4907292090/itmedia-makoto-22/">ブラック<i></i> <ruby>企業<rp>（</rp><rt>きぎょう</rt><rp>）</rp></ruby>に<i></i> <ruby>倍返<rp>（</rp><rt>きぎょう</rt><rp>）</rp></ruby>しだ!</a> (which means "to take double revenge on the black company") <a href="http://bizmakoto.jp/makoto/articles/1401/23/news018_2.html">created a checklist for a website called Business Media</a> to find out whether the company is "black" or "not black." There are thirty items on the list and if none of them apply to the company, it is pure white. If 1-9 items are applicable, it is considered gray. 10-14 is dark gray. 30 out of 30 is pitch black. You get the picture. Now let's take a look at the list.</p>

<ol>
  <li>I do work overtime, but overtime is never paid.</li>
  <li>It's usual to work more than 80 hours overtime a month.</li>
  <li>I don't have a break, or at the most, 10 minutes a day.</li>
  <li>I work on my days off. Actually, I'm not even sure when my days off are.</li>
  <li>There is no paid time off system or if there is such a system, I am never allowed to use it.</li>
  <li>I never get reimbursed for expenses and always have to pay out of pocket.</li>
  <li>There is no social insurance, benefits, or pension. If I ask about this, I would be bullied.</li>
  <li>If I converted my monthly wage into an hourly rate equivalent, it would be less than minimum wage.</li>
  <li>Regardless of how long I work overtime, the overtime payment is a fixed amount.</li>
  <li>The company is constantly hiring new employees.</li>
  <li>The advertised job wage is different from the actual amount paid.</li>
  <li>There are no time cards or someone else punches you in and out.</li>
  <li>There are one or more workers who can't come to the office due to psychotic depression or nervous breakdown.</li>
  <li>I'm so busy that I often can't get adequate sleep.</li>
  <li>There is no union or company regulations.</li>
  <li>Some employees are promoted to an administrative position right after joining the company, but there is no extra remuneration for that.</li>
  <li>Employees have to run private errands for their employers.</li>
  <li>There is a slogan saying "work until you die" on the company wall.</li>
  <li>Abuse of power and sexual harassment are very common.</li>
  <li>There are so many affiliate companies and subsidiaries, though I don't even know what those companies do.</li>
  <li>Whenever some incident happens, the company changes its name.</li>
  <li>There are training sessions, which use what can be considered brainwashing or hazing.</li>
  <li>Threats such as "I'm going to kill you" can be commonly heard at the office.</li>
  <li>Violence is rampant.</li>
  <li>All the supervisors are relatives of the CEO.</li>
  <li>I was told to quit the company in a roundabout way like, "you may not be cut out for this position."</li>
  <li>I can't quit the job. If I say I'm going to quit, I'll be threatened that I will have to pay damages for quitting.</li>
  <li>They don't provide the necessary documents such as the separation slip to those who try to quit.</li>
  <li>The worker's average age is really young.</li>
  <li>The rate of people leaving their jobs within 3 years is really high.</li>
</ol>

<p>Now after looking through them, do any of these conditions apply to your company? Many of the items may sound ridiculous, but I have worked under some of these conditions before and I have some friends who work for such companies. However, I'm not sure if their companies are pitch black. Maybe just very, very dark?</p>

<figure><img alt="Black paint trailing down a white wall" src="https://files.tofugu.com/articles/japan/2014-04-25-japanese-black-companies/dripping-black-paint.jpg"><figcaption>  </figcaption> Source: <a href="https://www.flickr.com/photos/rockandbacon/4600142725" title="Visit source's website" target="_blank">rockandbacon</a></figure>

<p>According to <a href="http://www.mhlw.go.jp/stf/houdou/2r985200000339uj.html">Japan's Ministry of Health, Labour and Welfare</a>, the number of cases delivered to the General Labor Consultation Center in 2012 was 1,067,210. 254,719 of them involved troubles at work such as encouragement of early retirement, worsening work conditions, the lowering of pay, long periods of overtime without payment, or mean, abusive bosses and/or coworkers. A decade ago, only around 100,000 cases were reported. This number has increased about 2.5x, showing that either black companies are increasing in number, or, what is more likely, more people are coming forward. These companies are finally having their true colors exposed (black).</p>

<p>In September, 2013, the Labor Ministry began a crackdown on black companies, too. They examined 5,111 such companies based on their high turnover rates of young workers, their past violations, and complaints from employees. Then it was revealed that over 80% of them, 4,189 companies, were indeed actually black companies engaged in illegal business practices. They were flagged for violations against the Labor Standards Act. The ministry intends to discipline the companies in question and if those companies continue to violate the Labor Standards laws, their names will be made public.</p>

<p>So, now that the Labor Ministry is getting involved, can we call this the end of the story? Well, I'm afraid it's not over yet. This was only the ministry's first survey on black companies and there are over 4 million companies in Japan. So, the exciting fight has only just begun! We're counting on you, Black Company Awards and Japan's Labor Ministry!</p>



</div>
</article>
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Linux kernel 6.12 has been released (143 pts)]]></title>
            <link>https://lwn.net/Articles/997958/</link>
            <guid>42169418</guid>
            <pubDate>Mon, 18 Nov 2024 03:12:44 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://lwn.net/Articles/997958/">https://lwn.net/Articles/997958/</a>, See on <a href="https://news.ycombinator.com/item?id=42169418">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><p>
Linus has <a href="https://lwn.net/Articles/998490/">released the 6.12 kernel</a>.
"<q>No strange surprises this last week, so we're sticking to the regular
release schedule, and that obviously means that the merge window opens
tomorrow.</q>".
</p><p>

Headline features in this release include:

support for the <a href="https://developer.arm.com/documentation/102376/0200/Permission-indirection-and-permission-overlay-extensions">Arm
permission overlay</a> extension,
better compile-time control over which Spectre mitigations to employ,
the <a href="https://lwn.net/Articles/990985/">last pieces of realtime preemption support</a>,
the realtime <a href="https://lwn.net/Articles/934415/">deadline server</a> mechanism,
more <a href="https://lwn.net/Articles/969062/">EEVDF scheduler</a> development,
the <a href="https://lwn.net/Articles/974387/">extensible scheduler class</a>,
the <a href="https://lwn.net/Articles/979549/">device memory TCP</a> work,
<a href="https://lwn.net/Articles/979683/">use of static calls</a> in the security-module
subsystem,
the <a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=a430d95c5efa">integrity
policy enforcement</a> security module,
the ability to handle devices with a block size larger than the system page
size in the XFS filesystem,
and more.
See the LWN merge-window summaries 
(<a href="https://lwn.net/Articles/990750/">part&nbsp;1</a>, <a href="https://lwn.net/Articles/991301/">part&nbsp;2</a>) and the <a href="https://kernelnewbies.org/Linux_6.12">KernelNewbies 6.12 page</a> for
more details.<br clear="all"></p><hr>
            </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[1 in 5 Japanese Workers in Their 20s Turn to Resignation Agencies (160 pts)]]></title>
            <link>https://metropolisjapan.com/resignation-agencies/</link>
            <guid>42169027</guid>
            <pubDate>Mon, 18 Nov 2024 01:49:53 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://metropolisjapan.com/resignation-agencies/">https://metropolisjapan.com/resignation-agencies/</a>, See on <a href="https://news.ycombinator.com/item?id=42169027">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>


                <figure>
                    <img width="1000" height="667" src="https://metropolisjapan.com/wp-content/uploads/2024/11/resignation-agencies-in-Japan-1000x667.jpg" alt="“They Ripped Up My Resignation Letter”: 1 in 5 Japanese Workers in Their 20s Turn to Resignation Agencies" decoding="async" fetchpriority="high" srcset="https://metropolisjapan.com/wp-content/uploads/2024/11/resignation-agencies-in-Japan-1000x667.jpg 1000w, https://metropolisjapan.com/wp-content/uploads/2024/11/resignation-agencies-in-Japan-600x400.jpg 600w, https://metropolisjapan.com/wp-content/uploads/2024/11/resignation-agencies-in-Japan-250x167.jpg 250w, https://metropolisjapan.com/wp-content/uploads/2024/11/resignation-agencies-in-Japan-768x512.jpg 768w, https://metropolisjapan.com/wp-content/uploads/2024/11/resignation-agencies-in-Japan-1536x1024.jpg 1536w, https://metropolisjapan.com/wp-content/uploads/2024/11/resignation-agencies-in-Japan-2048x1365.jpg 2048w" sizes="(max-width: 1000px) 100vw, 1000px">                </figure>

                
                

                
<p><a href="https://career-research.mynavi.jp/reserch/20241003_86953/" target="_blank" rel="noreferrer noopener"><em>A new survey from Mynavi Corp.</em></a><em> shows a significant rise in resignation agencies across Japan that help people quit their jobs. But why?</em></p>



<p>With deep remorse, Mr. Iida sank to the floor. His knees touched the cold concrete, and he bowed so profoundly that his head almost met the ground. “Dogeza,” the most sincere way to apologize for a serious offense, performed by a salaryman in his boss’s office. The reason? Mr. Iida submitted his resignation. But, after a brief silence, there was a tearing sound, and he realized his boss had ripped his resignation letter to shreds. The message was clear: <em>you are not allowed to quit.</em></p>



<p>In Japan, leaving a job can be challenging. Traditionally, employment is considered a lifelong commitment. Though Japan is moving away from this outdated mentality, many traditional companies still expect employees to work until retirement without changing jobs.</p>



<p>For some older generations, there is still a deep sense of shame in switching jobs, as work ethic in Japan is closely tied to loyalty and respect. Japanese law technically guarantees the right to quit, but doing so is often seen as disrespectful, as companies invest time and money in training employees. It is a mutual investment — the company invests in you, and you, in turn, commit to advancing within the organization over time.</p>



<h2>“I Can’t Take This Anymore”</h2>



<p>Mr. Iida performed the dogeza three times before his boss, apologizing for “letting him down,” yet his resignation still wasn’t accepted. He had to find another way out.</p>



<p>He contacted the resignation agency Momuri, whose name translates to “I Can’t Take This Anymore.” For around ¥22,000, they handle the entire resignation process, contacting the boss on behalf of the client, negotiating with the company, and even recommending lawyers if legal disputes arise.</p>



<p>According to Yujin Watanabe, a spokesperson from Albatross Corp., which manages Momuri’s services, their typical client profile is young people in their 20s who work for small to medium-sized companies, often in corporate or welfare industries.</p>



<p>Mr. Iida is far from alone in seeking outside help to resign. Since 2022, Momuri, just one independent resignation agency, has received 35,000 requests from people needing assistance quitting their jobs.</p>



<h2>1 in 5 in Their 20s Use Resignation Agencies</h2>



<figure><img decoding="async" loading="lazy" width="1000" height="611" src="https://metropolisjapan.com/wp-content/uploads/2024/11/Mynavi-Corporation-resignation-agency-age-metropolis-japan-1000x611.png" alt="" srcset="https://metropolisjapan.com/wp-content/uploads/2024/11/Mynavi-Corporation-resignation-agency-age-metropolis-japan-1000x611.png 1000w, https://metropolisjapan.com/wp-content/uploads/2024/11/Mynavi-Corporation-resignation-agency-age-metropolis-japan-654x400.png 654w, https://metropolisjapan.com/wp-content/uploads/2024/11/Mynavi-Corporation-resignation-agency-age-metropolis-japan-250x153.png 250w, https://metropolisjapan.com/wp-content/uploads/2024/11/Mynavi-Corporation-resignation-agency-age-metropolis-japan-768x470.png 768w, https://metropolisjapan.com/wp-content/uploads/2024/11/Mynavi-Corporation-resignation-agency-age-metropolis-japan.png 1220w" sizes="(max-width: 1000px) 100vw, 1000px"><figcaption>Mynavi Corporation: use of resignation services in the past year by age group and occupation.</figcaption></figure>



<p>A new survey by the employment information provider Mynavi Corp. found that nearly 1 in 5 people in their 20s who quit their jobs in Japan last year used agencies like Momuri to help them.&nbsp;</p>



<p>The survey, which included employees ages 20-50 who quit jobs between June 2023 and June 2024, shows that 18.6% of those in their 20s used these services, 17.6% were in their 30s and 17.3% were in their 40s. Only 4.4% were in their 50s, indicating that older employees tend to stay in jobs longer—even if conditions are poor—as the younger generation is more likely to adjust to their needs and wishes.&nbsp;</p>



<p>The top-cited reason for using resignation agencies, at 40.7%, was that companies refused to let them quit. Other reasons included fear of backlash if they resigned alone or their work environment discouraged employees from quitting independently.&nbsp;</p>



<p>Mynavi Corp. also surveyed workplaces and asked managers how often employees under their supervision had used resignation agencies. Between January and June 2024, 23.2% reported that they had employees who used resignation agencies. The most common fields were insurance, finance and IT.</p>



<h2><strong>Resignation Agencies Reflect Japan’s Mental Health Crisis</strong></h2>



<p>According to Momuri, most Japanese people in corporate roles have a low awareness of mental health. Social norms often discourage <a href="https://metropolisjapan.com/japanese-books-mental-health-wellbeing/" target="_blank" rel="noreferrer noopener">seeking help for mental challenges</a>—many of which stem from their work.&nbsp;</p>



<p>This lack of support is one reason more Japanese people now turn to resignation agencies. They quit to avoid damaging their mental health and use resignation agencies to sidestep the stress of handling the process themselves.</p>



<p>Mr. Iida’s experience of his boss tearing up his resignation letter is not unique. In fact, it’s far from the most extreme case. Momuri confirms stories of companies forcing employees to visit temples to ‘cure’ their desire to quit. Sometimes they even receive home visits from managers pressuring them to stay.&nbsp;</p>



<p>Those fortunate enough to leave are sometimes asked to send apology letters to colleagues or deliver speeches expressing regret for their “selfishness” and “disrespect.” Of course, these are the most extreme cases–but they do occur, according to Momuri.</p>



<p>Some companies are notorious for resignation difficulties, excessive overtime and intense work pressure. So much so that they are labeled as “black companies.” The problem has become so severe that Japan’s Ministry of Health, Labour and Welfare’s Labor Standards Bureau has published a list of these companies to warn potential job seekers.</p>



<figure><img decoding="async" loading="lazy" width="1000" height="647" src="https://metropolisjapan.com/wp-content/uploads/2024/11/Mynavi-Corporation-resignation-agency-reason-metropolis-japan-1000x647.png" alt="" srcset="https://metropolisjapan.com/wp-content/uploads/2024/11/Mynavi-Corporation-resignation-agency-reason-metropolis-japan-1000x647.png 1000w, https://metropolisjapan.com/wp-content/uploads/2024/11/Mynavi-Corporation-resignation-agency-reason-metropolis-japan-618x400.png 618w, https://metropolisjapan.com/wp-content/uploads/2024/11/Mynavi-Corporation-resignation-agency-reason-metropolis-japan-250x162.png 250w, https://metropolisjapan.com/wp-content/uploads/2024/11/Mynavi-Corporation-resignation-agency-reason-metropolis-japan-768x497.png 768w, https://metropolisjapan.com/wp-content/uploads/2024/11/Mynavi-Corporation-resignation-agency-reason-metropolis-japan.png 1224w" sizes="(max-width: 1000px) 100vw, 1000px"><figcaption>Mynavi Corporation: Reasons for using resignation service. </figcaption></figure>



<h2><strong>Generational Change Could Be Japan’s Savior</strong></h2>



<p>A generational shift is underway in Japan, one that may eventually ease work-related pressures and their sometimes fatal consequences. Physical strain and mental stress contribute to both <em>karojisatsu</em>, or ‘overwork suicide,’ and <em>karoshi</em>, or ‘death by overwork’.&nbsp;</p>



<p>According to the <a href="https://www.niph.go.jp/journal/data/73-1/202473010003.pdf" target="_blank" rel="noreferrer noopener">Ministry of Health, Labor and Welfare</a>, the number of Japanese people who committed suicide due to their work rose from 1,935 cases in 2021 to 2,968 in 2022. This marked a record high. While the figure has since slightly decreased, the strain on workers remains severe.</p>



<p>Since they first appeared in 2018, resignation agencies have become an essential ally in Japan’s work culture shift. These agencies empower young workers to prioritize their mental well-being and advocate for change, providing a way out for those trapped in restrictive work environments.&nbsp;</p>



<p>This growing reliance on resignation services underscores a generational pushback against outdated norms and signals a potential transformation in Japan’s work culture. If these shifts continue, Japan’s younger generation may indeed pave the way toward a more balanced and sustainable future for the country’s workforce. Let’s hope they succeed.&nbsp;</p>
            </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[It's Time to Replace TCP in the Datacenter (157 pts)]]></title>
            <link>https://arxiv.org/abs/2210.00714</link>
            <guid>42168997</guid>
            <pubDate>Mon, 18 Nov 2024 01:42:41 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://arxiv.org/abs/2210.00714">https://arxiv.org/abs/2210.00714</a>, See on <a href="https://news.ycombinator.com/item?id=42168997">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="labstabs"><p>
    <label for="tabone">Bibliographic Tools</label></p><div>
      <h2>Bibliographic and Citation Tools</h2>
      <div>
          <p><label>
              
              <span></span>
              <span>Bibliographic Explorer Toggle</span>
            </label>
          </p>
          
        </div>
        
        
        
        
    </div>


    <p>
    <label for="tabtwo">Code, Data, Media</label></p><div>
      <h2>Code, Data and Media Associated with this Article</h2>
      

      
      
      
      
      
      
      
      
    </div>


      <p>
      <label for="labstabs-demos-input" id="labstabs-demos-label">Demos</label></p><div>
        <h2>Demos</h2>
        
        
        
        
      </div>
      <p>
      <label for="tabfour">Related Papers</label></p><div>
        <h2>Recommenders and Search Tools</h2>
        
        
        
        
        
      </div>

      <p>
      <label for="tabfive">
        About arXivLabs
      </label></p><div>
            <h2>arXivLabs: experimental projects with community collaborators</h2>
            <p>arXivLabs is a framework that allows collaborators to develop and share new arXiv features directly on our website.</p>
            <p>Both individuals and organizations that work with arXivLabs have embraced and accepted our values of openness, community, excellence, and user data privacy. arXiv is committed to these values and only works with partners that adhere to them.</p>
            <p>Have an idea for a project that will add value for arXiv's community? <a href="https://info.arxiv.org/labs/index.html"><strong>Learn more about arXivLabs</strong></a>.</p>
          </div>

    </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Teen behind hundreds of swatting attacks pleads guilty to federal charges (147 pts)]]></title>
            <link>https://www.wired.com/story/alan-filion-torswats-guilty-plea-federal-charges-swatting/</link>
            <guid>42168652</guid>
            <pubDate>Mon, 18 Nov 2024 00:39:34 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.wired.com/story/alan-filion-torswats-guilty-plea-federal-charges-swatting/">https://www.wired.com/story/alan-filion-torswats-guilty-plea-federal-charges-swatting/</a>, See on <a href="https://news.ycombinator.com/item?id=42168652">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-testid="ArticlePageChunks"><div data-journey-hook="client-content" data-testid="BodyWrapper"><p>In perhaps the largest swatting case to ever be prosecuted, an 18-year-old from Lancaster, California, has pleaded guilty to federal charges stemming from a nationwide spree of <a href="https://www.wired.com/story/alan-filion-torswats-swatting-arrest/">hundreds of shooting and bomb threat hoaxes</a> that sent police scrambling to high schools, courthouses, and the homes of law enforcement officials and prominent politicians.</p><p>Alan Winston Filion now faces a maximum penalty of five years in prison for each of four counts of making interstate threats to injure the person of another, according to the <a href="https://www.justice.gov/opa/pr/california-teenager-pleads-guilty-florida-making-hundreds-swatting-calls-across-united">United States Department of Justice</a>.</p><p>Early this year, Filion was <a href="https://www.wired.com/story/torswats-swatting-arrest/">arrested and extradited</a> to Seminole County, Florida. At the time, state prosecutors charged Filion with four state-level felony counts stemming from a single incident in which, prosecutors allege, Filion told a Sanford Police Department dispatcher that he was armed with pipe bombs and an AR-15 rifle and was walking into Masjid Al Hayy Mosque to kill everyone he saw.</p><p>Filion, whom authorities believe operated online as “Torswats,” has been in jail without a trial for nearly a year. He entered a plea of not guilty to the state charges.</p><p>The federal charges announced on Wednesday, along with interviews from people connected to the investigation—and Filion himself—allege his swatting activities reached far beyond Florida’s borders.</p><p>Between approximately August 2022 to January 2024 Filion made more than 375 swatting calls, according to the plea agreement. These included incidents where he claimed to have planted bombs or threatened to conduct mass shootings at targeted locations that included religious institutions, high schools, and historically black colleges and universities.</p><p>“This prosecution and today’s guilty plea reaffirm the Justice Department’s commitment to using all tools to hold accountable every individual who endangers our communities through swatting and hoax threats,” deputy attorney general Lisa Monaco said in a statement. “For well over a year, Alan Filion targeted religious institutions, schools, government officials, and other innocent victims with hundreds of false threats of imminent mass shootings, bombings, and other violent crimes. He caused profound fear and chaos and will now face the consequences of his actions.”</p><p>According to court records, Filion was also part of a high-profile international swatting group that targeted several prominent figures between December 2023 and January 2024. Among the victims were US Homeland Security secretary Alejandro Mayorkas, Cybersecurity and Infrastructure Security Agency director Jen Easterly, Republican US representative Marjorie Taylor Greene of Georgia, and Republican senator Rick Scott of Florida. Investigators say they linked the scheme to roughly 100 calls, one of which targeted an unnamed former president of the United States.</p></div><div data-journey-hook="client-content" data-testid="BodyWrapper"><p>In August, the Department of Justice <a data-offer-url="https://www.politico.com/news/2024/08/28/2-men-charged-with-swatting-members-of-congress-00176675" data-event-click="{&quot;element&quot;:&quot;ExternalLink&quot;,&quot;outgoingURL&quot;:&quot;https://www.politico.com/news/2024/08/28/2-men-charged-with-swatting-members-of-congress-00176675&quot;}" href="https://www.politico.com/news/2024/08/28/2-men-charged-with-swatting-members-of-congress-00176675" rel="nofollow noopener" target="_blank">charged two European men,</a> Tomasz Szabo and Nemanja Radovanovic, in connection with the widespread swatting operation, which led to at least one car accident with injuries. During interviews with the US Secret Service in January and February, both men admitted their roles in the scheme. Radovanovic, however, claimed that he was directed by a third party who provided detailed scripts and selected the targets.</p><p>According to the plea agreement, Filion admitted to orchestrating the operation, supplying the names, addresses, and phone numbers of many of the targeted individuals.</p><p>“I shot my wife in the head with my AR-15,” a man identifying himself as "James" said in one such call. He told dispatchers in Georgia that he caught his wife sleeping with another man and, after killing her, had taken the man hostage. “I’ll release him for $10,000 in cash,” he added, threatening to detonate pipe bombs and blow up the house if his demands weren’t met. This call targeted the home of Georgia state senator John Albers.</p><p>The case against Filion, <a href="https://www.wired.com/story/torswats-swatting-arrest/">first reported by WIRED</a>, was built on a <a href="https://www.wired.com/story/alan-filion-torswats-swatting-arrest/">trail of digital evidence</a> left across platforms like Telegram, YouTube, and Discord, and pieced together by Brad “Cafrozed” Dennis, a private investigator. Dennis had been hired by two high-profile Twitch stars, both victims of Torswats’ calls, to find the person responsible.</p><p>For months, Dennis had posed online as a vengeful ex-husband looking to troll and harass his former wife. He used this persona to infiltrate <a href="https://www.wired.com/story/764-com-child-predator-network/">private Discord servers and Telegram groups</a> where Torswats and affiliates hung out. These were chats dedicated to extortion plots and racist memes; channels filled with child sexual abuse material, self-harm, and animal abuse—some of the worst content he'd ever seen, Dennis told WIRED.</p><p>On New Year's Eve 2022, Dennis sent Torswats a private message on Telegram: “You wanna make some real cash? Add me on Tox,” he wrote, referring to the peer-to-peer messaging service, under the pretense of arranging a swatting.</p><p>Using network monitoring tools, Dennis then captured the IP address linked to the Torswats account and uncovered a new username: "Paimon Arnum." In January 2023, Dennis handed this critical piece of evidence, along with other usernames and active Discord servers he had tracked over several months, over to the FBI.</p></div><div data-journey-hook="client-content" data-testid="BodyWrapper"><p>According to emails reviewed by WIRED, that information was central to how the FBI broke the case and was the basis of subpoenas sent to Discord and Google in April of 2023 seeking information on accounts Dennis had identified. By early May, the FBI had successfully pinpointed Torswats’ identity and location.</p><p>That month, Torswats privately took responsibility for swatting incidents in Telegram chats reviewed by WIRED. These incidents affected up to 25 schools in Washington state, impacting approximately 18,116 students and costing taxpayers an estimated $271,173 in lost instructional time, according to Don Beeler, CEO of <a data-offer-url="https://tdrtechnologysolutions.com/" data-event-click="{&quot;element&quot;:&quot;ExternalLink&quot;,&quot;outgoingURL&quot;:&quot;https://tdrtechnologysolutions.com/&quot;}" href="https://tdrtechnologysolutions.com/" rel="nofollow noopener" target="_blank">TDR Technology Solutions</a>, a company specializing in school surveillance and threat analysis.</p><p>Additionally, 911 audio and other police records obtained by WIRED corroborate that the same individual made the calls for more than a dozen of these swatting incidents. In some instances, the caller told dispatchers he had been commanded by Satan to kill students. In others, he said he had been mistreated because he was gay. In others, he seemed to have become bored enough with the game that he didn’t bother to make up a reason.</p><p>On July 12, the Torswats handle announced a new swatting operation dubbed the “Grand Offensive,” targeting a dozen senators. Three days later, the FBI raided Filion’s home and seized his electronic devices.</p><p>But the raid didn’t stop the swatting.</p><p>On November 6, 2023, someone using the Torswats handle took responsibility for a bomb threat aimed at North Beach High School in Ocean Shores, Washington, through a Telegram message. According to police reports and call records obtained by WIRED, the caller impersonated a drug dealer who wanted to report his client to the police because he had said he had placed pipe bombs around the school and was planning a mass shooting. That same month, a person going by Torswats also admitted to swatting an <a data-offer-url="https://ubivisproject.org/" data-event-click="{&quot;element&quot;:&quot;ExternalLink&quot;,&quot;outgoingURL&quot;:&quot;https://ubivisproject.org/&quot;}" href="https://ubivisproject.org/" rel="nofollow noopener" target="_blank">investigator and cybercrime expert</a> named Keven Hendricks in private Telegram communications.</p><p>Both threats could be attributed to the same individual, according to a law enforcement official who reviewed the recordings for WIRED but requested anonymity because they were unauthorized to speak to the press.</p><p>Details about Filion’s life outside his online activities remain sparse. Enrollment records from Lancaster’s Antelope Valley Community College show that Filion began pursuing a degree in mathematics in the fall of 2022. A former classmate, who requested anonymity due to fears of retaliation, described Filion as quiet and “forgettable.”</p><p>“He didn’t appear to have many friends,” they said.</p><p>In January 2024, an individual affiliated with the Torswats Telegram account and claiming to be a friend of Filion suggested that he was part of a group aiming to incite racial violence and that he sought money to “buy weapons and commit a mass shooting.” The allegation aligns with a written tip, placed to the FBI’s Internet Crime Complaint Center in April 2023 and obtained by WIRED, alleging that the person behind the Torswats account was involved in a neo-Nazi cult known as the Order of Nine Angles.</p><p>“He believes he is doing his part to bring about the end of days by ‘bleeding the finances and man hours of the system,’” the tipster wrote.</p><p>Filion’s family could not be immediately reached for comment. A sentencing date for the teenager has not yet been set.</p><p><em>Updated at 10:45 am EST, November, 2024: Added additional details about Filion’s involvement in swatting attacks against prominent US government officials and others.</em></p></div></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Museum of Bad Art (113 pts)]]></title>
            <link>https://museumofbadart.org/</link>
            <guid>42168503</guid>
            <pubDate>Mon, 18 Nov 2024 00:09:20 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://museumofbadart.org/">https://museumofbadart.org/</a>, See on <a href="https://news.ycombinator.com/item?id=42168503">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="content">
		<main id="main" role="main">

			
				
<article id="post-8" class="page">
	<div>
			<h2>The Museum Of Bad Art, MOBA</h2><p>
MOBA is the world’s only museum dedicated to the collection, exhibition, and
celebration of art that would not be welcomed to any traditional art museum.
Our collection includes sincere art in which something has gone wrong in a way
that results in a compelling, interesting image.

</p><!-- /wp:paragraph --><!-- wp:paragraph -->

<p><b>Location</b>: inside the <a href="https://www.dorchesterbrewing.com/"><strong>Dorchester Brewing Co</strong>,</a> 1250 Massachusetts Ave, Boston MA 02125.

<b>Hours:</b> Sunday Monday 11:30-9, Tuesday through Thursday 11:30-10,
Friday and Saturday 11:30-11.

<strong>Winter 2024/25 Hours: </strong></p><ul>
 	<li>Wednesday, Nov 27, close 6pm; Thanksgiving, Nov 28, CLOSED.</li>
 	<li>Christmas Eve, Dec 24, close 6pm; Christmas, Dec 25, CLOSED.</li>
 	<li>New Year’s Eve, Dec 31, open until midnight; New Year’s Day, Jan 1, open 11:30 to 10pm</li>
 	<li>January and February, every Monday, open at 3pm.</li>
</ul>
<p><b>Admission</b>: free
</p><h2>Dorchester Brewing Company</h2>
<p><span>DBco is Boston’s hottest Tap Room filled with fresh craft beer. It’s right on Mass
Ave in Dorchester! Admission to MOBA is free only because DBco allows (even
encourages) MOBA to adorn the walls in the taproom, game room, the stairwell,
even on the outside of the elevator shaft and a walk-in refrigerator. </span>

<b><span>While you’re there, try </span>house-made craft beers, cider,
seltzer, and wine. Here’s the<a href="https://www.dorchesterbrewing.com/tap-menu/"> Taproom menu</a>. Enjoy
lunch or dinner from their onsite food partner, <a href="https://www.mandmbbq.com/?location=11ea42e04848f045a53a0cc47a2b63cc">M&amp;M
Barbecue</a>. </b><b></b></p><p><span>DBco has a Rooftop Greenhouse and outdoor
roof deck with views of the Boston skyline; Game Room with skeeball, pinball,
arcade games, pop-a-shot, and tabletop shuffleboard; and public events like
Yappy Hour, Trivia Contests, Crafting Sessions, and more. <a href="https://www.dorchesterbrewing.com/events/">Event Calendar here</a>.</span></p>
<!-- wp:heading {"textAlign":"center"} -->
<h2>Meet the MOBA Staff</h2>
<!-- /wp:heading -->

<!-- wp:image {"id":3410,"width":"702px","height":"auto","sizeSlug":"full","linkDestination":"none","align":"center"} -->
<figure><img fetchpriority="high" decoding="async" width="500" height="261" src="https://museumofbadart.org/wp-content/uploads/2024/03/Art-Inc.jpg" alt="" srcset="https://museumofbadart.org/wp-content/uploads/2024/03/Art-Inc.jpg 500w, https://museumofbadart.org/wp-content/uploads/2024/03/Art-Inc-300x157.jpg 300w, https://museumofbadart.org/wp-content/uploads/2024/03/Art-Inc-230x120.jpg 230w, https://museumofbadart.org/wp-content/uploads/2024/03/Art-Inc-350x183.jpg 350w, https://museumofbadart.org/wp-content/uploads/2024/03/Art-Inc-480x251.jpg 480w" sizes="(max-width: 500px) 100vw, 500px"></figure>
<!-- /wp:image -->

<!-- wp:paragraph --><p>

WSBE RI PBS (Rhode Island Public Broadcast System) came all the way to Boston to learn about the Museum Of Bad Art. The result is a 7-minute video introducing MOBA’s people, history, and art. It was broadcast on their weekly show,&nbsp;<em>Art, Inc</em>. and is now available on YouTube.

</p><!-- /wp:paragraph -->

<!-- wp:paragraph --><p>

If you want to meet Curator-in-chief Michael Frank and Permanent Interim Acting Executive Director Louise Reilly Sacco, aka Mike and Louise,&nbsp;<a href="https://www.youtube.com/watch?v=HB6UhGbyXfE" target="_blank" rel="noreferrer noopener">take a look here.&nbsp;</a></p><!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>Donate</h2>
<!-- /wp:heading --><p>

MOBA is a non-profit museum. Your donation is tax-deductible in the US.

</p>
<!-- /wp:shortcode -->

<!-- wp:heading -->

<!-- /wp:heading -->					</div>
</article><!-- #post-## -->

				
			
		</main><!-- #main -->
	</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Show HN: The App I Built to Help Manage My Diabetes, Powered by GPT-4o-Mini (155 pts)]]></title>
            <link>https://apps.apple.com/gb/app/islet-diabetes/id6453168642</link>
            <guid>42168491</guid>
            <pubDate>Mon, 18 Nov 2024 00:07:55 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://apps.apple.com/gb/app/islet-diabetes/id6453168642">https://apps.apple.com/gb/app/islet-diabetes/id6453168642</a>, See on <a href="https://news.ycombinator.com/item?id=42168491">Hacker News</a></p>
<div id="readability-page-1" class="page"><div dir="" data-test-bidi=""><p>Islet: Your Personalized Glucose &amp; Health Journal</p><p>Take control of your health with Islet, the ultimate personalized health journal app designed to seamlessly track and analyze your glucose levels. Perfect for individuals managing diabetes or anyone passionate about monitoring their well-being, Islet integrates effortlessly with Apple Health to provide a comprehensive and intuitive overview of your blood glucose, heart rate during workouts, and more.</p><p> Key Features</p><p>Automatic Glucose Sync</p><p>Effortlessly keep your glucose data up-to-date by syncing directly with Apple Health. No manual entries needed!</p><p>Heart Rate &amp; Workout Insights</p><p>Track your heart rate alongside glucose levels during workouts to see how exercise impacts your blood sugar. Optimize your fitness routines with actionable insights.</p><p>Personal Health Journal</p><p>Document daily activities, symptoms, and thoughts. Add notes to specific glucose readings or workouts for a deeper understanding of your health patterns.</p><p>Food Barcode Scanner</p><p>Log meals effortlessly by scanning barcodes. Instantly capture nutritional information, including macronutrients and carbohydrate content, making diet tracking accurate and easy.</p><p>Meal Logging</p><p>Monitor your meals and snacks with ease. Discover how your dietary choices influence your glucose levels for better blood sugar management.</p><p>Highs &amp; Lows Overview</p><p>Quickly identify instances of high and low glucose levels. Spot patterns and adjust your lifestyle or treatment plan effectively.</p><p>Trend Analysis</p><p>Visualize your glucose trends over time with clear graphs and charts. Correlate fluctuations with diet, exercise, and daily habits to manage your blood sugar efficiently.</p><p>Integrated Health Data</p><p>Consolidate all your health metrics in one place by integrating Islet with Apple Health. Gain a holistic view of your glucose levels, heart rate, workouts, and more.</p><p>Subscription Benefits</p><p>Unlock the full potential of Islet with a subscription:</p><p>Flexible Plans: Choose between Monthly or Annual subscriptions.</p><p>Exclusive Features: Access automatic glucose imports, comprehensive trend analysis, meal logging with the Food Scanner, and in-depth health insights.</p><p>Free Trial: Experience all premium features with a trial period before committing.</p><p>Privacy &amp; Security</p><p>Your privacy is our priority. Read our Privacy Policy and Terms of Use to learn more about how we protect your data.</p><p>Privacy Policy: https://anthropometric.godaddysites.com/</p><p>Terms of Use (EULA): https://www.apple.com/legal/internet-services/itunes/dev/stdeula/</p><p>Availability</p><p>Download Islet now on the App Store. Compatible with all iOS devices, Islet seamlessly integrates with Apple Health to provide a comprehensive solution for tracking and managing your glucose levels and overall health.</p><p>Get Started Today</p><p>Connect to Apple Health: Sync Islet with Apple Health to automatically import your glucose data and other health metrics.</p><p>Start Journaling: Use the Food Barcode Scanner to log meals, track workouts, and add health-related notes. Islet integrates this data with your glucose readings.</p><p>Review &amp; Reflect: Regularly analyze your health data, journal entries, and trends to gain valuable insights into your glucose management and overall health.</p><p>Take charge of your health journey with Islet. Subscribe today and achieve better health outcomes with effortless glucose and wellness tracking!</p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Show HN: Nova JavaScript Engine (167 pts)]]></title>
            <link>https://github.com/trynova/nova</link>
            <guid>42168166</guid>
            <pubDate>Sun, 17 Nov 2024 23:07:25 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/trynova/nova">https://github.com/trynova/nova</a>, See on <a href="https://news.ycombinator.com/item?id=42168166">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto"><h2 tabindex="-1" dir="auto">Nova - Your favorite javascript and wasm engine</h2><a id="user-content-nova---your-favorite-javascript-and-wasm-engine" aria-label="Permalink: Nova - Your favorite javascript and wasm engine" href="#nova---your-favorite-javascript-and-wasm-engine"></a></p>
<p dir="auto"><h2 tabindex="-1" dir="auto"><g-emoji alias="warning">⚠️</g-emoji> This project is a Work In Progress, and is very far from being suitable for use <g-emoji alias="warning">⚠️</g-emoji></h2><a id="user-content-warning-this-project-is-a-work-in-progress-and-is-very-far-from-being-suitable-for-use-warning" aria-label="Permalink: :warning: This project is a Work In Progress, and is very far from being suitable for use :warning:" href="#warning-this-project-is-a-work-in-progress-and-is-very-far-from-being-suitable-for-use-warning"></a></p>
<p dir="auto">Nova is a <a href="https://tc39.es/ecma262" rel="nofollow">JavaScript</a> and
<a href="https://webassembly.org/" rel="nofollow">WebAssembly</a> engine written in Rust.</p>
<p dir="auto">The engine is exposed as a library with an API for implementation in Rust
projects which themselves must serve as a runtime for JavaScript code. The
execution model is currently greatly inspired by
<a href="https://codeberg.org/kiesel-js/kiesel" rel="nofollow">Kiesel</a> and
<a href="https://github.com/SerenityOS/serenity">SerenityOS's LibJS</a>. See the code for
more details.</p>
<p dir="auto">The core of our team is on our <a href="https://discord.gg/bwY4TRB8J7" rel="nofollow">Discord server</a>.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Talks</h2><a id="user-content-talks" aria-label="Permalink: Talks" href="#talks"></a></p>
<p dir="auto"><h3 tabindex="-1" dir="auto"><a href="https://www.youtube.com/watch?v=WKGo1k47eYQ" rel="nofollow">Nova Engine - Building a DOD JS Engine in Rust @ Finland Rust-lang meetup 1/2024</a></h3><a id="user-content-nova-engine---building-a-dod-js-engine-in-rust--finland-rust-lang-meetup-12024" aria-label="Permalink: Nova Engine - Building a DOD JS Engine in Rust @ Finland Rust-lang meetup 1/2024" href="#nova-engine---building-a-dod-js-engine-in-rust--finland-rust-lang-meetup-12024"></a></p>
<p dir="auto">Slides:
<a href="https://docs.google.com/presentation/d/1PRinuW2Zbw9c-FGArON3YHiCUP22qIeTpYvDRNbP5vc/edit?usp=drive_link" rel="nofollow">Google Drive</a></p>
<p dir="auto">Presented at the Finland Rust-lang group's January meetup, 2024. Focus on how
JavaScript engines work in general, and what sort of design choices Nova makes
in this context.</p>
<p dir="auto"><h3 tabindex="-1" dir="auto"><a href="https://www.youtube.com/watch?v=5olgPdqKZ84" rel="nofollow">Nova JavaScript Engine - Exploring a Data-Oriented Engine Design @ Web Engines Hackfest 2024</a></h3><a id="user-content-nova-javascript-engine---exploring-a-data-oriented-engine-design--web-engines-hackfest-2024" aria-label="Permalink: Nova JavaScript Engine - Exploring a Data-Oriented Engine Design @ Web Engines Hackfest 2024" href="#nova-javascript-engine---exploring-a-data-oriented-engine-design--web-engines-hackfest-2024"></a></p>
<p dir="auto">Slides:
<a href="https://docs.google.com/presentation/d/1YlHr67ZYCyMp_6uMMvCWOJNOUhleUtxOPlC0Gz8Bg7o/edit?usp=drive_link" rel="nofollow">Google Drive</a></p>
<p dir="auto">Presented at the Web Engines Hackfest, 2024. Focus on the details of why a
data-oriented engine design is interesting, what sort of benefits it gives and
what sort of costs it has. Explores the engine at a slightly deeper level.</p>
<p dir="auto">The talk was revisited at the TC39 June meeting, 2024. No video is available,
but the slightly modified slides are.</p>
<p dir="auto">TC39 slides:
<a href="https://docs.google.com/presentation/d/1Pv6Yn2sUWFIvlLwX9ViCjuyflsVdpEPQBbVlLJnFubM/edit?usp=drive_link" rel="nofollow">Google Drive</a></p>
<p dir="auto"><h2 tabindex="-1" dir="auto"><a href="https://github.com/trynova/nova/blob/main/ARCHITECTURE.md">Architecture</a></h2><a id="user-content-architecture" aria-label="Permalink: Architecture" href="#architecture"></a></p>
<p dir="auto">The architecture of the engine follows the ECMAScript specification in spirit,
but uses data-oriented design for the actual implementation. Records that are
present in the specification are likely present in the Nova engine as well and
they're likely found in an "equivalent" file / folder path as the specification
defines them in.</p>
<p dir="auto">Where the engine differs from the specification is that most ECMAScript types
and specification Record types are defined "twice": They have one "heap data"
definition, and another "index" definition. The heap data definition generally
corresponds to the specification's definition, in some degree at least. The
index definition is either a wrapper around <code>u32</code> or a <code>NonZeroU32</code>. Most spec
defined methods are defined on the index definitions (this avoids issues with
borrowing).</p>
<p dir="auto">The only case when direct "Record type A contains Record type B" ownership is
used is when there can be only one referrer to the Record type B.</p>
<p dir="auto"><h3 tabindex="-1" dir="auto">Heap structure - Data-oriented design</h3><a id="user-content-heap-structure---data-oriented-design" aria-label="Permalink: Heap structure - Data-oriented design" href="#heap-structure---data-oriented-design"></a></p>
<p dir="auto">Reading the above, you might be wondering why the double-definitions and all
that. The ultimate reason is two-fold:</p>
<ol dir="auto">
<li>It is an interesting design.</li>
<li>It helps the computer make frequently used things fast while allowing the
infrequently used things to become slow.</li>
</ol>
<p dir="auto">Data-oriented design is all the rage on the Internet because of its
cache-friendliness. This engine is one more attempt at seeing what sort of
real-world benefits one might gain with this sort of architecture.</p>
<p dir="auto">If you find yourself interested in where the idea spawns from and why, take a
look at <a href="https://github.com/trynova/nova/blob/main/nova_vm/src/heap/README.md">the Heap README.md</a>. It gives a more
thorough walkthrough of the Heap structure and what the idea there is.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto"><a href="https://github.com/trynova/nova/blob/main/CONTRIBUTING.md">Contributing</a></h2><a id="user-content-contributing" aria-label="Permalink: Contributing" href="#contributing"></a></p>
<p dir="auto">So you wish to contribute, eh? You're very welcome to do so! Please take a look
at <a href="https://github.com/trynova/nova/blob/main/CONTRIBUTING.md">the CONTRIBUTING.md</a>.</p>
</article></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Reverse Engineering iOS 18 Inactivity Reboot (432 pts)]]></title>
            <link>https://naehrdine.blogspot.com/2024/11/reverse-engineering-ios-18-inactivity.html</link>
            <guid>42167633</guid>
            <pubDate>Sun, 17 Nov 2024 21:50:26 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://naehrdine.blogspot.com/2024/11/reverse-engineering-ios-18-inactivity.html">https://naehrdine.blogspot.com/2024/11/reverse-engineering-ios-18-inactivity.html</a>, See on <a href="https://news.ycombinator.com/item?id=42167633">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="post-body-3312850032502776883">
<p>iOS 18 introduced a new inactivity reboot security feature. What does it protect from and how does it work? This blog post covers all the details down to a kernel extension and the Secure Enclave Processor.</p><h2>Security Before First Unlock / After First Unlock</h2><p>Did you know that entering your passcode for the first time after your phone starts is something very different then entering it later on to unlock your phone?</p><p>When initially entering your passcode, this unlocks a key store in the Secure Enclave Processor (SEP) that encrypts your data on an iPhone.</p><p>The state before entering your passcode for the first time is also called <b>Before First Unlock</b> (BFU). Due to the encrypted user data, your iPhone behaves slightly differently to later unlocks. You'll see that Face ID and Touch ID won't work and that the passcode is required. But there's more subtle things you might notice: Since Wi-Fi passwords are encrypted, your iPhone won't connect to Wi-Fi networks. If your SIM is not PIN-protected, your iPhone will still connect to cellular networks. That means, technically, you can still receive phone calls. Yet, if you receive a call, even if that number is in your contacts, the contact name won't be shown, as the contacts haven't been decrypted yet. Similarly, when you receive notifications about new messages, you'll see that you got messages, but you won't see any message previews. You can easily try this yourself!</p><p><a href="https://blogger.googleusercontent.com/img/a/AVvXsEihQqOut8zLHRxuz_g8ornTF1A-X69IoWpX8lZPnZBisvc1t80zBRGebsCj4x4Vz_6C_i_ImG5AszaaQ-rXnFEJeB1-Dfaj4bSBwajxyKLYoKQNdJ8dZZtaqhexYUc1rZL7w_6yXkMj5APTe30fHOMRlg3da55UCxSZhmTFRLWmBEh_iWVgPSyKuVCEQ_48"><img alt="" data-original-height="3936" data-original-width="7142" height="352" src="https://blogger.googleusercontent.com/img/a/AVvXsEihQqOut8zLHRxuz_g8ornTF1A-X69IoWpX8lZPnZBisvc1t80zBRGebsCj4x4Vz_6C_i_ImG5AszaaQ-rXnFEJeB1-Dfaj4bSBwajxyKLYoKQNdJ8dZZtaqhexYUc1rZL7w_6yXkMj5APTe30fHOMRlg3da55UCxSZhmTFRLWmBEh_iWVgPSyKuVCEQ_48=w640-h352" width="640"></a></p><p>In the <b>After First Unlock</b> (AFU) state, user data is decrypted. You can imagine this like a key safe that is kept open while iOS is running. Even when you see a lock screen, certain keys remain available to the operating system. This way, you stay connected to Wi-Fi networks and receive message notification previews, even when your iPhone is locked.</p><p>While it's more convenient, the AFU state is more susceptible to attacks. An attacker who can somehow bypass the lock screen can get access to decrypted data on the iPhone. To bypass the lock screen, an attacker does not necessarily need to know the passcode. Security vulnerabilities within iOS can allow attackers to get code execution and extract from an iPhone, even while it appears to be "locked".</p><p>Attackers with physical access to an iPhone have more security vulnerabilities to choose from. The attack surface is larger, as such attackers can exploit vulnerabilities in the USB stack or within wireless protocols, such as Wi-Fi, Bluetooth, or cellular, or even more invasive hardware attacks that involve opening the device. This larger attack surface tends to make exploits for these vulnerabilities cheaper on the gray market, as there's potentially more supply. Another factor that makes attacks cheaper is time – vulnerabilities that are publicly known by the vendor and patched in more recent software versions won't unlock new iPhones, but can unlock iPhones that were kept in AFU state for a long time that didn't get any software updates.</p><h2>Rumors about Rebooting iPhones</h2><p>In law enforcement scenarios, a lot of the forensically relevant data is available in the AFU state. Law enforcement takes advantage of this and often keeps seized iPhones powered on, but isolated from the Internet, until they can extract data. This time might be necessary to wait for an exploit to be available or for legal reasons, such as getting a warrant.</p><p>However, thieves and other criminals are also interested in getting this kind of access after stealing a device. It gives them access to bank accounts and other valuable information, by far exceeding what the iPhone itself would be worth, or which might be used for blackmail. People reuse their passwords often, and getting access to the iCloud account may allow a thief to reset activation lock for the device, increasing the resale value.</p><p>A recent&nbsp;<a href="https://www.404media.co/police-freak-out-at-iphones-mysteriously-rebooting-themselves-locking-cops-out/">news article by 404 media</a>&nbsp;(while paywalled, the most important information is also contained in the related&nbsp;<a href="https://x.com/josephfcox/status/1854615490087551327">Tweet</a>)&nbsp;reported on a law enforcement document about suspicious iPhone reboots. This document makes two interesting claims:</p><ol><li>iPhones on iOS 18 will reboot, even when completely isolated from wireless networks.</li><li>iPhones on iOS 18 will tell other iPhones on lower iOS versions to reboot – wirelessly!</li></ol><p>Especially the second claim would be huge if true. If anyone figured out how this works, they could build a large TV-Be-Gone for iPhones, forcing reboots over the air on hundreds of iPhones simultaneously. Would Apple really build such a feature into an iPhone?</p><p>Knowing a thing or two about the Apple wireless ecosystem, my interest was piqued, and I had to go down the rabbit hole!</p><h2>Discovery of Inactivity Reboot</h2><p>When Apple adds new features, they usually don't hide this very well. Apple software contains a lot of debug strings, which hint at new functionality. Blacktop maintains a <a href="https://github.com/blacktop/ipsw-diffs">git repository</a> of strings found in iOS, which keeps a nice version history. I decided to do the most low-effort thing I could think of: just search for "reboot".</p><div><p><a href="https://blogger.googleusercontent.com/img/a/AVvXsEi4XBZbJShDJ9GPps2OujHTkV_KZn-KcijaJX34M5GsyKk_TMRsUrYkxkft2LiAMa8V62VKXagqP5Q2lQntBlRo9lobsf-7qo39M-DzpWwGgfOioKq8LQs8xAnKIRNrC0b9RlA4FZWYQg4Q1yvcILbr_Lp_Nm0ULdRG9l13_sSB1R5JIP7eYJzYwy9QAwU2"><img alt="" data-original-height="1544" data-original-width="3000" height="330" src="https://blogger.googleusercontent.com/img/a/AVvXsEi4XBZbJShDJ9GPps2OujHTkV_KZn-KcijaJX34M5GsyKk_TMRsUrYkxkft2LiAMa8V62VKXagqP5Q2lQntBlRo9lobsf-7qo39M-DzpWwGgfOioKq8LQs8xAnKIRNrC0b9RlA4FZWYQg4Q1yvcILbr_Lp_Nm0ULdRG9l13_sSB1R5JIP7eYJzYwy9QAwU2=w640-h330" width="640"></a></p><br></div><p>Bingo, that third hit looks good: "inactivity_reboot". The fact that it's in <span>keybagd</span> is interesting: this daemon is related to the key store that is unlocked on the first unlock.</p><p>A second search for only inactivity reboot shows the string starts occurring in iOS 18.1 and iOS 18.2. In iOS 18.2, the string changed from "inactivity_reboot" to "inactivity_reboot_enabled", hinting towards more potential changes in the latest iOS 18.2 betas.</p><p><a href="https://blogger.googleusercontent.com/img/a/AVvXsEgBjM82vk9aCJNzlk-9gbRKwc9y83Z9g9WZsPDUQXxB4oYXsuA-QntGrp4pMalJFUPFqETW0fxy3IfCrlziX946r_ymJ8G0a-mtIkFEzp1DoXPRcq9RUi1KOOtjgK8XfRJJcghzLLgNsM7JfvByjxqfWz2JqHPGEEkXpttCbMvdoCW7FPrfDU-psLHbdgD-"><img alt="" data-original-height="1194" data-original-width="2334" height="328" src="https://blogger.googleusercontent.com/img/a/AVvXsEgBjM82vk9aCJNzlk-9gbRKwc9y83Z9g9WZsPDUQXxB4oYXsuA-QntGrp4pMalJFUPFqETW0fxy3IfCrlziX946r_ymJ8G0a-mtIkFEzp1DoXPRcq9RUi1KOOtjgK8XfRJJcghzLLgNsM7JfvByjxqfWz2JqHPGEEkXpttCbMvdoCW7FPrfDU-psLHbdgD-=w640-h328" width="640"></a></p><p>Something that was still unclear to me at that point is: How long does it take for inactivity reboot to be triggered? A new&nbsp;<a href="https://www.404media.co/apple-quietly-introduced-iphone-reboot-code-which-is-locking-out-cops/">article by 404 media</a>&nbsp;claimed that it was 3-4 days. So I updated my SRD to the latest beta and made a time lapse.</p><p><iframe allowfullscreen="" height="266" src="https://www.youtube.com/embed/QOe2rDKOWMk" width="320" youtube-src-id="QOe2rDKOWMk"></iframe></p><p>Turns out, the inactivity reboot triggers exactly after 3 days (72 hours). The iPhone would do so despite being connected to Wi-Fi. This confirms my suspicion that this feature had nothing to do with wireless connectivity.</p><h2>Reverse Engineering Inactivity Reboot</h2><p>Let's reverse engineer what's changed! Which security guarantees does it provide?</p><p>Here is a high-level overview of what I found:</p><ul><li>The Secure Enclave Processor (SEP) keeps track on when your phone was last unlocked. If that last unlock time exceeds 3 days, the SEP tells the <span>AppleSEPKeyStore</span> kernel module that the time was exceeded.</li><li>The <span>AppleSEPKeyStore</span> kernel module informs user space to initiate a reboot. <span>SpringBoard</span> will then gracefully terminate all user-space processes. This prevents potential data loss upon reboot.</li><li>If the <span>AppleSEPKeyStore</span> kernel module finds the iPhone to still be powered on after it should have rebooted, the kernel will panic. This case should never happen, unless someone tries to tamper with inactivity reboot.</li><li>The <span>AppleSEPKeyStore</span> kernel module writes an NVRAM variable <span>aks-inactivity</span>. After the iPhone rebooted, <span>keybagd</span> reads this variable and, if set, sends an analytics event to Apple including how long the iPhone was not unlocked.</li></ul><p>The remainder of this post shows how I figured this out and what security implications the underlying design has.</p><h2>Indicators in Sysdiagnose</h2><p>From my search in ipsw-diffs, I knew there were some log messages that are printed on reboot. At the same time as I started looking them statically, I knew I had to see them actually logged for myself.</p><p>After my phone rebooted after three days, I took a sysdiagnose and searched for these messages. When doing this yourself, make sure that you unlocked the device before making the sysdiagnose. Otherwise, events from before the reboot will be missing.</p><p>In the&nbsp;<span>AppleSEPKeyStore</span>&nbsp;messages, there are the following entries around the inactivity reboot:</p><p><span>default</span><span>	</span><span>2024-11-17 01:35:14.341697 +0100</span><span>	</span><span>kernel</span><span>	</span><span>"AppleSEPKeyStore":3846:0: <span>notifying user space of inactivity reboot</span><br></span><span>default</span><span>	</span><span>2024-11-17 01:35:14.341766 +0100</span><span>	</span><span>kernel</span><span>	</span><span>"AppleSEPKeyStore":12598:31: operation failed (sel: 35 ret: e00002f0)<br></span><span>default</span><span>	</span><span>2024-11-17 01:35:14.342053 +0100</span><span>	</span><span>kernel</span><span>	</span><span>"AppleSEPKeyStore":12598:31: operation failed (sel: 35 ret: e00002f0)<br></span><span>default</span><span>	</span><span>2024-11-17 01:35:34.958218<br></span><span><span>[reboot occurs]</span><br>+0100</span><span>	</span><span>kernel</span><span>	</span><span>"AppleSEPKeyStore":331:0: starting (BUILT: Oct 26 2024 08:16:35) ("normal" variant 🌽 , 1827.60.43)<br></span><span>default</span><span>	</span><span>2024-11-17 01:35:34.958381 +0100</span><span>	</span><span>kernel</span><span>	</span><span>"AppleSEPKeyStore":476:0: _sep_enabled = 1</span></p><p>For more context, these are the unfiltered log messages before the reboot is initiated:</p><p><a href="https://blogger.googleusercontent.com/img/a/AVvXsEjh3CycIuHLRgh46JB32Vr3WAFbEPzGzusiH_hWUUO248aoq27ntRBvDJuUhwVzF2O1p3BIYYhHoYam1IssPyBeI581bGm7frA4yFzIFA8gWerWJyuHfxDhRstUeo9eUcjG0xHcYoFeFi0S67dtuFRezYoJsz3ZMuhL5nce9o6jE7pH_Qb7tSedUNY0TxDn"><img alt="" data-original-height="1848" data-original-width="2518" height="470" src="https://blogger.googleusercontent.com/img/a/AVvXsEjh3CycIuHLRgh46JB32Vr3WAFbEPzGzusiH_hWUUO248aoq27ntRBvDJuUhwVzF2O1p3BIYYhHoYam1IssPyBeI581bGm7frA4yFzIFA8gWerWJyuHfxDhRstUeo9eUcjG0xHcYoFeFi0S67dtuFRezYoJsz3ZMuhL5nce9o6jE7pH_Qb7tSedUNY0TxDn=w640-h470" width="640"></a></p><h2>Reverse Engineering the <span>SEPKeyStore</span> Kernel Extension</h2><p>The latest iOS kernel can be downloaded using the following <a href="https://github.com/blacktop/ipsw"><span>ipsw</span></a> command:</p><p><span>ipsw download appledb --device iPhone17,3 --os iOS --version '18.2 beta 2' --kernel</span></p><p>This will download and decompress the kernel. For further analysis, I loaded the whole kernel cache into Binary Ninja. <span>ipsw</span> also supports splitting the kernel into its modules (called "extensions" on iOS). The latest version of Ghidra also has decent support for the iOS kernel. So there's a lot of tools to choose from for this analysis.</p><p>I also downloaded an older kernel where Apple accidentally included symbols and manually diffed these versions with a focus on the code related to inactivity reboot. The kernel has three strings relating to the feature:</p><p><a href="https://blogger.googleusercontent.com/img/a/AVvXsEh0ZxgYUnJU1elCjWJXqzi-qkQEehkAKd3dkIH4UAUmxk6dwL3iiZ2LFlo3IvYug9d_qFuuiV6AnibEN8o8cEN-76IfazheZdPhIkm88ZYS59KADrKHJcup3X1mwGQ-9BCkdOJt7L83mSLBSAiayIIxM4AXVjMtAKRHwYaccHqKMeYAejLtvi9TGxkrY0Xl"><img data-original-height="356" data-original-width="1386" height="164" src="https://blogger.googleusercontent.com/img/a/AVvXsEh0ZxgYUnJU1elCjWJXqzi-qkQEehkAKd3dkIH4UAUmxk6dwL3iiZ2LFlo3IvYug9d_qFuuiV6AnibEN8o8cEN-76IfazheZdPhIkm88ZYS59KADrKHJcup3X1mwGQ-9BCkdOJt7L83mSLBSAiayIIxM4AXVjMtAKRHwYaccHqKMeYAejLtvi9TGxkrY0Xl=w640-h164" width="640"></a></p><p>"notifying user space of inactivity reboot" is the string we already know from the sysdiagnose. It belongs to the function <span>AppleKeyStore::handle_events</span>, which polls for SEP events in the background. The following screenshot shows it in more context after reverse engineering and some renaming of functions.</p><p><a href="https://blogger.googleusercontent.com/img/a/AVvXsEhqa9iNrqdm95LKnxB9k2Nbw9Pp2lDkiYg6NVgZW3PFiO_0DntNVYm6QRwV-0Er5puxU_Y7m3kS1zEbuxcU1IGOOTU8ZKwZsfmLEPiZy_XJb1KWi1_dQAI7_iaV7pmymZS0NtE2CLVTfH0Km5pfKeETc27gLtKDgPXAgKmwZEQESfk0No_7H-CEqVZ5U33e"><img alt="" data-original-height="1936" data-original-width="3024" height="410" src="https://blogger.googleusercontent.com/img/a/AVvXsEhqa9iNrqdm95LKnxB9k2Nbw9Pp2lDkiYg6NVgZW3PFiO_0DntNVYm6QRwV-0Er5puxU_Y7m3kS1zEbuxcU1IGOOTU8ZKwZsfmLEPiZy_XJb1KWi1_dQAI7_iaV7pmymZS0NtE2CLVTfH0Km5pfKeETc27gLtKDgPXAgKmwZEQESfk0No_7H-CEqVZ5U33e=w640-h410" width="640"></a></p><p>The first string, "max inactivity window expired, failed to reboot the device", is the kernel panic in case that the iPhone failed to reboot.</p><p><a href="https://blogger.googleusercontent.com/img/a/AVvXsEgKeMPdV7mTxwu4QbCAEk4DnF6wdxUtpApFTkmHV7aYJjkkyVz4BdCN5tuFIJ5FsfvYqhjbDtdGic19Rt5cHbdoZ6S5Jl_lCTd7JhkuG8IzWCyg5h0WgXNKYa3xuaqlTOwuoG7SoATovv-m6nXthdMMaIpWeQ90xCh1IrqfzQorVcuFuH7TPuop6A6ysjBS"><img alt="" data-original-height="166" data-original-width="1338" height="80" src="https://blogger.googleusercontent.com/img/a/AVvXsEgKeMPdV7mTxwu4QbCAEk4DnF6wdxUtpApFTkmHV7aYJjkkyVz4BdCN5tuFIJ5FsfvYqhjbDtdGic19Rt5cHbdoZ6S5Jl_lCTd7JhkuG8IzWCyg5h0WgXNKYa3xuaqlTOwuoG7SoATovv-m6nXthdMMaIpWeQ90xCh1IrqfzQorVcuFuH7TPuop6A6ysjBS=w640-h80" width="640"></a></p><p>For more context, the panic is called by the function&nbsp;<span>AppleKeyStore::handle_device_state_return</span>. There are multiple paths that invoke this handler through many layers of abstraction, which have to do with the UserClient but also SEP states.</p><p><a href="https://blogger.googleusercontent.com/img/a/AVvXsEgi_v0P9i541Jg-d9THXz-ka-CvldLwbzLqWkCDFt6rEuKszDs8BQFtfhbYU2sXAqeOkMKkCrG47wShd3bzw-PurLLi766x86d1d3K_7T6oP_7R6y6bhBmCfAnKPnyuQLRVqlxjOaiJPkXl1UW0Yg5asqovDlzSJVqJdsks2pfF0oDKTw55nKSZ6EAq90yO"><img alt="" data-original-height="1584" data-original-width="1886" height="537" src="https://blogger.googleusercontent.com/img/a/AVvXsEgi_v0P9i541Jg-d9THXz-ka-CvldLwbzLqWkCDFt6rEuKszDs8BQFtfhbYU2sXAqeOkMKkCrG47wShd3bzw-PurLLi766x86d1d3K_7T6oP_7R6y6bhBmCfAnKPnyuQLRVqlxjOaiJPkXl1UW0Yg5asqovDlzSJVqJdsks2pfF0oDKTw55nKSZ6EAq90yO=w640-h537" width="640"></a></p><p>With the <a href="https://github.com/elbiazo/calltree">calltree plugin</a>, we can see all the incoming calls to this function.</p><p><a href="https://blogger.googleusercontent.com/img/a/AVvXsEjfKMpgWgr5MpdI1gKiXgnP860eGS0w4h7DqW8nWfOX5D2I8WiUPGHIGjfFeDOwJ_zKqjjv59fIAdeZQNQ-OPCzdNTM08N12sMg2Cg4M042iaWFkkgYlYeUsfk7njj6QwChF61fnDebQbbbDx1u6QKj33-cJnAqNBLo4f8LL68GNiodwTMwEfuptfnsadrL"><img alt="" data-original-height="660" data-original-width="1054" height="400" src="https://blogger.googleusercontent.com/img/a/AVvXsEjfKMpgWgr5MpdI1gKiXgnP860eGS0w4h7DqW8nWfOX5D2I8WiUPGHIGjfFeDOwJ_zKqjjv59fIAdeZQNQ-OPCzdNTM08N12sMg2Cg4M042iaWFkkgYlYeUsfk7njj6QwChF61fnDebQbbbDx1u6QKj33-cJnAqNBLo4f8LL68GNiodwTMwEfuptfnsadrL=w640-h400" width="640"></a></p><p>Now to the last string, "aks-inactivity". We can see that this is a property that is set in the IORegistry.</p><p><a href="https://blogger.googleusercontent.com/img/a/AVvXsEh3-JpRsuVcoQvKveSUKY47zOeJl3FVm3VAvtmG17u_f_wdfYYvQaS3JXA7kIAequNfdiQ9s-tSHQrOAtlRdVoPmJD1lJ2K5RZExe5vNgHNMZsv_JPgY5k-RflZTVqnC1-_FdZCmn6EZnE_fPiIWTIYPMKPh_oN_EkQP5YEk9eE1i-x-Wy-_YCEC9GvNus5"><img alt="" data-original-height="1000" data-original-width="2948" height="218" src="https://blogger.googleusercontent.com/img/a/AVvXsEh3-JpRsuVcoQvKveSUKY47zOeJl3FVm3VAvtmG17u_f_wdfYYvQaS3JXA7kIAequNfdiQ9s-tSHQrOAtlRdVoPmJD1lJ2K5RZExe5vNgHNMZsv_JPgY5k-RflZTVqnC1-_FdZCmn6EZnE_fPiIWTIYPMKPh_oN_EkQP5YEk9eE1i-x-Wy-_YCEC9GvNus5=w640-h218" width="640"></a></p><p>Its counterpart is in <span>keybagd</span> in user space. When <span>keybagd</span> is initialized, it checks for this variable, issues an analytics event, and then deletes it. This analytics event probably helps Apple optimize the time window, but we can ignore it for the core functionality.</p><p><a href="https://blogger.googleusercontent.com/img/a/AVvXsEiDi2dNE_vIsKY6UD2LhnRy31qXgNMeBdWA-Bk52lQV7aK6VWZqxudXe0wJRPDHV4rPDxi44CUOyKQpm7-Yks93eATITRqqbSkOME6xM9o7W7N1NYKsBBP65yS97cKtq6TLP6ChFQxF1gFg-NK84_q0lCXOubU1ZNr9-XIxdEKjE9dc3QwXRKe31KJ9j5oH"><img alt="" data-original-height="804" data-original-width="1692" height="304" src="https://blogger.googleusercontent.com/img/a/AVvXsEiDi2dNE_vIsKY6UD2LhnRy31qXgNMeBdWA-Bk52lQV7aK6VWZqxudXe0wJRPDHV4rPDxi44CUOyKQpm7-Yks93eATITRqqbSkOME6xM9o7W7N1NYKsBBP65yS97cKtq6TLP6ChFQxF1gFg-NK84_q0lCXOubU1ZNr9-XIxdEKjE9dc3QwXRKe31KJ9j5oH=w640-h304" width="640"></a></p><p>Something that I couldn't find in the kernel, even with the knowledge that it was 72 hours, was this particular time window. I couldn't find any numbers that matched 72 hours. So how does the phone know when to reboot?</p><p>While there are some references to time-related functionality in the <span>SEPKeyStore</span> kernel extension, none of these compare a value to 72 hours. These references were quite simple to find and did not differ much from the older kernel version without inactivity reboot, so it doesn't seem like the functionality was added here.</p><div><p><a href="https://blogger.googleusercontent.com/img/a/AVvXsEitDjU-0SbfmaNcNosZlWHx0dTUnfmIjSVxTW_xA1bgEVwSmgp_uob_P62GyCveo8CdmN7MwQ8rX_J1qI1U4KMTPxgUigfGwgRYlWzvkmhoqepnpr-KkBDhQ2WakbMxs_YGsuiOIMVoXq19cu4TEzqBHHxwQEMJrR1xAVTF0LRk6_2-W9L_m4k7LvDJw9Bb"><img alt="" data-original-height="936" data-original-width="1610" height="372" src="https://blogger.googleusercontent.com/img/a/AVvXsEitDjU-0SbfmaNcNosZlWHx0dTUnfmIjSVxTW_xA1bgEVwSmgp_uob_P62GyCveo8CdmN7MwQ8rX_J1qI1U4KMTPxgUigfGwgRYlWzvkmhoqepnpr-KkBDhQ2WakbMxs_YGsuiOIMVoXq19cu4TEzqBHHxwQEMJrR1xAVTF0LRk6_2-W9L_m4k7LvDJw9Bb=w640-h372" width="640"></a></p><p>However, the <span>SEPKeyStore</span> communicates with the SEP co-processor. In the functions I identified, reboots are related to some SEP states. Could it be the SEP itself that checks the time?</p><h2>Reverse Engineering the Secure Enclave Processor</h2><p>The SEP is one of Apple's most protected secrets. In contrast to most other firmware on the iPhone, the firmware for the SEP is encrypted.</p><p>Luckily for us, <a href="https://twitter.com/nyan_satan">@nyan_satan</a> recently leaked <a href="https://theapplewiki.com/wiki/Keys:CrystalBSeed_22B5069a_(iPhone16,1)">SEP firmware encryption keys for iOS 18.1 beta 6</a>, just eta wen Apple introduced inactivity reboot. (Thank you!! 🎉 And Apple, if you're reading this, why not ship the SEP unencrypted?) Using <span>ipsw</span>, we can download the SEP firmware as follows:</p><p><span>ipsw download appledb --device iPhone16,1 --os iOS --version '18.1 beta 6' --pattern "sep-firmware.d83.RELEASE.im4p"</span></p><p>With the leaked keys, we can decrypt the firmware:</p><p><span>pyimg4 im4p extract --iv 6705fb216080e19667dbcf71f532ae73 --key 4ea9db4c2e63a316a6854c83e2f5c81fd102ad40160b8998b5f9b16838b7116e -i sep-firmware.d83.RELEASE.im4p -o sep-firmware.d83.RELEASE.im4p.e</span></p><p>Loading this into Binary Ninja is a bit tricky. We can guess that the architecture is 64-bit ARM little endian. But there's no metadata where the firmware has to be loaded to. Being lazy and not wanting to spend time on writing a firmware loader, I used Binary Ninja's Triage feature to auto-detect the most likely address. Note that the firmware seems to have multiple fragments and there's multiple potential load addresses. I picked&nbsp;0x80090000ffc80000, which worked well for me.</p><p><a href="https://blogger.googleusercontent.com/img/a/AVvXsEguwmjRE1k8u5npWzXhq5cs8lRMkyQqgECTzTuq_zaLuWDr5J8AyZtKkN64XixVpkczXFfSsQknPPclpjICoz7GrfRWBINwETutIXB-RF45-vlem8PavZPTyOTK4k6BmjTyY2l7xcTbmC1g6gooiaAe9DtqaiGavX0ajfnofIghAADa8xtmsLPe7bMNN-cW"><img alt="" data-original-height="580" data-original-width="514" height="400" src="https://blogger.googleusercontent.com/img/a/AVvXsEguwmjRE1k8u5npWzXhq5cs8lRMkyQqgECTzTuq_zaLuWDr5J8AyZtKkN64XixVpkczXFfSsQknPPclpjICoz7GrfRWBINwETutIXB-RF45-vlem8PavZPTyOTK4k6BmjTyY2l7xcTbmC1g6gooiaAe9DtqaiGavX0ajfnofIghAADa8xtmsLPe7bMNN-cW=w355-h400" width="355"></a><span>&nbsp;</span></p><p>There's only little known about the SEP. The best information I could come up with is a <a href="https://www.blackhat.com/docs/us-16/materials/us-16-Mandt-Demystifying-The-Secure-Enclave-Processor.pdf">presentation dating back to 2016</a> – but that's better than nothing! What's good to know is that the SEP firmware is structured into apps, so I'm guessing the other base addresses the triage found may correspond to the other apps' address spaces. The app that communicates with the SEPKeyStore is called <span>sks</span> (see slide 86 of the presentation). Not a lot of information, but enough to start reverse engineering!</p><p>Looking at strings, it looks like the architecture of apps running inside the SEP hasn't changed much since 2016. The <span>SEPKeyStore</span>-related app is still called <span>sks</span>:</p><p><a href="https://blogger.googleusercontent.com/img/a/AVvXsEhfPY-EilBBTqlkWuLpWvFXx3bok5syhn8KZO15LWApKKMIN2wgcAMK-znjMMpk5Kv3xq0uVQOBI8UK4Ld8QpEmDQGCOpEq4shM1Td8ywQ3xHmdjl8Fi7lrCYg7iWTsGxY5fA-GcTTk-3z6Z4qb4FCGZ7AE1Lbcxy_KHPQ9-blxMVrSjLRtSUNdZxk8iluZ"><img alt="" data-original-height="436" data-original-width="1248" height="224" src="https://blogger.googleusercontent.com/img/a/AVvXsEhfPY-EilBBTqlkWuLpWvFXx3bok5syhn8KZO15LWApKKMIN2wgcAMK-znjMMpk5Kv3xq0uVQOBI8UK4Ld8QpEmDQGCOpEq4shM1Td8ywQ3xHmdjl8Fi7lrCYg7iWTsGxY5fA-GcTTk-3z6Z4qb4FCGZ7AE1Lbcxy_KHPQ9-blxMVrSjLRtSUNdZxk8iluZ=w640-h224" width="640"></a></p><p>The SEP has almost no debug strings, making it tougher to reverse engineer. Here is what the initialization function for the <span>SEPKeyStore</span> looks like after some manual annotations ("sth" stands for "something" – I didn't go too deep into understanding the specifics here):</p><p><a href="https://blogger.googleusercontent.com/img/a/AVvXsEhPrpu1jil4mrXVyRP1LvrLjsTVNQ2jC3QHXLJGZaSZ8oAFgGC97jZf0T00HGkzTiANO1MlZA6KSoUmiDzhEkx0Zk0GQcYD6MCAa1RuX9cJnQNBFWblQ_k5j0ZqBUltQ1B2Wfks6vmIcHu6MsDrJmmtw270W3SQ9bBTTcXai7Sc4g3Y6Uj-3PJQP71Z9zbE"><img alt="" data-original-height="458" data-original-width="1614" height="182" src="https://blogger.googleusercontent.com/img/a/AVvXsEhPrpu1jil4mrXVyRP1LvrLjsTVNQ2jC3QHXLJGZaSZ8oAFgGC97jZf0T00HGkzTiANO1MlZA6KSoUmiDzhEkx0Zk0GQcYD6MCAa1RuX9cJnQNBFWblQ_k5j0ZqBUltQ1B2Wfks6vmIcHu6MsDrJmmtw270W3SQ9bBTTcXai7Sc4g3Y6Uj-3PJQP71Z9zbE=w640-h182" width="640"></a></p><p>Within its main function, we can find multiple other functions executed before a service workloop starts. However, there's plenty of code. How do we focus on things that are related to the inactivity reboot?</p><p>Let's recall that we're looking for something that resembles 72 hours. In the kernel, times are usually measured in seconds or in microseconds. For example 72 hours are&nbsp;259200 seconds (0x3f480). But looking for this value (or for 259200000000, in microseconds, or any other sensible units) in the binary won't return any matches.</p><p>Using the <a href="https://godbolt.org/">compiler explorer</a>, we can see why: Optimizations...</p><p><a href="https://blogger.googleusercontent.com/img/a/AVvXsEjiVp3eTE2aXqnNiZMIJu7uRjTEpEahpDlVxzexq0iVsFmD01Ux8xTq8OUcNECXwZ099DnhfdpBvb_ztjNnzHlQ6XV9nbIOOYmabejFVA-D3Iq-cAt_nK2IktXQ7I0XF-6xONp4MgNgcjsCa1_mRTAiJ0WgeKRiac-QQpo8SBthBPDV3aK2UrLwNS7nUtRk"><img alt="" data-original-height="1062" data-original-width="3024" height="225" src="https://blogger.googleusercontent.com/img/a/AVvXsEjiVp3eTE2aXqnNiZMIJu7uRjTEpEahpDlVxzexq0iVsFmD01Ux8xTq8OUcNECXwZ099DnhfdpBvb_ztjNnzHlQ6XV9nbIOOYmabejFVA-D3Iq-cAt_nK2IktXQ7I0XF-6xONp4MgNgcjsCa1_mRTAiJ0WgeKRiac-QQpo8SBthBPDV3aK2UrLwNS7nUtRk" width="640"></a></p><p>Rather than looking the full time in bytes in reverse byte order, we're looking for assembly instructions that load parts of the timespan into a register.</p><p>Binary Ninja knows how to reverse this optimization, and allows us to search in its intermediate representations, instead of looking for raw bytes. In our case, we know that we're looking for a constant.</p><div><p><a href="https://blogger.googleusercontent.com/img/a/AVvXsEiAksVrxNBr5xGLwoRNEbxzVIMoOMMapRcHKVGaB_R_O3AWmrvNcMwINtPo1zaXnlNxbv0tV8EWXAg0jnHgskU22-Ui71tPAFkaoXud_POuCAdbcoAwPg8HNbjfeo6qYKmsaM9IlQR6muWihOSzBzauHF4PitCFVl-DfjRt6RUUZrBEPLU3Gu2WEusxU8hE"><img alt="" data-original-height="808" data-original-width="1100" height="294" src="https://blogger.googleusercontent.com/img/a/AVvXsEiAksVrxNBr5xGLwoRNEbxzVIMoOMMapRcHKVGaB_R_O3AWmrvNcMwINtPo1zaXnlNxbv0tV8EWXAg0jnHgskU22-Ui71tPAFkaoXud_POuCAdbcoAwPg8HNbjfeo6qYKmsaM9IlQR6muWihOSzBzauHF4PitCFVl-DfjRt6RUUZrBEPLU3Gu2WEusxU8hE=w400-h294" width="400"></a>&nbsp;</p></div><p>We find only two matches:</p><p><a href="https://blogger.googleusercontent.com/img/a/AVvXsEhJwjCy5EDHg2kK4t-h4GW_KqEKu7X_1d-jfbjm1LeYIMKF_YEA4oAZaWK20ZujWctbqOhXaseMbH1DvWp6H-O4flgmN419gJorpk653jeG90Jr540JGOV92Up4e7jyUq9CW1X2VPhFEncwOT-qWzB0ZFm6BN3vLcA01fZVH6WR9jJ5ywFRevYjyFVX4g5c"><img alt="" data-original-height="250" data-original-width="1632" height="98" src="https://blogger.googleusercontent.com/img/a/AVvXsEhJwjCy5EDHg2kK4t-h4GW_KqEKu7X_1d-jfbjm1LeYIMKF_YEA4oAZaWK20ZujWctbqOhXaseMbH1DvWp6H-O4flgmN419gJorpk653jeG90Jr540JGOV92Up4e7jyUq9CW1X2VPhFEncwOT-qWzB0ZFm6BN3vLcA01fZVH6WR9jJ5ywFRevYjyFVX4g5c=w640-h98" width="640"></a></p><p>And here it is – a function that compares various times, including 3 days, which is related to the <span>sks</span> application's main function. The result of this time comparison is used to create a message, which is likely sent to the <span>SEPKeyStore</span> kernel extension. Creating a new enum makes it more readable:</p><p><span>enum times : uint32_t</span></p><p><span>{</span></p><p><span>    _3_days = 0x3f480,</span></p><p><span>    _2_days = 0x2a301,</span></p><p><span>    _1_days = 0x15181,</span></p><p><span>    `_2.5h` = 0xe11</span></p><p><span>};</span></p><p><a href="https://blogger.googleusercontent.com/img/a/AVvXsEg0JC9kKOelUjXI7AmxnIJf4160QuVQ6JibF1gYvk_QIc3d-0mDP29IvKaxuYQS9Hou8u3gfcpJHf11qznWDYY2QQKSZhDWcGusssdg_kxo4fH9aJbveSJxRdo5OpLS7az18e9wfpKxsjTZqKeQdA6eB45tfr4y0offM4mmbADozT7PH3H71ypvq_83cql6"><img alt="" data-original-height="1114" data-original-width="1330" height="535" src="https://blogger.googleusercontent.com/img/a/AVvXsEg0JC9kKOelUjXI7AmxnIJf4160QuVQ6JibF1gYvk_QIc3d-0mDP29IvKaxuYQS9Hou8u3gfcpJHf11qznWDYY2QQKSZhDWcGusssdg_kxo4fH9aJbveSJxRdo5OpLS7az18e9wfpKxsjTZqKeQdA6eB45tfr4y0offM4mmbADozT7PH3H71ypvq_83cql6=w640-h535" width="640"></a></p><p>This function is used in a context to initialize a struct, which is likely a message being sent from the SEP to the kernel extension.</p><div><p><a href="https://blogger.googleusercontent.com/img/a/AVvXsEhIi1ytOnwIHz3FfehB3gzVzc4s2L1oOKyB_huAhQ_tMDIPvTFs3ffHMb8sICRwqbc8_dDY3r340BZpYdyjx9n1hRnMUcHIxRUEhcoPrBiiTA4tevJ3E_X8rxujzB1hq2Ncm0mLX3nzlHc41BfoAMsJcqZZWcaEg0_ElGxbhQS86UZeo9TXH4PdrzeFqIza"><img alt="" data-original-height="1626" data-original-width="1780" height="584" src="https://blogger.googleusercontent.com/img/a/AVvXsEhIi1ytOnwIHz3FfehB3gzVzc4s2L1oOKyB_huAhQ_tMDIPvTFs3ffHMb8sICRwqbc8_dDY3r340BZpYdyjx9n1hRnMUcHIxRUEhcoPrBiiTA4tevJ3E_X8rxujzB1hq2Ncm0mLX3nzlHc41BfoAMsJcqZZWcaEg0_ElGxbhQS86UZeo9TXH4PdrzeFqIza=w640-h584" width="640"></a></p><p>I didn't end up reverse engineering much more of the SEP, but this seems to confirm that it's really the SEP that keeps track of how long the phone hasn't been unlocked. This design makes sense to me, since the SEP is involved in every unlock, and is also hardened against tampering, even if an exploit against the main kernel is used, so it's a good place to anchor a mitigation like this.</p></div><div><h2>A Mitigation Only Against Cops?</h2><h2><p>While the media coverage so far framed this mitigation as primarily targeting law enforcement, it also a huge security improvement against theft. Outdated law enforcement equipment often finds its way to eBay and other similar platforms for rather cheap price tags. However, thieves won't have the financial and legal means to obtain up-to-date exploits to unlock iPhones within 3 days of getting them. That's another reason why it's important to keep your device updated!</p><p>On the other hand, law enforcement can and will have to adjust their process, and act faster than before. The first forensic tooling companies already announced that they're able to coordinate these steps within 24 hours! (Note that this also indicates that they only have exploits for AFU state... 🤡)</p></h2><h2>Key Takeaways</h2></div><div><p>This feature is not at all related to wireless activity. The law enforcement document's conclusion that the reboot is due to phones wirelessly communicating with each other is implausible. The older iPhones before iOS 18 likely rebooted due to another reason, such as a software bug.</p><p>The time measurement and triggering of the reboot is in the SEP, which communicates with the <span>SEPKeyStore</span> kernel extension to perform the reboot. It is likely that using an external time source provided over the Internet or cellular networks to tamper with timekeeping will not influence the 3-day timer.</p><p>Security-wise, this is a very powerful mitigation. An attacker must have kernel code execution to prevent an inactivity reboot. This means that a forensic analyst might be able to delay the reboot for the actual data extraction, but the initial exploit must be run within the first three days.</p><p>Inactivity reboot will change the threat landscape for both thieves and forensic analysts, but asymmetrically so: while law enforcement is under more time pressure, it likely completely locks out criminals from accessing your data to get into your bank accounts and other valuable information stored on your iPhone.</p><p>Interested in reverse engineering? Follow me on <a href="https://www.youtube.com/@jiskac">YouTube</a> and <a href="https://bsky.app/profile/naehrdine.bsky.social">BlueSky</a> for updates.</p></div></div>
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[You could have designed state of the art positional encoding (171 pts)]]></title>
            <link>https://fleetwood.dev/posts/you-could-have-designed-SOTA-positional-encoding</link>
            <guid>42166948</guid>
            <pubDate>Sun, 17 Nov 2024 20:31:26 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://fleetwood.dev/posts/you-could-have-designed-SOTA-positional-encoding">https://fleetwood.dev/posts/you-could-have-designed-SOTA-positional-encoding</a>, See on <a href="https://news.ycombinator.com/item?id=42166948">Hacker News</a></p>
<div id="readability-page-1" class="page"><article><div><blockquote>
<p><strong>Gall's Law</strong> <br>
<!-- -->A complex system that works is invariably found to have evolved from a simple
system that worked <br>
<!-- -->John Gall</p>
</blockquote>
<p>This post walks you through the step-by-step discovery of state-of-the-art positional encoding in transformer models. We will achieve
this by iteratively improving our approach to encoding position, arriving at <strong>Ro</strong>tary <strong>P</strong>ostional <strong>E</strong>ncoding (RoPE) used in the latest <a href="https://ai.meta.com/blog/llama-3-2-connect-2024-vision-edge-mobile-devices/" rel="nofollow" target="_blank">LLama 3.2</a> release and most modern transformers. This post intends to limit the mathematical knowledge required to follow along, but some basic linear algebra, trigonometry and understanding of self attention is expected.</p>
<h2>Problem Statement</h2>
<blockquote>
<p>You shall know a word by the company it keeps <br>
<!-- -->John Rupert Firth</p>
</blockquote>
<p>As with all problems, it is best to first start with understanding <strong>exactly</strong> what we are trying to achieve. The self attention mechanism in transformers is utilized to understand relationships
between tokens in a sequence. Self attention is a <strong>set</strong> operation, which
means it is <strong>permutation invariant</strong> (order does not matter). If we do not
enrich self attention with positional information, many important relationships are
<strong>incapable of being determined</strong>.</p>
<p>This is best demonstrated by example.</p>
<h2>Motivating Example</h2>
<p>Consider the following sentences:</p>
<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right" columnspacing=""><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mtext>The&nbsp;dog&nbsp;chased&nbsp;the&nbsp;cat</mtext></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mtext>The&nbsp;cat&nbsp;chased&nbsp;the&nbsp;dog</mtext></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
\text{The dog chased the cat} \\ \\ \text{The cat chased the dog} 
\end{align*}</annotation></semantics></math></span></span></span></p><p>Intuitively, these have very different meanings. Let's see what happens if we
first tokenize them, map to the real token embeddings of <strong>Llama 3.2 1B</strong> and pass them
through <a href="https://pytorch.org/docs/stable/generated/torch.nn.MultiheadAttention.html" rel="nofollow" target="_blank"><code>torch.nn.MultiheadAttention</code></a>.</p>
<pre><code><span line="1"><span>from</span> transformers <span>import</span> AutoTokenizer<span>,</span> AutoModel
</span><span line="2"><span>from</span> torch <span>import</span> torch<span>,</span> nn
</span><span line="3">
</span><span line="4">model_id <span>=</span> <span>"meta-llama/Llama-3.2-1B"</span>
</span><span line="5">tok <span>=</span> AutoTokenizer<span>.</span>from_pretrained<span>(</span>model_id<span>)</span>
</span><span line="6">model <span>=</span> AutoModel<span>.</span>from_pretrained<span>(</span>model_id<span>)</span> 
</span><span line="7">
</span><span line="8">s1<span>,</span> s2 <span>=</span> <span>"The dog chased the cat"</span><span>,</span> <span>"The cat chased the dog"</span>
</span><span line="9">e1<span>,</span> e2 <span>=</span> <span>[</span>model<span>.</span>embed_tokens<span>(</span>tok<span>(</span>s<span>,</span> return_tensors<span>=</span><span>"pt"</span><span>)</span><span>[</span><span>"input_ids"</span><span>]</span><span>)</span> <span>for</span> s <span>in</span> <span>(</span>s1<span>,</span> s2<span>)</span><span>]</span>
</span><span line="10">
</span><span line="11">hdim <span>=</span> e1<span>.</span>shape<span>[</span><span>-</span><span>1</span><span>]</span>
</span><span line="12">W_q <span>=</span> nn<span>.</span>Linear<span>(</span>hdim<span>,</span> hdim<span>,</span> bias<span>=</span><span>False</span><span>)</span>
</span><span line="13">W_k <span>=</span> nn<span>.</span>Linear<span>(</span>hdim<span>,</span> hdim<span>,</span> bias<span>=</span><span>False</span><span>)</span>
</span><span line="14">W_v <span>=</span> nn<span>.</span>Linear<span>(</span>hdim<span>,</span> hdim<span>,</span> bias<span>=</span><span>False</span><span>)</span>
</span><span line="15">
</span><span line="16">mha <span>=</span> nn<span>.</span>MultiheadAttention<span>(</span>embed_dim<span>=</span>hdim<span>,</span> num_heads<span>=</span><span>4</span><span>,</span> batch_first<span>=</span><span>True</span><span>)</span>
</span><span line="17">o1<span>,</span> _ <span>=</span> mha<span>(</span>W_q<span>(</span>e1<span>)</span><span>,</span> W_k<span>(</span>e1<span>)</span><span>,</span> W_v<span>(</span>e1<span>)</span><span>)</span>
</span><span line="18">o2<span>,</span> _ <span>=</span> mha<span>(</span>W_q<span>(</span>e2<span>)</span><span>,</span> W_k<span>(</span>e2<span>)</span><span>,</span> W_v<span>(</span>e2<span>)</span><span>)</span>
</span><span line="19"><span>print</span><span>(</span><span>"Matches: "</span><span>,</span> torch<span>.</span>allclose<span>(</span>o1<span>,</span> o2<span>,</span> atol<span>=</span><span>1e-6</span><span>)</span><span>)</span> <span># True</span>
</span></code></pre>
<p>As we can see, without any positional information, the output of a (multi
headed) self attention operation is <strong>identical</strong>, despite the different
word order and meaning. Let's begin designing a method of enhancing self attention with positional
information, such that it can determine relationships between words encoded by
their positions (i.e which mammal is chasing the other).</p>
<p>To understand and design an optimal encoding scheme, let's explore some desirable properties such a scheme should have.</p>
<h2>Desirable Properties</h2>
<p>Let's try and define some desirable properties that will make the optimization
process as easy as possible.</p>
<h4>Property 1 - Unique encoding for each position (across sequences)</h4>
<p>Each position needs a unique encoding that remains consistent regardless of sequence length - a token at position 5 should have the same encoding whether the current sequence is of length 10 or 10,000.</p>
<h4>Property 2 - Linear relation between two encoded positions</h4>
<p>The relationship between positions should be mathematically simple. If we know the encoding for position <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span></span>, it should be straightforward to compute the encoding for position <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>+</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">p+k</annotation></semantics></math></span></span>, making it easier for the model to learn positional patterns.</p>
<p>If you think about how we represent numbers on a number line, it's easy to understand that 5 is 2 steps away from 3, or that 10 is 5 steps from 15. The same intuitive relationship should exist in our encodings.</p>
<h4>Property 3 - Generalizes to longer sequences than those encountered in training</h4>
<p>To increase our models' utility in the real world, they should generalize outside
their training distribution. Therefore, our encoding scheme needs to be
adaptable enough to handle unexpected input lengths, without
violating any of our other desirable properties.</p>
<h4>Property 4 - Generated by a deterministic process the model can learn</h4>
<p>It would be ideal if our positional encodings could be drawn from a
deterministic process. This should allow the model to learn the mechanism
behind our encoding scheme efficiently.</p>
<h4>Property 5 - Extensible to multiple dimensions</h4>
<p>With multimodal models becoming the norm, it is crucial that our positional
encoding scheme can naturally extend from <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi>D</mi></mrow><annotation encoding="application/x-tex">1D</annotation></semantics></math></span></span> to <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>D</mi></mrow><annotation encoding="application/x-tex">nD</annotation></semantics></math></span></span>. This will allow models to consume data like images or brain scans, which are <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>D</mi></mrow><annotation encoding="application/x-tex">2D</annotation></semantics></math></span></span> and <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn><mi>D</mi></mrow><annotation encoding="application/x-tex">4D</annotation></semantics></math></span></span>
respectively.</p>
<p>Now we know the ideal properties (henceforth referred to as <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><msub><mi>r</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">Pr_n</annotation></semantics></math></span></span>), let's start designing and iterating on our encoding scheme.</p>
<h2>Integer Position Encoding</h2>
<p>The first approach that may jump to mind is simply to add the integer value of the token position to each component of the token embedding, with values ranging from <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>→</mo><mi>L</mi></mrow><annotation encoding="application/x-tex">0 \rightarrow L</annotation></semantics></math></span></span> where <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span></span> is the
length of our current sequence.</p>
<div><p><video autoplay="" muted="" loop="" playsinline=""><source src="https://fleetwood.dev/positional-encoding/IntegerEncoding.mp4" type="video/mp4">Your browser does not support the video tag.</video></p></div>
<p>In the above animation, we create our positional encoding vector for the token <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="#699C52"><mtext>chased</mtext></mstyle></mrow><annotation encoding="application/x-tex">\color{#699C52}\text{chased}</annotation></semantics></math></span></span> from the index and add it to our token embedding. The embedding values here are a subset of the real values from <strong>Llama 3.2 1B</strong>. We can observe that they're clustered around 0. This
is desirable to avoid <a href="https://www.cs.toronto.edu/~rgrosse/courses/csc321_2017/readings/L15%20Exploding%20and%20Vanishing%20Gradients.pdf" rel="nofollow" target="_blank">vanishing or exploding gradients</a> during training and therefore is something we'd like to maintain throughout the model.</p>
<p>It's clear that our current naïve approach is going to cause problems. The magnitude of the position value
vastly exceeds the actual values of our input. This means the signal-to-noise
ratio is very low, and it's hard for the model to separate the semantic
information from the positional information.</p>
<p>With this new knowledge, a natural follow on might be to normalize the position value by <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><mi>N</mi></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{N}</annotation></semantics></math></span></span>. This constrains the values between 0 and 1, but introduces another problem. If we choose <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span></span> to be the length of the current sequence, then the position values will be completely different for each sequence of differing lengths, violating <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><msub><mi>r</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">Pr_1</annotation></semantics></math></span></span>.</p>
<p>Is there a better way to ensure our numbers are between 0 and 1?
If we thought really hard about this for a while, we might come up with switching
from decimal to binary numbers.</p>
<h2>Binary Position Encoding</h2>
<p>Instead of adding our (potentially normalized) integer position to each
component of the embedding, we could instead convert it into its binary
representation and <em>s t r e t c h</em> our value out to match our embedding dimension, as demonstrated below.</p>
<div><p><video autoplay="" muted="" loop="" playsinline=""><source src="https://fleetwood.dev/positional-encoding/BinaryEncoding.mp4" type="video/mp4">Your browser does not support the video tag.</video></p></div>
<p>We've converted the position of interest (252) into its binary representation
(11111100) and added each bit to the corresponding component of the
token embedding. The least significant bit (LSB) will cycle between 0 and 1 for every
subsequent token, whilst the most significant bit (MSB) will cycle every
<span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">2^{n-1}</annotation></semantics></math></span></span> tokens where <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span></span> is the number of bits.
You can see the positional encoding vector for different indices in the animation below <sup><a href="#user-content-fn-1" id="user-content-fnref-1" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>.</p>
<div><p><video autoplay="" muted="" loop="" playsinline=""><source src="https://fleetwood.dev/positional-encoding/BinaryPositionalEncodingPlot.mp4" type="video/mp4">Your browser does not support the video tag.</video></p></div>
<p>We've solved the value range problem, and we now have unique encodings that are
consistent across different sequence lengths. What happens if we plot a low dimensional version of our token embedding and visualize the addition of our binary positional vector for different values.</p>
<div><p><video autoplay="" muted="" loop="" playsinline=""><source src="https://fleetwood.dev/positional-encoding/BinaryVector3D.mp4" type="video/mp4">Your browser does not support the video tag.</video></p></div>
<p>We can see that the result is very "jumpy" (as we might expect from the
discrete nature of binary). The optimization process likes smooth, continuous and
predictable changes. Do we know any functions with similar value ranges that are smooth and continuous?</p>
<p>If we looked around a little, we might notice that both <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>sin</mi><mo>⁡</mo></mrow><annotation encoding="application/x-tex">\sin</annotation></semantics></math></span></span> and <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>cos</mi><mo>⁡</mo></mrow><annotation encoding="application/x-tex">\cos</annotation></semantics></math></span></span> fit the bill!</p>
<h2>Sinusoidal positional encoding</h2>
<div><p><video autoplay="" muted="" loop="" playsinline=""><source src="https://fleetwood.dev/positional-encoding/SteppedPositionalEncodingPlot.mp4" type="video/mp4">Your browser does not support the video tag.</video></p></div>
<p>The above animation visualizes our position embedding if each component is
alternatively drawn from <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>sin</mi><mo>⁡</mo></mrow><annotation encoding="application/x-tex">\sin</annotation></semantics></math></span></span> and <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>cos</mi><mo>⁡</mo></mrow><annotation encoding="application/x-tex">\cos</annotation></semantics></math></span></span> with gradually increasing
wavelengths. If you compare it with the previous animation, you'll notice a striking similarity!</p>
<p>We've now arrived at Sinusoidal embeddings; originally defined in the <a href="https://arxiv.org/abs/1706.03762" rel="nofollow" target="_blank">Attention is all you need</a> paper.
Let's look at the equations:</p>
<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><msub><mi>E</mi><mrow><mo stretchy="false">(</mo><mi>p</mi><mi>o</mi><mi>s</mi><mo separator="true">,</mo><mn>2</mn><mi>i</mi><mo stretchy="false">)</mo></mrow></msub><mo>=</mo><mstyle mathcolor="#58C4DD"><mi>sin</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mstyle mathcolor="black"><mfrac><mrow><mi>p</mi><mi>o</mi><mi>s</mi></mrow><mrow><mn>1000</mn><msup><mn>0</mn><mrow><mn>2</mn><mi>i</mi><mi mathvariant="normal">/</mi><mi>d</mi></mrow></msup></mrow></mfrac><mstyle mathcolor="#58C4DD"></mstyle></mstyle><mo fence="true" mathcolor="#58C4DD">)</mo></mrow><mstyle mathcolor="black"><mspace linebreak="newline"></mspace><mspace width="1em"></mspace><mspace linebreak="newline"></mspace><mi>P</mi><msub><mi>E</mi><mrow><mo stretchy="false">(</mo><mi>p</mi><mi>o</mi><mi>s</mi><mo separator="true">,</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msub><mo>=</mo><mstyle mathcolor="#FC6255"><mi>cos</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mstyle mathcolor="black"><mfrac><mrow><mi>p</mi><mi>o</mi><mi>s</mi></mrow><mrow><mn>1000</mn><msup><mn>0</mn><mrow><mn>2</mn><mi>i</mi><mi mathvariant="normal">/</mi><mi>d</mi></mrow></msup></mrow></mfrac><mstyle mathcolor="#FC6255"></mstyle></mstyle><mo fence="true" mathcolor="#FC6255">)</mo></mrow><mstyle mathcolor="black"><mspace linebreak="newline"></mspace></mstyle></mstyle></mstyle></mstyle></mrow><annotation encoding="application/x-tex">PE_{(pos,2i)} = \color{#58C4DD}\sin\left(\color{black}\frac{pos}{10000^{2i/d}}\color{#58C4DD}\right)\color{black} \\ 
\quad \\
PE_{(pos,2i+1)} = \color{#FC6255}\cos\left(\color{black}\frac{pos}{10000^{2i/d}}\color{#FC6255}\right)\color{black} \\ </annotation></semantics></math></span></span></span></p><p>where <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>o</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">pos</annotation></semantics></math></span></span> is the tokens position index, <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span></span> is the component index
in the positional encoding vector, and <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span></span> is the model dimension. <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10</mn><mo separator="true">,</mo><mn>000</mn></mrow><annotation encoding="application/x-tex">10,000</annotation></semantics></math></span></span> is the <strong>base wavelength</strong> (henceforth referred to as
<span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span></span>), which we stretch or compress as a function of the component index. I encourage you to plug in some realistic values to get a feel for this
geometric progression.</p>
<p>There's a few parts of this equation that are confusing at first glance. How did the
authors choose <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10</mn><mo separator="true">,</mo><mn>000</mn></mrow><annotation encoding="application/x-tex">10,000</annotation></semantics></math></span></span>? Why are we using <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>sin</mi><mo>⁡</mo></mrow><annotation encoding="application/x-tex">\sin</annotation></semantics></math></span></span> <strong>and</strong> <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>cos</mi><mo>⁡</mo></mrow><annotation encoding="application/x-tex">\cos</annotation></semantics></math></span></span> for even and odd positions respectively?</p>
<p>It seems that using <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10</mn><mo separator="true">,</mo><mn>000</mn></mrow><annotation encoding="application/x-tex">10,000</annotation></semantics></math></span></span> for the base wavelength was determined experimentally <sup><a href="#user-content-fn-2" id="user-content-fnref-2" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup>. Deciphering the usage of both <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>sin</mi><mo>⁡</mo></mrow><annotation encoding="application/x-tex">\sin</annotation></semantics></math></span></span> and <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>cos</mi><mo>⁡</mo></mrow><annotation encoding="application/x-tex">\cos</annotation></semantics></math></span></span> is more involved, but crucial
for our iterative approach to understanding. The key here is our desire for a linear relation between two encoded positions (<span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><msub><mi>r</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">Pr_2</annotation></semantics></math></span></span>). To understand how using <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>sin</mi><mo>⁡</mo></mrow><annotation encoding="application/x-tex">\sin</annotation></semantics></math></span></span> and <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>cos</mi><mo>⁡</mo></mrow><annotation encoding="application/x-tex">\cos</annotation></semantics></math></span></span> in tandem produce this linear relation, we will have to dive into some trigonometry.</p>
<p>Consider a sequence of sine and cosine pairs, each associated with a frequency <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ω</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\omega_i</annotation></semantics></math></span></span>. Our goal is to find a linear transformation matrix <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">M</mi></mrow><annotation encoding="application/x-tex">\mathbf{M}</annotation></semantics></math></span></span> that can shift these sinusoidal functions by a fixed offset <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span></span>:</p>
<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="bold">M</mi><mo>⋅</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>p</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>p</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>p</mi><mo>+</mo><mi>k</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>p</mi><mo>+</mo><mi>k</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{M} \cdot \begin{bmatrix} \sin(\omega_i p) \\ \cos(\omega_i p) \end{bmatrix} = \begin{bmatrix} \sin(\omega_i(p + k)) \\ \cos(\omega_i(p + k)) \end{bmatrix}</annotation></semantics></math></span></span></span></p><p>The frequencies <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ω</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\omega_i</annotation></semantics></math></span></span> follow a geometric progression that decreases with dimension index <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span></span>, defined as:</p>
<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>ω</mi><mi>i</mi></msub><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1000</mn><msup><mn>0</mn><mrow><mn>2</mn><mi>i</mi><mi mathvariant="normal">/</mi><mi>d</mi></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">\omega_i = \frac{1}{10000^{2i/d}}</annotation></semantics></math></span></span></span></p><p>To find this transformation matrix, we can express it as a general 2×2 matrix with unknown coefficients <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">u_1</annotation></semantics></math></span></span>, <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">v_1</annotation></semantics></math></span></span>, <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">u_2</annotation></semantics></math></span></span>, and <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">v_2</annotation></semantics></math></span></span>:</p>
<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>u</mi><mn>1</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>v</mi><mn>1</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>u</mi><mn>2</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>v</mi><mn>2</mn></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>⋅</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>p</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>p</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>p</mi><mo>+</mo><mi>k</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>p</mi><mo>+</mo><mi>k</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{bmatrix} u_1 &amp; v_1 \\ u_2 &amp; v_2 \end{bmatrix} \cdot \begin{bmatrix} \sin(\omega_i p) \\ \cos(\omega_i p) \end{bmatrix} = \begin{bmatrix} \sin(\omega_i(p+k)) \\ \cos(\omega_i(p+k)) \end{bmatrix}</annotation></semantics></math></span></span></span></p><p>By applying the trigonometric addition theorem to the right-hand side, we can expand this into:</p>
<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>u</mi><mn>1</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>v</mi><mn>1</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>u</mi><mn>2</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>v</mi><mn>2</mn></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>⋅</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>p</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>p</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>p</mi><mo stretchy="false">)</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>k</mi><mo stretchy="false">)</mo><mo>+</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>p</mi><mo stretchy="false">)</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>k</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>p</mi><mo stretchy="false">)</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>k</mi><mo stretchy="false">)</mo><mo>−</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>p</mi><mo stretchy="false">)</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>k</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{bmatrix} u_1 &amp; v_1 \\ u_2 &amp; v_2 \end{bmatrix} \cdot \begin{bmatrix} \sin(\omega_i p) \\ \cos(\omega_i p) \end{bmatrix} = \begin{bmatrix} \sin(\omega_i p)\cos(\omega_i k) + \cos(\omega_i p)\sin(\omega_i k) \\ \cos(\omega_i p)\cos(\omega_i k) - \sin(\omega_i p)\sin(\omega_i k) \end{bmatrix}</annotation></semantics></math></span></span></span></p><p>This expansion gives us a system of two equations by matching coefficients:</p>
<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msub><mi>u</mi><mn>1</mn></msub><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>p</mi><mo stretchy="false">)</mo><mo>+</mo><msub><mi>v</mi><mn>1</mn></msub><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>p</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>k</mi><mo stretchy="false">)</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>p</mi><mo stretchy="false">)</mo><mo>+</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>k</mi><mo stretchy="false">)</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>p</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd></mtd><mtd></mtd></mtr><mtr><mtd></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msub><mi>u</mi><mn>2</mn></msub><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>p</mi><mo stretchy="false">)</mo><mo>+</mo><msub><mi>v</mi><mn>2</mn></msub><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>p</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo>−</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>k</mi><mo stretchy="false">)</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>p</mi><mo stretchy="false">)</mo><mo>+</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>k</mi><mo stretchy="false">)</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>p</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd></mtd><mtd></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
u_1\sin(\omega_i p) + v_1\cos(\omega_i p) &amp;= \cos(\omega_i k)\sin(\omega_i p) + \sin(\omega_i k)\cos(\omega_i p) \\
u_2\sin(\omega_i p) + v_2\cos(\omega_i p) &amp;= -\sin(\omega_i k)\sin(\omega_i p) + \cos(\omega_i k)\cos(\omega_i p)
\end{align}</annotation></semantics></math></span></span></span></p><p>By comparing terms with <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>p</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\sin(\omega_i p)</annotation></semantics></math></span></span> and <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>p</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\cos(\omega_i p)</annotation></semantics></math></span></span> on both sides, we can solve for the unknown coefficients:</p>
<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left right left" columnspacing="0em 1em 0em"><mtr><mtd></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>u</mi><mn>1</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>k</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>v</mi><mn>1</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>k</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd></mtd><mtd></mtd></mtr><mtr><mtd></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>u</mi><mn>2</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo>−</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>k</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>v</mi><mn>2</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>k</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd></mtd><mtd></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
u_1 &amp;= \cos(\omega_i k) &amp; v_1 &amp;= \sin(\omega_i k) \\
u_2 &amp;= -\sin(\omega_i k) &amp; v_2 &amp;= \cos(\omega_i k)
\end{align}</annotation></semantics></math></span></span></span></p><p>These solutions give us our final transformation matrix <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="bold">M</mi><mi mathvariant="bold">k</mi></msub></mrow><annotation encoding="application/x-tex">\mathbf{M_k}</annotation></semantics></math></span></span>:</p>
<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="bold">M</mi><mi mathvariant="bold">k</mi></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>k</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>k</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>k</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>k</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{M_k} = \begin{bmatrix} \cos(\omega_i k) &amp; \sin(\omega_i k) \\ -\sin(\omega_i k) &amp; \cos(\omega_i k) \end{bmatrix}</annotation></semantics></math></span></span></span></p><p>If you've done any game programming before, you might notice that the
result of our derivation is oddly familiar. That's right, it's the <a href="https://en.wikipedia.org/wiki/Rotation_matrix" rel="nofollow" target="_blank">Rotation Matrix!</a> <sup><a href="#user-content-fn-3" id="user-content-fnref-3" data-footnote-ref="true" aria-describedby="footnote-label">3</a></sup>.</p>
<p>So the encoding scheme designed by <a href="https://en.wikipedia.org/wiki/Noam_Shazeer" rel="nofollow" target="_blank">Noam Shazeer</a> in <a href="https://arxiv.org/abs/1706.03762" rel="nofollow" target="_blank">Attention is all you need</a> was already encoding relative position as a rotation back in 2017! It took another <strong>4 years</strong> to go from Sinusoidal Encoding to RoPE, despite rotations already being on the table...</p>
<h2>Absolute vs Relative Position Encoding</h2>
<p>With the knowledge in hand that rotations are important here, let's
return to our motivating example and try to discover some intuitions for our next iteration.</p>
<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mspace width="0.7em"></mspace><mn>0</mn><mspace width="1.4em"></mspace><mn>1</mn><mspace width="2em"></mspace><mn>2</mn><mspace width="1.7em"></mspace><mn>3</mn><mspace width="1.1em"></mspace><mn>4</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mtext>The&nbsp;dog&nbsp;chased&nbsp;the&nbsp;cat</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mspace width="0.3em"></mspace><mtext>-2</mtext><mspace width="1.4em"></mspace><mtext>-1</mtext><mspace width="1.7em"></mspace><mn>0</mn><mstyle mathcolor="black"><mspace width="1.7em"></mspace><mn>1</mn><mspace width="1.1em"></mspace><mn>2</mn></mstyle></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mrow><mtext>The&nbsp;dog&nbsp;</mtext><mstyle mathcolor="#699C52"><mtext>chased&nbsp;</mtext><mstyle mathcolor="black"><mtext>the&nbsp;cat</mtext></mstyle></mstyle></mrow></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
&amp;\hspace{0.7em}0 \hspace{1.4em} 1 \hspace{2em} 2 \hspace{1.7em} 3 \hspace{1.1em} 4\\
&amp;\text{The dog chased the cat} \\
\\
&amp;\hspace{0.3em}\text{-2} \hspace{1.4em} \text{-1} \hspace{1.7em} 0
\color{black} \hspace{1.7em} 1 \hspace{1.1em} 2\\
&amp;\text{The dog \color{#699C52}chased \color{black}the cat}
\end{align*}</annotation></semantics></math></span></span></span></p><p>Above we can see the absolute positions of our tokens, and the relative
positions from <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="#699C52"><mtext>chased</mtext></mstyle></mrow><annotation encoding="application/x-tex">\color{#699C52}\text{chased}</annotation></semantics></math></span></span> to every other token. With Sinusoidal Encoding, we
generated a separate vector which represents the absolute position,
and using some trigonometric trickery we were able to encode relative positions.</p>
<p>When we're trying to understand these sentences, does it matter that <em>this</em> word is the 2149th word in this blog post? Or do we care about its relationship to the words around it? The absolute position of a word rarely matters for meaning - what matters is how words relate to each other.</p>
<h2>Positional encoding in context</h2>
<p>From this point on, it's key to consider positional encoding <strong>in the context of</strong>
self attention. To reiterate, the self-attention mechanism enables the model to weigh the importance of different elements in an input sequence and dynamically adjust their influence on the output.</p>
<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>Attn</mtext><mo stretchy="false">(</mo><mi>Q</mi><mo separator="true">,</mo><mi>K</mi><mo separator="true">,</mo><mi>V</mi><mo stretchy="false">)</mo><mo>=</mo><mtext>softmax</mtext><mrow><mo fence="true">(</mo><mfrac><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><msqrt><msub><mi>d</mi><mi>k</mi></msub></msqrt></mfrac><mo fence="true">)</mo></mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">\text{Attn}(Q, K, V) = \text{softmax}\left(\frac{QK^T}{\sqrt{d_k}}\right)V</annotation></semantics></math></span></span></span></p><p>In all our previous iterations, we've generated a separate positional encoding
vector and <strong>added</strong> it to our token embedding prior to our <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span></span>, <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span></span> and <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span></span> projections.
By adding the positional information directly to our token embedding, we are
<strong>polluting</strong> the semantic information with the positional information. We should
be attempting to encode the information without modifying the norm. Shifting to multiplicative is the
key.</p>
<p>Using the dictionary analogy, when looking up a word (query) in our dictionary (keys), nearby words should have more influence than distant ones. The influence of one token upon another is determined by the <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">QK^T</annotation></semantics></math></span></span> dot product - so that's exactly where we should focus our positional encoding!</p>
<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>⋅</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>=</mo><mi mathvariant="normal">∣</mi><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi>cos</mi><mo>⁡</mo><mi>θ</mi></mrow><annotation encoding="application/x-tex">\vec{a} \cdot \vec{b} = |\vec{a}| |\vec{b}| \cos \theta</annotation></semantics></math></span></span></span></p><p>The geometric interpretation of the dot product shown above gives us a magnificent insight.
We can modulate the result of our dot product of two vectors purely by
increasing or decreasing the angle between them. Furthermore, by rotating the
vector, we have absolutely zero impact on the norm of the vector, which encodes
the semantic information of our token.</p>
<p>So now we know where to focus our <em>attention</em>, and have seen from another <em>angle</em> why a
rotation might be a sensible "channel" in which to encode our positional
information, let's put it all together!</p>
<h2><strong>Ro</strong>tary <strong>P</strong>ostional <strong>E</strong>ncoding</h2>
<p><strong>Ro</strong>tary <strong>P</strong>ostional <strong>E</strong>ncoding or RoPE was defined in the
<a href="https://arxiv.org/pdf/2104.09864" rel="nofollow" target="_blank">RoFormer paper</a> (<a href="https://x.com/bojone1993" rel="nofollow" target="_blank">Jianlin Su</a> designed it independently on his blog <a href="https://kexue.fm/archives/8130" rel="nofollow" target="_blank">here</a> and <a href="https://kexue.fm/archives/8265" rel="nofollow" target="_blank">here</a>).
While it may seem like voodoo if you skip to the end result, by thinking about Sinusoidal Encoding in the
context of self attention (and more specifically dot products), we can see how
it all comes together.</p>
<p>Much like in Sinusoidal Encoding, we decompose our vectors (<span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">q</mi></mrow><annotation encoding="application/x-tex">\mathbf{q}</annotation></semantics></math></span></span> or <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">k</mi></mrow><annotation encoding="application/x-tex">\mathbf{k}</annotation></semantics></math></span></span>, instead of pre-projection <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">x</mi></mrow><annotation encoding="application/x-tex">\mathbf{x}</annotation></semantics></math></span></span>) into 2D pairs/chunks. Rather than encoding <em>absolute</em> position directly by adding a vector we drew from sinusoidal functions of slowly decreasing frequencies, we cut to the chase and encode <em>relative</em> position by <strong>multiplying each pair with the rotation matrix</strong>.</p>
<p>Let <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">q</mi></mrow><annotation encoding="application/x-tex">\mathbf{q}</annotation></semantics></math></span></span> or <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">k</mi></mrow><annotation encoding="application/x-tex">\mathbf{k}</annotation></semantics></math></span></span> be our input vector at position <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span></span>. We create a block diagonal matrix
where <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="bold">M</mi><mi mathvariant="bold">i</mi></msub></mrow><annotation encoding="application/x-tex">\mathbf{M_i}</annotation></semantics></math></span></span> is the corresponding rotation matrix for that component
pairs desired rotation:</p>
<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>R</mi><mo stretchy="false">(</mo><mi mathvariant="bold">q</mi><mo separator="true">,</mo><mi>p</mi><mo stretchy="false">)</mo><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi mathvariant="bold">M</mi><mn mathvariant="bold">1</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi mathvariant="bold">M</mi><mn mathvariant="bold">2</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">⋱</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi mathvariant="bold">M</mi><mrow><mi mathvariant="bold">d</mi><mi mathvariant="bold">/</mi><mn mathvariant="bold">2</mn></mrow></msub></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>q</mi><mn>1</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>q</mi><mn>2</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi><mi mathvariant="normal">⋮</mi><mpadded height="0em" voffset="0em"><mspace mathbackground="black" width="0em" height="1.5em"></mspace></mpadded></mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>q</mi><mi>d</mi></msub></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">R(\mathbf{q}, p) = \begin{pmatrix} \mathbf{M_1} &amp; &amp; &amp; \\ &amp; \mathbf{M_2} &amp; &amp; \\ &amp; &amp; \ddots &amp; \\ &amp; &amp; &amp; \mathbf{M_{d/2}} \end{pmatrix} \begin{pmatrix} q_1 \\ q_2 \\ \vdots \\ q_d \end{pmatrix} </annotation></semantics></math></span></span></span></p><p>Much the same as Sinusoidal Encoding, <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="bold">M</mi><mi mathvariant="bold">i</mi></msub></mrow><annotation encoding="application/x-tex">\mathbf{M_i}</annotation></semantics></math></span></span> is simply:</p>
<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="bold">M</mi><mi mathvariant="bold">i</mi></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>p</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>p</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>p</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>p</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{M_i} = \begin{bmatrix} \cos(\omega_i p) &amp; \sin(\omega_i p) \\ -\sin(\omega_i p) &amp; \cos(\omega_i p) \end{bmatrix}</annotation></semantics></math></span></span></span></p><div><p><video autoplay="" muted="" loop="" playsinline=""><source src="https://fleetwood.dev/positional-encoding/RopeEncoding.mp4" type="video/mp4">Your browser does not support the video tag.</video></p></div>
<p>In practice, we don't use a matrix multiplication to compute RoPE as it would be
computationally inefficient with such a sparse matrix. Instead, we can directly apply the rotations to pairs of elements independently, taking advantage of the regular pattern in the computation:</p>
<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>R</mi><mrow><mi mathvariant="normal">Θ</mi><mo separator="true">,</mo><mi>p</mi></mrow><mi>d</mi></msubsup><mi>q</mi><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>q</mi><mn>1</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>q</mi><mn>2</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>q</mi><mn>3</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>q</mi><mn>4</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi><mi mathvariant="normal">⋮</mi><mpadded height="0em" voffset="0em"><mspace mathbackground="black" width="0em" height="1.5em"></mspace></mpadded></mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>q</mi><mrow><mi>d</mi><mo>−</mo><mn>1</mn></mrow></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>q</mi><mi>d</mi></msub></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>⊗</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>⁡</mo><mi>p</mi><msub><mi>θ</mi><mn>1</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>⁡</mo><mi>p</mi><msub><mi>θ</mi><mn>1</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>⁡</mo><mi>p</mi><msub><mi>θ</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>⁡</mo><mi>p</mi><msub><mi>θ</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi><mi mathvariant="normal">⋮</mi><mpadded height="0em" voffset="0em"><mspace mathbackground="black" width="0em" height="1.5em"></mspace></mpadded></mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>⁡</mo><mi>p</mi><msub><mi>θ</mi><mrow><mi>d</mi><mi mathvariant="normal">/</mi><mn>2</mn></mrow></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>⁡</mo><mi>p</mi><msub><mi>θ</mi><mrow><mi>d</mi><mi mathvariant="normal">/</mi><mn>2</mn></mrow></msub></mrow></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>+</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><msub><mi>q</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>q</mi><mn>1</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><msub><mi>q</mi><mn>4</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>q</mi><mn>3</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi><mi mathvariant="normal">⋮</mi><mpadded height="0em" voffset="0em"><mspace mathbackground="black" width="0em" height="1.5em"></mspace></mpadded></mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><msub><mi>q</mi><mi>d</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>q</mi><mrow><mi>d</mi><mo>−</mo><mn>1</mn></mrow></msub></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>⊗</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>sin</mi><mo>⁡</mo><mi>p</mi><msub><mi>θ</mi><mn>1</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>sin</mi><mo>⁡</mo><mi>p</mi><msub><mi>θ</mi><mn>1</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>sin</mi><mo>⁡</mo><mi>p</mi><msub><mi>θ</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>sin</mi><mo>⁡</mo><mi>p</mi><msub><mi>θ</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi><mi mathvariant="normal">⋮</mi><mpadded height="0em" voffset="0em"><mspace mathbackground="black" width="0em" height="1.5em"></mspace></mpadded></mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>sin</mi><mo>⁡</mo><mi>p</mi><msub><mi>θ</mi><mrow><mi>d</mi><mi mathvariant="normal">/</mi><mn>2</mn></mrow></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>sin</mi><mo>⁡</mo><mi>p</mi><msub><mi>θ</mi><mrow><mi>d</mi><mi mathvariant="normal">/</mi><mn>2</mn></mrow></msub></mrow></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">R_{\Theta,p}^d q = \begin{pmatrix} 
q_1 \\
q_2 \\
q_3 \\
q_4 \\
\vdots \\
q_{d-1} \\
q_d
\end{pmatrix} \otimes \begin{pmatrix}
\cos p\theta_1 \\
\cos p\theta_1 \\
\cos p\theta_2 \\
\cos p\theta_2 \\
\vdots \\
\cos p\theta_{d/2} \\
\cos p\theta_{d/2}
\end{pmatrix} + \begin{pmatrix}
-q_2 \\
q_1 \\
-q_4 \\
q_3 \\
\vdots \\
-q_d \\
q_{d-1}
\end{pmatrix} \otimes \begin{pmatrix}
\sin p\theta_1 \\
\sin p\theta_1 \\
\sin p\theta_2 \\
\sin p\theta_2 \\
\vdots \\
\sin p\theta_{d/2} \\
\sin p\theta_{d/2}
\end{pmatrix}</annotation></semantics></math></span></span></span></p><p>That's all there is to it! By artfully applying our rotations to 2D chunks of <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">q</mi></mrow><annotation encoding="application/x-tex">\mathbf{q}</annotation></semantics></math></span></span> and
<span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">k</mi></mrow><annotation encoding="application/x-tex">\mathbf{k}</annotation></semantics></math></span></span> prior to their dot product, and switching from additive to
multiplicative, we can gain a big performance boost in evaluations <sup><a href="#user-content-fn-4" id="user-content-fnref-4" data-footnote-ref="true" aria-describedby="footnote-label">4</a></sup>.</p>
<h2>Extending RoPE to <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span></span>-Dimensions</h2>
<p>We've explored the <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi>D</mi></mrow><annotation encoding="application/x-tex">1D</annotation></semantics></math></span></span> case for RoPE and by this point I hope you've gained an
intuitive understanding of an admittedly unintuitive component of transformers.
Finally, let's explore extending it to higher dimensions, such as images.</p>
<p>A natural first intuition could be to directly use the <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>x</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>y</mi></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex"> \begin{bmatrix} x \\ y \end{bmatrix}</annotation></semantics></math></span></span> coordinate pairs from the image. This might seem intuitive, after all, we were almost arbitrarily pairing up our components previously. However, this would be a mistake!</p>
<p>In the <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi>D</mi></mrow><annotation encoding="application/x-tex">1D</annotation></semantics></math></span></span> case, we encode the relative position <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>−</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">m - n</annotation></semantics></math></span></span> through a rotation of pairs
of values from our input vector. For <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>D</mi></mrow><annotation encoding="application/x-tex">2D</annotation></semantics></math></span></span> data, we need to encode both horizontal and vertical relative positions, say <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>−</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">m - n</annotation></semantics></math></span></span> and <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>−</mo><mi>j</mi></mrow><annotation encoding="application/x-tex">i - j</annotation></semantics></math></span></span> independently. RoPE's brilliance lies in how it handles multiple dimensions. Instead of trying to encode all positional information in a single rotation, we pair components <strong>within the same dimension</strong> and rotate those, otherwise we would be intermixing the <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span></span> and <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span></span> offset information. By handling each dimension independently, we maintain the natural structure of the space. This can generalize to as many dimensions as required!</p>
<h2>The future of positional encoding</h2>
<p>Is RoPE the final incarnation of positional encoding? This <a href="https://arxiv.org/pdf/2410.06205" rel="nofollow" target="_blank">recent paper</a> from DeepMind deeply analyses RoPE and highlights some fundamental problems.</p>
<p>I anticipate some future breakthroughs, perhaps taking inspiration from
signal processing with ideas like wavelets or hierarchical implementations. As models
are increasingly quantized for deployment, I'd also expect to see some
innovation in encoding schemes that remain robust under low-precision arithmetic.</p>
<h2>Conclusion</h2>
<p>Positional encoding has and continues to be treated as an after thought in
transformers. I believe we should view it differently - self attention has an
Achilles heel that has been repeatedly patched.</p>
<p>I hope this blog post showed you that you too could have discovered state of the
art positional encoding, despite it being unintuitive at first. In a follow up
post I'd love to explore practical implementation details for RoPE in order to
maximise performance.</p>
<p>Thanks to Madeline Ephgrave for proof reading this.</p>
<h2>References</h2>
<ul>
<li><a href="https://kazemnejad.com/blog/transformer_architecture_positional_encoding/" rel="nofollow" target="_blank">https://kazemnejad.com/blog/transformer_architecture_positional_encoding/</a></li>
<li><a href="https://blog.eleuther.ai/rotary-embeddings/" rel="nofollow" target="_blank">https://blog.eleuther.ai/rotary-embeddings/</a></li>
<li><a href="https://www.youtube.com/watch?v=T3OT8kqoqjc" rel="nofollow" target="_blank">https://www.youtube.com/watch?v=T3OT8kqoqjc</a></li>
<li><a href="https://arxiv.org/pdf/1706.03762" rel="nofollow" target="_blank">https://arxiv.org/pdf/1706.03762</a></li>
<li><a href="https://arxiv.org/pdf/2410.06205" rel="nofollow" target="_blank">https://arxiv.org/pdf/2410.06205</a></li>
<li><a href="https://arxiv.org/pdf/2104.09864" rel="nofollow" target="_blank">https://arxiv.org/pdf/2104.09864</a></li>
</ul>
<section data-footnotes="true">
<ol>
<li id="user-content-fn-1">
<p>Binary and Sinusoidal animations are reproductions of animations contained
in <a href="https://www.youtube.com/watch?v=T3OT8kqoqjc0" rel="nofollow" target="_blank">this</a> video. <a href="#user-content-fnref-1" data-footnote-backref="" aria-label="Back to reference 1">↩</a></p>
</li>
<li id="user-content-fn-2">
<p>Using <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><mo>=</mo><mn>10000</mn></mrow><annotation encoding="application/x-tex">\theta = 10000</annotation></semantics></math></span></span> gives us <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>π</mi><mo>⋅</mo><mn>10000</mn></mrow><annotation encoding="application/x-tex"> 2 \pi \cdot 10000</annotation></semantics></math></span></span> unique positions, or a
theoretical upper bound on the context length at ~63,000. <a href="#user-content-fnref-2" data-footnote-backref="" aria-label="Back to reference 2">↩</a></p>
</li>
<li id="user-content-fn-3">
<p>Pieces of this post are based on <a href="https://kazemnejad.com/blog/transformer_architecture_positional_encoding/" rel="nofollow" target="_blank">this fantastic
post</a>
by <a href="https://kazemnejad.com/" rel="nofollow" target="_blank">Amirhossein Kazemnejad</a>. <a href="#user-content-fnref-3" data-footnote-backref="" aria-label="Back to reference 3">↩</a></p>
</li>
<li id="user-content-fn-4">
<p>For empirical evidence, see <a href="https://blog.eleuther.ai/rotary-embeddings/" rel="nofollow" target="_blank">this</a> great post by EleutherAI. <a href="#user-content-fnref-4" data-footnote-backref="" aria-label="Back to reference 4">↩</a></p>
</li>
</ol>
</section></div></article></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Why did Windows 95 setup use three operating systems? (272 pts)]]></title>
            <link>https://devblogs.microsoft.com/oldnewthing/20241112-00/?p=110507</link>
            <guid>42166606</guid>
            <pubDate>Sun, 17 Nov 2024 19:54:24 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://devblogs.microsoft.com/oldnewthing/20241112-00/?p=110507">https://devblogs.microsoft.com/oldnewthing/20241112-00/?p=110507</a>, See on <a href="https://news.ycombinator.com/item?id=42166606">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="single-wrapper">
    
    <article data-clarity-region="article" id="post-110507">
        <div data-bi-area="body_article" data-bi-id="post_page_body_article">
            <p>Twitter users @tthirtle asked why Windows 95 setup goes through three operating systems: MS-DOS, Windows 3.1, and then Windows 95. Why not go from MS-DOS straight to Windows 95?</p>
<blockquote data-conversation="none">
<p dir="ltr" lang="en">Here’s another good question. Why does Windows 95 setup use 3 different UI’s. DOS,Win3.x,and Win9x?</p>
<p>— Thomas (@tthirtle) <a href="https://twitter.com/tthirtle/status/1809777917565767993?ref_src=twsrc%5Etfw">July 7, 2024</a></p></blockquote>

<p>Windows 95 setup could upgrade from three starting points: MS-DOS, Windows 3.1, or Windows 95. (Yes, you could upgrade Windows 95 to Windows 95. You might do this to repair a corrupted system while preserving data.)</p>
<p>One option is to write three versions of Windows 95 setup: One for setting up from MS-DOS, another for setting up from Windows 3.1, and a third for setting up from Windows 95.</p>
<p>This was not a pleasant option because you basically did the same work three times, but implemented separately, so you have to do three times the coding.</p>
<p>A better option is to just write one version of Windows 95 setup and use it for all three starting points. So now you get to choose the platform on which to base your code.</p>
<table>
<tbody>
<tr>
<th rowspan="2">From</th>
<th colspan="3">App type</th>
</tr>
<tr>
<th>MS-DOS</th>
<th>16-bit GUI</th>
<th>32-bit GUI</th>
</tr>
<tr>
<td>MS-DOS</td>
<td>•</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>Windows 3.1</td>
<td>•</td>
<td>•</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>Windows 95</td>
<td>•</td>
<td>•</td>
<td>•</td>
</tr>
</tbody>
</table>
<p>If you write Windows 95 setup as an MS-DOS app, then it runs on all three platforms. That’s great! You need to write only one setup program. The downside is that it’s going to be a text-mode setup program, which looks ugly and gives a poor initial impression of what is supposed to be a brand new GUI world.</p>
<p>At the other extreme, you can write Windows 95 setup as a 32-bit GUI program, but that means that if the user is starting from MS-DOS or Windows 3.1, you have to install Windows 95 before you can run Windows 95 setup, which is a bit of a catch-22.</p>
<p>In the middle is the happy medium: You can have the MS-DOS setup program install a minimal version of Windows 3.1, just barely enough to support what the 16-bit GUI setup program needs.¹ This tiny version is small enough to be copied and installed off a small number of floppy disks. Once that’s done, boot into the tiny version of Windows 3.1 and run the 16-bit GUI setup program.</p>
<p>Okay, so now we have three setup programs. The first one is used if you’re installing from MS-DOS: It installs the tiny version of Windows 3.1, and then boots into Windows 3.1 to continue to the next step.</p>
<p>The second setup program runs as a 16-bit Windows app, either in the miniature copy of Windows 3.1 (if the user is upgrading from MS-DOS), the real copy of Windows 3.1 (if the user is upgrading from Windows 3.1), or the real copy of Windows 95 (if the user is upgrading from Windows 95). This second setup program is the one that does almost all of the real work: It does the initial interaction with the user to gather information about how to install Windows 95, like asking which optional components to include, and does hardware detection to decide which drivers to install.² And then it copies the drivers and Windows 95 files onto the system, migrates your old settings to the new operating system, and boots into Windows 95.</p>
<p>The third setup program runs as a 32-bit Windows app. It is running in the real Windows 95 system and does some final steps that require operation a live running system, like installing printers.</p>
<table>
<tbody>
<tr>
<td>Starting from MS-DOS →</td>
<td>Install mini Windows 3.1</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>MS-DOS app</td>
</tr>
<tr>
<td>&nbsp;</td>
<td>↓</td>
</tr>
<tr>
<td>&nbsp;</td>
<td>Boot into mini-Windows 3.1</td>
</tr>
<tr>
<td>&nbsp;</td>
<td>↓</td>
</tr>
<tr>
<td>Starting from Windows 3.1 →</td>
<td>Gather information</td>
<td rowspan="7">&nbsp;</td>
<td rowspan="7">&nbsp;</td>
<td rowspan="7">16-bit Windows app</td>
</tr>
<tr>
<td>or Windows 95</td>
<td>↓</td>
</tr>
<tr>
<td>&nbsp;</td>
<td>Detect hardware</td>
</tr>
<tr>
<td>&nbsp;</td>
<td>↓</td>
</tr>
<tr>
<td>&nbsp;</td>
<td>Copy drivers and<br>
Windows 95 files</td>
</tr>
<tr>
<td>&nbsp;</td>
<td>↓</td>
</tr>
<tr>
<td>&nbsp;</td>
<td>Migrate settings and configure drivers</td>
</tr>
<tr>
<td>&nbsp;</td>
<td>↓</td>
</tr>
<tr>
<td>&nbsp;</td>
<td>Boot into Windows 95</td>
</tr>
<tr>
<td>&nbsp;</td>
<td>↓</td>
</tr>
<tr>
<td>&nbsp;</td>
<td>Final setup</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>Windows 95 app</td>
</tr>
</tbody>
</table>
<p>So that’s why Windows 95 setup is really three setup programs chained together. It allows a single copy of the code to be used for all three of the installation scenarios. Each program takes you one step closer to the goal. And everything got implemented only once.</p>
<p>¹ There was existing precedent for a tiny version of Windows that is barely enough to run a single program. The original Windows version of Microsoft Excel <a href="https://en.wikipedia.org/w/index.php?title=Microsoft_Excel&amp;oldid=166461028"> came with a runtime version of Windows 2.1</a>, so that customers who didn’t have Windows could still use Excel.</p>
<p>² This hardware detection code that Setup uses is the same code that runs when you do hardware detection from within Windows 95 itself, so even that code needed to be written only once. It did have some runtime checks to change behavior slightly depending on whether it’s running in Windows 3.1 or Windows 95, but the vast majority of the code is identical.</p>
        </div><!-- .entry-content -->

        <!-- AI Disclaimer -->
            </article>
    
</div><div><!-- Author section -->
            <h2>Author</h2>
            <div><div><p><img src="https://devblogs.microsoft.com/oldnewthing/wp-content/uploads/sites/38/2019/02/RaymondChen_5in-150x150.jpg" alt="Raymond Chen"></p></div><p>Raymond has been involved in the evolution of Windows for more than 30 years. In 2003, he began a Web site known as The Old New Thing which has grown in popularity far beyond his wildest imagination, a development which still gives him the heebie-jeebies. The Web site spawned a book, coincidentally also titled The Old New Thing (Addison Wesley 2007). He occasionally appears on the Windows Dev Docs Twitter account to tell stories which convey no useful information.</p></div>        </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Humans have caused 1.5 °C of long-term global warming according to new estimates (384 pts)]]></title>
            <link>https://www.lancaster.ac.uk/news/humans-have-already-caused-15-c-of-long-term-global-warming-according-to-new-estimates</link>
            <guid>42166030</guid>
            <pubDate>Sun, 17 Nov 2024 18:49:25 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.lancaster.ac.uk/news/humans-have-already-caused-15-c-of-long-term-global-warming-according-to-new-estimates">https://www.lancaster.ac.uk/news/humans-have-already-caused-15-c-of-long-term-global-warming-according-to-new-estimates</a>, See on <a href="https://news.ycombinator.com/item?id=42166030">Hacker News</a></p>
<div id="readability-page-1" class="page"><section>
                    <img src="https://cisweb.lancaster.ac.uk/img/cwip/cisweb.lancaster.ac.uk/EventsMedia/earth-adobestock242647178-smaller-638669192826825152.jpg?mode=crop&amp;width=874&amp;height=492&amp;center=0.50%2c0.50" alt="Earth from space" loading="lazy">
                                        <p>A new study published today in Nature Geoscience by Dr Andrew Jarvis at Lancaster University and Professor Piers Forster at the University of Leeds shows that humans may have already caused 1.5 °C of global warming when measured from a time genuinely before the industrial revolution and the start of large-scale carbon emissions.</p><p>The Paris Climate Agreement from 2016 established a long-term temperature goal of “limiting global temperature increase well below 2 degrees Celsius, while pursuing efforts to limit the increase to 1.5 degrees.” The 1.5 °C of warming figure has since become the yardstick to judge progress, or the lack of it, on climate change.</p><p>The human-induced contribution to global warming is currently put at 1.31 °C, but with an uncertainty range of 1.10 to 1.60 °C, according to the Intergovernmental Panel on Climate Change (IPCC’s) preferred methods. This means it is unclear, from the IPCC’s adopted estimates, whether the 1.5 °C boundary has been breached or not. </p><p>Crucially, the IPCC’s preferred methods use temperature records from 1850-1900 as their ‘pre-industrial’ baseline for their calculations. They do this because this is when the first temperature records were taken, although the exact way to measure global temperature increases has never been defined within the climate negotiations. </p><p>Using this same 1850-1900 baseline, Dr Jarvis and Professor Forster’s method more than halves the uncertainty in the current human-caused warming estimate, thereby showing human-caused global warming currently remains below 1.5 °C if measured this way. On this measure, crossing the 1.5 °C Paris guardrail is under 10 years away at current warming rates. </p><p>However, Dr Jarvis and Professor Forster go further. Their method makes a more accurate estimate of the true long-term human contribution to global warming by pushing the base period from which the global temperature change is measured back to before 1700.</p><p>The authors find that when measured from this earlier more accurate definition of pre-industrial time, the long-term human contribution to warming was 1.49 °C ± 0.11 °C in 2023 and is now above 1.5 °C. This reveals that there is almost 0.2 °C of warming within the 1850-1900 baseline currently being used to define the warming.</p><p>Dr Jarvis, lead author of the study, said: “Measuring human-caused global warming is a difficult task because it forces us to compare today’s temperature with what it was in pre-industrial times – we call this the pre-industrial baseline. The closest we come to pre-industrial global temperature measurements are from the middle of the 1800’s, and unsurprisingly, these data are somewhat patchy and the Industrial Revolution was well underway by then. So using these early temperature data as a baseline as previous methods do not only ignores the warming that was already underway, it also bakes significant uncertainty into warming estimates.”</p><p>This new study instead uses CO<sub>2</sub> records from air bubbles trapped in ice-cores to establish a pre-1700 baseline for temperature. These records stretch back thousands of years, well before the Industrial Revolution and the effects of human-derived carbon emissions. The scientists are able to use the CO<sub>2</sub> record to anchor global warming estimates because of what they say is an overlooked relationship between the two.</p><p>“If you plot global temperatures against the concentration of CO<sub>2</sub> in the atmosphere, they both fall on a remarkably straight line, much straighter than current theory would predict,” said Dr Jarvis. “That line tells you not only how much the Earth has warmed since pre-industrial times, but also how much of that warming can be blamed on human activity.</p><p>“The climate is unimaginably complex, so perhaps it isn’t so surprising that such a direct method for accurately measuring the warming humans are responsible for has been overlooked,” Dr Jarvis added.</p><p>The scientists believe their new method is a strong candidate for measuring progress against the 1.5 and 2.0 degree Paris yardsticks.</p><p>Dr Jarvis said: “Our method has a number of strengths. Firstly, it directly tackles the problem of how to establish a robust pre-industrial baseline, although it functions equally well with the 1850-1900 baseline. Secondly, it produces estimates of human-caused warming that are at least 30 percent more certain than current methods. Finally, it is easy and quick to apply, meaning that we can produce warming estimates as soon as the CO<sub>2</sub> and temperature data become available without having to re-run complex climate models. This also means the results are transparent, making them far easier to communicate to non-specialists.”</p><p>Professor Forster, co-author of the study, said: “Our study shows that human societies have caused more than 1.5 degrees of long-term global warming. However, this does not necessarily mean that the Paris Agreement’s 1.5 temperature guardrail is breached, as we find that 0.18 °C of warming happened before global temperature records began, and this baked-in warming would not have been factored into the Paris Agreement.</p><p>“Policy makers set the Paris temperature goal to limit the devasting climate impacts many around the world are already experiencing. It was set to push countries to higher national ambition. It is clear we need to do more. The ambition set out in the goal for “pursuing efforts to limit the increase to 1.5 degrees” was not vainglorious when set, rather countries did not match it with their efforts. Urgent actions can slow warming rates and push back the time of breaching the Paris 1.5 degree limit. Although breaching the limit is now inevitable, delivering action commensurate with the noble Paris goal is more important than ever.” he added.</p><p>Although useful for measuring current levels of human-induced global warming, the researchers caution against using their method for making predictions on future warming.</p><p>Dr Jarvis, said: “Although atmospheric CO<sub>2</sub> is responsible for the bulk of human-induced warming so far, it is not solely responsible, and we know other factors such as methane could become increasingly important in the future, especially if we encounter climate tipping points. This means we need to keep an eye on our analysis. Fortunately, departures from the current linear regime could provide valuable early warning of such a change.”</p><p>The study is outlined in the paper ‘<a href="https://www.nature.com/articles/s41561-024-01580-5" rel="noopener noreferrer" target="_blank">Estimated human-induced warming from a linear temperature and atmospheric CO<sub>2</sub> relationship</a>’ published in Nature Geoscience.</p><p>DOI:<a href="https://www.nature.com/articles/s41561-024-01580-5" rel="noopener noreferrer" target="_blank">10.1038/s41561-024-01580-5</a></p>          <a href="https://www.lancaster.ac.uk/news/">Back to News</a>
    </section></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Creating a QR Code step by step (237 pts)]]></title>
            <link>https://www.nayuki.io/page/creating-a-qr-code-step-by-step</link>
            <guid>42165862</guid>
            <pubDate>Sun, 17 Nov 2024 18:26:37 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.nayuki.io/page/creating-a-qr-code-step-by-step">https://www.nayuki.io/page/creating-a-qr-code-step-by-step</a>, See on <a href="https://news.ycombinator.com/item?id=42165862">Hacker News</a></p>
Couldn't get https://www.nayuki.io/page/creating-a-qr-code-step-by-step: Error: timeout of 10000ms exceeded]]></description>
        </item>
        <item>
            <title><![CDATA[Lucid dreaming app triples users' awareness in dreams, study finds (120 pts)]]></title>
            <link>https://www.psypost.org/lucid-dreaming-app-triples-users-awareness-in-dreams-study-finds/</link>
            <guid>42165849</guid>
            <pubDate>Sun, 17 Nov 2024 18:24:57 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.psypost.org/lucid-dreaming-app-triples-users-awareness-in-dreams-study-finds/">https://www.psypost.org/lucid-dreaming-app-triples-users-awareness-in-dreams-study-finds/</a>, See on <a href="https://news.ycombinator.com/item?id=42165849">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><p>In a recent study published in <a href="https://www.sciencedirect.com/science/article/abs/pii/S1053810024001260"><em>Consciousness and Cognition</em></a>, researchers at Northwestern University showed that a smartphone app using sensory cues can significantly increase the frequency of lucid dreams—dreams in which a person is aware they are dreaming while still asleep. This study marks the first attempt to apply a lucid-dreaming method called Targeted Lucidity Reactivation outside of a lab environment, demonstrating that even a simple at-home approach can help users experience more lucid dreams.</p><p>Lucid dreaming has drawn increasing public interest for its potential benefits, including enhancing creativity, overcoming nightmares, and providing a space for personal growth and skill practice. Traditional techniques for inducing lucid dreams involve cognitive exercises, such as keeping a dream journal, performing reality checks, and practicing intention-setting before sleep.</p><p>Although these techniques can be effective, they require significant dedication and consistency. A streamlined, at-home approach could make lucid dreaming more accessible to the general public. The researchers wanted to explore whether a simplified, app-based approach using Targeted Lucidity Reactivation—a method previously successful in a controlled lab setting—could be adapted for use outside the lab with minimal technical requirements.</p><p>In Targeted Lucidity Reactivation, participants undergo training to associate a sound cue—such as a tone or melody—with becoming aware that they are dreaming. This same sound is then played during sleep to prompt lucidity within a dream, leveraging the brain’s ability to recognize the cue and reawaken a state of self-awareness while dreaming.</p><p>“I have always been fascinated in lucid dreaming because it provides a space to experience yourself in an entirely new way,” said study author Karen Konkoly, a postdoctoral psychology fellow and member of <a href="https://pallerlab.psych.northwestern.edu/" target="_blank" rel="noopener">Ken Paller’s Cognitive Neuroscience Laboratory</a>.</p><p>“Looking around in a lucid dream, you realize that everything before you is generated by your mind, including your sense of self. Moreover, lucid dreaming is a fascinating model for studying consciousness. Since we’ve been developing more effective ways to induce lucid dreams in the sleep laboratory, we wanted to take a step towards making these advances available for individuals to use on their own.”</p><p>The study consisted of two experiments to test whether a smartphone-based Targeted Lucidity Reactivation method could increase lucid dreaming frequency. The first experiment involved 19 participants, all Android users with a history of dream recall, who completed a one-week protocol involving nightly training with a specialized app. In the second experiment, the researchers recruited a larger sample of 416 participants who used the app for multiple nights, allowing for a more comprehensive look at the effectiveness of Targeted Lucidity Reactivation cues in a diverse group.</p><p>In Experiment 1, participants used an app that played specific sounds—a sequence of beeps or a violin tone—to create an association between these sounds and a lucid state of awareness. Each night before sleep, participants completed a 20-minute training exercise where the app’s sound cues prompted them to enter a “lucid mindset.”</p><p>Once asleep, the app replayed these cues intermittently after a six-hour delay, using a gradual volume increase to avoid sudden awakenings. Participants reported any dreams they remembered each morning, noting if they experienced lucid awareness or incorporated the sound cue into their dream.</p><p>This first experiment found that using the app increased lucid dreaming frequency from an average of 0.74 dreams per week (prior to the study) to 2.11 during the week of app use. Many participants credited the app’s cues with prompting lucidity directly or indirectly.</p><p>Experiment 2 built on these results with a more complex design. This time, participants were divided into three groups to clarify the effect of the Targeted Lucidity Reactivation cues. The first group, receiving cues every night, served as the main experimental group. The second and third groups were control conditions: one received “untrained” cues—sounds not used in the pre-sleep training—and the other received no sound cues on alternate nights. This design helped distinguish increases in lucid dreaming due specifically to Targeted Lucidity Reactivation and those possibly caused by arousal from sound cues in general.</p><p>With 50 participants completing the full seven-night protocol, the study provided insight into the distinct impact of Targeted Lucidity Reactivation cues compared to other sounds. Participants receiving these cues reported significantly more lucid dreams on training nights than those receiving untrained or no cues, reinforcing that pairing cues with lucidity training was essential for effective lucid dreaming.</p><p>“Tweaking sleep opens the door for people to change their dreaming,” Paller said. “We are taking a sleep-engineering approach to using sleep for personal benefits, for practicing skills, solving problems, and for spiritual and personal growth.”</p><p>The combined results from both experiments support Targeted Lucidity Reactivation’s potential as an accessible, smartphone-based method for promoting lucid dreaming. While the cues showed a clear benefit, the study also highlighted challenges, such as the potential for cues to disrupt sleep if mistimed, since the app could not detect when participants entered rapid eye movement (REM) sleep.</p><p>To improve the precision of Targeted Lucidity Reactivation in the future, researchers are considering incorporating wearable technology capable of detecting REM sleep, allowing cues to play at the optimal time for triggering lucidity without disturbing sleep. The Northwestern team has already begun collaborating with InteraXon, the company behind the Muse-S headband, which could allow for more precise sleep-stage detection and improve the effectiveness of the Targeted Lucidity Reactivation method.</p><p>“The app used in this research is under continual development and the latest version can be found in the Google Playstore: <a href="https://play.google.com/store/apps/details?id=com.neurelectrics.dive&amp;hl=en_US&amp;gl=US">https://play.google.com/store/apps/details?id=com.neurelectrics.dive&amp;hl=en_US&amp;gl=US</a>,” Konkoly said. “We are working on making better methods available to the public, but we aren’t there yet. We hope to have more options for people next year.”</p><p>The study, “<a href="https://doi.org/10.1016/j.concog.2024.103759" target="_blank" rel="noopener">Provoking lucid dreams at home with sensory cues paired with pre-sleep cognitive training</a>,” was authored by Karen R. Konkoly, Nathan W. Whitmore, Remington Mallett, Christopher Y. Mazurek, and Ken A. Paller.</p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Show HN: A dynamic C (Hot reloading) module-based Web Framework (114 pts)]]></title>
            <link>https://github.com/joexbayer/c-web-modules</link>
            <guid>42165759</guid>
            <pubDate>Sun, 17 Nov 2024 18:12:14 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/joexbayer/c-web-modules">https://github.com/joexbayer/c-web-modules</a>, See on <a href="https://news.ycombinator.com/item?id=42165759">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto"><h2 tabindex="-1" dir="auto">c-web-modules: Modules for the Web</h2><a id="user-content-c-web-modules-modules-for-the-web" aria-label="Permalink: c-web-modules: Modules for the Web" href="#c-web-modules-modules-for-the-web"></a></p>
<blockquote>
<p dir="auto"><strong>Note:</strong><br>
This project is currently a <strong>proof of concept</strong> and represents the <strong>bare minimum viable product (MVP)</strong>.<br>
It is not designed for production use, and there may be bugs, limitations, or incomplete features.<br>
Use at your own discretion.</p>
</blockquote>
<p dir="auto">Welcome to <strong>c-web-modules</strong>, a modular and efficient approach to web development in C. Inspired by kernel modules and AWS Lambda, this project allows you to upload C code directly to the server, which compiles and deploys it at runtime. No precompilation is necessary, and the server can easily be upgraded to include more features or external libraries.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Addressing the Challenges of C for Web Development</h2><a id="user-content-addressing-the-challenges-of-c-for-web-development" aria-label="Permalink: Addressing the Challenges of C for Web Development" href="#addressing-the-challenges-of-c-for-web-development"></a></p>
<p dir="auto">C isn’t typically the go-to for web development, and there are valid reasons why. Here’s how <strong>c-web-modules</strong> tackles some of the common concerns:</p>
<ol dir="auto">
<li>
<p dir="auto"><strong>Slow Build Cycles</strong>:<br>
Instead of recompiling the entire application, <strong>c-web-modules</strong> allows you to upload raw C code. The server compiles it on-the-fly, enabling rapid iteration and eliminating the need for restarts. This is as close to "hot reloading" as you can get with C.</p>
</li>
<li>
<p dir="auto"><strong>Speed vs. Practicality</strong>:<br>
While raw computation speed might not always be critical for web apps, <strong>c-web-modules</strong> shines in scenarios where performance matters, like handling heavy data processing or real-time applications. Modules let you inject optimized performance-critical code where it’s needed.</p>
</li>
<li>
<p dir="auto"><strong>Manpower and Time-to-Market</strong>:<br>
By automating common server tasks (e.g., routing, module integration, and shared resources like SQLite3), <strong>c-web-modules</strong> reduces boilerplate and accelerates development compared to starting from scratch. It's not as fast as scripting languages, but it's far from the manual grind of traditional C projects.</p>
</li>
<li>
<p dir="auto"><strong>Memory Management and Crashes</strong>:<br>
Modules are isolated and dynamically managed, reducing the risk of crashing the entire server. While C still requires careful memory management, the modular approach lets you focus on smaller, manageable pieces of functionality rather than tackling a monolithic application.</p>
</li>
<li>
<p dir="auto"><strong>Pre-Made Solutions</strong>:<br>
By supporting external libraries like SQLite3, OpenSSL, and Jansson out of the box, <strong>c-web-modules</strong> leverages existing solutions, allowing developers to skip reinventing the wheel and focus on their application's unique needs.</p>
</li>
</ol>
<p dir="auto">This isn’t a silver bullet—it’s a proof of concept. But <strong>c-web-modules</strong> aims to bring C’s raw power into the web world in a more developer-friendly way.</p>
<hr>
<p dir="auto"><h2 tabindex="-1" dir="auto">Example: Counter Module</h2><a id="user-content-example-counter-module" aria-label="Permalink: Example: Counter Module" href="#example-counter-module"></a></p>
<p dir="auto">Here’s a simple example of a module that keeps track of a counter and returns its value every time you visit <code>/counter</code>.
See more examples in the <code>example/</code> folder.</p>
<p dir="auto"><a href="https://github.com/joexbayer/c-web-modules/blob/main/example/websocket.c">Websocket</a></p>
<p dir="auto"><a href="https://github.com/joexbayer/c-web-modules/blob/main/example/chat.c">Chat application</a></p>
<p dir="auto"><a href="https://github.com/joexbayer/c-web-modules/blob/main/example/json.c">JSON</a></p>
<p dir="auto"><a href="https://github.com/joexbayer/c-web-modules/blob/main/example/todo.c">TODO App</a></p>
<p dir="auto">SQLite3 App (TODO)</p>
<p dir="auto"><h4 tabindex="-1" dir="auto"><code>counter.c</code></h4><a id="user-content-counterc" aria-label="Permalink: counter.c" href="#counterc"></a></p>
<div dir="auto" data-snippet-clipboard-copy-content="#include <stdio.h>
#include <cweb.h>

static int counter = 0;
static const char* template = 
    &quot;<html>\n&quot;
    &quot;  <body>\n&quot;
    &quot;    <h1>Counter: %d</h1>\n&quot;
    &quot;  </body>\n&quot;
    &quot;</html>\n&quot;;

/* Route: /counter - Method GET */
static int index_route(struct http_request *req, struct http_response *res) {
    snprintf(res->body, HTTP_RESPONSE_SIZE, template, counter++);
    res->status = HTTP_200_OK;
    return 0;
}

/* Define the routes for the module */
export module_t config = {
    .name = &quot;counter&quot;,
    .author = &quot;cweb&quot;,
    .routes = {
        {&quot;/counter&quot;, &quot;GET&quot;, index_route, NONE},
    },
    .size = 1,
};"><pre><span>#include</span> <span>&lt;stdio.h&gt;</span>
<span>#include</span> <span>&lt;cweb.h&gt;</span>

<span>static</span> <span>int</span> <span>counter</span> <span>=</span> <span>0</span>;
<span>static</span> <span>const</span> <span>char</span><span>*</span> <span>template</span> <span>=</span> 
    <span>"&lt;html&gt;\n"</span>
    <span>"  &lt;body&gt;\n"</span>
    <span>"    &lt;h1&gt;Counter: %d&lt;/h1&gt;\n"</span>
    <span>"  &lt;/body&gt;\n"</span>
    <span>"&lt;/html&gt;\n"</span>;

<span>/* Route: /counter - Method GET */</span>
<span>static</span> <span>int</span> <span>index_route</span>(<span>struct</span> <span>http_request</span> <span>*</span><span>req</span>, <span>struct</span> <span>http_response</span> <span>*</span><span>res</span>) {
    <span>snprintf</span>(<span>res</span><span>-&gt;</span><span>body</span>, <span>HTTP_RESPONSE_SIZE</span>, <span>template</span>, <span>counter</span><span>++</span>);
    <span>res</span><span>-&gt;</span><span>status</span> <span>=</span> <span>HTTP_200_OK</span>;
    <span>return</span> <span>0</span>;
}

<span>/* Define the routes for the module */</span>
<span>export</span> <span>module_t</span> <span>config</span> <span>=</span> {
    .<span>name</span> <span>=</span> <span>"counter"</span>,
    .<span>author</span> <span>=</span> <span>"cweb"</span>,
    .<span>routes</span> <span>=</span> {
        {<span>"/counter"</span>, <span>"GET"</span>, <span>index_route</span>, <span>NONE</span>},
    },
    .<span>size</span> <span>=</span> <span>1</span>,
};</pre></div>
<hr>
<p dir="auto"><h2 tabindex="-1" dir="auto">Why Use c-web-modules?</h2><a id="user-content-why-use-c-web-modules" aria-label="Permalink: Why Use c-web-modules?" href="#why-use-c-web-modules"></a></p>
<ol dir="auto">
<li><strong>Code Deployment</strong>: Upload raw C code to the server for on-the-fly compilation and deployment.</li>
<li><strong>No Precompilation</strong>: Simplify your workflow—focus on writing code, and let the server handle compilation.</li>
<li><strong>Dynamic Updates</strong>: Add or replace functionality without downtime or recompiling the entire server.</li>
<li><strong>Performance</strong>: Written in C, the server offers unmatched speed and efficiency.</li>
<li><strong>WebSocket Support</strong>: Even when modules are updated, existing WebSocket connections remain alive.</li>
<li><strong>Built-In Features</strong>: Includes a cross-module cache and scheduler for deferred tasks.</li>
</ol>
<p dir="auto">Currently supported external libraries:</p>
<ul dir="auto">
<li><strong>OpenSSL</strong>: Currently only for hashing, but later for secure communication.</li>
<li><strong>SQLite3</strong>: Shared by all modules for lightweight database needs.</li>
<li><strong>Jansson</strong>: For easy JSON parsing and manipulation.</li>
</ul>
<hr>
<p dir="auto"><h2 tabindex="-1" dir="auto">Deployment</h2><a id="user-content-deployment" aria-label="Permalink: Deployment" href="#deployment"></a></p>
<p dir="auto">Deploying code to the server is simple and can be done in multiple ways, depending on your workflow.</p>
<p dir="auto"><h3 tabindex="-1" dir="auto">1. Basic Deployment with <code>curl</code></h3><a id="user-content-1-basic-deployment-with-curl" aria-label="Permalink: 1. Basic Deployment with curl" href="#1-basic-deployment-with-curl"></a></p>
<p dir="auto">At its core, deploying code to the server involves sending a POST request with the C file attached. Here’s an example using <code>curl</code>:</p>
<p dir="auto"><code>curl -X POST -F "code=@path/to/yourcode.c" http://localhost:8080/mgnt</code></p>
<p dir="auto"><h3 tabindex="-1" dir="auto">2. Using the cweb script and .ini config</h3><a id="user-content-2-using-the-cweb-script-and-ini-config" aria-label="Permalink: 2. Using the cweb script and .ini config" href="#2-using-the-cweb-script-and-ini-config"></a></p>
<p dir="auto">The script handles:</p>
<ul dir="auto">
<li>Sending the file to the server using <code>curl</code>.</li>
<li>Parsing responses for success or failure.</li>
<li>Providing helpful logs and error messages.</li>
</ul>
<p dir="auto"><h4 tabindex="-1" dir="auto">Deploying Multiple Files with a Config File</h4><a id="user-content-deploying-multiple-files-with-a-config-file" aria-label="Permalink: Deploying Multiple Files with a Config File" href="#deploying-multiple-files-with-a-config-file"></a></p>
<p dir="auto"><code>./cweb deploy path/to/yourcode.c</code></p>
<p dir="auto">You can deploy multiple modules in one go using a configuration file. By default, the script looks for a file named <code>routes.ini</code>.</p>
<p dir="auto">Example <code>routes.ini</code> file:</p>
<div dir="auto" data-snippet-clipboard-copy-content="server_url=http://localhost:8080/mgnt

[modules]
example1.c
example2.c"><pre><span>server_url</span>=http://localhost:8080/mgnt

<span>[modules]</span>
example1.c
example2.c</pre></div>
<p dir="auto">When using the .ini files you run: <code>./cweb deploy</code></p>
<p dir="auto"><h3 tabindex="-1" dir="auto">Errors</h3><a id="user-content-errors" aria-label="Permalink: Errors" href="#errors"></a></p>
<p dir="auto">Error messages are forwarded back to you over http.</p>
<hr>
<p dir="auto"><h2 tabindex="-1" dir="auto">Build it yourself!</h2><a id="user-content-build-it-yourself" aria-label="Permalink: Build it yourself!" href="#build-it-yourself"></a></p>
<blockquote>
<p dir="auto"><strong>Note:</strong><br>
MacOS support is not guaranteed!</p>
</blockquote>
<p dir="auto">The project depends on:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# Linux
sudo apt-get install libssl-dev
sudo apt-get install libsqlite3-dev
sudo apt-get install libjansson-dev

# MacOS
brew install openssl@3
brew install sqlite
brew install jansson"><pre><span><span>#</span> Linux</span>
sudo apt-get install libssl-dev
sudo apt-get install libsqlite3-dev
sudo apt-get install libjansson-dev

<span><span>#</span> MacOS</span>
brew install openssl@3
brew install sqlite
brew install jansson</pre></div>
<p dir="auto">Run make to compile and make run to start the server.</p>

<p dir="auto"><h2 tabindex="-1" dir="auto">Docker</h2><a id="user-content-docker" aria-label="Permalink: Docker" href="#docker"></a></p>
<div dir="auto" data-snippet-clipboard-copy-content="docker-compose up --build"><pre>docker-compose up --build</pre></div>
<p dir="auto"><h2 tabindex="-1" dir="auto">How is c-web-modules different from Apache Modules and ISAPI Extensions?</h2><a id="user-content-how-is-c-web-modules-different-from-apache-modules-and-isapi-extensions" aria-label="Permalink: How is c-web-modules different from Apache Modules and ISAPI Extensions?" href="#how-is-c-web-modules-different-from-apache-modules-and-isapi-extensions"></a></p>
<p dir="auto">Unlike Apache modules and ISAPI extensions, which are tightly integrated into the server and require configuration changes followed by a server restart or reload, <strong>c-web-modules</strong> offers runtime flexibility.</p>
<p dir="auto"><strong>Key Differences:</strong></p>
<ul dir="auto">
<li>
<p dir="auto"><strong>Dynamic Deployment</strong>:<br>
c-web-modules allows you to upload raw C code directly to the server, which compiles and integrates it into the running application without restarts. Neither Apache modules nor ISAPI extensions support this level of runtime modification.</p>
</li>
<li>
<p dir="auto"><strong>Module Isolation</strong>:<br>
Each module in c-web-modules is independently managed, minimizing the risk of crashing the entire server.</p>
</li>
<li>
<p dir="auto"><strong>WebSocket Updates</strong>:<br>
WebSocket handlers can be updated at runtime without breaking existing connections, a feature not typically available in Apache modules or ISAPI.</p>
</li>
</ul>
<p dir="auto">This makes <strong>c-web-modules</strong> suitable for rapid experimentation and modular design, especially in scenarios requiring frequent updates without disrupting service.</p>
</article></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[AlphaProof's Greatest Hits (227 pts)]]></title>
            <link>https://rishimehta.xyz/2024/11/17/alphaproofs-greatest-hits.html</link>
            <guid>42165397</guid>
            <pubDate>Sun, 17 Nov 2024 17:20:45 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://rishimehta.xyz/2024/11/17/alphaproofs-greatest-hits.html">https://rishimehta.xyz/2024/11/17/alphaproofs-greatest-hits.html</a>, See on <a href="https://news.ycombinator.com/item?id=42165397">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
      

      <main aria-label="Content">
        <div>
          <article itemscope="" itemtype="http://schema.org/BlogPosting">

  

  <div itemprop="articleBody">
    



<p>Here I’ll try to explain the coolest ideas in each of <a href="https://deepmind.google/discover/blog/ai-solves-imo-problems-at-silver-medal-level/">AlphaProof</a>’s IMO 2024 solutions. AlphaProof produces proofs in <a href="https://leanprover.github.io/">Lean</a>, and each Lean proof is composed of a series of tactics. So I’ll pick out the tactics that correspond to these ideas in the proofs for problems 1, 2 and 6 (the three problems that AlphaProof solved). AlphaProof has developed its own proving style, so figuring out what it’s doing can involve some detective work.</p>

<!--more-->

<p>If you’re not familiar with the problems already, I recommend trying them yourself, and then maybe reading <a href="https://web.evanchen.cc/exams/IMO-2024-notes.pdf">Evan Chen’s solution notes</a>, or watching these <a href="https://youtube.com/playlist?list=PLSa4NIW1yxdg7xoEL2x8wGzci0t8h51nN&amp;si=-GB9q9hreFBD7eOI">videos</a> that give an intuition for some of the human solutions. The full AlphaProof solutions, annotated by <a href="https://deepmind.google/discover/blog/ai-solves-imo-problems-at-silver-medal-level/#:~:text=Oliver%20Nash%2C%20Bhavik%20Mehta%2C%20Paul%20Lezeau%2C%20Salvatore%20Mercuri%2C%20Lawrence%20Wu%2C%20Calle%20Soenne%2C%20Thomas%20Murrills%2C%20Luigi%20Massacci%20and%20Andrew%20Yang%20advised%20and%20contributed%20as%20Lean%20experts">Lean experts</a>, are available <a href="https://storage.googleapis.com/deepmind-media/DeepMind.com/Blog/imo-2024-solutions/index.html">here</a> - I will only include snippets of the proofs in this post.</p>

<ul id="markdown-toc">
  <li><a href="#problem-1" id="markdown-toc-problem-1">Problem 1</a>    <ul>
      <li><a href="#problem" id="markdown-toc-problem">Problem</a></li>
      <li><a href="#solution" id="markdown-toc-solution">Solution</a></li>
    </ul>
  </li>
  <li><a href="#problem-2" id="markdown-toc-problem-2">Problem 2</a>    <ul>
      <li><a href="#problem-1" id="markdown-toc-problem-1">Problem</a></li>
      <li><a href="#solution-1" id="markdown-toc-solution-1">Solution</a></li>
    </ul>
  </li>
  <li><a href="#problem-6" id="markdown-toc-problem-6">Problem 6</a>    <ul>
      <li><a href="#problem-2" id="markdown-toc-problem-2">Problem</a></li>
      <li><a href="#solution-2" id="markdown-toc-solution-2">Solution</a></li>
    </ul>
  </li>
  <li><a href="#postscript" id="markdown-toc-postscript">Postscript</a></li>
</ul>

<h2 id="problem-1">Problem 1</h2>

<h3 id="problem">Problem</h3>
<p>Determine all real numbers $\alpha$ such that, for every positive integer $n$, the integer</p><p>

\[\lfloor \alpha \rfloor + \lfloor 2\alpha \rfloor + \dots +\lfloor n\alpha \rfloor\]

</p><p>is a multiple of $n$. (Note that $\lfloor z \rfloor$ denotes the greatest integer less than or equal to $z$. For example, $\lfloor -\pi \rfloor = -4$ and $\lfloor 2 \rfloor = \lfloor 2.9 \rfloor = 2$.)</p>

<h3 id="solution">Solution</h3>

<p>The answer turns out to be the set of even integers. Reminder that the way AlphaProof solves these problems is by proposing many solution candidates, attempting to prove and disprove each of them, and then eventually finding a proof only for the correct answer. The proof we’re looking at here is the one that proves that the answer is the set of even integers.</p>

<p>Showing that the even integers satisfy the given property is trivial, the hard part of this proof is to show that no $\alpha$ except the even integers can satisfy it. AlphaProof does this in an interesting (if convoluted) way. It first sets up an integer $\ell$ such that $2\ell = \lfloor\alpha\rfloor + \lfloor2\alpha\rfloor$. This is possible because we know the RHS is even by substituting $n=2$ into the given property.</p>

<figure><pre><code data-lang="lean"><span>exists</span><span>λ</span><span>x</span> <span>L</span><span>=&gt;</span>(<span>L</span> <span>2</span> <span>two_pos</span>)<span>.</span><span>rec</span> <span>λ</span><span>l</span> <span>Y</span><span>=&gt;</span><span>?</span><span>_</span></code></pre></figure>

<p><code>L 2</code> is where the given property is used with $n=2$. As an aside, AlphaProof often mashes several tactics together in a single line like this. A more comprehensible version that accomplishes the same thing is</p>

<figure><pre><code data-lang="lean"><span>constructor</span>
<span>·</span> <span>intro</span> <span>x</span> <span>L</span>
  <span>obtain</span> <span>⟨</span><span>l</span>, <span>Y</span><span>⟩</span> := <span>L</span> <span>2</span> (<span>by</span> <span>exact</span> <span>two_pos</span>)</code></pre></figure>

<p>Note that we’ve also renamed $\alpha$ to <code>x</code>.
Next, it claims (and goes on to prove) that for all natural numbers $n$,</p><p>

\[\lfloor (n + 1)\:\alpha \rfloor = \lfloor \alpha \rfloor + 2n\:(\ell - \lfloor \alpha \rfloor) \tag{1} \label{eq:claim}\]

</p><figure><pre><code data-lang="lean"><span>suffices</span>: <span>∀</span> (<span>n</span> : <span>ℕ</span>),<span>⌊</span>(<span>n</span><span>+</span><span>1</span>)<span>*</span><span>x</span><span>⌋</span> <span>=</span><span>⌊</span> <span>x</span><span>⌋</span><span>+</span><span>2</span> <span>*</span> <span>↑</span> (<span>n</span> : <span>ℕ</span>) <span>*</span> (<span>l</span><span>-</span>(<span>⌊</span>(<span>x</span>)<span>⌋</span>))</code></pre></figure>

<p>From this, it is able to show that $\alpha = 2\,(\ell-\lfloor\alpha\rfloor)$.</p>

<figure><pre><code data-lang="lean"><span>use</span>(<span>l</span><span>-</span><span>⌊</span><span>x</span><span>⌋</span>)<span>*</span><span>2</span></code></pre></figure>

<p>which has to be an even integer (since it’s 2 multiplied by an integer).</p>

<p>The way in which it proves these things involves some rather elaborate simplifications. But setting up the claim in \eqref{eq:claim} is the impressive bit that makes the rest of the proof work. To my eyes, the motivation for this claim is rather unintuitive, and the fact that it all works out is almost magical.</p>

<p>AlphaProof’s full solution is <a href="https://storage.googleapis.com/deepmind-media/DeepMind.com/Blog/imo-2024-solutions/P1/index.html">here</a>.</p>

<h2 id="problem-2">Problem 2</h2>

<h3 id="problem-1">Problem</h3>

<p>Find all positive integer pairs $(a,b)$ such that there exist positive integers $g$ and $N$ where</p><p>

\[\gcd\,(a^n + b, b^n + a) = g\]

</p><p>holds for all integers $n \geq N$.</p>

<h3 id="solution-1">Solution</h3>

<p>AlphaProof correctly proposes that $(1, 1)$ is the only solution. To show that no other solution can work, it asks us to consider the number $ab + 1$. It claims (and later proves) that $ab + 1$ must divide $g$.</p>

<figure><pre><code data-lang="lean"><span>suffices</span>:<span>b</span><span>.1*</span><span>b</span><span>.2+</span><span>1</span><span>∣</span><span>Y</span></code></pre></figure>

<p>Note that in its infinite wisdom, AlphaProof decides to rename pairs $(a, b)$ to <code>b</code>, so that it must reference the elements as <code>b.1</code> and <code>b.2</code>. It has also chosen, for reasons best known to itself, to rename the variable $g$ to <code>Y</code>.</p>

<p>Now, selecting $n=N \phi(ab+1)$, we get</p><p>

\[(ab + 1) \mid (a^{N\phi(ab + 1)} + b) \text{ and } (ab + 1) \mid (b^{N\phi(ab + 1)} + a)\]

</p><p>The fact that $ab + 1$ is coprime to $a$ and $b$ makes it so that we can apply <a href="https://en.wikipedia.org/wiki/Euler%27s_theorem">Euler’s theorem</a>, ie</p><p>

\[a^{\phi(ab+1)} \equiv 1 \pmod{ab+1}\]

\[b^{\phi(ab+1)} \equiv 1 \pmod{ab+1}\]

</p><p>So we have $ab + 1 \mid 1 + b$ and $ab + 1 \mid 1 + a$, from which it follows that $a = b = 1$.</p>

<p>This strategy closely follows human proofs to this problem. The choice to consider $ab + 1$ is the clever idea that sets up the proof.</p>

<p>AlphaProof’s full solution is <a href="https://storage.googleapis.com/deepmind-media/DeepMind.com/Blog/imo-2024-solutions/P2/index.html">here</a>.</p>

<h2 id="problem-6">Problem 6</h2>

<h3 id="problem-2">Problem</h3>
<p>Let $\mathbb{Q}$ be the set of rational numbers. A function $f: \mathbb{Q} \to \mathbb{Q}$ is called <em>aquaesulian</em> if the following property holds: for every $x,y \in \mathbb{Q}$,</p><p>

\[f(x+f(y)) = f(x) + y \quad \text{or} \quad f(f(x)+y) = x + f(y).\]

</p><p>Show that there exists an integer $c$ such that for any aquaesulian function $f$ there are at most $c$ different rational numbers of the form $f(r) + f(-r)$ for some rational number $r$, and find the smallest possible value of $c$.</p>

<h3 id="solution-2">Solution</h3>

<p>AlphaProof finds the answer $c=2$. It breaks the proof into two parts. First, it shows that $c \leq 2$, by showing that $f(r) + f(-r)$ can either be $0$ or some singular other value. This part of the proof is quite elaborate, and makes clever use of the given aquaesulian properties.</p>

<p>Once this is done, $c$ can be either $1$ or $2$. To show that $c=2$, AlphaProof proposes an aquaesulian function $f$ that takes on two different values for  $f(r) + f(-r)$.</p><p>

\[f(x) = -x + 2⌈x⌉\]

</p><figure><pre><code data-lang="lean"><span>specialize</span> <span>V</span> <span>$</span> <span>λ</span> <span>N</span><span>=&gt;-</span><span>N</span><span>+</span><span>2</span> <span>*</span><span>Int</span><span>.</span><span>ceil</span> <span>N</span></code></pre></figure>

<p>It then shows that $f(-1) + f(1) = 0$ and $f(1/2) + f(-1/2) = 2$, which gives us the two distinct values we need.</p>

<figure><pre><code data-lang="lean"><span>use</span> <span>Finset</span><span>.</span><span>one_lt_card</span><span>.2</span><span>$</span> <span>by</span> <span>exists</span><span>@</span><span>0</span>,<span>V</span><span>.1.</span><span>mem_toFinset</span><span>.2</span> (<span>by</span> <span>exists</span><span>-</span><span>1</span>),<span>2</span>,<span>V</span><span>.1.</span><span>mem_toFinset</span><span>.2</span> (<span>by</span> <span>exists</span> <span>1</span><span>/</span><span>2</span>)</code></pre></figure>

<p>Again, lots of stuff mashed into one line, but <code>by exists -1</code> and <code>by exists 1/2</code> are where it shows the two distinct values.</p>

<p>This is a remarkable function to have constructed! And it’s pretty hard to find. Only 5/509 participants solved P6, and notably Tim Gowers gave it a bit of a shot while judging this solution and didn’t find a function that gave two distinct values.</p>

<p>AlphaProof’s full solution is <a href="https://storage.googleapis.com/deepmind-media/DeepMind.com/Blog/imo-2024-solutions/P6/index.html">here</a>.</p>

<h2 id="postscript">Postscript</h2>

<p>Having now digested several AlphaProof solutions, I still find it remarkable that a machine is able to find proofs like this. Finding these mathematical ideas is hard enough, and having to prove them in Lean makes things even harder.</p>

<p>At an IMO afterparty, some of us from the AlphaProof team had fun with signing the best tactic from each proof.</p>

<p><img src="https://rishimehta.xyz/assets/p1_tactic.jpg" alt="p1 tactic">
<img src="https://rishimehta.xyz/assets/p2_tactic.jpg" alt="p2 tactic">
<img src="https://rishimehta.xyz/assets/p6_tactic.jpg" alt="p6 tactic"></p>

<p>I discussed the P6 solution in some more detail on the <a href="https://youtu.be/uX6ceY1vcUg?si=d9LY1QvdQ-yeppPK&amp;t=1845">No Priors podcast</a>.</p>

<p>Thanks to the <a href="https://deepmind.google/discover/blog/ai-solves-imo-problems-at-silver-medal-level/#:~:text=Oliver%20Nash%2C%20Bhavik%20Mehta%2C%20Paul%20Lezeau%2C%20Salvatore%20Mercuri%2C%20Lawrence%20Wu%2C%20Calle%20Soenne%2C%20Thomas%20Murrills%2C%20Luigi%20Massacci%20and%20Andrew%20Yang%20advised%20and%20contributed%20as%20Lean%20experts">Lean experts</a> who translated the cryptic Lean proofs into English, and Bhavik, Oliver and Paul in particular for suggesting impressive lines in the proofs.</p>

  </div>
</article>

        </div>
      </main>
    </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Good Software Development Habits (335 pts)]]></title>
            <link>https://zarar.dev/good-software-development-habits/</link>
            <guid>42165057</guid>
            <pubDate>Sun, 17 Nov 2024 16:34:26 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://zarar.dev/good-software-development-habits/">https://zarar.dev/good-software-development-habits/</a>, See on <a href="https://news.ycombinator.com/item?id=42165057">Hacker News</a></p>
<div id="readability-page-1" class="page">
  
  <header>
    <a href="https://zarar.dev/">
      <h2>
        Zarar's blog
      </h2>
    </a>
    <nav>
      <p><a href="https://zarar.dev/">Home</a>
<a href="https://zarar.dev/me/">Me</a>
<a href="https://zarar.dev/subscribe/">Subscribe</a></p>

    </nav>
  </header>
  <main>
    

    
        
    

    
        

        <p>
            <i>
                <time datetime="2024-09-05T13:00Z">
                    05 Sep, 2024
                </time>
            </i>
        </p>
    

    <p>This post is not advice, it's what's working for me.</p>
<p>It's easy to pick up bad habits and hard to create good ones. Writing down what's working for me helps me maintain any good habits I've worked hard to develop. Here's an unordered list of 10 things that have helped me increase speed and maintain a respectable level of quality in the product I'm currently developing.</p>
<ol>
<li><p>Keep commits small enough that you wonder if you're taking this "keep commits small" thing a little too far. You just never know when you have to revert a particular change and there's a sense of bliss knowing where you introduced a bug six days ago and only reverting that commit without going through the savagery of merge conflicts. My rule of thumb: compiling software should be commitable.</p>
</li>
<li><p>Live Kent Beck's <a href="https://x.com/KentBeck/status/250733358307500032?lang=en">holy words of wisdom</a>: "for each desired change, make the change easy (warning: this may be hard), then make the easy change". Aim for at least half of all commits to be refactorings. Continuous refactoring is thinking of changes I can make in under 10 minutes that improve something. Doing this pays off whenever a bigger requirement comes in and you find yourself making a small change to satisfy it only because of those smaller improvements. Big refactorings are a bad idea.</p>
</li>
<li><p>All code is a liability. Undeployed code is the grim reaper of liabilities. I need to know if it works or at least doesn't break anything. Tests give you confidence, production gives you approval. The hosting costs might rack up a little with so many deploys but it's a small price to pay for knowing the last thing you did was a true sign of progression. <em>Working software is the primary measure of progress</em>, says one of the <a href="https://agilemanifesto.org/principles.html">agile principles</a>. Working and progress are doing a lot of heavy lifting in that sentence, so I've defined them for myself. Working is something being working enough to be deployed, and if it's code that's contributing to a capability, that's progress.</p>
</li>
<li><p>Know when you're testing the framework's capability. If you are, don't do it. The framework is already tested by people who know a lot more than you, and you have to trust them that the <code>useState()</code> hook does what it's supposed to do. If you keep components small, then you reduce the need for a lot of tests as the framework will be doing most of the heavy lifting in the component. If the component is big, then you introduce more complexity and now you need to write a lot of tests.</p>
</li>
<li><p>If a particular function doesn't fit anywhere, create a new module (or class or component) for it and you'll find a home for it later. It's better to create a new independent construct than to jam it into an existing module where you know deep down it doesn't make sense. Worst comes to worst, it lives as an independent module which isn't too bad anyway.</p>
</li>
<li><p>If you don't know what an API should look like, write the tests first as it'll force you to think of the "customer" which in this case is you. You'll invariably discover cases that you would not have thought of if you had just written the code first and tests after. You don't have to be religious about TDD and it's OK to work in larger batches (e.g., write more than just a couple lines of code before making it pass).  The amount of code to write in a red/failing state doesn't always have to be small. You know what you're doing, don't let dogma get in the way of productivity.</p>
</li>
<li><p>Copy-paste is OK once. The second time you're introducing duplication (i.e., three copies), don't. You should have enough data points to create a good enough abstraction. The risk of diverging implementations of the same thing is too high at this point, and consolidation is needed.  It's better to have some wonky parameterization than it is to have multiple implementations of nearly the same thing. Improving the parameters will be easier than to consolidate four different implementations if this situation comes up again.</p>
</li>
<li><p>Designs get stale. You can slow the rate at which they get stale by refactoring, but ultimately you'll need to change how things work. Don't feel too bad about moving away from something that was dear to you a while ago and something you felt proud about at the time.  You did the right thing then and shouldn't beat yourself up for not getting it right enough that you wouldn't need to change anything. Most of the time writing software is changing software. Just accept it and move on. There's no such thing as the perfect design, and change is at the core of software development. How good you are at changing things is how good you are at software development.</p>
</li>
<li><p>Technical debt can be classified into three main types: 1) things that are preventing you from doing stuff now, 2) things that will prevent you from doing stuff later, and 3) things that <em>might</em> prevent you from doing stuff later. Every other classification is a subset of these three. Minimize having lots of stuff in #1 and try to focus on #2. Ignore #3.</p>
</li>
<li><p>Testability is correlated with good design. Something not being easily testable hints that the design needs to be changed. Sometimes that design is your test design. As an example, if you find yourself finding it difficult to mock <code>em.getRepository(User).findOneOrFail({id})</code>, then chances are you either need to put that call into its own function that can be mocked, or write a test utility which allows for easier mocking of the entity manager methods. Tests go unwritten when it's hard to test, not because you don't want to test.</p>
</li>
</ol>
<p>There's probably a lot more, but 10 is a nice number.</p>


    

    
        

        
            


        
    


  </main>
  

</div>]]></description>
        </item>
    </channel>
</rss>