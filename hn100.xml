<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
    <channel>
        <title>HN100 - Readable Contents</title>
        <link>https://hn.algolia.com/api/v1/search_by_date?tags=%28story,poll%29&amp;numericFilters=points%3E100</link>
        <description>Uses Readability to add bodies to the RSS feed</description>
        <lastBuildDate>Wed, 01 Nov 2023 15:00:06 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Improving deep sleep may prevent dementia, study finds (111 pts)]]></title>
            <link>https://www.monash.edu/news/articles/improving-deep-sleep-may-prevent-dementia,-study-finds</link>
            <guid>38097184</guid>
            <pubDate>Wed, 01 Nov 2023 12:07:32 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.monash.edu/news/articles/improving-deep-sleep-may-prevent-dementia,-study-finds">https://www.monash.edu/news/articles/improving-deep-sleep-may-prevent-dementia,-study-finds</a>, See on <a href="https://news.ycombinator.com/item?id=38097184">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="main" role="main">
                                                    
                                                            
                                    <!-- Social Media Share Bar: Not Configured -->                         

    
    
        
    <!-- News Article Contents -->
                <p><img src="https://www.monash.edu/__data/assets/image/0004/3440083/Matthew_Pase-LOW-RES.jpg" alt="" width="555" height="555"></p><p>Associate Professor Matthew Pase</p><p>As little as 1 per cent reduction in deep sleep per year for people over 60 years of age translates into a 27 per cent increased risk of dementia, according to a Monash study which suggests that enhancing or maintaining deep sleep, also known as slow wave sleep, in older years could stave off dementia.</p><p>The study, led by Associate Professor Matthew Pase, from the Monash School of Psychological Sciences and the Turner Institute for Brain and Mental Health in Melbourne, Australia, and published today in <a href="https://doi.org/10.1001/jamaneurol.2023.3889"><em>JAMA Neurology</em></a>, looked at 346 participants, over 60 years of age, enrolled in the Framingham Heart Study who completed two overnight sleep studies in the time periods 1995 to 1998 and 2001 to 2003, with an average of five years between the two studies.</p><p>These participants were then carefully followed for dementia from the time of the second sleep study through to 2018. The researchers found, on average, that the amount of deep sleep declined between the two studies, indicating slow wave sleep loss with ageing. Over the next 17 years of follow-up, there were 52 cases of dementia. Even adjusting for age, sex, cohort, genetic factors, smoking status, sleeping medication use, antidepressant use, and anxiolytic use, each percentage decrease in deep sleep each year was associated with a 27 per cent increase in the risk of dementia.</p><p>“Slow-wave sleep, or deep sleep, supports the ageing brain in many ways, and we know that sleep augments the clearance of metabolic waste from the brain, including facilitating the clearance of proteins that aggregate in Alzheimer’s disease,” Associate Professor Pase said.</p><p>“However, to date we have been unsure of the role of slow-wave sleep in the development of dementia. Our findings suggest that slow wave sleep loss may be a modifiable dementia risk factor.”</p><p>Associate Professor Pase said that the Framingham Heart Study is a unique community-based cohort with repeated overnight polysomnographic (PSG) sleep studies and uninterrupted surveillance for incident dementia.</p><p>“We used these to examine how slow-wave sleep changed with ageing and whether changes in slow-wave sleep percentage were associated with the risk of later-life dementia up to 17 years later,” he said.</p><p>“We also examined whether genetic risk for Alzheimer’s Disease or brain volumes suggestive of early neurodegeneration were associated with a reduction in slow-wave sleep. We found that a genetic risk factor for Alzheimer’s disease, but not brain volume, was associated with accelerated declines in slow wave sleep.”</p><p>Read the full paper in JAMA Neurology: <em>Association Between Slow-Wave Sleep Loss and Incident Dementia</em>. DOI: <a href="https://doi.org/10.1001/jamaneurol.2023.3889">10.1001/jamaneurol.2023.3889</a></p>
        
    <!-- Related Links -->
    

    <!-- magenta -->
                        
                                            <!-- /.content --></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Sentry: From the Beginning (122 pts)]]></title>
            <link>https://cra.mr/sentry-from-the-beginning/</link>
            <guid>38096955</guid>
            <pubDate>Wed, 01 Nov 2023 11:35:31 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://cra.mr/sentry-from-the-beginning/">https://cra.mr/sentry-from-the-beginning/</a>, See on <a href="https://news.ycombinator.com/item?id=38096955">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><p><em>I’ve been trying to invest more and more of my free time interacting with founders. I genuinely feel we’ve been through a lot with Sentry and I can provide some useful value to others. More so, I believe most people in this industry, most successful people, do others a disservice but not having honest conversations about the hardships and endurance it takes to succeed. As part of that I thought it’d be interesting, or at least therapeutic, to talk about some of the history in written form. I previously wrote about <a href="https://cra.mr/funding-sentry">Sentry’s Seed Funding</a>, but I want to go deeper on some other topics this time around. I’m not entirely sure what future topics I’ll cover, but hopefully you’ll find some value in it.</em></p>
<p>In today’s episode, let’s talk about Sentry’s origin, the early days iteration, and how we eventually started the business. If you have a side project you enjoy hacking on, or maybe you’re in the early stages of product-market-fit, this might be for you.</p>
<p>Sentry starts long before Sentry, with a once known project aptly named <a href="https://github.com/dcramer/django-db-log"><code>django-db-log</code></a>. Somewhere circa early 2008, on a long since forgotten chat medium called IRC. There was a small group of individuals - passionate individuals like <a href="https://simonwillison.net/2008/May/13/djangodblog/">Simon Willison</a> - who used to hang out in a channel called <code>#django-users</code>, and I was one of them. An anonymous user asked a simple question: how would you record errors to a dashboard? I obliged them with some <a href="https://github.com/dcramer/django-db-log/commit/3c2e87573d3bd16f61cf08fece0638cc47a4fc22">example code</a>, created a repository out of it, and the project was born. It’s not an overly interesting origin story, and its not filled with hardships, but its a very simple beginning.</p>
<p><img src="https://cra.mr/assets/sentry/django-sentry-details.png" alt="django-sentry"></p>
<p>Over the years I worked on a lot of open source. I <a href="https://cra.mr/work-life-balance">genuinely enjoy building things</a>, and Django was the community that really drew me in. I was fortunate enough that <em>no one cared about open source</em> so I could open source just about anything I worked on, whether it was from my side projects or random utilities I built at work. Over those early years, I open sourced dozens of small projects, many being extensions to the Django web framework: <a href="https://github.com/dcramer/django-devserver"><code>django-devserver</code></a>, <a href="https://github.com/dcramer/django-sphinx"><code>django-sphinx</code></a>, and <a href="https://github.com/dcramer/django-uuidfield"><code>django-uuidfield</code></a> for example. Of course <code>django-db-log</code> makes that list, but it focused on a passion I didn’t recognize at the time. That passion was solving my own problems- making my own work less tedious, my own day-to-day less frustrating. That passion, and that yearn for community, that more than anything else is what I contribute to both my personal success, as well as the success of our now business.</p>
<p>Eventually projects like <code>django-db-log</code> led to career opportunities. I have a vivid memory of going into an interview at Disqus (a startup I joined in 2010), watching them install the dependencies, and seeing several with my name on them. I had already interviewed and passed the assessment before I even talked to the team, and that’s a big deal for me given I am self-taught, come from rural America, and generally speaking have not had access to a lot of opportunities outside of ones I’ve created. That moment, and several other similar stories, are why I’ve been such a long believer in the power of Open Source for an individual’s career. As alluded, I joined Disqus, my first experience working at a “real” startup.</p>
<p><img src="https://cra.mr/assets/disqus-title-slide.png" alt="Disqus"></p>
<p><a href="https://en.wikipedia.org/wiki/Disqus">Disqus</a> was an interesting learning ground for me. Going in I was ambitious and productive, but you don’t know what you don’t know, and at that age there was <em>a lot</em> I didn’t know. It’s the era where I learned (and eventually preached) the value of testing. It’s when I met many of my former colleagues who have become lifelong friends, some of whom still work at Sentry. Most importantly, it’s the era that allowed me to significantly expand my career options, both by investing time into projects like <code>django-db-log</code>, as well as speaking at various Python conferences. Disqus was also an enabler to my open source contributions, and importantly they relied on <code>django-db-log</code>. That meant that at various times I had <em>a financially motivated</em> reason to invest more time into it. As an example, in the early days (in fact, this might have been my first week on the job) I took down the entire platform. I don’t recall why, but I do recall it being extra painful due to <code>django-db-log</code>’s inability to scale. It couldn’t handle the huge volume of errors I had just thrown at it, and based on how little email we could receive over the next day, nor could gmail handle the amount of alerts that it generated.</p>
<p>If I had to pick the single most important event for Sentry, it would be this real-world use of the project at my full-time job. It meant investment in the project was based on practicalities, based on what we actually needed it to do at the organization. It meant that investments being made into the project were being made <em>for myself</em> to <em>improve my own day-to-day</em> as well as those of my team. I worked at Disqus from mid 2010 to early 2013, a little under three years. It was in that time that we decided to rename the project (first to <code>django-sentry</code> and eventually to <em>Sentry</em>). It was also at that time that we decided to bootstrap the company.</p>
<p>I don’t recall exactly when we started development on the cloud services for Sentry, but I do recall being thoroughly uninformed about what it’d take to launch a software-as-a-service company. You see, I had been pitched the idea of launching an AddOn on Heroku by one of the at-the-time PMs. It seemed like an easy concept: make Sentry easy to run on Heroku and make a few bucks. The ambitions were high at the time: “beer money” specifically is how I remember thinking about our potential success. When I kicked this off I recruited Chris Jennings (aka ckj) to help me start the company. He had already helped out on the project at Disqus so he was familiar with the project. I recall it being close to the end of the 2012, around Christmas, where things slow down at work. Chris and I decided to use our holiday vacation to get the company off the ground, to launch the Heroku AddOn. We then realized launching an AddOn meant building a cloud service…</p>
<p>Over those two weeks, or at least how I remember it, we had completed multi-organization support in Sentry, added in Stripe billing, and launched the product on top of Heroku. Stripe was a key ingredient that was extremely simple to integrate, especially with our silly naive business model at the time (a story for another post). While I’m sure I’m fudging the numbers a bit, I recall launching Sentry’s cloud service, a paid-only offering, to customers within a few weeks of starting development on it.</p>
<p><strong>We launched it and that same day we had our first paying customer. Seven dollars baby!</strong></p>
<p><img src="https://cra.mr/assets/sentry/heroku-addon.png" alt="Heroku AddOn"></p>
<p>Except it wasn’t that easy, and it took a lot of work to get to that point. It was certainly easy to add the billing functionality, and a few small features to the product, but that would not have been possible if not for the hundreds of hours already invested into the project, as well as the countless contributions from others. Let’s step back and talk a little bit about that, about how Sentry had <strong>product-market-fit from day one</strong>.</p>
<p>If you did the Math, you’ll note Sentry existed for about five years before we launched the cloud service. That was half a decade of natural needs-driven growth, either the needs of myself or the company I worked at, or the needs of others, users or contributors, who were running their own copy of Sentry at their own jobs. It’s often hard to understate how valuable this period of time was for Sentry, but I don’t think its as important <em>how much</em> time it was, but the way it was spent and the environment surrounding it. It was a passion for solving our own problems, compounded through peer validation. That validation often came through conversations at conferences, on GitHub, or on IRC. If you opened a ticket on the Sentry project you rarely waited long on triage and frequently new ideas or fixes were implemented the same day. I personally found a lot of satisfaction in that, but more importantly I believe it helped accelerate a product that was already solving real world needs, and build the trust thats so important in developer tools.</p>
<p>This is what I find somewhat difficult to translate to folks. One of the biggest challenges of a company is finding product-market fit, yet we had stumbled into it. So how do you replicate that? I don’t have an answer, but I genuinely believe that you are your own best customer. So when asked, I try to come up with the best advice I can, even if we didn’t directly face the same challenges. The advice I give folks is the best thing you can do is to find customers - yourself or others - that share the same desired outcome that you’re passionate about. In my case it was all about fixing the bugs I continuously created, and with less frustration. We found customers who understood that, and validated our ideas off of them. We did <em>not</em> however, listen to potential customers who wanted something that we disagreed with. I talk a little bit about this in <a href="https://cra.mr/optimizing-for-taste">Optimizing for Taste</a>, but I thoroughly believe the best path you have to building a lasting product is by building something you’re passionate about, and have a strong thesis around.</p>
<p>I actually think this phase of building Sentry the most fulfilling, and the least demanding. Once we spun up the cloud service it meant being on-call (2x the pain when you’re also on call at your day job), having real customers to support, and dealing with all the backoffice involved in generating revenue. That, however, is a story for next time.</p>
<p>If you liked this article, I’d appreciate a share. Feel free to also reach out on (ugh) X, I’m <a href="https://x.com/zeeg">@zeeg</a>. I’d especially be interested if there’s something you found helpful, or something you’d like to hear more about. I’ll probably write about our approach to pricing and packaging next, as its something I’ve become very passionate about over the years, and is particularly interesting due to how few companies there are like us in the IT space.</p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[How Bear does analytics with CSS (177 pts)]]></title>
            <link>https://herman.bearblog.dev/how-bear-does-analytics-with-css/</link>
            <guid>38095699</guid>
            <pubDate>Wed, 01 Nov 2023 08:08:09 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://herman.bearblog.dev/how-bear-does-analytics-with-css/">https://herman.bearblog.dev/how-bear-does-analytics-with-css/</a>, See on <a href="https://news.ycombinator.com/item?id=38095699">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>

<p>
<i>
<time datetime="2023-11-01">
01 Nov, 2023
</time>
</i>
</p>
<p>Bear Blog has a few design constraints for speed, efficiency, and stability. There are many great open-source, privacy-focussed analytics platforms out there, but I wanted to build one native to Bear.</p>
<p><a href="#tldr">tldr;</a></p>
<p>One of my constraints for Bear is to not use client-side javascript. This applies to the analytics system as well. Client-side javascript can be tweaked to determine the authenticity of traffic to a page and determine (partially) whether it is bot traffic or not, which is very useful for analytics. The main downside, however, is that most adblockers block analytics scripts. And not just the bad ones, like Google Analytics. Even Fathom and Plausible analytics struggle with logging activity on adblocked browsers.</p>
<p>There's always the option of just parsing server logs, which gives a rough indication of the kinds of traffic accessing the server. Unfortunately all server traffic is generally seen as equal. Technically bots "should" have a user-agent that identifies them as a bot, but few identify that since they're trying to scrape information as a "person" using a browser. In essence, just using server logs for analytics gives a skewed perspective to traffic since a lot of it are search-engine crawlers and scrapers (and now GPT-based parsers).</p>
<p>So instead of using server logs, I trigger a read with CSS. Here's my slightly boutique analytics system.</p>
<p>When a person accesses the website the page is loaded.
On each page I have the following CSS:</p>
<div><pre><span></span><span>body</span><span>:</span><span>hover</span><span> </span><span>{</span>
<span>    </span><span>border</span><span>-</span><span>image</span><span>:</span><span> </span><span>url</span><span>(</span><span>"/hit/{{ post.id }}/?ref={{ request.META.HTTP_REFERER }}"</span><span>);</span>
<span>}</span>
</pre></div>
<p>The only info I need to actively re-add to this request is the referrer (yes, HTTP_REFERER is <a href="https://en.wikipedia.org/wiki/HTTP_referer" target="_blank">spelt incorrectly</a>).</p>
<p>Now, when a person hovers their cursor over the page (or scrolls on mobile) it triggers <code>body:hover</code> which calls the URL for the post hit. I don't think any bots hover and instead just use JS to interact with the page, so I can, with reasonable certainty, assume that this is a human reader.</p>
<p>I then confirm the user-agent isn't a bot (which isn't perfect, but still something). I also extract the browser and platform from the user-agent string.</p>
<p>My second constraint is to not store any identifying information about the reader either in browser cookies, or on the server. In order to do this I use the IP address of the request to determine the country, then hash the IP address along with the date. All subsequent requests to the page are checked for matching IP address + date hashes and duplicates are discarded.</p>
<p>In this way each IP address per day constitutes one "read" of the page. No IP addresses are stored un-hashed and the IP-with-date-hash creates a convenient built-in expiry time.</p>
<p>Here's the code if you're interested:</p>
<div><pre><span></span><span>user_agent</span> <span>=</span> <span>httpagentparser</span><span>.</span><span>detect</span><span>(</span><span>self</span><span>.</span><span>request</span><span>.</span><span>META</span><span>.</span><span>get</span><span>(</span><span>'HTTP_USER_AGENT'</span><span>,</span> <span>None</span><span>))</span>
<span>if</span> <span>user_agent</span><span>.</span><span>get</span><span>(</span><span>'bot'</span><span>,</span> <span>False</span><span>):</span>
    <span>print</span><span>(</span><span>'Bot traffic'</span><span>)</span>
    <span>return</span>

<span>ip_hash</span> <span>=</span> <span>hashlib</span><span>.</span><span>md5</span><span>(</span><span>f</span><span>"</span><span>{</span><span>client_ip</span><span>(</span><span>self</span><span>.</span><span>request</span><span>)</span><span>}</span><span>-</span><span>{</span><span>timezone</span><span>.</span><span>now</span><span>()</span><span>.</span><span>date</span><span>()</span><span>}</span><span>"</span><span>.</span><span>encode</span><span>(</span><span>'utf-8'</span><span>))</span><span>.</span><span>hexdigest</span><span>()</span>

<span>country</span> <span>=</span> <span>get_user_location</span><span>(</span><span>client_ip</span><span>(</span><span>self</span><span>.</span><span>request</span><span>))</span><span>.</span><span>get</span><span>(</span><span>'country_name'</span><span>,</span> <span>''</span><span>)</span>
<span>device</span> <span>=</span> <span>user_agent</span><span>.</span><span>get</span><span>(</span><span>'platform'</span><span>,</span> <span>{})</span><span>.</span><span>get</span><span>(</span><span>'name'</span><span>,</span> <span>''</span><span>)</span>
<span>browser</span> <span>=</span> <span>user_agent</span><span>.</span><span>get</span><span>(</span><span>'browser'</span><span>,</span> <span>{})</span><span>.</span><span>get</span><span>(</span><span>'name'</span><span>,</span> <span>''</span><span>)</span>

<span>referrer</span> <span>=</span> <span>self</span><span>.</span><span>request</span><span>.</span><span>GET</span><span>.</span><span>get</span><span>(</span><span>'ref'</span><span>,</span> <span>''</span><span>)</span>
<span>if</span> <span>referrer</span><span>:</span>
    <span>referrer</span> <span>=</span> <span>urlparse</span><span>(</span><span>referrer</span><span>)</span>
    <span>referrer</span> <span>=</span> <span>'</span><span>{uri.scheme}</span><span>://</span><span>{uri.netloc}</span><span>/'</span><span>.</span><span>format</span><span>(</span><span>uri</span><span>=</span><span>referrer</span><span>)</span>

<span>Hit</span><span>.</span><span>objects</span><span>.</span><span>get_or_create</span><span>(</span>
    <span>post_id</span><span>=</span><span>self</span><span>.</span><span>pk</span><span>,</span>
    <span>ip_address</span><span>=</span><span>ip_hash</span><span>,</span>
    <span>referrer</span><span>=</span><span>referrer</span><span>,</span>
    <span>country</span><span>=</span><span>country</span><span>,</span>
    <span>device</span><span>=</span><span>device</span><span>,</span>
    <span>browser</span><span>=</span><span>browser</span><span>)</span>
</pre></div>
<p>The only downside to this method is if there are multiple reads from the same IP address but on separate devices, it will still only be seen as one read. And I'm okay with that since it constitutes such a minor fragment of traffic. This provides an accurate count of reads and I feel is more concise and simpler than many other forms of analytics capture.</p>
<h2 id="tldr">tldr;</h2>
<p>I use CSS to trigger a url analytics endpoint on <code>body:hover</code>, determine useful information from the IP address and user-agent, then hash the IP address with the date to create a unique "read" of a page.</p>
<h5 id="enjoyed-the-article-i-write-about-1-2-a-month-subscribe-via-email-or-rss-feed">Enjoyed the article? I write about 1-2 a month. Subscribe via <a href="https://herman.bearblog.dev/subscribe/">email</a> or <a href="https://herman.bearblog.dev/feed/">RSS feed</a>.</h5>


</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[What the Goddamn Hell Is Going on in the Tech Industry? – Ludicity (214 pts)]]></title>
            <link>https://ludic.mataroa.blog/blog/what-the-goddamn-hell-is-going-on-in-the-tech-industry/</link>
            <guid>38095542</guid>
            <pubDate>Wed, 01 Nov 2023 07:40:07 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://ludic.mataroa.blog/blog/what-the-goddamn-hell-is-going-on-in-the-tech-industry/">https://ludic.mataroa.blog/blog/what-the-goddamn-hell-is-going-on-in-the-tech-industry/</a>, See on <a href="https://news.ycombinator.com/item?id=38095542">Hacker News</a></p>
<div id="readability-page-1" class="page"><article itemscope="" itemtype="http://schema.org/BlogPosting">
        

        

        <div itemprop="articleBody">
            <p>Sweet merciful Jesus, I woke up this morning and my inbox was flooded with horrific stories about how employers treat people. I knew things were fucked, but this was <em>so</em> much worse than I imagined, and that's not even getting into the comments on Hackernews. I am going to dig into some of those emails, but first...</p>
<p>I usually don't waste time on the negative comments because <em>usually</em> the person making it has obviously gulped down so much corporate Kool-aid that I am afraid they will projectile vomit Agile terminology all over me, but there was <em>one</em> that was so funny that I had to share it.</p>
<p><a href="https://ludic.mataroa.blog/blog/i-accidentally-saved-half-a-million-dollars/">With regards to my post on saving half a million dollars</a>:</p>
<blockquote>
<p>There is a high likelihood that many other people in the org were lightyears ahead of the author. It's even more likely that an engineer or manager in their group was "Banking" the inefficiencies to use during a cost-cutting period - and the author ruined that chance... which will inevitably cause massive suffering and possibly poor performance reviews when there is nothing to trim."</p>
</blockquote>
<p>My brother in Christ, I have a blog that is largely about corporate dysfunction and the soul-cost it imposes on well-meaning engineers, and you think that <em>I'm the problem because someone else was deliberately wasting money so that they could pretend to save it later</em>? In the words of the late Hitchens, "Do you see what brain rot descends on people?"</p>
<p>Incidentally that wasn't what was happening here, they really just never checked the database defaults. I'm sure someone is out there by 5-dimensional hyper-chess by deliberately going over the budget by a billion percent, but rest assured that this is not the simplest explanation. The whole idea that management must have a reason to do something this stupid is something I toyed with for a while, but it really only applies to the minority of cases.</p>
<h2 id="i-were-just-wasting-like-30-90-of-all-technical-productivity">I. We're Just Wasting Like 30-90% Of All Technical Productivity</h2>
<p>I am near <em>absolutely</em> convinced that the vast majority of our species' ability to produce things of value for the human race is just utterly squandered at large companies. I suspected we were wasting about 50%, but the volume of stories I got, frequently from <em>serious</em> companies, including some of the FAANG places that mere normal engineers like me look up at in awe while we worship at the altar of StackOverflow, just blew my mind. A lot of them involved doing variations of almost exactly what I did in different stacks, and every single time management just buried what happened.</p>
<p>If you recognize yourself in these emails but didn't give me permission to write an email, then it <em>isn't actually you</em>, it turns out these stories are so similar that they really do sound the same.</p>
<p>I received:</p>
<ol>
<li>A few stories about idling EC2 instances, totaling a total of about $4,000,000 saved <em>per month</em>, which management buried to avoid looking bad.</li>
<li>Another guy that discovered the same optimisations I made, with the same result from management.</li>
<li>Some security guys that just... I don't even know what to say about these stories, but <em>quite a few</em> stories were about finding out that a large proportion of a company's servers were infected with malware or mining cryptocurrency, which management, guess what, buried.</li>
<li>A guy, whose story deserves a whole post on its own, involving being told he's "not a team player" because he didn't stop someone else from flooding a server with crypto-bots.</li>
<li>Some people discovering other multi-million dollar optimisations that were ignored because they didn't have admin credentials, so they had to write suggestions which were ignored.</li>
</ol>
<p>There were some others, with a handful <em>genuinely</em> seeming to possibly add up to <em>billions</em> of dollars saved industry-wide, but the largest payout anyone ever received in the emails was $5K. Sampling bias, yadda yadda, listen, I'm pretty sure things are just fucked up.</p>
<p>The best story, which I have verified is true beyond all reasonable doubt, involved <em>literally saving a colleague's life with immense personal effort and in traumatic circumstances</em>, which was rewarded by <em>not</em> getting the rest of the day off and $50.</p>
<p>Like what the fuck is going on out there? I mean, I guess we already <em>know</em> what's going on out there - keeping a large company efficient is actually an unsolvable problem. I suspect that if you want to build a modern GPU, you just have to be able to sustain all that inefficiency or... you don't get to have anything that takes more than 50 people (or something in that range) to make. It's just all so much worse than I thought.</p>
<p>In fact, while a lot of those stories were bad, most of them <em>probably weren't the worst places</em> because most of the readers here are actually super talented engineers, which was evident from their excellent writing skills, open source contributions, and rugged good looks. The worst places <em>wouldn't have any talented engineers</em>. Like, Christ, let that sink in. It's like thinking you're in Hell with a few other people, desperately hanging on, then realizing that just in the next room is Super Hell which consists entirely of demons torturing each other. </p>
<p>Ack, it makes my skin crawl just thinking about it. There's a team out there where the main drama isn't one right faction and one wrong faction, there are <em>two factions fighting to the death over how best to use a spreadsheet as a database for a production application</em>. I feel like this has to be stopped but I don't have the strength.</p>
<p>It is fucking <em>awful</em> out there. Maybe we should set up a support group.</p>
<h2 id="ii-the-other-side">II. The Other Side</h2>
<p>The other thing I wanted to highlight is that there were <em>three</em> kinds of respondents, both via email and on Hackernews.</p>
<p>The first type, <a href="https://ludic.mataroa.blog/compliments/">my favourite commenters</a>, whose grim-faced no-nonsense corporate visages grace standups across the world. Thanks to their fearless leadership and keen business sense, I have it on good authority that all projects are scheduled to move from red status to green status despite all those risks unfortunately materializing, which is no one's fault in particular. Despite the various challenges we have faced over the years and lack of forward progress, I think <em>this</em> retro is the one where things are going to change.</p>
<p>The second type, the vast majority, who read this stuff and immediately suffer flashbacks. My heart goes out to you, my kin. As a few people wrote in, don't let the bastards grind you down.</p>
<p>And the mythical third type, who <em>aren't sure whether my stories are real</em>. Like, they just <em>assume</em> that I must be making stuff up, because how could <em>anyone</em> do their work so ineffectively? God, I wish I was them. I read stories similar to mine and can just tell that they're true. I really, really wish I couldn't - if only I could toggle my brain back to that sweet pre-employment state, where I knew there would be some minor inefficiencies and I'd have a great time tackling them. Before I realized that wasting ten years of someone's career on a task that doesn't need to be done is actually a rounding error for many companies, <em>and</em> that some absolute clowns would spend all their time trying to gaslight their peers into believing the work was accomplishing anything.</p>
<p>Some of the third type are obviously actually also working at really stupid companies, but just accept the social fiction. It's probably good for them. However many of the others <em>actually work somewhere functional</em>, and their experience is so far divorced from the average engineer's that I only have <em>one</em> friend that has worked at both a good and a bad place - and I keep a <em>lot</em> of friends in the tech space between being pretty extroverted and this blog.</p>
<p>There's just some massive unwashed mass of utterly stupid companies where nothing makes any sense, and the only efficiencies exist in the department that generates the money to fund the other stupid stuff, and then a few places doing things <em>halfway</em> right. The places doing things right tend to be characterized by being small, <em>not</em> being obsessed with growth, and having calm, compassionate founders who still keep a hand on the wheel. And the people that work there <em>tend not to know the people that work elsewhere</em>. They're just in some blessed bubble where the dysfunction still exists in serious quantities, but that quantity is like 1/10th the intensity of what it is elsewhere.</p>
<p>However, it's really hard to tell these people apart.</p>
<p>Anyway, what I'm saying is, hold out hope. I'm aiming to keep a few conversations going with people via email that have made the jump, and I'm hoping to write up a guide on how to most effectively follow suit. If I can help even a handful of readers connect with like-minded peers and escape their hellish office settings, that would be enough good to last me a lifetime.</p>
<p><em>Plus</em> then I can probably do some corporate backstabbing and stay karma-positive. Take me to management, baby, I want to buy an expensive hammock.</p>
        </div>
    </article></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Why ACPI? (158 pts)]]></title>
            <link>https://mjg59.dreamwidth.org/68350.html</link>
            <guid>38095276</guid>
            <pubDate>Wed, 01 Nov 2023 06:46:09 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://mjg59.dreamwidth.org/68350.html">https://mjg59.dreamwidth.org/68350.html</a>, See on <a href="https://news.ycombinator.com/item?id=38095276">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><p>"Why does ACPI exist" - - the greatest thread in the history of forums, locked by a moderator after 12,239 pages of heated debate, wait no let me start again.</p><p>Why does ACPI exist? In the beforetimes power management on x86 was done by jumping to an opaque BIOS entry point and hoping it would do the right thing. It frequently didn't. We called this <a href="https://en.wikipedia.org/wiki/Advanced_Power_Management">Advanced Power Management</a> (Advanced because before this power management involved custom drivers for every machine and everyone agreed that this was a bad idea), and it involved the firmware having to save and restore the state of every piece of hardware in the system. This meant that assumptions about hardware configuration were baked into the firmware - failed to program your graphics card exactly the way the BIOS expected? Hurrah! It's only saved and restored a subset of the state that you configured and now potential data corruption for you. The developers of ACPI made the reasonable decision that, well, maybe since the OS was the one setting state in the first place, the OS should restore it.</p><p>So far so good. But some state is fundamentally device specific, at a level that the OS generally ignores. How should this state be managed? One way to do that would be to have the OS know about the device specific details. Unfortunately that means you can't ship the computer without having OS support for it, which means having OS support for every device (exactly what we'd got away from with APM). This, uh, was not an option the PC industry seriously considered. The alternative is that you ship something that abstracts the details of the specific hardware and makes that abstraction available to the OS. This is what ACPI does, and it's also what things like Device Tree do. Both provide static information about how the platform is configured, which can then be consumed by the OS and avoid needing device-specific drivers or configuration to be built-in.</p><p>The main distinction between Device Tree and ACPI is that Device Tree is purely a description of the hardware that exists, and so still requires the OS to know what's possible - if you add a new type of power controller, for instance, you need to add a driver for that to the OS before you can express that via Device Tree. ACPI decided to include an interpreted language to allow vendors to expose functionality to the OS without the OS needing to know about the underlying hardware. So, for instance, ACPI allows you to associate a device with a function to power down that device. That function may, when executed, trigger a bunch of register accesses to a piece of hardware otherwise not exposed to the OS, and that hardware may then cut the power rail to the device to power it down entirely. And that can be done without the OS having to know anything about the control hardware.</p><p>How is this better than just calling into the firmware to do it? Because the fact that ACPI declares that it's going to access these registers means the OS can figure out that it shouldn't, because it might otherwise collide with what the firmware is doing. With APM we had no visibility into that - if the OS tried to touch the hardware at the same time APM did, boom, almost impossible to debug failures (This is why various hardware monitoring drivers refuse to load by default on Linux - the firmware declares that it's going to touch those registers itself, so Linux decides not to in order to avoid race conditions and potential hardware damage. In many cases the firmware offers a collaborative interface to obtain the same data, and a driver can be written to get that. <a href="https://bugzilla.kernel.org/show_bug.cgi?id=204807#c37">this bug comment</a> discusses this for a specific board)</p><p>Unfortunately ACPI doesn't entirely remove opaque firmware from the equation - ACPI methods can still trigger System Management Mode, which is basically a fancy way to say "Your computer stops running your OS, does something else for a while, and you have no idea what". This has all the same issues that APM did, in that if the hardware isn't in exactly the state the firmware expects, bad things can happen. While historically there were a bunch of ACPI-related issues because the spec didn't define every single possible scenario and also there was no conformance suite (eg, should the interpreter be multi-threaded? Not defined by spec, but influences whether a specific implementation will work or not!), these days overall compatibility is pretty solid and the vast majority of systems work just fine - but we do still have some issues that are largely associated with System Management Mode.</p><p>One example is a <a href="https://lore.kernel.org/all/20220429030501.1909-3-mario.limonciello@amd.com/">recent Lenovo one</a>, where the firmware appears to try to poke the NVME drive on resume. There's some indication that this is intended to deal with transparently unlocking self-encrypting drives on resume, but it seems to do so without taking IOMMU configuration into account and so things explode. It's kind of understandable why a vendor would implement something like this, but it's also kind of understandable that doing so without OS cooperation may end badly.</p><p>This isn't something that ACPI enabled - in the absence of ACPI firmware vendors would just be doing this unilaterally with even less OS involvement and we'd probably have even more of these issues. Ideally we'd "simply" have hardware that didn't support transitioning back to opaque code, but we don't (ARM has basically the same issue with TrustZone). In the absence of the ideal world, by and large ACPI has been a net improvement in Linux compatibility on x86 systems. It certainly didn't remove the "Everything is Windows" mentality that many vendors have, but it meant we largely only needed to ensure that Linux behaved the same way as Windows in a finite number of ways (ie, the behaviour of the ACPI interpreter) rather than in every single hardware driver, and so the chances that a new machine will work out of the box are much greater than they were in the pre-ACPI period.</p><p>There's an alternative universe where we decided to teach the kernel about every piece of hardware it should run on. Fortunately (or, well, unfortunately) we've seen that in the ARM world. Most device-specific simply never reaches mainline, and most users are stuck running ancient kernels as a result. Imagine every x86 device vendor shipping their own kernel optimised for their hardware, and now imagine how well that works out given the quality of their firmware. Does that really seem better to you?</p><p>It's understandable why ACPI has a poor reputation. But it's also hard to figure out what would work better in the real world. We could have built something similar on top of <a href="https://en.wikipedia.org/wiki/Open_Firmware">Open Firmware</a> instead but the distinction wouldn't be terribly meaningful - we'd just have Forth instead of the ACPI bytecode language. Longing for a non-ACPI world without presenting something that's better and actually stands a reasonable chance of adoption doesn't make the world a better place.</p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[SQLite 3.44: Interactive release notes (140 pts)]]></title>
            <link>https://antonz.org/sqlite-3-44/</link>
            <guid>38095239</guid>
            <pubDate>Wed, 01 Nov 2023 06:39:04 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://antonz.org/sqlite-3-44/">https://antonz.org/sqlite-3-44/</a>, See on <a href="https://news.ycombinator.com/item?id=38095239">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><article><div><header></header><p>SQlite 3.44 is just around the corner, and it has some decent features, so I think now it's a good time to show them off. Let's get started!</p><h2 id="order-by-in-aggregates">ORDER BY in aggregates</h2><p>Aggregate functions now accept an optional <code>order by</code> after the last parameter. It defines an order in which the function processes its arguments.</p><p><code>order by</code> in aggregates is probably not very useful in <code>avg</code>, <code>count</code> and other functions whose result does not depend on the order of the arguments. However, it can be quite handy for functions like <a href="https://sqlite.org/draft/lang_aggfunc.html#group_concat"><code>group_concat</code></a> and <a href="https://sqlite.org/draft/json1.html#jgrouparray"><code>json_group_array</code></a>.</p><p>Let's say we have an <code>employees</code> table:</p><pre tabindex="0"><code>┌────┬───────┬────────┬────────────┬────────┐
│ id │ name  │  city  │ department │ salary │
├────┼───────┼────────┼────────────┼────────┤
│ 11 │ Diane │ London │ hr         │ 70     │
│ 12 │ Bob   │ London │ hr         │ 78     │
│ 21 │ Emma  │ London │ it         │ 84     │
│ 22 │ Grace │ Berlin │ it         │ 90     │
│ 23 │ Henry │ London │ it         │ 104    │
│ 24 │ Irene │ Berlin │ it         │ 104    │
│ 25 │ Frank │ Berlin │ it         │ 120    │
│ 31 │ Cindy │ Berlin │ sales      │ 96     │
│ 32 │ Dave  │ London │ sales      │ 96     │
│ 33 │ Alice │ Berlin │ sales      │ 100    │
└────┴───────┴────────┴────────────┴────────┘
</code></pre><p><a href="https://antonz.org/sql-window-functions-book/employees.sql">↓ employees.sql</a></p><p>Suppose we want to show employees who work in each of the departments, so we group by <code>department</code> and use <code>group_concat</code> on the <code>name</code>. Previously, we had to rely on the default record order. But now we can concatenate the employees in straight or reverse alphabetical order (or any other order — try changing the <code>order by</code> clause below):</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>select</span>
</span></span><span><span>  <span>department</span>,
</span></span><span><span>  <span>group_concat</span>(<span>name</span> <span>order</span> <span>by</span> <span>name</span> <span>desc</span>) <span>as</span> <span>names</span>
</span></span><span><span><span>from</span> <span>employees</span>
</span></span><span><span><span>group</span> <span>by</span> <span>department</span>;
</span></span></code></pre></div><codapi-snippet sandbox="sqlite" editor="basic" template="sample.sql"></codapi-snippet><p>Now let's group employees by city using <code>json_group_array</code>:</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>select</span>
</span></span><span><span>  <span>value</span> <span>-&gt;&gt;</span> <span>'city'</span> <span>as</span> <span>city</span>,
</span></span><span><span>  <span>json_group_array</span>(
</span></span><span><span>    <span>value</span> <span>-&gt;</span> <span>'name'</span> <span>order</span> <span>by</span> <span>value</span> <span>-&gt;&gt;</span> <span>'id'</span>
</span></span><span><span>  ) <span>as</span> <span>json_names</span>
</span></span><span><span><span>from</span>
</span></span><span><span>  <span>json_each</span>(<span>readfile</span>(<span>'employees.json'</span>))
</span></span><span><span><span>group</span> <span>by</span>
</span></span><span><span>  <span>value</span> <span>-&gt;&gt;</span> <span>'city'</span>
</span></span></code></pre></div><codapi-snippet sandbox="sqlite" editor="basic" files="employees.json"></codapi-snippet><p>Nice!</p><h2 id="better-string-concatenation">Better string concatenation</h2><p>As you probably know, the <code>group_concat</code> function is SQLite (and MySQL) specific. In other databases (namely, PostgreSQL and SQL Server) the function is called <code>string_agg</code>. As of 3.44, SQLite also supports <code>string_agg</code> as an alias for <code>group_concat(expr, sep)</code>:</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>select</span>
</span></span><span><span>  <span>department</span>,
</span></span><span><span>  <span>string_agg</span>(<span>name</span>, <span>';'</span>) <span>as</span> <span>names</span>
</span></span><span><span><span>from</span> <span>employees</span>
</span></span><span><span><span>group</span> <span>by</span> <span>department</span>;
</span></span></code></pre></div><codapi-snippet sandbox="sqlite" editor="basic" template="sample.sql"></codapi-snippet><p>Now the only black sheep is Oracle, where the poor function is called <code>listagg</code>.</p><p>Speaking of concatenation, this release brings a couple of scalar string functions:</p><ul><li><a href="https://sqlite.org/draft/lang_corefunc.html#concat"><code>concat(arg, ...)</code></a> joins non-null arguments without a separator.</li><li><a href="https://sqlite.org/draft/lang_corefunc.html#concat_ws"><code>concat_ws(sep, arg, ...)</code></a> joins non-null arguments using the separator.</li></ul><div><pre tabindex="0"><code data-lang="sql"><span><span><span>select</span> <span>concat_ws</span>(<span>': '</span>, <span>id</span>, <span>name</span>) <span>as</span> <span>employee</span>
</span></span><span><span><span>from</span> <span>employees</span>
</span></span><span><span><span>where</span> <span>city</span> <span>=</span> <span>'London'</span>;
</span></span></code></pre></div><codapi-snippet sandbox="sqlite" editor="basic" template="sample.sql"></codapi-snippet><p>Both functions are also available in PostgreSQL, MySQL and SQL Server.</p><h2 id="thorough-date-formatting">Thorough date formatting</h2><p>The <a href="https://sqlite.org/lang_datefunc.html#strftm"><code>strftime</code></a> function was already quite powerful. Now it accepts even more formatting verbs:</p><ul><li><code>%F</code> ISO 8601 date: YYYY-MM-DD</li><li><code>%T</code> ISO 8601 time: HH:MM:SS</li><li><code>%R</code> ISO 8601 time: HH:MM</li><li><code>%I</code> hour for 12-hour clock: 01-12</li><li><code>%l</code> hour for 12-hour clock without leading zero: 1-12</li><li><code>%k</code> hour without leading zero: 0-24</li><li><code>%p</code> "AM" or "PM" depending on the hour</li><li><code>%P</code> "am" or "pm" depending on the hour</li><li><code>%e</code> day of month without leading zero: 0-31</li><li><code>%u</code> day of week 1-7 with Monday==1</li></ul><div><pre tabindex="0"><code data-lang="sql"><span><span><span>select</span> <span>"ISO date"</span> <span>as</span> <span>label</span>, <span>strftime</span>(<span>'%F'</span>, <span>datetime</span>(<span>'now'</span>)) <span>as</span> <span>value</span>
</span></span><span><span><span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>"ISO time"</span>, <span>strftime</span>(<span>'%R'</span>, <span>datetime</span>(<span>'now'</span>)) <span>as</span> <span>value</span>
</span></span><span><span><span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>"AM/PM time"</span>, <span>strftime</span>(<span>'%l:%M %P'</span>, <span>datetime</span>(<span>'now'</span>)) <span>as</span> <span>value</span>
</span></span><span><span><span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>"Day of month"</span>, <span>strftime</span>(<span>'%e'</span>, <span>datetime</span>(<span>'now'</span>)) <span>as</span> <span>value</span>
</span></span><span><span><span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>"Day of week"</span>, <span>strftime</span>(<span>'%u'</span>, <span>datetime</span>(<span>'now'</span>)) <span>as</span> <span>value</span>
</span></span></code></pre></div><codapi-snippet sandbox="sqlite" editor="basic"></codapi-snippet><p>ISO formatting is most welcome!</p><p>If you are wondering why lowercase <code>p</code> results in uppercase <code>AM/PM</code>, while uppercase <code>P</code> results in lowercase <code>am/pm</code> — it's because the standard C library function <code>strftime</code> does this (with the <code>%p</code> verb).</p><h2 id="and-a-few-other-things">And a few other things</h2><p><a href="https://sqlite.org/pragma.html#pragma_integrity_check">Integrity checking</a> now works with virtual tables.</p><p><a href="https://sqlite.org/fts5.html">Full-text search</a> tables can be used in triggers.</p><p>There are some query planner optimizations for partial index scans.</p><p>And a handful of other improvements that you can read about in the <a href="https://sqlite.org/draft/releaselog/3_44_0.html">official release notes</a>.</p><p>All in all, a great release!</p><p>──</p><p><mark>Interactive examples in this post</mark> are powered by <a href="https://codapi.org/"><strong>codapi</strong></a> — the platform I'm building. Use it to embed code playgrounds into your online course, documentation, or blog.</p><p><em><a href="https://antonz.org/subscribe/"><i></i>&nbsp;<strong>Subscribe</strong></a>
to keep up with new posts.</em></p></div></article></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[uBlock Origin 1.53 (417 pts)]]></title>
            <link>https://github.com/gorhill/uBlock/releases/tag/1.53.0</link>
            <guid>38094620</guid>
            <pubDate>Wed, 01 Nov 2023 04:33:02 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/gorhill/uBlock/releases/tag/1.53.0">https://github.com/gorhill/uBlock/releases/tag/1.53.0</a>, See on <a href="https://news.ycombinator.com/item?id=38094620">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-turbo-body="">
      


    <div>
      <p><a href="#start-of-content">Skip to content</a>
      <span data-view-component="true">
    <span data-view-component="true"></span>
</span></p><header role="banner" data-color-mode="light" data-light-theme="light" data-dark-theme="dark">
  

  <div>
          <nav aria-label="Global">
            <ul>
                <li>
      
      <div>
            <ul>
                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Product&quot;,&quot;action&quot;:&quot;click to go to Actions&quot;,&quot;label&quot;:&quot;ref_cta:Actions;&quot;}" href="https://github.com/features/actions">
      
      <div>
        <p>Actions</p><p>
        Automate any workflow
      </p></div>

    
</a></li>

                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Product&quot;,&quot;action&quot;:&quot;click to go to Packages&quot;,&quot;label&quot;:&quot;ref_cta:Packages;&quot;}" href="https://github.com/features/packages">
      
      <div>
        <p>Packages</p><p>
        Host and manage packages
      </p></div>

    
</a></li>

                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Product&quot;,&quot;action&quot;:&quot;click to go to Security&quot;,&quot;label&quot;:&quot;ref_cta:Security;&quot;}" href="https://github.com/features/security">
      
      <div>
        <p>Security</p><p>
        Find and fix vulnerabilities
      </p></div>

    
</a></li>

                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Product&quot;,&quot;action&quot;:&quot;click to go to Codespaces&quot;,&quot;label&quot;:&quot;ref_cta:Codespaces;&quot;}" href="https://github.com/features/codespaces">
      
      <div>
        <p>Codespaces</p><p>
        Instant dev environments
      </p></div>

    
</a></li>

                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Product&quot;,&quot;action&quot;:&quot;click to go to Copilot&quot;,&quot;label&quot;:&quot;ref_cta:Copilot;&quot;}" href="https://github.com/features/copilot">
      
      <div>
        <p>Copilot</p><p>
        Write better code with AI
      </p></div>

    
</a></li>

                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Product&quot;,&quot;action&quot;:&quot;click to go to Code review&quot;,&quot;label&quot;:&quot;ref_cta:Code review;&quot;}" href="https://github.com/features/code-review">
      
      <div>
        <p>Code review</p><p>
        Manage code changes
      </p></div>

    
</a></li>

                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Product&quot;,&quot;action&quot;:&quot;click to go to Issues&quot;,&quot;label&quot;:&quot;ref_cta:Issues;&quot;}" href="https://github.com/features/issues">
      
      <div>
        <p>Issues</p><p>
        Plan and track work
      </p></div>

    
</a></li>

                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Product&quot;,&quot;action&quot;:&quot;click to go to Discussions&quot;,&quot;label&quot;:&quot;ref_cta:Discussions;&quot;}" href="https://github.com/features/discussions">
      
      <div>
        <p>Discussions</p><p>
        Collaborate outside of code
      </p></div>

    
</a></li>

            </ul>
          </div>
</li>


                <li>
      
      
</li>


                <li>
      
      <div>
          <div>
            <ul>
                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Open Source&quot;,&quot;action&quot;:&quot;click to go to GitHub Sponsors&quot;,&quot;label&quot;:&quot;ref_cta:GitHub Sponsors;&quot;}" href="https://github.com/sponsors">
      
      <div>
        <p>GitHub Sponsors</p><p>
        Fund open source developers
      </p></div>

    
</a></li>

            </ul>
          </div>
          <div>
            <ul>
                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Open Source&quot;,&quot;action&quot;:&quot;click to go to The ReadME Project&quot;,&quot;label&quot;:&quot;ref_cta:The ReadME Project;&quot;}" href="https://github.com/readme">
      
      <div>
        <p>The ReadME Project</p><p>
        GitHub community articles
      </p></div>

    
</a></li>

            </ul>
          </div>
          
      </div>
</li>


                <li>
    <a data-analytics-event="{&quot;category&quot;:&quot;Header menu top item (logged out)&quot;,&quot;action&quot;:&quot;click to go to Pricing&quot;,&quot;label&quot;:&quot;ref_cta:Pricing;&quot;}" href="https://github.com/pricing">Pricing</a>
</li>

            </ul>
          </nav>

        <div>
                


<qbsearch-input data-scope="repo:gorhill/uBlock" data-custom-scopes-path="/search/custom_scopes" data-delete-custom-scopes-csrf="vI1s6Q7L6l94H24kXwjuT6QGqss2p_trOj6RRky3jwKrODwyEo15ce06sM-x8lFpnx4iZ8UKRhUkZAwFyFIb1A" data-max-custom-scopes="10" data-header-redesign-enabled="false" data-initial-value="" data-blackbird-suggestions-path="/search/suggestions" data-jump-to-suggestions-path="/_graphql/GetSuggestedNavigationDestinations" data-current-repository="gorhill/uBlock" data-current-org="" data-current-owner="gorhill" data-logged-in="false">
  <div data-modal-dialog-overlay="" data-action="click:qbsearch-input#searchInputContainerClicked">
  <modal-dialog data-action="close:qbsearch-input#handleClose cancel:qbsearch-input#handleClose" data-target="qbsearch-input.searchSuggestionsDialog" role="dialog" id="search-suggestions-dialog" aria-modal="true" aria-labelledby="search-suggestions-dialog-header" data-view-component="true">
      <h2 id="search-suggestions-dialog-header">Search code, repositories, users, issues, pull requests...</h2>
    
</modal-dialog></div>
  
  <div>
    
<div data-modal-dialog-overlay="">
  <modal-dialog data-target="qbsearch-input.feedbackDialog" data-action="close:qbsearch-input#handleDialogClose cancel:qbsearch-input#handleDialogClose" role="dialog" id="feedback-dialog" aria-modal="true" aria-disabled="true" aria-labelledby="feedback-dialog-title" aria-describedby="feedback-dialog-description" data-view-component="true">
    <div data-view-component="true">
    <p>
      <h2 id="feedback-dialog-title">
        Provide feedback
      </h2>
    </p>
    
  </div>
      
      
</modal-dialog></div>

    <custom-scopes data-target="qbsearch-input.customScopesManager">
    
<div data-modal-dialog-overlay="">
  <modal-dialog data-target="custom-scopes.customScopesModalDialog" data-action="close:qbsearch-input#handleDialogClose cancel:qbsearch-input#handleDialogClose" role="dialog" id="custom-scopes-dialog" aria-modal="true" aria-disabled="true" aria-labelledby="custom-scopes-dialog-title" aria-describedby="custom-scopes-dialog-description" data-view-component="true">
    <div data-view-component="true">
    <p>
      <h2 id="custom-scopes-dialog-title">
        Saved searches
      </h2>
        <h2 id="custom-scopes-dialog-description">Use saved searches to filter your results more quickly</h2>
    </p>
    
  </div>
      
      
</modal-dialog></div>
    </custom-scopes>
  </div>
</qbsearch-input>

            <p><a href="https://github.com/signup?ref_cta=Sign+up&amp;ref_loc=header+logged+out&amp;ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&amp;source=header-repo&amp;source_repo=gorhill%2FuBlock" data-hydro-click="{&quot;event_type&quot;:&quot;authentication.click&quot;,&quot;payload&quot;:{&quot;location_in_page&quot;:&quot;site header menu&quot;,&quot;repository_id&quot;:null,&quot;auth_type&quot;:&quot;SIGN_UP&quot;,&quot;originating_url&quot;:&quot;https://github.com/gorhill/uBlock/releases/tag/1.53.0&quot;,&quot;user_id&quot;:null}}" data-hydro-click-hmac="54744ca07a8fbeacf189a006f68a1ad7a8edc61ec7f1922a6cb0142746044dcd" data-analytics-event="{&quot;category&quot;:&quot;Sign up&quot;,&quot;action&quot;:&quot;click to sign up for account&quot;,&quot;label&quot;:&quot;ref_page:/<user-name>/<repo-name>/releases/show;ref_cta:Sign up;ref_loc:header logged out&quot;}">
              Sign up
            </a>
        </p></div>
      </div>
</header>

      
    </div>

  








    


    
    <include-fragment data-base-src="https://github.com/notifications/beta/shelf"></include-fragment>






  <div itemscope="" itemtype="http://schema.org/SoftwareSourceCode" data-commit-hovercards-enabled="" data-discussion-hovercards-enabled="" data-issue-and-pr-hovercards-enabled="">
    <main id="js-repo-pjax-container">
      
      
  
    






  
  <div id="repository-container-header" data-turbo-replace="">

      <div id="repository-details-container" data-turbo-replace="">
            <ul>
    
      

  <li>
            <a href="https://github.com/login?return_to=%2Fgorhill%2FuBlock" rel="nofollow" data-hydro-click="{&quot;event_type&quot;:&quot;authentication.click&quot;,&quot;payload&quot;:{&quot;location_in_page&quot;:&quot;notification subscription menu watch&quot;,&quot;repository_id&quot;:null,&quot;auth_type&quot;:&quot;LOG_IN&quot;,&quot;originating_url&quot;:&quot;https://github.com/gorhill/uBlock/releases/tag/1.53.0&quot;,&quot;user_id&quot;:null}}" data-hydro-click-hmac="f7e04b046d1ebf27827f2be222adf424da9ac621d7c347f49b1dd11e8532ee35" aria-label="You must be signed in to change notification settings" data-view-component="true">    Notifications
</a>
  </li>

  <li>
          <a icon="repo-forked" id="fork-button" href="https://github.com/login?return_to=%2Fgorhill%2FuBlock" rel="nofollow" data-hydro-click="{&quot;event_type&quot;:&quot;authentication.click&quot;,&quot;payload&quot;:{&quot;location_in_page&quot;:&quot;repo details fork button&quot;,&quot;repository_id&quot;:33263118,&quot;auth_type&quot;:&quot;LOG_IN&quot;,&quot;originating_url&quot;:&quot;https://github.com/gorhill/uBlock/releases/tag/1.53.0&quot;,&quot;user_id&quot;:null}}" data-hydro-click-hmac="5ad7ed1f1e098d2129bfcd2914d019a17ea2daa0b23677739ae92617ac48557a" data-view-component="true">    Fork
    <span id="repo-network-counter" data-pjax-replace="true" data-turbo-replace="true" title="2,898" data-view-component="true">2.9k</span>
</a>
  </li>

  <li>
        
  </li>

</ul>

        </div>

        


          <nav data-pjax="#js-repo-pjax-container" aria-label="Repository" data-view-component="true">

  <ul data-view-component="true">
      <li data-view-component="true">
  <a id="code-tab" href="https://github.com/gorhill/uBlock/tree/1.53.0" data-tab-item="i0code-tab" data-selected-links="repo_source repo_downloads repo_commits repo_releases repo_tags repo_branches repo_packages repo_deployments repo_attestations /gorhill/uBlock/tree/1.53.0" data-pjax="#repo-content-pjax-container" data-turbo-frame="repo-content-turbo-frame" data-hotkey="g c" data-analytics-event="{&quot;category&quot;:&quot;Underline navbar&quot;,&quot;action&quot;:&quot;Click tab&quot;,&quot;label&quot;:&quot;Code&quot;,&quot;target&quot;:&quot;UNDERLINE_NAV.TAB&quot;}" aria-current="page" data-view-component="true">
    
              
        <span data-content="Code">Code</span>
          <span id="code-repo-tab-count" data-pjax-replace="" data-turbo-replace="" title="Not available" data-view-component="true"></span>


    
</a></li>
      <li data-view-component="true">
  <a id="issues-tab" href="https://github.com/gorhill/uBlock/issues" data-tab-item="i1issues-tab" data-selected-links="repo_issues repo_labels repo_milestones /gorhill/uBlock/issues" data-pjax="#repo-content-pjax-container" data-turbo-frame="repo-content-turbo-frame" data-hotkey="g i" data-analytics-event="{&quot;category&quot;:&quot;Underline navbar&quot;,&quot;action&quot;:&quot;Click tab&quot;,&quot;label&quot;:&quot;Issues&quot;,&quot;target&quot;:&quot;UNDERLINE_NAV.TAB&quot;}" data-view-component="true">
    
              
        <span data-content="Issues">Issues</span>
          <span id="issues-repo-tab-count" data-pjax-replace="" data-turbo-replace="" title="13" data-view-component="true">13</span>


    
</a></li>
      <li data-view-component="true">
  <a id="pull-requests-tab" href="https://github.com/gorhill/uBlock/pulls" data-tab-item="i2pull-requests-tab" data-selected-links="repo_pulls checks /gorhill/uBlock/pulls" data-pjax="#repo-content-pjax-container" data-turbo-frame="repo-content-turbo-frame" data-hotkey="g p" data-analytics-event="{&quot;category&quot;:&quot;Underline navbar&quot;,&quot;action&quot;:&quot;Click tab&quot;,&quot;label&quot;:&quot;Pull requests&quot;,&quot;target&quot;:&quot;UNDERLINE_NAV.TAB&quot;}" data-view-component="true">
    
              
        <span data-content="Pull requests">Pull requests</span>
          <span id="pull-requests-repo-tab-count" data-pjax-replace="" data-turbo-replace="" title="1" data-view-component="true">1</span>


    
</a></li>
      <li data-view-component="true">
  <a id="actions-tab" href="https://github.com/gorhill/uBlock/actions" data-tab-item="i3actions-tab" data-selected-links="repo_actions /gorhill/uBlock/actions" data-pjax="#repo-content-pjax-container" data-turbo-frame="repo-content-turbo-frame" data-hotkey="g a" data-analytics-event="{&quot;category&quot;:&quot;Underline navbar&quot;,&quot;action&quot;:&quot;Click tab&quot;,&quot;label&quot;:&quot;Actions&quot;,&quot;target&quot;:&quot;UNDERLINE_NAV.TAB&quot;}" data-view-component="true">
    
              
        <span data-content="Actions">Actions</span>
          <span id="actions-repo-tab-count" data-pjax-replace="" data-turbo-replace="" title="Not available" data-view-component="true"></span>


    
</a></li>
      <li data-view-component="true">
  <a id="projects-tab" href="https://github.com/gorhill/uBlock/projects" data-tab-item="i4projects-tab" data-selected-links="repo_projects new_repo_project repo_project /gorhill/uBlock/projects" data-pjax="#repo-content-pjax-container" data-turbo-frame="repo-content-turbo-frame" data-hotkey="g b" data-analytics-event="{&quot;category&quot;:&quot;Underline navbar&quot;,&quot;action&quot;:&quot;Click tab&quot;,&quot;label&quot;:&quot;Projects&quot;,&quot;target&quot;:&quot;UNDERLINE_NAV.TAB&quot;}" data-view-component="true">
    
              
        <span data-content="Projects">Projects</span>
          


    
</a></li>
      <li data-view-component="true">
  <a id="wiki-tab" href="https://github.com/gorhill/uBlock/wiki" data-tab-item="i5wiki-tab" data-selected-links="repo_wiki /gorhill/uBlock/wiki" data-pjax="#repo-content-pjax-container" data-turbo-frame="repo-content-turbo-frame" data-hotkey="g w" data-analytics-event="{&quot;category&quot;:&quot;Underline navbar&quot;,&quot;action&quot;:&quot;Click tab&quot;,&quot;label&quot;:&quot;Wiki&quot;,&quot;target&quot;:&quot;UNDERLINE_NAV.TAB&quot;}" data-view-component="true">
    
              
        <span data-content="Wiki">Wiki</span>
          <span id="wiki-repo-tab-count" data-pjax-replace="" data-turbo-replace="" title="Not available" data-view-component="true"></span>


    
</a></li>
      <li data-view-component="true">
  <a id="security-tab" href="https://github.com/gorhill/uBlock/security" data-tab-item="i6security-tab" data-selected-links="security overview alerts policy token_scanning code_scanning /gorhill/uBlock/security" data-pjax="#repo-content-pjax-container" data-turbo-frame="repo-content-turbo-frame" data-hotkey="g s" data-analytics-event="{&quot;category&quot;:&quot;Underline navbar&quot;,&quot;action&quot;:&quot;Click tab&quot;,&quot;label&quot;:&quot;Security&quot;,&quot;target&quot;:&quot;UNDERLINE_NAV.TAB&quot;}" data-view-component="true">
    
              
        <span data-content="Security">Security</span>
          <include-fragment src="/gorhill/uBlock/security/overall-count" accept="text/fragment+html"></include-fragment>

    
</a></li>
      <li data-view-component="true">
  <a id="insights-tab" href="https://github.com/gorhill/uBlock/pulse" data-tab-item="i7insights-tab" data-selected-links="repo_graphs repo_contributors dependency_graph dependabot_updates pulse people community /gorhill/uBlock/pulse" data-pjax="#repo-content-pjax-container" data-turbo-frame="repo-content-turbo-frame" data-analytics-event="{&quot;category&quot;:&quot;Underline navbar&quot;,&quot;action&quot;:&quot;Click tab&quot;,&quot;label&quot;:&quot;Insights&quot;,&quot;target&quot;:&quot;UNDERLINE_NAV.TAB&quot;}" data-view-component="true">
    
              
        <span data-content="Insights">Insights</span>
          <span id="insights-repo-tab-count" data-pjax-replace="" data-turbo-replace="" title="Not available" data-view-component="true"></span>


    
</a></li>
</ul>
    
</nav>

  </div>

  



<turbo-frame id="repo-content-turbo-frame" target="_top" data-turbo-action="advance">
    <div id="repo-content-pjax-container">
  <nav data-pjax="#repo-content-pjax-container" data-turbo-frame="repo-content-turbo-frame" aria-label="Breadcrumb" data-view-component="true">
  <ol>
      <li data-view-component="true"><a href="https://github.com/gorhill/uBlock/releases" data-view-component="true">Releases</a></li>
      <li data-view-component="true"><a aria-current="page" href="https://github.com/gorhill/uBlock/releases/tag/1.53.0" data-view-component="true">    1.53.0
</a></li>
  </ol>
</nav>
<div data-view-component="true" data-hpc="">
  
  <div data-view-component="true">      

  <div data-pjax="#repo-content-pjax-container" data-turbo-frame="repo-content-turbo-frame">
          <a data-hovercard-type="commit" data-hovercard-url="/gorhill/uBlock/commit/6fb86394f72fa105ddeec9f3786813ee7e79515a/hovercard" href="https://github.com/gorhill/uBlock/commit/6fb86394f72fa105ddeec9f3786813ee7e79515a" data-view-component="true">
              <svg aria-label="Commit" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M11.93 8.5a4.002 4.002 0 0 1-7.86 0H.75a.75.75 0 0 1 0-1.5h3.32a4.002 4.002 0 0 1 7.86 0h3.32a.75.75 0 0 1 0 1.5Zm-1.43-.75a2.5 2.5 0 1 0-5 0 2.5 2.5 0 0 0 5 0Z"></path>
</svg>
              <code>6fb8639</code>
</a>          <details>
    <summary>
      <svg aria-label="Verified commit signature" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="m9.585.52.929.68c.153.112.331.186.518.215l1.138.175a2.678 2.678 0 0 1 2.24 2.24l.174 1.139c.029.187.103.365.215.518l.68.928a2.677 2.677 0 0 1 0 3.17l-.68.928a1.174 1.174 0 0 0-.215.518l-.175 1.138a2.678 2.678 0 0 1-2.241 2.241l-1.138.175a1.17 1.17 0 0 0-.518.215l-.928.68a2.677 2.677 0 0 1-3.17 0l-.928-.68a1.174 1.174 0 0 0-.518-.215L3.83 14.41a2.678 2.678 0 0 1-2.24-2.24l-.175-1.138a1.17 1.17 0 0 0-.215-.518l-.68-.928a2.677 2.677 0 0 1 0-3.17l.68-.928c.112-.153.186-.331.215-.518l.175-1.14a2.678 2.678 0 0 1 2.24-2.24l1.139-.175c.187-.029.365-.103.518-.215l.928-.68a2.677 2.677 0 0 1 3.17 0ZM7.303 1.728l-.927.68a2.67 2.67 0 0 1-1.18.489l-1.137.174a1.179 1.179 0 0 0-.987.987l-.174 1.136a2.677 2.677 0 0 1-.489 1.18l-.68.928a1.18 1.18 0 0 0 0 1.394l.68.927c.256.348.424.753.489 1.18l.174 1.137c.078.509.478.909.987.987l1.136.174a2.67 2.67 0 0 1 1.18.489l.928.68c.414.305.979.305 1.394 0l.927-.68a2.67 2.67 0 0 1 1.18-.489l1.137-.174a1.18 1.18 0 0 0 .987-.987l.174-1.136a2.67 2.67 0 0 1 .489-1.18l.68-.928a1.176 1.176 0 0 0 0-1.394l-.68-.927a2.686 2.686 0 0 1-.489-1.18l-.174-1.137a1.179 1.179 0 0 0-.987-.987l-1.136-.174a2.677 2.677 0 0 1-1.18-.489l-.928-.68a1.176 1.176 0 0 0-1.394 0ZM11.28 6.78l-3.75 3.75a.75.75 0 0 1-1.06 0L4.72 8.78a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L7 8.94l3.22-3.22a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042Z"></path>
</svg>
    </summary>

    <div>
          
          <p>
                This commit was signed with the committer’s <strong>verified signature</strong>.
          </p>
        </div>
</details>

        </div>
        <div data-pjax="true" data-test-selector="body-content" data-view-component="true"><p><a href="https://github.com/gorhill/uBlock/compare/1.53.0...master">Commits to master since this release</a><br>
<a href="https://github.com/gorhill/uBlock/compare/1.52.2...1.53.0">Commits since last release</a></p>
<p>To install the stable build:</p>
<ul>
<li><strong>Firefox</strong>: Review pending 
<ul>
<li><a href="https://github.com/gorhill/uBlock/wiki/uBlock-Origin-works-best-on-Firefox">uBO works best on Firefox</a>.</li>
</ul>
</li>
<li><strong>Chromium</strong>: Submission pending </li>
<li><strong>Edge</strong>: Install from Microsoft Store: <a href="https://microsoftedge.microsoft.com/addons/detail/odfafepnkmbhccpbejgmiehpchacaeak" rel="nofollow">https://microsoftedge.microsoft.com/addons/detail/odfafepnkmbhccpbejgmiehpchacaeak</a>
<ul>
<li>The Microsoft Store version of uBO is published by <a href="https://github.com/nicole-ashley/uBlock-Edge">Nicole Rolls</a></li>
</ul>
</li>
<li><strong>Opera</strong>: Submission pending </li>
</ul>
<hr>
<h2>Fixes / changes</h2>
<ul>
<li><a href="https://github.com/gorhill/uBlock/commit/d51b393fdb">Add additional set-cookie names</a> (by <a data-hovercard-type="user" data-hovercard-url="/users/ryanbr/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/ryanbr">@ryanbr</a>)</li>
<li><a href="https://github.com/gorhill/uBlock/commit/b445f4f4cd">Improve google-ima shim script</a> (by <a data-hovercard-type="user" data-hovercard-url="/users/kzar/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/kzar">@kzar</a>)</li>
<li><a href="https://github.com/gorhill/uBlock/commit/d32204f984">Match <code>type</code> exactly in <code>prevent-addEventListener</code> scriptlet</a></li>
<li><a href="https://github.com/gorhill/uBlock/commit/a9ff41ae55">Add filtering expressions for logger output</a></li>
<li><a href="https://github.com/gorhill/uBlock/commit/f1ce3b2191">Add warning against adding custom filters from untrusted sources</a></li>
<li><a href="https://github.com/gorhill/uBlock/commit/64c1f8767c">Consider <em>My filters</em> an untrusted source by default</a></li>
<li><a href="https://github.com/gorhill/uBlock/commit/1c9da227d7">Add <code>trusted-prune-inbound-object</code> scriptlet</a></li>
<li><a href="https://github.com/gorhill/uBlock/commit/607bba6eaf">Add <code>dontOverwrite</code> vararg to <code>(trusted-)set-cookie</code> scriptlets</a></li>
<li><a href="https://github.com/gorhill/uBlock/commit/eb66129fbf">Add "on" and "off" values to set-cookie</a> (by <a data-hovercard-type="user" data-hovercard-url="/users/peace2000/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/peace2000">@peace2000</a>)</li>
<li><a href="https://github.com/gorhill/uBlock/commit/41d91ed080">Fine tune <code>set-local-storage-item</code> as per feedback</a></li>
<li><a href="https://github.com/gorhill/uBlock/commit/9d3acd91b8">Support AdGuard's <code>[trusted-]set-cookie-reload</code> scriptlets</a></li>
<li><a href="https://github.com/gorhill/uBlock/commit/7daf31336a">Ignore assets older than cached version when fetching from CDNs</a></li>
<li><a href="https://github.com/gorhill/uBlock/commit/027c7a4fb5">Support quoting scriptlet parameters with backticks</a></li>
<li><a href="https://github.com/gorhill/uBlock/commit/2e4525fe3c">Add new static network filter option: <code>urltransform</code></a></li>
<li><a href="https://github.com/gorhill/uBlock/commit/bee64ebd90">Support pane: mark lists as obsolete only when update button is clicked</a></li>
<li><a href="https://github.com/gorhill/uBlock/commit/c96a673338">Bring <code>header=</code> filter option out of experimental status</a></li>
<li><a href="https://github.com/gorhill/uBlock/commit/7af88b025d">Add <code>trusted-click-element</code> scriptlet</a></li>
<li><a href="https://github.com/gorhill/uBlock/commit/0325dcdcb4">Add ability to update lists through links with specifically crafted URLs</a></li>
<li><a href="https://github.com/gorhill/uBlock/commit/e5c1b63315">Fix overzealous matching in <code>(remove|replace)-node-text</code> scriptlets</a></li>
<li><a href="https://github.com/gorhill/uBlock/commit/6f74df942d">Fix <code>no-xhr-if</code> scriptlet for Firefox</a></li>
<li><a href="https://github.com/gorhill/uBlock/commit/437453233d">Support restoring from <code>application/json</code> file</a></li>
<li><a href="https://github.com/gorhill/uBlock/commit/780383faef">Use safe versions of <code>Math.floor</code>/<code>Math.random</code> in scriptlets</a></li>
<li><a href="https://github.com/gorhill/uBlock/commit/02c7b32bef">Improve <code>google-ima.js</code> surrogate</a></li>
<li><a href="https://github.com/gorhill/uBlock/commit/6b211f622c">Add <code>stackToMatch</code> vararg to <code>json-prune</code>-related scriptlets</a></li>
<li><a href="https://github.com/gorhill/uBlock/commit/4cac9d185b">Reduce race conditions in scriptlet injection on Firefox</a></li>
<li><a href="https://github.com/gorhill/uBlock/commit/4e2aa3e384">Add scriptlet aliases for compatibility with AdGuard lists</a></li>
<li><a href="https://github.com/gorhill/uBlock/commit/c3cd596175">Remove unmaintained urlhaus PUP filter list</a></li>
<li><a href="https://github.com/gorhill/uBlock/commit/402e2ebf57">Use AG version of urlhaus list</a></li>
<li><a href="https://github.com/gorhill/uBlock/commit/cce3f3efc1">Minor code review of scriptlets</a></li>
</ul></div>
</div>
  <div data-view-component="true">          <div>
            <h3 data-view-component="true">Contributors</h3>
            

  <p>
    kzar, ryanbr, and peace2000
  </p>

          </div>

        


          <div data-view-component="true">
  <!-- '"` --><!-- </textarea></xmp> --><form data-turbo="false" action="/gorhill/uBlock/reactions" accept-charset="UTF-8" method="post">
    
    <div>
          <tool-tip id="tooltip-401b6a2a-de8b-4815-b43a-270d4c18d728" for="reactions--reaction_button_component-21c280" popover="manual" data-direction="n" data-type="description" data-view-component="true">Firmeteran, l3xrom, VerTigoNTxvii, superlex, azzamsa, SampeiNihira, Bardock88, kkaosninja, Rise58, EliothMonroy, and 4 more reacted with thumbs up emoji</tool-tip>
          <tool-tip id="tooltip-c63c788e-ef8a-46b5-96f3-ba2b8e3abd5f" for="reactions--reaction_button_component-d68b10" popover="manual" data-direction="n" data-type="description" data-view-component="true">maxkorsov, mdmrk, and i0tool5 reacted with hooray emoji</tool-tip>
          <tool-tip id="tooltip-0d40885b-f2e0-4d22-b24f-739074d25dc5" for="reactions--reaction_button_component-8d205e" popover="manual" data-direction="n" data-type="description" data-view-component="true">superlex, azzamsa, Exploding-Joysticks, Rise58, rywz, eksan127, and maxkorsov reacted with heart emoji</tool-tip>
          <tool-tip id="tooltip-1612bfa3-056f-4495-ba0f-32debe91ae71" for="reactions--reaction_button_component-ca2e00" popover="manual" data-direction="n" data-type="description" data-view-component="true">GwnMichael, superlex, azzamsa, SampeiNihira, dingobar, Bardock88, Rise58, rywz, maxkorsov, and i0tool5 reacted with rocket emoji</tool-tip>
      
    </div>
</form>    <p>20 people reacted</p>
</div>
</div>
</div>

</div>

</turbo-frame>


    </main>
  </div>

          




  

    <template id="site-details-dialog">
  <details class="details-reset details-overlay details-overlay-dark lh-default color-fg-default hx_rsm" open="">
    <summary role="button" aria-label="Close dialog"></summary>
    <details-dialog class="Box Box--overlay d-flex flex-column anim-fade-in fast hx_rsm-dialog hx_rsm-modal">
      <button class="Box-btn-octicon m-0 btn-octicon position-absolute right-0 top-0" type="button" aria-label="Close dialog" data-close-dialog="">
        <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-x">
    <path d="M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l3.22 3.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-3.22 3.22a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z"></path>
</svg>
      </button>
      <div class="octocat-spinner my-6 js-details-dialog-spinner"></div>
    </details-dialog>
  </details>
</template>

    

    <template id="snippet-clipboard-copy-button">
  <div class="zeroclipboard-container position-absolute right-0 top-0">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn js-clipboard-copy m-2 p-0 tooltipped-no-delay" data-copy-feedback="Copied!" data-tooltip-direction="w">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon m-2">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none m-2">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>
    </clipboard-copy>
  </div>
</template>
<template id="snippet-clipboard-copy-button-unpositioned">
  <div class="zeroclipboard-container">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn btn-invisible js-clipboard-copy m-2 p-0 tooltipped-no-delay d-flex flex-justify-center flex-items-center" data-copy-feedback="Copied!" data-tooltip-direction="w">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>
    </clipboard-copy>
  </div>
</template>




    </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Reflections on quitting my job (111 pts)]]></title>
            <link>https://mooseyanon.medium.com/reflections-on-quitting-my-job-fe7410e15a6a</link>
            <guid>38093669</guid>
            <pubDate>Wed, 01 Nov 2023 01:43:37 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://mooseyanon.medium.com/reflections-on-quitting-my-job-fe7410e15a6a">https://mooseyanon.medium.com/reflections-on-quitting-my-job-fe7410e15a6a</a>, See on <a href="https://news.ycombinator.com/item?id=38093669">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><div><h2 id="82d6">Programming lessons I’ve learnt over the last 7 years.</h2><div><a rel="noopener follow" href="https://mooseyanon.medium.com/?source=post_page-----fe7410e15a6a--------------------------------"><div aria-hidden="false"><p><img alt="MooseyAnon" src="https://miro.medium.com/v2/resize:fill:88:88/1*-yzglugPoZUiknfCBAgarQ.jpeg" width="44" height="44" loading="lazy" data-testid="authorPhoto"></p></div></a></div></div><figure><figcaption>We made it out boii!</figcaption></figure><p id="73b0">Last month I quit my job. There were several reasons for my decision but it mainly boiled down to me turning 30 this year, having an existential crisis questioning wtf I’m doing with my life and ultimately, realising I wasn’t having fun programming professionally anymore. I concluded that I needed some time away to fall back <em>“in love”</em> with programming, as a hobby with no financial strings attached to it. Obviously, I recognise this is an incredibly privileged thing to do, not working is something that many people can only dream of.</p><p id="9f97">So here I am, in my PJs after waking up at 12pm on a Tuesday, reflecting on my time working as a <em>“professional”</em> programmer, a career I’ve largely fallen into by accident.</p><h2 id="a992">Backstory</h2><p id="5883">I was never one of those kids that got into programming at 10 yrs old. When I was 10 I was at the cage in the estate next to my nan’s house shouting <em>”top bins!”</em> as I did my best Bend it Like Beckham impression (I’m still bitter I could never get the spiky hair going). Throughout my school life my main guiding heuristic was fun, I only ever did things I enjoyed. So when the time came to pick a degree I chose psychology because the syllabus looked cool and I’ve always found humans pretty interesting. Its funny, as I’ve gotten more experience as a developer one of the things that stand out to me the most is that there are a lot more human problems than people realise in any given software project. Problems that cant simply be coded away, so understanding humans has been surprisingly useful.</p><p id="d6f3">I’ve always been an avid reader of blogs and online publications. While at uni I has subscriptions to Scientific American, Wired, Arch Daily and Dezeen (what can I say, I’m a cultured guy). Toward the end of my time at uni there was a lot of buzz around CRISPR and self-driving cars. It was around then that I heard of neural networks for the first time. I think the fact that I understood the underlying analogy of neural nets was really important in helping me get over the subconscious mental barrier that I couldn’t be involved in technology in any other way than as a consumer.</p><p id="d770">Anyways, as I got toward the end of my degree I could no longer ignore the <em>”What are you going to do with psychology?”</em> question. After sitting on the question for some time I (naively) figured the three most important areas in the working world I could have an impact on were: humans, finance and technology. I knew I didn’t want to become a therapist because I had already been unofficially doing that for my friends and family for a while and peoples problems are tiring af. I’d always disliked finance (and still do tbh) so the only option left was technology.</p><p id="239c">I remember the day I wrote my fist line of code, it was 2nd of Jan 2016. I was 2 months away from 23. I started the day full of optimism and tried the python course on CodeAcademy (it was still free back then) and literally everything went over my head. I couldn’t grasp any of it. I remember feeling like an idiot for even thinking I could do this at 23. The failure confirmed the stereotypes I’d seen on TV, that if you didn’t start writing code at 10, then this wasn’t for you. Just as I was about to give up I decided to try CodeAcademy’s HTLM&amp;CSS course. To my surprise, I managed to whizz through it and firmly understood the material. I genuinely think if I hadn’t done that course I might have become an investment banker or something 🤢.</p><p id="49bf">Fast forward two years, an internship at AKQA, a shitty SWE job at a shitty startup, and then I got the offer to join the team I have just left. The best description of our role in the company is probably what AWS is to Amazon, the team manages the company’s internal infrastructure and data centre. Everything from procuring racks and servers; designing and implementing the data centres network topology; configuring servers and all the services that run on top (all the way up to JS for the interface used by other teams); configuring and running a bare metal Kubernetes (k8s) cluster and probably a lot more stuff that currently escapes my mind. It is a real diverse set of things to work on.</p><p id="b3ab">After exactly 5 yrs (to the day) with the team, I decided it was time to pack it all in for a bit. However, while the experiences are still fresh in my mind and I have some breathing space I want to go over the things I’ve learned and discovered in my journey from programmer training wheels to today, where I would describe myself as whatever the programming equivalent of puberty is.</p><h2 id="4ccc">Have an opinion</h2><p id="cca0">After my first year in the team, I remember asking one of our senior engineers for <strong><em>technical</em></strong> feedback. I asked him what I could do to improve. He told me a bunch of stuff but the one that stuck was,<em> ”have an opinion”</em>. Over the years I’ve thought about this a lot and I’ve come to the conclusion that having an opinion on a technical decision forces you to be able to justify that decision and to justify it you need a deeper understanding of that technology or choice.</p><p id="3ddb">I’ve always described SWEs as 15-year-old girls fighting over their favourite boy bands, jumping from one band to the next when something new and hot comes along. Having an opinion grounded in sound technical understanding can help calm that mental storm of feeling like you always need to keep up because you can either disagree with something based on evidence or can find connections between things based on your deeper understanding.</p><p id="51bd">I mean, he could have literally meant<em> ”fuck everyone, just bully your opinion onto people”</em> with no deeper meaning but this is how I’ve interpreted it. I guess you could say its just my opinion, innit.</p><h2 id="9aa0">Debugging is a science</h2><p id="13f7">Fast forward a few years and I was having some problems getting through tickets. Everything felt slow and laboured. I was struggling to get the last 10% of tickets working and over the line. I wasn’t really sure what to do and I guess others in the team picked up on it because our tech lead offered to take me for a coffee and some programmer therapy.</p><p id="bdf3">He asked me,<em> ”whats your approach to writing software?”</em>. At the time I remember thinking <em>”What do you mean bruv? The same as you obviously, I use a text editor.”</em>. I was a little confused by the question because I had never really thought about it. After some discussion we highlighted that my approach to writing code was akin to an artist throwing paint at a blank canvas, I tend to write what <strong><em>feels</em></strong> good. I also came to the realisation I didn’t really know how to debug code efficiently. I was fine debugging my own code but I would struggle to debug systems and components I was unfamiliar with. At the time a lot of my work was combining systems/components rather than writing fresh code myself, I was slightly out of my depth.</p><p id="6337">Debugging is a separate skill from writing code. It requires a different way of working and without deliberate practice, like anything, you won’t improve. Our tech lead told me, <em>”Writing code is creative, its like art. Debugging is like science, you need to formulate a small hypothesis and test it, then keep doing that till you’ve fixed the problem”</em>. That was incredibly eye-opening.</p><p id="29e4">Since that conversation, I’ve come to the conclusion that there are three main pillars of being a good software engineer: writing code, debugging code and reviewing code. We spend a lot of time focusing on and actively trying to improve the code-writing part but not so much on the other two. While I’m not a pair programming fanboy there are definitely times where its well worth sitting down and watching someone more experienced than you solve a problem, then comparing it to how you would do it and using that data to figure out how to improve. I would say that pair debugging and pair code review are just as important. You can speed run your personal development just by seeing what kind of questions the other person asks while reviewing and how they break down their debugging into testable chunks.</p><h2 id="299c">Pragmatic programming</h2><p id="2f56">Unlike my actual politics, I would describe my philosophy to software changes as <strong><em>small C</em></strong> conservative. I feel there needs to be a strong reason to make a drastic change to working code. Fundamentally, I believe giving your customers high-quality, working code trumps everything else. Customers really don’t care about how your team is collectively jerking off to memory-safe, perfectly functional code with no side effects. The end user doesn’t care if your code is readable, DRY, maintainable or spaghetti code. They care that the product works as intended and does so reliably.</p><p id="260c">As SWEs, I think we sometimes forget that. I would describe the team I just left’s approach to software delivery as pragmatic, working code trumps perfect code. It doesn’t matter if your code isn’t abstracted into a perfectly generic DSL, does that refactor need to happen? One of the things about gaining experience is you learn when to break the rules. You learn when its fine to copy and paste working code instead of trying to abstract it away, which then not only risks delaying that new feature or proof of concept but also risks breaking systems that we already know works well.</p><p id="65cd">I believe software gets complicated at the edges, at the points where systems interact with each other. Ensuring that the core of the system is as simple as possible to write, reason about and manage is the most important goal of any software project. I find saying <strong><em>no</em></strong> more often than saying <strong><em>yes</em></strong> makes reaching this target easier for everyone.</p><h2 id="31c9">You’re still a code parent even after you’ve merged and deployed</h2><p id="3b0c">Like everyone else, when the pandemic started we had a bunch of problems (other than the pandemic itself) transitioning from an in-office team to a remote team. During the first lockdown, we found ourselves in the office regularly doing maintenance and fixing fires. We’d always had monitoring but after this experience, we wanted to ramp up the observability of our systems.</p><p id="d79b">To hark back to my earlier point about human problems, throwing new tools at the problem is the easy part, the cultural change required for the tools to be useful is what’s actually hard. So we’ve just added tracing, that’s cool, now what?</p><p id="d3e8">You need to make sure your SWEs understand that they still have responsibilities even after their PR has been merged. They need to feel a sense of ownership over the entire system and lifecycle of a program/feature/change. Jenkins is broken? CI failed? We need to tweak the resources used by a service in our k8s cluster? It shouldn’t matter if a SWE mainly works on the frontend or backend or infrastructure, everyone should be able to jump in and fix the issue. It shouldn’t be any single persons responsibility, it should be <strong><em>our </em></strong>responsibility.</p><p id="f82e">Its this cultural change that necessitates the tooling. When SWEs realise its a pain to be consistently retroactive to fires instead of proactive to prevent the fire in the first place, they start thinking about the best ways to approach the problem. The solution and/or tooling is not important as long as it helps the team achieve their targets, its the collective desire of the team to ensure quality thats important.</p><h2 id="771a">Git — you’re doing it wrong (probably)</h2><p id="79c4">Although I said I’m a <strong><em>small C</em></strong> conservative, there are very few technology hills I’m willing to die on. After a convincing conversation, I’m happy to change my mind on most things, except git. Git is a hill I’m willing to die on.</p><p id="e11b">Every software team in the world has its own culture and ways of doing things, which is all good but when I see teams using git as a glorified <strong><em>`ctrl + s`</em></strong> it really breaks my heart.</p><p id="f524">This should be its own blog post (one I’m planning on writing) but these are some of my general issues with how I see teams use git. I apologise in advance for any hurt feelings but here goes…</p><p id="5c08">If you squash on merge, you’re doing it wrong. If you’ve never used git blame, you’re doing it wrong. If your repo’s history is useless, you’re doing it wrong. If you didn’t add a typo fix or white line change as a separate commit, you’re doing it wrong. If you’re commit message (when raising a PR) only consists of the words<em> ”fixup”</em> or a ticket number or a PR link, you’re doing it wrong. If you have a policy of one commit per PR, you’re doing it wrong. If you’re scared of a merge conflict, you’re doing it wrong.</p><p id="1278">In the time I’ve been working I’ve seen Jira projects change names, I’ve seen repos move from stash (bitbucket predecessor) to GitHub.com and then from GitHub.com to GitHub Enterprise. The only constant has been the <strong><em>`main`</em></strong> branch. As a tech company, as long as you’re in business the <strong><em>`main`</em></strong> branch will exist. Knowing that, it should be the single source of truth for your code base.</p><p id="551a">In my eyes, <strong><em>`main`</em></strong> has two main functions: firstly, it captures a moment in time. It shouldn’t redirect you to a ticket or PR, there is no guarantee either of those will exist. It should be self-encompassing. You shouldn’t try preserve history because I dont care about the journey or what discussions were had, all I care about is the final copy that got merged into <strong><em>`main`</em></strong>.</p><p id="ef4e">Secondly, its a forensic tool. You whip it out when something goes wrong and you need to go into NCIS mode. You should be able to meaningfully bisect <strong><em>`main` </em></strong>(read: without getting rid of whole features), you should be able to use <strong><em>`git blame`</em></strong> and be able to check the history of a line to see its accompanying changes. I dont wanna check the history of some line of code and see a whole heap of changes that have absolutely nothing to do with it because someone decided to fix a typo as part of some other work.</p><p id="1122">Your history should be clean and easily readable. Each commit should contain one logical change and ideally pass CI. If you dont know what that means its something that comes with experience but in a nutshell if you change some bit of code adding/removing/editing docs, comments and tests relevant to that change should all be a part of that commit. Nothing else, no typo fixes, no refactors, renaming another function etc, all of that should be separate commits. Your commit message should have a short title explaining the change and the body should go into as much detail as necessary into <strong><em>why</em></strong> the change took place, I can see the <strong><em>what</em></strong> from looking at the diff.</p><p id="1462">Ok, I’ll stop there before someone spontaneously combusts in flames of rage.</p><h2 id="5075">Hardware still matters</h2><p id="255c">We live in a world of abstractions. Whether its the cloud or the frameworks we use every day, we can sometimes forget that underneath it all everything is still running on physical computers somewhere.</p><p id="6794">Over the last five years, I’ve changed hard drives and SSDs; I added network cards to server chassis; I’ve diagnosed kernel panics on servers without BMC or IPMI interfaces by literally pushing in a trolley with a monitor and keyboard; I’ve installed device drivers for an array of weird devices; I’ve sat in hardware procure meetings; I’ve configured network switches; I’ve written kickstart files and configured `PXE` boots using MAC addresses; I’ve plugged ethernet cables in and out more times than I can count.</p><p id="408f">I may never again work in a team where I have a mental map of all the hardware we own or a team where <strong><em>`ssh`</em></strong> + <strong><em>`dmseg/journalctl`</em></strong> is the starting point of my debugging but the education I’ve had working on those systems will last me a lifetime. I’ve had a crash course in electrical engineering and computer science that I could have never gotten from any university in the world. I firmly believe its easier to go up the stack than it is to go down.</p><p id="0e64">In the outside world, there is a generation of people who only think in EC2s and AWS lambda’s and I dont blame them for that, its the world we live in. I just don’t believe that <strong><em>`ssh`</em></strong>-ing into a machine and digging around the file system using <strong><em>`vi`</em></strong> will ever not be a useful skill to have.</p><h2 id="8d4d">Being dumb is fun</h2><p id="1c7f">As I alluded to at the start of this post I’ve been playing both team and individual sports my whole life. One of the unique properties of sport is that you are viscerally aware of where you sit on the <strong><em>sucks</em></strong> -&gt; <strong><em>excellent</em></strong> spectrum. And if you are not sure someone will definitely let you know, whether its by running rings around you or literally shouting, <em>“Oi you’re fucking shit, go home”</em> across the field (true story, it’s happened to me). Inevitably, even if you’re a candidate with a realistic chance of going pro, at some point you’re going to suck.</p><p id="9d86">There are two ways you can deal with this: 1) actually go home and either leave the team or worse, leave the sport altogether, 2) suck it up and train harder so you can be the one telling people they’re shit. I’ve found that everyone who plays sports long enough is pretty competitive and doesn’t take criticism to heart in a way that people who haven’t sometimes do.</p><p id="c098">What’s this got to do with software engineering? I feel like there is a weird parallel, where there is a certain class of engineer, usually good at what they do and/or in positions of power, who are more than happy to tell you you’re shyte. They’re the type who don’t talk to you, they talk <strong><em>at</em></strong> you. The type who dont ever ask you questions in a conversation outside of <em>“What, you really dont know what X is??”</em>. The type who don’t explain things in an audience-appropriate manner, you either get it on their level or you dont.</p><p id="4323">As a normie, when I first met these types of engineers I didn’t know how to talk or deal with them. I’ve had engineers publically ask me, <em>“Did they not ask you what your favourite Linux distro is before they offered you the job?”</em> in a condescending tone when they discovered I didn’t know much about Linux. I’ve had engineers give me 101 comments on a PR starting with <em>“What the fuck is this…”</em> and ending with me coming in one morning to find the whole thing rewritten.</p><p id="7ac1">Over time I learned that while there are a bunch of them blowing hot smoke out their arses, there are also some who actually know what they’re talking about. The competitor in me always wants to improve so occasionally stroking their egos and making them feel like the smartest person in the room can lead to a lot of valuable and obscure bits of information that might have taken you months or years to discover by yourself. And in all honesty, it’s not that hard to do. It usually just involves you asking them a question and shutting the fuck up because as I said, they dont need more than themselves to carry a conversation.</p><p id="dbf3">I’ve also learnt that in any given team there are a lot more<em> me’s</em> than there are <em>them’s</em>. People who are confused but are too intimidated to ask questions or dont want to look stupid. As a result, I always pitch myself as the dumbest person in the room and ask all the stupid questions I can think of. Its beneficial for not only me but for others in the team too. Not everyone is comfortable playing this role or looking stupid in front of their peers but growing up being berated on a football pitch by your mate’s dad gives you some pretty thick skin.</p><h2 id="f07e">Fin</h2><p id="43d3">So that’s mostly what I can think of for now. It’ll be fun to come back in 7 yrs’ time to see what changed and what stayed the same in terms of my perspective on software engineering (if I’m still doing it), until then and in the wise words of Bill &amp; Ted, <em>“Be excellent to each other!”</em>.</p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Louis Rossmann given three YouTube community guideline strikes (115 pts)]]></title>
            <link>https://twitter.com/FUTO_Tech/status/1719468941582442871</link>
            <guid>38093375</guid>
            <pubDate>Wed, 01 Nov 2023 00:59:45 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://twitter.com/FUTO_Tech/status/1719468941582442871">https://twitter.com/FUTO_Tech/status/1719468941582442871</a>, See on <a href="https://news.ycombinator.com/item?id=38093375">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="ScriptLoadFailure"><form action="" method="GET"><div><p><span>Something went wrong, but don’t fret — let’s give it another shot.</span></p><br></div></form></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Distil-Whisper: distilled version of Whisper that is 6 times faster, 49% smaller (170 pts)]]></title>
            <link>https://github.com/huggingface/distil-whisper</link>
            <guid>38093353</guid>
            <pubDate>Wed, 01 Nov 2023 00:55:41 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/huggingface/distil-whisper">https://github.com/huggingface/distil-whisper</a>, See on <a href="https://news.ycombinator.com/item?id=38093353">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text"><h2 tabindex="-1" id="user-content-distil-whisper" dir="auto"><a href="#distil-whisper">Distil-Whisper</a></h2>
<p dir="auto"><a href="https://github.com/huggingface/distil-whisper/blob/main/Distil_Whisper.pdf">[Paper]</a>
<a href="https://huggingface.co/collections/distil-whisper/distil-whisper-models-65411987e6727569748d2eb6" rel="nofollow">[Models]</a>
<a href="https://wandb.ai/sanchit-gandhi/distil-whisper/workspace?workspace=user-sanchit-gandhi" rel="nofollow">[wandb]</a></p>
<p dir="auto">Distil-Whisper is a distilled version of Whisper that is <strong>6 times faster</strong>, 49% smaller, and performs <strong>within 1% WER</strong> on
out-of-distribution evaluation sets.</p>
<table>
<thead>
<tr>
<th>Model</th>
<th>Link</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>distil-medium.en</code></td>
<td>To be published on November 2nd</td>
</tr>
<tr>
<td><code>distil-large-v2</code></td>
<td>To be published on November 2nd</td>
</tr>
</tbody>
</table>
<h2 tabindex="-1" id="user-content-1-usage-" dir="auto"><a href="#1-usage-">1. Usage 👨‍💻</a></h2>
<p dir="auto">The Distil-Whisper checkpoints will be released on November 2nd with a direct 🤗 Transformers integration. Instructions
for running inference will be provided here:</p>
<div dir="auto" data-snippet-clipboard-copy-content="from transformers import WhisperForConditionalGeneration

..."><pre><span>from</span> <span>transformers</span> <span>import</span> <span>WhisperForConditionalGeneration</span>

...</pre></div>
<h2 tabindex="-1" id="user-content-2-why-use-distil-whisper-️" dir="auto"><a href="#2-why-use-distil-whisper-️">2. Why use Distil-Whisper? <g-emoji alias="interrobang">⁉️</g-emoji></a></h2>
<p dir="auto">Distil-Whisper is designed to be a drop-in replacement for Whisper on English ASR. Here are 4 reasons for making the
switch to Distil-Whisper:</p>
<ol dir="auto">
<li><strong>Faster inference:</strong> 6 times faster inference speed, while performing to within 1% WER of Whisper on out-of-distribution audio:</li>
</ol>
<p dir="auto">
  <a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/ebf591a662450e6350988f3bd886ba5ab6fdaf2178fe5fa92bbdfe063047149c/68747470733a2f2f68756767696e67666163652e636f2f64617461736574732f64697374696c2d776869737065722f666967757265732f7265736f6c76652f6d61696e2f6d61696e5f7461626c652e706e673f7261773d74727565"><img src="https://camo.githubusercontent.com/ebf591a662450e6350988f3bd886ba5ab6fdaf2178fe5fa92bbdfe063047149c/68747470733a2f2f68756767696e67666163652e636f2f64617461736574732f64697374696c2d776869737065722f666967757265732f7265736f6c76652f6d61696e2f6d61696e5f7461626c652e706e673f7261773d74727565" width="600" data-canonical-src="https://huggingface.co/datasets/distil-whisper/figures/resolve/main/main_table.png?raw=true"></a>
</p>
<ol start="2" dir="auto">
<li><strong>Robustness to noise:</strong> demonstrated by strong WER performance at low signal-to-noise ratios:</li>
</ol>
<p dir="auto">
  <a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/af9186f374ecd1491c50806bb1981b463484359758c0a6d3009085576e3367f5/68747470733a2f2f68756767696e67666163652e636f2f64617461736574732f64697374696c2d776869737065722f666967757265732f7265736f6c76652f6d61696e2f6e6f6973652e706e673f7261773d74727565"><img src="https://camo.githubusercontent.com/af9186f374ecd1491c50806bb1981b463484359758c0a6d3009085576e3367f5/68747470733a2f2f68756767696e67666163652e636f2f64617461736574732f64697374696c2d776869737065722f666967757265732f7265736f6c76652f6d61696e2f6e6f6973652e706e673f7261773d74727565" width="600" data-canonical-src="https://huggingface.co/datasets/distil-whisper/figures/resolve/main/noise.png?raw=true"></a>
</p>
<ol start="3" dir="auto">
<li><strong>Robustness to hallucinations:</strong> quantified by 1.3 times fewer repeated 5-gram word duplicates (5-Dup.) and 2.1% lower insertion error rate (IER) than Whisper:</li>
</ol>
<p dir="auto">
  <a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/274feb17952aa4572d148dced4b452803a06c769e4e548e2632afbdaefd13128/68747470733a2f2f68756767696e67666163652e636f2f64617461736574732f64697374696c2d776869737065722f666967757265732f7265736f6c76652f6d61696e2f68616c6c7563696e6174696f6e2e706e673f7261773d74727565"><img src="https://camo.githubusercontent.com/274feb17952aa4572d148dced4b452803a06c769e4e548e2632afbdaefd13128/68747470733a2f2f68756767696e67666163652e636f2f64617461736574732f64697374696c2d776869737065722f666967757265732f7265736f6c76652f6d61696e2f68616c6c7563696e6174696f6e2e706e673f7261773d74727565" width="600" data-canonical-src="https://huggingface.co/datasets/distil-whisper/figures/resolve/main/hallucination.png?raw=true"></a>
</p>
<ol start="4" dir="auto">
<li><strong>Designed for speculative decoding:</strong> Distil-Whisper can be used as an assistant model to Whisper, giving 2 times faster inference speed while mathematically ensuring the same outputs as the Whisper model.</li>
</ol>
<h2 tabindex="-1" id="user-content-3-approach-️" dir="auto"><a href="#3-approach-️">3. Approach ✍️</a></h2>
<p dir="auto">To distill Whisper, we copy the entire encoder module and freeze it during training. We copy only two decoder layers,
which are initialised from the first and last decoder layers from Whisper. All other decoder layers from Whisper
are discarded.</p>
<p dir="auto">
  <a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/213d411e260670d7b418caa2c37ee9aebd107bff8637c81f38621dd2ccb08e00/68747470733a2f2f68756767696e67666163652e636f2f64617461736574732f64697374696c2d776869737065722f666967757265732f7265736f6c76652f6d61696e2f6172636869746563747572652e706e673f7261773d74727565"><img src="https://camo.githubusercontent.com/213d411e260670d7b418caa2c37ee9aebd107bff8637c81f38621dd2ccb08e00/68747470733a2f2f68756767696e67666163652e636f2f64617461736574732f64697374696c2d776869737065722f666967757265732f7265736f6c76652f6d61696e2f6172636869746563747572652e706e673f7261773d74727565" width="600" data-canonical-src="https://huggingface.co/datasets/distil-whisper/figures/resolve/main/architecture.png?raw=true"></a>
</p>
<p dir="auto">Distil-Whisper is trained on a <em>knowledge distillation</em> objective. Specifically, it is trained to minimise the KL divergence
between the distilled model and the Whisper model, as well as the cross-entropy loss on pseudo-labelled audio data.</p>
<p dir="auto">We train Distil-Whisper on a total of 22k hours of pseudo-labelled audio data, spanning 10 domains with over 18k speakers:</p>
<p dir="auto">
  <a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/6fd49ea0e4d277311409ed41178109c5e6f39a05a1fa2cc2506ba0566f03448d/68747470733a2f2f68756767696e67666163652e636f2f64617461736574732f64697374696c2d776869737065722f666967757265732f7265736f6c76652f6d61696e2f64617461736574732e706e673f7261773d74727565"><img src="https://camo.githubusercontent.com/6fd49ea0e4d277311409ed41178109c5e6f39a05a1fa2cc2506ba0566f03448d/68747470733a2f2f68756767696e67666163652e636f2f64617461736574732f64697374696c2d776869737065722f666967757265732f7265736f6c76652f6d61696e2f64617461736574732e706e673f7261773d74727565" width="600" data-canonical-src="https://huggingface.co/datasets/distil-whisper/figures/resolve/main/datasets.png?raw=true"></a>
</p>
<p dir="auto">This diverse audio dataset is paramount to ensuring robustness of Distil-Whisper to different datasets and domains.</p>
<p dir="auto">In addition, we use a WER filter to discard pseudo-labels where Whisper mis-transcribes or hallucinates. This greatly
improves WER performance of the downstream distilled model.</p>
<p dir="auto">For full details on the distillation set-up and evaluation results, refer to the <a href="https://github.com/huggingface/distil-whisper/blob/main/Distil_Whisper.pdf">Distil-Whisper paper</a>.</p>
</article>
          </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Show HN: Halloween game to show off my new Terminal (149 pts)]]></title>
            <link>https://joel.tools/halloween/</link>
            <guid>38093083</guid>
            <pubDate>Wed, 01 Nov 2023 00:14:03 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://joel.tools/halloween/">https://joel.tools/halloween/</a>, See on <a href="https://news.ycombinator.com/item?id=38093083">Hacker News</a></p>
&lt;Unparsable&gt;]]></description>
        </item>
        <item>
            <title><![CDATA[Black 4.0 (135 pts)]]></title>
            <link>https://www.culturehustleusa.com/products/black-4-0</link>
            <guid>38092624</guid>
            <pubDate>Tue, 31 Oct 2023 23:11:29 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.culturehustleusa.com/products/black-4-0">https://www.culturehustleusa.com/products/black-4-0</a>, See on <a href="https://news.ycombinator.com/item?id=38092624">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="s-553d20bb-84a0-4052-a962-835817917acc"> <div id="s-7b6361e9-92df-42e9-98a4-c8d9928b5e17"> <div id="s-5a10a85f-fc7f-428f-b9e2-6f5cce9bbad0"> <p><h2><span>NOT ALL OBSESSIONS ARE UNHEALTHY</span></h2></p> </div> <div id="s-d95d34fd-4125-4e8c-be76-15c550105d78"> <div id="s-09ef23e6-c97a-4219-a493-4707c1f12290"><h3 dir="ltr">It’s here. </h3> <p dir="ltr">After seven years in the making, it’s here. Black 4.0 is without a doubt the blackest black paint in the known universe. Born out of Stuart Semple’s obsession to share utterly unique art materials that elevate your art, here is a material that has never seen before by the human eye.</p> <p dir="ltr">When Stuart’s obsession came into contact with Anish Kapoor not letting people have Vantablack it led him down a black hole that has resulted in the release of Black 4.0.<strong>&nbsp;</strong></p> <p dir="ltr">See for yourself. Once you’ve seen this Black you’ll never look back.</p></div> <div id="s-c1495ceb-dc75-426f-adb4-b1b6c4ef1bee"> <p> <iframe src="https://player.vimeo.com/video/875663441?autoplay=0&amp;loop=0&amp;transparent=0" allowfullscreen="" title="Embedded Vimeo Video" loading="lazy"> </iframe> </p> </div> </div> </div> <div id="s-bc8584bb-72df-4147-a78d-e5bed9e4806e"> <div id="s-1a3ddca8-142e-4265-aab2-54ce161fdf8c"> <p> <iframe src="https://player.vimeo.com/video/875522147?autoplay=1&amp;loop=1&amp;muted=1&amp;playlist=&amp;transparent=0" allowfullscreen="" title="Embedded Vimeo Video" loading="lazy"> </iframe> </p> </div>  <div id="s-68034d53-551c-438f-91be-f0171e093f4f"> <p><h2><span>YOU THINK IT'S PRETTY HOT</span></h2></p> </div> <div id="s-350dcffb-258e-4a43-922c-212a362369a8"><ul> <li dir="ltr"><span data-fontweight="Bold"><em>"Thank you CultureHustle &amp; Stuart Semple for this opportunity as an artist, it means a lot" </em>@kinesis.and.calamity</span></li> <li dir="ltr"><span data-fontweight="Bold"><em>"Got to say 4.0 was a dream to paint with went down so smooth and dried quickly." </em>@thecatasmodeus</span></li> <li dir="ltr"><span data-fontweight="Bold"><em>"Come and See and I Saw" </em>@<a href="https://www.instagram.com/daviddeclansheahan/#" target="_blank" rel="noopener" data-saferedirecturl="https://www.google.com/url?q=https://www.instagram.com/daviddeclansheahan/%23&amp;source=gmail&amp;ust=1697657571302000&amp;usg=AOvVaw2XDDRSHDSlCz1aWqNeYxch">daviddeclansheahan</a></span></li> <li dir="ltr"><span data-fontweight="Bold">"<em>It’s next level</em>" @<a href="https://www.instagram.com/thewonderprojekt#" target="_blank" rel="noopener" data-saferedirecturl="https://www.google.com/url?q=https://www.instagram.com/thewonderprojekt%23&amp;source=gmail&amp;ust=1697657571302000&amp;usg=AOvVaw0zCtRKTaePDlW4ObIiYBD8">thewonderprojekt</a></span></li> <li dir="ltr"><span data-fontweight="Bold"><span><em>"The 4.0 has great coverage and such a smooth consistency." </em></span><span>@brunskiwaa</span></span></li> </ul></div>  <div id="s-61b17770-577e-4d09-a0fc-b00c6396ae00"> <div id="s-c61f2683-8e4e-4fe4-84fa-9e68c7e1f81d"><h2><span>BLACK 4 DOES THIS...</span></h2> <ul> <li><span>Absorbs all the light in the universe as well as other universes</span></li> <li><span>Works on all surfaces</span></li> <li dir="ltr"><span>Thins with water</span></li> <li dir="ltr"><span>Archival</span></li> <li dir="ltr"><span>No cooking, Vacuum chambers or massive ego needed</span></li> <li dir="ltr"><span>Brush or airbrush</span></li> <li dir="ltr"><span>High quality pigments means a little travels light years</span></li> <li dir="ltr"><span>The mattest, flattest black you'll ever see</span></li> </ul> </div> <div id="s-1a8861c9-60d6-4034-b712-e30c1ceda766"> <p><img srcset="https://i.shgcdn.com/ce398555-222e-4f33-ba80-3c88187b9fba/-/format/auto/-/preview/3000x3000/-/quality/lighter/-/resize/180x/ 180w,https://i.shgcdn.com/ce398555-222e-4f33-ba80-3c88187b9fba/-/format/auto/-/preview/3000x3000/-/quality/lighter/-/resize/360x/ 360w,https://i.shgcdn.com/ce398555-222e-4f33-ba80-3c88187b9fba/-/format/auto/-/preview/3000x3000/-/quality/lighter/-/resize/720x/ 720w,https://i.shgcdn.com/ce398555-222e-4f33-ba80-3c88187b9fba/-/format/auto/-/preview/3000x3000/-/quality/lighter/-/resize/900x/ 900w,https://i.shgcdn.com/ce398555-222e-4f33-ba80-3c88187b9fba/-/format/auto/-/preview/3000x3000/-/quality/lighter/-/resize/1080x/ 1080w,https://i.shgcdn.com/ce398555-222e-4f33-ba80-3c88187b9fba/-/format/auto/-/preview/3000x3000/-/quality/lighter/-/resize/1200x/ 1200w" sizes="100vw" src="https://i.shgcdn.com/ce398555-222e-4f33-ba80-3c88187b9fba/-/format/auto/-/preview/3000x3000/-/quality/lighter/" width="" height="" alt="" decoding="async" loading="lazy"> </p> </div> <div id="s-77c5a103-80a4-462a-bf36-ac56061db8cd"> <h2><span>SO YOU CAN DO THIS.</span></h2> <p><span><strong id="docs-internal-guid-6a9d8dd4-7fff-2b8f-9286-77064f23273c">Black 4 is created by us but ultimately made by our incredible, resilient, patient, supportive community of artists. We recognise the brave artists who tested the Black 4 Founders Edition and let us know how we could make it better.</strong></span></p> </div> <div id="s-eba275a4-2ea4-404e-b70b-e6e97e880cec"><h2><span>max your BLACK 4.0</span></h2> <ul> <li dir="ltr"><span>Use a nice soft brush</span></li> <li dir="ltr"><span>Use at room temperature</span></li> <li dir="ltr"><span>Use as little as possible. Spread evenly</span></li> <li dir="ltr"><span>Allow to dry between coats</span></li> <li dir="ltr"><span>Seal pourous surfaces with 25% PVA and 75% water</span></li> <li dir="ltr"><span>Prime shiny surfaces with primer or Black 2.0</span></li> <li dir="ltr"><span>Share your work with #sharetheblack</span></li> </ul> </div> </div> <div id="s-bed13f62-c2d7-49b6-ad80-4fe20a63a298"> <p><img srcset="https://i.shgcdn.com/6dcab6ae-d27b-41f7-a0fe-4464b39c1289/-/format/auto/-/preview/3000x3000/-/quality/lighter/-/resize/180x/ 180w,https://i.shgcdn.com/6dcab6ae-d27b-41f7-a0fe-4464b39c1289/-/format/auto/-/preview/3000x3000/-/quality/lighter/-/resize/360x/ 360w,https://i.shgcdn.com/6dcab6ae-d27b-41f7-a0fe-4464b39c1289/-/format/auto/-/preview/3000x3000/-/quality/lighter/-/resize/720x/ 720w" sizes="100vw" src="https://i.shgcdn.com/6dcab6ae-d27b-41f7-a0fe-4464b39c1289/-/format/auto/-/preview/3000x3000/-/quality/lighter/" width="" height="" alt="" decoding="async" loading="lazy"> </p> </div> </div>  </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Norwegian ban on Meta behavioral advertising extended to entire EU (412 pts)]]></title>
            <link>https://www.datatilsynet.no/aktuelt/aktuelle-nyheter-2023/datatilsynets-vedtak-mot-meta-utvides-til-eueos-og-gjores-permanent/</link>
            <guid>38092612</guid>
            <pubDate>Tue, 31 Oct 2023 23:10:11 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.datatilsynet.no/aktuelt/aktuelle-nyheter-2023/datatilsynets-vedtak-mot-meta-utvides-til-eueos-og-gjores-permanent/">https://www.datatilsynet.no/aktuelt/aktuelle-nyheter-2023/datatilsynets-vedtak-mot-meta-utvides-til-eueos-og-gjores-permanent/</a>, See on <a href="https://news.ycombinator.com/item?id=38092612">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
<p>- Vi er veldig glade for at Personvernrådet er enige i Datatilsynets vurderinger og utvider forbudet vårt. Målet er at innbyggere over hele Europa vil få bedre personvern, sier direktør i Datatilsynet Line Coll.&nbsp;</p>
<p>Datatilsynet er svært bekymret for den ulovlige sporingen, overvåkingen og profileringen som skjer på Facebook og Instagram. Selv om det lenge har vært klart at Meta bryter loven, og på tross av Datatilsynets forbud i Norge, fortsetter Meta med sin ulovlig behandling av personopplysninger. Dette er grunnen til at vi har valgt å løfte saken til Personvernrådet (EDPB), som nå har sagt seg enige i at det haster med et permanent forbud mot de ulovlige aktivitetene på europeisk nivå.</p>
<p>Facebook og Instagram har over 250 millioner aktive brukere i EU/EØS.</p>
<p>Personvernrådets vedtak er en instruks til det irske datatilsynet om å nedlegge et permanent forbud ovenfor Metas europeiske hovedkontor i Irland. Når dette har skjedd vil forbudet begynne å gjelde.</p>
<p>- Nok er nok. Etter over fem år med krenkelse av brukernes grunnleggende personvern, setter Personvernrådet nå ned foten mot Metas manglende respekt for loven, sier leder for internasjonal seksjon, Tobias Judin.</p>
<p>Meta har&nbsp;fått klar beskjed om at forretningsmodellen deres og bruken av personopplysninger strider med det europeiske personvernregelverket. De har sagt at de vil be brukerne om samtykke til å bruke dataene deres til adferdsbasert markedsføring i fremtiden. Selskapet har imidlertid ikke innført noen konkrete endringer ennå, og dermed fortsetter de ulovlige aktivitetene fortløpende.</p>
<p>Datatilsynet er dessuten i sterk tvil om Metas foreslåtte samtykkeløsning,&nbsp;som innebærer at de som ikke samtykker til adferdsbasert markedsføring må betale en avgift, vil være lovlig. Personvernrådets avgjørelse er derfor viktig for å unngå at&nbsp;Metas lovbrudd fortsetter mens selskapet leter etter en lovlig måte å innrette seg på.&nbsp;</p>
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[M51: A Feast for the Eyes (165 pts)]]></title>
            <link>https://esawebb.org/images/potm2308a/</link>
            <guid>38092596</guid>
            <pubDate>Tue, 31 Oct 2023 23:08:51 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://esawebb.org/images/potm2308a/">https://esawebb.org/images/potm2308a/</a>, See on <a href="https://news.ycombinator.com/item?id=38092596">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>




<p><a href="https://cdn.esawebb.org/archives/images/screen/potm2308a.jpg" title="A FEAST for the eyes">
<img src="https://cdn.esawebb.org/archives/images/screen/potm2308a.jpg">
</a>
</p>

<div><p>The graceful winding arms of the grand-design spiral galaxy M51 stretch across this image from the NASA/ESA/CSA James Webb Space Telescope. Unlike the menagerie of weird and wonderful spiral galaxies with ragged or disrupted spiral arms, grand-design spiral galaxies boast prominent, well-developed spiral arms like the ones showcased in this image. This galactic portrait is a composite image that integrates data from Webb’s <a href="https://esawebb.org/about/instruments/nircam-niriss/">Near-InfraRed Camera</a> (NIRCam) and <a href="https://esawebb.org/about/instruments/miri/">Mid-InfraRed Instrument</a> (MIRI).</p><p>In this image the dark red regions trace the filamentary warm dust permeating the medium of the galaxy. The red regions show the reprocessed light from complex molecules forming on dust grains, while colours of orange and yellow reveal the regions of ionised gas by the recently formed star clusters. Stellar feedback has a dramatic effect on the medium of the galaxy and create complex network of bright knots as well as cavernous black bubbles.</p></div>
<p>M51 — also known as NGC 5194 — lies about 27 million light-years away from Earth in the constellation Canes Venatici, and is trapped in a tumultuous relationship with its near neighbour, the dwarf galaxy NGC 5195. The interaction between these two galaxies has made these galactic neighbours one of the better-studied galaxy pairs in the night sky. The gravitational influence of M51’s smaller companion is thought to be partially responsible for the stately nature of the galaxy’s prominent and distinct spiral arms. If you would like to learn more about this squabbling pair of galactic neighbours, you can explore earlier observations of M51 by the NASA/ESA Hubble Space Telescope <a href="https://esahubble.org/images/heic0506a/">here</a>.&nbsp;</p>
<p>This Webb observation of M51 is one of a series of observations collectively titled Feedback in Emerging extrAgalactic Star clusTers, or <a href="https://www.stsci.edu/jwst/science-execution/program-information?id=1783">FEAST</a>. The FEAST observations were designed to shed light on the interplay between stellar feedback and star formation in environments outside of our own galaxy, the Milky Way. Stellar feedback is the term used to describe the outpouring of energy from stars into the environments which form them, and is a crucial process in determining the rates at which stars form. Understanding stellar feedback is vital to building accurate universal models of star formation.</p>
<p>The aim of the FEAST observations is to discover and study stellar nurseries in galaxies beyond our own Milky Way. Before Webb became operative, other observatories such as the Atacama Large Millimetre Array in the Chilean desert and Hubble have given us a glimpse of star formation either at the onset (tracing the dense gas and dust clouds where stars will form) or after the stars have destroyed with their energy their natal gas and dust clouds. Webb is opening a new window into the early stages of star formation and stellar light, as well as the energy reprocessing of gas and dust. Scientists are seeing star clusters emerging from their natal cloud in galaxies beyond our local group for the first time. They will also be able to measure how long it takes for these stars to pollute with newly formed metals and to clean out the gas (these time scales are different from galaxy to galaxy). By studying these processes, we will better understand how the star formation cycle and metal enrichment are regulated within galaxies as well as what are the time scales for planets and brown dwarfs to form. Once dust and gas is removed from the newly formed stars, there is no material left to form planets.</p>
<p>[<em>Image Description:</em> A large spiral galaxy takes up the entirety of the image. The core is mostly bright white, but there are also swirling, detailed structures that resemble water circling a drain. There is white and pale blue light that emanates from stars and dust at the core’s centre, but it is tightly limited to the core. The rings feature colours of deep red and orange and highlight filaments of dust around cavernous black bubbles.]</p>
<p>Links</p>
<ul>
<li><a href="https://esawebb.org/images/potm2308b/">M51 (NIRCam image)</a></li>
<li><a href="https://esawebb.org/images/potm2308c/">M51 (MIRI image)</a></li>
<li><a href="https://esawebb.org/images/comparisons/potm2308/">Slider tool (NIRCam and MIRI image)</a></li>
</ul>
<p><strong>Credit:</strong></p><p>ESA/Webb, NASA &amp; CSA, A. Adamo (Stockholm University) and the FEAST JWST team</p>


</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[WeWork plans to file for bankruptcy as early as next week, source says (139 pts)]]></title>
            <link>https://www.reuters.com/markets/deals/wework-plans-file-bankruptcy-early-next-week-wsj-2023-10-31/</link>
            <guid>38092585</guid>
            <pubDate>Tue, 31 Oct 2023 23:06:51 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.reuters.com/markets/deals/wework-plans-file-bankruptcy-early-next-week-wsj-2023-10-31/">https://www.reuters.com/markets/deals/wework-plans-file-bankruptcy-early-next-week-wsj-2023-10-31/</a>, See on <a href="https://news.ycombinator.com/item?id=38092585">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-testid="primary-gallery"><p data-testid="Body"><b data-testid="Body">[1/3]</b><span>WeWork logos are seen at a WeWork office in San Francisco, California, U.S. September 30, 2019.  REUTERS/Kate Munsch <a data-testid="Link" href="https://www.reutersagency.com/en/licensereuterscontent/?utm_medium=rcom-article-media&amp;utm_campaign=rcom-rcp-lead" target="_blank" referrerpolicy="no-referrer-when-downgrade"> Acquire Licensing Rights</a></span></p></div><div><p data-testid="paragraph-0">Oct 31 (Reuters) - WeWork <a data-testid="Link" href="https://www.reuters.com/markets/companies/WE.N" target="_blank" referrerpolicy="no-referrer-when-downgrade">(WE.N)</a> plans to file for bankruptcy as early as next week, a source familiar with the matter said on Tuesday, as the SoftBank Group-backed company struggles with a massive debt pile and hefty losses.</p><p data-testid="paragraph-1">Shares of the flexible workspace provider fell 32% in extended trading after the Wall Street Journal first reported the news. They have fallen roughly 96% this year.</p><p data-testid="paragraph-2">New York-based WeWork is considering filing a Chapter 11 petition in New Jersey, the WSJ reported, citing people familiar with the matter.</p><p data-testid="paragraph-3">WeWork declined to comment.</p><p data-testid="paragraph-4">Earlier on Tuesday, WeWork <a data-testid="Link" href="https://www.reuters.com/business/wework-withhold-interest-payment-some-notes-2023-10-31/" referrerpolicy="no-referrer-when-downgrade">said</a> it had entered into an agreement with creditors for temporary postponement of payments for some of its debt, with the grace period nearing an end.</p><p data-testid="paragraph-5">The company had net long-term debt of $2.9 billion as of June end and more than $13 billion in long-term leases, at a time when rising borrowing costs are hurting the commercial real estate sector.</p><p data-testid="paragraph-6">WeWork's filing for bankruptcy would mark a stunning reversal of fortune for the company that was privately valued at $47 billion in 2019 and a black spot for investor SoftBank that sunk billions.</p><p data-testid="paragraph-7">The company has been in turmoil ever since its plans to go public in 2019 imploded following investors' skepticism over its business model of taking long-term leases and renting them for the short term and worries over its hefty losses.</p><p data-testid="paragraph-8">WeWork's woes <a data-testid="Link" href="https://www.reuters.com/business/wework-raises-going-concern-doubt-shares-tank-2023-08-08/" referrerpolicy="no-referrer-when-downgrade">did not abate</a> in subsequent years. It finally managed to go public in 2021 at a much-reduced valuation. Its major backer, Japanese conglomerate SoftBank, sunk tens of billions to prop up the startup, but the company has continued to lose money.</p><p data-testid="paragraph-9">WeWork raised "substantial doubt" about its ability to continue operations in August, with numerous top executives, including CEO Sandeep Mathrani, departing this year.</p><p data-testid="Body">Reporting by Anirban Sen in New York, Manas Mishra and Manya Saini in Bengaluru; Editing by Shailesh Kuber and Anil D'Silva</p><p data-testid="Body">Our Standards: <a data-testid="Link" href="https://www.thomsonreuters.com/en/about-us/trust-principles.html" target="_blank" referrerpolicy="no-referrer-when-downgrade">The Thomson Reuters Trust Principles.</a></p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[WeWork Plans to File for Bankruptcy as Early as Next Week (125 pts)]]></title>
            <link>https://www.wsj.com/articles/wework-plans-to-file-for-bankruptcy-as-early-as-next-week-1fdcb6a5</link>
            <guid>38091216</guid>
            <pubDate>Tue, 31 Oct 2023 20:52:09 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.wsj.com/articles/wework-plans-to-file-for-bankruptcy-as-early-as-next-week-1fdcb6a5">https://www.wsj.com/articles/wework-plans-to-file-for-bankruptcy-as-early-as-next-week-1fdcb6a5</a>, See on <a href="https://news.ycombinator.com/item?id=38091216">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><div><div><nav aria-label="WSJ News Exclusive flashline"><ol><li></li><li><a href="https://www.wsj.com/pro/bankruptcy/distress?mod=breadcrumb" data-testid="breadcrumb-link"><span><span><span>Distress</span></span></span></a></li></ol></nav></div><div><h2>Once a venture capital-backed star with an astronomical valuation, the flexible-office-space provider is now preparing for chapter 11 protection</h2></div></div><article><div><p><time datetime="2023-10-31T21:19:00Z">Updated Oct. 31, 2023 5:19 pm ET<span>|</span><span>WSJ Pro</span></time></p><section><p data-type="paragraph">WeWork<!-- --> is planning to file for bankruptcy as early as next week, according to people familiar with the matter, in what would mark a stunning reversal for the flexible-office-space venture that was once valued at $47 billion.&nbsp;</p><p data-type="paragraph">New York-based WeWork is considering filing a chapter 11 petition in New Jersey, the people said.&nbsp;</p></section><p>Copyright ©<!-- -->2023<!-- --> Dow Jones &amp; Company, Inc. All Rights Reserved. 87990cbe856818d5eddac44c7b1cdeb8</p><div id="cx-snippet-overlay"><h4>Our Intelligence. Your Advantage.</h4><p>Sign in or subscribe for access to peerless insight &amp; analysis, curated data &amp; interactives, and networking events.</p></div></div></article></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[A Grand Theft Auto III Re-Implementation (279 pts)]]></title>
            <link>https://openrw.org/</link>
            <guid>38090521</guid>
            <pubDate>Tue, 31 Oct 2023 19:53:00 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://openrw.org/">https://openrw.org/</a>, See on <a href="https://news.ycombinator.com/item?id=38090521">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
      
<div>
    <h2 id="faq">Frequently asked questions</h2>
    
<h2 id="what-is-openrw">What is OpenRW</h2>
<p>OpenRW is an open-source game engine that attempts to re-implement the engine used in the classic video game Grand Theft Auto III (GTA III), first released in 2001. With the purpose of enabling better compatibility with modern systems and ensuring that it remains possible to play the game in the future.</p>

<p>The primary goal of the project is to reach “Version 1.0”, this would mean:</p>
<ul>
  <li>Fully implementing the original gameplay</li>
  <li>Compatible with all data formats used in the game</li>
  <li>Compatible with modern gamepads where possible</li>
  <li>Able to load save game files from the game</li>
  <li>Run with community made mods that only change game data</li>
  <li>Run natively on Windows, Linux and macOS</li>
</ul>

<p>OpenRW would not aim for Version 1.0 to re-create any obvious bugs such as crashes or situations where the game becomes impossible to progress.</p>

<p>Other features, which would not be needed for Version 1.0 include:</p>
<ul>
  <li>Enhanced support for user modification</li>
  <li>Changes to the gameplay</li>
  <li>Multiplayer</li>
</ul>

<p>Features like these will not be accepted into OpenRW at present, as these don’t contribute to the primary goal. Once Version 1.0 has been reached a “new” version of OpenRW may be forked that contains these kinds of features.</p>

<h2 id="do-i-need-gta-iii-to-play-openrw">Do I need GTA III to play OpenRW?</h2>
<p>In short: Yes.</p>

<p>OpenRW is simply a game engine that is compatible with the original game, it has no assets of its own. In order to play GTA III using  OpenRW you must own the game and have the data installed on your system. If you need a copy of the game it’s available on <a href="http://store.steampowered.com/app/12100/">Steam</a>.</p>

<p>It is theoretically possible to develop a completely new game, without any of the assets or content from GTA III, however no such project is currently under way.</p>

<h2 id="can-i-play-openrw-now">Can I play OpenRW now?</h2>
<p>In its current state it is not possible to complete the game using OpenRW, or make any significant progress through the game. There are many bugs that need to be fixed and features that need to be developed before it becomes possible to play anything with OpenRW. The latest version of OpenRW will always be available from the source code <a href="https://github.com/rwengine/openrw">repository</a>.</p>

<h2 id="can-i-play-openrw-on-my-macos--linux-computer">Can I play OpenRW on my macOS / Linux computer?</h2>
<p>Yes. OpenRW runs on macOS and Linux, as well as some BSDs.</p>

<h2 id="why-make-openrw">Why make OpenRW?</h2>
<p>Beyond technical curiosity, OpenRW exists to conserve the game and ensure it is playable into the future by improving compatibility with modern systems and allowing future developers to make the engine compatible with whatever systems may exist in the future.</p>

<p>In addition to conservation it may also offer a platform for others to build 3D action games in the future.</p>

<h2 id="can-i-contribute-to-openrw">Can I contribute to OpenRW?</h2>
<p>Yes, development of OpenRW is open, you can follow along and contribute via the GitHub <a href="https://github.com/rwengine/openrw">project page</a>. Also drop into the IRC channel, <code>#openrw</code> @ <a href="https://web.libera.chat/#openrw">irc.libera.chat</a>.</p>

<h2 id="what-licence-is-openrw-released-under">What licence is OpenRW released under</h2>
<p>The OpenRW engine is released under the GNU General Public License Version 3.</p>

<h2 id="who-is-working-on-openrw">Who is working on OpenRW?</h2>
<p>The project is developed in an open and collaborative manner, anyone who wishes to contribute code or documentation is able to send changes via a pull request to the github <a href="https://github.com/rwengine/openrw">repository</a>.</p>

<h2 id="will-it-be-possible-to-play-vice-city-with-openrw">Will it be possible to play Vice City with OpenRW?</h2>
<p>The current priority of the project is to implement support for playing GTA III. Once this is completed it will be clear how much extra work will be required to fully support Vice City in addition to III. The work may need to be done in a fork of OpenRW dedicated to Vice CIty, or it may be unfeasible for one reason or another.</p>

<h2 id="what-is-the-story">What is the story?</h2>
<p>Development on OpenRW was started by tsjost and danhedron in 2013,  where it began as a simple model viewer that became a map viewer. Over time OpenRW has gained new features such as physics, vehicles and pedestrians, and a script machine that make more of the game accessible via the OpenRW engine. Now it is possible to start a new game or load a save game within OpenRW and interact with the world.
At present, development is performed in the open where anyone is free to contribute to the project via the github repository.</p>



  </div>



    </div><div>
  <p>
    © 2017 OpenRW<br>
    OpenRW is an unofficial project and is not endorsed by Rockstar Games.<br>
    Website Design &amp; Code by <a href="http://hugo.pro/">Hugo Locurcio</a>. <a href="https://github.com/rwengine/rwengine.github.io">Website Source</a>.
  </p>
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[The Ten Rules of Schema Growth (165 pts)]]></title>
            <link>https://blog.datomic.com/2017/01/the-ten-rules-of-schema-growth.html</link>
            <guid>38089980</guid>
            <pubDate>Tue, 31 Oct 2023 19:15:44 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://blog.datomic.com/2017/01/the-ten-rules-of-schema-growth.html">https://blog.datomic.com/2017/01/the-ten-rules-of-schema-growth.html</a>, See on <a href="https://news.ycombinator.com/item?id=38089980">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
			

			<p><em>25 December 2016</em></p>

			<p>Data outlives code, and a valuable database supports many applications over time. These ten rules will help grow your database schema without breaking your applications.<br></p><p><a href="https://blog.datomic.com/images/blog/-53l7suMbyss/WDw4_QYOk5I/AAAAAAAAANQ/MmACZ8DAbKsE8tE4BzI4I6Y81tt18aJtwCPcB/s1600/DatomicLogo_Square.png" imageanchor="1"><img height="199" src="https://blog.datomic.com/images/blog/-53l7suMbyss/WDw4_QYOk5I/AAAAAAAAANQ/MmACZ8DAbKsE8tE4BzI4I6Y81tt18aJtwCPcB/s200/DatomicLogo_Square.png" width="200"></a></p><h3>1. &nbsp;Prod is not like dev.</h3><p>Production is not development. In production, one or more codebases depend on your data, and these ten rules below should be followed exactingly.</p><p>A dev environment can be much more relaxed. &nbsp;Alone on your development machine experimenting with a new feature, you have no users to break. &nbsp;You can soften the rules, so long as you harden them when transitioning to production.</p><h3>2. &nbsp;Grow your schema, and never break it.</h3><p>The lack of common vocabulary makes it all too easy to automate the wrong practices. I will use the terms <i>growth</i> and <i>breakage</i> as defined in Rich Hickey's&nbsp;<a href="https://www.youtube.com/watch?v=oyLBGkS5ICk" target="_blank">Spec-ulation</a>&nbsp;talk. &nbsp;In schema terms:</p><ul><li><i>growth</i> is providing more schema</li><li><i>breakage</i> is removing schema, or changing the meaning of existing schema.</li></ul><p>In contrast to these terms, many people use "<a href="http://edgeguides.rubyonrails.org/active_record_migrations.html" target="_blank">migrations</a>", "<a href="http://databaserefactoring.com/" target="_blank">refactoring</a>", or "<a href="https://martinfowler.com/articles/evodb.html" target="_blank">evolution</a>". These usages tend to focus on repeatability, convenience, and the needs of new programs, ignoring the distinction between growth and breakage. The problem here is obvious: Breakage is bad, so we don't want it to be more convenient!</p><p>Using precise language underscores the costs of of breakage. Most migrations are easily categorized as growth or breakage by considering the rules below. &nbsp;<i>Growth migrations</i> are suitable for production, and <i>breakage migrations</i> are, at best, a dev-only convenience. Keep them widely separate.</p><h3>3. The database is the source of truth.</h3><p>Schema growth needs to be reproducible from one environment to another. &nbsp;Reproducibility supports the development and testing of new schema before putting it into production and also the reuse of schema in different databases. Schema growth also needs to be evident in the database itself, so that you can determine what the database has, what it needs, and when growth occurred.</p><p>For both of these reasons, the database is the proper source of truth for schema growth. When the database is the source of truth, reproducability and auditability happen <i>for free</i>&nbsp;via the ordinary<br>query and transaction capabilities of the database. &nbsp;(If your database is not up to the tasks of queries and transactions you have bigger problems beyond the scope of this article).</p><p>Storing schema in a database is strictly more powerful than storing schema as text files in source control. The database is the actual home for schema, plus it provides validation, structure, query, transactions, and history. A source control system provides only history and is separate from the data itself.</p><p>Note that this does <i>not</i> mean "never put schema information in source control". Source control may be convenient for other reasons, e.g. it may be more readily accessible. You may redundantly store schema in source control, but remember that the database is definitive.</p><h3>4. &nbsp;Growing is adding.</h3><p>As you acquire more information about your domain, grow your schema to match. You can grow a schema by adding new things, and <i>only</i> by adding new things, for example:</p><ul><li>adding new attributes to an existing 'type'</li><li>adding new types</li><li>adding relationships between types</li></ul><h3>5. &nbsp;Never remove a name.</h3><p>Removing a named schema component at any level is a breaking change for programs that depend on that name. Never remove a name.</p><h3>6. &nbsp;Never reuse a name.</h3><p>The meaning of a name is established when the name is first introduced. Reusing that name to mean something substantially different breaks programs that depend on that meaning. This can be even<br>worse than removing the name, as the breakage may not be as immediately obvious.</p><h3>7. &nbsp;Use aliases.</h3><p>If you are familiar with database refactoring patterns, the advice in Rules Five and Six may seem stark. After all, one purpose of refactoring is to adopt better names as we discover them. How can we<br>do that if names can never be removed or changed in meaning?</p><p>The simple solution is to use <a href="http://docs.datomic.com/schema.html#renaming-an-identity" target="_blank">more than one alias</a> to refer to the same schema entity. Consider the following example:</p><ul><li>In iteration 1, users of your system are identified by their email with an attribute named <span><b>:user/id</b></span>.&nbsp;</li><li>In iteration 2, you discover that users sometimes have non-email identifiers for users and that you want to store a user's email even when not using the email as an identifier. In short, you wish that <span><b>:user/id</b></span>&nbsp;was named <span><b>:user/primary-email</b></span>.</li></ul><p>No problem! Just create <span><b>:user/primary-email</b></span> as an alias for <span><b>:user/id</b></span>. Older programs can continue to use <span><b>:user/id</b></span>, and newer programs can use the now-preferred <span><b>:user/primary-email</b></span>.</p><h3>8. &nbsp;Namespace all names.</h3><p>Namespaces greatly reduce the cost of getting a name wrong, as the same local name can safely have different meanings in different namespaces. &nbsp;Continuing the previous example, imagine that the local<br>name <span><b>id</b></span> is used to refer to a UUID in several namespaces, e.g. <span><b>:inventory/id</b></span>, <span><b>:order/id</b></span>, and so on. The fact that <span><b>:user/id&nbsp;</b></span>is <i>not</i> a UUID is inconsistent, and newer programs should not have to put up with this.</p><p>Namespaces let you improve the situation without breaking existing programs. You can introduce <span><b>:user-v2/id</b></span>, and new programs can ignore names in the&nbsp;<b><span>user</span></b>&nbsp;namespace. If you don't like <b><span>v2</span></b>, you can also pick a more semantic name for the new namespace.</p><h3>9. &nbsp;Annotate your schema.</h3><p>Databases are good at storing data about your schema. Adding annotations to your schema can help both human readers and make sense of how the schema grew over time. For example:</p><ul><li>you could annotate names that are not recommended for new programs with a <span><b>:schema/deprecated</b></span> flag, or you could get fancier still with <span><b>:schema/deprecated-at</b></span> or <span><b>:schema/deprecated-because</b></span>. Note that such deprecated names are still <i>never</i> removed (Rule Five).</li><li>you could provide <span><b>:schema/see-also</b></span> or <span><b>:schema/see-instead</b></span> pointers to more current conventions.&nbsp;</li></ul><p>In fact, all the database refactoring patterns that are typically implemented as breaking changes could be implemented non-destructively, with the refactoring details recorded as an annotation. For example, the breaking <a href="http://databaserefactoring.com/SplitColumns.html" target="_blank">"split column" refactoring</a>&nbsp;might instead be implemented as schema growth:</p><ul><li>add N new columns</li><li>(optional) add a <span><b>:schema/split-into</b></span> attribute on the original column whose value is the new columns, and possibly even the recipe for the split</li></ul><h3>10. Plan for accretion.</h3><p>If a system is going to grow at all, then programs must not bake in limiting presumptions. &nbsp;For example: If a schema states that <span><b>:user/id</b></span> is a string, then programs can rely on <span><b>:user/id</b></span> being a string and not occasionally an integer or a boolean. &nbsp;But a program cannot assume that a user entity will be limited to a the set of attributes previously seen, or that it understands the semantics of attributes that it has not seen before.</p><h3>Are these rules specific to a particular database?</h3><p>No. These rules apply to almost any SQL or NoSQL database. &nbsp;The rules even apply to the so-called "schemaless" databases. &nbsp;A better word for schemaless is "schema-implicit", i.e. the schema is implicit in your data and the database has no reified awareness of it. &nbsp;With an implicit schema, all the rules still apply, except that the database is impotent to help you (no Rule 3).</p><h3>In Context</h3><p>Many of the resources on migrations, refactoring, and database evolution emphasize repeatability and the needs of new programs, without making the top-level distinctions of growth vs. breakage and prod vs. dev. As a result, these resources encourage breaking the rules in this article.</p><p>Happily, these resources can easily be recast in growth-only terms. &nbsp;You <i>can</i> grow your schema without breaking your app. You <i>can</i> continuously deploy without continuously propagating breakage. &nbsp;Here's what it looks like <a href="http://docs.datomic.com/best-practices.html#production-schema" target="_blank">in Datomic</a>.</p>

			<hr>
				
		</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Jury Finds Realtors Conspired, Awards Nearly $1.8B in Damages (296 pts)]]></title>
            <link>https://www.wsj.com/real-estate/jury-finds-realtors-conspired-to-keep-commissions-high-awards-nearly-1-8-billion-in-damages-b26f9c2f</link>
            <guid>38089356</guid>
            <pubDate>Tue, 31 Oct 2023 18:35:11 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.wsj.com/real-estate/jury-finds-realtors-conspired-to-keep-commissions-high-awards-nearly-1-8-billion-in-damages-b26f9c2f">https://www.wsj.com/real-estate/jury-finds-realtors-conspired-to-keep-commissions-high-awards-nearly-1-8-billion-in-damages-b26f9c2f</a>, See on <a href="https://news.ycombinator.com/item?id=38089356">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><div><p>Updated Oct. 31, 2023 3:55 pm ET</p></div><section><div data-type="image" data-inset_type="" data-sub_type="" data-layout="inline"><figure><picture><img alt="" sizes="(max-width: 639px) 100vw, (max-width: 979px) 620px, (max-width: 1299px) 540px, 700px" srcset="https://images.wsj.net/im-878747?width=540&amp;size=1.5005861664712778 540w, https://images.wsj.net/im-878747?width=620&amp;size=1.5005861664712778 620w, https://images.wsj.net/im-878747?width=639&amp;size=1.5005861664712778 639w, https://images.wsj.net/im-878747?width=700&amp;size=1.5005861664712778 700w, https://images.wsj.net/im-878747?width=700&amp;size=1.5005861664712778&amp;pixel_ratio=1.5 1050w, https://images.wsj.net/im-878747?width=700&amp;size=1.5005861664712778&amp;pixel_ratio=2 1400w, https://images.wsj.net/im-878747?width=700&amp;size=1.5005861664712778&amp;pixel_ratio=3 2100w" width="700" height="466" src="https://images.wsj.net/im-878747?width=700&amp;height=466"></picture></figure><figcaption><span>Plaintiffs in a federal lawsuit have asked a judge to order changes in how the home-sale industry operates.</span> <span><span>Photo: </span>Rich Pedroncelli/Associated Press</span></figcaption></div><p data-type="paragraph">KANSAS CITY, Mo.—A federal jury on Tuesday found the National Association of Realtors and large residential brokerages liable for about $1.8 billion in damages after determining they conspired to keep commissions for home sales artificially high.</p><p data-type="paragraph">The verdict <a data-type="link" href="https://www.wsj.com/us-news/law/real-estate-commissions-could-be-the-next-fee-on-the-chopping-block-4d8a68b" rel="">could lead to industrywide upheaval</a> by changing decades-old rules that have helped lock in commission rates even as <a data-type="link" href="https://www.wsj.com/economy/housing/u-s-home-prices-rose-to-record-in-august-d1863cfd" rel="">home prices have skyrocketed</a>—which has allowed real-estate agents to collect ever-larger sums. It comes in the first of two antitrust lawsuits arguing that unlawful industry practices have left consumers unable to lower their costs even though internet-era innovations have allowed many buyers to find homes themselves online.</p></section><p>Copyright ©<!-- -->2023<!-- --> Dow Jones &amp; Company, Inc. All Rights Reserved. 87990cbe856818d5eddac44c7b1cdeb8</p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[macOS Sonoma Boot Failures (590 pts)]]></title>
            <link>https://github.com/AsahiLinux/docs/wiki/macOS-Sonoma-Boot-Failures</link>
            <guid>38089342</guid>
            <pubDate>Tue, 31 Oct 2023 18:33:52 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/AsahiLinux/docs/wiki/macOS-Sonoma-Boot-Failures">https://github.com/AsahiLinux/docs/wiki/macOS-Sonoma-Boot-Failures</a>, See on <a href="https://news.ycombinator.com/item?id=38089342">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
                <h2 id="user-content-what-happened"><a href="#what-happened">What happened?</a></h2>
<p>macOS Sonoma and macOS Ventura 13.6 were released with multiple serious bugs in their upgrade and boot process. Combined, these bugs can create conditions where a machine always boots to a black screen, no matter what power button press combination is used. This leaves users stuck, and the only solution is to use DFU recovery.</p>
<p>This situation can happen with certain settings on certain models, when multiple macOS versions are installed side by side (one Sonoma, one earlier). Since Asahi Linux behaves as if it were macOS 12.3/12.4/13.5 (depending on model and installation time), dual-boot installs of macOS Sonoma and Asahi Linux have the same effect. For macOS 13.6, this situation doesn't even require a dual-boot system, and can be triggered stand-alone as the only installed OS.</p>
<p><strong>We have updated the Asahi Linux installer to automatically perform an integrity check and diagnose your system on startup</strong>. To run it, paste this command into Terminal in macOS:</p>
<p><code>curl https://alx.sh | sh</code></p>
<p>You can quit the installer once you reach the main menu, without making any changes to your system.</p>
<p>Apple bug reports: FB13319681 and FB13319708</p>
<h2 id="user-content-what-are-the-bugs-exactly"><a href="#what-are-the-bugs-exactly">What are the bugs exactly</a></h2>
<p>There are two bugs:</p>
<ul>
<li>
<p>macOS Sonoma upgrades use the previously installed version as System Recovery. This makes some sense, but does not consider backwards compatibility problems between older RecoveryOS and newer firmware. If this mismatch causes recoveryOS to fail to boot, this will leave System Recovery unusable.</p>
</li>
<li>
<p>For 14" and 16" models: Once System Firmware is updated to the macOS Sonoma version, if the display is configured to a refresh rate other than ProMotion, that system will no longer be able to boot into older macOS installs nor Asahi Linux correctly. This includes recovery mode when those systems are set as the default boot OS, <strong>and also System Recovery</strong> at least until the next subsequent OS upgrade.</p>
</li>
</ul>
<h2 id="user-content-what-happens-if-i-get-hit-by-the-bug-will-i-lose-data"><a href="#what-happens-if-i-get-hit-by-the-bug-will-i-lose-data">What happens if I get hit by the bug? Will I lose data?</a></h2>
<p>You will need another Mac to recover from the fault using DFU mode. However, you will <em>not</em> lose data.</p>
<h2 id="user-content-what-machines-are-affected"><a href="#what-machines-are-affected">What machines are affected?</a></h2>
<p>MacBook Pro models with ProMotion displays (14" and 16") are affected by the black screen boot bug.</p>
<h2 id="user-content-what-versions-are-affected"><a href="#what-versions-are-affected">What versions are affected?</a></h2>
<ul>
<li>macOS Sonoma 14.0+ (not fixed as of 2023-10-31)</li>
<li>macOS Ventura 13.6+ (uses 14.0 firmware)</li>
<li>Possibly: macOS Monterey 12.7 (unconfirmed)</li>
</ul>
<h2 id="user-content-what-should-i-do"><a href="#what-should-i-do">What should I do?</a></h2>
<h3 id="user-content-i-have-not-upgraded-to-macos-sonoma-or-macos-ventura-136-yet-and-i-want-to"><a href="#i-have-not-upgraded-to-macos-sonoma-or-macos-ventura-136-yet-and-i-want-to">I have not upgraded to macOS Sonoma (or macOS Ventura 13.6) yet and I want to</a></h3>
<p>We recommend waiting until these issues are fixed by Apple before upgrading. If you want to risk it and you have a 14" or 16" machine, <strong>make sure the display refresh rate is set to ProMotion</strong> before attempting the upgrade. You might still end up with a corrupted System Recovery, which can only be fixed with DFU mode or a subsequent successful upgrade.</p>
<p>Regardless of whether you plan to install Asahi Linux or not, we recommend running the Asahi Linux installer after a Sonoma upgrade to check the status of your System Recovery partition. It will inform you about any issues prior to the main menu, before any changes are made to your system.</p>
<h3 id="user-content-i-have-not-upgraded-to-macos-sonoma-or-macos-ventura-136-yet-and-im-in-no-rush"><a href="#i-have-not-upgraded-to-macos-sonoma-or-macos-ventura-136-yet-and-im-in-no-rush">I have not upgraded to macOS Sonoma (or macOS Ventura 13.6) yet and I'm in no rush</a></h3>
<p>Feel free to stay on macOS version 13.5 or earlier for the time being. You can safely install Asahi Linux if you wish.</p>
<h3 id="user-content-i-have-already-upgraded-to-macos-sonoma-and-i-want-to-install-asahi-linux"><a href="#i-have-already-upgraded-to-macos-sonoma-and-i-want-to-install-asahi-linux">I have already upgraded to macOS Sonoma and I want to install Asahi Linux</a></h3>
<p>The Asahi Linux installer has been updated to check the version of your System Recovery, and will inform you of the risks if there is a mismatch. It will also check the ProMotion refresh rate, and refuse to install if it is set to anything other than ProMotion mode. Therefore, it is safe to install at this time.</p>
<p>Start the installation process normally. Follow the prompts carefully and read all the information printed. If your System Recovery version is mismatched, make sure you understand the risks. If your display refresh rate is incorrect, the installer will ask you to change it.</p>
<h3 id="user-content-i-have-already-upgraded-to-macos-sonoma-and-i-have-asahi-linux"><a href="#i-have-already-upgraded-to-macos-sonoma-and-i-have-asahi-linux">I have already upgraded to macOS Sonoma and I have Asahi Linux</a></h3>
<p>If you are currently booted into macOS, ensure the display refresh rate is set to ProMotion (for 14" and 16" machines).</p>
<p>We recommend running the Asahi Linux installer again to verify the integrity of your System RecoveryOS partition and ProMotion status. If there is a problem, you should refrain from making any major changes to your system until the issue is fixed by Apple.</p>
<h3 id="user-content-i-am-affected-to-the-issue-what-do-i-do"><a href="#i-am-affected-to-the-issue-what-do-i-do">I am affected to the issue, what do I do?</a></h3>
<p>If your machine boots to a black screen (brief Apple logo, then nothing), first attempt a regular recoveryOS boot by fully powering down the machine, then holding down the power button.</p>
<p>If that does not work, try booting into System RecoveryOS. To do this, fully power down the machine, and then perform a fast "tap-and-hold" power button gesture (press and release once, then press and hold).</p>
<p>If that also leads to the same problem, unfortunately you will have to resort to DFU mode. See the following section for details.</p>
<p>If you can successfully reach a boot menu, select your macOS Sonoma install and hold down Option while confirming your selection to make it the default boot OS. <strong>If you have macOS 13.6 ventura instead, follow the special section below.</strong></p>
<h3 id="user-content-how-do-i-fix-my-machine-with-dfu-mode"><a href="#how-do-i-fix-my-machine-with-dfu-mode">How do I fix my machine with DFU mode?</a></h3>
<p>First, you will need another Mac running a recent version of macOS (an Intel Mac is OK). Install Apple Configurator from the App Store on the other Mac and open it.</p>
<p>Follow <a href="https://support.apple.com/en-gu/guide/apple-configurator-mac/apdd5f3c75ad/mac" rel="nofollow">Apple's</a> instructions to connect your two machines together, and put your target machine in DFU mode. The target machine's display should remain off at this point.</p>
<p>You should see a large "DFU" icon in Apple Configurator. If you see anything else, the machine is not in the correct mode. Repeat the procedure and try again.</p>
<p>Once you see the DFU icon, right click it and select Advanced → Revive. This will begin the revive process.</p>
<p>If you get a message saying "A system update is required for this device", you can ignore it and press "Restore Anyway". This process has been tested with another Mac running macOS 13.5.</p>
<p>Follow the prompts and accept any accessory connection requests. Do not leave the machine unattended, as you might miss one of those prompts (and there is a timeout). The process will take a few minutes to complete.</p>
<p>Once the Revive process completes, the machine should boot into macOS Recovery. Follow the prompts and authenticate yourself.</p>
<p>After this, the machine will reboot into the Boot Picker.</p>
<p><strong>If you have macOS 13.6 ventura instead, follow the special section below.</strong></p>
<p>Select your macOS Sonoma install, then go into the Display settings page and set the display refresh rate to ProMotion. This will prevent the problem from reoccurring.</p>
<p>Should you wind up with a "black screen boot" again after this point, follow the steps in the previous section to perform the "tap-and-hold" power gesture. This should now work properly, as your System RecoveryOS has been updated. You may then select macOS again and fix the display refresh rate.</p>
<h3 id="user-content-i-dont-have-another-mac-to-use-dfu-mode-what-do-i-do"><a href="#i-dont-have-another-mac-to-use-dfu-mode-what-do-i-do">I don't have another Mac to use DFU mode! What do I do?</a></h3>
<p>You can take your Mac to the Apple Store and ask them to do a <strong>DFU Revive</strong>. Make sure they do <strong>not</strong> do a Restore, which would wipe all your data. They should perform this service for free. Do not let them charge you any money for it. This is a problem Apple caused, and purely a software issue. If the technicians claim there is hardware damage, they are wrong.</p>
<h3 id="user-content-what-if-i-have-macos-136-ventura-and-not-sonoma"><a href="#what-if-i-have-macos-136-ventura-and-not-sonoma">What if I have macOS 13.6 Ventura and not Sonoma?</a></h3>
<p>macOS 13.6 Ventura uses the macOS Sonoma System Firmware, but suffers from the problem. Even users with just 13.6 installed single-boot are affected by this issue (no Asahi Linux needed). We do not understand how Apple managed to release an OS update that, when upgraded to normally, leaves machines unbootable if their display refresh rate is not the default. This seems to have been a major QA oversight by Apple.</p>
<p>If your system has 13.6 Ventura and ended up in the black boot situation, unfortunately the only known solution is to upgrade to Sonoma. From the Boot Picker, select Settings. This will boot into recoveryOS. From there, select "Install macOS Sonoma". Follow the prompts and select your existing macOS volume. This will upgrade macOS without losing your data.</p>

              </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Copying Angry Birds with nothing but AI (530 pts)]]></title>
            <link>https://twitter.com/javilopen/status/1719363262179938401</link>
            <guid>38089247</guid>
            <pubDate>Tue, 31 Oct 2023 18:27:15 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://twitter.com/javilopen/status/1719363262179938401">https://twitter.com/javilopen/status/1719363262179938401</a>, See on <a href="https://news.ycombinator.com/item?id=38089247">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="ScriptLoadFailure"><form action="" method="GET"><div><p><span>Something went wrong, but don’t fret — let’s give it another shot.</span></p><br></div></form></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Upstream Linux support available for Qualcomm Snapdragon 8 Gen 3 Mobile Platform (166 pts)]]></title>
            <link>https://www.linaro.org/blog/upstream-linux-support-now-available-for-the-the-qualcomm-snapdragon-8-gen-3-mobile-platform/</link>
            <guid>38088856</guid>
            <pubDate>Tue, 31 Oct 2023 18:01:27 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.linaro.org/blog/upstream-linux-support-now-available-for-the-the-qualcomm-snapdragon-8-gen-3-mobile-platform/">https://www.linaro.org/blog/upstream-linux-support-now-available-for-the-the-qualcomm-snapdragon-8-gen-3-mobile-platform/</a>, See on <a href="https://news.ycombinator.com/item?id=38088856">Hacker News</a></p>
<div id="readability-page-1" class="page"><div> <article> <p>At Linaro, we’re thrilled to share the latest development in our ongoing collaboration with Qualcomm. Linaro Engineer Neil Armstrong has successfully enabled upstream Linux support for the <a href="https://www.qualcomm.com/products/mobile/snapdragon/smartphones/snapdragon-8-series-mobile-platforms/snapdragon-8-gen-3-mobile-platform">Qualcomm Snapdragon 8 Gen 3 Mobile Platform</a>, the latest addition to the Snapdragon processor family.</p> <p>This achievement signifies a significant milestone in the realm of Linux support, as it demonstrates our commitment to providing cutting-edge solutions to our partners. Here an inside look at this groundbreaking development, showcasing the unparalleled collaboration between Qualcomm and Linaro, impacting positively on:</p> <ul> <li>Effortless upstream Linux integration</li> <li>Powerful performance optimization</li> <li>Running AOSP with Mainline</li> <li>Continued collaboration&nbsp;</li> </ul> <h2 id="the-qualcomm-announcement">The Qualcomm Announcement</h2> <p>The initial support was posted on October 25th 2023 on the Linux kernel mailing lists for review by the Linux developers community. With the set of patches released by Linaro engineers, it is also possible to boot an AOSP image with Graphics Software Rendering using Google’s SwiftShader.</p> <p>Since 2014, Linaro Engineers have been working closely with Qualcomm Engineers to enable Snapdragon platforms to work with Mainline Linux.</p> <p>Running a recent upstream Linux kernel immediately after the announcement of a new SoC is a significant achievement, and is a testimony to the close working partnership between Qualcomm and Linaro.</p> <h2 id="what-has-been-upstreamed-for-the-snapdragon-8-gen-3-mobile-platform">What has been upstreamed for the Snapdragon 8 Gen 3 Mobile Platform?</h2> <p>With the recent series of patches released by Linaro, the following features are enabled for the Snapdragon 8 Gen 3 Mobile Platform:</p> <ul> <li>Qualcomm® Kryo™ CPUs, including DVFS (Dynamic voltage and frequency scaling) and Power Management</li> <li>System foundation: Clocks, Power controllers, PMICs</li> <li>Low-Speed I/O: I2C, SPI, RTC, Buttons, LEDs</li> <li>High-Density Storage: UFS 4.0, SDXC</li> <li>High-Speed Peripherals: PCIe Gen3 and Gen4, USB Version 3.1 Gen 2, USB-C PD</li> <li>Qualcomm® Hexagon™ Processor SubSystems: Audio, Sensors, Compute and Modem</li> <li>Mobile Display Subsystem + DSI Engine, Touch Controller</li> <li>Communication: WCN7850 Bluetooth</li> </ul> <p>All patches sent for review are also integrated and available in the following development <a href="https://git.codelinaro.org/linaro/qcomlt/demos/linux/-/tree/topic/sm8650/demo/aosp-next-20231016">branch</a> on CodeLinaro.org.</p> <picture> <source data-srcset="/../generated/assets/images/content/snapdragon-8-gen-3-mobile-platform-400-6722fe.webp 400w, /../generated/assets/images/content/snapdragon-8-gen-3-mobile-platform-800-6722fe.webp 800w, /../generated/assets/images/content/snapdragon-8-gen-3-mobile-platform-1200-6722fe.webp 1200w" type="image/webp"> <source data-srcset="/../generated/assets/images/content/snapdragon-8-gen-3-mobile-platform-400-6722fe.png 400w, /../generated/assets/images/content/snapdragon-8-gen-3-mobile-platform-800-6722fe.png 800w, /../generated/assets/images/content/snapdragon-8-gen-3-mobile-platform-1200-6722fe.png 1200w" type="image/png"> <img data-src="/../generated/assets/images/content/snapdragon-8-gen-3-mobile-platform-800-6722fe.png" alt="On the left Screenshot of CPU Info (open-source) App showing information on the running system. On the right: FishTank WebGL sample running in Firefox for Android" src="https://www.linaro.org/generated/assets/images/content/snapdragon-8-gen-3-mobile-platform-800-6722fe.png"> </picture> <picture> <source data-srcset="/../generated/assets/images/content/development-kit-and-screenshot-of-the-android-version-menu--400-9c1bee.webp 400w, /../generated/assets/images/content/development-kit-and-screenshot-of-the-android-version-menu--800-9c1bee.webp 800w, /../generated/assets/images/content/development-kit-and-screenshot-of-the-android-version-menu--1200-9c1bee.webp 1200w" type="image/webp"> <source data-srcset="/../generated/assets/images/content/development-kit-and-screenshot-of-the-android-version-menu--400-9c1bee.png 400w, /../generated/assets/images/content/development-kit-and-screenshot-of-the-android-version-menu--800-9c1bee.png 800w, /../generated/assets/images/content/development-kit-and-screenshot-of-the-android-version-menu--1200-9c1bee.png 1200w" type="image/png"> <img data-src="/../generated/assets/images/content/development-kit-and-screenshot-of-the-android-version-menu--800-9c1bee.png" alt="On the left: Picture of a Qualcomm Development Kit with the attached debug board. On the right: Screenshot of the Android Version menu showing the device running Android 14 and running the v6.6-rc6 based Linux tree" src="https://www.linaro.org/generated/assets/images/content/development-kit-and-screenshot-of-the-android-version-menu--800-9c1bee.png"> </picture> <p><strong>Qualcomm Snapdragon 8 Gen 3 Running Android 14</strong></p> <h2 id="how-do-i-run-aosp-using-mainline">How do I run AOSP using Mainline?</h2> <p>One might think it is quite hard to run AOSP with mainline on such a new platform, but in reality, not at all! Thanks to the long term effort of Linaro and Google engineers making it possible to run AOSP with vanilla Linux releases. Thanks to Amit Pundir for providing a helping hand to get AOSP on this platform.</p> <p>To generate an AOSP image for the Snapdragon 8 Gen 3 Qualcomm Reference Device using the current set of patches available on the mailing list, use the following instructions, which&nbsp; are derived from here <a href="https://source.android.com/docs/setup/build/devices">https://source.android.com/docs/setup/build/devices</a> with some small changes.</p> <p>Download the Android source tree:</p> <div><pre><code>$ mkdir AOSP
$ cd AOSP
$ AOSP=$PWD
$ repo init -u https://android.googlesource.com/platform/manifest -b master
$ repo sync -j`nproc`
</code></pre></div> <p>Prepare SM8650 device config by pulling this pathset:</p> <div><pre><code>$ cd device/linaro/dragonboard
$ git fetch https://git.codelinaro.org/linaro/qcomlt/demos/device_linaro_dragonboard.git \
	topic/sm8650/demo/android-14-20231016 &amp;&amp; git checkout FETCH_HEAD
</code></pre></div> <p>Build the Linaro SM8550 tree containing the patches sent for review:</p> <div><pre><code>$ cd $AOSP
$ git clone https://git.codelinaro.org/linaro/qcomlt/demos/linux.git \
	 -b topic/sm8650/demo/aosp-next-20231016 sm8650-kernel
$ cd sm8650-kernel
$ make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- \
       rbX_aosp_defconfig
$ make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- -j`nproc`
$ mkdir $AOSP/device/linaro/dragonboard-kernel/android-6.6/
$ cp arch/arm64/boot/Image.gz arch/arm64/boot/dts/qcom/sm8650-qrd.dtb \
	 $AOSP/device/linaro/dragonboard-kernel/android-6.6/
$ find ./ -name "*.ko" -exec cp {} $AOSP/device/linaro/dragonboard-kernel/android-6.6/ \;
</code></pre></div> <p>Build AOSP</p> <div><pre><code>$ cd $AOSP
$ . build/envsetup.sh
$ lunch qrd8650-userdebug
$ make -j`nproc`
</code></pre></div> <p>Flash AOSP Images</p> <div><pre><code>$ cd out/target/product/qrd8650/
$ fastboot erase super erase boot erase vendor_boot \
           erase userdata erase metadata erase dtbo erase recovery
$ fastboot flash -S 256M super ./super.img flash boot ./boot.img \ 
           flash vendor_boot ./vendor_boot.img format:ext4 metadata \
           flash userdata ./userdata.img reboot
</code></pre></div> <h2 id="next-steps">Next steps</h2> <p>In the coming weeks, Linaro engineers will continue to work with the Linux kernel community to ensure all the patch series are merged in a timely manner. Additional patches are expected soon to enable display, audio and modem use cases.</p> <h2 id="want-to-learn-more-">Want to learn more ?</h2> <p>To find out more information on the ongoing work, check&nbsp; <a href="https://lore.kernel.org/all/?q=SM8650">https://lore.kernel.org/all/?q=SM8650</a> or contact us.</p> <p>The Snapdragon 8 Gen 3 Specification &amp; features can be found <a href="https://www.qualcomm.com/content/dam/qcomm-martech/dm-assets/images/company/news-media/media-center/press-kits/snapdragon-summit-2023/documents/Snapdragon8Gen3_%20ProductBrief.pdf">Here</a>&nbsp;</p> <p>For more information about what Qualcomm platform services Linaro offers and how we can help develop, maintain and optimize products using Qualcomm technologies, go to <a href="https://www.linaro.org/services/qualcomm-platforms-services/">https://www.linaro.org/services/qualcomm-platforms-services/</a>.</p> </article> </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Show HN: Phind Model beats GPT-4 at coding, with GPT-3.5 speed and 16k context (788 pts)]]></title>
            <link>https://www.phind.com/phindmodelhn</link>
            <guid>38088538</guid>
            <pubDate>Tue, 31 Oct 2023 17:40:47 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.phind.com/phindmodelhn">https://www.phind.com/phindmodelhn</a>, See on <a href="https://news.ycombinator.com/item?id=38088538">Hacker News</a></p>
Couldn't get https://www.phind.com/phindmodelhn: Error: Request failed with status code 403]]></description>
        </item>
        <item>
            <title><![CDATA[Firefox got faster for real users in 2023 (582 pts)]]></title>
            <link>https://hacks.mozilla.org/2023/10/down-and-to-the-right-firefox-got-faster-for-real-users-in-2023/</link>
            <guid>38087573</guid>
            <pubDate>Tue, 31 Oct 2023 16:39:13 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://hacks.mozilla.org/2023/10/down-and-to-the-right-firefox-got-faster-for-real-users-in-2023/">https://hacks.mozilla.org/2023/10/down-and-to-the-right-firefox-got-faster-for-real-users-in-2023/</a>, See on <a href="https://news.ycombinator.com/item?id=38087573">Hacker News</a></p>
<div id="readability-page-1" class="page"><article role="article">
    <p>One of the biggest challenges for any software is to determine how changes impact user experience in the real world. Whether it’s the processing speed of video editing software or the smoothness of a browsing experience, there’s only so much you can tell from testing in a controlled lab environment. While local experiments can provide plenty of metrics, improvements to those metrics may not translate to a better user experience.</p>
<p>This can be especially challenging with complex client software running third-party code like Firefox, and it’s a big reason why we’ve undertaken the <a href="https://twitter.com/mozhacks/status/1603435347190419456">Speedometer 3 effort</a> alongside other web browsers. Our goal is to build performance tests that simulate real-world user experiences so that browsers have better tools to drive improvements for real users on real webpages. While it’s easy to see that benchmarks have improved in Firefox throughout the year as a result of this work, what we really care about is how much those wins are being felt by our users.</p>
<p>In order to measure the user experience, Firefox collects a wide range of anonymized timing metrics related to page load, responsiveness, startup and other aspects of browser performance. Collecting data while holding ourselves to the highest standards of privacy can be challenging. For example, because we rely on aggregated metrics, we lack the ability to pinpoint data from any particular website. But perhaps even more challenging is analyzing the data once collected and drawing actionable conclusions. In the future we’ll talk more about these challenges and how we’re addressing them, but in this post we’d like to share how some of the metrics that are fundamental to how our users experience the browser have improved throughout the year</p>
<p>Let’s start with page load. <a href="https://developer.mozilla.org/en-US/docs/Glossary/First_contentful_paint">First Contentful Paint</a> (FCP) is a better metric for felt performance than the `onload` event. We’re tracking the time it takes between receiving the first byte from the network to FCP. This tells us how much faster we are giving feedback to the user that the page is successfully loading, so it’s a critical metric for understanding the user experience. While much of this is up to web pages themselves, if the browser improves performance across the board, we expect this number to go down.</p>
<div id="attachment_48049"><p><a href="https://hacks.mozilla.org/files/2023/10/FCPRUM.png"><img aria-describedby="caption-attachment-48049" decoding="async" fetchpriority="high" src="https://hacks.mozilla.org/files/2023/10/FCPRUM-500x215.png" alt="Graph of the median time between response start and first contentful paint, going from ~250 to ~215. Three distinct areas with a more pronounced slope are visible in mid february, late April and the largest in late July." width="500" height="215" srcset="https://hacks.mozilla.org/files/2023/10/FCPRUM-500x215.png 500w, https://hacks.mozilla.org/files/2023/10/FCPRUM-250x107.png 250w, https://hacks.mozilla.org/files/2023/10/FCPRUM-768x330.png 768w, https://hacks.mozilla.org/files/2023/10/FCPRUM-1536x659.png 1536w, https://hacks.mozilla.org/files/2023/10/FCPRUM.png 1670w" sizes="(max-width: 500px) 100vw, 500px"></a></p><p id="caption-attachment-48049">Image 1 – Median time from Response Start to First Contentful Paint in milliseconds</p></div>
<p>We can see that this time improved from roughly 250ms at the start of the year to 215ms in October. This means that a user receives feedback on page loads almost 15% faster than they did at the start of the year. And it’s important to note that this is all the result of optimization work that didn’t even explicitly target pageload.</p>
<p>In order to understand where this improvement is coming from, let’s look at another piece of timing data: the amount of time that was spent executing JavaScript code during a pageload. Here we are going to look at the 95th percentile, representing the most JS heavy pages and highlighting a big opportunity for us to remove friction for users..</p>
<div id="attachment_48050"><p><a href="https://hacks.mozilla.org/files/2023/10/JSPRUM.png"><img aria-describedby="caption-attachment-48050" decoding="async" src="https://hacks.mozilla.org/files/2023/10/JSPRUM-500x215.png" alt="A graph of the 95th percentile of JS execution time during pageload. It runs from ~1560 in January 2023 to ~1260 by October 2023. In general it's a steady downward slope with a small downward jump in April and a large downward jump during August." width="500" height="215" srcset="https://hacks.mozilla.org/files/2023/10/JSPRUM-500x215.png 500w, https://hacks.mozilla.org/files/2023/10/JSPRUM-250x107.png 250w, https://hacks.mozilla.org/files/2023/10/JSPRUM-768x330.png 768w, https://hacks.mozilla.org/files/2023/10/JSPRUM-1536x659.png 1536w, https://hacks.mozilla.org/files/2023/10/JSPRUM.png 1670w" sizes="(max-width: 500px) 100vw, 500px"></a></p><p id="caption-attachment-48050">Image 2 – 95th Percentile of JS execution time during pageload in milliseconds</p></div>
<p>This shows the 95th percentile improving from ~1560ms at the beginning of the year, to ~1260ms in October. This represents a considerable improvement of 300ms, or almost 20%, and is likely responsible for a significant portion of the reduced FCP times. This makes sense, since Speedometer 3 work has led to significant optimizations to the <a href="https://spidermonkey.dev/">SpiderMonkey</a> JavaScript engine (a story for another post).</p>
<p>We’d also like to know how responsive pages are after they are loaded. For example, how smooth is the response when typing on the keyboard as I write this blogpost! The primary metric we collect here is the “keypress present latency”; the time between a key being pressed on the keyboard and its result being presented onto the screen. Rendering some text to the screen may sound simple, but there’s a lot going on to make that happen – especially when web pages run main thread JavaScript to respond to the keypress event. Most typing is snappy and primarily limited by hardware (e.g. the refresh rate of the monitor), but it’s extremely disruptive when it’s not. This means it’s important to mitigate the worst cases, so we’ll again look at the 95th percentile.</p>
<div id="attachment_48048"><p><a href="https://hacks.mozilla.org/files/2023/10/KeypressRUM.png"><img aria-describedby="caption-attachment-48048" decoding="async" src="https://hacks.mozilla.org/files/2023/10/KeypressRUM-500x215.png" alt="A graph of the 95th percentile of the keypress present latency. Ranging from January 2023 to October 2023. It hovers fairly steady around 65ms, even seemingly going up a bit between March and May. Before dropping down to about 58-59ms over the course of August and September 2023." width="500" height="215" srcset="https://hacks.mozilla.org/files/2023/10/KeypressRUM-500x215.png 500w, https://hacks.mozilla.org/files/2023/10/KeypressRUM-250x107.png 250w, https://hacks.mozilla.org/files/2023/10/KeypressRUM-768x330.png 768w, https://hacks.mozilla.org/files/2023/10/KeypressRUM-1536x659.png 1536w, https://hacks.mozilla.org/files/2023/10/KeypressRUM.png 1670w" sizes="(max-width: 500px) 100vw, 500px"></a></p><p id="caption-attachment-48048">Image 3 – 95th Percentile of the keypress present latency</p></div>
<p>Once again we see a measurable improvement. The 95th percentile hovered around 65ms for most of the year and dropped to under 59ms after the Firefox 116 and 117 releases in August. A 10% improvement to the slowest keypresses means users are experiencing more instantaneous feedback and fewer disruptions while typing.</p>
<p>We’ve been motivated by the improvements we’re seeing in our telemetry data, and we’re convinced that our efforts this year are having a positive effect on Firefox users. We have many more optimizations in the pipeline and will share more details about those and our overall progress in future posts.</p>
    <section>
                                
                                <p><a href="https://hacks.mozilla.org/author/bschoutenmozilla-com/">More articles by Bas Schouten…</a></p>
                  </section>
  </article></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Apple’s keynote event shot on iPhone and edited on Mac (171 pts)]]></title>
            <link>https://www.apple.com/newsroom/2023/10/behind-the-scenes-at-scary-fast-apples-keynote-event-shot-on-iphone/</link>
            <guid>38087448</guid>
            <pubDate>Tue, 31 Oct 2023 16:32:37 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.apple.com/newsroom/2023/10/behind-the-scenes-at-scary-fast-apples-keynote-event-shot-on-iphone/">https://www.apple.com/newsroom/2023/10/behind-the-scenes-at-scary-fast-apples-keynote-event-shot-on-iphone/</a>, See on <a href="https://news.ycombinator.com/item?id=38087448">Hacker News</a></p>
<div id="readability-page-1" class="page">


	
    







 
<nav id="ac-localnav" lang="en-US" role="navigation" aria-label="Newsroom" data-analytics-region="local nav" data-sticky="">
	
    
    
        




    
    

</nav>



<main id="main" role="main"> 



<span id="opens-in-new-window">opens in new window</span>

	

<section>
<article data-analytics-activitymap-region-id="article">






    
    
    











    <div>
                
                
                
                    <h2>
                        
    
        Behind the scenes at Scary Fast: Apple’s keynote event shot on iPhone and edited on&nbsp;Mac
    

                    </h2>
                
            </div>







    
    
    




    
        
        
        
        
            <figure aria-label="Media, An iPhone 15 Pro Max on a rig captures a person sitting at a desk working on a MacBook." data-component-list="ModalGalleryTrigger">
                <div>
                     
                        
                        <div>
                            Scary Fast, shot by award-winning documentary filmmaker Brian Oakes, unveiled the all-new MacBook Pro with the M3 family of chips and iMac with M3.
                        </div>
                    
                    
                    
                    
                    <a href="https://www.apple.com/newsroom/images/2023/10/behind-the-scenes-at-scary-fast-apples-keynote-event-shot-on-iphone/article/Apple-Shot-on-iPhone-Apple-Log.zip" download="" data-analytics-title="Download image" aria-label="Download media, An iPhone 15 Pro Max on a rig captures a person sitting at a desk working on a MacBook."></a>
                </div>
            </figure>
        
        
    








    
    
    


     
     
    
    
        <div data-component-list="ModalGalleryTrigger">
             
                 <div>On Monday, October 30, at Apple’s Scary Fast special event unveiling the all-new MacBook Pro with the M3 family of chips and 24-inch iMac with M3, there was an unseen star of the show working behind the scenes. All of the presenters, locations, and drone footage in the event were filmed using iPhone 15 Pro Max, the preferred smartphone for creative pros and filmmakers. Led by documentary film director Brian Oakes, known for the award-winning <em>Jim: The James Foley Story </em>and<em> Living with Lincoln</em>, Scary Fast put iPhone 15 Pro Max right in the middle of the action.
</div>
                 
             
                 <div>The iPhone 15 Pro Max camera system offers the best video in a smartphone, with its quality rivaling those of professional video cameras. iPhone 15 Pro Max enables creatives to capture in ProRes up to 4K60 fps to an external drive with Apple Log encoding, which allows even more detail to be preserved for post-production color grading. iPhone 15 Pro and iPhone 15 Pro Max are also the first smartphones in the world to support the Academy Color Encoding System (ACES), a global standard for color workflows.
</div>
                 
             
                 <div>“We were able to get the same complex shots with iPhone 15 Pro Max,” says Oakes. “It’s amazing to see that the quality from a device that is so small and so portable can rival a large $20,000 camera.”
</div>
                 
             
                 <div>The production was advised by Apple’s Jon Carr, a Pro Workflow video specialist whose credits include <em>Top Gun: Maverick</em> and <em>Terminator: Dark Fate</em>, and Jeff Wozniak, who has worked on productions including <em>Transformers: Dark of the Moon</em>, <em>Avatar</em>, and <em>Iron Man 2</em>. “This year, iPhone 15 Pro Max was supercharged with the ability to record ProRes to an external drive, and Apple Log, our flavor of a format that all of the very high-end digital cameras shoot,” says Wozniak.
</div>
                 
             
                 <div>“It’s pretty amazing how you can put this in the hands of someone who’s a professional director and they don’t have to change their equipment — they don’t have to change any of the things that they always do,” adds Carr.
</div>
                 
             
                 <div>Capturing footage with multiple iPhone 15 Pro Max devices, the team utilized the integration between iPhone 15 Pro, the <a href="https://apps.apple.com/us/app/blackmagic-camera/id6449580241" target="_blank" rel="nofollow" data-analytics-exit-link="">Blackmagic Camera</a> app, and Tentacle Sync, showcasing the true power of the Apple ecosystem. Connected via Bluetooth, Tentacle Sync drives timecode and enables all devices on set — including Macs and preview screens — to be synced throughout the production. Beastgrip accessories, including cages and rigs, were also used during the production. &nbsp;
</div>
                 
             
                 <div>Here’s how Scary Fast came to life behind the scenes.
</div>
                 
             
         </div>
 

    
    
    


    
    <div data-component-list="ScrollAnimationDefault VideoPlayer">
                <video data-auto-ac-video="" src="https://www.apple.com/newsroom/videos/soip-scary-fast-bts/Oct2023_fall_eventbts/oct2023_fall_event__bts_16x9_multi-interview_longform_primary_f01_16x9.m3u8" poster="https://www.apple.com/newsroom/videos/soip-scary-fast-bts/Oct2023_fall_eventbts/posters/Apple-Shot-on-iPhone-Scary-Fast-behind-the-scenes_571x321.jpg.large.jpg" preload="auto" data-optimize-url="" data-text-tracks="{&quot;mode&quot;:&quot;hidden&quot;,&quot;src&quot;:&quot;&quot;,&quot;srclang&quot;:&quot;en&quot;}" data-ac-video-options="{&quot;responsive&quot;:&quot;true&quot;,&quot;sharing&quot;:{&quot;allowEmbed&quot;:true,&quot;description&quot;:&quot;Last night\u2019s reveal of the new MacBook Pro and the 24-inch iMac with the M3 family of chips involved a crew of filmmakers, editors, and colorists working on iPhone 15 Pro Max and Mac computers throughout the production.&quot;,&quot;videoid&quot;:&quot;03ed95365e3eca79a7fb37740e84e6d1&quot;,&quot;originatorUrl&quot;:&quot;https://www.apple.com/newsroom/2023/10/behind-the-scenes-at-scary-fast-apples-keynote-event-shot-on-iphone/?videoid=03ed95365e3eca79a7fb37740e84e6d1&quot;,&quot;hideExtension&quot;:true,&quot;title&quot;:&quot;Behind the Scenes at Scary Fast&quot;,&quot;hideFacebookShare&quot;:false,&quot;url&quot;:&quot;/newsroom/videos/soip-scary-fast-bts/Oct2023_fall_eventbts/oct2023_fall_event__bts_16x9_multi-interview_longform_primary_f01_16x9.m3u8&quot;,&quot;embedpath&quot;:&quot;https://share.newsroom.apple/newsroom/embed/videos/?embedvideoid=&quot;,&quot;duration&quot;:&quot;02:08&quot;,&quot;analytics&quot;:{&quot;pageName&quot;:&quot;Behind the scenes at Scary Fast: Apple\u2019s keynote event shot on iPhone&quot;},&quot;hideTwitterShare&quot;:false,&quot;poster&quot;:&quot;/newsroom/videos/soip-scary-fast-bts/Oct2023_fall_eventbts/posters/Apple-Shot-on-iPhone-Scary-Fast-behind-the-scenes_571x321.jpg.large.jpg&quot;}}">
                </video>
                
                <div>Last night’s reveal of the new MacBook Pro and the 24-inch iMac with the M3 family of chips involved a crew of filmmakers, editors, and colorists working on iPhone 15 Pro Max and Mac computers throughout the production.</div>
            </div>






    
    
    

    
    
    


     
     
    
    
        <div data-component-list="ModalGalleryTrigger">iPhone 15 Pro Max with the new USB-C connector brings a huge leap in data transfer with speeds of up to 10Gbps with a compatible USB 3 cable. This supports new workflows like ProRes video recording directly to an external SSD drive, allowing the crew to review footage in near real time and make adjustments on the fly. In post, editors can also take advantage of the higher dynamic range enabled with Apple Log, bringing even more control and flexibility into color grading.
</div>
 

    
    
    






  
    
    
    
    
      <figure aria-label="Media, A crew member captures behind-the-scenes footage at Scary Fast using iPhone 15 Pro and a custom rig." data-component-list="ModalGalleryTrigger">
        <div>
             
              
              <div>
                With a custom SpaceCam rig that’s regularly used on major productions, the team could work seamlessly with iPhone as their main camera and get the same complex shots they were used to.
              </div>
            
            
            
            
            <a href="https://www.apple.com/newsroom/images/2023/10/behind-the-scenes-at-scary-fast-apples-keynote-event-shot-on-iphone/article/Apple-Shot-on-iPhone-customized-SpaceCam-rig.zip" download="" data-analytics-title="Download image" aria-label="Download media, A crew member captures behind-the-scenes footage at Scary Fast using iPhone 15 Pro and a custom rig."></a>
          </div>
      </figure>
    
  






    
    
    

    
    
    


     
     
    
    
        <div data-component-list="ModalGalleryTrigger">Shot under the cover of night at Apple Park, Scary Fast showcased the improvements in low-light video performance on iPhone 15 Pro Max. With ProRes Log encoding, iPhone 15 Pro Max has even more high and low light range than previous models, resulting overall in better dynamic range and better flexibility for color grading in post-production. “When I first got the footage from iPhone 15 Pro Max, I was immediately pleasantly surprised,” says Stefan Sonnenfeld, Company 3’s CEO, who colored the presentation and has worked on projects including <em>Stranger Things</em>, <em>The Equalizer 3</em>, and<em> Fast X</em>. “The quality of the image on iPhone 15 Pro Max is incredible, and it’s there. And I know because I’ve done it and I’ve seen it, and we’re doing this project with it.”
</div>
 

    
    
    






  
    
    
    
    
      <figure aria-label="Media, Crew members capture footage of Tim Cook standing in front of exterior stairs at Apple Park." data-component-list="ModalGalleryTrigger">
        <div>
             
              
              <div>
                Tim Cook on set for Scary Fast at Apple Park.
              </div>
            
            
            
            
            <a href="https://www.apple.com/newsroom/images/2023/10/behind-the-scenes-at-scary-fast-apples-keynote-event-shot-on-iphone/article/Apple-Shot-on-iPhone-Tim-Cook-on-set.zip" download="" data-analytics-title="Download image" aria-label="Download media, Crew members capture footage of Tim Cook standing in front of exterior stairs at Apple Park."></a>
          </div>
      </figure>
    
  






    
    
    

    
    
    


     
     
    
    
        <div data-component-list="ModalGalleryTrigger">Using the Blackmagic Camera app designed exclusively for iOS users, the crew was able to leverage the same interface as Blackmagic Design’s award-winning digital film cameras, which provided the same tools used in feature films, television shows, and documentaries. Available now for free on the App Store, the app adds digital film camera controls to iPhone and supports Apple Log encoding on iPhone 15 Pro Max. “We’ve done a tremendous amount of work behind the scenes working with a great third-party developer, Blackmagic Design, that has created an incredible app that allows us to have huge amounts of monitors and crew, and everybody working how they traditionally would,” says Carr.
</div>
 

    
    
    






  
    
    
    
    
      <figure aria-label="Media, iPhone 15 Pro Max sits on top of a rig on set, capturing a person playing a guitar on a couch." data-component-list="ModalGalleryTrigger">
        <div>
             
              
              <div>
                Blackmagic Camera, an iOS-exclusive app, adds digital film camera controls to iPhone and supports Apple Log encoding on iPhone 15 Pro Max.
              </div>
            
            
            
            
            <a href="https://www.apple.com/newsroom/images/2023/10/behind-the-scenes-at-scary-fast-apples-keynote-event-shot-on-iphone/article/Apple-Shot-on-iPhone-Blackmagic-Camera-app.zip" download="" data-analytics-title="Download image" aria-label="Download media, iPhone 15 Pro Max sits on top of a rig on set, capturing a person playing a guitar on a couch."></a>
          </div>
      </figure>
    
  






    
    
    

    
    
    


     
     
    
    
        <div data-component-list="ModalGalleryTrigger">On the set, the crew employed traditional filming techniques — even the use of drones — seamlessly with iPhone 15 Pro Max to capture the scenes and showcase the new MacBook Pro. “There’s cranes, there’s dollies, there’s all the toys that you want as a filmmaker, and everybody’s moving and has their job to do, and it’s just a very exciting and lively environment,” says Oakes.
</div>
 

    
    
    






  
    
    
    
    
      <figure aria-label="Media, On the set, iPhone 15 Pro Max in a dolly captures MacBook Pro in a mock medical setting to showcase new capabilities for health professionals." data-component-list="ModalGalleryTrigger">
        <div>
             
              
              <div>
                On the set, iPhone 15 Pro Max in a dolly captures MacBook Pro in a mock medical setting to showcase new capabilities for health professionals.
              </div>
            
            
            
            
            <a href="https://www.apple.com/newsroom/images/2023/10/behind-the-scenes-at-scary-fast-apples-keynote-event-shot-on-iphone/article/Apple-Shot-on-iPhone-iPhone-15-Pro-on-dolly.zip" download="" data-analytics-title="Download image" aria-label="Download media, On the set, iPhone 15 Pro Max in a dolly captures MacBook Pro in a mock medical setting to showcase new capabilities for health professionals."></a>
          </div>
      </figure>
    
  






    
    
    


     
     
    
    
        <div data-component-list="ModalGalleryTrigger">Reflecting on the incredible versatility and ease of use of iPhone, Sonnenfeld says, “I think what I love about the iPhone is it enables everybody who uses it to have access to incredible amounts of information, and with a really intuitive operating system, so that whether it’s myself or my 7-year-old, anybody can pick it up and pretty much use it right away.”
</div>
 

    
    
    




    
    
        
    


    
    
    



    
    
    






    
















	
	
	
		















	
	

</article>



</section>
</main>


	

</div>]]></description>
        </item>
        <item>
            <title><![CDATA[Reverse-engineering Ethernet backoff on the Intel 82586 network chip's die (184 pts)]]></title>
            <link>http://www.righto.com/2023/10/reverse-engineering-ethernet-backoff-on.html</link>
            <guid>38086894</guid>
            <pubDate>Tue, 31 Oct 2023 15:59:57 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="http://www.righto.com/2023/10/reverse-engineering-ethernet-backoff-on.html">http://www.righto.com/2023/10/reverse-engineering-ethernet-backoff-on.html</a>, See on <a href="https://news.ycombinator.com/item?id=38086894">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="post-body-6841874513404372481" itemprop="description articleBody"><p>
Introduced in 1973, Ethernet is the predominant way of wiring computers together.
Chips were soon introduced to handle the low-level aspects of Ethernet: converting data packets into bits,
implementing checksums, and handling network collisions.
In 1982, Intel announced the i82586 Ethernet LAN coprocessor chip, which went much further by offloading most of the
data movement from the main processor to an on-chip coprocessor.
Modern Ethernet networks handle a gigabit of data per second or more, but at the time, the Intel chip's support for 10 Mb/s
Ethernet put it on the cutting edge.
(Ethernet was surprisingly expensive, about $2000 at the time, but <a href="https://books.google.com/books?id=3kpkQKds0lAC&amp;lpg=PA4&amp;pg=PA4#v=onepage&amp;q&amp;f=false">expected to drop</a> under $1000 with the Intel chip.)
In this blog post, I focus on a specific part of the coprocessor chip: how it handles network collisions and implements
exponential backoff.</p>
<p>The die photo below shows the i82586 chip. This photo shows the metal layer on top of the chip, which hides the underlying
polysilicon wiring and silicon transistors.
Around the edge of the chip, square bond pads provide the link to the chip's 48 external pins.
I have labeled the function blocks based on my reverse engineering and published descriptions. The left side of the chip is called the "receive unit" and
handles the low-level networking,
with circuitry for the network transmitter and receiver.
The left side also contains low-level control and status registers.
The right side is called the "command unit" and interfaces to memory and the main processor.
The right side contains a simple processor controlled by a microinstruction ROM.<span id="fnref:microcode"><a href="#fn:microcode">1</a></span>
Data is transmitted between the two halves of the chip by 16-byte FIFOs (first in, first out queues).</p>
<p><a href="https://static.righto.com/images/i82586s/die-labeled.jpg"><img alt="The die of the Intel 82586 with the main functional blocks labeled. Click this image (or any other) for a larger version." height="528" src="https://static.righto.com/images/i82586s/die-labeled-w600.jpg" title="The die of the Intel 82586 with the main functional blocks labeled. Click this image (or any other) for a larger version." width="600"></a></p><p>The die of the Intel 82586 with the main functional blocks labeled. Click this image (or any other) for a larger version.</p>
<p>The 82586 chip is more complex than the typical Ethernet chip at the time.
It was designed to improve system performance by moving most of the Ethernet processing from the main processor to
the coprocessor, allowing the main processor and the coprocessor to operate in parallel.
The coprocessor provides four DMA channels to move data between memory and the network without the main processor's involvement.
The main processor and the coprocessor communicate through complex data structures<span id="fnref:structures"><a href="#fn:structures">2</a></span> in shared memory: the main processor puts control blocks in memory
to tell the I/O coprocessor what to do, specifying the locations of transmit and receive buffers in memory.
In response, the I/O coprocessor puts status blocks in memory.
The processor onboard the 82586 chip allows the chip to handle these complex data structures in software.
Meanwhile, the transmission/receive circuitry on the left side of the chip uses dedicated circuitry to handle the low-level,
high-speed aspects of Ethernet. </p>
<h2>Ethernet and collisions</h2>
<p>A key problem with a shared network is how to prevent multiple computers from trying to send data on the network at the same
time.
Instead of a centralized control mechanism, Ethernet allows computers to transmit whenever they want.<span id="fnref:token-ring"><a href="#fn:token-ring">3</a></span>
If two computers transmit at the same time, the "collision" is detected and the computers try again, hoping to
avoid a collision the next time.
Although this may sound inefficient, it turns out to work out remarkably well.<span id="fnref:csma"><a href="#fn:csma">4</a></span>
To avoid a second collision, each computer waits a random amount of time before retransmitting the packet.
If a collision happens again (which is likely on a busy network), an exponential backoff algorithm is used, with each
computer waiting longer and longer after each collision.
This automatically balances the retransmission delay to minimize collisions and maximize throughput.</p>
<p>I traced out a bunch of circuitry to determine how the exponential backoff logic is implemented.
To summarize, exponential backoff is implemented with a 10-bit counter to provide a pseudorandom number, a 10-bit mask register to get an exponentially sized
delay, and a delay counter to count down the delay.
I'll discuss how these are implemented, starting with the 10-bit counter.</p>
<h2>The 10-bit counter</h2>
<p>A 10-bit counter may seem trivial, but it still takes up a substantial area of the chip.
The straightforward way of implementing a counter is to hook up 10 latches as a "ripple counter".
The counter is controlled by a clock signal that indicates that the counter should increment.
The clock toggles the lowest bit of the counter.
If this bit flips from 1 to 0, the next higher bit is toggled.
The process is repeated from bit to bit, toggling a bit if there is a carry.
The problem with this approach is that the carry "ripples" through the counter.
Each bit is delayed by the lower bit, so the bits don't all flip at the same time.
This limits the speed of the counter as the top bit isn't settled until the carry has propagated through the nine lower bits.</p>
<p>The counter in the chip uses a different approach with additional circuitry to improve performance.
Each bit has logic to check if all the lower bits are ones. If so, the clock signal toggles the bit.
All the bits toggle at the same time, rapidly incrementing the counter in response to the clock signals.
The drawback of this approach is that it requires much more logic.</p>
<p>The diagram below shows how the carry logic is implemented. 
The circuitry is optimized to balance speed and complexity.
In particular, bits are examined in groups of three, allowing some of the logic to be shared across multiple bits.
For instance, instead of using a 9-input gate to examine the nine lower bits, separate gates test bits 0-2 and 3-5.</p>
<p><a href="https://static.righto.com/images/i82586s/toggle-logic.jpg"><img alt="The circuitry to generate the toggle signals for each bit of the counter." height="555" src="https://static.righto.com/images/i82586s/toggle-logic-w350.jpg" title="The circuitry to generate the toggle signals for each bit of the counter." width="350"></a></p><p>The circuitry to generate the toggle signals for each bit of the counter.</p>
<p>The implementation of the latches is also interesting. 
Each latch is implemented with dynamic logic, using the circuit's capacitance to store each bit.
The input is connected to the output with two inverters.
When the clock is high, the transistor turns on, connecting the inverters in a loop that holds the value.
When the clock is low, the transistor turns off. However, the 0 or 1 value will still remain on the input to
the first inverter, held by the charge on the transistor's gate. 
At this time, an input can be fed into the latch, overriding the old value.</p>
<p><a href="https://static.righto.com/images/i82586s/bit.jpg"><img alt="The basic dynamic latch circuit." height="148" src="https://static.righto.com/images/i82586s/bit-w300.jpg" title="The basic dynamic latch circuit." width="300"></a></p><p>The basic dynamic latch circuit.</p>
<p>The latch has some additional circuitry to make it useful.
To toggle the latch, the output is inverted before feeding it back to the input. The toggle control signal selects
the inverted output through another pass transistor.
The toggle signal is only activated when the clock is low, ensuring that the
circuit doesn't repeatedly toggle, oscillating out of control.</p>
<p><a href="https://static.righto.com/images/i82586s/counter-bit.jpg"><img alt="One bit of the counter." height="196" src="https://static.righto.com/images/i82586s/counter-bit-w400.jpg" title="One bit of the counter." width="400"></a></p><p>One bit of the counter.</p>
<p>The image below shows how the counter circuit is implemented on the die. I have removed the metal layer to show the underlying transistors; the circles are contacts where the metal was connected to the underlying silicon.
The pinkish regions are doped silicon. The pink-gray lines are polysilicon wiring. When polysilicon crosses doped silicon, it
creates a transistor.
The blue color swirls are not significant; they are bits of oxide remaining on the die.</p>
<p><a href="https://static.righto.com/images/i82586s/die-counter.jpg"><img alt="The counter circuitry on the die." height="764" src="https://static.righto.com/images/i82586s/die-counter-w400.jpg" title="The counter circuitry on the die." width="400"></a></p><p>The counter circuitry on the die.</p>
<h2>The 10-bit mask register</h2>
<p>The mask register has a particular number of low bits set, providing a mask of length 0 to 10.
For instance, with 4 bits set, the mask register is 0000001111.
The mask register can be updated in two ways. First, it can be set to length 1-8 with a three-bit length input.<span id="fnref:length"><a href="#fn:length">5</a></span>
Second, the mask can be lengthened by one bit, for example going from 0000001111 to 0000011111 (length 4 to 5).</p>
<p>The mask register is implemented with dynamic latches similar to the counter, but the inputs to the latches are different.
To load the mask to a particular length, each bit has logic to determine if the bit should be set based on the three-bit input.
For example, bit 3 is cleared if the specified length is 0 to 3, and set otherwise.
The lengthening feature is implemented by shifting the mask value to the left by one bit and inserting a 1 into the lowest bit.</p>
<p>The schematic below shows one bit of the mask register. At the center is a two-inverter latch as seen before.
When the clock is high, it holds its value. When the clock is low, the latch can be loaded with a new value.
The "shift" line causes the bit from the previous stage to be shifted in. The "load" line loads the mask bit generated from
the input length. The "reset" line clears the mask.
At the right is the NAND gate that applies the mask to the count and inverts the result.
As will be seen below, these NAND gates are unusually large.</p>
<p><a href="https://static.righto.com/images/i82586s/mask-stage.png"><img alt="One stage of the mask register." height="259" src="https://static.righto.com/images/i82586s/mask-stage-w500.png" title="One stage of the mask register." width="500"></a></p><p>One stage of the mask register.</p>
<p>The logic to set a mask bit based on the length input is shown below.<span id="fnref:demorgan"><a href="#fn:demorgan">6</a></span>
The three-bit "sel" input selects the mask length from 1 to 8 bits; note that the mask0 bit is always set while bits
8 and 9 are cleared.<span id="fnref:control"><a href="#fn:control">7</a></span>
Each set of gates energizes the corresponding mask line for the appropriate inputs.</p>
<p><a href="https://static.righto.com/images/i82586s/mask-ctrl.png"><img alt="The control logic to enable mask bits based on length." height="602" src="https://static.righto.com/images/i82586s/mask-ctrl-w350.png" title="The control logic to enable mask bits based on length." width="350"></a></p><p>The control logic to enable mask bits based on length.</p>
<p>The diagram below shows the mask register on the die. I removed the metal layer to show the underlying
silicon and polysilicon, so the transistors are visible.
On the left are the NAND gates that combine each bit of the counter with the mask. Note that large snake-like
transistors; these larger transistors provide enough current to drive the signal over the long bus to
the delay counter register at the bottom of the chip.
Bit 0 of the mask is always set, so it doesn't have a latch. Bits 8 and 9 of the mask are only set by
shifting, not by selecting a mask length, so they don't have mask logic.<span id="fnref:state"><a href="#fn:state">8</a></span></p>
<p><a href="https://static.righto.com/images/i82586s/mask-register.jpg"><img alt="The mask register on the die." height="764" src="https://static.righto.com/images/i82586s/mask-register-w400.jpg" title="The mask register on the die." width="400"></a></p><p>The mask register on the die.</p>
<h2>The delay counter register</h2>
<p>To generate the pseudorandom exponential backoff, the counter register and the mask register are NANDed together.
This generates a number of the desired binary length, which is stored in the delay counter.
Note that the NAND operation inverts the result, making it negative.
Thus, as the delay counter counts up, it counts toward zero, reaching zero after the desired number of clock ticks.</p>
<p>The implementation of the delay counter is similar to the first counter, so I won't include a schematic.
However, the delay counter is attached to the register bus, allowing its value to be read by the chip's CPU.
Control lines allow the delay counter's value to pass onto the register bus.</p>
<p>The diagram below shows the locations of the counter, mask, and delay register on the die.
In this era, something as simple as a 10-bit register occupied a significant part of the die.
Also note the distance between the counter and mask and the delay register at the bottom of the chip.
The NAND gates for the counter and mask required large transistors to drive the signal across this large distance.</p>
<p><a href="https://static.righto.com/images/i82586s/die-labeled-backoff.jpg"><img alt="The die, with counter, mask, and delay register." height="446" src="https://static.righto.com/images/i82586s/die-labeled-backoff-w600.jpg" title="The die, with counter, mask, and delay register." width="600"></a></p><p>The die, with counter, mask, and delay register.</p>
<h2>Conclusions</h2>
<p>The Intel Ethernet chip provides an interesting example of how a real-world circuit is implemented on a chip.
Exponential backoff is a key part of the Ethernet standard.
This chip implements backoff with a simple but optimized circuit.<span id="fnref:drawback"><a href="#fn:drawback">9</a></span></p>
<p><a href="https://static.righto.com/images/i82586s/die-stripped-r.jpg"><img alt="A high-resolution image of the die with the metal removed. (Click for a larger version.) Some of the oxide layer remains, causing colored regions due to thin-film interference." height="511" src="https://static.righto.com/images/i82586s/die-stripped-r-w600.jpg" title="A high-resolution image of the die with the metal removed. (Click for a larger version.) Some of the oxide layer remains, causing colored regions due to thin-film interference." width="600"></a></p><p>A high-resolution image of the die with the metal removed. (Click for a larger version.) Some of the oxide layer remains, causing colored regions due to thin-film interference.</p>
<p>For more chip reverse engineering,
follow me on Twitter <a href="https://twitter.com/kenshirriff">@kenshirriff</a> or <a href="http://www.righto.com/feeds/posts/default">RSS</a> for updates.
I'm also on Mastodon occasionally as <a href="https://oldbytes.space/@kenshirriff">@<span data-cfemail="7b101e150813120909121d1d3b14171f19020f1e0855080b1a181e">[email&nbsp;protected]</span></a>.
Acknowledgments: Thanks to Robert Garner for providing the chip and questions.</p>
<h2>Notes and references</h2>


</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Show HN: MicroTCP, a minimal TCP/IP stack (180 pts)]]></title>
            <link>https://github.com/cozis/microtcp</link>
            <guid>38086598</guid>
            <pubDate>Tue, 31 Oct 2023 15:43:12 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/cozis/microtcp">https://github.com/cozis/microtcp</a>, See on <a href="https://news.ycombinator.com/item?id=38086598">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text"><h2 tabindex="-1" id="user-content-microtcp" dir="auto"><a href="#microtcp">MicroTCP</a></h2>
<p dir="auto">MicroTCP is a TCP/IP network stack I started building as a learning exercise while attending the Computer Networking course at the Università degli Studi di Napoli Federico II. It's just a hobby project and is intended to just be a minimal, yet complete, implementation.</p>
<p dir="auto">At this moment MicroTCP implements ARP (RFC 826, complete), IPv4 (no fragmentation), ICMP (minimum necessary to reply to pings) and TCP (complete but not stress-tested). Note that "complete" should not be intended as "fully compliant" but just as a measure of progress on all of the major features. For instance, it's complete enough to handle HTTP traffic on a local network (Look into examples/microhttp to know more).</p>
<h2 tabindex="-1" id="user-content-where-does-it-run" dir="auto"><a href="#where-does-it-run">Where does it run?</a></h2>
<p dir="auto">MicroTCP can run on Windows and Linux alongside the OS's network stack. To route the network traffic to MicroTCP, the process running it behaves as a virtual host with its own IP address. This is done using a TAP device, which comes built-in on Linux and needs to be installed on Windows. It should be very easy to adapt MicroTCP to run on microcontrollers but haven't tried yet. The dream is to serve my <a href="https://cozis.github.io/" rel="nofollow">blog</a> from an STM32 board!</p>
<h2 tabindex="-1" id="user-content-build-and-install" dir="auto"><a href="#build-and-install">Build and Install</a></h2>
<p dir="auto">If you are on Windows, you need to install the TAP driver provided by OpenVPN and instanciate a virtual NIC so that MicroTCP can connect to it when started. To build the project from source, make sure you cloned the repository with submodules</p>
<div dir="auto" data-snippet-clipboard-copy-content="git clone https://github.com/cozis/microtcp.git --recursive"><pre>git clone https://github.com/cozis/microtcp.git --recursive</pre></div>
<p dir="auto">and then run</p>

<p dir="auto">You'll need both <code>make</code> and <code>cmake</code> for it to work. If all goes well, you'll find the library files <code>libtuntap.a</code>, <code>libmicrotcp.a</code> and header files <code>tuntap.h</code>, <code>tuntap-export.h</code>, <code>microtcp.h</code> in <code>out/</code>.</p>
<h2 tabindex="-1" id="user-content-usage" dir="auto"><a href="#usage">Usage</a></h2>
<p dir="auto">MicroTCP's uses the usual socket interface any network programmer is familiar with, the main difference being you need to explicitly instanciate the network stack and pass its handle around.</p>
<p dir="auto">Here's a simple echo server that shows the basic usage:</p>
<div dir="auto" data-snippet-clipboard-copy-content="#include <microtcp.h>

int main(void)
{
    microtcp_t *mtcp = microtcp_create();
    
    uint16_t port = 80;
    microtcp_socket_t *server = microtcp_open(mtcp, port, NULL);
    
    while (1) {

        microtcp_socket_t *client = microtcp_accept(server, false, NULL);

        char buffer[1024];
        size_t num = microtcp_recv(client, buffer, sizeof(buffer), NULL);
        microtcp_send(client, &quot;echo: &quot;, 6, NULL);
        microtcp_send(client, buffer, num, NULL);

        microtcp_close(client);
    }
    
    microtcp_close(server);
    microtcp_destroy(mtcp);
    return 0;
}

// NOTE: Errors checks were omitted for readability's sake.
//       If you want to use this code, you probably want to
//       add some checks!"><pre><span>#include</span> <span>&lt;microtcp.h&gt;</span>

<span>int</span> <span>main</span>(<span>void</span>)
{
    <span>microtcp_t</span> <span>*</span><span>mtcp</span> <span>=</span> <span>microtcp_create</span>();
    
    <span>uint16_t</span> <span>port</span> <span>=</span> <span>80</span>;
    <span>microtcp_socket_t</span> <span>*</span><span>server</span> <span>=</span> <span>microtcp_open</span>(<span>mtcp</span>, <span>port</span>, <span>NULL</span>);
    
    <span>while</span> (<span>1</span>) {

        <span>microtcp_socket_t</span> <span>*</span><span>client</span> <span>=</span> <span>microtcp_accept</span>(<span>server</span>, false, <span>NULL</span>);

        <span>char</span> <span>buffer</span>[<span>1024</span>];
        <span>size_t</span> <span>num</span> <span>=</span> <span>microtcp_recv</span>(<span>client</span>, <span>buffer</span>, <span>sizeof</span>(<span>buffer</span>), <span>NULL</span>);
        <span>microtcp_send</span>(<span>client</span>, <span>"echo: "</span>, <span>6</span>, <span>NULL</span>);
        <span>microtcp_send</span>(<span>client</span>, <span>buffer</span>, <span>num</span>, <span>NULL</span>);

        <span>microtcp_close</span>(<span>client</span>);
    }
    
    <span>microtcp_close</span>(<span>server</span>);
    <span>microtcp_destroy</span>(<span>mtcp</span>);
    <span>return</span> <span>0</span>;
}

<span>// NOTE: Errors checks were omitted for readability's sake.</span>
<span>//       If you want to use this code, you probably want to</span>
<span>//       add some checks!</span></pre></div>
<p dir="auto">This should be pretty straight forward to understand. One thing may be worth noting is that <code>microtcp_open</code> behaves as the BSD's <code>socket+bind+listen</code> all at once to setup a listening TCP server.</p>
<p dir="auto">There is more than one way to set up the stack, the main way being <code>microtcp_create</code> which creates a virtual network inferface on the host OS with IP 10.0.0.5/24 and a virtual host for the MicroTCP process at 10.0.0.4/24. You can open Wireshark on the virtual NIC to inspect the traffic between the host and the process.</p>
<p dir="auto">It's also possible to configure the stack using the <code>microtcp_create_using_callbacks</code>, which lets you explicitly provide the input L2 frames to it and receive the frames in a buffer. This is how one would configure the stack to run on a microcontroller.</p>
<p dir="auto">Each instance of MicroTCP (without considering the callbacks) is completely isolated from the others, therefore, if your specific callback implementation allows it, you can have as many instances as you like!</p>
<h2 tabindex="-1" id="user-content-testing" dir="auto"><a href="#testing">Testing</a></h2>
<p dir="auto">There is still no testing infractructure. The way I'm testing it is by setting up an HTTP or echo server and stressing it until something breaks while capturing what happened using Wireshark.</p>
</article>
          </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Show HN: Streamdal – an open-source tail -f for your data (123 pts)]]></title>
            <link>https://github.com/streamdal/streamdal</link>
            <guid>38086387</guid>
            <pubDate>Tue, 31 Oct 2023 15:31:33 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/streamdal/streamdal">https://github.com/streamdal/streamdal</a>, See on <a href="https://news.ycombinator.com/item?id=38086387">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">  
<p dir="auto"><strong>This is the <em>main</em> repo for the <a href="https://streamdal.com/" rel="nofollow">Streamdal</a> project.</strong></p>
<p dir="auto">Streamdal is a combination of open source services and SDKs that enable <em>real-time</em>:</p>
<ul dir="auto">
<li><em>Data observability (think <code>tail -f</code> for your data!)</em></li>
<li><em>Data governance &amp; enforcement</em></li>
<li><em>Data quality monitoring</em></li>
<li><em>Data transformation + obfuscation + masking + stripping</em></li>
</ul>
<p dir="auto">.. and <a href="https://docs.streamdal.com/" rel="nofollow">a bunch of other things</a>.</p>
<p dir="auto"><sub><em>This is what it looks like:</em></sub>
<a target="_blank" rel="noopener noreferrer" href="https://github.com/streamdal/streamdal/blob/main/assets/img.png"><img src="https://github.com/streamdal/streamdal/raw/main/assets/img.png"></a></p>
<p dir="auto"><a href="#streamdal">Overview</a> •
<a href="#demo">Demo</a> •
<a href="#getting-started">Getting Started</a> •
<a href="#how-does-it-work">How Does It Work?</a> •
<a href="#community">Community</a> •
<a href="#resources">Resources</a></p>
<h2 tabindex="-1" id="user-content-live-demo" dir="auto"><a href="#live-demo">Live Demo</a></h2>
<p dir="auto">You don't have to install the <a href="https://github.com/streamdal/server">server</a>,
the <a href="https://github.com/streamdal/console">console</a>
or <a href="https://docs.streamdal.com/instrument" rel="nofollow">instrument</a> any of your apps to see
Streamdal in action. We've got a live demo :)</p>
<h3 tabindex="-1" id="user-content-demostreamdalcom" dir="auto"><a href="#demostreamdalcom"></a><a href="https://demo.streamdal.com/" rel="nofollow">DEMO.STREAMDAL.COM</a></h3>
<p dir="auto"><em>The demo will showcase:</em></p>
<ol dir="auto">
<li><strong>Tail</strong>
<ul dir="auto">
<li>Select any Component and start <code>Tail</code> request to watch live output</li>
</ul>
</li>
<li><strong>Welcome Service/Emailer</strong>
<ul dir="auto">
<li>View how attached <code>Mask dot com emails</code> pipeline obfuscates <code>recipient</code> field if field contains <code>.com</code></li>
</ul>
</li>
<li><strong>Signup Service/Recorder</strong>
<ul dir="auto">
<li>Observe attached <code>Scrub ICMP</code> pipeline changing <code>object.ipv4_address</code> if <code>object.protocol</code> equals "ICMP"</li>
</ul>
</li>
<li><strong>Observe Throughput</strong>
<ul dir="auto">
<li>Watch the read/write-per-second throughput for any component</li>
</ul>
</li>
<li><strong>Data Graph</strong>
<ul dir="auto">
<li>Use the service map to see all services, operations and components and how they relate to each other</li>
<li>The <a href="https://docs.streamdal.com/en/resources-support/glossary/#data-graph" rel="nofollow">data graph</a> is the "node map" of all services and components</li>
</ul>
</li>
<li><strong>Schema Inference</strong>
<ul dir="auto">
<li>View the inferred JSON Schema for all consumers and producers</li>
</ul>
</li>
</ol>
<p dir="auto"><strong>Each one of these actions is occurring in <em>real-time</em>!</strong></p>
<p dir="auto"><sub><em>You can read more about how this is achieved in the <a href="https://docs.streamdal.com/en/getting-started/how-streamdal-works/" rel="nofollow">"how does it work?"</a> docs.</em></sub></p>
<h2 tabindex="-1" id="user-content-getting-started" dir="auto"><a href="#getting-started">Getting Started</a></h2>
<p dir="auto">Getting started consists of two steps:</p>
<ol dir="auto">
<li><strong>Installing</strong> the server, console and their dependencies</li>
<li><strong>Instrumenting</strong> your code with one of our <a href="https://docs.streamdal.com/sdks" rel="nofollow">SDKs</a></li>
</ol>
<h3 tabindex="-1" id="user-content-install" dir="auto"><a href="#install">Install</a></h3>
<p dir="auto">The <em>easiest</em> way to get Streamdal running is via <code>curl | bash</code>:</p>
<div data-snippet-clipboard-copy-content="curl -sSL https://sh.streamdal.com | bash"><pre><code>curl -sSL https://sh.streamdal.com | bash
</code></pre></div>
<ol dir="auto">
<li>The install script will verify that you have <code>git</code>, <code>docker</code> and <code>docker-compose</code> installed</li>
<li>The install script will clone this repo to <code>~/streamdal</code></li>
<li>The install script will bring up all components via <code>docker-compose</code></li>
</ol>
<p dir="auto">Once done:</p>
<p dir="auto">🎉 <strong>Open<code>http://localhost:8080</code> in your browser!</strong> 🎉</p>
<p dir="auto">You should be presented with a <em>beautiful</em> (but empty) UI! To populate it,
we will need to instrument some code. <em>Onto the next section!</em></p>
<p dir="auto"><sub><em>For alternative installation methods, check the <a href="https://github.com/streamdal/streamdal/blob/main/install">install</a> dir.</em></sub></p>
<h3 tabindex="-1" id="user-content-instrument" dir="auto"><a href="#instrument">Instrument</a></h3>
<p dir="auto">Once you've installed the server and console, you can instrument your code using
one of our <a href="#sdks">SDKs</a>.</p>
<blockquote>
<p dir="auto">To see an example of a <em>complete</em> instrumentation, take a look at the
<a href="https://github.com/streamdal/server/tree/main/test-utils/demo-client">Go demo client</a>
that is bundled with the <a href="https://github.com/streamdal/server">server</a>.</p>
</blockquote>
<p dir="auto"><strong><a href="https://github.com/streamdal/go-sdk">Go</a></strong></p>
<div dir="auto" data-snippet-clipboard-copy-content="package main

import (
   &quot;context&quot;

   &quot;github.com/streamdal/go-sdk&quot;
)

func main() {
   sc, _ := streamdal.New(&amp;streamdal.Config{
      ServerURL:       &quot;streamdal-server.svc.cluster.local:8082&quot;,
      ServerToken:     &quot;1234&quot;,
      ServiceName:     &quot;billing-svc&quot;,
      ShutdownCtx:     context.Background(),
   })

   resp, _ := sc.Process(context.Background(), &amp;streamdal.ProcessRequest{
      OperationType: streamdal.OperationTypeConsumer,
      OperationName: &quot;new-order-topic&quot;,
      ComponentName: &quot;kafka&quot;,
      Data:          []byte(`{&quot;object&quot;: {&quot;field&quot;: true}}`),
   })
}"><pre><span>package</span> main

<span>import</span> (
   <span>"context"</span>

   <span>"github.com/streamdal/go-sdk"</span>
)

<span>func</span> <span>main</span>() {
   <span>sc</span>, <span>_</span> <span>:=</span> <span>streamdal</span>.<span>New</span>(<span>&amp;</span>streamdal.<span>Config</span>{
      <span>ServerURL</span>:       <span>"streamdal-server.svc.cluster.local:8082"</span>,
      <span>ServerToken</span>:     <span>"1234"</span>,
      <span>ServiceName</span>:     <span>"billing-svc"</span>,
      <span>ShutdownCtx</span>:     <span>context</span>.<span>Background</span>(),
   })

   <span>resp</span>, <span>_</span> <span>:=</span> <span>sc</span>.<span>Process</span>(<span>context</span>.<span>Background</span>(), <span>&amp;</span>streamdal.<span>ProcessRequest</span>{
      <span>OperationType</span>: <span>streamdal</span>.<span>OperationTypeConsumer</span>,
      <span>OperationName</span>: <span>"new-order-topic"</span>,
      <span>ComponentName</span>: <span>"kafka"</span>,
      <span>Data</span>:          []<span>byte</span>(<span>`{"object": {"field": true}}`</span>),
   })
}</pre></div>
<p dir="auto"><strong><a href="https://github.com/streamdal/python-sdk">Python</a></strong></p>
<div dir="auto" data-snippet-clipboard-copy-content="from streamdal import (OPERATION_TYPE_CONSUMER, ProcessRequest, StreamdalClient, StreamdalConfig)

client = StreamdalClient(
   cfg=StreamdalConfig(
      service_name=&quot;order-ingest&quot;,
      streamdal_url=&quot;streamdal-server.svc.cluster.local:8082&quot;,
      streamdal_token=&quot;1234&quot;,
   )
)

res = client.process(
   ProcessRequest(
      operation_type=OPERATION_TYPE_CONSUMER,
      operation_name=&quot;new-order-topic&quot;,
      component_name=&quot;kafka&quot;,
      data=b'{&quot;object&quot;: {&quot;field&quot;: true}}',
   )
)"><pre><span>from</span> <span>streamdal</span> <span>import</span> (<span>OPERATION_TYPE_CONSUMER</span>, <span>ProcessRequest</span>, <span>StreamdalClient</span>, <span>StreamdalConfig</span>)

<span>client</span> <span>=</span> <span>StreamdalClient</span>(
   <span>cfg</span><span>=</span><span>StreamdalConfig</span>(
      <span>service_name</span><span>=</span><span>"order-ingest"</span>,
      <span>streamdal_url</span><span>=</span><span>"streamdal-server.svc.cluster.local:8082"</span>,
      <span>streamdal_token</span><span>=</span><span>"1234"</span>,
   )
)

<span>res</span> <span>=</span> <span>client</span>.<span>process</span>(
   <span>ProcessRequest</span>(
      <span>operation_type</span><span>=</span><span>OPERATION_TYPE_CONSUMER</span>,
      <span>operation_name</span><span>=</span><span>"new-order-topic"</span>,
      <span>component_name</span><span>=</span><span>"kafka"</span>,
      <span>data</span><span>=</span><span>b'{"object": {"field": true}}'</span>,
   )
)</pre></div>
<p dir="auto"><strong><a href="https://github.com/streamdal/node-sdk">Node.js</a></strong></p>
<div dir="auto" data-snippet-clipboard-copy-content="import { OperationType, Streamdal } from &quot;@streamdal/node-sdk/streamdal&quot;;

export const example = async () => {
  const streamdal = new Streamdal({
    streamdalUrl: &quot;localhost:8082&quot;,
    streamdalToken: &quot;1234&quot;,
    serviceName: &quot;test-service-name&quot;,
    pipelineTimeout: &quot;100&quot;,
    stepTimeout: &quot;10&quot;,
  });

  const result = await streamdal.processPipeline({
    audience: {
      serviceName: &quot;test-service&quot;,
      componentName: &quot;kafka&quot;,
      operationType: OperationType.PRODUCER,
      operationName: &quot;kafka-producer&quot;,
    },
    data: new TextEncoder().encode(JSON.stringify({ key: &quot;value&quot; })),
  });
};
"><pre><span>import</span> <span>{</span> <span>OperationType</span><span>,</span> <span>Streamdal</span> <span>}</span> <span>from</span> <span>"@streamdal/node-sdk/streamdal"</span><span>;</span>

<span>export</span> <span>const</span> <span>example</span> <span>=</span> <span>async</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> <span>streamdal</span> <span>=</span> <span>new</span> <span>Streamdal</span><span>(</span><span>{</span>
    <span>streamdalUrl</span>: <span>"localhost:8082"</span><span>,</span>
    <span>streamdalToken</span>: <span>"1234"</span><span>,</span>
    <span>serviceName</span>: <span>"test-service-name"</span><span>,</span>
    <span>pipelineTimeout</span>: <span>"100"</span><span>,</span>
    <span>stepTimeout</span>: <span>"10"</span><span>,</span>
  <span>}</span><span>)</span><span>;</span>

  <span>const</span> <span>result</span> <span>=</span> <span>await</span> <span>streamdal</span><span>.</span><span>processPipeline</span><span>(</span><span>{</span>
    <span>audience</span>: <span>{</span>
      <span>serviceName</span>: <span>"test-service"</span><span>,</span>
      <span>componentName</span>: <span>"kafka"</span><span>,</span>
      <span>operationType</span>: <span>OperationType</span><span>.</span><span>PRODUCER</span><span>,</span>
      <span>operationName</span>: <span>"kafka-producer"</span><span>,</span>
    <span>}</span><span>,</span>
    <span>data</span>: <span>new</span> <span>TextEncoder</span><span>(</span><span>)</span><span>.</span><span>encode</span><span>(</span><span>JSON</span><span>.</span><span>stringify</span><span>(</span><span>{</span> <span>key</span>: <span>"value"</span> <span>}</span><span>)</span><span>)</span><span>,</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span><span>;</span></pre></div>
<div dir="auto"><p dir="auto"><span>Important</span><br>
<strong>These are <em>basic, minimal</em> examples and should NOT be used in production code.</strong></p><p dir="auto">Refer to the instrumentation docs for more thorough directions.</p></div>
<h2 tabindex="-1" id="user-content-how-does-it-work" dir="auto"><a href="#how-does-it-work">How Does It Work?</a></h2>
<p dir="auto">Streamdal consists of <strong>three</strong> main components:</p>
<ul dir="auto">
<li><strong><a href="https://github.com/streamdal/server">Server</a></strong></li>
<li><strong><a href="https://github.com/streamdal/console">Console</a></strong></li>
<li><strong><a href="https://docs.streamdal.com/en/core-components/sdk/" rel="nofollow">SDKs</a></strong></li>
</ul>
<p dir="auto">The basic flow is that you <a href="#getting-started">install</a> the server and console and
wrap any reads or writes in your app with our SDK. Once that's done, you will be
able to see the data your app is reading or writing in the
<a href="https://github.com/streamdal/console">console</a> (or use the<br>
<a href="https://github.com/streamdal/cli">CLI</a>).</p>
<p dir="auto">You will also be able to enforce rules on your data (such as <em>"this should be
valid JSON"</em>, <em>"message should contain a field called <code>foo</code>"</em>, <em>"strip all email
addresses"</em> and so on).</p>
<p dir="auto"><span>Important</span><br>
For a more in-depth explanation of the flow and the various components, visit
our <a href="https://docs.streamdal.com/en/getting-started/how-streamdal-works/" rel="nofollow">docs</a>.</p>
<h2 tabindex="-1" id="user-content-community" dir="auto"><a href="#community">Community</a></h2>
<p dir="auto">We're building Streamdal in the open and we'd love for you to join us!</p>
<p dir="auto">Join our <a href="https://discord.gg/streamdal" rel="nofollow">Discord</a>!</p>
<h2 tabindex="-1" id="user-content-resources" dir="auto"><a href="#resources">Resources</a></h2>
<h3 tabindex="-1" id="user-content-getting-help" dir="auto"><a href="#getting-help">Getting Help</a></h3>
<p dir="auto">Stuck? Something not working right? Have questions?</p>
<ul dir="auto">
<li>First and <em>easiest</em> way to get help is to join our <a href="https://discord.gg/streamdal" rel="nofollow">Discord</a></li>
<li>If you're not in the mood to chat - there's <a href="https://docs.streamdal.com/" rel="nofollow">docs</a></li>
<li>If all else fails, <a href="https://github.com/streamdal/streamdal/issues/new">open an issue</a>!</li>
</ul>
<h3 tabindex="-1" id="user-content-manifesto" dir="auto"><a href="#manifesto">Manifesto</a></h3>
<p dir="auto">To get a better understanding of what we're trying to do, our ethos, principles,
and really, our state of mind - check out our <a href="https://streamdal.com/manifesto" rel="nofollow">manifesto</a>.</p>
<h3 tabindex="-1" id="user-content-roadmap" dir="auto"><a href="#roadmap">Roadmap</a></h3>
<p dir="auto">You have control over what we're building - <a href="https://github.com/orgs/streamdal/projects/1">our roadmap is 100% public</a>!</p>
<p dir="auto">Feel free to stop by to discuss features, suggest new ones or just keep an eye
on what's in the pipeline.</p>
<h3 tabindex="-1" id="user-content-contributing" dir="auto"><a href="#contributing">Contributing</a></h3>
<p dir="auto">We ❤️ contributions! But... before you craft an amazing PR, please read
through our <a href="https://docs.streamdal.com/en/resources-support/contributing/" rel="nofollow">contributing docs</a>.</p>
<h3 tabindex="-1" id="user-content-license" dir="auto"><a href="#license">License</a></h3>
<p dir="auto">This project is licensed under the <code>Apache-2.0</code> license.</p>
<p dir="auto">See the <a href="https://github.com/streamdal/streamdal/blob/main/LICENSE">LICENSE</a> file for more info.</p>
</article>
          </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Real-time dreamy Cloudscapes with Volumetric Raymarching (119 pts)]]></title>
            <link>https://blog.maximeheckel.com/posts/real-time-cloudscapes-with-volumetric-raymarching/</link>
            <guid>38086222</guid>
            <pubDate>Tue, 31 Oct 2023 15:22:15 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://blog.maximeheckel.com/posts/real-time-cloudscapes-with-volumetric-raymarching/">https://blog.maximeheckel.com/posts/real-time-cloudscapes-with-volumetric-raymarching/</a>, See on <a href="https://news.ycombinator.com/item?id=38086222">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-testid="hero"><p>October 31, 2023<!-- --> /<!-- --> <!-- -->32 min read</p><p><span>Last Updated:<!-- --> <!-- -->October 31, 2023</span></p></div><div><p>I spent the past few months diving into the realm of Raymarching and studying some of its applications that may come in handy for future 3D projects, and while I managed to build a pretty diverse set of scenes, all of them consisted of rendering <em>surfaces or solid objects</em>. <a href="https://blog.maximeheckel.com/posts/painting-with-math-a-gentle-study-of-raymarching/">My blog post on Raymarching</a> covered some of the many impressive capabilities of this rendering technique, and as I mentioned at the end of that post, that was only the tip of the iceberg; there is <em>a lot more</em> we can do with it.</p>
<p>One fascinating aspect of Raymarching I quickly encountered in my study was its capacity to be tweaked to render <strong>volumes</strong>. Instead of stopping the raymarched loop once the ray hits a surface, we <em>push through</em> and continue the process to sample the <em>inside</em> of an object. That is where my obsession with volumetric clouds started, and I think the countless hours
I spent exploring the many Sky Islands in Zelda Tears of the Kingdom contributed a lot to my curiosity to learn more about how they work. I thus studied <a href="https://www.shadertoy.com/view/3dlfWs">a lot</a> <a href="https://www.shadertoy.com/view/3sffzj">of Shadertoy</a> <a href="https://www.shadertoy.com/view/tsScDG">scenes</a> leveraging many Volumetric Raymarching techniques to render smoke, clouds, and cloudscapes, which I obviously couldn't resist giving a try rebuilding myself:</p>

<p>I spent a great deal of time exploring the different ways I could use Raymarching to render clouds, from fully wrapping my head around <strong>the basics of Volumetric Raymarching</strong> to <strong>leveraging physically based properties of clouds</strong> to try getting a more realistic output while also trying to squeeze as much performance out of my scenes with neat <strong>performance improvement tips</strong> I learned along the way. I cover all of that in this article, which I hope can serve you as a field guide for your own volumetric rendering experiments and learnings.</p>


<section id="volumetric-rendering-raymarching-with-a-twist-section"><h2 id="volumetric-rendering-raymarching-with-a-twist">Volumetric rendering: Raymarching with a twist</h2><p>In my previous blog post on Raymarching, we saw that the technique relied on:</p><ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p><strong>Signed Distance Fields</strong>: functions that return the distance of a given point in space to the surface of an object</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p><strong>A Raymarching loop</strong> where we <strong>march step-by-step</strong> alongside rays cast <strong>from an origin point</strong> (a camera, the observer's eye) <strong>through each pixel of an output image</strong>, and we calculate the distance to the object's surface using our SDF. Once that distance is small enough, we can draw a pixel.</p></li>
</ul><p>If you've practiced this technique on some of your own scenes, you're in luck: Volumetric Raymarching relies on <em>the same principles</em>: there's a loop, rays cast from an origin, and SDFs. However, since we're rendering volumes instead of surfaces, there's a tiny twist to the technique 👀.</p><h3 id="how-to-sample-a-volume">How to sample a volume</h3><p>The first time we got introduced to the concept of SDF, we learned that it was important <em>not to step inside</em> the object during our Raymarching loop to have a beautiful render. I even emphasized that fact in one of my diagrams showcasing 3 points relative to an object:</p><ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p><code>P1</code> is located far from the surface, in green, representing a <em>positive</em> distance to the surface.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p><code>P2</code> is located at a close distance ε to the surface, in orange,</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p><code>P3</code> positioned <strong>inside</strong> the object, in red, representing a <strong>negative</strong> distance to the surface.</p></li>
</ul><div data-fullbleed="true"><figure><span><span></span><img alt="Diagram showcasing 3 points, P1, P2, and P3, being respectively, at a positive distance, small distance, and inside a sphere." sizes="100vw" srcset="https://res.cloudinary.com/dg5nsedzw/image/upload/blog/raymarching-points_s6aqzv.png 640w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/raymarching-points_s6aqzv.png 750w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/raymarching-points_s6aqzv.png 828w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/raymarching-points_s6aqzv.png 1080w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/raymarching-points_s6aqzv.png 1200w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/raymarching-points_s6aqzv.png 1920w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/raymarching-points_s6aqzv.png 2048w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/raymarching-points_s6aqzv.png 3840w" src="https://res.cloudinary.com/dg5nsedzw/image/upload/blog/raymarching-points_s6aqzv.png" decoding="async" data-nimg="responsive" loading="lazy" data-old-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"></span><figcaption>Diagram showcasing 3 points, P1, P2, and P3, being respectively, at a positive distance, small distance, and inside a sphere.</figcaption></figure></div><p>When sampling a volume, we'll need to actually <strong>raymarch inside our object</strong> and reframe how we think of SDF: instead of representing the distance to the surface, we will now use it as the <em>density</em> of our volume.</p><ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>When raymarching outside, the density is null, or <code>0</code>.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Once we raymarch inside, it is positive.</p></li>
</ul><p>To illustrate this new way of thinking about Raymarching in the context of volume, here's a modified version of the widget I introduced in my blog post on the topic earlier this year.</p><!--$--><div><p><span role="presentation">-0.5<!-- -->,<!-- -->0.5</span></p><p><span role="presentation">0.5<!-- -->,<!-- -->0.5</span></p><p><span role="presentation">-0.5<!-- -->,<!-- -->-0.5</span></p><p><span role="presentation">0.5<!-- -->,<!-- -->-0.5</span></p></div><!--/$--><p>That reframing of what an SDF represents ends up changing two core principles in our Raymarching technique that will have to be reflected in our code:</p><ol>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We have to march step-by-step with a <strong>constant step size</strong> along our rays. We no longer use the distance returned by the SDF.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Our SDF now returns the <strong>opposite</strong> of the distance to the surface to properly represent the density of our object (positive on the inside, <code>0</code> on the outside)</p></li>
</ol><div data-fullbleed="true"><figure><span><span></span><img alt="Diagram showcasing 3 points, P1, P2, and P3, being respectively, at a positive distance, small distance, and inside a sphere. Only P3 is considered 'valid' in the context of Volumetric Raymarching" sizes="100vw" srcset="https://res.cloudinary.com/dg5nsedzw/image/upload/blog/volumetric_raymarching_points 640w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/volumetric_raymarching_points 750w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/volumetric_raymarching_points 828w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/volumetric_raymarching_points 1080w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/volumetric_raymarching_points 1200w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/volumetric_raymarching_points 1920w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/volumetric_raymarching_points 2048w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/volumetric_raymarching_points 3840w" src="https://res.cloudinary.com/dg5nsedzw/image/upload/blog/volumetric_raymarching_points" decoding="async" data-nimg="responsive" loading="lazy" data-old-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"></span><figcaption>Diagram showcasing 3 points, P1, P2, and P3, being respectively, at a positive distance, small distance, and inside a sphere. Only P3 is considered 'valid' in the context of Volumetric Raymarching</figcaption></figure></div><h3 id="our-first-volumetric-raymarching-scene">Our first Volumetric Raymarching scene</h3><p>Now that we have a grasp of sampling volumes using what we know about Raymarching, we can try implementing it by modifying an existing scene. For brevity, I'm not detailing the setup of a basic of
Raymarching scenes. If you want a good starting point you can head to <a href="https://blog.maximeheckel.com/posts/painting-with-math-a-gentle-study-of-raymarching#our-first-raymarched-scene">my Raymarching setup</a> I already introduced in a previous article.</p><p>The setup of the scene is quite similar to what we're familiar with in classic Raymarching; the modifications we'll need to do are located in:</p><ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Our SDF functions: we'll need to return the opposite of the distance: <code>-d</code> instead of <code>d</code>.</p></li>
</ul><!--$--><div><div><p data-testid="codesnippet-title">Example of SDF used in Volumetric Raymarching</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">float</span><span data-testid="content-line"> </span><span data-testid="content-line">sdSphere</span><span data-testid="content-line">(</span><span data-testid="content-line">vec3</span><span data-testid="content-line"> p</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">float</span><span data-testid="content-line"> radius</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>2</p><p><span><span data-testid="content-line">    </span><span data-testid="content-line">return</span><span data-testid="content-line"> </span><span data-testid="content-line">length</span><span data-testid="content-line">(</span><span data-testid="content-line">p</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> radius</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>6</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> distance </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">sdSphere</span><span data-testid="content-line">(</span><span data-testid="content-line">p</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div></pre></div><!--/$--><ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Our <code>raymarch</code> function: we'll need to march at a <strong>constant step size</strong> and start drawing only once <strong>the density is over 0</strong>.</p></li>
</ul><!--$--><div><div><p data-testid="codesnippet-title">Volumetric Raymarching loop with constant step size</p></div><pre><div data-testid="highlight-line"><p>3</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">const</span><span data-testid="content-line"> </span><span data-testid="content-line">float</span><span data-testid="content-line"> MARCH_SIZE </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">0.08</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>7</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec3</span><span data-testid="content-line"> p </span><span data-testid="content-line">=</span><span data-testid="content-line"> rayOrigin </span><span data-testid="content-line">+</span><span data-testid="content-line"> depth </span><span data-testid="content-line">*</span><span data-testid="content-line"> rayDirection</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>11</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">for</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">int</span><span data-testid="content-line"> i </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">0</span><span data-testid="content-line">;</span><span data-testid="content-line"> i </span><span data-testid="content-line">&lt;</span><span data-testid="content-line"> MAX_STEPS</span><span data-testid="content-line">;</span><span data-testid="content-line"> i</span><span data-testid="content-line">++</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>12</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> density </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">scene</span><span data-testid="content-line">(</span><span data-testid="content-line">p</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>18</p><p><span><span data-testid="content-line">  p </span><span data-testid="content-line">=</span><span data-testid="content-line"> rayOrigin </span><span data-testid="content-line">+</span><span data-testid="content-line"> depth </span><span data-testid="content-line">*</span><span data-testid="content-line"> rayDirection</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div></pre></div><!--/$--><p>Now comes another question: <em>what shall we draw once our density is positive to represent a volume?</em>
For this first example, we can keep things simple and play with the <code>alpha</code> channel of our colors to make it proportional to the density of our volume: the denser our object gets as we march into it, the more opaque/darker it will be.</p><!--$--><div><div><p data-testid="codesnippet-title">Simple Volumetric Raymarching loop</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">const</span><span data-testid="content-line"> </span><span data-testid="content-line">float</span><span data-testid="content-line"> MARCH_SIZE </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">0.08</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>3</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec4</span><span data-testid="content-line"> </span><span data-testid="content-line">raymarch</span><span data-testid="content-line">(</span><span data-testid="content-line">vec3</span><span data-testid="content-line"> rayOrigin</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> rayDirection</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>5</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> p </span><span data-testid="content-line">=</span><span data-testid="content-line"> rayOrigin </span><span data-testid="content-line">+</span><span data-testid="content-line"> depth </span><span data-testid="content-line">*</span><span data-testid="content-line"> rayDirection</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>9</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">for</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">int</span><span data-testid="content-line"> i </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">0</span><span data-testid="content-line">;</span><span data-testid="content-line"> i </span><span data-testid="content-line">&lt;</span><span data-testid="content-line"> MAX_STEPS</span><span data-testid="content-line">;</span><span data-testid="content-line"> i</span><span data-testid="content-line">++</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>10</p><p><span><span data-testid="content-line">    </span><span data-testid="content-line">float</span><span data-testid="content-line"> density </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">scene</span><span data-testid="content-line">(</span><span data-testid="content-line">p</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>14</p><p><span><span data-testid="content-line">      </span><span data-testid="content-line">vec4</span><span data-testid="content-line"> color </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">vec4</span><span data-testid="content-line">(</span><span data-testid="content-line">mix</span><span data-testid="content-line">(</span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">1.0</span><span data-testid="content-line">,</span><span data-testid="content-line">1.0</span><span data-testid="content-line">,</span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">0.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">)</span><span data-testid="content-line">,</span><span data-testid="content-line"> density</span><span data-testid="content-line">)</span><span data-testid="content-line">,</span><span data-testid="content-line"> density </span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>16</p><p><span><span data-testid="content-line">      res </span><span data-testid="content-line">+=</span><span data-testid="content-line"> color </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">1.0</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> res</span><span data-testid="content-line">.</span><span data-testid="content-line">a</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>20</p><p><span><span data-testid="content-line">    p </span><span data-testid="content-line">=</span><span data-testid="content-line"> rayOrigin </span><span data-testid="content-line">+</span><span data-testid="content-line"> depth </span><span data-testid="content-line">*</span><span data-testid="content-line"> rayDirection</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div></pre></div><!--/$--><p>If we try to render this code in our React Three Fiber canvas, we should get the following result 👀</p><!--$--><!--/$--></section>
<section id="drawing-fluffy-raymarched-clouds-section"><h2 id="drawing-fluffy-raymarched-clouds">Drawing Fluffy Raymarched Clouds</h2><p>We now know and applied the basics of Volumetric Raymarching. So far, we only rendered a simple volumetric sphere with constant density as we march through the volume, which is a good start. We can now try using that simple scene as a foundation to render something more interesting: <strong>clouds!</strong></p><h3 id="noisy-volume">Noisy Volume</h3><p>Going from our simple SDF of a sphere to a cloud consists of drawing it with <em>a bit more noise</em>. Clouds don't have a uniform shape nor do they have a uniform density, thus we need to introduce some organic randomness through noise in our Raymarching loop. If you read <a href="https://blog.maximeheckel.com/posts/the-study-of-shaders-with-react-three-fiber/">some of</a> <a href="https://blog.maximeheckel.com/posts/painting-with-math-a-gentle-study-of-raymarching/">my previous articles</a>, you should already be familiar with the concept of:</p><ol>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Noise, Perlin noise, and value noise derivative</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Fractal Brownian Motion, or FBM.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Texture based noise.</p></li>
</ol><p>To generate raymarched landscapes, we used a noise texture, noise derivatives, and FBM to get a detailed organic result. We'll rely on some of those concepts to create organic randomness and obtain a cloud from our SDF ☁️.</p><!--$--><div><div><p data-testid="codesnippet-title">Noise function for Raymarched landscape</p></div><pre><div data-testid="line"><p>4</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> u </span><span data-testid="content-line">=</span><span data-testid="content-line"> f </span><span data-testid="content-line">*</span><span data-testid="content-line"> f </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">3.</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">2.</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> f</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>6</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> a </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">textureLod</span><span data-testid="content-line">(</span><span data-testid="content-line">uTexture</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">p </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">.0</span><span data-testid="content-line">,</span><span data-testid="content-line">.0</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">/</span><span data-testid="content-line"> </span><span data-testid="content-line">256.</span><span data-testid="content-line">,</span><span data-testid="content-line">0.</span><span data-testid="content-line">)</span><span data-testid="content-line">.</span><span data-testid="content-line">x</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>7</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> b </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">textureLod</span><span data-testid="content-line">(</span><span data-testid="content-line">uTexture</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">p </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">1.0</span><span data-testid="content-line">,</span><span data-testid="content-line">.0</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">/</span><span data-testid="content-line"> </span><span data-testid="content-line">256.</span><span data-testid="content-line">,</span><span data-testid="content-line">0.</span><span data-testid="content-line">)</span><span data-testid="content-line">.</span><span data-testid="content-line">x</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>8</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> c </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">textureLod</span><span data-testid="content-line">(</span><span data-testid="content-line">uTexture</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">p </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">.0</span><span data-testid="content-line">,</span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">/</span><span data-testid="content-line"> </span><span data-testid="content-line">256.</span><span data-testid="content-line">,</span><span data-testid="content-line">0.</span><span data-testid="content-line">)</span><span data-testid="content-line">.</span><span data-testid="content-line">x</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>9</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> d </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">textureLod</span><span data-testid="content-line">(</span><span data-testid="content-line">uTexture</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">p </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">1.0</span><span data-testid="content-line">,</span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">/</span><span data-testid="content-line"> </span><span data-testid="content-line">256.</span><span data-testid="content-line">,</span><span data-testid="content-line">0.</span><span data-testid="content-line">)</span><span data-testid="content-line">.</span><span data-testid="content-line">x</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>11</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> noiseValue </span><span data-testid="content-line">=</span><span data-testid="content-line"> a </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">b</span><span data-testid="content-line">-</span><span data-testid="content-line">a</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> u</span><span data-testid="content-line">.</span><span data-testid="content-line">x </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">c</span><span data-testid="content-line">-</span><span data-testid="content-line">a</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> u</span><span data-testid="content-line">.</span><span data-testid="content-line">y </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">a </span><span data-testid="content-line">-</span><span data-testid="content-line"> b </span><span data-testid="content-line">-</span><span data-testid="content-line"> c </span><span data-testid="content-line">+</span><span data-testid="content-line"> d</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> u</span><span data-testid="content-line">.</span><span data-testid="content-line">x </span><span data-testid="content-line">*</span><span data-testid="content-line"> u</span><span data-testid="content-line">.</span><span data-testid="content-line">y</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>12</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> noiseDerivative </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">6.</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> f </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">1.</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> f</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">b </span><span data-testid="content-line">-</span><span data-testid="content-line"> a</span><span data-testid="content-line">,</span><span data-testid="content-line"> c </span><span data-testid="content-line">-</span><span data-testid="content-line"> a</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">a </span><span data-testid="content-line">-</span><span data-testid="content-line"> b </span><span data-testid="content-line">-</span><span data-testid="content-line"> c </span><span data-testid="content-line">+</span><span data-testid="content-line"> d</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> u</span><span data-testid="content-line">.</span><span data-testid="content-line">yx</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>14</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">return</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">noiseValue</span><span data-testid="content-line">,</span><span data-testid="content-line"> noiseDerivative</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div></pre></div><!--/$--><p>For clouds, our <code>noise</code> function looks a bit different:</p><!--$--><div><div><p data-testid="codesnippet-title">Noise function for Volumetric clouds</p></div><pre><div data-testid="line"><p>4</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> u </span><span data-testid="content-line">=</span><span data-testid="content-line"> f </span><span data-testid="content-line">*</span><span data-testid="content-line"> f </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">3.</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">2.</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> f</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>6</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> uv </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">p</span><span data-testid="content-line">.</span><span data-testid="content-line">xy </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">37.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">239.0</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> p</span><span data-testid="content-line">.</span><span data-testid="content-line">z</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"> u</span><span data-testid="content-line">.</span><span data-testid="content-line">xy</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>7</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> tex </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">textureLod</span><span data-testid="content-line">(</span><span data-testid="content-line">uNoise</span><span data-testid="content-line">,</span><span data-testid="content-line">(</span><span data-testid="content-line">uv </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">0.5</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">/</span><span data-testid="content-line"> </span><span data-testid="content-line">256.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">)</span><span data-testid="content-line">.</span><span data-testid="content-line">yx</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>9</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">return</span><span data-testid="content-line"> </span><span data-testid="content-line">mix</span><span data-testid="content-line">(</span><span data-testid="content-line"> tex</span><span data-testid="content-line">.</span><span data-testid="content-line">x</span><span data-testid="content-line">,</span><span data-testid="content-line"> tex</span><span data-testid="content-line">.</span><span data-testid="content-line">y</span><span data-testid="content-line">,</span><span data-testid="content-line"> u</span><span data-testid="content-line">.</span><span data-testid="content-line">z </span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">2.0</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div></pre></div><!--/$--><p>To tell you the truth, I saw this function in many <a href="https://www.shadertoy.com/view/WdXGRj">Shadertoy demos</a> without necessarily seeing a credited author or even a link to an explanation; I kept using it throughout my work as it still yielded a convincing cloud noise pattern. Here's an attempt at gathering together some of its specificities from my own understanding:</p><ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Clouds are 3D structures, so our function takes in a <code>vec3</code> as input: a point in space within our cloud.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>The texture lookup differs from its landscape counterpart: we're sampling it as a 2D slice from a 3D position. The <code>vec2(37.0, 239.0) * p.z</code> seems a bit arbitrary to me, but from what I gathered, it allows for more variation in the resulting noise.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We then mix two noise values from our texture lookup based on the <code>z</code> value to generate a smooth noise pattern and rescale it within the <code>[-1, 1]</code> range.</p></li>
</ul><p>Applying this noise along with a Fractal Brownian motion is pretty similar to what we're used to with Raymarched landscapes:</p><!--$--><div><div><p data-testid="codesnippet-title">Fractal Brownian Motion applied to our Volumetric Raymarching scene</p></div><pre><div data-testid="line"><p>2</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> q </span><span data-testid="content-line">=</span><span data-testid="content-line"> p </span><span data-testid="content-line">+</span><span data-testid="content-line"> uTime </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">0.5</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">1.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line">0.2</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>9</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">for</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">int</span><span data-testid="content-line"> i </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">0</span><span data-testid="content-line">;</span><span data-testid="content-line"> i </span><span data-testid="content-line">&lt;</span><span data-testid="content-line"> </span><span data-testid="content-line">6</span><span data-testid="content-line">;</span><span data-testid="content-line"> i</span><span data-testid="content-line">++</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>10</p><p><span><span data-testid="content-line">      f </span><span data-testid="content-line">+=</span><span data-testid="content-line"> scale </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">noise</span><span data-testid="content-line">(</span><span data-testid="content-line">q</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>20</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> distance </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">sdSphere</span><span data-testid="content-line">(</span><span data-testid="content-line">p</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div></pre></div><!--/$--><p>If we apply the code above to our previous demo, we do get something that starts to look like a cloud 👀:</p><!--$--><!--/$--><h3 id="adding-light">Adding light</h3><p>Once again, we're just "starting" to see something approaching our goal, but a crucial element is missing to make our cloud feel more <em>cloudy</em>: <strong>light</strong>.</p><p>The demo we just saw in the previous part lacks depth and shadows and thus doesn't feel very realistic overall, and that's due to the lack of diffuse light.</p><p>To add light to our cloud and consequentially obtain better shadows, one may want to apply the same lighting we used in standard Raymarching scenes:</p><ol>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Calculate the normal of each sample point using our <code>scene</code> function</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Use the dot product of the normal and the light direction</p></li>
</ol><!--$--><div><div><p data-testid="codesnippet-title">Diffuse lighting in Raymarched scene using normals</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">vec3</span><span data-testid="content-line"> </span><span data-testid="content-line">getNormal</span><span data-testid="content-line">(</span><span data-testid="content-line">vec3</span><span data-testid="content-line"> p</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>4</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> n </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">scene</span><span data-testid="content-line">(</span><span data-testid="content-line">p</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>15</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> ro </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">0.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">5.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>16</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> rd </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">normalize</span><span data-testid="content-line">(</span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">uv</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>17</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> lightPosition </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>19</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> d </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">raymarch</span><span data-testid="content-line">(</span><span data-testid="content-line">ro</span><span data-testid="content-line">,</span><span data-testid="content-line"> rd</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>23</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> color </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">0.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>26</p><p><span><span data-testid="content-line">    </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> normal </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">getNormal</span><span data-testid="content-line">(</span><span data-testid="content-line">p</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>27</p><p><span><span data-testid="content-line">    </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> lightDirection </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">normalize</span><span data-testid="content-line">(</span><span data-testid="content-line">lightPosition </span><span data-testid="content-line">-</span><span data-testid="content-line"> p</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>29</p><p><span><span data-testid="content-line">    </span><span data-testid="content-line">float</span><span data-testid="content-line"> diffuse </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">max</span><span data-testid="content-line">(</span><span data-testid="content-line">dot</span><span data-testid="content-line">(</span><span data-testid="content-line">normal</span><span data-testid="content-line">,</span><span data-testid="content-line"> lightDirection</span><span data-testid="content-line">)</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>30</p><p><span><span data-testid="content-line">    color </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">1.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> diffuse</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>33</p><p><span><span data-testid="content-line">  gl_FragColor </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">vec4</span><span data-testid="content-line">(</span><span data-testid="content-line">color</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div></pre></div><!--/$--><p>That would work in theory, but it's not the optimal choice for Volumetric Raymarching:</p><ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>The <code>getNormal</code> function requires a lot of sample points to estimate the "gradient" in every direction. In the code above, we need 4, but there are code snippets that require 6 for a more accurate result.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Our volumetric raymarching loop is more resource-intensive: we're walking at a constant step size along our ray to sample the density of our volume.</p></li>
</ul><p>Thus, we need another method or approximation for our diffuse light. Luckily, Inigo Quilez presents a technique to solve this problem in <a href="https://iquilezles.org/articles/derivative/">his article on directional derivatives</a>. Instead of having to sample our density in every direction like <code>getNormal</code>, this method simplifies the problem by sampling the density at our sampling point <code>p</code> and at an offset <strong>in the direction of the light</strong> and getting the difference between those values to approximate how the light scatters roughly inside our volume.</p><figure><span><span></span><img alt="Diagram showcasing 2 sampled points P1 and P2 with both their diffuse lighting calculated by sampling extra points P1' and P2' in the direction of the light" sizes="100vw" srcset="https://res.cloudinary.com/dg5nsedzw/image/upload/blog/directional_derivatives 640w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/directional_derivatives 750w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/directional_derivatives 828w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/directional_derivatives 1080w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/directional_derivatives 1200w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/directional_derivatives 1920w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/directional_derivatives 2048w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/directional_derivatives 3840w" src="https://res.cloudinary.com/dg5nsedzw/image/upload/blog/directional_derivatives" decoding="async" data-nimg="responsive" loading="lazy" data-old-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"></span><figcaption>Diagram showcasing 2 sampled points P1 and P2 with both their diffuse lighting calculated by sampling extra points P1' and P2' in the direction of the light</figcaption></figure><p>In the diagram above, you can see that we're sampling our density at <code>p1</code> and at another point <code>p1'</code> that's a bit further along the light ray:</p><ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>If the density increases along that path, that means the volume gets denser, and light will scatter more</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>If the density gets smaller, our cloud is less thick, and thus, the light will scatter less.</p></li>
</ul><p>This method only requires 2 sampling points and consequentially requires fewer resources to give us a good approximation of how the light behaves with the volume <em>around</em> <code>p1</code>.</p><p>We can apply this diffuse formula to our demo as follows:</p><!--$--><div><div><p data-testid="codesnippet-title">Diffuse lighting using directional derivatives</p></div><pre><div data-testid="highlight-line"><p>5</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> diffuse </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">clamp</span><span data-testid="content-line">(</span><span data-testid="content-line">(</span><span data-testid="content-line">scene</span><span data-testid="content-line">(</span><span data-testid="content-line">p</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">scene</span><span data-testid="content-line">(</span><span data-testid="content-line">p </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">0.3</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> sunDirection</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">/</span><span data-testid="content-line"> </span><span data-testid="content-line">0.3</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line"> </span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>7</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> lin </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">0.60</span><span data-testid="content-line">,</span><span data-testid="content-line">0.60</span><span data-testid="content-line">,</span><span data-testid="content-line">0.75</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">1.1</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">0.8</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">1.0</span><span data-testid="content-line">,</span><span data-testid="content-line">0.6</span><span data-testid="content-line">,</span><span data-testid="content-line">0.3</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> diffuse</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>8</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec4</span><span data-testid="content-line"> color </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">vec4</span><span data-testid="content-line">(</span><span data-testid="content-line">mix</span><span data-testid="content-line">(</span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">1.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">0.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">)</span><span data-testid="content-line">,</span><span data-testid="content-line"> density</span><span data-testid="content-line">)</span><span data-testid="content-line">,</span><span data-testid="content-line"> density </span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>12</p><p><span><span data-testid="content-line">  res </span><span data-testid="content-line">+=</span><span data-testid="content-line"> color </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">1.0</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> res</span><span data-testid="content-line">.</span><span data-testid="content-line">a</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div></pre></div><!--/$--><p>That is, once again, very similar to what we were doing in standard Raymarching, except that now, we have to include it <em>inside the Raymarching loop</em> as we're sampling a volume and thus have to run the calculation multiple times throughout the volume as the density may vary whereas a surface required only one diffuse lighting computation (at the surface).</p><p>You can observe the difference between our cloud without lighting and with diffuse lighting below 👇</p><figure><div tabindex="0" role="slider" aria-label="Before/After comparison of our Volumetric cloud without and with diffuse lighting." aria-valuemin="0" aria-valuemax="100" aria-valuenow="40"><p><img alt="Before" loading="eager" src="https://res.cloudinary.com/dg5nsedzw/image/upload/v1698192589/blog/diffuse-before.png" width="700" height="511"></p><p><img alt="After" loading="eager" src="https://res.cloudinary.com/dg5nsedzw/image/upload/v1698192589/blog/diffuse-after.png" width="700" height="511"></p><div id="slider-line"><p><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img" style="transform:rotate(180deg)"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></p></div></div><figcaption>Before/After comparison of our Volumetric cloud without and with diffuse lighting.</figcaption></figure><p>And here's the demo featuring the concept and code we just introduced 👀:</p><!--$--><!--/$--><h3 id="morphing-clouds">Morphing clouds</h3><p>Let's take a little break to tweak our scene and have some fun with what we built so far! Despite the differences between the standard Raymarching and its volumetric counterpart, there are still a lot of SDF-related concepts you can apply when building cloudscapes.</p><p>You can try to make a cloud in fun shapes like a cross or a torus, or even better, try to make it morph from one form to another over time:</p><!--$--><div><div><p data-testid="codesnippet-title">Mixing SDF to morph volumetric clouds into different shapes</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">mat2</span><span data-testid="content-line"> </span><span data-testid="content-line">rotate2D</span><span data-testid="content-line">(</span><span data-testid="content-line">float</span><span data-testid="content-line"> a</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>4</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">return</span><span data-testid="content-line"> </span><span data-testid="content-line">mat2</span><span data-testid="content-line">(</span><span data-testid="content-line">c</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line">s</span><span data-testid="content-line">,</span><span data-testid="content-line"> s</span><span data-testid="content-line">,</span><span data-testid="content-line"> c</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>7</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> </span><span data-testid="content-line">nextStep</span><span data-testid="content-line">(</span><span data-testid="content-line">float</span><span data-testid="content-line"> t</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">float</span><span data-testid="content-line"> len</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">float</span><span data-testid="content-line"> smo</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>8</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> tt </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">mod</span><span data-testid="content-line">(</span><span data-testid="content-line">t </span><span data-testid="content-line">+=</span><span data-testid="content-line"> smo</span><span data-testid="content-line">,</span><span data-testid="content-line"> len</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>9</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> stp </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">t </span><span data-testid="content-line">/</span><span data-testid="content-line"> len</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>10</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">return</span><span data-testid="content-line"> </span><span data-testid="content-line">smoothstep</span><span data-testid="content-line">(</span><span data-testid="content-line">0.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> smo</span><span data-testid="content-line">,</span><span data-testid="content-line"> tt</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"> stp</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>15</p><p><span><span data-testid="content-line">  p1</span><span data-testid="content-line">.</span><span data-testid="content-line">xz </span><span data-testid="content-line">*=</span><span data-testid="content-line"> </span><span data-testid="content-line">rotate2D</span><span data-testid="content-line">(</span><span data-testid="content-line">-</span><span data-testid="content-line">PI </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">0.1</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>16</p><p><span><span data-testid="content-line">  p1</span><span data-testid="content-line">.</span><span data-testid="content-line">yz </span><span data-testid="content-line">*=</span><span data-testid="content-line"> </span><span data-testid="content-line">rotate2D</span><span data-testid="content-line">(</span><span data-testid="content-line">PI </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">0.3</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>18</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> s1 </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">sdTorus</span><span data-testid="content-line">(</span><span data-testid="content-line">p1</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">1.3</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.9</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>19</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> s2 </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">sdCross</span><span data-testid="content-line">(</span><span data-testid="content-line">p1 </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">2.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.6</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>20</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> s3 </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">sdSphere</span><span data-testid="content-line">(</span><span data-testid="content-line">p</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.5</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>21</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> s4 </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">sdCapsule</span><span data-testid="content-line">(</span><span data-testid="content-line">p</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">-</span><span data-testid="content-line">2.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line">1.5</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">)</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">2.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.5</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">)</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>23</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> t </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">mod</span><span data-testid="content-line">(</span><span data-testid="content-line">nextStep</span><span data-testid="content-line">(</span><span data-testid="content-line">uTime</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">3.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.2</span><span data-testid="content-line">)</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">4.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>25</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> distance </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">mix</span><span data-testid="content-line">(</span><span data-testid="content-line">s1</span><span data-testid="content-line">,</span><span data-testid="content-line"> s2</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">clamp</span><span data-testid="content-line">(</span><span data-testid="content-line">t</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>26</p><p><span><span data-testid="content-line">  distance </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">mix</span><span data-testid="content-line">(</span><span data-testid="content-line">distance</span><span data-testid="content-line">,</span><span data-testid="content-line"> s3</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">clamp</span><span data-testid="content-line">(</span><span data-testid="content-line">t </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>27</p><p><span><span data-testid="content-line">  distance </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">mix</span><span data-testid="content-line">(</span><span data-testid="content-line">distance</span><span data-testid="content-line">,</span><span data-testid="content-line"> s4</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">clamp</span><span data-testid="content-line">(</span><span data-testid="content-line">t </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">2.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>28</p><p><span><span data-testid="content-line">  distance </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">mix</span><span data-testid="content-line">(</span><span data-testid="content-line">distance</span><span data-testid="content-line">,</span><span data-testid="content-line"> s1</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">clamp</span><span data-testid="content-line">(</span><span data-testid="content-line">t </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">3.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div></pre></div><!--/$--><!--$--><!--/$--><p>This demo is a reproduction of <a href="https://www.shadertoy.com/view/mljyzw">this volumetric rendering related Shadertoy scene</a>. I really like this creation because the result is very organic, and it gives the impression that the cloud is <em>rolling</em> into its next shape naturally.</p><p>You can also try to render:</p><ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Clouds merging together using the <code>min</code> and <code>smoothmin</code> of two SDFs</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Repeating clouds through space using the <code>mod</code> function</p></li>
</ul><p>There are a lot of creative compositions to try!</p></section>
<section id="performance-optimization-section"><h2 id="performance-optimization">Performance optimization</h2><p>You may notice that running the scenes we built so far may make your computer sound like a jet engine at high resolution or at least not look as smooth as they could. Luckily, we can do something about it and use some <strong>performance optimization techniques to strike the right balance between FPS count and output quality</strong>.</p><h3 id="blue-noise-dithering">Blue noise dithering</h3><p>One of the main performance pitfalls of our current raymarched cloudscape scene is due to:</p><ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>the number of steps we have to perform to sample our volume and the small <code>marchSize</code></p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>some heavy computation we have to do within our loop, like our directional derivative or FBM.</p></li>
</ul><p>This issue will only worsen as we attempt to make more computations to achieve a more physically accurate output in the next part of this article.</p><p>One of the first things we could do to make this scene more efficient would be to <em>reduce the amount of steps</em> we perform when sampling our cloud and <em>increase the step size</em>. However, if we attempt this on some of our previous examples (I invite you to try), some <em>layering</em> will be visible, and our volume will look more like some kind of milk soup than a fluffy cloud.</p><figure><span><span></span><img alt="Screenshot of our rendered Volumetric cloud with a low max step count and higher step size. Notice how those optimizations have degraded the output quality." sizes="100vw" srcset="https://res.cloudinary.com/dg5nsedzw/image/upload/blog/lowstep_cloud 640w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/lowstep_cloud 750w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/lowstep_cloud 828w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/lowstep_cloud 1080w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/lowstep_cloud 1200w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/lowstep_cloud 1920w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/lowstep_cloud 2048w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/lowstep_cloud 3840w" src="https://res.cloudinary.com/dg5nsedzw/image/upload/blog/lowstep_cloud" decoding="async" data-nimg="responsive" loading="lazy" data-old-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"></span><figcaption>Screenshot of our rendered Volumetric cloud with a low max step count and higher step size. Notice how those optimizations have degraded the output quality.</figcaption></figure><p>You might have encountered the concept of dithering or some images using dithering styles before.
This process can create the illusion of more colors or shades in an image than available or purely used for artistic ends.
I recommend reading <a href="http://alex-charlton.com/posts/Dithering_on_the_GPU/">Dithering on the GPU</a> from Alex Charlton if you
want a quick introduction.</p><p>In <a href="https://blog.demofox.org/2020/05/10/ray-marching-fog-with-blue-noise/">Ray marching fog with blue noise</a>, the author showcases how you can leverage blue noise dithering in your raymarched scene to erase the <em>banding</em> or <em>layering</em> effect due to a lower step count or less granular loop.
This technique leverages a blue noise pattern, which has fewer patterns or clumps than other noises and is less visible to the human eye, to obtain a random number each time our fragment shader runs. We then introduce that number as an <em>offset</em> at the beginning of the raymarched loop, moving our sampling start point along our ray for each pixel of our output.</p><figure><span><span></span><img alt="Blue noise texture" sizes="100vw" srcset="https://res.cloudinary.com/dg5nsedzw/image/upload/blue-noise 640w, https://res.cloudinary.com/dg5nsedzw/image/upload/blue-noise 750w, https://res.cloudinary.com/dg5nsedzw/image/upload/blue-noise 828w, https://res.cloudinary.com/dg5nsedzw/image/upload/blue-noise 1080w, https://res.cloudinary.com/dg5nsedzw/image/upload/blue-noise 1200w, https://res.cloudinary.com/dg5nsedzw/image/upload/blue-noise 1920w, https://res.cloudinary.com/dg5nsedzw/image/upload/blue-noise 2048w, https://res.cloudinary.com/dg5nsedzw/image/upload/blue-noise 3840w" src="https://res.cloudinary.com/dg5nsedzw/image/upload/blue-noise" decoding="async" data-nimg="responsive" loading="lazy" data-old-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"></span><figcaption>Blue noise texture</figcaption></figure><figure><span><span></span><img alt="Diagram showcasing the difference between our cloud being sampled without and with blue noise dithering. Notice how each ray is offset when blue noise is introduced and how that 'erases' any obvious layering in the final render." sizes="100vw" srcset="https://res.cloudinary.com/dg5nsedzw/image/upload/blog/blue_noise_dithering 640w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/blue_noise_dithering 750w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/blue_noise_dithering 828w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/blue_noise_dithering 1080w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/blue_noise_dithering 1200w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/blue_noise_dithering 1920w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/blue_noise_dithering 2048w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/blue_noise_dithering 3840w" src="https://res.cloudinary.com/dg5nsedzw/image/upload/blog/blue_noise_dithering" decoding="async" data-nimg="responsive" loading="lazy" data-old-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"></span><figcaption>Diagram showcasing the difference between our cloud being sampled without and with blue noise dithering. Notice how each ray is offset when blue noise is introduced and how that 'erases' any obvious layering in the final render.</figcaption></figure><!--$--><div><div><p data-testid="codesnippet-title">Blue noise dithering introducing an offset in our Raymarching loop</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">uniform</span><span data-testid="content-line"> </span><span data-testid="content-line">sampler2D</span><span data-testid="content-line"> uBlueNoise</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>5</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec4</span><span data-testid="content-line"> </span><span data-testid="content-line">raymarch</span><span data-testid="content-line">(</span><span data-testid="content-line">vec3</span><span data-testid="content-line"> rayOrigin</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> rayDirection</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">float</span><span data-testid="content-line"> offset</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>7</p><p><span><span data-testid="content-line">  depth </span><span data-testid="content-line">+=</span><span data-testid="content-line"> MARCH_SIZE </span><span data-testid="content-line">*</span><span data-testid="content-line"> offset</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>8</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> p </span><span data-testid="content-line">=</span><span data-testid="content-line"> rayOrigin </span><span data-testid="content-line">+</span><span data-testid="content-line"> depth </span><span data-testid="content-line">*</span><span data-testid="content-line"> rayDirection</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>14</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> blueNoise </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">texture2D</span><span data-testid="content-line">(</span><span data-testid="content-line">uBlueNoise</span><span data-testid="content-line">,</span><span data-testid="content-line"> gl_FragCoord</span><span data-testid="content-line">.</span><span data-testid="content-line">xy </span><span data-testid="content-line">/</span><span data-testid="content-line"> </span><span data-testid="content-line">1024.0</span><span data-testid="content-line">)</span><span data-testid="content-line">.</span><span data-testid="content-line">r</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>15</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> offset </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">fract</span><span data-testid="content-line">(</span><span data-testid="content-line">blueNoise</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>17</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec4</span><span data-testid="content-line"> res </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">raymarch</span><span data-testid="content-line">(</span><span data-testid="content-line">ro</span><span data-testid="content-line">,</span><span data-testid="content-line"> rd</span><span data-testid="content-line">,</span><span data-testid="content-line"> offset</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div></pre></div><!--/$--><p>By introducing some <strong>blue noise dithering</strong> in our fragment shader, we can erase those artifacts and get a high-quality output while maintaining the Raymarching step count low!</p><p>However, under some circumstances, the dithering pattern can be pretty noticeable. By looking at some other <a href="https://www.shadertoy.com/view/WsfBDf">Shadertoy examples</a>, I discovered that introducing a <em>temporal</em> aspect to the blue noise can attenuate this issue.</p><!--$--><div><div><p data-testid="codesnippet-title">Temporal blue noise dithering offset</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">float</span><span data-testid="content-line"> offset </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">fract</span><span data-testid="content-line">(</span><span data-testid="content-line">blueNoise </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">float</span><span data-testid="content-line">(</span><span data-testid="content-line">uFrame</span><span data-testid="content-line">%</span><span data-testid="content-line">32</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">/</span><span data-testid="content-line"> </span><span data-testid="content-line">sqrt</span><span data-testid="content-line">(</span><span data-testid="content-line">0.5</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span></span></p></div></pre></div><!--/$--><p>Here's a before/after comparison of our single frame of our raymarched cloud. I guess the results speak for themselves here 😄.</p><figure><div tabindex="0" role="slider" aria-label="Before/After comparison of our Volumetric cloud with fewer Raymarching steps and without and with Blue Noise dithering." aria-valuemin="0" aria-valuemax="100" aria-valuenow="40"><p><img alt="Before" loading="eager" src="https://res.cloudinary.com/dg5nsedzw/image/upload/v1698193254/blog/blue-noise-dithering-before.png" width="700" height="511"></p><p><img alt="After" loading="eager" src="https://res.cloudinary.com/dg5nsedzw/image/upload/v1698193254/blog/blue-noise-dithering-after.png" width="700" height="511"></p><div id="slider-line"><p><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img" style="transform:rotate(180deg)"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></p></div></div><figcaption>Before/After comparison of our Volumetric cloud with fewer Raymarching steps and without and with Blue Noise dithering.</figcaption></figure><p>And here's the demo showcasing our blue noise dithering in action giving us a softer cloud ⛅:</p><!--$--><!--/$--><h3 id="upscaling-with-bicubic-filtering">Upscaling with Bicubic filtering</h3><p>This second improvement recommended by <a href="https://twitter.com/N8Programs">@N8Programs</a> aims to fix some remaining noise artifacts that remain following the introduction of the blue noise dithering to our raymarched scene.</p><p><strong>Bicubic filtering</strong> is used in upscaling and allows smoothing out some noise patterns while retaining details by calculating the value of a new pixel by considering 16 neighboring pixels through a cubic polynomial (<a href="https://en.wikipedia.org/wiki/Bicubic_interpolation">Sources</a>).</p><p>I was lucky to find <a href="https://www.shadertoy.com/view/Dl2SDW">an implementation of bicubic filtering on Shadertoy</a> made by N8Programs himself! Applying it directly to our existing work however, is not that straightforward. We have to add this improvement as its own step or pass in the rendering process, almost as a post-processing effect.</p><p>I introduced an easy way to build this kind of pipeline in my article titled <a href="https://blog.maximeheckel.com/posts/beautiful-and-mind-bending-effects-with-webgl-render-targets#an-alternative-to-effectcomposer-for-post-processing-effects">Beautiful and mind-bending effects with WebGL Render Targets</a> where I showcase how you can use Frame Buffer Objects (FBO) to apply some post-processing effects on an entire scene which we can use for this use case:</p><ol>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We render our main raymarched canvas in a <strong>portal</strong>.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>The default scene only contains a <strong>fullscreen triangle</strong>.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We render our main scene in a render target.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We pass <strong>the texture of the main scene's render target as a uniform</strong> of our bicubic filtering material.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We use the bicubic filtering material as the material for our fullscreen triangle.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Our bicubic filtering will take our noisy raymarched scene as a texture uniform and output the smoothed out scene.</p></li>
</ol><div data-fullbleed="true"><figure><span><span></span><img alt="Diagram showcasing how the bicubic filtering is applied as a post-processing effect to the original scene using Render Targets." sizes="100vw" srcset="https://res.cloudinary.com/dg5nsedzw/image/upload/blog/bicubic_filtering 640w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/bicubic_filtering 750w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/bicubic_filtering 828w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/bicubic_filtering 1080w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/bicubic_filtering 1200w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/bicubic_filtering 1920w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/bicubic_filtering 2048w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/bicubic_filtering 3840w" src="https://res.cloudinary.com/dg5nsedzw/image/upload/blog/bicubic_filtering" decoding="async" data-nimg="responsive" loading="lazy" data-old-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"></span><figcaption>Diagram showcasing how the bicubic filtering is applied as a post-processing effect to the original scene using Render Targets.</figcaption></figure></div><p>Here's a quick comparison of our scene before and after applying the bicubic
filtering:</p><figure><div tabindex="0" role="slider" aria-label="Before/After comparison of our Volumetric cloud with without and with Bicubic Filtering. Notice the noise around at the edges and less dense region of the cloud being smoothed out when the effect is applied." aria-valuemin="0" aria-valuemax="100" aria-valuenow="40"><p><img alt="Before" loading="eager" src="https://res.cloudinary.com/dg5nsedzw/image/upload/v1698193254/blog/bicubic-before.png" width="700" height="555"></p><p><img alt="After" loading="eager" src="https://res.cloudinary.com/dg5nsedzw/image/upload/v1698193254/blog/bicubic-after.png" width="700" height="555"></p><div id="slider-line"><p><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img" style="transform:rotate(180deg)"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></p></div></div><figcaption>Before/After comparison of our Volumetric cloud with without and with Bicubic Filtering. Notice the noise around at the edges and less dense region of the cloud being smoothed out when the effect is applied.</figcaption></figure><p>The full implementation is a bit long, and features concepts I already went through in my render target focused blog post, so I invite you to look at it on your own time in the demo below:</p><!--$--><!--/$--><p>Leveraging render targets allowed me to play more with the resolution of the original raymarched scene. You can see a little selector that lets you pick at which resolution we render our raymarched cloud. You can notice that there are not a lot of differences between <code>1x</code> and <code>0.5x</code> which is great: <strong>we can squeeze more FPS without sacrificing the output quality 🎉</strong>.</p></section>
<section id="physically-accurate-clouds-section"><h2 id="physically-accurate-clouds">Physically accurate Clouds</h2><p>So far, we've managed to build really <em>beautiful cloudscapes</em> with Volumetric Raymarching using some simple techniques and mixing the right colors. The resulting scenes are satisfying enough and give the illusion of large, dense clouds, but what if we wanted a more <em>realistic</em> output?</p><p>I spent quite some time digging through talks, videos, and articles on how game engines solve the problem of physically accurate clouds and all the techniques involved in them. It's been a journey, and I wanted to dedicate this last section to this topic because I find the subject fascinating: from a couple of physical principles of actual real-life clouds, we can render clouds in WebGL using Volumetric Raymarching!</p><h3 id="beers-law">Beer's Law</h3><p>I already introduced the concept of <a href="https://en.wikipedia.org/wiki/Beer%E2%80%93Lambert_law">Beer's Law</a> in my <a href="https://blog.maximeheckel.com/posts/painting-with-math-a-gentle-study-of-raymarching#sky-fog-and-martian-landscape">Raymarching blog post</a> as a way to render fog in the distance of a scene. It states that the intensity of light passing through a transparent medium is exponentially related to the distance it travels. <strong>The further to the medium light propagates, the more it is being absorbed</strong>. The formula for Beer's Law is as follows:</p><p><code>I = I0​ * exp(−α * d)</code>, where <code>α</code> is the absorption or attenuation coefficient describing how "thick" or "dense" the medium is. In our demos, we'll consider an absorption coefficient of <code>0.9</code>, although I'd invite you to try different values so you can see the impact of this number on the resulting render.</p><figure><span><span></span><img alt="Diagram showcasing how Beer's Law can be used to represent how much light gets absorbed through a volume" sizes="100vw" srcset="https://res.cloudinary.com/dg5nsedzw/image/upload/blog/beers_law 640w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/beers_law 750w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/beers_law 828w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/beers_law 1080w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/beers_law 1200w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/beers_law 1920w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/beers_law 2048w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/beers_law 3840w" src="https://res.cloudinary.com/dg5nsedzw/image/upload/blog/beers_law" decoding="async" data-nimg="responsive" loading="lazy" data-old-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"></span><figcaption>Diagram showcasing how Beer's Law can be used to represent how much light gets absorbed through a volume</figcaption></figure><p>We can use this formula in our GLSL code and modify the Raymarching loop to use it instead of the "hacky" transparency hack we used in the first part:</p><!--$--><div><div><p data-testid="codesnippet-title">Using Beer's Law to calculate and return the accumulated light energy going through the cloud</p></div><pre><div data-testid="line"><p>2</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">#</span><span data-testid="content-line">define</span><span data-testid="content-line"> </span><span data-testid="content-line">ABSORPTION_COEFFICIENT</span><span data-testid="content-line"> </span><span data-testid="content-line">0.9</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>6</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> </span><span data-testid="content-line">BeersLaw</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">float</span><span data-testid="content-line"> dist</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">float</span><span data-testid="content-line"> absorption</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>7</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">return</span><span data-testid="content-line"> </span><span data-testid="content-line">exp</span><span data-testid="content-line">(</span><span data-testid="content-line">-</span><span data-testid="content-line">dist </span><span data-testid="content-line">*</span><span data-testid="content-line"> absorption</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>10</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">const</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> SUN_POSITION </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">1.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>11</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">const</span><span data-testid="content-line"> </span><span data-testid="content-line">float</span><span data-testid="content-line"> MARCH_SIZE </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">0.16</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>13</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> </span><span data-testid="content-line">raymarch</span><span data-testid="content-line">(</span><span data-testid="content-line">vec3</span><span data-testid="content-line"> rayOrigin</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> rayDirection</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">float</span><span data-testid="content-line"> offset</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>15</p><p><span><span data-testid="content-line">  depth </span><span data-testid="content-line">+=</span><span data-testid="content-line"> MARCH_SIZE </span><span data-testid="content-line">*</span><span data-testid="content-line"> offset</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>16</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> p </span><span data-testid="content-line">=</span><span data-testid="content-line"> rayOrigin </span><span data-testid="content-line">+</span><span data-testid="content-line"> depth </span><span data-testid="content-line">*</span><span data-testid="content-line"> rayDirection</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>17</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> sunDirection </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">normalize</span><span data-testid="content-line">(</span><span data-testid="content-line">SUN_POSITION</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>19</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> totalTransmittance </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>20</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> lightEnergy </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>22</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">for</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">int</span><span data-testid="content-line"> i </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">0</span><span data-testid="content-line">;</span><span data-testid="content-line"> i </span><span data-testid="content-line">&lt;</span><span data-testid="content-line"> MAX_STEPS</span><span data-testid="content-line">;</span><span data-testid="content-line"> i</span><span data-testid="content-line">++</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>23</p><p><span><span data-testid="content-line">    </span><span data-testid="content-line">float</span><span data-testid="content-line"> density </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">scene</span><span data-testid="content-line">(</span><span data-testid="content-line">p</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>26</p><p><span><span data-testid="content-line">      </span><span data-testid="content-line">float</span><span data-testid="content-line"> transmittance </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">BeersLaw</span><span data-testid="content-line">(</span><span data-testid="content-line">density </span><span data-testid="content-line">*</span><span data-testid="content-line"> MARCH_SIZE</span><span data-testid="content-line">,</span><span data-testid="content-line"> ABSORPTION_COEFFICIENT</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>27</p><p><span><span data-testid="content-line">      </span><span data-testid="content-line">float</span><span data-testid="content-line"> luminance </span><span data-testid="content-line">=</span><span data-testid="content-line"> density</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>29</p><p><span><span data-testid="content-line">      totalTransmittance </span><span data-testid="content-line">*=</span><span data-testid="content-line"> transmittance</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>30</p><p><span><span data-testid="content-line">      lightEnergy </span><span data-testid="content-line">+=</span><span data-testid="content-line"> totalTransmittance </span><span data-testid="content-line">*</span><span data-testid="content-line"> luminance</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>34</p><p><span><span data-testid="content-line">    p </span><span data-testid="content-line">=</span><span data-testid="content-line"> rayOrigin </span><span data-testid="content-line">+</span><span data-testid="content-line"> depth </span><span data-testid="content-line">*</span><span data-testid="content-line"> rayDirection</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div></pre></div><!--/$--><p>In the code snippet above:</p><ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We gutted the raymarching loop, so it now relies on a more physically based property: <strong>Beer's Law</strong>.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We changed the interface of our function: instead of returning a full color, it now returns a <code>float</code> representing the <em>amount of light</em> or <em>light energy</em> going through the cloud.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>As we march through the volume, we accumulate the obtained <code>transmittance</code>. The deeper we go, the less light we add.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We return the resulting <code>lightEnergy</code></p></li>
</ul><p>The demo below showcases what using Beers Law yields in our Raymarching loop 👀</p><!--$--><!--/$--><p>The resulting cloud is a bit strange:</p><ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>its edges do indeed behave like a cloud</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>the center is just a white blob</p></li>
</ul><p>all of which is, once again, due to the lack of a proper lighting model.</p><h3 id="sampling-light">Sampling light</h3><p>Our new cloud does not interact with light right now. You can try changing the <code>SUN_POSITION</code> vector: the resulting render will remain the same. We not only need a lighting model but also a physically accurate one.</p><p>For that, we can try to compute how much light has been absorbed for each sample point of our Raymarching loop by:</p><ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Start a dedicated nested Raymarching loop that goes from the current sample point to the light source (direction of the light)</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Sample the density and apply Beer's Law like we just did</p></li>
</ul><p>The diagram below illustrates this technique to make it a bit easier to understand:</p><figure><span><span></span><img alt="Diagram showcasing how we sample multiple points of lights in the direction of the light through our volume for each sampled point in the Raymarching loop." sizes="100vw" srcset="https://res.cloudinary.com/dg5nsedzw/image/upload/blog/lightmarching 640w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/lightmarching 750w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/lightmarching 828w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/lightmarching 1080w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/lightmarching 1200w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/lightmarching 1920w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/lightmarching 2048w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/lightmarching 3840w" src="https://res.cloudinary.com/dg5nsedzw/image/upload/blog/lightmarching" decoding="async" data-nimg="responsive" loading="lazy" data-old-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"></span><figcaption>Diagram showcasing how we sample multiple points of lights in the direction of the light through our volume for each sampled point in the Raymarching loop.</figcaption></figure><p>The code snippet below is one of many implementations of this technique. We'll use this one going forward:</p><!--$--><div><div><p data-testid="codesnippet-title">Dedicated nested raymarching loop to sample the light received at a given sampled point</p></div><pre><div data-testid="line"><p>2</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">#</span><span data-testid="content-line">define</span><span data-testid="content-line"> </span><span data-testid="content-line">MAX_STEPS_LIGHTS</span><span data-testid="content-line"> </span><span data-testid="content-line">6</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>3</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">#</span><span data-testid="content-line">define</span><span data-testid="content-line"> </span><span data-testid="content-line">ABSORPTION_COEFFICIENT</span><span data-testid="content-line"> </span><span data-testid="content-line">0.9</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>7</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">const</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> SUN_POSITION </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">1.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>8</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">const</span><span data-testid="content-line"> </span><span data-testid="content-line">float</span><span data-testid="content-line"> MARCH_SIZE </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">0.16</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>10</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> </span><span data-testid="content-line">lightmarch</span><span data-testid="content-line">(</span><span data-testid="content-line">vec3</span><span data-testid="content-line"> position</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> rayDirection</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>11</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> lightDirection </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">normalize</span><span data-testid="content-line">(</span><span data-testid="content-line">SUN_POSITION</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>12</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> totalDensity </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>13</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> marchSize </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">0.03</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>15</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">for</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">int</span><span data-testid="content-line"> step </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">0</span><span data-testid="content-line">;</span><span data-testid="content-line"> step </span><span data-testid="content-line">&lt;</span><span data-testid="content-line"> MAX_STEPS_LIGHTS</span><span data-testid="content-line">;</span><span data-testid="content-line"> step</span><span data-testid="content-line">++</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>16</p><p><span><span data-testid="content-line">      position </span><span data-testid="content-line">+=</span><span data-testid="content-line"> lightDirection </span><span data-testid="content-line">*</span><span data-testid="content-line"> marchSize </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">float</span><span data-testid="content-line">(</span><span data-testid="content-line">step</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>18</p><p><span><span data-testid="content-line">      </span><span data-testid="content-line">float</span><span data-testid="content-line"> lightSample </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">scene</span><span data-testid="content-line">(</span><span data-testid="content-line">position</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">true</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>19</p><p><span><span data-testid="content-line">      totalDensity </span><span data-testid="content-line">+=</span><span data-testid="content-line"> lightSample</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>22</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> transmittance </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">BeersLaw</span><span data-testid="content-line">(</span><span data-testid="content-line">totalDensity</span><span data-testid="content-line">,</span><span data-testid="content-line"> ABSORPTION_COEFFICIENT</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>26</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> </span><span data-testid="content-line">raymarch</span><span data-testid="content-line">(</span><span data-testid="content-line">vec3</span><span data-testid="content-line"> rayOrigin</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> rayDirection</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">float</span><span data-testid="content-line"> offset</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>28</p><p><span><span data-testid="content-line">  depth </span><span data-testid="content-line">+=</span><span data-testid="content-line"> MARCH_SIZE </span><span data-testid="content-line">*</span><span data-testid="content-line"> offset</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>29</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> p </span><span data-testid="content-line">=</span><span data-testid="content-line"> rayOrigin </span><span data-testid="content-line">+</span><span data-testid="content-line"> depth </span><span data-testid="content-line">*</span><span data-testid="content-line"> rayDirection</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>30</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> sunDirection </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">normalize</span><span data-testid="content-line">(</span><span data-testid="content-line">SUN_POSITION</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>32</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> totalTransmittance </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>33</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> lightEnergy </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>35</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">for</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">int</span><span data-testid="content-line"> i </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">0</span><span data-testid="content-line">;</span><span data-testid="content-line"> i </span><span data-testid="content-line">&lt;</span><span data-testid="content-line"> MAX_STEPS</span><span data-testid="content-line">;</span><span data-testid="content-line"> i</span><span data-testid="content-line">++</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>36</p><p><span><span data-testid="content-line">    </span><span data-testid="content-line">float</span><span data-testid="content-line"> density </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">scene</span><span data-testid="content-line">(</span><span data-testid="content-line">p</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">false</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>40</p><p><span><span data-testid="content-line">      </span><span data-testid="content-line">float</span><span data-testid="content-line"> lightTransmittance </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">lightmarch</span><span data-testid="content-line">(</span><span data-testid="content-line">p</span><span data-testid="content-line">,</span><span data-testid="content-line"> rayDirection</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>41</p><p><span><span data-testid="content-line">      </span><span data-testid="content-line">float</span><span data-testid="content-line"> luminance </span><span data-testid="content-line">=</span><span data-testid="content-line"> density</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>43</p><p><span><span data-testid="content-line">      totalTransmittance </span><span data-testid="content-line">*=</span><span data-testid="content-line"> lightTransmittance</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>44</p><p><span><span data-testid="content-line">      lightEnergy </span><span data-testid="content-line">+=</span><span data-testid="content-line"> totalTransmittance </span><span data-testid="content-line">*</span><span data-testid="content-line"> luminance</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>48</p><p><span><span data-testid="content-line">    p </span><span data-testid="content-line">=</span><span data-testid="content-line"> rayOrigin </span><span data-testid="content-line">+</span><span data-testid="content-line"> depth </span><span data-testid="content-line">*</span><span data-testid="content-line"> rayDirection</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div></pre></div><!--/$--><p>Because of this nested loop, the algorithmic complexity of our Raymarching loop just increased, so we'll need to define a relatively low number of steps to sample our light while also calculating a less precise density by reducing the number of Octaves in our FBM to preserve a decent frame-rate (that's one easy <em>win</em> I implemented to avoid dropping too many frames).</p><p>All these little tweaks and performance considerations have been taken into account in the demo below:</p><!--$--><!--/$--><h3 id="anisotropic-scattering-and-phase-function">Anisotropic scattering and phase function</h3><p>Until now, we assumed that light gets distributed equally in every direction as it propagates through the cloud. In reality, the light gets scattered in different directions with different intensities due to water droplets. This phenomenon is called <strong>Anisotropic scattering</strong> (vs. Isotropic when light scatters evenly), and to have a realistic cloud, we can try to take this into account within our Raymarching loop.</p><figure><span><span></span><img alt="Diagram showcasing the difference between isotropic scattering and anisotropic scattering when sampling our light energy." sizes="100vw" srcset="https://res.cloudinary.com/dg5nsedzw/image/upload/blog/anisotropic_scattering 640w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/anisotropic_scattering 750w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/anisotropic_scattering 828w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/anisotropic_scattering 1080w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/anisotropic_scattering 1200w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/anisotropic_scattering 1920w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/anisotropic_scattering 2048w, https://res.cloudinary.com/dg5nsedzw/image/upload/blog/anisotropic_scattering 3840w" src="https://res.cloudinary.com/dg5nsedzw/image/upload/blog/anisotropic_scattering" decoding="async" data-nimg="responsive" loading="lazy" data-old-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"></span><figcaption>Diagram showcasing the difference between isotropic scattering and anisotropic scattering when sampling our light energy.</figcaption></figure><p>To simulate Anisotropic scattering in our cloud scene for each sampling point for a given light source, we can use a <em>phase function</em>. A common one is the <strong>Henyey-Greenstein phase function</strong>, which I encountered in pretty much all the examples I could find on physically accurate Volumetric Raymarching.</p><p>The GLSL implementation of this phase function looks as follows:</p><!--$--><div><div><p data-testid="codesnippet-title">Implementation of the Henyey-Greenstein phase function</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">float</span><span data-testid="content-line"> </span><span data-testid="content-line">HenyeyGreenstein</span><span data-testid="content-line">(</span><span data-testid="content-line">float</span><span data-testid="content-line"> g</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">float</span><span data-testid="content-line"> mu</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>3</p><p><span><span data-testid="content-line">	</span><span data-testid="content-line">return</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">1.0</span><span data-testid="content-line"> </span><span data-testid="content-line">/</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">4.0</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> PI</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line">  </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">(</span><span data-testid="content-line">1.0</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> gg</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">/</span><span data-testid="content-line"> </span><span data-testid="content-line">pow</span><span data-testid="content-line">(</span><span data-testid="content-line">1.0</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"> gg </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">2.0</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> g </span><span data-testid="content-line">*</span><span data-testid="content-line"> mu</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.5</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div></pre></div><!--/$--><p>We now have to introduce the result of this new function in our Raymarching loop by multiplying it by the density at a given sampled point, and what we obtain is more realistic lighting for our cloud, especially if the light source moves around.</p><!--$--><div><div><p data-testid="codesnippet-title">Introducing the Henyey-Greenstein phase function inside our Raymarching loop</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">float</span><span data-testid="content-line"> </span><span data-testid="content-line">raymarch</span><span data-testid="content-line">(</span><span data-testid="content-line">vec3</span><span data-testid="content-line"> rayOrigin</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> rayDirection</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">float</span><span data-testid="content-line"> offset</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>3</p><p><span><span data-testid="content-line">  depth </span><span data-testid="content-line">+=</span><span data-testid="content-line"> MARCH_SIZE </span><span data-testid="content-line">*</span><span data-testid="content-line"> offset</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>4</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> p </span><span data-testid="content-line">=</span><span data-testid="content-line"> rayOrigin </span><span data-testid="content-line">+</span><span data-testid="content-line"> depth </span><span data-testid="content-line">*</span><span data-testid="content-line"> rayDirection</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>5</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec3</span><span data-testid="content-line"> sunDirection </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">normalize</span><span data-testid="content-line">(</span><span data-testid="content-line">SUN_POSITION</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>7</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> totalTransmittance </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>8</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> lightEnergy </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>10</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> phase </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">HenyeyGreenstein</span><span data-testid="content-line">(</span><span data-testid="content-line">SCATTERING_ANISO</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">dot</span><span data-testid="content-line">(</span><span data-testid="content-line">rayDirection</span><span data-testid="content-line">,</span><span data-testid="content-line"> sunDirection</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>12</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">for</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">int</span><span data-testid="content-line"> i </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">0</span><span data-testid="content-line">;</span><span data-testid="content-line"> i </span><span data-testid="content-line">&lt;</span><span data-testid="content-line"> MAX_STEPS</span><span data-testid="content-line">;</span><span data-testid="content-line"> i</span><span data-testid="content-line">++</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>13</p><p><span><span data-testid="content-line">    </span><span data-testid="content-line">float</span><span data-testid="content-line"> density </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">scene</span><span data-testid="content-line">(</span><span data-testid="content-line">p</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">false</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>17</p><p><span><span data-testid="content-line">      </span><span data-testid="content-line">float</span><span data-testid="content-line"> lightTransmittance </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">lightmarch</span><span data-testid="content-line">(</span><span data-testid="content-line">p</span><span data-testid="content-line">,</span><span data-testid="content-line"> rayDirection</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>18</p><p><span><span data-testid="content-line">      </span><span data-testid="content-line">float</span><span data-testid="content-line"> luminance </span><span data-testid="content-line">=</span><span data-testid="content-line"> density </span><span data-testid="content-line">*</span><span data-testid="content-line"> phase</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>20</p><p><span><span data-testid="content-line">      totalTransmittance </span><span data-testid="content-line">*=</span><span data-testid="content-line"> lightTransmittance</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>21</p><p><span><span data-testid="content-line">      lightEnergy </span><span data-testid="content-line">+=</span><span data-testid="content-line"> totalTransmittance </span><span data-testid="content-line">*</span><span data-testid="content-line"> luminance</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>25</p><p><span><span data-testid="content-line">    p </span><span data-testid="content-line">=</span><span data-testid="content-line"> rayOrigin </span><span data-testid="content-line">+</span><span data-testid="content-line"> depth </span><span data-testid="content-line">*</span><span data-testid="content-line"> rayDirection</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div></pre></div><!--/$--><figure><div tabindex="0" role="slider" aria-label="Comparison of our physically accurate Volumetric cloud with and without applying the Henyey-Greenstein phase function." aria-valuemin="0" aria-valuemax="100" aria-valuenow="40"><p><img alt="Before" loading="eager" src="https://res.cloudinary.com/dg5nsedzw/image/upload/v1698193254/blog/phase-before.png" width="700" height="511"></p><p><img alt="After" loading="eager" src="https://res.cloudinary.com/dg5nsedzw/image/upload/v1698193254/blog/phase-after.png" width="700" height="511"></p><div id="slider-line"><p><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img" style="transform:rotate(180deg)"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></p></div></div><figcaption>Comparison of our physically accurate Volumetric cloud with and without applying the Henyey-Greenstein phase function.</figcaption></figure><p>The final demo of this article below showcases our scene with:</p><ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Blue noise dithering</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Bicubic filtering</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Beer's law</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Our more realistic light sampling</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Henyey-Greenstein phase function</p></li>
</ul><!--$--><!--/$--><p>The result is looks really good, although I'll admit I had to add an extra value term to my light energy formula so the cloud wouldn't simply "fade away" when dense parts would end up in the shade.</p><!--$--><div><div><p data-testid="codesnippet-title">Extra value added to the luminance formula</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">float</span><span data-testid="content-line"> luminance </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">0.025</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"> density </span><span data-testid="content-line">*</span><span data-testid="content-line"> phase</span><span data-testid="content-line">;</span></span></p></div></pre></div><!--/$--><p>The need for a hack probably highlights some issues with my code, most likely due to how I use the resulting light energy value returned by the Raymarching loop or an absorption coefficient that's a bit too high. Not sure. If you find any blatantly wrong assumptions in my code, please let me know so I can make the necessary edits.</p><p>Some other optimizations are possible to make the cloud look fluffier and denser, like using the <a href="https://www.guerrilla-games.com/media/News/Files/The-Real-time-Volumetric-Cloudscapes-of-Horizon-Zero-Dawn.pdf">Beer's Powder approximation (page 64)</a>, but it was mentioned to me that those are just used for aesthetic reasons and are not actually physically based (I also honestly couldn't figure out how to apply it without altering significantly my <code>MAX_STEPS</code>, <code>MAX_STEPS_LIGHTS</code>, and <code>marchSize</code> variables 😅 and the result was still not great).</p><div><p>@MaximeHeckel Note that beer-powder is a non-physical approximation. Maybe see:

https://t.co/LlHxW5x5sb</p></div></section>
<section id="conclusion-section"><h2 id="conclusion">Conclusion</h2><p>We learned several ways to render cloud-like volumes with Raymarching throughout this article, and considering that a few weeks prior to that, I wasn't even able to wrap my head around the concept of Volumetric Raymarching, <em>I'm happy with the result and proud of myself</em> given how complex and daunting this subject can be. I was also pleasantly surprised by the ability to apply some physics principles and port techniques commonly used in triple-A video game productions to WebGL to achieve realistic looking clouds.</p><p>With that, I'm excited to attempt combining raymarched clouds with terrain, like the ones introduced in my Raymarching article, or even more complex challenges like rendering a planet with realistic atmospheric scattering. Another idea I had was to build a raymarched galaxy; since we can simplify it to a massive cloud in space and that some of the physics principles introduced in this article should still apply and yield beautiful renders.</p><p>I hope this article will inspire you in your own Raymarching endeavors and that it helped make this seemingly hard-to-grasp concept of Volumetric rendering a bit more welcoming 🙂.</p></section></div></div>]]></description>
        </item>
    </channel>
</rss>