<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
    <channel>
        <title>HN100 - Readable Contents</title>
        <link>https://hn.algolia.com/api/v1/search_by_date?tags=%28story,poll%29&amp;numericFilters=points%3E100</link>
        <description>Uses Readability to add bodies to the RSS feed</description>
        <lastBuildDate>Wed, 27 Sep 2023 01:00:07 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[The Philips Hue ecosystem is collapsing into stupidity (268 pts)]]></title>
            <link>https://rachelbythebay.com/w/2023/09/26/hue/</link>
            <guid>37667266</guid>
            <pubDate>Tue, 26 Sep 2023 23:22:15 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://rachelbythebay.com/w/2023/09/26/hue/">https://rachelbythebay.com/w/2023/09/26/hue/</a>, See on <a href="https://news.ycombinator.com/item?id=37667266">Hacker News</a></p>
Couldn't get https://rachelbythebay.com/w/2023/09/26/hue/: Error: Request failed with status code 403]]></description>
        </item>
        <item>
            <title><![CDATA[Prophet: Automatic Forecasting Procedure (184 pts)]]></title>
            <link>https://github.com/facebook/prophet</link>
            <guid>37663820</guid>
            <pubDate>Tue, 26 Sep 2023 18:35:04 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/facebook/prophet">https://github.com/facebook/prophet</a>, See on <a href="https://news.ycombinator.com/item?id=37663820">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text"><h2 tabindex="-1" id="user-content-prophet-automatic-forecasting-procedure" dir="auto"><a href="#prophet-automatic-forecasting-procedure">Prophet: Automatic Forecasting Procedure</a></h2>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/facebook/prophet/workflows/Build/badge.svg"><img src="https://github.com/facebook/prophet/workflows/Build/badge.svg" alt="Build"></a></p>
<p dir="auto"><a href="https://pypi.python.org/pypi/prophet" rel="nofollow"><img src="https://camo.githubusercontent.com/ca04c4e8c3096c6322baf8345d9e49654b14eb653f95940ba94ff65ed179f0d6/68747470733a2f2f696d672e736869656c64732e696f2f707970692f762f70726f706865742e737667" alt="PyPI Version" data-canonical-src="https://img.shields.io/pypi/v/prophet.svg"></a>
<a href="https://pepy.tech/project/prophet" rel="nofollow"><img src="https://camo.githubusercontent.com/06eeeb6f5fd9a30c5a11817aade564762f59b68a00aecd9a39fbc7dc5b229d4b/68747470733a2f2f706570792e746563682f62616467652f70726f706865742f6d6f6e7468" alt="PyPI Downloads Monthly" data-canonical-src="https://pepy.tech/badge/prophet/month"></a>
<a href="https://pepy.tech/project/prophet" rel="nofollow"><img src="https://camo.githubusercontent.com/0ed6f9de39980c2849f2a31ca727fdc2a9f8f8f142a742732c2dd35c9f9c7132/68747470733a2f2f706570792e746563682f62616467652f70726f70686574" alt="PyPI Downloads All" data-canonical-src="https://pepy.tech/badge/prophet"></a></p>
<p dir="auto"><a href="https://cran.r-project.org/package=prophet" rel="nofollow"><img src="https://camo.githubusercontent.com/2d7a3597b2a92021a4f3d29cf68f35888afa2930867842f20782b54899b58aea/68747470733a2f2f7777772e722d706b672e6f72672f6261646765732f76657273696f6e2f70726f70686574" alt="CRAN Version" data-canonical-src="https://www.r-pkg.org/badges/version/prophet"></a>
<a href="https://cran.r-project.org/package=prophet" rel="nofollow"><img src="https://camo.githubusercontent.com/ba49b200f4ee0e11105953d13633da8aa63412acc86560b95ae95422d8c1675f/68747470733a2f2f6372616e6c6f67732e722d706b672e6f72672f6261646765732f70726f706865743f636f6c6f723d627269676874677265656e" alt="CRAN Downloads Monthly" data-canonical-src="https://cranlogs.r-pkg.org/badges/prophet?color=brightgreen"></a>
<a href="https://cranlogs.r-pkg.org/badges/grand-total/prophet" rel="nofollow"><img src="https://camo.githubusercontent.com/af33df4c8be51a774861f6df5d737d8856e1fae0fe35d6799219077e336a59fa/68747470733a2f2f6372616e6c6f67732e722d706b672e6f72672f6261646765732f6772616e642d746f74616c2f70726f706865743f636f6c6f723d627269676874677265656e" alt="CRAN Downloads All" data-canonical-src="https://cranlogs.r-pkg.org/badges/grand-total/prophet?color=brightgreen"></a></p>
<p dir="auto"><a href="https://anaconda.org/conda-forge/prophet/" rel="nofollow"><img src="https://camo.githubusercontent.com/e71d3c39b99e7977f6a02856c23eefbcf3c71806da569fd9ba4450142eff07a1/68747470733a2f2f616e61636f6e64612e6f72672f636f6e64612d666f7267652f70726f706865742f6261646765732f76657273696f6e2e737667" alt="Conda_Version" data-canonical-src="https://anaconda.org/conda-forge/prophet/badges/version.svg"></a></p>
<hr>
<p dir="auto"><strong>2023 Update:</strong> We discuss our plans for the future of Prophet in this blog post: <a href="https://medium.com/@cuongduong_35162/facebook-prophet-in-2023-and-beyond-c5086151c138" rel="nofollow">facebook/prophet in 2023 and beyond</a></p>
<hr>
<p dir="auto">Prophet is a procedure for forecasting time series data based on an additive model where non-linear trends are fit with yearly, weekly, and daily seasonality, plus holiday effects. It works best with time series that have strong seasonal effects and several seasons of historical data. Prophet is robust to missing data and shifts in the trend, and typically handles outliers well.</p>
<p dir="auto">Prophet is <a href="https://code.facebook.com/projects/" rel="nofollow">open source software</a> released by Facebook's <a href="https://research.fb.com/category/data-science/" rel="nofollow">Core Data Science team</a>. It is available for download on <a href="https://cran.r-project.org/package=prophet" rel="nofollow">CRAN</a> and <a href="https://pypi.python.org/pypi/prophet/" rel="nofollow">PyPI</a>.</p>
<h2 tabindex="-1" id="user-content-important-links" dir="auto"><a href="#important-links">Important links</a></h2>
<ul dir="auto">
<li>Homepage: <a href="https://facebook.github.io/prophet/" rel="nofollow">https://facebook.github.io/prophet/</a></li>
<li>HTML documentation: <a href="https://facebook.github.io/prophet/docs/quick_start.html" rel="nofollow">https://facebook.github.io/prophet/docs/quick_start.html</a></li>
<li>Issue tracker: <a href="https://github.com/facebook/prophet/issues">https://github.com/facebook/prophet/issues</a></li>
<li>Source code repository: <a href="https://github.com/facebook/prophet">https://github.com/facebook/prophet</a></li>
<li>Contributing: <a href="https://facebook.github.io/prophet/docs/contributing.html" rel="nofollow">https://facebook.github.io/prophet/docs/contributing.html</a></li>
<li>Prophet R package: <a href="https://cran.r-project.org/package=prophet" rel="nofollow">https://cran.r-project.org/package=prophet</a></li>
<li>Prophet Python package: <a href="https://pypi.python.org/pypi/prophet/" rel="nofollow">https://pypi.python.org/pypi/prophet/</a></li>
<li>Release blogpost: <a href="https://research.facebook.com/blog/2017/2/prophet-forecasting-at-scale/" rel="nofollow">https://research.facebook.com/blog/2017/2/prophet-forecasting-at-scale/</a></li>
<li>Prophet paper: Sean J. Taylor, Benjamin Letham (2018) Forecasting at scale. The American Statistician 72(1):37-45 (<a href="https://peerj.com/preprints/3190.pdf" rel="nofollow">https://peerj.com/preprints/3190.pdf</a>).</li>
</ul>
<h2 tabindex="-1" id="user-content-installation-in-r---cran" dir="auto"><a href="#installation-in-r---cran">Installation in R - CRAN</a></h2>
<p dir="auto"><g-emoji alias="warning">⚠️</g-emoji> <strong>The CRAN version of prophet is fairly outdated. To get the latest bug fixes and updated country holiday data, we suggest installing the <a href="#installation-in-r---latest-release">latest release</a>.</strong></p>
<p dir="auto">Prophet is a <a href="https://cran.r-project.org/package=prophet" rel="nofollow">CRAN package</a> so you can use <code>install.packages</code>.</p>
<div dir="auto" data-snippet-clipboard-copy-content="install.packages('prophet')"><pre>install.packages(<span><span>'</span>prophet<span>'</span></span>)</pre></div>
<p dir="auto">After installation, you can <a href="https://facebook.github.io/prophet/docs/quick_start.html#r-api" rel="nofollow">get started!</a></p>
<h2 tabindex="-1" id="user-content-installation-in-r---latest-release" dir="auto"><a href="#installation-in-r---latest-release">Installation in R - Latest release</a></h2>
<div dir="auto" data-snippet-clipboard-copy-content="install.packages('remotes')
remotes::install_github('facebook/prophet@*release', subdir = 'R')"><pre>install.packages(<span><span>'</span>remotes<span>'</span></span>)
<span>remotes</span><span>::</span>install_github(<span><span>'</span>facebook/prophet@*release<span>'</span></span>, <span>subdir</span> <span>=</span> <span><span>'</span>R<span>'</span></span>)</pre></div>
<h4 tabindex="-1" id="user-content-experimental-backend---cmdstanr" dir="auto"><a href="#experimental-backend---cmdstanr">Experimental backend - cmdstanr</a></h4>
<p dir="auto">You can also choose an experimental alternative stan backend called <code>cmdstanr</code>. Once you've installed <code>prophet</code>,
follow these instructions to use <code>cmdstanr</code> instead of <code>rstan</code> as the backend:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# R
# We recommend running this in a fresh R session or restarting your current session
install.packages(c(&quot;cmdstanr&quot;, &quot;posterior&quot;), repos = c(&quot;https://mc-stan.org/r-packages/&quot;, getOption(&quot;repos&quot;)))

# If you haven't installed cmdstan before, run:
cmdstanr::install_cmdstan()
# Otherwise, you can point cmdstanr to your cmdstan path:
cmdstanr::set_cmdstan_path(path = <your existing cmdstan>)

# Set the R_STAN_BACKEND environment variable
Sys.setenv(R_STAN_BACKEND = &quot;CMDSTANR&quot;)"><pre><span><span>#</span> R</span>
<span><span>#</span> We recommend running this in a fresh R session or restarting your current session</span>
install.packages(c(<span><span>"</span>cmdstanr<span>"</span></span>, <span><span>"</span>posterior<span>"</span></span>), <span>repos</span> <span>=</span> c(<span><span>"</span>https://mc-stan.org/r-packages/<span>"</span></span>, getOption(<span><span>"</span>repos<span>"</span></span>)))

<span><span>#</span> If you haven't installed cmdstan before, run:</span>
<span>cmdstanr</span><span>::</span>install_cmdstan()
<span><span>#</span> Otherwise, you can point cmdstanr to your cmdstan path:</span>
<span>cmdstanr</span><span>::</span>set_cmdstan_path(<span>path</span> <span>=</span> <span>&lt;</span><span>your</span> <span>existing</span> <span>cmdstan</span><span>&gt;</span>)

<span><span>#</span> Set the R_STAN_BACKEND environment variable</span>
Sys.setenv(<span>R_STAN_BACKEND</span> <span>=</span> <span><span>"</span>CMDSTANR<span>"</span></span>)</pre></div>
<h3 tabindex="-1" id="user-content-windows" dir="auto"><a href="#windows">Windows</a></h3>
<p dir="auto">On Windows, R requires a compiler so you'll need to <a href="https://github.com/stan-dev/rstan/wiki/RStan-Getting-Started">follow the instructions</a> provided by <code>rstan</code>. The key step is installing <a href="http://cran.r-project.org/bin/windows/Rtools/" rel="nofollow">Rtools</a> before attempting to install the package.</p>
<p dir="auto">If you have custom Stan compiler settings, install from source rather than the CRAN binary.</p>
<h2 tabindex="-1" id="user-content-installation-in-python---pypi-release" dir="auto"><a href="#installation-in-python---pypi-release">Installation in Python - PyPI release</a></h2>
<p dir="auto">Prophet is on PyPI, so you can use <code>pip</code> to install it.</p>
<div dir="auto" data-snippet-clipboard-copy-content="python -m pip install prophet"><pre>python -m pip install prophet</pre></div>
<ul dir="auto">
<li>From v0.6 onwards, Python 2 is no longer supported.</li>
<li>As of v1.0, the package name on PyPI is "prophet"; prior to v1.0 it was "fbprophet".</li>
<li>As of v1.1, the minimum supported Python version is 3.7.</li>
</ul>
<p dir="auto">After installation, you can <a href="https://facebook.github.io/prophet/docs/quick_start.html#python-api" rel="nofollow">get started!</a></p>
<h3 tabindex="-1" id="user-content-anaconda" dir="auto"><a href="#anaconda">Anaconda</a></h3>
<p dir="auto">Prophet can also be installed through conda-forge.</p>
<div dir="auto" data-snippet-clipboard-copy-content="conda install -c conda-forge prophet"><pre>conda install -c conda-forge prophet</pre></div>
<h2 tabindex="-1" id="user-content-installation-in-python---development-version" dir="auto"><a href="#installation-in-python---development-version">Installation in Python - Development version</a></h2>
<p dir="auto">To get the latest code changes as they are merged, you can clone this repo and build from source manually. This is <strong>not</strong> guaranteed to be stable.</p>
<div dir="auto" data-snippet-clipboard-copy-content="git clone https://github.com/facebook/prophet.git
cd prophet/python
python -m pip install -e ."><pre>git clone https://github.com/facebook/prophet.git
<span>cd</span> prophet/python
python -m pip install -e <span>.</span></pre></div>
<p dir="auto">By default, Prophet will use a fixed version of <code>cmdstan</code> (downloading and installing it if necessary) to compile the model executables. If this is undesired and you would like to use your own existing <code>cmdstan</code> installation, you can set the environment variable <code>PROPHET_REPACKAGE_CMDSTAN</code> to <code>False</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="export PROPHET_REPACKAGE_CMDSTAN=False; python -m pip install -e ."><pre><span>export</span> PROPHET_REPACKAGE_CMDSTAN=False<span>;</span> python -m pip install -e <span>.</span></pre></div>
<h3 tabindex="-1" id="user-content-linux" dir="auto"><a href="#linux">Linux</a></h3>
<p dir="auto">Make sure compilers (gcc, g++, build-essential) and Python development tools (python-dev, python3-dev) are installed. In Red Hat systems, install the packages gcc64 and gcc64-c++. If you are using a VM, be aware that you will need at least 4GB of memory to install prophet, and at least 2GB of memory to use prophet.</p>
<h3 tabindex="-1" id="user-content-windows-1" dir="auto"><a href="#windows-1">Windows</a></h3>
<p dir="auto">Using <code>cmdstanpy</code> with Windows requires a Unix-compatible C compiler such as mingw-gcc. If cmdstanpy is installed first, one can be installed via the <code>cmdstanpy.install_cxx_toolchain</code> command.</p>
<h2 tabindex="-1" id="user-content-changelog" dir="auto"><a href="#changelog">Changelog</a></h2>
<h3 tabindex="-1" id="user-content-version-114-20230530" dir="auto"><a href="#version-114-20230530">Version 1.1.4 (2023.05.30)</a></h3>
<h4 tabindex="-1" id="user-content-python" dir="auto"><a href="#python">Python</a></h4>
<ul dir="auto">
<li>We now rely solely on <code>holidays</code> package for country holidays.</li>
<li>Upgraded cmdstan version to 2.31.0, enabling Apple M1 support.</li>
<li>Fixed bug with Windows installation caused by long paths.</li>
</ul>
<h4 tabindex="-1" id="user-content-r" dir="auto"><a href="#r">R</a></h4>
<ul dir="auto">
<li>Updated <code>holidays</code> data based on holidays version 0.25.</li>
</ul>
<h3 tabindex="-1" id="user-content-version-112-20230120" dir="auto"><a href="#version-112-20230120">Version 1.1.2 (2023.01.20)</a></h3>
<h4 tabindex="-1" id="user-content-python-1" dir="auto"><a href="#python-1">Python</a></h4>
<ul dir="auto">
<li>Sped up <code>.predict()</code> by up to 10x by removing intermediate DataFrame creations.</li>
<li>Sped up fourier series generation, leading to at least 1.5x speed improvement for <code>train()</code> and <code>predict()</code> pipelines.</li>
<li>Fixed bug in how warm start values were being read.</li>
<li>Wheels are now version-agnostic.</li>
</ul>
<h4 tabindex="-1" id="user-content-r-1" dir="auto"><a href="#r-1">R</a></h4>
<ul dir="auto">
<li>Fixed a bug in <code>construct_holiday_dataframe()</code></li>
<li>Updated <code>holidays</code> data based on holidays version 0.18.</li>
</ul>
<h3 tabindex="-1" id="user-content-version-111-20220908" dir="auto"><a href="#version-111-20220908">Version 1.1.1 (2022.09.08)</a></h3>
<ul dir="auto">
<li>(Python) Improved runtime (3-7x) of uncertainty predictions via vectorization.</li>
<li>Bugfixes relating to Python package versions and R holiday objects.</li>
</ul>
<h3 tabindex="-1" id="user-content-version-11-20220625" dir="auto"><a href="#version-11-20220625">Version 1.1 (2022.06.25)</a></h3>
<ul dir="auto">
<li>Replaced <code>pystan2</code> dependency with <code>cmdstan</code> + <code>cmdstanpy</code>.</li>
<li>Pre-packaged model binaries for Python package, uploaded binary distributions to PyPI.</li>
<li>Improvements in the <code>stan</code> model code, cross-validation metric calculations, holidays.</li>
</ul>
<h3 tabindex="-1" id="user-content-version-10-20210328" dir="auto"><a href="#version-10-20210328">Version 1.0 (2021.03.28)</a></h3>
<ul dir="auto">
<li>Python package name changed from fbprophet to prophet</li>
<li>Fixed R Windows build issues to get latest version back on CRAN</li>
<li>Improvements in serialization, holidays, and R timezone handling</li>
<li>Plotting improvements</li>
</ul>
<h3 tabindex="-1" id="user-content-version-07-20200905" dir="auto"><a href="#version-07-20200905">Version 0.7 (2020.09.05)</a></h3>
<ul dir="auto">
<li>Built-in json serialization</li>
<li>Added "flat" growth option</li>
<li>Bugfixes related to <code>holidays</code> and <code>pandas</code></li>
<li>Plotting improvements</li>
<li>Improvements in cross validation, such as parallelization and directly specifying cutoffs</li>
</ul>
<h3 tabindex="-1" id="user-content-version-06-20200303" dir="auto"><a href="#version-06-20200303">Version 0.6 (2020.03.03)</a></h3>
<ul dir="auto">
<li>Fix bugs related to upstream changes in <code>holidays</code> and <code>pandas</code> packages.</li>
<li>Compile model during first use, not during install (to comply with CRAN policy)</li>
<li><code>cmdstanpy</code> backend now available in Python</li>
<li>Python 2 no longer supported</li>
</ul>
<h3 tabindex="-1" id="user-content-version-05-20190514" dir="auto"><a href="#version-05-20190514">Version 0.5 (2019.05.14)</a></h3>
<ul dir="auto">
<li>Conditional seasonalities</li>
<li>Improved cross validation estimates</li>
<li>Plotly plot in Python</li>
<li>Bugfixes</li>
</ul>
<h3 tabindex="-1" id="user-content-version-04-20181218" dir="auto"><a href="#version-04-20181218">Version 0.4 (2018.12.18)</a></h3>
<ul dir="auto">
<li>Added holidays functionality</li>
<li>Bugfixes</li>
</ul>
<h3 tabindex="-1" id="user-content-version-03-20180601" dir="auto"><a href="#version-03-20180601">Version 0.3 (2018.06.01)</a></h3>
<ul dir="auto">
<li>Multiplicative seasonality</li>
<li>Cross validation error metrics and visualizations</li>
<li>Parameter to set range of potential changepoints</li>
<li>Unified Stan model for both trend types</li>
<li>Improved future trend uncertainty for sub-daily data</li>
<li>Bugfixes</li>
</ul>
<h3 tabindex="-1" id="user-content-version-021-20171108" dir="auto"><a href="#version-021-20171108">Version 0.2.1 (2017.11.08)</a></h3>
<ul dir="auto">
<li>Bugfixes</li>
</ul>
<h3 tabindex="-1" id="user-content-version-02-20170902" dir="auto"><a href="#version-02-20170902">Version 0.2 (2017.09.02)</a></h3>
<ul dir="auto">
<li>Forecasting with sub-daily data</li>
<li>Daily seasonality, and custom seasonalities</li>
<li>Extra regressors</li>
<li>Access to posterior predictive samples</li>
<li>Cross-validation function</li>
<li>Saturating minimums</li>
<li>Bugfixes</li>
</ul>
<h3 tabindex="-1" id="user-content-version-011-20170417" dir="auto"><a href="#version-011-20170417">Version 0.1.1 (2017.04.17)</a></h3>
<ul dir="auto">
<li>Bugfixes</li>
<li>New options for detecting yearly and weekly seasonality (now the default)</li>
</ul>
<h3 tabindex="-1" id="user-content-version-01-20170223" dir="auto"><a href="#version-01-20170223">Version 0.1 (2017.02.23)</a></h3>
<ul dir="auto">
<li>Initial release</li>
</ul>
<h2 tabindex="-1" id="user-content-license" dir="auto"><a href="#license">License</a></h2>
<p dir="auto">Prophet is licensed under the <a href="https://github.com/facebook/prophet/blob/main/LICENSE">MIT license</a>.</p>
</article>
          </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[EU tells Apple to open everything up to its rivals (152 pts)]]></title>
            <link>https://appleinsider.com/articles/23/09/26/eu-tells-apple-to-open-everything-up-to-its-rivals</link>
            <guid>37663725</guid>
            <pubDate>Tue, 26 Sep 2023 18:28:20 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://appleinsider.com/articles/23/09/26/eu-tells-apple-to-open-everything-up-to-its-rivals">https://appleinsider.com/articles/23/09/26/eu-tells-apple-to-open-everything-up-to-its-rivals</a>, See on <a href="https://news.ycombinator.com/item?id=37663725">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
          <p>
                        <a href="https://photos5.appleinsider.com/gallery/51155-101060-european-union-flag-xl.jpg">
              <img src="https://photos5.appleinsider.com/gallery/51155-101060-european-union-flag-xl.jpg" alt="">
            </a>
          </p>

          
          
          
                    <p>European Commissioner Thierry Breton says the Digital Markets Act is just a beginning, and Apple must open up its whole ecosystem to competitors.
</p><p>The EU's Digital Markets Act (DMA) <a href="https://appleinsider.com/articles/22/07/19/european-council-approves-digital-markets-act-rules">was created</a> to target Big Tech firms like Apple, and make a fairer business environment for all comers. The DMA became law in the EU in <a href="https://appleinsider.com/articles/22/11/01/europe-confirms-its-digital-markets-act-will-go-after-apples-app-store">November 2022</a>, and became applicable from May 2023, though it is still in the process of <a href="https://appleinsider.com/articles/23/09/06/apples-imessage-gets-a-reprieve-from-eu-law">being implemented</a>.
</p><p>According to <em>Reuters</em>, Thierry Breton has now <a href="https://www.reuters.com/technology/eus-breton-tells-apple-ceo-open-its-ecosystem-rivals-2023-09-26/">called on Apple</a> to open up its hardware and software ecosystem.
</p><p>"The next job for Apple and other Big Tech, under the DMA is to open up its gates to competitors," he said. "Be it the electronic wallet, browsers or app stores, consumers using an Apple <a href="https://appleinsider.com/inside/iphone" title="iPhone" data-kpt="1">iPhone</a> should be able to benefit from competitive services by a range of providers."
</p><p>Breton said this after meeting with <a href="https://appleinsider.com/inside/tim-cook" title="Tim Cook" data-kpt="1">Tim Cook</a> in Brussels, where the Apple CEO is certain to have reiterated the company's arguments about security and privacy.
</p><p>"EU regulation fosters innovation, without compromising on security and privacy," Breton told <em>Reuters</em>.
</p><p>Apple has not commented. Cook's trip to Brussels was not announced, and he hasn't referred to his meeting with the EU Commissioner. However, he <a href="https://twitter.com/tim_cook/status/1706609678522658865/photo/1">has tweeted</a> about meeting with Apple Store staff in the city.</p>

        </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Show HN: Unity like game editor running in pure WASM (397 pts)]]></title>
            <link>https://raverie-us.github.io/raverie-engine/</link>
            <guid>37663270</guid>
            <pubDate>Tue, 26 Sep 2023 17:58:47 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://raverie-us.github.io/raverie-engine/">https://raverie-us.github.io/raverie-engine/</a>, See on <a href="https://news.ycombinator.com/item?id=37663270">Hacker News</a></p>
&lt;Unparsable&gt;]]></description>
        </item>
        <item>
            <title><![CDATA[ROCm is AMD's priority, executive says (234 pts)]]></title>
            <link>https://www.eetimes.com/rocm-is-amds-no-1-priority-exec-says/</link>
            <guid>37663194</guid>
            <pubDate>Tue, 26 Sep 2023 17:54:42 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.eetimes.com/rocm-is-amds-no-1-priority-exec-says/">https://www.eetimes.com/rocm-is-amds-no-1-priority-exec-says/</a>, See on <a href="https://news.ycombinator.com/item?id=37663194">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>

					<!--?//php echo do_shortcode('[responsivevoice_button voice="US English Male" buttontext="Listen to Post"]') ?-->
					<!-- EET_Top_Leaderboard -->

<p>SANTA CLARA, CALIF. — “If you think about the product portfolio that AMD has, it’s arguably the broadest in the industry in terms of AI compute,” Vamsi Boppana, senior VP of the AI group at AMD, said in his keynote address at the recent AI Hardware Summit. AMD’s hardware portfolio includes data-center–class CPUs and GPUs, consumer GPUs, FPGAs and the Ryzen 7040, a client CPU with NPU designed for PCs. Software is key to unlocking the performance of these different hardware platforms. But how does AMD compete with its GPU competitors’ strong offerings, given its more diverse hardware?</p>
<p>AMD’s software stacks for each class of product are separate: ROCm (short for Radeon Open Compute platform) targets its Instinct data center GPU lines (and, soon, its Radeon consumer GPUs), Vitis AI targets its FPGAs, and ZenDNN targets its client devices.</p>
<p>How far along is AMD with unifying these stacks?</p>


<p>“We have enormous customer pull coming, and that is dictating quite a bit of our near-term plans,” Boppana told EE Times in an interview after his talk here. “The plane is flying right now, so we cannot disassemble the engine. However, we are absolutely doing things at the foundational level to make more unification happen in our stack.”</p>
		
		<div>
		<div>
				<div>
					<figure>
					<a href="https://www.eetimes.com/briocean-technology-shines-bright-as-it-ranks-8th-on-the-top-asia-pacific-distributor-list/" title="Briocean Technology Shines Bright as It Ranks 8th on the Top Asia Pacific Distributor List&nbsp;"><img data-lazy-fallback="1" loading="lazy" width="62" src="https://www.eetimes.com/wp-content/uploads/Briocean-thumbnail-image.jpg?w=62" alt="Briocean Technology Shines Bright as It Ranks 8th on the Top Asia Pacific Distributor List&nbsp;" data-lazy-src="https://www.eetimes.com/wp-content/uploads/Briocean-thumbnail-image.jpg?w=62&amp;is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"></a>
					</figure>
					
				</div><p>By Briocean Technology&nbsp; 09.26.2023</p>
			</div>
		<div>
				<div>
					<figure>
					<a href="https://www.eetimes.com/unlock-the-benefits-of-endpoint-ai-solutions-for-laptop-computers/" title="Unlock the Benefits of Endpoint AI Solutions for Laptop Computers&nbsp;"><img data-lazy-fallback="1" loading="lazy" width="62" src="https://www.eetimes.com/wp-content/uploads/EE-Times_600x340_.jpg?w=62" alt="Unlock the Benefits of Endpoint AI Solutions for Laptop Computers&nbsp;" data-lazy-src="https://www.eetimes.com/wp-content/uploads/EE-Times_600x340_.jpg?w=62&amp;is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"></a>
					</figure>
					
				</div><p>By Himax Technologies. Ltd.&nbsp; 09.26.2023</p>
			</div>
		<div>
				<div>
					<figure>
					<a href="https://www.eetimes.com/1409388-2/" title="SK hynix’s Evolution in CIS HDR Technology and Future Outlook"><img data-lazy-fallback="1" loading="lazy" width="62" src="https://www.eetimes.com/wp-content/uploads/SK-hynix_CIS-HDR-Technology_Thumbnail.png?w=62" alt="SK hynix’s Evolution in CIS HDR Technology and Future Outlook" data-lazy-src="https://www.eetimes.com/wp-content/uploads/SK-hynix_CIS-HDR-Technology_Thumbnail.png?w=62&amp;is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"></a>
					</figure>
					
				</div><p>By Suram Cha, Technical Leader of Next Gen Biz Team, SK hynix&nbsp; 09.26.2023</p>
			</div></div>
<figure id="attachment_1409408" aria-describedby="caption-attachment-1409408"><a href="https://www.eetimes.com/wp-content/uploads/Kisaco_day2-4767.jpg"><img data-lazy-fallback="1" decoding="async" fetchpriority="high" src="https://www.eetimes.com/wp-content/uploads/Kisaco_day2-4767.jpg?w=640&amp;resize=640%2C427" alt="" width="640" height="427" data-recalc-dims="1" data-lazy-src="https://www.eetimes.com/wp-content/uploads/Kisaco_day2-4767.jpg?w=640&amp;is-pending-load=1#038;resize=640%2C427" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"></a><figcaption id="caption-attachment-1409408">AMD’s Vamsi Boppana gives a keynote address at the recent AI Hardware Summit in Santa Clara, Calif. (Source: Kisaco Research &amp; Jeffrey Hosier Photography)</figcaption></figure>
<p>Boppana said that there’s some common infrastructure and tooling underlying all three stacks, including an ongoing effort to make a common quantizer.</p>

<p>“Over time, we want to get to a place where users have one execution provider, and underneath that, you will be able to select [a hardware target],” he said. “In the near term, modules are shared across stacks, and over time, as things like heterogeneous platforms are going to become prevalent, the unified elements start coming through.”</p>
<p>A unified stack would be helpful for heterogeneous systems, Boppana said, especially where partitioning is required. Currently, the Vitis stack handles CPU plus xDNA targets, but he agrees that both automatic and user-driven partitioning will be necessary.</p>
<p>“In that scenario, we need to be able to take a problem statement and cut the graph, such that both parts of the graph get executed on [different parts of the hardware], and they need to inter-operate,” he said.</p>
<h3><strong>‘ROCm has evolved’</strong></h3>
<p>ROCm is less mature than competitors’ GPU software offerings, with <a href="https://www.eetimes.com/nvidia-brings-gpu-acceleration-to-computational-lithography/" target="_blank" rel="noopener">Nvidia</a>’s mature CUDA stack often seen as a big part of the market leader’s competitive advantage.</p>
<p>“Software is a journey,” Boppana said. “Anybody who has written or managed complex pieces of software knows it takes time. The good news is, we have been on the journey…ROCm has evolved.”</p>
<p>AMD has made ROCm the No. 1 priority at the company level in the last year, Boppana said, standing up a new organization that’s brought together assets from all the company’s software contributions.</p>
<p>“We have much larger resources actually working on software, and [AMD CEO Lisa Su] has been very clear that she wants to see significant and continued investments on the software side,” Boppana said. “We have agreed to provide people internally, we have acquired Mipsology, and we are looking to grow talent both organically and inorganically.”</p>
<p>AMD also recently stood up an internal <a href="https://www.eetimes.com/podcasts/demystifying-ai-how-neural-networks-like-transformers-really-work/" target="_blank" rel="noopener">AI models</a> group to increase its experience using its own software stack.</p>
<p>“We want a much tighter feedback loop,” Boppana said.</p>
<h3><strong>Using open source to challenge Nvidia</strong></h3>
<p>AMD has embraced OpenAI’s Triton, an open-source programming language and compiler for GPUs that promises to offer an open-source alternative to Nvidia’s CUDA for developers who want to write high-level code that performs optimally on the hardware.</p>
<p>“There are different personas that are programming [our GPUs],” he said. “[Triton] is a level of abstraction that people are comfortable with. It’s productive. And it gets to hardware in a pretty efficient, cogent fashion. But for other customers, that doesn’t matter; they don’t need to develop new kernels. For them, we can ship libraries. So, it’s just a matter of who wants to use us.”</p>
<p>In contrast to Nvidia’s approach with CUDA, which is mostly proprietary, most of AMD’s ROCm stack is open source.</p>
<p>“We partner with the [AI frameworks] and the people writing the libraries and say, ‘If you have a kernel you want to put together, you can take something that exists from us, but if you find there’s the opportunity for you to optimize source code, [you can]’,” he said. “Then we have so many more people that are willing and able to contribute. So, that’s very important and very powerful for us: We think it’s the right strategic direction for us to take.”</p>
<figure id="attachment_1409409" aria-describedby="caption-attachment-1409409"><a href="https://www.eetimes.com/wp-content/uploads/AMD-Hardware-architectures.jpg"><img data-lazy-fallback="1" decoding="async" src="https://www.eetimes.com/wp-content/uploads/AMD-Hardware-architectures.jpg?w=640&amp;resize=640%2C269" alt="" width="640" height="269" data-recalc-dims="1" data-lazy-src="https://www.eetimes.com/wp-content/uploads/AMD-Hardware-architectures.jpg?w=640&amp;is-pending-load=1#038;resize=640%2C269" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"></a><figcaption id="caption-attachment-1409409">AMD has a diverse portfolio of hardware architectures for AI acceleration. But how does the company manage its AI software stack for such diverse architectures? (Source: AMD)</figcaption></figure>
<p>MI300 samples are currently with customers, Boppana said, and both customers and AMD have AI training workloads up and running, with availability coming at the end of this year.</p>
<p>ROCm will be crucial to the success of both the MI300 and <a href="https://www.eetimes.com/can-amds-mi300x-take-on-nvidias-h100/" target="_blank" rel="noopener">MI300X</a>.</p>
<p>“Being candid, we have a few places to grow,” he said. “Allowing the community to contribute [to ROCm] alongside us helps us bridge the gap faster.”</p>
				</div><div>
					<div>
						<p><img width="173" height="164" src="https://www.eetimes.com/wp-content/uploads/Sally-Ward_Foxton_low-res-6-e1678729120589.jpg?fit=173%2C164&amp;is-pending-load=1" alt="" decoding="async" data-lazy-src="https://www.eetimes.com/wp-content/uploads/Sally-Ward_Foxton_low-res-6-e1678729120589.jpg?fit=173%2C164&amp;is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">						</p>
					</div>
											<div>
							<p>Sally Ward-Foxton</p>

							<p><em>Sally Ward-Foxton covers AI for EETimes.com and EETimes Europe magazine. Sally has spent the last 18 years writing about the electronics industry from London. She has written for Electronic Design, ECN, Electronic Specifier: Design, Components in Electronics, and many more news publications. She holds a Masters' degree in Electrical and Electronic Engineering from the University of Cambridge.   <br></em></p>
						</div>
									</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Sidechannel pixel-stealing attack works in Chromium on all modern GPUs (127 pts)]]></title>
            <link>https://arstechnica.com/security/2023/09/gpus-from-all-major-suppliers-are-vulnerable-to-new-pixel-stealing-attack/</link>
            <guid>37663159</guid>
            <pubDate>Tue, 26 Sep 2023 17:52:45 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://arstechnica.com/security/2023/09/gpus-from-all-major-suppliers-are-vulnerable-to-new-pixel-stealing-attack/">https://arstechnica.com/security/2023/09/gpus-from-all-major-suppliers-are-vulnerable-to-new-pixel-stealing-attack/</a>, See on <a href="https://news.ycombinator.com/item?id=37663159">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
        <header>
            <h4>
      SAME ORIGIN POLICY SHATTERED    —
</h4>
            
            <h2 itemprop="description">A previously unknown compression side channel in GPUs can expose images thought to be private.</h2>
                    </header>
        <section>
            <div itemprop="articleBody">
                                    
<figure>
  <img src="https://cdn.arstechnica.net/wp-content/uploads/2023/09/pixels-800x540.jpg" alt="GPUs from all major suppliers are vulnerable to new pixel-stealing attack">
      <figcaption></figcaption>  </figure>

  




<!-- cache hit 16:single/related:697e3f1e00d323130cb53bbec0736ce7 --><!-- empty -->
<p>GPUs from all six of the major suppliers are vulnerable to a newly discovered attack that allows malicious websites to read the usernames, passwords, and other sensitive visual data displayed by other websites, researchers have demonstrated in a paper published Tuesday.</p>
<p>The cross-origin attack allows a malicious website from one domain—say, example.com—to effectively read the pixels displayed by a website from example.org, or another different domain. Attackers can then reconstruct them in a way that allows them to view the words or images displayed by the latter site. This leakage violates a critical security principle that forms one of the most fundamental security boundaries safeguarding the Internet. Known as the <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">same origin policy</a>, it mandates that content hosted on one website domain be isolated from all other website domains.</p>
<h2>Optimizing bandwidth at a cost</h2>
<p>GPU.zip, as the proof-of-concept attack has been named, starts with a malicious website that places a link to the webpage it wants to read inside of an <a href="https://www.hostinger.com/tutorials/what-is-iframe/">iframe</a>, a common HTML element that allows sites to embed ads, images, or other content hosted on other websites. Normally, the same origin policy prevents either site from inspecting the source code, content, or final visual product of the other. The researchers found that data compression that both internal and discrete GPUs use to improve performance acts as a <a href="https://en.wikipedia.org/wiki/Side-channel_attack">side channel</a> that they can abuse to bypass the restriction and steal pixels one by one.</p>                                            
                                                        
<p>“We found that modern GPUs automatically try to compress this visual data, without any application involvement,” Yingchen Wang, the lead author and a researcher at the University of Texas at Austin, wrote in an email. “This is done to save memory bandwidth and improve performance. Since compressibility is data dependent, this optimization creates a side channel which can be exploited by an attacker to reveal information about the visual data.”</p>
<p>For GPU.zip to work, a malicious page must be loaded into the Chrome or Edge browsers. Under-the-hood differences in the way Firefox and Safari work prevent the attack from succeeding when those browsers process an attack page. Another requirement is that the page linked to in the iframe must not be configured to deny being embedded by cross-origin websites.</p>
<p>The security threats that can result when HTML is embedded in iframes on malicious websites have been well-known for more than a decade. Most websites <a href="https://web.dev/security-headers/">restrict the cross-origin embedding</a> of pages displaying user names, passwords, or other sensitive content through X-Frame-Options or Content-Security-Policy headers. Not all, however, do. One example is Wikipedia, which shows the usernames of people who log in to their accounts. A person who wants to remain anonymous while visiting a site they don’t trust could be outed if it contained an iframe containing a link to <code>https://en.wikipedia.org/wiki/Main_Page</code>.</p>
<figure><a href="https://cdn.arstechnica.net/wp-content/uploads/2023/09/gpu.zip-pixel-theft.jpg" data-height="607" data-width="1554" alt="Pixel stealing PoC for deanonymizing a user, run with other tabs open playing video. “Ground Truth” is the victim iframe (Wikipedia logged in as “Yingchenw”). “AMD” is the attack result on a Ryzen 7 4800U after 30 minutes, with 97 percent accuracy. “Intel” is the attack result for an i7-8700 after 215 minutes with 98 percent accuracy."><img alt="Pixel stealing PoC for deanonymizing a user, run with other tabs open playing video. “Ground Truth” is the victim iframe (Wikipedia logged in as “Yingchenw”). “AMD” is the attack result on a Ryzen 7 4800U after 30 minutes, with 97 percent accuracy. “Intel” is the attack result for an i7-8700 after 215 minutes with 98 percent accuracy." src="https://cdn.arstechnica.net/wp-content/uploads/2023/09/gpu.zip-pixel-theft-640x250.jpg" width="640" height="250" srcset="https://cdn.arstechnica.net/wp-content/uploads/2023/09/gpu.zip-pixel-theft-1280x500.jpg 2x"></a><figcaption><p><a href="https://cdn.arstechnica.net/wp-content/uploads/2023/09/gpu.zip-pixel-theft.jpg" data-height="607" data-width="1554">Enlarge</a> <span>/</span> Pixel stealing PoC for deanonymizing a user, run with other tabs open playing video. “Ground Truth” is the victim iframe (Wikipedia logged in as “Yingchenw”). “AMD” is the attack result on a Ryzen 7 4800U after 30 minutes, with 97 percent accuracy. “Intel” is the attack result for an i7-8700 after 215 minutes with 98 percent accuracy.</p><p>Wang et al.</p></figcaption></figure>
<p>The researchers showed how GPU.zip allows a malicious website they created for their PoC to steal pixels one by one for a user’s Wikipedia username. The attack works on GPUs provided by Apple, Intel, AMD, Qualcomm, Arm, and Nvidia. On AMD’s Ryzen 7 4800U, GPU.zip took about 30 minutes to render the targeted pixels with 97 percent accuracy. The attack required 215 minutes to reconstruct the pixels when displayed on a system running an Intel i7-8700.</p>                                            
                                                        
<p>All of the GPUs analyzed use proprietary forms of compression to optimize the bandwidth available in the memory data bus of the PC, phone, or other device displaying the targeted content. The compression schemes differ from manufacturer to manufacturer and are undocumented, so the researchers reverse-engineered each one. The insights yielded a method that uses the SVG, or the scalable vector graphics image format, to maximize differences in DRAM traffic between black and white target pixels in the presence of compression. While their paper discusses GPU.zip as it applies to iGPUs, or internal GPUs, the technique applies equally to standalone or discrete GPUs as well.</p>
<p>In their paper, the researchers wrote:</p>
<blockquote><p>We demonstrate that an attacker can exploit the iGPU-based compression channel to perform cross-origin pixel stealing attacks in the browser using SVG filters (the latest version of Google Chrome as of April 2023), even though SVG filters are implemented at constant time. The reason is that the attacker can create highly redundant or highly non-redundant patterns depending on a single secret pixel in the browser. As these patterns are processed by the iGPU, their varying degrees of redundancy cause the lossless compression output to depend on the secret pixel. The data-dependent compression output directly translates to data-dependent DRAM traffic and data-dependent cache occupancy. Consequently, we show that, even under the most passive threat model—where an attacker can only observe coarse-grained redundancy information of a pattern using a coarse-grained timer in the browser and lacks the ability to adaptively select input—individual pixels can be leaked. Our proof-of-concept attack succeeds on a range of devices (including computers, phones) from a variety of hardware vendors with distinct GPU architectures (Intel, AMD, Apple, Nvidia). Surprisingly, our attack also succeeds on discrete GPUs, and we have preliminary results indicating the presence of software-transparent compression on those architectures as well.</p></blockquote>

                                                </div>

            
                            <nav>Page: <span>1 <a href="https://arstechnica.com/security/2023/09/gpus-from-all-major-suppliers-are-vulnerable-to-new-pixel-stealing-attack/2/">2</a> <a href="https://arstechnica.com/security/2023/09/gpus-from-all-major-suppliers-are-vulnerable-to-new-pixel-stealing-attack/2/"><span>Next <span>→</span></span></a></span></nav>
            
        </section>
    </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[HNInternal: Ask HN: Tips for Solopreneur? (169 pts)]]></title>
            <link>https://news.ycombinator.com/item?id=37662937</link>
            <guid>37662937</guid>
            <pubDate>Tue, 26 Sep 2023 17:39:51 GMT</pubDate>
            <description><![CDATA[<p>See on <a href="https://news.ycombinator.com/item?id=37662937">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><td><table>
        <tbody><tr id="37662937">
      <td><span></span></td>      <td><center><a id="up_37662937" href="https://news.ycombinator.com/vote?id=37662937&amp;how=up&amp;goto=item%3Fid%3D37662937"></a></center></td><td><span><a href="https://news.ycombinator.com/item?id=37662937">Ask HN: Tips for Solopreneur?</a></span></td></tr><tr><td colspan="2"></td><td><span>
          <span id="score_37662937">106 points</span> by <a href="https://news.ycombinator.com/user?id=solo_prono">solo_prono</a> <span title="2023-09-26T17:39:51"><a href="https://news.ycombinator.com/item?id=37662937">3 hours ago</a></span> <span id="unv_37662937"></span> | <a href="https://news.ycombinator.com/hide?id=37662937&amp;goto=item%3Fid%3D37662937">hide</a> | <a href="https://hn.algolia.com/?query=Ask%20HN%3A%20Tips%20for%20Solopreneur%3F&amp;type=story&amp;dateRange=all&amp;sort=byDate&amp;storyText=false&amp;prefix&amp;page=0">past</a> | <a href="https://news.ycombinator.com/fave?id=37662937&amp;auth=a4c646cbd0cbd88c190eb0bbc2f21002eeaf249c">favorite</a> | <a href="https://news.ycombinator.com/item?id=37662937">52&nbsp;comments</a>        </span>
              </td></tr>
    <tr></tr><tr><td colspan="2"></td><td><div><p>Yo HN! I have been working on some design tools in my spare time to solve problems I've faced over and over, and I'm thinking about monetizing them.</p><p>I've been to some conferences recently and talked to a lot of people who have these problems as well, and they're keen to try it out. I have collected some emails, been communicating with them a bit and even got beers with one of them recently!</p><p>Here's my list of concerns:</p><p>1. It is just me - is that a red flag? Some people have asked me about my team and I told them it was just me. I got the feeling that it may have turned them off because the conversation kind of ended right there. To be fair, after that I did say that it is just me right now BUTTTTTTTT why that is okay due to my experience and work history. However, yes it is my first time doing a business.</p><p>2. How do I set appropriate milestones for me to reach? Do I think about reaching 100 customers before reaching 5 recurring customers for example?</p><p>3. I'm in a small town in PNW. Does that matter if this will be an online thing anyway? Why or when do people move to big cities like Seattle/SF/NYC/Austin etc.</p><p>4. What are some ways to do marketing? Should I even think about that before I have a few customers who are using my product consistently?</p><p>5. I've been inspired by the Startup School videos. Honestly though I'm not sure about fundraising and all these things, it seems very intimidating to me. What's the difference between those things and starting a company and slowly building it up?</p></div></td></tr>        <tr></tr><tr><td colspan="2"></td><td><form action="comment" method="post"></form></td></tr>  </tbody></table>
  </td></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Exploring Linux command-line space time (137 pts)]]></title>
            <link>https://fabiensanglard.net/st/index.html</link>
            <guid>37662655</guid>
            <pubDate>Tue, 26 Sep 2023 17:21:12 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://fabiensanglard.net/st/index.html">https://fabiensanglard.net/st/index.html</a>, See on <a href="https://news.ycombinator.com/item?id=37662655">Hacker News</a></p>
<div id="readability-page-1" class="page"><br><center>
    
</center><p>
Sep 26, 2023</p>
<p>Exploring Linux command-line space time</p><hr>

<p>I was curious to explore how long a program takes to run, how much memory is used over time, and what processes/threads are spawned. To provide answers I wrote a tool, which I named <code>st</code>. Here are a few things I looked into.</p>

<p>See details at the bottom if you are interested in how the tool works (and why I did not use <code><a href="https://man7.org/linux/man-pages/man1/time.1.html">time(1)</a></code> and <code>strace(1)</code>).</p>


<p>Fill</p><hr><p>An entertaining way to use <code>st</code> is so to predict the outcome of a command and explore the reasons for discrepancies. I started with a simple C program, <a href="https://fabiensanglard.net/st/fill.c">fill.c</a> allocating 1GiB and setting each byte individually.</p>

<!-- HTML generated using hilite.me -->
<pre><span>#include &lt;stdio.h&gt;</span>
<span>#include &lt;stdlib.h&gt;</span>
<span>#include &lt;stdint.h&gt;</span>

<span>void</span> <span>fill</span>(<span>uint8_t</span><span>*</span> addr, <span>size_t</span> amount, <span>char</span> value) {
    <span>for</span> (<span>size_t</span> i <span>=</span> <span>0</span>; i <span>&lt;</span> amount; i<span>++</span>) {
        <span>*</span>(addr <span>+</span> i) <span>=</span> value;
    }
}

<span>int</span> <span>main</span>(<span>int</span> argc, <span>char</span> <span>**</span>argv) {
    <span>size_t</span> s <span>=</span> <span>1</span><span>&lt;&lt;</span><span>30</span>;
    <span>uint8_t</span><span>*</span> buffer <span>=</span> (<span>uint8_t</span><span>*</span>)malloc(s);
    fill(buffer, s, atoi(argv[<span>0</span>]));
    <span>return</span> EXIT_SUCCESS;
}
</pre>



<p>Let's build and run it via <code>st</code>.</p>

<pre><b>$</b> clang -o fill fill.c
<b>$</b> sudo st fill
<span><span>EXEC</span>:</span> [/home/leaf/fill]
Num threads = 1
Num process = 1
Max PSS: 1,073,762,304 bytes
Walltime: 1,229ms - user-space: 1,109ms - kernel-space: 87ms
</pre>

<pre>  1┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
   ┃                                                                               ██████┃
   ┃                                                                         ████████████┃
   ┃                                                                    █████████████████┃
   ┃                                                               ██████████████████████┃
   ┃                                                         ████████████████████████████┃
   ┃                                                    █████████████████████████████████┃
   ┃                                              ███████████████████████████████████████┃
   ┫                                         ████████████████████████████████████████████┃
   ┃                                   ██████████████████████████████████████████████████┃
   ┃                             ████████████████████████████████████████████████████████┃
   ┃                        █████████████████████████████████████████████████████████████┃
   ┃                  ███████████████████████████████████████████████████████████████████┃
   ┃            █████████████████████████████████████████████████████████████████████████┃
   ┃       ██████████████████████████████████████████████████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
0GB┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
   0s                                                                                    1</pre>

<p>I expected 1GiB to be filled in 10ms but it took a whole second. The issue is that the program is generating many page faults. I remember Firefox sped up their startup time 2x by solving a similar issue<a name="back_1" href="#footnote_1"><sup>[1]</sup></a>.</p>

<p>Also noteworthy, the memory usage did not increase abruptly from 0 to 1GiB with <code>malloc</code>. Instead we see a staircase pattern which shows that physical RAM consumption increased as virtual pages were written to by the <code>fill</code> function.</p>


<p>fillfill</p><hr><p>Another test program, <a href="https://fabiensanglard.net/st/fillfill.c">fillfill.c</a>, to check the tool is properly tracking PSS, processes, and threads.</p>

<!-- HTML generated using hilite.me -->
<pre><span>#include &lt;stdio.h&gt;</span>
<span>#include &lt;stdlib.h&gt;</span>
<span>#include &lt;unistd.h&gt;</span>
<span>#include &lt;sys/wait.h&gt;</span>
<span>#include &lt;stdint.h&gt;</span>

<span>void</span> <span>malloc_and_fill</span>(<span>size_t</span> s) {
  <span>uint8_t</span><span>*</span> buffer <span>=</span> (<span>uint8_t</span><span>*</span>) malloc(s);
  <span>for</span> (<span>size_t</span> i <span>=</span> <span>0</span>; i <span>&lt;</span> s; i<span>++</span>) {
    <span>*</span>(buffer<span>+</span> i) <span>=</span> <span>'F'</span>;
  }
  free(buffer);
}

<span>int</span> <span>main</span>(<span>int</span> argc, <span>char</span> <span>**</span>argv) {
  malloc_and_fill(<span>1L</span> <span>&lt;&lt;</span> <span>30</span>);
  <span>int</span> pid <span>=</span> fork();
  <span>if</span> (pid <span>!=</span> <span>0</span>) {
    malloc_and_fill(<span>1L</span> <span>&lt;&lt;</span> <span>31</span>);   
  } <span>else</span> {
    waitpid(pid, <span>NULL</span>, <span>0</span>);
  }
  <span>return</span> <span>0</span>;
}
</pre>


<p>First allocate 1GiB, free it, then spawn a process which does the same but with 2GiB.</p>

<pre><b>$</b> sudo st ./fillfill
<span>EXEC</span>: [./fillfill]
Num threads = 2
Num process = 2
Max PSS: 2,147,591,168 bytes
Walltime: 3,608ms - user-space: 3,277ms - kernel-space: 327ms</pre>

<pre>  2┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
   ┃                                                                                ███  ┃
   ┃                                                                            ███████  ┃
   ┃                                                                         ██████████  ┃
   ┃                                                                     ██████████████  ┃
   ┃                                                                 ███████████████████ ┃
   ┃                                                              ██████████████████████ ┃
   ┃                                                          ██████████████████████████ ┃
   ┫                          █                           ██████████████████████████████ ┃
   ┃                      ██████                       █████████████████████████████████ ┃
   ┃                   █████████                   █████████████████████████████████████ ┃
   ┃               █████████████               █████████████████████████████████████████ ┃
   ┃           █████████████████            ████████████████████████████████████████████ ┃
   ┃        ████████████████████        ████████████████████████████████████████████████ ┃
   ┃    ████████████████████████    ████████████████████████████████████████████████████ ┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
0GB┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
   0s                                                                                    3</pre>



<p>Fill -O3</p><hr><p>Let's get back to <a href="https://fabiensanglard.net/st/fill.c">fill.c</a> but this time compile it with full optimization (<code>-O3</code>).
  </p>

<pre><b>$</b> clang -o fillo <span>-O3</span> fill.c
<b>$</b> sudo st fillo
<span><span>EXEC</span>:</span>: [ /home/leaf/fillo]
Num threads = 1
Num process = 1
Max PSS: 164,864 bytes
Walltime: 5ms - user-space: 1ms - kernel-space: 0ms
</pre>
<pre>164┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
   ┫█████████████████████████████████████████████████████████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
0KB┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
   0ms                                                                                   0</pre>  

<p>Wow. From 1000ms to 5ms. And only using 164 KiB?! According to Binary Ninja<a name="back_2" href="#footnote_2"><sup>[2]</sup></a>, the compiler discarded both <code>malloc</code> and <code>fill</code>. It makes sense since the program did not read what was allocated and written. Flag <code>-O3</code> effectively turned <code><a href="https://fabiensanglard.net/st/fill.c">fill.c</a></code> into an empty <code>main</code> function.</p>

<pre><span>int</span> main(<span>int</span> argc, char <span>**</span>argv) {
    <span>return</span> EXIT_SUCCESS;
}
</pre>


<p><b><u>Sidenote:</u></b> Exploring compiler <code>-O3</code> outputs with Binary Ninja is a source of endless amazement. Loop to memset substitution (<a href="https://fabiensanglard.net/st/fill.c">fill.c</a>, <a href="https://fabiensanglard.net/st/fill.webp">cc</a>, <a href="https://fabiensanglard.net/st/fillo.webp">cc -O3</a>), <code>strlen</code> caching ...even without <code>-O3</code> (<a href="https://fabiensanglard.net/st/strlen.c">strlen.c</a>, <a href="https://cloud.binary.ninja/embed/44fb8393-c731-4cda-b412-5cee57989840">cc</a>, <a href="https://cloud.binary.ninja/embed/6c81b81f-6c3d-4ac2-8297-6c291d7667bb">cc -O3</a>), and <code>printf("%c", 'x')</code> to <code>putchar('x')</code>!) substitution are only a few among many cool optimizations.</p>




<p>clang helloworld.c</p><hr>
<p>I have written extensively about <a href="https://fabiensanglard.net/dc">compiler drivers</a> by the past so it was a good opportunity to double check that <code>clang</code> behaved as expected when compiling <a href="https://fabiensanglard.net/st/hello.c">hello.c</a>.</p>

<pre><span>#include &lt;stdio.h&gt;</span>
<span>int</span> <span>main</span>() {
   printf(<span>"Hello, World!"</span>);
   <span>return</span> <span>0</span>;
}
</pre>


<pre><b>$</b> sudo st clang -o hello hello.c
<span><span>EXEC</span>:</span>: [ clang -o hello hello.c]
<span><span>EXEC</span>:</span>: [/usr/lib/llvm-14/bin/clang -cc1 -triple aarch64-unknown-linux-gnu -emit-obj -mrelax-all --mrelax-relocations -disable-free -clear-ast-before-backend -disable-llvm-verifier -discard-value-names -main-file-name hello.c -mrelocation-model pic -pic-level 2 -pic-is-pie -mframe-pointer=non-leaf -fmath-errno -ffp-contract=on -fno-rounding-math -mconstructor-aliases -funwind-tables=2 -target-cpu generic -target-feature +neon -target-feature +v8a -target-abi aapcs -fallow-half-arguments-and-returns -mllvm -treat-scalable-fixed-error-as-warning -debugger-tuning=gdb -fcoverage-compilation-dir=/home/leaf -resource-dir /usr/lib/llvm-14/lib/clang/14.0.0 -internal-isystem /usr/lib/llvm-14/lib/clang/14.0.0/include -internal-isystem /usr/local/include -internal-isystem /usr/bin/../lib/gcc/aarch64-linux-gnu/11/../../../../aarch64-linux-gnu/include -internal-externc-isystem /usr/include/aarch64-linux-gnu -internal-externc-isystem /include -internal-externc-isystem /usr/include -fdebug-compilation-dir=/home/leaf]
<span><span>EXEC</span>:</span>: [/usr/bin/ld -pie -EL -z relro --hash-style=gnu --build-id --eh-frame-hdr -m aarch64linux -dynamic-linker /lib/ld-linux-aarch64.so.1 -o hello /lib/aarch64-linux-gnu/Scrt1.o /lib/aarch64-linux-gnu/crti.o /usr/bin/../lib/gcc/aarch64-linux-gnu/11/crtbeginS.o -L/usr/bin/../lib/gcc/aarch64-linux-gnu/11 -L/lib/aarch64-linux-gnu -L/usr/lib/aarch64-linux-gnu -L/usr/lib/llvm-14/bin/../lib -L/lib -L/usr/lib /tmp/hello-df1527.o -lgcc --as-needed -lgcc_s --no-as-needed -lc -lgcc --as-needed -lgcc_s --no-as-needed /usr/bin/../lib/gcc/aarch64-linux-gnu/11/crtendS.o /lib/aarch64-linux-gnu/crtn.o ]
Num threads = 3
Num process = 3
Max PSS: 90,911,744 bytes
Walltime: 71ms - user-space: 24ms - kernel-space: 45ms</pre>

<pre> 63┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
   ┃                                                                             ████████┃
   ┃                                                                           ██████████┃
   ┃                                                                      ███████████████┃
   ┃                                                                    █████████████████┃
   ┃                                                               ██████████████████████┃
   ┃                                                             ████████████████████████┃
   ┃                                                        █████████████████████████████┃
   ┫                                                 ████████████████████████████████████┃
   ┃                                               ██████████████████████████████████████┃
   ┃                                        █████████████████████████████████████████████┃
   ┃                                   ██████████████████████████████████████████████████┃
   ┃                            █████████████████████████████████████████████████████████┃
   ┃                         ████████████████████████████████████████████████████████████┃
   ┃                  ███████████████████████████████████████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
0MB┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
   0ms                                                                                  36</pre>

<p>Without surprise, we see two forks. One when the driver invokes the compiler and one to invoke the linker. There is no assembler step since it is built-in <code>clang</code>.




</p><p>gcc helloworld.c</p><hr><p>After clang, let's check <code>gcc</code>.

</p><pre><b>$</b> sudo st gcc -o hello hello.c
<span><span>EXEC</span>:</span>: [ gcc -o hello hello.c]
<span><span>EXEC</span>:</span>: [/usr/lib/gcc/aarch64-linux-gnu/11/cc1 -quiet -imultiarch aarch64-linux-gnu hello.c -quiet -dumpbase hello.c -dumpbase-ext .c -mlittle-endian -mabi=lp64 -fasynchronous-unwind-tables -fstack-protector-strong -Wformat -Wformat-security -fstack-clash-protection -o /tmp/ccmt0cw6.s ]
<span><span>EXEC</span>:</span>: [as -EL -mabi=lp64 -o /tmp/ccSRW1gq.o /tmp/ccmt0cw6.s ]
<span><span>EXEC</span>:</span>: [/usr/lib/gcc/aarch64-linux-gnu/11/collect2 -plugin /usr/lib/gcc/aarch64-linux-gnu/11/liblto_plugin.so -plugin-opt=/usr/lib/gcc/aarch64-linux-gnu/11/lto-wrapper -plugin-opt=-fresolution=/tmp/cceZH2hF.res -plugin-opt=-pass-through=-lgcc -plugin-opt=-pass-through=-lgcc_s -plugin-opt=-pass-through=-lc -plugin-opt=-pass-through=-lgcc -plugin-opt=-pass-through=-lgcc_s --build-id --eh-frame-hdr --hash-style=gnu --as-needed -dynamic-linker /lib/ld-linux-aarch64.so.1 -X -EL -maarch64linux --fix-cortex-a53-843419 -pie -z now -z relro -o hello /usr/lib/gcc/aarch64-linux-gnu/11/../../../aarch64-linux-gnu/Scrt1.o /usr/lib/gcc/aarch64-linux-gnu/11/../../../aarch64-linux-gnu/crti.o /usr/lib/gcc/aarch64-linux-gnu/11/crtbeginS.o -L/usr/lib/gcc/aarch64-linux-gnu/11 -L/usr/lib/gcc/aarch64-linux-gnu/11/../../../aarch64-linux-gnu -L/usr/lib/gcc/aarch64-linux-gnu/11/../../../../lib -L/lib/aarch64-linux-gnu -L/lib/../lib -L/usr/lib/aarch64-linux-gnu -L/usr/lib/../lib -L/usr/lib/gcc/aarch64-linux-gnu/11/../../.. /tmp/ccSRW1gq.o -lg]
<span><span>EXEC</span>:</span>: [/usr/bin/ld -plugin /usr/lib/gcc/aarch64-linux-gnu/11/liblto_plugin.so -plugin-opt=/usr/lib/gcc/aarch64-linux-gnu/11/lto-wrapper -plugin-opt=-fresolution=/tmp/cceZH2hF.res -plugin-opt=-pass-through=-lgcc -plugin-opt=-pass-through=-lgcc_s -plugin-opt=-pass-through=-lc -plugin-opt=-pass-through=-lgcc -plugin-opt=-pass-through=-lgcc_s --build-id --eh-frame-hdr --hash-style=gnu --as-needed -dynamic-linker /lib/ld-linux-aarch64.so.1 -X -EL -maarch64linux --fix-cortex-a53-843419 -pie -z now -z relro -o hello /usr/lib/gcc/aarch64-linux-gnu/11/../../../aarch64-linux-gnu/Scrt1.o /usr/lib/gcc/aarch64-linux-gnu/11/../../../aarch64-linux-gnu/crti.o /usr/lib/gcc/aarch64-linux-gnu/11/crtbeginS.o -L/usr/lib/gcc/aarch64-linux-gnu/11 -L/usr/lib/gcc/aarch64-linux-gnu/11/../../../aarch64-linux-gnu -L/usr/lib/gcc/aarch64-linux-gnu/11/../../../../lib -L/lib/aarch64-linux-gnu -L/lib/../lib -L/usr/lib/aarch64-linux-gnu -L/usr/lib/../lib -L/usr/lib/gcc/aarch64-linux-gnu/11/../../.. /tmp/ccSRW1gq.o -lgcc --push-state --as-needed -lg]
Num threads = 5
Num process = 5
Max PSS: 18,597,888 bytes
Walltime: 51ms - user-space: 20ms - kernel-space: 20ms</pre>

<pre> 17┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
   ┃                                          ███████                                    ┃
   ┃                                          ███████                                    ┃
   ┃                                        █████████                                    ┃
   ┃                                        █████████                                    ┃
   ┃                                   ██████████████                                    ┃
   ┃                              ███████████████████                                    ┃
   ┃                         ████████████████████████                                    ┃
   ┫                       ██████████████████████████                            ███████ ┃
   ┃                     ████████████████████████████                          █████████ ┃
   ┃                  ███████████████████████████████                        ███████████ ┃
   ┃                  ███████████████████████████████                   ████████████████ ┃
   ┃              ███████████████████████████████████     █████       ██████████████████ ┃
   ┃           ██████████████████████████████████████  ████████    █████████████████████ ┃
   ┃         ████████████████████████████████████████  ██████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
0MB┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
   0ms                                                                                  36</pre>

<p><code>gcc</code> uses two more steps than <code>clang</code>. One for the self-explanatory assembler <code>as</code> and one for the cryptic <code>collect2</code>. I read the <a href="https://gcc.gnu.org/onlinedocs/gccint/Collect2.html">documentation page</a> but I still don't understand what it does.</p>

<p>Noteworthy, <code>gcc</code> uses four times less memory than <code>clang</code>.</p>

















<p>clang++ hello.cc</p><hr><p>Let's checkout the C++ compiler driver from LLVM suite with <code><a href="https://fabiensanglard.net/st/hello.cc">hello.cc</a></code>.</p>

<pre><span>#include &lt;iostream&gt;</span>

<span>int</span> <span>main</span>() {
    std<span>::</span>cout <span>&lt;&lt;</span> <span>"Hello World!"</span>;
    <span>return</span> <span>0</span>;
}
</pre>


<pre><b>$</b> sudo st clang++ hello.cc
<span>EXEC</span>: [ clang++ /home/leaf/hello.cc]
<span>EXEC</span>: [/usr/lib/llvm-14/bin/clang -cc1 -triple aarch64-unknown-linux-gnu -emit-obj -mrelax-all --mrelax-relocations -disable-free -clear-ast-before-backend -disable-llvm-verifier -discard-value-names -main-file-name hello.cc -mrelocation-model pic -pic-level 2 -pic-is-pie -mframe-pointer=non-leaf -fmath-errno -ffp-contract=on -fno-rounding-math -mconstructor-aliases -funwind-tables=2 -target-cpu generic -target-feature +neon -target-feature +v8a -target-abi aapcs -fallow-half-arguments-and-returns -mllvm -treat-scalable-fixed-error-as-warning -debugger-tuning=gdb -fcoverage-compilation-dir=/home/leaf/repos/st -resource-dir /usr/lib/llvm-14/lib/clang/14.0.0 -internal-isystem /usr/bin/../lib/gcc/aarch64-linux-gnu/11/../../../../include/c++/11 -internal-isystem /usr/bin/../lib/gcc/aarch64-linux-gnu/11/../../../../include/aarch64-linux-gnu/c++/11 -internal-isystem /usr/bin/../lib/gcc/aarch64-linux-gnu/11/../../../../include/c++/11/backward -internal-isystem /usr/lib/llvm-14/lib/clang/14.0.0/include -internal-isystem /u]
<span>EXEC</span>: [/usr/bin/ld -pie -EL -z relro --hash-style=gnu --build-id --eh-frame-hdr -m aarch64linux -dynamic-linker /lib/ld-linux-aarch64.so.1 -o a.out /lib/aarch64-linux-gnu/Scrt1.o /lib/aarch64-linux-gnu/crti.o /usr/bin/../lib/gcc/aarch64-linux-gnu/11/crtbeginS.o -L/usr/bin/../lib/gcc/aarch64-linux-gnu/11 -L/lib/aarch64-linux-gnu -L/usr/lib/aarch64-linux-gnu -L/usr/lib/llvm-14/bin/../lib -L/lib -L/usr/lib /tmp/hello-32e667.o -lstdc++ -lm -lgcc_s -lgcc -lc -lgcc_s -lgcc /usr/bin/../lib/gcc/aarch64-linux-gnu/11/crtendS.o /lib/aarch64-linux-gnu/crtn.o ]
Num threads = 3
Num process = 3
Max PSS: 127,156,224 bytes
Walltime: 221ms - user-space: 136ms - kernel-space: 69ms</pre>

<pre>127┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
   ┃                                                                                     ┃
   ┃                                                                                     ┃
   ┃                                                          █████████████              ┃
   ┃            █                    ██████████████████████████████████████              ┃
   ┃            █           ███████████████████████████████████████████████              ┃
   ┃            █         █████████████████████████████████████████████████      █ ████  ┃
   ┃            █  ████████████████████████████████████████████████████████  ████████████┃
   ┫            ███████████████████████████████████████████████████████████ █████████████┃
   ┃           ██████████████████████████████████████████████████████████████████████████┃
   ┃          ███████████████████████████████████████████████████████████████████████████┃
   ┃        █████████████████████████████████████████████████████████████████████████████┃
   ┃      ███████████████████████████████████████████████████████████████████████████████┃
   ┃    █████████████████████████████████████████████████████████████████████████████████┃
   ┃   ██████████████████████████████████████████████████████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
0MB┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
   0ms                                                                                 221</pre>

<p>No surprises here either. Compiling <code>C++</code> is much more costly in terms of memory (2x), and takes much longer than <code><a href="https://fabiensanglard.net/st/hello.c">hello.c</a></code> (4x).</p>


<p>g++ hello.cc</p><hr>
<p>Let's checkout the C++ compiler driver from GNU suite, <code>g++</code>.</p>

<pre><b>$</b> sudo st g++ hello.cc
<span>EXEC</span>: [ g++ /home/leaf/hello.cc]
<span>EXEC</span>: [/usr/lib/gcc/aarch64-linux-gnu/11/cc1plus -quiet -imultiarch aarch64-linux-gnu -D_GNU_SOURCE /home/leaf/hello.cc -quiet -dumpdir a- -dumpbase hello.cc -dumpbase-ext .cc -mlittle-endian -mabi=lp64 -fasynchronous-unwind-tables -fstack-protector-strong -Wformat -Wformat-security -fstack-clash-protection -o /tmp/ccBFHbve.s ]
<span>EXEC</span>: [as -EL -mabi=lp64 -o /tmp/cckOP2RY.o /tmp/ccBFHbve.s ]
<span>EXEC</span>: [/usr/lib/gcc/aarch64-linux-gnu/11/collect2 -plugin /usr/lib/gcc/aarch64-linux-gnu/11/liblto_plugin.so -plugin-opt=/usr/lib/gcc/aarch64-linux-gnu/11/lto-wrapper -plugin-opt=-fresolution=/tmp/ccpZysdX.res -plugin-opt=-pass-through=-lgcc_s -plugin-opt=-pass-through=-lgcc -plugin-opt=-pass-through=-lc -plugin-opt=-pass-through=-lgcc_s -plugin-opt=-pass-through=-lgcc --build-id --eh-frame-hdr --hash-style=gnu --as-needed -dynamic-linker /lib/ld-linux-aarch64.so.1 -X -EL -maarch64linux --fix-cortex-a53-843419 -pie -z now -z relro /usr/lib/gcc/aarch64-linux-gnu/11/../../../aarch64-linux-gnu/Scrt1.o /usr/lib/gcc/aarch64-linux-gnu/11/../../../aarch64-linux-gnu/crti.o /usr/lib/gcc/aarch64-linux-gnu/11/crtbeginS.o -L/usr/lib/gcc/aarch64-linux-gnu/11 -L/usr/lib/gcc/aarch64-linux-gnu/11/../../../aarch64-linux-gnu -L/usr/lib/gcc/aarch64-linux-gnu/11/../../../../lib -L/lib/aarch64-linux-gnu -L/lib/../lib -L/usr/lib/aarch64-linux-gnu -L/usr/lib/../lib -L/usr/lib/gcc/aarch64-linux-gnu/11/../../.. /tmp/cckOP2RY.o -lstdc++ -lm]
<span>EXEC</span>: [/usr/bin/ld -plugin /usr/lib/gcc/aarch64-linux-gnu/11/liblto_plugin.so -plugin-opt=/usr/lib/gcc/aarch64-linux-gnu/11/lto-wrapper -plugin-opt=-fresolution=/tmp/ccpZysdX.res -plugin-opt=-pass-through=-lgcc_s -plugin-opt=-pass-through=-lgcc -plugin-opt=-pass-through=-lc -plugin-opt=-pass-through=-lgcc_s -plugin-opt=-pass-through=-lgcc --build-id --eh-frame-hdr --hash-style=gnu --as-needed -dynamic-linker /lib/ld-linux-aarch64.so.1 -X -EL -maarch64linux --fix-cortex-a53-843419 -pie -z now -z relro /usr/lib/gcc/aarch64-linux-gnu/11/../../../aarch64-linux-gnu/Scrt1.o /usr/lib/gcc/aarch64-linux-gnu/11/../../../aarch64-linux-gnu/crti.o /usr/lib/gcc/aarch64-linux-gnu/11/crtbeginS.o -L/usr/lib/gcc/aarch64-linux-gnu/11 -L/usr/lib/gcc/aarch64-linux-gnu/11/../../../aarch64-linux-gnu -L/usr/lib/gcc/aarch64-linux-gnu/11/../../../../lib -L/lib/aarch64-linux-gnu -L/lib/../lib -L/usr/lib/aarch64-linux-gnu -L/usr/lib/../lib -L/usr/lib/gcc/aarch64-linux-gnu/11/../../.. /tmp/cckOP2RY.o -lstdc++ -lm -lgcc_s -lgcc -lc -lgcc_s -lgc]
Num threads = 5
Num process = 5
Max PSS: 60,565,504 bytes
Walltime: 232ms - user-space: 127ms - kernel-space: 48ms</pre>

<pre> 60┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
   ┃                                                                 ████                ┃
   ┃                                                             ████████                ┃
   ┃                                                        █████████████                ┃
   ┃                                                    █████████████████                ┃
   ┃                                               ██████████████████████                ┃
   ┃                                            █████████████████████████                ┃
   ┃                                         ████████████████████████████                ┃
   ┫                                      ███████████████████████████████                ┃
   ┃                                 ████████████████████████████████████                ┃
   ┃                            █████████████████████████████████████████                ┃
   ┃                        █████████████████████████████████████████████          █████ ┃
   ┃                    █████████████████████████████████████████████████         ██████ ┃
   ┃                █████████████████████████████████████████████████████       █████████┃
   ┃           ██████████████████████████████████████████████████████████     ███████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
0MB┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
   0ms                                                                                 232</pre>

<p>Alike the C driver, <code>gnu</code>'s version requires twice less RAM than <code>clang++</code>.</p>

<p>rust hello.rs</p><hr><p><code>rustc</code> has a reputation to be slow and memory hungry. Seems appropriate since it ran for nearly 200ms and used 131 MiB of RAM (roughly the same as <code>clang++ hello.cc</code>).</p>

<!-- HTML generated using hilite.me -->
<pre><span>fn</span> main() {
    println<span>!</span>(<span>"Hello World!"</span>);
}
</pre>


<p><code>rustc</code> uses an embedded LLVM backend to generates object files. These are handed to the regular <code>gnu</code> suite with <code>collect2</code> and then the linker <code>ld</code>.

</p><pre><b>$</b> sudo st rustc hello.rs 
<span><span>EXEC</span>:</span>: [rustc hello.rs]
<span><span>EXEC</span>:</span>: [cc /tmp/rustc4fdpuV/symbols.o hello.hello.f76cf86e-cgu.0.rcgu.o hello.hello.f76cf86e-cgu.1.rcgu.o hello.hello.f76cf86e-cgu.2.rcgu.o hello.hello.f76cf86e-cgu.3.rcgu.o hello.hello.f76cf86e-cgu.4.rcgu.o hello.hello.f76cf86e-cgu.5.rcgu.o hello.2pelail77dwjevsg.rcgu.o -Wl,--as-needed -L /usr/lib/rustlib/aarch64-unknown-linux-gnu/lib -Wl,-Bstatic /usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/libstd-1d2bb2d795f2ca05.rlib /usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/libpanic_unwind-f1c586c276421094.rlib /usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/libobject-8060a154fd842f2c.rlib /usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/libmemchr-1f7fc15c78d3bcac.rlib /usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/libaddr2line-965bde82ccc4b5e8.rlib /usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/libgimli-352be989f07a059f.rlib /usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/librustc_demangle-4f461a85c762abbb.rlib /usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/libstd_detect-814ef12b1b7d93c2.rlib /usr/lib/rustlib/aarch64-unknow]
<span><span>EXEC</span>:</span>: [/usr/lib/gcc/aarch64-linux-gnu/11/collect2 -plugin /usr/lib/gcc/aarch64-linux-gnu/11/liblto_plugin.so -plugin-opt=/usr/lib/gcc/aarch64-linux-gnu/11/lto-wrapper -plugin-opt=-fresolution=/tmp/ccXRoDto.res --build-id --eh-frame-hdr --hash-style=gnu --as-needed -dynamic-linker /lib/ld-linux-aarch64.so.1 -X -EL -maarch64linux --fix-cortex-a53-843419 -pie -z now -z relro -o hello /usr/lib/gcc/aarch64-linux-gnu/11/../../../aarch64-linux-gnu/Scrt1.o /usr/lib/gcc/aarch64-linux-gnu/11/../../../aarch64-linux-gnu/crti.o /usr/lib/gcc/aarch64-linux-gnu/11/crtbeginS.o -L/usr/lib/rustlib/aarch64-unknown-linux-gnu/lib -L/usr/lib/rustlib/aarch64-unknown-linux-gnu/lib -L/usr/lib/gcc/aarch64-linux-gnu/11 -L/usr/lib/gcc/aarch64-linux-gnu/11/../../../aarch64-linux-gnu -L/usr/lib/gcc/aarch64-linux-gnu/11/../../../../lib -L/lib/aarch64-linux-gnu -L/lib/../lib -L/usr/lib/aarch64-linux-gnu -L/usr/lib/../lib -L/usr/lib/gcc/aarch64-linux-gnu/11/../../.. /tmp/rustc4fdpuV/symbols.o hello.hello.f76cf86e-cgu.0.rcgu.o hello.hello.f76cf86e-c]
<span><span>EXEC</span>:</span>: [/usr/bin/ld -plugin /usr/lib/gcc/aarch64-linux-gnu/11/liblto_plugin.so -plugin-opt=/usr/lib/gcc/aarch64-linux-gnu/11/lto-wrapper -plugin-opt=-fresolution=/tmp/ccXRoDto.res --build-id --eh-frame-hdr --hash-style=gnu --as-needed -dynamic-linker /lib/ld-linux-aarch64.so.1 -X -EL -maarch64linux --fix-cortex-a53-843419 -pie -z now -z relro -o hello /usr/lib/gcc/aarch64-linux-gnu/11/../../../aarch64-linux-gnu/Scrt1.o /usr/lib/gcc/aarch64-linux-gnu/11/../../../aarch64-linux-gnu/crti.o /usr/lib/gcc/aarch64-linux-gnu/11/crtbeginS.o -L/usr/lib/rustlib/aarch64-unknown-linux-gnu/lib -L/usr/lib/rustlib/aarch64-unknown-linux-gnu/lib -L/usr/lib/gcc/aarch64-linux-gnu/11 -L/usr/lib/gcc/aarch64-linux-gnu/11/../../../aarch64-linux-gnu -L/usr/lib/gcc/aarch64-linux-gnu/11/../../../../lib -L/lib/aarch64-linux-gnu -L/lib/../lib -L/usr/lib/aarch64-linux-gnu -L/usr/lib/../lib -L/usr/lib/gcc/aarch64-linux-gnu/11/../../.. /tmp/rustc4fdpuV/symbols.o hello.hello.f76cf86e-cgu.0.rcgu.o hello.hello.f76cf86e-cgu.1.rcgu.o hello.hello.f76cf86]
Num threads = 14
Num process = 4
Max PSS: 131,376,128 bytes
Walltime: 197ms - user-space: 134ms - kernel-space: 67ms</pre>


<pre>133┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
   ┃                                                  ████████████████████████████████   ┃
   ┃                                     █████████████████████████████████████████████   ┃
   ┃                         █        ████████████████████████████████████████████████   ┃
   ┃                     █████      ██████████████████████████████████████████████████   ┃
   ┃                   ███████   █████████████████████████████████████████████████████   ┃
   ┃                  █████████████████████████████████████████████████████████████████  ┃
   ┃                 ██████████████████████████████████████████████████████████████████  ┃
   ┫                 ██████████████████████████████████████████████████████████████████  ┃
   ┃               ████████████████████████████████████████████████████████████████████  ┃
   ┃              █████████████████████████████████████████████████████████████████████  ┃
   ┃             ████████████████████████████████████████████████████████████████████████┃
   ┃           ██████████████████████████████████████████████████████████████████████████┃
   ┃        █████████████████████████████████████████████████████████████████████████████┃
   ┃     ████████████████████████████████████████████████████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
0MB┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
   0ms                                                                                 220</pre>

<p>Notice that fourteen threads were created. Ten of then are coming from <code>rustc</code>.</p>




<p>javac helloworld.java</p><hr><pre><b>$</b> cat HelloWorld.java 
class HelloWorld {
    public static void main(String[] args) {
        System.out.println("Hello, World!"); 
    }
}
<b>$</b> sudo st javac HelloWorld.java
<span><span>EXEC</span>:</span>: [ javac HelloWorld.java]
Num threads = 23
Num process = 1
Max PSS: 75,673,600 bytes
Walltime: 272ms - user-space: 472ms - kernel-space: 48ms</pre>


<pre> 75┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
   ┃                                                                          ███████████┃
   ┃                                                               ██████████████████████┃
   ┃                                                       ██████████████████████████████┃
   ┃                                             ████████████████████████████████████████┃
   ┃                                      ███████████████████████████████████████████████┃
   ┃                               ██████████████████████████████████████████████████████┃
   ┃                        █████████████████████████████████████████████████████████████┃
   ┫                 ████████████████████████████████████████████████████████████████████┃
   ┃             ████████████████████████████████████████████████████████████████████████┃
   ┃          ███████████████████████████████████████████████████████████████████████████┃
   ┃       ██████████████████████████████████████████████████████████████████████████████┃
   ┃       ██████████████████████████████████████████████████████████████████████████████┃
   ┃       ██████████████████████████████████████████████████████████████████████████████┃
   ┃   ██████████████████████████████████████████████████████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
0MB┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
   0ms                                                                                 263</pre>


<p>Since the compiler is written in Java, I was expecting to see a second process, execing something like <code>java -cp javac.jar java.tools.Javac ...</code>. Surprisingly, javac is actually a JNI wrapper which acts as a launcher<a name="back_3" href="#footnote_3"><sup>[3]</sup></a>. It instantiates a VM in-process and there is no fork/exec needed.</p>


<p>Also surprising is the number of threads created. Although the next test shows that it is probably just a thread pool created at startup regardless of what the VM actually does.</p>


<p>java Helloworld</p><hr><pre><b>$</b> sudo st java -cp . HelloWorld
<span>EXEC</span>: [ java -cp /home/leaf HelloWorld]
Hello, World!
Num threads = 19
Num process = 1
Max PSS: 30,813,184 bytes
Walltime: 38ms - user-space: 10ms - kernel-space: 21ms</pre>


<pre> 30┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
   ┃                                                                   █████████████     ┃
   ┃                                                          ██████████████████████     ┃
   ┃                                                   █████████████████████████████     ┃
   ┃                                      ██████████████████████████████████████████     ┃
   ┃                                      ██████████████████████████████████████████     ┃
   ┃                                   █████████████████████████████████████████████     ┃
   ┃                                   █████████████████████████████████████████████     ┃
   ┫                                 ███████████████████████████████████████████████     ┃
   ┃                             ███████████████████████████████████████████████████     ┃
   ┃                          ███████████████████████████████████████████████████████████┃
   ┃                      ███████████████████████████████████████████████████████████████┃
   ┃                    █████████████████████████████████████████████████████████████████┃
   ┃                 ████████████████████████████████████████████████████████████████████┃
   ┃             ████████████████████████████████████████████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
0MB┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
   0ms                                                                                  38</pre>

<p>Same elevated number of thread as <code>javac</code>. Likely, <code>javac</code> only created four threads (23-19=4).</p>

<p>go build helloworld.go</p><hr><p><code>go</code> stood up to its reputation of being fast. It generated an executable in 54ms while using only 15MiB of RAM. In this limited helloworld study, it is both the fastest and the least RAM hungry compiler.</p>

<!-- HTML generated using hilite.me -->
<pre><span>package</span> main
<span>import</span> <span>"fmt"</span>
<span>func</span> main() {
    fmt.Println(<span>"hello world"</span>)
}
</pre>


<pre><b>$</b> sudo st go build helloworld.go 
<span><span>EXEC</span>:</span>: [ go build helloworld.go]
Num threads = 9
Num process = 1
Max PSS: 15,591,424 bytes
Walltime: 54ms - user-space: 25ms - kernel-space: 39ms
</pre>


<pre> 15┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
   ┃                                                █████████████████████████████████████┃
   ┃                                      ███████████████████████████████████████████████┃
   ┃                                    █████████████████████████████████████████████████┃
   ┃                                █████████████████████████████████████████████████████┃
   ┃                                █████████████████████████████████████████████████████┃
   ┃                           ██████████████████████████████████████████████████████████┃
   ┃                         ████████████████████████████████████████████████████████████┃
   ┫                         ████████████████████████████████████████████████████████████┃
   ┃                      ███████████████████████████████████████████████████████████████┃
   ┃                      ███████████████████████████████████████████████████████████████┃
   ┃                      ███████████████████████████████████████████████████████████████┃
   ┃                █████████████████████████████████████████████████████████████████████┃
   ┃        █████████████████████████████████████████████████████████████████████████████┃
   ┃      ███████████████████████████████████████████████████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
0MB┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
   0ms                                                                                  53</pre>



<p>Golang relies heavily on goroutines, I was surprised to see nine threads being used on a four core system. Something to look into someday.</p>






<p>Opening Chromium</p><hr><pre><b>$</b> sudo st chromium --headless https://fabiensanglard.net/index.html
<span>EXEC</span>: [ chromium https://fabiensanglard.net/index.html]
<span>EXEC</span>: [ chromium https://fabiensanglard.net/index.html]
<span>EXEC</span>: [/snap/snapd/20102/usr/lib/snapd/snap-seccomp version-info ]
Num threads = 21
Num process = 2
Max PSS: 32,493,568 bytes
Walltime: 51ms - user-space: 639ms - kernel-space: 565ms
</pre>


<pre> 32┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
   ┃                                                                                     ┃
   ┃                                                                                     ┃
   ┃                                                                                     ┃
   ┃                                                                                     ┃
   ┃           █                                                                         ┃
   ┃           █                                                                         ┃
   ┃           █ ████████████████████████████████████████████████████████████████████████┃
   ┫           ██████████████████████████████████████████████████████████████████████████┃
   ┃          ███████████████████████████████████████████████████████████████████████████┃
   ┃     █    ███████████████████████████████████████████████████████████████████████████┃
   ┃   ████ █████████████████████████████████████████████████████████████████████████████┃
   ┃   ████ █████████████████████████████████████████████████████████████████████████████┃
   ┃   ████ █████████████████████████████████████████████████████████████████████████████┃
   ┃  ███████████████████████████████████████████████████████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
0MB┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
   0ms                                                                                 280</pre>

<p>The process spawned by Chromium is for the GPU render. It looks like it also executed a command to check the version of <a href="https://en.wikipedia.org/wiki/Seccomp">seccomp</a> before sandboxing the GPU.</p>


<p>curl</p><hr><pre><b>$</b> sudo st curl https://fabiensanglard.net/index.html 
<span>EXEC</span>: [ curl https://fabiensanglard.net/index.html]
Num threads = 2
Num process = 1
Max PSS: 4,878,336 bytes
Walltime: 356ms - user-space: 47ms - kernel-space: 7ms
</pre>


<pre>  4┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
   ┃                                █████████████████████████████████████████████████████┃
   ┃                             ████████████████████████████████████████████████████████┃
   ┃                         ████████████████████████████████████████████████████████████┃
   ┃                       ██████████████████████████████████████████████████████████████┃
   ┃                       ██████████████████████████████████████████████████████████████┃
   ┃                       ██████████████████████████████████████████████████████████████┃
   ┃   ██████████████████████████████████████████████████████████████████████████████████┃
   ┫   ██████████████████████████████████████████████████████████████████████████████████┃
   ┃   ██████████████████████████████████████████████████████████████████████████████████┃
   ┃   ██████████████████████████████████████████████████████████████████████████████████┃
   ┃  ███████████████████████████████████████████████████████████████████████████████████┃
   ┃  ███████████████████████████████████████████████████████████████████████████████████┃
   ┃  ███████████████████████████████████████████████████████████████████████████████████┃
   ┃ ████████████████████████████████████████████████████████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
0MB┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
   0ms                                                                                 356</pre>


<p>wget</p><hr><pre><b>$</b> sudo st wget https://fabiensanglard.net/index.html 
<span>EXEC</span>: [ wget https://fabiensanglard.net/index.html]
Num threads = 1
Num process = 1
Max PSS: 2,942,976 bytes
Walltime: 348ms - user-space: 8ms - kernel-space: 8ms
</pre>


<pre>  2┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
   ┃                                        █████████████████████████████████████████████┃
   ┃                      ███████████████████████████████████████████████████████████████┃
   ┃   ██████████████████████████████████████████████████████████████████████████████████┃
   ┃   ██████████████████████████████████████████████████████████████████████████████████┃
   ┃   ██████████████████████████████████████████████████████████████████████████████████┃
   ┃   ██████████████████████████████████████████████████████████████████████████████████┃
   ┃   ██████████████████████████████████████████████████████████████████████████████████┃
   ┫   ██████████████████████████████████████████████████████████████████████████████████┃
   ┃  ███████████████████████████████████████████████████████████████████████████████████┃
   ┃  ███████████████████████████████████████████████████████████████████████████████████┃
   ┃  ███████████████████████████████████████████████████████████████████████████████████┃
   ┃  ███████████████████████████████████████████████████████████████████████████████████┃
   ┃ ████████████████████████████████████████████████████████████████████████████████████┃
   ┃ ████████████████████████████████████████████████████████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
0MB┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
   0ms                                                                                 348</pre>

<p><code>wget</code> seems to use less RAM than <code>curl</code>. Also, it uses one thread instead of two.</p>



<p>git make</p><hr>
<p>Let's build a medium size project, <code>git</code>, with <code>make</code>.</p>

<pre><b>$</b> sudo apt-get install dh-autoreconf libcurl4-gnutls-dev libexpat1-dev gettext libz-dev libssl-dev
<b>$</b> sudo apt-get install asciidoc xmlto docbook2x
<b>$</b> gh repo clone git/git
<b>$</b> cd git
<b>$</b> make configure
<b>$</b> ./configure --prefix=/usr
<b>$</b> sudo st make all
...
</pre>

<pre>Num threads = 3,155
Num process = 3,155
Max PSS: 144,361,472 bytes
Walltime: 95,427ms - user-space: 83,485ms - kernel-space: 10,995ms
</pre>


<pre>144┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
   ┃                                                                                     ┃
   ┃                                                                                     ┃
   ┃                                                                                     ┃
   ┃                                                                                     ┃
   ┃                                                                                     ┃
   ┃                                   █                                                 ┃
   ┃  █        █                       █                              █                  ┃
   ┫  █        ██       █             ███             █        █      █                  ┃
   ┃  █ █ ███  ███ █    ██ █     ███  ███     █  █    █ █ █ █  ██  █  █ ██  █            ┃
   ┃ ████ ████████ ██ █████████████████████  ███ ██  ██████ ██ █████ █████████   █       ┃
   ┃ ██████████████████████████████████████████████████████████████████████████  ████████┃
   ┃████████████████████████████████████████████████████████████████████████████ ████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
0MB┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
   0s                                                                                   95</pre>

<p>git make -j8</p><hr><p>Let's observe how parallel compilation, <code>-j4</code>,trades walltime with RAM/cores.</p>

<pre><b>$</b> git clean
<b>$</b> sudo st make <span>-j4</span> all
...
Num threads = 3155
Num process = 3155
Max PSS: 288,531,456 bytes
Walltime: 27,556ms - user-space: 90,311ms - kernel-space: 11,458ms
</pre>


<pre>
288┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
   ┃                                                                                     ┃
   ┃                                                                                     ┃
   ┃               █                                  █                                  ┃
   ┃               █     █                █           █                                  ┃
   ┃     █       █ █     ██       █    █ ██           █       █      █                   ┃
   ┃    ██ █     ███     ██       █  ██████      █    █ █ █   █      █                   ┃
   ┃   ███ ████ ████     ███      ██ ██████   █  █   ██ █ █  ████  █████  █              ┃
   ┫  ████ ████ █████ █ ███████████████████  ██  █  █████ ██ ██████████████  █           ┃
   ┃  █████████████████████████████████████ ██████  ██████████████████████████   █       ┃
   ┃  ████████████████████████████████████████████████████████████████████████   ██ ███  ┃
   ┃  █████████████████████████████████████████████████████████████████████████  ███████ ┃
   ┃  █████████████████████████████████████████████████████████████████████████ █████████┃
   ┃  █████████████████████████████████████████████████████████████████████████ █████████┃
   ┃ ██████████████████████████████████████████████████████████████████████████ █████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
0MB┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
   0s                                                                                   27</pre>

<p>Using four cores, dropped runtime nearly linearly (3.5) and doubled RAM usage.</p>

<p>m</p><hr><p>The latest command I wanted to observe was <code>m</code> which builds AOSP.</p>
<pre><b>$</b> cd aosp_24
<b>$</b> cat &gt; source build/envsetup.sh
source build/envsetup.sh
lunch aosp_arm64-eng
m -j8
<b>$</b> chmod +x make.sh
<b>$</b> sudo st make.sh
...
</pre>
<pre>Num threads = 136,305
Num process = 132,891
Max PSS: 6,152,478,720 bytes
Walltime: 700864ms - user-space: 9942532ms - kernel-space: 900950ms
</pre>


<pre>  6┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
   ┃                                                                                     ┃
   ┃                                                                                     ┃
   ┃                                       █                                             ┃
   ┃                                      ██                                       █     ┃
   ┃                  █████               ███                     █                █     ┃
   ┃                  ███████         ███████                     █ █   █          ██    ┃
   ┃                  ███████████ █ █ ███████                     █ █████          ██    ┃
   ┫                  ███████████████████████                     ████████         ██    ┃
   ┃                 ████████████████████████          ██         ████████         ██    ┃
   ┃          █ █   █████████████████████████        ██████   █   ██████████   █ █ ███ ██┃
   ┃          █ ██ ██████████████████████████        ██████████ █ ██████████████ ████████┃
   ┃  █   ███ ████████████████████████████████       ████████████████████████████████████┃
   ┃ ████ ███████████████████████████████████████   █████████████████████████████████████┃
   ┃ ████████████████████████████████████████████████████████████████████████████████████┃
   ┃█████████████████████████████████████████████████████████████████████████████████████┃
0GB┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
   0s                                                                                  700</pre>

<p>6 GiB and 11 minutes to build a whole OS with 8 cores. Not bad at all!</p>


<p>st internals</p><hr><p>Before writing the tool, I considered relying on <code><a href="https://man7.org/linux/man-pages/man1/time.1.html">time(1)</a></code> and <code>strace(1)</code>. However I was not completely satisfied with them. If <code>time(1)</code> invoked via <code>/usr/bin/time -v</code> could retrieve child processes stats and show peak RSS, I wanted PSS. Also, I wanted to see PSS over time.</p>

<p>Likewise, <code>strace -f</code> could follow child processes but it had a tremendous performance overhead and did not show the command invoked by <code>clone</code> upon fork/thread creation.</p>

<p>In the end, I wrote my own tool and called it <code>st</code> (for space-time). The data sources are as follows.</p>

<ul>
<li>CPU time/ Kernel time relies on <code><a href="https://linux.die.net/man/2/waitpid">waitpid(2)</a></code> and <code><a href="https://man7.org/linux/man-pages/man2/getrusage.2.html">getrusage(2)</a></code>.</li>

<li>PSS over time relies on sampling <code><a href="https://man7.org/linux/man-pages/man5/proc.5.html">proc(5)</a></code>(<code>/proc/PID/smaps</code>) on a regular interval.</li>

<li>Following process/thread creation is done via <code><a href="https://man7.org/linux/man-pages/man7/netlink.7.html">netlink(7)</a></code>.</li>

</ul>

<p>Working with netlink</p><hr><p>Following processes lifecycle via netlink proved more challenging than expected, mainly because of poor documentation (maybe because netlink needs <code>root</code> anyway?). If I managed to dig out <a href="https://fabiensanglard.net/st/process-events.txt">process-events.txt</a> from a mailing list and found a working sample <a href="https://fabiensanglard.net/st/exec-notify.c">exec-notify.c</a>, there wasn't much more around.</p>

<p>One series of articles did stand out. Natan Yellin's blog<a name="back_4" href="#footnote_4"><sup>[4]</sup></a><a name="back_5" href="#footnote_5"><sup>[5]</sup></a><a name="back_6" href="#footnote_6"><sup>[6]</sup></a><a name="back_7" href="#footnote_7"><sup>[7]</sup></a>. is a gem. Among many excellent insights, he clarified<a name="back_8" href="#footnote_8"><sup>[8]</sup></a> the less than intuitive values provided by netlink for parent-gid and parent-pid which saved me a lot of time.

</p>

<p>Hopefully, <code>st</code>'s(<a href="https://github.com/fabiensanglard/st">source code</a>) will add a little extra clarity to <code>netlink</code>.</p>


<p>References</p><hr><p id="paperbox"><table><tbody><tr><td><a name="footnote_1"></a><a href="#back_1">^</a></td><td> [1]</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=627591">Firefox Bugzilla: Preload dlls on windows</a></td></tr><tr><td><a name="footnote_2"></a><a href="#back_2">^</a></td><td> [2]</td><td><a href="https://binary.ninja/">Binary Ninja</a></td></tr><tr><td><a name="footnote_3"></a><a href="#back_3">^</a></td><td> [3]</td><td><a href="https://gist.github.com/mauricio/2310831">java-launcher.c</a></td></tr><tr><td><a name="footnote_4"></a><a href="#back_4">^</a></td><td> [4]</td><td><a href="https://natanyellin.com/posts/life-and-death-of-a-linux-process">
Life and Death of a Linux Process</a></td></tr><tr><td><a name="footnote_5"></a><a href="#back_5">^</a></td><td> [5]</td><td><a href="https://natanyellin.com/posts/using-linux-audit-to-track-processes">
Using the Linux Audit API to Track Processes</a></td></tr><tr><td><a name="footnote_6"></a><a href="#back_6">^</a></td><td> [6]</td><td><a href="https://natanyellin.com/posts/buggy-netlink-process-connectors">
When Netlink Process Connectors Don’t Process</a></td></tr><tr><td><a name="footnote_7"></a><a href="#back_7">^</a></td><td> [7]</td><td><a href="https://natanyellin.com/posts/tracking-running-processes-on-linux">
The Difficulties of Tracking Running Processes on Linux</a></td></tr><tr><td><a name="footnote_8"></a><a href="#back_8">^</a></td><td> [8]</td><td><a href="https://natanyellin.com/posts/understanding-netlink-process-connector-output">
Understanding Netlink Process Connector Output</a></td></tr></tbody></table></p> <hr>
 <center>*</center></div>]]></description>
        </item>
        <item>
            <title><![CDATA[macOS Sonoma is available today (247 pts)]]></title>
            <link>https://www.apple.com/newsroom/2023/09/macos-sonoma-is-available-today/</link>
            <guid>37662510</guid>
            <pubDate>Tue, 26 Sep 2023 17:12:17 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.apple.com/newsroom/2023/09/macos-sonoma-is-available-today/">https://www.apple.com/newsroom/2023/09/macos-sonoma-is-available-today/</a>, See on <a href="https://news.ycombinator.com/item?id=37662510">Hacker News</a></p>
<div id="readability-page-1" class="page">


	
    







 
<nav id="ac-localnav" lang="en-US" role="navigation" aria-label="Newsroom" data-analytics-region="local nav" data-sticky="">
	
    
    
        




    
    

</nav>



<main id="main" role="main"> 



<span id="opens-in-new-window">opens in new window</span>

	

<section>
<article data-analytics-activitymap-region-id="article">






    
    
    











    <div>
        

        <div>
                    
                    
                        <span>UPDATE</span>
                    
                    
                        <span>September 26, 2023</span>
                    
                    
                </div>

        <div>
                
                
                
                    <h2>
                        
    
        macOS Sonoma is available today
    

                    </h2>
                
            </div>

        

        
            
    
    
    
    
    

        

    </div>







    
    
    






  
    
    
    
    
      <figure aria-label="Media, macOS Sonoma displayed on MacBook Pro, the 27-inch iMac, and MacBook Air.">
        <div>
             
              
              <div>
                macOS Sonoma makes the Mac experience better than ever — from more ways to personalize with widgets, to big updates to Safari and video conferencing, along with optimized gaming.
              </div>
            
            
            
            
            <a href="https://www.apple.com/newsroom/images/2023/09/macos-sonoma-is-available-today/article/Apple-macOS-Sonoma-3up.zip" download="" data-analytics-title="Download image" aria-label="Download media, macOS Sonoma displayed on MacBook Pro, the 27-inch iMac, and MacBook Air."></a>
          </div>
      </figure>
    
  






    
    
    


     
     
    
    
        <div>
             
                 <div><a href="https://www.apple.com/macos/sonoma/" target="_blank">macOS Sonoma</a> is now available as a free software update, bringing a rich set of new features to the Mac that make work and play even more powerful. With macOS Sonoma, desktop widgets unlock a new way to personalize the Mac and get more done, while stunning new screen savers, big updates to video conferencing and Safari, along with optimized gaming make the Mac experience better than ever.<br>

</div>
                 
             
                 <h2>Widgets and Stunning Screen Savers
</h2>
                 
             
                 <div>With macOS Sonoma, widgets can be placed right on the desktop and blend seamlessly with the wallpaper while other windows are open. Widgets also become interactive so users can complete a reminder, play or pause media, access home controls, and perform various tasks directly from the widget on their desktop. And through the magic of Continuity, users can further customize their Mac with widgets from their iPhone.
</div>
                 
             
         </div>
 

    
    
    






  
    
    
    
    
      <figure aria-label="Media, A collection of widgets displayed on MacBook Pro with macOS Sonoma.">
        <div>
             
              
              <div>
                Users can personalize their desktop with widgets, and with Continuity, they can even add their iPhone widgets to their Mac desktop.
              </div>
            
            
            
            
            <a href="https://www.apple.com/newsroom/images/2023/09/macos-sonoma-is-available-today/article/Apple-macOS-Sonoma-Widgets.zip" download="" data-analytics-title="Download image" aria-label="Download media, A collection of widgets displayed on MacBook Pro with macOS Sonoma."></a>
          </div>
      </figure>
    
  






    
    
    


     
     
    
    
        <div>A new selection of screen savers in macOS Sonoma features slow-motion videos of beautiful locations around the world, such as the sweeping skyline of Hong Kong, the sandstone buttes of Monument Valley in Arizona, and the rolling hills of Sonoma in Northern California. And after login, the screen savers seamlessly transition to become the desktop wallpaper.
</div>
 

    
    
    


    
    <div data-component-list="ScrollAnimationDefault AutoPlayVideo">
        <div>A new selection of screen savers in macOS Sonoma shows slow-motion videos of some of the most beautiful locations around the world.</div>
        
            <a aria-label="Download video: macOS Sonoma Screen Saver" data-analytics-title="Download video - macOS Sonoma Screen Saver" download="" href="https://www.apple.com/newsroom/videos/apple-macos-sonoma-screen-saver/downloads/Apple-macOS-Sonoma-screen-saver.zip">
            </a>
        
    </div>






    
    
    


     
     
    
    
        <div>
             
                 <h2>Powerful Productivity for Video Conferencing
</h2>
                 
             
                 <div>macOS Sonoma brings enhanced video conferencing features that enable users to present and share their work more effectively within any video conferencing app. Presenter Overlay displays users in front of the content they are sharing, and Reactions allow users to share how they feel with simple hand gestures that trigger fun, frame-filling 3D effects like balloons, confetti, hearts, and more.
</div>
                 
             
         </div>
 

    
    
    


    
    
        
        
        
            <div role="group" aria-label="gallery" data-component-list="MixinGallery" id="video-conferencing">
            <nav role="presentation">
                <ul role="tablist">
                    
                        <li role="presentation">
                            <a id="gallery-dotnav-cd3c7cce41feeadca525a4198744a00d" href="#gallery-cd3c7cce41feeadca525a4198744a00d" data-ac-gallery-trigger="gallery-cd3c7cce41feeadca525a4198744a00d"><span>A video conference call on MacBook Pro shows a presenter in front of a document they’re showing.</span></a>
                        </li>
                    
                        <li role="presentation">
                            <a id="gallery-dotnav-73d7ac7d6ab2c5b0311ab299cd09aa3e" href="#gallery-73d7ac7d6ab2c5b0311ab299cd09aa3e" data-ac-gallery-trigger="gallery-73d7ac7d6ab2c5b0311ab299cd09aa3e"><span>A Zoom meeting on MacBook Pro shows fireworks behind a presenter.</span></a>
                        </li>
                    
                </ul>
            </nav>
            <div>
                
                    
                        
                        <div id="gallery-cd3c7cce41feeadca525a4198744a00d" aria-labelledby="gallery-dotnav-cd3c7cce41feeadca525a4198744a00d" data-gallery-item="">
                            <figure role="presentation" data-analytics-activitymap-region-id="Gallery:presenter-overlay">
                                
                                <div>
                                    <div>Video conference calls get more engaging with new features like Presenter Overlay, which displays users in front of the content they are sharing.</div>
                                    
                                    
                                    <a href="https://www.apple.com/newsroom/images/2023/09/macos-sonoma-is-available-today/article/Apple-macOS-Sonoma-Zoom-Presenter-Overlay.zip" download="" data-analytics-title="Download image" aria-label="Download media, A video conference call on MacBook Pro shows a presenter in front of a document they’re showing."></a>
                                </div>
                            </figure>
                        </div>
                        
                    
                
                    
                        
                        <div id="gallery-73d7ac7d6ab2c5b0311ab299cd09aa3e" aria-labelledby="gallery-dotnav-73d7ac7d6ab2c5b0311ab299cd09aa3e" data-gallery-item="">
                            <figure role="presentation" data-analytics-activitymap-region-id="Gallery:reactions">
                                
                                <div>
                                    <div>Reactions allow users to share how they feel with simple hand gestures that trigger fun, frame-filling 3D effects like balloons, confetti, hearts, and more. </div>
                                    
                                    
                                    <a href="https://www.apple.com/newsroom/images/2023/09/macos-sonoma-is-available-today/article/Apple-macOS-Sonoma-Zoom-Reactions.zip" download="" data-analytics-title="Download image" aria-label="Download media, A Zoom meeting on MacBook Pro shows fireworks behind a presenter."></a>
                                </div>
                            </figure>
                        </div>
                        
                    
                
            </div>
            
                
                
                <nav role="presentation">
                    
                        <ul>
                            <li>
                                
                            </li>
                            <li>
                                
                            </li>
                        </ul>
                    
                </nav>
            
        </div>
    


    
    
    


     
     
    
    
        <div>
             
                 <h2>Enhanced Browsing with Safari
</h2>
                 
             
                 <div>In Safari, profiles keep browsing separate between topics like work, school, and more so users can quickly switch between them. Private Browsing gets even better with added protection against some of the most advanced techniques used to track users — Private Browsing windows become locked when not in use and known trackers are blocked from loading. Safari users can also now add any website to the Dock as they would with an app, complete with a simplified toolbar and notifications for an app-like experience.
</div>
                 
             
         </div>
 

    
    
    






  
    
    
    
    
      <figure aria-label="Media, MacBook Pro displays two profiles: one labeled School and the other labeled Home.">
        <div>
             
              
              <div>
                Profiles keep browsing separate between topics like work, school, and more so users can quickly switch between them.
              </div>
            
            
            
            
            <a href="https://www.apple.com/newsroom/images/2023/09/macos-sonoma-is-available-today/article/Apple-macOS-Sonoma-profiles.zip" download="" data-analytics-title="Download image" aria-label="Download media, MacBook Pro displays two profiles: one labeled School and the other labeled Home."></a>
          </div>
      </figure>
    
  






    
    
    


     
     
    
    
        <div>
             
                 <h2>An Immersive Gaming Experience<br>

</h2>
                 
             
                 <div>With the power of Apple silicon, tens of millions of Macs can run demanding games with great performance, long battery life, and breathtaking visuals. macOS Sonoma improves the gaming experience even further with Game Mode, providing more consistent frame rates and dramatically reducing input and audio latency with wireless game controllers and AirPods.<sup> </sup>Game Mode works with any game, including recent and upcoming Mac games like DEATH STRANDING DIRECTOR’S CUT, Stray, Layers of Fear, and SnowRunner.
</div>
                 
             
         </div>
 

    
    
    






  
    
    
    
    
      <figure aria-label="Media, MacBook Pro displays a screen from the video game Stray.">
        <div>
             
              
              <div>
                In macOS Sonoma, Game Mode provides more consistent frame rates and dramatically reduced input and audio latency with wireless game controllers and AirPods.
              </div>
            
            
            
            
            <a href="https://www.apple.com/newsroom/images/2023/09/macos-sonoma-is-available-today/article/Apple-macOS-Sonoma-gaming.zip" download="" data-analytics-title="Download image" aria-label="Download media, MacBook Pro displays a screen from the video game Stray."></a>
          </div>
      </figure>
    
  






    
    
    


     
     
    
    
        <div>
             
                 <h2><strong>Additional macOS Sonoma Updates</strong>
</h2>
                 
             
                 <div><ul>
<li><strong>Notes</strong>:<strong> </strong>Users can view PDFs and scans of presentations, assignments, research papers, and more right inside Notes. They can also create links from one note to another to relate ideas and content.</li>
</ul>
</div>
                 
             
                 <div><ul>
<li><strong>Passwords</strong>:<strong> </strong>A set of passwords can now be shared among a group. Everyone in a group can add and edit passwords to keep them up to date, and since sharing is through iCloud Keychain, it’s end-to-end encrypted. Additionally, the one-time verification codes received in Mail will now autofill in Safari, making it easy to securely log in without leaving the browser.</li>
</ul>
</div>
                 
             
                 <div><ul>
<li><strong>Messages</strong>: Search filters and swipe to reply enhance everyday messaging, while all-new Live Stickers can be created and synced across macOS, iOS, and iPadOS.</li>
</ul>
</div>
                 
             
                 <div><ul>
<li><strong>Reminders</strong>:<strong> </strong>Intelligent grocery lists in Reminders streamline weekly trips to the store by organizing lists into sections and arranging them horizontally using a new column view.</li>
</ul>
</div>
                 
             
                 <div><ul>
<li><strong>Keyboard</strong>:<strong> </strong>Autocorrect receives a comprehensive update with a transformer language model, a state-of-the-art on-device machine learning language model that improves accuracy. A refreshed design makes corrections easier to fix and inline predictions quickly finish sentences. Dictation brings next-level speech recognition and the ability to move fluidly between voice and typing.</li>
</ul>
</div>
                 
             
                 <div><ul>
<li><strong>Screen Sharing:&nbsp; </strong>A new high performance mode in the Screen Sharing app delivers incredibly responsive remote access over high-bandwidth connections — enabling creative professionals to accomplish their work remotely.</li>
</ul>
</div>
                 
             
         </div>
 

    
    
    


     
     
    
    
        <div>macOS Sonoma is a free software update that is available starting today. Some features may not be available in all regions, languages, or on all devices. For more information and a full list of features, visit <a href="https://www.apple.com/macos/sonoma/" target="_blank">apple.com/macos/sonoma</a>.
</div>
 

    
    
    




    
    
        
    


    
    
    



    
    
    






    
















	
	
	
		















	
	

</article>



</section>
</main>


	

</div>]]></description>
        </item>
        <item>
            <title><![CDATA[Show HN: Magentic – Use LLMs as simple Python functions (194 pts)]]></title>
            <link>https://github.com/jackmpcollins/magentic</link>
            <guid>37661767</guid>
            <pubDate>Tue, 26 Sep 2023 16:31:16 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/jackmpcollins/magentic">https://github.com/jackmpcollins/magentic</a>, See on <a href="https://news.ycombinator.com/item?id=37661767">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text"><h2 tabindex="-1" id="user-content-magentic" dir="auto"><a href="#magentic">magentic</a></h2>
<p dir="auto">Easily integrate Large Language Models into your Python code. Simply use the <code>@prompt</code> decorator to create functions that return structured output from the LLM. Mix LLM queries and function calling with regular Python code to create complex logic.</p>
<p dir="auto"><code>magentic</code> is</p>
<ul dir="auto">
<li><strong>Compact:</strong> Query LLMs without duplicating boilerplate code.</li>
<li><strong>Atomic:</strong> Prompts are functions that can be individually tested and reasoned about.</li>
<li><strong>Transparent:</strong> Create "chains" using regular Python code. Define all of your own prompts.</li>
<li><strong>Compatible:</strong> Use <code>@prompt</code> functions as normal functions, including with decorators like <code>@lru_cache</code>.</li>
<li><strong>Type Annotated:</strong> Works with linters and IDEs.</li>
</ul>
<p dir="auto">Continue reading for sample usage, or go straight to the <a href="https://github.com/jackmpcollins/magentic/blob/main/examples">examples directory</a>.</p>
<h2 tabindex="-1" id="user-content-installation" dir="auto"><a href="#installation">Installation</a></h2>

<p dir="auto">or using poetry</p>

<p dir="auto">Configure your OpenAI API key by setting the <code>OPENAI_API_KEY</code> environment variable or using <code>openai.api_key = "sk-..."</code>. See the <a href="https://github.com/openai/openai-python#usage">OpenAI Python library documentation</a> for more information.</p>
<h2 tabindex="-1" id="user-content-usage" dir="auto"><a href="#usage">Usage</a></h2>
<p dir="auto">The <code>@prompt</code> decorator allows you to define a template for a Large Language Model (LLM) prompt as a Python function. When this function is called, the arguments are inserted into the template, then this prompt is sent to an LLM which generates the function output.</p>
<div dir="auto" data-snippet-clipboard-copy-content="from magentic import prompt


@prompt('Add more &quot;dude&quot;ness to: {phrase}')
def dudeify(phrase: str) -> str:
    ...  # No function body as this is never executed


dudeify(&quot;Hello, how are you?&quot;)
# &quot;Hey, dude! What's up? How's it going, my man?&quot;"><pre><span>from</span> <span>magentic</span> <span>import</span> <span>prompt</span>


<span>@<span>prompt</span>(<span>'Add more "dude"ness to: {phrase}'</span>)</span>
<span>def</span> <span>dudeify</span>(<span>phrase</span>: <span>str</span>) <span>-&gt;</span> <span>str</span>:
    ...  <span># No function body as this is never executed</span>


<span>dudeify</span>(<span>"Hello, how are you?"</span>)
<span># "Hey, dude! What's up? How's it going, my man?"</span></pre></div>
<p dir="auto">The <code>@prompt</code> decorator will respect the return type annotation of the decorated function. This can be <a href="https://docs.pydantic.dev/latest/usage/types/types/" rel="nofollow">any type supported by pydantic</a> including a <code>pydantic</code> model.</p>
<div dir="auto" data-snippet-clipboard-copy-content="from magentic import prompt
from pydantic import BaseModel


class Superhero(BaseModel):
    name: str
    age: int
    power: str
    enemies: list[str]


@prompt(&quot;Create a Superhero named {name}.&quot;)
def create_superhero(name: str) -> Superhero:
    ...


create_superhero(&quot;Garden Man&quot;)
# Superhero(name='Garden Man', age=30, power='Control over plants', enemies=['Pollution Man', 'Concrete Woman'])"><pre><span>from</span> <span>magentic</span> <span>import</span> <span>prompt</span>
<span>from</span> <span>pydantic</span> <span>import</span> <span>BaseModel</span>


<span>class</span> <span>Superhero</span>(<span>BaseModel</span>):
    <span>name</span>: <span>str</span>
    <span>age</span>: <span>int</span>
    <span>power</span>: <span>str</span>
    <span>enemies</span>: <span>list</span>[<span>str</span>]


<span>@<span>prompt</span>(<span>"Create a Superhero named {name}."</span>)</span>
<span>def</span> <span>create_superhero</span>(<span>name</span>: <span>str</span>) <span>-&gt;</span> <span>Superhero</span>:
    ...


<span>create_superhero</span>(<span>"Garden Man"</span>)
<span># Superhero(name='Garden Man', age=30, power='Control over plants', enemies=['Pollution Man', 'Concrete Woman'])</span></pre></div>
<p dir="auto">An LLM can also decide to call functions. In this case the <code>@prompt</code>-decorated function returns a <code>FunctionCall</code> object which can be called to execute the function using the arguments provided by the LLM.</p>
<div dir="auto" data-snippet-clipboard-copy-content="from typing import Literal

from magentic import prompt, FunctionCall


def activate_oven(temperature: int, mode: Literal[&quot;broil&quot;, &quot;bake&quot;, &quot;roast&quot;]) -> str:
    &quot;&quot;&quot;Turn the oven on with the provided settings.&quot;&quot;&quot;
    return f&quot;Preheating to {temperature} F with mode {mode}&quot;


@prompt(
    &quot;Prepare the oven so I can make {food}&quot;,
    functions=[activate_oven],
)
def configure_oven(food: str) -> FunctionCall[str]:
    ...


output = configure_oven(&quot;cookies!&quot;)
# FunctionCall(<function activate_oven at 0x1105a6200>, temperature=350, mode='bake')
output()
# 'Preheating to 350 F with mode bake'"><pre><span>from</span> <span>typing</span> <span>import</span> <span>Literal</span>

<span>from</span> <span>magentic</span> <span>import</span> <span>prompt</span>, <span>FunctionCall</span>


<span>def</span> <span>activate_oven</span>(<span>temperature</span>: <span>int</span>, <span>mode</span>: <span>Literal</span>[<span>"broil"</span>, <span>"bake"</span>, <span>"roast"</span>]) <span>-&gt;</span> <span>str</span>:
    <span>"""Turn the oven on with the provided settings."""</span>
    <span>return</span> <span>f"Preheating to <span><span>{</span><span>temperature</span><span>}</span></span> F with mode <span><span>{</span><span>mode</span><span>}</span></span>"</span>


<span>@<span>prompt</span>(</span>
<span>    <span>"Prepare the oven so I can make {food}"</span>,</span>
<span>    <span>functions</span><span>=</span>[<span>activate_oven</span>],</span>
<span>)</span>
<span>def</span> <span>configure_oven</span>(<span>food</span>: <span>str</span>) <span>-&gt;</span> <span>FunctionCall</span>[<span>str</span>]:
    ...


<span>output</span> <span>=</span> <span>configure_oven</span>(<span>"cookies!"</span>)
<span># FunctionCall(&lt;function activate_oven at 0x1105a6200&gt;, temperature=350, mode='bake')</span>
<span>output</span>()
<span># 'Preheating to 350 F with mode bake'</span></pre></div>
<p dir="auto">Sometimes the LLM requires making one or more function calls to generate a final answer. The <code>@prompt_chain</code> decorator will resolve <code>FunctionCall</code> objects automatically and pass the output back to the LLM to continue until the final answer is reached.</p>
<p dir="auto">In the following example, when <code>describe_weather</code> is called the LLM first calls the <code>get_current_weather</code> function, then uses the result of this to formulate its final answer which gets returned.</p>
<div dir="auto" data-snippet-clipboard-copy-content="from magentic import prompt_chain


def get_current_weather(location, unit=&quot;fahrenheit&quot;):
    &quot;&quot;&quot;Get the current weather in a given location&quot;&quot;&quot;
    # Pretend to query an API
    return {
        &quot;location&quot;: location,
        &quot;temperature&quot;: &quot;72&quot;,
        &quot;unit&quot;: unit,
        &quot;forecast&quot;: [&quot;sunny&quot;, &quot;windy&quot;],
    }


@prompt_chain(
    &quot;What's the weather like in {city}?&quot;,
    functions=[get_current_weather],
)
def describe_weather(city: str) -> str:
    ...


describe_weather(&quot;Boston&quot;)
# 'The current weather in Boston is 72°F and it is sunny and windy.'"><pre><span>from</span> <span>magentic</span> <span>import</span> <span>prompt_chain</span>


<span>def</span> <span>get_current_weather</span>(<span>location</span>, <span>unit</span><span>=</span><span>"fahrenheit"</span>):
    <span>"""Get the current weather in a given location"""</span>
    <span># Pretend to query an API</span>
    <span>return</span> {
        <span>"location"</span>: <span>location</span>,
        <span>"temperature"</span>: <span>"72"</span>,
        <span>"unit"</span>: <span>unit</span>,
        <span>"forecast"</span>: [<span>"sunny"</span>, <span>"windy"</span>],
    }


<span>@<span>prompt_chain</span>(</span>
<span>    <span>"What's the weather like in {city}?"</span>,</span>
<span>    <span>functions</span><span>=</span>[<span>get_current_weather</span>],</span>
<span>)</span>
<span>def</span> <span>describe_weather</span>(<span>city</span>: <span>str</span>) <span>-&gt;</span> <span>str</span>:
    ...


<span>describe_weather</span>(<span>"Boston"</span>)
<span># 'The current weather in Boston is 72°F and it is sunny and windy.'</span></pre></div>
<p dir="auto">LLM-powered functions created using <code>@prompt</code> and <code>@prompt_chain</code> can be supplied as <code>functions</code> to other <code>@prompt</code>/<code>@prompt_chain</code> decorators, just like regular python functions. This enables increasingly complex LLM-powered functionality, while allowing individual components to be tested and improved in isolation.</p>
<p dir="auto">See the <a href="https://github.com/jackmpcollins/magentic/blob/main/examples">examples directory</a> for more.</p>
<h3 tabindex="-1" id="user-content-streaming" dir="auto"><a href="#streaming">Streaming</a></h3>
<p dir="auto">The <code>StreamedStr</code> (and <code>AsyncStreamedStr</code>) class can be used to stream the output of the LLM. This allows you to process the text while it is being generated, rather than receiving the whole output at once.</p>
<div dir="auto" data-snippet-clipboard-copy-content="from magentic import prompt, StreamedStr


@prompt(&quot;Tell me about {country}&quot;)
def describe_country(country: str) -> StreamedStr:
    ...


# Print the chunks while they are being received
for chunk in describe_country(&quot;Brazil&quot;):
    print(chunk, end=&quot;&quot;)
# 'Brazil, officially known as the Federative Republic of Brazil, is ...'"><pre><span>from</span> <span>magentic</span> <span>import</span> <span>prompt</span>, <span>StreamedStr</span>


<span>@<span>prompt</span>(<span>"Tell me about {country}"</span>)</span>
<span>def</span> <span>describe_country</span>(<span>country</span>: <span>str</span>) <span>-&gt;</span> <span>StreamedStr</span>:
    ...


<span># Print the chunks while they are being received</span>
<span>for</span> <span>chunk</span> <span>in</span> <span>describe_country</span>(<span>"Brazil"</span>):
    <span>print</span>(<span>chunk</span>, <span>end</span><span>=</span><span>""</span>)
<span># 'Brazil, officially known as the Federative Republic of Brazil, is ...'</span></pre></div>
<p dir="auto">Multiple <code>StreamedStr</code> can be created at the same time to stream LLM outputs concurrently. In the below example, generating the description for multiple countries takes approximately the same amount of time as for a single country.</p>
<div dir="auto" data-snippet-clipboard-copy-content="from time import time

countries = [&quot;Australia&quot;, &quot;Brazil&quot;, &quot;Chile&quot;]


# Generate the descriptions one at a time
start_time = time()
for country in countries:
    # Converting `StreamedStr` to `str` blocks until the LLM output is fully generated
    description = str(describe_country(country))
    print(f&quot;{time() - start_time:.2f}s : {country} - {len(description)} chars&quot;)

# 22.72s : Australia - 2130 chars
# 41.63s : Brazil - 1884 chars
# 74.31s : Chile - 2968 chars


# Generate the descriptions concurrently by creating the StreamedStrs at the same time
start_time = time()
streamed_strs = [describe_country(country) for country in countries]
for country, streamed_str in zip(countries, streamed_strs):
    description = str(streamed_str)
    print(f&quot;{time() - start_time:.2f}s : {country} - {len(description)} chars&quot;)

# 22.79s : Australia - 2147 chars
# 23.64s : Brazil - 2202 chars
# 24.67s : Chile - 2186 chars"><pre><span>from</span> <span>time</span> <span>import</span> <span>time</span>

<span>countries</span> <span>=</span> [<span>"Australia"</span>, <span>"Brazil"</span>, <span>"Chile"</span>]


<span># Generate the descriptions one at a time</span>
<span>start_time</span> <span>=</span> <span>time</span>()
<span>for</span> <span>country</span> <span>in</span> <span>countries</span>:
    <span># Converting `StreamedStr` to `str` blocks until the LLM output is fully generated</span>
    <span>description</span> <span>=</span> <span>str</span>(<span>describe_country</span>(<span>country</span>))
    <span>print</span>(<span>f"<span><span>{</span><span>time</span>() <span>-</span> <span>start_time</span>:.2f<span>}</span></span>s : <span><span>{</span><span>country</span><span>}</span></span> - <span><span>{</span><span>len</span>(<span>description</span>)<span>}</span></span> chars"</span>)

<span># 22.72s : Australia - 2130 chars</span>
<span># 41.63s : Brazil - 1884 chars</span>
<span># 74.31s : Chile - 2968 chars</span>


<span># Generate the descriptions concurrently by creating the StreamedStrs at the same time</span>
<span>start_time</span> <span>=</span> <span>time</span>()
<span>streamed_strs</span> <span>=</span> [<span>describe_country</span>(<span>country</span>) <span>for</span> <span>country</span> <span>in</span> <span>countries</span>]
<span>for</span> <span>country</span>, <span>streamed_str</span> <span>in</span> <span>zip</span>(<span>countries</span>, <span>streamed_strs</span>):
    <span>description</span> <span>=</span> <span>str</span>(<span>streamed_str</span>)
    <span>print</span>(<span>f"<span><span>{</span><span>time</span>() <span>-</span> <span>start_time</span>:.2f<span>}</span></span>s : <span><span>{</span><span>country</span><span>}</span></span> - <span><span>{</span><span>len</span>(<span>description</span>)<span>}</span></span> chars"</span>)

<span># 22.79s : Australia - 2147 chars</span>
<span># 23.64s : Brazil - 2202 chars</span>
<span># 24.67s : Chile - 2186 chars</span></pre></div>
<h3 tabindex="-1" id="user-content-object-streaming" dir="auto"><a href="#object-streaming">Object Streaming</a></h3>
<p dir="auto">Structured outputs can also be streamed from the LLM by using the return type annotation <code>Iterable</code> (or <code>AsyncIterable</code>). This allows each item to be processed while the next one is being generated. See the example in <a href="https://github.com/jackmpcollins/magentic/blob/main/examples/quiz">examples/quiz</a> for how this can be used to improve user experience by quickly displaying/using the first item returned.</p>
<div dir="auto" data-snippet-clipboard-copy-content="from collections.abc import Iterable
from time import time

from magentic import prompt
from pydantic import BaseModel


class Superhero(BaseModel):
    name: str
    age: int
    power: str
    enemies: list[str]


@prompt(&quot;Create a Superhero team named {name}.&quot;)
def create_superhero_team(name: str) -> Iterable[Superhero]:
    ...


start_time = time()
for hero in create_superhero_team(&quot;The Food Dudes&quot;):
    print(f&quot;{time() - start_time:.2f}s : {hero}&quot;)

# 2.23s : name='Pizza Man' age=30 power='Can shoot pizza slices from his hands' enemies=['The Hungry Horde', 'The Junk Food Gang']
# 4.03s : name='Captain Carrot' age=35 power='Super strength and agility from eating carrots' enemies=['The Sugar Squad', 'The Greasy Gang']
# 6.05s : name='Ice Cream Girl' age=25 power='Can create ice cream out of thin air' enemies=['The Hot Sauce Squad', 'The Healthy Eaters']"><pre><span>from</span> <span>collections</span>.<span>abc</span> <span>import</span> <span>Iterable</span>
<span>from</span> <span>time</span> <span>import</span> <span>time</span>

<span>from</span> <span>magentic</span> <span>import</span> <span>prompt</span>
<span>from</span> <span>pydantic</span> <span>import</span> <span>BaseModel</span>


<span>class</span> <span>Superhero</span>(<span>BaseModel</span>):
    <span>name</span>: <span>str</span>
    <span>age</span>: <span>int</span>
    <span>power</span>: <span>str</span>
    <span>enemies</span>: <span>list</span>[<span>str</span>]


<span>@<span>prompt</span>(<span>"Create a Superhero team named {name}."</span>)</span>
<span>def</span> <span>create_superhero_team</span>(<span>name</span>: <span>str</span>) <span>-&gt;</span> <span>Iterable</span>[<span>Superhero</span>]:
    ...


<span>start_time</span> <span>=</span> <span>time</span>()
<span>for</span> <span>hero</span> <span>in</span> <span>create_superhero_team</span>(<span>"The Food Dudes"</span>):
    <span>print</span>(<span>f"<span><span>{</span><span>time</span>() <span>-</span> <span>start_time</span>:.2f<span>}</span></span>s : <span><span>{</span><span>hero</span><span>}</span></span>"</span>)

<span># 2.23s : name='Pizza Man' age=30 power='Can shoot pizza slices from his hands' enemies=['The Hungry Horde', 'The Junk Food Gang']</span>
<span># 4.03s : name='Captain Carrot' age=35 power='Super strength and agility from eating carrots' enemies=['The Sugar Squad', 'The Greasy Gang']</span>
<span># 6.05s : name='Ice Cream Girl' age=25 power='Can create ice cream out of thin air' enemies=['The Hot Sauce Squad', 'The Healthy Eaters']</span></pre></div>
<h3 tabindex="-1" id="user-content-asyncio" dir="auto"><a href="#asyncio">Asyncio</a></h3>
<p dir="auto">Asynchronous functions / coroutines can be used to concurrently query the LLM. This can greatly increase the overall speed of generation, and also allow other asynchronous code to run while waiting on LLM output. In the below example, the LLM generates a description for each US president while it is waiting on the next one in the list. Measuring the characters generated per second shows that this example achieves a 7x speedup over serial processing.</p>
<div dir="auto" data-snippet-clipboard-copy-content="import asyncio
from time import time
from typing import AsyncIterable

from magentic import prompt


@prompt(&quot;List ten presidents of the United States&quot;)
async def iter_presidents() -> AsyncIterable[str]:
    ...


@prompt(&quot;Tell me more about {topic}&quot;)
async def tell_me_more_about(topic: str) -> str:
    ...


# For each president listed, generate a description concurrently
start_time = time()
tasks = []
async for president in await iter_presidents():
    # Use asyncio.create_task to schedule the coroutine for execution before awaiting it
    # This way descriptions will start being generated while the list of presidents is still being generated
    task = asyncio.create_task(tell_me_more_about(president))
    tasks.append(task)

descriptions = await asyncio.gather(*tasks)

# Measure the characters per second
total_chars = sum(len(desc) for desc in descriptions)
time_elapsed = time() - start_time
print(total_chars, time_elapsed, total_chars / time_elapsed)
# 24575 28.70 856.07


# Measure the characters per second to describe a single president
start_time = time()
out = await tell_me_more_about(&quot;George Washington&quot;)
time_elapsed = time() - start_time
print(len(out), time_elapsed, len(out) / time_elapsed)
# 2206 18.72 117.78"><pre><span>import</span> <span>asyncio</span>
<span>from</span> <span>time</span> <span>import</span> <span>time</span>
<span>from</span> <span>typing</span> <span>import</span> <span>AsyncIterable</span>

<span>from</span> <span>magentic</span> <span>import</span> <span>prompt</span>


<span>@<span>prompt</span>(<span>"List ten presidents of the United States"</span>)</span>
<span>async</span> <span>def</span> <span>iter_presidents</span>() <span>-&gt;</span> <span>AsyncIterable</span>[<span>str</span>]:
    ...


<span>@<span>prompt</span>(<span>"Tell me more about {topic}"</span>)</span>
<span>async</span> <span>def</span> <span>tell_me_more_about</span>(<span>topic</span>: <span>str</span>) <span>-&gt;</span> <span>str</span>:
    ...


<span># For each president listed, generate a description concurrently</span>
<span>start_time</span> <span>=</span> <span>time</span>()
<span>tasks</span> <span>=</span> []
<span>async</span> <span>for</span> <span>president</span> <span>in</span> <span>await</span> <span>iter_presidents</span>():
    <span># Use asyncio.create_task to schedule the coroutine for execution before awaiting it</span>
    <span># This way descriptions will start being generated while the list of presidents is still being generated</span>
    <span>task</span> <span>=</span> <span>asyncio</span>.<span>create_task</span>(<span>tell_me_more_about</span>(<span>president</span>))
    <span>tasks</span>.<span>append</span>(<span>task</span>)

<span>descriptions</span> <span>=</span> <span>await</span> <span>asyncio</span>.<span>gather</span>(<span>*</span><span>tasks</span>)

<span># Measure the characters per second</span>
<span>total_chars</span> <span>=</span> <span>sum</span>(<span>len</span>(<span>desc</span>) <span>for</span> <span>desc</span> <span>in</span> <span>descriptions</span>)
<span>time_elapsed</span> <span>=</span> <span>time</span>() <span>-</span> <span>start_time</span>
<span>print</span>(<span>total_chars</span>, <span>time_elapsed</span>, <span>total_chars</span> <span>/</span> <span>time_elapsed</span>)
<span># 24575 28.70 856.07</span>


<span># Measure the characters per second to describe a single president</span>
<span>start_time</span> <span>=</span> <span>time</span>()
<span>out</span> <span>=</span> <span>await</span> <span>tell_me_more_about</span>(<span>"George Washington"</span>)
<span>time_elapsed</span> <span>=</span> <span>time</span>() <span>-</span> <span>start_time</span>
<span>print</span>(<span>len</span>(<span>out</span>), <span>time_elapsed</span>, <span>len</span>(<span>out</span>) <span>/</span> <span>time_elapsed</span>)
<span># 2206 18.72 117.78</span></pre></div>
<h3 tabindex="-1" id="user-content-additional-features" dir="auto"><a href="#additional-features">Additional Features</a></h3>
<ul dir="auto">
<li>The <code>functions</code> argument to <code>@prompt</code> can contain async/coroutine functions. When the corresponding <code>FunctionCall</code> objects are called the result must be awaited.</li>
<li>The <code>Annotated</code> type annotation can be used to provide descriptions and other metadata for function parameters. See <a href="https://docs.pydantic.dev/latest/usage/validation_decorator/#using-field-to-describe-function-arguments" rel="nofollow">the pydantic documentation on using <code>Field</code> to describe function arguments</a>.</li>
<li>The <code>@prompt</code> and <code>@prompt_chain</code> decorators also accept a <code>model</code> argument. You can pass an instance of <code>OpenaiChatModel</code> (from <code>magentic.chat_model.openai_chat_model</code>) to use GPT4 or configure a different temperature.</li>
</ul>
<h2 tabindex="-1" id="user-content-configuration" dir="auto"><a href="#configuration">Configuration</a></h2>
<p dir="auto">The order of precedence of configuration is</p>
<ol dir="auto">
<li>Arguments passed when initializing an instance in Python</li>
<li>Environment variables</li>
</ol>
<p dir="auto">The following environment variables can be set.</p>
<table>
<thead>
<tr>
<th>Environment Variable</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>MAGENTIC_OPENAI_MODEL</td>
<td>OpenAI model</td>
<td>gpt-4</td>
</tr>
<tr>
<td>MAGENTIC_OPENAI_TEMPERATURE</td>
<td>OpenAI temperature</td>
<td>0.5</td>
</tr>
</tbody>
</table>
<h2 tabindex="-1" id="user-content-type-checking" dir="auto"><a href="#type-checking">Type Checking</a></h2>
<p dir="auto">Many type checkers will raise warnings or errors for functions with the <code>@prompt</code> decorator due to the function having no body or return value. There are several ways to deal with these.</p>
<ol dir="auto">
<li>Disable the check globally for the type checker. For example in mypy by disabling error code <code>empty-body</code>.
<div dir="auto" data-snippet-clipboard-copy-content="# pyproject.toml
[tool.mypy]
disable_error_code = [&quot;empty-body&quot;]"><pre><span><span>#</span> pyproject.toml</span>
[<span>tool</span>.<span>mypy</span>]
<span>disable_error_code</span> = [<span><span>"</span>empty-body<span>"</span></span>]</pre></div>
</li>
<li>Make the function body <code>...</code> (this does not satisfy mypy) or <code>raise</code>.
<div dir="auto" data-snippet-clipboard-copy-content="@prompt(&quot;Choose a color&quot;)
def random_color() -> str:
    ..."><pre><span>@<span>prompt</span>(<span>"Choose a color"</span>)</span>
<span>def</span> <span>random_color</span>() <span>-&gt;</span> <span>str</span>:
    ...</pre></div>
</li>
<li>Use comment <code># type: ignore[empty-body]</code> on each function. In this case you can add a docstring instead of <code>...</code>.
<div dir="auto" data-snippet-clipboard-copy-content="@prompt(&quot;Choose a color&quot;)
def random_color() -> str:  # type: ignore[empty-body]
    &quot;&quot;&quot;Returns a random color.&quot;&quot;&quot;"><pre><span>@<span>prompt</span>(<span>"Choose a color"</span>)</span>
<span>def</span> <span>random_color</span>() <span>-&gt;</span> <span>str</span>:  <span># type: ignore[empty-body]</span>
    <span>"""Returns a random color."""</span></pre></div>
</li>
</ol>
</article>
          </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Ollama for Linux – Run LLMs on Linux with GPU Acceleration (156 pts)]]></title>
            <link>https://github.com/jmorganca/ollama/releases/tag/v0.1.0</link>
            <guid>37661755</guid>
            <pubDate>Tue, 26 Sep 2023 16:29:56 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/jmorganca/ollama/releases/tag/v0.1.0">https://github.com/jmorganca/ollama/releases/tag/v0.1.0</a>, See on <a href="https://news.ycombinator.com/item?id=37661755">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-pjax="true" data-test-selector="body-content" data-view-component="true"><h2>Ollama for Linux</h2>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/jmorganca/ollama/assets/251292/89f8526e-866a-4e19-a73c-3ff850d45c76"><img src="https://github.com/jmorganca/ollama/assets/251292/89f8526e-866a-4e19-a73c-3ff850d45c76" height="220"></a></p>
<p>Ollama for Linux is now available, with GPU acceleration enabled out-of-the-box for Nvidia GPUs.</p>
<p>💯 Ollama will run on cloud servers with multiple GPUs attached<br>
🤖 Ollama will run on WSL 2 with GPU support<br>
😍 Ollama maximizes the number of GPU layers to load to increase performance without crashing<br>
🤩 Ollama will support CPU only, and small hobby gaming GPUs to super powerful workstation graphics cards like the H100</p>
<h3>Download</h3>
<div data-snippet-clipboard-copy-content="curl https://ollama.ai/install.sh | sh"><pre><code>curl https://ollama.ai/install.sh | sh
</code></pre></div>
<p>Manual <a href="https://github.com/jmorganca/ollama/blob/main/docs/linux.md">install steps</a> are also available.</p>
<h2>Changelog</h2>
<ul>
<li>Ollama will now automatically offload as much of the running model as is supported by your GPU for maximum performance without any crashes</li>
<li>Fix issue where characters would be erased when running <code>ollama run</code></li>
<li>Added a new community project by <a data-hovercard-type="user" data-hovercard-url="/users/TwanLuttik/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/TwanLuttik">@TwanLuttik</a> in <a data-error-text="Failed to load title" data-id="1909265837" data-permission-text="Title is private" data-url="https://github.com/jmorganca/ollama/issues/574" data-hovercard-type="pull_request" data-hovercard-url="/jmorganca/ollama/pull/574/hovercard" href="https://github.com/jmorganca/ollama/pull/574">#574</a></li>
</ul>
<h2>New Contributors</h2>
<ul>
<li><a data-hovercard-type="user" data-hovercard-url="/users/TwanLuttik/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/TwanLuttik">@TwanLuttik</a> made their first contribution in <a data-error-text="Failed to load title" data-id="1909265837" data-permission-text="Title is private" data-url="https://github.com/jmorganca/ollama/issues/574" data-hovercard-type="pull_request" data-hovercard-url="/jmorganca/ollama/pull/574/hovercard" href="https://github.com/jmorganca/ollama/pull/574">#574</a></li>
</ul>
<p><strong>Full Changelog</strong>: <a href="https://github.com/jmorganca/ollama/compare/v0.0.21...v0.1.0"><tt>v0.0.21...v0.1.0</tt></a></p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[9th Circuit rejects TSA claim of impunity for checkpoint staff who rape traveler (234 pts)]]></title>
            <link>https://papersplease.org/wp/2023/06/26/9th-circuit-rejects-tsa-claim-of-impunity-for-checkpoint-staff-who-rape-travelers/</link>
            <guid>37661609</guid>
            <pubDate>Tue, 26 Sep 2023 16:21:30 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://papersplease.org/wp/2023/06/26/9th-circuit-rejects-tsa-claim-of-impunity-for-checkpoint-staff-who-rape-travelers/">https://papersplease.org/wp/2023/06/26/9th-circuit-rejects-tsa-claim-of-impunity-for-checkpoint-staff-who-rape-travelers/</a>, See on <a href="https://news.ycombinator.com/item?id=37661609">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="primary" role="main">	
			
<article id="post-17978">
			
	
	<p><span>Jun</span>
		<span>26</span>
		<span>2023</span>
	</p>
		
	<div>
		<p>Last December, we <a href="https://papersplease.org/wp/2022/12/06/tsa-argues-for-impunity-for-checkpoint-staff-who-rape-travelers/">attended and reported on oral argument before the 9th Circuit Court of Appeals</a> in a case in which the Transportation Security Administration (TSA) argued that TSA checkpoint staff have absolute immunity from lawsuits for assault, even sexual assault or rape, committed against travelers they are “screening”.</p>
<p>We’re pleased to report that today the 9th Circuit panel of judges <a href="https://cdn.ca9.uscourts.gov/datastore/opinions/2023/06/26/22-15402.pdf">rejected the TSA’s claim of impunity</a>. The three judges found unanimously that the Federal Tort Clams Act (FTCA) allows lawsuits against the TSA for damages caused by checkpoint staff who assault travelers. The 9th Circuit thus joins every other Circuit Court of Appeals (the <a href="https://papersplease.org/wp/2019/08/30/3rd-circuit-finds-tsa-checkpoint-staff-conduct-searches-and-can-be-sued-for-misconduct/">3rd</a>, <a href="https://papersplease.org/wp/2023/04/18/4th-circuit-agrees-that-tsa-checkpoint-staff-are-liable-for-assault/">4th</a>, and <a href="https://papersplease.org/wp/2020/08/31/8th-circuit-finds-tsa-agents-can-be-liable-for-assault/">8th</a>) to have addressed this issue in a published opinion.</p>
<p>The case decided today by the 9th Circuit will now return to the U.S. District Court in Las Vegas for much-belated consideration of the claim against the TSA and its officers. The precedent set by today’s decision will apply <a href="https://www.ca9.uscourts.gov/information/circuit-map/">throughout the 9th Circuit</a>, the largest of the Federal judicial circuits, including all of the states on the West Coast.</p>
<p>Kudos to <a href="http://www.corbettrights.com/">Jonathan Corbett, Esq.</a>, who has represented the plaintiffs in each of these cases.&nbsp; Coals for Christmas to the TSA for continuing to argue for impunity for its staff to one Circuit Court after another, despite the growing weight of precedent against the agency and, perhaps more importantly, the moral repugnance of arguing that any agents of the government should be entitled to assault or rape members of the public with impunity.</p>
			</div>
</article><!-- #post-17978 -->
	<!-- #nav-below -->
	

	<!-- #comments .comments-area -->
				</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[FTC Sues Amazon for Illegally Maintaining Monopoly Power (772 pts)]]></title>
            <link>https://www.ftc.gov/news-events/news/press-releases/2023/09/ftc-sues-amazon-illegally-maintaining-monopoly-power</link>
            <guid>37661446</guid>
            <pubDate>Tue, 26 Sep 2023 16:10:40 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.ftc.gov/news-events/news/press-releases/2023/09/ftc-sues-amazon-illegally-maintaining-monopoly-power">https://www.ftc.gov/news-events/news/press-releases/2023/09/ftc-sues-amazon-illegally-maintaining-monopoly-power</a>, See on <a href="https://news.ycombinator.com/item?id=37661446">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><p>The Federal Trade Commission and 17 state attorneys general today sued Amazon.com, Inc. alleging that the online retail and technology company is a monopolist that uses a set of interlocking anticompetitive and unfair strategies to illegally maintain its monopoly power. The FTC and its state partners say Amazon’s actions allow it to stop rivals and sellers from lowering prices, degrade quality for shoppers, overcharge sellers, stifle innovation, and prevent rivals from fairly competing against Amazon. &nbsp;</p>

<p>The complaint alleges that Amazon violates the law not because it is big, but because it engages in a course of exclusionary conduct that prevents current competitors from growing and new competitors from emerging. By stifling competition on price, product selection, quality, and by preventing its current or future rivals from attracting a critical mass of shoppers and sellers, Amazon ensures that no current or future rival can threaten its dominance. Amazon’s far-reaching schemes impact hundreds of billions of dollars in retail sales every year, touch hundreds of thousands of products sold by businesses big and small and affect over a hundred million shoppers.&nbsp;</p>

<p>“Our complaint lays out how Amazon has used a set of punitive and coercive tactics to unlawfully maintain its monopolies,” said FTC Chair Lina M. Khan. “The complaint sets forth detailed allegations noting how Amazon is now exploiting its monopoly power to enrich itself while raising prices and degrading service for the tens of millions of American families who shop on its platform and the hundreds of thousands of businesses that rely on Amazon to reach them. Today’s lawsuit seeks to hold Amazon to account for these monopolistic practices and restore the lost promise of free and fair competition.”</p>

<p>“We’re bringing this case because Amazon’s illegal conduct has stifled competition across a huge swath of the online economy.&nbsp;Amazon is a monopolist that uses its power to hike prices on American shoppers and charge sky-high fees on hundreds of thousands of online sellers,” said John Newman, Deputy Director of the FTC’s Bureau of Competition.&nbsp;“Seldom in the history of U.S. antitrust law has one case had the potential to do so much good for so many people.”</p>

<p>The FTC and states allege Amazon’s anticompetitive conduct occurs in two markets—the online superstore market that serves shoppers and the market for online marketplace services purchased by sellers. These tactics include:</p>

<ul><li>Anti-discounting measures that punish sellers and deter other online retailers from offering prices lower than Amazon, keeping prices higher for products across the internet.&nbsp;For example, if Amazon discovers that a seller is offering lower-priced goods elsewhere, Amazon can bury discounting sellers so far down in Amazon’s search results that they become effectively invisible.</li>
<li>Conditioning sellers’ ability to obtain “Prime” eligibility for their products—a virtual necessity for doing business on Amazon—on sellers using Amazon’s costly fulfillment service, which has made it substantially more expensive for sellers on Amazon to also offer their products on other platforms. This unlawful coercion has in turn limited competitors’ ability to effectively compete against Amazon.</li>
</ul><p>Amazon’s illegal, exclusionary conduct makes it impossible for competitors to gain a foothold. With its amassed power across both the online superstore market and online marketplace services market, Amazon extracts enormous monopoly rents from everyone within its reach. This includes:</p>

<ul><li>Degrading the customer experience by replacing relevant, organic search results with paid advertisements—and deliberately increasing junk ads that worsen search quality and frustrate both shoppers seeking products and sellers who are promised a return on their advertising purchase.</li>
<li>Biasing Amazon’s search results to preference Amazon’s own products over ones that Amazon knows are of better quality.&nbsp;</li>
<li>Charging costly fees on the hundreds of thousands of sellers that currently have no choice but to rely on Amazon to stay in business. These fees range from a monthly fee sellers must pay for each item sold, to advertising fees that have become virtually necessary for sellers to do business. Combined, all of these fees force many sellers to pay close to 50% of their total revenues to Amazon. These fees harm not only sellers but also shoppers, who pay increased prices for thousands of products sold on or off Amazon. &nbsp;</li>
</ul><p>The FTC, along with its state partners, are seeking a permanent injunction in federal court that would prohibit Amazon from engaging in its unlawful conduct and pry loose Amazon’s monopolistic control to restore competition.<s> </s></p>

<p>Connecticut, Delaware, Maine, Maryland, Massachusetts, Michigan, Minnesota, New Jersey, New Hampshire, New Mexico, Nevada, New York, Oklahoma, Oregon, Pennsylvania, Rhode Island, and Wisconsin joined the Commission’s lawsuit. The Commission vote to authorize staff to file for a permanent injunction and other equitable relief in the U.S. District Court for the Western District of Washington was 3-0.</p>

<p><strong>NOTE:&nbsp;</strong>The Commission issues a complaint when it has “reason to believe” that the law has been or is being violated, and it appears to the Commission that a proceeding is in the public interest.</p>
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Yet another E-Ink weather display – but with Rust (181 pts)]]></title>
            <link>https://harrystern.net/halldisplay.html</link>
            <guid>37661387</guid>
            <pubDate>Tue, 26 Sep 2023 16:06:21 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://harrystern.net/halldisplay.html">https://harrystern.net/halldisplay.html</a>, See on <a href="https://news.ycombinator.com/item?id=37661387">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
          <p><span><time datetime="2023-09-24T00:00:00-04:00">Sun 24 September 2023</time></span>
   	  <span> - 12 min </span>
          </p>
        </div><section id="content">
          <p>I made one of those e-ink weather displays that you see on tech blogs and hacker news sometimes. It can display the current weather, the temperature and precipitation forecast for the rest of the week, and my current and upcoming tasks from Todoist. It's powered by a couple NiMH AA batteries and lasts at least a couple months on a single charge, if not more.</p>
<p><img alt="hall display" src="https://harrystern.net/images/halldisplay.png"></p>
<p>The code can be found <a href="https://github.com/boustrophedon/eink-esp-weather-display">on my github</a>.</p>
<h2>Hardware</h2>
<h2>E-ink display</h2>
<p>The screen is a <a href="https://www.waveshare.com/product/7.5inch-e-paper-b.htm">7.5", 800 by 480 pixel, 3-color e-ink display</a> that I purchased from waveshare. It does black, white, and red, which is slightly unusual for e-ink and increases the price and lowers the refresh rate, but looks really nice. I believe it works (skipping over how e-ink works in general) by first pushing the black particles to the front, and then pushing the red particles, which are maybe smaller or lighter or less dense, further in front of the black ones.</p>
<h2>Microcontroller</h2>
<p>I bought a <a href="https://www.waveshare.com/e-paper-esp32-driver-board.htm">pre-assembled ESP32 board</a>, also from waveshare, which contains the FPC connector already assembled and connected to the ESP32 module's SPI pins.</p>
<p>I desoldered the on-board LEDs to increase battery life, since the power LED was always on, and the other led seemed to be slightly receiving/drawing power during sleep. I was able to turn it off in software by configuring an internal pulldown to stay on during sleep but I wasn't sure if that would also draw some current so I just removed it since I wasn't using it.</p>
<h2>Software</h2>
<p>This project consists of two different Rust projects.</p>
<p>There's the code that runs on the esp32 board connected to the display, and then there's also code running on a server that both gathers the data and renders it to a file. Originally I was going to do everything on-device, but since the display is battery-powered I thought it would be more efficient to download a single file and display it. So all the API requests, graph drawing, and text rendering operations happen on the server, and the display board effectively acts as a dumb terminal which just displays the data it receives.</p>
<h2>On-device software</h2>
<h3>ESP32 overview</h3>
<p>For the "firmware" running on the esp32 board, I'm using esp-idf with the standard library (i.e. not no-std) via the esp-rs project.</p>
<p>Setup is a tiny bit complicated, but <a href="https://esp-rs.github.io/book/overview/using-the-standard-library.html">the esp-rs book</a> is a great guide and explains everything fairly clearly. Hopefully one day it will be as simple as "edit your runner in .cargo/config.toml to use espflash and then just <code>cargo run</code>" although I think for RISC-V boards with no-std it might be pretty close already. I added a Justfile that exports the libclang and esp toolchain environment variables internally so that I can <code>just build</code> and <code>just run</code>.</p>
<p>The esp32-std embedded ecosystem is comprised of several different crates, including:
- <a href="https://crates.io/crates/esp-idf-sys">esp-idf-sys</a>, which contains bindgen bindings to the <a href="https://github.com/espressif/esp-idf">esp-idf C API</a>
- <a href="https://crates.io/crates/esp-idf-hal">esp-idf-hal</a>, which contains higher-level, type-safe wrappers and drivers for hardware like GPIO and SPI 
- <a href="https://crates.io/crates/esp-idf-svc">esp-idf-svc</a>, which contains implementations and wrappers for system services like Wifi and storage</p>
<p>Additionally, the above crates use and implement traits from the following embedded-rust ecosystem crates:
- <a href="https://crates.io/crates/embedded-hal">embedded-hal</a>
- <a href="https://crates.io/crates/embedded-svc">embedded-svc</a></p>
<p>and several other setup utility binaries like espup, espflash, and embuild, in addition to a fork of the rust compiler for the Xtensa/ESP32 architecture (there are also RISC-V ESP32 processors which don't require the forked compiler and llvm). </p>
<p>I mostly read example code, the various projects' mentioned above documentation, and the esp-idf documentation to figure out how to put everything together. In particular this repo is fairly extensive: <a href="https://github.com/ivmarkov/rust-esp32-std-demo">https://github.com/ivmarkov/rust-esp32-std-demo</a></p>
<p>It can be somewhat confusing to figure out which types you need from which crates to e.g. turn on wifi, but this isn't unique to esp32 or embedded rust. Libraries will take traits from embedded-hal/svc as impl parameters and it can sometimes be difficult to figure out how to instantiate concrete versions of those types. Typically the sample code is useful in those cases to get things started.</p>
<p>Overall, the code is pretty simple.</p>
<ol>
<li>We "gather" the peripherals we need - spi, the modem for wifi, and the gpio pin used to wake up via button press</li>
<li>Turn on the wifi</li>
<li>Get the display data from the server</li>
<li>Turn off the wifi</li>
<li>Send the data to the display and wait until we expect it's done</li>
<li>Tell the e-ink display to go to sleep</li>
<li>Tell the device to sleep for 90 minutes or until the button is pressed</li>
</ol>
<p>The URL to request the data from and the wifi SSID and password are just constants in a <code>src/config.rs</code> file which isn't checked in to git. This gets baked into the final binary.</p>
<h3>Getting the data</h3>
<p>To request the display data from the server, we use the <code>esp_idf_svc::http</code> and <code>embedded_svc::http</code> modules.</p>
<p>There really isn't too much to the code - it's a pretty standard http request. The only thing of note is that we explicitly check that we're getting the right size file back from the server to fit the display.</p>
<h3>Waveshare e-ink driver</h3>
<p>To send the image data to the display, we use the <a href="https://crates.io/crates/epd-waveshare">epd-waveshare</a> crate, but because the last release was published to crates.io 2 years ago, we have to use the git repo url directly in our Cargo.toml file. My display uses the "epd7in5b_v2" driver. The sticker on the back says v3 but everything seems to work.</p>
<p>Other than that everything just works - you set up the SPI device, pass it to the library and give it the image data. It doesn't seem to wait for the display to actually finish updating, so we wait for about 20 seconds before sending a sleep signal to the display, which lowers its power consumption. Since it's an e-ink display, the image continues to be displayed even during sleep, of course.</p>
<blockquote>
<p>Aside: The memory layout for the display data is just the raw bits bitpacked into bytes. The red pixels are handled by simply having two separate buffers packed next to each other. This is inefficient in terms of space - we could instead do a variable length encoding scheme where say 0 is white, 10 is black and 11 is red. However, this would make it significantly slower to do standard drawing operations on because individual pixel access becomes O(n).</p>
</blockquote>
<h2>Rendering software</h2>
<p>The rendering code was by far the most interesting. Everything is drawn with the <a href="https://crates.io/crates/imageproc">imageproc crate</a>, which uses the <a href="https://crates.io/crates/image">image crate</a> and the <a href="https://crates.io/crates/rusttype">rusttype crate</a> for fonts. Additionally, it uses the same <a href="https://crates.io/crates/epd-waveshare">epd_waveshare</a> crate and also the <a href="https://crates.io/crates/embedded_graphics">embedded_graphics</a> crate to pack the image buffer into the format used by the display driver.</p>
<p>So again, the strategy here is to draw the image into a generic image buffer, and then "render" it into the driver display library's buffer type as if the code were running directly on the device. Then as above the esp32 downloads the file and sends it directly to the display without having to do any extra work.</p>
<h3>Gathering the data</h3>
<p>I'm using <a href="https://www.weather.gov/documentation/services-web-api">weather.gov's free API</a> for the weather data, which requires just a couple HTTP requests to get the current weather and the forecast. To figure out the station and gridpoint parameters for the requests, you'll need to make a couple requests manually to some other endpoints that take GPS coordinates and return the nearest stations and gridpoint.</p>
<p>The todo list data is just a single API request with a filter of -24h to +48h on the due date.</p>
<h3>Drawing and measuring text</h3>
<p>While imageproc has a built-in function for drawing text, I had to write several variations of wrappers to get different alignments. The <code>measure_text</code> function I'm pretty sure was taken from example code somewhere in rusttype or imageproc.</p>
<h3>Drawing the graphs</h3>
<p>Imageproc's line drawing methods are just basic Bresenham and have no thickness parameter, so to get thick lines I just drew them with the start and end points offset vertically by a pixel. Note that this obviously does not work for perfectly straight lines and mathematically you'd want to offset by the vector perpendicular to the original line, but since the graph is mostly horizontal it works fine for this case.</p>
<p>Regarding the precipitation graph, it was a fair amount of trial and error to get it looking the way I imagined it. The code is a little obscure and I'm pretty sure it can be simplified. The idea is that we just split the graph into 6x6 squares, turn on some pixels on the diagonal, and then offset the squares themselves. The last part is the part that I think could be simplified (or at least better explained) and is expressed in the <code>xm</code> variable in the code.</p>
<p>I really love how the thin lines in the precipitation graph really make it look blue even though it's the same black as the rest of the image.</p>
<h3>Dithering and "rendering" to the display buffer</h3>
<p>Since the display can only handle 3 colors but the text is rendered with anti-aliasing (and I couldn't find an easy way to not anti-alias) I ended up using the image crate's dithering functionality with just a manually-tuned cutoff point that looked good with the font and the display. Fortunately e-ink displays are a bit fuzzy due to their construction, so combined with the curvy font I chose it's very hard to see any artifacts without looking very closely.</p>
<p>After the final image is dithered to white/black/red, we use the same exact crate that's used in the firmware, but this time to write the buffer instead ofread it. All we have to do is enumerate over the pixels in the image and call <code>set_pixel</code> inside the buffer, and the crate takes care of doing the bitpacking for us. It could be done more efficiently, but since we're not running on the device it doesn't matter as much.</p>
<h3>Running the rendering software</h3>
<p>Unlike the firmware, the rendering software takes an actual json-formatted config file as a cli parameter, along with the location of the output file.</p>
<p>The rendering binary gets run every hour via a systemd user service and timer file which can be found in the scripts/ directory. In my case, the output file gets put into a directory which nginx is configured to serve static files from.</p>
<h3>Extrasafe</h3>
<p>I used my own <a href="https://github.com/boustrophedon/extrasafe">extrasafe crate</a> in the rendering software on the server. It allows you to restrict your software's syscall usage to a subset of your choosing <a href="https://man7.org/linux/man-pages/man2/seccomp.2.html">via seccomp.</a> We start one thread to make the HTTP requests to all the APIs, then pass that raw JSON data to another thread with even less privileges to do the parsing, and finally pass that back to the main thread, where we then do our final restriction that only allows us to write to the output file. I think ideally we would first spawn the threads, wait until the original thread is restricted, and <em>then</em> run the other threads, but with more than one worker thread in the sequence it becomes difficult to organize everything manually.</p>
<p>I'm currently working on improvements to extrasafe to allow the use of Landlock and also maybe a helper function for the <code>unshare</code> syscall. In particular I'd like to restrict the network thread's filesystem access to only the necessary files for DNS and SSL, rather than all files.</p>
<h2>The Case</h2>
<p>I learned how to use CAD software for this project and it was simpler than I thought it would be.</p>
<p>First, you select a plane to draw on, which can be either a plane along two major axes, or a plane formed by part of your model that you've drawn alreday. Then you can draw 2D shapes on that plane with standard 2D curve tools like lines, bezier curves, conics, etc. Once you've got the parts of your shape in place, you then need to constrain the shape. Here "constrain" means to lock in the position, dimension, and other parameters such as angles, radii, control point position, which you do with operations like "these two points are concurrent", "these two points are symmetric about this line", "these two lines are perpendicular", "the length of this line is 5mm", "the angle between these two lines is 30 degrees". Finally, back in "3D mode", you can use tools to extrude, cut out pockets, revolve, or otherwise 3d-ify the 2d sketches you drew.</p>
<p>Additionally, you can make a spreadsheet or mapping of labeled dimensions and use them in the 2d sketches or extrusions in place of using specific dimensions like "5mm" and the model will automatically be updated when you change the values. Overall it's actually pretty fun, although maybe a bit tedious.</p>
<p>I tried out both freecad and onshape, and freecad seemed a bit too easy to get into a buggy state but I otherwise liked the constraint interface. In particular one tiny thing I liked about freecad was that the sketch turned a very visible green when it's fully constrained. Onshape's blue/black scheme is pretty low contrast and can be hard to see, especially when using flux or redshift. Maybe I just missed an external indicator that said whether the sketch was fully constrained or not. The built-in variables table in onshape was simpler than freecad, where you have to use spreadsheet workbench or a separate plugin, and even then I'm pretty sure you have to type <code>spreadsheet.&lt;name&gt;</code> or <code>dd.dd&lt;name&gt;</code> whenever you want to use a variable inside a sketch. I also didn't see a way in onshape to see a list of constraints like you can see in freecad.</p>
<p>I had the case <a href="https://3d.jlcpcb.com/3d-printing-quote">printed by JLCPCB</a> in white resin via SLA for about $20 - $30 USD shipped and it was both really easy and it came out pretty clean. I had to do a second revision because I messed up with the bezel size (accidentally made it symmetric rather than the bottom having a larger lip) and the second order came out just as good or better than the first. <a href="https://cad.onshape.com/documents/7335050833c9b0394faa498c/w/53cba50a0cfeb1391b6847f2/e/390ae9e3c38a9286a52c2ae4">Here's the oncad project.</a></p>
<p>I couldn't find any cheap 3D printing services in the US to do the print for me - I guess they either get outcompeted on labor costs by China or there isn't demand for them on a hobbyist level because hobbyists can buy their own or use a makerspace's printer?</p>
<p>The case is mounted on the wall with regular Command picture hanging strips - I designed pads on the backside of the case specifically for this purpose.</p>
<h2>Things I would like to improve</h2>
<ul>
<li>Case snap-fit for pcb, maybe for display as well/or just supports<ul>
<li>I'm not really sure what's possible for resin in terms of both printability and flexibility / thin parts</li>
</ul>
</li>
<li>Custom PCB with a lower quiescient current voltage regulator for improved battery life? Plus on-board battery holder.</li>
<li>The weather.gov API is occasionally flakey or provides bad JSON, maybe add a retry option via the systemd unit file</li>
<li>Add some code to note if the image from the server hasn't been updated (either via comparing to an RTC or storing the last successful update time in flash) and then maybe draw a red dot or line in the top corner or somewhere. This would be equivalent to just setting one or a couple bytes to all 1s in the binary, so it wouldn't be very difficult.</li>
<li>Minor issues with graph data</li>
<li>Make daily high/lows red and smaller</li>
<li>Show daily high/lows for current day</li>
<li>Measure current draw accurately</li>
<li>Current ranger / ucurrent gold / borrow one from somewhere?</li>
<li>Better test the renderer</li>
<li>Set up some kind of testing with qemu for the firmware</li>
</ul>
<h2>Conclusions</h2>
<p>It's really easy and fun to get started writing code for microcontrollers in Rust! CAD is also pretty fun.</p>
<p><em>Thanks to Neil Chen and Stan Zhang for reviewing a draft of this post</em></p>
        </section></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Common infections can spark psychiatric illnesses in children (205 pts)]]></title>
            <link>https://www.economist.com/science-and-technology/2023/09/20/how-common-infections-can-spark-psychiatric-illnesses-in-children</link>
            <guid>37661034</guid>
            <pubDate>Tue, 26 Sep 2023 15:43:26 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.economist.com/science-and-technology/2023/09/20/how-common-infections-can-spark-psychiatric-illnesses-in-children">https://www.economist.com/science-and-technology/2023/09/20/how-common-infections-can-spark-psychiatric-illnesses-in-children</a>, See on <a href="https://news.ycombinator.com/item?id=37661034">Hacker News</a></p>
<div id="readability-page-1" class="page"><section><h2>And why many doctors do not realise it</h2></section><div><div data-body-id="cp2"><div><figure><div><figcaption>Listen to this story.</figcaption> <p><span>Enjoy more audio and podcasts on<!-- --> <a id="audio-ios-cta" href="https://economist-app.onelink.me/d2eC/bed1b25" target="_blank" rel="noreferrer">iOS</a> <!-- -->or<!-- --> <a id="audio-android-cta" href="https://economist-app.onelink.me/d2eC/7f3c199" target="_blank" rel="noreferrer">Android</a>.</span></p></div><audio controls="" id="audio-player" preload="none" src="https://www.economist.com/media-assets/audio/072%20Science%20and%20technology%20-%20Children%20and%20mental%20health-7425bb279b144fea9958a5cae581e0bb.mp3" title="How common infections can spark psychiatric illnesses in children" controlslist="nodownload"><p>Your browser does not support the &lt;audio&gt; element.</p></audio></figure></div><p data-component="paragraph"><span data-caps="initial">I</span><small>t was a</small> sunny day in September 2007 when Garrett Pohlman, then seven years old, came home from school. Crying, he warned his mother that radiation was coming out of the house’s electrical sockets. If they went outside, he said, birds would peck them to death. These pronouncements were accompanied by odd facial movements. The boy would stick his tongue out and jerk his arms and legs. The day before, Garrett had been a normal boy. Both the paranoia and the tics had come out of the blue, but they proved to be the start of a horrifying mental decline.</p><p data-component="paragraph">In the end, Garrett was lucky. A hospital scan three months later revealed a bacterial sinus infection. A course of antibiotics cured the infection and brought about a striking improvement in his psychiatric symptoms. Garrett had been suffering from <small>PANDAS</small>, which stands for Paediatric Autoimmune-Neuropsychiatric Disorders Associated with <i>Streptococcus</i>.</p><p data-component="paragraph">Many other children are not so fortunate; some have suffered long-term damage. In plain English, Garrett’s unsettling behaviour was the result of an immune system gone haywire following an infection with group A <i>Streptococcus</i>, a common bacterium. (A similar illness, triggered by other infections, goes by the acronym <small>PANS</small>, for Paediatric Acute-onset Neuropsychiatric Syndrome.)</p><p data-component="paragraph">Yet many doctors have heard of neither <small>PANDAS</small> nor <small>PANS</small>. Some have dismissed them as fictitious diseases. Very few countries issue guidance on their diagnosis or treatment. Diana Pohlman, Garrett’s mother, says she is “exhausted” by years spent campaigning to get doctors to take the illnesses seriously.</p><p data-component="paragraph">That is starting to change. Scientists are beginning to characterise the conditions in detail and determine exactly what is going wrong with the immune systems of sufferers. On September 12th Maria Caulfield, a British health minister,  weighed in, telling legislators that <small>PANDAS</small> and <small>PANS</small> exist and are triggered by infections.</p><p data-component="paragraph">Such efforts are starting from a low base. In a 2020 survey for <small>PANS PANDAS UK</small>, a charity, 95% of parents whose children have <small>PANDAS</small> said their family doctors had not offered the diagnosis, suggesting awareness is low. Things were only a little better among specialists. Around half of paediatricians said they had never heard of the disease. Nearly one in five of the parents surveyed said their paediatrician felt that the diagnosis was controversial.</p><p data-component="paragraph">That ignorance carries costs. In many countries children with <small>PANDAS</small> are presented with an alphabet soup of psychiatric misdiagnoses. These can include attention-deficit hyperactivity disorder, autism and sensory-processing disorders. Children can be given inappropriate drugs like antipsychotics, many of which have unpleasant side-effects and which do nothing to treat the cause of their disease.</p><p data-component="paragraph">In some cases parents have been accused of inventing or inducing their children’s illness. <i>The Economist</i> has spoken to parents who say their children have been committed to mental-health services against their will, or removed from their care altogether. According to testimony provided in Parliament, one doctor told a child that he would not treat “an American illness”. In 2019 several dozen children with <small>PANDAS</small> and<small> PANS</small> were discharged from a British hospital. Their parents were told they had a “functional neurological disorder”—a diagnosis that has evolved from the old (and discredited) idea of hysteria, and which some doctors joke grimly means “finding no diagnosis”.</p><p data-component="paragraph">Exactly why the diagnosis is controversial remains unclear. After all, the idea that the aftermath of an infection can cause psychiatric symptoms is not new. Sydenham’s chorea, in which patients suffer from jerky movements of the face and body, is likewise the result of a streptococcal infection. <i>The Economist</i> contacted a number of psychiatrists and professional bodies for comment. Some did not reply. Others said they were unable to offer any comment. The Royal College of Psychiatrists said it was struggling to find an available spokesperson.</p><h2>The body and the mind</h2><p data-component="paragraph">But as evidence accumulates that <small>PANS</small> and <small>PANDAS</small> are real, attitudes are beginning to shift. Scientists who study the disorder now believe it is caused by an auto-immune reaction, in which the body’s immune system mistakenly attacks brain tissue. After infection with <i>Streptococcus</i>, the theory goes, children begin producing antibodies that cause inflammation in their own brains, which in turn causes the psychiatric symptoms.</p><p data-component="paragraph">In 2018 Christopher Pittenger, a psychiatrist at Yale University, and his colleagues extracted antibodies from the blood of children with <small>PANDAS</small> and introduced them into laboratory mice. They found that the antibodies attacked cholinergic interneurons in particular, a group of cells in parts of the brain associated with tic disorders, which are one of the features of <small>PANDAS</small>. Chandra Menendez, a researcher at the University of Oklahoma Health Sciences Centre, says she has found a “correlation between antibodies that target dopamine receptors <small>D</small>1 and <small>D</small>2 and the <small>PANDAS</small> phenotype”. This sort of work could help develop diagnostic tests.</p><p data-component="paragraph">A paper by Dritan Agalliu, a neurologist at Columbia University, currently under review by a scientific journal, suggests that blocking a particular part of the immune system—a type of lymphocyte called T helper 17 cells—with immune-suppressing drugs reduces damage to the brain, at least in mice. Other work suggests that damage to the blood-brain barrier, a filter designed to protect the brain from potentially harmful substances in the blood, could also be part of the story.</p><p data-component="paragraph">Such findings may have significance beyond a single obscure, debilitating illness. For they fit an intriguing, and growing, body of evidence that other kinds of psychiatric conditions might also result from infections. Dr Pittenger says it is now clear that covid-19 infections can trigger psychosis, fatigue and other neuro-psychiatric symptoms. A misbehaving immune system is thought to be the culprit. The idea that schizophrenia may, at least sometimes, likewise be an auto-immune disorder is also under investigation. (Intriguingly, people with any kind of auto-immune disorder appear to be about 40% more likely to develop psychotic disorders such as schizophrenia.)</p><p data-component="paragraph">How long it takes doctors to pick up on this change of thinking is another matter. Some of the prodding now comes not from patients, but from governments. Robin Millar, a British <small>MP</small> who chairs a parliamentary group on <small>PANDAS</small> and <small>PANS</small>, says Britain’s government is committed to working out how to diagnose and assess the illnesses. It has begun discussions with doctors, and is pondering a research project to work out how prevalent the diseases are. A pan-European patient group called <small>EXPAND</small>, founded in 2018, is also pushing to improve understanding.</p><p data-component="paragraph">Such efforts are sorely needed. As Garrett Pohlman’s case shows, if infections are caught early, treatment can be very effective, avoiding long-term damage. Now 23, Mr Pohlman graduated in 2022 with high honours from the University of California, Berkeley, in chemical engineering, and these days runs his own company. Not every patient has been so lucky. <span>■</span></p><p data-component="paragraph"><i>Correction (September 22nd 2023): An earlier version of this article described the use of anti-inflammatory drugs to reduce damage to the brain. In fact, immune-suppressing drugs were used. Apologies for the error.</i></p><p data-component="paragraph"><i>Curious about the world? To enjoy our mind-expanding science coverage, sign up to&nbsp;<a href="https://www.economist.com/newsletters/simply-science" target="_blank">Simply Science</a>, our weekly subscriber-only newsletter.</i></p></div><p>This article appeared in the Science &amp; technology section of the print edition under the headline "PANDA-monium"</p><div orientation="vertical" data-test-id="vertical"><div orientation="vertical"><figure><img alt="Time for a rethink: Helping Ukraine win a long war" loading="lazy" width="1280" height="1684" decoding="async" data-nimg="1" sizes="300px" srcset="https://www.economist.com/img/b/16/21/90/media-assets/image/20230923_DE_US.jpg 16w, https://www.economist.com/img/b/32/42/90/media-assets/image/20230923_DE_US.jpg 32w, https://www.economist.com/img/b/48/63/90/media-assets/image/20230923_DE_US.jpg 48w, https://www.economist.com/img/b/64/84/90/media-assets/image/20230923_DE_US.jpg 64w, https://www.economist.com/img/b/96/126/90/media-assets/image/20230923_DE_US.jpg 96w, https://www.economist.com/img/b/128/168/90/media-assets/image/20230923_DE_US.jpg 128w, https://www.economist.com/img/b/256/336/90/media-assets/image/20230923_DE_US.jpg 256w, https://www.economist.com/img/b/360/473/90/media-assets/image/20230923_DE_US.jpg 360w, https://www.economist.com/img/b/384/505/90/media-assets/image/20230923_DE_US.jpg 384w, https://www.economist.com/img/b/480/631/90/media-assets/image/20230923_DE_US.jpg 480w, https://www.economist.com/img/b/600/789/90/media-assets/image/20230923_DE_US.jpg 600w, https://www.economist.com/img/b/834/1097/90/media-assets/image/20230923_DE_US.jpg 834w, https://www.economist.com/img/b/960/1263/90/media-assets/image/20230923_DE_US.jpg 960w, https://www.economist.com/img/b/1096/1441/90/media-assets/image/20230923_DE_US.jpg 1096w, https://www.economist.com/img/b/1280/1684/90/media-assets/image/20230923_DE_US.jpg 1280w, https://www.economist.com/img/b/1424/1873/90/media-assets/image/20230923_DE_US.jpg 1424w" src="https://www.economist.com/img/b/1424/1873/90/media-assets/image/20230923_DE_US.jpg"></figure></div><div orientation="vertical"><h3 orientation="vertical">From the September 23rd 2023 edition</h3><p orientation="vertical">Discover stories from this section and more in the list of contents </p><a href="https://www.economist.com/printedition/2023-09-23" data-analytics="sidebar:weekly_edition"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M12 1c6.075 0 11 4.925 11 11s-4.925 11-11 11S1 18.075 1 12 5.925 1 12 1zm.142 4.5l-1.008 1.062c3.33 3.276 4.194 4.14 4.608 4.5-1.602-.018-3.168-.018-10.242-.018v1.584c7.074 0 8.73 0 10.242-.018-.432.36-1.314 1.206-4.608 4.536l1.008 1.044 6.354-6.354L12.142 5.5z" fill="#2E45B8" fill-rule="nonzero"></path></g></svg><span>Explore the edition</span></a></div></div></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Unity U-turns on controversial runtime fee and begs forgiveness (120 pts)]]></title>
            <link>https://techcrunch.com/2023/09/22/unity-u-turns-on-controversial-runtime-fee-and-begs-forgiveness/</link>
            <guid>37660327</guid>
            <pubDate>Tue, 26 Sep 2023 14:55:44 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://techcrunch.com/2023/09/22/unity-u-turns-on-controversial-runtime-fee-and-begs-forgiveness/">https://techcrunch.com/2023/09/22/unity-u-turns-on-controversial-runtime-fee-and-begs-forgiveness/</a>, See on <a href="https://news.ycombinator.com/item?id=37660327">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
				<p id="speakable-summary">Unity has done a 180 on a <a href="https://techcrunch.com/2023/09/18/unity-reportedly-backtracking-on-new-fees-after-developers-revolt/">controversial new pricing scheme</a> that users of its cross-platform game engine almost unanimously disparaged. A new pricing policy is still incoming, but it’s far less fraught for independent developers, many of whom threatened to leave the engine and platform behind rather than pay.</p>
<p>The changes were announced only last week, and immediately attracted the ire of nearly everyone in the gaming community, prompting a panicked “clarification” soft-pedaling of the “runtime fee” that would be owed with every install of a game past a certain level of revenue. The plan was intensely unpopular, as apart from the increased costs many would incur under it, it suggested that the people running the show at Unity were completely disconnected from the community.</p>
<p>Less than two weeks from its debut, however, the runtime fee policy has been almost completely reversed and its architects are abasing themselves before their customers. Unity Create head Marc Whitten <a href="https://blog.unity.com/news/open-letter-on-runtime-fee" target="_blank" rel="noopener">posted an apologetic note detailing the changes</a>.</p>
<blockquote><p>I want to start with this: I am sorry.</p>
<p>We should have spoken with more of you and we should have incorporated more of your feedback before announcing our new Runtime Fee policy.</p>
<p>You are what makes Unity great, and we know we need to listen, and work hard to earn your trust. We have heard your concerns, and we are making changes in the policy we announced to address them.</p></blockquote>
<p>Under the revised terms, there is no runtime fee whatever for any game developed with a current version of Unity, only for those developers who adopt the latest version in 2024. The free Unity Personal will stay free, and the revenue ceiling above which users must upgrade to the next tier has been raised to $200,000. And above $1 million, users will be able to choose between a per-user fee or a 2.5% revenue share, whichever is lesser.</p>
<p>Whitten also said he will <a href="https://youtube.com/live/qyLcI5O9iUY" target="_blank" rel="noopener">conduct a live Q&amp;A at 1 PM PDT today</a>, during which some further clarifications may be made.</p>
<p>Overall the changes seem to address most of the issues people had with the new terms, and importantly it is more or less opt-in (or the unavoidable product of success) come 2024, on new projects, rather than taking effect on games that are out now or have been for years.</p>
<p>But the high-handed manner in which Unity attempted to squeeze its customers has unquestionably spooked the community, and while the threatened exodus will likely now be far smaller, they will remain watchful for future shenanigans. What trust Unity had built up was seriously damaged by this ill-conceived foray, and many developers may look more seriously at competitors rather than run the risk of the company altering the deal again.</p>
			</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Investigation: 78% of carbon offset projects globally are “likely junk“ (286 pts)]]></title>
            <link>https://www.power-technology.com/news/report-majority-carbon-offsets-junk-or-useless/</link>
            <guid>37660256</guid>
            <pubDate>Tue, 26 Sep 2023 14:50:35 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.power-technology.com/news/report-majority-carbon-offsets-junk-or-useless/">https://www.power-technology.com/news/report-majority-carbon-offsets-junk-or-useless/</a>, See on <a href="https://news.ycombinator.com/item?id=37660256">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
                    
                            <header>
            

        <div>
            
                                        
                <p>Analysis found that 39, or 78%, of the 50 environmental projects were categorised as “likely junk or worthless” due to one or more “fundamental failing".</p>

				                
                            

        </div>
    </header>
    <div>
                                  
                                                
                        
                                                                    
                                        
                <!--<p class="drop-cap"></p>-->
                                                <div>
                    <figure>
                        <img src="https://www.power-technology.com/wp-content/uploads/sites/21/2023/08/shutterstock_1274894119-scaled.jpg">
                        <figcaption>Reforestation is one of the most common projects traded within the VCM. Credit: Richard Whitcombe via Shutterstock.</figcaption>
                    </figure>
                </div>
                            
<p>The “vast majority” of environmental projects most commonly used within the voluntary carbon market (VCM) to offset greenhouse gas (GHG) emissions seem to have “fundamental failings” and cannot be relied upon to tackle global warming, according to a joint investigation from the <em>Guardian </em>and non-profit climate watchdog Corporate Accountability.</p>



<p>The <a href="https://www.theguardian.com/environment/2023/sep/19/do-carbon-credit-reduce-emissions-greenhouse-gases?CMP=Share_AndroidApp_Other" target="_blank">investigation analysed</a> the top 50 emission offset projects, selected because they have sold the most carbon credits within the global VCM, and found that most of them exaggerate climate benefits and underestimate the potential harm caused by the project’s activity.</p>



<p>The most popular projects traded globally include forestry schemes, hydroelectric dams, solar and wind farms, waste disposal and greener household appliance schemes across 20 countries, most of which have developing economies. The data comes from <a href="https://alliedoffsets.com/" target="_blank">Allied Offsets,</a> the world’s biggest and most comprehensive emissions trading database, which aggregates information about projects traded within the VCM from their inception.</p>



<p>The analysis found that 39, or 78%, of the 50 projects were categorised as “likely junk or worthless” due to one or more “fundamental failing” that undermines its alleged emissions offsetting power.</p>



<p>Eight others, or 16%, look “problematic”. There is evidence to suggest that they may have at least one fundamental failing and could therefore be “junk”.</p>



<p>The effectiveness of the remaining three projects could not be assessed properly or classified definitively, largely due to a lack of available public, independent information. The analysis also found that $1.16bn worth of carbon credits have been traded so far from those projects classified as “likely junk or worthless”.</p>



<p>The criteria for assessing whether a project is likely junk was based on whether there was “compelling evidence” or a high risk that the project could not guarantee additional GHG emission cuts. In some cases, there was evidence to suggest that projects were leaking further, additional emissions or simply shifting emissions elsewhere. In other cases, evidence was found to suggest that a project’s climate benefits had been exaggerated.</p>



<h2 id="h-carbon-market-actively-exacerbating-the-climate-emergency">Carbon market “actively exacerbating the climate emergency”</h2>



<p>“The ramifications of this analysis are huge, as it points to systemic failings of the voluntary market, providing additional evidence that junk carbon credits pervade,” said Anuradha Mittal, director of the Oakland Institute think tank. “We cannot afford to waste any more time on false solutions. The issues are far-reaching and pervasive, extending well beyond specific verifiers. The VCM is actively exacerbating the climate emergency.”</p>



<p>The VCM has already <a href="https://www.power-technology.com/features/carbon-credits-greenwashing-market/?cf-view&amp;cf-closed" target="_blank">come under fire</a> several times this year after a number of investigations exposed serious shortcomings in the market.</p>



<p>In January, a <a href="https://www.theguardian.com/environment/2023/jan/18/revealed-forest-carbon-offsets-biggest-provider-worthless-verra-aoe" target="_blank">joint investigation</a> by the <em>Guardian, </em>German newspaper <em>Die Zeit </em>and online climate reporters at <em>SourceMaterial, </em>revealed that more than 90% of rainforest offsets offered by Verra, the world’s leading carbon credits certifier, were likely to be “phantom credits” and did not represent genuine emissions reductions.</p>



<p>Verra published a <a href="https://verra.org/statement-vcm-stakeholders-latest-guardian-attack/" target="_blank">statement</a> on Thursday in response to the latest investigation by the <em>Guardian </em>and Corporate Accountability, suggesting that the <em>Guardian </em>has gone “dangerously off track when it comes to reporting on the VCM”.</p>



<p>At the end of May, an <a href="https://www.offshore-technology.com/news/chevron-carbon-offsets-junk-or-harmful/?cf-view" target="_blank">earlier investigation</a> by Corporate Accountability found that 93% of the carbon offsets used by oil and gas giant <a href="https://www.globaldata.com/store/report/?cdmsid=1544307&amp;scalar=true&amp;pid=310253&amp;sid=21" target="_blank">Chevron</a> “seem to be worthless” and should be presumed “junk” until proven otherwise. At the time a spokesperson for Chevron said the report was “biased against [the company’s] industry”.</p>
                
            </div>
    
<section>
                <header>
                                            <h2>More Relevant</h2>
                        <!--<a href="https://www.power-technology.com/" class="view-more-link">
                            View More
                        </a>-->
                    </header>
                        
                                            <!--<h2>Related Rankings</h2>
                        <a href="" class="view-more-link">
                            View More
                        </a>
                    </header>-->
                                    
            </section>


</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Apple exec Eddy Cue set to testify in Google trial about $19B search deal (128 pts)]]></title>
            <link>https://www.cnbc.com/2023/09/26/apple-exec-eddy-cue-testify-google-trial-about-19-billion-search-deal.html</link>
            <guid>37660120</guid>
            <pubDate>Tue, 26 Sep 2023 14:41:30 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.cnbc.com/2023/09/26/apple-exec-eddy-cue-testify-google-trial-about-19-billion-search-deal.html">https://www.cnbc.com/2023/09/26/apple-exec-eddy-cue-testify-google-trial-about-19-billion-search-deal.html</a>, See on <a href="https://news.ycombinator.com/item?id=37660120">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="RegularArticle-ArticleBody-6" data-module="ArticleBody" data-test="articleBody-2" data-analytics="RegularArticle-articleBody-6-2"><div id="ArticleBody-InlineImage-105060036" data-test="InlineImage"><p>Eddy Cue, senior vice president of services at Apple Inc.</p><p>David Paul Morris | Bloomberg | Getty Images</p></div><div><p><span data-test="QuoteInBody" id="RegularArticle-QuoteInBody-1"><a href="https://www.cnbc.com/quotes/AAPL/">Apple</a><span><span id="-WatchlistDropdown" data-analytics-id="-WatchlistDropdown"></span></span></span> senior vice president of services Eddy Cue is expected to testify all day Tuesday in federal court where the U.S. Department of Justice is accusing <span data-test="QuoteInBody" id="RegularArticle-QuoteInBody-2"><a href="https://www.cnbc.com/quotes/GOOGL/">Google</a><span><span id="-WatchlistDropdown" data-analytics-id="-WatchlistDropdown"></span></span></span> of using licensing agreements to monopolize online search.</p><p>Under scrutiny is a deal in which Google pays Apple billions of dollars to be the default search engine on the iPhone's browser and other settings. Google could pay Apple as much as $19 billion this year, according to an estimate from Bernstein.  </p><p>Cue, who <a href="https://www.cnbc.com/2019/06/10/apple-ex-counsel-bruce-sewell-describes-negotiations-with-google.html">negotiated</a> the deal with Google from Apple's side, is expected to testify that Apple picked the Google search engine as an iPhone default because it was the best product. He's also expected to say that Apple doesn't see a reason to create a new Apple search engine because Google already exists, according to a person familiar with Cue's anticipated testimony.</p><p>Cue will also say that Apple has revenue-sharing agreements with competing search engines Yahoo, Microsoft Bing, DuckDuckGo and Ecosia, and that Apple users can change their default search engines, according to a person familiar with Cue's anticipated testimony.</p><p>The testimony could shed some light on one of the <a href="https://www.cnbc.com/2019/06/10/apple-ex-counsel-bruce-sewell-describes-negotiations-with-google.html">highest-profile deals</a> in the technology industry, which has been shrouded in secrecy for the past decade. The money Google pays to Apple for default placement is one of its biggest costs, and the advertising revenue Apple collects from Google is a major part of Apple's profits. </p><p>Apple reports its payments from Google as advertising revenue, reported in its services business, which totaled $78.1 billion in sales in Apple's fiscal 2022. </p><p>"I think their search engine is the best," Apple CEO Tim Cook <a href="https://www.axios.com/2018/11/19/tim-cook-apple-google-search-engine" target="_blank">said</a> when asked about using Google as the iPhone's default search engine in 2018. </p></div><h2><a id="headline0"></a>Google on trial</h2><div><p>Much of Cue's testimony and related financial documents could remain under seal, which means they won't be released to the public.</p><p>Last week, Apple machine learning executive John Giannandrea testified. Before Apple, he worked at Google on its search engine.</p><p>The D.C. District Court judge, Amit Mehta, has said he wants to be conservative about how many documents are released to the public, and last week's Giannandrea testimony was entirely sealed except for 15 minutes, where Giannandrea <a href="https://www.bloomberg.com/news/articles/2023-09-22/apple-ai-chief-posits-new-private-browser-search-at-google-trial" target="_blank">revealed a new search engine setting</a> on the most recent iPhone operating system.</p><p>The DOJ previously had a page on its website where it would post documents and exhibits from the trial, and it was taken down last week on Google's request.</p><p>The Google trial, expected to last 10 weeks, is the <a href="https://www.cnbc.com/2023/09/11/google-to-face-doj-in-the-first-major-tech-monopoly-trial-in-decades.html">biggest technology monopoly trial since</a> the DOJ took <a href="https://en.wikipedia.org/wiki/United_States_v._Microsoft_Corp." target="_blank">on Microsoft</a> more than 20 years ago. The DOJ alleges Google has violated anti-monopoly law by striking exclusive agreements with mobile phone makers for its Android operating system and browser companies for default placement. The government alleges that the practice creates barriers to entry for competing search engines.</p><p>"This case is about the future of the internet and whether Google's search engine will ever face meaningful competition," the DOJ's lawyer, Kenneth Dintzer, told the court <a href="https://www.cnbc.com/2023/09/12/doj-v-google-what-hapened-the-first-day-of-the-anti-monopoly-trial.html">in opening statements</a>. He alleged that Google has more than 89% of the market for general search.</p><p><a href="https://www.cnbc.com/2023/09/08/heres-how-google-plans-to-fight-the-doj.html">Google said</a> before the trial kicked off earlier this month that it sees licensing agreements as a standard business practice that brings its products to consumers and creates a better experience for users. Google also argues that consumers can easily change default search engines on Android and Apple phones.</p><p>The DOJ is expected to present its case for about four weeks, then a coalition of attorneys general will present their case, followed by Google. Google CEO Sundar Pichai is also expected to testify, the DOJ said.</p><p><em>CNBC's Steve Kovach contributed to this story.</em></p></div></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Spinneret: A modern Common Lisp HTML generator (101 pts)]]></title>
            <link>https://github.com/ruricolist/spinneret</link>
            <guid>37660025</guid>
            <pubDate>Tue, 26 Sep 2023 14:36:18 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/ruricolist/spinneret">https://github.com/ruricolist/spinneret</a>, See on <a href="https://news.ycombinator.com/item?id=37660025">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto"><strong>Table of Contents</strong></p>
<ul dir="auto">
<li><a href="#spinneret">Spinneret</a>
<ul dir="auto">
<li><a href="#printing-style">Printing style</a></li>
<li><a href="#inserted-spaces">Inserted spaces</a></li>
<li><a href="#line-wrapping">Line wrapping</a></li>
<li><a href="#syntax">Syntax</a>
<ul dir="auto">
<li><a href="#dynamic-output">Dynamic output</a></li>
<li><a href="#interpreting-trees">Interpreting trees</a></li>
<li><a href="#markdown">Markdown</a></li>
</ul>
</li>
<li><a href="#get-html-path"><code>get-html-path</code></a>
<ul dir="auto">
<li><a href="#html-path"><code>*html-path*</code></a></li>
</ul>
</li>
<li><a href="#deftag"><code>deftag</code></a></li>
<li><a href="#parenscript">Parenscript</a></li>
<li><a href="#validation">Validation</a></li>
</ul>
</li>
</ul>

<h2 tabindex="-1" id="user-content-spinneret" dir="auto"><a href="#spinneret">Spinneret</a></h2>
<p dir="auto">In the crowded space of Common Lisp HTML generators, Spinneret
occupies the following coordinates:</p>
<ul dir="auto">
<li>
<p dir="auto">Modern. Targets HTML5. Does not treat XML and HTML as the same
problem. Assumes you will be serving your documents as UTF-8.</p>
</li>
<li>
<p dir="auto">Composable. Makes it easy to refactor HTML generation into separate
functions and macros.</p>
</li>
<li>
<p dir="auto">Pretty. Treats HTML as a document format, not a serialization.
Output is idiomatic and readable, following the coding style of the
HTML5 specification.</p>
</li>
<li>
<p dir="auto">Aggressive. If something can be interpreted as HTML, then it will
be, meaning that some Lisp forms can't be mixed with HTML syntax. In
the trade-off between 90% convenience and 10% correctness Spinneret
is on the side of convenience.</p>
</li>
<li>
<p dir="auto">Bilingual. Spinneret (after loading <code>spinneret/ps</code>) has the same semantics in Lisp and <a href="https://parenscript.common-lisp.dev/" rel="nofollow">Parenscript</a>.</p>
</li>
</ul>
<p dir="auto">HTML generation with Spinneret looks like this:</p>
<div data-snippet-clipboard-copy-content=" (in-package #:spinneret)

 (defparameter *shopping-list*
   '(&quot;Atmospheric ponds&quot;
     &quot;Electric gumption socks&quot;
     &quot;Mrs. Leland's embyronic television combustion&quot;
     &quot;Savage gymnatic aggressors&quot;
     &quot;Pharmaceutical pianos&quot;
     &quot;Intravenous retribution champions&quot;))

 (defparameter *user-name* &quot;John Q. Lisper&quot;)

 (defparameter *last-login* &quot;12th Never&quot;)

 (defmacro with-page ((&amp;key title) &amp;body body)
   `(with-html
      (:doctype)
      (:html
        (:head
         (:title ,title))
        (:body ,@body))))

 (defun shopping-list ()
   (with-page (:title &quot;Home page&quot;)
     (:header
      (:h1 &quot;Home page&quot;))
     (:section
      (&quot;~A, here is *your* shopping list: &quot; *user-name*)
      (:ol (dolist (item *shopping-list*)
             (:li (1+ (random 10)) item))))
     (:footer (&quot;Last login: ~A&quot; *last-login*))))"><pre><code> (in-package #:spinneret)

 (defparameter *shopping-list*
   '("Atmospheric ponds"
     "Electric gumption socks"
     "Mrs. Leland's embyronic television combustion"
     "Savage gymnatic aggressors"
     "Pharmaceutical pianos"
     "Intravenous retribution champions"))

 (defparameter *user-name* "John Q. Lisper")

 (defparameter *last-login* "12th Never")

 (defmacro with-page ((&amp;key title) &amp;body body)
   `(with-html
      (:doctype)
      (:html
        (:head
         (:title ,title))
        (:body ,@body))))

 (defun shopping-list ()
   (with-page (:title "Home page")
     (:header
      (:h1 "Home page"))
     (:section
      ("~A, here is *your* shopping list: " *user-name*)
      (:ol (dolist (item *shopping-list*)
             (:li (1+ (random 10)) item))))
     (:footer ("Last login: ~A" *last-login*))))
</code></pre></div>
<p dir="auto">Which produces:</p>
<div data-snippet-clipboard-copy-content=" <!DOCTYPE html>
 <html lang=en>
  <head>
   <meta charset=UTF-8>
   <title>Home page</title>
  </head>
  <body>
   <header>
    <h1>Home page</h1>
   </header>
   <section>
    John Q. Lisper, here is <em>your</em> shopping list:
    <ol>
     <li>10 Atmospheric ponds
     <li>6 Electric gumption socks
     <li>4 Mrs. Leland's embyronic television combustion
     <li>9 Savage gymnatic aggressors
     <li>6 Pharmaceutical pianos
     <li>9 Intravenous retribution champions
    </ol>
   </section>
   <footer>
    Last login: 12th Never
   </footer>
  </body>
 </html>"><pre><code> &lt;!DOCTYPE html&gt;
 &lt;html lang=en&gt;
  &lt;head&gt;
   &lt;meta charset=UTF-8&gt;
   &lt;title&gt;Home page&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
   &lt;header&gt;
    &lt;h1&gt;Home page&lt;/h1&gt;
   &lt;/header&gt;
   &lt;section&gt;
    John Q. Lisper, here is &lt;em&gt;your&lt;/em&gt; shopping list:
    &lt;ol&gt;
     &lt;li&gt;10 Atmospheric ponds
     &lt;li&gt;6 Electric gumption socks
     &lt;li&gt;4 Mrs. Leland's embyronic television combustion
     &lt;li&gt;9 Savage gymnatic aggressors
     &lt;li&gt;6 Pharmaceutical pianos
     &lt;li&gt;9 Intravenous retribution champions
    &lt;/ol&gt;
   &lt;/section&gt;
   &lt;footer&gt;
    Last login: 12th Never
   &lt;/footer&gt;
  &lt;/body&gt;
 &lt;/html&gt;
</code></pre></div>
<p dir="auto">(Pretty-printing is pretty fast, but Spinneret obeys <code>*print-pretty*</code>
should you want to turn it off.)</p>
<h3 tabindex="-1" id="user-content-printing-style" dir="auto"><a href="#printing-style">Printing style</a></h3>
<p dir="auto">Spinneret tries hard to produce human-writable output – output that
looks like a human being wrote it. Sometimes, however, you may have
markup to render that there is no human-writable way to render,
because no human being would ever write it.</p>
<p dir="auto">In these cases you can set or bind the <code>*html-style*</code> variable to
control Spinneret’s print style. The default is <code>:human</code>, which means
to attempt to produce human-writable output. It can also be set to
<code>:tree</code>, which simply prints every element as if it were a block
element, and every run of text on a new line.</p>
<div data-snippet-clipboard-copy-content="(let ((*html-style* :human))
  (with-html
    (:div
      (:p &quot;Text &quot; (:a &quot;link text&quot;) &quot; more text&quot;))))
=> <div>
    <p>Text <a>link text</a> more text
   </div>&quot;

(let ((*html-style* :tree))
  (with-html-string
    (:div
      (:p &quot;Text &quot; (:a &quot;link text&quot;) &quot; more text&quot;))))
=> <div>
    <p>
     Text
     <a>
      link text
     </a>
      more text
    </p>
   </div>"><pre><code>(let ((*html-style* :human))
  (with-html
    (:div
      (:p "Text " (:a "link text") " more text"))))
=&gt; &lt;div&gt;
    &lt;p&gt;Text &lt;a&gt;link text&lt;/a&gt; more text
   &lt;/div&gt;"

(let ((*html-style* :tree))
  (with-html-string
    (:div
      (:p "Text " (:a "link text") " more text"))))
=&gt; &lt;div&gt;
    &lt;p&gt;
     Text
     &lt;a&gt;
      link text
     &lt;/a&gt;
      more text
    &lt;/p&gt;
   &lt;/div&gt;
</code></pre></div>
<p dir="auto">With <code>*html-style*</code> bound to <code>:tree</code>, and <code>*print-pretty*</code> bound to
nil, output is verbose but predictable:</p>
<div data-snippet-clipboard-copy-content="(let ((*html-style* :tree)
      (*print-pretty* nil))
  (with-html-string
    (:div
      (:p &quot;Text &quot; (:a &quot;link text&quot;) &quot; more text&quot;))))
=> &quot;<div><p>Text <a>link text</a>  more text</p></div>&quot;"><pre><code>(let ((*html-style* :tree)
      (*print-pretty* nil))
  (with-html-string
    (:div
      (:p "Text " (:a "link text") " more text"))))
=&gt; "&lt;div&gt;&lt;p&gt;Text &lt;a&gt;link text&lt;/a&gt;  more text&lt;/p&gt;&lt;/div&gt;"
</code></pre></div>
<p dir="auto">Notice that binding <code>*html-style*</code> to <code>:tree</code> ensures that all tags are
closed.</p>
<h3 tabindex="-1" id="user-content-inserted-spaces" dir="auto"><a href="#inserted-spaces">Inserted spaces</a></h3>
<p dir="auto">By default, when objects are output to HTML, spaces are inserted betweeen them. This is nearly always the right thing to do, but in some special cases, the spaces may be a problem. They can be turned off by setting the flag <code>*suppress-inserted-spaces*</code> to <code>t</code>.</p>
<h3 tabindex="-1" id="user-content-line-wrapping" dir="auto"><a href="#line-wrapping">Line wrapping</a></h3>
<p dir="auto">When pretty-printing, Spinneret makes the best decisions about line
wrapping that it can, given the information it has about how to get
the print length of various types. But, in the case of user-defined
types, it has no way to tell in advance how long they will be when
printed. If you find Spinneret is making bad line-breaking decisions
with your types, you can help it out by specializing <code>html-length</code>.
For example, if you use PURI, you could help Spinneret pretty-print
PURI URIs by teaching it how to get their length:</p>
<div data-snippet-clipboard-copy-content="(defmethod html-length ((uri puri:uri))
  ;; Doesn't cons.
  (length (puri:render-uri uri nil)))"><pre><code>(defmethod html-length ((uri puri:uri))
  ;; Doesn't cons.
  (length (puri:render-uri uri nil)))
</code></pre></div>
<h2 tabindex="-1" id="user-content-syntax" dir="auto"><a href="#syntax">Syntax</a></h2>
<p dir="auto">The rules for WITH-HTML are these:</p>
<ul dir="auto">
<li>
<p dir="auto">All generated forms write to <code>*html*</code>.</p>
</li>
<li>
<p dir="auto">A keyword in function position is interpreted as a tag name. If the
name is not valid as a tag, it is ignored.</p>
<p dir="auto">Certain keywords are recognized as pseudo-tags and given special
treatment:</p>
<p dir="auto">:RAW :DOCTYPE :!DOCTYPE :CDATA :!-- :COMMENT :HTML :HEAD :H* :TAG</p>
<ul dir="auto">
<li>
<p dir="auto">The pseudotag :RAW can be used to bypass Spinneret’s implicit
escaping for raw output. This allows inserting HTML literals, and
bypasses pretty printing.</p>
<p dir="auto">Note that you need :RAW for inline stylesheets and scripts,
otherwise angle brackets will be escaped as if they were HTML:</p>
<div dir="auto" data-snippet-clipboard-copy-content="(with-html-string (:style &quot;a > p{color: white;}&quot;))
=> &quot;<style>a &amp;gt; p{color: white;}</style>&quot;

(with-html-string (:style (:raw &quot;a > p{color: white;}&quot;)))
=> &quot;<style>a > p{color: white;}</style>&quot;
"><pre>(with-html-string (:style <span><span>"</span>a &gt; p{color: white;}<span>"</span></span>))
=&gt; <span><span>"</span>&lt;style&gt;a &amp;gt; p{color: white;}&lt;/style&gt;<span>"</span></span>

(with-html-string (:style (:raw <span><span>"</span>a &gt; p{color: white;}<span>"</span></span>)))
=&gt; <span><span>"</span>&lt;style&gt;a &gt; p{color: white;}&lt;/style&gt;<span>"</span></span>
</pre></div>
</li>
<li>
<p dir="auto">The pseudotags :!– and :COMMENT insert comments into the output.</p>
</li>
<li>
<p dir="auto">The pseudotag :H* renders as one of :H1 through :H6 depending on
how many :SECTION elements it is dynamically nested inside. At the
top level, :H* is equivalent to :H1. Inside the dynamic extent of
one :SECTION tag, it is equivalent to :H2; inside two section
tags, it is equivalent to :H3; and so forth up to :H6.</p>
</li>
<li>
<p dir="auto">The pseudotag :TAG allows dynamic selection of a tag.</p>
</li>
</ul>
<p dir="auto">The value of the LANG attribute of HTML is controlled by
<code>*html-lang*</code>; the value of the meta charset attribute is controlled
by <code>*html-charset*</code>. These are defaults; passing an explicit
attribute takes precedence.</p>
<p dir="auto">Constant classes and ids can be specified with a selector-like
syntax. E.g.:</p>
<div data-snippet-clipboard-copy-content="  (:div#wrapper (:div.section ...))
  ≡ (:div :id &quot;wrapper&quot; (:div :class &quot;section&quot; ...))"><pre><code>  (:div#wrapper (:div.section ...))
  ≡ (:div :id "wrapper" (:div :class "section" ...))
</code></pre></div>
</li>
<li>
<p dir="auto">Keyword-value pairs following a tag are interpreted as attributes.
HTML syntax may not be used in attribute values. Attributes with nil
values are omitted from the output. Boolean attributes with non-nil
values are minimized.</p>
<p dir="auto">Duplicate attributes are handled like duplicate keyword arguments:
all values are evaluated, but only the leftmost value is used. The
exception is the handling of tokenized attributes, such as :CLASS or
:REL. The class of a tag is the union of all its :CLASS arguments.</p>
<p dir="auto">The argument :DATASET introduces a list of :DATA-FOO arguments:</p>
<div data-snippet-clipboard-copy-content="  (:p :dataset (:duck (dolomphious) :fish 'fizzgigious
                      :spoon &quot;runcible&quot;))
  ≡ (:p :data-duck (dolomphious) :data-fish 'fizzgigious
        :data-spoon &quot;runcible&quot;)"><pre><code>  (:p :dataset (:duck (dolomphious) :fish 'fizzgigious
                      :spoon "runcible"))
  ≡ (:p :data-duck (dolomphious) :data-fish 'fizzgigious
        :data-spoon "runcible")
</code></pre></div>
<p dir="auto">For flexibility, even at the cost of efficiency, the argument :ATTRS
introduces a form to evaluate at run time for a plist of extra
attributes and values.</p>
</li>
<li>
<p dir="auto">Forms after the attributes are treated as arguments. Each non-nil
(primary) value returned by an argument to a tag is written to the
stream by HTML, a generic function on which you can define your own
methods. By default only literal arguments are printed. Literal
arguments are strings, characters, numbers and symbols beside NIL.</p>
</li>
</ul>
<p dir="auto">WITH-HTML-STRING is like WITH-HTML, but intercepts the generated HTML
at run time and returns a string.</p>
<h3 tabindex="-1" id="user-content-dynamic-output" dir="auto"><a href="#dynamic-output">Dynamic output</a></h3>
<p dir="auto">For flexibility, even at the cost of efficiency, the pseudo-attribute
:ATTRS introduces a form to evaluate at run time for a plist of extra
attributes and values.</p>
<div data-snippet-clipboard-copy-content="(:p :attrs (list :id &quot;dynamic!&quot;))
=> <p id=&quot;dynamic!&quot;>"><pre><code>(:p :attrs (list :id "dynamic!"))
=&gt; &lt;p id="dynamic!"&gt;
</code></pre></div>
<p dir="auto">Similarly, the pseudo-tag :TAG allows you to select a tag at run time.</p>
<div data-snippet-clipboard-copy-content="(:tag :name &quot;div&quot;
 (:tag :name &quot;p&quot;
  (:tag :name &quot;span&quot;
    &quot;Hello.&quot;)))
≡ (:div (:p (:span &quot;Hello&quot;)))"><pre><code>(:tag :name "div"
 (:tag :name "p"
  (:tag :name "span"
    "Hello.")))
≡ (:div (:p (:span "Hello")))
</code></pre></div>
<p dir="auto">Note that :TAG only allows you to <em>select</em> a tag, not <em>create</em> one.
The tag must still be one that is known to Spinneret to be valid. (That is, either defined as part of HTML or matching the requirements for a custom element.)</p>
<p dir="auto">For maximum dynamicity, you can combine :TAG and :ATTRS:</p>
<div data-snippet-clipboard-copy-content="(:tag :name &quot;div&quot; :attrs (list :id &quot;dynamic!&quot;))
=> <div id=dynamic!></div>"><pre><code>(:tag :name "div" :attrs (list :id "dynamic!"))
=&gt; &lt;div id=dynamic!&gt;&lt;/div&gt;
</code></pre></div>
<h3 tabindex="-1" id="user-content-interpreting-trees" dir="auto"><a href="#interpreting-trees">Interpreting trees</a></h3>
<p dir="auto">For the <em>ne plus ultra</em> of flexibility, you can interpret trees at runtime using a subset of Spinneret syntax:</p>
<div data-snippet-clipboard-copy-content="(interpret-html-tree `(:div :id &quot;dynamic!&quot;))
=> <div id=dynamic!></div>"><pre><code>(interpret-html-tree `(:div :id "dynamic!"))
=&gt; &lt;div id=dynamic!&gt;&lt;/div&gt;
</code></pre></div>
<p dir="auto">The interpreter is still under development; it supports most but not yet all Spinneret syntax.</p>
<h3 tabindex="-1" id="user-content-markdown" dir="auto"><a href="#markdown">Markdown</a></h3>
<p dir="auto">If the additional system <code>spinneret/cl-markdown</code> is loaded, then a
string in function position is first compiled as Markdown (using
<a href="https://github.com/gwkkwg/cl-markdown">CL-MARKDOWN</a>), then passed to <code>format</code> as a control string and
applied to its arguments.</p>
<p dir="auto">This is useful for inline formatting, like links, where sexps would be
clumsy:</p>
<div data-snippet-clipboard-copy-content="(with-html
 (&quot;Here is some copy, with [a link](~a)&quot; link))

(with-html
  (:span &quot;Here is some copy, with &quot;
    (:a :href link &quot;a link.&quot;)))"><pre><code>(with-html
 ("Here is some copy, with [a link](~a)" link))

(with-html
  (:span "Here is some copy, with "
    (:a :href link "a link.")))
</code></pre></div>
<h2 tabindex="-1" id="user-content-get-html-path" dir="auto"><a href="#get-html-path"><code>get-html-path</code></a></h2>
<p dir="auto">Sometimes it is useful for a piece of HTML-generating code to know
where in the document it appears. You might, for example, want to
define a <code>tabulate</code> function that prints list-of-lists as rows of
cells, but only prints the surrounding <code>&lt;table&gt;&lt;/table&gt;</code> if it is not
already within a table. The function <code>get-html-path</code> returns a list of
open tags, from latest to earliest. Usually it will look something
like</p>
<div data-snippet-clipboard-copy-content="  (get-html-path) ;-> '(:table :section :body :html)"><pre><code>  (get-html-path) ;-&gt; '(:table :section :body :html)
</code></pre></div>
<p dir="auto">Thus `tabulate' could be written</p>
<div data-snippet-clipboard-copy-content=" (defun tabulate (&amp;rest rows)
   (with-html
     (flet ((tabulate ()
              (loop for row in rows do
                (:tr (loop for cell in row do
                  (:td cell))))))
       (if (find :table (get-html-path))
           (tabulate)
           (:table (:tbody (tabulate)))))))"><pre><code> (defun tabulate (&amp;rest rows)
   (with-html
     (flet ((tabulate ()
              (loop for row in rows do
                (:tr (loop for cell in row do
                  (:td cell))))))
       (if (find :table (get-html-path))
           (tabulate)
           (:table (:tbody (tabulate)))))))
</code></pre></div>
<p dir="auto">Note that <code>get-html-path</code> returns a freshly-consed list each time it
is called.</p>
<h3 tabindex="-1" id="user-content-html-path" dir="auto"><a href="#html-path"><code>*html-path*</code></a></h3>
<p dir="auto">The variable underneath <code>get-html-path</code> is <code>*html-path*</code>, and it can
be let-bound to manipulate the nested tags (like <code>:h*</code> and <code>tabulate</code>
from the example above).</p>
<p dir="auto">WARNING: Spinneret binds <code>*html-path*</code> with <a href="http://clhs.lisp.se/Body/d_dynami.htm" rel="nofollow">dynamic
extent</a>. If you need to inspect
the binding, use <code>get-html-path</code> instead to get a value you can safely
store.</p>
<p dir="auto"><code>*html-path*</code> is most useful if the document generated by Spinneret is
split into several functions. Binding <code>*html-path*</code> allows to preserve
the structure of the document there.</p>
<p dir="auto">Example:</p>
<div dir="auto" data-snippet-clipboard-copy-content="(defun inner-section ()
  &quot;Binds *HTML-PATH* to replicate the depth the output is used in.&quot;
  (with-html-string
    (let ((*html-path* (append *html-path* '(:section :section))))
      (:h* &quot;Heading three levels deep&quot;))))

(defun outer-section (html)
  &quot;Uses HTML from elsewhere and embed it into a section&quot;
  (with-html-string
    (:section
     (:h* &quot;Heading two levels deep&quot;)
     (:section
      (:raw html)))))

(outer-section (inner-section))
;; <section>
;; <h2>Heading two levels deep</h2>
;; <section><h3>Heading three levels deep</h3>
;; </section>
;;</section>"><pre>(<span>defun</span> <span>inner-section</span> ()
  <span><span>"</span>Binds *HTML-PATH* to replicate the depth the output is used in.<span>"</span></span>
  (with-html-string
    (<span>let</span> ((<span>*html-path*</span> (<span>append</span> <span>*html-path*</span> '(:section :section))))
      (:h* <span><span>"</span>Heading three levels deep<span>"</span></span>))))

(<span>defun</span> <span>outer-section</span> (html)
  <span><span>"</span>Uses HTML from elsewhere and embed it into a section<span>"</span></span>
  (with-html-string
    (:section
     (:h* <span><span>"</span>Heading two levels deep<span>"</span></span>)
     (:section
      (:raw html)))))

(outer-section (inner-section))
<span><span>;</span>; &lt;section&gt;</span>
<span><span>;</span>; &lt;h2&gt;Heading two levels deep&lt;/h2&gt;</span>
<span><span>;</span>; &lt;section&gt;&lt;h3&gt;Heading three levels deep&lt;/h3&gt;</span>
<span><span>;</span>; &lt;/section&gt;</span>
<span><span>;</span>;&lt;/section&gt;</span></pre></div>
<h2 tabindex="-1" id="user-content-deftag" dir="auto"><a href="#deftag"><code>deftag</code></a></h2>
<p dir="auto">The stumbling block for all sexp-based HTML generators is order of
evaluation. It's tempting to write something like this:</p>
<div data-snippet-clipboard-copy-content=" ;; Doesn't work
 (defun field (control)
   (with-html (:p control)))

 (defun input (default &amp;key name label (type &quot;text&quot;))
   (with-html
     (:label :for name label)
     (:input :name name :id name :type type :value default)))"><pre><code> ;; Doesn't work
 (defun field (control)
   (with-html (:p control)))

 (defun input (default &amp;key name label (type "text"))
   (with-html
     (:label :for name label)
     (:input :name name :id name :type type :value default)))
</code></pre></div>
<p dir="auto">But it won't work: in <code>(field (input "Default" :name "why" :label "Reason"))</code>, <code>(input)</code> gets evaluated before <code>(field)</code>, and the HTML
is printed inside-out.</p>
<p dir="auto">Macros do work:</p>
<div data-snippet-clipboard-copy-content=" (defmacro field (control)
   `(with-html (:p ,control)))

 (defmacro input (name label &amp;key (type &quot;text&quot;))
   `(with-html
      (:label :for ,name ,label)
      (:input :name ,name :id ,name :type ,type)))"><pre><code> (defmacro field (control)
   `(with-html (:p ,control)))

 (defmacro input (name label &amp;key (type "text"))
   `(with-html
      (:label :for ,name ,label)
      (:input :name ,name :id ,name :type ,type)))
</code></pre></div>
<p dir="auto">But we can do better than this. Spinneret provides a macro-writing
macro, <code>deftag</code>, which lets you <em>refactor</em> HTML without <em>hiding</em> it.</p>
<div data-snippet-clipboard-copy-content=" (deftag field (control attrs)
  `(:p ,@attrs ,@control))

 (deftag input (default attrs &amp;key name label (type &quot;text&quot;))
   (once-only (name)
     `(progn
        (:label :for ,name ,label)
        (:input :name ,name :id ,name :type ,type
          ,@attrs
          :value (progn ,@default)))))"><pre><code> (deftag field (control attrs)
  `(:p ,@attrs ,@control))

 (deftag input (default attrs &amp;key name label (type "text"))
   (once-only (name)
     `(progn
        (:label :for ,name ,label)
        (:input :name ,name :id ,name :type ,type
          ,@attrs
          :value (progn ,@default)))))
</code></pre></div>
<p dir="auto">A macro defined using <code>deftag</code> takes its arguments just like an HTML
element. Instead of</p>
<div data-snippet-clipboard-copy-content="(input &quot;Default&quot; :name &quot;why&quot; :label &quot;Reason&quot;) ; defmacro"><pre><code>(input "Default" :name "why" :label "Reason") ; defmacro
</code></pre></div>
<p dir="auto">You write</p>
<div data-snippet-clipboard-copy-content="(input :name &quot;why&quot; :label &quot;Reason&quot; &quot;Default&quot;) ; deftag"><pre><code>(input :name "why" :label "Reason" "Default") ; deftag
</code></pre></div>
<p dir="auto">The macro re-arranges the arguments so they can be bound to an
ordinary lambda list, like the one above: the body of the tag is bound
to the first argument, and matching attributes are bound to keywords.
Multiple <code>:class</code> arguments, <code>:dataset</code>, and other shorthands are
handled exactly as in the usual HTML syntax.</p>
<p dir="auto">But the great advantage of <code>deftag</code> is how it handles attributes which
are <em>not</em> bound to keywords. In the definition of <code>input</code> using
<code>deftag</code>, you see that the <code>attrs</code> catch-all argument is spliced into
the call to <code>:input</code>. This means that any unhandled attributes pass
through to the actual input element.</p>
<div data-snippet-clipboard-copy-content="(input :name &quot;why&quot; :label &quot;Reason&quot; :required t :class &quot;special&quot; &quot;Default&quot;)
=> <label for=why>Reason</label>
   <input class=special name=why id=why type=text required value=Default>"><pre><code>(input :name "why" :label "Reason" :required t :class "special" "Default")
=&gt; &lt;label for=why&gt;Reason&lt;/label&gt;
   &lt;input class=special name=why id=why type=text required value=Default&gt;
</code></pre></div>
<p dir="auto">In effect, <code>input</code> <em>extends</em> the <code>:input</code> tag, almost like a subclass.
This is a very idiomatic and expressive way of building abstractions
over HTML.</p>
<p dir="auto">(Spinneret used to provide a more elaborate way of building HTML
abstractions, <code>deftemplate</code>, but <code>deftag</code> is simpler and more useful.)</p>
<h2 tabindex="-1" id="user-content-spinneret-in-parenscript" dir="auto"><a href="#spinneret-in-parenscript">Spinneret in Parenscript</a></h2>
<p dir="auto">To use Spinneret with Parenscript, load the system <code>spinneret/ps</code>.</p>
<p dir="auto">The semantics of Spinneret in Parenscript are almost the same. There
is no <code>with-html-string</code>, and <code>with-html</code> returns a
<code>DocumentFragment</code>.</p>
<p dir="auto">If Markdown support is enabled, strings in function position are still
parsed as Markdown, but supplying arguments triggers an error (since
Parenscript does not have <code>format</code>).</p>
<p dir="auto"><code>get-html-path</code> is not implemented for Parenscript.</p>
<p dir="auto">Neither :ATTRS nor :TAG is available in Parenscript.</p>
<h2 tabindex="-1" id="user-content-parenscript-in-spinneret" dir="auto"><a href="#parenscript-in-spinneret">Parenscript in Spinneret</a></h2>
<p dir="auto">To use Parenscript in Spinneret, remember to wrap the <code>ps</code> macro with <code>:raw</code>, otherwise the generated JavaScript will be escaped.</p>
<div dir="auto" data-snippet-clipboard-copy-content="(with-html-string
  (:script
    (:raw (ps
            (defun greeting ()
              (alert &quot;Hello&quot;))))))
=>
&quot;<script>function greeting() {
    __PS_MV_REG = [];
    return alert('Hello');
};</script>&quot;

(with-html-string
  (:div :onclick (:raw (ps (alert &quot;Hello&quot;)))))
&quot;<div onclick=\&quot;alert('Hello');\&quot;></div>&quot;"><pre>(with-html-string
  (:script
    (:raw (ps
            (<span>defun</span> <span>greeting</span> ()
              (alert <span><span>"</span>Hello<span>"</span></span>))))))
=&gt;
<span><span>"</span>&lt;script&gt;function greeting() {</span>
<span>    __PS_MV_REG = [];</span>
<span>    return alert('Hello');</span>
<span>};&lt;/script&gt;<span>"</span></span>

(with-html-string
  (:div :onclick (:raw (ps (alert <span><span>"</span>Hello<span>"</span></span>)))))
<span><span>"</span>&lt;div onclick=<span>\"</span>alert('Hello');<span>\"</span>&gt;&lt;/div&gt;<span>"</span></span></pre></div>
<h2 tabindex="-1" id="user-content-validation" dir="auto"><a href="#validation">Validation</a></h2>
<p dir="auto">Spinneret does not do document validation, but it does warn, at compile time, about invalid tags and attributes.</p>
<p dir="auto">Although HTML5 does include a mechanism for application-specific
attributes (the <code>data-</code> prefix), some client-side frameworks choose to
employ their own prefixes instead. You can disable validation for a
given prefix by adding it to <code>*unvalidated-attribute-prefixes*</code>.</p>
<div data-snippet-clipboard-copy-content="(pushnew &quot;ng-&quot; *unvalidated-attribute-prefixes* :test #’equal)"><pre><code>(pushnew "ng-" *unvalidated-attribute-prefixes* :test #’equal)
</code></pre></div>
<p dir="auto">You can disable attribute validation altogether by adding the empty
string to the list:</p>
<div data-snippet-clipboard-copy-content=";; Disable attribute validation.
(setf *unvalidated-attribute-prefixes* '(&quot;&quot;))"><pre><code>;; Disable attribute validation.
(setf *unvalidated-attribute-prefixes* '(""))
</code></pre></div>
<p dir="auto">Tags are considered valid if they are defined as part of the HTML standard, or if they match the rules for the name of a <a href="https://html.spec.whatwg.org/multipage/custom-elements.html#valid-custom-element-name" rel="nofollow">custom element</a> – basically, start with an ASCII alphabetic character and include a hyphen. For custom elements, attributes are not validated.</p>
</article>
          </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Harvard: Student Use Cases for AI (108 pts)]]></title>
            <link>https://hbsp.harvard.edu/inspiring-minds/student-use-cases-for-ai</link>
            <guid>37659542</guid>
            <pubDate>Tue, 26 Sep 2023 14:07:19 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://hbsp.harvard.edu/inspiring-minds/student-use-cases-for-ai">https://hbsp.harvard.edu/inspiring-minds/student-use-cases-for-ai</a>, See on <a href="https://news.ycombinator.com/item?id=37659542">Hacker News</a></p>
&lt;Unparsable&gt;]]></description>
        </item>
        <item>
            <title><![CDATA[Google Podcasts to shut down in 2024 (191 pts)]]></title>
            <link>https://techcrunch.com/2023/09/26/google-podcasts-to-shut-down-in-2024-with-listeners-migrated-to-youtube-music/</link>
            <guid>37659482</guid>
            <pubDate>Tue, 26 Sep 2023 14:04:11 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://techcrunch.com/2023/09/26/google-podcasts-to-shut-down-in-2024-with-listeners-migrated-to-youtube-music/">https://techcrunch.com/2023/09/26/google-podcasts-to-shut-down-in-2024-with-listeners-migrated-to-youtube-music/</a>, See on <a href="https://news.ycombinator.com/item?id=37659482">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
				<p id="speakable-summary">Google announced this morning it will be shutting down its Google Podcasts app later in 2024 as part of its broader transition to move its streaming listeners over to YouTube Music. The company earlier this year announced YouTube Music <a href="https://techcrunch.com/2023/04/27/youtube-music-officially-launches-podcasts-for-listeners-in-the-us/">would begin supporting podcasts in the U.S.</a>, which will expand globally by year-end, and more recently said it was adding the ability for <a href="https://techcrunch.com/2023/08/25/youtube-to-support-rss-uploads-for-podcasters-by-year-end-plus-private-feeds-in-youtube-music/">podcasters to upload their RSS feeds to YouTube</a> also by year-end.</p>
<p>Today, Google says it plans on further increasing its investment in the podcast experience on YouTube Music and making it more of a destination for podcast fans with features focused on discovery, community, and switching between audio podcasts and video. The latter is something rival Spotify has also been working on with its <a href="https://techcrunch.com/2022/11/15/spotifys-video-podcast-publishing-tools-expand-to-creators-worldwide/">rollout of video podcast support</a> to creators worldwide last year along with <a href="https://techcrunch.com/2023/03/08/spotify-is-revamping-its-podcaster-tools-including-anchor-and-is-partnering-with-patreon/">community features like Q&amp;As and polls.</a></p>
<p>However, to make YouTube Music the new home for podcasts, that means moving users away from the current offering, Google Podcasts. The company notes this plan reflects how people are already listening. According to Edison, about 23% of weekly podcast users in the U.S. say YouTube is their most frequently used service versus just 4% for Google Podcasts.</p>
<p>To help users with the transition to YouTube Music, the company will offer Google Podcast users a migration tool and the ability to add podcast RSS feeds to their YouTube Music library, including shows that aren’t currently hosted by YouTube — something <a href="https://techcrunch.com/2023/08/25/youtube-to-support-rss-uploads-for-podcasters-by-year-end-plus-private-feeds-in-youtube-music/">it had announced last month was in the works.</a> These migration tools aren’t yet available but will be worked on in the coming weeks and months before being rolled out to all users.</p>
<p>In addition, Google will also support the option to download an OPML file of their show subscriptions from Google Podcasts, which they can upload to any app that supports importing if they don’t want to move to YouTube Music.</p>
<p>“We know this transition will take time, but these efforts will allow us to build an amazing product and a single destination that rewards creators and artists and provides fans with the best Podcasts experience,” <a href="https://blog.youtube/news-and-events/creating-a-centralized-podcast-destination-on-youtube-music/">a YouTube blog post explained.</a> “For now, nothing is changing and fans will continue to have access to YouTube, YouTube Music, and Google Podcasts. We’re committed to being transparent in communicating future changes with our users and podcasters and will have more to share about this process in the coming months,” it said.</p>
<p>Google has been slowly shifting users away from older products in its effort to make YouTube Music more of a competitor to Spotify, Apple Music, Amazon Music and others. In 2020, YouTube Music offered a similar transition strategy to <a href="https://techcrunch.com/2020/05/12/youtube-music-adds-a-transfer-option-ahead-of-google-play-musics-shutdown-this-year/">move music listeners away from Google Play Music ahead of its shutdown</a> that year. However, podcasts have a more difficult product because so many users turn to YouTube itself to listen to podcasts, not to the dedicated Google Podcasts app. Meanwhile, YouTube Music hasn’t been ready to support podcasts until more recently.</p>
<p>The move will leave only Apple among the major players that hasn’t consolidated music and podcasts into a single destination, as Spotify, Amazon and Pandora all offer both types of audio in their flagship applications.</p>
			</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Newly discovered deep-sea enzyme breaks down PET plastic (148 pts)]]></title>
            <link>https://phys.org/news/2023-09-newly-deep-sea-enzyme-pet-plastic.amp</link>
            <guid>37659327</guid>
            <pubDate>Tue, 26 Sep 2023 13:52:58 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://phys.org/news/2023-09-newly-deep-sea-enzyme-pet-plastic.amp">https://phys.org/news/2023-09-newly-deep-sea-enzyme-pet-plastic.amp</a>, See on <a href="https://news.ycombinator.com/item?id=37659327">Hacker News</a></p>
<div id="readability-page-1" class="page"><article>
    

    
    

    <div id="popover">
            <p>
             This article has been reviewed according to Science&nbsp;X's <a href="https://sciencex.com/help/editorial-process/" target="_blank">editorial process</a>
                and <a href="https://sciencex.com/help/editorial-standards/" target="_blank"> policies</a>. 
                <a href="https://sciencex.com/help/editorial-team/" target="_blank">Editors</a> have highlighted the following attributes while ensuring the content's credibility: 
            </p>
            <div>
                                            <p><span></span> fact-checked
                </p>
                                                            <p><span></span> peer-reviewed publication
                </p>
                                                                                                                                                                            <p><span></span> proofread
                </p>
                                          
            </div>
            </div>

    

    <div>
        <p>
                                    by Eva Sittig
                                                
                    , 
                                                            
                                    Christian-Albrechts-Universität zu Kiel
                                        
                            </p>
        
    </div>

    
    
<div>
    <figure itemprop="image" itemscope="" itemtype="https://schema.org/ImageObject" id="i1110920">
        <amp-img on="tap:lbx1110920" role="button" tabindex="0" src="https://scx2.b-cdn.net/gfx/news/2023/newly-discovered-deep.jpg" srcset="https://scx1.b-cdn.net/csz/news/800w/2023/newly-discovered-deep.jpg?f=webp 800w" layout="responsive" width="1280" height="735" alt="Newly discovered deep-sea enzyme breaks down PET plastic">
        </amp-img>
                    <figcaption itemprop="description" on="tap:AMP.setState({expanded: !expanded})" tabindex="0" role="button" [class]="expanded ? 'desc expanded' : 'desc'">The crystal structure of PET46 resembles the crystal structure of the IsPETase and LCC - with unique features. Credit: <i>Communications Chemistry</i> (2023). DOI: 10.1038/s42004-023-00998-z</figcaption>
            </figure>
    <amp-lightbox id="lbx1110920" layout="nodisplay" animate-in="fly-in-bottom">
        <div>
            <p><span>× </span> close
            </p>
            <amp-img on="tap:lbx1110920" role="button" tabindex="0" src="https://scx2.b-cdn.net/gfx/news/hires/2023/newly-discovered-deep.jpg" layout="fill" alt="Newly discovered deep-sea enzyme breaks down PET plastic">
            </amp-img>
            <figcaption on="tap:AMP.setState({collapsed: !collapsed})" role="button" tabindex="0" [class]="!collapsed ? 'expanded' : ''">
                The crystal structure of PET46 resembles the crystal structure of the IsPETase and LCC - with unique features. Credit: <i>Communications Chemistry</i> (2023). DOI: 10.1038/s42004-023-00998-z
            </figcaption>
        </div>
    </amp-lightbox>
</div>
<p>Plastic pollution is increasingly affecting the health of coasts and oceans. One well-known problem is plastic bottles made from polyethylene terephthalate, or PET.</p>

		    <!-- Phys.org - News - AMP -->
		

		        
<p>A new study involving scientists from Professor Ruth Schmitz-Streit's research group at Kiel University has shown for the first time, using microorganisms from the deep sea, that polymers such as PET are continuously degraded by an enzyme. Researchers from the University of Hamburg and the Heinrich-Heine-University Düsseldorf played a major role in the microbiological study.
</p><p>The results fundamentally expand the knowledge of PET-degrading enzymes, the underlying mechanism and the evolutionary understanding of the diversity of putative PET-degrading enzymes throughout the global ocean. The research team <a href="https://www.nature.com/articles/s42004-023-00998-z">published the results in the journal <i>Communications Chemistry</i></a>, where they discuss both biotechnological applications and the high relevance for biogeochemical processes in the ocean and on land.
</p><p>The study highlights a special feature of the PET-degrading enzyme. "In our study, we have discovered a new genetic resource from deep-sea organisms belonging to the archaea," says Professor Ruth Schmitz-Streit, head of the Molecular Biology of Microorganisms working group at the Institute of General Microbiology (IfAM) and member of the research priority area Kiel Marine Science (KMS) at Kiel University. Until now, about 80 different PET-degrading enzymes were known, most of which were found in bacteria or fungi.
</p><p>"Our data contribute to a better understanding of the ecological role of deep-sea archaea and the possible degradation of PET waste in the sea," says the microbiologist.
</p><h2>The new enzyme: PET46</h2>
<p>Using a metagenomic approach, the research team has identified and biochemically described the PET-degrading enzyme PET46 from a non-cultured deep-sea microorganism for the first time. This involved identifying the gene from a <a href="https://phys.org/tags/deep+sea/" rel="tag">deep-sea</a> sample based on similarities to known sequences, synthesizing the corresponding coding gene, producing the protein in the bacterium Escherichia coli and then studying it biochemically and structurally.
</p><p>PET46 has many unusual properties and adds to the scaffold diversity of PET-active enzymes. Structurally, the enzyme differs significantly from those previously discovered. For example, it has the ability to degrade both very long-chain PET molecules, known as polymers, and short-chain PET molecules, known as oligomers, which means that degradation can be continuous.
</p><p>Among other things, PET46 uses a completely different mechanism for substrate binding than previously known PET-degrading enzymes. The researchers describe an unusual 'lid' of 45 amino acids above the enzyme's active center as crucial for binding. In other PET enzymes, aromatic <a href="https://phys.org/tags/amino+acids/" rel="tag">amino acids</a> close to the active site are typical.
</p><h2>Promising biotechnology applications</h2>
<p>At the <a href="https://phys.org/tags/molecular+level/" rel="tag">molecular level</a>, PET46 is very similar to another enzyme, ferulic acid esterase. This degrades the natural polymer lignin in <a href="https://phys.org/tags/plant+cell+walls/" rel="tag">plant cell walls</a> by breaking down lignin polymers to release sugars from woody plant parts. Lignin and PET have many structural similarities, so the PET-degrading enzymes found in nature may be important for composting wood in forest soils, for example.
</p><p>The biochemical properties of PET46 therefore make it a very interesting <a href="https://phys.org/tags/enzyme/" rel="tag">enzyme</a> both for marine and terrestrial plastics and for biotechnology. Compared to the best-characterized PET-degrading enzymes from bacteria and composting plants, PET46 is more efficient at 70° Celsius than these reference enzymes at their respective optimum temperatures.
</p><p>The research was carried out as part of the PLASTISEA project, coordinated by Professor Ute Hentschel Humeida of the GEOMAR Helmholtz Center for Ocean Research in Kiel. First author Dr. Jennifer Chow from the University of Hamburg and first author Dr. Pablo Pérez-Garcia, who works as a research assistant in Schmitz-Streit's group, contributed equally to the study.
		 

            <!-- Phys.org - News - AMP -->
		</p>
		
					<div>
				                    <p>
                        <strong>More information:</strong> 
                        Pablo Perez-Garcia et al, An archaeal lid-containing feruloyl esterase degrades polyethylene terephthalate, <i>Communications Chemistry</i> (2023).  <a data-doi="1" href="https://dx.doi.org/10.1038/s42004-023-00998-z" target="_blank">DOI: 10.1038/s42004-023-00998-z</a>
                    </p>
																
				                    <p>
                        <strong>Journal information:</strong> 
                        							<a href="https://phys.org/journals/communications-chemistry/">Communications Chemistry</a>
                                                                    <a href="https://www.nature.com/commschem/" target="_blank" rel="nofollow">
										<i></i>
									</a>
                                                                 
						                    </p>
							</div>
    											
				
                    <p>
                    Provided by
                            
                                            Christian-Albrechts-Universität zu Kiel
                     
                </p>
        

        
        
	</article></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Firefox 118 (360 pts)]]></title>
            <link>https://www.mozilla.org/en-US/firefox/118.0/releasenotes/</link>
            <guid>37658915</guid>
            <pubDate>Tue, 26 Sep 2023 13:22:46 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.mozilla.org/en-US/firefox/118.0/releasenotes/">https://www.mozilla.org/en-US/firefox/118.0/releasenotes/</a>, See on <a href="https://news.ycombinator.com/item?id=37658915">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
  <article id="main-content">

    
    <header>
      <div>
          
            <p>Version 118.0, first offered to Release channel users on September 26, 2023</p>
            
          
        </div></header>
  

    <section>
    
      
        
          <div>
              <ul>
        
        
  <li id="note-789750">
    <p>Automated translation of web content is now available to Firefox users! Unlike cloud-based alternatives, translation is done locally in Firefox, so that the text being translated does not leave your machine.</p>
    
  </li>

        
      
        
        
  <li id="note-789751">
    <p>Web Audio in Firefox now uses the FDLIBM math library on all systems to improve anonymity with <a href="https://support.mozilla.org/kb/firefox-protection-against-fingerprinting">Fingerprint Protection</a>.</p>
    
  </li>

        
      
        
        
  <li id="note-789752">
    <p>The visibility of fonts to websites has been restricted to system fonts and language pack fonts to mitigate font fingerprinting in Private Browsing windows.</p>
    
  </li>

        
      
        
        
  <li id="note-789753">
    <p>Video Effects and background blur are now available to Firefox users on Google Meet! (Note: These effects have also been released retroactively to support Firefox versions back to Firefox 115.)</p>
    
  </li>

        
      
        
        
  <li id="note-789762">
    <p>Firefox Suggest users (US-only at this time) will now be able to see browser add-on suggestions right in the address bar based on their keywords.</p>
    
  </li>

        
              </ul>
            </div>
        
      

      
        
          <div>
              <ul>
        
        
  <li id="note-789761">
    <p>Various <a href="https://www.mozilla.org/en-US/security/advisories/mfsa2023-41/">security</a> fixes.</p>
    
  </li>

        
              </ul>
            </div>
        
      

      

      
        
          <div>
              <ul>
        
        
  <li id="note-789754">
    <p>You can find information about policy updates and enterprise specific bug fixes in the <a href="https://support.mozilla.org/kb/firefox-enterprise-118-release-notes">Firefox for Enterprise 118 Release Notes</a>.</p>
    
  </li>

        
              </ul>
            </div>
        
      

      
      

      
        
        
          
        
      

      
        
          <div>
              <ul>
        
        
  <li id="note-789695">
    <p>10 new CSS math functions are now supported: round, mod, rem, pow, sqrt, hypot, log, exp, abs, sign.</p>
    
  </li>

        
      
        
        
  <li id="note-789744">
    <p><a href="https://github.com/annevk/orb">OpaqueResponseBlocking</a> is now enabled by default.</p>
    
  </li>

        
              </ul>
            </div>
        
      

      

      

      

      
        
          <div id="community">
            <ul>
        
        
  <li id="note-789755">
    <p>With the release of Firefox 118, we are pleased to welcome the developers who contributed their first code change to Firefox in this release, 8 of whom were brand new volunteers! Please join us in thanking each of these diligent and enthusiastic individuals, and take a look at their contributions:</p>
<ul>
<li>Andrew de Rozario: <a href="https://bugzilla.mozilla.org/1791983">1791983</a></li>
<li>jackyzy823: <a href="https://bugzilla.mozilla.org/1847513">1847513</a></li>
<li>Janne Heß: <a href="https://bugzilla.mozilla.org/1460986">1460986</a></li>
<li>Krishna Ravishankar: <a href="https://bugzilla.mozilla.org/1578994">1578994</a></li>
<li>Rayyan: <a href="https://bugzilla.mozilla.org/1844745">1844745</a></li>
<li>Shauryadubey123: <a href="https://bugzilla.mozilla.org/1819352">1819352</a></li>
<li>Simon Thoby: <a href="https://bugzilla.mozilla.org/1832576">1832576</a>, <a href="https://bugzilla.mozilla.org/1847763">1847763</a></li>
<li>wujiahuan: <a href="https://bugzilla.mozilla.org/1782159">1782159</a></li>
</ul>
    
  </li>

        
            </ul>
          </div>
        
      
    
    </section>

    <div>
      <p>
        <h2>Get the most recent version</h2>
        
      </p>
    </div>

    
    <section>
      <a href="https://www.mozilla.org/en-US/firefox/all/#product-desktop-release">All Firefox downloads</a>
    </section>
    

    
    
    
</article>
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Google is picking ChatGPT responses from Quora as correct answer (364 pts)]]></title>
            <link>https://twitter.com/8teapi/status/1706520893621784780</link>
            <guid>37658319</guid>
            <pubDate>Tue, 26 Sep 2023 12:31:06 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://twitter.com/8teapi/status/1706520893621784780">https://twitter.com/8teapi/status/1706520893621784780</a>, See on <a href="https://news.ycombinator.com/item?id=37658319">Hacker News</a></p>
Couldn't get https://twitter.com/8teapi/status/1706520893621784780: Error [ERR_FR_TOO_MANY_REDIRECTS]: Maximum number of redirects exceeded]]></description>
        </item>
        <item>
            <title><![CDATA[Yandex open sourced it's BI tool DataLens (171 pts)]]></title>
            <link>https://github.com/datalens-tech</link>
            <guid>37657772</guid>
            <pubDate>Tue, 26 Sep 2023 11:36:21 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/datalens-tech">https://github.com/datalens-tech</a>, See on <a href="https://news.ycombinator.com/item?id=37657772">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-turbo-body="">
      


    <div>
      <p><a href="#start-of-content">Skip to content</a>
      <span data-view-component="true">
    <span data-view-component="true"></span>
</span></p><header role="banner" data-color-mode="light" data-light-theme="light" data-dark-theme="dark">
  

  <div>
          <nav aria-label="Global">
            <ul>
                <li>
      
      <div>
            <ul>
                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Product&quot;,&quot;action&quot;:&quot;click to go to Actions&quot;,&quot;label&quot;:&quot;ref_cta:Actions;&quot;}" href="https://github.com/features/actions">
      
      <div>
        <p>Actions</p><p>
        Automate any workflow
      </p></div>

    
</a></li>

                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Product&quot;,&quot;action&quot;:&quot;click to go to Packages&quot;,&quot;label&quot;:&quot;ref_cta:Packages;&quot;}" href="https://github.com/features/packages">
      
      <div>
        <p>Packages</p><p>
        Host and manage packages
      </p></div>

    
</a></li>

                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Product&quot;,&quot;action&quot;:&quot;click to go to Security&quot;,&quot;label&quot;:&quot;ref_cta:Security;&quot;}" href="https://github.com/features/security">
      
      <div>
        <p>Security</p><p>
        Find and fix vulnerabilities
      </p></div>

    
</a></li>

                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Product&quot;,&quot;action&quot;:&quot;click to go to Codespaces&quot;,&quot;label&quot;:&quot;ref_cta:Codespaces;&quot;}" href="https://github.com/features/codespaces">
      
      <div>
        <p>Codespaces</p><p>
        Instant dev environments
      </p></div>

    
</a></li>

                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Product&quot;,&quot;action&quot;:&quot;click to go to Copilot&quot;,&quot;label&quot;:&quot;ref_cta:Copilot;&quot;}" href="https://github.com/features/copilot">
      
      <div>
        <p>Copilot</p><p>
        Write better code with AI
      </p></div>

    
</a></li>

                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Product&quot;,&quot;action&quot;:&quot;click to go to Code review&quot;,&quot;label&quot;:&quot;ref_cta:Code review;&quot;}" href="https://github.com/features/code-review">
      
      <div>
        <p>Code review</p><p>
        Manage code changes
      </p></div>

    
</a></li>

                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Product&quot;,&quot;action&quot;:&quot;click to go to Issues&quot;,&quot;label&quot;:&quot;ref_cta:Issues;&quot;}" href="https://github.com/features/issues">
      
      <div>
        <p>Issues</p><p>
        Plan and track work
      </p></div>

    
</a></li>

                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Product&quot;,&quot;action&quot;:&quot;click to go to Discussions&quot;,&quot;label&quot;:&quot;ref_cta:Discussions;&quot;}" href="https://github.com/features/discussions">
      
      <div>
        <p>Discussions</p><p>
        Collaborate outside of code
      </p></div>

    
</a></li>

            </ul>
          </div>
</li>


                <li>
      
      
</li>


                <li>
      
      <div>
          <div>
            <ul>
                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Open Source&quot;,&quot;action&quot;:&quot;click to go to GitHub Sponsors&quot;,&quot;label&quot;:&quot;ref_cta:GitHub Sponsors;&quot;}" href="https://github.com/sponsors">
      
      <div>
        <p>GitHub Sponsors</p><p>
        Fund open source developers
      </p></div>

    
</a></li>

            </ul>
          </div>
          <div>
            <ul>
                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Open Source&quot;,&quot;action&quot;:&quot;click to go to The ReadME Project&quot;,&quot;label&quot;:&quot;ref_cta:The ReadME Project;&quot;}" href="https://github.com/readme">
      
      <div>
        <p>The ReadME Project</p><p>
        GitHub community articles
      </p></div>

    
</a></li>

            </ul>
          </div>
          
      </div>
</li>


                <li>
    <a data-analytics-event="{&quot;category&quot;:&quot;Header menu top item (logged out)&quot;,&quot;action&quot;:&quot;click to go to Pricing&quot;,&quot;label&quot;:&quot;ref_cta:Pricing;&quot;}" href="https://github.com/pricing">Pricing</a>
</li>

            </ul>
          </nav>

        
      </div>
</header>

      
    </div>

  








    


    
    <include-fragment data-base-src="https://github.com/notifications/beta/shelf"></include-fragment>






  <div data-commit-hovercards-enabled="" data-discussion-hovercards-enabled="" data-issue-and-pr-hovercards-enabled="">
      <main>
        











<div itemscope="" itemtype="http://schema.org/Organization">
  


<header>
  <div>
        <p><img itemprop="image" src="https://avatars.githubusercontent.com/u/134070780?s=200&amp;v=4" width="100" height="100" alt="@datalens-tech">
        </p>
      

      

    </div>

  <div>
  <nav data-url="/users/datalens-tech/tab_counts" aria-label="Organization">
    <div>
      <ul>
          <li data-tab-item="org-header-overview-tab">
  <a href="https://github.com/datalens-tech">
    
    Overview
  </a>
</li>

          <li data-tab-item="org-header-repositories-tab">
  <a href="https://github.com/orgs/datalens-tech/repositories">
    
    Repositories
      <span title="Not available" data-view-component="true"></span>
  </a>
</li>

          
          <li data-tab-item="org-header-projects-tab">
  <a href="https://github.com/orgs/datalens-tech/projects" data-hotkey="g b">
    
    Projects
      <span title="Not available" data-view-component="true"></span>
  </a>
</li>

          <li data-tab-item="org-header-packages-tab">
  <a href="https://github.com/orgs/datalens-tech/packages">
    
    Packages
  </a>
</li>

          
          <li data-tab-item="org-header-people-tab">
  <a href="https://github.com/orgs/datalens-tech/people">
    
    People
      <span title="Not available" data-view-component="true"></span>
  </a>
</li>

          
          
          
          
      </ul>

      
    </div>
  </nav>
</div>


    
</header>


  <div data-view-component="true">

  <div data-hpc="" data-view-component="true">
  

  

  

     

    <div>

  <h2>
        Pinned

    <svg style="box-sizing: content-box; color: var(--color-icon-primary);" width="16" height="16" viewBox="0 0 16 16" fill="none" data-view-component="true">
  <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-opacity="0.25" stroke-width="2" vector-effect="non-scaling-stroke" fill="none"></circle>
  <path d="M15 8a7.002 7.002 0 00-7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" vector-effect="non-scaling-stroke"></path>
</svg>
    <span role="status" aria-live="polite" data-error-text="Something went wrong." data-success-text="Order updated."></span>
  </h2>

      <ol>
      <li>
  <div>
      


      <p>
        A modern, scalable analytics system
      </p>

      <p>
          <a href="https://github.com/datalens-tech/datalens/stargazers">
            <svg aria-label="stars" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25Zm0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41L8 2.694Z"></path>
</svg>
            244
          </a>
          <a href="https://github.com/datalens-tech/datalens/forks">
            <svg aria-label="forks" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0ZM5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Zm6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Z"></path>
</svg>
            4
          </a>
      </p>
    </div>
</li>

      <li>
  <div>
      


      <p>
        User interface for DataLens
      </p>

      <p>
          <span>
  <span></span>
  <span itemprop="programmingLanguage">TypeScript</span>
</span>

          <a href="https://github.com/datalens-tech/datalens-ui/stargazers">
            <svg aria-label="stars" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25Zm0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41L8 2.694Z"></path>
</svg>
            43
          </a>
          <a href="https://github.com/datalens-tech/datalens-ui/forks">
            <svg aria-label="forks" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0ZM5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Zm6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Z"></path>
</svg>
            2
          </a>
      </p>
    </div>
</li>

      <li>
  <div>
      


      <p>
        Data processing backend for DataLens
      </p>

      <p>
          <span>
  <span></span>
  <span itemprop="programmingLanguage">Python</span>
</span>

          <a href="https://github.com/datalens-tech/datalens-backend/stargazers">
            <svg aria-label="stars" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25Zm0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41L8 2.694Z"></path>
</svg>
            40
          </a>
          <a href="https://github.com/datalens-tech/datalens-backend/forks">
            <svg aria-label="forks" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0ZM5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Zm6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Z"></path>
</svg>
            2
          </a>
      </p>
    </div>
</li>

      <li>
  <div>
      


      <p>
        Configuration object storage for DataLens
      </p>

      <p>
          <span>
  <span></span>
  <span itemprop="programmingLanguage">TypeScript</span>
</span>

          <a href="https://github.com/datalens-tech/datalens-us/stargazers">
            <svg aria-label="stars" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25Zm0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41L8 2.694Z"></path>
</svg>
            18
          </a>
          <a href="https://github.com/datalens-tech/datalens-us/forks">
            <svg aria-label="fork" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0ZM5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Zm6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Z"></path>
</svg>
            1
          </a>
      </p>
    </div>
</li>

</ol>

</div>


    <div id="org-profile-repositories">
      <h3>
        
        Repositories
      </h3>
      <div>
          <!-- '"` --><!-- </textarea></xmp> --><form data-autosearch-results-container="org-repositories" role="search" data-turbo="false" action="/datalens-tech" accept-charset="UTF-8" method="get">
            <div>
                <details id="type-options">
                    <summary aria-haspopup="true" data-view-component="true">    <span>Type</span>
                    <span></span>
</summary>                  <details-menu>
                    <div>
                      <header>
                        <span>Select type</span>
                        
                      </header>
                      <p><label role="menuitemradio" aria-checked="true" tabindex="0">
                            
                            
                            <span data-menu-button-text="">All</span>
                          </label>
                          <label role="menuitemradio" aria-checked="false" tabindex="0">
                            
                            
                            <span data-menu-button-text="">Public</span>
                          </label>
                          <label role="menuitemradio" aria-checked="false" tabindex="0">
                            
                            
                            <span data-menu-button-text="">Sources</span>
                          </label>
                          <label role="menuitemradio" aria-checked="false" tabindex="0">
                            
                            
                            <span data-menu-button-text="">Forks</span>
                          </label>
                          <label role="menuitemradio" aria-checked="false" tabindex="0">
                            
                            
                            <span data-menu-button-text="">Archived</span>
                          </label>
                          <label role="menuitemradio" aria-checked="false" tabindex="0">
                            
                            
                            <span data-menu-button-text="">Mirrors</span>
                          </label>
                          <label role="menuitemradio" aria-checked="false" tabindex="0">
                            
                            
                            <span data-menu-button-text="">Templates</span>
                          </label>
                      </p>
                    </div>
                  </details-menu>
                </details>

                  <details id="language-options">
                      <summary aria-haspopup="true" data-view-component="true">    <span>Language</span>
                      <span></span>
</summary>                    <details-menu>
                      <div>
                        <header>
                          <span>Select language</span>
                          
                        </header>
                        <p><label role="menuitemradio" aria-checked="true" tabindex="0">
                            
                            
                            <span data-menu-button-text="">All</span>
                          </label>
                            <label role="menuitemradio" aria-checked="false" tabindex="0">
                              
                              
                              <span data-menu-button-text="">Python</span>
                            </label>
                            <label role="menuitemradio" aria-checked="false" tabindex="0">
                              
                              
                              <span data-menu-button-text="">TypeScript</span>
                            </label>
                        </p>
                      </div>
                    </details-menu>
                  </details>

                <details id="sort-options">
                    <summary aria-haspopup="true" data-view-component="true">    <span>Sort</span>
                    <span></span>
</summary>                  <details-menu>
                    <div>
                      <header>
                        <span>Select order</span>
                        
                      </header>
                      <p><label role="menuitemradio" aria-checked="true" tabindex="0">
                          
                          
                          <span data-menu-button-text="">Last updated</span>
                        </label>
                        <label role="menuitemradio" aria-checked="false" tabindex="0">
                          
                          
                          <span data-menu-button-text="">Name</span>
                        </label>
                        <label role="menuitemradio" aria-checked="false" tabindex="0">
                          
                          
                          <span data-menu-button-text="">Stars</span>
                        </label>
                      </p>
                    </div>
                  </details-menu>
                </details>
                
              </div>
</form>
        </div>
      <div id="org-repositories" data-delay-results="">
    <p><span data-autosearch-results="">Showing 7 of 7 repositories</span></p><div data-view-component="true">
  
  
    <ul data-view-component="true">
        <li data-view-component="true">          <div data-view-component="true" itemprop="owns" itemtype="http://schema.org/Code" itemscope="itemscope">

        <p><span>
  <span></span>
  <span itemprop="programmingLanguage">TypeScript</span>
</span></p><a href="https://github.com/datalens-tech/datalens-ui/stargazers" data-view-component="true">
          
          43
</a>
        <p><span data-view-component="true">
          Apache-2.0
</span></p><a href="https://github.com/datalens-tech/datalens-ui/forks" data-view-component="true">
          <svg aria-label="fork" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0ZM5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Zm6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Z"></path>
</svg>
          2
</a>
      <a href="https://github.com/datalens-tech/datalens-ui/issues" data-view-component="true">
        
        1
</a>

      <a href="https://github.com/datalens-tech/datalens-ui/pulls" data-view-component="true">
        
        1
</a>
      <p><span data-view-component="true">
          Updated <relative-time datetime="2023-09-26T15:59:53Z">Sep 26, 2023</relative-time>
</span></p></div>
</li>
        <li data-view-component="true">          <div itemprop="owns" itemtype="http://schema.org/Code" itemscope="itemscope" data-view-component="true">
  
    <div data-view-component="true">
        <p><a itemprop="name codeRepository" data-hovercard-type="repository" data-hovercard-url="/datalens-tech/datalens-us/hovercard" href="https://github.com/datalens-tech/datalens-us" data-view-component="true">
          datalens-us
</a>
        <span title="Label: Public" data-view-component="true">
          Public
</span></p><p itemprop="description" data-view-component="true">
            Configuration object storage for DataLens
</p></div>
    <div data-view-component="true">

        <p><span>
  <span></span>
  <span itemprop="programmingLanguage">TypeScript</span>
</span></p><a href="https://github.com/datalens-tech/datalens-us/stargazers" data-view-component="true">
          
          18
</a>
        <p><span data-view-component="true">
          Apache-2.0
</span></p><a href="https://github.com/datalens-tech/datalens-us/forks" data-view-component="true">
          <svg aria-label="fork" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0ZM5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Zm6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Z"></path>
</svg>
          1
</a>
      <a href="https://github.com/datalens-tech/datalens-us/issues" data-view-component="true">
        
        0
</a>

      <a href="https://github.com/datalens-tech/datalens-us/pulls" data-view-component="true">
        
        2
</a>
      <p><span data-view-component="true">
          Updated <relative-time datetime="2023-09-26T08:06:22Z">Sep 26, 2023</relative-time>
</span></p></div></div>
</li>
        <li data-view-component="true">          <div itemprop="owns" itemtype="http://schema.org/Code" itemscope="itemscope" data-view-component="true">
  
    <div data-view-component="true">
        <p><a itemprop="name codeRepository" data-hovercard-type="repository" data-hovercard-url="/datalens-tech/datalens/hovercard" href="https://github.com/datalens-tech/datalens" data-view-component="true">
          datalens
</a>
        <span title="Label: Public" data-view-component="true">
          Public
</span></p><p itemprop="description" data-view-component="true">
            A modern, scalable analytics system
</p></div>
    <div data-view-component="true">


        <a href="https://github.com/datalens-tech/datalens/stargazers" data-view-component="true">
          
          244
</a>
        <p><span data-view-component="true">
          Apache-2.0
</span></p><a href="https://github.com/datalens-tech/datalens/forks" data-view-component="true">
          <svg aria-label="fork" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0ZM5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Zm6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Z"></path>
</svg>
          4
</a>
      <a href="https://github.com/datalens-tech/datalens/issues" data-view-component="true">
        
        9
</a>

      <a href="https://github.com/datalens-tech/datalens/pulls" data-view-component="true">
        
        0
</a>
      <p><span data-view-component="true">
          Updated <relative-time datetime="2023-09-25T14:07:07Z">Sep 25, 2023</relative-time>
</span></p></div></div>
</li>
        <li data-view-component="true">          <div data-view-component="true" itemprop="owns" itemtype="http://schema.org/Code" itemscope="itemscope">

        <p><span>
  <span></span>
  <span itemprop="programmingLanguage">Python</span>
</span></p><a href="https://github.com/datalens-tech/datalens-backend/stargazers" data-view-component="true">
          
          40
</a>
        <p><span data-view-component="true">
          Apache-2.0
</span></p><a href="https://github.com/datalens-tech/datalens-backend/forks" data-view-component="true">
          <svg aria-label="fork" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0ZM5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Zm6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Z"></path>
</svg>
          2
</a>
      <a href="https://github.com/datalens-tech/datalens-backend/issues" data-view-component="true">
        
        0
</a>

      <a href="https://github.com/datalens-tech/datalens-backend/pulls" data-view-component="true">
        
        0
</a>
      <p><span data-view-component="true">
          Updated <relative-time datetime="2023-09-25T13:51:04Z">Sep 25, 2023</relative-time>
</span></p></div>
</li>
        <li data-view-component="true">          <div data-view-component="true" itemprop="owns" itemtype="http://schema.org/Code" itemscope="itemscope">

        <p><span>
  <span></span>
  <span itemprop="programmingLanguage">Python</span>
</span>


        <span data-view-component="true">
          0
</span>
        <span data-view-component="true">
          Apache-2.0
</span></p><a href="https://github.com/datalens-tech/publish-unit-test-result-action/forks" data-view-component="true">
          <svg aria-label="fork" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0ZM5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Zm6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Z"></path>
</svg>
          156
</a>
      <a href="https://github.com/datalens-tech/publish-unit-test-result-action/issues" data-view-component="true">
        
        0
</a>

      <a href="https://github.com/datalens-tech/publish-unit-test-result-action/pulls" data-view-component="true">
        
        0
</a>
      <p><span data-view-component="true">
          Updated <relative-time datetime="2023-08-11T12:45:36Z">Aug 11, 2023</relative-time>
</span></p></div>
</li>
        <li data-view-component="true">          <div data-view-component="true" itemprop="owns" itemtype="http://schema.org/Code" itemscope="itemscope">


        <p><span data-view-component="true">
          0
</span>
        <span data-view-component="true">
          MIT
</span></p><a href="https://github.com/datalens-tech/ansible-github_actions_runner/forks" data-view-component="true">
          <svg aria-label="fork" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0ZM5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Zm6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Z"></path>
</svg>
          53
</a>
      <a href="https://github.com/datalens-tech/ansible-github_actions_runner/issues" data-view-component="true">
        
        0
</a>

      <a href="https://github.com/datalens-tech/ansible-github_actions_runner/pulls" data-view-component="true">
        
        0
</a>
      <p><span data-view-component="true">
          Updated <relative-time datetime="2023-08-09T12:22:47Z">Aug 9, 2023</relative-time>
</span></p></div>
</li>
        <li data-view-component="true">          <div itemprop="owns" itemtype="http://schema.org/Code" itemscope="itemscope" data-view-component="true">
  
    <div data-view-component="true">
        <p><a itemprop="name codeRepository" data-hovercard-type="repository" data-hovercard-url="/datalens-tech/action-local-cache/hovercard" href="https://github.com/datalens-tech/action-local-cache" data-view-component="true">
          action-local-cache
</a>
        <span title="Label: Public" data-view-component="true">
          Public
</span></p><p itemprop="description" data-view-component="true">
            A Github Action to save and restore files across job runs directly in the runner's file system
</p></div>
    <div data-view-component="true">

        <p><span>
  <span></span>
  <span itemprop="programmingLanguage">TypeScript</span>
</span>


        <span data-view-component="true">
          0
</span>
        <span data-view-component="true">
          MIT
</span></p><a href="https://github.com/datalens-tech/action-local-cache/forks" data-view-component="true">
          <svg aria-label="fork" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0ZM5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Zm6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Z"></path>
</svg>
          41
</a>
      <a href="https://github.com/datalens-tech/action-local-cache/issues" data-view-component="true">
        
        0
</a>

      <a href="https://github.com/datalens-tech/action-local-cache/pulls" data-view-component="true">
        
        0
</a>
      <p><span data-view-component="true">
          Updated <relative-time datetime="2023-05-18T08:29:51Z">May 18, 2023</relative-time>
</span></p></div></div>
</li>
</ul>  
</div></div>
  </div>
</div>

    <div data-view-component="true">
            





<div id="org-members">
    <a href="https://github.com/orgs/datalens-tech/people" data-ga-click="Orgs, go to people, location:profile people module; text:People">
      <h4>People</h4>
    </a>
    <p>
      This organization has no public members. You must be a member to see who’s a part of this organization.
    </p>
  </div>

  


    

<include-fragment src="/orgs/datalens-tech/topics/most_used?context=overview" accept="text/fragment+html">
  <div>
      <h4>Most used topics</h4>
      <p>Loading…</p>
    </div>
</include-fragment>


        </div>
</div>
</div>

      </main>
  </div>

          




  

    <template id="site-details-dialog">
  <details class="details-reset details-overlay details-overlay-dark lh-default color-fg-default hx_rsm" open="">
    <summary role="button" aria-label="Close dialog"></summary>
    <details-dialog class="Box Box--overlay d-flex flex-column anim-fade-in fast hx_rsm-dialog hx_rsm-modal">
      <button class="Box-btn-octicon m-0 btn-octicon position-absolute right-0 top-0" type="button" aria-label="Close dialog" data-close-dialog="">
        <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-x">
    <path d="M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l3.22 3.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-3.22 3.22a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z"></path>
</svg>
      </button>
      <div class="octocat-spinner my-6 js-details-dialog-spinner"></div>
    </details-dialog>
  </details>
</template>

    

    <template id="snippet-clipboard-copy-button">
  <div class="zeroclipboard-container position-absolute right-0 top-0">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn js-clipboard-copy m-2 p-0 tooltipped-no-delay" data-copy-feedback="Copied!" data-tooltip-direction="w">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon m-2">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none m-2">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>
    </clipboard-copy>
  </div>
</template>
<template id="snippet-clipboard-copy-button-unpositioned">
  <div class="zeroclipboard-container">
    <clipboard-copy aria-label="Copy" class="ClipboardButton btn btn-invisible js-clipboard-copy m-2 p-0 tooltipped-no-delay d-flex flex-justify-center flex-items-center" data-copy-feedback="Copied!" data-tooltip-direction="w">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon">
    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
</svg>
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none">
    <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
</svg>
    </clipboard-copy>
  </div>
</template>




    </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Google assigns a CVE for libwebp and gives it a 10.0 score (230 pts)]]></title>
            <link>https://stackdiary.com/heap-buffer-overflow-in-libwebp-cve-2023-5129/</link>
            <guid>37657746</guid>
            <pubDate>Tue, 26 Sep 2023 11:33:31 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://stackdiary.com/heap-buffer-overflow-in-libwebp-cve-2023-5129/">https://stackdiary.com/heap-buffer-overflow-in-libwebp-cve-2023-5129/</a>, See on <a href="https://news.ycombinator.com/item?id=37657746">Hacker News</a></p>
<div id="readability-page-1" class="page"><div itemprop="text">
							
<p>In case you missed the news, there's a critical 0day in WebP (a heap buffer overflow in the <a href="https://github.com/webmproject/libwebp" target="_blank" rel="noreferrer noopener">libwepb</a> library) floating about, which was initially issued as <a href="https://stackdiary.com/critical-vulnerability-in-webp-codec-cve-2023-4863/" target="_blank" rel="noreferrer noopener">CVE-2023-4863</a> and assigned <a href="https://chromereleases.googleblog.com/2023/09/stable-channel-update-for-desktop_11.html" target="_blank" rel="noreferrer noopener">specifically to Google Chrome</a>. At the time this happened, I wrote my blog post about it and vehemently tried to make it clear that it wasn't just Chrome that was affected, but any software that uses libwebp to render WebP images.</p>



<p><em>That story exploded. 🤯</em></p>



<p>I've just taken note that Google has issued a separate CVE, which is tracked under <a href="https://www.cve.org/CVERecord?id=CVE-2023-5129" target="_blank" rel="noreferrer noopener nofollow">CVE-2023-5129</a>,</p>



<p>With a specially crafted WebP lossless file, libwebp may write data out of bounds to the heap. The ReadHuffmanCodes() function allocates the HuffmanCode buffer with a size that comes from an array of precomputed sizes: kTableSize. The color_cache_bits value defines which size to use. The kTableSize array only takes into account sizes for 8-bit first-level table lookups but not second-level table lookups. libwebp allows codes that are up to 15-bit (MAX_ALLOWED_CODE_LENGTH). When BuildHuffmanTable() attempts to fill the second-level tables it may write data out-of-bounds. The OOB write to the undersized array happens in ReplicateValue.</p>



<p><em><strong>Important:</strong> If you're a news person or someone who isn't sure - this is not a new bug in libwebp; it's the same bug as previously, but now it has been correctly marked as a bug inside the WebP Codec and not just a "bug inside Google Chrome".</em></p>



<p>And Google is not beating around the bush either; they've straight up given it a 10.0 base score.</p>



<figure><img decoding="async" width="998" height="393" src="https://stackdiary.com/wp-content/uploads/2023/09/CVE-2023-5129-severity.png" alt="CVE-2023-5129 severity" srcset="https://stackdiary.com/wp-content/uploads/2023/09/CVE-2023-5129-severity.png 998w, https://stackdiary.com/wp-content/uploads/2023/09/CVE-2023-5129-severity-300x118.png 300w, https://stackdiary.com/wp-content/uploads/2023/09/CVE-2023-5129-severity-768x302.png 768w" sizes="(max-width: 998px) 100vw, 998px" data-old-src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20998%20393'%3E%3C/svg%3E" data-lazy-srcset="https://stackdiary.com/wp-content/uploads/2023/09/CVE-2023-5129-severity.png 998w, https://stackdiary.com/wp-content/uploads/2023/09/CVE-2023-5129-severity-300x118.png 300w, https://stackdiary.com/wp-content/uploads/2023/09/CVE-2023-5129-severity-768x302.png 768w" data-lazy-src="https://stackdiary.com/wp-content/uploads/2023/09/CVE-2023-5129-severity.png"><figcaption><em>The Impact score is 6.0, and the Exploitability score is 3.9.</em></figcaption></figure>



<p>And it's what they should have done in the first place.</p>



<h2>Who is and isn't affected?</h2>



<p>The versions affected by this bug are <strong>from 0.5.0 before 1.3.2</strong>. The type of software affected is pretty much any software that directly uses the WebP Codec to render images. Just in the last two weeks alone, outside of web browsers (most of which should be patched now) - I have seen Red Hat to Debian to software like Puppeteer and the .NET library for ImageMagick patching it. Honestly, I have no idea of the full scope of this, and it's not that easy to track who is or isn't actively patching it.</p>



<p>Ben Hawkes (former Project Zero manager) also <a href="https://blog.isosceles.com/the-webp-0day/" target="_blank" rel="noreferrer noopener">wrote about this 0day</a>, and he had this to say about it:</p>



<p>The bad news is that Android is still likely affected. Similar to Apple's ImageIO, Android has a facility called the&nbsp;<a href="https://developer.android.com/reference/android/graphics/BitmapFactory?ref=blog.isosceles.com">BitmapFactory</a>&nbsp;that handles image decoding, and of course libwebp is supported. As of today, Android hasn't released a security bulletin that includes a fix for CVE-2023-4863 -- although the fix has been merged into AOSP. To put this in context: if this bug does affect Android, then it could potentially be turned into a remote exploit for apps like Signal and WhatsApp. I'd expect it to be fixed in the October bulletin.</p>



<p>Ben's article also has a Proof of Concept example and other interesting notes; make sure to check it out.</p>



<p>But the real question is, why didn't Google tag it specifically for libwebp in the first place? I mean, it clearly was much broader than just Chrome (and many news editorials failed to pick this up initially), and now they've gone ahead and assigned a separate CVE. </p>



<p>And it makes me wonder if the best thing wouldn't be to merge both CVEs to avoid any further confusion.</p>
							</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[DuckDB 0.9.0 (145 pts)]]></title>
            <link>https://duckdb.org/2023/09/26/announcing-duckdb-090.html</link>
            <guid>37657736</guid>
            <pubDate>Tue, 26 Sep 2023 11:32:24 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://duckdb.org/2023/09/26/announcing-duckdb-090.html">https://duckdb.org/2023/09/26/announcing-duckdb-090.html</a>, See on <a href="https://news.ycombinator.com/item?id=37657736">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
							<p><span>2023-09-26</span><span>Mark Raasveldt and Hannes Mühleisen</span></p>
							
							<p><img src="https://duckdb.org/images/blog/yellow-billed-duck.jpg" alt="Image of the Yellow Billed Duck" width="200px"></p>

<p>The DuckDB team is happy to announce the latest DuckDB release (0.9.0). This release is named Undulata after the <a href="https://en.wikipedia.org/wiki/Yellow-billed_duck">Yellow-billed duck</a> native to Africa.</p>

<p>To install the new version, please visit the <a href="https://duckdb.org/docs/installation/index">installation guide</a>. The full release notes can be found <a href="https://github.com/duckdb/duckdb/releases/tag/v0.9.0">here</a>.</p>

<!--more-->
      <h4 id="whats-new-in-090">
        
        <a href="#whats-new-in-090">What’s new in 0.9.0</a>
        
      </h4>
    

<p>There have been too many changes to discuss them each in detail, but we would like to highlight several particularly exciting features!</p>

<ul>
  <li>Out-Of-Core Hash Aggregate</li>
  <li>Storage Improvements</li>
  <li>Index Improvements</li>
  <li>DuckDB-WASM Extensions</li>
  <li>Extension Auto-Loading</li>
  <li>Improved AWS Support</li>
  <li>Iceberg Support</li>
  <li>Azure Support</li>
  <li>PySpark-Compatible API</li>
</ul>

<p>Below is a summary of those new features with examples, starting with a change in our SQL dialect that is designed to produce more intuitive results by default.</p>
      <h4 id="breaking-sql-changes">
        
        <a href="#breaking-sql-changes">Breaking SQL Changes</a>
        
      </h4>
    

<p><a href="https://github.com/duckdb/duckdb/pull/8942"><strong>Struct Auto-Casting</strong></a>. Previously the names of struct entries were ignored when determining auto-casting rules. As a result, struct field names could be silently renamed. Starting with this release, this will result in an error instead.</p>

<div><pre><code><span>CREATE</span> <span>TABLE</span> <span>structs</span><span>(</span><span>s</span> <span>STRUCT</span><span>(</span><span>i</span> <span>INT</span><span>));</span>
<span>INSERT</span> <span>INTO</span> <span>structs</span> <span>VALUES</span> <span>({</span><span>'k'</span><span>:</span> <span>42</span><span>});</span>
<span>-- Mismatch Type Error: Type STRUCT(k INTEGER) does not match with STRUCT(i INTEGER). Cannot cast STRUCTs with different names</span>
</code></pre></div>

<p>Unnamed structs constructed using the <code>ROW</code> function can still be inserted into struct fields.</p>

<div><pre><code><span>INSERT</span> <span>INTO</span> <span>structs</span> <span>VALUES</span> <span>(</span><span>ROW</span><span>(</span><span>42</span><span>));</span>
</code></pre></div>
      <h4 id="core-system-improvements">
        
        <a href="#core-system-improvements">Core System Improvements</a>
        
      </h4>
    

<p><strong><a href="https://github.com/duckdb/duckdb/pull/7931">Out-Of-Core Hash Aggregates</a></strong> and <strong><a href="https://github.com/duckdb/duckdb/pull/8475">Hash Aggregate Performance Improvements.</a></strong> When working with large data sets, memory management is always a potential pain point. By using a streaming execution engine and buffer manager, DuckDB supports many operations on larger than memory data sets. DuckDB also aims to support queries where <em>intermediate</em> results do not fit into memory by using disk-spilling techniques.</p>

<p>In this release, support for disk-spilling techniques is further extended through the support for out-of-core hash aggregates. Now, hash tables constructed during <code>GROUP BY</code> queries or <code>DISTINCT</code> operations that do not fit in memory due to a large number of unique groups will spill data to disk instead of throwing an out-of-memory exception. Due to the clever use of radix partitioning, performance degradation is gradual, and performance cliffs are avoided. Only the subset of the table that does not fit into memory will be spilled to disk.</p>

<p>The performance of our hash aggregate has also improved in general, especially when there are many groups. For example, we compute the number of unique rows in a data set with 30 million rows and 15 columns by using the following query:</p>

<div><pre><code><span>SELECT</span> <span>COUNT</span><span>(</span><span>*</span><span>)</span> <span>FROM</span> <span>(</span><span>SELECT</span> <span>DISTINCT</span> <span>*</span> <span>FROM</span> <span>tbl</span><span>);</span>
</code></pre></div>
<p>If we keep all the data in memory, the query should use around 6GB. However, we can still complete the query if less memory is available. In the table below, we can see how the runtime is affected by lowering the memory limit:</p>

<table>
  <thead>
    <tr>
      <th>memory limit</th>
      <th>v0.8.1</th>
      <th>v0.9.0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>10.0GB</td>
      <td>8.52s</td>
      <td>2.91s</td>
    </tr>
    <tr>
      <td>9.0GB</td>
      <td>8.52s</td>
      <td>3.45s</td>
    </tr>
    <tr>
      <td>8.0GB</td>
      <td>8.52s</td>
      <td>3.45s</td>
    </tr>
    <tr>
      <td>7.0GB</td>
      <td>8.52s</td>
      <td>3.47s</td>
    </tr>
    <tr>
      <td>6.0GB</td>
      <td>OOM</td>
      <td>3.41s</td>
    </tr>
    <tr>
      <td>5.0GB</td>
      <td>OOM</td>
      <td>3.67s</td>
    </tr>
    <tr>
      <td>4.0GB</td>
      <td>OOM</td>
      <td>3.87s</td>
    </tr>
    <tr>
      <td>3.0GB</td>
      <td>OOM</td>
      <td>4.20s</td>
    </tr>
    <tr>
      <td>2.0GB</td>
      <td>OOM</td>
      <td>4.39s</td>
    </tr>
    <tr>
      <td>1.0GB</td>
      <td>OOM</td>
      <td>4.91s</td>
    </tr>
  </tbody>
</table>

<p><strong><a href="https://github.com/duckdb/duckdb/pull/7644">Compressed Materialization.</a></strong> DuckDB’s streaming execution engine has a low memory footprint, but more memory is required for operations such as grouped aggregation. The memory footprint of these operations can be reduced by compression. DuckDB already uses <a href="https://duckdb.org/2022/10/28/lightweight-compression.html">many compression techniques in its storage format</a>, but many of these techniques are too costly to use during query execution. However, certain lightweight compression techniques are so cheap that the benefit of the reducing memory footprint outweight the cost of (de)compression.</p>

<p>In this release, we add support for compression of strings and integer types right before data goes into the grouped aggregation and sorting operators. By using statistics, both types are compressed to the smallest possible integer type. For example, if we have the following table:</p>

<div><pre><code>┌───────┬─────────┐
│  id   │  name   │
│ int32 │ varchar │
├───────┼─────────┤
│   300 │ alice   │
│   301 │ bob     │
│   302 │ eve     │
│   303 │ mallory │
│   304 │ trent   │
└───────┴─────────┘
</code></pre></div>

<p>The <code>id</code> column uses a 32-bit integer. From our statistics we know that the minimum value is 300, and the maximum value is 304. We can subtract 300 and cast to an 8-bit integer instead, reducing the width from 4 bytes down to 1.</p>

<p>The <code>name</code> column uses our internal string type, which is 16 bytes wide. However, our statistics tell us that the longest string here is only 7 bytes. We can fit this into a 64-bit integer like so:</p>
<div><pre><code>alice   -&gt; alice005
bob     -&gt; bob00003
eve     -&gt; eve00003
mallory -&gt; mallory7
trent   -&gt; trent005
</code></pre></div>

<p>This reduces the width from 16 bytes down to 8. To support sorting of compressed strings, we flip the bytes on big-endian machines so that our comparison operators are still correct:</p>
<div><pre><code>alice005 -&gt; 500ecila
bob00003 -&gt; 30000bob
eve00003 -&gt; 30000eve
mallory7 -&gt; 7yrollam
trent005 -&gt; 500tnert
</code></pre></div>

<p>By reducing the size of query intermediates, we can prevent/reduce spilling data to disk, reducing the need for costly I/O operations, thereby improving query performance.</p>

<p><strong>Window Function Performance Improvements (<a href="https://github.com/duckdb/duckdb/pull/7831">#7831</a>, <a href="https://github.com/duckdb/duckdb/pull/7996">#7996</a>, <a href="https://github.com/duckdb/duckdb/pull/8050">#8050</a>, <a href="https://github.com/duckdb/duckdb/pull/8491">#8491</a>).</strong> This release features many improvements to the performance of Window functions due to improved vectorization of the code, more re-use of partial aggregates and improved parallelism through work stealing of tasks. As a result, performance of <a href="https://github.com/duckdb/duckdb/issues/7809#issuecomment-1679387022">Window functions has improved significantly, particularly in scenarios where there are no or few partitions</a>.</p>

<div><pre><code><span>SELECT</span>
    <span>SUM</span><span>(</span><span>driver_pay</span><span>)</span> <span>OVER</span> <span>(</span>
        <span>ORDER</span> <span>BY</span> <span>dropoff_datetime</span> <span>ASC</span>
        <span>RANGE</span> <span>BETWEEN</span>
        <span>INTERVAL</span> <span>3</span> <span>DAYS</span> <span>PRECEDING</span> <span>AND</span>
        <span>INTERVAL</span> <span>0</span> <span>DAYS</span> <span>FOLLOWING</span>
    <span>)</span>
<span>FROM</span> <span>tripdata</span><span>;</span>
</code></pre></div>

<table>
  <thead>
    <tr>
      <th>Version</th>
      <th>Time (s)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>v0.8.0</td>
      <td>33.8</td>
    </tr>
    <tr>
      <td>v0.9.0</td>
      <td>3.8</td>
    </tr>
  </tbody>
</table>
      <h4 id="storage-improvements">
        
        <a href="#storage-improvements">Storage Improvements</a>
        
      </h4>
    

<p><a href="https://github.com/duckdb/duckdb/pull/7794"><strong>Vacuuming of Deleted Row Groups</strong></a>. Starting with this release, when deleting data using <code>DELETE</code> statements, entire row groups that are deleted will be automatically cleaned up. Support is also added to <a href="https://github.com/duckdb/duckdb/pull/7824">truncate the database file on checkpoint</a> which allows the database file to be reduced in size after data is deleted. Note that this only occurs if the deleted row groups are located at the end of the file. The system does not yet move around data in order to reduce the size of the file on disk. Instead, free blocks earlier on in the file are re-used to store later data.</p>

<p><strong>Index Storage Improvements (<a href="https://github.com/duckdb/duckdb/pull/7930">#7930</a>, <a href="https://github.com/duckdb/duckdb/pull/8112">#8112</a>, <a href="https://github.com/duckdb/duckdb/pull/8437">#8437</a>, <a href="https://github.com/duckdb/duckdb/pull/8703">#8703</a>)</strong>. Many improvements have been made to both the in-memory footprint, and the on-disk footprint of ART indexes. In particular for indexes created to maintain <code>PRIMARY KEY</code>, <code>UNIQUE</code> or <code>FOREIGN KEY</code> constraints the storage and in-memory footprint is drastically reduced.</p>

<div><pre><code><span>CREATE</span> <span>TABLE</span> <span>integers</span><span>(</span><span>i</span> <span>INTEGER</span> <span>PRIMARY</span> <span>KEY</span><span>);</span>
<span>INSERT</span> <span>INTO</span> <span>integers</span> <span>FROM</span> <span>range</span><span>(</span><span>10000000</span><span>);</span>
</code></pre></div>

<table>
  <thead>
    <tr>
      <th>Version</th>
      <th>Size</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>v0.8.0</td>
      <td>278MB</td>
    </tr>
    <tr>
      <td>v0.9.0</td>
      <td>78MB</td>
    </tr>
  </tbody>
</table>

<p>In addition, due to improvements in the manner in which indexes are stored on disk they can now be written to disk incrementally instead of always requiring a full rewrite. This allows for much quicker checkpointing for tables that have indexes.</p>
      <h4 id="extensions">
        
        <a href="#extensions">Extensions</a>
        
      </h4>
    

<p><a href="https://github.com/duckdb/duckdb/pull/8732"><strong>Extension Auto-Loading</strong></a>. Starting from this release, DuckDB supports automatically installing and loading of trusted extensions. As many workflows rely on core extensions that are not bundled, such as <code>httpfs</code>, many users found themselves having to remember to load the required extensions up front. With this change, the extensions will instead be automatically loaded (and optionally installed) when used in a query.</p>

<p>For example, in Python the following code snippet now works without needing to explicitly load the <code>httpfs</code> or <code>json</code> extensions.</p>

<div><pre><code><span>import</span> <span>duckdb</span>

<span>duckdb</span><span>.</span><span>sql</span><span>(</span><span>"FROM 'https://raw.githubusercontent.com/duckdb/duckdb/main/data/json/example_n.ndjson'"</span><span>)</span>
</code></pre></div>

<p>The set of autoloadable extensions is limited to official extensions distributed by DuckDB Labs, and can be <a href="https://github.com/duckdb/duckdb/blob/8feb03d274892db0e7757cd62c145b18dfa930ec/scripts/generate_extensions_function.py#L298">found here</a>. The behavior can also be disabled using the <code>autoinstall_known_extensions</code> and <code>autoload_known_extensions</code> settings, or through the more general <code>enable_external_access</code> setting. See the <a href="https://duckdb.org/docs/sql/configuration.html">configuration options</a>.</p>

<p><a href="https://github.com/duckdb/duckdb-wasm/pull/1403"><strong>DuckDB-WASM Extensions</strong></a>. This release adds support for loadable extensions to DuckDB-WASM. Previously, any extensions that you wanted to use with the WASM client had to be baked in. With this release, extensions can be loaded dynamically instead. When an extension is loaded, the WASM bundle is downloaded and the functionality of the extension is enabled. Give it a try in our <a href="https://shell.duckdb.org/">WASM shell</a>.</p>

<div><pre><code><span>LOAD</span> <span>inet</span><span>;</span>
<span>SELECT</span> <span>'127.0.0.1'</span><span>::</span><span>INET</span><span>;</span>
</code></pre></div>

<p><a href="https://github.com/duckdblabs/duckdb_aws"><strong>AWS Extension</strong></a>. This release marks the launch of the DuckDB AWS extension. This extension contains AWS related features that rely on the AWS SDK. Currently, the extension contains one function, <code>LOAD_AWS_CREDENTIALS</code>, which uses the AWS <a href="https://docs.aws.amazon.com/sdkref/latest/guide/standardized-credentials.html#credentialProviderChain">Credential Provider Chain</a> to automatically fetch and set credentials:</p>

<div><pre><code><span>CALL</span> <span>load_aws_credentials</span><span>();</span>
<span>SELECT</span> <span>*</span> <span>FROM</span> <span>"s3://some-bucket/that/requires/authentication.parquet"</span><span>;</span>
</code></pre></div>

<p><a href="https://duckdb.org/docs/extensions/aws">See the documentation for more information</a>.</p>

<p><a href="https://github.com/duckdblabs/duckdb_iceberg"><strong>Experimental Iceberg Extension</strong></a>. This release marks the launch of the DuckDB Iceberg extension. This extension adds support for reading tables stored in the <a href="https://iceberg.apache.org/">Iceberg format</a>.</p>

<div><pre><code><span>SELECT</span> <span>count</span><span>(</span><span>*</span><span>)</span> <span>FROM</span> <span>iceberg_scan</span><span>(</span><span>'data/iceberg/lineitem_iceberg'</span><span>,</span> <span>ALLOW_MOVED_PATHS</span><span>=</span><span>true</span><span>);</span>
</code></pre></div>

<p><a href="https://duckdb.org/docs/extensions/iceberg">See the documentation for more information</a>.</p>

<p><a href="https://github.com/duckdblabs/duckdb_azure"><strong>Experimental Azure Extension</strong></a>. This release marks the launch of the DuckDB Azure extension. This extension allows for DuckDB to natively read data stored on Azure, in a similar manner to how it can read data stored on S3.</p>

<div><pre><code><span>SET</span> <span>azure_storage_connection_string</span> <span>=</span> <span>'&lt;your_connection_string&gt;'</span><span>;</span>
<span>SELECT</span> <span>*</span> <span>from</span> <span>'azure://&lt;my_container&gt;/*.csv'</span><span>;</span>
</code></pre></div>

<p><a href="https://duckdb.org/docs/extensions/azure">See the documentation for more information</a>.</p>
      <h4 id="clients">
        
        <a href="#clients">Clients</a>
        
      </h4>
    

<p><a href="https://github.com/duckdb/duckdb/pull/8083"><strong>Experimental PySpark API</strong></a>. This release features the addition of an experimental Spark API to the Python client. The API aims to be fully compatible with the PySpark API, allowing you to use the Spark API as you are familiar with but while utilizing the power of DuckDB. All statements are translated to DuckDB’s internal plans using our <a href="https://duckdb.org/docs/archive/0.8.1/api/python/relational_api">relational API</a> and executed using DuckDB’s query engine.</p>

<div><pre><code><span>from</span> <span>duckdb.experimental.spark.sql</span> <span>import</span> <span>SparkSession</span> <span>as</span> <span>session</span>
<span>from</span> <span>duckdb.experimental.spark.sql.functions</span> <span>import</span> <span>lit</span><span>,</span> <span>col</span>
<span>import</span> <span>pandas</span> <span>as</span> <span>pd</span>

<span>spark</span> <span>=</span> <span>session</span><span>.</span><span>builder</span><span>.</span><span>getOrCreate</span><span>()</span>

<span>pandas_df</span> <span>=</span> <span>pd</span><span>.</span><span>DataFrame</span><span>({</span>
    <span>'age'</span><span>:</span> <span>[</span><span>34</span><span>,</span> <span>45</span><span>,</span> <span>23</span><span>,</span> <span>56</span><span>],</span>
    <span>'name'</span><span>:</span> <span>[</span><span>'Joan'</span><span>,</span> <span>'Peter'</span><span>,</span> <span>'John'</span><span>,</span> <span>'Bob'</span><span>]</span>
<span>})</span>

<span>df</span> <span>=</span> <span>spark</span><span>.</span><span>createDataFrame</span><span>(</span><span>pandas_df</span><span>)</span>
<span>df</span> <span>=</span> <span>df</span><span>.</span><span>withColumn</span><span>(</span>
    <span>'location'</span><span>,</span> <span>lit</span><span>(</span><span>'Seattle'</span><span>)</span>
<span>)</span>
<span>res</span> <span>=</span> <span>df</span><span>.</span><span>select</span><span>(</span>
    <span>col</span><span>(</span><span>'age'</span><span>),</span>
    <span>col</span><span>(</span><span>'location'</span><span>)</span>
<span>).</span><span>collect</span><span>()</span>

<span>print</span><span>(</span><span>res</span><span>)</span>
<span>#[
#    Row(age=34, location='Seattle'),
#    Row(age=45, location='Seattle'),
#    Row(age=23, location='Seattle'),
#    Row(age=56, location='Seattle')
#]
</span></code></pre></div>

<p>Note that the API is currently experimental and features are still missing. We are very interested in feedback. Please report any functionality that you are missing, either through Discord or on Github.</p>
      <h4 id="final-thoughts">
        
        <a href="#final-thoughts">Final Thoughts</a>
        
      </h4>
    

<p>The full release notes can be <a href="https://github.com/duckdb/duckdb/releases/tag/v0.9.0">found on Github</a>. We would like to thank all of the contributors for their hard work on improving DuckDB.</p>

							<p><a href="https://duckdb.org/news/">back to news archive <span></span></a>
						</p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Why we bootstrap (108 pts)]]></title>
            <link>https://www.flagsmith.com/blog/why-we-bootstrap</link>
            <guid>37657519</guid>
            <pubDate>Tue, 26 Sep 2023 11:06:33 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.flagsmith.com/blog/why-we-bootstrap">https://www.flagsmith.com/blog/why-we-bootstrap</a>, See on <a href="https://news.ycombinator.com/item?id=37657519">Hacker News</a></p>
<div id="readability-page-1" class="page"><div fs-richtext-element="rich-text"><p>Venture capital isn’t the necessity it once was for tech startups. Bootstrapped companies are competing with—and outflanking—heavily funded goliaths by finding a niche and applying focus. </p><h2>The bootstrapping superpower</h2><p>The combination of small teams and an intense bootstrapping ethos can be a superpower.</p><p>• Venture capital offers a tonne of competitive advantage and can grow a company fast, but it puts you on a treadmill focused on revenue and fast growth targets.<a href="https://posthog.com/blog/using-vc-carefully"> Raising rounds is intoxicating</a> and it's easy to get stuck in the fundraising loop. </p><p>• Bootstrapped founders get to choose their company's focus. For example, David Heinemeier Hansson <a href="https://www.linkedin.com/pulse/bootstrapped-basecamp-executing-nonsense-strategy-sramana-mitra-1e/">bootstrapped Basecamp</a> by focusing on slow, consistent, profitable growth.&nbsp;</p><p>At <a href="https://www.flagsmith.com/">Flagsmith</a>, bootstrapping lets us build efficiently and focus on the customer. We hit $1.5M ARR earlier this year with a super lean team, and we’re genuinely excited about the next chapters. Here are four reasons we continue to bootstrap.&nbsp;&nbsp;</p><h2>1. Customer focus&nbsp;</h2><p>The VC track puts focus on the company’s next raise. Bootstrapping lets us focus on customers.&nbsp;</p><p>There are pros and cons to both tracks. With external capital growth can rocket, but the path is laid out for you. The growth mindset can become very internally focused as you need to look at:</p><p>• Hiring</p><p>• Increasing LTVs </p><p>• Getting more customers fast </p><p>• Hitting board-driven revenue milestones </p><p>We’re profitable and stable and don't have an absolute mandate to hit an external revenue goal. All of the goals we set are our own. </p><p>We’ve had tough budget constraints, but since we’ve stayed profitable we haven’t had to play pricing games by upselling customers or hiking prices. We’ve created a pricing model and customer support ethos that fits with our business goals.</p><h2>2. We haven't had financial pressure to grow fast</h2><h4>Fewer financial pressures from infrastructure costs etc.</h4><p>Back in the day venture capital was applied to technology businesses because they were enormously expensive to start—and run—so you couldn't do it on your own.&nbsp;</p><p>You had to buy pricey hardware. Software tools were expensive and you needed enterprise licences. You probably also needed Oracle databases, which weren’t cheap. To start a technology company you needed capital.</p><p>That's not the case anymore. You can start a sustainable software business for relatively small amounts. A lot of software tools have trials, startup versions or open source options. </p><p>The guts of the Flagsmith platform were essentially free when we were running the agency, and we scaled it to billions of monthly requests on our own budget. That would have cost a fortune 20 years ago.&nbsp;</p><h4>Building out of an agency&nbsp;</h4><p>We started building Flagsmith alongside running an agency. At first, we were able to grow organically in line with <a href="https://github.com/Flagsmith/flagsmith">open source growth</a>. We didn’t have financial pressures to build quickly, so we didn’t need capital.&nbsp;</p><p>As we grew, we realised VC money comes with some competitive advantage, but it also comes with a tonne of obligations like meetings, targets, reporting, and externally set timelines. That doesn’t fit the way we want to build. Since we’ve hit profitability and sustainability, we’ve chosen to continue sidestepping the VC path in favour of growing efficiently.&nbsp;&nbsp;</p><h2>3. Bootstrapping can be sustainable</h2><p>Bootstrapped companies often get asked about sustainability. Really, though, bootstrapped companies are hardened and have had to make their way from the beginning; they have stability baked in at the start.</p><p>Venture-backed companies’ sustainability is commonly measured by runway (the amount of time they have left before they run out of cash.) Typically this is measured in months!&nbsp;</p><p>It's a ticking clock that can lead to running out of money, selling, or having to raise again. This can be fragile. If you look at a bootstrapped company that’s hit profitability, there is no runway. The plane is climbing into the air.&nbsp;</p><p>Coming back to the hardened mentality, bootstrapping founders of sustainable businesses often appreciate the fact that there are no quick wins. They’ve chosen to grow efficiently and have worked with hard financial constraints. They've had to avoid <a href="https://a16z.com/how-to-ruin-your-company-with-one-bad-process/">messing up budgeting choices by growing too fast</a> and creating cultural/technical drift.</p><p>So while there are a huge number of companies that do well with VC money, ask any VC and you will hear that most of their portfolio will fail. There are a lot of companies that raise $5 million and get published on Crunchbase only to disappear overnight because they aren’t sustainable. (e.g. Just <a href="https://venturebeat.com/entrepreneur/getting-to-50-million-how-to-avoid-the-saas-valley-of-death/">4% of SaaS companies reach $1M ARR</a>.)&nbsp;&nbsp;</p><h2>4. Bootstrapping fits our ethos (and excitement around figuring out what's next)</h2><h4>Company ethos</h4><p>We believe enterprise software is not a winner-takes-all game. With the current software landscape, there's room for multiple players in most software markets.&nbsp;</p><p>External capital can help you grow faster and take more market share. But you can also do really well in a market without that competitive advantage if you find your niche.&nbsp;</p><p>We’ve chosen to build a sustainable open source feature flag software with commercial enterprise licenses and on-premises deployment options. Our code is in the open and tested by developers around the globe. Our choices to open source and bootstrap mirror one another.&nbsp;</p><h4>Personal ethos</h4><p>I don't want Flagsmith’s focus to be on money. Part of the joy of bootstrapping Flagsmith is that we aren’t bound to hit externally set revenue goals within a timeframe. We have the freedom to choose what happens next. </p><p>Flagsmith makes money. It’s sustainable. It has fantastic customers and a thriving open source community. There’s no rigidity or pre-ordained milestones for the next phase of our growth, which lets us be creative and enjoy running the business.&nbsp;</p><p>There’s a lot of joy in knowing that we don’t have the next five years set in stone, and we’re not cycling down a path that's getting narrower and narrower while our ability to fail is going up and up.&nbsp;</p><p>‍</p><figure></figure><p>‍</p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Who Lusts for Certainty Lusts for Lies (270 pts)]]></title>
            <link>https://www.etymonline.com/columns/post/who-lusts-for-certainty-lusts-for-lies</link>
            <guid>37657368</guid>
            <pubDate>Tue, 26 Sep 2023 10:50:26 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.etymonline.com/columns/post/who-lusts-for-certainty-lusts-for-lies">https://www.etymonline.com/columns/post/who-lusts-for-certainty-lusts-for-lies</a>, See on <a href="https://news.ycombinator.com/item?id=37657368">Hacker News</a></p>
<div id="readability-page-1" class="page"><p>We need to talk about the Google Ngram Viewer n-grams. They are wrong. [D.R.H.]</p><section><p>Here's the Ngram's idea of the frequency of the word <strong><span>said</span></strong>:</p> 
<p><img src="https://cdn.etymonline.com/pictures/7e45901b5b1856dffde4625ce1b5783a.png"></p> 
<p>It doesn't look like an indicator of the diachronic change in the popularity of a very common English verb during the 20th century. It looks like the temperature graph of the last ice age. Younger people, rest assured that English authors in the 1970s did not all stop using "said" and then start again.</p> 
<p>Talia Felix and I plow in Google Books every day, researching. It is a marvel of a resource, but we know by experience how ineptly assembled that database is. And how many booby-traps lie hidden in it.</p> 
<p>I cannot tell you much about how AI works. But I can tell you how AI handles something I know how to handle. Here's another example. "The Great Toast Famine of '77"</p> 
<p><img src="https://cdn.etymonline.com/pictures/ebe7cc61ca9a9a7052b6eb2cbdf5417d.png"></p> 
<p>Ngram says <strong><span>toast</span></strong> almost vanishes from the English language by 1980, and then it pops back up.</p> 
 
<p><strong>WHY THAT'S WRONG</strong></p> 
<p>There's a <a href="https://www.google.com/search?q=Ngram+inaccurate&amp;sca_esv=563166832&amp;gs_lp=Egxnd3Mtd2l6LXNlcnAiEE5ncmFtIGluYWNjdXJhdGUyBRAAGKIEMgUQABiiBDIFEAAYogQyBRAAGKIESM8HUFVYrwVwAXgBkAEAmAGzAaABmQKqAQMwLjK4AQPIAQD4AQHCAgoQABhHGNYEGLAD4gMEGAAgQYgGAZAGCA" rel="nofollow" target="_blank">long-documented flaw</a> in the Ngram formula, inherited from Google Books. The error makes a vast number of English words appear to be diminishing in use through the 20th century only to revive around 1980.</p> 
<p>A rough gist of an explanation for it seems to be that Google Books' corpus is heavily academic. The printed matter Google sucked up from universities had a disproportion of modern scientific and academic journals in it. The articles in those journals and textbooks lean on the same few words (as academics are wont to do when they write).</p> 
<p>That not only bloats the scores for those few words, it falsely drives down the other words. That creates that mid-20th-century "dip" in the Ngram of almost every word.</p> 
<p><strong><span>Said</span></strong> likely appears less often in academic writing than in other writing, such as a novel or a newspaper. But academic papers use words such as, say, <strong><span>graph</span></strong>, a good deal more often. And here's what the Ngram for <strong><span>graph</span></strong> looks like in the 20th century:</p> 
<p><img src="https://cdn.etymonline.com/pictures/2a6e1c82c744e08c1f00ec63f2afaa6e.png"></p> 
<p>See? No dip.</p> 
<p>That's just one error. Here's another: If you look at an Ngram for <a href="https://www.etymonline.com/search?q=fuck" rel="nofollow" target="_blank">the F-word</a>, you'll see very little use of it until modern times, which is expected. But the number of hits for it jumps up as you go back past about 1820, and keeps rising into the late 1700s (if you could see it). Those are all the word <strong><span>suck</span></strong>, written with the old "long " <strong>-s-</strong> — the printer's <strong>-ſ-</strong>. It looks like a lower-case <strong>-f-</strong>, in worn-down fonts on cheap paper in old libraries. The use of that character faded out about 1820. Sometimes only context tells you whether it is an <span>-f-</span> or an <span>-s-</span>. AI has no clue.</p> 
<p>Here's another: Google Books fails to recognize identity in variant spellings. The Ngram for <strong>authorise</strong> is different from that for <strong>authorize</strong>, and neither counts <strong>authorizes</strong>. Google doesn't count plural forms in the noun Ngrams. It can't tell <strong>dog</strong> from <strong>dogs</strong>.</p> 
<p>Worse, many of Google Books' files are misdated. On a battered library book, an "1896" on the cover page can look like "1800" to a digital scanner. A stack of Bible tracts from the 1910s long appeared in Google Books as published in 1799. That date did appear on all their covers — on the logo of the Bible tract society that printed them, as the date of its founding. I hardly trust Google Books dated search results to be right five times in a row. <a href="https://youtu.be/GG8qDmoR3dw?si=jxMQnyuu8fUJmLl8" rel="nofollow" target="_blank">We even made a video about it</a>.</p> 
 
<p><strong>BUT PEOPLE WANT THEM</strong></p> 
<p>The text of Etymonline is built entirely from print sources, and is done entirely by human beings. Ngrams are not. They are unreliable, a sloppy product of an ignorant technology, one made to sell and distract, one never taught the difference between "influence" and "inform."</p> 
<p>Why are they on the site at all? Because now, online, pictures win and words lose. The war is over; they won. Just remember: Ngrams are unreliable. Even if the world now prefers Ngram reality, where the word "said" went into eclipse with Jimmy Carter, you're allowed to be smarter than that.</p> 
<p>When you see an Ngrams on etymonline or anywhere else, admire it as decorative, whimsical, a gourami tank in a restaurant, abstract art on hotel walls, blueprints for roller-coasters. And where the Ngrams disagree with etymonline on a first date, presume we're right and they're wrong.</p></section></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Spain cancels Pegasus spyware investigation because Israel is not co-operating (302 pts)]]></title>
            <link>https://www.theguardian.com/world/2023/jul/10/spain-closes-pegasus-investigation-over-lack-of-cooperation-from-israel</link>
            <guid>37657334</guid>
            <pubDate>Tue, 26 Sep 2023 10:46:51 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.theguardian.com/world/2023/jul/10/spain-closes-pegasus-investigation-over-lack-of-cooperation-from-israel">https://www.theguardian.com/world/2023/jul/10/spain-closes-pegasus-investigation-over-lack-of-cooperation-from-israel</a>, See on <a href="https://news.ycombinator.com/item?id=37657334">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="maincontent"><p>A Spanish judge investigating the alleged hacking of ministers’ phones with Pegasus spyware has shelved his investigation over a “complete” lack of cooperation from <a href="https://www.theguardian.com/world/israel" data-link-name="in body link">Israel</a>, a court statement said on Monday.</p><p>In June 2022, José Luis Calama said he had sent a formal request for international judicial assistance, known as a letter rogatory, to the Israeli government asking for information about the software made by the Israeli firm NSO Group.</p><p>He also said he wanted to go there in person to take a witness statement from NSO’s chief executive.</p><p>But on Monday, the Audiencia Nacional, <a href="https://www.theguardian.com/world/spain" data-link-name="in body link">Spain</a>’s top criminal court, said Calama had decided to provisionally close the case “due to the complete lack of legal cooperation from Israel, which has not responded to the rogatory commission … and has prevented the investigation from going ahead”.</p><p>The investigation began in May 2022 after the Spanish government said the spyware, which can infiltrate mobile phones to extract data or activate a camera or microphone to spy on their owners, <a href="https://www.theguardian.com/world/2022/may/03/over-200-spanish-mobile-numbers-possible-targets-pegasus-spyware" data-link-name="in body link">had been used against phones belonging to top politicians</a>.</p><figure id="56a31631-1cfb-471f-93fd-f7145973c18e" data-spacefinder-role="richLink" data-spacefinder-type="model.dotcomrendering.pageElements.RichLinkBlockElement"><gu-island name="RichLinkComponent" deferuntil="idle" props="{&quot;richLinkIndex&quot;:5,&quot;element&quot;:{&quot;_type&quot;:&quot;model.dotcomrendering.pageElements.RichLinkBlockElement&quot;,&quot;url&quot;:&quot;https://www.theguardian.com/world/2022/may/03/over-200-spanish-mobile-numbers-possible-targets-pegasus-spyware&quot;,&quot;text&quot;:&quot;Over 200 Spanish mobile numbers ‘possible targets of Pegasus spyware’&quot;,&quot;prefix&quot;:&quot;Related: &quot;,&quot;role&quot;:&quot;richLink&quot;,&quot;elementId&quot;:&quot;56a31631-1cfb-471f-93fd-f7145973c18e&quot;},&quot;ajaxUrl&quot;:&quot;https://api.nextgen.guardianapps.co.uk&quot;,&quot;format&quot;:{&quot;display&quot;:0,&quot;theme&quot;:0,&quot;design&quot;:0}}" config="{&quot;renderingTarget&quot;:&quot;Web&quot;}"></gu-island></figure><p>Among those targeted were the phones of the prime minister, Pedro Sánchez; the defence minister, Margarita Robles; the interior minister, Fernando Grande-Marlaska, and the agriculture minister, Luis Planas.</p><p>But the Israeli government had not answered the request for assistance, which had been sent four times, meaning “it probably never would”, the court said in a statement, indicating the only remaining option was diplomacy.</p><p>“All that remains is a possible diplomatic channel capable of promoting compliance with the obligations derived from international treaties,” it said.</p><p>The court said Sánchez’s phone had been targeted on five occasions between October 2020 and December 2021. But despite a prolonged analysis of the four phones, it had not been possible to determine who was behind the attacks, the statement said.</p><p>Spain’s government has blamed it on “an external attack” while the Spanish press has pointed the finger at Morocco, given the diplomatic crisis between the two countries at the time.</p><p>The Guardian and El País <a href="https://www.theguardian.com/world/2020/jul/13/phone-of-top-catalan-politician-targeted-by-government-grade-spyware" data-link-name="in body link">first reported in June 2020</a> that the speaker of the Catalan regional parliament, Roger Torrent, and at least two other pro-independence supporters had been alerted that they had been targeted in what at the time was called a “possible case of domestic political espionage”. Dozens more cases were later identified in April 2022,<strong> </strong>when researchers at the Citizen Lab at the University of Toronto’s Munk school published a report saying <a href="https://www.theguardian.com/world/2022/apr/18/catalan-leaders-targeted-using-nso-spyware-say-cybersecurity-experts" data-link-name="in body link">the phones of at least 65 Catalan separatists had been targeted using Pegasus</a> after the failed 2017 independence bid.</p><p>NSO has said its spyware is sold to government clients only for the purposes of investigating serious crime and terrorism. It has said it investigates legitimate allegations of abuse.</p><p>The spy chief Paz Esteban told a parliamentary committee in 2022 that 18 Catalan separatists, including the Catalan regional leader, Pere Aragonès, had been spied on with Pegasus software – but always with court approval. She <a href="https://www.theguardian.com/world/2022/may/10/spains-spy-chief-paz-esteban-sacked-after-pegasus-spyware-revelations" data-link-name="in body link">was later sacked</a>.</p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[NSA, FBI, and CISA Release Cybersecurity Information Sheet on Deepfake Threats (138 pts)]]></title>
            <link>https://www.cisa.gov/news-events/alerts/2023/09/12/nsa-fbi-and-cisa-release-cybersecurity-information-sheet-deepfake-threats</link>
            <guid>37656646</guid>
            <pubDate>Tue, 26 Sep 2023 09:26:40 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.cisa.gov/news-events/alerts/2023/09/12/nsa-fbi-and-cisa-release-cybersecurity-information-sheet-deepfake-threats">https://www.cisa.gov/news-events/alerts/2023/09/12/nsa-fbi-and-cisa-release-cybersecurity-information-sheet-deepfake-threats</a>, See on <a href="https://news.ycombinator.com/item?id=37656646">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
          <p>Today, the National Security Agency (NSA), the Federal Bureau of Investigation (FBI), and the Cybersecurity and Infrastructure Security Agency (CISA) released a Cybersecurity Information Sheet (CSI), <a href="https://media.defense.gov/2023/Sep/12/2003298925/-1/-1/0/CSI-DEEPFAKE-THREATS.PDF" title="Contextualizing Deepfake Threats to Organizations">Contextualizing Deepfake Threats to Organizations</a>, which provides an overview of synthetic media threats, techniques, and trends. Threats from synthetic media, such as deepfakes, have exponentially increased—presenting a growing challenge for users of modern technology and communications, including the National Security Systems (NSS), the Department of Defense (DoD), the Defense Industrial Base (DIB), and national critical infrastructure owners and operators. Between 2021 and 2022, U.S. Government agencies collaborated to establish a set of employable best practices to take in preparation and response to the growing threat. Public concern around synthetic media includes disinformation operations, designed to influence the public and spread false information about political, social, military, or economic issues to cause confusion, unrest, and uncertainty.</p>
<p>The authoring agencies urge organizations review <a href="https://media.defense.gov/2023/Sep/12/2003298925/-1/-1/0/CSI-DEEPFAKE-THREATS.PDF" title="Contextualizing Deepfake Threats to Organizations">the CSI</a>&nbsp;for recommended steps and best practices to prepare, identify, defend against, and respond to deepfake threats.</p>

      </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[FCC Aims to Reinstate Net Neutrality After US Democrats Gain Control of Panel (279 pts)]]></title>
            <link>https://www.bloomberg.com/news/articles/2023-09-26/fcc-aims-to-reinstate-net-neutrality-rules-as-us-democrats-gain-control-of-panel</link>
            <guid>37656170</guid>
            <pubDate>Tue, 26 Sep 2023 08:28:59 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.bloomberg.com/news/articles/2023-09-26/fcc-aims-to-reinstate-net-neutrality-rules-as-us-democrats-gain-control-of-panel">https://www.bloomberg.com/news/articles/2023-09-26/fcc-aims-to-reinstate-net-neutrality-rules-as-us-democrats-gain-control-of-panel</a>, See on <a href="https://news.ycombinator.com/item?id=37656170">Hacker News</a></p>
<div id="readability-page-1" class="page"><section>
    <section>
        <h3>Why did this happen?</h3>
        <p>Please make sure your browser supports JavaScript and cookies and that you are not
            blocking them from loading.
            For more information you can review our <a href="https://www.bloomberg.com/notices/tos">Terms of
                Service</a> and <a href="https://www.bloomberg.com/notices/tos">Cookie Policy</a>.</p>
    </section>
    <section>
        <h3>Need Help?</h3>
        <p>For inquiries related to this message please <a href="https://www.bloomberg.com/feedback">contact
            our support team</a> and provide the reference ID below.</p>
        <p>Block reference ID:</p>
    </section>
</section></div>]]></description>
        </item>
        <item>
            <title><![CDATA[AI is fundamentally ‘a surveillance technology’ (199 pts)]]></title>
            <link>https://techcrunch.com/2023/09/25/signals-meredith-whittaker-ai-is-fundamentally-a-surveillance-technology/</link>
            <guid>37656091</guid>
            <pubDate>Tue, 26 Sep 2023 08:18:08 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://techcrunch.com/2023/09/25/signals-meredith-whittaker-ai-is-fundamentally-a-surveillance-technology/">https://techcrunch.com/2023/09/25/signals-meredith-whittaker-ai-is-fundamentally-a-surveillance-technology/</a>, See on <a href="https://news.ycombinator.com/item?id=37656091">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
				<p id="speakable-summary">Why is it that so many companies that rely on monetizing the data of their users seem to be extremely hot on AI? If you ask Signal president Meredith Whittaker (and I did), she’ll tell you it’s simply because “AI is a surveillance technology.”</p>
<p><a href="https://youtu.be/amNriUZNP8w" target="_blank" rel="noopener">Onstage at TechCrunch Disrupt 2023</a>, Whittaker explained her perspective that AI is largely inseparable from the big data and targeting industry perpetuated by the likes of Google and Meta, as well as less consumer-focused but equally prominent enterprise and defense companies. (Her remarks lightly edited for clarity.)</p>
<p>“It requires the surveillance business model; it’s an exacerbation of what we’ve seen since the late ’90s and the development of surveillance advertising. AI is a way, I think, to entrench and expand the surveillance business model,” she said. “The Venn diagram is a circle.”</p>
<p>“And the use of AI is also surveillant, right?” she continued. “You know, you walk past a facial recognition camera that’s instrumented with pseudo-scientific emotion recognition, and it produces data about you, right or wrong, that says ‘you are happy, you are sad, you have a bad character, you’re a liar, whatever.’ These are ultimately surveillance systems that are being marketed to those who have power over us generally: our employers, governments, border control, etc., to make determinations and predictions that will shape our access to resources and opportunities.”</p>
<p>Ironically, she pointed out, the data that underlies these systems is frequently organized and annotated (a necessary step in the AI dataset assembly process) by the very workers at whom it can be aimed.</p>
<p>“There’s no way to make these systems without human labor at the level of informing the ground truth of the data — reinforcement learning with human feedback, which again is just kind of tech-washing precarious human labor. It’s thousands and thousands of workers paid very little, though en masse it’s very expensive, and there’s no other way to create these systems, full stop,” she explained. “In some ways what we’re seeing is a kind of Wizard of Oz phenomenon, when we pull back the curtain there’s not that much that’s intelligent.”</p>

<p>Not all AI and machine learning systems are equally exploitative, though. When I asked if Signal uses any AI tools or processes in its app or development work, she confirmed that the app has a “small on-device model that we didn’t develop, we use it off the shelf, as part of the face blur feature in our media editing toolset. It’s not actually that good… but it helps detect faces in crowd photos and blur them, so that when you share them on social media you’re not revealing people’s intimate biometric data to, say, Clearview.”</p>
<p>“But here’s the thing. Like… yeah, that’s a great use of AI, and doesn’t that just disabuse us of all this negativity I’ve been throwing out onstage,” she added. “Sure, if that were the only market for facial recognition… but let’s be clear. The economic incentives that drive the very expensive process of developing and deploying facial recognition technology would never let that be the only use.”</p>
			</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[macOS Containers v0.0.1 (448 pts)]]></title>
            <link>https://macoscontainers.org/</link>
            <guid>37655477</guid>
            <pubDate>Tue, 26 Sep 2023 07:01:45 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://macoscontainers.org/">https://macoscontainers.org/</a>, See on <a href="https://news.ycombinator.com/item?id=37655477">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
			
			<p><img src="https://macoscontainers.org/assets/images/favicon.svg" alt="macOS Containers logo"></p>



<p>Containers have fundamentally changed the way that modern software is developed and deployed. Containers are supported by a wide range of operating systems including FreeBSD, Solaris, Linux and even Windows, but are not natively supported by macOS. <strong>Until now.</strong></p>

<p>We’re announcing initial 0.0.1 release of macOS native containers.  Yes, you can now <strong>run macOS inside macOS</strong>, build images using Docker and distribute them using registries.</p>

<p><img src="https://macoscontainers.org/assets/images/showcase.png" alt="Showcase"></p>

<p>So what are you waiting for? Installation is available via <a href="https://github.com/macOScontainers/homebrew-formula#installation">Homebrew</a>.</p>



			
		</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Inside the Matrix: Visualizing Matrix Multiplication, Attention and Beyond (205 pts)]]></title>
            <link>https://pytorch.org/blog/inside-the-matrix/</link>
            <guid>37655094</guid>
            <pubDate>Tue, 26 Sep 2023 06:11:40 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://pytorch.org/blog/inside-the-matrix/">https://pytorch.org/blog/inside-the-matrix/</a>, See on <a href="https://news.ycombinator.com/item?id=37655094">Hacker News</a></p>
<div id="readability-page-1" class="page"><article>
                    
                    <p><em>Use 3D to visualize matrix multiplication expressions, attention heads with real weights, and more.</em></p>

<p>Matrix multiplications (matmuls) are the building blocks of today’s ML models. This note presents <a href="https://bhosmer.github.io/mm/ref.html">mm</a>, a visualization tool for matmuls and compositions of matmuls.</p>

<p>Because mm uses all three spatial dimensions, it helps build intuition and spark ideas with less cognitive overhead than the usual squares-on-paper idioms, especially (though not only) for visual/spatial thinkers.</p>

<p>And with three dimensions available for <em>composing</em> matmuls, along with the ability to load trained weights, we can visualize big, compound expressions like attention heads and observe how they actually behave, using im.</p>

<p>mm is fully interactive, runs <a href="https://bhosmer.github.io/mm/">in the browser</a> or <a href="https://colab.research.google.com/drive/1wZIoU20eRWKtRNCW7e5Iugm3MhfaE1f7">notebook iframes</a> and keeps its complete state in the URL, so links are shareable sessions (the screenshots and videos in this note all have links that open the visualizations in the tool). This <a href="https://bhosmer.github.io/mm/ref.html">reference guide</a> describes all of the available functionality.</p>

<p>We’ll first introduce the visualization approach, build intuition by visualizing some simple matmuls and expressions, then dive into some more extended examples:</p>

<ol>
  <li><strong>Pitch</strong> - why is this way of visualizing better?</li>
  <li><strong>Warmup - animations</strong> - watching the canonical matmul decompositions in action</li>
  <li><strong>Warmup - expressions</strong> - a quick tour of some fundamental expression building blocks</li>
  <li><strong>Inside an attention head</strong> - an in-depth look at the structure, values and computation behavior of a couple of attention heads from GPT2 via <a href="https://github.com/karpathy/nanoGPT">NanoGPT</a></li>
  <li><strong>Parallelizing attention</strong> - visualizing attention head parallelization with examples from the recent <a href="https://arxiv.org/pdf/2305.19370.pdf">Blockwise Parallel Transformer</a> paper</li>
  <li><strong>Sizes in an attention layer</strong> - what do the MHA and FFA halves of an attention layer look like together, when we visualize a whole layer as a single structure? How does the picture change during autoregressive decoding?</li>
  <li><strong>LoRA</strong> - a visual explanation of this elaboration of the attention head architecture</li>
  <li><strong>Wrapup</strong> - next steps and call for feedback</li>
</ol>

<h2 id="1-pitch">1 Pitch</h2>

<p><a href="https://bhosmer.github.io/mm/ref.html">mm</a>’s visualization approach is based on the premise that <em>matrix multiplication is fundamentally a three-dimensional operation</em>.</p>

<p>In other words this:</p>

<p><img src="https://pytorch.org/assets/images/inside-the-matrix/matmul3.jpg" alt="matrix multiplication is fundamentally a three-dimensional operation"></p>

<p>is a sheet of paper trying to be this (<a href="https://bhosmer.github.io/mm/index.html?params=%7B%22expr%22%3A%22L%20%40%20R%22%2C%22name%22%3A%22L%20%40%20R%22%2C%22epilog%22%3A%22none%22%2C%22left%22%3A%7B%22name%22%3A%22L%22%2C%22matmul%22%3Afalse%2C%22h%22%3A32%2C%22w%22%3A24%2C%22init%22%3A%22expr%22%2C%22url%22%3A%22%22%2C%22min%22%3A-1%2C%22max%22%3A1%2C%22dropout%22%3A0%2C%22expr%22%3A%22-2%20*%20(Math.trunc(i%20%2F%208)%20%25%202)%20%2B%201%22%2C%22folder%22%3A%22open%22%7D%2C%22right%22%3A%7B%22name%22%3A%22R%22%2C%22matmul%22%3Afalse%2C%22h%22%3A24%2C%22w%22%3A32%2C%22init%22%3A%22expr%22%2C%22url%22%3A%22%22%2C%22min%22%3A-1%2C%22max%22%3A1%2C%22dropout%22%3A0%2C%22expr%22%3A%22-2%20*%20(Math.trunc(j%20%2F%208)%20%25%202)%20%2B%201%22%2C%22folder%22%3A%22open%22%7D%2C%22anim%22%3A%7B%22fuse%22%3A%22none%22%2C%22speed%22%3A20%2C%22hide%20inputs%22%3Afalse%2C%22alg%22%3A%22none%22%2C%22spin%22%3A0%2C%22folder%22%3A%22open%22%7D%2C%22block%22%3A%7B%22i%20blocks%22%3A1%2C%22j%20blocks%22%3A1%2C%22k%20blocks%22%3A1%7D%2C%22layout%22%3A%7B%22scheme%22%3A%22blocks%22%2C%22gap%22%3A3%2C%22scatter%22%3A0%2C%22molecule%22%3A1%2C%22blast%22%3A0%2C%22polarity%22%3A%22negative%22%2C%22left%20placement%22%3A%22left%22%2C%22right%20placement%22%3A%22top%22%2C%22result%20placement%22%3A%22front%22%2C%22folder%22%3A%22closed%22%7D%2C%22deco%22%3A%7B%22legends%22%3A6%2C%22shape%22%3Atrue%2C%22spotlight%22%3A2%2C%22row%20guides%22%3A1%2C%22flow%20guides%22%3A0.5%2C%22lens%20size%22%3A0.5%2C%22magnification%22%3A10%2C%22interior%20spotlight%22%3Afalse%2C%22axes%22%3Afalse%2C%22folder%22%3A%22closed%22%7D%2C%22viz%22%3A%7B%22sensitivity%22%3A%22semilocal%22%2C%22min%20size%22%3A0.196%2C%22min%20light%22%3A0.4%2C%22max%20light%22%3A0.6%2C%22elem%20scale%22%3A0.8227%2C%22zero%20hue%22%3A0.77%2C%22hue%20gap%22%3A0.74%2C%22hue%20spread%22%3A0.04%2C%22folder%22%3A%22open%22%7D%2C%22diag%22%3A%7B%22url%22%3A%22%22%7D%2C%22cam%22%3A%7B%22x%22%3A-48.763575165818956%2C%22y%22%3A43.72517618222101%2C%22z%22%3A33.70077275818966%2C%22target%22%3A%7B%22x%22%3A0%2C%22y%22%3A0%2C%22z%22%3A0%7D%7D%2C%22folder%22%3A%22closed%22%2C%22compress%22%3Afalse%7D">open in mm</a>):</p>

<p><img src="https://pytorch.org/assets/images/inside-the-matrix/initial.jpg" alt="wrap the matmul around a cube"></p>

<p>When we wrap the matmul around a cube this way, the correct relationships between argument shapes, result shape and shared dimensions all fall into place.</p>

<p>Now the computation makes <em>geometric sense</em>: each location <code>i, j</code> in the result matrix anchors a vector running along the depth dimension <code>k</code> in the cube’s interior, where the horizontal plane extending from row <code>i</code> in <code>L</code> and a vertical plane extending from column <code>j</code> in <code>R</code> intersect. Along this vector, pairs of <code>(i, k)</code> <code>(k, j)</code> elements from the left and right arguments meet and are multiplied, and the resulting products are summed along <code>k</code> and the result is deposited in location <code>i, j</code> of the result.</p>

<p>(Jumping ahead momentarily, <a href="https://bhosmer.github.io/mm/index.html?params=%7B%22expr%22%3A%22L%20%40%20R%22%2C%22name%22%3A%22L%20%40%20R%22%2C%22epilog%22%3A%22none%22%2C%22left%22%3A%7B%22name%22%3A%22L%22%2C%22matmul%22%3Afalse%2C%22h%22%3A32%2C%22w%22%3A24%2C%22init%22%3A%22expr%22%2C%22url%22%3A%22%22%2C%22min%22%3A-1%2C%22max%22%3A1%2C%22dropout%22%3A0%2C%22expr%22%3A%22-2%20*%20(Math.trunc(i%20%2F%208)%20%25%202)%20%2B%201%22%2C%22folder%22%3A%22open%22%7D%2C%22right%22%3A%7B%22name%22%3A%22R%22%2C%22matmul%22%3Afalse%2C%22h%22%3A24%2C%22w%22%3A32%2C%22init%22%3A%22expr%22%2C%22url%22%3A%22%22%2C%22min%22%3A-1%2C%22max%22%3A1%2C%22dropout%22%3A0%2C%22expr%22%3A%22-2%20*%20(Math.trunc(j%20%2F%208)%20%25%202)%20%2B%201%22%2C%22folder%22%3A%22open%22%7D%2C%22anim%22%3A%7B%22fuse%22%3A%22none%22%2C%22speed%22%3A48%2C%22hide%20inputs%22%3Afalse%2C%22alg%22%3A%22dotprod%20(row%20major)%22%2C%22spin%22%3A0%2C%22folder%22%3A%22open%22%7D%2C%22block%22%3A%7B%22i%20blocks%22%3A1%2C%22j%20blocks%22%3A1%2C%22k%20blocks%22%3A1%7D%2C%22layout%22%3A%7B%22scheme%22%3A%22blocks%22%2C%22gap%22%3A5%2C%22scatter%22%3A0%2C%22molecule%22%3A1%2C%22blast%22%3A0%2C%22polarity%22%3A%22negative%22%2C%22left%20placement%22%3A%22left%22%2C%22right%20placement%22%3A%22top%22%2C%22result%20placement%22%3A%22front%22%2C%22folder%22%3A%22open%22%7D%2C%22deco%22%3A%7B%22legends%22%3A6%2C%22shape%22%3Atrue%2C%22spotlight%22%3A2%2C%22row%20guides%22%3A1%2C%22flow%20guides%22%3A0.5%2C%22lens%20size%22%3A0.5%2C%22magnification%22%3A10%2C%22interior%20spotlight%22%3Afalse%2C%22axes%22%3Afalse%2C%22folder%22%3A%22closed%22%7D%2C%22viz%22%3A%7B%22sensitivity%22%3A%22semilocal%22%2C%22min%20size%22%3A0.196%2C%22min%20light%22%3A0.4%2C%22max%20light%22%3A0.6%2C%22elem%20scale%22%3A1%2C%22zero%20hue%22%3A0.77%2C%22hue%20gap%22%3A0.74%2C%22hue%20spread%22%3A0.04%2C%22folder%22%3A%22open%22%7D%2C%22diag%22%3A%7B%22url%22%3A%22%22%7D%2C%22cam%22%3A%7B%22x%22%3A-54.145594172414235%2C%22y%22%3A48.55110882721702%2C%22z%22%3A37.42031544768185%2C%22target%22%3A%7B%22x%22%3A0%2C%22y%22%3A0%2C%22z%22%3A0%7D%7D%2C%22folder%22%3A%22closed%22%2C%22compress%22%3Afalse%7D">here’s an animation</a>.)</p>

<p>This is the <em>intuitive</em> meaning of matrix multiplication:</p>

<ol>
  <li><strong>project</strong> two orthogonal matrices into the interior of a cube</li>
  <li><strong>multiply</strong> the pair of values at each intersection, forming a grid of products</li>
  <li><strong>sum</strong> along the third orthogonal dimension to produce a result matrix.</li>
</ol>

<p>For orientation, the tool displays an arrow in the cube’s interior that points towards the result matrix, with a blue vane coming from the left argument and a <strong>r</strong>ed vane coming from the <strong>r</strong>ight argument. The tool also displays white guidelines to indicate the row axis of each matrix, though they’re faint in this screenshot.</p>

<p>The layout constraints are straightforward:</p>

<ul>
  <li>left argument and result must be adjoined along their shared <strong>height</strong> (i) dimension</li>
  <li>right argument and result must be adjoined along their shared <strong>width</strong> (j) dimension</li>
  <li>left and right arguments must be adjoined along their shared (left width/right height) dimension, which becomes the matmul’s <strong>depth</strong> (k) dimension</li>
</ul>

<p>This geometry gives us a solid foundation for visualizing all the standard matmul decompositions, and an intuitive basis for exploring nontrivially complex <em>compositions</em> of matmuls, as we’ll see below.</p>

<h2 id="2-warmup---animations">2 Warmup - animations</h2>

<p>Before diving into some more complex examples, we’ll run through a few intuition builders to get a feel for how things look and feel in this style of visualization.</p>

<h3 id="2a-dot-product">2a Dot product</h3>

<p>First, the canonical algorithm - computing each result element by taking the dot product of the corresponding left row and right column. What we see in the animation is the sweep of multiplied value vectors through the cube’s interior, each delivering a summed result at the corresponding position.</p>

<p>Here, <code>L</code> has blocks of rows filled with 1 (blue) or -1 (red); <code>R</code> has column blocks filled similarly. <code>k</code> is 24 here, so the result matrix (<code>L @ R</code>) has blue values of 24 and red values of -24 (<a href="https://bhosmer.github.io/mm/index.html?params=%7B%22expr%22%3A%22L%20%40%20R%22%2C%22name%22%3A%22L%20%40%20R%22%2C%22epilog%22%3A%22none%22%2C%22left%22%3A%7B%22name%22%3A%22L%22%2C%22matmul%22%3Afalse%2C%22h%22%3A32%2C%22w%22%3A24%2C%22init%22%3A%22expr%22%2C%22url%22%3A%22%22%2C%22min%22%3A-1%2C%22max%22%3A1%2C%22dropout%22%3A0%2C%22expr%22%3A%22-2%20*%20(Math.trunc(i%20%2F%208)%20%25%202)%20%2B%201%22%2C%22folder%22%3A%22open%22%7D%2C%22right%22%3A%7B%22name%22%3A%22R%22%2C%22matmul%22%3Afalse%2C%22h%22%3A24%2C%22w%22%3A32%2C%22init%22%3A%22expr%22%2C%22url%22%3A%22%22%2C%22min%22%3A-1%2C%22max%22%3A1%2C%22dropout%22%3A0%2C%22expr%22%3A%22-2%20*%20(Math.trunc(j%20%2F%208)%20%25%202)%20%2B%201%22%2C%22folder%22%3A%22open%22%7D%2C%22anim%22%3A%7B%22fuse%22%3A%22none%22%2C%22speed%22%3A48%2C%22hide%20inputs%22%3Afalse%2C%22alg%22%3A%22dotprod%20(row%20major)%22%2C%22spin%22%3A0%2C%22folder%22%3A%22open%22%7D%2C%22block%22%3A%7B%22i%20blocks%22%3A1%2C%22j%20blocks%22%3A1%2C%22k%20blocks%22%3A1%7D%2C%22layout%22%3A%7B%22scheme%22%3A%22blocks%22%2C%22gap%22%3A5%2C%22scatter%22%3A0%2C%22molecule%22%3A1%2C%22blast%22%3A0%2C%22polarity%22%3A%22negative%22%2C%22left%20placement%22%3A%22left%22%2C%22right%20placement%22%3A%22top%22%2C%22result%20placement%22%3A%22front%22%2C%22folder%22%3A%22open%22%7D%2C%22deco%22%3A%7B%22legends%22%3A6%2C%22shape%22%3Atrue%2C%22spotlight%22%3A2%2C%22row%20guides%22%3A1%2C%22flow%20guides%22%3A0.5%2C%22lens%20size%22%3A0.5%2C%22magnification%22%3A10%2C%22interior%20spotlight%22%3Afalse%2C%22axes%22%3Afalse%2C%22folder%22%3A%22closed%22%7D%2C%22viz%22%3A%7B%22sensitivity%22%3A%22semilocal%22%2C%22min%20size%22%3A0.196%2C%22min%20light%22%3A0.4%2C%22max%20light%22%3A0.6%2C%22elem%20scale%22%3A1%2C%22zero%20hue%22%3A0.77%2C%22hue%20gap%22%3A0.74%2C%22hue%20spread%22%3A0.04%2C%22folder%22%3A%22open%22%7D%2C%22diag%22%3A%7B%22url%22%3A%22%22%7D%2C%22cam%22%3A%7B%22x%22%3A-54.145594172414235%2C%22y%22%3A48.55110882721702%2C%22z%22%3A37.42031544768185%2C%22target%22%3A%7B%22x%22%3A0%2C%22y%22%3A0%2C%22z%22%3A0%7D%7D%2C%22folder%22%3A%22closed%22%2C%22compress%22%3Afalse%7D">open in mm</a> - long click or control-click to inspect values):</p>



<h3 id="2b-matrix-vector-products">2b Matrix-vector products</h3>

<p>A matmul decomposed into matrix-vector products looks like a vertical plane (a product of the left argument with each column of the right argument) painting columns onto the result as it sweeps horizontally through the cube’s interior (<a href="https://bhosmer.github.io/mm/index.html?params=%7B%22expr%22%3A%22L%20%40%20R%22%2C%22name%22%3A%22L%20%40%20R%22%2C%22epilog%22%3A%22none%22%2C%22left%22%3A%7B%22name%22%3A%22L%22%2C%22matmul%22%3Afalse%2C%22h%22%3A32%2C%22w%22%3A24%2C%22init%22%3A%22expr%22%2C%22url%22%3A%22%22%2C%22min%22%3A-1%2C%22max%22%3A1%2C%22dropout%22%3A0%2C%22expr%22%3A%22-2%20*%20(Math.trunc(i%20%2F%208)%20%25%202)%20%2B%201%22%2C%22folder%22%3A%22closed%22%7D%2C%22right%22%3A%7B%22name%22%3A%22R%22%2C%22matmul%22%3Afalse%2C%22h%22%3A24%2C%22w%22%3A32%2C%22init%22%3A%22expr%22%2C%22url%22%3A%22%22%2C%22min%22%3A-1%2C%22max%22%3A1%2C%22dropout%22%3A0%2C%22expr%22%3A%22-2%20*%20(Math.trunc(j%20%2F%208)%20%25%202)%20%2B%201%22%2C%22folder%22%3A%22closed%22%7D%2C%22anim%22%3A%7B%22fuse%22%3A%22none%22%2C%22speed%22%3A12%2C%22hide%20inputs%22%3Afalse%2C%22alg%22%3A%22mvprod%22%2C%22spin%22%3A0%2C%22folder%22%3A%22open%22%7D%2C%22block%22%3A%7B%22i%20blocks%22%3A1%2C%22j%20blocks%22%3A1%2C%22k%20blocks%22%3A1%7D%2C%22layout%22%3A%7B%22scheme%22%3A%22blocks%22%2C%22gap%22%3A5%2C%22scatter%22%3A0%2C%22molecule%22%3A1%2C%22blast%22%3A0%2C%22polarity%22%3A%22negative%22%2C%22left%20placement%22%3A%22left%22%2C%22right%20placement%22%3A%22top%22%2C%22result%20placement%22%3A%22front%22%2C%22folder%22%3A%22open%22%7D%2C%22deco%22%3A%7B%22legends%22%3A6%2C%22shape%22%3Atrue%2C%22spotlight%22%3A2%2C%22row%20guides%22%3A1%2C%22flow%20guides%22%3A0.5%2C%22lens%20size%22%3A0.5%2C%22magnification%22%3A10%2C%22interior%20spotlight%22%3Afalse%2C%22axes%22%3Afalse%2C%22folder%22%3A%22closed%22%7D%2C%22viz%22%3A%7B%22sensitivity%22%3A%22semilocal%22%2C%22min%20size%22%3A0.196%2C%22min%20light%22%3A0.4%2C%22max%20light%22%3A0.6%2C%22elem%20scale%22%3A1%2C%22zero%20hue%22%3A0.77%2C%22hue%20gap%22%3A0.74%2C%22hue%20spread%22%3A0.04%2C%22folder%22%3A%22open%22%7D%2C%22diag%22%3A%7B%22url%22%3A%22%22%7D%2C%22cam%22%3A%7B%22x%22%3A-54.145594172414235%2C%22y%22%3A48.55110882721702%2C%22z%22%3A37.42031544768185%2C%22target%22%3A%7B%22x%22%3A0%2C%22y%22%3A0%2C%22z%22%3A0%7D%7D%2C%22folder%22%3A%22closed%22%2C%22compress%22%3Afalse%7D">open in mm</a>):</p>



<p>Observing the intermediate values of a decomposition can be quite interesting, even in simple examples.</p>

<p>For instance, note the prominent vertical patterns in the intermediate matrix-vector products when we use randomly initialized arguments- reflecting the fact that each intermediate is a column-scaled replica of the left argument (<a href="https://bhosmer.github.io/mm/index.html?params=%7B%22expr%22%3A%22L%20%40%20R%22%2C%22name%22%3A%22L%20%40%20R%22%2C%22epilog%22%3A%22none%22%2C%22left%22%3A%7B%22name%22%3A%22L%22%2C%22matmul%22%3Afalse%2C%22h%22%3A32%2C%22w%22%3A24%2C%22init%22%3A%22gaussian%22%2C%22url%22%3A%22%22%2C%22min%22%3A-1%2C%22max%22%3A1%2C%22dropout%22%3A0%2C%22expr%22%3A%22(-Math.trunc(i%20%2F%208)%20%25%202)%20%2B%20.5%22%2C%22folder%22%3A%22open%22%7D%2C%22right%22%3A%7B%22name%22%3A%22R%22%2C%22matmul%22%3Afalse%2C%22h%22%3A24%2C%22w%22%3A32%2C%22init%22%3A%22gaussian%22%2C%22url%22%3A%22%22%2C%22min%22%3A-1%2C%22max%22%3A1%2C%22dropout%22%3A0%2C%22expr%22%3A%22(-Math.trunc(j%20%2F%208)%20%25%202)%20%2B%20.5%22%2C%22folder%22%3A%22open%22%7D%2C%22anim%22%3A%7B%22fuse%22%3A%22none%22%2C%22speed%22%3A6%2C%22hide%20inputs%22%3Afalse%2C%22alg%22%3A%22mvprod%22%2C%22spin%22%3A0%2C%22folder%22%3A%22open%22%7D%2C%22block%22%3A%7B%22i%20blocks%22%3A1%2C%22j%20blocks%22%3A1%2C%22k%20blocks%22%3A1%7D%2C%22layout%22%3A%7B%22scheme%22%3A%22blocks%22%2C%22gap%22%3A5%2C%22scatter%22%3A0%2C%22molecule%22%3A1%2C%22blast%22%3A0%2C%22polarity%22%3A%22negative%22%2C%22left%20placement%22%3A%22left%22%2C%22right%20placement%22%3A%22top%22%2C%22result%20placement%22%3A%22front%22%2C%22folder%22%3A%22open%22%7D%2C%22deco%22%3A%7B%22legends%22%3A6%2C%22shape%22%3Atrue%2C%22spotlight%22%3A2%2C%22row%20guides%22%3A1%2C%22flow%20guides%22%3A0%2C%22lens%20size%22%3A0.5%2C%22magnification%22%3A10%2C%22interior%20spotlight%22%3Afalse%2C%22axes%22%3Afalse%2C%22folder%22%3A%22open%22%7D%2C%22viz%22%3A%7B%22sensitivity%22%3A%22local%22%2C%22min%20size%22%3A0.196%2C%22min%20light%22%3A0.4%2C%22max%20light%22%3A0.6%2C%22elem%20scale%22%3A1%2C%22zero%20hue%22%3A0.77%2C%22hue%20gap%22%3A0.74%2C%22hue%20spread%22%3A0.04%2C%22folder%22%3A%22open%22%7D%2C%22diag%22%3A%7B%22url%22%3A%22%22%7D%2C%22cam%22%3A%7B%22x%22%3A-54.14559417241423%2C%22y%22%3A48.55110882721702%2C%22z%22%3A37.42031544768186%2C%22target%22%3A%7B%22x%22%3A0%2C%22y%22%3A0%2C%22z%22%3A0%7D%7D%2C%22folder%22%3A%22closed%22%2C%22compress%22%3Afalse%7D">open in mm</a>):</p>



<h3 id="2c-vector-matrix-products">2c Vector-matrix products</h3>

<p>A matmul decomposed into vector-matrix products looks like a horizontal plane painting rows onto the result as it descends through the cube’s interior (<a href="https://bhosmer.github.io/mm/index.html?params=%7B%22expr%22%3A%22L%20%40%20R%22%2C%22name%22%3A%22L%20%40%20R%22%2C%22epilog%22%3A%22none%22%2C%22left%22%3A%7B%22name%22%3A%22L%22%2C%22matmul%22%3Afalse%2C%22h%22%3A32%2C%22w%22%3A24%2C%22init%22%3A%22expr%22%2C%22url%22%3A%22%22%2C%22min%22%3A-1%2C%22max%22%3A1%2C%22dropout%22%3A0%2C%22expr%22%3A%22-2%20*%20(Math.trunc(i%20%2F%208)%20%25%202)%20%2B%201%22%2C%22folder%22%3A%22closed%22%7D%2C%22right%22%3A%7B%22name%22%3A%22R%22%2C%22matmul%22%3Afalse%2C%22h%22%3A24%2C%22w%22%3A32%2C%22init%22%3A%22expr%22%2C%22url%22%3A%22%22%2C%22min%22%3A-1%2C%22max%22%3A1%2C%22dropout%22%3A0%2C%22expr%22%3A%22-2%20*%20(Math.trunc(j%20%2F%208)%20%25%202)%20%2B%201%22%2C%22folder%22%3A%22closed%22%7D%2C%22anim%22%3A%7B%22fuse%22%3A%22none%22%2C%22speed%22%3A12%2C%22hide%20inputs%22%3Afalse%2C%22alg%22%3A%22vmprod%22%2C%22spin%22%3A0%2C%22folder%22%3A%22open%22%7D%2C%22block%22%3A%7B%22i%20blocks%22%3A1%2C%22j%20blocks%22%3A1%2C%22k%20blocks%22%3A1%7D%2C%22layout%22%3A%7B%22scheme%22%3A%22blocks%22%2C%22gap%22%3A5%2C%22scatter%22%3A0%2C%22molecule%22%3A1%2C%22blast%22%3A0%2C%22polarity%22%3A%22negative%22%2C%22left%20placement%22%3A%22left%22%2C%22right%20placement%22%3A%22top%22%2C%22result%20placement%22%3A%22front%22%2C%22folder%22%3A%22open%22%7D%2C%22deco%22%3A%7B%22legends%22%3A6%2C%22shape%22%3Atrue%2C%22spotlight%22%3A2%2C%22row%20guides%22%3A1%2C%22flow%20guides%22%3A0.5%2C%22lens%20size%22%3A0.5%2C%22magnification%22%3A10%2C%22interior%20spotlight%22%3Afalse%2C%22axes%22%3Afalse%2C%22folder%22%3A%22closed%22%7D%2C%22viz%22%3A%7B%22sensitivity%22%3A%22semilocal%22%2C%22min%20size%22%3A0.196%2C%22min%20light%22%3A0.4%2C%22max%20light%22%3A0.6%2C%22elem%20scale%22%3A1%2C%22zero%20hue%22%3A0.77%2C%22hue%20gap%22%3A0.74%2C%22hue%20spread%22%3A0.04%2C%22folder%22%3A%22open%22%7D%2C%22diag%22%3A%7B%22url%22%3A%22%22%7D%2C%22cam%22%3A%7B%22x%22%3A-54.145594172414235%2C%22y%22%3A48.55110882721702%2C%22z%22%3A37.42031544768185%2C%22target%22%3A%7B%22x%22%3A0%2C%22y%22%3A0%2C%22z%22%3A0%7D%7D%2C%22folder%22%3A%22closed%22%2C%22compress%22%3Afalse%7D">open in mm</a>):</p>



<p>Switching to randomly initialized arguments, we see patterns analogous to those we saw with matrix-vector products - only this time the patterns are horizontal, corresponding to the fact that each intermediate vector-matrix product is a row-scaled replica of the right argument.</p>

<p>When thinking about how matmuls express the rank and structure of their arguments, it’s useful to envision both of these patterns happening simultaneously in the computation (<a href="https://bhosmer.github.io/mm/index.html?params=%7B%22expr%22%3A%22L%20%40%20R%22%2C%22name%22%3A%22L%20%40%20R%22%2C%22epilog%22%3A%22none%22%2C%22left%22%3A%7B%22name%22%3A%22L%22%2C%22matmul%22%3Afalse%2C%22h%22%3A32%2C%22w%22%3A24%2C%22init%22%3A%22gaussian%22%2C%22url%22%3A%22%22%2C%22min%22%3A-1%2C%22max%22%3A1%2C%22dropout%22%3A0%2C%22expr%22%3A%22(-Math.trunc(i%20%2F%208)%20%25%202)%20%2B%20.5%22%2C%22folder%22%3A%22open%22%7D%2C%22right%22%3A%7B%22name%22%3A%22R%22%2C%22matmul%22%3Afalse%2C%22h%22%3A24%2C%22w%22%3A32%2C%22init%22%3A%22gaussian%22%2C%22url%22%3A%22%22%2C%22min%22%3A-1%2C%22max%22%3A1%2C%22dropout%22%3A0%2C%22expr%22%3A%22(-Math.trunc(j%20%2F%208)%20%25%202)%20%2B%20.5%22%2C%22folder%22%3A%22open%22%7D%2C%22anim%22%3A%7B%22fuse%22%3A%22none%22%2C%22speed%22%3A6%2C%22hide%20inputs%22%3Afalse%2C%22alg%22%3A%22vmprod%22%2C%22spin%22%3A0%2C%22folder%22%3A%22open%22%7D%2C%22block%22%3A%7B%22i%20blocks%22%3A1%2C%22j%20blocks%22%3A1%2C%22k%20blocks%22%3A1%7D%2C%22layout%22%3A%7B%22scheme%22%3A%22blocks%22%2C%22gap%22%3A5%2C%22scatter%22%3A0%2C%22molecule%22%3A1%2C%22blast%22%3A0%2C%22polarity%22%3A%22negative%22%2C%22left%20placement%22%3A%22left%22%2C%22right%20placement%22%3A%22top%22%2C%22result%20placement%22%3A%22front%22%2C%22folder%22%3A%22open%22%7D%2C%22deco%22%3A%7B%22legends%22%3A6%2C%22shape%22%3Atrue%2C%22spotlight%22%3A2%2C%22row%20guides%22%3A1%2C%22flow%20guides%22%3A0%2C%22lens%20size%22%3A0.5%2C%22magnification%22%3A10%2C%22interior%20spotlight%22%3Afalse%2C%22axes%22%3Afalse%2C%22folder%22%3A%22open%22%7D%2C%22viz%22%3A%7B%22sensitivity%22%3A%22local%22%2C%22min%20size%22%3A0.196%2C%22min%20light%22%3A0.4%2C%22max%20light%22%3A0.6%2C%22elem%20scale%22%3A1%2C%22zero%20hue%22%3A0.77%2C%22hue%20gap%22%3A0.74%2C%22hue%20spread%22%3A0.04%2C%22folder%22%3A%22open%22%7D%2C%22diag%22%3A%7B%22url%22%3A%22%22%7D%2C%22cam%22%3A%7B%22x%22%3A-54.14559417241423%2C%22y%22%3A48.55110882721702%2C%22z%22%3A37.42031544768186%2C%22target%22%3A%7B%22x%22%3A0%2C%22y%22%3A0%2C%22z%22%3A0%7D%7D%2C%22folder%22%3A%22closed%22%2C%22compress%22%3Afalse%7D">open in mm</a>):</p>



<p>Here’s one more intuition builder using vector-matrix products, showing how the identity matrix functions exactly like a mirror set at a 45deg angle to both its counterargument and the result (<a href="https://bhosmer.github.io/mm/index.html?params=%7B%22expr%22%3A%22L%20%40%20R%22%2C%22name%22%3A%22L%20%40%20R%22%2C%22epilog%22%3A%22none%22%2C%22left%22%3A%7B%22name%22%3A%22L%22%2C%22matmul%22%3Afalse%2C%22h%22%3A24%2C%22w%22%3A24%2C%22init%22%3A%22eye%22%2C%22url%22%3A%22%22%2C%22min%22%3A-1%2C%22max%22%3A1%2C%22dropout%22%3A0%2C%22expr%22%3A%22(-Math.trunc(i%20%2F%208)%20%25%202)%20%2B%20.5%22%2C%22folder%22%3A%22open%22%7D%2C%22right%22%3A%7B%22name%22%3A%22R%22%2C%22matmul%22%3Afalse%2C%22h%22%3A24%2C%22w%22%3A32%2C%22init%22%3A%22row%20major%22%2C%22url%22%3A%22%22%2C%22min%22%3A-1%2C%22max%22%3A1%2C%22dropout%22%3A0%2C%22expr%22%3A%22(-Math.trunc(j%20%2F%208)%20%25%202)%20%2B%20.5%22%2C%22folder%22%3A%22open%22%7D%2C%22anim%22%3A%7B%22fuse%22%3A%22none%22%2C%22speed%22%3A12%2C%22hide%20inputs%22%3Afalse%2C%22alg%22%3A%22vmprod%22%2C%22spin%22%3A0%2C%22folder%22%3A%22open%22%7D%2C%22block%22%3A%7B%22i%20blocks%22%3A1%2C%22j%20blocks%22%3A1%2C%22k%20blocks%22%3A1%7D%2C%22layout%22%3A%7B%22scheme%22%3A%22blocks%22%2C%22gap%22%3A5%2C%22scatter%22%3A0%2C%22molecule%22%3A1%2C%22blast%22%3A0%2C%22polarity%22%3A%22negative%22%2C%22left%20placement%22%3A%22left%22%2C%22right%20placement%22%3A%22top%22%2C%22result%20placement%22%3A%22front%22%2C%22folder%22%3A%22open%22%7D%2C%22deco%22%3A%7B%22legends%22%3A6%2C%22shape%22%3Atrue%2C%22spotlight%22%3A2%2C%22row%20guides%22%3A1%2C%22flow%20guides%22%3A0%2C%22lens%20size%22%3A0.5%2C%22magnification%22%3A10%2C%22interior%20spotlight%22%3Afalse%2C%22axes%22%3Afalse%2C%22folder%22%3A%22open%22%7D%2C%22viz%22%3A%7B%22sensitivity%22%3A%22local%22%2C%22min%20size%22%3A0.196%2C%22min%20light%22%3A0.4%2C%22max%20light%22%3A0.6%2C%22elem%20scale%22%3A1%2C%22zero%20hue%22%3A0.77%2C%22hue%20gap%22%3A0.74%2C%22hue%20spread%22%3A0.04%2C%22folder%22%3A%22open%22%7D%2C%22diag%22%3A%7B%22url%22%3A%22%22%7D%2C%22cam%22%3A%7B%22x%22%3A-50.560896320538845%2C%22y%22%3A45.336792719337595%2C%22z%22%3A34.94291121097398%7D%2C%22folder%22%3A%22closed%22%2C%22compress%22%3Afalse%7D">open in mm</a>):</p>



<h3 id="2d-summed-outer-products">2d Summed outer products</h3>

<p>The third planar decomposition is along the <code>k</code> axis, computing the matmul result by a pointwise summation of vector outer products. Here we see the plane of outer products sweeping the cube “from back to front”, accumulating into the result (<a href="https://bhosmer.github.io/mm/index.html?params=%7B%22expr%22%3A%22L%20%40%20R%22%2C%22name%22%3A%22L%20%40%20R%22%2C%22epilog%22%3A%22none%22%2C%22left%22%3A%7B%22name%22%3A%22L%22%2C%22matmul%22%3Afalse%2C%22h%22%3A32%2C%22w%22%3A24%2C%22init%22%3A%22expr%22%2C%22url%22%3A%22%22%2C%22min%22%3A-1%2C%22max%22%3A1%2C%22dropout%22%3A0%2C%22expr%22%3A%22-2%20*%20(Math.trunc(i%20%2F%208)%20%25%202)%20%2B%201%22%2C%22folder%22%3A%22closed%22%7D%2C%22right%22%3A%7B%22name%22%3A%22R%22%2C%22matmul%22%3Afalse%2C%22h%22%3A24%2C%22w%22%3A32%2C%22init%22%3A%22expr%22%2C%22url%22%3A%22%22%2C%22min%22%3A-1%2C%22max%22%3A1%2C%22dropout%22%3A0%2C%22expr%22%3A%22-2%20*%20(Math.trunc(j%20%2F%208)%20%25%202)%20%2B%201%22%2C%22folder%22%3A%22closed%22%7D%2C%22anim%22%3A%7B%22fuse%22%3A%22none%22%2C%22speed%22%3A12%2C%22hide%20inputs%22%3Afalse%2C%22alg%22%3A%22vvprod%22%2C%22spin%22%3A0%2C%22folder%22%3A%22open%22%7D%2C%22block%22%3A%7B%22i%20blocks%22%3A1%2C%22j%20blocks%22%3A1%2C%22k%20blocks%22%3A1%7D%2C%22layout%22%3A%7B%22scheme%22%3A%22blocks%22%2C%22gap%22%3A5%2C%22scatter%22%3A0%2C%22molecule%22%3A1%2C%22blast%22%3A0%2C%22polarity%22%3A%22negative%22%2C%22left%20placement%22%3A%22left%22%2C%22right%20placement%22%3A%22top%22%2C%22result%20placement%22%3A%22front%22%2C%22folder%22%3A%22open%22%7D%2C%22deco%22%3A%7B%22legends%22%3A6%2C%22shape%22%3Atrue%2C%22spotlight%22%3A2%2C%22row%20guides%22%3A1%2C%22flow%20guides%22%3A0.5%2C%22lens%20size%22%3A0.5%2C%22magnification%22%3A10%2C%22interior%20spotlight%22%3Afalse%2C%22axes%22%3Afalse%2C%22folder%22%3A%22closed%22%7D%2C%22viz%22%3A%7B%22sensitivity%22%3A%22semilocal%22%2C%22min%20size%22%3A0.196%2C%22min%20light%22%3A0.4%2C%22max%20light%22%3A0.6%2C%22elem%20scale%22%3A1%2C%22zero%20hue%22%3A0.77%2C%22hue%20gap%22%3A0.74%2C%22hue%20spread%22%3A0.04%2C%22folder%22%3A%22open%22%7D%2C%22diag%22%3A%7B%22url%22%3A%22%22%7D%2C%22cam%22%3A%7B%22x%22%3A-54.145594172414235%2C%22y%22%3A48.55110882721702%2C%22z%22%3A37.42031544768185%2C%22target%22%3A%7B%22x%22%3A0%2C%22y%22%3A0%2C%22z%22%3A0%7D%7D%2C%22folder%22%3A%22closed%22%2C%22compress%22%3Afalse%7D">open in mm</a>):</p>



<p>Using randomly initialized matrices with this decomposition, we can see not just values but <em>rank</em> accumulate in the result, as each rank-1 outer product is added to it.</p>

<p>Among other things this builds intuition for why “low-rank factorization” - i.e. approximating a matrix by constructing a matmul whose arguments are small in the depth dimension - works best when the matrix being approximated is low rank. <a href="https://arxiv.org/pdf/2106.09685.pdf">LoRA</a> in a later section (<a href="https://bhosmer.github.io/mm/index.html?params=%7B%22expr%22%3A%22L%20%40%20R%22%2C%22name%22%3A%22L%20%40%20R%22%2C%22epilog%22%3A%22none%22%2C%22left%22%3A%7B%22name%22%3A%22L%22%2C%22matmul%22%3Afalse%2C%22h%22%3A32%2C%22w%22%3A24%2C%22init%22%3A%22gaussian%22%2C%22url%22%3A%22%22%2C%22min%22%3A-1%2C%22max%22%3A1%2C%22dropout%22%3A0%2C%22expr%22%3A%22(-Math.trunc(i%20%2F%208)%20%25%202)%20%2B%20.5%22%2C%22folder%22%3A%22closed%22%7D%2C%22right%22%3A%7B%22name%22%3A%22R%22%2C%22matmul%22%3Afalse%2C%22h%22%3A24%2C%22w%22%3A32%2C%22init%22%3A%22gaussian%22%2C%22url%22%3A%22%22%2C%22min%22%3A-1%2C%22max%22%3A1%2C%22dropout%22%3A0%2C%22expr%22%3A%22(-Math.trunc(j%20%2F%208)%20%25%202)%20%2B%20.5%22%2C%22folder%22%3A%22closed%22%7D%2C%22anim%22%3A%7B%22fuse%22%3A%22none%22%2C%22speed%22%3A6%2C%22hide%20inputs%22%3Afalse%2C%22alg%22%3A%22vvprod%22%2C%22spin%22%3A0%2C%22folder%22%3A%22open%22%7D%2C%22block%22%3A%7B%22i%20blocks%22%3A1%2C%22j%20blocks%22%3A1%2C%22k%20blocks%22%3A1%7D%2C%22layout%22%3A%7B%22scheme%22%3A%22blocks%22%2C%22gap%22%3A5%2C%22scatter%22%3A0%2C%22molecule%22%3A1%2C%22blast%22%3A0%2C%22polarity%22%3A%22negative%22%2C%22left%20placement%22%3A%22left%22%2C%22right%20placement%22%3A%22top%22%2C%22result%20placement%22%3A%22front%22%2C%22folder%22%3A%22open%22%7D%2C%22deco%22%3A%7B%22legends%22%3A6%2C%22shape%22%3Atrue%2C%22spotlight%22%3A2%2C%22row%20guides%22%3A1%2C%22flow%20guides%22%3A0%2C%22lens%20size%22%3A0.5%2C%22magnification%22%3A10%2C%22interior%20spotlight%22%3Afalse%2C%22axes%22%3Afalse%2C%22folder%22%3A%22open%22%7D%2C%22viz%22%3A%7B%22sensitivity%22%3A%22local%22%2C%22min%20size%22%3A0.196%2C%22min%20light%22%3A0.4%2C%22max%20light%22%3A0.6%2C%22elem%20scale%22%3A1%2C%22zero%20hue%22%3A0.77%2C%22hue%20gap%22%3A0.74%2C%22hue%20spread%22%3A0.04%2C%22folder%22%3A%22open%22%7D%2C%22diag%22%3A%7B%22url%22%3A%22%22%7D%2C%22cam%22%3A%7B%22x%22%3A-54.14559417241423%2C%22y%22%3A48.55110882721702%2C%22z%22%3A37.42031544768186%2C%22target%22%3A%7B%22x%22%3A0%2C%22y%22%3A0%2C%22z%22%3A0%7D%7D%2C%22folder%22%3A%22closed%22%2C%22compress%22%3Afalse%7D">open in mm</a>):</p>



<h2 id="3-warmup---expressions">3 Warmup - expressions</h2>

<p>How can we extend this visualization approach to <em>compositions</em> of matmuls? Our examples so far have all visualized a single matmul <code>L @ R</code> of some matrices <code>L</code> and <code>R</code> - what about when <code>L</code> and/or <code>R</code> are themselves matmuls, and so on transitively?</p>

<p>It turns out we can extend the approach nicely to compound expressions. The key rules are simple: the subexpression (child) matmul is another cube, subject to the same layout constraints as the parent, and the result face of the child is <em>simultaneously</em> the corresponding argument face of the parent, like a covalently shared electron.</p>

<p>Within these constraints, we’re free to arrange the faces of a child matmul however we like. Here we use the tool’s default scheme, which generates alternating convex and concave cubes - this layout works well in practice to maximize use of space and minimize occlusion. (Layouts are completely customizable, however - see the <a href="https://bhosmer.github.io/mm/ref.html">reference</a> for details.)</p>

<p>In this section we’ll visualize some of the key building blocks we find in ML models, to gain fluency in the visual idiom and to see what intuitions even simple examples can give us.</p>

<h3 id="3a-left-associative-expressions">3a Left-associative expressions</h3>

<p>We’ll look at two expressions of the form <code>(A @ B) @ C</code>, each with its own distinctive shape and character. (Note: mm adheres to the convention that matrix multiplication is left-associative and writes this simply as <code>A @ B @ C</code>.)</p>

<p>First we’ll give <code>A @ B @ C</code> the characteristic FFN shape, in which the “hidden dimension” is wider than the “input” or “output” dimensions. (Concretely in the context of this example, this means that the width of <code>B</code> is greater than the widths of <code>A</code> or <code>C</code>.)</p>

<p>As in the single matmul examples, the floating arrows point towards the result matrix, blue vane coming from the left argument and red vane from right argument (<a href="https://bhosmer.github.io/mm/index.html?0=A%20%40%20B%20%40%20C&amp;1=A%20%40%20B%20%40%20C&amp;2=none&amp;12=closed&amp;64=true&amp;3.1=A%20%40%20B&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row%20major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.12=open&amp;3.2=none&amp;13.1=A&amp;13.4=false&amp;13.5=64&amp;13.6=32&amp;13.7=expr&amp;13.8=&amp;13.0=-2%20*%20(Math.trunc(i%20%2F%208)%20%25%202)%20%2B%201&amp;13.9=-1&amp;13.10=1&amp;13.11=0&amp;13.12=open&amp;14.1=B&amp;14.4=false&amp;14.5=32&amp;14.6=96&amp;14.7=row%20major&amp;14.8=&amp;14.0=-2%20*%20(Math.trunc(j%20%2F%208)%20%25%202)%20%2B%201&amp;14.9=-1&amp;14.10=1&amp;14.11=0&amp;14.12=open&amp;15.16=inherit&amp;17.18=positive&amp;17.19=left&amp;17.20=bottom&amp;17.21=back&amp;22.23=1&amp;24.1=C&amp;24.4=false&amp;24.5=96&amp;24.6=32&amp;24.7=col%20major&amp;24.8=&amp;24.9=-1&amp;24.10=1&amp;24.11=0&amp;24.0=-2%20*%20(Math.trunc(i%20%2F%208)%20%25%202)%20%2B%201&amp;24.12=open&amp;25.26=none&amp;25.27=12&amp;25.28=false&amp;25.16=none&amp;25.29=0&amp;25.12=closed&amp;30.31=1&amp;30.32=1&amp;30.23=1&amp;33.34=blocks&amp;33.35=5&amp;33.36=0&amp;33.37=1&amp;33.38=0&amp;33.18=negative&amp;33.19=left&amp;33.20=top&amp;33.21=front&amp;33.12=closed&amp;39.40=6&amp;39.41=true&amp;39.42=2&amp;39.43=1&amp;39.44=0.5&amp;39.45=0.5&amp;39.46=10&amp;39.47=false&amp;39.48=false&amp;39.12=open&amp;49.50=semilocal&amp;49.51=0.2&amp;49.52=0.4&amp;49.53=0.6&amp;49.54=1.25&amp;49.55=0.77&amp;49.56=0.74&amp;49.57=0.04&amp;49.12=open&amp;58.8=&amp;59.60=-102.42301073851515&amp;59.61=96.27580041479706&amp;59.62=112.34410815468306&amp;63.60=-4.617417891034972&amp;63.61=-3.695553245058398&amp;63.62=-1.8863985145585351&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;folder=12&amp;left.left=13&amp;left.right=14&amp;left.anim=15&amp;alg=16&amp;left.layout=17&amp;polarity=18&amp;left%20placement=19&amp;right%20placement=20&amp;result%20placement=21&amp;left.block=22&amp;k%20blocks=23&amp;right=24&amp;anim=25&amp;fuse=26&amp;speed=27&amp;hide%20inputs=28&amp;spin=29&amp;block=30&amp;i%20blocks=31&amp;j%20blocks=32&amp;layout=33&amp;scheme=34&amp;gap=35&amp;scatter=36&amp;molecule=37&amp;blast=38&amp;deco=39&amp;legends=40&amp;shape=41&amp;spotlight=42&amp;row%20guides=43&amp;flow%20guides=44&amp;lens%20size=45&amp;magnification=46&amp;interior%20spotlight=47&amp;axes=48&amp;viz=49&amp;sensitivity=50&amp;min%20size=51&amp;min%20light=52&amp;max%20light=53&amp;elem%20scale=54&amp;zero%20hue=55&amp;hue%20gap=56&amp;hue%20spread=57&amp;diag=58&amp;cam=59&amp;x=60&amp;y=61&amp;z=62&amp;cam.target=63&amp;compress=64">open in mm</a>):</p>

<p><img src="https://pytorch.org/assets/images/inside-the-matrix/la2still.jpg" alt="As in the single matmul examples, the floating arrows point towards the result matrix, blue vane coming from the left argument and red vane from right argument"></p>

<p>Next we’ll visualize <code>A @ B @ C</code> with the width of <code>B</code> <em>narrower</em> than that of <code>A</code> or <code>C</code>, giving it a bottleneck or “autoencoder” shape (<a href="https://bhosmer.github.io/mm/index.html?0=A%20%40%20B%20%40%20C&amp;1=A%20%40%20B%20%40%20C&amp;2=none&amp;12=closed&amp;64=true&amp;3.1=A%20%40%20B&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row%20major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.12=open&amp;3.2=none&amp;13.1=A&amp;13.4=false&amp;13.5=64&amp;13.6=96&amp;13.7=expr&amp;13.8=&amp;13.0=-2%20*%20(Math.trunc(i%20%2F%208)%20%25%202)%20%2B%201&amp;13.9=-1&amp;13.10=1&amp;13.11=0&amp;13.12=open&amp;14.1=B&amp;14.4=false&amp;14.5=96&amp;14.6=32&amp;14.7=row%20major&amp;14.8=&amp;14.0=-2%20*%20(Math.trunc(j%20%2F%208)%20%25%202)%20%2B%201&amp;14.9=-1&amp;14.10=1&amp;14.11=0&amp;14.12=open&amp;15.16=inherit&amp;17.18=positive&amp;17.19=left&amp;17.20=bottom&amp;17.21=back&amp;22.23=1&amp;24.1=C&amp;24.4=false&amp;24.5=32&amp;24.6=96&amp;24.7=col%20major&amp;24.8=&amp;24.9=-1&amp;24.10=1&amp;24.11=0&amp;24.0=-2%20*%20(Math.trunc(i%20%2F%208)%20%25%202)%20%2B%201&amp;24.12=open&amp;25.26=none&amp;25.27=12&amp;25.28=false&amp;25.16=none&amp;25.29=0&amp;25.12=closed&amp;30.31=1&amp;30.32=1&amp;30.23=1&amp;33.34=blocks&amp;33.35=5&amp;33.36=0&amp;33.37=1&amp;33.38=0&amp;33.18=negative&amp;33.19=left&amp;33.20=top&amp;33.21=front&amp;33.12=closed&amp;39.40=6&amp;39.41=true&amp;39.42=2&amp;39.43=1&amp;39.44=0.5&amp;39.45=0.5&amp;39.46=10&amp;39.47=false&amp;39.48=false&amp;39.12=open&amp;49.50=semilocal&amp;49.51=0.2&amp;49.52=0.4&amp;49.53=0.6&amp;49.54=1.25&amp;49.55=0.77&amp;49.56=0.74&amp;49.57=0.04&amp;49.12=open&amp;58.8=&amp;59.60=-125.71162036288077&amp;59.61=101.84279252909485&amp;59.62=122.50425255743914&amp;63.60=-14.817097084822203&amp;63.61=-9.723209466639396&amp;63.62=-5.4699873376955646&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;folder=12&amp;left.left=13&amp;left.right=14&amp;left.anim=15&amp;alg=16&amp;left.layout=17&amp;polarity=18&amp;left%20placement=19&amp;right%20placement=20&amp;result%20placement=21&amp;left.block=22&amp;k%20blocks=23&amp;right=24&amp;anim=25&amp;fuse=26&amp;speed=27&amp;hide%20inputs=28&amp;spin=29&amp;block=30&amp;i%20blocks=31&amp;j%20blocks=32&amp;layout=33&amp;scheme=34&amp;gap=35&amp;scatter=36&amp;molecule=37&amp;blast=38&amp;deco=39&amp;legends=40&amp;shape=41&amp;spotlight=42&amp;row%20guides=43&amp;flow%20guides=44&amp;lens%20size=45&amp;magnification=46&amp;interior%20spotlight=47&amp;axes=48&amp;viz=49&amp;sensitivity=50&amp;min%20size=51&amp;min%20light=52&amp;max%20light=53&amp;elem%20scale=54&amp;zero%20hue=55&amp;hue%20gap=56&amp;hue%20spread=57&amp;diag=58&amp;cam=59&amp;x=60&amp;y=61&amp;z=62&amp;cam.target=63&amp;compress=64">open in mm</a>):</p>

<p><img src="https://pytorch.org/assets/images/inside-the-matrix/lacontract.jpg" alt="visualize A @ B @ C with the width of B narrower than that of A or C"></p>

<p>This pattern of alternating convex and concave blocks extends to chains of arbitrary length: for example this multilayer bottleneck (<a href="https://bhosmer.github.io/mm/index.html?0=A%20%40%20B%20%40%20C%20%40%20D%20%40%20E&amp;1=A%20%40%20B%20%40%20C%20%40%20D%20%40%20E&amp;2=none&amp;23=closed&amp;63=true&amp;3.2=none&amp;4.5=inherit&amp;6.7=1&amp;8.9=positive&amp;8.10=left&amp;8.11=bottom&amp;8.12=back&amp;13.0=A%20%40%20B%20%40%20C%20%40%20D%20%40%20E&amp;13.1=A%20%40%20B%20%40%20C&amp;13.2=none&amp;14.1=A%20%40%20B&amp;14.15=true&amp;14.16=32&amp;14.17=32&amp;14.18=row%20major&amp;14.19=&amp;14.20=-1&amp;14.21=1&amp;14.22=0&amp;14.23=open&amp;14.2=none&amp;24.1=A&amp;24.15=false&amp;24.16=64&amp;24.17=96&amp;24.18=expr&amp;24.19=&amp;24.0=-2%20*%20(Math.trunc(i%20%2F%208)%20%25%202)%20%2B%201&amp;24.20=-1&amp;24.21=1&amp;24.22=0&amp;24.23=open&amp;25.1=B&amp;25.15=false&amp;25.16=96&amp;25.17=64&amp;25.18=row%20major&amp;25.19=&amp;25.0=-2%20*%20(Math.trunc(j%20%2F%208)%20%25%202)%20%2B%201&amp;25.20=-1&amp;25.21=1&amp;25.22=0&amp;25.23=open&amp;26.5=inherit&amp;27.9=positive&amp;27.10=left&amp;27.11=bottom&amp;27.12=back&amp;28.7=1&amp;29.1=C&amp;29.15=false&amp;29.16=64&amp;29.17=32&amp;29.18=col%20major&amp;29.19=&amp;29.20=-1&amp;29.21=1&amp;29.22=0&amp;29.0=-2%20*%20(Math.trunc(i%20%2F%208)%20%25%202)%20%2B%201&amp;29.23=open&amp;30.31=none&amp;30.32=12&amp;30.33=false&amp;30.5=none&amp;30.34=0&amp;30.23=closed&amp;35.36=1&amp;35.7=1&amp;37.9=negative&amp;37.10=left&amp;37.11=top&amp;37.12=front&amp;38.39=6&amp;38.40=true&amp;38.41=2&amp;38.42=1&amp;38.43=0.5&amp;38.44=0.5&amp;38.45=10&amp;38.46=false&amp;38.47=false&amp;38.23=open&amp;48.49=semilocal&amp;48.50=0.2&amp;48.51=0.4&amp;48.52=0.6&amp;48.53=1.25&amp;48.54=0.77&amp;48.55=0.74&amp;48.56=0.04&amp;48.23=open&amp;57.19=&amp;58.59=-125.71162036288077&amp;58.60=101.84279252909485&amp;58.61=122.50425255743914&amp;62.59=-14.817097084822203&amp;62.60=-9.723209466639396&amp;62.61=-5.4699873376955646&amp;13.23=open&amp;13.63=true&amp;13.15=true&amp;64.1=D&amp;64.15=false&amp;64.16=32&amp;64.17=64&amp;64.18=col%20major&amp;64.19=&amp;64.20=-1&amp;64.21=1&amp;64.22=0&amp;64.0=&amp;64.23=open&amp;3.1=A%20%40%20B%20%40%20C%20%40%20D&amp;3.15=true&amp;65.1=E&amp;65.15=false&amp;65.16=64&amp;65.17=96&amp;65.18=col%20major&amp;65.19=&amp;65.20=-1&amp;65.21=1&amp;65.22=0&amp;65.0=&amp;66.31=none&amp;66.32=12&amp;66.33=false&amp;66.5=none&amp;66.34=0&amp;66.23=closed&amp;67.36=1&amp;67.68=1&amp;67.7=1&amp;69.70=blocks&amp;69.71=5&amp;69.72=0&amp;69.73=1&amp;69.74=0&amp;69.9=negative&amp;69.10=left&amp;69.11=top&amp;69.12=front&amp;69.23=closed&amp;75.39=5.28&amp;75.40=true&amp;75.41=2&amp;75.42=1&amp;75.43=0.5&amp;75.44=0.5&amp;75.45=10&amp;75.46=false&amp;75.47=false&amp;75.23=open&amp;76.49=semilocal&amp;76.50=0.2&amp;76.51=0.4&amp;76.52=0.6&amp;76.53=1.25&amp;76.54=0.77&amp;76.55=0.74&amp;76.56=0.04&amp;76.23=open&amp;77.19=&amp;78.59=-163.23429720087873&amp;78.60=132.20892347209139&amp;78.61=159.04014894666057&amp;79.59=-14.817097084822203&amp;79.60=-9.723209466639396&amp;79.61=-5.4699873376955646&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;left.anim=4&amp;alg=5&amp;left.block=6&amp;k%20blocks=7&amp;left.layout=8&amp;polarity=9&amp;left%20placement=10&amp;right%20placement=11&amp;result%20placement=12&amp;left.left=13&amp;left.left.left=14&amp;matmul=15&amp;h=16&amp;w=17&amp;init=18&amp;url=19&amp;min=20&amp;max=21&amp;dropout=22&amp;folder=23&amp;left.left.left.left=24&amp;left.left.left.right=25&amp;left.left.left.anim=26&amp;left.left.left.layout=27&amp;left.left.left.block=28&amp;left.left.right=29&amp;left.left.anim=30&amp;fuse=31&amp;speed=32&amp;hide%20inputs=33&amp;spin=34&amp;left.left.block=35&amp;i%20blocks=36&amp;left.left.layout=37&amp;left.left.deco=38&amp;legends=39&amp;shape=40&amp;spotlight=41&amp;row%20guides=42&amp;flow%20guides=43&amp;lens%20size=44&amp;magnification=45&amp;interior%20spotlight=46&amp;axes=47&amp;left.left.viz=48&amp;sensitivity=49&amp;min%20size=50&amp;min%20light=51&amp;max%20light=52&amp;elem%20scale=53&amp;zero%20hue=54&amp;hue%20gap=55&amp;hue%20spread=56&amp;left.left.diag=57&amp;left.left.cam=58&amp;x=59&amp;y=60&amp;z=61&amp;left.left.cam.target=62&amp;compress=63&amp;left.right=64&amp;right=65&amp;anim=66&amp;block=67&amp;j%20blocks=68&amp;layout=69&amp;scheme=70&amp;gap=71&amp;scatter=72&amp;molecule=73&amp;blast=74&amp;deco=75&amp;viz=76&amp;diag=77&amp;cam=78&amp;cam.target=79">open in mm</a>):</p>

<p><img src="https://pytorch.org/assets/images/inside-the-matrix/nlayerbottleneck.jpg" alt="pattern of alternating convex and concave blocks extends to chains of arbitrary length"></p>

<h3 id="3b-right-associative-expressions">3b Right associative expressions</h3>

<p>Next we’ll visualize a right-associative expression <code>A @ (B @ C)</code>.</p>

<p>In the same way left-associative expressions extend horizontally - sprouting from the left argument of the root expression, so to speak - right-associative chains extend vertically, sprouting from the root’s right argument.</p>

<p>One sometimes sees an MLP formulated right-associatively, i.e. with columnar input on the right and weight layers running right to left. Using the matrices from the 2-layer FFN example pictured above - suitably transposed - here’s what that looks like, with <code>C</code> now playing the role of the input, <code>B</code> the first layer and <code>A</code> the second layer (<a href="https://bhosmer.github.io/mm/index.html?0=A%20%40%20(B%20%40%20C)&amp;1=A%20%40%20(B%20%40%20C)&amp;2=none&amp;12=closed&amp;64=true&amp;3.1=A&amp;3.4=false&amp;3.5=32&amp;3.6=96&amp;3.7=row%20major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.0=-2%20*%20(Math.trunc(j%20%2F%208)%20%25%202)%20%2B%201&amp;3.12=open&amp;13.1=B%20%40%20C&amp;13.4=true&amp;13.5=32&amp;13.6=32&amp;13.7=col%20major&amp;13.8=&amp;13.9=-1&amp;13.10=1&amp;13.11=0&amp;13.2=none&amp;14.15=inherit&amp;16.17=1&amp;18.19=positive&amp;18.20=right&amp;18.21=top&amp;18.22=back&amp;23.1=B&amp;23.4=false&amp;23.5=96&amp;23.6=32&amp;23.7=col%20major&amp;23.8=&amp;23.0=-2%20*%20(Math.trunc(j%20%2F%208)%20%25%202)%20%2B%201&amp;23.9=-1&amp;23.10=1&amp;23.11=0&amp;23.12=open&amp;24.1=C&amp;24.4=false&amp;24.5=32&amp;24.6=64&amp;24.7=expr&amp;24.8=&amp;24.0=-2%20*%20(Math.trunc(j%20%2F%208)%20%25%202)%20%2B%201&amp;24.9=-1&amp;24.10=1&amp;24.11=0&amp;24.12=open&amp;13.12=open&amp;25.26=none&amp;25.27=12&amp;25.28=false&amp;25.15=none&amp;25.29=0&amp;25.12=closed&amp;30.31=1&amp;30.32=1&amp;30.17=1&amp;33.34=blocks&amp;33.35=5&amp;33.36=0&amp;33.37=1&amp;33.38=0&amp;33.19=negative&amp;33.20=left&amp;33.21=top&amp;33.22=front&amp;33.12=closed&amp;39.40=6&amp;39.41=true&amp;39.42=2&amp;39.43=1&amp;39.44=0.5&amp;39.45=0.5&amp;39.46=10&amp;39.47=false&amp;39.48=false&amp;39.12=closed&amp;49.50=semilocal&amp;49.51=0.2&amp;49.52=0.4&amp;49.53=0.6&amp;49.54=1.25&amp;49.55=0.77&amp;49.56=0.74&amp;49.57=0.04&amp;49.12=closed&amp;58.8=&amp;58.12=open&amp;59.60=-105.78213185291946&amp;59.61=96.67420268229331&amp;59.62=113.6419504179439&amp;63.60=-4.617417891034972&amp;63.61=-3.695553245058398&amp;63.62=-1.8863985145585351&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;folder=12&amp;right=13&amp;right.anim=14&amp;alg=15&amp;right.block=16&amp;k%20blocks=17&amp;right.layout=18&amp;polarity=19&amp;left%20placement=20&amp;right%20placement=21&amp;result%20placement=22&amp;right.left=23&amp;right.right=24&amp;anim=25&amp;fuse=26&amp;speed=27&amp;hide%20inputs=28&amp;spin=29&amp;block=30&amp;i%20blocks=31&amp;j%20blocks=32&amp;layout=33&amp;scheme=34&amp;gap=35&amp;scatter=36&amp;molecule=37&amp;blast=38&amp;deco=39&amp;legends=40&amp;shape=41&amp;spotlight=42&amp;row%20guides=43&amp;flow%20guides=44&amp;lens%20size=45&amp;magnification=46&amp;interior%20spotlight=47&amp;axes=48&amp;viz=49&amp;sensitivity=50&amp;min%20size=51&amp;min%20light=52&amp;max%20light=53&amp;elem%20scale=54&amp;zero%20hue=55&amp;hue%20gap=56&amp;hue%20spread=57&amp;diag=58&amp;cam=59&amp;x=60&amp;y=61&amp;z=62&amp;cam.target=63&amp;compress=64">open in mm</a>):</p>

<p><img src="https://pytorch.org/assets/images/inside-the-matrix/raffn.jpg" alt="an MLP formulated right-associatively"></p>

<p>Aside: in addition to the color of the arrow vanes (blue for left, red for right), a second visual cue for distinguishing left and right arguments is their <em>orientation</em>: the rows of the left argument are coplanar with those of the result - they stack along the same axis (<code>i</code>). Both cues tell us for example that <code>B</code> is the left argument to <code>(B @ C)</code> above.</p>

<h3 id="3c-binary-expressions">3c Binary expressions</h3>

<p>For a visualization tool to be useful beyond simple didactic examples, visualizations need to remain legible as expressions get more complicated. A key structural component in real-world use cases is binary expressions - matmuls with subexpressions on both the left and right.</p>

<p>Here we’ll visualize the simplest such expression shape, <code>(A @ B) @ (C @ D)</code> (<a href="https://bhosmer.github.io/mm/index.html?0=A%20%40%20B%20%40%20(C%20%40%20D)&amp;1=A%20%40%20B%20%40%20(C%20%40%20D)&amp;2=none&amp;12=closed&amp;69=true&amp;3.1=A%20%40%20B&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row%20major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.12=open&amp;3.2=none&amp;13.1=A&amp;13.4=false&amp;13.5=64&amp;13.6=64&amp;13.7=expr&amp;13.8=&amp;13.0=-2%20*%20(Math.trunc(i%20%2F%208)%20%25%202)%20%2B%201&amp;13.9=-1&amp;13.10=1&amp;13.11=0&amp;13.12=closed&amp;14.1=B&amp;14.4=false&amp;14.5=64&amp;14.6=64&amp;14.7=row%20major&amp;14.8=&amp;14.0=-2%20*%20(Math.trunc(j%20%2F%208)%20%25%202)%20%2B%201&amp;14.9=-1&amp;14.10=1&amp;14.11=0&amp;14.12=closed&amp;15.16=inherit&amp;17.18=positive&amp;17.19=left&amp;17.20=bottom&amp;17.21=back&amp;22.23=1&amp;24.1=C%20%40%20D&amp;24.4=true&amp;24.5=32&amp;24.6=32&amp;24.7=col%20major&amp;24.8=&amp;24.9=-1&amp;24.10=1&amp;24.11=0&amp;24.2=none&amp;25.16=inherit&amp;26.23=1&amp;27.18=positive&amp;27.19=right&amp;27.20=top&amp;27.21=back&amp;28.1=C&amp;28.4=false&amp;28.5=64&amp;28.6=64&amp;28.7=col%20major&amp;28.8=&amp;28.9=-1&amp;28.10=1&amp;28.11=0&amp;28.0=-2%20*%20(Math.trunc(i%20%2F%208)%20%25%202)%20%2B%201&amp;28.12=open&amp;29.1=D&amp;29.4=false&amp;29.5=64&amp;29.6=64&amp;29.7=expr&amp;29.8=&amp;29.9=-1&amp;29.10=1&amp;29.11=0&amp;29.0=-2%20*%20(Math.trunc(j%20%2F%208)%20%25%202)%20%2B%201&amp;29.12=open&amp;30.31=none&amp;30.32=12&amp;30.33=false&amp;30.16=none&amp;30.34=0&amp;30.12=closed&amp;35.36=1&amp;35.37=1&amp;35.23=1&amp;38.39=blocks&amp;38.40=5&amp;38.41=0&amp;38.42=1&amp;38.43=0&amp;38.18=negative&amp;38.19=left&amp;38.20=top&amp;38.21=front&amp;38.12=closed&amp;44.45=6&amp;44.46=true&amp;44.47=2&amp;44.48=1&amp;44.49=0.5&amp;44.50=0.5&amp;44.51=10&amp;44.52=false&amp;44.53=false&amp;44.12=closed&amp;54.55=semilocal&amp;54.56=0.4&amp;54.57=0.4&amp;54.58=0.6&amp;54.59=1.5&amp;54.60=0.77&amp;54.61=0.74&amp;54.62=0.04&amp;54.12=open&amp;63.8=&amp;64.65=-149.45958189074523&amp;64.66=140.76437147298853&amp;64.67=162.13832534246401&amp;68.65=-4.044017278625395&amp;68.66=-2.123834827920271&amp;68.67=-2.551083969824457&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;folder=12&amp;left.left=13&amp;left.right=14&amp;left.anim=15&amp;alg=16&amp;left.layout=17&amp;polarity=18&amp;left%20placement=19&amp;right%20placement=20&amp;result%20placement=21&amp;left.block=22&amp;k%20blocks=23&amp;right=24&amp;right.anim=25&amp;right.block=26&amp;right.layout=27&amp;right.left=28&amp;right.right=29&amp;anim=30&amp;fuse=31&amp;speed=32&amp;hide%20inputs=33&amp;spin=34&amp;block=35&amp;i%20blocks=36&amp;j%20blocks=37&amp;layout=38&amp;scheme=39&amp;gap=40&amp;scatter=41&amp;molecule=42&amp;blast=43&amp;deco=44&amp;legends=45&amp;shape=46&amp;spotlight=47&amp;row%20guides=48&amp;flow%20guides=49&amp;lens%20size=50&amp;magnification=51&amp;interior%20spotlight=52&amp;axes=53&amp;viz=54&amp;sensitivity=55&amp;min%20size=56&amp;min%20light=57&amp;max%20light=58&amp;elem%20scale=59&amp;zero%20hue=60&amp;hue%20gap=61&amp;hue%20spread=62&amp;diag=63&amp;cam=64&amp;x=65&amp;y=66&amp;z=67&amp;cam.target=68&amp;compress=69">open in mm</a>):</p>

<p><img src="https://pytorch.org/assets/images/inside-the-matrix/binary4.jpg" alt="binary expressions - matmuls with subexpressions on both the left and right"></p>

<h3 id="3d-quick-aside-partitioning-and-parallelism">3d Quick aside: partitioning and parallelism</h3>

<p>A full presentation of this topic is out of scope for this note, though we’ll see it in action later in the context of attention heads. But as a warmup, two quick examples should give a sense of how this style of visualization makes reasoning about parallelizing compound expressions very intuitive, via the simple geometry of partitioning.</p>

<p>In the first example we’ll apply the canonical “data parallel” partitioning to the left-associative multilayer bottleneck example above. We partition along <code>i</code>, segmenting the initial left argument (“batch”) and all intermediate results (“activations”), but none of the subsequent arguments (“weights”) - the geometry making it obvious which participants in the expression are segmented and which remain whole (<a href="https://bhosmer.github.io/mm/index.html?0=A%20%40%20B%20%40%20C%20%40%20D%20%40%20E&amp;1=A%20%40%20B%20%40%20C%20%40%20D%20%40%20E&amp;2=none&amp;23=closed&amp;63=true&amp;3.1=A%20%40%20B%20%40%20C%20%40%20D&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row%20major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.2=none&amp;12.13=inherit&amp;14.15=1&amp;16.17=positive&amp;16.18=left&amp;16.19=bottom&amp;16.20=back&amp;21.0=A%20%40%20B%20%40%20C%20%40%20D%20%40%20E&amp;21.1=A%20%40%20B%20%40%20C&amp;21.2=none&amp;22.1=A%20%40%20B&amp;22.4=true&amp;22.5=32&amp;22.6=32&amp;22.7=row%20major&amp;22.8=&amp;22.9=-1&amp;22.10=1&amp;22.11=0&amp;22.23=open&amp;22.2=none&amp;24.1=A&amp;24.4=false&amp;24.5=64&amp;24.6=96&amp;24.7=expr&amp;24.8=&amp;24.0=-2%20*%20(Math.trunc(i%20%2F%208)%20%25%202)%20%2B%201&amp;24.9=-1&amp;24.10=1&amp;24.11=0&amp;24.23=open&amp;25.1=B&amp;25.4=false&amp;25.5=96&amp;25.6=64&amp;25.7=row%20major&amp;25.8=&amp;25.0=-2%20*%20(Math.trunc(j%20%2F%208)%20%25%202)%20%2B%201&amp;25.9=-1&amp;25.10=1&amp;25.11=0&amp;25.23=open&amp;26.13=inherit&amp;27.17=positive&amp;27.18=left&amp;27.19=bottom&amp;27.20=back&amp;28.15=1&amp;29.1=C&amp;29.4=false&amp;29.5=64&amp;29.6=32&amp;29.7=col%20major&amp;29.8=&amp;29.9=-1&amp;29.10=1&amp;29.11=0&amp;29.0=-2%20*%20(Math.trunc(i%20%2F%208)%20%25%202)%20%2B%201&amp;29.23=open&amp;30.31=none&amp;30.32=12&amp;30.33=false&amp;30.13=none&amp;30.34=0&amp;30.23=closed&amp;35.36=1&amp;35.15=1&amp;37.17=negative&amp;37.18=left&amp;37.19=top&amp;37.20=front&amp;38.39=6&amp;38.40=true&amp;38.41=2&amp;38.42=1&amp;38.43=0.5&amp;38.44=0.5&amp;38.45=10&amp;38.46=false&amp;38.47=false&amp;38.23=open&amp;48.49=semilocal&amp;48.50=0.2&amp;48.51=0.4&amp;48.52=0.6&amp;48.53=1.25&amp;48.54=0.77&amp;48.55=0.74&amp;48.56=0.04&amp;48.23=open&amp;57.8=&amp;58.59=-125.71162036288077&amp;58.60=101.84279252909485&amp;58.61=122.50425255743914&amp;62.59=-14.817097084822203&amp;62.60=-9.723209466639396&amp;62.61=-5.4699873376955646&amp;21.23=open&amp;21.63=true&amp;21.4=true&amp;64.1=D&amp;64.4=false&amp;64.5=32&amp;64.6=64&amp;64.7=col%20major&amp;64.8=&amp;64.9=-1&amp;64.10=1&amp;64.11=0&amp;64.0=&amp;64.23=open&amp;65.1=E&amp;65.4=false&amp;65.5=64&amp;65.6=96&amp;65.7=col%20major&amp;65.8=&amp;65.9=-1&amp;65.10=1&amp;65.11=0&amp;65.0=&amp;66.31=none&amp;66.32=12&amp;66.33=false&amp;66.13=none&amp;66.34=0&amp;66.23=closed&amp;67.36=8&amp;67.68=1&amp;67.15=1&amp;67.23=open&amp;69.70=blocks&amp;69.71=5&amp;69.72=0&amp;69.73=1&amp;69.74=0&amp;69.17=negative&amp;69.18=left&amp;69.19=top&amp;69.20=front&amp;69.23=closed&amp;75.39=5.28&amp;75.40=true&amp;75.41=2&amp;75.42=1&amp;75.43=0.5&amp;75.44=0.5&amp;75.45=10&amp;75.46=false&amp;75.47=false&amp;75.23=closed&amp;76.49=semilocal&amp;76.50=0.3&amp;76.51=0.4&amp;76.52=0.6&amp;76.53=1.5&amp;76.54=0.77&amp;76.55=0.74&amp;76.56=0.04&amp;76.23=closed&amp;77.8=&amp;78.59=-174.76129648411032&amp;78.60=141.54502619212317&amp;78.61=170.2709730709386&amp;79.59=-14.817097084822203&amp;79.60=-9.723209466639396&amp;79.61=-5.4699873376955646&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;left.anim=12&amp;alg=13&amp;left.block=14&amp;k%20blocks=15&amp;left.layout=16&amp;polarity=17&amp;left%20placement=18&amp;right%20placement=19&amp;result%20placement=20&amp;left.left=21&amp;left.left.left=22&amp;folder=23&amp;left.left.left.left=24&amp;left.left.left.right=25&amp;left.left.left.anim=26&amp;left.left.left.layout=27&amp;left.left.left.block=28&amp;left.left.right=29&amp;left.left.anim=30&amp;fuse=31&amp;speed=32&amp;hide%20inputs=33&amp;spin=34&amp;left.left.block=35&amp;i%20blocks=36&amp;left.left.layout=37&amp;left.left.deco=38&amp;legends=39&amp;shape=40&amp;spotlight=41&amp;row%20guides=42&amp;flow%20guides=43&amp;lens%20size=44&amp;magnification=45&amp;interior%20spotlight=46&amp;axes=47&amp;left.left.viz=48&amp;sensitivity=49&amp;min%20size=50&amp;min%20light=51&amp;max%20light=52&amp;elem%20scale=53&amp;zero%20hue=54&amp;hue%20gap=55&amp;hue%20spread=56&amp;left.left.diag=57&amp;left.left.cam=58&amp;x=59&amp;y=60&amp;z=61&amp;left.left.cam.target=62&amp;compress=63&amp;left.right=64&amp;right=65&amp;anim=66&amp;block=67&amp;j%20blocks=68&amp;layout=69&amp;scheme=70&amp;gap=71&amp;scatter=72&amp;molecule=73&amp;blast=74&amp;deco=75&amp;viz=76&amp;diag=77&amp;cam=78&amp;cam.target=79">open in mm</a>):</p>

<p><img src="https://pytorch.org/assets/images/inside-the-matrix/bottleneck_part.jpg" alt="the canonical &quot;data parallel&quot; partitioning to the left-associative multilayer bottleneck example"></p>

<p>The second example would (for me, anyway) be much harder to build intuition about without clear geometry to support it: it shows how a binary expression can be parallelized by partitioning the left subexpression along its <code>j</code> axis, the right subexpression along its <code>i</code> axis, and the parent expression along its <code>k</code> axis (<a href="https://bhosmer.github.io/mm/index.html?0=A%20%40%20B%20%40%20(C%20%40%20D)&amp;1=A%20%40%20B%20%40%20(C%20%40%20D)&amp;2=none&amp;12=closed&amp;69=true&amp;3.1=A%20%40%20B&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row%20major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.12=open&amp;3.2=none&amp;13.1=A&amp;13.4=false&amp;13.5=64&amp;13.6=64&amp;13.7=expr&amp;13.8=&amp;13.0=-2%20*%20(Math.trunc(i%20%2F%208)%20%25%202)%20%2B%201&amp;13.9=-1&amp;13.10=1&amp;13.11=0&amp;13.12=closed&amp;14.1=B&amp;14.4=false&amp;14.5=64&amp;14.6=64&amp;14.7=row%20major&amp;14.8=&amp;14.0=-2%20*%20(Math.trunc(j%20%2F%208)%20%25%202)%20%2B%201&amp;14.9=-1&amp;14.10=1&amp;14.11=0&amp;14.12=closed&amp;15.16=inherit&amp;17.18=positive&amp;17.19=left&amp;17.20=bottom&amp;17.21=back&amp;22.23=1&amp;24.1=C%20%40%20D&amp;24.4=true&amp;24.5=32&amp;24.6=32&amp;24.7=col%20major&amp;24.8=&amp;24.9=-1&amp;24.10=1&amp;24.11=0&amp;24.2=none&amp;25.16=inherit&amp;26.23=1&amp;27.18=positive&amp;27.19=right&amp;27.20=top&amp;27.21=back&amp;28.1=C&amp;28.4=false&amp;28.5=64&amp;28.6=64&amp;28.7=col%20major&amp;28.8=&amp;28.9=-1&amp;28.10=1&amp;28.11=0&amp;28.0=-2%20*%20(Math.trunc(i%20%2F%208)%20%25%202)%20%2B%201&amp;28.12=open&amp;29.1=D&amp;29.4=false&amp;29.5=64&amp;29.6=64&amp;29.7=expr&amp;29.8=&amp;29.9=-1&amp;29.10=1&amp;29.11=0&amp;29.0=-2%20*%20(Math.trunc(j%20%2F%208)%20%25%202)%20%2B%201&amp;29.12=open&amp;30.31=none&amp;30.32=12&amp;30.33=false&amp;30.16=none&amp;30.34=0&amp;30.12=closed&amp;35.36=1&amp;35.37=1&amp;35.23=8&amp;35.12=open&amp;38.39=blocks&amp;38.40=5&amp;38.41=0&amp;38.42=1&amp;38.43=0&amp;38.18=negative&amp;38.19=left&amp;38.20=top&amp;38.21=front&amp;38.12=closed&amp;44.45=6&amp;44.46=true&amp;44.47=2&amp;44.48=1&amp;44.49=0.5&amp;44.50=0.5&amp;44.51=10&amp;44.52=false&amp;44.53=false&amp;44.12=closed&amp;54.55=semilocal&amp;54.56=0.4&amp;54.57=0.4&amp;54.58=0.6&amp;54.59=1.5&amp;54.60=0.77&amp;54.61=0.74&amp;54.62=0.04&amp;54.12=open&amp;63.8=&amp;64.65=-163.0431410622342&amp;64.66=153.55767080483412&amp;64.67=176.87418575632128&amp;68.65=-4.044017278625395&amp;68.66=-2.123834827920271&amp;68.67=-2.551083969824457&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;folder=12&amp;left.left=13&amp;left.right=14&amp;left.anim=15&amp;alg=16&amp;left.layout=17&amp;polarity=18&amp;left%20placement=19&amp;right%20placement=20&amp;result%20placement=21&amp;left.block=22&amp;k%20blocks=23&amp;right=24&amp;right.anim=25&amp;right.block=26&amp;right.layout=27&amp;right.left=28&amp;right.right=29&amp;anim=30&amp;fuse=31&amp;speed=32&amp;hide%20inputs=33&amp;spin=34&amp;block=35&amp;i%20blocks=36&amp;j%20blocks=37&amp;layout=38&amp;scheme=39&amp;gap=40&amp;scatter=41&amp;molecule=42&amp;blast=43&amp;deco=44&amp;legends=45&amp;shape=46&amp;spotlight=47&amp;row%20guides=48&amp;flow%20guides=49&amp;lens%20size=50&amp;magnification=51&amp;interior%20spotlight=52&amp;axes=53&amp;viz=54&amp;sensitivity=55&amp;min%20size=56&amp;min%20light=57&amp;max%20light=58&amp;elem%20scale=59&amp;zero%20hue=60&amp;hue%20gap=61&amp;hue%20spread=62&amp;diag=63&amp;cam=64&amp;x=65&amp;y=66&amp;z=67&amp;cam.target=68&amp;compress=69">open in mm</a>):</p>

<p><img src="https://pytorch.org/assets/images/inside-the-matrix/binary_part.jpg" alt="a binary expression can be parallelized by partitioning the left subexpression along its j axis, the right subexpression along its i axis, and the parent expression along its k axis"></p>

<h2 id="4-inside-an-attention-head">4 Inside an Attention Head</h2>

<p>Let’s look at a GPT2 attention head - specifically layer 5, head 4 of the “gpt2” (small) configuration (layers=12, heads=12, embed=768) from <a href="https://github.com/karpathy/nanoGPT">NanoGPT</a>, using OpenAI weights via HuggingFace. Input activations are taken from a forward pass on an OpenWebText training sample of 256 tokens.</p>

<p>There’s nothing particularly unusual about this particular head; I chose it mainly because it computes a fairly common attention pattern and lives in the middle of the model, where activations have become structured and show some interesting texture. (Aside: in a subsequent note I’ll present an attention head explorer that lets you visualize all layers and heads of this model, along with some travel notes.)</p>

<p><a href="https://bhosmer.github.io/mm/index.html?0=out%20%3D%20(attn%20%3D%20(Q%20%3D%20input%20%40%20wQ)%20%40%20(K_t%20%3D%20wK_t%20%40%20input_t))%20%40%20(V%20%3D%20input%20%40%20wV)%20%40%20wO&amp;1=out&amp;2=none&amp;49=closed&amp;84=true&amp;3.1=attn%20%40%20V&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row%20major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.2=none&amp;12.13=vmprod&amp;14.15=1&amp;16.17=positive&amp;16.18=left&amp;16.19=bottom&amp;16.20=back&amp;21.1=attn&amp;21.4=true&amp;21.2=softmax(tril(x%2Fsqrt(k)))&amp;22.1=Q&amp;22.4=true&amp;22.2=none&amp;23.1=input&amp;23.4=false&amp;23.5=256&amp;23.6=768&amp;23.7=url&amp;23.9=-1&amp;23.10=1&amp;23.11=0&amp;23.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;23.0=&amp;24.1=wQ&amp;24.4=false&amp;24.5=768&amp;24.6=64&amp;24.7=url&amp;24.9=-1&amp;24.10=1&amp;24.11=0&amp;24.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wq4_768_64.csv&amp;24.0=&amp;25.13=vmprod&amp;26.15=1&amp;27.17=positive&amp;27.18=left&amp;27.19=bottom&amp;27.20=back&amp;28.2=none&amp;29.13=none&amp;30.15=1&amp;31.17=positive&amp;31.18=right&amp;31.19=top&amp;31.20=back&amp;32.1=wK_t&amp;32.4=false&amp;32.5=64&amp;32.6=768&amp;32.7=url&amp;32.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wk_t4_64_768.csv&amp;32.9=-1&amp;32.10=1&amp;32.11=0&amp;32.0=&amp;33.1=input_t&amp;33.4=false&amp;33.5=768&amp;33.6=256&amp;33.7=url&amp;33.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input_t0_768_256.csv&amp;33.9=-1&amp;33.10=1&amp;33.11=0&amp;33.0=&amp;28.1=K_t&amp;28.4=true&amp;34.13=vmprod&amp;35.15=1&amp;36.17=negative&amp;36.18=left&amp;36.19=top&amp;36.20=front&amp;37.1=V&amp;37.4=true&amp;37.2=none&amp;38.1=input&amp;38.4=false&amp;38.5=256&amp;38.6=768&amp;38.7=url&amp;38.9=-1&amp;38.10=1&amp;38.11=0&amp;38.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;38.0=&amp;39.1=wV&amp;39.4=false&amp;39.5=768&amp;39.6=64&amp;39.7=url&amp;39.9=-1&amp;39.10=1&amp;39.11=0&amp;39.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wv4_768_64.csv&amp;39.0=&amp;40.13=none&amp;41.15=1&amp;42.17=negative&amp;42.18=right&amp;42.19=top&amp;42.20=back&amp;43.1=wO&amp;43.4=false&amp;43.5=64&amp;43.6=768&amp;43.7=url&amp;43.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wo4_64_768.csv&amp;43.9=-1&amp;43.10=1&amp;43.11=0&amp;43.0=&amp;44.45=sync&amp;44.46=16&amp;44.47=false&amp;44.13=none&amp;44.48=0&amp;44.49=open&amp;50.51=1&amp;50.52=1&amp;50.15=1&amp;53.54=blocks&amp;53.55=10&amp;53.56=0&amp;53.57=1&amp;53.58=0&amp;53.17=negative&amp;53.18=left&amp;53.19=top&amp;53.20=front&amp;53.49=open&amp;59.60=10&amp;59.61=true&amp;59.62=4&amp;59.63=0.394&amp;59.64=0.655&amp;59.65=0.5&amp;59.66=12&amp;59.67=false&amp;59.68=false&amp;59.49=open&amp;69.70=local&amp;69.71=0.2&amp;69.72=0.2&amp;69.73=0.9&amp;69.74=2&amp;69.75=0.75&amp;69.76=0.75&amp;69.77=0.03&amp;69.49=closed&amp;78.8=&amp;78.49=closed&amp;79.80=-1149.3128801149742&amp;79.81=1143.004532598807&amp;79.82=1754.3660479535383&amp;83.80=-6.708919569777563&amp;83.81=75.05036284609801&amp;83.82=-216.66743330111652&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;left.anim=12&amp;alg=13&amp;left.block=14&amp;k%20blocks=15&amp;left.layout=16&amp;polarity=17&amp;left%20placement=18&amp;right%20placement=19&amp;result%20placement=20&amp;left.left=21&amp;left.left.left=22&amp;left.left.left.left=23&amp;left.left.left.right=24&amp;left.left.left.anim=25&amp;left.left.left.block=26&amp;left.left.left.layout=27&amp;left.left.right=28&amp;left.left.right.anim=29&amp;left.left.right.block=30&amp;left.left.right.layout=31&amp;left.left.right.left=32&amp;left.left.right.right=33&amp;left.left.anim=34&amp;left.left.block=35&amp;left.left.layout=36&amp;left.right=37&amp;left.right.left=38&amp;left.right.right=39&amp;left.right.anim=40&amp;left.right.block=41&amp;left.right.layout=42&amp;right=43&amp;anim=44&amp;fuse=45&amp;speed=46&amp;hide%20inputs=47&amp;spin=48&amp;folder=49&amp;block=50&amp;i%20blocks=51&amp;j%20blocks=52&amp;layout=53&amp;scheme=54&amp;gap=55&amp;scatter=56&amp;molecule=57&amp;blast=58&amp;deco=59&amp;legends=60&amp;shape=61&amp;spotlight=62&amp;row%20guides=63&amp;flow%20guides=64&amp;lens%20size=65&amp;magnification=66&amp;interior%20spotlight=67&amp;axes=68&amp;viz=69&amp;sensitivity=70&amp;min%20size=71&amp;min%20light=72&amp;max%20light=73&amp;elem%20scale=74&amp;zero%20hue=75&amp;hue%20gap=76&amp;hue%20spread=77&amp;diag=78&amp;cam=79&amp;x=80&amp;y=81&amp;z=82&amp;cam.target=83&amp;compress=84">Open in mm</a> (may take a few seconds to fetch model weights)</p>

<p><img src="https://pytorch.org/assets/images/inside-the-matrix/mha1.jpg" alt="There's nothing particularly unusual about this particular head"></p>

<h3 id="4a-structure">4a Structure</h3>

<p>The entire attention head is visualized as a single compound expression, starting with input and ending with projected output. (Note: to keep things self-contained we do per-head output projection as described in <a href="https://arxiv.org/pdf/1909.08053.pdf">Megatron-LM</a>.)</p>

<p>The computation contains six matmuls:</p>

<div><pre><code>Q = input @ wQ        // 1
K_t = wK_t @ input_t  // 2
V = input @ wV        // 3
attn = sdpa(Q @ K_t)  // 4
head_out = attn @ V   // 5
out = head_out @ wO   // 6
</code></pre></div>

<p>A thumbnail description of what we’re looking at:</p>

<ul>
  <li>the blades of the windmill are matmuls 1, 2, 3 and 6: the former group are the in-projections from input to Q, K and V; the latter is the out-projection from attn @ V back to the embedding dimension.</li>
  <li>at the hub is the double matmul that first calculates attention scores (convex cube in back), then uses them to produce output tokens from the values vector (concave cube in front). Causality means that the attention scores form a lower triangle.</li>
</ul>

<p>But I’d encourage <a href="https://bhosmer.github.io/mm/index.html?0=out%20%3D%20(attn%20%3D%20(Q%20%3D%20input%20%40%20wQ)%20%40%20(K_t%20%3D%20wK_t%20%40%20input_t))%20%40%20(V%20%3D%20input%20%40%20wV)%20%40%20wO&amp;1=out&amp;2=none&amp;49=closed&amp;84=true&amp;3.1=attn%20%40%20V&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row%20major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.2=none&amp;12.13=vmprod&amp;14.15=1&amp;16.17=positive&amp;16.18=left&amp;16.19=bottom&amp;16.20=back&amp;21.1=attn&amp;21.4=true&amp;21.2=softmax(tril(x%2Fsqrt(k)))&amp;22.1=Q&amp;22.4=true&amp;22.2=none&amp;23.1=input&amp;23.4=false&amp;23.5=256&amp;23.6=768&amp;23.7=url&amp;23.9=-1&amp;23.10=1&amp;23.11=0&amp;23.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;23.0=&amp;24.1=wQ&amp;24.4=false&amp;24.5=768&amp;24.6=64&amp;24.7=url&amp;24.9=-1&amp;24.10=1&amp;24.11=0&amp;24.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wq4_768_64.csv&amp;24.0=&amp;25.13=vmprod&amp;26.15=1&amp;27.17=positive&amp;27.18=left&amp;27.19=bottom&amp;27.20=back&amp;28.2=none&amp;29.13=none&amp;30.15=1&amp;31.17=positive&amp;31.18=right&amp;31.19=top&amp;31.20=back&amp;32.1=wK_t&amp;32.4=false&amp;32.5=64&amp;32.6=768&amp;32.7=url&amp;32.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wk_t4_64_768.csv&amp;32.9=-1&amp;32.10=1&amp;32.11=0&amp;32.0=&amp;33.1=input_t&amp;33.4=false&amp;33.5=768&amp;33.6=256&amp;33.7=url&amp;33.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input_t0_768_256.csv&amp;33.9=-1&amp;33.10=1&amp;33.11=0&amp;33.0=&amp;28.1=K_t&amp;28.4=true&amp;34.13=vmprod&amp;35.15=1&amp;36.17=negative&amp;36.18=left&amp;36.19=top&amp;36.20=front&amp;37.1=V&amp;37.4=true&amp;37.2=none&amp;38.1=input&amp;38.4=false&amp;38.5=256&amp;38.6=768&amp;38.7=url&amp;38.9=-1&amp;38.10=1&amp;38.11=0&amp;38.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;38.0=&amp;39.1=wV&amp;39.4=false&amp;39.5=768&amp;39.6=64&amp;39.7=url&amp;39.9=-1&amp;39.10=1&amp;39.11=0&amp;39.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wv4_768_64.csv&amp;39.0=&amp;40.13=none&amp;41.15=1&amp;42.17=negative&amp;42.18=right&amp;42.19=top&amp;42.20=back&amp;43.1=wO&amp;43.4=false&amp;43.5=64&amp;43.6=768&amp;43.7=url&amp;43.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wo4_64_768.csv&amp;43.9=-1&amp;43.10=1&amp;43.11=0&amp;43.0=&amp;44.45=sync&amp;44.46=16&amp;44.47=false&amp;44.13=none&amp;44.48=0&amp;44.49=open&amp;50.51=1&amp;50.52=1&amp;50.15=1&amp;53.54=blocks&amp;53.55=24&amp;53.56=0&amp;53.57=1&amp;53.58=0&amp;53.17=negative&amp;53.18=left&amp;53.19=top&amp;53.20=front&amp;59.60=10&amp;59.61=true&amp;59.62=4&amp;59.63=0.394&amp;59.64=0&amp;59.65=0.5&amp;59.66=12&amp;59.67=false&amp;59.68=false&amp;59.49=closed&amp;69.70=local&amp;69.71=0&amp;69.72=0.2&amp;69.73=0.9&amp;69.74=2&amp;69.75=0.75&amp;69.76=0.75&amp;69.77=0.03&amp;69.49=open&amp;78.8=&amp;78.49=open&amp;79.80=-1212.5184472916683&amp;79.81=1205.8631771144878&amp;79.82=1850.8460431010271&amp;83.80=-6.708919569777563&amp;83.81=75.05036284609801&amp;83.82=-216.66743330111652&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;left.anim=12&amp;alg=13&amp;left.block=14&amp;k%20blocks=15&amp;left.layout=16&amp;polarity=17&amp;left%20placement=18&amp;right%20placement=19&amp;result%20placement=20&amp;left.left=21&amp;left.left.left=22&amp;left.left.left.left=23&amp;left.left.left.right=24&amp;left.left.left.anim=25&amp;left.left.left.block=26&amp;left.left.left.layout=27&amp;left.left.right=28&amp;left.left.right.anim=29&amp;left.left.right.block=30&amp;left.left.right.layout=31&amp;left.left.right.left=32&amp;left.left.right.right=33&amp;left.left.anim=34&amp;left.left.block=35&amp;left.left.layout=36&amp;left.right=37&amp;left.right.left=38&amp;left.right.right=39&amp;left.right.anim=40&amp;left.right.block=41&amp;left.right.layout=42&amp;right=43&amp;anim=44&amp;fuse=45&amp;speed=46&amp;hide%20inputs=47&amp;spin=48&amp;folder=49&amp;block=50&amp;i%20blocks=51&amp;j%20blocks=52&amp;layout=53&amp;scheme=54&amp;gap=55&amp;scatter=56&amp;molecule=57&amp;blast=58&amp;deco=59&amp;legends=60&amp;shape=61&amp;spotlight=62&amp;row%20guides=63&amp;flow%20guides=64&amp;lens%20size=65&amp;magnification=66&amp;interior%20spotlight=67&amp;axes=68&amp;viz=69&amp;sensitivity=70&amp;min%20size=71&amp;min%20light=72&amp;max%20light=73&amp;elem%20scale=74&amp;zero%20hue=75&amp;hue%20gap=76&amp;hue%20spread=77&amp;diag=78&amp;cam=79&amp;x=80&amp;y=81&amp;z=82&amp;cam.target=83&amp;compress=84">exploring this example in the tool itself</a>, rather than relying on the screenshot or the video below to convey just how much signal can be absorbed from it - both about its structure and the actual values flowing through the computation.</p>

<h3 id="4b-computation-and-values">4b Computation and Values</h3>

<p>Here’s an animation of the attention head computation. Specifically, we’re watching</p>

<div><pre><code>sdpa(input @ wQ @ K_t) @ V @ wO
</code></pre></div>

<p>(i.e., matmuls 1, 4 , 5 and 6 above, with <code>K_t</code> and <code>V</code> precomputed) being computed as a fused chain of vector-matrix products: each item in the sequence goes all the way from input through attention to output in one step. More on this animation choice in the later section on parallelization, but first let’s look at what the values being computed tell us.</p>

<p><a href="https://bhosmer.github.io/mm/index.html?0=out%20%3D%20(attn%20%3D%20(Q%20%3D%20input_0_5%20%40%20wQ_5_4)%20%40%20(K_t%20%3D%20wK_t_5_4%20%40%20input_t_0_5))%20%40%20(V%20%3D%20input_0_5%20%40%20wV_5_4)%20%40%20wO_5_4&amp;1=out&amp;2=none&amp;49=closed&amp;84=true&amp;3.1=attn%20%40%20V&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row%20major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.2=none&amp;12.13=vmprod&amp;14.15=1&amp;16.17=positive&amp;16.18=left&amp;16.19=bottom&amp;16.20=back&amp;21.1=attn&amp;21.4=true&amp;21.2=softmax(tril(x%2Fsqrt(k)))&amp;22.1=Q&amp;22.4=true&amp;22.2=none&amp;23.1=input_0_5&amp;23.4=false&amp;23.5=256&amp;23.6=768&amp;23.7=url&amp;23.9=-1&amp;23.10=1&amp;23.11=0&amp;23.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;23.0=&amp;24.1=wQ_5_4&amp;24.4=false&amp;24.5=768&amp;24.6=64&amp;24.7=url&amp;24.9=-1&amp;24.10=1&amp;24.11=0&amp;24.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wq4_768_64.csv&amp;24.0=&amp;25.13=vmprod&amp;26.15=1&amp;27.17=positive&amp;27.18=left&amp;27.19=bottom&amp;27.20=back&amp;28.2=none&amp;29.13=none&amp;30.15=1&amp;31.17=positive&amp;31.18=right&amp;31.19=top&amp;31.20=back&amp;32.1=wK_t_5_4&amp;32.4=false&amp;32.5=64&amp;32.6=768&amp;32.7=url&amp;32.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wk_t4_64_768.csv&amp;32.9=-1&amp;32.10=1&amp;32.11=0&amp;32.0=&amp;33.1=input_t_0_5&amp;33.4=false&amp;33.5=768&amp;33.6=256&amp;33.7=url&amp;33.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input_t0_768_256.csv&amp;33.9=-1&amp;33.10=1&amp;33.11=0&amp;33.0=&amp;28.1=K_t&amp;28.4=true&amp;34.13=vmprod&amp;35.15=1&amp;36.17=negative&amp;36.18=left&amp;36.19=top&amp;36.20=front&amp;37.1=V&amp;37.4=true&amp;37.2=none&amp;38.1=input_0_5&amp;38.4=false&amp;38.5=256&amp;38.6=768&amp;38.7=url&amp;38.9=-1&amp;38.10=1&amp;38.11=0&amp;38.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;38.0=&amp;39.1=wV_5_4&amp;39.4=false&amp;39.5=768&amp;39.6=64&amp;39.7=url&amp;39.9=-1&amp;39.10=1&amp;39.11=0&amp;39.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wv4_768_64.csv&amp;39.0=&amp;40.13=none&amp;41.15=1&amp;42.17=negative&amp;42.18=right&amp;42.19=top&amp;42.20=back&amp;43.1=wO_5_4&amp;43.4=false&amp;43.5=64&amp;43.6=768&amp;43.7=url&amp;43.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wo4_64_768.csv&amp;43.9=-1&amp;43.10=1&amp;43.11=0&amp;43.0=&amp;44.45=sync&amp;44.46=16&amp;44.47=false&amp;44.13=vmprod&amp;44.48=0&amp;44.49=open&amp;50.51=1&amp;50.52=1&amp;50.15=1&amp;53.54=blocks&amp;53.55=24&amp;53.56=0&amp;53.57=1&amp;53.58=0&amp;53.17=negative&amp;53.18=left&amp;53.19=top&amp;53.20=front&amp;59.60=8.38&amp;59.61=true&amp;59.62=4&amp;59.63=0.394&amp;59.64=0&amp;59.65=0.5&amp;59.66=12&amp;59.67=false&amp;59.68=false&amp;59.49=open&amp;69.70=local&amp;69.71=0.05&amp;69.72=0.2&amp;69.73=0.9&amp;69.74=2&amp;69.75=0.75&amp;69.76=0.75&amp;69.77=0.03&amp;78.8=&amp;79.80=-382.8684269325278&amp;79.81=293.7591554956184&amp;79.82=395.95878922315694&amp;83.80=-14.023727291338966&amp;83.81=-38.22974037070054&amp;83.82=-84.10726407282482&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;left.anim=12&amp;alg=13&amp;left.block=14&amp;k%20blocks=15&amp;left.layout=16&amp;polarity=17&amp;left%20placement=18&amp;right%20placement=19&amp;result%20placement=20&amp;left.left=21&amp;left.left.left=22&amp;left.left.left.left=23&amp;left.left.left.right=24&amp;left.left.left.anim=25&amp;left.left.left.block=26&amp;left.left.left.layout=27&amp;left.left.right=28&amp;left.left.right.anim=29&amp;left.left.right.block=30&amp;left.left.right.layout=31&amp;left.left.right.left=32&amp;left.left.right.right=33&amp;left.left.anim=34&amp;left.left.block=35&amp;left.left.layout=36&amp;left.right=37&amp;left.right.left=38&amp;left.right.right=39&amp;left.right.anim=40&amp;left.right.block=41&amp;left.right.layout=42&amp;right=43&amp;anim=44&amp;fuse=45&amp;speed=46&amp;hide%20inputs=47&amp;spin=48&amp;folder=49&amp;block=50&amp;i%20blocks=51&amp;j%20blocks=52&amp;layout=53&amp;scheme=54&amp;gap=55&amp;scatter=56&amp;molecule=57&amp;blast=58&amp;deco=59&amp;legends=60&amp;shape=61&amp;spotlight=62&amp;row%20guides=63&amp;flow%20guides=64&amp;lens%20size=65&amp;magnification=66&amp;interior%20spotlight=67&amp;axes=68&amp;viz=69&amp;sensitivity=70&amp;min%20size=71&amp;min%20light=72&amp;max%20light=73&amp;elem%20scale=74&amp;zero%20hue=75&amp;hue%20gap=76&amp;hue%20spread=77&amp;diag=78&amp;cam=79&amp;x=80&amp;y=81&amp;z=82&amp;cam.target=83&amp;compress=84">Open in mm</a></p>



<p>There’s a lot of interesting stuff going on here.</p>

<ul>
  <li>Before we even get to the attention calculation, it’s quite striking how low-rank <code>Q</code> and <code>K_t</code> are. <a href="https://bhosmer.github.io/mm/index.html?0=out%20%3D%20(attn%20%3D%20(Q%20%3D%20input_0_5%20%40%20wQ_5_4)%20%40%20(K_t%20%3D%20wK_t_5_4%20%40%20input_t_0_5))%20%40%20(V%20%3D%20input_0_5%20%40%20wV_5_4)%20%40%20wO_5_4&amp;1=out&amp;2=none&amp;24=closed&amp;84=true&amp;3.1=attn%20%40%20V&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row%20major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.2=none&amp;12.13=vmprod&amp;14.15=1&amp;16.17=positive&amp;16.18=left&amp;16.19=bottom&amp;16.20=back&amp;21.1=attn&amp;21.4=true&amp;21.2=softmax(tril(x%2Fsqrt(k)))&amp;22.1=Q&amp;22.4=true&amp;22.2=none&amp;23.1=input_0_5&amp;23.4=false&amp;23.5=256&amp;23.6=768&amp;23.7=url&amp;23.9=-1&amp;23.10=1&amp;23.11=0&amp;23.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;23.0=&amp;23.24=closed&amp;25.1=wQ_5_4&amp;25.4=false&amp;25.5=768&amp;25.6=64&amp;25.7=url&amp;25.9=-1&amp;25.10=1&amp;25.11=0&amp;25.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wq4_768_64.csv&amp;25.0=&amp;26.13=none&amp;26.24=open&amp;27.15=1&amp;28.17=positive&amp;28.18=left&amp;28.19=bottom&amp;28.20=back&amp;22.24=open&amp;29.2=none&amp;30.13=none&amp;31.15=1&amp;32.17=positive&amp;32.18=right&amp;32.19=top&amp;32.20=back&amp;33.1=wK_t_5_4&amp;33.4=false&amp;33.5=64&amp;33.6=768&amp;33.7=url&amp;33.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wk_t4_64_768.csv&amp;33.9=-1&amp;33.10=1&amp;33.11=0&amp;33.0=&amp;34.1=input_t_0_5&amp;34.4=false&amp;34.5=768&amp;34.6=256&amp;34.7=url&amp;34.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input_t0_768_256.csv&amp;34.9=-1&amp;34.10=1&amp;34.11=0&amp;34.0=&amp;29.1=K_t&amp;29.4=true&amp;35.13=vmprod&amp;36.15=1&amp;37.17=negative&amp;37.18=left&amp;37.19=top&amp;37.20=front&amp;21.24=closed&amp;38.1=V&amp;38.4=true&amp;38.2=none&amp;39.1=input_0_5&amp;39.4=false&amp;39.5=256&amp;39.6=768&amp;39.7=url&amp;39.9=-1&amp;39.10=1&amp;39.11=0&amp;39.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;39.0=&amp;40.1=wV_5_4&amp;40.4=false&amp;40.5=768&amp;40.6=64&amp;40.7=url&amp;40.9=-1&amp;40.10=1&amp;40.11=0&amp;40.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wv4_768_64.csv&amp;40.0=&amp;41.13=none&amp;42.15=1&amp;43.17=negative&amp;43.18=right&amp;43.19=top&amp;43.20=back&amp;3.24=closed&amp;44.1=wO_5_4&amp;44.4=false&amp;44.5=64&amp;44.6=768&amp;44.7=url&amp;44.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wo4_64_768.csv&amp;44.9=-1&amp;44.10=1&amp;44.11=0&amp;44.0=&amp;45.46=sync&amp;45.47=4&amp;45.48=false&amp;45.13=vmprod&amp;45.49=0&amp;45.24=open&amp;50.51=1&amp;50.52=1&amp;50.15=1&amp;53.54=blocks&amp;53.55=24&amp;53.56=0&amp;53.57=1&amp;53.58=0&amp;53.17=negative&amp;53.18=left&amp;53.19=top&amp;53.20=front&amp;59.60=8.38&amp;59.61=true&amp;59.62=4&amp;59.63=0.394&amp;59.64=0&amp;59.65=0.5&amp;59.66=12&amp;59.67=false&amp;59.68=false&amp;59.24=open&amp;69.70=local&amp;69.71=0.05&amp;69.72=0.2&amp;69.73=0.9&amp;69.74=2&amp;69.75=0.75&amp;69.76=0.75&amp;69.77=0.03&amp;78.8=&amp;79.80=-0.30816774330149777&amp;79.81=333.6054152134701&amp;79.82=155.72856559616935&amp;83.80=-0.11764216999897817&amp;83.81=-38.43510027180947&amp;83.82=-78.52287109278605&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;left.anim=12&amp;alg=13&amp;left.block=14&amp;k%20blocks=15&amp;left.layout=16&amp;polarity=17&amp;left%20placement=18&amp;right%20placement=19&amp;result%20placement=20&amp;left.left=21&amp;left.left.left=22&amp;left.left.left.left=23&amp;folder=24&amp;left.left.left.right=25&amp;left.left.left.anim=26&amp;left.left.left.block=27&amp;left.left.left.layout=28&amp;left.left.right=29&amp;left.left.right.anim=30&amp;left.left.right.block=31&amp;left.left.right.layout=32&amp;left.left.right.left=33&amp;left.left.right.right=34&amp;left.left.anim=35&amp;left.left.block=36&amp;left.left.layout=37&amp;left.right=38&amp;left.right.left=39&amp;left.right.right=40&amp;left.right.anim=41&amp;left.right.block=42&amp;left.right.layout=43&amp;right=44&amp;anim=45&amp;fuse=46&amp;speed=47&amp;hide%20inputs=48&amp;spin=49&amp;block=50&amp;i%20blocks=51&amp;j%20blocks=52&amp;layout=53&amp;scheme=54&amp;gap=55&amp;scatter=56&amp;molecule=57&amp;blast=58&amp;deco=59&amp;legends=60&amp;shape=61&amp;spotlight=62&amp;row%20guides=63&amp;flow%20guides=64&amp;lens%20size=65&amp;magnification=66&amp;interior%20spotlight=67&amp;axes=68&amp;viz=69&amp;sensitivity=70&amp;min%20size=71&amp;min%20light=72&amp;max%20light=73&amp;elem%20scale=74&amp;zero%20hue=75&amp;hue%20gap=76&amp;hue%20spread=77&amp;diag=78&amp;cam=79&amp;x=80&amp;y=81&amp;z=82&amp;cam.target=83&amp;compress=84">Zooming in on the Q @ K_t vector-matrix product animation</a>, the situation is even more vivid: a significant number of channels (embedding positions) in <em>both</em> <code>Q</code> and <code>K</code> look more or less constant across the sequence, implying that the useful attention signal is potentially driven by a only smallish subset of the embedding. Understanding and exploiting this phenomenon is one of the threads we’re pulling on as part of the SysML ATOM transformer efficiency project.</li>
  <li>Perhaps most familiar is the strong-but-not-perfect diagonal that emerges in the attention matrix. This is a common pattern, showing up in many of the attention heads of this model (and those of many transformers). It produces <em>localized</em> attention: the value tokens in the small neighborhood immediately preceding an output token’s position largely determine that output token’s content pattern.</li>
  <li>However, the size of this neighborhood and the influence of individual tokens within it vary nontrivially - this can be seen both in the off-diagonal frost in the attention grid, and in the <a href="https://bhosmer.github.io/mm/index.html?0=out%20%3D%20(attn%20%3D%20(Q%20%3D%20input_0_5%20%40%20wQ_5_4)%20%40%20(K_t%20%3D%20wK_t_5_4%20%40%20input_t_0_5))%20%40%20(V%20%3D%20input_0_5%20%40%20wV_5_4)%20%40%20wO_5_4&amp;1=out&amp;2=none&amp;26=closed&amp;84=true&amp;3.1=attn%20%40%20V&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row%20major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.2=none&amp;12.13=vmprod&amp;14.15=1&amp;16.17=positive&amp;16.18=left&amp;16.19=bottom&amp;16.20=back&amp;21.1=attn&amp;21.4=true&amp;21.2=softmax(tril(x%2Fsqrt(k)))&amp;22.1=Q&amp;22.4=true&amp;22.2=none&amp;23.1=input_0_5&amp;23.4=false&amp;23.5=256&amp;23.6=768&amp;23.7=url&amp;23.9=-1&amp;23.10=1&amp;23.11=0&amp;23.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;23.0=&amp;24.1=wQ_5_4&amp;24.4=false&amp;24.5=768&amp;24.6=64&amp;24.7=url&amp;24.9=-1&amp;24.10=1&amp;24.11=0&amp;24.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wq4_768_64.csv&amp;24.0=&amp;25.13=none&amp;25.26=open&amp;27.15=1&amp;28.17=positive&amp;28.18=left&amp;28.19=bottom&amp;28.20=back&amp;22.26=closed&amp;29.2=none&amp;30.13=none&amp;31.15=1&amp;32.17=positive&amp;32.18=right&amp;32.19=top&amp;32.20=back&amp;33.1=wK_t_5_4&amp;33.4=false&amp;33.5=64&amp;33.6=768&amp;33.7=url&amp;33.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wk_t4_64_768.csv&amp;33.9=-1&amp;33.10=1&amp;33.11=0&amp;33.0=&amp;34.1=input_t_0_5&amp;34.4=false&amp;34.5=768&amp;34.6=256&amp;34.7=url&amp;34.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input_t0_768_256.csv&amp;34.9=-1&amp;34.10=1&amp;34.11=0&amp;34.0=&amp;29.1=K_t&amp;29.4=true&amp;35.13=none&amp;35.26=open&amp;36.15=1&amp;37.17=negative&amp;37.18=left&amp;37.19=top&amp;37.20=front&amp;21.26=open&amp;38.1=V&amp;38.4=true&amp;38.2=none&amp;39.1=input_0_5&amp;39.4=false&amp;39.5=256&amp;39.6=768&amp;39.7=url&amp;39.9=-1&amp;39.10=1&amp;39.11=0&amp;39.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;39.0=&amp;40.1=wV_5_4&amp;40.4=false&amp;40.5=768&amp;40.6=64&amp;40.7=url&amp;40.9=-1&amp;40.10=1&amp;40.11=0&amp;40.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wv4_768_64.csv&amp;40.0=&amp;41.13=none&amp;42.15=1&amp;43.17=negative&amp;43.18=right&amp;43.19=top&amp;43.20=back&amp;3.26=open&amp;44.1=wO_5_4&amp;44.4=false&amp;44.5=64&amp;44.6=768&amp;44.7=url&amp;44.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wo4_64_768.csv&amp;44.9=-1&amp;44.10=1&amp;44.11=0&amp;44.0=&amp;45.46=sync&amp;45.47=16&amp;45.48=false&amp;45.13=vmprod&amp;45.49=0&amp;45.26=open&amp;50.51=1&amp;50.52=1&amp;50.15=1&amp;53.54=blocks&amp;53.55=24&amp;53.56=0&amp;53.57=1&amp;53.58=0&amp;53.17=negative&amp;53.18=left&amp;53.19=top&amp;53.20=front&amp;59.60=8.38&amp;59.61=true&amp;59.62=4&amp;59.63=0.394&amp;59.64=0&amp;59.65=0.5&amp;59.66=12&amp;59.67=false&amp;59.68=false&amp;59.26=open&amp;69.70=local&amp;69.71=0.05&amp;69.72=0.2&amp;69.73=0.9&amp;69.74=2&amp;69.75=0.75&amp;69.76=0.75&amp;69.77=0.03&amp;78.8=&amp;79.80=-12.838747258760423&amp;79.81=224.62765397316576&amp;79.82=274.71626756027933&amp;83.80=-13.049253781233714&amp;83.81=-55.16215322834755&amp;83.82=-70.26525235295296&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;left.anim=12&amp;alg=13&amp;left.block=14&amp;k%20blocks=15&amp;left.layout=16&amp;polarity=17&amp;left%20placement=18&amp;right%20placement=19&amp;result%20placement=20&amp;left.left=21&amp;left.left.left=22&amp;left.left.left.left=23&amp;left.left.left.right=24&amp;left.left.left.anim=25&amp;folder=26&amp;left.left.left.block=27&amp;left.left.left.layout=28&amp;left.left.right=29&amp;left.left.right.anim=30&amp;left.left.right.block=31&amp;left.left.right.layout=32&amp;left.left.right.left=33&amp;left.left.right.right=34&amp;left.left.anim=35&amp;left.left.block=36&amp;left.left.layout=37&amp;left.right=38&amp;left.right.left=39&amp;left.right.right=40&amp;left.right.anim=41&amp;left.right.block=42&amp;left.right.layout=43&amp;right=44&amp;anim=45&amp;fuse=46&amp;speed=47&amp;hide%20inputs=48&amp;spin=49&amp;block=50&amp;i%20blocks=51&amp;j%20blocks=52&amp;layout=53&amp;scheme=54&amp;gap=55&amp;scatter=56&amp;molecule=57&amp;blast=58&amp;deco=59&amp;legends=60&amp;shape=61&amp;spotlight=62&amp;row%20guides=63&amp;flow%20guides=64&amp;lens%20size=65&amp;magnification=66&amp;interior%20spotlight=67&amp;axes=68&amp;viz=69&amp;sensitivity=70&amp;min%20size=71&amp;min%20light=72&amp;max%20light=73&amp;elem%20scale=74&amp;zero%20hue=75&amp;hue%20gap=76&amp;hue%20spread=77&amp;diag=78&amp;cam=79&amp;x=80&amp;y=81&amp;z=82&amp;cam.target=83&amp;compress=84">fluctuating patterns of the attn[i] @ V vector-matrix product plane</a> as it descends the attention matrix on its way through the sequence.</li>
  <li>But note that the local neighborhood isn’t the only thing that’s attracting attention: the leftmost column of the attention grid, corresponding to the first token of the sequence, is entirely filled with nonzero (but fluctuating) values, meaning every output token will be influenced to some degree by the first value token.</li>
  <li>Moreover there’s an <a href="https://bhosmer.github.io/mm/index.html?0=out%20%3D%20(attn%20%3D%20(Q%20%3D%20input_0_5%20%40%20wQ_5_4)%20%40%20(K_t%20%3D%20wK_t_5_4%20%40%20input_t_0_5))%20%40%20(V%20%3D%20input_0_5%20%40%20wV_5_4)%20%40%20wO_5_4&amp;1=out&amp;2=none&amp;49=closed&amp;84=true&amp;3.1=attn%20%40%20V&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row%20major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.2=none&amp;12.13=vmprod&amp;14.15=1&amp;16.17=positive&amp;16.18=left&amp;16.19=bottom&amp;16.20=back&amp;21.1=attn&amp;21.4=true&amp;21.2=softmax(tril(x%2Fsqrt(k)))&amp;22.1=Q&amp;22.4=true&amp;22.2=none&amp;23.1=input_0_5&amp;23.4=false&amp;23.5=256&amp;23.6=768&amp;23.7=url&amp;23.9=-1&amp;23.10=1&amp;23.11=0&amp;23.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;23.0=&amp;24.1=wQ_5_4&amp;24.4=false&amp;24.5=768&amp;24.6=64&amp;24.7=url&amp;24.9=-1&amp;24.10=1&amp;24.11=0&amp;24.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wq4_768_64.csv&amp;24.0=&amp;25.13=vmprod&amp;26.15=1&amp;27.17=positive&amp;27.18=left&amp;27.19=bottom&amp;27.20=back&amp;28.2=none&amp;29.13=none&amp;30.15=1&amp;31.17=positive&amp;31.18=right&amp;31.19=top&amp;31.20=back&amp;32.1=wK_t_5_4&amp;32.4=false&amp;32.5=64&amp;32.6=768&amp;32.7=url&amp;32.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wk_t4_64_768.csv&amp;32.9=-1&amp;32.10=1&amp;32.11=0&amp;32.0=&amp;33.1=input_t_0_5&amp;33.4=false&amp;33.5=768&amp;33.6=256&amp;33.7=url&amp;33.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input_t0_768_256.csv&amp;33.9=-1&amp;33.10=1&amp;33.11=0&amp;33.0=&amp;28.1=K_t&amp;28.4=true&amp;34.13=vmprod&amp;35.15=1&amp;36.17=negative&amp;36.18=left&amp;36.19=top&amp;36.20=front&amp;37.1=V&amp;37.4=true&amp;37.2=none&amp;38.1=input_0_5&amp;38.4=false&amp;38.5=256&amp;38.6=768&amp;38.7=url&amp;38.9=-1&amp;38.10=1&amp;38.11=0&amp;38.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;38.0=&amp;39.1=wV_5_4&amp;39.4=false&amp;39.5=768&amp;39.6=64&amp;39.7=url&amp;39.9=-1&amp;39.10=1&amp;39.11=0&amp;39.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wv4_768_64.csv&amp;39.0=&amp;40.13=none&amp;41.15=1&amp;42.17=negative&amp;42.18=right&amp;42.19=top&amp;42.20=back&amp;43.1=wO_5_4&amp;43.4=false&amp;43.5=64&amp;43.6=768&amp;43.7=url&amp;43.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wo4_64_768.csv&amp;43.9=-1&amp;43.10=1&amp;43.11=0&amp;43.0=&amp;44.45=sync&amp;44.46=16&amp;44.47=false&amp;44.13=none&amp;44.48=0&amp;44.49=open&amp;50.51=1&amp;50.52=1&amp;50.15=1&amp;53.54=blocks&amp;53.55=24&amp;53.56=0&amp;53.57=1&amp;53.58=0&amp;53.17=negative&amp;53.18=left&amp;53.19=top&amp;53.20=front&amp;59.60=8.38&amp;59.61=true&amp;59.62=4&amp;59.63=0.394&amp;59.64=0&amp;59.65=0.5&amp;59.66=12&amp;59.67=false&amp;59.68=false&amp;59.49=open&amp;69.70=local&amp;69.71=0.05&amp;69.72=0.2&amp;69.73=0.9&amp;69.74=2&amp;69.75=0.75&amp;69.76=0.75&amp;69.77=0.03&amp;78.8=&amp;79.80=-328.8286059935543&amp;79.81=-64.64788859858083&amp;79.82=156.66189435044396&amp;83.80=-6.5479856531724625&amp;83.81=-27.630477427688977&amp;83.82=-64.70186279804427&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;left.anim=12&amp;alg=13&amp;left.block=14&amp;k%20blocks=15&amp;left.layout=16&amp;polarity=17&amp;left%20placement=18&amp;right%20placement=19&amp;result%20placement=20&amp;left.left=21&amp;left.left.left=22&amp;left.left.left.left=23&amp;left.left.left.right=24&amp;left.left.left.anim=25&amp;left.left.left.block=26&amp;left.left.left.layout=27&amp;left.left.right=28&amp;left.left.right.anim=29&amp;left.left.right.block=30&amp;left.left.right.layout=31&amp;left.left.right.left=32&amp;left.left.right.right=33&amp;left.left.anim=34&amp;left.left.block=35&amp;left.left.layout=36&amp;left.right=37&amp;left.right.left=38&amp;left.right.right=39&amp;left.right.anim=40&amp;left.right.block=41&amp;left.right.layout=42&amp;right=43&amp;anim=44&amp;fuse=45&amp;speed=46&amp;hide%20inputs=47&amp;spin=48&amp;folder=49&amp;block=50&amp;i%20blocks=51&amp;j%20blocks=52&amp;layout=53&amp;scheme=54&amp;gap=55&amp;scatter=56&amp;molecule=57&amp;blast=58&amp;deco=59&amp;legends=60&amp;shape=61&amp;spotlight=62&amp;row%20guides=63&amp;flow%20guides=64&amp;lens%20size=65&amp;magnification=66&amp;interior%20spotlight=67&amp;axes=68&amp;viz=69&amp;sensitivity=70&amp;min%20size=71&amp;min%20light=72&amp;max%20light=73&amp;elem%20scale=74&amp;zero%20hue=75&amp;hue%20gap=76&amp;hue%20spread=77&amp;diag=78&amp;cam=79&amp;x=80&amp;y=81&amp;z=82&amp;cam.target=83&amp;compress=84">inexact but discernible oscillation in attention score dominance</a> between the current token neighborhood and the initial token. The period of the oscillation varies, but broadly speaking starts short and then lengthens as one travels down the sequence (evocatively correlated with the quantity of candidate attention tokens for each row, given causality).</li>
  <li>To get a feel for how (<code>attn @ V)</code> is formed, it’s important not to focus on attention in isolation - <code>V</code> is an equal player. Each output item is a weighted average of the entire <code>V</code> vector: at the limit when attention is a perfect diagonal, <code>attn @ V</code> is simply an exact copy of <code>V</code>. Here we see <a href="https://bhosmer.github.io/mm/index.html?0=out+%3D+%28attn+%3D+%28Q+%3D+input_0_5+%40+wQ_5_4%29+%40+%28K_t+%3D+wK_t_5_4+%40+input_t_0_5%29%29+%40+%28V+%3D+input_0_5+%40+wV_5_4%29+%40+wO_5_4&amp;1=out&amp;2=none&amp;51=closed&amp;84=true&amp;3.1=attn+%40+V&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row+major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.2=none&amp;12.13=vmprod&amp;14.15=1&amp;14.16=1&amp;14.17=1&amp;18.19=positive&amp;18.20=left&amp;18.21=bottom&amp;18.22=back&amp;23.1=attn&amp;23.4=true&amp;23.2=softmax%28tril%28x%2Fsqrt%28k%29%29%29&amp;24.1=Q&amp;24.4=true&amp;24.2=none&amp;25.1=input_0_5&amp;25.4=false&amp;25.5=256&amp;25.6=768&amp;25.7=url&amp;25.9=-1&amp;25.10=1&amp;25.11=0&amp;25.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;25.0=&amp;26.1=wQ_5_4&amp;26.4=false&amp;26.5=768&amp;26.6=64&amp;26.7=url&amp;26.9=-1&amp;26.10=1&amp;26.11=0&amp;26.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wq4_768_64.csv&amp;26.0=&amp;27.13=vmprod&amp;28.15=1&amp;28.16=1&amp;28.17=1&amp;29.19=positive&amp;29.20=left&amp;29.21=bottom&amp;29.22=back&amp;30.2=none&amp;31.13=none&amp;32.15=1&amp;32.16=1&amp;32.17=1&amp;33.19=positive&amp;33.20=right&amp;33.21=top&amp;33.22=back&amp;34.1=wK_t_5_4&amp;34.4=false&amp;34.5=64&amp;34.6=768&amp;34.7=url&amp;34.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wk_t4_64_768.csv&amp;34.9=-1&amp;34.10=1&amp;34.11=0&amp;34.0=&amp;35.1=input_t_0_5&amp;35.4=false&amp;35.5=768&amp;35.6=256&amp;35.7=url&amp;35.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input_t0_768_256.csv&amp;35.9=-1&amp;35.10=1&amp;35.11=0&amp;35.0=&amp;30.1=K_t&amp;30.4=true&amp;36.13=vmprod&amp;37.15=1&amp;37.16=1&amp;37.17=1&amp;38.19=negative&amp;38.20=left&amp;38.21=top&amp;38.22=front&amp;39.1=V&amp;39.4=true&amp;39.2=none&amp;40.1=input_0_5&amp;40.4=false&amp;40.5=256&amp;40.6=768&amp;40.7=url&amp;40.9=-1&amp;40.10=1&amp;40.11=0&amp;40.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;40.0=&amp;41.1=wV_5_4&amp;41.4=false&amp;41.5=768&amp;41.6=64&amp;41.7=url&amp;41.9=-1&amp;41.10=1&amp;41.11=0&amp;41.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wv4_768_64.csv&amp;41.0=&amp;42.13=none&amp;43.15=1&amp;43.16=1&amp;43.17=1&amp;44.19=negative&amp;44.20=right&amp;44.21=top&amp;44.22=back&amp;45.1=wO_5_4&amp;45.4=false&amp;45.5=64&amp;45.6=768&amp;45.7=url&amp;45.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wo4_64_768.csv&amp;45.9=-1&amp;45.10=1&amp;45.11=0&amp;45.0=&amp;46.47=sync&amp;46.48=16&amp;46.49=false&amp;46.13=none&amp;46.50=0&amp;46.51=open&amp;52.16=1&amp;52.15=1&amp;52.17=1&amp;53.54=blocks&amp;53.55=24&amp;53.56=0&amp;53.57=1&amp;53.58=0&amp;53.19=negative&amp;53.20=left&amp;53.21=top&amp;53.22=front&amp;59.60=8.38&amp;59.61=true&amp;59.62=4&amp;59.63=0.394&amp;59.64=0&amp;59.65=0.5&amp;59.66=20&amp;59.67=false&amp;59.68=false&amp;59.51=open&amp;69.70=local&amp;69.71=0.05&amp;69.72=0.2&amp;69.73=0.9&amp;69.74=2&amp;69.75=0.75&amp;69.76=0.75&amp;69.77=0.03&amp;78.8=&amp;79.80=-164.2339403949366&amp;79.81=18.940074323234473&amp;79.82=173.55325640245638&amp;83.80=117.76774477612946&amp;83.81=2.623526996843087&amp;83.82=53.25986191913323&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;left.anim=12&amp;alg=13&amp;left.block=14&amp;k+blocks=15&amp;i+blocks=16&amp;j+blocks=17&amp;left.layout=18&amp;polarity=19&amp;left+placement=20&amp;right+placement=21&amp;result+placement=22&amp;left.left=23&amp;left.left.left=24&amp;left.left.left.left=25&amp;left.left.left.right=26&amp;left.left.left.anim=27&amp;left.left.left.block=28&amp;left.left.left.layout=29&amp;left.left.right=30&amp;left.left.right.anim=31&amp;left.left.right.block=32&amp;left.left.right.layout=33&amp;left.left.right.left=34&amp;left.left.right.right=35&amp;left.left.anim=36&amp;left.left.block=37&amp;left.left.layout=38&amp;left.right=39&amp;left.right.left=40&amp;left.right.right=41&amp;left.right.anim=42&amp;left.right.block=43&amp;left.right.layout=44&amp;right=45&amp;anim=46&amp;fuse=47&amp;speed=48&amp;hide+inputs=49&amp;spin=50&amp;folder=51&amp;block=52&amp;layout=53&amp;scheme=54&amp;gap=55&amp;scatter=56&amp;molecule=57&amp;blast=58&amp;deco=59&amp;legends=60&amp;shape=61&amp;spotlight=62&amp;row+guides=63&amp;flow+guides=64&amp;lens+size=65&amp;magnification=66&amp;interior+spotlight=67&amp;axes=68&amp;viz=69&amp;sensitivity=70&amp;min+size=71&amp;min+light=72&amp;max+light=73&amp;elem+scale=74&amp;zero+hue=75&amp;hue+gap=76&amp;hue+spread=77&amp;diag=78&amp;cam=79&amp;x=80&amp;y=81&amp;z=82&amp;cam.target=83&amp;compress=84">something more textured</a>: visible banding where particular tokens have scored high over a contiguous subsequence of attention rows, superimposed on a matrix visibly similar to to <code>V</code> but with some vertical smearing due to the fat diagonal. (Aside: per the <a href="https://bhosmer.github.io/mm/ref.html">mm reference guide</a>, long-clicking or control-clicking will reveal the actual numeric values of visualized elements.)</li>
  <li>Bear in mind that since we’re in a middle layer (5), the input to this attention head is an intermediate representation, not the original tokenized text. So the <a href="https://bhosmer.github.io/mm/index.html?0=out+%3D+%28attn+%3D+%28Q+%3D+input+%40+wQ%29+%40+%28K_t+%3D+wK_t+%40+input_t%29%29+%40+%28V+%3D+input+%40+wV%29+%40+wO&amp;1=out&amp;2=none&amp;26=closed&amp;84=true&amp;3.1=attn+%40+V&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row+major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.2=none&amp;12.13=vmprod&amp;14.15=1&amp;14.16=1&amp;14.17=1&amp;18.19=positive&amp;18.20=left&amp;18.21=bottom&amp;18.22=back&amp;23.1=attn&amp;23.4=true&amp;23.2=softmax%28tril%28x%2Fsqrt%28k%29%29%29&amp;24.1=Q&amp;24.4=true&amp;24.2=none&amp;25.1=input&amp;25.4=false&amp;25.5=256&amp;25.6=768&amp;25.7=url&amp;25.9=-1&amp;25.10=1&amp;25.11=0&amp;25.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;25.0=&amp;25.26=open&amp;27.1=wQ&amp;27.4=false&amp;27.5=768&amp;27.6=64&amp;27.7=url&amp;27.9=-1&amp;27.10=1&amp;27.11=0&amp;27.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wq4_768_64.csv&amp;27.0=&amp;28.13=vmprod&amp;29.15=1&amp;29.16=1&amp;29.17=1&amp;30.19=positive&amp;30.20=left&amp;30.21=bottom&amp;30.22=back&amp;24.26=open&amp;31.2=none&amp;32.13=none&amp;33.15=1&amp;33.16=1&amp;33.17=1&amp;34.19=positive&amp;34.20=right&amp;34.21=top&amp;34.22=back&amp;35.1=wK_t&amp;35.4=false&amp;35.5=64&amp;35.6=768&amp;35.7=url&amp;35.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wk_t4_64_768.csv&amp;35.9=-1&amp;35.10=1&amp;35.11=0&amp;35.0=&amp;36.1=input_t&amp;36.4=false&amp;36.5=768&amp;36.6=256&amp;36.7=url&amp;36.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input_t0_768_256.csv&amp;36.9=-1&amp;36.10=1&amp;36.11=0&amp;36.0=&amp;31.1=K_t&amp;31.4=true&amp;37.13=vmprod&amp;38.15=1&amp;38.16=1&amp;38.17=1&amp;39.19=negative&amp;39.20=left&amp;39.21=top&amp;39.22=front&amp;23.26=open&amp;40.1=V&amp;40.4=true&amp;40.2=none&amp;41.1=input&amp;41.4=false&amp;41.5=256&amp;41.6=768&amp;41.7=url&amp;41.9=-1&amp;41.10=1&amp;41.11=0&amp;41.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;41.0=&amp;42.1=wV&amp;42.4=false&amp;42.5=768&amp;42.6=64&amp;42.7=url&amp;42.9=-1&amp;42.10=1&amp;42.11=0&amp;42.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wv4_768_64.csv&amp;42.0=&amp;43.13=none&amp;44.15=1&amp;44.16=1&amp;44.17=1&amp;45.19=negative&amp;45.20=right&amp;45.21=top&amp;45.22=back&amp;3.26=open&amp;46.1=wO&amp;46.4=false&amp;46.5=64&amp;46.6=768&amp;46.7=url&amp;46.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wo4_64_768.csv&amp;46.9=-1&amp;46.10=1&amp;46.11=0&amp;46.0=&amp;47.48=sync&amp;47.49=16&amp;47.50=false&amp;47.13=none&amp;47.51=0&amp;47.26=open&amp;52.16=1&amp;52.15=1&amp;52.17=1&amp;53.54=blocks&amp;53.55=24&amp;53.56=0&amp;53.57=1&amp;53.58=0&amp;53.19=negative&amp;53.20=left&amp;53.21=top&amp;53.22=front&amp;59.60=10&amp;59.61=true&amp;59.62=5&amp;59.63=0.394&amp;59.64=0&amp;59.65=0.25&amp;59.66=4.632&amp;59.67=false&amp;59.68=false&amp;59.26=open&amp;69.70=local&amp;69.71=0.2&amp;69.72=0.4&amp;69.73=0.9&amp;69.74=2&amp;69.75=0.75&amp;69.76=0.75&amp;69.77=0.03&amp;69.26=open&amp;78.8=&amp;78.26=open&amp;79.80=-1126.8641673236093&amp;79.81=-4.707283693510895&amp;79.82=168.0669807860928&amp;83.80=-692.9006907132649&amp;83.81=4.068470706235418&amp;83.82=-171.27561837707958&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;left.anim=12&amp;alg=13&amp;left.block=14&amp;k+blocks=15&amp;i+blocks=16&amp;j+blocks=17&amp;left.layout=18&amp;polarity=19&amp;left+placement=20&amp;right+placement=21&amp;result+placement=22&amp;left.left=23&amp;left.left.left=24&amp;left.left.left.left=25&amp;folder=26&amp;left.left.left.right=27&amp;left.left.left.anim=28&amp;left.left.left.block=29&amp;left.left.left.layout=30&amp;left.left.right=31&amp;left.left.right.anim=32&amp;left.left.right.block=33&amp;left.left.right.layout=34&amp;left.left.right.left=35&amp;left.left.right.right=36&amp;left.left.anim=37&amp;left.left.block=38&amp;left.left.layout=39&amp;left.right=40&amp;left.right.left=41&amp;left.right.right=42&amp;left.right.anim=43&amp;left.right.block=44&amp;left.right.layout=45&amp;right=46&amp;anim=47&amp;fuse=48&amp;speed=49&amp;hide+inputs=50&amp;spin=51&amp;block=52&amp;layout=53&amp;scheme=54&amp;gap=55&amp;scatter=56&amp;molecule=57&amp;blast=58&amp;deco=59&amp;legends=60&amp;shape=61&amp;spotlight=62&amp;row+guides=63&amp;flow+guides=64&amp;lens+size=65&amp;magnification=66&amp;interior+spotlight=67&amp;axes=68&amp;viz=69&amp;sensitivity=70&amp;min+size=71&amp;min+light=72&amp;max+light=73&amp;elem+scale=74&amp;zero+hue=75&amp;hue+gap=76&amp;hue+spread=77&amp;diag=78&amp;cam=79&amp;x=80&amp;y=81&amp;z=82&amp;cam.target=83&amp;compress=84">patterns seen in the input</a> are themselves thought-provoking - in particular, the strong vertical threads are particular embedding positions whose values are uniformly high magnitude across long stretches of the sequence - sometimes almost the entire thing.</li>
  <li>Interestingly, though, the <a href="https://bhosmer.github.io/mm/index.html?0=out%20%3D%20(attn%20%3D%20(Q%20%3D%20input%20%40%20wQ)%20%40%20(K_t%20%3D%20wK_t%20%40%20input_t))%20%40%20(V%20%3D%20input%20%40%20wV)%20%40%20wO&amp;1=out&amp;2=none&amp;24=closed&amp;84=true&amp;3.1=attn%20%40%20V&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row%20major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.2=none&amp;12.13=vmprod&amp;14.15=1&amp;16.17=positive&amp;16.18=left&amp;16.19=bottom&amp;16.20=back&amp;21.1=attn&amp;21.4=true&amp;21.2=softmax(tril(x%2Fsqrt(k)))&amp;22.1=Q&amp;22.4=true&amp;22.2=none&amp;23.1=input&amp;23.4=false&amp;23.5=256&amp;23.6=768&amp;23.7=url&amp;23.9=-1&amp;23.10=1&amp;23.11=0&amp;23.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;23.0=&amp;23.24=open&amp;25.1=wQ&amp;25.4=false&amp;25.5=768&amp;25.6=64&amp;25.7=url&amp;25.9=-1&amp;25.10=1&amp;25.11=0&amp;25.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wq4_768_64.csv&amp;25.0=&amp;26.13=vmprod&amp;27.15=1&amp;28.17=positive&amp;28.18=left&amp;28.19=bottom&amp;28.20=back&amp;22.24=open&amp;29.2=none&amp;30.13=none&amp;31.15=1&amp;32.17=positive&amp;32.18=right&amp;32.19=top&amp;32.20=back&amp;33.1=wK_t&amp;33.4=false&amp;33.5=64&amp;33.6=768&amp;33.7=url&amp;33.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wk_t4_64_768.csv&amp;33.9=-1&amp;33.10=1&amp;33.11=0&amp;33.0=&amp;34.1=input_t&amp;34.4=false&amp;34.5=768&amp;34.6=256&amp;34.7=url&amp;34.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input_t0_768_256.csv&amp;34.9=-1&amp;34.10=1&amp;34.11=0&amp;34.0=&amp;29.1=K_t&amp;29.4=true&amp;35.13=vmprod&amp;36.15=1&amp;37.17=negative&amp;37.18=left&amp;37.19=top&amp;37.20=front&amp;21.24=open&amp;38.1=V&amp;38.4=true&amp;38.2=none&amp;39.1=input&amp;39.4=false&amp;39.5=256&amp;39.6=768&amp;39.7=url&amp;39.9=-1&amp;39.10=1&amp;39.11=0&amp;39.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;39.0=&amp;40.1=wV&amp;40.4=false&amp;40.5=768&amp;40.6=64&amp;40.7=url&amp;40.9=-1&amp;40.10=1&amp;40.11=0&amp;40.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wv4_768_64.csv&amp;40.0=&amp;41.13=none&amp;42.15=1&amp;43.17=negative&amp;43.18=right&amp;43.19=top&amp;43.20=back&amp;3.24=open&amp;44.1=wO&amp;44.4=false&amp;44.5=64&amp;44.6=768&amp;44.7=url&amp;44.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wo4_64_768.csv&amp;44.9=-1&amp;44.10=1&amp;44.11=0&amp;44.0=&amp;45.46=sync&amp;45.47=16&amp;45.48=false&amp;45.13=none&amp;45.49=0&amp;45.24=open&amp;50.51=1&amp;50.52=1&amp;50.15=1&amp;53.54=blocks&amp;53.55=24&amp;53.56=0&amp;53.57=1&amp;53.58=0&amp;53.17=negative&amp;53.18=left&amp;53.19=top&amp;53.20=front&amp;59.60=10&amp;59.61=true&amp;59.62=5&amp;59.63=0.394&amp;59.64=0&amp;59.65=0&amp;59.66=4.632&amp;59.67=false&amp;59.68=false&amp;59.24=open&amp;69.70=local&amp;69.71=0.2&amp;69.72=0.4&amp;69.73=0.9&amp;69.74=2&amp;69.75=0.75&amp;69.76=0.75&amp;69.77=0.03&amp;69.24=open&amp;78.8=&amp;78.24=open&amp;79.80=-905.2149526505231&amp;79.81=126.10717525695773&amp;79.82=-90.1644865901155&amp;83.80=-739.2766627330938&amp;83.81=125.47333863007341&amp;83.82=-229.39828071999955&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;left.anim=12&amp;alg=13&amp;left.block=14&amp;k%20blocks=15&amp;left.layout=16&amp;polarity=17&amp;left%20placement=18&amp;right%20placement=19&amp;result%20placement=20&amp;left.left=21&amp;left.left.left=22&amp;left.left.left.left=23&amp;folder=24&amp;left.left.left.right=25&amp;left.left.left.anim=26&amp;left.left.left.block=27&amp;left.left.left.layout=28&amp;left.left.right=29&amp;left.left.right.anim=30&amp;left.left.right.block=31&amp;left.left.right.layout=32&amp;left.left.right.left=33&amp;left.left.right.right=34&amp;left.left.anim=35&amp;left.left.block=36&amp;left.left.layout=37&amp;left.right=38&amp;left.right.left=39&amp;left.right.right=40&amp;left.right.anim=41&amp;left.right.block=42&amp;left.right.layout=43&amp;right=44&amp;anim=45&amp;fuse=46&amp;speed=47&amp;hide%20inputs=48&amp;spin=49&amp;block=50&amp;i%20blocks=51&amp;j%20blocks=52&amp;layout=53&amp;scheme=54&amp;gap=55&amp;scatter=56&amp;molecule=57&amp;blast=58&amp;deco=59&amp;legends=60&amp;shape=61&amp;spotlight=62&amp;row%20guides=63&amp;flow%20guides=64&amp;lens%20size=65&amp;magnification=66&amp;interior%20spotlight=67&amp;axes=68&amp;viz=69&amp;sensitivity=70&amp;min%20size=71&amp;min%20light=72&amp;max%20light=73&amp;elem%20scale=74&amp;zero%20hue=75&amp;hue%20gap=76&amp;hue%20spread=77&amp;diag=78&amp;cam=79&amp;x=80&amp;y=81&amp;z=82&amp;cam.target=83&amp;compress=84">first vector in the input sequence is distinctive</a>, not only breaking the pattern of these high-magnitude columns but carrying atypical values at almost every position (aside: not visualized here, but this pattern is repeated over multiple sample inputs).</li>
</ul>

<p>Note: apropos of the last two bullet points, it’s worth reiterating that we’re visualizing computation over a <em>single sample input</em>. In practice I’ve found that each head has a characteristic pattern it will express consistently (though not identically) over a decent collection of samples (and the upcoming attention head browser will provide a collection of samples to play with), but when looking at any visualization that includes activations, it’s important to bear in mind that a full distribution of inputs may influence the ideas and intuitions it provokes it in subtle ways.</p>

<p>Finally, one more pitch to <a href="https://bhosmer.github.io/mm/index.html?0=out%20%3D%20(attn%20%3D%20(Q%20%3D%20input_0_5%20%40%20wQ_5_4)%20%40%20(K_t%20%3D%20wK_t_5_4%20%40%20input_t_0_5))%20%40%20(V%20%3D%20input_0_5%20%40%20wV_5_4)%20%40%20wO_5_4&amp;1=out&amp;2=none&amp;49=closed&amp;84=true&amp;3.1=attn%20%40%20V&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row%20major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.2=none&amp;12.13=vmprod&amp;14.15=1&amp;16.17=positive&amp;16.18=left&amp;16.19=bottom&amp;16.20=back&amp;21.1=attn&amp;21.4=true&amp;21.2=softmax(tril(x%2Fsqrt(k)))&amp;22.1=Q&amp;22.4=true&amp;22.2=none&amp;23.1=input_0_5&amp;23.4=false&amp;23.5=256&amp;23.6=768&amp;23.7=url&amp;23.9=-1&amp;23.10=1&amp;23.11=0&amp;23.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;23.0=&amp;24.1=wQ_5_4&amp;24.4=false&amp;24.5=768&amp;24.6=64&amp;24.7=url&amp;24.9=-1&amp;24.10=1&amp;24.11=0&amp;24.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wq4_768_64.csv&amp;24.0=&amp;25.13=vmprod&amp;26.15=1&amp;27.17=positive&amp;27.18=left&amp;27.19=bottom&amp;27.20=back&amp;28.2=none&amp;29.13=none&amp;30.15=1&amp;31.17=positive&amp;31.18=right&amp;31.19=top&amp;31.20=back&amp;32.1=wK_t_5_4&amp;32.4=false&amp;32.5=64&amp;32.6=768&amp;32.7=url&amp;32.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wk_t4_64_768.csv&amp;32.9=-1&amp;32.10=1&amp;32.11=0&amp;32.0=&amp;33.1=input_t_0_5&amp;33.4=false&amp;33.5=768&amp;33.6=256&amp;33.7=url&amp;33.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input_t0_768_256.csv&amp;33.9=-1&amp;33.10=1&amp;33.11=0&amp;33.0=&amp;28.1=K_t&amp;28.4=true&amp;34.13=vmprod&amp;35.15=1&amp;36.17=negative&amp;36.18=left&amp;36.19=top&amp;36.20=front&amp;37.1=V&amp;37.4=true&amp;37.2=none&amp;38.1=input_0_5&amp;38.4=false&amp;38.5=256&amp;38.6=768&amp;38.7=url&amp;38.9=-1&amp;38.10=1&amp;38.11=0&amp;38.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;38.0=&amp;39.1=wV_5_4&amp;39.4=false&amp;39.5=768&amp;39.6=64&amp;39.7=url&amp;39.9=-1&amp;39.10=1&amp;39.11=0&amp;39.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wv4_768_64.csv&amp;39.0=&amp;40.13=none&amp;41.15=1&amp;42.17=negative&amp;42.18=right&amp;42.19=top&amp;42.20=back&amp;43.1=wO_5_4&amp;43.4=false&amp;43.5=64&amp;43.6=768&amp;43.7=url&amp;43.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wo4_64_768.csv&amp;43.9=-1&amp;43.10=1&amp;43.11=0&amp;43.0=&amp;44.45=sync&amp;44.46=16&amp;44.47=false&amp;44.13=vmprod&amp;44.48=0&amp;44.49=open&amp;50.51=1&amp;50.52=1&amp;50.15=1&amp;53.54=blocks&amp;53.55=24&amp;53.56=0&amp;53.57=1&amp;53.58=0&amp;53.17=negative&amp;53.18=left&amp;53.19=top&amp;53.20=front&amp;59.60=8.38&amp;59.61=true&amp;59.62=4&amp;59.63=0.394&amp;59.64=0&amp;59.65=0.5&amp;59.66=12&amp;59.67=false&amp;59.68=false&amp;59.49=open&amp;69.70=local&amp;69.71=0.05&amp;69.72=0.2&amp;69.73=0.9&amp;69.74=2&amp;69.75=0.75&amp;69.76=0.75&amp;69.77=0.03&amp;78.8=&amp;79.80=-382.8684269325278&amp;79.81=293.7591554956184&amp;79.82=395.95878922315694&amp;83.80=-14.023727291338966&amp;83.81=-38.22974037070054&amp;83.82=-84.10726407282482&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;left.anim=12&amp;alg=13&amp;left.block=14&amp;k%20blocks=15&amp;left.layout=16&amp;polarity=17&amp;left%20placement=18&amp;right%20placement=19&amp;result%20placement=20&amp;left.left=21&amp;left.left.left=22&amp;left.left.left.left=23&amp;left.left.left.right=24&amp;left.left.left.anim=25&amp;left.left.left.block=26&amp;left.left.left.layout=27&amp;left.left.right=28&amp;left.left.right.anim=29&amp;left.left.right.block=30&amp;left.left.right.layout=31&amp;left.left.right.left=32&amp;left.left.right.right=33&amp;left.left.anim=34&amp;left.left.block=35&amp;left.left.layout=36&amp;left.right=37&amp;left.right.left=38&amp;left.right.right=39&amp;left.right.anim=40&amp;left.right.block=41&amp;left.right.layout=42&amp;right=43&amp;anim=44&amp;fuse=45&amp;speed=46&amp;hide%20inputs=47&amp;spin=48&amp;folder=49&amp;block=50&amp;i%20blocks=51&amp;j%20blocks=52&amp;layout=53&amp;scheme=54&amp;gap=55&amp;scatter=56&amp;molecule=57&amp;blast=58&amp;deco=59&amp;legends=60&amp;shape=61&amp;spotlight=62&amp;row%20guides=63&amp;flow%20guides=64&amp;lens%20size=65&amp;magnification=66&amp;interior%20spotlight=67&amp;axes=68&amp;viz=69&amp;sensitivity=70&amp;min%20size=71&amp;min%20light=72&amp;max%20light=73&amp;elem%20scale=74&amp;zero%20hue=75&amp;hue%20gap=76&amp;hue%20spread=77&amp;diag=78&amp;cam=79&amp;x=80&amp;y=81&amp;z=82&amp;cam.target=83&amp;compress=84">explore the animation directly</a>!</p>

<h3 id="4c-heads-are-different-in-interesting-ways">4c Heads are different in interesting ways</h3>

<p>Before we move on, here’s one more demonstration of the usefulness of simply poking around a model to see how it works in detail.</p>

<p>This is another attention head from GPT2. It behaves quite differently from layer 5, head 4 above - as one might expect, given that it’s in a very different part of the model. This head is in the very first layer: layer 0, head 2 (<a href="https://bhosmer.github.io/mm/index.html?0=out%20%3D%20(attn%20%3D%20(Q%20%3D%20input_0_0%20%40%20wQ_0_2)%20%40%20(K_t%20%3D%20wK_t_0_2%20%40%20input_t_0_0))%20%40%20(V%20%3D%20input_0_0%20%40%20wV_0_2)%20%40%20wO_0_2&amp;1=out&amp;2=none&amp;49=closed&amp;84=true&amp;3.1=attn%20%40%20V&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row%20major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.2=none&amp;12.13=vmprod&amp;14.15=1&amp;16.17=positive&amp;16.18=left&amp;16.19=bottom&amp;16.20=back&amp;21.1=attn&amp;21.4=true&amp;21.2=softmax(tril(x%2Fsqrt(k)))&amp;22.1=Q&amp;22.4=true&amp;22.2=none&amp;23.1=input_0_0&amp;23.4=false&amp;23.5=256&amp;23.6=768&amp;23.7=url&amp;23.9=-1&amp;23.10=1&amp;23.11=0&amp;23.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_input0_256_768.csv&amp;23.0=&amp;24.1=wQ_0_2&amp;24.4=false&amp;24.5=768&amp;24.6=64&amp;24.7=url&amp;24.9=-1&amp;24.10=1&amp;24.11=0&amp;24.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wq2_768_64.csv&amp;24.0=&amp;25.13=none&amp;26.15=1&amp;27.17=positive&amp;27.18=left&amp;27.19=bottom&amp;27.20=back&amp;28.2=none&amp;29.13=none&amp;30.15=1&amp;31.17=positive&amp;31.18=right&amp;31.19=top&amp;31.20=back&amp;32.1=wK_t_0_2&amp;32.4=false&amp;32.5=64&amp;32.6=768&amp;32.7=url&amp;32.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wk_t2_64_768.csv&amp;32.9=-1&amp;32.10=1&amp;32.11=0&amp;32.0=&amp;33.1=input_t_0_0&amp;33.4=false&amp;33.5=768&amp;33.6=256&amp;33.7=url&amp;33.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_input_t0_768_256.csv&amp;33.9=-1&amp;33.10=1&amp;33.11=0&amp;33.0=&amp;28.1=K_t&amp;28.4=true&amp;34.13=none&amp;35.15=1&amp;36.17=negative&amp;36.18=left&amp;36.19=top&amp;36.20=front&amp;37.1=V&amp;37.4=true&amp;37.2=none&amp;38.1=input_0_0&amp;38.4=false&amp;38.5=256&amp;38.6=768&amp;38.7=url&amp;38.9=-1&amp;38.10=1&amp;38.11=0&amp;38.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_input0_256_768.csv&amp;38.0=&amp;39.1=wV_0_2&amp;39.4=false&amp;39.5=768&amp;39.6=64&amp;39.7=url&amp;39.9=-1&amp;39.10=1&amp;39.11=0&amp;39.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wv2_768_64.csv&amp;39.0=&amp;40.13=none&amp;41.15=1&amp;42.17=negative&amp;42.18=right&amp;42.19=top&amp;42.20=back&amp;43.1=wO_0_2&amp;43.4=false&amp;43.5=64&amp;43.6=768&amp;43.7=url&amp;43.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wo2_64_768.csv&amp;43.9=-1&amp;43.10=1&amp;43.11=0&amp;43.0=&amp;44.45=sync&amp;44.46=16&amp;44.47=false&amp;44.13=none&amp;44.48=0&amp;44.49=open&amp;50.51=1&amp;50.52=1&amp;50.15=1&amp;53.54=blocks&amp;53.55=24&amp;53.56=0&amp;53.57=1&amp;53.58=0&amp;53.17=negative&amp;53.18=left&amp;53.19=top&amp;53.20=front&amp;59.60=6&amp;59.61=true&amp;59.62=4&amp;59.63=0.73&amp;59.64=0&amp;59.65=0.5&amp;59.66=12&amp;59.67=false&amp;59.68=false&amp;59.49=open&amp;69.70=local&amp;69.71=0.2&amp;69.72=0.2&amp;69.73=0.9&amp;69.74=2&amp;69.75=0.75&amp;69.76=0.75&amp;69.77=0.03&amp;69.49=open&amp;78.8=&amp;78.49=open&amp;79.80=-217.09372134188362&amp;79.81=412.82010718887307&amp;79.82=523.3596617096426&amp;83.80=127.59196458710655&amp;83.81=35.32022663933653&amp;83.82=87.43354119148215&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;left.anim=12&amp;alg=13&amp;left.block=14&amp;k%20blocks=15&amp;left.layout=16&amp;polarity=17&amp;left%20placement=18&amp;right%20placement=19&amp;result%20placement=20&amp;left.left=21&amp;left.left.left=22&amp;left.left.left.left=23&amp;left.left.left.right=24&amp;left.left.left.anim=25&amp;left.left.left.block=26&amp;left.left.left.layout=27&amp;left.left.right=28&amp;left.left.right.anim=29&amp;left.left.right.block=30&amp;left.left.right.layout=31&amp;left.left.right.left=32&amp;left.left.right.right=33&amp;left.left.anim=34&amp;left.left.block=35&amp;left.left.layout=36&amp;left.right=37&amp;left.right.left=38&amp;left.right.right=39&amp;left.right.anim=40&amp;left.right.block=41&amp;left.right.layout=42&amp;right=43&amp;anim=44&amp;fuse=45&amp;speed=46&amp;hide%20inputs=47&amp;spin=48&amp;folder=49&amp;block=50&amp;i%20blocks=51&amp;j%20blocks=52&amp;layout=53&amp;scheme=54&amp;gap=55&amp;scatter=56&amp;molecule=57&amp;blast=58&amp;deco=59&amp;legends=60&amp;shape=61&amp;spotlight=62&amp;row%20guides=63&amp;flow%20guides=64&amp;lens%20size=65&amp;magnification=66&amp;interior%20spotlight=67&amp;axes=68&amp;viz=69&amp;sensitivity=70&amp;min%20size=71&amp;min%20light=72&amp;max%20light=73&amp;elem%20scale=74&amp;zero%20hue=75&amp;hue%20gap=76&amp;hue%20spread=77&amp;diag=78&amp;cam=79&amp;x=80&amp;y=81&amp;z=82&amp;cam.target=83&amp;compress=84">open in mm</a>, may take a few seconds to load model weights):</p>

<p><img src="https://pytorch.org/assets/images/inside-the-matrix/gpt2_0_2c.jpg" alt="This is another attention head from GPT2"></p>

<p>Things to note:</p>

<ul>
  <li>This head spreads attention very evenly. This has the effect of delivering a relatively <em>unweighted</em> average of <code>V</code> (or rather, the appropriate causal prefix of <code>V</code>) to each row in <code>attn @ V</code>, as can be seen in <a href="https://bhosmer.github.io/mm/index.html?0=out%20%3D%20(attn%20%3D%20(Q%20%3D%20input_0_0%20%40%20wQ_0_2)%20%40%20(K_t%20%3D%20wK_t_0_2%20%40%20input_t_0_0))%20%40%20(V%20%3D%20input_0_0%20%40%20wV_0_2)%20%40%20wO_0_2&amp;1=out&amp;2=none&amp;49=closed&amp;84=true&amp;3.1=attn%20%40%20V&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row%20major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.2=none&amp;12.13=vmprod&amp;14.15=1&amp;16.17=positive&amp;16.18=left&amp;16.19=bottom&amp;16.20=back&amp;21.1=attn&amp;21.4=true&amp;21.2=softmax(tril(x%2Fsqrt(k)))&amp;22.1=Q&amp;22.4=true&amp;22.2=none&amp;23.1=input_0_0&amp;23.4=false&amp;23.5=256&amp;23.6=768&amp;23.7=url&amp;23.9=-1&amp;23.10=1&amp;23.11=0&amp;23.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_input0_256_768.csv&amp;23.0=&amp;24.1=wQ_0_2&amp;24.4=false&amp;24.5=768&amp;24.6=64&amp;24.7=url&amp;24.9=-1&amp;24.10=1&amp;24.11=0&amp;24.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wq2_768_64.csv&amp;24.0=&amp;25.13=none&amp;26.15=1&amp;27.17=positive&amp;27.18=left&amp;27.19=bottom&amp;27.20=back&amp;28.2=none&amp;29.13=none&amp;30.15=1&amp;31.17=positive&amp;31.18=right&amp;31.19=top&amp;31.20=back&amp;32.1=wK_t_0_2&amp;32.4=false&amp;32.5=64&amp;32.6=768&amp;32.7=url&amp;32.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wk_t2_64_768.csv&amp;32.9=-1&amp;32.10=1&amp;32.11=0&amp;32.0=&amp;33.1=input_t_0_0&amp;33.4=false&amp;33.5=768&amp;33.6=256&amp;33.7=url&amp;33.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_input_t0_768_256.csv&amp;33.9=-1&amp;33.10=1&amp;33.11=0&amp;33.0=&amp;28.1=K_t&amp;28.4=true&amp;34.13=none&amp;35.15=1&amp;36.17=negative&amp;36.18=left&amp;36.19=top&amp;36.20=front&amp;37.1=V&amp;37.4=true&amp;37.2=none&amp;38.1=input_0_0&amp;38.4=false&amp;38.5=256&amp;38.6=768&amp;38.7=url&amp;38.9=-1&amp;38.10=1&amp;38.11=0&amp;38.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_input0_256_768.csv&amp;38.0=&amp;39.1=wV_0_2&amp;39.4=false&amp;39.5=768&amp;39.6=64&amp;39.7=url&amp;39.9=-1&amp;39.10=1&amp;39.11=0&amp;39.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wv2_768_64.csv&amp;39.0=&amp;40.13=none&amp;41.15=1&amp;42.17=negative&amp;42.18=right&amp;42.19=top&amp;42.20=back&amp;43.1=wO_0_2&amp;43.4=false&amp;43.5=64&amp;43.6=768&amp;43.7=url&amp;43.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wo2_64_768.csv&amp;43.9=-1&amp;43.10=1&amp;43.11=0&amp;43.0=&amp;44.45=sync&amp;44.46=16&amp;44.47=false&amp;44.13=vmprod&amp;44.48=0&amp;44.49=open&amp;50.51=1&amp;50.52=1&amp;50.15=1&amp;53.54=blocks&amp;53.55=24&amp;53.56=0&amp;53.57=1&amp;53.58=0&amp;53.17=negative&amp;53.18=left&amp;53.19=top&amp;53.20=front&amp;59.60=6&amp;59.61=true&amp;59.62=4&amp;59.63=0.73&amp;59.64=0&amp;59.65=0.5&amp;59.66=12&amp;59.67=false&amp;59.68=false&amp;59.49=closed&amp;69.70=local&amp;69.71=0.4&amp;69.72=0.4&amp;69.73=0.9&amp;69.74=2&amp;69.75=0.75&amp;69.76=0.75&amp;69.77=0.03&amp;69.49=open&amp;78.8=&amp;78.49=closed&amp;79.80=11.34872888812131&amp;79.81=324.07536950158396&amp;79.82=239.8893041928473&amp;83.80=11.804686909150822&amp;83.81=25.33948904441141&amp;83.82=46.896270190786204&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;left.anim=12&amp;alg=13&amp;left.block=14&amp;k%20blocks=15&amp;left.layout=16&amp;polarity=17&amp;left%20placement=18&amp;right%20placement=19&amp;result%20placement=20&amp;left.left=21&amp;left.left.left=22&amp;left.left.left.left=23&amp;left.left.left.right=24&amp;left.left.left.anim=25&amp;left.left.left.block=26&amp;left.left.left.layout=27&amp;left.left.right=28&amp;left.left.right.anim=29&amp;left.left.right.block=30&amp;left.left.right.layout=31&amp;left.left.right.left=32&amp;left.left.right.right=33&amp;left.left.anim=34&amp;left.left.block=35&amp;left.left.layout=36&amp;left.right=37&amp;left.right.left=38&amp;left.right.right=39&amp;left.right.anim=40&amp;left.right.block=41&amp;left.right.layout=42&amp;right=43&amp;anim=44&amp;fuse=45&amp;speed=46&amp;hide%20inputs=47&amp;spin=48&amp;folder=49&amp;block=50&amp;i%20blocks=51&amp;j%20blocks=52&amp;layout=53&amp;scheme=54&amp;gap=55&amp;scatter=56&amp;molecule=57&amp;blast=58&amp;deco=59&amp;legends=60&amp;shape=61&amp;spotlight=62&amp;row%20guides=63&amp;flow%20guides=64&amp;lens%20size=65&amp;magnification=66&amp;interior%20spotlight=67&amp;axes=68&amp;viz=69&amp;sensitivity=70&amp;min%20size=71&amp;min%20light=72&amp;max%20light=73&amp;elem%20scale=74&amp;zero%20hue=75&amp;hue%20gap=76&amp;hue%20spread=77&amp;diag=78&amp;cam=79&amp;x=80&amp;y=81&amp;z=82&amp;cam.target=83&amp;compress=84">this animation</a>: as we move down the attention score triangle, the <code>attn[i] @ V</code> vector-matrix product is small fluctuations away from being simply a downscaled, progressively revealed copy of <code>V</code>.</li>
  <li><code>attn @ V</code> has <a href="https://bhosmer.github.io/mm/index.html?0=out%20%3D%20(attn%20%3D%20(Q%20%3D%20input_0_0%20%40%20wQ_0_2)%20%40%20(K_t%20%3D%20wK_t_0_2%20%40%20input_t_0_0))%20%40%20(V%20%3D%20input_0_0%20%40%20wV_0_2)%20%40%20wO_0_2&amp;1=out&amp;2=none&amp;49=closed&amp;84=true&amp;3.1=attn%20%40%20V&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row%20major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.2=none&amp;12.13=vmprod&amp;14.15=1&amp;16.17=positive&amp;16.18=left&amp;16.19=bottom&amp;16.20=back&amp;21.1=attn&amp;21.4=true&amp;21.2=softmax(tril(x%2Fsqrt(k)))&amp;22.1=Q&amp;22.4=true&amp;22.2=none&amp;23.1=input_0_0&amp;23.4=false&amp;23.5=256&amp;23.6=768&amp;23.7=url&amp;23.9=-1&amp;23.10=1&amp;23.11=0&amp;23.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_input0_256_768.csv&amp;23.0=&amp;24.1=wQ_0_2&amp;24.4=false&amp;24.5=768&amp;24.6=64&amp;24.7=url&amp;24.9=-1&amp;24.10=1&amp;24.11=0&amp;24.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wq2_768_64.csv&amp;24.0=&amp;25.13=none&amp;26.15=1&amp;27.17=positive&amp;27.18=left&amp;27.19=bottom&amp;27.20=back&amp;28.2=none&amp;29.13=none&amp;30.15=1&amp;31.17=positive&amp;31.18=right&amp;31.19=top&amp;31.20=back&amp;32.1=wK_t_0_2&amp;32.4=false&amp;32.5=64&amp;32.6=768&amp;32.7=url&amp;32.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wk_t2_64_768.csv&amp;32.9=-1&amp;32.10=1&amp;32.11=0&amp;32.0=&amp;33.1=input_t_0_0&amp;33.4=false&amp;33.5=768&amp;33.6=256&amp;33.7=url&amp;33.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_input_t0_768_256.csv&amp;33.9=-1&amp;33.10=1&amp;33.11=0&amp;33.0=&amp;28.1=K_t&amp;28.4=true&amp;34.13=none&amp;35.15=1&amp;36.17=negative&amp;36.18=left&amp;36.19=top&amp;36.20=front&amp;37.1=V&amp;37.4=true&amp;37.2=none&amp;38.1=input_0_0&amp;38.4=false&amp;38.5=256&amp;38.6=768&amp;38.7=url&amp;38.9=-1&amp;38.10=1&amp;38.11=0&amp;38.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_input0_256_768.csv&amp;38.0=&amp;39.1=wV_0_2&amp;39.4=false&amp;39.5=768&amp;39.6=64&amp;39.7=url&amp;39.9=-1&amp;39.10=1&amp;39.11=0&amp;39.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wv2_768_64.csv&amp;39.0=&amp;40.13=none&amp;41.15=1&amp;42.17=negative&amp;42.18=right&amp;42.19=top&amp;42.20=back&amp;43.1=wO_0_2&amp;43.4=false&amp;43.5=64&amp;43.6=768&amp;43.7=url&amp;43.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wo2_64_768.csv&amp;43.9=-1&amp;43.10=1&amp;43.11=0&amp;43.0=&amp;44.45=sync&amp;44.46=16&amp;44.47=false&amp;44.13=none&amp;44.48=0&amp;44.49=open&amp;50.51=1&amp;50.52=1&amp;50.15=1&amp;53.54=blocks&amp;53.55=24&amp;53.56=0&amp;53.57=1&amp;53.58=0&amp;53.17=negative&amp;53.18=left&amp;53.19=top&amp;53.20=front&amp;59.60=6&amp;59.61=true&amp;59.62=4&amp;59.63=0.73&amp;59.64=0&amp;59.65=0.5&amp;59.66=12&amp;59.67=false&amp;59.68=false&amp;59.49=open&amp;69.70=local&amp;69.71=0.2&amp;69.72=0.2&amp;69.73=0.9&amp;69.74=2&amp;69.75=0.75&amp;69.76=0.75&amp;69.77=0.03&amp;69.49=open&amp;78.8=&amp;78.49=open&amp;79.80=-152.24249732960024&amp;79.81=115.78244265148294&amp;79.82=89.29496035154&amp;83.80=20.231661185991296&amp;83.81=61.75722293832386&amp;83.82=52.45120329048098&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;left.anim=12&amp;alg=13&amp;left.block=14&amp;k%20blocks=15&amp;left.layout=16&amp;polarity=17&amp;left%20placement=18&amp;right%20placement=19&amp;result%20placement=20&amp;left.left=21&amp;left.left.left=22&amp;left.left.left.left=23&amp;left.left.left.right=24&amp;left.left.left.anim=25&amp;left.left.left.block=26&amp;left.left.left.layout=27&amp;left.left.right=28&amp;left.left.right.anim=29&amp;left.left.right.block=30&amp;left.left.right.layout=31&amp;left.left.right.left=32&amp;left.left.right.right=33&amp;left.left.anim=34&amp;left.left.block=35&amp;left.left.layout=36&amp;left.right=37&amp;left.right.left=38&amp;left.right.right=39&amp;left.right.anim=40&amp;left.right.block=41&amp;left.right.layout=42&amp;right=43&amp;anim=44&amp;fuse=45&amp;speed=46&amp;hide%20inputs=47&amp;spin=48&amp;folder=49&amp;block=50&amp;i%20blocks=51&amp;j%20blocks=52&amp;layout=53&amp;scheme=54&amp;gap=55&amp;scatter=56&amp;molecule=57&amp;blast=58&amp;deco=59&amp;legends=60&amp;shape=61&amp;spotlight=62&amp;row%20guides=63&amp;flow%20guides=64&amp;lens%20size=65&amp;magnification=66&amp;interior%20spotlight=67&amp;axes=68&amp;viz=69&amp;sensitivity=70&amp;min%20size=71&amp;min%20light=72&amp;max%20light=73&amp;elem%20scale=74&amp;zero%20hue=75&amp;hue%20gap=76&amp;hue%20spread=77&amp;diag=78&amp;cam=79&amp;x=80&amp;y=81&amp;z=82&amp;cam.target=83&amp;compress=84">striking vertical uniformity</a> - in large columnar regions of the embedding, the same value patterns persist over <em>the entire sequence</em>. One can think of these as properties shared by every token.</li>
  <li>Aside: on the one hand one might expect <em>some</em> uniformity in <code>attn @ V</code> given the effect of very evenly spread attention. But each row has been constructed from only a causal subsequence of <code>V</code> rather than the whole thing - why is that not causing more variation, like a progressive morphing as one moves down the sequence? <a href="https://bhosmer.github.io/mm/index.html?0=out%20%3D%20(attn%20%3D%20(Q%20%3D%20input_0_0%20%40%20wQ_0_2)%20%40%20(K_t%20%3D%20wK_t_0_2%20%40%20input_t_0_0))%20%40%20(V%20%3D%20input_0_0%20%40%20wV_0_2)%20%40%20wO_0_2&amp;1=out&amp;2=none&amp;49=closed&amp;84=true&amp;3.1=attn%20%40%20V&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row%20major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.2=none&amp;12.13=vmprod&amp;14.15=1&amp;16.17=positive&amp;16.18=left&amp;16.19=bottom&amp;16.20=back&amp;21.1=attn&amp;21.4=true&amp;21.2=softmax(tril(x%2Fsqrt(k)))&amp;22.1=Q&amp;22.4=true&amp;22.2=none&amp;23.1=input_0_0&amp;23.4=false&amp;23.5=256&amp;23.6=768&amp;23.7=url&amp;23.9=-1&amp;23.10=1&amp;23.11=0&amp;23.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_input0_256_768.csv&amp;23.0=&amp;24.1=wQ_0_2&amp;24.4=false&amp;24.5=768&amp;24.6=64&amp;24.7=url&amp;24.9=-1&amp;24.10=1&amp;24.11=0&amp;24.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wq2_768_64.csv&amp;24.0=&amp;25.13=none&amp;26.15=1&amp;27.17=positive&amp;27.18=left&amp;27.19=bottom&amp;27.20=back&amp;28.2=none&amp;29.13=none&amp;30.15=1&amp;31.17=positive&amp;31.18=right&amp;31.19=top&amp;31.20=back&amp;32.1=wK_t_0_2&amp;32.4=false&amp;32.5=64&amp;32.6=768&amp;32.7=url&amp;32.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wk_t2_64_768.csv&amp;32.9=-1&amp;32.10=1&amp;32.11=0&amp;32.0=&amp;33.1=input_t_0_0&amp;33.4=false&amp;33.5=768&amp;33.6=256&amp;33.7=url&amp;33.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_input_t0_768_256.csv&amp;33.9=-1&amp;33.10=1&amp;33.11=0&amp;33.0=&amp;28.1=K_t&amp;28.4=true&amp;34.13=none&amp;35.15=1&amp;36.17=negative&amp;36.18=left&amp;36.19=top&amp;36.20=front&amp;37.1=V&amp;37.4=true&amp;37.2=none&amp;38.1=input_0_0&amp;38.4=false&amp;38.5=256&amp;38.6=768&amp;38.7=url&amp;38.9=-1&amp;38.10=1&amp;38.11=0&amp;38.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_input0_256_768.csv&amp;38.0=&amp;39.1=wV_0_2&amp;39.4=false&amp;39.5=768&amp;39.6=64&amp;39.7=url&amp;39.9=-1&amp;39.10=1&amp;39.11=0&amp;39.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wv2_768_64.csv&amp;39.0=&amp;40.13=none&amp;41.15=1&amp;42.17=negative&amp;42.18=right&amp;42.19=top&amp;42.20=back&amp;43.1=wO_0_2&amp;43.4=false&amp;43.5=64&amp;43.6=768&amp;43.7=url&amp;43.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wo2_64_768.csv&amp;43.9=-1&amp;43.10=1&amp;43.11=0&amp;43.0=&amp;44.45=sync&amp;44.46=16&amp;44.47=false&amp;44.13=none&amp;44.48=0&amp;44.49=open&amp;50.51=1&amp;50.52=1&amp;50.15=1&amp;53.54=blocks&amp;53.55=24&amp;53.56=0&amp;53.57=1&amp;53.58=0&amp;53.17=negative&amp;53.18=left&amp;53.19=top&amp;53.20=front&amp;59.60=6&amp;59.61=true&amp;59.62=4&amp;59.63=0.73&amp;59.64=0&amp;59.65=0.5&amp;59.66=12&amp;59.67=false&amp;59.68=false&amp;59.49=open&amp;69.70=local&amp;69.71=0.2&amp;69.72=0.2&amp;69.73=0.9&amp;69.74=2&amp;69.75=0.75&amp;69.76=0.75&amp;69.77=0.03&amp;69.49=open&amp;78.8=&amp;78.49=open&amp;79.80=8.296178745251016&amp;79.81=-533.8678069620822&amp;79.82=35.64126972299759&amp;83.80=8.29674894856322&amp;83.81=36.25749961529174&amp;83.82=35.64126624185369&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;left.anim=12&amp;alg=13&amp;left.block=14&amp;k%20blocks=15&amp;left.layout=16&amp;polarity=17&amp;left%20placement=18&amp;right%20placement=19&amp;result%20placement=20&amp;left.left=21&amp;left.left.left=22&amp;left.left.left.left=23&amp;left.left.left.right=24&amp;left.left.left.anim=25&amp;left.left.left.block=26&amp;left.left.left.layout=27&amp;left.left.right=28&amp;left.left.right.anim=29&amp;left.left.right.block=30&amp;left.left.right.layout=31&amp;left.left.right.left=32&amp;left.left.right.right=33&amp;left.left.anim=34&amp;left.left.block=35&amp;left.left.layout=36&amp;left.right=37&amp;left.right.left=38&amp;left.right.right=39&amp;left.right.anim=40&amp;left.right.block=41&amp;left.right.layout=42&amp;right=43&amp;anim=44&amp;fuse=45&amp;speed=46&amp;hide%20inputs=47&amp;spin=48&amp;folder=49&amp;block=50&amp;i%20blocks=51&amp;j%20blocks=52&amp;layout=53&amp;scheme=54&amp;gap=55&amp;scatter=56&amp;molecule=57&amp;blast=58&amp;deco=59&amp;legends=60&amp;shape=61&amp;spotlight=62&amp;row%20guides=63&amp;flow%20guides=64&amp;lens%20size=65&amp;magnification=66&amp;interior%20spotlight=67&amp;axes=68&amp;viz=69&amp;sensitivity=70&amp;min%20size=71&amp;min%20light=72&amp;max%20light=73&amp;elem%20scale=74&amp;zero%20hue=75&amp;hue%20gap=76&amp;hue%20spread=77&amp;diag=78&amp;cam=79&amp;x=80&amp;y=81&amp;z=82&amp;cam.target=83&amp;compress=84">By visual inspection V isn’t uniform along its length</a>, so the answer must lie in some more subtle property of its distribution of values.</li>
  <li>Finally, this head’s output is <a href="https://bhosmer.github.io/mm/index.html?0=out%20%3D%20(attn%20%3D%20(Q%20%3D%20input_0_0%20%40%20wQ_0_2)%20%40%20(K_t%20%3D%20wK_t_0_2%20%40%20input_t_0_0))%20%40%20(V%20%3D%20input_0_0%20%40%20wV_0_2)%20%40%20wO_0_2&amp;1=out&amp;2=none&amp;49=closed&amp;84=true&amp;3.1=attn%20%40%20V&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row%20major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.2=none&amp;12.13=vmprod&amp;14.15=1&amp;16.17=positive&amp;16.18=left&amp;16.19=bottom&amp;16.20=back&amp;21.1=attn&amp;21.4=true&amp;21.2=softmax(tril(x%2Fsqrt(k)))&amp;22.1=Q&amp;22.4=true&amp;22.2=none&amp;23.1=input_0_0&amp;23.4=false&amp;23.5=256&amp;23.6=768&amp;23.7=url&amp;23.9=-1&amp;23.10=1&amp;23.11=0&amp;23.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_input0_256_768.csv&amp;23.0=&amp;24.1=wQ_0_2&amp;24.4=false&amp;24.5=768&amp;24.6=64&amp;24.7=url&amp;24.9=-1&amp;24.10=1&amp;24.11=0&amp;24.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wq2_768_64.csv&amp;24.0=&amp;25.13=none&amp;26.15=1&amp;27.17=positive&amp;27.18=left&amp;27.19=bottom&amp;27.20=back&amp;28.2=none&amp;29.13=none&amp;30.15=1&amp;31.17=positive&amp;31.18=right&amp;31.19=top&amp;31.20=back&amp;32.1=wK_t_0_2&amp;32.4=false&amp;32.5=64&amp;32.6=768&amp;32.7=url&amp;32.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wk_t2_64_768.csv&amp;32.9=-1&amp;32.10=1&amp;32.11=0&amp;32.0=&amp;33.1=input_t_0_0&amp;33.4=false&amp;33.5=768&amp;33.6=256&amp;33.7=url&amp;33.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_input_t0_768_256.csv&amp;33.9=-1&amp;33.10=1&amp;33.11=0&amp;33.0=&amp;28.1=K_t&amp;28.4=true&amp;34.13=none&amp;35.15=1&amp;36.17=negative&amp;36.18=left&amp;36.19=top&amp;36.20=front&amp;37.1=V&amp;37.4=true&amp;37.2=none&amp;38.1=input_0_0&amp;38.4=false&amp;38.5=256&amp;38.6=768&amp;38.7=url&amp;38.9=-1&amp;38.10=1&amp;38.11=0&amp;38.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_input0_256_768.csv&amp;38.0=&amp;39.1=wV_0_2&amp;39.4=false&amp;39.5=768&amp;39.6=64&amp;39.7=url&amp;39.9=-1&amp;39.10=1&amp;39.11=0&amp;39.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wv2_768_64.csv&amp;39.0=&amp;40.13=none&amp;41.15=1&amp;42.17=negative&amp;42.18=right&amp;42.19=top&amp;42.20=back&amp;43.1=wO_0_2&amp;43.4=false&amp;43.5=64&amp;43.6=768&amp;43.7=url&amp;43.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wo2_64_768.csv&amp;43.9=-1&amp;43.10=1&amp;43.11=0&amp;43.0=&amp;44.45=sync&amp;44.46=16&amp;44.47=false&amp;44.13=none&amp;44.48=0&amp;44.49=open&amp;50.51=1&amp;50.52=1&amp;50.15=1&amp;53.54=blocks&amp;53.55=24&amp;53.56=0&amp;53.57=1&amp;53.58=0&amp;53.17=negative&amp;53.18=left&amp;53.19=top&amp;53.20=front&amp;59.60=6&amp;59.61=true&amp;59.62=4&amp;59.63=0.73&amp;59.64=0&amp;59.65=0.5&amp;59.66=12&amp;59.67=false&amp;59.68=false&amp;59.49=open&amp;69.70=local&amp;69.71=0.2&amp;69.72=0.2&amp;69.73=0.9&amp;69.74=2&amp;69.75=0.75&amp;69.76=0.75&amp;69.77=0.03&amp;69.49=open&amp;78.8=&amp;78.49=open&amp;79.80=41.37507219272118&amp;79.81=4.367136718959145&amp;79.82=430.5595129727994&amp;83.80=607.5332301692057&amp;83.81=-2.548000389888877&amp;83.82=-122.74351758382484&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;left.anim=12&amp;alg=13&amp;left.block=14&amp;k%20blocks=15&amp;left.layout=16&amp;polarity=17&amp;left%20placement=18&amp;right%20placement=19&amp;result%20placement=20&amp;left.left=21&amp;left.left.left=22&amp;left.left.left.left=23&amp;left.left.left.right=24&amp;left.left.left.anim=25&amp;left.left.left.block=26&amp;left.left.left.layout=27&amp;left.left.right=28&amp;left.left.right.anim=29&amp;left.left.right.block=30&amp;left.left.right.layout=31&amp;left.left.right.left=32&amp;left.left.right.right=33&amp;left.left.anim=34&amp;left.left.block=35&amp;left.left.layout=36&amp;left.right=37&amp;left.right.left=38&amp;left.right.right=39&amp;left.right.anim=40&amp;left.right.block=41&amp;left.right.layout=42&amp;right=43&amp;anim=44&amp;fuse=45&amp;speed=46&amp;hide%20inputs=47&amp;spin=48&amp;folder=49&amp;block=50&amp;i%20blocks=51&amp;j%20blocks=52&amp;layout=53&amp;scheme=54&amp;gap=55&amp;scatter=56&amp;molecule=57&amp;blast=58&amp;deco=59&amp;legends=60&amp;shape=61&amp;spotlight=62&amp;row%20guides=63&amp;flow%20guides=64&amp;lens%20size=65&amp;magnification=66&amp;interior%20spotlight=67&amp;axes=68&amp;viz=69&amp;sensitivity=70&amp;min%20size=71&amp;min%20light=72&amp;max%20light=73&amp;elem%20scale=74&amp;zero%20hue=75&amp;hue%20gap=76&amp;hue%20spread=77&amp;diag=78&amp;cam=79&amp;x=80&amp;y=81&amp;z=82&amp;cam.target=83&amp;compress=84">even more vertically uniform after out-projection</a></li>
  <li>the strong impression being that the bulk of the information being delivered by this attention head consists of properties which are shared by every token in the sequence. The composition of its <a href="https://bhosmer.github.io/mm/index.html?0=out%20%3D%20(attn%20%3D%20(Q%20%3D%20input_0_0%20%40%20wQ_0_2)%20%40%20(K_t%20%3D%20wK_t_0_2%20%40%20input_t_0_0))%20%40%20(V%20%3D%20input_0_0%20%40%20wV_0_2)%20%40%20wO_0_2&amp;1=out&amp;2=none&amp;49=closed&amp;84=true&amp;3.1=attn%20%40%20V&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row%20major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.2=none&amp;12.13=vmprod&amp;14.15=1&amp;16.17=positive&amp;16.18=left&amp;16.19=bottom&amp;16.20=back&amp;21.1=attn&amp;21.4=true&amp;21.2=softmax(tril(x%2Fsqrt(k)))&amp;22.1=Q&amp;22.4=true&amp;22.2=none&amp;23.1=input_0_0&amp;23.4=false&amp;23.5=256&amp;23.6=768&amp;23.7=url&amp;23.9=-1&amp;23.10=1&amp;23.11=0&amp;23.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_input0_256_768.csv&amp;23.0=&amp;24.1=wQ_0_2&amp;24.4=false&amp;24.5=768&amp;24.6=64&amp;24.7=url&amp;24.9=-1&amp;24.10=1&amp;24.11=0&amp;24.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wq2_768_64.csv&amp;24.0=&amp;25.13=none&amp;26.15=1&amp;27.17=positive&amp;27.18=left&amp;27.19=bottom&amp;27.20=back&amp;28.2=none&amp;29.13=none&amp;30.15=1&amp;31.17=positive&amp;31.18=right&amp;31.19=top&amp;31.20=back&amp;32.1=wK_t_0_2&amp;32.4=false&amp;32.5=64&amp;32.6=768&amp;32.7=url&amp;32.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wk_t2_64_768.csv&amp;32.9=-1&amp;32.10=1&amp;32.11=0&amp;32.0=&amp;33.1=input_t_0_0&amp;33.4=false&amp;33.5=768&amp;33.6=256&amp;33.7=url&amp;33.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_input_t0_768_256.csv&amp;33.9=-1&amp;33.10=1&amp;33.11=0&amp;33.0=&amp;28.1=K_t&amp;28.4=true&amp;34.13=none&amp;35.15=1&amp;36.17=negative&amp;36.18=left&amp;36.19=top&amp;36.20=front&amp;37.1=V&amp;37.4=true&amp;37.2=none&amp;38.1=input_0_0&amp;38.4=false&amp;38.5=256&amp;38.6=768&amp;38.7=url&amp;38.9=-1&amp;38.10=1&amp;38.11=0&amp;38.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_input0_256_768.csv&amp;38.0=&amp;39.1=wV_0_2&amp;39.4=false&amp;39.5=768&amp;39.6=64&amp;39.7=url&amp;39.9=-1&amp;39.10=1&amp;39.11=0&amp;39.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wv2_768_64.csv&amp;39.0=&amp;40.13=none&amp;41.15=1&amp;42.17=negative&amp;42.18=right&amp;42.19=top&amp;42.20=back&amp;43.1=wO_0_2&amp;43.4=false&amp;43.5=64&amp;43.6=768&amp;43.7=url&amp;43.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wo2_64_768.csv&amp;43.9=-1&amp;43.10=1&amp;43.11=0&amp;43.0=&amp;44.45=sync&amp;44.46=16&amp;44.47=false&amp;44.13=none&amp;44.48=0&amp;44.49=open&amp;50.51=1&amp;50.52=1&amp;50.15=1&amp;53.54=blocks&amp;53.55=24&amp;53.56=0&amp;53.57=1&amp;53.58=0&amp;53.17=negative&amp;53.18=left&amp;53.19=top&amp;53.20=front&amp;59.60=6&amp;59.61=true&amp;59.62=4&amp;59.63=0.73&amp;59.64=0&amp;59.65=0.5&amp;59.66=12&amp;59.67=false&amp;59.68=false&amp;59.49=open&amp;69.70=local&amp;69.71=0.2&amp;69.72=0.2&amp;69.73=0.9&amp;69.74=2&amp;69.75=0.75&amp;69.76=0.75&amp;69.77=0.03&amp;69.49=open&amp;78.8=&amp;78.49=open&amp;79.80=136.19712021298585&amp;79.81=351.47497630691043&amp;79.82=254.9066405965837&amp;83.80=554.2569175811409&amp;83.81=-39.63963114876448&amp;83.82=-109.72659308933949&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;left.anim=12&amp;alg=13&amp;left.block=14&amp;k%20blocks=15&amp;left.layout=16&amp;polarity=17&amp;left%20placement=18&amp;right%20placement=19&amp;result%20placement=20&amp;left.left=21&amp;left.left.left=22&amp;left.left.left.left=23&amp;left.left.left.right=24&amp;left.left.left.anim=25&amp;left.left.left.block=26&amp;left.left.left.layout=27&amp;left.left.right=28&amp;left.left.right.anim=29&amp;left.left.right.block=30&amp;left.left.right.layout=31&amp;left.left.right.left=32&amp;left.left.right.right=33&amp;left.left.anim=34&amp;left.left.block=35&amp;left.left.layout=36&amp;left.right=37&amp;left.right.left=38&amp;left.right.right=39&amp;left.right.anim=40&amp;left.right.block=41&amp;left.right.layout=42&amp;right=43&amp;anim=44&amp;fuse=45&amp;speed=46&amp;hide%20inputs=47&amp;spin=48&amp;folder=49&amp;block=50&amp;i%20blocks=51&amp;j%20blocks=52&amp;layout=53&amp;scheme=54&amp;gap=55&amp;scatter=56&amp;molecule=57&amp;blast=58&amp;deco=59&amp;legends=60&amp;shape=61&amp;spotlight=62&amp;row%20guides=63&amp;flow%20guides=64&amp;lens%20size=65&amp;magnification=66&amp;interior%20spotlight=67&amp;axes=68&amp;viz=69&amp;sensitivity=70&amp;min%20size=71&amp;min%20light=72&amp;max%20light=73&amp;elem%20scale=74&amp;zero%20hue=75&amp;hue%20gap=76&amp;hue%20spread=77&amp;diag=78&amp;cam=79&amp;x=80&amp;y=81&amp;z=82&amp;cam.target=83&amp;compress=84">output projection weights</a> reinforces this intuition.</li>
</ul>

<p>Overall, it’s hard to resist the idea that the extremely regular, highly structured information this attention head produces might be obtained by computational means that are a bit… less lavish. Of course this isn’t an unexplored area, but the specificity and richness of signal of the visualized computation has been useful in generating new ideas, and reasoning about existing ones.</p>

<h3 id="4d-revisiting-the-pitch-invariants-for-free">4d Revisiting the pitch: invariants for free</h3>

<p>Stepping back, it’s worth reiterating that the reason we can visualize nontrivially compound operations like attention heads and have them remain intuitive is that important algebraic properties - like how argument shapes are constrained, or which parallelization axes intersect which operations - <em>don’t require additional thinking</em>: they arise directly from the geometry of the visualized object, rather than being additional rules to keep in mind.</p>

<p>For example, in these attention head visualizations it’s immediately obvious that</p>

<ul>
  <li><code>Q</code> and <code>attn @ V</code> are the same length, <code>K</code> and <code>V</code> are the same length, and the lengths of these pairs are independent of each other</li>
  <li><code>Q</code> and <code>K</code> are the same width, <code>V</code> and <code>attn @ V</code> are the same width, and the widths of these pairs are independent of each other.</li>
</ul>

<p>These properties are true by construction, as a simple consequence of which parts of the compound structure the constituents inhabit and how they are oriented.</p>

<p>This “properties for free” benefit can be especially useful when exploring variations on a canonical structure - an obvious example being the one-row-high attention matrix in autoregressive token-at-a-time decoding (<a href="https://bhosmer.github.io/mm/index.html?0=out%20%3D%20(attn%20%3D%20(Q%20%3D%20input_0_5%20%40%20wQ_5_4)%20%40%20(K_t%20%3D%20wK_t_5_4%20%40%20input_t_0_5))%20%40%20(V%20%3D%20input_0_5%20%40%20wV_5_4)%20%40%20wO_5_4&amp;1=out&amp;2=none&amp;24=closed&amp;84=true&amp;3.1=attn%20%40%20V&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row%20major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.2=none&amp;12.13=vmprod&amp;14.15=1&amp;16.17=positive&amp;16.18=left&amp;16.19=bottom&amp;16.20=back&amp;21.1=attn&amp;21.4=true&amp;21.2=softmax(x%2Fsqrt(k))&amp;22.1=Q&amp;22.4=true&amp;22.2=none&amp;23.1=input_0_5&amp;23.4=false&amp;23.5=1&amp;23.6=768&amp;23.7=url&amp;23.9=-1&amp;23.10=1&amp;23.11=0&amp;23.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;23.0=&amp;23.24=open&amp;25.1=wQ_5_4&amp;25.4=false&amp;25.5=768&amp;25.6=64&amp;25.7=url&amp;25.9=-1&amp;25.10=1&amp;25.11=0&amp;25.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wq4_768_64.csv&amp;25.0=&amp;26.13=vmprod&amp;27.15=1&amp;28.17=positive&amp;28.18=left&amp;28.19=bottom&amp;28.20=back&amp;22.24=open&amp;29.2=none&amp;30.13=none&amp;31.15=1&amp;32.17=positive&amp;32.18=right&amp;32.19=top&amp;32.20=back&amp;33.1=wK_t_5_4&amp;33.4=false&amp;33.5=64&amp;33.6=768&amp;33.7=url&amp;33.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wk_t4_64_768.csv&amp;33.9=-1&amp;33.10=1&amp;33.11=0&amp;33.0=&amp;34.1=input_t_0_5&amp;34.4=false&amp;34.5=768&amp;34.6=256&amp;34.7=url&amp;34.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input_t0_768_256.csv&amp;34.9=-1&amp;34.10=1&amp;34.11=0&amp;34.0=&amp;29.1=K_t&amp;29.4=true&amp;35.13=vmprod&amp;36.15=1&amp;37.17=negative&amp;37.18=left&amp;37.19=top&amp;37.20=front&amp;21.24=open&amp;38.1=V&amp;38.4=true&amp;38.2=none&amp;39.1=input_0_5&amp;39.4=false&amp;39.5=256&amp;39.6=768&amp;39.7=url&amp;39.9=-1&amp;39.10=1&amp;39.11=0&amp;39.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;39.0=&amp;40.1=wV_5_4&amp;40.4=false&amp;40.5=768&amp;40.6=64&amp;40.7=url&amp;40.9=-1&amp;40.10=1&amp;40.11=0&amp;40.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wv4_768_64.csv&amp;40.0=&amp;41.13=none&amp;42.15=1&amp;43.17=negative&amp;43.18=right&amp;43.19=top&amp;43.20=back&amp;3.24=closed&amp;44.1=wO_5_4&amp;44.4=false&amp;44.5=64&amp;44.6=768&amp;44.7=url&amp;44.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wo4_64_768.csv&amp;44.9=-1&amp;44.10=1&amp;44.11=0&amp;44.0=&amp;45.46=sync&amp;45.47=16&amp;45.48=false&amp;45.13=none&amp;45.49=0&amp;45.24=open&amp;50.51=1&amp;50.52=1&amp;50.15=1&amp;53.54=blocks&amp;53.55=24&amp;53.56=0&amp;53.57=1&amp;53.58=0&amp;53.17=negative&amp;53.18=left&amp;53.19=top&amp;53.20=front&amp;59.60=10&amp;59.61=true&amp;59.62=4&amp;59.63=0.394&amp;59.64=0&amp;59.65=0.5&amp;59.66=12&amp;59.67=false&amp;59.68=false&amp;59.24=open&amp;69.70=local&amp;69.71=0.05&amp;69.72=0.2&amp;69.73=0.9&amp;69.74=2&amp;69.75=0.75&amp;69.76=0.75&amp;69.77=0.03&amp;78.8=&amp;79.80=-289.3020871171715&amp;79.81=176.55051931108687&amp;79.82=202.12550566094345&amp;83.80=6.09420901744693&amp;83.81=-60.94451681776672&amp;83.82=-55.94371166611936&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;left.anim=12&amp;alg=13&amp;left.block=14&amp;k%20blocks=15&amp;left.layout=16&amp;polarity=17&amp;left%20placement=18&amp;right%20placement=19&amp;result%20placement=20&amp;left.left=21&amp;left.left.left=22&amp;left.left.left.left=23&amp;folder=24&amp;left.left.left.right=25&amp;left.left.left.anim=26&amp;left.left.left.block=27&amp;left.left.left.layout=28&amp;left.left.right=29&amp;left.left.right.anim=30&amp;left.left.right.block=31&amp;left.left.right.layout=32&amp;left.left.right.left=33&amp;left.left.right.right=34&amp;left.left.anim=35&amp;left.left.block=36&amp;left.left.layout=37&amp;left.right=38&amp;left.right.left=39&amp;left.right.right=40&amp;left.right.anim=41&amp;left.right.block=42&amp;left.right.layout=43&amp;right=44&amp;anim=45&amp;fuse=46&amp;speed=47&amp;hide%20inputs=48&amp;spin=49&amp;block=50&amp;i%20blocks=51&amp;j%20blocks=52&amp;layout=53&amp;scheme=54&amp;gap=55&amp;scatter=56&amp;molecule=57&amp;blast=58&amp;deco=59&amp;legends=60&amp;shape=61&amp;spotlight=62&amp;row%20guides=63&amp;flow%20guides=64&amp;lens%20size=65&amp;magnification=66&amp;interior%20spotlight=67&amp;axes=68&amp;viz=69&amp;sensitivity=70&amp;min%20size=71&amp;min%20light=72&amp;max%20light=73&amp;elem%20scale=74&amp;zero%20hue=75&amp;hue%20gap=76&amp;hue%20spread=77&amp;diag=78&amp;cam=79&amp;x=80&amp;y=81&amp;z=82&amp;cam.target=83&amp;compress=84">open in mm</a>):</p>

<p><img src="https://pytorch.org/assets/images/inside-the-matrix/gpt2_decode2.jpg" alt="the one-row-high attention matrix in autoregressive token-at-a-time decoding"></p>

<h2 id="5-parallelizing-attention">5 Parallelizing attention</h2>

<p>In the animation of head 5, layer 4 above, we visualize 4 of the 6 matmuls in the attention head</p>

<p>as a fused chain of vector-matrix products, confirming the geometric intuition that the entire left-associative chain from input to output is <em>laminar</em> along the shared <code>i</code> axis, and can be parallelized.</p>

<h3 id="5a-example-partitioning-along-i">5a Example: partitioning along <code>i</code></h3>

<p>To parallelize the computation in practice, we would partition the input into blocks along the <code>i</code> axis. We can visualize this partition in the tool, by specifying that a given axis be partitioned into a particular number of blocks - in these examples we’ll use 8, but there’s nothing special about that number.</p>

<p>Among other things, this visualization makes clear that <code>wQ</code> (for in-projection), <code>K_t</code> and <code>V</code> (for attention) and <code>wO</code> (for out-projection) are needed in their entirety by each parallel computation, since they’re adjacent to the partitioned matrices along those matrices’ unpartitioned dimensions (<a href="https://bhosmer.github.io/mm/index.html?0=out%20%3D%20(attn%20%3D%20(Q%20%3D%20input_0_5%20%40%20wQ_5_4)%20%40%20(K_t%20%3D%20wK_t_5_4%20%40%20input_t_0_5))%20%40%20(V%20%3D%20input_0_5%20%40%20wV_5_4)%20%40%20wO_5_4&amp;1=out&amp;2=none&amp;49=closed&amp;84=true&amp;3.1=attn%20%40%20V&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row%20major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.2=none&amp;12.13=vmprod&amp;14.15=1&amp;16.17=positive&amp;16.18=left&amp;16.19=bottom&amp;16.20=back&amp;21.1=attn&amp;21.4=true&amp;21.2=softmax(tril(x%2Fsqrt(k)))&amp;22.1=Q&amp;22.4=true&amp;22.2=none&amp;23.1=input_0_5&amp;23.4=false&amp;23.5=256&amp;23.6=768&amp;23.7=url&amp;23.9=-1&amp;23.10=1&amp;23.11=0&amp;23.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;23.0=&amp;24.1=wQ_5_4&amp;24.4=false&amp;24.5=768&amp;24.6=64&amp;24.7=url&amp;24.9=-1&amp;24.10=1&amp;24.11=0&amp;24.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wq4_768_64.csv&amp;24.0=&amp;25.13=vmprod&amp;26.15=1&amp;27.17=positive&amp;27.18=left&amp;27.19=bottom&amp;27.20=back&amp;28.2=none&amp;29.13=none&amp;30.15=1&amp;31.17=positive&amp;31.18=right&amp;31.19=top&amp;31.20=back&amp;32.1=wK_t_5_4&amp;32.4=false&amp;32.5=64&amp;32.6=768&amp;32.7=url&amp;32.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wk_t4_64_768.csv&amp;32.9=-1&amp;32.10=1&amp;32.11=0&amp;32.0=&amp;33.1=input_t_0_5&amp;33.4=false&amp;33.5=768&amp;33.6=256&amp;33.7=url&amp;33.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input_t0_768_256.csv&amp;33.9=-1&amp;33.10=1&amp;33.11=0&amp;33.0=&amp;28.1=K_t&amp;28.4=true&amp;34.13=vmprod&amp;35.15=1&amp;36.17=negative&amp;36.18=left&amp;36.19=top&amp;36.20=front&amp;37.1=V&amp;37.4=true&amp;37.2=none&amp;38.1=input_0_5&amp;38.4=false&amp;38.5=256&amp;38.6=768&amp;38.7=url&amp;38.9=-1&amp;38.10=1&amp;38.11=0&amp;38.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;38.0=&amp;39.1=wV_5_4&amp;39.4=false&amp;39.5=768&amp;39.6=64&amp;39.7=url&amp;39.9=-1&amp;39.10=1&amp;39.11=0&amp;39.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wv4_768_64.csv&amp;39.0=&amp;40.13=none&amp;41.15=1&amp;42.17=negative&amp;42.18=right&amp;42.19=top&amp;42.20=back&amp;43.1=wO_5_4&amp;43.4=false&amp;43.5=64&amp;43.6=768&amp;43.7=url&amp;43.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wo4_64_768.csv&amp;43.9=-1&amp;43.10=1&amp;43.11=0&amp;43.0=&amp;44.45=sync&amp;44.46=16&amp;44.47=false&amp;44.13=none&amp;44.48=0&amp;44.49=closed&amp;50.51=8&amp;50.52=1&amp;50.15=1&amp;50.49=open&amp;53.54=blocks&amp;53.55=10&amp;53.56=0&amp;53.57=1&amp;53.58=0&amp;53.17=negative&amp;53.18=left&amp;53.19=top&amp;53.20=front&amp;53.49=closed&amp;59.60=10&amp;59.61=true&amp;59.62=4&amp;59.63=0.507&amp;59.64=0&amp;59.65=0.5&amp;59.66=12&amp;59.67=false&amp;59.68=false&amp;59.49=open&amp;69.70=local&amp;69.71=0.2&amp;69.72=0.3&amp;69.73=0.9&amp;69.74=2&amp;69.75=0.75&amp;69.76=0.75&amp;69.77=0.03&amp;69.49=closed&amp;78.8=&amp;78.49=open&amp;79.80=-452.09425433307837&amp;79.81=-10.01467989007457&amp;79.82=392.9851223674549&amp;83.80=-27.91725760321879&amp;83.81=-18.858991089590095&amp;83.82=-140.6826497984033&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;left.anim=12&amp;alg=13&amp;left.block=14&amp;k%20blocks=15&amp;left.layout=16&amp;polarity=17&amp;left%20placement=18&amp;right%20placement=19&amp;result%20placement=20&amp;left.left=21&amp;left.left.left=22&amp;left.left.left.left=23&amp;left.left.left.right=24&amp;left.left.left.anim=25&amp;left.left.left.block=26&amp;left.left.left.layout=27&amp;left.left.right=28&amp;left.left.right.anim=29&amp;left.left.right.block=30&amp;left.left.right.layout=31&amp;left.left.right.left=32&amp;left.left.right.right=33&amp;left.left.anim=34&amp;left.left.block=35&amp;left.left.layout=36&amp;left.right=37&amp;left.right.left=38&amp;left.right.right=39&amp;left.right.anim=40&amp;left.right.block=41&amp;left.right.layout=42&amp;right=43&amp;anim=44&amp;fuse=45&amp;speed=46&amp;hide%20inputs=47&amp;spin=48&amp;folder=49&amp;block=50&amp;i%20blocks=51&amp;j%20blocks=52&amp;layout=53&amp;scheme=54&amp;gap=55&amp;scatter=56&amp;molecule=57&amp;blast=58&amp;deco=59&amp;legends=60&amp;shape=61&amp;spotlight=62&amp;row%20guides=63&amp;flow%20guides=64&amp;lens%20size=65&amp;magnification=66&amp;interior%20spotlight=67&amp;axes=68&amp;viz=69&amp;sensitivity=70&amp;min%20size=71&amp;min%20light=72&amp;max%20light=73&amp;elem%20scale=74&amp;zero%20hue=75&amp;hue%20gap=76&amp;hue%20spread=77&amp;diag=78&amp;cam=79&amp;x=80&amp;y=81&amp;z=82&amp;cam.target=83&amp;compress=84">open in mm</a>):</p>

<p><img src="https://pytorch.org/assets/images/inside-the-matrix/gpt2_parti.jpg" alt="wQ (for in-projection), K_t and V (for attention) and wO (for out-projection) are needed in their entirety by each parallel computation"></p>

<h3 id="5b-example-double-partitioning">5b Example: double partitioning</h3>

<p>As an example of partitioning along <em>multiple</em> axes, we can visualize some recent work which innovates in this space (<a href="https://arxiv.org/pdf/2305.19370.pdf">Block Parallel Transformer</a>, building on work done in e.g. <a href="https://arxiv.org/pdf/2205.14135.pdf">Flash Attention</a> and its antecedents).</p>

<p>First, BPT partitions along <code>i</code> as described above - and actually extends this horizontal partitioning of the sequence into chunks all the way through the second (FFN) half of the attention layer as well. (We’ll visualize this in a later section.)</p>

<p>To fully attack the context length problem, a second partitioning is then added to MHA - that of the attention calculation itself (i.e., a partition along the <code>j</code> axis of <code>Q @ K_t</code>). The two partitions together divide attention into a grid of blocks (<a href="https://bhosmer.github.io/mm/index.html?0=out%20%3D%20(attn%20%3D%20(Q%20%3D%20input_0_5%20%40%20wQ_5_4)%20%40%20(K_t%20%3D%20wK_t_5_4%20%40%20input_t_0_5))%20%40%20(V%20%3D%20input_0_5%20%40%20wV_5_4)%20%40%20wO_5_4&amp;1=out&amp;2=none&amp;16=closed&amp;84=true&amp;3.1=attn%20%40%20V&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row%20major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.2=none&amp;12.13=vmprod&amp;14.15=8&amp;14.16=open&amp;17.18=positive&amp;17.19=left&amp;17.20=bottom&amp;17.21=back&amp;22.1=attn&amp;22.4=true&amp;22.2=softmax(tril(x%2Fsqrt(k)))&amp;23.1=Q&amp;23.4=true&amp;23.2=none&amp;24.1=input_0_5&amp;24.4=false&amp;24.5=256&amp;24.6=768&amp;24.7=url&amp;24.9=-1&amp;24.10=1&amp;24.11=0&amp;24.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;24.0=&amp;25.1=wQ_5_4&amp;25.4=false&amp;25.5=768&amp;25.6=64&amp;25.7=url&amp;25.9=-1&amp;25.10=1&amp;25.11=0&amp;25.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wq4_768_64.csv&amp;25.0=&amp;26.13=vmprod&amp;27.15=1&amp;28.18=positive&amp;28.19=left&amp;28.20=bottom&amp;28.21=back&amp;29.2=none&amp;30.13=none&amp;31.15=1&amp;32.18=positive&amp;32.19=right&amp;32.20=top&amp;32.21=back&amp;33.1=wK_t_5_4&amp;33.4=false&amp;33.5=64&amp;33.6=768&amp;33.7=url&amp;33.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wk_t4_64_768.csv&amp;33.9=-1&amp;33.10=1&amp;33.11=0&amp;33.0=&amp;34.1=input_t_0_5&amp;34.4=false&amp;34.5=768&amp;34.6=256&amp;34.7=url&amp;34.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input_t0_768_256.csv&amp;34.9=-1&amp;34.10=1&amp;34.11=0&amp;34.0=&amp;29.1=K_t&amp;29.4=true&amp;35.13=vmprod&amp;36.15=1&amp;37.18=negative&amp;37.19=left&amp;37.20=top&amp;37.21=front&amp;38.1=V&amp;38.4=true&amp;38.2=none&amp;39.1=input_0_5&amp;39.4=false&amp;39.5=256&amp;39.6=768&amp;39.7=url&amp;39.9=-1&amp;39.10=1&amp;39.11=0&amp;39.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;39.0=&amp;40.1=wV_5_4&amp;40.4=false&amp;40.5=768&amp;40.6=64&amp;40.7=url&amp;40.9=-1&amp;40.10=1&amp;40.11=0&amp;40.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wv4_768_64.csv&amp;40.0=&amp;41.13=none&amp;42.15=1&amp;43.18=negative&amp;43.19=right&amp;43.20=top&amp;43.21=back&amp;3.16=open&amp;44.1=wO_5_4&amp;44.4=false&amp;44.5=64&amp;44.6=768&amp;44.7=url&amp;44.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wo4_64_768.csv&amp;44.9=-1&amp;44.10=1&amp;44.11=0&amp;44.0=&amp;45.46=sync&amp;45.47=16&amp;45.48=false&amp;45.13=none&amp;45.49=0&amp;45.16=closed&amp;50.51=8&amp;50.52=1&amp;50.15=1&amp;50.16=closed&amp;53.54=blocks&amp;53.55=10&amp;53.56=0&amp;53.57=1&amp;53.58=0&amp;53.18=negative&amp;53.19=left&amp;53.20=top&amp;53.21=front&amp;53.16=closed&amp;59.60=10&amp;59.61=true&amp;59.62=4&amp;59.63=0.507&amp;59.64=0&amp;59.65=0.5&amp;59.66=12&amp;59.67=false&amp;59.68=false&amp;59.16=open&amp;69.70=local&amp;69.71=0.2&amp;69.72=0.3&amp;69.73=0.9&amp;69.74=2&amp;69.75=0.75&amp;69.76=0.75&amp;69.77=0.03&amp;69.16=closed&amp;78.8=&amp;78.16=open&amp;79.80=-459.733038437248&amp;79.81=-10.183892342609507&amp;79.82=399.6251724834292&amp;83.80=-27.91725760321879&amp;83.81=-18.858991089590095&amp;83.82=-140.6826497984033&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;left.anim=12&amp;alg=13&amp;left.block=14&amp;k%20blocks=15&amp;folder=16&amp;left.layout=17&amp;polarity=18&amp;left%20placement=19&amp;right%20placement=20&amp;result%20placement=21&amp;left.left=22&amp;left.left.left=23&amp;left.left.left.left=24&amp;left.left.left.right=25&amp;left.left.left.anim=26&amp;left.left.left.block=27&amp;left.left.left.layout=28&amp;left.left.right=29&amp;left.left.right.anim=30&amp;left.left.right.block=31&amp;left.left.right.layout=32&amp;left.left.right.left=33&amp;left.left.right.right=34&amp;left.left.anim=35&amp;left.left.block=36&amp;left.left.layout=37&amp;left.right=38&amp;left.right.left=39&amp;left.right.right=40&amp;left.right.anim=41&amp;left.right.block=42&amp;left.right.layout=43&amp;right=44&amp;anim=45&amp;fuse=46&amp;speed=47&amp;hide%20inputs=48&amp;spin=49&amp;block=50&amp;i%20blocks=51&amp;j%20blocks=52&amp;layout=53&amp;scheme=54&amp;gap=55&amp;scatter=56&amp;molecule=57&amp;blast=58&amp;deco=59&amp;legends=60&amp;shape=61&amp;spotlight=62&amp;row%20guides=63&amp;flow%20guides=64&amp;lens%20size=65&amp;magnification=66&amp;interior%20spotlight=67&amp;axes=68&amp;viz=69&amp;sensitivity=70&amp;min%20size=71&amp;min%20light=72&amp;max%20light=73&amp;elem%20scale=74&amp;zero%20hue=75&amp;hue%20gap=76&amp;hue%20spread=77&amp;diag=78&amp;cam=79&amp;x=80&amp;y=81&amp;z=82&amp;cam.target=83&amp;compress=84">open in mm</a>):</p>

<p><img src="https://pytorch.org/assets/images/inside-the-matrix/gpt2_ik.jpg" alt="The two partitions together divide attention into a grid of blocks"></p>

<p>This visualization makes clear</p>

<ul>
  <li>the effectiveness of this double partitioning as an attack on the context length problem, since we’ve now visibly partitioned every occurrence of sequence length in the attention calculation</li>
  <li>the “reach” of this second partitioning: it’s clear from the geometry that the in-projection computations of <code>K</code> and <code>V</code> can be partitioned along with the core double matmul</li>
</ul>

<p>Note one subtlety: the visual implication here is that we can also parallelize the subsequent matmul <code>attn @ V</code> along <code>k</code> and sum the partial results <a href="https://github.com/NVIDIA/cutlass/blob/main/media/docs/efficient_gemm.md#parallelized-reductions">split-k style</a>, thus parallelizing the entire double matmul. But the row-wise softmax in <code>sdpa()</code> adds the requirement that each row have all its segments normalized before the corresponding row of <code>attn @ V</code> can be computed, adding an extra row-wise step between the attention calculation and the final matmul.</p>

<h2 id="6-sizes-in-an-attention-layer">6 Sizes in an Attention Layer</h2>

<p>The first (MHA) half of an attention layer is famously computationally demanding because of its quadratic complexity, but the second (FFN) half is demanding in its own right due to the width of its hidden dimension, typically 4 times that of the model’s embedding dimension. Visualizing the biomass of a full attention layer can be useful in building intuition about how the two halves of the layer compare to each other.</p>

<h3 id="6a-visualizing-the-full-layer">6a Visualizing the full layer</h3>

<p>Below is a full attention layer with the first half (MHA) in the background and the second (FFN) in the foreground. As usual, arrows point in the direction of computation.</p>

<p>Notes:</p>

<ul>
  <li>This visualization doesn’t depict individual attention heads, but instead shows the unsliced Q/K/V weights and projections surrounding a central double matmul. Of course this isn’t a faithful visualization of the full MHA operation - but the goal here is to give a clearer sense of the relative matrix <em>sizes</em> in the two halves of the layer, rather than the relative amounts of computation each half performs. (Also, randomized values are used rather than real weights.)</li>
  <li>The dimensions used here are downsized to keep the browser (relatively) happy, but the proportions are preserved (from <a href="https://github.com/karpathy/nanoGPT/blob/master/model.py#L217">NanoGPT’s small config</a>): model embedding dimension = 192 (from 768), FFN embedding dimension = 768 (from 3072), sequence length = 256 (from 1024), although sequence length is not fundamental to the model. (Visually, changes in sequence length would appear as changes in the width of the input blades, and consequently in the size of the attention hub and the height of the downstream vertical planes.)</li>
</ul>

<p><a href="https://bhosmer.github.io/mm/index.html?0=layer_out%20%3D%20(attn_out%20%3D%20(attn%20%3D%20(Q%20%3D%20input%20%40%20wQ)%20%40%20(K_t%20%3D%20wK_t%20%40%20input_t))%20%40%20(V%20%3D%20input%20%40%20wV)%20%40%20wO)%20%40%20FFN_1%20%40%20FFN_2&amp;1=layer_out&amp;2=layernorm&amp;16=closed&amp;94=true&amp;3.1=attn_out%20%40%20FFN_1&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row%20major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.2=gelu&amp;12.13=inherit&amp;14.15=1&amp;14.16=open&amp;17.18=positive&amp;17.19=left&amp;17.20=bottom&amp;17.21=back&amp;22.2=layernorm&amp;23.13=inherit&amp;24.15=1&amp;24.16=open&amp;25.18=negative&amp;25.19=left&amp;25.20=top&amp;25.21=front&amp;26.1=attn%20%40%20V&amp;26.4=true&amp;26.5=32&amp;26.6=32&amp;26.7=row%20major&amp;26.8=&amp;26.9=-1&amp;26.10=1&amp;26.11=0&amp;26.2=none&amp;27.13=vmprod&amp;28.15=1&amp;28.16=open&amp;29.18=positive&amp;29.19=left&amp;29.20=bottom&amp;29.21=back&amp;30.1=attn&amp;30.4=true&amp;30.2=softmax(tril(x%2Fsqrt(k)))&amp;31.1=Q&amp;31.4=true&amp;31.2=none&amp;32.1=input&amp;32.4=false&amp;32.5=256&amp;32.6=192&amp;32.7=gaussian&amp;32.9=-1&amp;32.10=1&amp;32.11=0&amp;32.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;32.0=&amp;32.16=open&amp;33.1=wQ&amp;33.4=false&amp;33.5=192&amp;33.6=192&amp;33.7=gaussian&amp;33.9=-1&amp;33.10=1&amp;33.11=0&amp;33.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wq4_768_64.csv&amp;33.0=&amp;33.16=open&amp;34.13=vmprod&amp;35.15=1&amp;36.18=positive&amp;36.19=left&amp;36.20=bottom&amp;36.21=back&amp;31.16=closed&amp;37.2=none&amp;38.13=none&amp;39.15=1&amp;40.18=positive&amp;40.19=right&amp;40.20=top&amp;40.21=back&amp;41.1=wK_t&amp;41.4=false&amp;41.5=192&amp;41.6=192&amp;41.7=gaussian&amp;41.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wk_t4_64_768.csv&amp;41.9=-1&amp;41.10=1&amp;41.11=0&amp;41.0=&amp;41.16=open&amp;42.1=input_t&amp;42.4=false&amp;42.5=192&amp;42.6=256&amp;42.7=gaussian&amp;42.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input_t0_768_256.csv&amp;42.9=-1&amp;42.10=1&amp;42.11=0&amp;42.0=&amp;42.16=open&amp;37.1=K_t&amp;37.4=true&amp;37.16=closed&amp;43.13=vmprod&amp;44.15=1&amp;44.16=open&amp;45.18=negative&amp;45.19=left&amp;45.20=top&amp;45.21=front&amp;30.16=open&amp;46.1=V&amp;46.4=true&amp;46.2=none&amp;47.1=input&amp;47.4=false&amp;47.5=256&amp;47.6=192&amp;47.7=gaussian&amp;47.9=-1&amp;47.10=1&amp;47.11=0&amp;47.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;47.0=&amp;47.16=open&amp;48.1=wV&amp;48.4=false&amp;48.5=192&amp;48.6=192&amp;48.7=gaussian&amp;48.9=-1&amp;48.10=1&amp;48.11=0&amp;48.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wv4_768_64.csv&amp;48.0=&amp;48.16=open&amp;49.13=none&amp;50.15=1&amp;51.18=negative&amp;51.19=right&amp;51.20=top&amp;51.21=back&amp;46.16=open&amp;26.16=open&amp;52.1=wO&amp;52.4=false&amp;52.5=192&amp;52.6=192&amp;52.7=gaussian&amp;52.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wo4_64_768.csv&amp;52.9=-1&amp;52.10=0.996&amp;52.11=0&amp;52.0=&amp;52.16=closed&amp;22.1=attn_out&amp;22.4=true&amp;22.16=open&amp;53.1=FFN_1&amp;53.4=false&amp;53.5=192&amp;53.6=768&amp;53.7=gaussian&amp;53.8=&amp;53.9=-1&amp;53.10=1&amp;53.11=0&amp;53.0=&amp;53.16=closed&amp;3.16=open&amp;54.1=FFN_2&amp;54.4=false&amp;54.5=768&amp;54.6=192&amp;54.7=gaussian&amp;54.8=&amp;54.9=-1&amp;54.10=1&amp;54.11=0&amp;54.0=&amp;54.16=closed&amp;55.56=sync&amp;55.57=16&amp;55.58=false&amp;55.13=none&amp;55.59=0&amp;55.16=closed&amp;60.61=1&amp;60.62=1&amp;60.15=1&amp;60.16=closed&amp;63.64=blocks&amp;63.65=8&amp;63.66=0&amp;63.67=1&amp;63.68=0&amp;63.18=negative&amp;63.19=left&amp;63.20=top&amp;63.21=front&amp;63.16=closed&amp;69.70=10&amp;69.71=true&amp;69.72=4&amp;69.73=0.507&amp;69.74=0.524&amp;69.75=0.5&amp;69.76=12&amp;69.77=false&amp;69.78=false&amp;69.16=closed&amp;79.80=local&amp;79.81=0.1&amp;79.82=0.2&amp;79.83=0.9&amp;79.84=2&amp;79.85=0.75&amp;79.86=0.75&amp;79.87=0.03&amp;79.16=closed&amp;88.8=&amp;88.16=open&amp;89.90=-738.1526976199144&amp;89.91=919.9001193338946&amp;89.92=957.7418906526483&amp;93.90=0&amp;93.91=0&amp;93.92=0&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;left.anim=12&amp;alg=13&amp;left.block=14&amp;k%20blocks=15&amp;folder=16&amp;left.layout=17&amp;polarity=18&amp;left%20placement=19&amp;right%20placement=20&amp;result%20placement=21&amp;left.left=22&amp;left.left.anim=23&amp;left.left.block=24&amp;left.left.layout=25&amp;left.left.left=26&amp;left.left.left.anim=27&amp;left.left.left.block=28&amp;left.left.left.layout=29&amp;left.left.left.left=30&amp;left.left.left.left.left=31&amp;left.left.left.left.left.left=32&amp;left.left.left.left.left.right=33&amp;left.left.left.left.left.anim=34&amp;left.left.left.left.left.block=35&amp;left.left.left.left.left.layout=36&amp;left.left.left.left.right=37&amp;left.left.left.left.right.anim=38&amp;left.left.left.left.right.block=39&amp;left.left.left.left.right.layout=40&amp;left.left.left.left.right.left=41&amp;left.left.left.left.right.right=42&amp;left.left.left.left.anim=43&amp;left.left.left.left.block=44&amp;left.left.left.left.layout=45&amp;left.left.left.right=46&amp;left.left.left.right.left=47&amp;left.left.left.right.right=48&amp;left.left.left.right.anim=49&amp;left.left.left.right.block=50&amp;left.left.left.right.layout=51&amp;left.left.right=52&amp;left.right=53&amp;right=54&amp;anim=55&amp;fuse=56&amp;speed=57&amp;hide%20inputs=58&amp;spin=59&amp;block=60&amp;i%20blocks=61&amp;j%20blocks=62&amp;layout=63&amp;scheme=64&amp;gap=65&amp;scatter=66&amp;molecule=67&amp;blast=68&amp;deco=69&amp;legends=70&amp;shape=71&amp;spotlight=72&amp;row%20guides=73&amp;flow%20guides=74&amp;lens%20size=75&amp;magnification=76&amp;interior%20spotlight=77&amp;axes=78&amp;viz=79&amp;sensitivity=80&amp;min%20size=81&amp;min%20light=82&amp;max%20light=83&amp;elem%20scale=84&amp;zero%20hue=85&amp;hue%20gap=86&amp;hue%20spread=87&amp;diag=88&amp;cam=89&amp;x=90&amp;y=91&amp;z=92&amp;cam.target=93&amp;compress=94">Open in mm</a>:</p>

<p><img src="https://pytorch.org/assets/images/inside-the-matrix/attnlayer2.jpg" alt="a full attention layer with the first half (MHA) in the background and the second (FFN) in the foreground"></p>

<h3 id="6b-visualizing-the-bpt-partitioned-layer">6b Visualizing the BPT partitioned layer</h3>

<p>Revisiting <a href="https://arxiv.org/pdf/2305.19370.pdf">Blockwise Parallel Transformer</a> briefly, here we visualize BPT’s parallelization scheme in the context of an entire attention layer (with individual heads elided per above). In particular, note how the partitioning along <code>i</code> (of sequence blocks) extends through both MHA and FFN halves (<a href="https://bhosmer.github.io/mm/index.html?0=layer_out%20%3D%20(attn_out%20%3D%20(attn%20%3D%20(Q%20%3D%20input%20%40%20wQ)%20%40%20(K_t%20%3D%20wK_t%20%40%20input_t))%20%40%20(V%20%3D%20input%20%40%20wV)%20%40%20wO)%20%40%20FFN_1%20%40%20FFN_2&amp;1=layer_out&amp;2=layernorm&amp;16=closed&amp;94=true&amp;3.1=attn_out%20%40%20FFN_1&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row%20major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.2=gelu&amp;12.13=inherit&amp;14.15=1&amp;14.16=closed&amp;17.18=positive&amp;17.19=left&amp;17.20=bottom&amp;17.21=back&amp;22.2=layernorm&amp;23.13=inherit&amp;24.15=1&amp;24.16=closed&amp;25.18=negative&amp;25.19=left&amp;25.20=top&amp;25.21=front&amp;26.1=attn%20%40%20V&amp;26.4=true&amp;26.5=32&amp;26.6=32&amp;26.7=row%20major&amp;26.8=&amp;26.9=-1&amp;26.10=1&amp;26.11=0&amp;26.2=none&amp;27.13=vmprod&amp;28.15=8&amp;28.16=open&amp;29.18=positive&amp;29.19=left&amp;29.20=bottom&amp;29.21=back&amp;30.1=attn&amp;30.4=true&amp;30.2=softmax(tril(x%2Fsqrt(k)))&amp;31.1=Q&amp;31.4=true&amp;31.2=none&amp;32.1=input&amp;32.4=false&amp;32.5=256&amp;32.6=192&amp;32.7=gaussian&amp;32.9=-1&amp;32.10=1&amp;32.11=0&amp;32.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;32.0=&amp;32.16=open&amp;33.1=wQ&amp;33.4=false&amp;33.5=192&amp;33.6=192&amp;33.7=gaussian&amp;33.9=-1&amp;33.10=1&amp;33.11=0&amp;33.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wq4_768_64.csv&amp;33.0=&amp;33.16=open&amp;34.13=vmprod&amp;35.15=1&amp;36.18=positive&amp;36.19=left&amp;36.20=bottom&amp;36.21=back&amp;31.16=closed&amp;37.2=none&amp;38.13=none&amp;39.15=1&amp;40.18=positive&amp;40.19=right&amp;40.20=top&amp;40.21=back&amp;41.1=wK_t&amp;41.4=false&amp;41.5=192&amp;41.6=192&amp;41.7=gaussian&amp;41.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wk_t4_64_768.csv&amp;41.9=-1&amp;41.10=1&amp;41.11=0&amp;41.0=&amp;41.16=open&amp;42.1=input_t&amp;42.4=false&amp;42.5=192&amp;42.6=256&amp;42.7=gaussian&amp;42.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input_t0_768_256.csv&amp;42.9=-1&amp;42.10=1&amp;42.11=0&amp;42.0=&amp;42.16=open&amp;37.1=K_t&amp;37.4=true&amp;37.16=closed&amp;43.13=vmprod&amp;44.15=1&amp;44.16=open&amp;45.18=negative&amp;45.19=left&amp;45.20=top&amp;45.21=front&amp;30.16=closed&amp;46.1=V&amp;46.4=true&amp;46.2=none&amp;47.1=input&amp;47.4=false&amp;47.5=256&amp;47.6=192&amp;47.7=gaussian&amp;47.9=-1&amp;47.10=1&amp;47.11=0&amp;47.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;47.0=&amp;47.16=open&amp;48.1=wV&amp;48.4=false&amp;48.5=192&amp;48.6=192&amp;48.7=gaussian&amp;48.9=-1&amp;48.10=1&amp;48.11=0&amp;48.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wv4_768_64.csv&amp;48.0=&amp;48.16=open&amp;49.13=none&amp;50.15=1&amp;51.18=negative&amp;51.19=right&amp;51.20=top&amp;51.21=back&amp;46.16=closed&amp;26.16=open&amp;52.1=wO&amp;52.4=false&amp;52.5=192&amp;52.6=192&amp;52.7=gaussian&amp;52.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wo4_64_768.csv&amp;52.9=-1&amp;52.10=0.996&amp;52.11=0&amp;52.0=&amp;52.16=closed&amp;22.1=attn_out&amp;22.4=true&amp;22.16=open&amp;53.1=FFN_1&amp;53.4=false&amp;53.5=192&amp;53.6=768&amp;53.7=gaussian&amp;53.8=&amp;53.9=-1&amp;53.10=1&amp;53.11=0&amp;53.0=&amp;53.16=closed&amp;3.16=open&amp;54.1=FFN_2&amp;54.4=false&amp;54.5=768&amp;54.6=192&amp;54.7=gaussian&amp;54.8=&amp;54.9=-1&amp;54.10=1&amp;54.11=0&amp;54.0=&amp;54.16=closed&amp;55.56=sync&amp;55.57=16&amp;55.58=false&amp;55.13=none&amp;55.59=0&amp;55.16=closed&amp;60.61=8&amp;60.62=1&amp;60.15=1&amp;60.16=open&amp;63.64=blocks&amp;63.65=8&amp;63.66=0&amp;63.67=1&amp;63.68=0&amp;63.18=negative&amp;63.19=left&amp;63.20=top&amp;63.21=front&amp;63.16=closed&amp;69.70=10&amp;69.71=true&amp;69.72=4&amp;69.73=0.507&amp;69.74=0.524&amp;69.75=0.5&amp;69.76=12&amp;69.77=false&amp;69.78=false&amp;69.16=closed&amp;79.80=local&amp;79.81=0.1&amp;79.82=0.2&amp;79.83=0.9&amp;79.84=2&amp;79.85=0.75&amp;79.86=0.75&amp;79.87=0.03&amp;79.16=closed&amp;88.8=&amp;88.16=open&amp;89.90=-766.4372214429399&amp;89.91=955.1488380935747&amp;89.92=994.4406298292719&amp;93.90=0&amp;93.91=0&amp;93.92=0&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;left.anim=12&amp;alg=13&amp;left.block=14&amp;k%20blocks=15&amp;folder=16&amp;left.layout=17&amp;polarity=18&amp;left%20placement=19&amp;right%20placement=20&amp;result%20placement=21&amp;left.left=22&amp;left.left.anim=23&amp;left.left.block=24&amp;left.left.layout=25&amp;left.left.left=26&amp;left.left.left.anim=27&amp;left.left.left.block=28&amp;left.left.left.layout=29&amp;left.left.left.left=30&amp;left.left.left.left.left=31&amp;left.left.left.left.left.left=32&amp;left.left.left.left.left.right=33&amp;left.left.left.left.left.anim=34&amp;left.left.left.left.left.block=35&amp;left.left.left.left.left.layout=36&amp;left.left.left.left.right=37&amp;left.left.left.left.right.anim=38&amp;left.left.left.left.right.block=39&amp;left.left.left.left.right.layout=40&amp;left.left.left.left.right.left=41&amp;left.left.left.left.right.right=42&amp;left.left.left.left.anim=43&amp;left.left.left.left.block=44&amp;left.left.left.left.layout=45&amp;left.left.left.right=46&amp;left.left.left.right.left=47&amp;left.left.left.right.right=48&amp;left.left.left.right.anim=49&amp;left.left.left.right.block=50&amp;left.left.left.right.layout=51&amp;left.left.right=52&amp;left.right=53&amp;right=54&amp;anim=55&amp;fuse=56&amp;speed=57&amp;hide%20inputs=58&amp;spin=59&amp;block=60&amp;i%20blocks=61&amp;j%20blocks=62&amp;layout=63&amp;scheme=64&amp;gap=65&amp;scatter=66&amp;molecule=67&amp;blast=68&amp;deco=69&amp;legends=70&amp;shape=71&amp;spotlight=72&amp;row%20guides=73&amp;flow%20guides=74&amp;lens%20size=75&amp;magnification=76&amp;interior%20spotlight=77&amp;axes=78&amp;viz=79&amp;sensitivity=80&amp;min%20size=81&amp;min%20light=82&amp;max%20light=83&amp;elem%20scale=84&amp;zero%20hue=85&amp;hue%20gap=86&amp;hue%20spread=87&amp;diag=88&amp;cam=89&amp;x=90&amp;y=91&amp;z=92&amp;cam.target=93&amp;compress=94">open in mm</a>):</p>

<p><img src="https://pytorch.org/assets/images/inside-the-matrix/bptlayer.jpg" alt="visualize BPT's parallelization scheme in the context of an entire attention layer"></p>

<h3 id="6c-partitioning-the-ffn">6c Partitioning the FFN</h3>

<p>The visualization suggests an additional partitioning, orthogonal to the ones described above - in the FFN half of the attention layer, splitting the double matmul <code>(attn_out @ FFN_1) @ FFN_2</code>, first along <code>j</code> for <code>attn_out @ FFN_1</code>, then along <code>k</code> in the subsequent matmul with <code>FFN_2</code>. This partition slices both layers of <code>FFN</code> weights, reducing the capacity requirements of each participant in the computation at the cost of a final summation of the partial results.</p>

<p>Here’s what this partition looks like applied to an otherwise unpartitioned attention layer (<a href="https://bhosmer.github.io/mm/index.html?0=layer_out+%3D+%28attn_out+%3D+%28attn+%3D+%28Q+%3D+input+%40+wQ%29+%40+%28K_t+%3D+wK_t+%40+input_t%29%29+%40+%28V+%3D+input+%40+wV%29+%40+wO%29+%40+FFN_1+%40+FFN_2&amp;1=layer_out&amp;2=layernorm&amp;16=closed&amp;94=true&amp;3.1=attn_out+%40+FFN_1&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row+major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.2=gelu&amp;12.13=inherit&amp;14.15=1&amp;14.16=open&amp;14.17=1&amp;14.18=8&amp;19.20=positive&amp;19.21=left&amp;19.22=bottom&amp;19.23=back&amp;24.2=layernorm&amp;25.13=inherit&amp;26.15=1&amp;26.16=closed&amp;26.17=1&amp;26.18=1&amp;27.20=negative&amp;27.21=left&amp;27.22=top&amp;27.23=front&amp;28.1=attn+%40+V&amp;28.4=true&amp;28.5=32&amp;28.6=32&amp;28.7=row+major&amp;28.8=&amp;28.9=-1&amp;28.10=1&amp;28.11=0&amp;28.2=none&amp;29.13=vmprod&amp;30.15=1&amp;30.16=open&amp;30.17=1&amp;30.18=1&amp;31.20=positive&amp;31.21=left&amp;31.22=bottom&amp;31.23=back&amp;32.1=attn&amp;32.4=true&amp;32.2=softmax%28tril%28x%2Fsqrt%28k%29%29%29&amp;33.1=Q&amp;33.4=true&amp;33.2=none&amp;34.1=input&amp;34.4=false&amp;34.5=256&amp;34.6=192&amp;34.7=gaussian&amp;34.9=-1&amp;34.10=1&amp;34.11=0&amp;34.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;34.0=&amp;34.16=open&amp;35.1=wQ&amp;35.4=false&amp;35.5=192&amp;35.6=192&amp;35.7=gaussian&amp;35.9=-1&amp;35.10=1&amp;35.11=0&amp;35.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wq4_768_64.csv&amp;35.0=&amp;35.16=open&amp;36.13=vmprod&amp;37.15=1&amp;37.17=1&amp;37.18=1&amp;38.20=positive&amp;38.21=left&amp;38.22=bottom&amp;38.23=back&amp;33.16=closed&amp;39.2=none&amp;40.13=none&amp;41.15=1&amp;41.17=1&amp;41.18=1&amp;42.20=positive&amp;42.21=right&amp;42.22=top&amp;42.23=back&amp;43.1=wK_t&amp;43.4=false&amp;43.5=192&amp;43.6=192&amp;43.7=gaussian&amp;43.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wk_t4_64_768.csv&amp;43.9=-1&amp;43.10=1&amp;43.11=0&amp;43.0=&amp;43.16=open&amp;44.1=input_t&amp;44.4=false&amp;44.5=192&amp;44.6=256&amp;44.7=gaussian&amp;44.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input_t0_768_256.csv&amp;44.9=-1&amp;44.10=1&amp;44.11=0&amp;44.0=&amp;44.16=open&amp;39.1=K_t&amp;39.4=true&amp;39.16=closed&amp;45.13=vmprod&amp;46.15=1&amp;46.16=open&amp;46.17=1&amp;46.18=1&amp;47.20=negative&amp;47.21=left&amp;47.22=top&amp;47.23=front&amp;32.16=closed&amp;48.1=V&amp;48.4=true&amp;48.2=none&amp;49.1=input&amp;49.4=false&amp;49.5=256&amp;49.6=192&amp;49.7=gaussian&amp;49.9=-1&amp;49.10=1&amp;49.11=0&amp;49.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;49.0=&amp;49.16=open&amp;50.1=wV&amp;50.4=false&amp;50.5=192&amp;50.6=192&amp;50.7=gaussian&amp;50.9=-1&amp;50.10=1&amp;50.11=0&amp;50.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wv4_768_64.csv&amp;50.0=&amp;50.16=open&amp;51.13=none&amp;52.15=1&amp;52.17=1&amp;52.18=1&amp;53.20=negative&amp;53.21=right&amp;53.22=top&amp;53.23=back&amp;48.16=closed&amp;28.16=open&amp;54.1=wO&amp;54.4=false&amp;54.5=192&amp;54.6=192&amp;54.7=gaussian&amp;54.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wo4_64_768.csv&amp;54.9=-1&amp;54.10=0.996&amp;54.11=0&amp;54.0=&amp;54.16=closed&amp;24.1=attn_out&amp;24.4=true&amp;24.16=closed&amp;55.1=FFN_1&amp;55.4=false&amp;55.5=192&amp;55.6=768&amp;55.7=gaussian&amp;55.8=&amp;55.9=-1&amp;55.10=1&amp;55.11=0&amp;55.0=&amp;55.16=closed&amp;3.16=open&amp;56.1=FFN_2&amp;56.4=false&amp;56.5=768&amp;56.6=192&amp;56.7=gaussian&amp;56.8=&amp;56.9=-1&amp;56.10=1&amp;56.11=0&amp;56.0=&amp;56.16=closed&amp;57.58=sync&amp;57.59=16&amp;57.60=false&amp;57.13=none&amp;57.61=0&amp;57.16=closed&amp;62.17=1&amp;62.15=8&amp;62.18=1&amp;62.16=closed&amp;63.64=blocks&amp;63.65=8&amp;63.66=0&amp;63.67=1&amp;63.68=0&amp;63.20=negative&amp;63.21=left&amp;63.22=top&amp;63.23=front&amp;63.16=closed&amp;69.70=10&amp;69.71=true&amp;69.72=4&amp;69.73=0.507&amp;69.74=0.524&amp;69.75=0.5&amp;69.76=12&amp;69.77=false&amp;69.78=false&amp;69.16=closed&amp;79.80=local&amp;79.81=0.1&amp;79.82=0.2&amp;79.83=0.9&amp;79.84=2&amp;79.85=0.75&amp;79.86=0.75&amp;79.87=0.03&amp;79.16=closed&amp;88.8=&amp;88.16=open&amp;89.90=-725.0392607527422&amp;89.91=909.2543497392985&amp;89.92=1420.9035091451585&amp;93.90=84.4062135237143&amp;93.91=2.295441349889614&amp;93.92=60.16668289640925&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;left.anim=12&amp;alg=13&amp;left.block=14&amp;k+blocks=15&amp;folder=16&amp;i+blocks=17&amp;j+blocks=18&amp;left.layout=19&amp;polarity=20&amp;left+placement=21&amp;right+placement=22&amp;result+placement=23&amp;left.left=24&amp;left.left.anim=25&amp;left.left.block=26&amp;left.left.layout=27&amp;left.left.left=28&amp;left.left.left.anim=29&amp;left.left.left.block=30&amp;left.left.left.layout=31&amp;left.left.left.left=32&amp;left.left.left.left.left=33&amp;left.left.left.left.left.left=34&amp;left.left.left.left.left.right=35&amp;left.left.left.left.left.anim=36&amp;left.left.left.left.left.block=37&amp;left.left.left.left.left.layout=38&amp;left.left.left.left.right=39&amp;left.left.left.left.right.anim=40&amp;left.left.left.left.right.block=41&amp;left.left.left.left.right.layout=42&amp;left.left.left.left.right.left=43&amp;left.left.left.left.right.right=44&amp;left.left.left.left.anim=45&amp;left.left.left.left.block=46&amp;left.left.left.left.layout=47&amp;left.left.left.right=48&amp;left.left.left.right.left=49&amp;left.left.left.right.right=50&amp;left.left.left.right.anim=51&amp;left.left.left.right.block=52&amp;left.left.left.right.layout=53&amp;left.left.right=54&amp;left.right=55&amp;right=56&amp;anim=57&amp;fuse=58&amp;speed=59&amp;hide+inputs=60&amp;spin=61&amp;block=62&amp;layout=63&amp;scheme=64&amp;gap=65&amp;scatter=66&amp;molecule=67&amp;blast=68&amp;deco=69&amp;legends=70&amp;shape=71&amp;spotlight=72&amp;row+guides=73&amp;flow+guides=74&amp;lens+size=75&amp;magnification=76&amp;interior+spotlight=77&amp;axes=78&amp;viz=79&amp;sensitivity=80&amp;min+size=81&amp;min+light=82&amp;max+light=83&amp;elem+scale=84&amp;zero+hue=85&amp;hue+gap=86&amp;hue+spread=87&amp;diag=88&amp;cam=89&amp;x=90&amp;y=91&amp;z=92&amp;cam.target=93&amp;compress=94">open in mm</a>):</p>

<p><img src="https://pytorch.org/assets/images/inside-the-matrix/attnlayer_ffnsplitk.jpg" alt="what this partition looks like applied to an otherwise unpartitioned attention layer"></p>

<p>And here it is applied to a layer partitioned a la BPT (<a href="https://bhosmer.github.io/mm/index.html?0=layer_out+%3D+%28attn_out+%3D+%28attn+%3D+%28Q+%3D+input+%40+wQ%29+%40+%28K_t+%3D+wK_t+%40+input_t%29%29+%40+%28V+%3D+input+%40+wV%29+%40+wO%29+%40+FFN_1+%40+FFN_2&amp;1=layer_out&amp;2=layernorm&amp;16=closed&amp;94=true&amp;3.1=attn_out+%40+FFN_1&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row+major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.2=gelu&amp;12.13=inherit&amp;14.15=1&amp;14.16=open&amp;14.17=8&amp;14.18=8&amp;19.20=positive&amp;19.21=left&amp;19.22=bottom&amp;19.23=back&amp;24.2=layernorm&amp;25.13=inherit&amp;26.15=1&amp;26.16=closed&amp;26.17=8&amp;26.18=1&amp;27.20=negative&amp;27.21=left&amp;27.22=top&amp;27.23=front&amp;28.1=attn+%40+V&amp;28.4=true&amp;28.5=32&amp;28.6=32&amp;28.7=row+major&amp;28.8=&amp;28.9=-1&amp;28.10=1&amp;28.11=0&amp;28.2=none&amp;29.13=vmprod&amp;30.15=8&amp;30.16=open&amp;30.17=8&amp;30.18=1&amp;31.20=positive&amp;31.21=left&amp;31.22=bottom&amp;31.23=back&amp;32.1=attn&amp;32.4=true&amp;32.2=softmax%28tril%28x%2Fsqrt%28k%29%29%29&amp;33.1=Q&amp;33.4=true&amp;33.2=none&amp;34.1=input&amp;34.4=false&amp;34.5=256&amp;34.6=192&amp;34.7=gaussian&amp;34.9=-1&amp;34.10=1&amp;34.11=0&amp;34.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;34.0=&amp;34.16=open&amp;35.1=wQ&amp;35.4=false&amp;35.5=192&amp;35.6=192&amp;35.7=gaussian&amp;35.9=-1&amp;35.10=1&amp;35.11=0&amp;35.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wq4_768_64.csv&amp;35.0=&amp;35.16=open&amp;36.13=vmprod&amp;37.15=1&amp;37.17=8&amp;37.18=1&amp;38.20=positive&amp;38.21=left&amp;38.22=bottom&amp;38.23=back&amp;33.16=closed&amp;39.2=none&amp;40.13=none&amp;41.15=1&amp;41.17=1&amp;41.18=1&amp;42.20=positive&amp;42.21=right&amp;42.22=top&amp;42.23=back&amp;43.1=wK_t&amp;43.4=false&amp;43.5=192&amp;43.6=192&amp;43.7=gaussian&amp;43.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wk_t4_64_768.csv&amp;43.9=-1&amp;43.10=1&amp;43.11=0&amp;43.0=&amp;43.16=open&amp;44.1=input_t&amp;44.4=false&amp;44.5=192&amp;44.6=256&amp;44.7=gaussian&amp;44.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input_t0_768_256.csv&amp;44.9=-1&amp;44.10=1&amp;44.11=0&amp;44.0=&amp;44.16=open&amp;39.1=K_t&amp;39.4=true&amp;39.16=closed&amp;45.13=vmprod&amp;46.15=1&amp;46.16=open&amp;46.17=8&amp;46.18=1&amp;47.20=negative&amp;47.21=left&amp;47.22=top&amp;47.23=front&amp;32.16=closed&amp;48.1=V&amp;48.4=true&amp;48.2=none&amp;49.1=input&amp;49.4=false&amp;49.5=256&amp;49.6=192&amp;49.7=gaussian&amp;49.9=-1&amp;49.10=1&amp;49.11=0&amp;49.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;49.0=&amp;49.16=open&amp;50.1=wV&amp;50.4=false&amp;50.5=192&amp;50.6=192&amp;50.7=gaussian&amp;50.9=-1&amp;50.10=1&amp;50.11=0&amp;50.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wv4_768_64.csv&amp;50.0=&amp;50.16=open&amp;51.13=none&amp;52.15=1&amp;52.17=1&amp;52.18=1&amp;53.20=negative&amp;53.21=right&amp;53.22=top&amp;53.23=back&amp;48.16=closed&amp;28.16=open&amp;54.1=wO&amp;54.4=false&amp;54.5=192&amp;54.6=192&amp;54.7=gaussian&amp;54.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wo4_64_768.csv&amp;54.9=-1&amp;54.10=0.996&amp;54.11=0&amp;54.0=&amp;54.16=closed&amp;24.1=attn_out&amp;24.4=true&amp;24.16=closed&amp;55.1=FFN_1&amp;55.4=false&amp;55.5=192&amp;55.6=768&amp;55.7=gaussian&amp;55.8=&amp;55.9=-1&amp;55.10=1&amp;55.11=0&amp;55.0=&amp;55.16=closed&amp;3.16=open&amp;56.1=FFN_2&amp;56.4=false&amp;56.5=768&amp;56.6=192&amp;56.7=gaussian&amp;56.8=&amp;56.9=-1&amp;56.10=1&amp;56.11=0&amp;56.0=&amp;56.16=closed&amp;57.58=sync&amp;57.59=16&amp;57.60=false&amp;57.13=none&amp;57.61=0&amp;57.16=closed&amp;62.17=8&amp;62.15=8&amp;62.18=1&amp;62.16=open&amp;63.64=blocks&amp;63.65=8&amp;63.66=0&amp;63.67=1&amp;63.68=0&amp;63.20=negative&amp;63.21=left&amp;63.22=top&amp;63.23=front&amp;63.16=closed&amp;69.70=10&amp;69.71=true&amp;69.72=4&amp;69.73=0.507&amp;69.74=0.524&amp;69.75=0.5&amp;69.76=12&amp;69.77=false&amp;69.78=false&amp;69.16=closed&amp;79.80=local&amp;79.81=0.1&amp;79.82=0.2&amp;79.83=0.9&amp;79.84=2&amp;79.85=0.75&amp;79.86=0.75&amp;79.87=0.03&amp;79.16=closed&amp;88.8=&amp;88.16=open&amp;89.90=-908.5990219796431&amp;89.91=1012.984380609292&amp;89.92=1378.7815259698948&amp;93.90=57.978218494193676&amp;93.91=-30.847130586978256&amp;93.92=41.66771129059017&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;left.anim=12&amp;alg=13&amp;left.block=14&amp;k+blocks=15&amp;folder=16&amp;i+blocks=17&amp;j+blocks=18&amp;left.layout=19&amp;polarity=20&amp;left+placement=21&amp;right+placement=22&amp;result+placement=23&amp;left.left=24&amp;left.left.anim=25&amp;left.left.block=26&amp;left.left.layout=27&amp;left.left.left=28&amp;left.left.left.anim=29&amp;left.left.left.block=30&amp;left.left.left.layout=31&amp;left.left.left.left=32&amp;left.left.left.left.left=33&amp;left.left.left.left.left.left=34&amp;left.left.left.left.left.right=35&amp;left.left.left.left.left.anim=36&amp;left.left.left.left.left.block=37&amp;left.left.left.left.left.layout=38&amp;left.left.left.left.right=39&amp;left.left.left.left.right.anim=40&amp;left.left.left.left.right.block=41&amp;left.left.left.left.right.layout=42&amp;left.left.left.left.right.left=43&amp;left.left.left.left.right.right=44&amp;left.left.left.left.anim=45&amp;left.left.left.left.block=46&amp;left.left.left.left.layout=47&amp;left.left.left.right=48&amp;left.left.left.right.left=49&amp;left.left.left.right.right=50&amp;left.left.left.right.anim=51&amp;left.left.left.right.block=52&amp;left.left.left.right.layout=53&amp;left.left.right=54&amp;left.right=55&amp;right=56&amp;anim=57&amp;fuse=58&amp;speed=59&amp;hide+inputs=60&amp;spin=61&amp;block=62&amp;layout=63&amp;scheme=64&amp;gap=65&amp;scatter=66&amp;molecule=67&amp;blast=68&amp;deco=69&amp;legends=70&amp;shape=71&amp;spotlight=72&amp;row+guides=73&amp;flow+guides=74&amp;lens+size=75&amp;magnification=76&amp;interior+spotlight=77&amp;axes=78&amp;viz=79&amp;sensitivity=80&amp;min+size=81&amp;min+light=82&amp;max+light=83&amp;elem+scale=84&amp;zero+hue=85&amp;hue+gap=86&amp;hue+spread=87&amp;diag=88&amp;cam=89&amp;x=90&amp;y=91&amp;z=92&amp;cam.target=93&amp;compress=94">open in mm</a>):</p>

<p><img src="https://pytorch.org/assets/images/inside-the-matrix/bptlayer_ffnsplitk.jpg" alt="applied to a layer partitioned a la BPT"></p>

<h3 id="6d-visualizing-token-at-a-time-decoding">6d Visualizing token-at-a-time decoding</h3>

<p>During autoregressive token-at-a-time decoding, the query vector consists of a single token. It’s instructive to have a mental picture of what an attention layer looks like in that situation - a single embedding row working its way through an enormous tiled plane of weights.</p>

<p>Aside from the emphasizing the sheer immensity of weights compared to activations, this view is also evocative of the notion that <code>K_t</code> and <code>V</code> function like dynamically generated layers in a 6-layer MLP, although the mux/demux computations of MHA itself (papered over here, per above) make the correspondence inexact (<a href="https://bhosmer.github.io/mm/index.html?0=layer_out%20%3D%20(attn_out%20%3D%20(attn%20%3D%20(Q%20%3D%20input%20%40%20wQ)%20%40%20K_t)%20%40%20V%20%40%20wO)%20%40%20FFN_1%20%40%20FFN_2&amp;1=layer_out&amp;2=layernorm&amp;16=closed&amp;84=true&amp;3.1=attn_out%20%40%20FFN_1&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=row%20major&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.2=gelu&amp;12.13=inherit&amp;14.15=1&amp;14.16=open&amp;17.18=positive&amp;17.19=left&amp;17.20=bottom&amp;17.21=back&amp;22.2=layernorm&amp;23.13=inherit&amp;24.15=1&amp;24.16=open&amp;25.18=negative&amp;25.19=left&amp;25.20=top&amp;25.21=front&amp;26.1=attn%20%40%20V&amp;26.4=true&amp;26.5=32&amp;26.6=32&amp;26.7=row%20major&amp;26.8=&amp;26.9=-1&amp;26.10=1&amp;26.11=0&amp;26.2=none&amp;27.13=vmprod&amp;28.15=1&amp;28.16=open&amp;29.18=positive&amp;29.19=left&amp;29.20=bottom&amp;29.21=back&amp;30.1=attn&amp;30.4=true&amp;30.2=softmax(tril(x%2Fsqrt(k)))&amp;31.1=Q&amp;31.4=true&amp;31.2=none&amp;32.1=input&amp;32.4=false&amp;32.5=1&amp;32.6=192&amp;32.7=gaussian&amp;32.9=-1&amp;32.10=1&amp;32.11=0&amp;32.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input0_256_768.csv&amp;32.0=&amp;32.16=open&amp;33.1=wQ&amp;33.4=false&amp;33.5=192&amp;33.6=192&amp;33.7=gaussian&amp;33.9=-1&amp;33.10=1&amp;33.11=0&amp;33.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wq4_768_64.csv&amp;33.0=&amp;33.16=open&amp;34.13=vmprod&amp;35.15=1&amp;36.18=positive&amp;36.19=left&amp;36.20=bottom&amp;36.21=back&amp;31.16=open&amp;37.1=K_t&amp;37.4=false&amp;37.5=192&amp;37.6=256&amp;37.7=gaussian&amp;37.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_input_t0_768_256.csv&amp;37.9=-1&amp;37.10=1&amp;37.11=0&amp;37.0=&amp;37.16=open&amp;38.13=vmprod&amp;39.15=1&amp;39.16=open&amp;40.18=negative&amp;40.19=left&amp;40.20=top&amp;40.21=front&amp;30.16=open&amp;41.1=V&amp;41.4=false&amp;41.16=open&amp;41.5=256&amp;41.6=192&amp;41.7=gaussian&amp;41.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wv4_768_64.csv&amp;41.0=&amp;41.9=-1&amp;41.10=1&amp;41.11=0&amp;26.16=open&amp;42.1=wO&amp;42.4=false&amp;42.5=192&amp;42.6=192&amp;42.7=gaussian&amp;42.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer5_wo4_64_768.csv&amp;42.9=-1&amp;42.10=0.996&amp;42.11=0&amp;42.0=&amp;42.16=closed&amp;22.1=attn_out&amp;22.4=true&amp;22.16=open&amp;43.1=FFN_1&amp;43.4=false&amp;43.5=192&amp;43.6=768&amp;43.7=gaussian&amp;43.8=&amp;43.9=-1&amp;43.10=1&amp;43.11=0&amp;43.0=&amp;43.16=closed&amp;3.16=open&amp;44.1=FFN_2&amp;44.4=false&amp;44.5=768&amp;44.6=192&amp;44.7=gaussian&amp;44.8=&amp;44.9=-1&amp;44.10=1&amp;44.11=0&amp;44.0=&amp;44.16=closed&amp;45.46=sync&amp;45.47=16&amp;45.48=false&amp;45.13=none&amp;45.49=0&amp;45.16=closed&amp;50.51=1&amp;50.52=1&amp;50.15=1&amp;50.16=closed&amp;53.54=blocks&amp;53.55=8&amp;53.56=0&amp;53.57=1&amp;53.58=0&amp;53.18=negative&amp;53.19=left&amp;53.20=top&amp;53.21=front&amp;53.16=closed&amp;59.60=10&amp;59.61=true&amp;59.62=4&amp;59.63=0.507&amp;59.64=0.524&amp;59.65=0.5&amp;59.66=12&amp;59.67=false&amp;59.68=false&amp;59.16=closed&amp;69.70=local&amp;69.71=0.1&amp;69.72=0.2&amp;69.73=0.9&amp;69.74=2&amp;69.75=0.75&amp;69.76=0.75&amp;69.77=0.03&amp;69.16=closed&amp;78.8=&amp;78.16=open&amp;79.80=-621.3352100945762&amp;79.81=774.3199147754915&amp;79.82=806.172978523008&amp;83.80=0&amp;83.81=0&amp;83.82=0&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;left.anim=12&amp;alg=13&amp;left.block=14&amp;k%20blocks=15&amp;folder=16&amp;left.layout=17&amp;polarity=18&amp;left%20placement=19&amp;right%20placement=20&amp;result%20placement=21&amp;left.left=22&amp;left.left.anim=23&amp;left.left.block=24&amp;left.left.layout=25&amp;left.left.left=26&amp;left.left.left.anim=27&amp;left.left.left.block=28&amp;left.left.left.layout=29&amp;left.left.left.left=30&amp;left.left.left.left.left=31&amp;left.left.left.left.left.left=32&amp;left.left.left.left.left.right=33&amp;left.left.left.left.left.anim=34&amp;left.left.left.left.left.block=35&amp;left.left.left.left.left.layout=36&amp;left.left.left.left.right=37&amp;left.left.left.left.anim=38&amp;left.left.left.left.block=39&amp;left.left.left.left.layout=40&amp;left.left.left.right=41&amp;left.left.right=42&amp;left.right=43&amp;right=44&amp;anim=45&amp;fuse=46&amp;speed=47&amp;hide%20inputs=48&amp;spin=49&amp;block=50&amp;i%20blocks=51&amp;j%20blocks=52&amp;layout=53&amp;scheme=54&amp;gap=55&amp;scatter=56&amp;molecule=57&amp;blast=58&amp;deco=59&amp;legends=60&amp;shape=61&amp;spotlight=62&amp;row%20guides=63&amp;flow%20guides=64&amp;lens%20size=65&amp;magnification=66&amp;interior%20spotlight=67&amp;axes=68&amp;viz=69&amp;sensitivity=70&amp;min%20size=71&amp;min%20light=72&amp;max%20light=73&amp;elem%20scale=74&amp;zero%20hue=75&amp;hue%20gap=76&amp;hue%20spread=77&amp;diag=78&amp;cam=79&amp;x=80&amp;y=81&amp;z=82&amp;cam.target=83&amp;compress=84">open in mm</a>):</p>

<p><img src="https://pytorch.org/assets/images/inside-the-matrix/decoding.jpg" alt="the mux/demux computations of MHA itself"></p>

<h2 id="7-lora">7 LoRA</h2>

<p>The recent LoRA paper (<a href="https://arxiv.org/pdf/2106.09685.pdf">LoRA: Low-Rank Adaptation of Large Language Models</a>) describes an efficient finetuning technique based on the idea that weight deltas introduced during finetuning are low-rank. Per the paper, this “allows us to train some dense layers in a neural network indirectly by optimizing rank decomposition matrices of the dense layers’ change during adaptation […], while keeping the pre-trained weights frozen.”</p>

<h3 id="7a-the-basic-idea">7a The basic idea</h3>

<p>In a nutshell, the key move is to train the <em>factors</em> of a weight matrix rather than the matrix itself: replace an <code>I x J</code> weights tensor with a matmul of an <code>I x K</code> tensor and a <code>K x J</code> tensor, holding <code>K</code> to some small number.</p>

<p>If <code>K</code> is small enough the size win can be huge, but the tradeoff is that lowering it lowers the rank of what the product can express. As a quick illustration of both the size savings and the structuring effect on the result, here’s a matmul of random <code>128 x 4</code> left and <code>4 x 128</code> right arguments - a.k.a. a rank-4 factorization of a <code>128 x 128</code> matrix. Notice the vertical and horizontal patterning in <code>L @ R</code> (<a href="https://bhosmer.github.io/mm/?0=L%20%40%20R&amp;1=L%20%40%20R&amp;2=none&amp;12=closed&amp;59=true&amp;3.1=L&amp;3.4=false&amp;3.5=128&amp;3.6=4&amp;3.7=gaussian&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.0=&amp;3.12=open&amp;13.1=R&amp;13.4=false&amp;13.5=4&amp;13.6=128&amp;13.7=gaussian&amp;13.8=&amp;13.9=-1&amp;13.10=1&amp;13.11=0&amp;13.0=&amp;14.15=none&amp;14.16=1&amp;14.17=false&amp;14.18=none&amp;14.19=0&amp;14.20=1&amp;14.21=1&amp;14.22=1&amp;23.20=1&amp;23.22=1&amp;23.21=1&amp;24.25=blocks&amp;24.26=11.214&amp;24.27=0&amp;24.28=1&amp;24.29=0&amp;24.30=negative&amp;24.31=left&amp;24.32=top&amp;24.33=front&amp;24.12=open&amp;34.35=10&amp;34.36=true&amp;34.37=2&amp;34.38=1&amp;34.39=0&amp;34.40=0.5&amp;34.41=10&amp;34.42=false&amp;34.43=false&amp;34.12=open&amp;44.45=local&amp;44.46=0.3&amp;44.47=0.5&amp;44.48=0.7&amp;44.49=1.25&amp;44.50=0.77&amp;44.51=0.74&amp;44.52=0.04&amp;44.12=open&amp;53.8=&amp;54.55=-147.50937470998977&amp;54.56=141.1312665550063&amp;54.57=104.24779022699425&amp;58.55=-7.97607936427614&amp;58.56=3.391570600844088&amp;58.57=-11.685048965074932&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;folder=12&amp;right=13&amp;anim=14&amp;fuse=15&amp;speed=16&amp;hide%20inputs=17&amp;alg=18&amp;spin=19&amp;i%20blocks=20&amp;k%20blocks=21&amp;j%20blocks=22&amp;block=23&amp;layout=24&amp;scheme=25&amp;gap=26&amp;scatter=27&amp;molecule=28&amp;blast=29&amp;polarity=30&amp;left%20placement=31&amp;right%20placement=32&amp;result%20placement=33&amp;deco=34&amp;legends=35&amp;shape=36&amp;spotlight=37&amp;row%20guides=38&amp;flow%20guides=39&amp;lens%20size=40&amp;magnification=41&amp;interior%20spotlight=42&amp;axes=43&amp;viz=44&amp;sensitivity=45&amp;min%20size=46&amp;min%20light=47&amp;max%20light=48&amp;elem%20scale=49&amp;zero%20hue=50&amp;hue%20gap=51&amp;hue%20spread=52&amp;diag=53&amp;cam=54&amp;x=55&amp;y=56&amp;z=57&amp;cam.target=58&amp;compress=59">open in mm</a>):</p>

<p><img src="https://pytorch.org/assets/images/inside-the-matrix/lora_single.jpg" alt="a matmul of random 128 x 4 left and 4 x 128 right arguments"></p>

<h3 id="7b-applying-lora-to-an-attention-head">7b Applying LoRA to an attention head</h3>

<p>The way LoRA applies this factoring move to the fine tuning process is to</p>

<ul>
  <li>create a low-rank factorization for each weight tensor to be fine-tuned and train the factors, keeping the original weights frozen</li>
  <li>after fine tuning, multiply each pair of low-rank factors to get a matrix in the shape of the original weights tensor, and add it to the original pretrained weights tensor</li>
</ul>

<p>The following visualization shows an attention head with the weight tensors <code>wQ</code>, <code>wK_t</code>, <code>wV</code>, <code>wO</code> replaced by low rank factorizations <code>wQ_A @ wQ_B</code>, etc. Visually, the factor matrices show up as low fences along the edges of the windmill blades (<a href="https://bhosmer.github.io/mm/index.html?0=out%20%3D%20(attn%20%3D%20(Q%20%3D%20input%20%40%20(wQ%20%3D%20wQ_A%20%40%20wQ_B))%20%40%20(K_t%20%3D%20(wK_t%20%3D%20wK_t_A%20%40%20wK_t_B)%20%40%20input_t))%20%40%20(V%20%3D%20input%20%40%20(wV%20%3D%20wV_A%20%40%20wV_B))%20%40%20(wO%20%3D%20wO_A%20%40%20wO_B)&amp;1=out&amp;2=none&amp;15=closed&amp;104=true&amp;3.1=attn%20%40%20V&amp;3.4=true&amp;3.5=32&amp;3.6=32&amp;3.7=rows&amp;3.8=&amp;3.9=-1&amp;3.10=1&amp;3.11=0&amp;3.2=none&amp;12.13=inherit&amp;12.14=1&amp;12.15=open&amp;16.17=positive&amp;16.18=left&amp;16.19=bottom&amp;16.20=back&amp;21.1=attn&amp;21.4=true&amp;21.2=softmax(tril(x%2Fsqrt(k)))&amp;22.1=Q&amp;22.4=true&amp;22.2=none&amp;23.1=input&amp;23.4=false&amp;23.5=64&amp;23.6=96&amp;23.7=gaussian&amp;23.9=-1&amp;23.10=1&amp;23.11=0&amp;23.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_input0_256_768.csv&amp;23.0=&amp;23.15=closed&amp;24.1=wQ&amp;24.4=true&amp;24.2=none&amp;25.1=wQ_A&amp;25.4=false&amp;25.5=96&amp;25.6=8&amp;25.7=gaussian&amp;25.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wq0_768_64.csv&amp;25.9=-1&amp;25.10=1&amp;25.11=0&amp;25.0=&amp;25.15=closed&amp;26.1=wQ_B&amp;26.4=false&amp;26.5=8&amp;26.6=32&amp;26.7=gaussian&amp;26.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wq0_768_64.csv&amp;26.9=-1&amp;26.10=1&amp;26.11=0&amp;26.0=&amp;26.15=open&amp;27.13=inherit&amp;27.14=1&amp;27.15=closed&amp;28.17=negative&amp;28.18=right&amp;28.19=top&amp;28.20=back&amp;29.30=1&amp;24.15=closed&amp;31.13=inherit&amp;31.14=1&amp;31.15=closed&amp;32.17=positive&amp;32.18=left&amp;32.19=bottom&amp;32.20=back&amp;33.30=1&amp;22.15=closed&amp;34.2=none&amp;35.13=inherit&amp;35.14=1&amp;35.15=closed&amp;36.17=positive&amp;36.18=right&amp;36.19=top&amp;36.20=back&amp;37.1=wK_t&amp;37.4=true&amp;37.2=none&amp;38.1=wK_t_A&amp;38.4=false&amp;38.5=32&amp;38.6=8&amp;38.7=gaussian&amp;38.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wk_t0_64_768.csv&amp;38.9=-1&amp;38.10=1&amp;38.11=0&amp;38.0=&amp;38.15=open&amp;39.1=wK_t_B&amp;39.4=false&amp;39.5=8&amp;39.6=96&amp;39.7=gaussian&amp;39.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wk_t0_64_768.csv&amp;39.9=-1&amp;39.10=1&amp;39.11=0&amp;39.0=&amp;39.15=closed&amp;40.13=inherit&amp;40.14=1&amp;40.15=open&amp;41.17=negative&amp;41.18=left&amp;41.19=bottom&amp;41.20=back&amp;42.30=1&amp;37.15=closed&amp;43.1=input_t&amp;43.4=false&amp;43.5=96&amp;43.6=64&amp;43.7=gaussian&amp;43.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_input_t0_768_256.csv&amp;43.9=-1&amp;43.10=1&amp;43.11=0&amp;43.0=&amp;43.15=closed&amp;34.1=K_t&amp;34.4=true&amp;44.30=1&amp;34.15=closed&amp;45.13=inherit&amp;45.14=1&amp;45.15=closed&amp;46.17=negative&amp;46.18=left&amp;46.19=top&amp;46.20=front&amp;47.30=1&amp;21.15=closed&amp;48.1=V&amp;48.4=true&amp;48.2=none&amp;49.1=input&amp;49.4=false&amp;49.5=64&amp;49.6=96&amp;49.7=gaussian&amp;49.9=-1&amp;49.10=1&amp;49.11=0&amp;49.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_input0_256_768.csv&amp;49.0=&amp;49.15=closed&amp;50.1=wV&amp;50.4=true&amp;50.2=none&amp;51.1=wV_A&amp;51.4=false&amp;51.5=96&amp;51.6=8&amp;51.7=gaussian&amp;51.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wv0_768_64.csv&amp;51.9=-1&amp;51.10=1&amp;51.11=0&amp;51.0=&amp;51.15=open&amp;52.1=wV_B&amp;52.4=false&amp;52.5=8&amp;52.6=32&amp;52.7=gaussian&amp;52.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wv0_768_64.csv&amp;52.9=-1&amp;52.10=1&amp;52.11=0&amp;52.0=&amp;52.15=open&amp;53.13=inherit&amp;53.14=1&amp;53.15=open&amp;54.17=positive&amp;54.18=left&amp;54.19=bottom&amp;54.20=back&amp;55.30=1&amp;50.15=closed&amp;56.13=inherit&amp;56.14=1&amp;56.15=closed&amp;57.17=negative&amp;57.18=right&amp;57.19=top&amp;57.20=back&amp;58.30=1&amp;48.15=closed&amp;3.15=closed&amp;59.30=1&amp;60.1=wO&amp;60.4=true&amp;60.5=32&amp;60.6=32&amp;60.7=cols&amp;60.8=&amp;60.9=-1&amp;60.10=1&amp;60.11=0&amp;60.2=none&amp;61.1=wO_A&amp;61.4=false&amp;61.5=32&amp;61.6=8&amp;61.7=gaussian&amp;61.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wo0_64_768.csv&amp;61.9=-1&amp;61.10=1&amp;61.11=0&amp;61.0=&amp;61.15=open&amp;62.1=wO_B&amp;62.4=false&amp;62.5=8&amp;62.6=96&amp;62.7=gaussian&amp;62.8=https%3A%2F%2Fraw.githubusercontent.com%2Fbhosmer%2Ftestdata%2Fmain%2Fweights%2Fgpt2%2Flayer0_wo0_64_768.csv&amp;62.9=-1&amp;62.10=1&amp;62.11=0&amp;62.0=&amp;62.15=closed&amp;63.13=inherit&amp;63.14=1&amp;63.15=closed&amp;64.17=positive&amp;64.18=right&amp;64.19=top&amp;64.20=back&amp;60.15=closed&amp;65.30=1&amp;66.67=none&amp;66.68=100&amp;66.69=false&amp;66.13=none&amp;66.70=-3&amp;66.71=1&amp;66.30=1&amp;66.14=1&amp;66.15=open&amp;72.71=1&amp;72.14=1&amp;72.30=1&amp;73.74=blocks&amp;73.75=2&amp;73.76=8&amp;73.77=2&amp;73.78=0&amp;73.17=negative&amp;73.18=left&amp;73.19=top&amp;73.20=front&amp;73.15=closed&amp;79.80=6.5&amp;79.81=false&amp;79.82=1&amp;79.83=1&amp;79.84=0.757&amp;79.85=0.5&amp;79.86=10&amp;79.87=false&amp;79.88=false&amp;79.15=open&amp;89.90=local&amp;89.91=0.2&amp;89.92=0.3&amp;89.93=1&amp;89.94=1.25&amp;89.95=0.75&amp;89.96=0.75&amp;89.97=0.03&amp;89.15=closed&amp;98.8=&amp;98.15=closed&amp;99.100=-172.19348886030096&amp;99.101=179.87607098671913&amp;99.102=291.20723943546824&amp;103.100=-6.083689158200286&amp;103.101=-2.2203698054118064&amp;103.102=-20.406063431589725&amp;expr=0&amp;name=1&amp;epilog=2&amp;left=3&amp;matmul=4&amp;h=5&amp;w=6&amp;init=7&amp;url=8&amp;min=9&amp;max=10&amp;dropout=11&amp;left.anim=12&amp;alg=13&amp;j%20blocks=14&amp;folder=15&amp;left.layout=16&amp;polarity=17&amp;left%20placement=18&amp;right%20placement=19&amp;result%20placement=20&amp;left.left=21&amp;left.left.left=22&amp;left.left.left.left=23&amp;left.left.left.right=24&amp;left.left.left.right.left=25&amp;left.left.left.right.right=26&amp;left.left.left.right.anim=27&amp;left.left.left.right.layout=28&amp;left.left.left.right.block=29&amp;k%20blocks=30&amp;left.left.left.anim=31&amp;left.left.left.layout=32&amp;left.left.left.block=33&amp;left.left.right=34&amp;left.left.right.anim=35&amp;left.left.right.layout=36&amp;left.left.right.left=37&amp;left.left.right.left.left=38&amp;left.left.right.left.right=39&amp;left.left.right.left.anim=40&amp;left.left.right.left.layout=41&amp;left.left.right.left.block=42&amp;left.left.right.right=43&amp;left.left.right.block=44&amp;left.left.anim=45&amp;left.left.layout=46&amp;left.left.block=47&amp;left.right=48&amp;left.right.left=49&amp;left.right.right=50&amp;left.right.right.left=51&amp;left.right.right.right=52&amp;left.right.right.anim=53&amp;left.right.right.layout=54&amp;left.right.right.block=55&amp;left.right.anim=56&amp;left.right.layout=57&amp;left.right.block=58&amp;left.block=59&amp;right=60&amp;right.left=61&amp;right.right=62&amp;right.anim=63&amp;right.layout=64&amp;right.block=65&amp;anim=66&amp;fuse=67&amp;speed=68&amp;hide%20inputs=69&amp;spin=70&amp;i%20blocks=71&amp;block=72&amp;layout=73&amp;scheme=74&amp;gap=75&amp;scatter=76&amp;molecule=77&amp;blast=78&amp;deco=79&amp;legends=80&amp;shape=81&amp;spotlight=82&amp;row%20guides=83&amp;flow%20guides=84&amp;lens%20size=85&amp;magnification=86&amp;interior%20spotlight=87&amp;axes=88&amp;viz=89&amp;sensitivity=90&amp;min%20size=91&amp;min%20light=92&amp;max%20light=93&amp;elem%20scale=94&amp;zero%20hue=95&amp;hue%20gap=96&amp;hue%20spread=97&amp;diag=98&amp;cam=99&amp;x=100&amp;y=101&amp;z=102&amp;cam.target=103&amp;compress=104">open in mm</a> - spacebar stops the spin):</p>



<h2 id="8-wrapup">8 Wrapup</h2>

<h3 id="8a-call-for-feedback">8a Call for feedback</h3>

<p>I’ve found this way of visualizing matmul expressions extremely helpful for building intuition and reasoning about not just matrix multiplication itself, but also many aspects of ML models and their computation, from efficiency to interpretability.</p>

<p>if you try it out and have suggestions or comments, I definitely want to hear, either in the comments here or <a href="https://github.com/bhosmer/mm">in the repo</a>.</p>

<h3 id="8b-next-steps">8b Next steps</h3>

<ul>
  <li>There’s a <a href="https://bhosmer.github.io/mm/examples/attngpt2/index.html">GPT2 attention head explorer</a> built on top of the tool which I’m currently using to inventory and classify the attention head traits found in that model. (This was the tool I used to find and explore the attention heads in this note.) Once complete I plan to post a note with the inventory.</li>
  <li>As mentioned up top, embedding these visualizations in Python notebooks is <a href="https://colab.research.google.com/drive/1wZIoU20eRWKtRNCW7e5Iugm3MhfaE1f7?usp=sharing">dead simple</a>. But session URLs can get… unwieldy, so it will be useful to have Python-side utilities for constructing them from configuration objects, similar to the simple JavaScript helpers used in the <a href="https://bhosmer.github.io/mm/ref.html">reference guide</a>.</li>
  <li>If you’ve got a use case you think might benefit from visualizations like this but it’s not obvious how to use the tool to do it, get in touch! I’m not necessarily looking to expand its core visualization capabilities that much further (right tool for the job, etc.), but e.g. the API for driving it programmatically is pretty basic, there’s plenty that can be done there.</li>
</ul>

                </article></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Control Center on macOS is always re-rendering its SwiftUI causing 1% CPU load (195 pts)]]></title>
            <link>https://twitter.com/praeclarum/status/1706356007348343064</link>
            <guid>37654904</guid>
            <pubDate>Tue, 26 Sep 2023 05:41:01 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://twitter.com/praeclarum/status/1706356007348343064">https://twitter.com/praeclarum/status/1706356007348343064</a>, See on <a href="https://news.ycombinator.com/item?id=37654904">Hacker News</a></p>
Couldn't get https://twitter.com/praeclarum/status/1706356007348343064: Error [ERR_FR_TOO_MANY_REDIRECTS]: Maximum number of redirects exceeded]]></description>
        </item>
        <item>
            <title><![CDATA[Quadlets might make me finally stop using Docker-compose – Major Hayden (241 pts)]]></title>
            <link>https://major.io/p/quadlets-replace-docker-compose/</link>
            <guid>37654891</guid>
            <pubDate>Tue, 26 Sep 2023 05:39:19 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://major.io/p/quadlets-replace-docker-compose/">https://major.io/p/quadlets-replace-docker-compose/</a>, See on <a href="https://news.ycombinator.com/item?id=37654891">Hacker News</a></p>
<div id="readability-page-1" class="page"><article><header><ol><li><a href="https://major.io/">Major Hayden</a><span>/</span></li><li><a href="https://major.io/posts/">Posts</a><span>/</span></li><li><a href="https://major.io/p/quadlets-replace-docker-compose/">Quadlets might make me finally stop using docker-compose</a><span>/</span></li></ol><div><p><time datetime="2023-09-25 00:00:00 +0000 UTC">25 September 2023</time><span>·</span><span>1417 words</span><span>·</span><span title="Reading time">7 mins</span><span>·</span>
<span><a href="https://github.com/major/major.io/blob/main/content/posts/2023/quadlets-replace-docker-compose/index.md" rel="noopener noreferrer" target="_blank" title="Edit content"><span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M490.3 40.4c21.9 21.87 21.9 57.33.0 79.2l-30 30.1-98-97.98 30.1-30.06C414.3-.2135 449.7-.2135 471.6 21.66L490.3 40.4zM172.4 241.7 339.7 74.34l98 97.96L270.3 339.6C264.2 345.8 256.7 350.4 248.4 353.2l-88.8 29.6C150.1 385.6 141.5 383.4 135 376.1 128.6 370.5 126.4 361 129.2 352.4l29.6-88.8C161.6 255.3 166.2 247.8 172.4 241.7v0zM192 63.1c17.7.0 32 15.23 32 32 0 18.6-14.3 32-32 32H96c-17.67.0-32 15.2-32 32V416c0 17.7 14.33 32 32 32H352c17.7.0 32-14.3 32-32V319.1c0-16.8 14.3-32 32-32s32 15.2 32 32V416c0 53-43 96-96 96H96c-53.02.0-96-43-96-96V159.1c0-53 42.98-96 96-96h96z"></path></svg></span></a></span></p></div></header><div><hr><p>I’ve <a href="https://major.io/tags/containers/">written a lot about containers</a> on this blog.
Why do I love containers so much?</p><ul><li>They start quickly</li><li>They make your workloads portable</li><li>They disconnect your application stack from the OS that runs underneath</li><li>You can send your application through CI as a single container image</li><li>You can isolate workloads on the network and limit their resource usage much like a VM</li></ul><p>However, I’m still addicted to <a href="https://docs.docker.com/compose/" target="_blank" rel="noreferrer noopener">docker-compose</a>.
Can podman’s <a href="https://www.redhat.com/sysadmin/quadlet-podman" target="_blank" rel="noreferrer noopener">quadlets</a> change that?</p><p><strong>Yes, I think they can.</strong></p><h2 id="whats-a-quadlet">What’s a quadlet? <span><a href="#whats-a-quadlet" aria-label="Anchor">#</a></span></h2><p>Podman introduced support for quadlets in version 4.4 and it’s a simpler way of letting systemd manage your containers.
There was an option in the past to have podman generate systemd unit files, but those were unwieldy and full of podman command line options inside a unit file.
These unit files weren’t easy to edit or even parse with eyeballs.</p><p>Quadlets make this easier by giving you a simple ini-style file that you can easily read and edit.
This blog post will include some quadlets later, but here’s an example one for Wordpress:</p><div><pre tabindex="0"><code data-lang="ini"><span><span><span>[Unit]</span>
</span></span><span><span><span>Description</span><span>=</span><span>Wordpress Quadlet</span>
</span></span><span><span>
</span></span><span><span><span>[Container]</span>
</span></span><span><span><span>Image</span><span>=</span><span>docker.io/library/wordpress:fpm</span>
</span></span><span><span><span>ContainerName</span><span>=</span><span>wordpress</span>
</span></span><span><span><span>AutoUpdate</span><span>=</span><span>registry</span>
</span></span><span><span><span>EnvironmentFile</span><span>=</span><span>/home/core/.config/containers/containers-environment</span>
</span></span><span><span><span>Volume</span><span>=</span><span>wordpress.volume:/var/www/html</span>
</span></span><span><span><span>Network</span><span>=</span><span>wordpress.network</span>
</span></span><span><span>
</span></span><span><span><span>[Service]</span>
</span></span><span><span><span>Restart</span><span>=</span><span>always</span>
</span></span><span><span><span>TimeoutStartSec</span><span>=</span><span>900</span>
</span></span><span><span>
</span></span><span><span><span>[Install]</span>
</span></span><span><span><span>WantedBy</span><span>=</span><span>caddy.service multi-user.target default.target</span>
</span></span></code></pre></div><p>Lots of the lines under <code>[Container]</code> should look familiar to most readers who have worked with containers before.
However, there’s something new here.</p><p>Check out the <code>AutoUpdate=registry</code> line.
This tells podman to keep your container updated on a regular basis with the upstream container registry.
I’ve used <a href="https://major.io/p/podman-quadlet-watchtower/">watchtower</a> in the past for this, but it requires a privileged container and it’s yet another external dependency.</p><p>Also, at the very end, you’ll see a <code>WantedBy</code> line.
This is a great place to set up container dependencies.
In this example, the container that runs <code>caddy</code> (a web server) can’t start until Wordpress is up and running.</p><h2 id="so-why-not-stick-with-docker-compose">So why not stick with docker-compose? <span><a href="#so-why-not-stick-with-docker-compose" aria-label="Anchor">#</a></span></h2><p>There’s no denying that docker-compose is an awesome tool.
You specify the desired outcome, tell it to bring up containers, and it gets containers into the state you specified.
It handles volumes, networks, and complicated configuration without a lot of legwork.
The YAML files are pretty easy to read, too.</p><p>However, as with watchtower, that’s another external dependency.</p><p>My container deployments are often done at instance boot time and I don’t make too many changes afterwards.
I found myself using docker-compose for the initial deployment and then I didn’t really use it again.</p><p>Why not remove it entirely and use what’s built into CoreOS already?</p><h2 id="quaint-quadlets-quickly">Quaint quadlets quickly! <span><a href="#quaint-quadlets-quickly" aria-label="Anchor">#</a></span></h2><p>Before we start, we’re going to need a few things:</p><ul><li>An easy to read <a href="https://coreos.github.io/butane/" target="_blank" rel="noreferrer noopener">butane</a> configuration which gets transformed into a tiny <a href="https://coreos.github.io/ignition/" target="_blank" rel="noreferrer noopener">ignition</a> configuration for CoreOS</li><li>Some quadlets</li><li>Extra system configuration</li><li>A cloud provider with CoreOS images <em>(using <a href="https://www.vultr.com/?ref=9544589-8H" target="_blank" rel="noreferrer noopener">VULTR</a> for this)</em></li></ul><p>I’ve packed all of these items into my <a href="https://github.com/major/quadlets-wordpress" target="_blank" rel="noreferrer noopener">quadlets-wordpress</a> repository to make it easy.
Start by looking at the <a href="https://github.com/major/quadlets-wordpress/blob/main/config.butane" target="_blank" rel="noreferrer noopener">config.butane</a> file.</p><p>Let’s break it down here.
First up, we add an ssh key for the default <code>core</code> user.</p><div><pre tabindex="0"><code data-lang="yaml"><span><span><span>variant</span><span>:</span><span> </span><span>fcos</span><span>
</span></span></span><span><span><span></span><span>version</span><span>:</span><span> </span><span>1.5.0</span><span>
</span></span></span><span><span><span></span><span>passwd</span><span>:</span><span>
</span></span></span><span><span><span>  </span><span>users</span><span>:</span><span>
</span></span></span><span><span><span>    </span>- <span>name</span><span>:</span><span> </span><span>core</span><span>
</span></span></span><span><span><span>      </span><span>ssh_authorized_keys</span><span>:</span><span>
</span></span></span><span><span><span>        </span>- <span>ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIDyoH6gU4lgEiSiwihyD0Rxk/o5xYIfA3stVDgOGM9N0</span><span>
</span></span></span></code></pre></div><p>Next up, we enable the <code>podman-auto-update.timer</code> so we get container updates automatically:</p><div><pre tabindex="0"><code data-lang="yaml"><span><span><span>storage</span><span>:</span><span>
</span></span></span><span><span><span>  </span><span>links</span><span>:</span><span>
</span></span></span><span><span><span>    </span>- <span>path</span><span>:</span><span> </span><span>/home/core/.config/systemd/user/timers.target.wants/podman-auto-update.timer</span><span>
</span></span></span><span><span><span>      </span><span>target</span><span>:</span><span> </span><span>/usr/lib/systemd/user/podman-auto-update.timer</span><span>
</span></span></span><span><span><span>      </span><span>user</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>name</span><span>:</span><span> </span><span>core</span><span>
</span></span></span><span><span><span>      </span><span>group</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>name</span><span>:</span><span> </span><span>core</span><span>
</span></span></span></code></pre></div><p>Next is the long <code>files</code> section:</p><div><pre tabindex="0"><code data-lang="yaml"><span><span><span>  </span><span>files</span><span>:</span><span>
</span></span></span><span><span><span>    </span><span># Ensure the `core` user can keep processes running after they're logged out.</span><span>
</span></span></span><span><span><span>    </span>- <span>path</span><span>:</span><span> </span><span>/var/lib/systemd/linger/core</span><span>
</span></span></span><span><span><span>      </span><span>mode</span><span>:</span><span> </span><span>0644</span><span>
</span></span></span><span><span><span>    
</span></span></span><span><span><span>    </span><span># Allow caddy to listen on 80 and 443.</span><span>
</span></span></span><span><span><span>    </span><span># Allow it to ask for bigger network buffers, too.</span><span>
</span></span></span><span><span><span>    </span>- <span>path</span><span>:</span><span> </span><span>/etc/sysctl.d/90-caddy.conf</span><span>
</span></span></span><span><span><span>      </span><span>contents</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>inline</span><span>:</span><span> </span><span>|</span><span>
</span></span></span><span><span><span>          net.ipv4.ip_unprivileged_port_start = 80
</span></span></span><span><span><span>          net.core.rmem_max=2500000
</span></span></span><span><span><span>          net.core.wmem_max=2500000</span><span>          
</span></span></span><span><span><span>
</span></span></span><span><span><span>    </span><span># Set up an an environment file that containers can read to configure themselves.</span><span>
</span></span></span><span><span><span>    </span>- <span>path</span><span>:</span><span> </span><span>/home/core/.config/containers/containers-environment</span><span>
</span></span></span><span><span><span>      </span><span>contents</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>inline</span><span>:</span><span> </span><span>|</span><span>
</span></span></span><span><span><span>          MYSQL_DATABASE=wordpress
</span></span></span><span><span><span>          MYSQL_USER=wordpress
</span></span></span><span><span><span>          MYSQL_ROOT_PASSWORD=mariadb-needs-a-secure-password
</span></span></span><span><span><span>          MYSQL_PASSWORD=wordpress-needs-a-secure-password
</span></span></span><span><span><span>          WORDPRESS_DB_HOST=mariadb
</span></span></span><span><span><span>          WORDPRESS_DB_USER=wordpress
</span></span></span><span><span><span>          WORDPRESS_DB_PASSWORD=wordpress-needs-a-secure-password
</span></span></span><span><span><span>          WORDPRESS_DB_NAME=wordpress</span><span>          
</span></span></span><span><span><span>      </span><span>mode</span><span>:</span><span> </span><span>0644</span><span>
</span></span></span><span><span><span>
</span></span></span><span><span><span>    </span><span># Deploy the caddy configuration file from the repository.</span><span>
</span></span></span><span><span><span>    </span>- <span>path</span><span>:</span><span> </span><span>/home/core/.config/caddy/Caddyfile</span><span>
</span></span></span><span><span><span>      </span><span>contents</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>local</span><span>:</span><span> </span><span>caddy/Caddyfile</span><span>
</span></span></span><span><span><span>      </span><span>mode</span><span>:</span><span> </span><span>0644</span><span>
</span></span></span><span><span><span>      </span><span>user</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>name</span><span>:</span><span> </span><span>core</span><span>
</span></span></span><span><span><span>      </span><span>group</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>name</span><span>:</span><span> </span><span>core</span><span>
</span></span></span><span><span><span>
</span></span></span><span><span><span>    </span><span># Add some named volumes for caddy and wordpress.</span><span>
</span></span></span><span><span><span>    </span>- <span>path</span><span>:</span><span> </span><span>/home/core/.config/containers/systemd/caddy-config.volume</span><span>
</span></span></span><span><span><span>      </span><span>contents</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>inline</span><span>:</span><span> </span><span>|</span><span>
</span></span></span><span><span><span>          [Volume]</span><span>          
</span></span></span><span><span><span>      </span><span>user</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>name</span><span>:</span><span> </span><span>core</span><span>
</span></span></span><span><span><span>      </span><span>group</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>name</span><span>:</span><span> </span><span>core</span><span>
</span></span></span><span><span><span>    </span>- <span>path</span><span>:</span><span> </span><span>/home/core/.config/containers/systemd/caddy-data.volume</span><span>
</span></span></span><span><span><span>      </span><span>contents</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>inline</span><span>:</span><span> </span><span>|</span><span>
</span></span></span><span><span><span>          [Volume]</span><span>          
</span></span></span><span><span><span>      </span><span>user</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>name</span><span>:</span><span> </span><span>core</span><span>
</span></span></span><span><span><span>      </span><span>group</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>name</span><span>:</span><span> </span><span>core</span><span>
</span></span></span><span><span><span>    </span>- <span>path</span><span>:</span><span> </span><span>/home/core/.config/containers/systemd/wordpress.volume</span><span>
</span></span></span><span><span><span>      </span><span>contents</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>inline</span><span>:</span><span> </span><span>|</span><span>
</span></span></span><span><span><span>          [Volume]</span><span>          
</span></span></span><span><span><span>      </span><span>user</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>name</span><span>:</span><span> </span><span>core</span><span>
</span></span></span><span><span><span>      </span><span>group</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>name</span><span>:</span><span> </span><span>core</span><span>
</span></span></span><span><span><span>
</span></span></span><span><span><span>    </span><span># Create a network for all the containers to use and enable the</span><span>
</span></span></span><span><span><span>    </span><span># DNS plugin. This allows containers to find each other using</span><span>
</span></span></span><span><span><span>    </span><span># the container names.</span><span>
</span></span></span><span><span><span>    </span>- <span>path</span><span>:</span><span> </span><span>/home/core/.config/containers/systemd/wordpress.network</span><span>
</span></span></span><span><span><span>      </span><span>contents</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>inline</span><span>:</span><span> </span><span>|</span><span>
</span></span></span><span><span><span>          [Network]
</span></span></span><span><span><span>          DisableDNS=false
</span></span></span><span><span><span>          Internal=false</span><span>          
</span></span></span><span><span><span>      </span><span>user</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>name</span><span>:</span><span> </span><span>core</span><span>
</span></span></span><span><span><span>      </span><span>group</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>name</span><span>:</span><span> </span><span>core</span><span>
</span></span></span><span><span><span>
</span></span></span><span><span><span>    </span><span># Add the wordpress container.</span><span>
</span></span></span><span><span><span>    </span>- <span>path</span><span>:</span><span> </span><span>/home/core/.config/containers/systemd/wordpress.container</span><span>
</span></span></span><span><span><span>      </span><span>contents</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>local</span><span>:</span><span> </span><span>quadlets/wordpress.container</span><span>
</span></span></span><span><span><span>      </span><span>mode</span><span>:</span><span> </span><span>0644</span><span>
</span></span></span><span><span><span>      </span><span>user</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>name</span><span>:</span><span> </span><span>core</span><span>
</span></span></span><span><span><span>      </span><span>group</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>name</span><span>:</span><span> </span><span>core</span><span>
</span></span></span><span><span><span>
</span></span></span><span><span><span>    </span><span># Add the MariaDB container.</span><span>
</span></span></span><span><span><span>    </span>- <span>path</span><span>:</span><span> </span><span>/home/core/.config/containers/systemd/mariadb.container</span><span>
</span></span></span><span><span><span>      </span><span>contents</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>local</span><span>:</span><span> </span><span>quadlets/mariadb.container</span><span>
</span></span></span><span><span><span>      </span><span>mode</span><span>:</span><span> </span><span>0644</span><span>
</span></span></span><span><span><span>      </span><span>user</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>name</span><span>:</span><span> </span><span>core</span><span>
</span></span></span><span><span><span>      </span><span>group</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>name</span><span>:</span><span> </span><span>core</span><span>
</span></span></span><span><span><span>
</span></span></span><span><span><span>    </span><span># Add the caddy container.</span><span>
</span></span></span><span><span><span>    </span>- <span>path</span><span>:</span><span> </span><span>/home/core/.config/containers/systemd/caddy.container</span><span>
</span></span></span><span><span><span>      </span><span>contents</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>local</span><span>:</span><span> </span><span>quadlets/caddy.container</span><span>
</span></span></span><span><span><span>      </span><span>mode</span><span>:</span><span> </span><span>0644</span><span>
</span></span></span><span><span><span>      </span><span>user</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>name</span><span>:</span><span> </span><span>core</span><span>
</span></span></span><span><span><span>      </span><span>group</span><span>:</span><span>
</span></span></span><span><span><span>        </span><span>name</span><span>:</span><span> </span><span>core</span><span>
</span></span></span></code></pre></div><p>The <a href="https://github.com/major/quadlets-wordpress/blob/main/caddy/Caddyfile" target="_blank" rel="noreferrer noopener">Caddyfile</a> is also in the repository and will be deployed by the butane configuration shown above.</p><p>We can go through each quadlet in detail.
First up is MariaDB.
We tell systemd that the wordpress container will want to have this one started first.</p><div><pre tabindex="0"><code data-lang="ini"><span><span><span>[Unit]</span>
</span></span><span><span><span>Description</span><span>=</span><span>MariaDB Quadlet</span>
</span></span><span><span>
</span></span><span><span><span>[Container]</span>
</span></span><span><span><span>Image</span><span>=</span><span>docker.io/library/mariadb:11</span>
</span></span><span><span><span>ContainerName</span><span>=</span><span>mariadb</span>
</span></span><span><span><span>AutoUpdate</span><span>=</span><span>registry</span>
</span></span><span><span><span>EnvironmentFile</span><span>=</span><span>/home/core/.config/containers/containers-environment</span>
</span></span><span><span><span>Volume</span><span>=</span><span>mariadb.volume:/var/lib/mysql</span>
</span></span><span><span><span>Network</span><span>=</span><span>wordpress.network</span>
</span></span><span><span>
</span></span><span><span><span>[Service]</span>
</span></span><span><span><span>Restart</span><span>=</span><span>always</span>
</span></span><span><span><span>TimeoutStartSec</span><span>=</span><span>900</span>
</span></span><span><span>
</span></span><span><span><span>[Install]</span>
</span></span><span><span><span>WantedBy</span><span>=</span><span>wordpress.service multi-user.target default.target</span>
</span></span></code></pre></div><p>The wordpress quadlet is much the same as the MariaDB one, but we tell systemd that caddy will want wordpress started first.</p><div><pre tabindex="0"><code data-lang="ini"><span><span><span>[Unit]</span>
</span></span><span><span><span>Description</span><span>=</span><span>Wordpress Quadlet</span>
</span></span><span><span>
</span></span><span><span><span>[Container]</span>
</span></span><span><span><span>Image</span><span>=</span><span>docker.io/library/wordpress:fpm</span>
</span></span><span><span><span>ContainerName</span><span>=</span><span>wordpress</span>
</span></span><span><span><span>AutoUpdate</span><span>=</span><span>registry</span>
</span></span><span><span><span>EnvironmentFile</span><span>=</span><span>/home/core/.config/containers/containers-environment</span>
</span></span><span><span><span>Volume</span><span>=</span><span>wordpress.volume:/var/www/html</span>
</span></span><span><span><span>Network</span><span>=</span><span>wordpress.network</span>
</span></span><span><span>
</span></span><span><span><span>[Service]</span>
</span></span><span><span><span>Restart</span><span>=</span><span>always</span>
</span></span><span><span><span>TimeoutStartSec</span><span>=</span><span>900</span>
</span></span><span><span>
</span></span><span><span><span>[Install]</span>
</span></span><span><span><span>WantedBy</span><span>=</span><span>caddy.service multi-user.target default.target</span>
</span></span></code></pre></div><p>Finally, the caddy quadlet contains four volumes and some published ports.
These ports will be published to the container host.
Also, you’ll note that the wordpress volume is mounted here, too.
This is because caddy can serve static files <em>much faster</em> than wordpress can.</p><div><pre tabindex="0"><code data-lang="ini"><span><span><span>[Unit]</span>
</span></span><span><span><span>Description</span><span>=</span><span>Caddy Quadlet</span>
</span></span><span><span>
</span></span><span><span><span>[Container]</span>
</span></span><span><span><span>Image</span><span>=</span><span>docker.io/library/caddy:latest</span>
</span></span><span><span><span>ContainerName</span><span>=</span><span>caddy</span>
</span></span><span><span><span>AutoUpdate</span><span>=</span><span>registry</span>
</span></span><span><span><span>EnvironmentFile</span><span>=</span><span>/home/core/.config/containers/containers-environment</span>
</span></span><span><span><span>Volume</span><span>=</span><span>caddy-data.volume:/data</span>
</span></span><span><span><span>Volume</span><span>=</span><span>caddy-config.volume:/config</span>
</span></span><span><span><span>Volume</span><span>=</span><span>/home/core/.config/caddy/Caddyfile:/etc/caddy/Caddyfile:Z</span>
</span></span><span><span><span>Volume</span><span>=</span><span>wordpress.volume:/var/www/html</span>
</span></span><span><span><span>PublishPort</span><span>=</span><span>80:80</span>
</span></span><span><span><span>PublishPort</span><span>=</span><span>443:443</span>
</span></span><span><span><span>Network</span><span>=</span><span>wordpress.network</span>
</span></span><span><span>
</span></span><span><span><span>[Service]</span>
</span></span><span><span><span>Restart</span><span>=</span><span>always</span>
</span></span><span><span><span>TimeoutStartSec</span><span>=</span><span>900</span>
</span></span><span><span>
</span></span><span><span><span>[Install]</span>
</span></span><span><span><span>WantedBy</span><span>=</span><span>multi-user.target default.target</span>
</span></span></code></pre></div><h2 id="launch-the-quadlets">Launch the quadlets <span><a href="#launch-the-quadlets" aria-label="Anchor">#</a></span></h2><p>There’s a <a href="https://github.com/major/quadlets-wordpress/blob/main/launch-instance" target="_blank" rel="noreferrer noopener">launch script</a> that ships this configuration to VULTR and launches a CoreOS instance:</p><div><pre tabindex="0"><code data-lang="shell"><span><span><span>#!/bin/bash
</span></span></span><span><span><span></span><span># This command starts up a CoreOS instance on Vultr using the vultr-cli</span>
</span></span><span><span>vultr-cli instance create <span>\
</span></span></span><span><span><span></span>    --os <span>391</span> <span>\
</span></span></span><span><span><span></span>    --plan vhp-1c-1gb-amd <span>\
</span></span></span><span><span><span></span>    --region dfw <span>\
</span></span></span><span><span><span></span>    --notify <span>true</span> <span>\
</span></span></span><span><span><span></span>    --ipv6 <span>true</span> <span>\
</span></span></span><span><span><span></span>    -u <span>"</span><span>$(</span>butane --files-dir . config.butane<span>)</span><span>"</span> <span>\
</span></span></span><span><span><span></span>    -l <span>"coreos-</span><span>$(</span>date <span>"+%s"</span><span>)</span><span>"</span>
</span></span></code></pre></div><p>To launch an instance, get your <a href="https://my.vultr.com/settings/#settingsapi" target="_blank" rel="noreferrer noopener">VULTR API key</a> first.
Then install vultr-cli and butane:</p><div><pre tabindex="0"><code data-lang="console"><span><span><span>$</span> sudo dnf -y install butane vultr-cli
</span></span></code></pre></div><p>After launch, check to see what your containers are doing:</p><div><pre tabindex="0"><code data-lang="console"><span><span><span>[core@vultr ~]$</span> podman ps
</span></span><span><span><span>CONTAINER ID  IMAGE                            COMMAND               CREATED         STATUS         PORTS                                     NAMES
</span></span></span><span><span><span>afa2d6501593  docker.io/library/caddy:latest   caddy run --confi...  54 seconds ago  Up 53 seconds  0.0.0.0:80-&gt;80/tcp, 0.0.0.0:443-&gt;443/tcp  caddy
</span></span></span><span><span><span>460426f39e6c  docker.io/library/mariadb:11     mariadbd              35 seconds ago  Up 35 seconds                                            mariadb
</span></span></span><span><span><span>92ece6538d5a  docker.io/library/wordpress:fpm  php-fpm               28 seconds ago  Up 29 seconds                                            wordpress
</span></span></span></code></pre></div><p>We should be able to talk to wordpress through caddy on port 80:</p><div><pre tabindex="0"><code data-lang="console"><span><span><span>[core@vultr ~]$</span> curl -si http://localhost/wp-admin/install.php <span>|</span> head -n <span>25</span>
</span></span><span><span><span>HTTP/1.1 200 OK
</span></span></span><span><span><span>Cache-Control: no-cache, must-revalidate, max-age=0
</span></span></span><span><span><span>Content-Type: text/html; charset=utf-8
</span></span></span><span><span><span>Expires: Wed, 11 Jan 1984 05:00:00 GMT
</span></span></span><span><span><span>Server: Caddy
</span></span></span><span><span><span>X-Powered-By: PHP/8.0.30
</span></span></span><span><span><span>Date: Mon, 25 Sep 2023 21:43:40 GMT
</span></span></span><span><span><span>Transfer-Encoding: chunked
</span></span></span><span><span><span></span><span>
</span></span></span><span><span><span></span><span>&lt;!DOCTYPE html&gt;
</span></span></span><span><span><span>&lt;html lang="en-US" xml:lang="en-US"&gt;
</span></span></span><span><span><span>&lt;head&gt;
</span></span></span><span><span><span>	&lt;meta name="viewport" content="width=device-width" /&gt;
</span></span></span><span><span><span>	&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;
</span></span></span><span><span><span>	&lt;meta name="robots" content="noindex,nofollow" /&gt;
</span></span></span><span><span><span>	&lt;title&gt;WordPress &amp;rsaquo; Installation&lt;/title&gt;
</span></span></span><span><span><span>	&lt;link rel='stylesheet' id='dashicons-css' href='http://localhost/wp-includes/css/dashicons.min.css?ver=6.3.1' type='text/css' media='all' /&gt;
</span></span></span><span><span><span>&lt;link rel='stylesheet' id='buttons-css' href='http://localhost/wp-includes/css/buttons.min.css?ver=6.3.1' type='text/css' media='all' /&gt;
</span></span></span><span><span><span>&lt;link rel='stylesheet' id='forms-css' href='http://localhost/wp-admin/css/forms.min.css?ver=6.3.1' type='text/css' media='all' /&gt;
</span></span></span><span><span><span>&lt;link rel='stylesheet' id='l10n-css' href='http://localhost/wp-admin/css/l10n.min.css?ver=6.3.1' type='text/css' media='all' /&gt;
</span></span></span><span><span><span>&lt;link rel='stylesheet' id='install-css' href='http://localhost/wp-admin/css/install.min.css?ver=6.3.1' type='text/css' media='all' /&gt;
</span></span></span><span><span><span>&lt;/head&gt;
</span></span></span><span><span><span>&lt;body class="wp-core-ui language-chooser"&gt;
</span></span></span><span><span><span>&lt;p id="logo"&gt;WordPress&lt;/p&gt;
</span></span></span></code></pre></div><p>Awesome! 🎉</p><h2 id="managing-containers">Managing containers <span><a href="#managing-containers" aria-label="Anchor">#</a></span></h2><p>Containers will automatically update on a schedule and you can check the timer:</p><div><pre tabindex="0"><code data-lang="console"><span><span><span>[core@vultr ~]$</span> systemctl status --user podman-auto-update.timer
</span></span><span><span><span>● podman-auto-update.timer - Podman auto-update timer
</span></span></span><span><span><span>     Loaded: loaded (/usr/lib/systemd/user/podman-auto-update.timer; enabled; preset: disabled)
</span></span></span><span><span><span>     Active: active (waiting) since Mon 2023-09-25 21:41:31 UTC; 3min 14s ago
</span></span></span><span><span><span>    Trigger: Tue 2023-09-26 00:04:46 UTC; 2h 20min left
</span></span></span><span><span><span>   Triggers: ● podman-auto-update.service
</span></span></span><span><span><span></span><span>
</span></span></span><span><span><span></span><span>Sep 25 21:41:31 vultr.guest systemd[1786]: Started podman-auto-update.timer - Podman auto-update timer.
</span></span></span></code></pre></div><p>Quadlets are just regular systemd units:</p><div><pre tabindex="0"><code data-lang="console"><span><span><span>[core@vultr ~]$</span> systemctl list-units --user <span>|</span> grep -i Quadlet
</span></span><span><span><span>  caddy.service                                                                       loaded active running Caddy Quadlet
</span></span></span><span><span><span>  mariadb.service                                                                     loaded active running MariaDB Quadlet
</span></span></span><span><span><span>  wordpress.service                                                                   loaded active running Wordpress Quadlet
</span></span></span></code></pre></div><p>As an example, you can make changes to caddy’s config file and restart it easily:</p><div><pre tabindex="0"><code data-lang="console"><span><span><span>[core@vultr ~]$</span> systemctl restart --user caddy
</span></span><span><span><span>[core@vultr ~]$</span> systemctl status --user caddy
</span></span><span><span><span>● caddy.service - Caddy Quadlet
</span></span></span><span><span><span>     Loaded: loaded (/var/home/core/.config/containers/systemd/caddy.container; generated)
</span></span></span><span><span><span>    Drop-In: /usr/lib/systemd/user/service.d
</span></span></span><span><span><span>             └─10-timeout-abort.conf
</span></span></span><span><span><span>     Active: active (running) since Mon 2023-09-25 21:46:28 UTC; 5s ago
</span></span></span><span><span><span>   Main PID: 2652 (conmon)
</span></span></span><span><span><span>      Tasks: 18 (limit: 1023)
</span></span></span><span><span><span>     Memory: 15.1M
</span></span></span><span><span><span>        CPU: 207ms
</span></span></span></code></pre></div><p>If you need to change a quadlet’s configuration, just open up the configuration file in your favorite editor under <code>~/.config/containers/systemd</code>, reload systemd, and restart the container:</p><div><pre tabindex="0"><code data-lang="console"><span><span><span>$</span> vi ~/.config/containers/systemd/caddy.container
</span></span><span><span><span>
</span></span></span><span><span><span></span><span>--- make your edits and save the quadlet configuration ---
</span></span></span><span><span><span></span><span>
</span></span></span><span><span><span></span><span>$</span> systemctl daemon-reload --user
</span></span><span><span><span>$</span> systemctl restart --user caddy
</span></span></code></pre></div><p>Enjoy!</p></div></article></div>]]></description>
        </item>
        <item>
            <title><![CDATA[iPhone 15 teardown reveals software lockdown (120 pts)]]></title>
            <link>https://www.ifixit.com/News/82867/iphone-15-teardown-reveals-software-lockdown</link>
            <guid>37654413</guid>
            <pubDate>Tue, 26 Sep 2023 04:33:24 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.ifixit.com/News/82867/iphone-15-teardown-reveals-software-lockdown">https://www.ifixit.com/News/82867/iphone-15-teardown-reveals-software-lockdown</a>, See on <a href="https://news.ycombinator.com/item?id=37654413">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
    
<p>iPhone 15 is here, and it boasts a new charge port, a titanium frame, a periscope, and a new pro-repair design. Let’s dive inside! We’re going to focus on the 15 Pro Max, with some cameos from the other phone models.</p>



<figure><p>
<iframe title="iPhone 15 Pro Max Teardown: Big Phone, Microscopic Scratches" width="456" height="257" src="https://www.youtube-nocookie.com/embed/hmQHgWNAg24?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe>
</p></figure>



<h2>Design Architecture</h2>



<p>For years, smartphones have either opened from the front–making battery swaps difficult, or from the back–making screen swaps challenging. Apple finally <a href="https://www.ifixit.com/News/64865/iphone-14-teardown">cracked this nut</a> with last year’s <a href="https://www.ifixit.com/Device/iPhone_14">vanilla iPhone 14</a>, enabling the phone to open from the front <em>and</em> the back. This huge upgrade led us to ratchet up the iPhone’s repairability score from previous models. (We’ve since ratcheted it back down due to repair limitations imposed by parts pairing, but <a href="https://www.ifixit.com/News/82493/we-are-retroactively-dropping-the-iphones-repairability-score-en">that’s another story</a>.)</p>



<figure><img loading="lazy" width="6000" height="3375" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24112635/lineup.jpg" alt="" srcset="https://valkyrie.cdn.ifixit.com/media/2023/09/24112635/lineup.jpg 6000w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112635/lineup-1536x864.jpg 1536w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112635/lineup-2048x1152.jpg 2048w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112635/lineup-1600x900.jpg 1600w" sizes="(max-width: 6000px) 100vw, 6000px"></figure>



<p>The iPhone 15 and 15 Plus thankfully adopt the iPhone 14’s advancement. There’s a central chassis, or midframe, that the internal components are mounted to. The 15 Pro and Pro Max also now open from both directions, but in an unexpectedly opposite manner: all of the internals are hiding behind the screen still instead of behind the back glass. But that back glass is now removable, too, just like the 14.</p>



<p>This notable achievement is worth celebrating. For the first time, Apple’s keynote discussed repairability:</p>



<figure><blockquote><p>There is also a new internal chassis architecture that makes iPhone more repairable, thanks to a new structural frame that allows the back glass to be easily replaced.</p></blockquote></figure>



<p>This inverted chassis arrangement makes critical repairs like battery swaps slightly riskier than on the 14, because you’re removing the expensive, fragile display rather than an inert sheet of glass.</p>



<figure><img loading="lazy" width="6259" height="4694" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24112337/iPhone15_TD_46.jpg" alt="" srcset="https://valkyrie.cdn.ifixit.com/media/2023/09/24112337/iPhone15_TD_46.jpg 6259w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112337/iPhone15_TD_46-1536x1152.jpg 1536w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112337/iPhone15_TD_46-2048x1536.jpg 2048w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112337/iPhone15_TD_46-1200x900.jpg 1200w" sizes="(max-width: 6259px) 100vw, 6259px"></figure>



<p>In order to get to the battery and other components you have to heat and pry open the screen, which is slightly riskier. If you accidentally tear a cable, it’s better to tear the back cover cable than it is to ruin the display.</p>



<p>The nod goes to the 14 for being slightly more risk-tolerant, but they’re both good designs. Why didn’t the 15 Pro adopt the 14’s design? We’re not sure. It may have to do with the larger camera array. The cameras protrude through a cutout in the aluminum midframe, and it’s possible there wasn’t enough room for the opposite arrangement.</p>



<figure><img loading="lazy" width="11530" height="5770" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24125711/screen_combined_3.jpg" alt="" srcset="https://valkyrie.cdn.ifixit.com/media/2023/09/24125711/screen_combined_3.jpg 11530w, https://valkyrie.cdn.ifixit.com/media/2023/09/24125711/screen_combined_3-1536x769.jpg 1536w, https://valkyrie.cdn.ifixit.com/media/2023/09/24125711/screen_combined_3-2048x1025.jpg 2048w, https://valkyrie.cdn.ifixit.com/media/2023/09/24125711/screen_combined_3-1798x900.jpg 1798w" sizes="(max-width: 11530px) 100vw, 11530px"><figcaption>iPhone 15 Pro Max display front and back</figcaption></figure>



<p>Apple has continued to incrementally reduce the thickness of the display bezel.</p>



<p>Some have reported that the white gasket on the perimeter of the display is new, but it’s not–it’s just changed from black to white. The design is a little different than previous phones, and some have reported that it’s more difficult to remove.</p>



<div><figure><img loading="lazy" width="1200" height="800" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24180516/bottomrightmic-1200x800.jpg" alt="" srcset="https://valkyrie.cdn.ifixit.com/media/2023/09/24180516/bottomrightmic-1200x800.jpg 1200w, https://valkyrie.cdn.ifixit.com/media/2023/09/24180516/bottomrightmic-1536x1024.jpg 1536w, https://valkyrie.cdn.ifixit.com/media/2023/09/24180516/bottomrightmic-2048x1365.jpg 2048w, https://valkyrie.cdn.ifixit.com/media/2023/09/24180516/bottomrightmic-1350x900.jpg 1350w, https://valkyrie.cdn.ifixit.com/media/2023/09/24180516/bottomrightmic-300x200.jpg 300w, https://valkyrie.cdn.ifixit.com/media/2023/09/24180516/bottomrightmic-600x400.jpg 600w, https://valkyrie.cdn.ifixit.com/media/2023/09/24180516/bottomrightmic-768x512.jpg 768w, https://valkyrie.cdn.ifixit.com/media/2023/09/24180516/bottomrightmic-324x216.jpg 324w, https://valkyrie.cdn.ifixit.com/media/2023/09/24180516/bottomrightmic-450x300.jpg 450w" sizes="(max-width: 1200px) 100vw, 1200px"></figure></div>



<p>On the base iPhone 15 models, Apple is <a href="https://www.macrumors.com/2023/09/22/apple-can-repair-iphone-15-bottom-microphone/">now performing microphone repairs</a> in their service centers. This is enabled by increased modularity, where the microphone is now a separate component.</p>



<h2>Finally: USB-C</h2>



<p>Notorious for charting their own course, convincing Apple to change direction takes a monumental amount of pressure. Our Right to Repair advocacy has <a href="https://www.ifixit.com/News/79902/apples-u-turn-tech-giant-finally-backs-repair-in-california">already applied</a> some such pressure, and Apple’s now selling service parts and posting repair manuals. But even <a href="https://news.bloomberglaw.com/tech-and-telecom-law/california-follows-europes-lead-on-usb-c-mandate-for-devices">we couldn’t convince</a> them to switch to a standard port—it took the European Parliament to <a href="https://www.macrumors.com/2022/10/26/craig-joz-wsj-event/">force </a>that particular change.</p>



<figure><img loading="lazy" width="6000" height="4000" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24112706/USBC_ports_closeup.jpg" alt="" srcset="https://valkyrie.cdn.ifixit.com/media/2023/09/24112706/USBC_ports_closeup.jpg 6000w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112706/USBC_ports_closeup-1536x1024.jpg 1536w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112706/USBC_ports_closeup-2048x1365.jpg 2048w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112706/USBC_ports_closeup-1350x900.jpg 1350w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112706/USBC_ports_closeup-300x200.jpg 300w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112706/USBC_ports_closeup-600x400.jpg 600w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112706/USBC_ports_closeup-1200x800.jpg 1200w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112706/USBC_ports_closeup-768x512.jpg 768w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112706/USBC_ports_closeup-324x216.jpg 324w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112706/USBC_ports_closeup-450x300.jpg 450w" sizes="(max-width: 6000px) 100vw, 6000px"></figure>



<p>And now everyone can reap the benefits! In addition to obvious compatibility advantages, the new USB-C port can provide 4.5 watts of power to external devices. That’s a massive 15x upgrade over previous Lightning phones, which can only <a href="https://9to5mac.com/2023/09/16/iphone-15-usb-c-port-charge-power-output/">output 0.3 watts</a>.</p>



<figure><a href="https://support.apple.com/en-us/HT213839"><img loading="lazy" width="1074" height="413" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24114417/usb-c-iphone-15.jpg" alt=""></a></figure>



<p>Going into this release, there were two rumors floating around about the charge port. The first was that the part would be serialized, pairing it to the main board and locking out independent repairs. Fortunately, this is not the case, and swapping two ports maintains full functionality. Phew!</p>



<p>The second rumor was that Apple would limit the throughput of the USB-C port for some reason.&nbsp;That rumor turned out to be unfounded. The A17 System-on-Chip (SoC) adds a USB 3 controller, enabling USB 3.2 Gen 2 10 Gb throughput. Because the non-Pro iPhone 15 models inherited the older A16 Bionic, they only support USB 2 and are limited to the same transfer speeds as previous devices with Lightning.</p>



<p>The battery in the <a href="https://www.ifixit.com/Device/iPhone_15_Pro_Max">15 Pro Max</a> is 4422 mAh, an incremental 2.3% increase over the <a href="https://www.ifixit.com/Device/iPhone_14_Pro_Max">14 Pro Max’s</a> 4323 mAh pack. Similarly, the <a href="https://www.ifixit.com/Device/iPhone_15_Pro">15 Pro</a> has an identical 2.3% 3274 mAh (2.3% increase) over the <a href="https://www.ifixit.com/Device/iPhone_14_Pro">14 Pro’s</a> 3200 mAh. This isn’t a good year for anemic battery capacity gains, because the A17 Pro is power-thirsty. Early reports are that the <a href="https://www.notebookcheck.net/Severe-Apple-iPhone-15-Pro-Max-thermal-throttling-reported-as-A17-Pro-appears-to-push-surface-temperatures-to-48-C-during-gaming.753143.0.html">phone gets hot</a> and stays hot, with a corresponding drop in battery life.</p>



<figure><img loading="lazy" width="5504" height="5504" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24112731/battery_front.jpg" alt="iPhone 15 Pro Max Battery" srcset="https://valkyrie.cdn.ifixit.com/media/2023/09/24112731/battery_front.jpg 5504w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112731/battery_front-150x150.jpg 150w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112731/battery_front-1536x1536.jpg 1536w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112731/battery_front-2048x2048.jpg 2048w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112731/battery_front-900x900.jpg 900w" sizes="(max-width: 5504px) 100vw, 5504px"><figcaption>Uncle Sam wants YOU to be a Trained Technician.</figcaption></figure>



<p>The battery is serviceable only by a trained technician. Fortunately, you can be a trained technician! Simply train yourself using Apple’s service manual (likely coming soon) or <a href="https://www.ifixit.com/Device/iPhone_15_Pro_Max">iFixit’s repair guides</a> (in progress!). It’s not all that hard, we’ve helped millions of people fix their electronics themselves.</p>



<h2>A Titanium Housing</h2>



<p>The new Pro Max weighs 221 grams, 19 grams less than the 14 Pro Max. How much would you spend to save 19 grams? Pick up four nickels. What’s it worth to you to shave that much weight off of your phone? Well if you’re Apple, the answer is a heck of a lot.</p>



<figure><a href="https://valkyrie.cdn.ifixit.com/media/2023/09/24123124/iPhone15_TD_42.jpg"><img loading="lazy" width="5401" height="3038" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24123124/iPhone15_TD_42.jpg" alt="" srcset="https://valkyrie.cdn.ifixit.com/media/2023/09/24123124/iPhone15_TD_42.jpg 5401w, https://valkyrie.cdn.ifixit.com/media/2023/09/24123124/iPhone15_TD_42-1536x864.jpg 1536w, https://valkyrie.cdn.ifixit.com/media/2023/09/24123124/iPhone15_TD_42-2048x1152.jpg 2048w, https://valkyrie.cdn.ifixit.com/media/2023/09/24123124/iPhone15_TD_42-1600x900.jpg 1600w" sizes="(max-width: 5401px) 100vw, 5401px"></a><figcaption>Left: iPhone 14 Pro Max: 221 grams. Right: iPhone 15 Pro Max plus four nickels: 222 grams.</figcaption></figure>



<p>The single largest use of metal in the iPhone is in the outer frame, so that’s where Apple turned to advanced metallurgy to save some grams and gain some marketing points.</p>



<p>One <a href="https://leancrew.com/all-this/2023/09/iphone-15-pro-facts-and-estimates/">interesting theory</a> that has been floated about the reduced weight is that by shaving weight around the perimeter of the phone, it <em>feels</em> easier to move around. The technical term for this is moment of inertia, or how much force it takes to rotate the phone around its axes. As mass is removed from the edges, the phone feels more nimble in your hand—like tucking your legs in while spinning. <em>Where</em> Apple is removing the weight is a larger contributor to the “feel” than the actual 9% weight reduction.</p>



<blockquote><p>“Reducing the mass at the perimeter, which the change from stainless steel to titanium has done, has definitely reduced the moment of inertia more than a uniform reduction in mass would have. And that will make the 15 Pro easier to manipulate and will contribute—at least somewhat—to the impression of lightness.”</p><cite>Dr. Drang</cite></blockquote>



<figure><video autoplay="" controls="" loop="" src="https://valkyrie.cdn.ifixit.com/media/2023/09/25143100/360xrayBW2.mp4" playsinline=""></video></figure>



<p>Titanium is a space-grade material, used in situations where you’re willing to spend a lot of money for extra tough and lightweight materials. The titanium used in the super-fast <a href="https://en.wikipedia.org/wiki/Lockheed_SR-71_Blackbird">SR-71 Blackbird</a> reconnaissance aircraft famously <a href="https://theaviationgeekclub.com/did-you-know-that-titanium-used-to-build-the-iconic-sr-71-blackbird-mach-3-spy-plane-came-from-soviet-union/">came from the unwitting Soviet Union</a>. Way back in 2001, Apple made the <a href="https://www.ifixit.com/Device/PowerBook_G4_Titanium_Series">PowerBook G4</a> out of titanium. We were particularly fond of this workhorse, which encased the display in painted titanium.</p>



<p>Manufacturers tend to avoid titanium if at all possible, not just because it’s expensive but because it’s notoriously hard to work with.</p>



<p>So while titanium made sense for the outer shell, it didn’t make a difference for the midframe, a hidden yet mechanically complex aluminum part that all the inside phone components mount to. But how do you keep the aluminum midframe <em>and </em>use titanium for the perimeter?</p>



<figure><blockquote><p>Using an industry-first thermo-mechanical process, the titanium bands encase a new substructure made from 100 percent recycled aluminum, bonding these two metals with incredible strength through solid-state diffusion. The aluminum frame helps with thermal dissipation and allows the back glass to be easily replaced.</p></blockquote></figure>



<p>That thermo-mechanical process is likely solid state diffusion bonding, a process where two different metals are heated really hot and then pressed together really hard. This isn’t a new idea–heating metals up and banging them together is how blacksmiths have worked for thousands of years. But these days, it’s quite rare. Wikipedia says, “Due to its relatively high cost, diffusion bonding is most often used for jobs either difficult or impossible to weld by other means.”</p>



<p>High cost? Super-hard metal? Difficult job? That sounds like something really up Apple’s alley.</p>



<p>This is approximately what a <a href="https://vacuum-furnaces.com/production-furnaces-series-3520/">diffusion bonding machine</a> looks like. It heats metals up to 1700 Celsius, or about the melting point of steel. And then it sucks all the oxygen out, creating a 10<sup>‐6</sup> torr high vacuum. Then it presses the material together with 100 tons of force. And then you leave it there for an hour. Apple’s recipe won’t match this exactly, but if this reminds you of the process for making diamonds, you’re not far off.</p>



<div><figure><a href="https://vacuum-furnaces.com/production-furnaces-series-3520/"><img loading="lazy" width="861" height="587" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24114905/Sintervac-AM-spotlight.jpg" alt=""></a><figcaption>A vacuum hot chamber used for sintering 3D printed parts. Combine this with a hydraulic press and you’ve got the idea. Photo: Centorr Vacuum Industries</figcaption></figure></div>



<p>That’s an insanely complicated, expensive process that is typically limited to small production aerospace parts, not mass production of smartphones. Whatever machine Apple is using, they have <em>a lot</em> of them.</p>



<p>There are sustainability implications here. Electronics recyclers are accustomed to working with steel and aluminum, but don’t usually deal with titanium. If the titanium ended up in an aluminum shredder, it would damage or dull the blades. On the other hand, iPhones have so much residual value that they generally get special treatment in these facilities.</p>







<p>While the titanium itself is very hard, the coating on the titanium scratches quite easily. Thanks to <a href="https://www.evidentscientific.com/en/">Evident Scientific</a> for assistance with the imagery.</p>



<h2>Electronics</h2>



<p>One thing we were not expecting to find is an Apple baseband processor. Apple’s 5G modem team has been <a href="https://www.wsj.com/tech/apple-iphone-modem-chip-failure-6fe33d19">toiling in isolation</a> for years without any hardware to show for it. We’re not sure who to feel for, Tim Cook’s wallet or the poor Apple lawyers who had to grovel with Broadcom for a new contract. Amazingly, the hundreds of engineers working on this project for <a href="https://www.eetimes.com/infineon-adds-145-siemens-engineers-to-wireless-team-2/">first-Infineon</a>, <a href="https://www.infineon.com/cms/en/about-infineon/press/press-releases/2010/INFXX201008-069.html">then-Intel</a>, and <a href="https://www.apple.com/newsroom/2019/07/apple-to-acquire-the-majority-of-intels-smartphone-modem-business/">now-Apple</a> have yet to ship a single 5G modem to customers. That’s got to be demoralizing.</p>



<figure><a href="https://valkyrie.cdn.ifixit.com/media/2023/09/24124006/iphone_15_pro_max_comms-1.jpg"><img loading="lazy" width="5981" height="2500" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24124006/iphone_15_pro_max_comms-1.jpg" alt="" srcset="https://valkyrie.cdn.ifixit.com/media/2023/09/24124006/iphone_15_pro_max_comms-1.jpg 5981w, https://valkyrie.cdn.ifixit.com/media/2023/09/24124006/iphone_15_pro_max_comms-1-1536x642.jpg 1536w, https://valkyrie.cdn.ifixit.com/media/2023/09/24124006/iphone_15_pro_max_comms-1-2048x856.jpg 2048w" sizes="(max-width: 5981px) 100vw, 5981px"></a></figure>



<p>Sure enough, once we separated the main boards, we can confirm that Apple is using Broadcom’s high end <a href="https://www.qualcomm.com/products/technology/modems/snapdragon-x70-modem-rf-system">Snapdragon X70 modem</a>. According to Qualcomm, it’s powered by AI for beam management and antenna tuning. AI and 5G? We’ve <a href="https://www.theverge.com/2019/4/10/18296793/foxconn-wisconsin-location-factory-innovation-centers-technology-hub-no-news">heard that before</a>! Alas <a href="https://www.amazon.com/Exoviz-AI-8K-5G/dp/B07RM71F33">8K</a> is nowhere to be seen.</p>



<figure><a href="https://valkyrie.cdn.ifixit.com/media/2023/09/24124050/iphone_15_pro_max_a17_pro-1.jpg"><img loading="lazy" width="5981" height="2500" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24124050/iphone_15_pro_max_a17_pro-1.jpg" alt="" srcset="https://valkyrie.cdn.ifixit.com/media/2023/09/24124050/iphone_15_pro_max_a17_pro-1.jpg 5981w, https://valkyrie.cdn.ifixit.com/media/2023/09/24124050/iphone_15_pro_max_a17_pro-1-1536x642.jpg 1536w, https://valkyrie.cdn.ifixit.com/media/2023/09/24124050/iphone_15_pro_max_a17_pro-1-2048x856.jpg 2048w" sizes="(max-width: 5981px) 100vw, 5981px"></a></figure>



<p>The Apple A17 Pro hexa-core applications processor with six-core GPU layered under what is likely SK Hynix DDR5 memory.&nbsp;We’ve created a <a href="https://www.ifixit.com/Guide/iPhone+15+Pro+Max+Chip+ID/165320">separate Chip ID page</a> with extreme detail on what all of those parts are.</p>






<p>This part is manufactured with TSMC’s <a href="https://www.tsmc.com/english/dedicatedFoundry/technology/logic/l_3nm">cutting-edge 3nm process</a>, and is unlikely to be beaten by anything else anytime soon as Apple simply bought out the entirety of TSMC’s capacity for the year. Rumors are that yield on this new process are <a href="https://wccftech.com/apple-pay-tsmc-3nm-good-dies-a17-bionic-and-m3-yields-at-55-percent/">still quite low</a>, making this a particularly expensive part.</p>



<p><strong>Cameras</strong></p>



<p>The big upgrade for the cameras this year is the “tetraprism” periscope lens, upping the iPhone’s optical zoom from 2x to 5x. The <a href="https://www.ifixit.com/Device/Galaxy_S23_Ultra">S23 Ultra</a> technically beats this with 10x zoom, but the way Apple’s engineers achieved it is particularly interesting.&nbsp;Tetraprism, a fancy way of saying four lenses, is a word invented by Apple’s marketing team, but it’s got a nice ring to it!</p>



<figure><img loading="lazy" width="1200" height="800" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24112755/camera_front_2-1200x800.jpg" alt="" srcset="https://valkyrie.cdn.ifixit.com/media/2023/09/24112755/camera_front_2-1200x800.jpg 1200w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112755/camera_front_2-300x200.jpg 300w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112755/camera_front_2-600x400.jpg 600w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112755/camera_front_2-768x512.jpg 768w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112755/camera_front_2-324x216.jpg 324w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112755/camera_front_2-450x300.jpg 450w" sizes="(max-width: 1200px) 100vw, 1200px"></figure>



<p>Instead of opting for a series of lens elements controlled by electromagnets, they designed a single element “periscope” which reflects light multiple times to simulate a 120mm focal length. </p>



<figure><a href="https://valkyrie.cdn.ifixit.com/media/2023/09/24212223/tetralaser.gif"><img loading="lazy" width="1236" height="672" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24212223/tetralaser.gif" alt=""></a><figcaption>The laser light coming from the left is shifted onto a higher plane by the periscope lens system.</figcaption></figure>



<p>The physics challenge that smartphone camera designers are constantly working against is the thickness of the lens system. Using a periscope allows them to offset the sensor slightly from the lens.</p>







<figure><img loading="lazy" width="1200" height="719" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24120016/apple-iphone-15-pro-max-tetraprism.jpg" alt=""><figcaption>Photo: Apple</figcaption></figure>



<p>A periscope is a device for viewing things past obstacles. In this case, the obstacle is the camera itself. The mirrors bounce the light to the side, allowing for a greater focal length between the front lens and the focusing point on the sensor.</p>



<p>Aside from the new periscope lens, the sensors on the 15 Pro Max main and wide cameras seem to be the same size as last year’s 14 Pro Max—suggesting any improvement in image quality has more to do with the new A17 SoC than the camera hardware itself.</p>



<div><figure><img loading="lazy" width="1200" height="800" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24112844/faceid_v1-1200x800.jpg" alt="" srcset="https://valkyrie.cdn.ifixit.com/media/2023/09/24112844/faceid_v1-1200x800.jpg 1200w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112844/faceid_v1-300x200.jpg 300w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112844/faceid_v1-600x400.jpg 600w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112844/faceid_v1-768x512.jpg 768w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112844/faceid_v1-324x216.jpg 324w, https://valkyrie.cdn.ifixit.com/media/2023/09/24112844/faceid_v1-450x300.jpg 450w" sizes="(max-width: 1200px) 100vw, 1200px"></figure></div>



<p>One surprising thing we found was substantially larger screws holding down the camera than in the past. Why? We have no idea. But we have a new microscope, and this is as good a way as any to show it off!</p>



<div><figure><img loading="lazy" width="1200" height="800" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24120350/Camera_screw_comparison2_37x_C_C-1-1-1200x800.jpg" alt="" srcset="https://valkyrie.cdn.ifixit.com/media/2023/09/24120350/Camera_screw_comparison2_37x_C_C-1-1-1200x800.jpg 1200w, https://valkyrie.cdn.ifixit.com/media/2023/09/24120350/Camera_screw_comparison2_37x_C_C-1-1-300x200.jpg 300w, https://valkyrie.cdn.ifixit.com/media/2023/09/24120350/Camera_screw_comparison2_37x_C_C-1-1-600x400.jpg 600w, https://valkyrie.cdn.ifixit.com/media/2023/09/24120350/Camera_screw_comparison2_37x_C_C-1-1-768x512.jpg 768w, https://valkyrie.cdn.ifixit.com/media/2023/09/24120350/Camera_screw_comparison2_37x_C_C-1-1-324x216.jpg 324w, https://valkyrie.cdn.ifixit.com/media/2023/09/24120350/Camera_screw_comparison2_37x_C_C-1-1-450x300.jpg 450w" sizes="(max-width: 1200px) 100vw, 1200px"><figcaption>iPhone 15 camera screw, top. Equivalent iPhone 14 screw, bottom.</figcaption></figure></div>



<h2>A Great Design Undermined by Parts Pairing</h2>



<p>Unfortunately, swapping the front camera between two of our 15 Pro Max units results in complete failure. The cameras simply do not work. When we first encountered this problem last year, where the part was paired to its original device, we assumed that it was a bug that would be quickly fixed. Our trust was clearly misplaced.</p>



<p>It’s time for an urgent conversation about Apple’s approach to repairability. Despite our enthusiasm for iPhone 14’s easier-to-disassemble design, we’ve been compelled to <a href="https://www.ifixit.com/News/82493/we-are-retroactively-dropping-the-iphones-repairability-score-en">adjust our repairability score</a> from a promising 7 to a discouraging 4, highlighting Apple’s ongoing constriction of repair freedoms through its restrictive parts pairing system. To effectively repair these models, you have to procure parts within Apple’s sphere and validate the repairs. Without calibration, the parts either don’t work at all, or have compromised functionality and incessant warnings.</p>



<p>Repair is hard enough without software obstacles thrown into the mix. We’ve spent over $10,000 on iPhones over the last few days and our technicians have been systematically testing components to determine which repairs are possible and which are not.</p>



<p>Our objective in methodically swapping out every component in the phone is to find out whether repairs will be impossible or simply annoying. Our tests swap parts between identical, brand new devices. No aftermarket parts are involved. We’ve discovered that the rear lidar assembly, which will be critical for augmented reality functionality and creating content for the Vision Pro, is completely locked to the iPhone 15 Pro Max.</p>



<figure><a href="https://valkyrie.cdn.ifixit.com/media/2023/09/25150927/Parts-Pairing-Summary.png"><img loading="lazy" width="1465" height="661" src="https://valkyrie.cdn.ifixit.com/media/2023/09/25150927/Parts-Pairing-Summary.png" alt=""></a></figure>



<p>We purchased two iPhone 15 Pro Max units, and swapped the lidar modules between the two. The camera app initially loaded and then crashed. We were able to repeatedly reproduce this behavior.</p>



<p>Here’s the <a href="https://docs.google.com/spreadsheets/d/1BuxNntf-KIG_DFYEvKvfPafBI09IM4rjOf2RsGbN9II/edit#gid=2078984963">result of our tests</a>:</p>



<figure><a href="https://docs.google.com/spreadsheets/d/1BuxNntf-KIG_DFYEvKvfPafBI09IM4rjOf2RsGbN9II/edit"><img loading="lazy" width="1920" height="1564" src="https://valkyrie.cdn.ifixit.com/media/2023/09/25125202/parts-pairing-iphone-15-max-2.jpg" alt="" srcset="https://valkyrie.cdn.ifixit.com/media/2023/09/25125202/parts-pairing-iphone-15-max-2.jpg 1920w, https://valkyrie.cdn.ifixit.com/media/2023/09/25125202/parts-pairing-iphone-15-max-2-1536x1251.jpg 1536w, https://valkyrie.cdn.ifixit.com/media/2023/09/25125202/parts-pairing-iphone-15-max-2-1105x900.jpg 1105w" sizes="(max-width: 1920px) 100vw, 1920px"></a></figure>



<p>Parts pairing in these models extends beyond mere mechanical compatibility, requiring authentication and pairing through Apple’s System Configuration tool, further limiting genuine replacements to Apple-blessed ones and substantially impacting independent repair enterprises and the overarching issue of e-waste.</p>



<p>Our insights aren’t confined to iPhones; we’ve witnessed analogous situations with MacBooks and iPads where the stranglehold on repairability is tightening, restricting the remit of repairs to Apple or forcing compromises on independent repairs. The slew of software hindrances significantly overshadow any mechanical advancements in design.</p>



<p>That <a href="https://arstechnica.com/gaming/2020/01/unauthorized-bread-a-near-future-tale-of-refugees-and-sinister-iot-appliances/">dystopian future</a> that science fiction authors <a href="https://www.eff.org/deeplinks/2018/05/eff-presents-john-scalzi-science-fiction-story-about-our-right-repair-petition">warned us</a> was coming, where DRM infected every part of our lives? We’re living in it. The result of these extensive limitations is a major infringement of ownership rights and amplification of the e-waste crisis.</p>



<h2>Repairability</h2>



<p>The iPhone 15 Pro Max, 15 Pro, 15 Plus, and 15 all earn a four out of ten. </p>



<div><figure><img loading="lazy" width="400" height="535" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24181350/4_Provisional_Repairability-Score_Drop-Shadow.png" alt=""></figure></div>



<p>The score is provisional because we are awarding some credit for anticipated service manual availability and selling repair parts. Apple doesn’t have either of these live at the moment, but we expect them soon.</p>



<p>Unfortunately, software is the anchor around an otherwise exceptionally designed phone. But without the ability to swap components, repairability suffers dramatically. We don’t purchase products for our team that score below a five, so iFixit will not be purchasing the iPhone 15 for internal use.</p>



<h2>The Bottom Line</h2>



<p>The 15 is an incremental upgrade, and that’s just fine. The rollout of the 14’s innovative open-from-both-sides mechanical architecture is welcome. Investments in camera hardware are always well spent, and the periscope is particularly innovative. Given the expense, reduced drop test tolerance, recycling challenges, and fragile finish, titanium doesn’t seem like the best long-term material for a smartphone—but we’re impressed Apple pulled it off. We tip our hats at the materials engineers, but aluminum works just fine from our perspective.</p>



<p>It’s clearly time for Apple to abandon parts pairing. Some parts calibrations will need to be performed with tooling in the field, and some parts will simply need to be enabled without calibration or the same level of precision that Apple achieves in their factories. That’s perfectly acceptable for a field repair.</p>



<p>A part installed in a phone should just work. Ever since we invented interchangeable parts in the 1800s, parts have been swappable between products. Software shouldn’t be an obstacle to harvesting parts, or using aftermarket parts for that matter. The entire economy of reuse depends on interoperability, from local repair shops to large scale refurbishers to recyclers.</p>



<p>The iPhone is the market leader, but Apple is trailing the pack on repairability. This gap is completely self-inflicted, with a perfectly serviceable hardware design that is sabotaged by an incredibly complex regime of parts pairing and cloud calibrations.</p>



<p>It’s time for Apple to start thinking differently.</p>



<figure><a href="https://valkyrie.cdn.ifixit.com/media/2023/09/24230945/iPhone15_layout_v2.jpg"><img loading="lazy" width="3200" height="1800" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24230945/iPhone15_layout_v2.jpg" alt="" srcset="https://valkyrie.cdn.ifixit.com/media/2023/09/24230945/iPhone15_layout_v2.jpg 3200w, https://valkyrie.cdn.ifixit.com/media/2023/09/24230945/iPhone15_layout_v2-1536x864.jpg 1536w, https://valkyrie.cdn.ifixit.com/media/2023/09/24230945/iPhone15_layout_v2-2048x1152.jpg 2048w, https://valkyrie.cdn.ifixit.com/media/2023/09/24230945/iPhone15_layout_v2-1600x900.jpg 1600w" sizes="(max-width: 3200px) 100vw, 3200px"></a></figure>



<h2>Wallpapers</h2>



<figure>
<figure><a href="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Pro-Max-Wallpaper-1.jpg"><img loading="lazy" width="1290" height="2796" data-id="83058" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Pro-Max-Wallpaper-1.jpg" alt="" srcset="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Pro-Max-Wallpaper-1.jpg 1290w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Pro-Max-Wallpaper-1-709x1536.jpg 709w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Pro-Max-Wallpaper-1-945x2048.jpg 945w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Pro-Max-Wallpaper-1-415x900.jpg 415w" sizes="(max-width: 1290px) 100vw, 1290px"></a><figcaption><strong>iPhone 15 Pro Max Wallpaper</strong></figcaption></figure>



<figure><a href="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Pro-Wallpaper-1.jpg"><img loading="lazy" width="1179" height="2556" data-id="83056" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Pro-Wallpaper-1.jpg" alt="" srcset="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Pro-Wallpaper-1.jpg 1179w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Pro-Wallpaper-1-709x1536.jpg 709w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Pro-Wallpaper-1-945x2048.jpg 945w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Pro-Wallpaper-1-415x900.jpg 415w" sizes="(max-width: 1179px) 100vw, 1179px"></a><figcaption><strong>iPhone 15 Pro Wallpaper</strong></figcaption></figure>



<figure><a href="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Plus-True-Wallpaper-Pink-1.jpg"><img loading="lazy" width="1290" height="2796" data-id="83053" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Plus-True-Wallpaper-Pink-1.jpg" alt="" srcset="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Plus-True-Wallpaper-Pink-1.jpg 1290w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Plus-True-Wallpaper-Pink-1-709x1536.jpg 709w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Plus-True-Wallpaper-Pink-1-945x2048.jpg 945w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Plus-True-Wallpaper-Pink-1-415x900.jpg 415w" sizes="(max-width: 1290px) 100vw, 1290px"></a><figcaption><strong>iPhone 15 Plus True Wallpaper (Pink)</strong></figcaption></figure>



<figure><a href="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Plus-Wallpaper-Pink-1.jpg"><img loading="lazy" width="1290" height="2796" data-id="83059" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Plus-Wallpaper-Pink-1.jpg" alt="" srcset="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Plus-Wallpaper-Pink-1.jpg 1290w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Plus-Wallpaper-Pink-1-709x1536.jpg 709w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Plus-Wallpaper-Pink-1-945x2048.jpg 945w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Plus-Wallpaper-Pink-1-415x900.jpg 415w" sizes="(max-width: 1290px) 100vw, 1290px"></a><figcaption><strong>iPhone 15 Plus Rear Wallpaper (Pink)</strong></figcaption></figure>



<figure><a href="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Plus-True-Wallpaper-1.jpg"><img loading="lazy" width="1290" height="2796" data-id="83052" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Plus-True-Wallpaper-1.jpg" alt="" srcset="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Plus-True-Wallpaper-1.jpg 1290w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Plus-True-Wallpaper-1-709x1536.jpg 709w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Plus-True-Wallpaper-1-945x2048.jpg 945w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Plus-True-Wallpaper-1-415x900.jpg 415w" sizes="(max-width: 1290px) 100vw, 1290px"></a><figcaption><strong>iPhone 15 Plus True Wallpaper (Neutral)</strong></figcaption></figure>



<figure><a href="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Plus-Wallpaper-1.jpg"><img loading="lazy" width="1290" height="2796" data-id="83057" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Plus-Wallpaper-1.jpg" alt="" srcset="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Plus-Wallpaper-1.jpg 1290w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Plus-Wallpaper-1-709x1536.jpg 709w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Plus-Wallpaper-1-945x2048.jpg 945w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Plus-Wallpaper-1-415x900.jpg 415w" sizes="(max-width: 1290px) 100vw, 1290px"></a><figcaption><strong>iPhone 15 Plus Rear Wallpaper (Neutral)</strong></figcaption></figure>



<figure><a href="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-True-Wallpaper-Pink-1.jpg"><img loading="lazy" width="1179" height="2556" data-id="83051" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-True-Wallpaper-Pink-1.jpg" alt="" srcset="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-True-Wallpaper-Pink-1.jpg 1179w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-True-Wallpaper-Pink-1-709x1536.jpg 709w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-True-Wallpaper-Pink-1-945x2048.jpg 945w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-True-Wallpaper-Pink-1-415x900.jpg 415w" sizes="(max-width: 1179px) 100vw, 1179px"></a><figcaption><strong>iPhone 15 True Wallpaper (Pink)</strong></figcaption></figure>



<figure><a href="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Wallpaper-Pink.jpg"><img loading="lazy" width="1179" height="2556" data-id="83054" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Wallpaper-Pink.jpg" alt="" srcset="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Wallpaper-Pink.jpg 1179w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Wallpaper-Pink-709x1536.jpg 709w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Wallpaper-Pink-945x2048.jpg 945w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Wallpaper-Pink-415x900.jpg 415w" sizes="(max-width: 1179px) 100vw, 1179px"></a><figcaption><strong>iPhone 15 Rear Wallpaper (Pink)</strong></figcaption></figure>



<figure><a href="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-True-Wallpaper-1.jpg"><img loading="lazy" width="1179" height="2556" data-id="83050" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-True-Wallpaper-1.jpg" alt="" srcset="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-True-Wallpaper-1.jpg 1179w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-True-Wallpaper-1-709x1536.jpg 709w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-True-Wallpaper-1-945x2048.jpg 945w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-True-Wallpaper-1-415x900.jpg 415w" sizes="(max-width: 1179px) 100vw, 1179px"></a><figcaption><strong>iPhone 15 True Wallpaper (Neutral)</strong> </figcaption></figure>



<figure><a href="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Wallpaper-1.jpg"><img loading="lazy" width="1179" height="2556" data-id="83055" src="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Wallpaper-1.jpg" alt="" srcset="https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Wallpaper-1.jpg 1179w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Wallpaper-1-709x1536.jpg 709w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Wallpaper-1-945x2048.jpg 945w, https://valkyrie.cdn.ifixit.com/media/2023/09/24231829/iPhone-15-Wallpaper-1-415x900.jpg 415w" sizes="(max-width: 1179px) 100vw, 1179px"></a><figcaption><strong>iPhone 15 Rear Wallpaper (Neutral)</strong></figcaption></figure>
</figure>
    
  </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Costco now offering virtual medical care for $29 (206 pts)]]></title>
            <link>https://www.cbsnews.com/news/costco-virtual-medical-checkups-for-29/</link>
            <guid>37653831</guid>
            <pubDate>Tue, 26 Sep 2023 03:07:25 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.cbsnews.com/news/costco-virtual-medical-checkups-for-29/">https://www.cbsnews.com/news/costco-virtual-medical-checkups-for-29/</a>, See on <a href="https://news.ycombinator.com/item?id=37653831">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
                    
                            
                                    
                                                        
<article id="article-0" data-index="0" data-path="/news/costco-virtual-medical-checkups-for-29/" data-infinite-scroll-options="{&quot;toggleClass&quot;:&quot;has--infinite-scroll&quot;,&quot;baseEl&quot;:&quot;.content__body&quot;,&quot;assetId&quot;:&quot;0d8de626-1f6c-4704-8d15-3ad7983ae925&quot;}" data-component="[&quot;infinite-scroll&quot;]">

  <div id="article-header" data-sort-time="1695684167000" data-update-time="1695684167000">
    <header><p>
        <a href="https://www.cbsnews.com/moneywatch?ftag=CNM-16-10abg0d" data-invalid-url-rewritten-http="">
          MoneyWatch
          </a>
      </p>
      
      
      <div>

        <!-- show SVG here -->
                            <p><a href="https://www.cbsnews.com/moneywatch">
            <img width="60" height="60" alt="moneywatch" src="https://www.cbsnews.com/assets/show/moneywatch/logo-square-32.svg" loading="lazy"></a></p><!-- end show SVG -->

                  
        
        <p>
          <time datetime="2023-09-25T18:36:00-0400">September 25, 2023 / 6:36 PM</time>
          / MoneyWatch
        </p>
        


</div>
          </header></div>

      
  
  <section><p>For just under the cost of six Costco rotisserie chickens — still $4.99 after more than a decade — members of the warehouse club can visit a doctor online.</p><p>Online marketplace Sesame is partnering with the retail "members only" giant to offer Costco members virtual primary care for $29 in all 50 states, the New York-based startup said Monday in a blog&nbsp;<a href="https://sesamecare.com/blog/sesame-costco-partnership" target="_blank" rel="nofollow noopener">post</a>.</p><p>The health care services listed via a link on the Costco Pharmacy's <a href="https://www.costco.com/pharmacy/warehouse-pickup" target="_blank" rel="nofollow noopener">homepage</a>&nbsp;include virtual checkups involving a standard lab panel and virtual follow-up with a doctor for $72, and virtual mental health visits. &nbsp;</p><figure>
          <figcaption><a href="https://www.cbsnews.com/video/high-health-insurance-deductibles-are-causing-financial-hardship/" data-invalid-url-rewritten-http="">
          
          <span>
            </span>

          <span>High health insurance deductibles are causing financial hardship</span>

          <span>01:05</span>

                      </a>
                  
        
        
              </figcaption></figure><p>Sesame said it<span><a href="https://www.cbsnews.com/news/cancer-treatment-uninsured/" target="_blank" data-invalid-url-rewritten-http=""> targets the uninsured</a></span> and those with high deductibles who need to pay cash. It doesn't accept health insurance to help keep prices low.&nbsp;</p>    
  <p>"Quality, great value and low price are what the Costco brand is known for," David Goldhill, Sesame's co-founder and CEO, stated. "When it comes to health care, Sesame also delivers high quality and great value — and a low price that will be appreciated by Costco Members when it comes to their own care."</p><p>The move has Costco following other major retailers in offering health care services. Amazon provides &nbsp;around-the-clock remote access to third-party health care providers and Walmart Inc. runs in-store medical clinics.&nbsp;</p>
                  
        
      
        
    <!-- data-recirc-source="chartbeat" -->

    <!-- tags --></section><div id="soft-login-gate" data-soft-login-gate-options="{&quot;url&quot;:&quot;https:\/\/www.cbsnews.com\/user\/email-check\/&quot;}" data-smart-banner-options="{&quot;cookieName&quot;:&quot;SB_soft-login-gate&quot;,&quot;bannerVisibleClass&quot;:&quot;soft-login-gate--visible&quot;,&quot;bannerHiddenClass&quot;:&quot;soft-login-gate--hidden&quot;,&quot;retryDays&quot;:0}" data-component="[&quot;soft-login-gate&quot;,&quot;smart-banner&quot;,&quot;logingate-cookie-check&quot;]">
    <p>Thanks for reading CBS NEWS. </p>
    <p>Create your free account or log in <br> for more features.</p>

    <form method="post" id="soft-login-gate__form">
        
        <div>
            <p>
                Please enter email address to continue
            </p>
            <p>
                Please enter valid email address to continue
            </p>
        </div>
    </form>
</div>
  
  </article></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Nickel Hydrogen Batteries by NASA (121 pts)]]></title>
            <link>https://spectrum.ieee.org/grid-scale-battery-storage-nickel-hydrogen</link>
            <guid>37653656</guid>
            <pubDate>Tue, 26 Sep 2023 02:39:10 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://spectrum.ieee.org/grid-scale-battery-storage-nickel-hydrogen">https://spectrum.ieee.org/grid-scale-battery-storage-nickel-hydrogen</a>, See on <a href="https://news.ycombinator.com/item?id=37653656">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-elid="2665718559" data-post-url="https://spectrum.ieee.org/grid-scale-battery-storage-nickel-hydrogen" data-authors="Prachi Patel" data-headline="NASA Battery Tech to Deliver for the Grid" data-page-title="NASA Battery Tech to Deliver for the Grid - IEEE Spectrum"><p>Technologies for space are designed to be tough, safe, and long-lasting. So what happens when you bring the battery chemistry deployed on the International Space Station, <a href="https://en.wikipedia.org/wiki/Nickel%E2%80%93hydrogen_battery" target="_blank">nickel-hydrogen</a>, down to Earth? </p><p>“[It’s] the most durable battery ever invented,” says Jorg Heinemann. Nickel-hydrogen batteries, he says, can last for 30,000 charge cycles, are fireproof, and outperform lithium-ion batteries on a number of key metrics for energy storage at the large scale.</p><p>Heinemann is CEO of <a href="https://enervenue.com/" rel="noopener noreferrer" target="_blank">EnerVenue</a>, a Fremont, California-based nickel-hydrogen battery manufacturer. “Our cost is comparable to where lithium-ion is going, and we use earth-abundant materials,” he says. “Nickel is the most expensive thing we use. We operate at a ninety percent round-trip efficiency, more efficient than lithium-ion. And there’s basically no maintenance on this battery, it was designed for sending up on a rocket ship into outer space.”</p><p>Nickel-hydrogen batteries can run for tens of thousands of cycles, giving them a life of over 30 years. </p><p>This fall, the company will finish construction of a 92,900 square-meter gigafactory in Kentucky that will start by making up to five gigawatt-hours’ worth of batteries annually. He projects the facility will reach its full capacity when it’s churning out 20 GWh of cells per year. </p><p>Nickel-hydrogen batteries look and work unlike any other battery. They consist of a stack of electrodes inside a pressurized gas tank. The cathode is <a href="https://en.wikipedia.org/wiki/Nickel(II)_hydroxide" target="_blank">nickel hydroxide</a> while the anode is hydrogen. When the battery is charging, a catalytic reaction generates hydrogen gas. During discharge, the hydrogen oxidizes and converts back to water.</p><p>The chemistry was designed in the 1970s and chosen for the space program because “there were really no other alternatives then,” Heinemann says. Lithium-ion was in its infancy and lasted for about 200 cycles, while lead-acid lasted around 500. </p><p>Nickel-hydrogen batteries can run for tens of thousands of cycles, giving them a life of over 30 years. Their use of <a href="https://spectrum.ieee.org/precious-metal-free-fuel-cell" target="_self">expensive platinum catalysts</a> kept them relegated to space applications until five years ago, when Stanford materials science and engineering professor and <a href="https://spectrum.ieee.org/silicon-anode-battery" target="_self">battery entrepreneur</a> Yi Cui’s team <a href="https://www.pnas.org/doi/full/10.1073/pnas.1809344115" rel="noopener noreferrer" target="_blank">found an inexpensive nickel-molybdenum-cobalt alloy catalyst</a> for the battery that costs $20/kg. </p><p>Cui helped launch EnerVenue in 2020 and is now the startup’s chairman and chief technology officer. The company’s newest-generation batteries, revealed in early September, are tanks measuring 1.8 meters long (6 feet) and 15 centimeters wide (6 inches) with an energy capacity of 3kWh, Heinemann says.</p><p>“I call it the barbecue test. We take the battery, put it in an open fire, and watch it continue to heat up.”<br>—Jorg Heinemann, EnerVenue</p><p>Needing a pressurized vessel raises eyebrows, he adds, but the reactions are very stable and as hydrogen gas builds up inside the tank, it reaches a peak pressure that is about 5 percent of what a hydrogen fuel cell would typically reach. The nature of the chemistry is such that if the pressure continues to rise past the maximum, it forces the recombination of hydrogen back into water. So there is no mechanism for thermal runaway as there is in lithium-ion, where byproducts of the reaction can sometimes cause uncontrolled buildup of heat that can cause fires.</p><p>“I call it the barbecue test,” Heinemann says. “We take the battery, put it in an open fire, and watch it continue to heat up. What ends up happening is that the pressure above top charge will force the hydrogen back into water. And then we have a release valve designed into the unit so at a predesigned pressure and temperature that will release, and you’ll get a steam vent.”</p><p data-rm-resized-container="25%"><img alt="photo of many racks of EnerVenue batteries in a warehouse space" data-rm-shortcode-id="f89f7a0efbbda4d328ec9ca1804a0f7d" data-rm-shortcode-name="rebelmouse-image" data-runner-src="https://spectrum.ieee.org/media-library/photo-of-many-racks-of-enervenue-batteries-in-a-warehouse-space.jpg?id=44646962&amp;width=980" height="1295" id="2fa55" lazy-loadable="true" src="https://spectrum.ieee.org/media-library/photo-of-many-racks-of-enervenue-batteries-in-a-warehouse-space.jpg?id=44646962&amp;width=980" width="1800"><small data-gramm="false" data-lt-tmp-id="lt-83122" placeholder="Add Photo Caption..." spellcheck="false">EnerVenue says its cylindrical batteries are low-maintenance and non-volatile and will require no special heating, cooling, or safety systems—unlike lithium-ion battery storage. </small><small data-gramm="false" data-lt-tmp-id="lt-975200" placeholder="Add Photo Credit..." spellcheck="false"> EnerVenue</small></p><p>Another advantage is that the battery chemistry works across a wide temperature range of -40 to 60°C. That means any given battery storage bank requires no costly heating, air-conditioning, ventilation, and fire-suppression systems—all of which require their own maintenance and upkeep, in addition to sapping a company’s bottom line.</p><p>Many novel battery technologies are vying for the grid storage market, and nickel-hydrogen batteries are at least tried and tested in small-scale <a href="https://spectrum.ieee.org/topic/aerospace/">aerospace</a> applications. But they haven’t been made and tested on large scale yet, and the new metal alloy catalyst has yet to prove itself in the real world.</p><p><span></span>“Like many early-stage technologies, EnerVenue’s nickel-hydrogen batteries currently cost more than lithium-ion batteries,” says Aaron Marks, an energy storage technology analyst at <a href="https://www.woodmac.com/" target="_blank">Wood Mackenzie</a>. “They also have lower energy density, meaning more space and more batteries are needed for the same power rating.” But, he adds, their less intensive manufacturing process may provide a key advantage for companies like EnerVenue to ramp up manufacturing. The batteries’ relative safety and long life should also make them very competitive. “Once the technology reaches scale, it will help make the entire technology landscape better and cheaper just by virtue of providing real competition,” Marks says.<br></p><p>So far, EnerVenue has been operating a pilot production line that can manufacture 100 megawatt-hours’ worth of batteries per year—and they’ve deployed small-scale test systems. But, says Heinemann, the company already has over 7 GWh, or about 400 million dollars’ worth of purchase orders, including from solar energy developer <a href="https://pv-magazine-usa.com/2022/05/17/pine-gate-purchases-2-4-gwh-of-enervenue-batteries/" target="_blank">Pine Gate Renewables</a> and <a href="https://enervenue.com/schlumberger-new-energy-enters-into-agreement-with-enervenue-for-metal-hydrogen-stationary-energy-storage-solutions/" rel="noopener noreferrer" target="_blank">Schlumberger New Energy</a>. “Our mission,” he says, “Is to become the number one provider of stationary storage serving power plants, businesses and homes globally.”</p></div></div>]]></description>
        </item>
    </channel>
</rss>