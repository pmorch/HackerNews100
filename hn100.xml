<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
    <channel>
        <title>HN100 - Readable Contents</title>
        <link>https://hn.algolia.com/api/v1/search_by_date?tags=%28story,poll%29&amp;numericFilters=points%3E100</link>
        <description>Uses Readability to add bodies to the RSS feed</description>
        <lastBuildDate>Fri, 06 Oct 2023 09:00:05 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Rails 7.1 Released (163 pts)]]></title>
            <link>https://github.com/rails/rails/releases/tag/v7.1.0</link>
            <guid>37787130</guid>
            <pubDate>Fri, 06 Oct 2023 04:31:36 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/rails/rails/releases/tag/v7.1.0">https://github.com/rails/rails/releases/tag/v7.1.0</a>, See on <a href="https://news.ycombinator.com/item?id=37787130">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
<li>
<p>Fix <code>AS::MessagePack</code> with <code>ENV["RAILS_MAX_THREADS"]</code>.</p>
<p><em>Jonathan Hefner</em></p>
</li>
<li>
<p>Add a new public API for broadcasting logs</p>
<p>This feature existed for a while but was until now a private API.<br>
Broadcasting log allows to send log message to difference sinks (STDOUT, a file ...) and<br>
is used by default in the development environment to write logs both on STDOUT and in the<br>
"development.log" file.</p>
<p>Basic usage:</p>
<div data-snippet-clipboard-copy-content="stdout_logger = Logger.new(STDOUT)
file_logger = Logger.new(&quot;development.log&quot;)
broadcast = ActiveSupport::BroadcastLogger.new(stdout_logger, file_logger)

broadcast.info(&quot;Hello!&quot;) # The &quot;Hello!&quot; message is written on STDOUT and in the log file."><pre><span>stdout_logger</span> <span>=</span> <span>Logger</span><span>.</span><span>new</span><span>(</span><span>STDOUT</span><span>)</span>
<span>file_logger</span> <span>=</span> <span>Logger</span><span>.</span><span>new</span><span>(</span><span>"development.log"</span><span>)</span>
<span>broadcast</span> <span>=</span> <span>ActiveSupport</span>::<span>BroadcastLogger</span><span>.</span><span>new</span><span>(</span><span>stdout_logger</span><span>,</span> <span>file_logger</span><span>)</span>

<span>broadcast</span><span>.</span><span>info</span><span>(</span><span>"Hello!"</span><span>)</span> <span># The "Hello!" message is written on STDOUT and in the log file.</span></pre></div>
<p>Adding other sink(s) to the broadcast:</p>
<div data-snippet-clipboard-copy-content="broadcast = ActiveSupport::BroadcastLogger.new
broadcast.broadcast_to(Logger.new(STDERR))"><pre><span>broadcast</span> <span>=</span> <span>ActiveSupport</span>::<span>BroadcastLogger</span><span>.</span><span>new</span>
<span>broadcast</span><span>.</span><span>broadcast_to</span><span>(</span><span>Logger</span><span>.</span><span>new</span><span>(</span><span>STDERR</span><span>)</span><span>)</span></pre></div>
<p>Remove a sink from the broadcast:</p>
<div data-snippet-clipboard-copy-content="stdout_logger = Logger.new(STDOUT)
broadcast = ActiveSupport::BroadcastLogger.new(stdout_logger)

broadcast.stop_broadcasting_to(stdout_logger)"><pre><span>stdout_logger</span> <span>=</span> <span>Logger</span><span>.</span><span>new</span><span>(</span><span>STDOUT</span><span>)</span>
<span>broadcast</span> <span>=</span> <span>ActiveSupport</span>::<span>BroadcastLogger</span><span>.</span><span>new</span><span>(</span><span>stdout_logger</span><span>)</span>

<span>broadcast</span><span>.</span><span>stop_broadcasting_to</span><span>(</span><span>stdout_logger</span><span>)</span></pre></div>
<p><em>Edouard Chin</em></p>
</li>
<li>
<p>Fix Range#overlap? not taking empty ranges into account on Ruby &lt; 3.3</p>
<p><em>Nobuyoshi Nakada</em>, <em>Shouichi Kamiya</em>, <em>Hartley McGuire</em></p>
</li>
<li>
<p>Use Ruby 3.3 Range#overlap? if available</p>
<p><em>Yasuo Honda</em></p>
</li>
<li>
<p>Add <code>bigdecimal</code> as Active Support dependency that is a bundled gem candidate for Ruby 3.4.</p>
<p><code>bigdecimal</code> 3.1.4 or higher version will be installed.<br>
Ruby 2.7 and 3.0 users who want <code>bigdecimal</code> version 2.0.0 or 3.0.0 behavior as a default gem,<br>
pin the <code>bigdecimal</code> version in your application Gemfile.</p>
<p><em>Koichi ITO</em></p>
</li>
<li>
<p>Add <code>drb</code>, <code>mutex_m</code> and <code>base64</code> that are bundled gem candidates for Ruby 3.4</p>
<p><em>Yasuo Honda</em></p>
</li>
<li>
<p>When using cache format version &gt;= 7.1 or a custom serializer, expired and<br>
version-mismatched cache entries can now be detected without deserializing<br>
their values.</p>
<p><em>Jonathan Hefner</em></p>
</li>
<li>
<p>Make all cache stores return a boolean for <code>#delete</code></p>
<p>Previously the <code>RedisCacheStore#delete</code> would return <code>1</code> if the entry<br>
exists and <code>0</code> otherwise. Now it returns true if the entry exists and false<br>
otherwise, just like the other stores.</p>
<p>The <code>FileStore</code> would return <code>nil</code> if the entry doesn't exists and returns<br>
<code>false</code> now as well.</p>
<p><em>Petrik de Heus</em></p>
</li>
<li>
<p>Active Support cache stores now support replacing the default compressor via<br>
a <code>:compressor</code> option. The specified compressor must respond to <code>deflate</code><br>
and <code>inflate</code>. For example:</p>
<div data-snippet-clipboard-copy-content="module MyCompressor
  def self.deflate(string)
    # compression logic...
  end

  def self.inflate(compressed)
    # decompression logic...
  end
end

config.cache_store = :redis_cache_store, { compressor: MyCompressor }"><pre><span>module</span> <span>MyCompressor</span>
  <span>def</span> <span>self</span><span>.</span><span>deflate</span><span>(</span><span>string</span><span>)</span>
    <span># compression logic...</span>
  <span>end</span>

  <span>def</span> <span>self</span><span>.</span><span>inflate</span><span>(</span><span>compressed</span><span>)</span>
    <span># decompression logic...</span>
  <span>end</span>
<span>end</span>

<span>config</span><span>.</span><span>cache_store</span> <span>=</span> <span>:redis_cache_store</span><span>,</span> <span>{</span> <span>compressor</span>: <span>MyCompressor</span> <span>}</span></pre></div>
<p><em>Jonathan Hefner</em></p>
</li>
<li>
<p>Active Support cache stores now support a <code>:serializer</code> option. Similar to<br>
the <code>:coder</code> option, serializers must respond to <code>dump</code> and <code>load</code>. However,<br>
serializers are only responsible for serializing a cached value, whereas<br>
coders are responsible for serializing the entire <code>ActiveSupport::Cache::Entry</code><br>
instance.  Additionally, the output from serializers can be automatically<br>
compressed, whereas coders are responsible for their own compression.</p>
<p>Specifying a serializer instead of a coder also enables performance<br>
optimizations, including the bare string optimization introduced by cache<br>
format version 7.1.</p>
<p>The <code>:serializer</code> and <code>:coder</code> options are mutually exclusive. Specifying<br>
both will raise an <code>ArgumentError</code>.</p>
<p><em>Jonathan Hefner</em></p>
</li>
<li>
<p>Fix <code>ActiveSupport::Inflector.humanize(nil)</code> raising <code>NoMethodError: undefined method `end_with?' for nil:NilClass</code>.</p>
<p><em>James Robinson</em></p>
</li>
<li>
<p>Don't show secrets for <code>ActiveSupport::KeyGenerator#inspect</code>.</p>
<p>Before:</p>
<div data-snippet-clipboard-copy-content="ActiveSupport::KeyGenerator.new(secret).inspect
&quot;#<ActiveSupport::KeyGenerator:0x0000000104888038 ... @secret=\&quot;\\xAF\\bFh]LV}q\\nl\\xB2U\\xB3 ... >&quot;"><pre><span>ActiveSupport</span>::<span>KeyGenerator</span><span>.</span><span>new</span><span>(</span><span>secret</span><span>)</span><span>.</span><span>inspect</span>
<span>"#&lt;ActiveSupport::KeyGenerator:0x0000000104888038 ... @secret=<span>\"</span><span>\\</span>xAF<span>\\</span>bFh]LV}q<span>\\</span>nl<span>\\</span>xB2U<span>\\</span>xB3 ... &gt;"</span></pre></div>
<p>After:</p>
<div data-snippet-clipboard-copy-content="ActiveSupport::KeyGenerator::Aes256Gcm(secret).inspect
&quot;#<ActiveSupport::KeyGenerator:0x0000000104888038>&quot;"><pre><span>ActiveSupport</span>::<span>KeyGenerator</span>::<span>Aes256Gcm</span><span>(</span><span>secret</span><span>)</span><span>.</span><span>inspect</span>
<span>"#&lt;ActiveSupport::KeyGenerator:0x0000000104888038&gt;"</span></pre></div>
<p><em>Petrik de Heus</em></p>
</li>
<li>
<p>Improve error message when EventedFileUpdateChecker is used without a<br>
compatible version of the Listen gem</p>
<p><em>Hartley McGuire</em></p>
</li>
<li>
<p>Add <code>:report</code> behavior for Deprecation</p>
<p>Setting <code>config.active_support.deprecation = :report</code> uses the error<br>
reporter to report deprecation warnings to <code>ActiveSupport::ErrorReporter</code>.</p>
<p>Deprecations are reported as handled errors, with a severity of <code>:warning</code>.</p>
<p>Useful to report deprecations happening in production to your bug tracker.</p>
<p><em>Étienne Barrié</em></p>
</li>
<li>
<p>Rename <code>Range#overlaps?</code> to <code>#overlap?</code> and add alias for backwards compatibility</p>
<p><em>Christian Schmidt</em></p>
</li>
<li>
<p>Fix <code>EncryptedConfiguration</code> returning incorrect values for some <code>Hash</code><br>
methods</p>
<p><em>Hartley McGuire</em></p>
</li>
<li>
<p>Don't show secrets for <code>MessageEncryptor#inspect</code>.</p>
<p>Before:</p>
<div data-snippet-clipboard-copy-content="ActiveSupport::MessageEncryptor.new(secret, cipher: &quot;aes-256-gcm&quot;).inspect
&quot;#<ActiveSupport::MessageEncryptor:0x0000000104888038 ... @secret=\&quot;\\xAF\\bFh]LV}q\\nl\\xB2U\\xB3 ... >&quot;"><pre><span>ActiveSupport</span>::<span>MessageEncryptor</span><span>.</span><span>new</span><span>(</span><span>secret</span><span>,</span> <span>cipher</span>: <span>"aes-256-gcm"</span><span>)</span><span>.</span><span>inspect</span>
<span>"#&lt;ActiveSupport::MessageEncryptor:0x0000000104888038 ... @secret=<span>\"</span><span>\\</span>xAF<span>\\</span>bFh]LV}q<span>\\</span>nl<span>\\</span>xB2U<span>\\</span>xB3 ... &gt;"</span></pre></div>
<p>After:</p>
<div data-snippet-clipboard-copy-content="ActiveSupport::MessageEncryptor.new(secret, cipher: &quot;aes-256-gcm&quot;).inspect
&quot;#<ActiveSupport::MessageEncryptor:0x0000000104888038>&quot;"><pre><span>ActiveSupport</span>::<span>MessageEncryptor</span><span>.</span><span>new</span><span>(</span><span>secret</span><span>,</span> <span>cipher</span>: <span>"aes-256-gcm"</span><span>)</span><span>.</span><span>inspect</span>
<span>"#&lt;ActiveSupport::MessageEncryptor:0x0000000104888038&gt;"</span></pre></div>
<p><em>Petrik de Heus</em></p>
</li>
<li>
<p>Don't show contents for <code>EncryptedConfiguration#inspect</code>.</p>
<p>Before:</p>
<div data-snippet-clipboard-copy-content="Rails.application.credentials.inspect
&quot;#<ActiveSupport::EncryptedConfiguration:0x000000010d2b38e8 ... @config={:secret=>\&quot;something secret\&quot;} ... @key_file_contents=\&quot;915e4ea054e011022398dc242\&quot; ...>&quot;"><pre><span>Rails</span><span>.</span><span>application</span><span>.</span><span>credentials</span><span>.</span><span>inspect</span>
<span>"#&lt;ActiveSupport::EncryptedConfiguration:0x000000010d2b38e8 ... @config={:secret=&gt;<span>\"</span>something secret<span>\"</span>} ... @key_file_contents=<span>\"</span>915e4ea054e011022398dc242<span>\"</span> ...&gt;"</span></pre></div>
<p>After:</p>
<div data-snippet-clipboard-copy-content="Rails.application.credentials.inspect
&quot;#<ActiveSupport::EncryptedConfiguration:0x000000010d2b38e8>&quot;"><pre><span>Rails</span><span>.</span><span>application</span><span>.</span><span>credentials</span><span>.</span><span>inspect</span>
<span>"#&lt;ActiveSupport::EncryptedConfiguration:0x000000010d2b38e8&gt;"</span></pre></div>
<p><em>Petrik de Heus</em></p>
</li>
<li>
<p><code>ERB::Util.html_escape_once</code> always returns an <code>html_safe</code> string.</p>
<p>This method previously maintained the <code>html_safe?</code> property of a string on the return<br>
value. Because this string has been escaped, however, not marking it as <code>html_safe</code> causes<br>
entities to be double-escaped.</p>
<p>As an example, take this view snippet:</p>
<div data-snippet-clipboard-copy-content="<p><%= html_escape_once(&quot;this &amp; that &amp;amp; the other&quot;) %></p>"><pre><span>&lt;</span><span>p</span><span>&gt;</span><span>&lt;</span>%= html_escape_once("this &amp; that &amp;amp; the other") %<span>&gt;</span><span>&lt;/</span><span>p</span><span>&gt;</span></pre></div>
<p>Before this change, that would be double-escaped and render as:</p>
<div data-snippet-clipboard-copy-content="<p>this &amp;amp;amp; that &amp;amp;amp; the other</p>"><pre><span>&lt;</span><span>p</span><span>&gt;</span>this &amp;amp;amp; that &amp;amp;amp; the other<span>&lt;/</span><span>p</span><span>&gt;</span></pre></div>
<p>After this change, it renders correctly as:</p>
<div data-snippet-clipboard-copy-content="<p>this &amp;amp; that &amp;amp; the other</p>"><pre><span>&lt;</span><span>p</span><span>&gt;</span>this &amp;amp; that &amp;amp; the other<span>&lt;/</span><span>p</span><span>&gt;</span></pre></div>
<p>Fixes <a data-error-text="Failed to load title" data-id="1717796292" data-permission-text="Title is private" data-url="https://github.com/rails/rails/issues/48256" data-hovercard-type="issue" data-hovercard-url="/rails/rails/issues/48256/hovercard" href="https://github.com/rails/rails/issues/48256">#48256</a></p>
<p><em>Mike Dalessio</em></p>
</li>
<li>
<p>Deprecate <code>SafeBuffer#clone_empty</code>.</p>
<p>This method has not been used internally since Rails 4.2.0.</p>
<p><em>Mike Dalessio</em></p>
</li>
<li>
<p><code>MessageEncryptor</code>, <code>MessageVerifier</code>, and <code>config.active_support.message_serializer</code><br>
now accept <code>:message_pack</code> and <code>:message_pack_allow_marshal</code> as serializers.<br>
These serializers require the <a href="https://rubygems.org/gems/msgpack" rel="nofollow"><code>msgpack</code> gem</a><br>
(&gt;= 1.7.0).</p>
<p>The Message Pack format can provide improved performance and smaller payload<br>
sizes. It also supports round-tripping some Ruby types that are not supported<br>
by JSON. For example:</p>
<div data-snippet-clipboard-copy-content="verifier = ActiveSupport::MessageVerifier.new(&quot;secret&quot;)
data = [{ a: 1 }, { b: 2 }.with_indifferent_access, 1.to_d, Time.at(0, 123)]
message = verifier.generate(data)

# BEFORE with config.active_support.message_serializer = :json
verifier.verified(message)
# => [{&quot;a&quot;=>1}, {&quot;b&quot;=>2}, &quot;1.0&quot;, &quot;1969-12-31T18:00:00.000-06:00&quot;]
verifier.verified(message).map(&amp;:class)
# => [Hash, Hash, String, String]

# AFTER with config.active_support.message_serializer = :message_pack
verifier.verified(message)
# => [{:a=>1}, {&quot;b&quot;=>2}, 0.1e1, 1969-12-31 18:00:00.000123 -0600]
verifier.verified(message).map(&amp;:class)
# => [Hash, ActiveSupport::HashWithIndifferentAccess, BigDecimal, Time]"><pre><span>verifier</span> <span>=</span> <span>ActiveSupport</span>::<span>MessageVerifier</span><span>.</span><span>new</span><span>(</span><span>"secret"</span><span>)</span>
<span>data</span> <span>=</span> <span>[</span><span>{</span> <span>a</span>: <span>1</span> <span>}</span><span>,</span> <span>{</span> <span>b</span>: <span>2</span> <span>}</span><span>.</span><span>with_indifferent_access</span><span>,</span> <span>1</span><span>.</span><span>to_d</span><span>,</span> <span>Time</span><span>.</span><span>at</span><span>(</span><span>0</span><span>,</span> <span>123</span><span>)</span><span>]</span>
<span>message</span> <span>=</span> <span>verifier</span><span>.</span><span>generate</span><span>(</span><span>data</span><span>)</span>

<span># BEFORE with config.active_support.message_serializer = :json</span>
<span>verifier</span><span>.</span><span>verified</span><span>(</span><span>message</span><span>)</span>
<span># =&gt; [{"a"=&gt;1}, {"b"=&gt;2}, "1.0", "1969-12-31T18:00:00.000-06:00"]</span>
<span>verifier</span><span>.</span><span>verified</span><span>(</span><span>message</span><span>)</span><span>.</span><span>map</span><span>(</span>&amp;<span>:class</span><span>)</span>
<span># =&gt; [Hash, Hash, String, String]</span>

<span># AFTER with config.active_support.message_serializer = :message_pack</span>
<span>verifier</span><span>.</span><span>verified</span><span>(</span><span>message</span><span>)</span>
<span># =&gt; [{:a=&gt;1}, {"b"=&gt;2}, 0.1e1, 1969-12-31 18:00:00.000123 -0600]</span>
<span>verifier</span><span>.</span><span>verified</span><span>(</span><span>message</span><span>)</span><span>.</span><span>map</span><span>(</span>&amp;<span>:class</span><span>)</span>
<span># =&gt; [Hash, ActiveSupport::HashWithIndifferentAccess, BigDecimal, Time]</span></pre></div>
<p>The <code>:message_pack</code> serializer can fall back to deserializing with<br>
<code>ActiveSupport::JSON</code> when necessary, and the <code>:message_pack_allow_marshal</code><br>
serializer can fall back to deserializing with <code>Marshal</code> as well as<br>
<code>ActiveSupport::JSON</code>. Additionally, the <code>:marshal</code>, <code>:json</code>, and<br>
<code>:json_allow_marshal</code> serializers can now fall back to deserializing with<br>
<code>ActiveSupport::MessagePack</code> when necessary. These behaviors ensure old<br>
messages can still be read so that migration is easier.</p>
<p><em>Jonathan Hefner</em></p>
</li>
<li>
<p>A new <code>7.1</code> cache format is available which includes an optimization for<br>
bare string values such as view fragments.</p>
<p>The <code>7.1</code> cache format is used by default for new apps, and existing apps<br>
can enable the format by setting <code>config.load_defaults 7.1</code> or by setting<br>
<code>config.active_support.cache_format_version = 7.1</code> in <code>config/application.rb</code><br>
or a <code>config/environments/*.rb</code> file.</p>
<p>Cache entries written using the <code>6.1</code> or <code>7.0</code> cache formats can be read<br>
when using the <code>7.1</code> format. To perform a rolling deploy of a Rails 7.1<br>
upgrade, wherein servers that have not yet been upgraded must be able to<br>
read caches from upgraded servers, leave the cache format unchanged on the<br>
first deploy, then enable the <code>7.1</code> cache format on a subsequent deploy.</p>
<p><em>Jonathan Hefner</em></p>
</li>
<li>
<p>Active Support cache stores can now use a preconfigured serializer based on<br>
<code>ActiveSupport::MessagePack</code> via the <code>:serializer</code> option:</p>
<div data-snippet-clipboard-copy-content="config.cache_store = :redis_cache_store, { serializer: :message_pack }"><pre><span>config</span><span>.</span><span>cache_store</span> <span>=</span> <span>:redis_cache_store</span><span>,</span> <span>{</span> <span>serializer</span>: <span>:message_pack</span> <span>}</span></pre></div>
<p>The <code>:message_pack</code> serializer can reduce cache entry sizes and improve<br>
performance, but requires the <a href="https://rubygems.org/gems/msgpack" rel="nofollow"><code>msgpack</code> gem</a><br>
(&gt;= 1.7.0).</p>
<p>The <code>:message_pack</code> serializer can read cache entries written by the default<br>
serializer, and the default serializer can now read entries written by the<br>
<code>:message_pack</code> serializer. These behaviors make it easy to migrate between<br>
serializer without invalidating the entire cache.</p>
<p><em>Jonathan Hefner</em></p>
</li>
<li>
<p><code>Object#deep_dup</code> no longer duplicate named classes and modules.</p>
<p>Before:</p>
<div data-snippet-clipboard-copy-content="hash = { class: Object, module: Kernel }
hash.deep_dup # => {:class=>#<Class:0x00000001063ffc80>, :module=>#<Module:0x00000001063ffa00>}"><pre><span>hash</span> <span>=</span> <span>{</span> <span>class</span>: <span>Object</span><span>,</span> <span>module</span>: <span>Kernel</span> <span>}</span>
<span>hash</span><span>.</span><span>deep_dup</span> <span># =&gt; {:class=&gt;#&lt;Class:0x00000001063ffc80&gt;, :module=&gt;#&lt;Module:0x00000001063ffa00&gt;}</span></pre></div>
<p>After:</p>
<div data-snippet-clipboard-copy-content="hash = { class: Object, module: Kernel }
hash.deep_dup # => {:class=>Object, :module=>Kernel}"><pre><span>hash</span> <span>=</span> <span>{</span> <span>class</span>: <span>Object</span><span>,</span> <span>module</span>: <span>Kernel</span> <span>}</span>
<span>hash</span><span>.</span><span>deep_dup</span> <span># =&gt; {:class=&gt;Object, :module=&gt;Kernel}</span></pre></div>
<p><em>Jean Boussier</em></p>
</li>
<li>
<p>Consistently raise an <code>ArgumentError</code> if the <code>ActiveSupport::Cache</code> key is blank.</p>
<p><em>Joshua Young</em></p>
</li>
<li>
<p>Deprecate usage of the singleton <code>ActiveSupport::Deprecation</code>.</p>
<p>All usage of <code>ActiveSupport::Deprecation</code> as a singleton is deprecated, the most common one being<br>
<code>ActiveSupport::Deprecation.warn</code>. Gem authors should now create their own deprecator (<code>ActiveSupport::Deprecation</code><br>
object), and use it to emit deprecation warnings.</p>
<p>Calling any of the following without specifying a deprecator argument is also deprecated:</p>
<ul>
<li>Module.deprecate</li>
<li>deprecate_constant</li>
<li>DeprecatedObjectProxy</li>
<li>DeprecatedInstanceVariableProxy</li>
<li>DeprecatedConstantProxy</li>
<li>deprecation-related test assertions</li>
</ul>
<p>Use of <code>ActiveSupport::Deprecation.silence</code> and configuration methods like <code>behavior=</code>, <code>disallowed_behavior=</code>,<br>
<code>disallowed_warnings=</code> should now be aimed at the <a href="https://api.rubyonrails.org/classes/Rails/Application.html#method-i-deprecators" rel="nofollow">application's deprecators</a>.</p>
<div data-snippet-clipboard-copy-content="Rails.application.deprecators.silence do
  # code that emits deprecation warnings
end"><pre><span>Rails</span><span>.</span><span>application</span><span>.</span><span>deprecators</span><span>.</span><span>silence</span> <span>do</span>
  <span># code that emits deprecation warnings</span>
<span>end</span></pre></div>
<p>If your gem has a Railtie or Engine, it's encouraged to add your deprecator to the application's deprecators, that<br>
way the deprecation related configuration options will apply to it as well, e.g.<br>
<code>config.active_support.report_deprecations</code> set to <code>false</code> in the production environment will also disable your<br>
deprecator.</p>
<div data-snippet-clipboard-copy-content="initializer &quot;my_gem.deprecator&quot; do |app|
  app.deprecators[:my_gem] = MyGem.deprecator
end"><pre><span>initializer</span> <span>"my_gem.deprecator"</span> <span>do</span> |<span>app</span>|
  <span>app</span><span>.</span><span>deprecators</span><span>[</span><span>:my_gem</span><span>]</span> <span>=</span> <span>MyGem</span><span>.</span><span>deprecator</span>
<span>end</span></pre></div>
<p><em>Étienne Barrié</em></p>
</li>
<li>
<p>Add <code>Object#with</code> to set and restore public attributes around a block</p>
<div data-snippet-clipboard-copy-content="client.timeout # => 5
client.with(timeout: 1) do
  client.timeout # => 1
end
client.timeout # => 5"><pre><span>client</span><span>.</span><span>timeout</span> <span># =&gt; 5</span>
<span>client</span><span>.</span><span>with</span><span>(</span><span>timeout</span>: <span>1</span><span>)</span> <span>do</span>
  <span>client</span><span>.</span><span>timeout</span> <span># =&gt; 1</span>
<span>end</span>
<span>client</span><span>.</span><span>timeout</span> <span># =&gt; 5</span></pre></div>
<p><em>Jean Boussier</em></p>
</li>
<li>
<p>Remove deprecated support to generate incorrect RFC 4122 UUIDs when providing a namespace ID that is not one of the<br>
constants defined on <code>Digest::UUID</code>.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Deprecate <code>config.active_support.use_rfc4122_namespaced_uuids</code>.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Remove implicit conversion of objects into <code>String</code> by <code>ActiveSupport::SafeBuffer</code>.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Remove deprecated <code>active_support/core_ext/range/include_time_with_zone</code> file.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Deprecate <code>config.active_support.remove_deprecated_time_with_zone_name</code>.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Remove deprecated override of <code>ActiveSupport::TimeWithZone.name</code>.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Deprecate <code>config.active_support.disable_to_s_conversion</code>.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Remove deprecated option to passing a format to <code>#to_s</code> in <code>Array</code>, <code>Range</code>, <code>Date</code>, <code>DateTime</code>, <code>Time</code>,<br>
<code>BigDecimal</code>, <code>Float</code> and, <code>Integer</code>.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Remove deprecated <code>ActiveSupport::PerThreadRegistry</code>.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Remove deprecated override of <code>Enumerable#sum</code>.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Deprecated initializing a <code>ActiveSupport::Cache::MemCacheStore</code> with an instance of <code>Dalli::Client</code>.</p>
<p>Deprecate the undocumented option of providing an already-initialized instance of <code>Dalli::Client</code> to <code>ActiveSupport::Cache::MemCacheStore</code>. Such clients could be configured with unrecognized options, which could lead to unexpected behavior. Instead, provide addresses as documented.</p>
<p><em>aledustet</em></p>
</li>
<li>
<p>Stub <code>Time.new()</code> in <code>TimeHelpers#travel_to</code></p>
<div data-snippet-clipboard-copy-content="travel_to Time.new(2004, 11, 24) do
  # Inside the `travel_to` block `Time.new` is stubbed
  assert_equal 2004, Time.new.year
end"><pre><span>travel_to</span> <span>Time</span><span>.</span><span>new</span><span>(</span><span>2004</span><span>,</span> <span>11</span><span>,</span> <span>24</span><span>)</span> <span>do</span>
  <span># Inside the `travel_to` block `Time.new` is stubbed</span>
  <span>assert_equal</span> <span>2004</span><span>,</span> <span>Time</span><span>.</span><span>new</span><span>.</span><span>year</span>
<span>end</span></pre></div>
<p><em>fatkodima</em></p>
</li>
<li>
<p>Raise <code>ActiveSupport::MessageEncryptor::InvalidMessage</code> from<br>
<code>ActiveSupport::MessageEncryptor#decrypt_and_verify</code> regardless of cipher.<br>
Previously, when a <code>MessageEncryptor</code> was using a non-AEAD cipher such as<br>
AES-256-CBC, a corrupt or tampered message would raise<br>
<code>ActiveSupport::MessageVerifier::InvalidSignature</code>.  Now, all ciphers raise<br>
the same error:</p>
<div data-snippet-clipboard-copy-content="encryptor = ActiveSupport::MessageEncryptor.new(&quot;x&quot; * 32, cipher: &quot;aes-256-gcm&quot;)
message = encryptor.encrypt_and_sign(&quot;message&quot;)
encryptor.decrypt_and_verify(message.next)
# => raises ActiveSupport::MessageEncryptor::InvalidMessage

encryptor = ActiveSupport::MessageEncryptor.new(&quot;x&quot; * 32, cipher: &quot;aes-256-cbc&quot;)
message = encryptor.encrypt_and_sign(&quot;message&quot;)
encryptor.decrypt_and_verify(message.next)
# BEFORE:
# => raises ActiveSupport::MessageVerifier::InvalidSignature
# AFTER:
# => raises ActiveSupport::MessageEncryptor::InvalidMessage"><pre><span>encryptor</span> <span>=</span> <span>ActiveSupport</span>::<span>MessageEncryptor</span><span>.</span><span>new</span><span>(</span><span>"x"</span> * <span>32</span><span>,</span> <span>cipher</span>: <span>"aes-256-gcm"</span><span>)</span>
<span>message</span> <span>=</span> <span>encryptor</span><span>.</span><span>encrypt_and_sign</span><span>(</span><span>"message"</span><span>)</span>
<span>encryptor</span><span>.</span><span>decrypt_and_verify</span><span>(</span><span>message</span><span>.</span><span>next</span><span>)</span>
<span># =&gt; raises ActiveSupport::MessageEncryptor::InvalidMessage</span>

<span>encryptor</span> <span>=</span> <span>ActiveSupport</span>::<span>MessageEncryptor</span><span>.</span><span>new</span><span>(</span><span>"x"</span> * <span>32</span><span>,</span> <span>cipher</span>: <span>"aes-256-cbc"</span><span>)</span>
<span>message</span> <span>=</span> <span>encryptor</span><span>.</span><span>encrypt_and_sign</span><span>(</span><span>"message"</span><span>)</span>
<span>encryptor</span><span>.</span><span>decrypt_and_verify</span><span>(</span><span>message</span><span>.</span><span>next</span><span>)</span>
<span># BEFORE:</span>
<span># =&gt; raises ActiveSupport::MessageVerifier::InvalidSignature</span>
<span># AFTER:</span>
<span># =&gt; raises ActiveSupport::MessageEncryptor::InvalidMessage</span></pre></div>
<p><em>Jonathan Hefner</em></p>
</li>
<li>
<p>Support <code>nil</code> original values when using <code>ActiveSupport::MessageVerifier#verify</code>.<br>
Previously, <code>MessageVerifier#verify</code> did not work with <code>nil</code> original<br>
values, though both <code>MessageVerifier#verified</code> and<br>
<code>MessageEncryptor#decrypt_and_verify</code> do:</p>
<div data-snippet-clipboard-copy-content="encryptor = ActiveSupport::MessageEncryptor.new(secret)
message = encryptor.encrypt_and_sign(nil)

encryptor.decrypt_and_verify(message)
# => nil

verifier = ActiveSupport::MessageVerifier.new(secret)
message = verifier.generate(nil)

verifier.verified(message)
# => nil

verifier.verify(message)
# BEFORE:
# => raises ActiveSupport::MessageVerifier::InvalidSignature
# AFTER:
# => nil"><pre><span>encryptor</span> <span>=</span> <span>ActiveSupport</span>::<span>MessageEncryptor</span><span>.</span><span>new</span><span>(</span><span>secret</span><span>)</span>
<span>message</span> <span>=</span> <span>encryptor</span><span>.</span><span>encrypt_and_sign</span><span>(</span><span>nil</span><span>)</span>

<span>encryptor</span><span>.</span><span>decrypt_and_verify</span><span>(</span><span>message</span><span>)</span>
<span># =&gt; nil</span>

<span>verifier</span> <span>=</span> <span>ActiveSupport</span>::<span>MessageVerifier</span><span>.</span><span>new</span><span>(</span><span>secret</span><span>)</span>
<span>message</span> <span>=</span> <span>verifier</span><span>.</span><span>generate</span><span>(</span><span>nil</span><span>)</span>

<span>verifier</span><span>.</span><span>verified</span><span>(</span><span>message</span><span>)</span>
<span># =&gt; nil</span>

<span>verifier</span><span>.</span><span>verify</span><span>(</span><span>message</span><span>)</span>
<span># BEFORE:</span>
<span># =&gt; raises ActiveSupport::MessageVerifier::InvalidSignature</span>
<span># AFTER:</span>
<span># =&gt; nil</span></pre></div>
<p><em>Jonathan Hefner</em></p>
</li>
<li>
<p>Maintain <code>html_safe?</code> on html_safe strings when sliced with <code>slice</code>, <code>slice!</code>, or <code>chr</code> method.</p>
<p>Previously, <code>html_safe?</code> was only maintained when the html_safe strings were sliced<br>
with <code>[]</code> method. Now, <code>slice</code>, <code>slice!</code>, and <code>chr</code> methods will maintain <code>html_safe?</code> like <code>[]</code> method.</p>
<div data-snippet-clipboard-copy-content="string = &quot;<div>test</div>&quot;.html_safe
string.slice(0, 1).html_safe? # => true
string.slice!(0, 1).html_safe? # => true
# maintain html_safe? after the slice!
string.html_safe? # => true
string.chr.html_safe? # => true"><pre><span>string</span> <span>=</span> <span>"&lt;div&gt;test&lt;/div&gt;"</span><span>.</span><span>html_safe</span>
<span>string</span><span>.</span><span>slice</span><span>(</span><span>0</span><span>,</span> <span>1</span><span>)</span><span>.</span><span>html_safe?</span> <span># =&gt; true</span>
<span>string</span><span>.</span><span>slice!</span><span>(</span><span>0</span><span>,</span> <span>1</span><span>)</span><span>.</span><span>html_safe?</span> <span># =&gt; true</span>
<span># maintain html_safe? after the slice!</span>
<span>string</span><span>.</span><span>html_safe?</span> <span># =&gt; true</span>
<span>string</span><span>.</span><span>chr</span><span>.</span><span>html_safe?</span> <span># =&gt; true</span></pre></div>
<p><em>Michael Go</em></p>
</li>
<li>
<p>Add <code>Object#in?</code> support for open ranges.</p>
<div data-snippet-clipboard-copy-content="assert Date.today.in?(..Date.tomorrow)
assert_not Date.today.in?(Date.tomorrow..)"><pre><span>assert</span> <span>Date</span><span>.</span><span>today</span><span>.</span><span>in?</span><span>(</span>..<span>Date</span><span>.</span><span>tomorrow</span><span>)</span>
<span>assert_not</span> <span>Date</span><span>.</span><span>today</span><span>.</span><span>in?</span><span>(</span><span>Date</span><span>.</span><span>tomorrow</span>..<span>)</span></pre></div>
<p><em>Ignacio Galindo</em></p>
</li>
<li>
<p><code>config.i18n.raise_on_missing_translations = true</code> now raises on any missing translation.</p>
<p>Previously it would only raise when called in a view or controller. Now it will raise<br>
anytime <code>I18n.t</code> is provided an unrecognised key.</p>
<p>If you do not want this behaviour, you can customise the i18n exception handler. See the<br>
upgrading guide or i18n guide for more information.</p>
<p><em>Alex Ghiculescu</em></p>
</li>
<li>
<p><code>ActiveSupport::CurrentAttributes</code> now raises if a restricted attribute name is used.</p>
<p>Attributes such as <code>set</code> and <code>reset</code> cannot be used as they clash with the<br>
<code>CurrentAttributes</code> public API.</p>
<p><em>Alex Ghiculescu</em></p>
</li>
<li>
<p><code>HashWithIndifferentAccess#transform_keys</code> now takes a Hash argument, just<br>
as Ruby's <code>Hash#transform_keys</code> does.</p>
<p><em>Akira Matsuda</em></p>
</li>
<li>
<p><code>delegate</code> now defines method with proper arity when delegating to a Class.<br>
With this change, it defines faster method (3.5x faster with no argument).<br>
However, in order to gain this benefit, the delegation target method has to<br>
be defined before declaring the delegation.</p>
<div data-snippet-clipboard-copy-content="# This defines 3.5 times faster method than before
class C
  def self.x() end
  delegate :x, to: :class
end

class C
  # This works but silently falls back to old behavior because
  # `delegate` cannot find the definition of `x`
  delegate :x, to: :class
  def self.x() end
end"><pre><span># This defines 3.5 times faster method than before</span>
<span>class</span> <span>C</span>
  <span>def</span> <span>self</span><span>.</span><span>x</span><span>(</span><span>)</span> <span>end</span>
  <span>delegate</span> <span>:x</span><span>,</span> <span>to</span>: <span>:class</span>
<span>end</span>

<span>class</span> <span>C</span>
  <span># This works but silently falls back to old behavior because</span>
  <span># `delegate` cannot find the definition of `x`</span>
  <span>delegate</span> <span>:x</span><span>,</span> <span>to</span>: <span>:class</span>
  <span>def</span> <span>self</span><span>.</span><span>x</span><span>(</span><span>)</span> <span>end</span>
<span>end</span></pre></div>
<p><em>Akira Matsuda</em></p>
</li>
<li>
<p><code>assert_difference</code> message now includes what changed.</p>
<p>This makes it easier to debug non-obvious failures.</p>
<p>Before:</p>
<div data-snippet-clipboard-copy-content="&quot;User.count&quot; didn't change by 32.
Expected: 1611
  Actual: 1579"><pre><code>"User.count" didn't change by 32.
Expected: 1611
  Actual: 1579
</code></pre></div>
<p>After:</p>
<div data-snippet-clipboard-copy-content="&quot;User.count&quot; didn't change by 32, but by 0.
Expected: 1611
  Actual: 1579"><pre><code>"User.count" didn't change by 32, but by 0.
Expected: 1611
  Actual: 1579
</code></pre></div>
<p><em>Alex Ghiculescu</em></p>
</li>
<li>
<p>Add ability to match exception messages to <code>assert_raises</code> assertion</p>
<p>Instead of this</p>
<div data-snippet-clipboard-copy-content="error = assert_raises(ArgumentError) do
  perform_service(param: 'exception')
end
assert_match(/incorrect param/i, error.message)"><pre><span>error</span> <span>=</span> <span>assert_raises</span><span>(</span><span>ArgumentError</span><span>)</span> <span>do</span>
  <span>perform_service</span><span>(</span><span>param</span>: <span>'exception'</span><span>)</span>
<span>end</span>
<span>assert_match</span><span>(</span><span>/incorrect param/i</span><span>,</span> <span>error</span><span>.</span><span>message</span><span>)</span></pre></div>
<p>you can now write this</p>
<div data-snippet-clipboard-copy-content="assert_raises(ArgumentError, match: /incorrect param/i) do
  perform_service(param: 'exception')
end"><pre><span>assert_raises</span><span>(</span><span>ArgumentError</span><span>,</span> <span>match</span>: <span>/incorrect param/i</span><span>)</span> <span>do</span>
  <span>perform_service</span><span>(</span><span>param</span>: <span>'exception'</span><span>)</span>
<span>end</span></pre></div>
<p><em>fatkodima</em></p>
</li>
<li>
<p>Add <code>Rails.env.local?</code> shorthand for <code>Rails.env.development? || Rails.env.test?</code>.</p>
<p><em>DHH</em></p>
</li>
<li>
<p><code>ActiveSupport::Testing::TimeHelpers</code> now accepts named <code>with_usec</code> argument<br>
to <code>freeze_time</code>, <code>travel</code>, and <code>travel_to</code> methods. Passing true prevents<br>
truncating the destination time with <code>change(usec: 0)</code>.</p>
<p><em>KevSlashNull</em>, and <em>serprex</em></p>
</li>
<li>
<p><code>ActiveSupport::CurrentAttributes.resets</code> now accepts a method name</p>
<p>The block API is still the recommended approach, but now both APIs are supported:</p>
<div data-snippet-clipboard-copy-content="class Current < ActiveSupport::CurrentAttributes
  resets { Time.zone = nil }
  resets :clear_time_zone
end"><pre><span>class</span> <span>Current</span> &lt; <span>ActiveSupport</span>::<span>CurrentAttributes</span>
  <span>resets</span> <span>{</span> <span>Time</span><span>.</span><span>zone</span> <span>=</span> <span>nil</span> <span>}</span>
  <span>resets</span> <span>:clear_time_zone</span>
<span>end</span></pre></div>
<p><em>Alex Ghiculescu</em></p>
</li>
<li>
<p>Ensure <code>ActiveSupport::Testing::Isolation::Forking</code> closes pipes</p>
<p>Previously, <code>Forking.run_in_isolation</code> opened two ends of a pipe. The fork<br>
process closed the read end, wrote to it, and then terminated (which<br>
presumably closed the file descriptors on its end). The parent process<br>
closed the write end, read from it, and returned, never closing the read<br>
end.</p>
<p>This resulted in an accumulation of open file descriptors, which could<br>
cause errors if the limit is reached.</p>
<p><em>Sam Bostock</em></p>
</li>
<li>
<p>Fix <code>Time#change</code> and <code>Time#advance</code> for times around the end of Daylight<br>
Saving Time.</p>
<p>Previously, when <code>Time#change</code> or <code>Time#advance</code> constructed a time inside<br>
the final stretch of Daylight Saving Time (DST), the non-DST offset would<br>
always be chosen for local times:</p>
<div data-snippet-clipboard-copy-content="# DST ended just before 2021-11-07 2:00:00 AM in US/Eastern.
ENV[&quot;TZ&quot;] = &quot;US/Eastern&quot;

time = Time.local(2021, 11, 07, 00, 59, 59) + 1
# => 2021-11-07 01:00:00 -0400
time.change(day: 07)
# => 2021-11-07 01:00:00 -0500
time.advance(seconds: 0)
# => 2021-11-07 01:00:00 -0500

time = Time.local(2021, 11, 06, 01, 00, 00)
# => 2021-11-06 01:00:00 -0400
time.change(day: 07)
# => 2021-11-07 01:00:00 -0500
time.advance(days: 1)
# => 2021-11-07 01:00:00 -0500"><pre><span># DST ended just before 2021-11-07 2:00:00 AM in US/Eastern.</span>
<span>ENV</span><span>[</span><span>"TZ"</span><span>]</span> <span>=</span> <span>"US/Eastern"</span>

<span>time</span> <span>=</span> <span>Time</span><span>.</span><span>local</span><span>(</span><span>2021</span><span>,</span> <span>11</span><span>,</span> <span>07</span><span>,</span> <span>00</span><span>,</span> <span>59</span><span>,</span> <span>59</span><span>)</span> + <span>1</span>
<span># =&gt; 2021-11-07 01:00:00 -0400</span>
<span>time</span><span>.</span><span>change</span><span>(</span><span>day</span>: <span>07</span><span>)</span>
<span># =&gt; 2021-11-07 01:00:00 -0500</span>
<span>time</span><span>.</span><span>advance</span><span>(</span><span>seconds</span>: <span>0</span><span>)</span>
<span># =&gt; 2021-11-07 01:00:00 -0500</span>

<span>time</span> <span>=</span> <span>Time</span><span>.</span><span>local</span><span>(</span><span>2021</span><span>,</span> <span>11</span><span>,</span> <span>06</span><span>,</span> <span>01</span><span>,</span> <span>00</span><span>,</span> <span>00</span><span>)</span>
<span># =&gt; 2021-11-06 01:00:00 -0400</span>
<span>time</span><span>.</span><span>change</span><span>(</span><span>day</span>: <span>07</span><span>)</span>
<span># =&gt; 2021-11-07 01:00:00 -0500</span>
<span>time</span><span>.</span><span>advance</span><span>(</span><span>days</span>: <span>1</span><span>)</span>
<span># =&gt; 2021-11-07 01:00:00 -0500</span></pre></div>
<p>And the DST offset would always be chosen for times with a <code>TimeZone</code><br>
object:</p>
<div data-snippet-clipboard-copy-content="Time.zone = &quot;US/Eastern&quot;

time = Time.new(2021, 11, 07, 02, 00, 00, Time.zone) - 3600
# => 2021-11-07 01:00:00 -0500
time.change(day: 07)
# => 2021-11-07 01:00:00 -0400
time.advance(seconds: 0)
# => 2021-11-07 01:00:00 -0400

time = Time.new(2021, 11, 8, 01, 00, 00, Time.zone)
# => 2021-11-08 01:00:00 -0500
time.change(day: 07)
# => 2021-11-07 01:00:00 -0400
time.advance(days: -1)
# => 2021-11-07 01:00:00 -0400"><pre><span>Time</span><span>.</span><span>zone</span> <span>=</span> <span>"US/Eastern"</span>

<span>time</span> <span>=</span> <span>Time</span><span>.</span><span>new</span><span>(</span><span>2021</span><span>,</span> <span>11</span><span>,</span> <span>07</span><span>,</span> <span>02</span><span>,</span> <span>00</span><span>,</span> <span>00</span><span>,</span> <span>Time</span><span>.</span><span>zone</span><span>)</span> - <span>3600</span>
<span># =&gt; 2021-11-07 01:00:00 -0500</span>
<span>time</span><span>.</span><span>change</span><span>(</span><span>day</span>: <span>07</span><span>)</span>
<span># =&gt; 2021-11-07 01:00:00 -0400</span>
<span>time</span><span>.</span><span>advance</span><span>(</span><span>seconds</span>: <span>0</span><span>)</span>
<span># =&gt; 2021-11-07 01:00:00 -0400</span>

<span>time</span> <span>=</span> <span>Time</span><span>.</span><span>new</span><span>(</span><span>2021</span><span>,</span> <span>11</span><span>,</span> <span>8</span><span>,</span> <span>01</span><span>,</span> <span>00</span><span>,</span> <span>00</span><span>,</span> <span>Time</span><span>.</span><span>zone</span><span>)</span>
<span># =&gt; 2021-11-08 01:00:00 -0500</span>
<span>time</span><span>.</span><span>change</span><span>(</span><span>day</span>: <span>07</span><span>)</span>
<span># =&gt; 2021-11-07 01:00:00 -0400</span>
<span>time</span><span>.</span><span>advance</span><span>(</span><span>days</span>: -<span>1</span><span>)</span>
<span># =&gt; 2021-11-07 01:00:00 -0400</span></pre></div>
<p>Now, <code>Time#change</code> and <code>Time#advance</code> will choose the offset that matches<br>
the original time's offset when possible:</p>
<div data-snippet-clipboard-copy-content="ENV[&quot;TZ&quot;] = &quot;US/Eastern&quot;

time = Time.local(2021, 11, 07, 00, 59, 59) + 1
# => 2021-11-07 01:00:00 -0400
time.change(day: 07)
# => 2021-11-07 01:00:00 -0400
time.advance(seconds: 0)
# => 2021-11-07 01:00:00 -0400

time = Time.local(2021, 11, 06, 01, 00, 00)
# => 2021-11-06 01:00:00 -0400
time.change(day: 07)
# => 2021-11-07 01:00:00 -0400
time.advance(days: 1)
# => 2021-11-07 01:00:00 -0400

Time.zone = &quot;US/Eastern&quot;

time = Time.new(2021, 11, 07, 02, 00, 00, Time.zone) - 3600
# => 2021-11-07 01:00:00 -0500
time.change(day: 07)
# => 2021-11-07 01:00:00 -0500
time.advance(seconds: 0)
# => 2021-11-07 01:00:00 -0500

time = Time.new(2021, 11, 8, 01, 00, 00, Time.zone)
# => 2021-11-08 01:00:00 -0500
time.change(day: 07)
# => 2021-11-07 01:00:00 -0500
time.advance(days: -1)
# => 2021-11-07 01:00:00 -0500"><pre><span>ENV</span><span>[</span><span>"TZ"</span><span>]</span> <span>=</span> <span>"US/Eastern"</span>

<span>time</span> <span>=</span> <span>Time</span><span>.</span><span>local</span><span>(</span><span>2021</span><span>,</span> <span>11</span><span>,</span> <span>07</span><span>,</span> <span>00</span><span>,</span> <span>59</span><span>,</span> <span>59</span><span>)</span> + <span>1</span>
<span># =&gt; 2021-11-07 01:00:00 -0400</span>
<span>time</span><span>.</span><span>change</span><span>(</span><span>day</span>: <span>07</span><span>)</span>
<span># =&gt; 2021-11-07 01:00:00 -0400</span>
<span>time</span><span>.</span><span>advance</span><span>(</span><span>seconds</span>: <span>0</span><span>)</span>
<span># =&gt; 2021-11-07 01:00:00 -0400</span>

<span>time</span> <span>=</span> <span>Time</span><span>.</span><span>local</span><span>(</span><span>2021</span><span>,</span> <span>11</span><span>,</span> <span>06</span><span>,</span> <span>01</span><span>,</span> <span>00</span><span>,</span> <span>00</span><span>)</span>
<span># =&gt; 2021-11-06 01:00:00 -0400</span>
<span>time</span><span>.</span><span>change</span><span>(</span><span>day</span>: <span>07</span><span>)</span>
<span># =&gt; 2021-11-07 01:00:00 -0400</span>
<span>time</span><span>.</span><span>advance</span><span>(</span><span>days</span>: <span>1</span><span>)</span>
<span># =&gt; 2021-11-07 01:00:00 -0400</span>

<span>Time</span><span>.</span><span>zone</span> <span>=</span> <span>"US/Eastern"</span>

<span>time</span> <span>=</span> <span>Time</span><span>.</span><span>new</span><span>(</span><span>2021</span><span>,</span> <span>11</span><span>,</span> <span>07</span><span>,</span> <span>02</span><span>,</span> <span>00</span><span>,</span> <span>00</span><span>,</span> <span>Time</span><span>.</span><span>zone</span><span>)</span> - <span>3600</span>
<span># =&gt; 2021-11-07 01:00:00 -0500</span>
<span>time</span><span>.</span><span>change</span><span>(</span><span>day</span>: <span>07</span><span>)</span>
<span># =&gt; 2021-11-07 01:00:00 -0500</span>
<span>time</span><span>.</span><span>advance</span><span>(</span><span>seconds</span>: <span>0</span><span>)</span>
<span># =&gt; 2021-11-07 01:00:00 -0500</span>

<span>time</span> <span>=</span> <span>Time</span><span>.</span><span>new</span><span>(</span><span>2021</span><span>,</span> <span>11</span><span>,</span> <span>8</span><span>,</span> <span>01</span><span>,</span> <span>00</span><span>,</span> <span>00</span><span>,</span> <span>Time</span><span>.</span><span>zone</span><span>)</span>
<span># =&gt; 2021-11-08 01:00:00 -0500</span>
<span>time</span><span>.</span><span>change</span><span>(</span><span>day</span>: <span>07</span><span>)</span>
<span># =&gt; 2021-11-07 01:00:00 -0500</span>
<span>time</span><span>.</span><span>advance</span><span>(</span><span>days</span>: -<span>1</span><span>)</span>
<span># =&gt; 2021-11-07 01:00:00 -0500</span></pre></div>
<p><em>Kevin Hall</em>, <em>Takayoshi Nishida</em>, and <em>Jonathan Hefner</em></p>
</li>
<li>
<p>Fix MemoryStore to preserve entries TTL when incrementing or decrementing</p>
<p>This is to be more consistent with how MemCachedStore and RedisCacheStore behaves.</p>
<p><em>Jean Boussier</em></p>
</li>
<li>
<p><code>Rails.error.handle</code> and <code>Rails.error.record</code> filter now by multiple error classes.</p>
<div data-snippet-clipboard-copy-content="Rails.error.handle(IOError, ArgumentError) do
  1 + '1' # raises TypeError
end
1 + 1 # TypeErrors are not IOErrors or ArgumentError, so this will *not* be handled"><pre><span>Rails</span><span>.</span><span>error</span><span>.</span><span>handle</span><span>(</span><span>IOError</span><span>,</span> <span>ArgumentError</span><span>)</span> <span>do</span>
  <span>1</span> + <span>'1'</span> <span># raises TypeError</span>
<span>end</span>
<span>1</span> + <span>1</span> <span># TypeErrors are not IOErrors or ArgumentError, so this will *not* be handled</span></pre></div>
<p><em>Martin Spickermann</em></p>
</li>
<li>
<p><code>Class#subclasses</code> and <code>Class#descendants</code> now automatically filter reloaded classes.</p>
<p>Previously they could return old implementations of reloadable classes that have been<br>
dereferenced but not yet garbage collected.</p>
<p>They now automatically filter such classes like <code>DescendantTracker#subclasses</code> and<br>
<code>DescendantTracker#descendants</code>.</p>
<p><em>Jean Boussier</em></p>
</li>
<li>
<p><code>Rails.error.report</code> now marks errors as reported to avoid reporting them twice.</p>
<p>In some cases, users might want to report errors explicitly with some extra context<br>
before letting it bubble up.</p>
<p>This also allows to safely catch and report errors outside of the execution context.</p>
<p><em>Jean Boussier</em></p>
</li>
<li>
<p>Add <code>assert_error_reported</code> and <code>assert_no_error_reported</code></p>
<p>Allows to easily asserts an error happened but was handled</p>
<div data-snippet-clipboard-copy-content="report = assert_error_reported(IOError) do
  # ...
end
assert_equal &quot;Oops&quot;, report.error.message
assert_equal &quot;admin&quot;, report.context[:section]
assert_equal :warning, report.severity
assert_predicate report, :handled?"><pre><span>report</span> <span>=</span> <span>assert_error_reported</span><span>(</span><span>IOError</span><span>)</span> <span>do</span>
  <span># ...</span>
<span>end</span>
<span>assert_equal</span> <span>"Oops"</span><span>,</span> <span>report</span><span>.</span><span>error</span><span>.</span><span>message</span>
<span>assert_equal</span> <span>"admin"</span><span>,</span> <span>report</span><span>.</span><span>context</span><span>[</span><span>:section</span><span>]</span>
<span>assert_equal</span> <span>:warning</span><span>,</span> <span>report</span><span>.</span><span>severity</span>
<span>assert_predicate</span> <span>report</span><span>,</span> <span>:handled?</span></pre></div>
<p><em>Jean Boussier</em></p>
</li>
<li>
<p><code>ActiveSupport::Deprecation</code> behavior callbacks can now receive the<br>
deprecator instance as an argument.  This makes it easier for such callbacks<br>
to change their behavior based on the deprecator's state.  For example,<br>
based on the deprecator's <code>debug</code> flag.</p>
<p>3-arity and splat-args callbacks such as the following will now be passed<br>
the deprecator instance as their third argument:</p>
<ul>
<li><code>-&gt;(message, callstack, deprecator) { ... }</code></li>
<li><code>-&gt;(*args) { ... }</code></li>
<li><code>-&gt;(message, *other_args) { ... }</code></li>
</ul>
<p>2-arity and 4-arity callbacks such as the following will continue to behave<br>
the same as before:</p>
<ul>
<li><code>-&gt;(message, callstack) { ... }</code></li>
<li><code>-&gt;(message, callstack, deprecation_horizon, gem_name) { ... }</code></li>
<li><code>-&gt;(message, callstack, *deprecation_details) { ... }</code></li>
</ul>
<p><em>Jonathan Hefner</em></p>
</li>
<li>
<p><code>ActiveSupport::Deprecation#disallowed_warnings</code> now affects the instance on<br>
which it is configured.</p>
<p>This means that individual <code>ActiveSupport::Deprecation</code> instances can be<br>
configured with their own disallowed warnings, and the global<br>
<code>ActiveSupport::Deprecation.disallowed_warnings</code> now only affects the global<br>
<code>ActiveSupport::Deprecation.warn</code>.</p>
<p><strong>Before</strong></p>
<div data-snippet-clipboard-copy-content="ActiveSupport::Deprecation.disallowed_warnings = [&quot;foo&quot;]
deprecator = ActiveSupport::Deprecation.new(&quot;2.0&quot;, &quot;MyCoolGem&quot;)
deprecator.disallowed_warnings = [&quot;bar&quot;]

ActiveSupport::Deprecation.warn(&quot;foo&quot;) # => raise ActiveSupport::DeprecationException
ActiveSupport::Deprecation.warn(&quot;bar&quot;) # => print &quot;DEPRECATION WARNING: bar&quot;
deprecator.warn(&quot;foo&quot;)                 # => raise ActiveSupport::DeprecationException
deprecator.warn(&quot;bar&quot;)                 # => print &quot;DEPRECATION WARNING: bar&quot;"><pre><span>ActiveSupport</span>::<span>Deprecation</span><span>.</span><span>disallowed_warnings</span> <span>=</span> <span>[</span><span>"foo"</span><span>]</span>
<span>deprecator</span> <span>=</span> <span>ActiveSupport</span>::<span>Deprecation</span><span>.</span><span>new</span><span>(</span><span>"2.0"</span><span>,</span> <span>"MyCoolGem"</span><span>)</span>
<span>deprecator</span><span>.</span><span>disallowed_warnings</span> <span>=</span> <span>[</span><span>"bar"</span><span>]</span>

<span>ActiveSupport</span>::<span>Deprecation</span><span>.</span><span>warn</span><span>(</span><span>"foo"</span><span>)</span> <span># =&gt; raise ActiveSupport::DeprecationException</span>
<span>ActiveSupport</span>::<span>Deprecation</span><span>.</span><span>warn</span><span>(</span><span>"bar"</span><span>)</span> <span># =&gt; print "DEPRECATION WARNING: bar"</span>
<span>deprecator</span><span>.</span><span>warn</span><span>(</span><span>"foo"</span><span>)</span>                 <span># =&gt; raise ActiveSupport::DeprecationException</span>
<span>deprecator</span><span>.</span><span>warn</span><span>(</span><span>"bar"</span><span>)</span>                 <span># =&gt; print "DEPRECATION WARNING: bar"</span></pre></div>
<p><strong>After</strong></p>
<div data-snippet-clipboard-copy-content="ActiveSupport::Deprecation.disallowed_warnings = [&quot;foo&quot;]
deprecator = ActiveSupport::Deprecation.new(&quot;2.0&quot;, &quot;MyCoolGem&quot;)
deprecator.disallowed_warnings = [&quot;bar&quot;]

ActiveSupport::Deprecation.warn(&quot;foo&quot;) # => raise ActiveSupport::DeprecationException
ActiveSupport::Deprecation.warn(&quot;bar&quot;) # => print &quot;DEPRECATION WARNING: bar&quot;
deprecator.warn(&quot;foo&quot;)                 # => print &quot;DEPRECATION WARNING: foo&quot;
deprecator.warn(&quot;bar&quot;)                 # => raise ActiveSupport::DeprecationException"><pre><span>ActiveSupport</span>::<span>Deprecation</span><span>.</span><span>disallowed_warnings</span> <span>=</span> <span>[</span><span>"foo"</span><span>]</span>
<span>deprecator</span> <span>=</span> <span>ActiveSupport</span>::<span>Deprecation</span><span>.</span><span>new</span><span>(</span><span>"2.0"</span><span>,</span> <span>"MyCoolGem"</span><span>)</span>
<span>deprecator</span><span>.</span><span>disallowed_warnings</span> <span>=</span> <span>[</span><span>"bar"</span><span>]</span>

<span>ActiveSupport</span>::<span>Deprecation</span><span>.</span><span>warn</span><span>(</span><span>"foo"</span><span>)</span> <span># =&gt; raise ActiveSupport::DeprecationException</span>
<span>ActiveSupport</span>::<span>Deprecation</span><span>.</span><span>warn</span><span>(</span><span>"bar"</span><span>)</span> <span># =&gt; print "DEPRECATION WARNING: bar"</span>
<span>deprecator</span><span>.</span><span>warn</span><span>(</span><span>"foo"</span><span>)</span>                 <span># =&gt; print "DEPRECATION WARNING: foo"</span>
<span>deprecator</span><span>.</span><span>warn</span><span>(</span><span>"bar"</span><span>)</span>                 <span># =&gt; raise ActiveSupport::DeprecationException</span></pre></div>
<p>Note that global <code>ActiveSupport::Deprecation</code> methods such as <code>ActiveSupport::Deprecation.warn</code><br>
and <code>ActiveSupport::Deprecation.disallowed_warnings</code> have been deprecated.</p>
<p><em>Jonathan Hefner</em></p>
</li>
<li>
<p>Add italic and underline support to <code>ActiveSupport::LogSubscriber#color</code></p>
<p>Previously, only bold text was supported via a positional argument.<br>
This allows for bold, italic, and underline options to be specified<br>
for colored logs.</p>
<div data-snippet-clipboard-copy-content="info color(&quot;Hello world!&quot;, :red, bold: true, underline: true)"><pre><span>info</span> <span>color</span><span>(</span><span>"Hello world!"</span><span>,</span> <span>:red</span><span>,</span> <span>bold</span>: <span>true</span><span>,</span> <span>underline</span>: <span>true</span><span>)</span></pre></div>
<p><em>Gannon McGibbon</em></p>
</li>
<li>
<p>Add <code>String#downcase_first</code> method.</p>
<p>This method is the corollary of <code>String#upcase_first</code>.</p>
<p><em>Mark Schneider</em></p>
</li>
<li>
<p><code>thread_mattr_accessor</code> will call <code>.dup.freeze</code> on non-frozen default values.</p>
<p>This provides a basic level of protection against different threads trying<br>
to mutate a shared default object.</p>
<p><em>Jonathan Hefner</em></p>
</li>
<li>
<p>Add <code>raise_on_invalid_cache_expiration_time</code> config to <code>ActiveSupport::Cache::Store</code></p>
<p>Specifies if an <code>ArgumentError</code> should be raised if <code>Rails.cache</code> <code>fetch</code> or<br>
<code>write</code> are given an invalid <code>expires_at</code> or <code>expires_in</code> time.</p>
<p>Options are <code>true</code>, and <code>false</code>. If <code>false</code>, the exception will be reported<br>
as <code>handled</code> and logged instead. Defaults to <code>true</code> if <code>config.load_defaults &gt;= 7.1</code>.</p>
<p><em>Trevor Turk</em></p>
</li>
<li>
<p><code>ActiveSupport::Cache:Store#fetch</code> now passes an options accessor to the block.</p>
<p>It makes possible to override cache options:</p>
<div data-snippet-clipboard-copy-content="Rails.cache.fetch(&quot;3rd-party-token&quot;) do |name, options|
  token = fetch_token_from_remote
  # set cache's TTL to match token's TTL
  options.expires_in = token.expires_in
  token
end"><pre><code>Rails.cache.fetch("3rd-party-token") do |name, options|
  token = fetch_token_from_remote
  # set cache's TTL to match token's TTL
  options.expires_in = token.expires_in
  token
end
</code></pre></div>
<p><em>Andrii Gladkyi</em>, <em>Jean Boussier</em></p>
</li>
<li>
<p><code>default</code> option of <code>thread_mattr_accessor</code> now applies through inheritance and<br>
also across new threads.</p>
<p>Previously, the <code>default</code> value provided was set only at the moment of defining<br>
the attribute writer, which would cause the attribute to be uninitialized in<br>
descendants and in other threads.</p>
<p>Fixes <a data-error-text="Failed to load title" data-id="1008053433" data-permission-text="Title is private" data-url="https://github.com/rails/rails/issues/43312" data-hovercard-type="issue" data-hovercard-url="/rails/rails/issues/43312/hovercard" href="https://github.com/rails/rails/issues/43312">#43312</a>.</p>
<p><em>Thierry Deo</em></p>
</li>
<li>
<p>Redis cache store is now compatible with redis-rb 5.0.</p>
<p><em>Jean Boussier</em></p>
</li>
<li>
<p>Add <code>skip_nil:</code> support to <code>ActiveSupport::Cache::Store#fetch_multi</code>.</p>
<p><em>Daniel Alfaro</em></p>
</li>
<li>
<p>Add <code>quarter</code> method to date/time</p>
<p><em>Matt Swanson</em></p>
</li>
<li>
<p>Fix <code>NoMethodError</code> on custom <code>ActiveSupport::Deprecation</code> behavior.</p>
<p><code>ActiveSupport::Deprecation.behavior=</code> was supposed to accept any object<br>
that responds to <code>call</code>, but in fact its internal implementation assumed that<br>
this object could respond to <code>arity</code>, so it was restricted to only <code>Proc</code> objects.</p>
<p>This change removes this <code>arity</code> restriction of custom behaviors.</p>
<p><em>Ryo Nakamura</em></p>
</li>
<li>
<p>Support <code>:url_safe</code> option for <code>MessageEncryptor</code>.</p>
<p>The <code>MessageEncryptor</code> constructor now accepts a <code>:url_safe</code> option, similar<br>
to the <code>MessageVerifier</code> constructor.  When enabled, this option ensures<br>
that messages use a URL-safe encoding.</p>
<p><em>Jonathan Hefner</em></p>
</li>
<li>
<p>Add <code>url_safe</code> option to <code>ActiveSupport::MessageVerifier</code> initializer</p>
<p><code>ActiveSupport::MessageVerifier.new</code> now takes optional <code>url_safe</code> argument.<br>
It can generate URL-safe strings by passing <code>url_safe: true</code>.</p>
<div data-snippet-clipboard-copy-content="verifier = ActiveSupport::MessageVerifier.new(url_safe: true)
message = verifier.generate(data) # => URL-safe string"><pre><span>verifier</span> <span>=</span> <span>ActiveSupport</span>::<span>MessageVerifier</span><span>.</span><span>new</span><span>(</span><span>url_safe</span>: <span>true</span><span>)</span>
<span>message</span> <span>=</span> <span>verifier</span><span>.</span><span>generate</span><span>(</span><span>data</span><span>)</span> <span># =&gt; URL-safe string</span></pre></div>
<p>This option is <code>false</code> by default to be backwards compatible.</p>
<p><em>Shouichi Kamiya</em></p>
</li>
<li>
<p>Enable connection pooling by default for <code>MemCacheStore</code> and <code>RedisCacheStore</code>.</p>
<p>If you want to disable connection pooling, set <code>:pool</code> option to <code>false</code> when configuring the cache store:</p>
<div data-snippet-clipboard-copy-content="config.cache_store = :mem_cache_store, &quot;cache.example.com&quot;, pool: false"><pre><span>config</span><span>.</span><span>cache_store</span> <span>=</span> <span>:mem_cache_store</span><span>,</span> <span>"cache.example.com"</span><span>,</span> <span>pool</span>: <span>false</span></pre></div>
<p><em>fatkodima</em></p>
</li>
<li>
<p>Add <code>force:</code> support to <code>ActiveSupport::Cache::Store#fetch_multi</code>.</p>
<p><em>fatkodima</em></p>
</li>
<li>
<p>Deprecated <code>:pool_size</code> and <code>:pool_timeout</code> options for configuring connection pooling in cache stores.</p>
<p>Use <code>pool: true</code> to enable pooling with default settings:</p>
<div data-snippet-clipboard-copy-content="config.cache_store = :redis_cache_store, pool: true"><pre><span>config</span><span>.</span><span>cache_store</span> <span>=</span> <span>:redis_cache_store</span><span>,</span> <span>pool</span>: <span>true</span></pre></div>
<p>Or pass individual options via <code>:pool</code> option:</p>
<div data-snippet-clipboard-copy-content="config.cache_store = :redis_cache_store, pool: { size: 10, timeout: 2 }"><pre><span>config</span><span>.</span><span>cache_store</span> <span>=</span> <span>:redis_cache_store</span><span>,</span> <span>pool</span>: <span>{</span> <span>size</span>: <span>10</span><span>,</span> <span>timeout</span>: <span>2</span> <span>}</span></pre></div>
<p><em>fatkodima</em></p>
</li>
<li>
<p>Allow #increment and #decrement methods of <code>ActiveSupport::Cache::Store</code><br>
subclasses to set new values.</p>
<p>Previously incrementing or decrementing an unset key would fail and return<br>
nil. A default will now be assumed and the key will be created.</p>
<p><em>Andrej Blagojević</em>, <em>Eugene Kenny</em></p>
</li>
<li>
<p>Add <code>skip_nil:</code> support to <code>RedisCacheStore</code></p>
<p><em>Joey Paris</em></p>
</li>
<li>
<p><code>ActiveSupport::Cache::MemoryStore#write(name, val, unless_exist:true)</code> now<br>
correctly writes expired keys.</p>
<p><em>Alan Savage</em></p>
</li>
<li>
<p><code>ActiveSupport::ErrorReporter</code> now accepts and forward a <code>source:</code> parameter.</p>
<p>This allow libraries to signal the origin of the errors, and reporters<br>
to easily ignore some sources.</p>
<p><em>Jean Boussier</em></p>
</li>
<li>
<p>Fix and add protections for XSS in <code>ActionView::Helpers</code> and <code>ERB::Util</code>.</p>
<p>Add the method <code>ERB::Util.xml_name_escape</code> to escape dangerous characters<br>
in names of tags and names of attributes, following the specification of XML.</p>
<p><em>Álvaro Martín Fraguas</em></p>
</li>
<li>
<p>Respect <code>ActiveSupport::Logger.new</code>'s <code>:formatter</code> keyword argument</p>
<p>The stdlib <code>Logger::new</code> allows passing a <code>:formatter</code> keyword argument to<br>
set the logger's formatter. Previously <code>ActiveSupport::Logger.new</code> ignored<br>
that argument by always setting the formatter to an instance of<br>
<code>ActiveSupport::Logger::SimpleFormatter</code>.</p>
<p><em>Steven Harman</em></p>
</li>
<li>
<p>Deprecate preserving the pre-Ruby 2.4 behavior of <code>to_time</code></p>
<p>With Ruby 2.4+ the default for +to_time+ changed from converting to the<br>
local system time to preserving the offset of the receiver. At the time Rails<br>
supported older versions of Ruby so a compatibility layer was added to assist<br>
in the migration process. From Rails 5.0 new applications have defaulted to<br>
the Ruby 2.4+ behavior and since Rails 7.0 now only supports Ruby 2.7+<br>
this compatibility layer can be safely removed.</p>
<p>To minimize any noise generated the deprecation warning only appears when the<br>
setting is configured to <code>false</code> as that is the only scenario where the<br>
removal of the compatibility layer has any effect.</p>
<p><em>Andrew White</em></p>
</li>
<li>
<p><code>Pathname.blank?</code> only returns true for <code>Pathname.new("")</code></p>
<p>Previously it would end up calling <code>Pathname#empty?</code> which returned true<br>
if the path existed and was an empty directory or file.</p>
<p>That behavior was unlikely to be expected.</p>
<p><em>Jean Boussier</em></p>
</li>
<li>
<p>Deprecate <code>Notification::Event</code>'s <code>#children</code> and <code>#parent_of?</code></p>
<p><em>John Hawthorn</em></p>
</li>
<li>
<p>Change the default serializer of <code>ActiveSupport::MessageVerifier</code> from<br>
<code>Marshal</code> to <code>ActiveSupport::JSON</code> when using <code>config.load_defaults 7.1</code>.</p>
<p>Messages serialized with <code>Marshal</code> can still be read, but new messages will<br>
be serialized with <code>ActiveSupport::JSON</code>. For more information, see<br>
<a href="https://guides.rubyonrails.org/v7.1/configuring.html#config-active-support-message-serializer" rel="nofollow">https://guides.rubyonrails.org/v7.1/configuring.html#config-active-support-message-serializer</a>.</p>
<p><em>Saba Kiaei</em>, <em>David Buckley</em>, and <em>Jonathan Hefner</em></p>
</li>
<li>
<p>Change the default serializer of <code>ActiveSupport::MessageEncryptor</code> from<br>
<code>Marshal</code> to <code>ActiveSupport::JSON</code> when using <code>config.load_defaults 7.1</code>.</p>
<p>Messages serialized with <code>Marshal</code> can still be read, but new messages will<br>
be serialized with <code>ActiveSupport::JSON</code>. For more information, see<br>
<a href="https://guides.rubyonrails.org/v7.1/configuring.html#config-active-support-message-serializer" rel="nofollow">https://guides.rubyonrails.org/v7.1/configuring.html#config-active-support-message-serializer</a>.</p>
<p><em>Zack Deveau</em>, <em>Martin Gingras</em>, and <em>Jonathan Hefner</em></p>
</li>
<li>
<p>Add <code>ActiveSupport::TestCase#stub_const</code> to stub a constant for the duration of a yield.</p>
<p><em>DHH</em></p>
</li>
<li>
<p>Fix <code>ActiveSupport::EncryptedConfiguration</code> to be compatible with Psych 4</p>
<p><em>Stephen Sugden</em></p>
</li>
<li>
<p>Improve <code>File.atomic_write</code> error handling</p>
<p><em>Daniel Pepper</em></p>
</li>
<li>
<p>Fix <code>Class#descendants</code> and <code>DescendantsTracker#descendants</code> compatibility with Ruby 3.1.</p>
<p><a href="https://bugs.ruby-lang.org/issues/14394#note-33" rel="nofollow">The native <code>Class#descendants</code> was reverted prior to Ruby 3.1 release</a>,<br>
but <code>Class#subclasses</code> was kept, breaking the feature detection.</p>
<p><em>Jean Boussier</em></p>
</li>
</div><div>
<li>
<p>Remove -shm and -wal SQLite files when <code>rails db:drop</code> is run.</p>
<p><em>Niklas Häusele</em></p>
</li>
<li>
<p>Revert the change to raise an <code>ArgumentError</code> when <code>#accepts_nested_attributes_for</code> is declared more than once for<br>
an association in the same class.</p>
<p>The reverted behavior broke the case where the <code>#accepts_nested_attributes_for</code> was defined in a concern and<br>
where overridden in the class that included the concern.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Better naming for unique constraints support.</p>
<p>Naming unique keys leads to misunderstanding it's a short-hand of unique indexes.<br>
Just naming it unique constraints is not misleading.</p>
<p>In Rails 7.1.0.beta1 or before:</p>
<div data-snippet-clipboard-copy-content="add_unique_key :sections, [:position], deferrable: :deferred, name: &quot;unique_section_position&quot;
remove_unique_key :sections, name: &quot;unique_section_position&quot;"><pre><span>add_unique_key</span> <span>:sections</span><span>,</span> <span>[</span><span>:position</span><span>]</span><span>,</span> <span>deferrable</span>: <span>:deferred</span><span>,</span> <span>name</span>: <span>"unique_section_position"</span>
<span>remove_unique_key</span> <span>:sections</span><span>,</span> <span>name</span>: <span>"unique_section_position"</span></pre></div>
<p>Now:</p>
<div data-snippet-clipboard-copy-content="add_unique_constraint :sections, [:position], deferrable: :deferred, name: &quot;unique_section_position&quot;
remove_unique_constraint :sections, name: &quot;unique_section_position&quot;"><pre><span>add_unique_constraint</span> <span>:sections</span><span>,</span> <span>[</span><span>:position</span><span>]</span><span>,</span> <span>deferrable</span>: <span>:deferred</span><span>,</span> <span>name</span>: <span>"unique_section_position"</span>
<span>remove_unique_constraint</span> <span>:sections</span><span>,</span> <span>name</span>: <span>"unique_section_position"</span></pre></div>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fix duplicate quoting for check constraint expressions in schema dump when using MySQL</p>
<p>A check constraint with an expression, that already contains quotes, lead to an invalid schema<br>
dump with the mysql2 adapter.</p>
<p>Fixes <a data-error-text="Failed to load title" data-id="915248782" data-permission-text="Title is private" data-url="https://github.com/rails/rails/issues/42424" data-hovercard-type="issue" data-hovercard-url="/rails/rails/issues/42424/hovercard" href="https://github.com/rails/rails/issues/42424">#42424</a>.</p>
<p><em>Felix Tscheulin</em></p>
</li>
<li>
<p>Performance tune the SQLite3 adapter connection configuration</p>
<p>For Rails applications, the Write-Ahead-Log in normal syncing mode with a capped journal size, a healthy shared memory buffer and a shared cache will perform, on average, 2× better.</p>
<p><em>Stephen Margheim</em></p>
</li>
<li>
<p>Allow SQLite3 <code>busy_handler</code> to be configured with simple max number of <code>retries</code></p>
<p>Retrying busy connections without delay is a preferred practice for performance-sensitive applications. Add support for a <code>database.yml</code> <code>retries</code> integer, which is used in a simple <code>busy_handler</code> function to retry busy connections without exponential backoff up to the max number of <code>retries</code>.</p>
<p><em>Stephen Margheim</em></p>
</li>
<li>
<p>The SQLite3 adapter now supports <code>supports_insert_returning?</code></p>
<p>Implementing the full <code>supports_insert_returning?</code> contract means the SQLite3 adapter supports auto-populated columns (<a data-error-text="Failed to load title" data-id="1712735611" data-permission-text="Title is private" data-url="https://github.com/rails/rails/issues/48241" data-hovercard-type="pull_request" data-hovercard-url="/rails/rails/pull/48241/hovercard" href="https://github.com/rails/rails/pull/48241">#48241</a>) as well as custom primary keys.</p>
<p><em>Stephen Margheim</em></p>
</li>
<li>
<p>Ensure the SQLite3 adapter handles default functions with the <code>||</code> concatenation operator</p>
<p>Previously, this default function would produce the static string <code>"'Ruby ' || 'on ' || 'Rails'"</code>.<br>
Now, the adapter will appropriately receive and use <code>"Ruby on Rails"</code>.</p>
<div data-snippet-clipboard-copy-content="change_column_default &quot;test_models&quot;, &quot;ruby_on_rails&quot;, -> { &quot;('Ruby ' || 'on ' || 'Rails')&quot; }"><pre><span>change_column_default</span> <span>"test_models"</span><span>,</span> <span>"ruby_on_rails"</span><span>,</span> <span>-&gt;</span> <span>{</span> <span>"('Ruby ' || 'on ' || 'Rails')"</span> <span>}</span></pre></div>
<p><em>Stephen Margheim</em></p>
</li>
<li>
<p>Dump PostgreSQL schemas as part of the schema dump.</p>
<p><em>Lachlan Sylvester</em></p>
</li>
<li>
<p>Encryption now supports <code>support_unencrypted_data</code> being set per-attribute.</p>
<p>You can now opt out of <code>support_unencrypted_data</code> on a specific encrypted attribute.<br>
This only has an effect if <code>ActiveRecord::Encryption.config.support_unencrypted_data == true</code>.</p>
<div data-snippet-clipboard-copy-content="class User < ActiveRecord::Base
  encrypts :name, deterministic: true, support_unencrypted_data: false
  encrypts :email, deterministic: true
end"><pre><span>class</span> <span>User</span> &lt; <span>ActiveRecord</span>::<span>Base</span>
  <span>encrypts</span> <span>:name</span><span>,</span> <span>deterministic</span>: <span>true</span><span>,</span> <span>support_unencrypted_data</span>: <span>false</span>
  <span>encrypts</span> <span>:email</span><span>,</span> <span>deterministic</span>: <span>true</span>
<span>end</span></pre></div>
<p><em>Alex Ghiculescu</em></p>
</li>
<li>
<p>Add instrumentation for Active Record transactions</p>
<p>Allows subscribing to transaction events for tracking/instrumentation. The event payload contains the connection and the outcome (commit, rollback, restart, incomplete), as well as timing details.</p>
<div data-snippet-clipboard-copy-content="ActiveSupport::Notifications.subscribe(&quot;transaction.active_record&quot;) do |event|
  puts &quot;Transaction event occurred!&quot;
  connection = event.payload[:connection]
  puts &quot;Connection: #{connection.inspect}&quot;
end"><pre><span>ActiveSupport</span>::<span>Notifications</span><span>.</span><span>subscribe</span><span>(</span><span>"transaction.active_record"</span><span>)</span> <span>do</span> |<span>event</span>|
  <span>puts</span> <span>"Transaction event occurred!"</span>
  <span>connection</span> <span>=</span> <span>event</span><span>.</span><span>payload</span><span>[</span><span>:connection</span><span>]</span>
  <span>puts</span> <span>"Connection: <span><span>#{</span><span>connection</span><span>.</span><span>inspect</span><span>}</span></span>"</span>
<span>end</span></pre></div>
<p><em>Daniel Colson</em>, <em>Ian Candy</em></p>
</li>
<li>
<p>Support composite foreign keys via migration helpers.</p>
<div data-snippet-clipboard-copy-content="# Assuming &quot;carts&quot; table has &quot;(shop_id, user_id)&quot; as a primary key.

add_foreign_key(:orders, :carts, primary_key: [:shop_id, :user_id])

remove_foreign_key(:orders, :carts, primary_key: [:shop_id, :user_id])
foreign_key_exists?(:orders, :carts, primary_key: [:shop_id, :user_id])"><pre><span># Assuming "carts" table has "(shop_id, user_id)" as a primary key.</span>

<span>add_foreign_key</span><span>(</span><span>:orders</span><span>,</span> <span>:carts</span><span>,</span> <span>primary_key</span>: <span>[</span><span>:shop_id</span><span>,</span> <span>:user_id</span><span>]</span><span>)</span>

<span>remove_foreign_key</span><span>(</span><span>:orders</span><span>,</span> <span>:carts</span><span>,</span> <span>primary_key</span>: <span>[</span><span>:shop_id</span><span>,</span> <span>:user_id</span><span>]</span><span>)</span>
<span>foreign_key_exists?</span><span>(</span><span>:orders</span><span>,</span> <span>:carts</span><span>,</span> <span>primary_key</span>: <span>[</span><span>:shop_id</span><span>,</span> <span>:user_id</span><span>]</span><span>)</span></pre></div>
<p><em>fatkodima</em></p>
</li>
<li>
<p>Adds support for <code>if_not_exists</code> when adding a check constraint.</p>
<div data-snippet-clipboard-copy-content="add_check_constraint :posts, &quot;post_type IN ('blog', 'comment', 'share')&quot;, if_not_exists: true"><pre><span>add_check_constraint</span> <span>:posts</span><span>,</span> <span>"post_type IN ('blog', 'comment', 'share')"</span><span>,</span> <span>if_not_exists</span>: <span>true</span></pre></div>
<p><em>Cody Cutrer</em></p>
</li>
<li>
<p>Raise an <code>ArgumentError</code> when <code>#accepts_nested_attributes_for</code> is declared more than once for an association in<br>
the same class. Previously, the last declaration would silently override the previous one. Overriding in a subclass<br>
is still allowed.</p>
<p><em>Joshua Young</em></p>
</li>
<li>
<p>Deprecate <code>rewhere</code> argument on <code>#merge</code>.</p>
<p>The <code>rewhere</code> argument on <code>#merge</code>is deprecated without replacement and<br>
will be removed in Rails 7.2.</p>
<p><em>Adam Hess</em></p>
</li>
<li>
<p>Fix unscope is not working in specific case</p>
<p>Before:</p>
<div data-snippet-clipboard-copy-content="Post.where(id: 1...3).unscope(where: :id).to_sql # &quot;SELECT `posts`.* FROM `posts` WHERE `posts`.`id` >= 1 AND `posts`.`id` < 3&quot;
"><pre><span>Post</span><span>.</span><span>where</span><span>(</span><span>id</span>: <span>1</span>...<span>3</span><span>)</span><span>.</span><span>unscope</span><span>(</span><span>where</span>: <span>:id</span><span>)</span><span>.</span><span>to_sql</span> <span># "SELECT `posts`.* FROM `posts` WHERE `posts`.`id` &gt;= 1 AND `posts`.`id` &lt; 3"</span></pre></div>
<p>After:</p>
<div data-snippet-clipboard-copy-content="Post.where(id: 1...3).unscope(where: :id).to_sql # &quot;SELECT `posts`.* FROM `posts`&quot;"><pre><span>Post</span><span>.</span><span>where</span><span>(</span><span>id</span>: <span>1</span>...<span>3</span><span>)</span><span>.</span><span>unscope</span><span>(</span><span>where</span>: <span>:id</span><span>)</span><span>.</span><span>to_sql</span> <span># "SELECT `posts`.* FROM `posts`"</span></pre></div>
<p>Fixes <a data-error-text="Failed to load title" data-id="1689435061" data-permission-text="Title is private" data-url="https://github.com/rails/rails/issues/48094" data-hovercard-type="issue" data-hovercard-url="/rails/rails/issues/48094/hovercard" href="https://github.com/rails/rails/issues/48094">#48094</a>.</p>
<p><em>Kazuya Hatanaka</em></p>
</li>
<li>
<p>Change <code>has_secure_token</code> default to <code>on: :initialize</code></p>
<p>Change the new default value from <code>on: :create</code> to <code>on: :initialize</code></p>
<p>Can be controlled by the <code>config.active_record.generate_secure_token_on</code><br>
configuration:</p>
<div data-snippet-clipboard-copy-content="config.active_record.generate_secure_token_on = :create"><pre><span>config</span><span>.</span><span>active_record</span><span>.</span><span>generate_secure_token_on</span> <span>=</span> <span>:create</span></pre></div>
<p><em>Sean Doyle</em></p>
</li>
<li>
<p>Fix <code>change_column</code> not setting <code>precision: 6</code> on <code>datetime</code> columns when<br>
using 7.0+ Migrations and SQLite.</p>
<p><em>Hartley McGuire</em></p>
</li>
<li>
<p>Support composite identifiers in <code>to_key</code></p>
<p><code>to_key</code> avoids wrapping <code>#id</code> value into an <code>Array</code> if <code>#id</code> already an array</p>
<p><em>Nikita Vasilevsky</em></p>
</li>
<li>
<p>Add validation option for <code>enum</code></p>
<div data-snippet-clipboard-copy-content="class Contract < ApplicationRecord
  enum :status, %w[in_progress completed], validate: true
end
Contract.new(status: &quot;unknown&quot;).valid? # => false
Contract.new(status: nil).valid? # => false
Contract.new(status: &quot;completed&quot;).valid? # => true

class Contract < ApplicationRecord
  enum :status, %w[in_progress completed], validate: { allow_nil: true }
end
Contract.new(status: &quot;unknown&quot;).valid? # => false
Contract.new(status: nil).valid? # => true
Contract.new(status: &quot;completed&quot;).valid? # => true"><pre><span>class</span> <span>Contract</span> &lt; <span>ApplicationRecord</span>
  <span>enum</span> <span>:status</span><span>,</span> <span>%w[</span><span>in_progress</span> <span>completed</span><span>]</span><span>,</span> <span>validate</span>: <span>true</span>
<span>end</span>
<span>Contract</span><span>.</span><span>new</span><span>(</span><span>status</span>: <span>"unknown"</span><span>)</span><span>.</span><span>valid?</span> <span># =&gt; false</span>
<span>Contract</span><span>.</span><span>new</span><span>(</span><span>status</span>: <span>nil</span><span>)</span><span>.</span><span>valid?</span> <span># =&gt; false</span>
<span>Contract</span><span>.</span><span>new</span><span>(</span><span>status</span>: <span>"completed"</span><span>)</span><span>.</span><span>valid?</span> <span># =&gt; true</span>

<span>class</span> <span>Contract</span> &lt; <span>ApplicationRecord</span>
  <span>enum</span> <span>:status</span><span>,</span> <span>%w[</span><span>in_progress</span> <span>completed</span><span>]</span><span>,</span> <span>validate</span>: <span>{</span> <span>allow_nil</span>: <span>true</span> <span>}</span>
<span>end</span>
<span>Contract</span><span>.</span><span>new</span><span>(</span><span>status</span>: <span>"unknown"</span><span>)</span><span>.</span><span>valid?</span> <span># =&gt; false</span>
<span>Contract</span><span>.</span><span>new</span><span>(</span><span>status</span>: <span>nil</span><span>)</span><span>.</span><span>valid?</span> <span># =&gt; true</span>
<span>Contract</span><span>.</span><span>new</span><span>(</span><span>status</span>: <span>"completed"</span><span>)</span><span>.</span><span>valid?</span> <span># =&gt; true</span></pre></div>
<p><em>Edem Topuzov</em>, <em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Allow batching methods to use already loaded relation if available</p>
<p>Calling batch methods on already loaded relations will use the records previously loaded instead of retrieving<br>
them from the database again.</p>
<p><em>Adam Hess</em></p>
</li>
<li>
<p>Deprecate <code>read_attribute(:id)</code> returning the primary key if the primary key is not <code>:id</code>.</p>
<p>Starting in Rails 7.2, <code>read_attribute(:id)</code> will return the value of the id column, regardless of the model's<br>
primary key. To retrieve the value of the primary key, use <code>#id</code> instead. <code>read_attribute(:id)</code> for composite<br>
primary key models will now return the value of the id column.</p>
<p><em>Adrianna Chang</em></p>
</li>
<li>
<p>Fix <code>change_table</code> setting datetime precision for 6.1 Migrations</p>
<p><em>Hartley McGuire</em></p>
</li>
<li>
<p>Fix change_column setting datetime precision for 6.1 Migrations</p>
<p><em>Hartley McGuire</em></p>
</li>
<li>
<p>Add <code>ActiveRecord::Base#id_value</code> alias to access the raw value of a record's id column.</p>
<p>This alias is only provided for models that declare an <code>:id</code> column.</p>
<p><em>Adrianna Chang</em></p>
</li>
<li>
<p>Fix previous change tracking for <code>ActiveRecord::Store</code> when using a column with JSON structured database type</p>
<p>Before, the methods to access the changes made during the last save <code>#saved_change_to_key?</code>, <code>#saved_change_to_key</code>, and <code>#key_before_last_save</code> did not work if the store was defined as a <code>store_accessor</code> on a column with a JSON structured database type</p>
<p><em>Robert DiMartino</em></p>
</li>
<li>
<p>Fully support <code>NULLS [NOT] DISTINCT</code> for PostgreSQL 15+ indexes.</p>
<p>Previous work was done to allow the index to be created in a migration, but it was not<br>
supported in schema.rb. Additionally, the matching for <code>NULLS [NOT] DISTINCT</code> was not<br>
in the correct order, which could have resulted in inconsistent schema detection.</p>
<p><em>Gregory Jones</em></p>
</li>
<li>
<p>Allow escaping of literal colon characters in <code>sanitize_sql_*</code> methods when named bind variables are used</p>
<p><em>Justin Bull</em></p>
</li>
<li>
<p>Fix <code>#previously_new_record?</code> to return true for destroyed records.</p>
<p>Before, if a record was created and then destroyed, <code>#previously_new_record?</code> would return true.<br>
Now, any UPDATE or DELETE to a record is considered a change, and will result in <code>#previously_new_record?</code><br>
returning false.</p>
<p><em>Adrianna Chang</em></p>
</li>
<li>
<p>Specify callback in <code>has_secure_token</code></p>
<div data-snippet-clipboard-copy-content="class User < ApplicationRecord
  has_secure_token on: :initialize
end

User.new.token # => &quot;abc123....&quot;"><pre><span>class</span> <span>User</span> &lt; <span>ApplicationRecord</span>
  <span>has_secure_token</span> <span>on</span>: <span>:initialize</span>
<span>end</span>

<span>User</span><span>.</span><span>new</span><span>.</span><span>token</span> <span># =&gt; "abc123...."</span></pre></div>
<p><em>Sean Doyle</em></p>
</li>
<li>
<p>Fix incrementation of in memory counter caches when associations overlap</p>
<p>When two associations had a similarly named counter cache column, Active Record<br>
could sometime increment the wrong one.</p>
<p><em>Jacopo Beschi</em>, <em>Jean Boussier</em></p>
</li>
<li>
<p>Don't show secrets for Active Record's <code>Cipher::Aes256Gcm#inspect</code>.</p>
<p>Before:</p>
<div data-snippet-clipboard-copy-content="ActiveRecord::Encryption::Cipher::Aes256Gcm.new(secret).inspect
&quot;#<ActiveRecord::Encryption::Cipher::Aes256Gcm:0x0000000104888038 ... @secret=\&quot;\\xAF\\bFh]LV}q\\nl\\xB2U\\xB3 ... >&quot;"><pre><span>ActiveRecord</span>::<span>Encryption</span>::<span>Cipher</span>::<span>Aes256Gcm</span><span>.</span><span>new</span><span>(</span><span>secret</span><span>)</span><span>.</span><span>inspect</span>
<span>"#&lt;ActiveRecord::Encryption::Cipher::Aes256Gcm:0x0000000104888038 ... @secret=<span>\"</span><span>\\</span>xAF<span>\\</span>bFh]LV}q<span>\\</span>nl<span>\\</span>xB2U<span>\\</span>xB3 ... &gt;"</span></pre></div>
<p>After:</p>
<div data-snippet-clipboard-copy-content="ActiveRecord::Encryption::Cipher::Aes256Gcm(secret).inspect
&quot;#<ActiveRecord::Encryption::Cipher::Aes256Gcm:0x0000000104888038>&quot;"><pre><span>ActiveRecord</span>::<span>Encryption</span>::<span>Cipher</span>::<span>Aes256Gcm</span><span>(</span><span>secret</span><span>)</span><span>.</span><span>inspect</span>
<span>"#&lt;ActiveRecord::Encryption::Cipher::Aes256Gcm:0x0000000104888038&gt;"</span></pre></div>
<p><em>Petrik de Heus</em></p>
</li>
<li>
<p>Bring back the historical behavior of committing transaction on non-local return.</p>
<div data-snippet-clipboard-copy-content="Model.transaction do
  model.save
  return
  other_model.save # not executed
end"><pre><span>Model</span><span>.</span><span>transaction</span> <span>do</span>
  <span>model</span><span>.</span><span>save</span>
  <span>return</span>
  <span>other_model</span><span>.</span><span>save</span> <span># not executed</span>
<span>end</span></pre></div>
<p>Historically only raised errors would trigger a rollback, but in Ruby <code>2.3</code>, the <code>timeout</code> library<br>
started using <code>throw</code> to interrupt execution which had the adverse effect of committing open transactions.</p>
<p>To solve this, in Active Record 6.1 the behavior was changed to instead rollback the transaction as it was safer<br>
than to potentially commit an incomplete transaction.</p>
<p>Using <code>return</code>, <code>break</code> or <code>throw</code> inside a <code>transaction</code> block was essentially deprecated from Rails 6.1 onwards.</p>
<p>However with the release of <code>timeout 0.4.0</code>, <code>Timeout.timeout</code> now raises an error again, and Active Record is able<br>
to return to its original, less surprising, behavior.</p>
<p>This historical behavior can now be opt-ed in via:</p>
<div data-snippet-clipboard-copy-content="Rails.application.config.active_record.commit_transaction_on_non_local_return = true"><pre><code>Rails.application.config.active_record.commit_transaction_on_non_local_return = true
</code></pre></div>
<p>And is the default for new applications created in Rails 7.1.</p>
<p><em>Jean Boussier</em></p>
</li>
<li>
<p>Deprecate <code>name</code> argument on <code>#remove_connection</code>.</p>
<p>The <code>name</code> argument is deprecated on <code>#remove_connection</code> without replacement. <code>#remove_connection</code> should be called directly on the class that established the connection.</p>
<p><em>Eileen M. Uchitelle</em></p>
</li>
<li>
<p>Fix has_one through singular building with inverse.</p>
<p>Allows building of records from an association with a has_one through a<br>
singular association with inverse. For belongs_to through associations,<br>
linking the foreign key to the primary key model isn't needed.<br>
For has_one, we cannot build records due to the association not being mutable.</p>
<p><em>Gannon McGibbon</em></p>
</li>
<li>
<p>Disable database prepared statements when query logs are enabled</p>
<p>Prepared Statements and Query Logs are incompatible features due to query logs making every query unique.</p>
<p><em>zzak, Jean Boussier</em></p>
</li>
<li>
<p>Support decrypting data encrypted non-deterministically with a SHA1 hash digest.</p>
<p>This adds a new Active Record encryption option to support decrypting data encrypted<br>
non-deterministically with a SHA1 hash digest:</p>
<div data-snippet-clipboard-copy-content="Rails.application.config.active_record.encryption.support_sha1_for_non_deterministic_encryption = true"><pre><code>Rails.application.config.active_record.encryption.support_sha1_for_non_deterministic_encryption = true
</code></pre></div>
<p>The new option addresses a problem when upgrading from 7.0 to 7.1. Due to a bug in how Active Record<br>
Encryption was getting initialized, the key provider used for non-deterministic encryption were using<br>
SHA-1 as its digest class, instead of the one configured globally by Rails via<br>
<code>Rails.application.config.active_support.key_generator_hash_digest_class</code>.</p>
<p><em>Cadu Ribeiro and Jorge Manrubia</em></p>
</li>
<li>
<p>Added PostgreSQL migration commands for enum rename, add value, and rename value.</p>
<p><code>rename_enum</code> and <code>rename_enum_value</code> are reversible. Due to Postgres<br>
limitation, <code>add_enum_value</code> is not reversible since you cannot delete enum<br>
values. As an alternative you should drop and recreate the enum entirely.</p>
<div data-snippet-clipboard-copy-content="rename_enum :article_status, to: :article_state"><pre><span>rename_enum</span> <span>:article_status</span><span>,</span> <span>to</span>: <span>:article_state</span></pre></div>
<div data-snippet-clipboard-copy-content="add_enum_value :article_state, &quot;archived&quot; # will be at the end of existing values
add_enum_value :article_state, &quot;in review&quot;, before: &quot;published&quot;
add_enum_value :article_state, &quot;approved&quot;, after: &quot;in review&quot;"><pre><span>add_enum_value</span> <span>:article_state</span><span>,</span> <span>"archived"</span> <span># will be at the end of existing values</span>
<span>add_enum_value</span> <span>:article_state</span><span>,</span> <span>"in review"</span><span>,</span> <span>before</span>: <span>"published"</span>
<span>add_enum_value</span> <span>:article_state</span><span>,</span> <span>"approved"</span><span>,</span> <span>after</span>: <span>"in review"</span></pre></div>
<div data-snippet-clipboard-copy-content="rename_enum_value :article_state, from: &quot;archived&quot;, to: &quot;deleted&quot;"><pre><span>rename_enum_value</span> <span>:article_state</span><span>,</span> <span>from</span>: <span>"archived"</span><span>,</span> <span>to</span>: <span>"deleted"</span></pre></div>
<p><em>Ray Faddis</em></p>
</li>
<li>
<p>Allow composite primary key to be derived from schema</p>
<p>Booting an application with a schema that contains composite primary keys<br>
will not issue warning and won't <code>nil</code>ify the <code>ActiveRecord::Base#primary_key</code> value anymore.</p>
<p>Given a <code>travel_routes</code> table definition and a <code>TravelRoute</code> model like:</p>
<div data-snippet-clipboard-copy-content="create_table :travel_routes, primary_key: [:origin, :destination], force: true do |t|
  t.string :origin
  t.string :destination
end

class TravelRoute < ActiveRecord::Base; end"><pre><span>create_table</span> <span>:travel_routes</span><span>,</span> <span>primary_key</span>: <span>[</span><span>:origin</span><span>,</span> <span>:destination</span><span>]</span><span>,</span> <span>force</span>: <span>true</span> <span>do</span> |<span>t</span>|
  <span>t</span><span>.</span><span>string</span> <span>:origin</span>
  <span>t</span><span>.</span><span>string</span> <span>:destination</span>
<span>end</span>

<span>class</span> <span>TravelRoute</span> &lt; <span>ActiveRecord</span>::<span>Base</span><span>;</span> <span>end</span></pre></div>
<p>The <code>TravelRoute.primary_key</code> value will be automatically derived to <code>["origin", "destination"]</code></p>
<p><em>Nikita Vasilevsky</em></p>
</li>
<li>
<p>Include the <code>connection_pool</code> with exceptions raised from an adapter.</p>
<p>The <code>connection_pool</code> provides added context such as the connection used<br>
that led to the exception as well as which role and shard.</p>
<p><em>Luan Vieira</em></p>
</li>
<li>
<p>Support multiple column ordering for <code>find_each</code>, <code>find_in_batches</code> and <code>in_batches</code>.</p>
<p>When find_each/find_in_batches/in_batches are performed on a table with composite primary keys, ascending or descending order can be selected for each key.</p>
<div data-snippet-clipboard-copy-content="Person.find_each(order: [:desc, :asc]) do |person|
  person.party_all_night!
end"><pre><span>Person</span><span>.</span><span>find_each</span><span>(</span><span>order</span>: <span>[</span><span>:desc</span><span>,</span> <span>:asc</span><span>]</span><span>)</span> <span>do</span> |<span>person</span>|
  <span>person</span><span>.</span><span>party_all_night!</span>
<span>end</span></pre></div>
<p><em>Takuya Kurimoto</em></p>
</li>
<li>
<p>Fix where on association with has_one/has_many polymorphic relations.</p>
<p>Before:</p>
<div data-snippet-clipboard-copy-content="Treasure.where(price_estimates: PriceEstimate.all)
#=> SELECT (...) WHERE &quot;treasures&quot;.&quot;id&quot; IN (SELECT &quot;price_estimates&quot;.&quot;estimate_of_id&quot; FROM &quot;price_estimates&quot;)"><pre><span>Treasure</span><span>.</span><span>where</span><span>(</span><span>price_estimates</span>: <span>PriceEstimate</span><span>.</span><span>all</span><span>)</span>
<span>#=&gt; SELECT (...) WHERE "treasures"."id" IN (SELECT "price_estimates"."estimate_of_id" FROM "price_estimates")</span></pre></div>
<p>Later:</p>
<div data-snippet-clipboard-copy-content="Treasure.where(price_estimates: PriceEstimate.all)
#=> SELECT (...) WHERE &quot;treasures&quot;.&quot;id&quot; IN (SELECT &quot;price_estimates&quot;.&quot;estimate_of_id&quot; FROM &quot;price_estimates&quot; WHERE &quot;price_estimates&quot;.&quot;estimate_of_type&quot; = 'Treasure')"><pre><span>Treasure</span><span>.</span><span>where</span><span>(</span><span>price_estimates</span>: <span>PriceEstimate</span><span>.</span><span>all</span><span>)</span>
<span>#=&gt; SELECT (...) WHERE "treasures"."id" IN (SELECT "price_estimates"."estimate_of_id" FROM "price_estimates" WHERE "price_estimates"."estimate_of_type" = 'Treasure')</span></pre></div>
<p><em>Lázaro Nixon</em></p>
</li>
<li>
<p>Assign auto populated columns on Active Record record creation.</p>
<p>Changes record creation logic to allow for the <code>auto_increment</code> column to be assigned<br>
immediately after creation regardless of it's relation to the model's primary key.</p>
<p>The PostgreSQL adapter benefits the most from the change allowing for any number of auto-populated<br>
columns to be assigned on the object immediately after row insertion utilizing the <code>RETURNING</code> statement.</p>
<p><em>Nikita Vasilevsky</em></p>
</li>
<li>
<p>Use the first key in the <code>shards</code> hash from <code>connected_to</code> for the <code>default_shard</code>.</p>
<p>Some applications may not want to use <code>:default</code> as a shard name in their connection model. Unfortunately Active Record expects there to be a <code>:default</code> shard because it must assume a shard to get the right connection from the pool manager. Rather than force applications to manually set this, <code>connects_to</code> can infer the default shard name from the hash of shards and will now assume that the first shard is your default.</p>
<p>For example if your model looked like this:</p>
<div data-snippet-clipboard-copy-content="class ShardRecord < ApplicationRecord
  self.abstract_class = true

  connects_to shards: {
    shard_one: { writing: :shard_one },
    shard_two: { writing: :shard_two }
  }"><pre><span>class</span> <span>ShardRecord</span> &lt; <span>ApplicationRecord</span>
  <span>self</span><span>.</span><span>abstract_class</span> <span>=</span> <span>true</span>

  <span>connects_to</span> <span>shards</span>: <span>{</span>
    <span>shard_one</span>: <span>{</span> <span>writing</span>: <span>:shard_one</span> <span>}</span><span>,</span>
    <span>shard_two</span>: <span>{</span> <span>writing</span>: <span>:shard_two</span> <span>}</span>
  <span>}</span></pre></div>
<p>Then the <code>default_shard</code> for this class would be set to <code>shard_one</code>.</p>
<p>Fixes: <a data-error-text="Failed to load title" data-id="1275315412" data-permission-text="Title is private" data-url="https://github.com/rails/rails/issues/45390" data-hovercard-type="issue" data-hovercard-url="/rails/rails/issues/45390/hovercard" href="https://github.com/rails/rails/issues/45390">#45390</a></p>
<p><em>Eileen M. Uchitelle</em></p>
</li>
<li>
<p>Fix mutation detection for serialized attributes backed by binary columns.</p>
<p><em>Jean Boussier</em></p>
</li>
<li>
<p>Add <code>ActiveRecord.disconnect_all!</code> method to immediately close all connections from all pools.</p>
<p><em>Jean Boussier</em></p>
</li>
<li>
<p>Discard connections which may have been left in a transaction.</p>
<p>There are cases where, due to an error, <code>within_new_transaction</code> may unexpectedly leave a connection in an open transaction. In these cases the connection may be reused, and the following may occur:</p>
<ul>
<li>Writes appear to fail when they actually succeed.</li>
<li>Writes appear to succeed when they actually fail.</li>
<li>Reads return stale or uncommitted data.</li>
</ul>
<p>Previously, the following case was detected:</p>
<ul>
<li>An error is encountered during the transaction, then another error is encountered while attempting to roll it back.</li>
</ul>
<p>Now, the following additional cases are detected:</p>
<ul>
<li>An error is encountered just after successfully beginning a transaction.</li>
<li>An error is encountered while committing a transaction, then another error is encountered while attempting to roll it back.</li>
<li>An error is encountered while rolling back a transaction.</li>
</ul>
<p><em>Nick Dower</em></p>
</li>
<li>
<p>Active Record query cache now evicts least recently used entries</p>
<p>By default it only keeps the <code>100</code> most recently used queries.</p>
<p>The cache size can be configured via <code>database.yml</code></p>
<div data-snippet-clipboard-copy-content="development:
  adapter: mysql2
  query_cache: 200"><pre><span>development</span>:
  <span>adapter</span>: <span>mysql2</span>
  <span>query_cache</span>: <span>200</span></pre></div>
<p>It can also be entirely disabled:</p>
<div data-snippet-clipboard-copy-content="development:
  adapter: mysql2
  query_cache: false"><pre><span>development</span>:
  <span>adapter</span>: <span>mysql2</span>
  <span>query_cache</span>: <span>false</span></pre></div>
<p><em>Jean Boussier</em></p>
</li>
<li>
<p>Deprecate <code>check_pending!</code> in favor of <code>check_all_pending!</code>.</p>
<p><code>check_pending!</code> will only check for pending migrations on the current database connection or the one passed in. This has been deprecated in favor of <code>check_all_pending!</code> which will find all pending migrations for the database configurations in a given environment.</p>
<p><em>Eileen M. Uchitelle</em></p>
</li>
<li>
<p>Make <code>increment_counter</code>/<code>decrement_counter</code> accept an amount argument</p>
<div data-snippet-clipboard-copy-content="Post.increment_counter(:comments_count, 5, by: 3)"><pre><span>Post</span><span>.</span><span>increment_counter</span><span>(</span><span>:comments_count</span><span>,</span> <span>5</span><span>,</span> <span>by</span>: <span>3</span><span>)</span></pre></div>
<p><em>fatkodima</em></p>
</li>
<li>
<p>Add support for <code>Array#intersect?</code> to <code>ActiveRecord::Relation</code>.</p>
<p><code>Array#intersect?</code> is only available on Ruby 3.1 or later.</p>
<p>This allows the Rubocop <code>Style/ArrayIntersect</code> cop to work with <code>ActiveRecord::Relation</code> objects.</p>
<p><em>John Harry Kelly</em></p>
</li>
<li>
<p>The deferrable foreign key can be passed to <code>t.references</code>.</p>
<p><em>Hiroyuki Ishii</em></p>
</li>
<li>
<p>Deprecate <code>deferrable: true</code> option of <code>add_foreign_key</code>.</p>
<p><code>deferrable: true</code> is deprecated in favor of <code>deferrable: :immediate</code>, and<br>
will be removed in Rails 7.2.</p>
<p>Because <code>deferrable: true</code> and <code>deferrable: :deferred</code> are hard to understand.<br>
Both true and :deferred are truthy values.<br>
This behavior is the same as the deferrable option of the add_unique_key method, added in <a data-error-text="Failed to load title" data-id="1396155024" data-permission-text="Title is private" data-url="https://github.com/rails/rails/issues/46192" data-hovercard-type="pull_request" data-hovercard-url="/rails/rails/pull/46192/hovercard" href="https://github.com/rails/rails/pull/46192">#46192</a>.</p>
<p><em>Hiroyuki Ishii</em></p>
</li>
<li>
<p><code>AbstractAdapter#execute</code> and <code>#exec_query</code> now clear the query cache</p>
<p>If you need to perform a read only SQL query without clearing the query<br>
cache, use <code>AbstractAdapter#select_all</code>.</p>
<p><em>Jean Boussier</em></p>
</li>
<li>
<p>Make <code>.joins</code> / <code>.left_outer_joins</code> work with CTEs.</p>
<p>For example:</p>
<div data-snippet-clipboard-copy-content="Post
 .with(commented_posts: Comment.select(:post_id).distinct)
 .joins(:commented_posts)
#=> WITH (...) SELECT ... INNER JOIN commented_posts on posts.id = commented_posts.post_id"><pre><span>Post</span>
 <span>.</span><span>with</span><span>(</span><span>commented_posts</span>: <span>Comment</span><span>.</span><span>select</span><span>(</span><span>:post_id</span><span>)</span><span>.</span><span>distinct</span><span>)</span>
 <span>.</span><span>joins</span><span>(</span><span>:commented_posts</span><span>)</span>
<span>#=&gt; WITH (...) SELECT ... INNER JOIN commented_posts on posts.id = commented_posts.post_id</span></pre></div>
<p><em>Vladimir Dementyev</em></p>
</li>
<li>
<p>Add a load hook for <code>ActiveRecord::ConnectionAdapters::Mysql2Adapter</code><br>
(named <code>active_record_mysql2adapter</code>) to allow for overriding aspects of the<br>
<code>ActiveRecord::ConnectionAdapters::Mysql2Adapter</code> class. This makes <code>Mysql2Adapter</code><br>
consistent with <code>PostgreSQLAdapter</code> and <code>SQLite3Adapter</code> that already have load hooks.</p>
<p><em>fatkodima</em></p>
</li>
<li>
<p>Introduce adapter for Trilogy database client</p>
<p>Trilogy is a MySQL-compatible database client. Rails applications can use Trilogy<br>
by configuring their <code>config/database.yml</code>:</p>
<div data-snippet-clipboard-copy-content="development:
adapter: trilogy
database: blog_development
pool: 5"><pre><span>development</span>:
<span>adapter</span>: <span>trilogy</span>
<span>database</span>: <span>blog_development</span>
<span>pool</span>: <span>5</span></pre></div>
<p>Or by using the <code>DATABASE_URL</code> environment variable:</p>
<div data-snippet-clipboard-copy-content="ENV['DATABASE_URL'] # => &quot;trilogy://localhost/blog_development?pool=5&quot;"><pre><span>ENV</span><span>[</span><span>'DATABASE_URL'</span><span>]</span> <span># =&gt; "trilogy://localhost/blog_development?pool=5"</span></pre></div>
<p><em>Adrianna Chang</em></p>
</li>
<li>
<p><code>after_commit</code> callbacks defined on models now execute in the correct order.</p>
<div data-snippet-clipboard-copy-content="class User < ActiveRecord::Base
  after_commit { puts(&quot;this gets called first&quot;) }
  after_commit { puts(&quot;this gets called second&quot;) }
end"><pre><span>class</span> <span>User</span> &lt; <span>ActiveRecord</span>::<span>Base</span>
  <span>after_commit</span> <span>{</span> <span>puts</span><span>(</span><span>"this gets called first"</span><span>)</span> <span>}</span>
  <span>after_commit</span> <span>{</span> <span>puts</span><span>(</span><span>"this gets called second"</span><span>)</span> <span>}</span>
<span>end</span></pre></div>
<p>Previously, the callbacks executed in the reverse order. To opt in to the new behaviour:</p>
<div data-snippet-clipboard-copy-content="config.active_record.run_after_transaction_callbacks_in_order_defined = true"><pre><span>config</span><span>.</span><span>active_record</span><span>.</span><span>run_after_transaction_callbacks_in_order_defined</span> <span>=</span> <span>true</span></pre></div>
<p>This is the default for new apps.</p>
<p><em>Alex Ghiculescu</em></p>
</li>
<li>
<p>Infer <code>foreign_key</code> when <code>inverse_of</code> is present on <code>has_one</code> and <code>has_many</code> associations.</p>
<div data-snippet-clipboard-copy-content="has_many :citations, foreign_key: &quot;book1_id&quot;, inverse_of: :book"><pre><span>has_many</span> <span>:citations</span><span>,</span> <span>foreign_key</span>: <span>"book1_id"</span><span>,</span> <span>inverse_of</span>: <span>:book</span></pre></div>
<p>can be simplified to</p>
<div data-snippet-clipboard-copy-content="has_many :citations, inverse_of: :book"><pre><span>has_many</span> <span>:citations</span><span>,</span> <span>inverse_of</span>: <span>:book</span></pre></div>
<p>and the foreign_key will be read from the corresponding <code>belongs_to</code> association.</p>
<p><em>Daniel Whitney</em></p>
</li>
<li>
<p>Limit max length of auto generated index names</p>
<p>Auto generated index names are now limited to 62 bytes, which fits within<br>
the default index name length limits for MySQL, Postgres and SQLite.</p>
<p>Any index name over the limit will fallback to the new short format.</p>
<p>Before (too long):</p>
<div data-snippet-clipboard-copy-content="index_testings_on_foo_and_bar_and_first_name_and_last_name_and_administrator"><pre><code>index_testings_on_foo_and_bar_and_first_name_and_last_name_and_administrator
</code></pre></div>
<p>After (short format):</p>
<div data-snippet-clipboard-copy-content="idx_on_foo_bar_first_name_last_name_administrator_5939248142"><pre><code>idx_on_foo_bar_first_name_last_name_administrator_5939248142
</code></pre></div>
<p>The short format includes a hash to ensure the name is unique database-wide.</p>
<p><em>Mike Coutermarsh</em></p>
</li>
<li>
<p>Introduce a more stable and optimized Marshal serializer for Active Record models.</p>
<p>Can be enabled with <code>config.active_record.marshalling_format_version = 7.1</code>.</p>
<p><em>Jean Boussier</em></p>
</li>
<li>
<p>Allow specifying where clauses with column-tuple syntax.</p>
<p>Querying through <code>#where</code> now accepts a new tuple-syntax which accepts, as<br>
a key, an array of columns and, as a value, an array of corresponding tuples.<br>
The key specifies a list of columns, while the value is an array of<br>
ordered-tuples that conform to the column list.</p>
<p>For instance:</p>
<div data-snippet-clipboard-copy-content="# Cpk::Book => Cpk::Book(author_id: integer, number: integer, title: string, revision: integer)
# Cpk::Book.primary_key => [&quot;author_id&quot;, &quot;number&quot;]

book = Cpk::Book.create!(author_id: 1, number: 1)
Cpk::Book.where(Cpk::Book.primary_key => [[1, 2]]) # => [book]

# Topic => Topic(id: integer, title: string, author_name: string...)

Topic.where([:title, :author_name] => [[&quot;The Alchemist&quot;, &quot;Paulo Coelho&quot;], [&quot;Harry Potter&quot;, &quot;J.K Rowling&quot;]])"><pre><span># Cpk::Book =&gt; Cpk::Book(author_id: integer, number: integer, title: string, revision: integer)</span>
<span># Cpk::Book.primary_key =&gt; ["author_id", "number"]</span>

<span>book</span> <span>=</span> <span>Cpk</span>::<span>Book</span><span>.</span><span>create!</span><span>(</span><span>author_id</span>: <span>1</span><span>,</span> <span>number</span>: <span>1</span><span>)</span>
<span>Cpk</span>::<span>Book</span><span>.</span><span>where</span><span>(</span><span>Cpk</span>::<span>Book</span><span>.</span><span>primary_key</span> <span>=&gt;</span> <span>[</span><span>[</span><span>1</span><span>,</span> <span>2</span><span>]</span><span>]</span><span>)</span> <span># =&gt; [book]</span>

<span># Topic =&gt; Topic(id: integer, title: string, author_name: string...)</span>

<span>Topic</span><span>.</span><span>where</span><span>(</span><span>[</span><span>:title</span><span>,</span> <span>:author_name</span><span>]</span> <span>=&gt;</span> <span>[</span><span>[</span><span>"The Alchemist"</span><span>,</span> <span>"Paulo Coelho"</span><span>]</span><span>,</span> <span>[</span><span>"Harry Potter"</span><span>,</span> <span>"J.K Rowling"</span><span>]</span><span>]</span><span>)</span></pre></div>
<p><em>Paarth Madan</em></p>
</li>
<li>
<p>Allow warning codes to be ignore when reporting SQL warnings.</p>
<p>Active Record config that can ignore warning codes</p>
<div data-snippet-clipboard-copy-content="# Configure allowlist of warnings that should always be ignored
config.active_record.db_warnings_ignore = [
  &quot;1062&quot;, # MySQL Error 1062: Duplicate entry
]"><pre><span># Configure allowlist of warnings that should always be ignored</span>
<span>config</span><span>.</span><span>active_record</span><span>.</span><span>db_warnings_ignore</span> <span>=</span> <span>[</span>
  <span>"1062"</span><span>,</span> <span># MySQL Error 1062: Duplicate entry</span>
<span>]</span></pre></div>
<p>This is supported for the MySQL and PostgreSQL adapters.</p>
<p><em>Nick Borromeo</em></p>
</li>
<li>
<p>Introduce <code>:active_record_fixtures</code> lazy load hook.</p>
<p>Hooks defined with this name will be run whenever <code>TestFixtures</code> is included<br>
in a class.</p>
<div data-snippet-clipboard-copy-content="ActiveSupport.on_load(:active_record_fixtures) do
  self.fixture_paths << &quot;test/fixtures&quot;
end

klass = Class.new
klass.include(ActiveRecord::TestFixtures)

klass.fixture_paths # => [&quot;test/fixtures&quot;]"><pre><span>ActiveSupport</span><span>.</span><span>on_load</span><span>(</span><span>:active_record_fixtures</span><span>)</span> <span>do</span>
  <span>self</span><span>.</span><span>fixture_paths</span> &lt;&lt; <span>"test/fixtures"</span>
<span>end</span>

<span>klass</span> <span>=</span> <span>Class</span><span>.</span><span>new</span>
<span>klass</span><span>.</span><span>include</span><span>(</span><span>ActiveRecord</span>::<span>TestFixtures</span><span>)</span>

<span>klass</span><span>.</span><span>fixture_paths</span> <span># =&gt; ["test/fixtures"]</span></pre></div>
<p><em>Andrew Novoselac</em></p>
</li>
<li>
<p>Introduce <code>TestFixtures#fixture_paths</code>.</p>
<p>Multiple fixture paths can now be specified using the <code>#fixture_paths</code> accessor.<br>
Apps will continue to have <code>test/fixtures</code> as their one fixture path by default,<br>
but additional fixture paths can be specified.</p>
<div data-snippet-clipboard-copy-content="ActiveSupport::TestCase.fixture_paths << &quot;component1/test/fixtures&quot;
ActiveSupport::TestCase.fixture_paths << &quot;component2/test/fixtures&quot;"><pre><span>ActiveSupport</span>::<span>TestCase</span><span>.</span><span>fixture_paths</span> &lt;&lt; <span>"component1/test/fixtures"</span>
<span>ActiveSupport</span>::<span>TestCase</span><span>.</span><span>fixture_paths</span> &lt;&lt; <span>"component2/test/fixtures"</span></pre></div>
<p><code>TestFixtures#fixture_path</code> is now deprecated.</p>
<p><em>Andrew Novoselac</em></p>
</li>
<li>
<p>Adds support for deferrable exclude constraints in PostgreSQL.</p>
<p>By default, exclude constraints in PostgreSQL are checked after each statement.<br>
This works for most use cases, but becomes a major limitation when replacing<br>
records with overlapping ranges by using multiple statements.</p>
<div data-snippet-clipboard-copy-content="exclusion_constraint :users, &quot;daterange(valid_from, valid_to) WITH &amp;&amp;&quot;, deferrable: :immediate"><pre><span>exclusion_constraint</span> <span>:users</span><span>,</span> <span>"daterange(valid_from, valid_to) WITH &amp;&amp;"</span><span>,</span> <span>deferrable</span>: <span>:immediate</span></pre></div>
<p>Passing <code>deferrable: :immediate</code> checks constraint after each statement,<br>
but allows manually deferring the check using <code>SET CONSTRAINTS ALL DEFERRED</code><br>
within a transaction. This will cause the excludes to be checked after the transaction.</p>
<p>It's also possible to change the default behavior from an immediate check<br>
(after the statement), to a deferred check (after the transaction):</p>
<div data-snippet-clipboard-copy-content="exclusion_constraint :users, &quot;daterange(valid_from, valid_to) WITH &amp;&amp;&quot;, deferrable: :deferred"><pre><span>exclusion_constraint</span> <span>:users</span><span>,</span> <span>"daterange(valid_from, valid_to) WITH &amp;&amp;"</span><span>,</span> <span>deferrable</span>: <span>:deferred</span></pre></div>
<p><em>Hiroyuki Ishii</em></p>
</li>
<li>
<p>Respect <code>foreign_type</code> option to <code>delegated_type</code> for <code>{role}_class</code> method.</p>
<p>Usage of <code>delegated_type</code> with non-conventional <code>{role}_type</code> column names can now be specified with <code>foreign_type</code> option.<br>
This option is the same as <code>foreign_type</code> as forwarded to the underlying <code>belongs_to</code> association that <code>delegated_type</code> wraps.</p>
<p><em>Jason Karns</em></p>
</li>
<li>
<p>Add support for unique constraints (PostgreSQL-only).</p>
<div data-snippet-clipboard-copy-content="add_unique_key :sections, [:position], deferrable: :deferred, name: &quot;unique_section_position&quot;
remove_unique_key :sections, name: &quot;unique_section_position&quot;"><pre><span>add_unique_key</span> <span>:sections</span><span>,</span> <span>[</span><span>:position</span><span>]</span><span>,</span> <span>deferrable</span>: <span>:deferred</span><span>,</span> <span>name</span>: <span>"unique_section_position"</span>
<span>remove_unique_key</span> <span>:sections</span><span>,</span> <span>name</span>: <span>"unique_section_position"</span></pre></div>
<p>See PostgreSQL's <a href="https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-UNIQUE-CONSTRAINTS" rel="nofollow">Unique Constraints</a> documentation for more on unique constraints.</p>
<p>By default, unique constraints in PostgreSQL are checked after each statement.<br>
This works for most use cases, but becomes a major limitation when replacing<br>
records with unique column by using multiple statements.</p>
<p>An example of swapping unique columns between records.</p>
<div data-snippet-clipboard-copy-content="# position is unique column
old_item = Item.create!(position: 1)
new_item = Item.create!(position: 2)

Item.transaction do
  old_item.update!(position: 2)
  new_item.update!(position: 1)
end"><pre><span># position is unique column</span>
<span>old_item</span> <span>=</span> <span>Item</span><span>.</span><span>create!</span><span>(</span><span>position</span>: <span>1</span><span>)</span>
<span>new_item</span> <span>=</span> <span>Item</span><span>.</span><span>create!</span><span>(</span><span>position</span>: <span>2</span><span>)</span>

<span>Item</span><span>.</span><span>transaction</span> <span>do</span>
  <span>old_item</span><span>.</span><span>update!</span><span>(</span><span>position</span>: <span>2</span><span>)</span>
  <span>new_item</span><span>.</span><span>update!</span><span>(</span><span>position</span>: <span>1</span><span>)</span>
<span>end</span></pre></div>
<p>Using the default behavior, the transaction would fail when executing the<br>
first <code>UPDATE</code> statement.</p>
<p>By passing the <code>:deferrable</code> option to the <code>add_unique_key</code> statement in<br>
migrations, it's possible to defer this check.</p>
<div data-snippet-clipboard-copy-content="add_unique_key :items, [:position], deferrable: :immediate"><pre><span>add_unique_key</span> <span>:items</span><span>,</span> <span>[</span><span>:position</span><span>]</span><span>,</span> <span>deferrable</span>: <span>:immediate</span></pre></div>
<p>Passing <code>deferrable: :immediate</code> does not change the behaviour of the previous example,<br>
but allows manually deferring the check using <code>SET CONSTRAINTS ALL DEFERRED</code> within a transaction.<br>
This will cause the unique constraints to be checked after the transaction.</p>
<p>It's also possible to adjust the default behavior from an immediate<br>
check (after the statement), to a deferred check (after the transaction):</p>
<div data-snippet-clipboard-copy-content="add_unique_key :items, [:position], deferrable: :deferred"><pre><span>add_unique_key</span> <span>:items</span><span>,</span> <span>[</span><span>:position</span><span>]</span><span>,</span> <span>deferrable</span>: <span>:deferred</span></pre></div>
<p>If you want to change an existing unique index to deferrable, you can use :using_index<br>
to create deferrable unique constraints.</p>
<div data-snippet-clipboard-copy-content="add_unique_key :items, deferrable: :deferred, using_index: &quot;index_items_on_position&quot;"><pre><span>add_unique_key</span> <span>:items</span><span>,</span> <span>deferrable</span>: <span>:deferred</span><span>,</span> <span>using_index</span>: <span>"index_items_on_position"</span></pre></div>
<p><em>Hiroyuki Ishii</em></p>
</li>
<li>
<p>Remove deprecated <code>Tasks::DatabaseTasks.schema_file_type</code>.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Remove deprecated <code>config.active_record.partial_writes</code>.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Remove deprecated <code>ActiveRecord::Base</code> config accessors.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Remove the <code>:include_replicas</code> argument from <code>configs_for</code>. Use <code>:include_hidden</code> argument instead.</p>
<p><em>Eileen M. Uchitelle</em></p>
</li>
<li>
<p>Allow applications to lookup a config via a custom hash key.</p>
<p>If you have registered a custom config or want to find configs where the hash matches a specific key, now you can pass <code>config_key</code> to <code>configs_for</code>. For example if you have a <code>db_config</code> with the key <code>vitess</code> you can look up a database configuration hash by  matching that key.</p>
<div data-snippet-clipboard-copy-content="ActiveRecord::Base.configurations.configs_for(env_name: &quot;development&quot;, name: &quot;primary&quot;, config_key: :vitess)
ActiveRecord::Base.configurations.configs_for(env_name: &quot;development&quot;, config_key: :vitess)"><pre><span>ActiveRecord</span>::<span>Base</span><span>.</span><span>configurations</span><span>.</span><span>configs_for</span><span>(</span><span>env_name</span>: <span>"development"</span><span>,</span> <span>name</span>: <span>"primary"</span><span>,</span> <span>config_key</span>: <span>:vitess</span><span>)</span>
<span>ActiveRecord</span>::<span>Base</span><span>.</span><span>configurations</span><span>.</span><span>configs_for</span><span>(</span><span>env_name</span>: <span>"development"</span><span>,</span> <span>config_key</span>: <span>:vitess</span><span>)</span></pre></div>
<p><em>Eileen M. Uchitelle</em></p>
</li>
<li>
<p>Allow applications to register a custom database configuration handler.</p>
<p>Adds a mechanism for registering a custom handler for cases where you want database configurations to respond to custom methods. This is useful for non-Rails database adapters or tools like Vitess that you may want to configure differently from a standard <code>HashConfig</code> or <code>UrlConfig</code>.</p>
<p>Given the following database YAML we want the <code>animals</code> db to create a <code>CustomConfig</code> object instead while the <code>primary</code> database will be a <code>UrlConfig</code>:</p>
<div data-snippet-clipboard-copy-content="development:
  primary:
    url: postgres://localhost/primary
  animals:
    url: postgres://localhost/animals
    custom_config:
      sharded: 1"><pre><span>development</span>:
  <span>primary</span>:
    <span>url</span>: <span>postgres://localhost/primary</span>
  <span>animals</span>:
    <span>url</span>: <span>postgres://localhost/animals</span>
    <span>custom_config</span>:
      <span>sharded</span>: <span>1</span></pre></div>
<p>To register a custom handler first make a class that has your custom methods:</p>
<div data-snippet-clipboard-copy-content="class CustomConfig < ActiveRecord::DatabaseConfigurations::UrlConfig
  def sharded?
    custom_config.fetch(&quot;sharded&quot;, false)
  end

  private
    def custom_config
      configuration_hash.fetch(:custom_config)
    end
end"><pre><span>class</span> <span>CustomConfig</span> &lt; <span>ActiveRecord</span>::<span>DatabaseConfigurations</span>::<span>UrlConfig</span>
  <span>def</span> <span>sharded?</span>
    <span>custom_config</span><span>.</span><span>fetch</span><span>(</span><span>"sharded"</span><span>,</span> <span>false</span><span>)</span>
  <span>end</span>

  <span>private</span>
    <span>def</span> <span>custom_config</span>
      <span>configuration_hash</span><span>.</span><span>fetch</span><span>(</span><span>:custom_config</span><span>)</span>
    <span>end</span>
<span>end</span></pre></div>
<p>Then register the config in an initializer:</p>
<div data-snippet-clipboard-copy-content="ActiveRecord::DatabaseConfigurations.register_db_config_handler do |env_name, name, url, config|
  next unless config.key?(:custom_config)
  CustomConfig.new(env_name, name, url, config)
end"><pre><span>ActiveRecord</span>::<span>DatabaseConfigurations</span><span>.</span><span>register_db_config_handler</span> <span>do</span> |<span>env_name</span><span>,</span> <span>name</span><span>,</span> <span>url</span><span>,</span> <span>config</span>|
  <span>next</span> <span>unless</span> <span>config</span><span>.</span><span>key?</span><span>(</span><span>:custom_config</span><span>)</span>
  <span>CustomConfig</span><span>.</span><span>new</span><span>(</span><span>env_name</span><span>,</span> <span>name</span><span>,</span> <span>url</span><span>,</span> <span>config</span><span>)</span>
<span>end</span></pre></div>
<p>When the application is booted, configuration hashes with the <code>:custom_config</code> key will be <code>CustomConfig</code> objects and respond to <code>sharded?</code>. Applications must handle the condition in which Active Record should use their custom handler.</p>
<p><em>Eileen M. Uchitelle and John Crepezzi</em></p>
</li>
<li>
<p><code>ActiveRecord::Base.serialize</code> no longer uses YAML by default.</p>
<p>YAML isn't particularly performant and can lead to security issues<br>
if not used carefully.</p>
<p>Unfortunately there isn't really any good serializers in Ruby's stdlib<br>
to replace it.</p>
<p>The obvious choice would be JSON, which is a fine format for this use case,<br>
however the JSON serializer in Ruby's stdlib isn't strict enough, as it fallback<br>
to casting unknown types to strings, which could lead to corrupted data.</p>
<p>Some third party JSON libraries like <code>Oj</code> have a suitable strict mode.</p>
<p>So it's preferable that users choose a serializer based on their own constraints.</p>
<p>The original default can be restored by setting <code>config.active_record.default_column_serializer = YAML</code>.</p>
<p><em>Jean Boussier</em></p>
</li>
<li>
<p><code>ActiveRecord::Base.serialize</code> signature changed.</p>
<p>Rather than a single positional argument that accepts two possible<br>
types of values, <code>serialize</code> now accepts two distinct keyword arguments.</p>
<p>Before:</p>
<div data-snippet-clipboard-copy-content="serialize :content, JSON
serialize :backtrace, Array"><pre><span>serialize</span> <span>:content</span><span>,</span> <span>JSON</span>
<span>serialize</span> <span>:backtrace</span><span>,</span> <span>Array</span></pre></div>
<p>After:</p>
<div data-snippet-clipboard-copy-content="serialize :content, coder: JSON
serialize :backtrace, type: Array"><pre><span>serialize</span> <span>:content</span><span>,</span> <span>coder</span>: <span>JSON</span>
<span>serialize</span> <span>:backtrace</span><span>,</span> <span>type</span>: <span>Array</span></pre></div>
<p><em>Jean Boussier</em></p>
</li>
<li>
<p>YAML columns use <code>YAML.safe_dump</code> if available.</p>
<p>As of <code>psych 5.1.0</code>, <code>YAML.safe_dump</code> can now apply the same permitted<br>
types restrictions than <code>YAML.safe_load</code>.</p>
<p>It's preferable to ensure the payload only use allowed types when we first<br>
try to serialize it, otherwise you may end up with invalid records in the<br>
database.</p>
<p><em>Jean Boussier</em></p>
</li>
<li>
<p><code>ActiveRecord::QueryLogs</code> better handle broken encoding.</p>
<p>It's not uncommon when building queries with BLOB fields to contain<br>
binary data. Unless the call carefully encode the string in ASCII-8BIT<br>
it generally end up being encoded in <code>UTF-8</code>, and <code>QueryLogs</code> would<br>
end up failing on it.</p>
<p><code>ActiveRecord::QueryLogs</code> no longer depend on the query to be properly encoded.</p>
<p><em>Jean Boussier</em></p>
</li>
<li>
<p>Fix a bug where <code>ActiveRecord::Generators::ModelGenerator</code> would not respect create_table_migration template overrides.</p>
<div data-snippet-clipboard-copy-content="rails g model create_books title:string content:text"><pre><code>rails g model create_books title:string content:text
</code></pre></div>
<p>will now read from the create_table_migration.rb.tt template in the following locations in order:</p>
<div data-snippet-clipboard-copy-content="lib/templates/active_record/model/create_table_migration.rb
lib/templates/active_record/migration/create_table_migration.rb"><pre><code>lib/templates/active_record/model/create_table_migration.rb
lib/templates/active_record/migration/create_table_migration.rb
</code></pre></div>
<p><em>Spencer Neste</em></p>
</li>
<li>
<p><code>ActiveRecord::Relation#explain</code> now accepts options.</p>
<p>For databases and adapters which support them (currently PostgreSQL<br>
and MySQL), options can be passed to <code>explain</code> to provide more<br>
detailed query plan analysis:</p>
<div data-snippet-clipboard-copy-content="Customer.where(id: 1).joins(:orders).explain(:analyze, :verbose)"><pre><span>Customer</span><span>.</span><span>where</span><span>(</span><span>id</span>: <span>1</span><span>)</span><span>.</span><span>joins</span><span>(</span><span>:orders</span><span>)</span><span>.</span><span>explain</span><span>(</span><span>:analyze</span><span>,</span> <span>:verbose</span><span>)</span></pre></div>
<p><em>Reid Lynch</em></p>
</li>
<li>
<p>Multiple <code>Arel::Nodes::SqlLiteral</code> nodes can now be added together to<br>
form <code>Arel::Nodes::Fragments</code> nodes. This allows joining several pieces<br>
of SQL.</p>
<p><em>Matthew Draper</em>, <em>Ole Friis</em></p>
</li>
<li>
<p><code>ActiveRecord::Base#signed_id</code> raises if called on a new record.</p>
<p>Previously it would return an ID that was not usable, since it was based on <code>id = nil</code>.</p>
<p><em>Alex Ghiculescu</em></p>
</li>
<li>
<p>Allow SQL warnings to be reported.</p>
<p>Active Record configs can be set to enable SQL warning reporting.</p>
<div data-snippet-clipboard-copy-content="# Configure action to take when SQL query produces warning
config.active_record.db_warnings_action = :raise

# Configure allowlist of warnings that should always be ignored
config.active_record.db_warnings_ignore = [
  /Invalid utf8mb4 character string/,
  &quot;An exact warning message&quot;,
]"><pre><span># Configure action to take when SQL query produces warning</span>
<span>config</span><span>.</span><span>active_record</span><span>.</span><span>db_warnings_action</span> <span>=</span> <span>:raise</span>

<span># Configure allowlist of warnings that should always be ignored</span>
<span>config</span><span>.</span><span>active_record</span><span>.</span><span>db_warnings_ignore</span> <span>=</span> <span>[</span>
  <span>/Invalid utf8mb4 character string/</span><span>,</span>
  <span>"An exact warning message"</span><span>,</span>
<span>]</span></pre></div>
<p>This is supported for the MySQL and PostgreSQL adapters.</p>
<p><em>Adrianna Chang</em>, <em>Paarth Madan</em></p>
</li>
<li>
<p>Add <code>#regroup</code> query method as a short-hand for <code>.unscope(:group).group(fields)</code></p>
<p>Example:</p>
<div data-snippet-clipboard-copy-content="Post.group(:title).regroup(:author)
# SELECT `posts`.`*` FROM `posts` GROUP BY `posts`.`author`"><pre><span>Post</span><span>.</span><span>group</span><span>(</span><span>:title</span><span>)</span><span>.</span><span>regroup</span><span>(</span><span>:author</span><span>)</span>
<span># SELECT `posts`.`*` FROM `posts` GROUP BY `posts`.`author`</span></pre></div>
<p><em>Danielius Visockas</em></p>
</li>
<li>
<p>PostgreSQL adapter method <code>enable_extension</code> now allows parameter to be <code>[schema_name.]&lt;extension_name&gt;</code><br>
if the extension must be installed on another schema.</p>
<p>Example: <code>enable_extension('heroku_ext.hstore')</code></p>
<p><em>Leonardo Luarte</em></p>
</li>
<li>
<p>Add <code>:include</code> option to <code>add_index</code>.</p>
<p>Add support for including non-key columns in indexes for PostgreSQL<br>
with the <code>INCLUDE</code> parameter.</p>
<div data-snippet-clipboard-copy-content="add_index(:users, :email, include: [:id, :created_at])"><pre><span>add_index</span><span>(</span><span>:users</span><span>,</span> <span>:email</span><span>,</span> <span>include</span>: <span>[</span><span>:id</span><span>,</span> <span>:created_at</span><span>]</span><span>)</span></pre></div>
<p>will result in:</p>
<div data-snippet-clipboard-copy-content="CREATE INDEX index_users_on_email USING btree (email) INCLUDE (id, created_at)"><pre><span>CREATE</span> <span>INDEX</span> <span>index_users_on_email</span> USING btree (email) INCLUDE (id, created_at)</pre></div>
<p><em>Steve Abrams</em></p>
</li>
<li>
<p><code>ActiveRecord::Relation</code>’s <code>#any?</code>, <code>#none?</code>, and <code>#one?</code> methods take an optional pattern<br>
argument, more closely matching their <code>Enumerable</code> equivalents.</p>
<p><em>George Claghorn</em></p>
</li>
<li>
<p>Add <code>ActiveRecord::Base.normalizes</code> for declaring attribute normalizations.</p>
<p>An attribute normalization is applied when the attribute is assigned or<br>
updated, and the normalized value will be persisted to the database.  The<br>
normalization is also applied to the corresponding keyword argument of query<br>
methods, allowing records to be queried using unnormalized values.</p>
<p>For example:</p>
<div data-snippet-clipboard-copy-content="class User < ActiveRecord::Base
  normalizes :email, with: -> email { email.strip.downcase }
  normalizes :phone, with: -> phone { phone.delete(&quot;^0-9&quot;).delete_prefix(&quot;1&quot;) }
end

user = User.create(email: &quot; CRUISE-CONTROL@EXAMPLE.COM\n&quot;)
user.email                  # => &quot;cruise-control@example.com&quot;

user = User.find_by(email: &quot;\tCRUISE-CONTROL@EXAMPLE.COM &quot;)
user.email                  # => &quot;cruise-control@example.com&quot;
user.email_before_type_cast # => &quot;cruise-control@example.com&quot;

User.where(email: &quot;\tCRUISE-CONTROL@EXAMPLE.COM &quot;).count         # => 1
User.where([&quot;email = ?&quot;, &quot;\tCRUISE-CONTROL@EXAMPLE.COM &quot;]).count # => 0

User.exists?(email: &quot;\tCRUISE-CONTROL@EXAMPLE.COM &quot;)         # => true
User.exists?([&quot;email = ?&quot;, &quot;\tCRUISE-CONTROL@EXAMPLE.COM &quot;]) # => false

User.normalize_value_for(:phone, &quot;+1 (555) 867-5309&quot;) # => &quot;5558675309&quot;"><pre><span>class</span> <span>User</span> &lt; <span>ActiveRecord</span>::<span>Base</span>
  <span>normalizes</span> <span>:email</span><span>,</span> <span>with</span>: <span>-&gt;</span> <span>email</span> <span>{</span> <span>email</span><span>.</span><span>strip</span><span>.</span><span>downcase</span> <span>}</span>
  <span>normalizes</span> <span>:phone</span><span>,</span> <span>with</span>: <span>-&gt;</span> <span>phone</span> <span>{</span> <span>phone</span><span>.</span><span>delete</span><span>(</span><span>"^0-9"</span><span>)</span><span>.</span><span>delete_prefix</span><span>(</span><span>"1"</span><span>)</span> <span>}</span>
<span>end</span>

<span>user</span> <span>=</span> <span>User</span><span>.</span><span>create</span><span>(</span><span>email</span>: <span>" CRUISE-CONTROL@EXAMPLE.COM<span>\n</span>"</span><span>)</span>
<span>user</span><span>.</span><span>email</span>                  <span># =&gt; "cruise-control@example.com"</span>

<span>user</span> <span>=</span> <span>User</span><span>.</span><span>find_by</span><span>(</span><span>email</span>: <span>"<span>\t</span>CRUISE-CONTROL@EXAMPLE.COM "</span><span>)</span>
<span>user</span><span>.</span><span>email</span>                  <span># =&gt; "cruise-control@example.com"</span>
<span>user</span><span>.</span><span>email_before_type_cast</span> <span># =&gt; "cruise-control@example.com"</span>

<span>User</span><span>.</span><span>where</span><span>(</span><span>email</span>: <span>"<span>\t</span>CRUISE-CONTROL@EXAMPLE.COM "</span><span>)</span><span>.</span><span>count</span>         <span># =&gt; 1</span>
<span>User</span><span>.</span><span>where</span><span>(</span><span>[</span><span>"email = ?"</span><span>,</span> <span>"<span>\t</span>CRUISE-CONTROL@EXAMPLE.COM "</span><span>]</span><span>)</span><span>.</span><span>count</span> <span># =&gt; 0</span>

<span>User</span><span>.</span><span>exists?</span><span>(</span><span>email</span>: <span>"<span>\t</span>CRUISE-CONTROL@EXAMPLE.COM "</span><span>)</span>         <span># =&gt; true</span>
<span>User</span><span>.</span><span>exists?</span><span>(</span><span>[</span><span>"email = ?"</span><span>,</span> <span>"<span>\t</span>CRUISE-CONTROL@EXAMPLE.COM "</span><span>]</span><span>)</span> <span># =&gt; false</span>

<span>User</span><span>.</span><span>normalize_value_for</span><span>(</span><span>:phone</span><span>,</span> <span>"+1 (555) 867-5309"</span><span>)</span> <span># =&gt; "5558675309"</span></pre></div>
<p><em>Jonathan Hefner</em></p>
</li>
<li>
<p>Hide changes to before_committed! callback behaviour behind flag.</p>
<p>In <a data-error-text="Failed to load title" data-id="1456102052" data-permission-text="Title is private" data-url="https://github.com/rails/rails/issues/46525" data-hovercard-type="pull_request" data-hovercard-url="/rails/rails/pull/46525/hovercard" href="https://github.com/rails/rails/pull/46525">#46525</a>, behavior around before_committed! callbacks was changed so that callbacks<br>
would run on every enrolled record in a transaction, not just the first copy of a record.<br>
This change in behavior is now controlled by a configuration option,<br>
<code>config.active_record.before_committed_on_all_records</code>. It will be enabled by default on Rails 7.1.</p>
<p><em>Adrianna Chang</em></p>
</li>
<li>
<p>The <code>namespaced_controller</code> Query Log tag now matches the <code>controller</code> format</p>
<p>For example, a request processed by <code>NameSpaced::UsersController</code> will now log as:</p>
<div data-snippet-clipboard-copy-content=":controller # &quot;users&quot;
:namespaced_controller # &quot;name_spaced/users&quot;"><pre><code>:controller # "users"
:namespaced_controller # "name_spaced/users"
</code></pre></div>
<p><em>Alex Ghiculescu</em></p>
</li>
<li>
<p>Return only unique ids from ActiveRecord::Calculations#ids</p>
<p>Updated ActiveRecord::Calculations#ids to only return the unique ids of the base model<br>
when using eager_load, preload and includes.</p>
<div data-snippet-clipboard-copy-content="Post.find_by(id: 1).comments.count
# => 5
Post.includes(:comments).where(id: 1).pluck(:id)
# => [1, 1, 1, 1, 1]
Post.includes(:comments).where(id: 1).ids
# => [1]"><pre><span>Post</span><span>.</span><span>find_by</span><span>(</span><span>id</span>: <span>1</span><span>)</span><span>.</span><span>comments</span><span>.</span><span>count</span>
<span># =&gt; 5</span>
<span>Post</span><span>.</span><span>includes</span><span>(</span><span>:comments</span><span>)</span><span>.</span><span>where</span><span>(</span><span>id</span>: <span>1</span><span>)</span><span>.</span><span>pluck</span><span>(</span><span>:id</span><span>)</span>
<span># =&gt; [1, 1, 1, 1, 1]</span>
<span>Post</span><span>.</span><span>includes</span><span>(</span><span>:comments</span><span>)</span><span>.</span><span>where</span><span>(</span><span>id</span>: <span>1</span><span>)</span><span>.</span><span>ids</span>
<span># =&gt; [1]</span></pre></div>
<p><em>Joshua Young</em></p>
</li>
<li>
<p>Stop using <code>LOWER()</code> for case-insensitive queries on <code>citext</code> columns</p>
<p>Previously, <code>LOWER()</code> was added for e.g. uniqueness validations with<br>
<code>case_sensitive: false</code>.<br>
It wasn't mentioned in the documentation that the index without <code>LOWER()</code><br>
wouldn't be used in this case.</p>
<p><em>Phil Pirozhkov</em></p>
</li>
<li>
<p>Extract <code>#sync_timezone_changes</code> method in AbstractMysqlAdapter to enable subclasses<br>
to sync database timezone changes without overriding <code>#raw_execute</code>.</p>
<p><em>Adrianna Chang</em>, <em>Paarth Madan</em></p>
</li>
<li>
<p>Do not write additional new lines when dumping sql migration versions</p>
<p>This change updates the <code>insert_versions_sql</code> function so that the database insert string containing the current database migration versions does not end with two additional new lines.</p>
<p><em>Misha Schwartz</em></p>
</li>
<li>
<p>Fix <code>composed_of</code> value freezing and duplication.</p>
<p>Previously composite values exhibited two confusing behaviors:</p>
<ul>
<li>When reading a compositve value it'd <em>NOT</em> be frozen, allowing it to get out of sync with its underlying database<br>
columns.</li>
<li>When writing a compositve value the argument would be frozen, potentially confusing the caller.</li>
</ul>
<p>Currently, composite values instantiated based on database columns are frozen (addressing the first issue) and<br>
assigned compositve values are duplicated and the duplicate is frozen (addressing the second issue).</p>
<p><em>Greg Navis</em></p>
</li>
<li>
<p>Fix redundant updates to the column insensitivity cache</p>
<p>Fixed redundant queries checking column capability for insensitive<br>
comparison.</p>
<p><em>Phil Pirozhkov</em></p>
</li>
<li>
<p>Allow disabling methods generated by <code>ActiveRecord.enum</code>.</p>
<p><em>Alfred Dominic</em></p>
</li>
<li>
<p>Avoid validating <code>belongs_to</code> association if it has not changed.</p>
<p>Previously, when updating a record, Active Record will perform an extra query to check for the presence of<br>
<code>belongs_to</code> associations (if the presence is configured to be mandatory), even if that attribute hasn't changed.</p>
<p>Currently, only <code>belongs_to</code>-related columns are checked for presence. It is possible to have orphaned records with<br>
this approach. To avoid this problem, you need to use a foreign key.</p>
<p>This behavior can be controlled by configuration:</p>
<div data-snippet-clipboard-copy-content="config.active_record.belongs_to_required_validates_foreign_key = false"><pre><span>config</span><span>.</span><span>active_record</span><span>.</span><span>belongs_to_required_validates_foreign_key</span> <span>=</span> <span>false</span></pre></div>
<p>and will be disabled by default with <code>config.load_defaults 7.1</code>.</p>
<p><em>fatkodima</em></p>
</li>
<li>
<p><code>has_one</code> and <code>belongs_to</code> associations now define a <code>reset_association</code> method<br>
on the owner model (where <code>association</code> is the name of the association). This<br>
method unloads the cached associate record, if any, and causes the next access<br>
to query it from the database.</p>
<p><em>George Claghorn</em></p>
</li>
<li>
<p>Allow per attribute setting of YAML permitted classes (safe load) and unsafe load.</p>
<p><em>Carlos Palhares</em></p>
</li>
<li>
<p>Add a build persistence method</p>
<p>Provides a wrapper for <code>new</code>, to provide feature parity with <code>create</code>s<br>
ability to create multiple records from an array of hashes, using the<br>
same notation as the <code>build</code> method on associations.</p>
<p><em>Sean Denny</em></p>
</li>
<li>
<p>Raise on assignment to readonly attributes</p>
<div data-snippet-clipboard-copy-content="class Post < ActiveRecord::Base
  attr_readonly :content
end
Post.create!(content: &quot;cannot be updated&quot;)
post.content # &quot;cannot be updated&quot;
post.content = &quot;something else&quot; # => ActiveRecord::ReadonlyAttributeError"><pre><span>class</span> <span>Post</span> &lt; <span>ActiveRecord</span>::<span>Base</span>
  <span>attr_readonly</span> <span>:content</span>
<span>end</span>
<span>Post</span><span>.</span><span>create!</span><span>(</span><span>content</span>: <span>"cannot be updated"</span><span>)</span>
<span>post</span><span>.</span><span>content</span> <span># "cannot be updated"</span>
<span>post</span><span>.</span><span>content</span> <span>=</span> <span>"something else"</span> <span># =&gt; ActiveRecord::ReadonlyAttributeError</span></pre></div>
<p>Previously, assignment would succeed but silently not write to the database.</p>
<p>This behavior can be controlled by configuration:</p>
<div data-snippet-clipboard-copy-content="config.active_record.raise_on_assign_to_attr_readonly = true"><pre><span>config</span><span>.</span><span>active_record</span><span>.</span><span>raise_on_assign_to_attr_readonly</span> <span>=</span> <span>true</span></pre></div>
<p>and will be enabled by default with <code>config.load_defaults 7.1</code>.</p>
<p><em>Alex Ghiculescu</em>, <em>Hartley McGuire</em></p>
</li>
<li>
<p>Allow unscoping of preload and eager_load associations</p>
<p>Added the ability to unscope preload and eager_load associations just like<br>
includes, joins, etc. See ActiveRecord::QueryMethods::VALID_UNSCOPING_VALUES<br>
for the full list of supported unscopable scopes.</p>
<div data-snippet-clipboard-copy-content="query.unscope(:eager_load, :preload).group(:id).select(:id)"><pre><span>query</span><span>.</span><span>unscope</span><span>(</span><span>:eager_load</span><span>,</span> <span>:preload</span><span>)</span><span>.</span><span>group</span><span>(</span><span>:id</span><span>)</span><span>.</span><span>select</span><span>(</span><span>:id</span><span>)</span></pre></div>
<p><em>David Morehouse</em></p>
</li>
<li>
<p>Add automatic filtering of encrypted attributes on inspect</p>
<p>This feature is enabled by default but can be disabled with</p>
<div data-snippet-clipboard-copy-content="config.active_record.encryption.add_to_filter_parameters = false"><pre><span>config</span><span>.</span><span>active_record</span><span>.</span><span>encryption</span><span>.</span><span>add_to_filter_parameters</span> <span>=</span> <span>false</span></pre></div>
<p><em>Hartley McGuire</em></p>
</li>
<li>
<p>Clear locking column on #dup</p>
<p>This change fixes not to duplicate locking_column like id and timestamps.</p>
<div data-snippet-clipboard-copy-content="car = Car.create!
car.touch
car.lock_version #=> 1
car.dup.lock_version #=> 0"><pre><code>car = Car.create!
car.touch
car.lock_version #=&gt; 1
car.dup.lock_version #=&gt; 0
</code></pre></div>
<p><em>Shouichi Kamiya</em>, <em>Seonggi Yang</em>, <em>Ryohei UEDA</em></p>
</li>
<li>
<p>Invalidate transaction as early as possible</p>
<p>After rescuing a <code>TransactionRollbackError</code> exception Rails invalidates transactions earlier in the flow<br>
allowing the framework to skip issuing the <code>ROLLBACK</code> statement in more cases.<br>
Only affects adapters that have <code>savepoint_errors_invalidate_transactions?</code> configured as <code>true</code>,<br>
which at this point is only applicable to the <code>mysql2</code> adapter.</p>
<p><em>Nikita Vasilevsky</em></p>
</li>
<li>
<p>Allow configuring columns list to be used in SQL queries issued by an <code>ActiveRecord::Base</code> object</p>
<p>It is now possible to configure columns list that will be used to build an SQL query clauses when<br>
updating, deleting or reloading an <code>ActiveRecord::Base</code> object</p>
<div data-snippet-clipboard-copy-content="class Developer < ActiveRecord::Base
  query_constraints :company_id, :id
end
developer = Developer.first.update(name: &quot;Bob&quot;)
# => UPDATE &quot;developers&quot; SET &quot;name&quot; = 'Bob' WHERE &quot;developers&quot;.&quot;company_id&quot; = 1 AND &quot;developers&quot;.&quot;id&quot; = 1"><pre><span>class</span> <span>Developer</span> &lt; <span>ActiveRecord</span>::<span>Base</span>
  <span>query_constraints</span> <span>:company_id</span><span>,</span> <span>:id</span>
<span>end</span>
<span>developer</span> <span>=</span> <span>Developer</span><span>.</span><span>first</span><span>.</span><span>update</span><span>(</span><span>name</span>: <span>"Bob"</span><span>)</span>
<span># =&gt; UPDATE "developers" SET "name" = 'Bob' WHERE "developers"."company_id" = 1 AND "developers"."id" = 1</span></pre></div>
<p><em>Nikita Vasilevsky</em></p>
</li>
<li>
<p>Adds <code>validate</code> to foreign keys and check constraints in schema.rb</p>
<p>Previously, <code>schema.rb</code> would not record if <code>validate: false</code> had been used when adding a foreign key or check<br>
constraint, so restoring a database from the schema could result in foreign keys or check constraints being<br>
incorrectly validated.</p>
<p><em>Tommy Graves</em></p>
</li>
<li>
<p>Adapter <code>#execute</code> methods now accept an <code>allow_retry</code> option. When set to <code>true</code>, the SQL statement will be<br>
retried, up to the database's configured <code>connection_retries</code> value, upon encountering connection-related errors.</p>
<p><em>Adrianna Chang</em></p>
</li>
<li>
<p>Only trigger <code>after_commit :destroy</code> callbacks when a database row is deleted.</p>
<p>This prevents <code>after_commit :destroy</code> callbacks from being triggered again<br>
when <code>destroy</code> is called multiple times on the same record.</p>
<p><em>Ben Sheldon</em></p>
</li>
<li>
<p>Fix <code>ciphertext_for</code> for yet-to-be-encrypted values.</p>
<p>Previously, <code>ciphertext_for</code> returned the cleartext of values that had not<br>
yet been encrypted, such as with an unpersisted record:</p>
<div data-snippet-clipboard-copy-content="Post.encrypts :body

post = Post.create!(body: &quot;Hello&quot;)
post.ciphertext_for(:body)
# => &quot;{\&quot;p\&quot;:\&quot;abc...&quot;

post.body = &quot;World&quot;
post.ciphertext_for(:body)
# => &quot;World&quot;"><pre><span>Post</span><span>.</span><span>encrypts</span> <span>:body</span>

<span>post</span> <span>=</span> <span>Post</span><span>.</span><span>create!</span><span>(</span><span>body</span>: <span>"Hello"</span><span>)</span>
<span>post</span><span>.</span><span>ciphertext_for</span><span>(</span><span>:body</span><span>)</span>
<span># =&gt; "{\"p\":\"abc..."</span>

<span>post</span><span>.</span><span>body</span> <span>=</span> <span>"World"</span>
<span>post</span><span>.</span><span>ciphertext_for</span><span>(</span><span>:body</span><span>)</span>
<span># =&gt; "World"</span></pre></div>
<p>Now, <code>ciphertext_for</code> will always return the ciphertext of encrypted<br>
attributes:</p>
<div data-snippet-clipboard-copy-content="Post.encrypts :body

post = Post.create!(body: &quot;Hello&quot;)
post.ciphertext_for(:body)
# => &quot;{\&quot;p\&quot;:\&quot;abc...&quot;

post.body = &quot;World&quot;
post.ciphertext_for(:body)
# => &quot;{\&quot;p\&quot;:\&quot;xyz...&quot;"><pre><span>Post</span><span>.</span><span>encrypts</span> <span>:body</span>

<span>post</span> <span>=</span> <span>Post</span><span>.</span><span>create!</span><span>(</span><span>body</span>: <span>"Hello"</span><span>)</span>
<span>post</span><span>.</span><span>ciphertext_for</span><span>(</span><span>:body</span><span>)</span>
<span># =&gt; "{\"p\":\"abc..."</span>

<span>post</span><span>.</span><span>body</span> <span>=</span> <span>"World"</span>
<span>post</span><span>.</span><span>ciphertext_for</span><span>(</span><span>:body</span><span>)</span>
<span># =&gt; "{\"p\":\"xyz..."</span></pre></div>
<p><em>Jonathan Hefner</em></p>
</li>
<li>
<p>Fix a bug where using groups and counts with long table names would return incorrect results.</p>
<p><em>Shota Toguchi</em>, <em>Yusaku Ono</em></p>
</li>
<li>
<p>Fix encryption of column default values.</p>
<p>Previously, encrypted attributes that used column default values appeared to<br>
be encrypted on create, but were not:</p>
<div data-snippet-clipboard-copy-content="Book.encrypts :name

book = Book.create!
book.name
# => &quot;<untitled>&quot;
book.name_before_type_cast
# => &quot;{\&quot;p\&quot;:\&quot;abc...&quot;
book.reload.name_before_type_cast
# => &quot;<untitled>&quot;"><pre><span>Book</span><span>.</span><span>encrypts</span> <span>:name</span>

<span>book</span> <span>=</span> <span>Book</span><span>.</span><span>create!</span>
<span>book</span><span>.</span><span>name</span>
<span># =&gt; "&lt;untitled&gt;"</span>
<span>book</span><span>.</span><span>name_before_type_cast</span>
<span># =&gt; "{\"p\":\"abc..."</span>
<span>book</span><span>.</span><span>reload</span><span>.</span><span>name_before_type_cast</span>
<span># =&gt; "&lt;untitled&gt;"</span></pre></div>
<p>Now, attributes with column default values are encrypted:</p>
<div data-snippet-clipboard-copy-content="Book.encrypts :name

book = Book.create!
book.name
# => &quot;<untitled>&quot;
book.name_before_type_cast
# => &quot;{\&quot;p\&quot;:\&quot;abc...&quot;
book.reload.name_before_type_cast
# => &quot;{\&quot;p\&quot;:\&quot;abc...&quot;"><pre><span>Book</span><span>.</span><span>encrypts</span> <span>:name</span>

<span>book</span> <span>=</span> <span>Book</span><span>.</span><span>create!</span>
<span>book</span><span>.</span><span>name</span>
<span># =&gt; "&lt;untitled&gt;"</span>
<span>book</span><span>.</span><span>name_before_type_cast</span>
<span># =&gt; "{\"p\":\"abc..."</span>
<span>book</span><span>.</span><span>reload</span><span>.</span><span>name_before_type_cast</span>
<span># =&gt; "{\"p\":\"abc..."</span></pre></div>
<p><em>Jonathan Hefner</em></p>
</li>
<li>
<p>Deprecate delegation from <code>Base</code> to <code>connection_handler</code>.</p>
<p>Calling <code>Base.clear_all_connections!</code>, <code>Base.clear_active_connections!</code>, <code>Base.clear_reloadable_connections!</code> and <code>Base.flush_idle_connections!</code> is deprecated. Please call these methods on the connection handler directly. In future Rails versions, the delegation from <code>Base</code> to the <code>connection_handler</code> will be removed.</p>
<p><em>Eileen M. Uchitelle</em></p>
</li>
<li>
<p>Allow ActiveRecord::QueryMethods#reselect to receive hash values, similar to ActiveRecord::QueryMethods#select</p>
<p><em>Sampat Badhe</em></p>
</li>
<li>
<p>Validate options when managing columns and tables in migrations.</p>
<p>If an invalid option is passed to a migration method like <code>create_table</code> and <code>add_column</code>, an error will be raised<br>
instead of the option being silently ignored. Validation of the options will only be applied for new migrations<br>
that are created.</p>
<p><em>Guo Xiang Tan</em>, <em>George Wambold</em></p>
</li>
<li>
<p>Update query log tags to use the <a href="https://open-telemetry.github.io/opentelemetry-sqlcommenter/" rel="nofollow">SQLCommenter</a> format by default. See <a href="https://github.com/rails/rails/issues/46179" data-hovercard-type="issue" data-hovercard-url="/rails/rails/issues/46179/hovercard">#46179</a></p>
<p>To opt out of SQLCommenter-formatted query log tags, set <code>config.active_record.query_log_tags_format = :legacy</code>. By default, this is set to <code>:sqlcommenter</code>.</p>
<p><em>Modulitos</em> and <em>Iheanyi</em></p>
</li>
<li>
<p>Allow any ERB in the database.yml when creating rake tasks.</p>
<p>Any ERB can be used in <code>database.yml</code> even if it accesses environment<br>
configurations.</p>
<p>Deprecates <code>config.active_record.suppress_multiple_database_warning</code>.</p>
<p><em>Eike Send</em></p>
</li>
<li>
<p>Add table to error for duplicate column definitions.</p>
<p>If a migration defines duplicate columns for a table, the error message<br>
shows which table it concerns.</p>
<p><em>Petrik de Heus</em></p>
</li>
<li>
<p>Fix erroneous nil default precision on virtual datetime columns.</p>
<p>Prior to this change, virtual datetime columns did not have the same<br>
default precision as regular datetime columns, resulting in the following<br>
being erroneously equivalent:</p>
<div data-snippet-clipboard-copy-content="t.virtual :name, type: datetime,                 as: &quot;expression&quot;
t.virtual :name, type: datetime, precision: nil, as: &quot;expression&quot;"><pre><code>t.virtual :name, type: datetime,                 as: "expression"
t.virtual :name, type: datetime, precision: nil, as: "expression"
</code></pre></div>
<p>This change fixes the default precision lookup, so virtual and regular<br>
datetime column default precisions match.</p>
<p><em>Sam Bostock</em></p>
</li>
<li>
<p>Use connection from <code>#with_raw_connection</code> in <code>#quote_string</code>.</p>
<p>This ensures that the string quoting is wrapped in the reconnect and retry logic<br>
that <code>#with_raw_connection</code> offers.</p>
<p><em>Adrianna Chang</em></p>
</li>
<li>
<p>Add <code>expires_at</code> option to <code>signed_id</code>.</p>
<p><em>Shouichi Kamiya</em></p>
</li>
<li>
<p>Allow applications to set retry deadline for query retries.</p>
<p>Building on the work done in <a data-error-text="Failed to load title" data-id="1154273875" data-permission-text="Title is private" data-url="https://github.com/rails/rails/issues/44576" data-hovercard-type="pull_request" data-hovercard-url="/rails/rails/pull/44576/hovercard" href="https://github.com/rails/rails/pull/44576">#44576</a> and <a data-error-text="Failed to load title" data-id="1155775285" data-permission-text="Title is private" data-url="https://github.com/rails/rails/issues/44591" data-hovercard-type="pull_request" data-hovercard-url="/rails/rails/pull/44591/hovercard" href="https://github.com/rails/rails/pull/44591">#44591</a>, we extend the logic that automatically<br>
reconnects database connections to take into account a timeout limit. We won't retry<br>
a query if a given amount of time has elapsed since the query was first attempted. This<br>
value defaults to nil, meaning that all retryable queries are retried regardless of time elapsed,<br>
but this can be changed via the <code>retry_deadline</code> option in the database config.</p>
<p><em>Adrianna Chang</em></p>
</li>
<li>
<p>Fix a case where the query cache can return wrong values. See <a data-error-text="Failed to load title" data-id="1374793684" data-permission-text="Title is private" data-url="https://github.com/rails/rails/issues/46044" data-hovercard-type="issue" data-hovercard-url="/rails/rails/issues/46044/hovercard" href="https://github.com/rails/rails/issues/46044">#46044</a></p>
<p><em>Aaron Patterson</em></p>
</li>
<li>
<p>Support MySQL's ssl-mode option for MySQLDatabaseTasks.</p>
<p>Verifying the identity of the database server requires setting the ssl-mode<br>
option to VERIFY_CA or VERIFY_IDENTITY. This option was previously ignored<br>
for MySQL database tasks like creating a database and dumping the structure.</p>
<p><em>Petrik de Heus</em></p>
</li>
<li>
<p>Move <code>ActiveRecord::InternalMetadata</code> to an independent object.</p>
<p><code>ActiveRecord::InternalMetadata</code> no longer inherits from <code>ActiveRecord::Base</code> and is now an independent object that should be instantiated with a <code>connection</code>. This class is private and should not be used by applications directly. If you want to interact with the schema migrations table, please access it on the connection directly, for example: <code>ActiveRecord::Base.connection.schema_migration</code>.</p>
<p><em>Eileen M. Uchitelle</em></p>
</li>
<li>
<p>Deprecate quoting <code>ActiveSupport::Duration</code> as an integer</p>
<p>Using ActiveSupport::Duration as an interpolated bind parameter in a SQL<br>
string template is deprecated. To avoid this warning, you should explicitly<br>
convert the duration to a more specific database type. For example, if you<br>
want to use a duration as an integer number of seconds:</p>
<div data-snippet-clipboard-copy-content="Record.where(&quot;duration = ?&quot;, 1.hour.to_i)"><pre><code>Record.where("duration = ?", 1.hour.to_i)
</code></pre></div>
<p>If you want to use a duration as an ISO 8601 string:</p>
<div data-snippet-clipboard-copy-content="Record.where(&quot;duration = ?&quot;, 1.hour.iso8601)"><pre><code>Record.where("duration = ?", 1.hour.iso8601)
</code></pre></div>
<p><em>Aram Greenman</em></p>
</li>
<li>
<p>Allow <code>QueryMethods#in_order_of</code> to order by a string column name.</p>
<div data-snippet-clipboard-copy-content="Post.in_order_of(&quot;id&quot;, [4,2,3,1]).to_a
Post.joins(:author).in_order_of(&quot;authors.name&quot;, [&quot;Bob&quot;, &quot;Anna&quot;, &quot;John&quot;]).to_a"><pre><span>Post</span><span>.</span><span>in_order_of</span><span>(</span><span>"id"</span><span>,</span> <span>[</span><span>4</span><span>,</span><span>2</span><span>,</span><span>3</span><span>,</span><span>1</span><span>]</span><span>)</span><span>.</span><span>to_a</span>
<span>Post</span><span>.</span><span>joins</span><span>(</span><span>:author</span><span>)</span><span>.</span><span>in_order_of</span><span>(</span><span>"authors.name"</span><span>,</span> <span>[</span><span>"Bob"</span><span>,</span> <span>"Anna"</span><span>,</span> <span>"John"</span><span>]</span><span>)</span><span>.</span><span>to_a</span></pre></div>
<p><em>Igor Kasyanchuk</em></p>
</li>
<li>
<p>Move <code>ActiveRecord::SchemaMigration</code> to an independent object.</p>
<p><code>ActiveRecord::SchemaMigration</code> no longer inherits from <code>ActiveRecord::Base</code> and is now an independent object that should be instantiated with a <code>connection</code>. This class is private and should not be used by applications directly. If you want to interact with the schema migrations table, please access it on the connection directly, for example: <code>ActiveRecord::Base.connection.schema_migration</code>.</p>
<p><em>Eileen M. Uchitelle</em></p>
</li>
<li>
<p>Deprecate <code>all_connection_pools</code> and make <code>connection_pool_list</code> more explicit.</p>
<p>Following on <a data-error-text="Failed to load title" data-id="1359250964" data-permission-text="Title is private" data-url="https://github.com/rails/rails/issues/45924" data-hovercard-type="pull_request" data-hovercard-url="/rails/rails/pull/45924/hovercard" href="https://github.com/rails/rails/pull/45924">#45924</a> <code>all_connection_pools</code> is now deprecated. <code>connection_pool_list</code> will either take an explicit role or applications can opt into the new behavior by passing <code>:all</code>.</p>
<p><em>Eileen M. Uchitelle</em></p>
</li>
<li>
<p>Fix connection handler methods to operate on all pools.</p>
<p><code>active_connections?</code>, <code>clear_active_connections!</code>, <code>clear_reloadable_connections!</code>, <code>clear_all_connections!</code>, and <code>flush_idle_connections!</code> now operate on all pools by default. Previously they would default to using the <code>current_role</code> or <code>:writing</code> role unless specified.</p>
<p><em>Eileen M. Uchitelle</em></p>
</li>
<li>
<p>Allow ActiveRecord::QueryMethods#select to receive hash values.</p>
<p>Currently, <code>select</code> might receive only raw sql and symbols to define columns and aliases to select.</p>
<p>With this change we can provide <code>hash</code> as argument, for example:</p>
<div data-snippet-clipboard-copy-content="Post.joins(:comments).select(posts: [:id, :title, :created_at], comments: [:id, :body, :author_id])
#=> &quot;SELECT \&quot;posts\&quot;.\&quot;id\&quot;, \&quot;posts\&quot;.\&quot;title\&quot;, \&quot;posts\&quot;.\&quot;created_at\&quot;, \&quot;comments\&quot;.\&quot;id\&quot;, \&quot;comments\&quot;.\&quot;body\&quot;, \&quot;comments\&quot;.\&quot;author_id\&quot;
#   FROM \&quot;posts\&quot; INNER JOIN \&quot;comments\&quot; ON \&quot;comments\&quot;.\&quot;post_id\&quot; = \&quot;posts\&quot;.\&quot;id\&quot;&quot;

Post.joins(:comments).select(posts: { id: :post_id, title: :post_title }, comments: { id: :comment_id, body: :comment_body })
#=> &quot;SELECT posts.id as post_id, posts.title as post_title, comments.id as comment_id, comments.body as comment_body
#    FROM \&quot;posts\&quot; INNER JOIN \&quot;comments\&quot; ON \&quot;comments\&quot;.\&quot;post_id\&quot; = \&quot;posts\&quot;.\&quot;id\&quot;&quot;"><pre><span>Post</span><span>.</span><span>joins</span><span>(</span><span>:comments</span><span>)</span><span>.</span><span>select</span><span>(</span><span>posts</span>: <span>[</span><span>:id</span><span>,</span> <span>:title</span><span>,</span> <span>:created_at</span><span>]</span><span>,</span> <span>comments</span>: <span>[</span><span>:id</span><span>,</span> <span>:body</span><span>,</span> <span>:author_id</span><span>]</span><span>)</span>
<span>#=&gt; "SELECT \"posts\".\"id\", \"posts\".\"title\", \"posts\".\"created_at\", \"comments\".\"id\", \"comments\".\"body\", \"comments\".\"author_id\"</span>
<span>#   FROM \"posts\" INNER JOIN \"comments\" ON \"comments\".\"post_id\" = \"posts\".\"id\""</span>

<span>Post</span><span>.</span><span>joins</span><span>(</span><span>:comments</span><span>)</span><span>.</span><span>select</span><span>(</span><span>posts</span>: <span>{</span> <span>id</span>: <span>:post_id</span><span>,</span> <span>title</span>: <span>:post_title</span> <span>}</span><span>,</span> <span>comments</span>: <span>{</span> <span>id</span>: <span>:comment_id</span><span>,</span> <span>body</span>: <span>:comment_body</span> <span>}</span><span>)</span>
<span>#=&gt; "SELECT posts.id as post_id, posts.title as post_title, comments.id as comment_id, comments.body as comment_body</span>
<span>#    FROM \"posts\" INNER JOIN \"comments\" ON \"comments\".\"post_id\" = \"posts\".\"id\""</span></pre></div>
<p><em>Oleksandr Holubenko</em>, <em>Josef Šimánek</em>, <em>Jean Boussier</em></p>
</li>
<li>
<p>Adapts virtual attributes on <code>ActiveRecord::Persistence#becomes</code>.</p>
<p>When source and target classes have a different set of attributes adapts<br>
attributes such that the extra attributes from target are added.</p>
<div data-snippet-clipboard-copy-content="class Person < ApplicationRecord
end

class WebUser < Person
  attribute :is_admin, :boolean
  after_initialize :set_admin

  def set_admin
    write_attribute(:is_admin, email =~ /@ourcompany\.com$/)
  end
end

person = Person.find_by(email: &quot;email@ourcompany.com&quot;)
person.respond_to? :is_admin
# => false
person.becomes(WebUser).is_admin?
# => true"><pre><span>class</span> <span>Person</span> &lt; <span>ApplicationRecord</span>
<span>end</span>

<span>class</span> <span>WebUser</span> &lt; <span>Person</span>
  <span>attribute</span> <span>:is_admin</span><span>,</span> <span>:boolean</span>
  <span>after_initialize</span> <span>:set_admin</span>

  <span>def</span> <span>set_admin</span>
    <span>write_attribute</span><span>(</span><span>:is_admin</span><span>,</span> <span>email</span> =~ <span>/@ourcompany<span>\.</span>com$/</span><span>)</span>
  <span>end</span>
<span>end</span>

<span>person</span> <span>=</span> <span>Person</span><span>.</span><span>find_by</span><span>(</span><span>email</span>: <span>"email@ourcompany.com"</span><span>)</span>
<span>person</span><span>.</span><span>respond_to?</span> <span>:is_admin</span>
<span># =&gt; false</span>
<span>person</span><span>.</span><span>becomes</span><span>(</span><span>WebUser</span><span>)</span><span>.</span><span>is_admin?</span>
<span># =&gt; true</span></pre></div>
<p><em>Jacopo Beschi</em>, <em>Sampson Crowley</em></p>
</li>
<li>
<p>Fix <code>ActiveRecord::QueryMethods#in_order_of</code> to include <code>nil</code>s, to match the<br>
behavior of <code>Enumerable#in_order_of</code>.</p>
<p>For example, <code>Post.in_order_of(:title, [nil, "foo"])</code> will now include posts<br>
with <code>nil</code> titles, the same as <code>Post.all.to_a.in_order_of(:title, [nil, "foo"])</code>.</p>
<p><em>fatkodima</em></p>
</li>
<li>
<p>Optimize <code>add_timestamps</code> to use a single SQL statement.</p>

<p>Now results in the following SQL:</p>
<div data-snippet-clipboard-copy-content="ALTER TABLE &quot;my_table&quot; ADD COLUMN &quot;created_at&quot; datetime(6) NOT NULL, ADD COLUMN &quot;updated_at&quot; datetime(6) NOT NULL"><pre><span>ALTER</span> <span>TABLE</span> <span><span>"</span>my_table<span>"</span></span> ADD COLUMN <span><span>"</span>created_at<span>"</span></span> datetime(<span>6</span>) <span>NOT NULL</span>, ADD COLUMN <span><span>"</span>updated_at<span>"</span></span> datetime(<span>6</span>) <span>NOT NULL</span></pre></div>
<p><em>Iliana Hadzhiatanasova</em></p>
</li>
<li>
<p>Add <code>drop_enum</code> migration command for PostgreSQL</p>
<p>This does the inverse of <code>create_enum</code>. Before dropping an enum, ensure you have<br>
dropped columns that depend on it.</p>
<p><em>Alex Ghiculescu</em></p>
</li>
<li>
<p>Adds support for <code>if_exists</code> option when removing a check constraint.</p>
<p>The <code>remove_check_constraint</code> method now accepts an <code>if_exists</code> option. If set<br>
to true an error won't be raised if the check constraint doesn't exist.</p>
<p><em>Margaret Parsa</em> and <em>Aditya Bhutani</em></p>
</li>
<li>
<p><code>find_or_create_by</code> now try to find a second time if it hits a unicity constraint.</p>
<p><code>find_or_create_by</code> always has been inherently racy, either creating multiple<br>
duplicate records or failing with <code>ActiveRecord::RecordNotUnique</code> depending on<br>
whether a proper unicity constraint was set.</p>
<p><code>create_or_find_by</code> was introduced for this use case, however it's quite wasteful<br>
when the record is expected to exist most of the time, as INSERT require to send<br>
more data than SELECT and require more work from the database. Also on some<br>
databases it can actually consume a primary key increment which is undesirable.</p>
<p>So for case where most of the time the record is expected to exist, <code>find_or_create_by</code><br>
can be made race-condition free by re-trying the <code>find</code> if the <code>create</code> failed<br>
with <code>ActiveRecord::RecordNotUnique</code>. This assumes that the table has the proper<br>
unicity constraints, if not, <code>find_or_create_by</code> will still lead to duplicated records.</p>
<p><em>Jean Boussier</em>, <em>Alex Kitchens</em></p>
</li>
<li>
<p>Introduce a simpler constructor API for ActiveRecord database adapters.</p>
<p>Previously the adapter had to know how to build a new raw connection to<br>
support reconnect, but also expected to be passed an initial already-<br>
established connection.</p>
<p>When manually creating an adapter instance, it will now accept a single<br>
config hash, and only establish the real connection on demand.</p>
<p><em>Matthew Draper</em></p>
</li>
<li>
<p>Avoid redundant <code>SELECT 1</code> connection-validation query during DB pool<br>
checkout when possible.</p>
<p>If the first query run during a request is known to be idempotent, it can be<br>
used directly to validate the connection, saving a network round-trip.</p>
<p><em>Matthew Draper</em></p>
</li>
<li>
<p>Automatically reconnect broken database connections when safe, even<br>
mid-request.</p>
<p>When an error occurs while attempting to run a known-idempotent query, and<br>
not inside a transaction, it is safe to immediately reconnect to the<br>
database server and try again, so this is now the default behavior.</p>
<p>This new default should always be safe -- to support that, it's consciously<br>
conservative about which queries are considered idempotent -- but if<br>
necessary it can be disabled by setting the <code>connection_retries</code> connection<br>
option to <code>0</code>.</p>
<p><em>Matthew Draper</em></p>
</li>
<li>
<p>Avoid removing a PostgreSQL extension when there are dependent objects.</p>
<p>Previously, removing an extension also implicitly removed dependent objects. Now, this will raise an error.</p>
<p>You can force removing the extension:</p>
<div data-snippet-clipboard-copy-content="disable_extension :citext, force: :cascade"><pre><span>disable_extension</span> <span>:citext</span><span>,</span> <span>force</span>: <span>:cascade</span></pre></div>
<p>Fixes <a data-error-text="Failed to load title" data-id="228722817" data-permission-text="Title is private" data-url="https://github.com/rails/rails/issues/29091" data-hovercard-type="issue" data-hovercard-url="/rails/rails/issues/29091/hovercard" href="https://github.com/rails/rails/issues/29091">#29091</a>.</p>
<p><em>fatkodima</em></p>
</li>
<li>
<p>Allow nested functions as safe SQL string</p>
<p><em>Michael Siegfried</em></p>
</li>
<li>
<p>Allow <code>destroy_association_async_job=</code> to be configured with a class string instead of a constant.</p>
<p>Defers an autoloading dependency between <code>ActiveRecord::Base</code> and <code>ActiveJob::Base</code><br>
and moves the configuration of <code>ActiveRecord::DestroyAssociationAsyncJob</code><br>
from ActiveJob to ActiveRecord.</p>
<p>Deprecates <code>ActiveRecord::ActiveJobRequiredError</code> and now raises a <code>NameError</code><br>
if the job class is unloadable or an <code>ActiveRecord::ConfigurationError</code> if<br>
<code>dependent: :destroy_async</code> is declared on an association but there is no job<br>
class configured.</p>
<p><em>Ben Sheldon</em></p>
</li>
<li>
<p>Fix <code>ActiveRecord::Store</code> to serialize as a regular Hash</p>
<p>Previously it would serialize as an <code>ActiveSupport::HashWithIndifferentAccess</code><br>
which is wasteful and cause problem with YAML safe_load.</p>
<p><em>Jean Boussier</em></p>
</li>
<li>
<p>Add <code>timestamptz</code> as a time zone aware type for PostgreSQL</p>
<p>This is required for correctly parsing <code>timestamp with time zone</code> values in your database.</p>
<p>If you don't want this, you can opt out by adding this initializer:</p>
<div data-snippet-clipboard-copy-content="ActiveRecord::Base.time_zone_aware_types -= [:timestamptz]"><pre><span>ActiveRecord</span>::<span>Base</span><span>.</span><span>time_zone_aware_types</span> -= <span>[</span><span>:timestamptz</span><span>]</span></pre></div>
<p><em>Alex Ghiculescu</em></p>
</li>
<li>
<p>Add new <code>ActiveRecord::Base.generates_token_for</code> API.</p>
<p>Currently, <code>signed_id</code> fulfills the role of generating tokens for e.g.<br>
resetting a password.  However, signed IDs cannot reflect record state, so<br>
if a token is intended to be single-use, it must be tracked in a database at<br>
least until it expires.</p>
<p>With <code>generates_token_for</code>, a token can embed data from a record.  When<br>
using the token to fetch the record, the data from the token and the current<br>
data from the record will be compared.  If the two do not match, the token<br>
will be treated as invalid, the same as if it had expired.  For example:</p>
<div data-snippet-clipboard-copy-content="class User < ActiveRecord::Base
  has_secure_password

  generates_token_for :password_reset, expires_in: 15.minutes do
    # A password's BCrypt salt changes when the password is updated.
    # By embedding (part of) the salt in a token, the token will
    # expire when the password is updated.
    BCrypt::Password.new(password_digest).salt[-10..]
  end
end

user = User.first
token = user.generate_token_for(:password_reset)

User.find_by_token_for(:password_reset, token) # => user

user.update!(password: &quot;new password&quot;)
User.find_by_token_for(:password_reset, token) # => nil"><pre><span>class</span> <span>User</span> &lt; <span>ActiveRecord</span>::<span>Base</span>
  <span>has_secure_password</span>

  <span>generates_token_for</span> <span>:password_reset</span><span>,</span> <span>expires_in</span>: <span>15</span><span>.</span><span>minutes</span> <span>do</span>
    <span># A password's BCrypt salt changes when the password is updated.</span>
    <span># By embedding (part of) the salt in a token, the token will</span>
    <span># expire when the password is updated.</span>
    <span>BCrypt</span>::<span>Password</span><span>.</span><span>new</span><span>(</span><span>password_digest</span><span>)</span><span>.</span><span>salt</span><span>[</span>-<span>10</span>..<span>]</span>
  <span>end</span>
<span>end</span>

<span>user</span> <span>=</span> <span>User</span><span>.</span><span>first</span>
<span>token</span> <span>=</span> <span>user</span><span>.</span><span>generate_token_for</span><span>(</span><span>:password_reset</span><span>)</span>

<span>User</span><span>.</span><span>find_by_token_for</span><span>(</span><span>:password_reset</span><span>,</span> <span>token</span><span>)</span> <span># =&gt; user</span>

<span>user</span><span>.</span><span>update!</span><span>(</span><span>password</span>: <span>"new password"</span><span>)</span>
<span>User</span><span>.</span><span>find_by_token_for</span><span>(</span><span>:password_reset</span><span>,</span> <span>token</span><span>)</span> <span># =&gt; nil</span></pre></div>
<p><em>Jonathan Hefner</em></p>
</li>
<li>
<p>Optimize Active Record batching for whole table iterations.</p>
<p>Previously, <code>in_batches</code> got all the ids and constructed an <code>IN</code>-based query for each batch.<br>
When iterating over the whole tables, this approach is not optimal as it loads unneeded ids and<br>
<code>IN</code> queries with lots of items are slow.</p>
<p>Now, whole table iterations use range iteration (<code>id &gt;= x AND id &lt;= y</code>) by default which can make iteration<br>
several times faster. E.g., tested on a PostgreSQL table with 10 million records: querying (<code>253s</code> vs <code>30s</code>),<br>
updating (<code>288s</code> vs <code>124s</code>), deleting (<code>268s</code> vs <code>83s</code>).</p>
<p>Only whole table iterations use this style of iteration by default. You can disable this behavior by passing <code>use_ranges: false</code>.<br>
If you iterate over the table and the only condition is, e.g., <code>archived_at: nil</code> (and only a tiny fraction<br>
of the records are archived), it makes sense to opt in to this approach:</p>
<div data-snippet-clipboard-copy-content="Project.where(archived_at: nil).in_batches(use_ranges: true) do |relation|
  # do something
end"><pre><span>Project</span><span>.</span><span>where</span><span>(</span><span>archived_at</span>: <span>nil</span><span>)</span><span>.</span><span>in_batches</span><span>(</span><span>use_ranges</span>: <span>true</span><span>)</span> <span>do</span> |<span>relation</span>|
  <span># do something</span>
<span>end</span></pre></div>
<p>See <a data-error-text="Failed to load title" data-id="1277547479" data-permission-text="Title is private" data-url="https://github.com/rails/rails/issues/45414" data-hovercard-type="pull_request" data-hovercard-url="/rails/rails/pull/45414/hovercard" href="https://github.com/rails/rails/pull/45414">#45414</a> for more details.</p>
<p><em>fatkodima</em></p>
</li>
<li>
<p><code>.with</code> query method added. Construct common table expressions with ease and get <code>ActiveRecord::Relation</code> back.</p>
<div data-snippet-clipboard-copy-content="Post.with(posts_with_comments: Post.where(&quot;comments_count > ?&quot;, 0))
# => ActiveRecord::Relation
# WITH posts_with_comments AS (SELECT * FROM posts WHERE (comments_count > 0)) SELECT * FROM posts"><pre><span>Post</span><span>.</span><span>with</span><span>(</span><span>posts_with_comments</span>: <span>Post</span><span>.</span><span>where</span><span>(</span><span>"comments_count &gt; ?"</span><span>,</span> <span>0</span><span>)</span><span>)</span>
<span># =&gt; ActiveRecord::Relation</span>
<span># WITH posts_with_comments AS (SELECT * FROM posts WHERE (comments_count &gt; 0)) SELECT * FROM posts</span></pre></div>
<p><em>Vlado Cingel</em></p>
</li>
<li>
<p>Don't establish a new connection if an identical pool exists already.</p>
<p>Previously, if <code>establish_connection</code> was called on a class that already had an established connection, the existing connection would be removed regardless of whether it was the same config. Now if a pool is found with the same values as the new connection, the existing connection will be returned instead of creating a new one.</p>
<p>This has a slight change in behavior if application code is depending on a new connection being established regardless of whether it's identical to an existing connection. If the old behavior is desirable, applications should call <code>ActiveRecord::Base#remove_connection</code> before establishing a new one. Calling <code>establish_connection</code> with a different config works the same way as it did previously.</p>
<p><em>Eileen M. Uchitelle</em></p>
</li>
<li>
<p>Update <code>db:prepare</code> task to load schema when an uninitialized database exists, and dump schema after migrations.</p>
<p><em>Ben Sheldon</em></p>
</li>
<li>
<p>Fix supporting timezone awareness for <code>tsrange</code> and <code>tstzrange</code> array columns.</p>
<div data-snippet-clipboard-copy-content="# In database migrations
add_column :shops, :open_hours, :tsrange, array: true
# In app config
ActiveRecord::Base.time_zone_aware_types += [:tsrange]
# In the code times are properly converted to app time zone
Shop.create!(open_hours: [Time.current..8.hour.from_now])"><pre><span># In database migrations</span>
<span>add_column</span> <span>:shops</span><span>,</span> <span>:open_hours</span><span>,</span> <span>:tsrange</span><span>,</span> <span>array</span>: <span>true</span>
<span># In app config</span>
<span>ActiveRecord</span>::<span>Base</span><span>.</span><span>time_zone_aware_types</span> += <span>[</span><span>:tsrange</span><span>]</span>
<span># In the code times are properly converted to app time zone</span>
<span>Shop</span><span>.</span><span>create!</span><span>(</span><span>open_hours</span>: <span>[</span><span>Time</span><span>.</span><span>current</span>..<span>8</span><span>.</span><span>hour</span><span>.</span><span>from_now</span><span>]</span><span>)</span></pre></div>
<p><em>Wojciech Wnętrzak</em></p>
</li>
<li>
<p>Introduce strategy pattern for executing migrations.</p>
<p>By default, migrations will use a strategy object that delegates the method<br>
to the connection adapter. Consumers can implement custom strategy objects<br>
to change how their migrations run.</p>
<p><em>Adrianna Chang</em></p>
</li>
<li>
<p>Add adapter option disallowing foreign keys</p>
<p>This adds a new option to be added to <code>database.yml</code> which enables skipping<br>
foreign key constraints usage even if the underlying database supports them.</p>
<p>Usage:</p>
<div data-snippet-clipboard-copy-content="development:
    <<: *default
    database: storage/development.sqlite3
    foreign_keys: false"><pre><span>development</span>:
    <span>&lt;&lt;</span>: <span>*default</span>
    <span>database</span>: <span>storage/development.sqlite3</span>
    <span>foreign_keys</span>: <span>false</span></pre></div>
<p><em>Paulo Barros</em></p>
</li>
<li>
<p>Add configurable deprecation warning for singular associations</p>
<p>This adds a deprecation warning when using the plural name of a singular associations in <code>where</code>.<br>
It is possible to opt into the new more performant behavior with <code>config.active_record.allow_deprecated_singular_associations_name = false</code></p>
<p><em>Adam Hess</em></p>
</li>
<li>
<p>Run transactional callbacks on the freshest instance to save a given<br>
record within a transaction.</p>
<p>When multiple Active Record instances change the same record within a<br>
transaction, Rails runs <code>after_commit</code> or <code>after_rollback</code> callbacks for<br>
only one of them. <code>config.active_record.run_commit_callbacks_on_first_saved_instances_in_transaction</code><br>
was added to specify how Rails chooses which instance receives the<br>
callbacks. The framework defaults were changed to use the new logic.</p>
<p>When <code>config.active_record.run_commit_callbacks_on_first_saved_instances_in_transaction</code><br>
is <code>true</code>, transactional callbacks are run on the first instance to save,<br>
even though its instance state may be stale.</p>
<p>When it is <code>false</code>, which is the new framework default starting with version<br>
7.1, transactional callbacks are run on the instances with the freshest<br>
instance state. Those instances are chosen as follows:</p>
<ul>
<li>In general, run transactional callbacks on the last instance to save a<br>
given record within the transaction.</li>
<li>There are two exceptions:
<ul>
<li>If the record is created within the transaction, then updated by<br>
another instance, <code>after_create_commit</code> callbacks will be run on the<br>
second instance. This is instead of the <code>after_update_commit</code><br>
callbacks that would naively be run based on that instance’s state.</li>
<li>If the record is destroyed within the transaction, then<br>
<code>after_destroy_commit</code> callbacks will be fired on the last destroyed<br>
instance, even if a stale instance subsequently performed an update<br>
(which will have affected 0 rows).</li>
</ul>
</li>
</ul>
<p><em>Cameron Bothner and Mitch Vollebregt</em></p>
</li>
<li>
<p>Enable strict strings mode for <code>SQLite3Adapter</code>.</p>
<p>Configures SQLite with a strict strings mode, which disables double-quoted string literals.</p>
<p>SQLite has some quirks around double-quoted string literals.<br>
It first tries to consider double-quoted strings as identifier names, but if they don't exist<br>
it then considers them as string literals. Because of this, typos can silently go unnoticed.<br>
For example, it is possible to create an index for a non existing column.<br>
See <a href="https://www.sqlite.org/quirks.html#double_quoted_string_literals_are_accepted" rel="nofollow">SQLite documentation</a> for more details.</p>
<p>If you don't want this behavior, you can disable it via:</p>
<div data-snippet-clipboard-copy-content="# config/application.rb
config.active_record.sqlite3_adapter_strict_strings_by_default = false"><pre><span># config/application.rb</span>
<span>config</span><span>.</span><span>active_record</span><span>.</span><span>sqlite3_adapter_strict_strings_by_default</span> <span>=</span> <span>false</span></pre></div>
<p>Fixes <a data-error-text="Failed to load title" data-id="202667093" data-permission-text="Title is private" data-url="https://github.com/rails/rails/issues/27782" data-hovercard-type="issue" data-hovercard-url="/rails/rails/issues/27782/hovercard" href="https://github.com/rails/rails/issues/27782">#27782</a>.</p>
<p><em>fatkodima</em>, <em>Jean Boussier</em></p>
</li>
<li>
<p>Resolve issue where a relation cache_version could be left stale.</p>
<p>Previously, when <code>reset</code> was called on a relation object it did not reset the cache_versions<br>
ivar. This led to a confusing situation where despite having the correct data the relation<br>
still reported a stale cache_version.</p>
<p>Usage:</p>
<div data-snippet-clipboard-copy-content="developers = Developer.all
developers.cache_version

Developer.update_all(updated_at: Time.now.utc + 1.second)

developers.cache_version # Stale cache_version
developers.reset
developers.cache_version # Returns the current correct cache_version"><pre><span>developers</span> <span>=</span> <span>Developer</span><span>.</span><span>all</span>
<span>developers</span><span>.</span><span>cache_version</span>

<span>Developer</span><span>.</span><span>update_all</span><span>(</span><span>updated_at</span>: <span>Time</span><span>.</span><span>now</span><span>.</span><span>utc</span> + <span>1</span><span>.</span><span>second</span><span>)</span>

<span>developers</span><span>.</span><span>cache_version</span> <span># Stale cache_version</span>
<span>developers</span><span>.</span><span>reset</span>
<span>developers</span><span>.</span><span>cache_version</span> <span># Returns the current correct cache_version</span></pre></div>
<p>Fixes <a data-error-text="Failed to load title" data-id="1269654145" data-permission-text="Title is private" data-url="https://github.com/rails/rails/issues/45341" data-hovercard-type="issue" data-hovercard-url="/rails/rails/issues/45341/hovercard" href="https://github.com/rails/rails/issues/45341">#45341</a>.</p>
<p><em>Austen Madden</em></p>
</li>
<li>
<p>Add support for exclusion constraints (PostgreSQL-only).</p>
<div data-snippet-clipboard-copy-content="add_exclusion_constraint :invoices, &quot;daterange(start_date, end_date) WITH &amp;&amp;&quot;, using: :gist, name: &quot;invoices_date_overlap&quot;
remove_exclusion_constraint :invoices, name: &quot;invoices_date_overlap&quot;"><pre><span>add_exclusion_constraint</span> <span>:invoices</span><span>,</span> <span>"daterange(start_date, end_date) WITH &amp;&amp;"</span><span>,</span> <span>using</span>: <span>:gist</span><span>,</span> <span>name</span>: <span>"invoices_date_overlap"</span>
<span>remove_exclusion_constraint</span> <span>:invoices</span><span>,</span> <span>name</span>: <span>"invoices_date_overlap"</span></pre></div>
<p>See PostgreSQL's <a href="https://www.postgresql.org/docs/12/sql-createtable.html#SQL-CREATETABLE-EXCLUDE" rel="nofollow"><code>CREATE TABLE ... EXCLUDE ...</code></a> documentation for more on exclusion constraints.</p>
<p><em>Alex Robbin</em></p>
</li>
<li>
<p><code>change_column_null</code> raises if a non-boolean argument is provided</p>
<p>Previously if you provided a non-boolean argument, <code>change_column_null</code> would<br>
treat it as truthy and make your column nullable. This could be surprising, so now<br>
the input must be either <code>true</code> or <code>false</code>.</p>
<div data-snippet-clipboard-copy-content="change_column_null :table, :column, true # good
change_column_null :table, :column, false # good
change_column_null :table, :column, from: true, to: false # raises (previously this made the column nullable)"><pre><span>change_column_null</span> <span>:table</span><span>,</span> <span>:column</span><span>,</span> <span>true</span> <span># good</span>
<span>change_column_null</span> <span>:table</span><span>,</span> <span>:column</span><span>,</span> <span>false</span> <span># good</span>
<span>change_column_null</span> <span>:table</span><span>,</span> <span>:column</span><span>,</span> <span>from</span>: <span>true</span><span>,</span> <span>to</span>: <span>false</span> <span># raises (previously this made the column nullable)</span></pre></div>
<p><em>Alex Ghiculescu</em></p>
</li>
<li>
<p>Enforce limit on table names length.</p>
<p>Fixes <a data-error-text="Failed to load title" data-id="1241820374" data-permission-text="Title is private" data-url="https://github.com/rails/rails/issues/45130" data-hovercard-type="issue" data-hovercard-url="/rails/rails/issues/45130/hovercard" href="https://github.com/rails/rails/issues/45130">#45130</a>.</p>
<p><em>fatkodima</em></p>
</li>
<li>
<p>Adjust the minimum MariaDB version for check constraints support.</p>
<p><em>Eddie Lebow</em></p>
</li>
<li>
<p>Fix Hstore deserialize regression.</p>
<p><em>edsharp</em></p>
</li>
<li>
<p>Add validity for PostgreSQL indexes.</p>
<div data-snippet-clipboard-copy-content="connection.index_exists?(:users, :email, valid: true)
connection.indexes(:users).select(&amp;:valid?)"><pre><span>connection</span><span>.</span><span>index_exists?</span><span>(</span><span>:users</span><span>,</span> <span>:email</span><span>,</span> <span>valid</span>: <span>true</span><span>)</span>
<span>connection</span><span>.</span><span>indexes</span><span>(</span><span>:users</span><span>)</span><span>.</span><span>select</span><span>(</span>&amp;<span>:valid?</span><span>)</span></pre></div>
<p><em>fatkodima</em></p>
</li>
<li>
<p>Fix eager loading for models without primary keys.</p>
<p><em>Anmol Chopra</em>, <em>Matt Lawrence</em>, and <em>Jonathan Hefner</em></p>
</li>
<li>
<p>Avoid validating a unique field if it has not changed and is backed by a unique index.</p>
<p>Previously, when saving a record, Active Record will perform an extra query to check for the<br>
uniqueness of each attribute having a <code>uniqueness</code> validation, even if that attribute hasn't changed.<br>
If the database has the corresponding unique index, then this validation can never fail for persisted<br>
records, and we could safely skip it.</p>
<p><em>fatkodima</em></p>
</li>
<li>
<p>Stop setting <code>sql_auto_is_null</code></p>
<p>Since version 5.5 the default has been off, we no longer have to manually turn it off.</p>
<p><em>Adam Hess</em></p>
</li>
<li>
<p>Fix <code>touch</code> to raise an error for readonly columns.</p>
<p><em>fatkodima</em></p>
</li>
<li>
<p>Add ability to ignore tables by regexp for SQL schema dumps.</p>
<div data-snippet-clipboard-copy-content="ActiveRecord::SchemaDumper.ignore_tables = [/^_/]"><pre><span>ActiveRecord</span>::<span>SchemaDumper</span><span>.</span><span>ignore_tables</span> <span>=</span> <span>[</span><span>/^_/</span><span>]</span></pre></div>
<p><em>fatkodima</em></p>
</li>
<li>
<p>Avoid queries when performing calculations on contradictory relations.</p>
<p>Previously calculations would make a query even when passed a<br>
contradiction, such as <code>User.where(id: []).count</code>. We no longer perform a<br>
query in that scenario.</p>
<p>This applies to the following calculations: <code>count</code>, <code>sum</code>, <code>average</code>,<br>
<code>minimum</code> and <code>maximum</code></p>
<p><em>Luan Vieira, John Hawthorn and Daniel Colson</em></p>
</li>
<li>
<p>Allow using aliased attributes with <code>insert_all</code>/<code>upsert_all</code>.</p>
<div data-snippet-clipboard-copy-content="class Book < ApplicationRecord
  alias_attribute :title, :name
end

Book.insert_all [{ title: &quot;Remote&quot;, author_id: 1 }], returning: :title"><pre><span>class</span> <span>Book</span> &lt; <span>ApplicationRecord</span>
  <span>alias_attribute</span> <span>:title</span><span>,</span> <span>:name</span>
<span>end</span>

<span>Book</span><span>.</span><span>insert_all</span> <span>[</span><span>{</span> <span>title</span>: <span>"Remote"</span><span>,</span> <span>author_id</span>: <span>1</span> <span>}</span><span>]</span><span>,</span> <span>returning</span>: <span>:title</span></pre></div>
<p><em>fatkodima</em></p>
</li>
<li>
<p>Support encrypted attributes on columns with default db values.</p>
<p>This adds support for encrypted attributes defined on columns with default values.<br>
It will encrypt those values at creation time. Before, it would raise an<br>
error unless <code>config.active_record.encryption.support_unencrypted_data</code> was true.</p>
<p><em>Jorge Manrubia</em> and <em>Dima Fatko</em></p>
</li>
<li>
<p>Allow overriding <code>reading_request?</code> in <code>DatabaseSelector::Resolver</code></p>
<p>The default implementation checks if a request is a <code>get?</code> or <code>head?</code>,<br>
but you can now change it to anything you like. If the method returns true,<br>
<code>Resolver#read</code> gets called meaning the request could be served by the<br>
replica database.</p>
<p><em>Alex Ghiculescu</em></p>
</li>
<li>
<p>Remove <code>ActiveRecord.legacy_connection_handling</code>.</p>
<p><em>Eileen M. Uchitelle</em></p>
</li>
<li>
<p><code>rails db:schema:{dump,load}</code> now checks <code>ENV["SCHEMA_FORMAT"]</code> before config</p>
<p>Since <code>rails db:structure:{dump,load}</code> was deprecated there wasn't a simple<br>
way to dump a schema to both SQL and Ruby formats. You can now do this with<br>
an environment variable. For example:</p>
<div data-snippet-clipboard-copy-content="SCHEMA_FORMAT=sql rake db:schema:dump"><pre><code>SCHEMA_FORMAT=sql rake db:schema:dump
</code></pre></div>
<p><em>Alex Ghiculescu</em></p>
</li>
<li>
<p>Fixed MariaDB default function support.</p>
<p>Defaults would be written wrong in "db/schema.rb" and not work correctly<br>
if using <code>db:schema:load</code>. Further more the function name would be<br>
added as string content when saving new records.</p>
<p><em>kaspernj</em></p>
</li>
<li>
<p>Add <code>active_record.destroy_association_async_batch_size</code> configuration</p>
<p>This allows applications to specify the maximum number of records that will<br>
be destroyed in a single background job by the <code>dependent: :destroy_async</code><br>
association option. By default, the current behavior will remain the same:<br>
when a parent record is destroyed, all dependent records will be destroyed<br>
in a single background job. If the number of dependent records is greater<br>
than this configuration, the records will be destroyed in multiple<br>
background jobs.</p>
<p><em>Nick Holden</em></p>
</li>
<li>
<p>Fix <code>remove_foreign_key</code> with <code>:if_exists</code> option when foreign key actually exists.</p>
<p><em>fatkodima</em></p>
</li>
<li>
<p>Remove <code>--no-comments</code> flag in structure dumps for PostgreSQL</p>
<p>This broke some apps that used custom schema comments. If you don't want<br>
comments in your structure dump, you can use:</p>
<div data-snippet-clipboard-copy-content="ActiveRecord::Tasks::DatabaseTasks.structure_dump_flags = ['--no-comments']"><pre><span>ActiveRecord</span>::<span>Tasks</span>::<span>DatabaseTasks</span><span>.</span><span>structure_dump_flags</span> <span>=</span> <span>[</span><span>'--no-comments'</span><span>]</span></pre></div>
<p><em>Alex Ghiculescu</em></p>
</li>
<li>
<p>Reduce the memory footprint of fixtures accessors.</p>
<p>Until now fixtures accessors were eagerly defined using <code>define_method</code>.<br>
So the memory usage was directly dependent of the number of fixtures and<br>
test suites.</p>
<p>Instead fixtures accessors are now implemented with <code>method_missing</code>,<br>
so they incur much less memory and CPU overhead.</p>
<p><em>Jean Boussier</em></p>
</li>
<li>
<p>Fix <code>config.active_record.destroy_association_async_job</code> configuration</p>
<p><code>config.active_record.destroy_association_async_job</code> should allow<br>
applications to specify the job that will be used to destroy associated<br>
records in the background for <code>has_many</code> associations with the<br>
<code>dependent: :destroy_async</code> option. Previously, that was ignored, which<br>
meant the default <code>ActiveRecord::DestroyAssociationAsyncJob</code> always<br>
destroyed records in the background.</p>
<p><em>Nick Holden</em></p>
</li>
<li>
<p>Fix <code>change_column_comment</code> to preserve column's AUTO_INCREMENT in the MySQL adapter</p>
<p><em>fatkodima</em></p>
</li>
<li>
<p>Fix quoting of <code>ActiveSupport::Duration</code> and <code>Rational</code> numbers in the MySQL adapter.</p>
<p><em>Kevin McPhillips</em></p>
</li>
<li>
<p>Allow column name with COLLATE (e.g., title COLLATE "C") as safe SQL string</p>
<p><em>Shugo Maeda</em></p>
</li>
<li>
<p>Permit underscores in the VERSION argument to database rake tasks.</p>
<p><em>Eddie Lebow</em></p>
</li>
<li>
<p>Reversed the order of <code>INSERT</code> statements in <code>structure.sql</code> dumps</p>
<p>This should decrease the likelihood of merge conflicts. New migrations<br>
will now be added at the top of the list.</p>
<p>For existing apps, there will be a large diff the next time <code>structure.sql</code><br>
is generated.</p>
<p><em>Alex Ghiculescu</em>, <em>Matt Larraz</em></p>
</li>
<li>
<p>Fix PG.connect keyword arguments deprecation warning on ruby 2.7</p>
<p>Fixes <a data-error-text="Failed to load title" data-id="1121266570" data-permission-text="Title is private" data-url="https://github.com/rails/rails/issues/44307" data-hovercard-type="issue" data-hovercard-url="/rails/rails/issues/44307/hovercard" href="https://github.com/rails/rails/issues/44307">#44307</a>.</p>
<p><em>Nikita Vasilevsky</em></p>
</li>
<li>
<p>Fix dropping DB connections after serialization failures and deadlocks.</p>
<p>Prior to 6.1.4, serialization failures and deadlocks caused rollbacks to be<br>
issued for both real transactions and savepoints. This breaks MySQL which<br>
disallows rollbacks of savepoints following a deadlock.</p>
<p>6.1.4 removed these rollbacks, for both transactions and savepoints, causing<br>
the DB connection to be left in an unknown state and thus discarded.</p>
<p>These rollbacks are now restored, except for savepoints on MySQL.</p>
<p><em>Thomas Morgan</em></p>
</li>
<li>
<p>Make <code>ActiveRecord::ConnectionPool</code> Fiber-safe</p>
<p>When <code>ActiveSupport::IsolatedExecutionState.isolation_level</code> is set to <code>:fiber</code>,<br>
the connection pool now supports multiple Fibers from the same Thread checking<br>
out connections from the pool.</p>
<p><em>Alex Matchneer</em></p>
</li>
<li>
<p>Add <code>update_attribute!</code> to <code>ActiveRecord::Persistence</code></p>
<p>Similar to <code>update_attribute</code>, but raises <code>ActiveRecord::RecordNotSaved</code> when a <code>before_*</code> callback throws <code>:abort</code>.</p>
<div data-snippet-clipboard-copy-content="class Topic < ActiveRecord::Base
  before_save :check_title

  def check_title
    throw(:abort) if title == &quot;abort&quot;
  end
end

topic = Topic.create(title: &quot;Test Title&quot;)
# #=> #<Topic title: &quot;Test Title&quot;>
topic.update_attribute!(:title, &quot;Another Title&quot;)
# #=> #<Topic title: &quot;Another Title&quot;>
topic.update_attribute!(:title, &quot;abort&quot;)
# raises ActiveRecord::RecordNotSaved"><pre><span>class</span> <span>Topic</span> &lt; <span>ActiveRecord</span>::<span>Base</span>
  <span>before_save</span> <span>:check_title</span>

  <span>def</span> <span>check_title</span>
    <span>throw</span><span>(</span><span>:abort</span><span>)</span> <span>if</span> <span>title</span> == <span>"abort"</span>
  <span>end</span>
<span>end</span>

<span>topic</span> <span>=</span> <span>Topic</span><span>.</span><span>create</span><span>(</span><span>title</span>: <span>"Test Title"</span><span>)</span>
<span># #=&gt; #&lt;Topic title: "Test Title"&gt;</span>
<span>topic</span><span>.</span><span>update_attribute!</span><span>(</span><span>:title</span><span>,</span> <span>"Another Title"</span><span>)</span>
<span># #=&gt; #&lt;Topic title: "Another Title"&gt;</span>
<span>topic</span><span>.</span><span>update_attribute!</span><span>(</span><span>:title</span><span>,</span> <span>"abort"</span><span>)</span>
<span># raises ActiveRecord::RecordNotSaved</span></pre></div>
<p><em>Drew Tempelmeyer</em></p>
</li>
<li>
<p>Avoid loading every record in <code>ActiveRecord::Relation#pretty_print</code></p>
<div data-snippet-clipboard-copy-content="# Before
pp Foo.all # Loads the whole table.

# After
pp Foo.all # Shows 10 items and an ellipsis."><pre><span># Before</span>
<span>pp</span> <span>Foo</span><span>.</span><span>all</span> <span># Loads the whole table.</span>

<span># After</span>
<span>pp</span> <span>Foo</span><span>.</span><span>all</span> <span># Shows 10 items and an ellipsis.</span></pre></div>
<p><em>Ulysse Buonomo</em></p>
</li>
<li>
<p>Change <code>QueryMethods#in_order_of</code> to drop records not listed in values.</p>
<p><code>in_order_of</code> now filters down to the values provided, to match the behavior of the <code>Enumerable</code> version.</p>
<p><em>Kevin Newton</em></p>
</li>
<li>
<p>Allow named expression indexes to be revertible.</p>
<p>Previously, the following code would raise an error in a reversible migration executed while rolling back, due to the index name not being used in the index removal.</p>
<div data-snippet-clipboard-copy-content="add_index(:settings, &quot;(data->'property')&quot;, using: :gin, name: :index_settings_data_property)"><pre><span>add_index</span><span>(</span><span>:settings</span><span>,</span> <span>"(data-&gt;'property')"</span><span>,</span> <span>using</span>: <span>:gin</span><span>,</span> <span>name</span>: <span>:index_settings_data_property</span><span>)</span></pre></div>
<p>Fixes <a data-error-text="Failed to load title" data-id="1010891915" data-permission-text="Title is private" data-url="https://github.com/rails/rails/issues/43331" data-hovercard-type="issue" data-hovercard-url="/rails/rails/issues/43331/hovercard" href="https://github.com/rails/rails/issues/43331">#43331</a>.</p>
<p><em>Oliver Günther</em></p>
</li>
<li>
<p>Fix incorrect argument in PostgreSQL structure dump tasks.</p>
<p>Updating the <code>--no-comment</code> argument added in Rails 7 to the correct <code>--no-comments</code> argument.</p>
<p><em>Alex Dent</em></p>
</li>
<li>
<p>Fix migration compatibility to create SQLite references/belongs_to column as integer when migration version is 6.0.</p>
<p>Reference/belongs_to in migrations with version 6.0 were creating columns as<br>
bigint instead of integer for the SQLite Adapter.</p>
<p><em>Marcelo Lauxen</em></p>
</li>
<li>
<p>Fix <code>QueryMethods#in_order_of</code> to handle empty order list.</p>
<div data-snippet-clipboard-copy-content="Post.in_order_of(:id, []).to_a"><pre><span>Post</span><span>.</span><span>in_order_of</span><span>(</span><span>:id</span><span>,</span> <span>[</span><span>]</span><span>)</span><span>.</span><span>to_a</span></pre></div>
<p>Also more explicitly set the column as secondary order, so that any other<br>
value is still ordered.</p>
<p><em>Jean Boussier</em></p>
</li>
<li>
<p>Fix quoting of column aliases generated by calculation methods.</p>
<p>Since the alias is derived from the table name, we can't assume the result<br>
is a valid identifier.</p>
<div data-snippet-clipboard-copy-content="class Test < ActiveRecord::Base
  self.table_name = '1abc'
end
Test.group(:id).count
# syntax error at or near &quot;1&quot; (ActiveRecord::StatementInvalid)
# LINE 1: SELECT COUNT(*) AS count_all, &quot;1abc&quot;.&quot;id&quot; AS 1abc_id FROM &quot;1..."><pre><span>class</span> <span>Test</span> &lt; <span>ActiveRecord</span>::<span>Base</span>
  <span>self</span><span>.</span><span>table_name</span> <span>=</span> <span>'1abc'</span>
<span>end</span>
<span>Test</span><span>.</span><span>group</span><span>(</span><span>:id</span><span>)</span><span>.</span><span>count</span>
<span># syntax error at or near "1" (ActiveRecord::StatementInvalid)</span>
<span># LINE 1: SELECT COUNT(*) AS count_all, "1abc"."id" AS 1abc_id FROM "1...</span></pre></div>
<p><em>Jean Boussier</em></p>
</li>
<li>
<p>Add <code>authenticate_by</code> when using <code>has_secure_password</code>.</p>
<p><code>authenticate_by</code> is intended to replace code like the following, which<br>
returns early when a user with a matching email is not found:</p>
<div data-snippet-clipboard-copy-content="User.find_by(email: &quot;...&quot;)&amp;.authenticate(&quot;...&quot;)"><pre><span>User</span><span>.</span><span>find_by</span><span>(</span><span>email</span>: <span>"..."</span><span>)</span>&amp;.<span>authenticate</span><span>(</span><span>"..."</span><span>)</span></pre></div>
<p>Such code is vulnerable to timing-based enumeration attacks, wherein an<br>
attacker can determine if a user account with a given email exists. After<br>
confirming that an account exists, the attacker can try passwords associated<br>
with that email address from other leaked databases, in case the user<br>
re-used a password across multiple sites (a common practice). Additionally,<br>
knowing an account email address allows the attacker to attempt a targeted<br>
phishing ("spear phishing") attack.</p>
<p><code>authenticate_by</code> addresses the vulnerability by taking the same amount of<br>
time regardless of whether a user with a matching email is found:</p>
<div data-snippet-clipboard-copy-content="User.authenticate_by(email: &quot;...&quot;, password: &quot;...&quot;)"><pre><span>User</span><span>.</span><span>authenticate_by</span><span>(</span><span>email</span>: <span>"..."</span><span>,</span> <span>password</span>: <span>"..."</span><span>)</span></pre></div>
<p><em>Jonathan Hefner</em></p>
</li>
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Ollama is now available as an official Docker image (161 pts)]]></title>
            <link>https://ollama.ai/blog/ollama-is-now-available-as-an-official-docker-image</link>
            <guid>37786525</guid>
            <pubDate>Fri, 06 Oct 2023 02:18:27 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://ollama.ai/blog/ollama-is-now-available-as-an-official-docker-image">https://ollama.ai/blog/ollama-is-now-available-as-an-official-docker-image</a>, See on <a href="https://news.ycombinator.com/item?id=37786525">Hacker News</a></p>
<div id="readability-page-1" class="page"><section>
        <p><img src="https://github.com/jmorganca/ollama/assets/3325447/080f3a72-e2fd-4741-8070-ae79a06f943f">
</p>

<h2>Ollama is now available as an official Docker image</h2>

<p>We are excited to share that Ollama is now available as an official Docker sponsored <a href="https://hub.docker.com/r/ollama/ollama">open-source image</a>, making it simpler to get up and running with large language models using Docker containers.</p>

<p>With Ollama, all your interactions with large language models happen locally without sending private data to third-party services.</p>

<h2>On the Mac</h2>

<p>Ollama handles running the model with GPU acceleration. It provides both a simple CLI as well as a REST API for interacting with your applications.</p>

<p>To get started, simply <a href="https://ollama.ai/download">download</a> and install Ollama.</p>

<p>We recommend running Ollama alongside Docker Desktop for macOS in order for Ollama to enable GPU acceleration for models.</p>

<h2>On Linux</h2>

<p>Ollama can run with GPU acceleration inside Docker containers for Nvidia GPUs.</p>

<p>To get started using the Docker image, please use the commands below.</p>

<h4>CPU only</h4>

<pre><code>docker run -d -v ollama:/root/.ollama -p 11434:11434 --name ollama ollama/ollama
</code></pre>

<h4>Nvidia GPU</h4>

<ol>
<li>Install the <a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html#installation">Nvidia container toolkit</a>.</li>
<li>Run Ollama inside a Docker container</li>
</ol>

<pre><code>docker run -d --gpus=all -v ollama:/root/.ollama -p 11434:11434 --name ollama ollama/ollama
</code></pre>

<h3>Run a model</h3>

<p>Now you can run a model like Llama 2 inside the container.</p>

<pre><code>docker exec -it ollama ollama run llama2
</code></pre>

<p>More models can be found on the <a href="https://ollama.ai/library">Ollama library</a>.</p>

<p>Join Ollama’s <a href="https://discord.gg/ollama">Discord</a> to chat with other community members, maintainers, and contributors.</p>

<p>Follow <a href="https://twitter.com/ollama_ai">Ollama on Twitter</a> for updates.</p>

      </section></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Gboard Hat Version (155 pts)]]></title>
            <link>https://landing.google.co.jp/caps/</link>
            <guid>37785920</guid>
            <pubDate>Fri, 06 Oct 2023 00:27:09 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://landing.google.co.jp/caps/">https://landing.google.co.jp/caps/</a>, See on <a href="https://news.ycombinator.com/item?id=37785920">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
      <div>
          <!-- prettier-ignore -->
          <p>誰かに<wbr>思いを<wbr>伝える<wbr>ために<wbr>筆を<wbr>走らせ、<wbr>自分の<wbr>ことを<wbr>より<wbr>知る<wbr>ために<wbr>文字を<wbr>紡ぐ。<wbr>文字入力は<wbr>新しい<wbr>世界と<wbr>自分を<wbr>知る<wbr>冒険だ。</p>

          <!-- prettier-ignore -->
          <p>あなたと<wbr>一体となる<wbr>キーボード、<wbr>Gboard 帽バージョン。</p>
        </div>
      <p>
        <iframe title="YouTube video player" src="https://www.youtube-nocookie.com/embed/6vib77CUxNM" frameborder="0" allowfullscreen="" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"></iframe>
      </p>
      <section>
        <h2>
          <ruby>Wearable<rp>(</rp><rt>ウェアラ<b>ボー</b></rt><rp>)</rp></ruby>
          で
          <ruby>Portable<rp>(</rp><rt>ポータ<b>ボー</b></rt><rp>)</rp></ruby>
          で
          <ruby>Fashionable<rp>(</rp><rt>ファッショナ<b>ボー</b></rt><rp>)</rp></ruby>
          な
          <ruby>Keyboard<rp>(</rp><rt>キー<b>ボー</b>ド</rt><rp>)</rp></ruby>
        </h2>
        <p>いつも<wbr>使う<wbr>キーボードだから<wbr>こそ、<wbr>常に<wbr>おしゃれに<wbr>持ち歩きたい。<wbr>Gboard 帽バージョンなら、<wbr>日々の<wbr>ファッションに<wbr>取り入れるだけで、<wbr>思い立ったら<wbr>すぐ<wbr>文字入力できます。</p>
        <picture>
          <source srcset="
              https://lh3.googleusercontent.com/kNcDR3TqUJvZAvcLLVgA_yseoFVcIzaY9OKaWVcuotQ4PFD-1_jnpx9WVqzr0-BTPiAOC2uE6RXx6_tBkP8Vd4nK66gfD7QRFBR7F6jW5jrscm_jZuA=w1248-rw 1248w,
              https://lh3.googleusercontent.com/kNcDR3TqUJvZAvcLLVgA_yseoFVcIzaY9OKaWVcuotQ4PFD-1_jnpx9WVqzr0-BTPiAOC2uE6RXx6_tBkP8Vd4nK66gfD7QRFBR7F6jW5jrscm_jZuA=w2492-rw 2492w
            " type="image/webp">
          <source srcset="
              https://lh3.googleusercontent.com/kNcDR3TqUJvZAvcLLVgA_yseoFVcIzaY9OKaWVcuotQ4PFD-1_jnpx9WVqzr0-BTPiAOC2uE6RXx6_tBkP8Vd4nK66gfD7QRFBR7F6jW5jrscm_jZuA=w1248-rj 1248w,
              https://lh3.googleusercontent.com/kNcDR3TqUJvZAvcLLVgA_yseoFVcIzaY9OKaWVcuotQ4PFD-1_jnpx9WVqzr0-BTPiAOC2uE6RXx6_tBkP8Vd4nK66gfD7QRFBR7F6jW5jrscm_jZuA=w2492-rj 2492w
            " type="image/jpeg">
          <img src="https://lh3.googleusercontent.com/kNcDR3TqUJvZAvcLLVgA_yseoFVcIzaY9OKaWVcuotQ4PFD-1_jnpx9WVqzr0-BTPiAOC2uE6RXx6_tBkP8Vd4nK66gfD7QRFBR7F6jW5jrscm_jZuA=w1248" fetchpriority="auto" alt="Gboard 帽バージョンを使って文字を入力している様子" width="2492" height="1661">
        </picture>
      </section>
      <section>
        <!-- prettier-ignore -->
        <h2>ひとつの<wbr>帽子、<wbr>無限の<wbr>可能性</h2>
        <p>Gboard 帽バージョンなら、<wbr>もう<wbr>キーの<wbr>場所を<wbr>覚える<wbr>必要は<wbr>ありません。<wbr>頭の<wbr>方向で<wbr>文字を<wbr>選択、<wbr>頭を<wbr>押して<wbr>文字を<wbr>確定する<wbr> A<span>tama</span> I<span>nput</span> 機構を<wbr>採用しています。</p>
        
      </section>
      <section id="variation">
        <!-- prettier-ignore -->
        <h2>いつも<wbr>使うから<wbr>こそ<wbr>おしゃれしたい</h2>
        <p>普段<wbr>使いの<wbr>帽子と<wbr>しても<wbr>ファッショナボーに<wbr>お使いいただけるよう、<wbr>豊富な<wbr>バリエーションを<wbr>ご用意しています。</p>
        <picture>
          <source srcset="
              https://lh3.googleusercontent.com/9hWktV1GDCbPyjVgH0Eg2irYIfQzV908L757Pfn4YdZoe3Ll0zjq5jyqUd9ZTy3dTPvCXxzWKYzxEqWRhIBsz2DetgQveRB7s6f1Vi8kUyWxSCwNdw=w1248-rw 1248w,
              https://lh3.googleusercontent.com/9hWktV1GDCbPyjVgH0Eg2irYIfQzV908L757Pfn4YdZoe3Ll0zjq5jyqUd9ZTy3dTPvCXxzWKYzxEqWRhIBsz2DetgQveRB7s6f1Vi8kUyWxSCwNdw=w2492-rw 2492w
            " type="image/webp">
          <source srcset="
              https://lh3.googleusercontent.com/9hWktV1GDCbPyjVgH0Eg2irYIfQzV908L757Pfn4YdZoe3Ll0zjq5jyqUd9ZTy3dTPvCXxzWKYzxEqWRhIBsz2DetgQveRB7s6f1Vi8kUyWxSCwNdw=w1248-rj 1248w,
              https://lh3.googleusercontent.com/9hWktV1GDCbPyjVgH0Eg2irYIfQzV908L757Pfn4YdZoe3Ll0zjq5jyqUd9ZTy3dTPvCXxzWKYzxEqWRhIBsz2DetgQveRB7s6f1Vi8kUyWxSCwNdw=w2492-rj 2492w
            " type="image/jpeg">
          <img src="https://lh3.googleusercontent.com/9hWktV1GDCbPyjVgH0Eg2irYIfQzV908L757Pfn4YdZoe3Ll0zjq5jyqUd9ZTy3dTPvCXxzWKYzxEqWRhIBsz2DetgQveRB7s6f1Vi8kUyWxSCwNdw=w1248" fetchpriority="auto" alt="さまざまな形と色の帽子型キーボード" width="2492" height="1402">
        </picture>
        <p>Gboard 帽バージョンを<wbr>いつでも<wbr>持ち歩けるよう、<wbr>壁紙を<wbr>ご用意しました。<wbr>お使いの<wbr>端末の<wbr>画面に<wbr>合わせた<wbr>画像を<wbr>ダウンロードできます。</p>
        
      </section>
      <section id="diy">
        <!-- prettier-ignore -->
        <h2>あなただけの<wbr>帽子型キーボードを<wbr>つくる</h2>
        <p>Gboard 帽バージョンは<wbr>みなさんの<wbr>手で<wbr>制作できる<wbr> DIY デバイスです。</p>
        <div>
          <div>
            <picture>
              <source srcset="
                  https://lh3.googleusercontent.com/4Ty1Irbi_SALfoYlFd_kCrE5DNOhUYBt1nA-MOKC-AQICsNbLedgNjMTohgJ-J1atu-ySLAV8HSXbG_aGPidJltl9w5tt_jdXhIwkzNsFcybez7-AKM=w1232-rw
                " type="image/webp">
              <source srcset="
                  https://lh3.googleusercontent.com/4Ty1Irbi_SALfoYlFd_kCrE5DNOhUYBt1nA-MOKC-AQICsNbLedgNjMTohgJ-J1atu-ySLAV8HSXbG_aGPidJltl9w5tt_jdXhIwkzNsFcybez7-AKM=w1232-rj
                " type="image/jpeg">
              <img src="https://lh3.googleusercontent.com/4Ty1Irbi_SALfoYlFd_kCrE5DNOhUYBt1nA-MOKC-AQICsNbLedgNjMTohgJ-J1atu-ySLAV8HSXbG_aGPidJltl9w5tt_jdXhIwkzNsFcybez7-AKM=w1232" fetchpriority="auto" alt="電子工作で帽子型キーボードを制作する様子" width="616" height="411">
            </picture>
            <h3>
              電子工作でつくる
            </h3>

            <!-- prettier-ignore -->
            <p>ご家庭の<wbr> 3D プリンターを<wbr>使って<wbr>制作する<wbr>本格派バージョンです。<wbr>ワンキー仕様の<wbr>文字入力を<wbr>体感したい<wbr>あなたに<wbr>ぴったりです。</p>
            <p><a href="https://github.com/google/mozc-devices/tree/master/mozc-caps" target="_blank" rel="noopener noreferrer">
              GitHub で設計書を見る
            </a>
          </p></div>
          <div>
            <picture>
              <source srcset="
                  https://lh3.googleusercontent.com/off3LhymuSpLRbtqNPSl4DGSZzZusQYHjjFIB20jf2vZ0rke98NexwBqJvEfloUGGOAJW-5treDxw0eKXNuvkzq_BdATU6iVuEJ7s1EguuJwieBlycH7=w1232-rw
                " type="image/webp">
              <source srcset="
                  https://lh3.googleusercontent.com/off3LhymuSpLRbtqNPSl4DGSZzZusQYHjjFIB20jf2vZ0rke98NexwBqJvEfloUGGOAJW-5treDxw0eKXNuvkzq_BdATU6iVuEJ7s1EguuJwieBlycH7=w1232-rj
                " type="image/jpeg">
              <img src="https://lh3.googleusercontent.com/off3LhymuSpLRbtqNPSl4DGSZzZusQYHjjFIB20jf2vZ0rke98NexwBqJvEfloUGGOAJW-5treDxw0eKXNuvkzq_BdATU6iVuEJ7s1EguuJwieBlycH7=w1232" fetchpriority="auto" alt="ダンボールで帽子型キーボードを制作する様子" width="616" height="411">
            </picture>
            <h3>
              ダンボールでつくる
            </h3>

            <!-- prettier-ignore -->
            <p>ダンボールと<wbr>ハサミで<wbr>つくる<wbr>お手軽バージョンです。<wbr>文字入力は<wbr>できませんが、<wbr>ファッショナボーな<wbr>気分を<wbr>味わえます。</p>
            <p><a href="https://landing.google.co.jp/caps/static/assets/gboard_caps_cardboard.pdf" target="_blank" rel="noopener noreferrer">
              制作ガイドを見る
            </a>
          </p></div>
        </div>
      </section>
      <div id="specs">
          <h2>
            仕様
          </h2>
          <div>
            <dl>
              <dt>センサー</dt>
              <dd>6 軸慣性センサー</dd>
              <dt>スイッチ</dt>
              <dd>1 軸プッシュスイッチ</dd>
              <dt>バッテリー</dt>
              <dd>3.7V 120mAh</dd>
              <dt>充電</dt>
              <dd>USB-C</dd>
              <dt>サイズ</dt>
              <dd>フリーサイズ（ユニセックス）</dd>
              <dt>キー数</dt>
              <dd>1</dd>
            </dl>
            <dl>
              <dt>キー荷重</dt>
              <dd>輪ゴムによる</dd>
              <dt>ストローク深さ</dt>
              <dd>2cm</dd>
              <dt>インターフェイス</dt>
              <dd>Bluetooth</dd>
              <dt>オプション</dt>
              <dd>UV カット</dd>
              <dt>付属品</dt>
              <dd>あごひも（CAPS LOCK）</dd>
              <dt>色</dt>
              <dd>ベージュ、ネイビー、その他いろいろ</dd>
            </dl>
          </div>
        </div>
      <div id="download">
          <!-- prettier-ignore -->
          
          <p>いままでの<wbr>盤面上の<wbr>文字入力に<wbr>慣れ親しんだ<wbr>方には、<wbr>通常版の<wbr> Gboard も<wbr>ご用意しております。<wbr>かわいい絵文字を<wbr>組み合わせて<wbr>遊べる<wbr> Emoji Kitchen (Android 版の<wbr>み) に<wbr>加え、<wbr>音声入力や<wbr>翻訳機能など<wbr> Google の<wbr>各種サービスと<wbr>連携した<wbr>快適な<wbr>入力体験を<wbr>提供します。</p>
          
        </div>
      <section id="faq">
        <h2>
          よくある質問
        </h2>
        <div>
          <dl>
            <!-- prettier-ignore -->
            <dt>今日は<wbr> 10 月 1 日ですよね？</dt>

            <!-- prettier-ignore -->
            <dd>は<wbr>い、<wbr>今日は<wbr> 10 月 1 日です！</dd>

            <!-- prettier-ignore -->
            <dt>今日は<wbr>なんの<wbr>日なんですか？</dt>

            <!-- prettier-ignore -->
            <dd>キーボードの<wbr>発表に<wbr>ふさわしい<wbr>日を<wbr>検討していた際、<wbr>101 キーボードと<wbr>呼ばれる<wbr> 101 個の<wbr>キーが<wbr>ある<wbr>タイプが<wbr>よく<wbr>使われている<wbr>ことに<wbr>気が<wbr>付きました。<wbr>そこで、<wbr>101 キーボードに<wbr>ちなんで<wbr> 10 月 1 日に<wbr>公開しました。</dd>

            <!-- prettier-ignore -->
            <dt>どこで<wbr>購入できますか？</dt>

            <!-- prettier-ignore -->
            <dd>発売予定は<wbr>ありません。<wbr>同様の<wbr>デバイスを<wbr>自作していただける<wbr>設計図を<wbr>オープンソースと<wbr>して<a href="https://github.com/google/mozc-devices/tree/master/mozc-caps" target="_blank" rel="noopener noreferrer"><wbr>公開</a>しています。<wbr>また、<wbr>キーキャップを<wbr>試着したい<wbr>方へは、<wbr>ダンボールと<wbr>ハサミで<wbr>つくる<a href="https://landing.google.co.jp/caps/static/assets/gboard_caps_cardboard.pdf" target="_blank" rel="noopener noreferrer"><wbr>製作ガイド</a>も<wbr>ご用意しました。</dd>

            <!-- prettier-ignore -->
            <dt>前回も<wbr>「<a href="https://g.co/____" target="_blank" rel="noopener noreferrer">ぼう<wbr>バージョン</a>」では<wbr>ありませんでした？</dt>

            <!-- prettier-ignore -->
            <dd>帽子なだけに<wbr>被ってしまいましたね！</dd>

            <!-- prettier-ignore -->
            <dt>はっと<wbr>するような<wbr>デバイスですね。</dt>

            <!-- prettier-ignore -->
            <dd>きぼうした<wbr>通りの<wbr>設計に<wbr>なりました。</dd>
          </dl>
        </div>
      </section>
    </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[NIST Elliptic Curves Seeds Bounty (335 pts)]]></title>
            <link>https://words.filippo.io/dispatches/seeds-bounty/</link>
            <guid>37784499</guid>
            <pubDate>Thu, 05 Oct 2023 21:26:52 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://words.filippo.io/dispatches/seeds-bounty/">https://words.filippo.io/dispatches/seeds-bounty/</a>, See on <a href="https://news.ycombinator.com/item?id=37784499">Hacker News</a></p>
<div id="readability-page-1" class="page"><article>
        <span>
            <time datetime="2023-10-05">05 Oct 2023</time>
        </span>
        
        <section>
            <!--kg-card-begin: markdown--><p>The NIST elliptic curves that power much of modern cryptography were generated in the late ‘90s by hashing seeds provided by the NSA. How were the seeds generated? Rumor has it that they are in turn hashes of English sentences, but the person who picked them, Dr. Jerry Solinas, passed away in early 2023 leaving behind a cryptographic mystery, some conspiracy theories, and an historical password cracking challenge.</p>
<p><strong>Together with some generous matchers, I’m announcing a <s>$8,192</s> $12,288 (12 Ki$) bounty for cracking these five hashes, tripled to $36,864 if the recipient chooses to donate it to a 501(c)(3) charity of their choice.</strong></p>
<pre><code>3045AE6FC8422F64ED579528D38120EAE12196D5
BD71344799D5C7FCDC45B59FA3B9AB8F6A948BC5
C49D360886E704936A6678E1139D26B7819F7E90
A335926AA319A27A1D00896A6773A4827ACDAC73
D09E8800291CB85396CC6717393284AAA0DA64BA
</code></pre>
<p>Thank you to Amir Omidi, Chris Palmer, Colm MacCárthaigh, David Adrian, David Anderson, Jeff Hodges, Matt Green, Matthew McPherrin, Paul Kehrer, Ryan Sleevi, and Soatok for contributing to the bounty, and to Steve Weis for the research that inspired this.</p>
<h2 id="step-back-what-is-this-about">Step back, what is this about?</h2>
<p>The NIST elliptic curves (P-192, P-224, P-256, P-384, and P-521<sup><a href="#fn1" id="fnref1">[1]</a></sup>) were published by NIST in FIPS 186-2 in 2000, and generated “verifiably at random” according to ANSI X9.62 by taking an arbitrary seed, hashing it with SHA-1, and using the output to derive some of the parameters.</p>
<p>A <em>lot</em> of cryptography uses NIST curves, and especially P-256 and P-384. They are in the Commercial National Security Algorithm Suite (the successor of Suite B), and are the curves used by the ECDSA X.509 certificates that secure much of the web. They’re a big deal.</p>
<p>Steve Weis has recently published <a href="https://saweis.net/posts/nist-curve-seed-origins.html?ref=words.filippo.io">a well researched article</a> on everything we know about those arbitrary seeds embedded in the FIPS 186 specification. Apparently, they were provided by the NSA, and generated by Jerry Solinas in 1997. He allegedly generated them by hashing, presumably with SHA-1, some English sentences that he later forgot.</p>
<blockquote>
<p>[Jerry] told me that he used a seed that was something like:<br>
<code>SEED = SHA1("Jerry deserves a raise.")</code><br>
After he did the work, his machine was replaced or upgraded, and the actual phrase that he used was lost. When the controversy first came up, Jerry tried every phrase that he could think of that was similar to this, but none matched.</p>
</blockquote>
<p>That’s unfortunate, because the NIST curves are—surprisingly—looking better and better: we now have <a href="https://eprint.iacr.org/2015/1060?ref=words.filippo.io">complete addition formulas</a> for them, mitigating their major footgun; we know how to design safer interfaces for them; and we painfully learned to appreciate the value of prime order curves immune to cofactor attacks. However, there is—mostly amongst non-practitioners—some fear that the NSA could have picked the seeds to select some intentionally weak curves.</p>
<p>Do I think those fears are well-founded? No. Koblitz and Menezes make a good argument in <a href="https://eprint.iacr.org/2015/1018.pdf?ref=words.filippo.io"><em>A riddle wrapped in an enigma</em></a> that even with full control over the seed, the NSA would have had to be aware of a class of weak curves so large that it’s not plausible that no one in academia or industry discovered them in 25 years.<sup><a href="#fn2" id="fnref2">[2]</a></sup></p>
<p>Anyway, some <a href="https://en.wikipedia.org/wiki/Fear,_uncertainty,_and_doubt?ref=words.filippo.io">FUD</a> persists around the otherwise pretty good NIST curves that would be good to clear up, even if the English preimage of the hashes <a href="https://twitter.com/lauriewired/status/1700982575291142594?ref=words.filippo.io">is not a complete guarantee of rigidity</a><sup><a href="#fn3" id="fnref3">[3]</a></sup>.</p>
<p>That’s where this bounty comes in. Finding the pre-seeds, the inputs to the hash that generated the seeds, is the bread and butter of password crackers and brainwallet bruteforcers. <strong>This is a call to arms for them to join the search, help fill in a page of cryptographic history, and collect a large bounty or donate an even larger one to charity.</strong></p>
<h2 id="ok-so-what-do-we-know-about-the-hashes">Ok, so what do we know about the hashes?</h2>
<p>To recap Steve Weis’s post, the inputs are probably English phrases which mention Jerry Solinas, possibly someone else, and probably a counter. If you’re actually going for it I recommend reading Steve’s post in full.</p>
<p>The counter has to be there because only one in every 192 to 521 hashes is actually good to make a curve out of, depending the bit size of the curve. (This is because <a href="https://en.wikipedia.org/wiki/Prime_number_theorem?ref=words.filippo.io">one in every ln(N) numbers less than N is prime, for large enough N</a>.) There’s a <a href="https://www.wolframalpha.com/input?i2d=true&amp;i=Power%5B%5C%2840%291+-+Divide%5B1%2C521%5D%5C%2841%29%2Cx%5D+%3D+0.01&amp;ref=words.filippo.io">99% chance the counter is less than 2400 for the largest curve</a>, and less than 1175 for P-256.</p>
<p>The seeds for P-192 and P-256 appeared as examples in the previous ANSI X9.62 standard, while all the others were new in FIPS 186-2, so they might have been generated from differently structured sentences.</p>
<p>Since testing more hashes is nearly free, I recommend also targeting all the examples from ANSI X9.62 that didn’t make the FIPS standard, as well as the seeds for the binary curves in FIPS 186-2, although they are not included in the bounty. Here’s a recap.</p>
<pre><code>3045AE6FC8422F64ED579528D38120EAE12196D5 # NIST P-192, ANSI prime192v1
BD71344799D5C7FCDC45B59FA3B9AB8F6A948BC5 # NIST P-224
C49D360886E704936A6678E1139D26B7819F7E90 # NIST P-256, ANSI prime256v1
A335926AA319A27A1D00896A6773A4827ACDAC73 # NIST P-384
D09E8800291CB85396CC6717393284AAA0DA64BA # NIST P-521
31A92EE2029FD10D901B113E990710F0D21AC6B6 # ANSI prime192v2, not eligible for bounty
C469684435DEB378C4B65CA9591E2A5763059A2E # ANSI prime192v3, not eligible for bounty
E43BB460F0B80CC0C0B075798E948060F8321B7D # ANSI prime239v1, not eligible for bounty
E8B4011604095303CA3B8099982BE09FCB9AE616 # ANSI prime239v2, not eligible for bounty
7D7374168FFE3471B60A857686A19475D3BFA2FF # ANSI prime239v3, not eligible for bounty
85E25BFE5C86226CDB12016F7553F9D0E693A268 # NIST B-163, not eligible for bounty
74D59FF07F6B413D0EA14B344B20A2DB049B50C3 # NIST B-233, not eligible for bounty
77E2B07370EB0F832A6DD5B62DFC88CD06BB84BE # NIST B-283, not eligible for bounty
4099B5A457F9D69F79213D094C4BCD4D4262210B # NIST B-409, not eligible for bounty
2AA058F73A0E33AB486B0F610410C53A7F132310 # NIST B-571, not eligible for bounty
</code></pre>
<p>The format of the string is part of the mystery. It could end with a period or not, end with a newline or not, the counter could be decimal (with or without leading zeroes) or binary (16 or 32 bit), and it could come after the period or separated some other way. The same sentence with different counters could have been used to generate all the seeds, or they could be different sentences, or they could include the curve name or size. Human memory is notoriously fallible, so it could also be that some of the details in the second-hand recollections are wrong.</p>
<p>The good news is that SHA-1 is tremendously fast to bruteforce, and <em>YOU</em> are the experts in cracking passphrases you know nothing about.</p>
<h2 id="cool-what%E2%80%99s-the-fine-print">Cool, what’s the fine print?</h2>
<p>The bounty will pay out to the first person(s) to email the pre-seeds for the five prime-order NIST curves to <a href="mailto:seeds@filippo.io">seeds@filippo.io</a>.</p>
<p>Half the bounty ($6,144) will pay out to the first submission of <em>at least one</em> pre-seed, and the other half will pay out to the first submission of <em>all five</em> pre-seeds. They can of course go to the same person, so don’t wait to have them all to submit. Even one would make history.</p>
<p>If successful, you can either choose to receive the cash bounty, or select a U.S. 501(c)(3) charity to receive triple the amount. We reserve the right to veto charity choices dramatically incompatible with our values, but we won’t be jerks about it. If it’s not legally allowed for a U.S. person or Italian national to send money to you, you will have to select the charity option. You’re responsible for any taxes on the cash bounty. I fully trust every matcher, and I am guaranteeing the full amount of the bounty personally, so you don’t have to.</p>
<p>Put “ANTISPAM” in the subject line of any submission to hit my allowlisting rules. The Received header of my mail host will be the unappealable criterion of what submission arrived first.</p>
<p>The bounty expires if the seeds become publicly known, otherwise it’s valid until announced otherwise on this page. If the bounty is being cancelled or lowered, it will be announced six months in advance. (We don’t want anyone to feel cheated of their resources.)</p>
<p>We don’t actually care how you find the seeds. It can be bruteforcing, clever guessing, sleuth work tracking down NSA employees (don’t get arrested), or even recovering that old backup of when you used to work at NIST. If you don’t want us to, we won’t ask questions.</p>
<p>May the hashrate be ever in your favor, and let's fill out a page of cryptographic history.</p>
<p>For updates, you might want to <a href="https://bsky.app/profile/filippo.abyssdomain.expert?ref=words.filippo.io">follow me on Bluesky</a> or <a href="https://abyssdomain.expert/@filippo?ref=words.filippo.io">Mastodon</a>.</p>
<hr>
<section>
<ol>
<li id="fn1"><p>Not a typo for 512. There’s a very conveniently shaped prime at 2^521-1. We do typo that a lot in code. <a href="#fnref1">↩︎</a></p>
</li>
<li id="fn2"><p>The NSA's precedents, namely <a href="http://en.wikipedia.org/wiki/Dual_EC_DRBG?ref=words.filippo.io">Dual_EC_DRBG</a>, are why some people find the seeds suspicious. I find them reassuring. First, selecting weak seeds (which are just hash inputs, not "keys" like in Dual_EC_DRBG), would not be a <a href="https://en.wikipedia.org/wiki/NOBUS?ref=words.filippo.io">NOBUS backdoor</a>. Second, the Dual_EC_DRBG design immediately stuck out like a sore thumb and library authors had to be paid to implement it; this suggests the NSA is <em>kinda bad</em> at backdoors, not magical. <a href="#fnref2">↩︎</a></p>
</li>
<li id="fn3"><p>Rigidity is the design generalization of <a href="https://en.wikipedia.org/wiki/Nothing-up-my-sleeve_number?ref=words.filippo.io">nothing up my sleeves numbers</a>. The idea is that if you set your goals explicitly and then make only obvious and rational and optimal choices in a design, there is no wiggle room to pick intentionally weak outcomes. FWIW, I think rigidity is overrated: there is no such thing as an objectively best choice, and reasonable people disagree, and it’s possible to craft rational arguments for many different choices. Anyway, it’d be nice to settle the argument by bringing the NIST curves up in their level of rigidity by cracking the seeds. <a href="#fnref3">↩︎</a></p>
</li>
</ol>
</section>
<!--kg-card-end: markdown-->
        </section>
    </article></div>]]></description>
        </item>
        <item>
            <title><![CDATA[ChromeOS is Linux with Google’s desktop environment (114 pts)]]></title>
            <link>https://www.aboutchromebooks.com/news/now-more-than-ever-chromeos-is-linux-with-googles-desktop-environment/#google_vignette</link>
            <guid>37783081</guid>
            <pubDate>Thu, 05 Oct 2023 19:25:33 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.aboutchromebooks.com/news/now-more-than-ever-chromeos-is-linux-with-googles-desktop-environment/#google_vignette">https://www.aboutchromebooks.com/news/now-more-than-ever-chromeos-is-linux-with-googles-desktop-environment/#google_vignette</a>, See on <a href="https://news.ycombinator.com/item?id=37783081">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><p>Although not everyone knows it, ChromeOS is effectively a Linux distribution. That fact is effectively hidden and I can understand why: Linux can be a scary word to mainstream consumers. But there’s no denying the fact that ChromeOS is Linux. It uses a Linux kernel, hidden away by the graphical user interface, also known as a desktop environment. Between the <a href="https://www.aboutchromebooks.com/news/chromeos-117-release-adds-several-new-chromebook-features/" target="_blank" rel="noopener" title="ChromeOS 117 release adds several new Chromebook features">new Material You design</a> and move to <a href="https://www.aboutchromebooks.com/news/chromeos-116-may-begin-the-lacros-browser-push-to-chromebooks/" target="_blank" rel="noopener" title="ChromeOS 116 may begin the Lacros browser push to Chromebooks">break apart the Chrome browser from ChromeOS</a>, now more than ever, ChromeOS is Linux with Google’s desktop environment.</p><p>To help illustrate the point about desktop environments, it’s worth explaining what one actually is. Particularly when it comes to Linux systems.</p><p>When you install Linux, you choose a distribution. It could be Arch, Fedora, Debian, Ubuntu, or in my case, <a href="https://pop.system76.com/" target="_blank" rel="noopener">Pop OS!</a>. The distribution comes with a Linux kernel along with software and modifications for that particular distribution. Think of the kernel as the lowest level of software. It helps other software speak to the hardware to make a cohesive system. It’s what lets you browse your files through an application or the Terminal, for example.</p><p><span data-ez-name="aboutchromebooks_com-medrectangle-3"></span><span><span><img src="https://go.ezodn.com/utilcave_com/ezoicbwa.png" alt="Ezoic" loading="lazy" title="ezoic" name="?pageview_id=ecb46d62-204a-4e94-6acf-e0d78f5d4c25&amp;ad_position_id=187&amp;impression_group_id=aboutchromebooks_com-medrectangle-3/2023-10-05/8762120453988575&amp;ad_size=580x400&amp;domain_id=82556&amp;url=https://www.aboutchromebooks.com/news/now-more-than-ever-chromeos-is-linux-with-googles-desktop-environment/"></span></span></p><p>But that’s only part of the system. The other part is how you interact with it. Some people prefer to simply use the Terminal and command line for everything. And there’s a relatively steep learning curve involved with that approach. So there are graphical desktop environments to help with that. These visually show clickable folders, for example, or have an application launcher menu, among other things.</p><p>And there’s no lack of standard desktop environments available to Linux users, all of which are customizable. Here’s a gallery of just a few of them, for illustration:</p><figure><figure><img title="gnome-desktop - About Chromebooks" decoding="async" width="300" height="169" data-id="14395" src="https://www.aboutchromebooks.com/wp-content/uploads/2023/10/gnome-desktop-300x169.png" alt="ChromeOS is Linux with Google's desktop environment" data-ezsrcset="https://www.aboutchromebooks.com/wp-content/uploads/2023/10/gnome-desktop-300x169.png 300w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/gnome-desktop-150x84.png 150w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/gnome-desktop-768x432.png 768w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/gnome-desktop.png 1280w" sizes="(max-width: 300px) 100vw, 300px" ezimgfmt="rs rscb836 src ng ngcb835 srcset" data-ezsrc="https://www.aboutchromebooks.com/wp-content/uploads/2023/10/gnome-desktop-300x169.png" srcset="https://www.aboutchromebooks.com/wp-content/uploads/2023/10/gnome-desktop-300x169.png 300w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/gnome-desktop-150x84.png 150w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/gnome-desktop-768x432.png 768w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/gnome-desktop.png 1280w"><figcaption>GNOME</figcaption></figure><figure><img title="xfce-desktop - About Chromebooks" decoding="async" width="1280" height="720" data-id="14392" src="https://www.aboutchromebooks.com/wp-content/uploads/2023/10/xfce-desktop.png" alt="" data-ezsrcset="https://www.aboutchromebooks.com/wp-content/uploads/2023/10/xfce-desktop.png 1280w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/xfce-desktop-300x169.png 300w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/xfce-desktop-150x84.png 150w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/xfce-desktop-768x432.png 768w" sizes="(max-width: 1280px) 100vw, 1280px" ezimgfmt="rs rscb836 src ng ngcb835 srcset" data-ezsrc="https://www.aboutchromebooks.com/wp-content/uploads/2023/10/xfce-desktop.png" srcset="https://www.aboutchromebooks.com/wp-content/uploads/2023/10/xfce-desktop.png 1280w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/xfce-desktop-300x169.png 300w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/xfce-desktop-150x84.png 150w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/xfce-desktop-768x432.png 768w"><figcaption>XCFe</figcaption></figure><figure><img title="kde-desktop - About Chromebooks" decoding="async" loading="lazy" width="1280" height="720" data-id="14394" src="https://www.aboutchromebooks.com/wp-content/uploads/2023/10/kde-desktop.png" alt="" data-ezsrcset="https://www.aboutchromebooks.com/wp-content/uploads/2023/10/kde-desktop.png 1280w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/kde-desktop-300x169.png 300w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/kde-desktop-150x84.png 150w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/kde-desktop-768x432.png 768w" sizes="(max-width: 1280px) 100vw, 1280px" ezimgfmt="rs rscb836 src ng ngcb835 srcset" data-ezsrc="https://www.aboutchromebooks.com/wp-content/uploads/2023/10/kde-desktop.png" srcset="https://www.aboutchromebooks.com/wp-content/uploads/2023/10/kde-desktop.png 1280w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/kde-desktop-300x169.png 300w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/kde-desktop-150x84.png 150w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/kde-desktop-768x432.png 768w"><figcaption>KDE</figcaption></figure><figure><img title="unity-desktop - About Chromebooks" decoding="async" loading="lazy" width="1280" height="719" data-id="14393" src="https://www.aboutchromebooks.com/wp-content/uploads/2023/10/unity-desktop.png" alt="" data-ezsrcset="https://www.aboutchromebooks.com/wp-content/uploads/2023/10/unity-desktop.png 1280w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/unity-desktop-300x169.png 300w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/unity-desktop-150x84.png 150w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/unity-desktop-768x431.png 768w" sizes="(max-width: 1280px) 100vw, 1280px" ezimgfmt="rs rscb836 src ng ngcb835 srcset" data-ezsrc="https://www.aboutchromebooks.com/wp-content/uploads/2023/10/unity-desktop.png" srcset="https://www.aboutchromebooks.com/wp-content/uploads/2023/10/unity-desktop.png 1280w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/unity-desktop-300x169.png 300w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/unity-desktop-150x84.png 150w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/unity-desktop-768x431.png 768w"><figcaption>Unity</figcaption></figure></figure><p>While most Linux distributions come with a default desktop environment, users can install and choose from many others. You can’t do that on ChromeOS, which is why I say ChromeOS uses Google’s desktop environment. Choice would be nice here but I really do like the new Material You interface.</p><p><span data-ez-name="aboutchromebooks_com-medrectangle-4"></span><span><span><img src="https://go.ezodn.com/utilcave_com/ezoicbwa.png" alt="Ezoic" loading="lazy" title="ezoic" name="?pageview_id=ecb46d62-204a-4e94-6acf-e0d78f5d4c25&amp;ad_position_id=188&amp;impression_group_id=aboutchromebooks_com-medrectangle-4/2023-10-05/878417047957786&amp;ad_size=336x280&amp;domain_id=82556&amp;url=https://www.aboutchromebooks.com/news/now-more-than-ever-chromeos-is-linux-with-googles-desktop-environment/"></span></span></p><figure><img title="Material You quick settings - About Chromebooks" decoding="async" loading="lazy" width="1200" height="675" src="https://www.aboutchromebooks.com/wp-content/uploads/2023/02/Material-You-quick-settings-e1676301492285.jpg" alt="Material You Quick Settings in ChromeOS 114" data-ezsrcset="https://www.aboutchromebooks.com/wp-content/uploads/2023/02/Material-You-quick-settings-e1676301492285.jpg 1200w,https://www.aboutchromebooks.com/wp-content/uploads/2023/02/Material-You-quick-settings-e1676301492285-300x169.jpg 300w,https://www.aboutchromebooks.com/wp-content/uploads/2023/02/Material-You-quick-settings-e1676301492285-150x84.jpg 150w,https://www.aboutchromebooks.com/wp-content/uploads/2023/02/Material-You-quick-settings-e1676301492285-768x432.jpg 768w" sizes="(max-width: 1200px) 100vw, 1200px" ezimgfmt="rs rscb836 src ng ngcb835 srcset" data-ezsrc="https://www.aboutchromebooks.com/wp-content/uploads/2023/02/Material-You-quick-settings-e1676301492285.jpg" srcset="https://www.aboutchromebooks.com/wp-content/uploads/2023/02/Material-You-quick-settings-e1676301492285.jpg 1200w,https://www.aboutchromebooks.com/wp-content/uploads/2023/02/Material-You-quick-settings-e1676301492285-300x169.jpg 300w,https://www.aboutchromebooks.com/wp-content/uploads/2023/02/Material-You-quick-settings-e1676301492285-150x84.jpg 150w,https://www.aboutchromebooks.com/wp-content/uploads/2023/02/Material-You-quick-settings-e1676301492285-768x432.jpg 768w"></figure><h2>ChromeOS runs on Linux</h2><p>Going back to ChromeOS and the underlying system software for a second, it’s Linux. Google uses a customized version of Linux that you never see. Well, unless you turn on the Linux container, which gets you Debian Linux and a Terminal. Even though you can install Linux desktop applications for that container, you can’t use it to modify the Linux code that runs ChromeOS.</p><p>So it’s a bit locked down, particuarly compared to regular Linux. When I use Pop OS! for example, I have total control to change just about anything I want to.</p><p>Here’s a look at how I typically use that Linux machine on an ultra-wide monitor:</p><p><span data-ez-name="aboutchromebooks_com-box-4"></span><span><span><img src="https://go.ezodn.com/utilcave_com/ezoicbwa.png" alt="Ezoic" loading="lazy" title="ezoic" name="?pageview_id=ecb46d62-204a-4e94-6acf-e0d78f5d4c25&amp;ad_position_id=189&amp;impression_group_id=aboutchromebooks_com-box-4/2023-10-05/5772599447941272&amp;ad_size=250x250&amp;domain_id=82556&amp;url=https://www.aboutchromebooks.com/news/now-more-than-ever-chromeos-is-linux-with-googles-desktop-environment/"></span></span></p><figure><img title="IMG_2360 - About Chromebooks" decoding="async" loading="lazy" width="1280" height="960" src="https://www.aboutchromebooks.com/wp-content/uploads/2023/10/IMG_2360-1280x960.jpg" alt="" data-ezsrcset="https://www.aboutchromebooks.com/wp-content/uploads/2023/10/IMG_2360-1280x960.jpg 1280w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/IMG_2360-300x225.jpg 300w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/IMG_2360-150x113.jpg 150w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/IMG_2360-768x576.jpg 768w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/IMG_2360-1536x1152.jpg 1536w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/IMG_2360-2048x1536.jpg 2048w" sizes="(max-width: 1280px) 100vw, 1280px" ezimgfmt="rs rscb836 src ng ngcb835 srcset" data-ezsrc="https://www.aboutchromebooks.com/wp-content/uploads/2023/10/IMG_2360-1280x960.jpg" srcset="https://www.aboutchromebooks.com/wp-content/uploads/2023/10/IMG_2360-1280x960.jpg 1280w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/IMG_2360-300x225.jpg 300w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/IMG_2360-150x113.jpg 150w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/IMG_2360-768x576.jpg 768w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/IMG_2360-1536x1152.jpg 1536w,https://www.aboutchromebooks.com/wp-content/uploads/2023/10/IMG_2360-2048x1536.jpg 2048w"></figure><p>Note that when using applications, whether it’s just one or a dozen, all of the screen is being used. That’s because Pop OS! has a feature that automatically tiles my windows. When I open an application, the system reduces the size of another app and makes room for the new one.</p><p>I like this style of window management and although it’s not quite the same, ChromeOS does offer a bit of this. That’s the feature when you <a href="https://www.aboutchromebooks.com/news/chromeos-115-release-adds-several-new-chromebook-features/" target="_blank" rel="noopener" title="ChromeOS 115 release adds several new Chromebook features">click and hover on a window’s maximize button to select a window placement and size</a>.</p><figure><img title="ChromeOS 105 partial split - About Chromebooks" decoding="async" loading="lazy" width="1280" height="720" src="https://www.aboutchromebooks.com/wp-content/uploads/2022/07/ChromeOS-105-partial-split.jpg" alt="ChromeOS is trying to replicate some custom Linux desktop environment features" data-ezsrcset="https://www.aboutchromebooks.com/wp-content/uploads/2022/07/ChromeOS-105-partial-split.jpg 1280w,https://www.aboutchromebooks.com/wp-content/uploads/2022/07/ChromeOS-105-partial-split-300x169.jpg 300w,https://www.aboutchromebooks.com/wp-content/uploads/2022/07/ChromeOS-105-partial-split-150x84.jpg 150w,https://www.aboutchromebooks.com/wp-content/uploads/2022/07/ChromeOS-105-partial-split-768x432.jpg 768w" sizes="(max-width: 1280px) 100vw, 1280px" ezimgfmt="rs rscb836 src ng ngcb835 srcset" data-ezsrc="https://www.aboutchromebooks.com/wp-content/uploads/2022/07/ChromeOS-105-partial-split.jpg" srcset="https://www.aboutchromebooks.com/wp-content/uploads/2022/07/ChromeOS-105-partial-split.jpg 1280w,https://www.aboutchromebooks.com/wp-content/uploads/2022/07/ChromeOS-105-partial-split-300x169.jpg 300w,https://www.aboutchromebooks.com/wp-content/uploads/2022/07/ChromeOS-105-partial-split-150x84.jpg 150w,https://www.aboutchromebooks.com/wp-content/uploads/2022/07/ChromeOS-105-partial-split-768x432.jpg 768w"></figure><p>It’s not quite the same thing, of course. It is an attempt to bring some of Linux’s productivity features to ChromeOS, however.</p><p><span><span><img src="https://go.ezodn.com/utilcave_com/ezoicbwa.png" alt="Ezoic" loading="lazy" title="ezoic" name="?pageview_id=ecb46d62-204a-4e94-6acf-e0d78f5d4c25&amp;ad_position_id=190&amp;impression_group_id=aboutchromebooks_com-banner-1/2023-10-05/4765125825982371&amp;ad_size=300x250&amp;domain_id=82556&amp;url=https://www.aboutchromebooks.com/news/now-more-than-ever-chromeos-is-linux-with-googles-desktop-environment/"></span></span></p><h2>ChromeOS vs Linux</h2><p>With Google’s desktop environment and a limited but effective Linux software platform, I’ve started to question my own use of ChromeOS a little. Don’t get me wrong: ChromeOS is great at what it does. Google has smartly used Linux without scaring everyday people from using Linux. That’s a good thing.</p><p>However, my needs are changing a bit. I spend far more time in desktop applications than I used to. Most of that time is for my coding education. Yes, I do use the Linux version of Microsoft Visual Code on my Chromebook. And it works just as well as the same app on a traditional Linux or Windows machine. So I’m not giving anything up there.</p><figure><img title="Visual Studio code on Buster after Stretch restore - About Chromebooks" decoding="async" loading="lazy" width="1024" height="683" src="https://www.aboutchromebooks.com/wp-content/uploads/2020/03/Screenshot-2020-03-05-at-11.48.19-AM-1024x683.png" alt="ChromeOS runs Linux desktop applications just fine." data-ezsrcset="https://www.aboutchromebooks.com/wp-content/uploads/2020/03/Screenshot-2020-03-05-at-11.48.19-AM-1024x683.png 1024w,https://www.aboutchromebooks.com/wp-content/uploads/2020/03/Screenshot-2020-03-05-at-11.48.19-AM-300x200.png 300w,https://www.aboutchromebooks.com/wp-content/uploads/2020/03/Screenshot-2020-03-05-at-11.48.19-AM-768x512.png 768w,https://www.aboutchromebooks.com/wp-content/uploads/2020/03/Screenshot-2020-03-05-at-11.48.19-AM-1536x1024.png 1536w,https://www.aboutchromebooks.com/wp-content/uploads/2020/03/Screenshot-2020-03-05-at-11.48.19-AM-2048x1365.png 2048w" sizes="(max-width: 1024px) 100vw, 1024px" ezimgfmt="rs rscb836 src ng ngcb835 srcset" data-ezsrc="https://www.aboutchromebooks.com/wp-content/uploads/2020/03/Screenshot-2020-03-05-at-11.48.19-AM-1024x683.png" srcset="https://www.aboutchromebooks.com/wp-content/uploads/2020/03/Screenshot-2020-03-05-at-11.48.19-AM-1024x683.png 1024w,https://www.aboutchromebooks.com/wp-content/uploads/2020/03/Screenshot-2020-03-05-at-11.48.19-AM-300x200.png 300w,https://www.aboutchromebooks.com/wp-content/uploads/2020/03/Screenshot-2020-03-05-at-11.48.19-AM-768x512.png 768w,https://www.aboutchromebooks.com/wp-content/uploads/2020/03/Screenshot-2020-03-05-at-11.48.19-AM-1536x1024.png 1536w,https://www.aboutchromebooks.com/wp-content/uploads/2020/03/Screenshot-2020-03-05-at-11.48.19-AM-2048x1365.png 2048w"></figure><p>No, the fact that I can run Linux applications on a Chromebook is a bonus. And it keeps me productive, even if I run into the occasional challenge or limitation.</p><p><span data-ez-name="aboutchromebooks_com-large-leaderboard-2"></span><span><span><img src="https://go.ezodn.com/utilcave_com/ezoicbwa.png" alt="Ezoic" loading="lazy" title="ezoic" name="?pageview_id=ecb46d62-204a-4e94-6acf-e0d78f5d4c25&amp;ad_position_id=191&amp;impression_group_id=aboutchromebooks_com-large-leaderboard-2/2023-10-05/5800972367997400&amp;ad_size=250x250&amp;domain_id=82556&amp;url=https://www.aboutchromebooks.com/news/now-more-than-ever-chromeos-is-linux-with-googles-desktop-environment/"></span></span></p><p>It’s mainly the desktop environment aspect that has me using Linux more than ChromeOS lately.</p><p>That tiling window manager I mentioned is a huge part of it. I prefer to use all of a screen regardless of my computing activities. Having that happen automatically by the desktop environment is one less thing I need to do or manage.</p><p>Then there’s the customization aspect. Yes, with the Material You design, ChromeOS now sets the interface colors to correspond with or complement the colors from my desktop wallpaper. That’s nice but… it’s really just the bare minimum of customization.</p><p><span data-ez-name="aboutchromebooks_com-leader-1"></span><span><span><img src="https://go.ezodn.com/utilcave_com/ezoicbwa.png" alt="Ezoic" loading="lazy" title="ezoic" name="?pageview_id=ecb46d62-204a-4e94-6acf-e0d78f5d4c25&amp;ad_position_id=192&amp;impression_group_id=aboutchromebooks_com-leader-1/2023-10-05/441610223991752&amp;ad_size=250x250&amp;domain_id=82556&amp;url=https://www.aboutchromebooks.com/news/now-more-than-ever-chromeos-is-linux-with-googles-desktop-environment/"></span></span></p><p>On my Linux machines, I’ve customized the fonts, both globally and for certain applications where I want something different than my global default. I’ve added useful widgets and Menubar applications for quick info at a glance. And I’ve created custom keyboard shortcuts for the tasks I do the most. Granted, <a href="https://www.aboutchromebooks.com/news/custom-chromebook-keyboard-shortcuts-app/" target="_blank" rel="noopener" title="There’s a new app for custom Chromebook keyboard shortcuts (Updated)">that type of customiziation is coming to ChromeOS</a>, which I appreciate.</p><figure><img title="Keyboard-shortcuts - About Chromebooks" decoding="async" loading="lazy" width="1280" height="720" src="https://www.aboutchromebooks.com/wp-content/uploads/2023/06/Keyboard-shortcuts-1280x720.jpg" alt="Customzied keyboard shortcuts is one of the best hidden ChromeOS features on my Chromebook." data-ezsrcset="https://www.aboutchromebooks.com/wp-content/uploads/2023/06/Keyboard-shortcuts-1280x720.jpg 1280w,https://www.aboutchromebooks.com/wp-content/uploads/2023/06/Keyboard-shortcuts-300x169.jpg 300w,https://www.aboutchromebooks.com/wp-content/uploads/2023/06/Keyboard-shortcuts-150x84.jpg 150w,https://www.aboutchromebooks.com/wp-content/uploads/2023/06/Keyboard-shortcuts-768x432.jpg 768w,https://www.aboutchromebooks.com/wp-content/uploads/2023/06/Keyboard-shortcuts-1536x864.jpg 1536w,https://www.aboutchromebooks.com/wp-content/uploads/2023/06/Keyboard-shortcuts.jpg 1920w" sizes="(max-width: 1280px) 100vw, 1280px" ezimgfmt="rs rscb836 src ng ngcb835 srcset" data-ezsrc="https://www.aboutchromebooks.com/wp-content/uploads/2023/06/Keyboard-shortcuts-1280x720.jpg" srcset="https://www.aboutchromebooks.com/wp-content/uploads/2023/06/Keyboard-shortcuts-1280x720.jpg 1280w,https://www.aboutchromebooks.com/wp-content/uploads/2023/06/Keyboard-shortcuts-300x169.jpg 300w,https://www.aboutchromebooks.com/wp-content/uploads/2023/06/Keyboard-shortcuts-150x84.jpg 150w,https://www.aboutchromebooks.com/wp-content/uploads/2023/06/Keyboard-shortcuts-768x432.jpg 768w,https://www.aboutchromebooks.com/wp-content/uploads/2023/06/Keyboard-shortcuts-1536x864.jpg 1536w,https://www.aboutchromebooks.com/wp-content/uploads/2023/06/Keyboard-shortcuts.jpg 1920w"></figure><p>Effectively, I have no limitations when I use Linux. When I use ChromeOS, I am limited. By Google.</p><p>That’s not a bad thing for most people. Heck, I’d say that Google has created one of the most popularly used Linux implementations and that’s no small feat. I’m saying that the more my computing activities and preferences change, the more attractive a traditional Linux distribution is to me.</p><p><span><span><img src="https://go.ezodn.com/utilcave_com/ezoicbwa.png" alt="Ezoic" loading="lazy" title="ezoic" name="?pageview_id=ecb46d62-204a-4e94-6acf-e0d78f5d4c25&amp;ad_position_id=193&amp;impression_group_id=aboutchromebooks_com-large-mobile-banner-2/2023-10-05/1705468225922598&amp;ad_size=250x250&amp;domain_id=82556&amp;url=https://www.aboutchromebooks.com/news/now-more-than-ever-chromeos-is-linux-with-googles-desktop-environment/"></span></span></p><h2>ChromeOS should continue to embrace Linux</h2><p>I’ve said this before, both on the site and to people at Google: ChromeOS should really have some type of Linux desktop application store. Or at least a repository of Linux applications easily available from the Linux container on ChromeOS.</p><p>I get why Google pushed Android applications to ChromeOS in lieu of this. Android has a massive user base that’s familiar with the applications that run on Android phones and tablets. But after seven years of Android apps on ChromeOS, I think the net effect is negligible.</p><p>Put another way: When people ask me which Chromebook to buy for running Android apps, I tell them to reconsider the question. If the primary purpose is to run those Android apps, you’re better off using an Android phone or tablet because the software is optimized for those titles. Occasionally Android app use on a Chromebook is fine for most people but I wouldn’t say it’s a core strength of ChromeOS. It’s a bonus feature if you want to use it.</p><p><span data-ez-name="aboutchromebooks_com-leader-4"></span><span><span><img src="https://go.ezodn.com/utilcave_com/ezoicbwa.png" alt="Ezoic" loading="lazy" title="ezoic" name="?pageview_id=ecb46d62-204a-4e94-6acf-e0d78f5d4c25&amp;ad_position_id=194&amp;impression_group_id=aboutchromebooks_com-leader-4/2023-10-05/6665960897927523&amp;ad_size=300x250&amp;domain_id=82556&amp;url=https://www.aboutchromebooks.com/news/now-more-than-ever-chromeos-is-linux-with-googles-desktop-environment/"></span></span></p><figure><img title="libreoffice on a Chromebook in Linux - About Chromebooks" decoding="async" loading="lazy" width="880" height="587" src="https://www.aboutchromebooks.com/wp-content/uploads/2021/10/libreoffice-on-a-Chromebook-in-Linux.jpg" alt="LibreOffice for Linux on" data-ezsrcset="https://www.aboutchromebooks.com/wp-content/uploads/2021/10/libreoffice-on-a-Chromebook-in-Linux.jpg 880w,https://www.aboutchromebooks.com/wp-content/uploads/2021/10/libreoffice-on-a-Chromebook-in-Linux-300x200.jpg 300w,https://www.aboutchromebooks.com/wp-content/uploads/2021/10/libreoffice-on-a-Chromebook-in-Linux-768x512.jpg 768w" sizes="(max-width: 880px) 100vw, 880px" ezimgfmt="rs rscb836 src ng ngcb835 srcset" data-ezsrc="https://www.aboutchromebooks.com/wp-content/uploads/2021/10/libreoffice-on-a-Chromebook-in-Linux.jpg" srcset="https://www.aboutchromebooks.com/wp-content/uploads/2021/10/libreoffice-on-a-Chromebook-in-Linux.jpg 880w,https://www.aboutchromebooks.com/wp-content/uploads/2021/10/libreoffice-on-a-Chromebook-in-Linux-300x200.jpg 300w,https://www.aboutchromebooks.com/wp-content/uploads/2021/10/libreoffice-on-a-Chromebook-in-Linux-768x512.jpg 768w"></figure><p>Linux desktop apps, however, are built to run on a…well, a desktop computer. When I run them on a Chromebook, they run well, just like they do on my Pop OS! machines. I don’t have to worry about screen sizes, touchpoints, application resizing, etc…. it all just works.</p><p>It would take a fair amount of effort for Google to curate and maintain a Linux application store or repository. And other than potential customer satisfaction, there’s little in the effort for Google. Still, I think it would have more of a positive effect on ChromeOS than Android apps will. At least in the long run.</p><p>And it just might sway me to use ChromeOS more often than Linux these days. Particularly if the desktop environment were a little less locked down too.</p><p><span data-ez-name="aboutchromebooks_com-leader-2"></span><span><span><img src="https://go.ezodn.com/utilcave_com/ezoicbwa.png" alt="Ezoic" loading="lazy" title="ezoic" name="?pageview_id=ecb46d62-204a-4e94-6acf-e0d78f5d4c25&amp;ad_position_id=195&amp;impression_group_id=aboutchromebooks_com-leader-2/2023-10-05/2377892291921602&amp;ad_size=300x250&amp;domain_id=82556&amp;url=https://www.aboutchromebooks.com/news/now-more-than-ever-chromeos-is-linux-with-googles-desktop-environment/"></span></span></p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Test Anything Protocol (122 pts)]]></title>
            <link>https://testanything.org/</link>
            <guid>37783025</guid>
            <pubDate>Thu, 05 Oct 2023 19:21:42 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://testanything.org/">https://testanything.org/</a>, See on <a href="https://news.ycombinator.com/item?id=37783025">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
          

<p>TAP, the Test Anything Protocol, is a simple text-based interface between testing modules in a test harness. It decouples the reporting of errors from the presentation of the reports.</p>

<p>One of its major uses is for noise reduction; when you have a suite of many tests, making them TAP producers and using a TAP consumer to view them helps ensures that you will see everything you need to notice and diagnose breakage without being distracted by a flood of irrelevant success messages. It can assist other forms of analysis and statistics-gathering as well.</p>

<p>TAP started life as part of the test harness for Perl but now has implementations in C, C++, Python, PHP, Perl, Java, JavaScript, Go, Rust, and others.  Consumers and producers do not have to be written in the same language to interoperate.</p>

<p>Here’s what a TAP test stream looks like:</p>

<div><pre><code>1..4
ok 1 - Input file opened
not ok 2 - First line of the input valid
ok 3 - Read the rest of the file
not ok 4 - Summarized correctly # TODO Not written yet
</code></pre></div>

<h2 id="testing-with-tap">Testing with TAP</h2>

<ul>
  <li><a href="https://testanything.org/testing-with-tap">Testing with TAP</a> - How to run TAP based tests in your language of choice</li>
</ul>

<h2 id="tap-development">TAP Development</h2>

<ul>
  <li><a href="https://testanything.org/producers.html">TAP Producers</a> - Testing tools that generate TAP output</li>
  <li><a href="https://testanything.org/consumers.html">TAP Consumers</a> - Test harnesses that read TAP</li>
  <li><a href="https://testanything.org/philosophy.html">TAP Philosophy</a> - The Tao of TAP</li>
  <li><a href="https://testanything.org/history.html">TAP History</a> - The story of TAP</li>
</ul>

<h2 id="specifications">Specifications</h2>

<ul>
  <li><a href="https://testanything.org/tap-version-14-specification.html">TAP version 14 specification</a> (Current)</li>
  <li><a href="https://testanything.org/tap-version-13-specification.html">TAP version 13 specification</a></li>
  <li><a href="https://testanything.org/tap-specification.html">TAP specification</a></li>
</ul>

<h2 id="external-resources">External Resources</h2>

<ul>
  <li><a href="https://en.wikipedia.org/wiki/Test_Anything_Protocol">Wikipedia article on TAP</a></li>
  <li><a href="http://www.reddit.com/r/testanythingprotocol">The TAP subreddit</a></li>
</ul>


          </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[I’m not a programmer, and I used AI to build my first bot (137 pts)]]></title>
            <link>https://blog.replit.com/building-my-first-slack-bot</link>
            <guid>37782626</guid>
            <pubDate>Thu, 05 Oct 2023 18:57:21 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://blog.replit.com/building-my-first-slack-bot">https://blog.replit.com/building-my-first-slack-bot</a>, See on <a href="https://news.ycombinator.com/item?id=37782626">Hacker News</a></p>
Couldn't get https://blog.replit.com/building-my-first-slack-bot: Error: Request failed with status code 403]]></description>
        </item>
        <item>
            <title><![CDATA[Show HN: An app store just for installable web apps (358 pts)]]></title>
            <link>https://store.app</link>
            <guid>37782513</guid>
            <pubDate>Thu, 05 Oct 2023 18:50:10 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://store.app">https://store.app</a>, See on <a href="https://news.ycombinator.com/item?id=37782513">Hacker News</a></p>
&lt;Unparsable&gt;]]></description>
        </item>
        <item>
            <title><![CDATA[How fast are Linux pipes anyway? (2022) (380 pts)]]></title>
            <link>https://mazzo.li/posts/fast-pipes.html</link>
            <guid>37782493</guid>
            <pubDate>Thu, 05 Oct 2023 18:49:29 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://mazzo.li/posts/fast-pipes.html">https://mazzo.li/posts/fast-pipes.html</a>, See on <a href="https://news.ycombinator.com/item?id=37782493">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="wrapper">



<div>
<p>In this post, we will explore how Unix pipes are implemented in Linux by iteratively optimizing a test program that writes and reads data through a pipe.<a href="#fn1" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>We will begin with a simple program with a throughput of around 3.5GiB/s, and improve its performance twentyfold. The improvements will be informed by profiling the program using Linux’s <a href="https://en.wikipedia.org/wiki/Perf_(Linux)"><code>perf</code> tooling</a>.<a href="#fn2" id="fnref2" role="doc-noteref"><sup>2</sup></a> The code <a href="https://github.com/bitonic/pipes-speed-test">is available on GitHub</a>.</p>
<div>
<figure>
<img src="https://mazzo.li/assets/images/fast-pipe-chart.svg" alt="Chart showing the performance of our pipe test programs.">

</figure>
</div>
<!--
This exercise won't be of much practical use --- we shouldn't be using pipes for high-performance inter-process communication anyway. However, it will shed some light on common themes when dealing with IO and the kernel, and on how one can go about identifying what's slow.
-->
<p>The post was inspired by reading <a href="https://codegolf.stackexchange.com/questions/215216/high-throughput-fizz-buzz/236630#236630">a highly optimized FizzBuzz program</a>, which pushes output to a pipe at a rate of ~35GiB/s on my laptop.<a href="#fn3" id="fnref3" role="doc-noteref"><sup>3</sup></a> Our first goal will be to match that speed, explaining every step as we go along. We’ll also add an additional performance-improving measure, which is not needed in FizzBuzz since the bottleneck is actually computing the output, not IO, at least on my machine.</p>
<p>We will proceed as follows:</p>
<ol type="1">
<li><a href="#first-version">A first slow version of our pipe test bench;</a></li>
<li><a href="#trouble-with-write">How pipes are implemented internally, and why writing and reading from them is slow;</a></li>
<li><a href="#splicing">How the <code>vmsplice</code> and <code>splice</code> syscalls let us get around some (but not all!) of the slowness;</a></li>
<li><a href="#paging">A description of Linux paging, leading up to a faster version using huge pages;</a></li>
<li><a href="#busy-loop">The final optimization, replacing polling with busy looping;</a></li>
<li><a href="#closing-thoughts">Some closing thoughts.</a></li>
</ol>
<p>Section 4 is the heaviest on Linux kernel internals, so it might be interesting even if you’re familiar with the other topics treated in the post. For readers not familiar with the topics treated, only basic knowledge of C is assumed.</p>
<p>Let’s begin!</p>
</div>
<section role="doc-endnotes">
<ol>
<li id="fn1" role="doc-endnote"><p>This will be similar in style to my <a href="https://mazzo.li/posts/vectorized-atan2.html"><code>atan2f</code> performance investigation</a>, although the program in question will only be useful for learning.</p>
<p>Moreover, we will optimize code at a different level. While tuning <code>atan2f</code> consisted in micro-optimizations guided by the assembly output, tuning our pipe program will involve looking at <code>perf</code> events and reducing various sorts of kernel overhead.<a href="#fnref1" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>The tests were run on an Intel Skylake i7-8550U CPU, and on Linux 5.17.</p>
<p>Your mileage <em>will</em> vary, since the Linux internals that power the programs described in this post have been under constant change for the past couple of years, and will probably continue to be tweaked in future releases. Keep reading for more details!<a href="#fnref2" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p>“FizzBuzz” is an allegedly common coding interview question.</p>
<p>The details are not relevant to this blog post, but they are explained in the link. I have personally never been asked it, but I have it on good authority that it does happen!<a href="#fnref3" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<h2 id="first-version">The challenge, and a slow first version <a href="#first-version">#</a></h2>
<div>
<p>First of all, let’s start with measuring the performance of <a href="https://codegolf.stackexchange.com/questions/215216/high-throughput-fizz-buzz/236630#236630">the fabled FizzBuzz program</a>, following the rules laid down by the StackOverflow post:</p>
<pre><code>% ./fizzbuzz | pv &gt;/dev/null
 422GiB 0:00:16 [36.2GiB/s]</code></pre>
<p><code>pv</code> is “pipe viewer”, <a href="http://www.ivarch.com/programs/pv.shtml">a handy utility</a> to measure the throughput of data flowing through a pipe. So <code>fizzbuzz</code> is producing output at a rate of 36GiB/s.</p>
<p><code>fizzbuzz</code> writes the output in blocks as big as the L2 cache, to strike a good balance between cheap access to memory and minimizing IO overhead.</p>
</div>
<div>
<p>On my machine, the L2 cache is 256KiB. Throughout this post, we’ll also output blocks of 256KiB, but without “computing” anything. Essentially, we’ll try to measure the upper bound for programs writing to a pipe with a reasonable buffer size.<a href="#fn4" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<p>While <code>fizzbuzz</code> uses <code>pv</code> to measure speed, our setup will be slightly different: we’ll implement the programs on both ends of the pipe. This is so that we fully control the code involved in pushing and pulling data from the pipe.</p>
</div>
<section role="doc-endnotes">
<ol start="4">
<li id="fn4" role="doc-endnote"><p>While we fix the buffer size, the numbers are actually not wildly different if we use different buffer sizes, given that other bottlenecks kick in.<a href="#fnref4" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<div>
<p>The code is available <a href="https://github.com/bitonic/pipes-speed-test">in my <code>pipes-speed-test</code> repo</a>. <code>write.cpp</code> implements the writing, and <code>read.cpp</code> the reading. <code>write</code> repeatedly writes the same 256KiB forever. <code>read</code> reads through 10GiB of data and terminates, printing the throughput in GiB/s. Both executables accept a variety of command line options to change their behavior.</p>
<p>The first attempt at reading and writing from pipes will be using the <a href="https://linux.die.net/man/2/write"><code>write</code></a> and <a href="https://linux.die.net/man/2/read"><code>read</code></a> syscalls, using the same buffer size as <code>fizzbuzz</code>. Here’s a view of the writing end:</p>
</div>
<div id="cb2"><pre><code><span id="cb2-1"><span>int</span> main<span>()</span> <span>{</span></span>
<span id="cb2-2">  <span>size_t</span> buf_size <span>=</span> <span>1</span> <span>&lt;&lt;</span> <span>18</span><span>;</span> <span>// 256KiB</span></span>
<span id="cb2-3">  <span>char</span><span>*</span> buf <span>=</span> <span>(</span><span>char</span><span>*)</span> malloc<span>(</span>buf_size<span>);</span></span>
<span id="cb2-4">  memset<span>((</span><span>void</span><span>*)</span>buf<span>,</span> <span>'X'</span><span>,</span> buf_size<span>);</span> <span>// output Xs</span></span>
<span id="cb2-5">  <span>while</span> <span>(</span><span>true</span><span>)</span> <span>{</span></span>
<span id="cb2-6">    <span>size_t</span> remaining <span>=</span> buf_size<span>;</span></span>
<span id="cb2-7">    <span>while</span> <span>(</span>remaining <span>&gt;</span> <span>0</span><span>)</span> <span>{</span></span>
<span id="cb2-8">      <span>// Keep invoking `write` until we've written the entirety</span></span>
<span id="cb2-9">      <span>// of the buffer. Remember that write returns how much</span></span>
<span id="cb2-10">      <span>// it could write into the destination -- in this case,</span></span>
<span id="cb2-11">      <span>// our pipe.</span></span>
<span id="cb2-12">      <span>ssize_t</span> written <span>=</span> write<span>(</span></span>
<span id="cb2-13">        STDOUT_FILENO<span>,</span> buf <span>+</span> <span>(</span>buf_size <span>-</span> remaining<span>),</span> remaining</span>
<span id="cb2-14">      <span>);</span></span>
<span id="cb2-15">      remaining <span>-=</span> written<span>;</span></span>
<span id="cb2-16">    <span>}</span></span>
<span id="cb2-17">  <span>}</span></span>
<span id="cb2-18"><span>}</span></span></code></pre></div>
<div>
<p>This snippet and following ones omit all error checking for brevity.<a href="#fn5" id="fnref5" role="doc-noteref"><sup>5</sup></a> The <code>memset</code> ensures that the output will be printable, but also plays another role, as we’ll discuss later.</p>
<p>The work is all done by the <code>write</code> call, the rest is making sure that the whole buffer is written. The read end is very similar, but <code>read</code>ing data into <code>buf</code>, and terminating when enough has been read.</p>
<p>After building, the code from the repo can be run as follows:</p>
</div>
<section role="doc-endnotes">
<ol start="5">
<li id="fn5" role="doc-endnote"><p>Feel free to refer to <a href="https://github.com/bitonic/pipes-speed-test">the repo</a> for the gory details.</p>
<p>More generally, I won’t reproduce the code verbatim here, since the details are unimportant. I will instead post snippets of code representative of what is going on.<a href="#fnref5" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<pre><code>% ./write | ./read
3.7GiB/s, 256KiB buffer, 40960 iterations (10GiB piped)</code></pre>
<p>We’re writing the same 256KiB buffer filled with <code>'X'</code>s 40960 times, and measuring the throughput. What’s worrying is that we’re 10 times slower than <code>fizzbuzz</code>! And we’re not doing any work, just writing bytes to the pipe.</p>
<p>It turns out that we can’t get much faster than this by using <code>write</code> and <code>read</code>.</p>
<h2 id="trouble-with-write">The trouble with <code>write</code> <a href="#trouble-with-write">#</a></h2>
<div>
<p>To find out what our program is spending time on, we can use <a href="https://en.wikipedia.org/wiki/Perf_(Linux)"><code>perf</code></a>:<a href="#fn6" id="fnref6" role="doc-noteref"><sup>6</sup></a> <a href="#fn7" id="fnref7" role="doc-noteref"><sup>7</sup></a></p>
<pre><code>% perf record -g sh -c './write | ./read'
3.2GiB/s, 256KiB buffer, 40960 iterations (10GiB piped)
[ perf record: Woken up 6 times to write data ]
[ perf record: Captured and wrote 2.851 MB perf.data (21201 samples) ]</code></pre>
<p>The <code>-g</code> instructs perf to record call graphs: this will allow us to take a top-down look at where time is being spent.</p>
<p>We can take a look at where time is spent using <code>perf report</code>. Here is a lightly redacted excerpt, breaking down where <code>write</code> spends its time:<a href="#fn8" id="fnref8" role="doc-noteref"><sup>8</sup></a></p>
<pre><code>% perf report -g --symbol-filter=write
-   48.05%     0.05%  write    libc-2.33.so       [.] __GI___libc_write
   - 48.04% __GI___libc_write
      - 47.69% entry_SYSCALL_64_after_hwframe
         - do_syscall_64
            - 47.54% ksys_write
               - 47.40% vfs_write
                  - 47.23% new_sync_write
                     - pipe_write
                        + 24.08% copy_page_from_iter
                        + 11.76% __alloc_pages
                        + 4.32% schedule
                        + 2.98% __wake_up_common_lock
                          0.95% _raw_spin_lock_irq
                          0.74% alloc_pages
                          0.66% prepare_to_wait_event
</code></pre>
<p>47% of the time is spent in <code>pipe_write</code>, which is what <code>write</code> resolves to if we’re writing to a pipe. This is not surprising — we’re spending roughly half of the time writing, and the other half reading.</p>
<p>Within <code>pipe_write</code>, 3/4 of the time is spent copying or allocating pages (<code>copy_page_from_iter</code> and <code>__alloc_pages</code>). If we already have an idea of how communication between the kernel and userspace works this might make some sense. Regardless, to fully understand what’s happening we must first understand how pipes work.</p>
</div>
<section role="doc-endnotes">
<ol start="6">
<li id="fn6" role="doc-endnote"><p>Note that here we’re profiling a shell invocation including both the pipe reading and writing — <code>perf record</code> follows all child processes by default.<a href="#fnref6" role="doc-backlink">↩︎</a></p></li>
<li id="fn7" role="doc-endnote"><p>When profiling this program, I noticed that the <code>perf</code> output was being polluted by information from the <a href="https://facebookmicrosites.github.io/psi/docs/overview">“Pressure Stall Information” infrastructure (PSI)</a>.</p>
<p>Therefore the numbers are taken from a kernel compiled with PSI disabled. This can be achieved by putting <code>CONFIG_PSI=n</code> in the kernel build configuration. In NixOS:</p>
<pre><code>boot.kernelPatches = [{
  name = "disable-psi";
  patch = null;
  extraConfig = '' 
    PSI n 
  '';
}];</code></pre>
<p>Moreover, the kernel debug symbols must be present for <code>perf</code> to correctly show where time is spent while in syscalls. How to install the symbols varies from distro to distro. In recent NixOS versions they are installed by default.<a href="#fnref7" role="doc-backlink">↩︎</a></p></li>
<li id="fn8" role="doc-endnote"><p>In <code>perf report</code> you can use <code>+</code> to expand a call graph, assuming you ran <code>perf record -g</code>.<a href="#fnref8" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<h3 id="what-are-pipes-made-of">What are pipes made of? <a href="#what-are-pipes-made-of">#</a></h3>
<p>The data structure holding a pipe can be found in <a href="https://github.com/torvalds/linux/blob/f443e374ae131c168a065ea1748feac6b2e76613/include/linux/pipe_fs_i.h#L34"><code>include/linux/pipe_fs_i.h</code></a>, and the operations on it in <a href="https://github.com/torvalds/linux/blob/f443e374ae131c168a065ea1748feac6b2e76613/fs/pipe.c"><code>fs/pipe.c</code></a>.</p>
<p>A Linux pipe is a <a href="https://en.wikipedia.org/wiki/Circular_buffer">ring buffer</a> holding references to pages where the data is written to and read from:</p>
<p><img src="https://mazzo.li/assets/images/fast-pipes-pipe-ring.png"></p>
<p>In the image above the ring buffer has 8 slots, but we might have more or less, the default being 16. Each page is 4KiB on x86-64, but might be of different sizes on other architectures. In total, this pipe can hold at most 32KiB of data. This is a key point: every pipe has an upper bound on the total amount of data it can hold before it’s full.</p>
<p>The shaded part of the diagram represents the current pipe data, the non-shaded part the empty space in the pipe.</p>
<p>Somewhat counterintuitively, <code>head</code> stores the write-end of the pipe. That is, writers will write into the buffer pointed at by <code>head</code>, and increase <code>head</code> accordingly if they need to move onto the next buffer. Within the write buffer, <code>len</code> stores how much we’ve written in it.</p>
<p>Conversely, <code>tail</code> stores the read-end of the pipe: readers will start consuming the pipe from there. <code>offset</code> indicates where to start reading from.</p>
<p>Note that <code>tail</code> can appear <em>after</em> <code>head</code>, like in the picture, since we’re working with a circular/ring buffer. Also note that some slots might be unused when we haven’t filled the pipe completely — the <code>NULL</code> cells in the middle. If the pipe is full (no <code>NULL</code>s and no free space in the pages), <code>write</code> will block. If the pipe is empty (all <code>NULL</code>s), <code>read</code> will block.</p>
<p>Here’s an abridged version of the C data structures in <a href="https://github.com/torvalds/linux/blob/f443e374ae131c168a065ea1748feac6b2e76613/include/linux/pipe_fs_i.h#L34"><code>pipe_fs_i.h</code></a>:</p>
<div id="cb7"><pre><code><span id="cb7-1"><span>struct</span> pipe_inode_info <span>{</span></span>
<span id="cb7-2">  <span>unsigned</span> <span>int</span> head<span>;</span></span>
<span id="cb7-3">  <span>unsigned</span> <span>int</span> tail<span>;</span></span>
<span id="cb7-4">  <span>struct</span> pipe_buffer <span>*</span>bufs<span>;</span></span>
<span id="cb7-5"><span>};</span></span>
<span id="cb7-6"></span>
<span id="cb7-7"><span>struct</span> pipe_buffer <span>{</span></span>
<span id="cb7-8">  <span>struct</span> page <span>*</span>page<span>;</span></span>
<span id="cb7-9">  <span>unsigned</span> <span>int</span> offset<span>,</span> len<span>;</span></span>
<span id="cb7-10"><span>};</span></span></code></pre></div>
<p>We’re omitting many fields here, and we’re not explainining what <code>struct page</code> contains yet, but this is the key data structure to understanding how reading and writing from a pipe happens.</p>
<h3 id="reading-and-writing-to-pipes">Reading and writing to pipes <a href="#reading-and-writing-to-pipes">#</a></h3>
<p>Let’s now go to <a href="https://github.com/torvalds/linux/blob/f443e374ae131c168a065ea1748feac6b2e76613/fs/pipe.c#L416">the definition of <code>pipe_write</code></a>, to try and make sense of the <code>perf</code> output shown before.</p>
<p>Here is a simplified explanation of how <code>pipe_write</code> works:</p>
<ol type="1">
<li>If the pipe is already full, <a href="https://github.com/torvalds/linux/blob/f443e374ae131c168a065ea1748feac6b2e76613/fs/pipe.c#L561">wait for space</a> and restart;</li>
<li>If the buffer currently pointed at by <code>head</code> has space, <a href="https://github.com/torvalds/linux/blob/f443e374ae131c168a065ea1748feac6b2e76613/fs/pipe.c#L457">fill that space first</a>;</li>
<li><a href="https://github.com/torvalds/linux/blob/f443e374ae131c168a065ea1748feac6b2e76613/fs/pipe.c#L577">While there’s free slots</a>, and <a href="https://github.com/torvalds/linux/blob/f443e374ae131c168a065ea1748feac6b2e76613/fs/pipe.c#L542">there are remaining bytes to write</a>, <a href="https://github.com/torvalds/linux/blob/f443e374ae131c168a065ea1748feac6b2e76613/fs/pipe.c#L496">allocate new pages</a> and <a href="https://github.com/torvalds/linux/blob/f443e374ae131c168a065ea1748feac6b2e76613/fs/pipe.c#L532">fill them</a>, updating <code>head</code>.</li>
</ol>
<div>
<figure>
<img src="https://mazzo.li/assets/images/write-to-pipe.svg" alt="What happens to a pipe when we write to it.">

</figure>
</div>
<div>
<p>The operations described above are protected by a lock, which <code>pipe_write</code> <a href="https://github.com/torvalds/linux/blob/2c85ebc57b3e1817b6ce1a6b703928e113a90442/fs/pipe.c#L416">acquires</a> and releases as necessary.</p>
<p><code>pipe_read</code> is the mirror image of <code>pipe_write</code>, except that we consume pages, free them when we’ve fully read them, and update <code>tail</code>.<a href="#fn9" id="fnref9" role="doc-noteref"><sup>9</sup></a></p>
<p>So, we now have a quite unpleasant picture of what is going on:</p>
<ul>
<li>We copy each page twice, once from user memory to the kernel, and back again to the kernel to user memory;</li>
<li>The copying is done one 4KiB page at a time, interspersed with other activity, such as the synchronization between read and write, and page allocation and freeing;</li>
<li>We are working with memory that might not be contiguous, since we’re constantly allocating new pages;</li>
<li>We’re acquiring and releasing the pipe lock.</li>
</ul>
<p>On this machine, sequential RAM reading clocks at around 16GiB/s:</p>
</div>
<section role="doc-endnotes">
<ol start="9">
<li id="fn9" role="doc-endnote"><p>One single “spare page” called <code>tmp_page</code> is actually kept around by <code>pipe_read</code>, and reused by <code>pipe_write</code>.</p>
<p>However, since this is always only a single page, I couldn’t leverage it to achieve higher performance given that the page reuse is counteracted by fixed overhead when calling <code>pipe_write</code> and <code>pipe_read</code>.<a href="#fnref9" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<pre><code>% sysbench memory --memory-block-size=1G --memory-oper=read --threads=1 run
...
102400.00 MiB transferred (15921.22 MiB/sec)</code></pre>
<p>Given all the fiddliness listed above, a 4x slowdown compared to single-threaded sequential RAM speed is not that surprising.</p>
<p>Tweaking the buffer size or the pipe size to reduce the amount of syscall and synchronization overhead, or tuning other parameters will not get us very far. Luckily, there is a way to get around the slowness of <code>write</code> and of <code>read</code> altogether.</p>
<h2 id="splicing">Splicing to the rescue <a href="#splicing">#</a></h2>
<p>This copying of buffers from user memory to the kernel and back is a frequent thorn in the side of people needing to do fast IO. One common solution is to just cut the kernel out of the picture and perform IO operations directly. For example we might interact directly with a network card and bypass the kernel for low-latency networking.</p>
<p>In general when we write to a socket, or a file, or in our case a pipe, we’re first writing to a buffer somewhere in the kernel, and then let the kernel do its work. In the case of pipes, the pipe <em>is</em> a series of buffers in the kernel. All this copying is undesirable if we’re in the business of performance.</p>
<div>
<p>Luckily, Linux includes system calls to speed things up when we want to move data to and from pipes, without copying. Specifically:</p>
<ul>
<li><a href="https://man7.org/linux/man-pages/man2/splice.2.html"><code>splice</code></a> moves data from a pipe to a file descriptor, and vice-versa.</li>
<li><a href="https://man7.org/linux/man-pages/man2/vmsplice.2.html"><code>vmsplice</code></a> moves data from user memory into a pipe.<a href="#fn10" id="fnref10" role="doc-noteref"><sup>10</sup></a></li>
</ul>
<p>Crucially, both operations work without copying anything.</p>
<p>Now that we know how pipes work, we can already vaguely imagine how the two operations function: they just “grab” an existing buffer from somewhere and put it into the pipe ring buffer, or the reverse, rather than allocating new pages as needed:</p>
<p><img src="https://mazzo.li/assets/images/vmsplice-intuition.svg"></p>
</div>
<section role="doc-endnotes">
<ol start="10">
<li id="fn10" role="doc-endnote"><p>Technically, <code>vmsplice</code> also supports transferring data in the other direction, although not in a useful way. As the <a href="https://man7.org/linux/man-pages/man2/vmsplice.2.html">man page</a> states:</p>
<blockquote>
<p><code>vmsplice</code> really supports true splicing only from user memory to a pipe. In the opposite direction, it actually just copies the data to user space.</p>
</blockquote>
<a href="#fnref10" role="doc-backlink">↩︎</a></li>
</ol>
</section>
<p>We’ll soon see exactly how this works.</p>
<h3 id="splicing-in-practice">Splicing in practice <a href="#splicing-in-practice">#</a></h3>
<p>Let’s replace <code>write</code> with <code>vmsplice</code>. This is the signature for <code>vmsplice</code>:</p>
<div id="cb9"><pre><code><span id="cb9-1"><span>struct</span> iovec <span>{</span></span>
<span id="cb9-2">  <span>void</span>  <span>*</span>iov_base<span>;</span> <span>// Starting address</span></span>
<span id="cb9-3">  <span>size_t</span> iov_len<span>;</span>  <span>// Number of bytes</span></span>
<span id="cb9-4"><span>};</span></span>
<span id="cb9-5"></span>
<span id="cb9-6"><span>// Returns how much we've spliced into the pipe</span></span>
<span id="cb9-7"><span>ssize_t</span> vmsplice<span>(</span></span>
<span id="cb9-8">  <span>int</span> fd<span>,</span> <span>const</span> <span>struct</span> iovec <span>*</span>iov<span>,</span> <span>size_t</span> nr_segs<span>,</span> <span>unsigned</span> <span>int</span> flags</span>
<span id="cb9-9"><span>);</span></span></code></pre></div>
<div>
<p><code>fd</code> is the target pipe, <code>struct iovec *iov</code> is an array of buffers we’ll be moving to the pipe. Note that <code>vmsplice</code> returns how much was “spliced” into the pipe, which might not be the full amount, much like how <code>write</code> returns how much was written. Remember that pipes are bounded by how many slots they have in the ring buffer, and <code>vmsplice</code> is not exempt from this restriction.</p>
<p>We also need to be a bit careful when using <code>vmsplice</code>. Since the user memory is moved to the pipe without copying, we must ensure that the read-end consumes it before we can reuse the spliced buffer.</p>
<p>For this reason <code>fizzbuzz</code> uses a double buffering scheme, which works as follows:</p>
<ol type="1">
<li>Split the 256KiB buffer in two;</li>
<li>Set the pipe size to 128KiB, this will have the effect of setting the pipe ring buffer to have 128KiB/4KiB = 32 slots;</li>
<li>Alternate between writing to the first half-buffer and using <code>vmsplice</code> to move it to the pipe and doing the same with the other half.</li>
</ol>
<p>The fact that the pipe size is set to 128KiB, and that we wait for <code>vmsplice</code> to fully output one 128KiB buffer, ensures that by the time we’re done with one iteration of <code>vmsplice</code> we <em>know</em> that the the previous buffer has been fully read — otherwise we would not have been able to fully <code>vmsplice</code> the new 128KiB buffer into the 128KiB pipe.</p>
<p>Now, we’re not actually writing anything to the buffers, but we’ll keep the double buffering scheme since a similar scheme would be required for any program actually writing content.<a href="#fn11" id="fnref11" role="doc-noteref"><sup>11</sup></a></p>
<p>Our write loop now looks something like this:</p>
</div>
<section role="doc-endnotes">
<ol start="11">
<li id="fn11" role="doc-endnote"><p>Travis Downs <a href="https://news.ycombinator.com/item?id=31596169">pointed out</a> that this scheme might still be unsafe, since the page could be spliced further, therefore extending its lifetime. This problem is also present in the original FizzBuzz post.</p>
<p>It’s actually not entirely clear to me whether <code>vmsplice</code> without <code>SPLICE_F_GIFT</code> is actually unsafe — the man page for <code>vmsplice</code> implies it shouldn’t be. However, it’s definitely the case that particular care is needed to achieve zero copy piping while maintaining safety.</p>
<p>In the test program the reading end splices the pipe into <code>/dev/null</code>, so it could be that the kernel knows that the pages can be spliced without copying, but I have not verified whether this is what’s actually happening.<a href="#fnref11" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<div id="cb10"><pre><code><span id="cb10-1"><span>int</span> main<span>()</span> <span>{</span></span>
<span id="cb10-2">  <span>size_t</span> buf_size <span>=</span> <span>1</span> <span>&lt;&lt;</span> <span>18</span><span>;</span> <span>// 256KiB</span></span>
<span id="cb10-3">  <span>char</span><span>*</span> buf <span>=</span> malloc<span>(</span>buf_size<span>);</span></span>
<span id="cb10-4">  memset<span>((</span><span>void</span><span>*)</span>buf<span>,</span> <span>'X'</span><span>,</span> buf_size<span>);</span> <span>// output Xs</span></span>
<span id="cb10-5">  <span>char</span><span>*</span> bufs<span>[</span><span>2</span><span>]</span> <span>=</span> <span>{</span> buf<span>,</span> buf <span>+</span> buf_size<span>/</span><span>2</span> <span>};</span></span>
<span id="cb10-6">  <span>int</span> buf_ix <span>=</span> <span>0</span><span>;</span></span>
<span id="cb10-7">  <span>// Flip between the two buffers, splicing until we're done.</span></span>
<span id="cb10-8">  <span>while</span> <span>(</span><span>true</span><span>)</span> <span>{</span></span>
<span id="cb10-9">    <span>struct</span> iovec bufvec <span>=</span> <span>{</span></span>
<span id="cb10-10">      <span>.</span>iov_base <span>=</span> bufs<span>[</span>buf_ix<span>],</span></span>
<span id="cb10-11">      <span>.</span>iov_len <span>=</span> buf_size<span>/</span><span>2</span></span>
<span id="cb10-12">    <span>};</span></span>
<span id="cb10-13">    buf_ix <span>=</span> <span>(</span>buf_ix <span>+</span> <span>1</span><span>)</span> <span>%</span> <span>2</span><span>;</span></span>
<span id="cb10-14">    <span>while</span> <span>(</span>bufvec<span>.</span>iov_len <span>&gt;</span> <span>0</span><span>)</span> <span>{</span></span>
<span id="cb10-15">      <span>ssize_t</span> ret <span>=</span> vmsplice<span>(</span>STDOUT_FILENO<span>,</span> <span>&amp;</span>bufvec<span>,</span> <span>1</span><span>,</span> <span>0</span><span>);</span></span>
<span id="cb10-16">      bufvec<span>.</span>iov_base <span>=</span> <span>(</span><span>void</span><span>*)</span> <span>(((</span><span>char</span><span>*)</span> bufvec<span>.</span>iov_base<span>)</span> <span>+</span> ret<span>);</span></span>
<span id="cb10-17">      bufvec<span>.</span>iov_len <span>-=</span> ret<span>;</span></span>
<span id="cb10-18">    <span>}</span></span>
<span id="cb10-19">  <span>}</span></span>
<span id="cb10-20"><span>}</span></span></code></pre></div>
<p>Here are the results writing with <code>vmsplice</code>, rather than <code>write</code>:</p>
<pre><code>% ./write --write_with_vmsplice | ./read
12.7GiB/s, 256KiB buffer, 40960 iterations (10GiB piped)</code></pre>
<p>This reduces by half the amount of copying we need to do, and already improves our througput more than threefold — to 12.7GiB/s. Changing the read end to use <code>splice</code>, we eliminate all copying, and get another 2.5x speedup:</p>
<pre><code>% ./write --write_with_vmsplice | ./read --read_with_splice
32.8GiB/s, 256KiB buffer, 40960 iterations (10GiB piped)</code></pre>
<h2 id="paging">Fishing for pages <a href="#paging">#</a></h2>
<p>What next? Let’s ask <code>perf</code>:</p>
<pre><code>% perf record -g sh -c './write --write_with_vmsplice | ./read --read_with_splice'
33.4GiB/s, 256KiB buffer, 40960 iterations (10GiB piped)
[ perf record: Woken up 1 times to write data ]
[ perf record: Captured and wrote 0.305 MB perf.data (2413 samples) ]
% perf report --symbol-filter=vmsplice
-   49.59%     0.38%  write    libc-2.33.so       [.] vmsplice
   - 49.46% vmsplice
      - 45.17% entry_SYSCALL_64_after_hwframe
         - do_syscall_64
            - 44.30% __do_sys_vmsplice
               + 17.88% iov_iter_get_pages
               + 16.57% __mutex_lock.constprop.0
                 3.89% add_to_pipe
                 1.17% iov_iter_advance
                 0.82% mutex_unlock
                 0.75% pipe_lock
        2.01% __entry_text_start
        1.45% syscall_return_via_sysret</code></pre>
<div>
<p>The lion’s share of the time is taken by locking the pipe for writing (<code>__mutex_lock.constprop.0</code>), and by moving the pages into the pipe (<code>iov_iter_get_pages</code>). There isn’t so much we can do about the locking, but we <em>can</em> improve the performance of <code>iov_iter_get_pages</code>.</p>
<p>As the name suggests, <code>iov_iter_get_pages</code> turns the <code>struct iovec</code>s we feed into <code>vmsplice</code> into <code>struct page</code>s to put into the pipe. To understand what this function actually does, and how to speed it up, we must first take a detour into how the CPU and Linux organize pages.</p>
</div>
<h3 id="a-whirlwind-tour-of-paging">A whirlwind tour of paging <a href="#a-whirlwind-tour-of-paging">#</a></h3>
<div>
<p>As you might be aware of, processes do not refer to locations in RAM directly: instead, the are assigned <em>virtual</em> memory addresses, which get resolved to <em>physical</em> addresses. This abstraction is known as <a href="https://en.wikipedia.org/wiki/Virtual_memory"><em>virtual memory</em></a>, and has all sorts of advantages we won’t cover here — the most obvious being that it significantly simplifies running multiple processes competing for the same physical memory.</p>
<p>In any case, whenever we execute a program and we load/store from/to memory, the CPU needs to convert our virtual address to a physical address. Storing a mapping from every virtual address to every corresponding physical address would be impratical. Therefore memory is split up in uniformly sized chunks, called <em>pages</em>, and virtual pages are mapped to physical pages:<a href="#fn12" id="fnref12" role="doc-noteref"><sup>12</sup></a></p>
<p><img src="https://mazzo.li/assets/images/virtual-phsyical.svg"></p>
<p>There’s nothing special about 4KiB: each architecture picks a size, based on various tradeoffs — some of which we’ll soon explore.</p>
<p>To make this a bit more precise, let’s imagine allocating 10000 bytes using <code>malloc</code>:</p>
<div id="cb14"><pre><code><span id="cb14-1"><span>void</span><span>*</span> buf <span>=</span> malloc<span>(</span><span>10000</span><span>);</span></span>
<span id="cb14-2">printf<span>(</span><span>"%p</span><span>\n</span><span>"</span><span>,</span> buf<span>);</span>          <span>// 0x6f42430</span></span></code></pre></div>
</div>
<section role="doc-endnotes">
<ol start="12">
<li id="fn12" role="doc-endnote"><p>Here we’re presenting a simplified model where physical memory is a simple flat, linear sequence. Reality is <a href="https://lwn.net/Articles/789304/">a bit more complicated</a>, but the simple model will do for our purposes.<a href="#fnref12" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<div>
<p>As we use them, our 10k bytes will look contiguous in virtual memory, but will be mapped to 3 not necessarily contiguous physical pages:<a href="#fn13" id="fnref13" role="doc-noteref"><sup>13</sup></a></p>
<p><img src="https://mazzo.li/assets/images/example-allocation.svg"></p>
</div>
<section role="doc-endnotes">
<ol start="13">
<li id="fn13" role="doc-endnote"><p>You can inspect the physical address assigned to the current process’ virtual pages by reading <code>/proc/self/pagemap</code>, <a href="https://mazzo.li/posts/check-huge-page.html">as illustrated in a previous post on this blog</a>, and multiplying the “page frame number” by the page size.<a href="#fnref13" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<div>
<p>One of the tasks of the kernel is to manage this mapping, which is embodied in a data structure called the <em>page table</em>. The CPU specifies how the page table looks (since it needs to understand it), and the kernel manipulates it as needed. On x86-64 the page table is a 4-level, 512-way tree, which itself lives in memory.<a href="#fn14" id="fnref14" role="doc-noteref"><sup>14</sup></a> Each node of this tree is (you guessed it!) 4KiB wide, with each entry within the node leading to the next level being 8 bytes (4KiB/8bytes = 512). The entries contain the address of the next node, along with other metadata.</p>
<p>We have one page table per process — or in other words, each process has a reserved virtual address space. When the kernel context-switches to a process, it sets the special register CR3 to the <em>physical</em> address of the root of this tree.<a href="#fn15" id="fnref15" role="doc-noteref"><sup>15</sup></a> Then whenever a virtual address needs to be converted to a physical address, the CPU splits up the address in sections, and uses them to walk this tree and compute the physical address.</p>
<p>To make these concepts less abstract, here’s a visual depiction of how the virtual address <code>0x0000f2705af953c0</code> might be resolved to a physical address:</p>
<p><img src="https://mazzo.li/assets/images/virtual-address-resolution.svg"></p>
</div>
<section role="doc-endnotes">
<ol start="14">
<li id="fn14" role="doc-endnote"><p>Intel extended the page table to consist of <a href="https://en.wikipedia.org/wiki/Intel_5-level_paging">5 levels</a> starting from Ice Lake, thereby increasing the maximum addressable memory from 256TiB to 128PiB. However this capability has to explicitly enabled, since some programs rely on the upper 16 bits of pointers to be unused.<a href="#fnref14" role="doc-backlink">↩︎</a></p></li>
<li id="fn15" role="doc-endnote"><p>The addresses within the page table must be physical, otherwise we’d have infinite loop on our hands.<a href="#fnref15" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<div>
<p>The search starts from the first level, called the “page global directory”, or PGD, the physical location of which is stored in CR3. The first 16 bits of the address are unused.<a href="#fn16" id="fnref16" role="doc-noteref"><sup>16</sup></a> We use the next 9 bits the PGD entry, and traverse down to the second level, “page upper directory”, or PUD. The next 9 bits are used to select an entry from the PUD. The process repeats for the next two levels, PMD (“page middle directory”), and PTE (“page table entry”). The PTE tells where the actual physical page we’re looking for is, and then we use the last 12 bits to find the offset inside the page.</p>
<p>The sparse structure of the page table allows the mapping to be gradually built up as new pages are needed. Whenever a process needs memory, the page table will be updated with a new entry by the kernel.</p>
</div>
<section role="doc-endnotes">
<ol start="16">
<li id="fn16" role="doc-endnote"><p>Note that the highest 16 bits are unused: this means that each process can address at most <span>2^{48}-1</span> bytes, or 256TiB, of physical memory.<a href="#fnref16" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<h3 id="the-role-of-struct-page">The role of <code>struct page</code> <a href="#the-role-of-struct-page">#</a></h3>
<div>
<p>The <code>struct page</code> data structure is a key piece of this machinery: it is what the kernel uses to refer to a single <em>physical</em> page, storing its physical address and all sorts of other metadata about it.<a href="#fn17" id="fnref17" role="doc-noteref"><sup>17</sup></a> For instance we can get a <code>struct page</code> from the information contained in the PTE (the last level of the page table described above). In general it is used pervasively in all code handling page-related matters.</p>
<p>In the case of pipes, <code>struct page</code> is used to hold their data in the ring buffer, as we’re already seen:</p>
<div id="cb15"><pre><code><span id="cb15-1"><span>struct</span> pipe_inode_info <span>{</span></span>
<span id="cb15-2">  <span>unsigned</span> <span>int</span> head<span>;</span></span>
<span id="cb15-3">  <span>unsigned</span> <span>int</span> tail<span>;</span></span>
<span id="cb15-4">  <span>struct</span> pipe_buffer <span>*</span>bufs<span>;</span></span>
<span id="cb15-5"><span>};</span></span>
<span id="cb15-6"></span>
<span id="cb15-7"><span>struct</span> pipe_buffer <span>{</span></span>
<span id="cb15-8">  <span>struct</span> page <span>*</span>page<span>;</span></span>
<span id="cb15-9">  <span>unsigned</span> <span>int</span> offset<span>,</span> len<span>;</span></span>
<span id="cb15-10"><span>};</span></span></code></pre></div>
</div>
<section role="doc-endnotes">
<ol start="17">
<li id="fn17" role="doc-endnote"><p><code>struct page</code> might also refer to yet-to-be-allocated physical pages, which do not have a physical address yet, and other page-related abstractions. Think of them as fairly abstract references to physical pages, but not necessarily references to an <em>allocated</em> physical page.</p>
<p>This subtle point will be relevant in a later sidenote 🫠.<a href="#fnref17" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<p>However, <code>vmsplice</code> accepts <em>virtual</em> memory as input, while <code>struct page</code> refers to <em>physical</em> memory directly.</p>
<p>Therefore we need turn arbitrary chunks of virtual memory into a bunch of <code>struct page</code>s. This is exactly what <a href="https://github.com/torvalds/linux/blob/f443e374ae131c168a065ea1748feac6b2e76613/lib/iov_iter.c#L1518"><code>iov_iter_get_pages</code></a> does, and where we’re spending half of our time:</p>
<div id="cb16"><pre><code><span id="cb16-1"><span>ssize_t</span> iov_iter_get_pages<span>(</span></span>
<span id="cb16-2">  <span>struct</span> iov_iter <span>*</span>i<span>,</span>  <span>// input: a sized buffer in virtual memory</span></span>
<span id="cb16-3">  <span>struct</span> page <span>**</span>pages<span>,</span> <span>// output: the list of pages which back the input buffers</span></span>
<span id="cb16-4">  <span>size_t</span> maxsize<span>,</span>      <span>// maximum number of bytes to get</span></span>
<span id="cb16-5">  <span>unsigned</span> maxpages<span>,</span>   <span>// maximum number of pages to get</span></span>
<span id="cb16-6">  <span>size_t</span> <span>*</span>start        <span>// offset into first page, if the input buffer wasn't page-aligned</span></span>
<span id="cb16-7"><span>);</span></span></code></pre></div>
<p><code>struct iov_iter</code> is a Linux kernel data structure representing various ways of walking through chunks of memory, including <code>struct iovec</code>. In our case, it will point to a 128KiB buffer. <code>vmsplice</code> will use <code>iov_iter_get_pages</code> to turn the input buffer into a bunch of <code>struct page</code>s, and hold on to them. Now that you know how paging works, you might vaguely imagine how <code>iov_iter_get_pages</code> works as well, but we’ll explain it in detail in the next section.</p>
<p>We’ve rapidly gone through a lot of new concepts, so to recap:</p>
<ul>
<li>Modern CPUs use virtual memory for their processes;</li>
<li>Memory is organized in regularly-sized pages;</li>
<li>The CPU translates virtual addresses into physical addresses using a page table mapping virtual pages to physical pages;</li>
<li>The kernel adds and removes entries to the page table as necessary;</li>
<li>Pipes are made out of references to physical pages, so <code>vmsplice</code> must convert virtual memory ranges into physical pages, and hold on to them.</li>
</ul>
<h3 id="the-cost-of-getting-pages">The cost of getting pages <a href="#the-cost-of-getting-pages">#</a></h3>
<div>
<p>The time spent in <code>iov_iter_get_pages</code> is really entirely spent in another function, <code>get_user_pages_fast</code>:</p>
<pre><code>% perf report -g --symbol-filter=iov_iter_get_pages
-   17.08%     0.17%  write    [kernel.kallsyms]  [k] iov_iter_get_pages
   - 16.91% iov_iter_get_pages
      - 16.88% internal_get_user_pages_fast
           11.22% try_grab_compound_head
</code></pre>
<p><a href="https://github.com/torvalds/linux/blob/f443e374ae131c168a065ea1748feac6b2e76613/mm/gup.c#L2944"><code>get_user_pages_fast</code></a> is a more bare-bones version of <code>iov_iter_get_pages</code>:</p>
<div id="cb18"><pre><code><span id="cb18-1"><span>int</span> get_user_pages_fast<span>(</span></span>
<span id="cb18-2">  <span>// virtual address, page aligned</span></span>
<span id="cb18-3">  <span>unsigned</span> <span>long</span> start<span>,</span></span>
<span id="cb18-4">  <span>// number of pages to retrieve</span></span>
<span id="cb18-5">  <span>int</span> nr_pages<span>,</span></span>
<span id="cb18-6">  <span>// flags, the meaning of which we won't get into</span></span>
<span id="cb18-7">  <span>unsigned</span> <span>int</span> gup_flags<span>,</span></span>
<span id="cb18-8">  <span>// output physical pages</span></span>
<span id="cb18-9">  <span>struct</span> page <span>**</span>pages</span>
<span id="cb18-10"><span>)</span></span></code></pre></div>
<p>Here “user” (as opposed to “kernel”) refers to the fact that we’re turning virtual pages into references to physical pages.</p>
<p>To get our <code>struct page</code>s, <code>get_user_pages_fast</code> does exactly what the CPU would do, but in software: it walks the page table to collect all the physical pages, storing the results in <code>struct page</code>s. In our case, we have a 128KiB buffer, and 4KiB pages, so we’ll have <code>nr_pages = 32</code>.<a href="#fn18" id="fnref18" role="doc-noteref"><sup>18</sup></a> <code>get_user_pages_fast</code> will need to walk the page table tree collecting 32 leaves, and storing the result in 32 <code>struct page</code>s.</p>
<p><code>get_user_pages_fast</code> also needs to make sure that the physical page is not repurposed until the caller doesn’t need it anymore. This is achieved in the kernel using a reference count <a href="https://github.com/torvalds/linux/blob/f443e374ae131c168a065ea1748feac6b2e76613/include/linux/mm_types.h#L187">stored in <code>struct page</code></a>, which is used to know when a physical page can be released and repurposed in the future. The caller of <code>get_user_pages_fast</code> must, at some point, release the pages again with <a href="https://github.com/torvalds/linux/blob/f443e374ae131c168a065ea1748feac6b2e76613/include/linux/mm.h#L1222"><code>put_page</code></a>, which will decrease the reference count.</p>
<p>Finally, <code>get_user_pages_fast</code> behaves differently depending on whether virtual addresses are already in the page table. This is where the <code>_fast</code> suffix comes from: the kernel will first try to get an already existing page table entry and corresponding <code>struct page</code> by just walking the page table, which is relatively cheap, and fall back to producing a <code>struct page</code> by other, more expensive means otherwise. The fact that we <code>memset</code> the memory at the beginning will ensure that we never end up in the “slow” path of <code>get_user_pages_fast</code>, since the page table entries will be created as our buffer is filled with <code>'X'</code>s.<a href="#fn19" id="fnref19" role="doc-noteref"><sup>19</sup></a></p>
<p>Note that the <code>get_user_pages</code> family of functions is not only useful for pipes — in fact, it is central in many drivers. A typical use is related to the kernel bypass we mentioned: a driver for a network card might use it to turn some user memory region into a physical page, then communicate the physical page location to the network card, and have the network card interact directly with that memory region without kernel involvement.</p>
</div>
<section role="doc-endnotes">
<ol start="18">
<li id="fn18" role="doc-endnote"><p>Actually, the pipe code <a href="https://github.com/torvalds/linux/blob/f443e374ae131c168a065ea1748feac6b2e76613/fs/splice.c#L1174">happens to always call <code>get_user_pages_fast</code> with <code>nr_pages = 16</code></a>, looping if necessary, presumably so that a small static buffer can be used. But it is an implementation detail, and the total number of spliced pages will still be 32.<a href="#fnref18" role="doc-backlink">↩︎</a></p></li>
<li id="fn19" role="doc-endnote"><p>Subtleties follow, not needed to understand the rest of the post!</p>
<p>If the page table does not contain the entry we’re looking for, <code>get_user_pages_fast</code> still needs to return a <code>struct page</code>. The most obvious way to do so would be to create the right page table entry, and then return the corresponding <code>struct page</code>.</p>
<p>However <code>get_user_pages_fast</code> will only do so if it’s asked to get <code>struct page</code> for the purpose of writing into it. Otherwise it will <em>not</em> update the page table, instead returning a <code>struct page</code> giving us a reference to a yet-to-be-allocated physical page. This is exactly what happens in the case of <code>vmsplice</code>, since we just need to produce a <code>struct page</code> for the purpose of filling the pipe, without actually writing any memory.</p>
<p>Or in other words, allocating the page is delayed until we actually need to. This saves allocating the physical page, but will cause the slow path of <code>get_user_pages_fast</code> to be called repeatedly if the page is never faulted in by other means.</p>
<p>Therefore, if we do <em>not</em> <code>memset</code> before, and therefore do not fault the pages into the page table “manually”, not only we would end up in the slow path the first time we call <code>get_user_pages_fast</code>, but also all successive invocations, resulting in a significant slowdown (25GiB/s rather than 30GiB/s):</p>
<pre><code>% ./write --write_with_vmsplice --dont_touch_pages | ./read --read_with_splice
25.0GiB/s, 256KiB buffer, 40960 iterations (10GiB piped)</code></pre>
<p>Moreover, this behavior does <em>not</em> manifest itself when using huge pages: in that case <code>get_user_pages_fast</code> <em>will</em> properly fault the pages in when the virtual memory range passed in would be backed by huge pages.</p>
<p>If this is all very confusing, don’t worry, <code>get_user_pages</code> and friends seem to be a very tricky corner of the kernel, <a href="https://lwn.net/Kernel/Index/#Memory_management-get_user_pages">even for</a> <a href="https://github.com/torvalds/linux/blob/f443e374ae131c168a065ea1748feac6b2e76613/Documentation/core-api/pin_user_pages.rst">kernel developers</a>.<a href="#fnref19" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<h3 id="huge-pages">Huge pages <a href="#huge-pages">#</a></h3>
<div>
<p>Up to now we’ve presented pages as always being of the same size — 4KiB on x86-64. However, many CPU architectures, including x86-64, include larger page sizes. In the case of x86-64, we not only have 4KiB pages (the “standard” size), but also 2MiB and even 1GiB pages (“huge” pages). In the rest of the post we’ll only deal with 2MiB huge pages, since 1GiB pages are fairly uncommon, and overkill for our task anyway.</p>
<div>
<table>
<thead>
<tr>
<th>Architecture</th>
<th>Smallest page size</th>
<th>Larger page sizes</th>
</tr>
</thead>
<tbody>
<tr>
<td>x86</td>
<td>4KiB</td>
<td>2MiB, 4MiB</td>
</tr>
<tr>
<td>x86-64</td>
<td>4KiB</td>
<td>2MiB, 1GiB<a href="#fn20" id="fnref20" role="doc-noteref"><sup>20</sup></a></td>
</tr>
<tr>
<td>ARMv7</td>
<td>4KiB</td>
<td>64KiB, 1MiB, 16MiB</td>
</tr>
<tr>
<td>ARMv8</td>
<td>4KiB</td>
<td>16KiB, 64KiB</td>
</tr>
<tr>
<td>RISCV32</td>
<td>4KiB</td>
<td>4MiB</td>
</tr>
<tr>
<td>RISCV64</td>
<td>4KiB</td>
<td>2MiB, 1GiB, 512GiB, 256 TiB</td>
</tr>
<tr>
<td>Power ISA</td>
<td>8KiB</td>
<td>64 KiB, 16 MiB, 16 GiB</td>
</tr>
</tbody>
</table>
<p><small>Page sizes available on architectures commonly used today, from <a href="https://en.wikipedia.org/wiki/Page_(computer_memory)#Multiple_page_sizes">Wikipedia</a>.</small></p>
</div>
<p>The main advantage of huge pages is that bookkeeping is cheaper, since there’s fewer of them needed to cover the same amount of memory. Moreover other operations are cheaper too, such as resolving a virtual address to a physical address, since one level less of page table is needed: instead of having a 12-bit offset into the page, we’ll have a 21-bit offset, and one less page table level.</p>
</div>
<section role="doc-endnotes">
<ol start="20">
<li id="fn20" role="doc-endnote"><p>Only when the CPU has <code>PDPE1GB</code> flag.<a href="#fnref20" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<div>
<p>This relieves pressure on the parts of the CPUs that handle this conversion, leading to performance improvements in many circumstances.<a href="#fn21" id="fnref21" role="doc-noteref"><sup>21</sup></a> However, in our case, the pressure is not on the hardware that walks the page table, but on its software counterpart which runs in the kernel.</p>
<p>On Linux, we can allocate a 2MiB huge page <a href="https://mazzo.li/posts/check-huge-page.html">in a variety of ways</a>, such as by allocating memory aligned to 2MiB and then using <code>madvise</code> to tell the kernel to use huge pages for the provided buffer:</p>
<div id="cb20"><pre><code><span id="cb20-1"><span>void</span><span>*</span> buf <span>=</span> aligned_alloc<span>(</span><span>1</span> <span>&lt;&lt;</span> <span>21</span><span>,</span> size<span>);</span></span>
<span id="cb20-2">madvise<span>(</span>buf<span>,</span> size<span>,</span> MADV_HUGEPAGE<span>)</span></span></code></pre></div>
<p>Switching to huge pages in our program yields another ~50% improvement:</p>
<pre><code>% ./write --write_with_vmsplice --huge_page | ./read --read_with_splice
51.0GiB/s, 256KiB buffer, 40960 iterations (10GiB piped)</code></pre>
</div>
<section role="doc-endnotes">
<ol start="21">
<li id="fn21" role="doc-endnote"><p>For instance, the CPU includes dedicated hardware to cache parts of the page table, the “translation lookaside buffer” (TLB). The TLB is flushed at every context switch (every time we change the contents of CR3).</p>
<p>Huge pages can significantly reduce TLB misses, since a single entry for a 2MiB page covers 512 times more memory compared to a 4KiB page.<a href="#fnref21" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<div>
<p>However, the reason for the improvements is not totally obvious. Naively, we might think that by using huge pages <code>struct page</code> will just refer to a 2MiB page, rather than 4KiB.</p>
<p>Sadly this is <em>not</em> the case: the kernel code assumes everywhere that a <code>struct page</code> refers to a page of the “standard” size for the current architecture. The way this works for huge pages (and in general for what Linux calls “compound pages”) is that a “head” <code>struct page</code> contains the actual information about the backing physical page, with successive “tail” pages just containing a pointer to the head page.</p>
<p>So to represent 2MiB huge page we’ll have 1 “head” <code>struct page</code>, and up to 511 “tail” <code>struct page</code>s. Or in the case of our 128KiB buffer, 31 tail <code>struct page</code>s:<a href="#fn22" id="fnref22" role="doc-noteref"><sup>22</sup></a></p>
<p><img src="https://mazzo.li/assets/images/head-tail-pages.svg"></p>
<p>Even if we need all these <code>struct page</code>s, the code generating it ends up significantly faster. Instead of traversing the page table multiple times, once the first entry is found, the following <code>struct page</code>s can be <a href="https://github.com/torvalds/linux/blob/f443e374ae131c168a065ea1748feac6b2e76613/mm/gup.c#L2457">generated in a simple loop</a>. Hence the performance improvement!</p>
</div>
<section role="doc-endnotes">
<ol start="22">
<li id="fn22" role="doc-endnote"><p>If you’re thinking “that’s horrible!”, you’re not alone.</p>
<p>Various efforts are underway to simplify and/or optimize this situation.</p>
<p>Recent kernels (from 5.17 onwards) <a href="https://lwn.net/Articles/849538/">include a new type</a>, <code>struct folio</code>, identifying head pages explicitly. This reduces the need for checking whether a <code>struct page</code> is a head page or tail page at runtime, yielding performance improvements.</p>
<p><a href="https://lwn.net/Articles/839737/">Other efforts</a> aim to outright remove the extra <code>struct page</code>s, although I’m not up to date on how that is going.<a href="#fnref22" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<h2 id="busy-loop">Busy looping <a href="#busy-loop">#</a></h2>
<p>We’re almost done, I promise! Let’s look at <code>perf</code> output once again:</p>
<pre><code>-   46.91%     0.38%  write    libc-2.33.so       [.] vmsplice
   - 46.84% vmsplice
      - 43.15% entry_SYSCALL_64_after_hwframe
         - do_syscall_64
            - 41.80% __do_sys_vmsplice
               + 14.90% wait_for_space
               + 8.27% __wake_up_common_lock
                 4.40% add_to_pipe
               + 4.24% iov_iter_get_pages
               + 3.92% __mutex_lock.constprop.0
                 1.81% iov_iter_advance
               + 0.55% import_iovec
            + 0.76% syscall_exit_to_user_mode
        1.54% syscall_return_via_sysret
        1.49% __entry_text_start
</code></pre>
<p>We’re now spending a significant amount of time waiting for the pipe to be writeable (<code>wait_for_space</code>), and waking up readers which were waiting for the pipe to have content (<code>__wake_up_common_lock</code>).</p>
<p>To sidestep these synchronization costs, we can ask <code>vmsplice</code> to return if the pipe cannot be written to, and busy loop until it is — and the same when reading with <code>splice</code>:</p>
<div id="cb23"><pre><code><span id="cb23-1"><span>...</span></span>
<span id="cb23-2"><span>// SPLICE_F_NONBLOCK will cause `vmsplice` to return immediately</span></span>
<span id="cb23-3"><span>// if we can't write to the pipe, returning EAGAIN</span></span>
<span id="cb23-4"><span>ssize_t</span> ret <span>=</span> vmsplice<span>(</span>STDOUT_FILENO<span>,</span> <span>&amp;</span>bufvec<span>,</span> <span>1</span><span>,</span> SPLICE_F_NONBLOCK<span>);</span></span>
<span id="cb23-5"><span>if</span> <span>(</span>ret <span>&lt;</span> <span>0</span> <span>&amp;&amp;</span> errno <span>==</span> EAGAIN<span>)</span> <span>{</span></span>
<span id="cb23-6">  <span>continue</span><span>;</span> <span>// busy loop if not ready to write</span></span>
<span id="cb23-7"><span>}</span></span>
<span id="cb23-8"><span>...</span></span></code></pre></div>
<p>By busy looping we get another 25% performance increase:</p>
<pre><code>% ./write --write_with_vmsplice --huge_page --busy_loop | ./read --read_with_splice --busy_loop
62.5GiB/s, 256KiB buffer, 40960 iterations (10GiB piped)</code></pre>
<p>Obviously busy looping comes at the cost of fully occupying a CPU core waiting for <code>vmsplice</code> to be ready. But often this compromise is worth it, and in fact it is a common pattern for high-performance server applications: we trade off possibly wasteful CPU utilization for better latency and/or throughput.</p>
<p>In our case, this concludes our optimization journey for our little synthetic benchmark, from 3.5GiB/s to 65GiB/s.</p>
<h2 id="closing-thoughts">Closing thoughts <a href="#closing-thoughts">#</a></h2>
<p>We’ve systematically improved the performance of our program by looking at the <code>perf</code> output and the Linux source. Pipes and splicing in particular aren’t really hot topics when it comes to high-performance programming, but the themes we’ve touched upon are: zero-copy operations, ring buffers, paging &amp; virtual memory, synchronization overhead.</p>
<p>There are some details and interesting topics I left out, but this blog post was already spiraling out of control and becoming too long:</p>
<ul>
<li><p>In the actual code, the buffers are allocated separatedly, to reduce page table contention by placing them in different page table entries (something that the FizzBuzz program also does).</p>
<p>Remember that when a page table entry is taken with <code>get_user_pages</code>, its refcount is increased, and decreased on <code>put_page</code>. If we use two page table entries for the two buffers, rather than one page table entry for both of them, we have less contention when modifying the refcount.</p></li>
<li><p>The tests are ran by pinning the <code>./write</code> and <code>./read</code> processes to two cores with <code>taskset</code>.</p></li>
<li><p>The code in the repo contains many other options I played with, but did not end up talking about since they were irrelevant or not interesting enough.</p></li>
<li><p>The repo also contains <a href="https://github.com/bitonic/pipes-speed-test/blob/master/get-user-pages.cpp">a synthetic benchmark</a> for <code>get_user_pages_fast</code>, which can be used to measure exactly how much slower it runs with or without huge pages.</p></li>
<li><p>Splicing in general is a slightly dubious/<a href="https://dirtypipe.cm4all.com/">dangerous</a> concept, <a href="https://lwn.net/Articles/896267/">which continues to annoy</a> to kernel developers.</p></li>
</ul>
<p>Please let me know if this post was helpful, interesting, or unclear!</p>
<h2 id="acknowledgements">Acknowledgements <a href="#acknowledgements">#</a></h2>
<p>Many thanks to <a href="https://scvalex.net/">Alexandru Scvorţov</a>, Max Staudt, Alex Appetiti, Alex Sayers, Stephen Lavelle, Peter Cawley, and Niklas Hambüchen for reviewing drafts of this post. Max Staudt also helped me understand some subtleties of <code>get_user_pages</code>.</p>






</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[U.S. federal price tag for the post-9/11 wars is over $8T (136 pts)]]></title>
            <link>https://watson.brown.edu/costsofwar/figures/2021/BudgetaryCosts</link>
            <guid>37782218</guid>
            <pubDate>Thu, 05 Oct 2023 18:30:24 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://watson.brown.edu/costsofwar/figures/2021/BudgetaryCosts">https://watson.brown.edu/costsofwar/figures/2021/BudgetaryCosts</a>, See on <a href="https://news.ycombinator.com/item?id=37782218">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>

                      <p><img src="https://watson.brown.edu/costsofwar/files/cow/imce/figures/2021/Screen%20Shot%202021-08-31%20at%202.08.46%20PM.png" width="662" height="349"></p>
<p><strong>U.S. BUDGETARY COSTS</strong>&nbsp;<span>The vast economic impact of the U.S. post-9/11 wars goes beyond the Pentagon's "Overseas Contigency Operations" (War) budget. This chart and the attached paper estimate the more comprehensive budgetary costs of the wars.</span><em> <em>Posted on September 1, 2021.</em></em></p>
<h2><a href="https://watson.brown.edu/costsofwar/figures/2021/WarDeathToll">SEE Human Costs Data</a></h2>          
                      <ul>
                                                          <li><a href="https://watson.brown.edu/costsofwar/files/cow/imce/papers/2021/Costs%20of%20War_U.S.%20Budgetary%20Costs%20of%20Post-9%2011%20Wars_9.1.21.pdf">View Paper</a></li>
                          </ul>
          
                      <p><span><span>September 2021</span></span></p>
          
        </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[HP fails to derail claims that it bricks scanners on printers when ink runs low (295 pts)]]></title>
            <link>https://abcnews.go.com/Technology/wireStory/hp-fails-derail-claims-bricks-scanners-multifunction-printers-102286365</link>
            <guid>37781862</guid>
            <pubDate>Thu, 05 Oct 2023 18:03:22 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://abcnews.go.com/Technology/wireStory/hp-fails-derail-claims-bricks-scanners-multifunction-printers-102286365">https://abcnews.go.com/Technology/wireStory/hp-fails-derail-claims-bricks-scanners-multifunction-printers-102286365</a>, See on <a href="https://news.ycombinator.com/item?id=37781862">Hacker News</a></p>
<div id="readability-page-1" class="page"><article data-testid="prism-article-body"><p><span>SAN FRANCISCO -- </span>HP has failed to shunt aside class-action legal claims that it disables the scanners on its multifunction printers when their ink runs low. Though not for lack of trying.</p><p>On Aug. 10, a federal judge ruled that HP Inc. must face a class-action lawsuit claiming that the company designs its “all-in-one” inkjet printers to disable scanning and faxing functions whenever a single printer ink cartridge runs low. The company had sought — for the second time — to dismiss the lawsuit on technical legal grounds.</p><p>“It is well-documented that ink is not required in order to scan or to fax a document, and it is certainly possible to manufacture an all-in-one printer that scans or faxes when the device is out of ink,” the plaintiffs wrote in their complaint. “Indeed, HP designs its all-in-one printer products so they will not work without ink. Yet HP does not disclose this fact to consumers.”</p><p>The lawsuit charges that HP deliberately withholds this information from consumers to boost profits from the sale of expensive ink cartridges. </p><p>Color printers require four ink cartridges -- one black and a set of three cartridges in cyan, magenta and yellow for producing colors. Some will also refuse to print if one of the color cartridges is low, even in black-and-white mode.</p><p>HP declined to comment on the issue, citing the pending litigation. The company’s court filings in the case have generally not addressed the substance of the plaintiff’s allegations.</p><p>In early 2022, U.S. District Judge Beth Labson Freeman dismissed the complaint on legal grounds but did not address the lawsuit's claims. The judge allowed the plaintiffs to amend their claim and resubmit it. On Aug. 10, the judge largely rejected HP's request to dismiss the revised complaint, allowing the case to proceed.</p><p>All-in-one inkjet printers generally seem like a bargain compared to the cost of separate devices with scanning, copying and fax functions. For instance, HP currently sells its all-in-one OfficeJet Pro 8034e online for just $159. But its least expensive standalone scanner, the ScanJet Pro s2, lists for $369 — more than twice the cost of the multifunction printer. </p><p>Of course, only one of these devices requires printer ink. “Printer ink is wildly expensive,” Consumer Reports states in its current printer buying guide, noting that consumer ink costs can easily run more than $70 a year.</p><p>Worse, a significant amount of ink is never actually used to print documents because it's consumed by printer maintenance cycles. In 2018, Consumer Reports tested hundreds of all-in-one inkjet printers and found that, when used intermittently, many models delivered less than half of their ink to printed documents. A few managed no more than 20% to 30%.</p><p>HP isn't alone in facing such legal complaints. A different set of plaintiffs sued the U.S. unit of printer and camera maker Canon Inc. in 2021 for similarly handicapping its all-in-one printers without disclosure. The parties settled that case in late 2022. Terms were not disclosed. </p></article></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Safety vs. Performance. A case study of C, C++ and Rust sort implementations (162 pts)]]></title>
            <link>https://github.com/Voultapher/sort-research-rs/blob/main/writeup/sort_safety/text.md</link>
            <guid>37781612</guid>
            <pubDate>Thu, 05 Oct 2023 17:44:59 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/Voultapher/sort-research-rs/blob/main/writeup/sort_safety/text.md">https://github.com/Voultapher/sort-research-rs/blob/main/writeup/sort_safety/text.md</a>, See on <a href="https://news.ycombinator.com/item?id=37781612">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
          <nav aria-label="Global">
            <ul>
                <li>
      
      <div>
            <ul>
                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Product&quot;,&quot;action&quot;:&quot;click to go to Actions&quot;,&quot;label&quot;:&quot;ref_cta:Actions;&quot;}" href="https://github.com/features/actions">
      
      <div>
        <p>Actions</p><p>
        Automate any workflow
      </p></div>

    
</a></li>

                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Product&quot;,&quot;action&quot;:&quot;click to go to Packages&quot;,&quot;label&quot;:&quot;ref_cta:Packages;&quot;}" href="https://github.com/features/packages">
      
      <div>
        <p>Packages</p><p>
        Host and manage packages
      </p></div>

    
</a></li>

                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Product&quot;,&quot;action&quot;:&quot;click to go to Security&quot;,&quot;label&quot;:&quot;ref_cta:Security;&quot;}" href="https://github.com/features/security">
      
      <div>
        <p>Security</p><p>
        Find and fix vulnerabilities
      </p></div>

    
</a></li>

                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Product&quot;,&quot;action&quot;:&quot;click to go to Codespaces&quot;,&quot;label&quot;:&quot;ref_cta:Codespaces;&quot;}" href="https://github.com/features/codespaces">
      
      <div>
        <p>Codespaces</p><p>
        Instant dev environments
      </p></div>

    
</a></li>

                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Product&quot;,&quot;action&quot;:&quot;click to go to Copilot&quot;,&quot;label&quot;:&quot;ref_cta:Copilot;&quot;}" href="https://github.com/features/copilot">
      
      <div>
        <p>Copilot</p><p>
        Write better code with AI
      </p></div>

    
</a></li>

                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Product&quot;,&quot;action&quot;:&quot;click to go to Code review&quot;,&quot;label&quot;:&quot;ref_cta:Code review;&quot;}" href="https://github.com/features/code-review">
      
      <div>
        <p>Code review</p><p>
        Manage code changes
      </p></div>

    
</a></li>

                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Product&quot;,&quot;action&quot;:&quot;click to go to Issues&quot;,&quot;label&quot;:&quot;ref_cta:Issues;&quot;}" href="https://github.com/features/issues">
      
      <div>
        <p>Issues</p><p>
        Plan and track work
      </p></div>

    
</a></li>

                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Product&quot;,&quot;action&quot;:&quot;click to go to Discussions&quot;,&quot;label&quot;:&quot;ref_cta:Discussions;&quot;}" href="https://github.com/features/discussions">
      
      <div>
        <p>Discussions</p><p>
        Collaborate outside of code
      </p></div>

    
</a></li>

            </ul>
          </div>
</li>


                <li>
      
      
</li>


                <li>
      
      <div>
          <div>
            <ul>
                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Open Source&quot;,&quot;action&quot;:&quot;click to go to GitHub Sponsors&quot;,&quot;label&quot;:&quot;ref_cta:GitHub Sponsors;&quot;}" href="https://github.com/sponsors">
      
      <div>
        <p>GitHub Sponsors</p><p>
        Fund open source developers
      </p></div>

    
</a></li>

            </ul>
          </div>
          <div>
            <ul>
                <li>
  <a data-analytics-event="{&quot;category&quot;:&quot;Header dropdown (logged out), Open Source&quot;,&quot;action&quot;:&quot;click to go to The ReadME Project&quot;,&quot;label&quot;:&quot;ref_cta:The ReadME Project;&quot;}" href="https://github.com/readme">
      
      <div>
        <p>The ReadME Project</p><p>
        GitHub community articles
      </p></div>

    
</a></li>

            </ul>
          </div>
          
      </div>
</li>


                <li>
    <a data-analytics-event="{&quot;category&quot;:&quot;Header menu top item (logged out)&quot;,&quot;action&quot;:&quot;click to go to Pricing&quot;,&quot;label&quot;:&quot;ref_cta:Pricing;&quot;}" href="https://github.com/pricing">Pricing</a>
</li>

            </ul>
          </nav>

        <div>
                


<qbsearch-input data-scope="repo:Voultapher/sort-research-rs" data-custom-scopes-path="/search/custom_scopes" data-delete-custom-scopes-csrf="U7u_kUobEylXo0sTdDQCtWYkrYB8lolDFQmJ-fNGPMrZ9gy9H9Mq5MIaEc7aMDOWfMZEFvl9hspTRsXeV3hb2w" data-max-custom-scopes="10" data-header-redesign-enabled="false" data-initial-value="" data-blackbird-suggestions-path="/search/suggestions" data-jump-to-suggestions-path="/_graphql/GetSuggestedNavigationDestinations" data-current-repository="Voultapher/sort-research-rs" data-current-org="" data-current-owner="Voultapher" data-logged-in="false">
  <div data-modal-dialog-overlay="" data-action="click:qbsearch-input#searchInputContainerClicked">
  <modal-dialog data-action="close:qbsearch-input#handleClose cancel:qbsearch-input#handleClose" data-target="qbsearch-input.searchSuggestionsDialog" role="dialog" id="search-suggestions-dialog" aria-modal="true" aria-labelledby="search-suggestions-dialog-header" data-view-component="true">
      <h2 id="search-suggestions-dialog-header">Search code, repositories, users, issues, pull requests...</h2>
    
</modal-dialog></div>
  
  <div>
    
<div data-modal-dialog-overlay="">
  <modal-dialog data-target="qbsearch-input.feedbackDialog" data-action="close:qbsearch-input#handleDialogClose cancel:qbsearch-input#handleDialogClose" role="dialog" id="feedback-dialog" aria-modal="true" aria-disabled="true" aria-labelledby="feedback-dialog-title" aria-describedby="feedback-dialog-description" data-view-component="true">
    <div data-view-component="true">
    <p>
      <h2 id="feedback-dialog-title">
        Provide feedback
      </h2>
    </p>
    
  </div>
      
      
</modal-dialog></div>

    <custom-scopes data-target="qbsearch-input.customScopesManager">
    
<div data-modal-dialog-overlay="">
  <modal-dialog data-target="custom-scopes.customScopesModalDialog" data-action="close:qbsearch-input#handleDialogClose cancel:qbsearch-input#handleDialogClose" role="dialog" id="custom-scopes-dialog" aria-modal="true" aria-disabled="true" aria-labelledby="custom-scopes-dialog-title" aria-describedby="custom-scopes-dialog-description" data-view-component="true">
    <div data-view-component="true">
    <p>
      <h2 id="custom-scopes-dialog-title">
        Saved searches
      </h2>
        <h2 id="custom-scopes-dialog-description">Use saved searches to filter your results more quickly</h2>
    </p>
    
  </div>
      
      
</modal-dialog></div>
    </custom-scopes>
  </div>
</qbsearch-input>

            <p><a href="https://github.com/signup?ref_cta=Sign+up&amp;ref_loc=header+logged+out&amp;ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&amp;source=header-repo&amp;source_repo=Voultapher%2Fsort-research-rs" data-hydro-click="{&quot;event_type&quot;:&quot;authentication.click&quot;,&quot;payload&quot;:{&quot;location_in_page&quot;:&quot;site header menu&quot;,&quot;repository_id&quot;:null,&quot;auth_type&quot;:&quot;SIGN_UP&quot;,&quot;originating_url&quot;:&quot;https://github.com/Voultapher/sort-research-rs/blob/main/writeup/sort_safety/text.md&quot;,&quot;user_id&quot;:null}}" data-hydro-click-hmac="16bc9cf423b7afc00f2b133036d922a0eb602a143faeb09b02dfa67895100db6" data-analytics-event="{&quot;category&quot;:&quot;Sign up&quot;,&quot;action&quot;:&quot;click to sign up for account&quot;,&quot;label&quot;:&quot;ref_page:/<user-name>/<repo-name>/blob/show;ref_cta:Sign up;ref_loc:header logged out&quot;}">
              Sign up
            </a>
        </p></div>
      </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Windows Copilot's is showing third-party Ads to Windows users (170 pts)]]></title>
            <link>https://www.ghacks.net/2023/10/03/windows-copilots-is-showing-third-party-ads-to-windows-users/</link>
            <guid>37781266</guid>
            <pubDate>Thu, 05 Oct 2023 17:17:28 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.ghacks.net/2023/10/03/windows-copilots-is-showing-third-party-ads-to-windows-users/">https://www.ghacks.net/2023/10/03/windows-copilots-is-showing-third-party-ads-to-windows-users/</a>, See on <a href="https://news.ycombinator.com/item?id=37781266">Hacker News</a></p>
Couldn't get https://www.ghacks.net/2023/10/03/windows-copilots-is-showing-third-party-ads-to-windows-users/: Error: Request failed with status code 403]]></description>
        </item>
        <item>
            <title><![CDATA[Rerun 0.9 – a framework for visualizing streams of multimodal data (101 pts)]]></title>
            <link>https://www.rerun.io/blog/release-0.9</link>
            <guid>37781244</guid>
            <pubDate>Thu, 05 Oct 2023 17:15:12 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.rerun.io/blog/release-0.9">https://www.rerun.io/blog/release-0.9</a>, See on <a href="https://news.ycombinator.com/item?id=37781244">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="__next"><p>We’re building a fast and easy to use general framework for handling and visualizing streams of multimodal data. This is a big undertaking, and the way we’re getting there is by starting with a fast and easy to use visualizer for computer vision, and then making it more capable and extensible piece by piece.</p>
<p>Rerun 0.9.0 is released two months after 0.8.0, but it’s been even longer coming. It includes the foundation of the coming C++ SDK, our most asked for feature by far. In order to maintain great and consistent APIs across Rust, Python, C++, and any future languages, we’ve rebuilt much of Rerun's data infrastructure around a new code generation framework.</p>
<p>0.9 also adds support for logging markdown, a new in-viewer getting started experience, and as always, a bunch of performance improvements.</p>
<p><iframe src="https://player.vimeo.com/video/870834549?autoplay=1&amp;loop=1&amp;autopause=0&amp;background=1&amp;muted=1&amp;ratio=1440:1080&amp;transparent=false&amp;dnt=1" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen=""></iframe></p>
<p><em>Load example recordings, including descriptions of how they were made, directly in the viewer.</em></p>
<p>This has all been a huge lift, but what I’m most excited about are our redesigned APIs and what they pave the way for in future releases.
From this release on, we’ll start to expose more and more of Rerun's underlying infrastructure, starting with the core data model, a hierarchical and time varying Entity Component System (ECS).</p>
<p>To ease the transition for Python users, we've marked the old APIs as deprecated in 0.9 with migration instructions in the warning messages. The old API will be removed completely in 0.10. Check out the <a href="https://www.rerun.io/docs/reference/migration-0-9">migration guide</a> for more details on updating your code.</p>
<h2 id="a-more-type-centric-logging-api">A more type centric logging API<!-- --> <a href="#a-more-type-centric-logging-api"></a></h2>
<p>At the heart of Rerun is the ability to handle streams of multimodal data, e.g. images, tensors, point clouds, and text. To get data out of your programs and ready to be visualized, you log it with the Rerun SDK. Rerun handles everything needed to make that work. It doesn't matter if the data source and visualization are in the same process or the data is coming in real-time from multiple devices.</p>
<p>The ease of use, expressiveness, and extensibility of these APIs are core to the usefulness of Rerun. On a first glance, the API changes introduced in 0.9 are very small. For example, here is how you might log a single colored point cloud, represented by two 3xN numpy arrays of positions and colors.</p>
<p>Old Python API</p>
<pre><p><code>rr<span>.</span><span>log_points</span><span>(</span><span>"example/points"</span><span>,</span> positions<span>,</span> colors<span>=</span>colors<span>)</span>
</code></p></pre>
<p>New Python API</p>
<pre><p><code>rr<span>.</span><span>log</span><span>(</span><span>"example/points"</span><span>,</span> rr<span>.</span><span>Points3D</span><span>(</span>positions<span>,</span> colors<span>=</span>colors<span>)</span><span>)</span>
</code></p></pre>
<p>Both these log calls take the same user data. The difference is in the data type information, which is moved from the function name <code>rr.log_points</code> to a type, <code>rr.Points3D</code> that wraps the logged data. This new structure both opens up for more direct control of the underlying ECS and for more ergonomic logging of your own objects.</p>
<h2 id="lower-level-control-of-entity-components">Lower level control of Entity Components<!-- --> <a href="#lower-level-control-of-entity-components"></a></h2>
<p>Rerun comes with a set of <a href="https://www.rerun.io/docs/reference/types/archetypes">built in archetypes</a> like <code>rr.Points3D</code> , <code>rr.Image</code>, and <code>rr.Tensor</code>. An archetype defines a bundle of component batches that the Rerun Viewer knows how to interpret, such that Rerun will just <strong><em>do the right thing™️</em></strong> when you log it. In this case, that’s one component batch for positions and one for colors.</p>
<pre><p><code>rr<span>.</span><span>log</span><span>(</span><span>"example/points"</span><span>,</span> rr<span>.</span><span>Points3D</span><span>(</span>positions<span>,</span> colors<span>=</span>colors<span>)</span><span>)</span>
<span># is equivalent to</span>
rr<span>.</span><span>log</span><span>(</span><span>"example/points"</span><span>,</span> rr<span>.</span><span>Points3D</span><span>(</span>positions<span>,</span> colors<span>=</span>colors<span>)</span><span>.</span>as_component_batches<span>(</span><span>)</span><span>)</span>
<span># which in this case is the same as</span>
rr<span>.</span><span>log</span><span>(</span><span>"example/points"</span><span>,</span> <span>[</span>rr<span>.</span><span>Points3D</span><span>.</span>indicator<span>(</span><span>)</span><span>,</span>
                          rr<span>.</span><span>components</span><span>.</span>Position3DBatch<span>(</span>positions<span>)</span><span>,</span>
                          rr<span>.</span><span>components</span><span>.</span>ColorBatch<span>(</span>rgb<span>=</span>colors<span>)</span><span>]</span><span>)</span>
</code></p></pre>
<h3 id="partial-updates-using-the-component-level-api">Partial updates using the component level API<!-- --> <a href="#partial-updates-using-the-component-level-api"></a></h3>
<p>In most cases, you’ll want to stick to the high level archetype API, but directly setting single components gives a lot of control, which can matter. For instance, a common use case is meshes where only the vertex positions change over time.
Logging the whole mesh for each change adds a lot of overhead. For example:</p>
<pre><p><code><span>import</span> numpy <span>as</span> np
<span>import</span> rerun <span>as</span> rr  <span># pip install rerun-sdk</span>

rr<span>.</span><span>init</span><span>(</span><span>"rerun_example_mesh3d_partial_updates"</span><span>,</span> spawn<span>=</span><span>True</span><span>)</span>

vertex_positions <span>=</span> np<span>.</span>array<span>(</span><span>[</span><span>[</span><span>-</span><span>1.0</span><span>,</span> <span>0.0</span><span>,</span> <span>0.0</span><span>]</span><span>,</span> <span>[</span><span>1.0</span><span>,</span> <span>0.0</span><span>,</span> <span>0.0</span><span>]</span><span>,</span> <span>[</span><span>0.0</span><span>,</span> <span>1.0</span><span>,</span> <span>0.0</span><span>]</span><span>]</span><span>,</span> dtype<span>=</span>np<span>.</span>float32<span>)</span>

<span># Log the initial state of our triangle</span>
rr<span>.</span><span>set_time_sequence</span><span>(</span><span>"frame"</span><span>,</span> <span>0</span><span>)</span>
rr<span>.</span><span>log</span><span>(</span>
    <span>"triangle"</span><span>,</span>
    rr<span>.</span><span>Mesh3D</span><span>(</span>
        vertex_positions<span>,</span>
        vertex_normals<span>=</span><span>[</span><span>0.0</span><span>,</span> <span>0.0</span><span>,</span> <span>1.0</span><span>]</span><span>,</span>
        vertex_colors<span>=</span><span>[</span><span>[</span><span>255</span><span>,</span> <span>0</span><span>,</span> <span>0</span><span>]</span><span>,</span> <span>[</span><span>0</span><span>,</span> <span>255</span><span>,</span> <span>0</span><span>]</span><span>,</span> <span>[</span><span>0</span><span>,</span> <span>0</span><span>,</span> <span>255</span><span>]</span><span>]</span><span>,</span>
    <span>)</span><span>,</span>
<span>)</span>

<span># Only update its vertices' positions each frame</span>
factors <span>=</span> np<span>.</span><span>abs</span><span>(</span>np<span>.</span>sin<span>(</span>np<span>.</span>arange<span>(</span><span>1</span><span>,</span> <span>300</span><span>,</span> dtype<span>=</span>np<span>.</span>float32<span>)</span> <span>*</span> <span>0.04</span><span>)</span><span>)</span>
<span>for</span> i<span>,</span> factor <span>in</span> <span>enumerate</span><span>(</span>factors<span>)</span><span>:</span>
    rr<span>.</span><span>set_time_sequence</span><span>(</span><span>"frame"</span><span>,</span> i<span>)</span>
    rr<span>.</span><span>log</span><span>(</span><span>"triangle"</span><span>,</span> <span>[</span>rr<span>.</span><span>components</span><span>.</span>Position3DBatch<span>(</span>vertex_positions <span>*</span> factor<span>)</span><span>]</span><span>)</span>
</code></p></pre>
<p><iframe src="https://player.vimeo.com/video/866772278?autoplay=1&amp;loop=1&amp;autopause=0&amp;background=1&amp;muted=1&amp;ratio=1440:1080&amp;transparent=false&amp;dnt=1" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen=""></iframe></p>
<h3 id="interpret-the-same-data-in-several-ways-using-the-component-level-api">Interpret the same data in several ways using the component level API<!-- --> <a href="#interpret-the-same-data-in-several-ways-using-the-component-level-api"></a></h3>
<p>The component level API gives you the ability to interpret the same data as multiple types.
We do that by logging multiple indicator components, which tell the Rerun Viewer "hey, this entity should be interpreted as type X".
In this example we interpret an entity as bott a colored triangle and as three colored points.</p>
<pre><p><code><span>import</span> rerun <span>as</span> rr

rr<span>.</span><span>init</span><span>(</span><span>"rerun_example_manual_indicator"</span><span>,</span> spawn<span>=</span><span>True</span><span>)</span>

<span># Specify both a Mesh3D and a Points3D indicator component so that </span>
<span># the data is shown as both a 3D mesh _and_ a point cloud by default.</span>
rr<span>.</span><span>log</span><span>(</span>
    <span>"points_and_mesh"</span><span>,</span>
    <span>[</span>
        rr<span>.</span><span>Points3D</span><span>.</span>indicator<span>(</span><span>)</span><span>,</span>
        rr<span>.</span><span>Mesh3D</span><span>.</span>indicator<span>(</span><span>)</span><span>,</span>
        rr<span>.</span><span>components</span><span>.</span>Position3DBatch<span>(</span><span>[</span><span>[</span><span>0.0</span><span>,</span> <span>0.0</span><span>,</span> <span>0.0</span><span>]</span><span>,</span> <span>[</span><span>10.0</span><span>,</span> <span>0.0</span><span>,</span> <span>0.0</span><span>]</span><span>,</span> <span>[</span><span>0.0</span><span>,</span> <span>10.0</span><span>,</span> <span>0.0</span><span>]</span><span>]</span><span>)</span><span>,</span>
        rr<span>.</span><span>components</span><span>.</span>ColorBatch<span>(</span><span>[</span><span>[</span><span>1.0</span><span>,</span> <span>0.0</span><span>,</span> <span>0.0</span><span>]</span><span>,</span> <span>[</span><span>0.0</span><span>,</span> <span>1.0</span><span>,</span> <span>0.0</span><span>]</span><span>,</span> <span>[</span><span>0.0</span><span>,</span> <span>0.0</span><span>,</span> <span>1.0</span><span>]</span><span>]</span><span>)</span><span>,</span>
        rr<span>.</span><span>components</span><span>.</span>RadiusBatch<span>(</span><span>[</span><span>1.0</span><span>]</span><span>)</span><span>,</span>
    <span>]</span><span>,</span>
<span>)</span>
</code></p></pre>
<p><iframe src="https://player.vimeo.com/video/870604519?autoplay=1&amp;loop=1&amp;autopause=0&amp;background=1&amp;muted=1&amp;ratio=1440:1080&amp;transparent=false&amp;dnt=1" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen=""></iframe></p>
<h2 id="using-your-own-types-with-rerun">Using your own types with Rerun<!-- --> <a href="#using-your-own-types-with-rerun"></a></h2>
<p>The new type oriented API also makes logging data from your own objects more ergonomic. For example, you might have your very own point cloud class.</p>
<pre><p><code><span>@dataclass</span>
<span>class</span> <span>LabeledPoints</span><span>:</span>
    points<span>:</span> np<span>.</span>ndarray
    labels<span>:</span> List<span>[</span><span>str</span><span>]</span><span>)</span>
</code></p></pre>
<p>All you need to do is implement <code>as_component_batches()</code> and you can pass them directly to <code>rr.log</code>. The simplest possible way is to use the matching Rerun archetype’s <code>as_component_batches</code> method like below but you can also get as fancy as you like with custom components and archetypes. Check out the guide on <a href="https://www.rerun.io/blog/docs/howto/extend/custom-data">using Rerun with custom data</a> for more details.</p>
<pre><p><code><span>@dataclass</span>
<span>class</span> <span>LabeledPoints</span><span>:</span>
    points<span>:</span> np<span>.</span>ndarray
    labels<span>:</span> List<span>[</span><span>str</span><span>]</span><span>)</span>
    
    <span>def</span> <span>as_component_batches</span><span>(</span>self<span>)</span> <span>-</span><span>&gt;</span> Iterable<span>[</span>rr<span>.</span><span>ComponentBatch</span><span>]</span><span>:</span>
        <span>return</span> rr<span>.</span><span>Points3D</span><span>(</span>positions<span>=</span>self<span>.</span>points<span>,</span> labels<span>=</span>self<span>.</span>labels<span>)</span><span>.</span>as_component_batches<span>(</span><span>)</span>
<span>.</span><span>.</span><span>.</span>
<span># Somewhere deep in my code</span>
classified <span>=</span> my_points_classifier<span>(</span><span>.</span><span>.</span><span>.</span><span>)</span>  <span># type: LabeledPoints</span>
rr<span>.</span><span>log</span><span>(</span><span>"points/classified"</span><span>,</span> classified<span>)</span>
</code></p></pre>
<p>The main takeaway here is that with 0.9 and the new type oriented API,
it becomes a lot easier to use Rerun with your own data types.</p>
<h2 id="how-it-paves-the-way-for-the-future">How it paves the way for the future<!-- --> <a href="#how-it-paves-the-way-for-the-future"></a></h2>
<p>Although this release brings a lot of great updates, it's perhaps the future features it paves the way for that are the most exciting.</p>
<h3 id="c-sdk">C++ SDK<!-- --> <a href="#c-sdk"></a></h3>
<p>Getting data from C++ environments into Rerun was the motivating factor behind
the move to our own code generation framework. A large amount of
production systems in robotics, computer vision and gaming are built in C++ and we're
incredibly excited to soon bring Rerun to all those developers.</p>
<h3 id="building-visualizations-inline">Building visualizations inline<!-- --> <a href="#building-visualizations-inline"></a></h3>
<p>Rerun started out making the hard case, where you stream data out of multiple processes and visualize it live, easy.
The downside so far has been that in simpler cases, like in jupyter notebooks, using Rerun is more convoluted than it should be.</p>
<p>Even when time is not a factor and you have all your data right there and just want to draw it,
you currently have to go through the indirection of logging it first.</p>
<p>The new APIs introduced in 0.9, pave the way for a clean way of just drawing data inline without logging.
We'll start rolling that out together with the ability to control layout and visualization options
from the SDK later in the year once C++ has landed.</p>
<h3 id="generating-your-own-rerun-sdk-extensions">Generating your own Rerun SDK extensions<!-- --> <a href="#generating-your-own-rerun-sdk-extensions"></a></h3>
<p>Our new code generation framework is still a bit immature, but it's been a design goal from the start
to let users use it to generate their own stand alone extensions to the Rerun SDK.
We hope once it's had time to mature, it will
be useful to both teams with their own proprietary data formats and for other projects
that want to make interfacing with Rerun as easy as possible for their users.</p>
<h2 id="let-us-know-what-you-think">Let us know what you think<!-- --> <a href="#let-us-know-what-you-think"></a></h2>
<p>We're incredibly excited to hear what you think about these changes.
Join us on <a href="https://github.com/rerun-io/rerun">Github</a> or <a href="https://discord.gg/PXtCgFBSmH">Discord</a>
and let us know how 0.9 works for you and what you'd like to see in the future.</p>
<p>If you're an existing Rerun user and have any questions or need any help migrating to the new APIs,
send us a ping on Discord or elsewhere and we'll be happy to get on a call and help you out.</p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Generative AI could make search harder to trust (209 pts)]]></title>
            <link>https://www.wired.com/story/fast-forward-chatbot-hallucinations-are-poisoning-web-search/</link>
            <guid>37781231</guid>
            <pubDate>Thu, 05 Oct 2023 17:13:44 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.wired.com/story/fast-forward-chatbot-hallucinations-are-poisoning-web-search/">https://www.wired.com/story/fast-forward-chatbot-hallucinations-are-poisoning-web-search/</a>, See on <a href="https://news.ycombinator.com/item?id=37781231">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-testid="ArticlePageChunks"><div data-journey-hook="client-content" data-testid="BodyWrapper"><p><span>Web search is</span> such a routine part of daily life that it’s easy to forget how marvelous it is. Type into a little text box and a complex array of technologies—vast data centers, ravenous web crawlers, and stacks of algorithms that poke and parse a query—spring into action to serve you a simple set of relevant results.</p><p>At least, that’s the idea. The age of <a href="https://www.wired.com/tag/artificial-intelligence/">generative AI</a> threatens to sprinkle epistemological sand into the gears of web search by fooling algorithms designed for a time when the web was mostly written by humans.</p><p>Take what I learned this week about Claude Shannon, the brilliant mathematician and engineer known especially for his work on <a data-offer-url="https://en.wikipedia.org/wiki/Information_theory" data-event-click="{&quot;element&quot;:&quot;ExternalLink&quot;,&quot;outgoingURL&quot;:&quot;https://en.wikipedia.org/wiki/Information_theory&quot;}" href="https://en.wikipedia.org/wiki/Information_theory" rel="nofollow noopener" target="_blank">information theory</a> in the 1940s. Microsoft’s Bing search engine informed me that he had also foreseen the appearance of search algorithms, describing a 1948 research paper by Shannon called “A Short History of Searching” as “a seminal work in the field of computer science outlining the history of search algorithms and their evolution over time.”</p><p>Like a good AI tool, Bing also offers a few citations to show that it has checked its facts.</p><figure><p><span><p>Microsoft's Bing search engine served up this information about a research paper mathematician Claude Shannon never wrote as if it were true.</p>
</span><span>Microsoft via Will Knight</span></p></figure><p>There is just one big problem: Shannon did not write any such paper, and the citations offered by Bing consist of fabrications—or “hallucinations” in generative AI parlance—by two chatbots, <a data-offer-url="https://pi.ai/s/v49ubm6cg7yQcMaybKgST" data-event-click="{&quot;element&quot;:&quot;ExternalLink&quot;,&quot;outgoingURL&quot;:&quot;https://pi.ai/s/v49ubm6cg7yQcMaybKgST&quot;}" href="https://pi.ai/s/v49ubm6cg7yQcMaybKgST" rel="nofollow noopener" target="_blank">Pi from Inflection AI</a> and <a data-offer-url="https://poe.com/s/NP7t5G7oZVuz4mzdLVcp" data-event-click="{&quot;element&quot;:&quot;ExternalLink&quot;,&quot;outgoingURL&quot;:&quot;https://poe.com/s/NP7t5G7oZVuz4mzdLVcp&quot;}" href="https://poe.com/s/NP7t5G7oZVuz4mzdLVcp" rel="nofollow noopener" target="_blank">Claude from Anthropic</a>.</p><p>This generative-AI trap that caused Bing to offer up untruths was laid—purely by accident—by <a data-offer-url="https://danielsgriffin.com/" data-event-click="{&quot;element&quot;:&quot;ExternalLink&quot;,&quot;outgoingURL&quot;:&quot;https://danielsgriffin.com/&quot;}" href="https://danielsgriffin.com/" rel="nofollow noopener" target="_blank">Daniel Griffin</a>, who recently finished a PhD on web search at UC Berkeley. In July he <a data-offer-url="https://danielsgriffin.com/weblinks/2023/07/05/a-short-history-of-searching.html" data-event-click="{&quot;element&quot;:&quot;ExternalLink&quot;,&quot;outgoingURL&quot;:&quot;https://danielsgriffin.com/weblinks/2023/07/05/a-short-history-of-searching.html&quot;}" href="https://danielsgriffin.com/weblinks/2023/07/05/a-short-history-of-searching.html" rel="nofollow noopener" target="_blank">posted the fabricated responses</a> from the bots on his blog. Griffin had instructed both bots, “Please summarize Claude E. Shannon’s ‘A Short History of Searching’ (1948)”. He thought it a nice example of the kind of query that brings out the worst in large language models, because it asks for information that is similar to existing text found in its training data, encouraging the models to make very confident statements. Shannon did write an incredibly <a href="https://people.math.harvard.edu/~ctm/home/text/others/shannon/entropy/entropy.pdf">important article</a> in 1948 titled “A Mathematical Theory of Communication,” which helped <a href="https://www.quantamagazine.org/how-claude-shannons-information-theory-invented-the-future-20201222/">lay the foundation</a> for the field of information theory.</p><p>Last week, Griffin discovered that his blog post and the links to these chatbot results had inadvertently poisoned Bing with false information. On a whim, he tried feeding the same question into Bing and discovered that the chatbot hallucinations he had induced were highlighted above the search results in the same way as facts drawn from Wikipedia might be. “It gives no indication to the user that several of these results are actually sending you straight to conversations people have with LLMs,” Griffin says. (Although WIRED could initially replicate the troubling Bing result, after an enquiry was made to Microsoft it appears to have been resolved.)</p><p>Griffin’s accidental experiment shows how the rush to deploy ChatGPT-style AI is tripping up even the companies most familiar with the technology. And how the flaws in these impressive systems can harm services that millions of people use every day.</p></div><div data-journey-hook="client-content" data-testid="BodyWrapper"><div><p>It may be difficult for search engines to automatically <a href="https://www.wired.com/story/how-to-spot-generative-ai-text-chatgpt/">detect AI-generated text</a>. But Microsoft could have implemented some basic safeguards, perhaps barring text drawn from chatbot transcripts from becoming a featured snippet or adding warnings that certain results or citations consist of text dreamt up by an algorithm. Griffin added a disclaimer to his blog post warning that the Shannon result was false, but Bing initially seemed to ignore it.</p><p>Although WIRED could initially replicate the troubling Bing result, it now appears to have been resolved. Caitlin Roulston, director of communications at Microsoft, says the company has adjusted Bing and regularly tweaks the search engine to stop it from showing low authority content. “There are circumstances where this may appear in search results—often because the user has expressed a clear intent to see that content or because the only content relevant to the search terms entered by the user happens to be low authority,” Roulston says. “We have developed a process for identifying these issues and are adjusting results accordingly.”</p></div><p><a data-offer-url="https://sils.unc.edu/people/faculty/profiles/Francesca-Tripodi" data-event-click="{&quot;element&quot;:&quot;ExternalLink&quot;,&quot;outgoingURL&quot;:&quot;https://sils.unc.edu/people/faculty/profiles/Francesca-Tripodi&quot;}" href="https://sils.unc.edu/people/faculty/profiles/Francesca-Tripodi" rel="nofollow noopener" target="_blank">Francesca Tripodi</a>, an assistant professor at the University of North Carolina at Chapel Hill, who studies how search queries that produce few results, dubbed <a href="https://www.wired.com/story/opinion-google-and-the-cost-of-data-voids-during-a-pandemic/">data voids</a>, can be used to manipulate results, says large language models are affected by the same issue, because they are trained on web data and are more likely to hallucinate when an answer is absent from that training. Before long, Tripodi says, we may see people use AI-generated content to intentionally manipulate search results, a tactic Griffin’s accidental experiment suggests could be powerful. “You're going to increasingly see inaccuracies, but these inaccuracies can also be wielded and without that much computer savvy,” Tripodi says.</p><p>Even WIRED was able to try a bit of search subterfuge. I was able to get Pi to create a summary of a fake article of my own by inputting, “Summarize Will Knight’s article ‘Google’s Secret AI Project That Uses Cat Brains.’” Google did once famously develop an AI algorithm that <a href="https://www.wired.com/2012/06/google-x-neural-network/">learned to recognize cats on YouTube</a>, which perhaps led the chatbot to find my request not too far a jump from its training data. Griffin added a link to the result on his blog; we’ll see if it too becomes elevated by Bing as a bizarre piece of alternative internet history.</p><p>The problem of search results becoming soured by AI content may get a lot worse as SEO pages, social media posts, and blog posts are increasingly made with help from AI. This may be just one example of generative AI eating itself like an algorithmic <a data-offer-url="https://en.wikipedia.org/wiki/Ouroboros" data-event-click="{&quot;element&quot;:&quot;ExternalLink&quot;,&quot;outgoingURL&quot;:&quot;https://en.wikipedia.org/wiki/Ouroboros&quot;}" href="https://en.wikipedia.org/wiki/Ouroboros" rel="nofollow noopener" target="_blank">ouroboros</a>.</p><p>Griffin says he hopes to see AI-powered search tools shake things up in the industry and spur <a href="https://www.wired.com/story/chatgpt-opened-a-new-era-in-search-microsoft-could-ruin-it/">wider choice for users</a>. But given the accidental trap he sprang on Bing and the way people rely so heavily on web search, he says “there's also some very real concerns.”</p><p>Given his “seminal work” on the subject, I think Shannon would almost certainly agree.</p></div></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Vivaldi on iOS (140 pts)]]></title>
            <link>https://vivaldi.com/blog/vivaldi-browser-launches-on-ios/</link>
            <guid>37781125</guid>
            <pubDate>Thu, 05 Oct 2023 17:03:39 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://vivaldi.com/blog/vivaldi-browser-launches-on-ios/">https://vivaldi.com/blog/vivaldi-browser-launches-on-ios/</a>, See on <a href="https://news.ycombinator.com/item?id=37781125">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
					<p><img width="860" height="484" src="https://vivaldi.com/wp-content/uploads/860w_ios_Hero.png" alt="" decoding="async" itemprop="image" fetchpriority="high"></p><p><em><i>Read this article in</i> <a hreflang="es" href="https://vivaldi.com/es/blog/vivaldi-browser-launches-on-ios/?pk_campaign=vivaldi-blog&amp;pk_kwd=visitor" target="_blank" rel="noopener noreferrer">español</a>, <a hreflang="ja" href="https://vivaldi.com/ja/blog/vivaldi-browser-launches-on-ios/?pk_campaign=vivaldi-blog&amp;pk_kwd=visitor" target="_blank" rel="noopener noreferrer">日本語</a>, <a hreflang="de" href="https://vivaldi.com/de/blog/vivaldi-browser-launches-on-ios/?pk_campaign=vivaldi-blog&amp;pk_kwd=visitor" target="_blank" rel="noopener noreferrer">Deutsch</a>, <a hreflang="" href="https://vivaldi.com/ru/blog/vivaldi-browser-launches-on-ios/?pk_campaign=vivaldi-blog&amp;pk_kwd=visitor" target="_blank" rel="noopener noreferrer">русский</a>.</em></p>										
<p>The wait is over! Vivaldi on iOS has arrived.</p>



<p>At Vivaldi, we believe that your browser should adapt to you, not the other way around. Now we bring this experience to your iPhone and iPad.</p>



<p>Whether you’re a casual or an advanced user, you get the flexibility and versatility to browse the web your way with Vivaldi’s powerful features and unmatched levels of personalization.&nbsp;</p>



<p>Vivaldi on iOS has our distinctive look and feel with a set of built-in tools that includes Desktop-style tabs, Speed Dials, Panels, Notes, a Reading List, and a Tracker and Ad Blocker. And, of course, with the Sync functionality, we give you a secure way to take Vivaldi – and your browsing data&nbsp;– with you.</p>


<div>
<figure><a href="https://apps.apple.com/app/vivaldi-browser/id1633234600" target="_blank" rel="noreferrer noopener"><img decoding="async" src="https://vivaldi.com/wp-content/uploads/app-store.png" alt=""></a></figure></div>


<h2>Welcome to Vivaldi on iOS</h2>



<p>As in our <a href="https://vivaldi.com/desktop/">desktop</a> and <a href="https://vivaldi.com/android/">Android</a> versions, when you launch Vivaldi on iOS you start with <a href="https://help.vivaldi.com/ios/ios-bookmarks/speed-dials-in-vivaldi-on-ios/" data-type="link" data-id="https://help.vivaldi.com/ios/ios-bookmarks/speed-dials-in-vivaldi-on-ios/">Speed Dials</a> – your favorite sites organized the way you like them.</p>



<p>Here’s how the interface will look when you open a new tab:</p>


<div>
<figure><img decoding="async" width="860" height="484" src="https://vivaldi.com/wp-content/uploads/860w_ios_Explainer-2.png" alt=""><figcaption><em>The unique interface of Vivaldi on iOS. Key functionality is just a tap away</em></figcaption></figure></div>


<p>At the bottom-left corner of the browser, you’ll find Panels, a quick way to access useful tools like <a href="https://help.vivaldi.com/ios/ios-bookmarks/bookmarks-in-vivaldi-on-ios/" data-type="link" data-id="https://help.vivaldi.com/ios/ios-bookmarks/bookmarks-in-vivaldi-on-ios/">Bookmarks</a>, <a href="https://help.vivaldi.com/ios/ios-panels/history-in-vivaldi-on-ios/" data-type="link" data-id="https://help.vivaldi.com/ios/ios-panels/history-in-vivaldi-on-ios/">History</a>, <a href="https://help.vivaldi.com/ios/ios-panels/notes-in-vivaldi-on-ios/" data-type="link" data-id="https://help.vivaldi.com/ios/ios-panels/notes-in-vivaldi-on-ios/">Notes</a>, <a href="https://help.vivaldi.com/ios/ios-browse/reading-list-on-ios/" data-type="link" data-id="https://help.vivaldi.com/ios/ios-browse/reading-list-on-ios/">Reading List</a>, and <a href="https://help.vivaldi.com/ios/ios-browse/manage-downloads-in-vivaldi-on-ios/" data-type="link" data-id="https://help.vivaldi.com/ios/ios-browse/manage-downloads-in-vivaldi-on-ios/">Downloads</a>. To the right, the <a href="https://help.vivaldi.com/ios/ios-browse/tabs-on-ios/" data-type="link" data-id="https://help.vivaldi.com/ios/ios-browse/tabs-on-ios/">Tab Switcher</a> lets you access regular, private, and synced tabs in addition to the trash can to retrieve recently closed tabs.</p>



<p>In the middle, you’ll find Search and buttons for moving back and forth in History.</p>



<p>The Address Bar lets you search using any installed <a href="https://help.vivaldi.com/ios/ios-browse/search-the-web-with-vivaldi-on-ios/" data-type="link" data-id="https://help.vivaldi.com/ios/ios-browse/search-the-web-with-vivaldi-on-ios/">search engine</a> or find a bookmark in an instant. The Tab Bar with desktop-style tabs helps you view and switch between tabs easily.</p>



<figure><p>
<iframe title="The Vivaldi Browser on iOS: A short story" src="https://player.vimeo.com/video/866864591?h=34cea89763&amp;dnt=1&amp;app_id=122963" width="500" height="281" frameborder="0" allow="autoplay; fullscreen; picture-in-picture"></iframe>
</p></figure>



<p>Let’s get to the feature highlights and the unique ways in which you can browse on iOS:</p>



<h2>Experience a reimagined tab interface with Desktop-style Tabs</h2>



<p>In most browsers on mobile, it’s difficult to keep track of many open tabs. But in Vivaldi, we have made it easy for you to view the tabs that are open and also switch between them without the hassle. </p>



<p>We’ve integrated an elegant desktop-style Tab Bar in the UI by default. This makes our Tab Bar unconventional and gives the same look and feel as Vivaldi on the <a href="https://vivaldi.com/desktop/">desktop</a> and <a href="https://vivaldi.com/android/">Android</a>. This unique feature improves usability significantly.</p>


<div>
<figure><img decoding="async" loading="lazy" width="860" height="484" src="https://vivaldi.com/wp-content/uploads/860w_ios_Desktop-style-tab.png" alt=""><figcaption><em>Unique to Vivaldi, desktop-style real tabs help manage open tabs easily</em></figcaption></figure></div>


<p>A gateway to Vivaldi’s unique tab interface, the <a href="https://help.vivaldi.com/ios/ios-browse/tabs-on-ios/" data-type="link" data-id="https://help.vivaldi.com/ios/ios-browse/tabs-on-ios/">Tab Switcher</a> gives you the ability to find open, private, recently closed, or synced tabs. This functionality makes finding and managing tabs a breeze.&nbsp;</p>



<p>The number in the Tab Switcher button (at the right side of the toolbar) indicates, how many open tabs you have. With a long press, you can open a new or private tab, or close the active tab.</p>



<p>The active tab will be displayed with a border around the Tab thumbnail. With a tap on the thumbnail, you can switch to the selected Tab. It is also easy to share selected tabs with a friend, mark them as a <a href="https://help.vivaldi.com/ios/ios-bookmarks/bookmarks-in-vivaldi-on-ios/" data-type="link" data-id="https://help.vivaldi.com/ios/ios-bookmarks/bookmarks-in-vivaldi-on-ios/">Bookmark</a>, or add them to your <a href="https://help.vivaldi.com/ios/ios-browse/reading-list-on-ios/" data-type="link" data-id="https://help.vivaldi.com/ios/ios-browse/reading-list-on-ios/">Reading List</a> – all with a long press.</p>



<h2>Access sites faster with Speed Dials</h2>



<p>We give you the power to make the Start Page more personal, unlike other browsers. You’re the one who gets to decide how your Start Page looks, feels, and performs.&nbsp;</p>


<div>
<figure><img decoding="async" loading="lazy" width="860" height="484" src="https://vivaldi.com/wp-content/uploads/860w_ios_Speed-Dial.png" alt=""><figcaption><em>Customize Speed Dials with your favorite links</em> </figcaption></figure></div>


<p>At the core of Vivaldi’s Start Page are Speed Dials, displaying thumbnail galleries of bookmarks. With <a href="https://help.vivaldi.com/ios/ios-bookmarks/speed-dials-in-vivaldi-on-ios/" data-type="link" data-id="https://help.vivaldi.com/ios/ios-bookmarks/speed-dials-in-vivaldi-on-ios/">Speed Dials</a>, you can access your favorite sites quickly and organize which bookmarks should show on your new tab page.</p>



<p>Thumbnails are generated by default, but you can create and customize multiple Speed Dials for different scenarios or categories. And even organize and manage bookmarks into nested folders.</p>



<h2>Take Notes on the go</h2>



<p>Unique to Vivaldi, <a href="https://help.vivaldi.com/ios/ios-panels/notes-in-vivaldi-on-ios/" data-type="link" data-id="https://help.vivaldi.com/ios/ios-panels/notes-in-vivaldi-on-ios/">built-in Notes</a> help you jot down ideas, to-dos, and inspirations while browsing. What is handy here is that when you highlight any text, one of the options that comes up is “Copy to note” at which the text gets copied into the Notes section of the browser.</p>


<div>
<figure><img decoding="async" loading="lazy" width="860" height="484" src="https://vivaldi.com/wp-content/uploads/860w_ios_Notes.png" alt=""><figcaption><em>Create notes as you browse and sync them between devices with the built-in&nbsp;Notes&nbsp;feature</em></figcaption></figure></div>


<p>Plus, Notes can easily be synced between your phone, <a href="https://vivaldi.com/desktop/">desktop</a>, and <a href="https://vivaldi.com/android/automotive/">car</a>, so you can pick up where you left off.</p>



<h2>Never miss a good story with the Reading List</h2>



<p><a href="https://help.vivaldi.com/ios/ios-browse/reading-list-on-ios/" data-type="link" data-id="https://help.vivaldi.com/ios/ios-browse/reading-list-on-ios/">Reading List</a> lets you add web pages to keep it for later. It prevents endless tabs from accumulating on your Tab Bar/Tab Switcher and Bookmarks from being filled with entries you only need once.</p>






<div>
<figure><img decoding="async" loading="lazy" width="860" height="484" src="https://vivaldi.com/wp-content/uploads/860w_ios_Reading-List.png" alt=""><figcaption>&nbsp;<em>Save pages that you want to read later with the built-in Reading List on Vivaldi on iOS</em></figcaption></figure></div>


<p>What’s great about having a Reading List is that it does not require an external app and you do not need to sign up for an account. Bonus – they can be synced on any device with Vivaldi.</p>



<h2>Sync browsing data, seamlessly and safely</h2>


<div>
<figure><img decoding="async" loading="lazy" width="860" height="484" src="https://vivaldi.com/wp-content/uploads/860w_ios_Sync-2.png" alt=""></figure></div>


<p>You can <a href="https://help.vivaldi.com/ios/ios-tools/sync-browser-data-on-ios/" data-type="link" data-id="https://help.vivaldi.com/ios/ios-tools/sync-browser-data-on-ios/">sync</a> your browsing data – Bookmarks, Speed Dials, saved passwords, autofill information, typed History, and Notes – securely between installations of Vivaldi and other devices with our end-to-end encryption. Vivaldi is available on <a href="https://vivaldi.com/desktop/">Desktop</a>, <a href="https://vivaldi.com/android/">Android</a>, and in <a href="https://vivaldi.com/android/automotive/">cars</a>.</p>



<p>No third-party servers – Vivaldi stores Sync data on its own servers in Iceland.</p>


<div>
<figure><img decoding="async" loading="lazy" width="860" height="484" src="https://vivaldi.com/wp-content/uploads/860w_ios_Sync.png" alt=""><figcaption><em>With the powerful Sync, synchronize data between different installations of Vivaldi on desktop, Android, and in cars</em></figcaption></figure></div>


<h2>Enjoy speed, without ads and trackers.</h2>



<p>Our <a href="https://help.vivaldi.com/ios/ios-privacy/tracker-and-ad-blocker-on-ios/" data-type="link" data-id="https://help.vivaldi.com/ios/ios-privacy/tracker-and-ad-blocker-on-ios/">built-in Tracker and Ad Blocker</a> gives you the choice of how you want sites to display. We’ve always believed that what you want the sites to know about you should be your choice.&nbsp;</p>



<p>The Tracker Blocker protects you from web trackers that follow you around the web gathering your personal information. While blocking trackers provides enough protection, some of you prefer to block ads in addition to trackers.&nbsp;</p>



<p>The Tracker and Ad Blocker can be easily enabled for sites through the shield icon at the left end of the Address field or globally in Settings.</p>


<div>
<figure><img decoding="async" loading="lazy" width="860" height="484" src="https://vivaldi.com/wp-content/uploads/860w_ios_Ad-Tracker-Blocker-1.png" alt=""><figcaption><em>Browse privately and with speed with the built-in Tracker and Ad</em><em> blocker</em></figcaption></figure></div>


<p>The shield icon indicates whether the Tracker and Ad blocker is active. It also helps to enable or disable blocking for specific sites if that’s what you prefer. You can further manage the blocking level per site from here (or from <em>Settings → Tracker and Ad blocker</em>).</p>



<p>For enhanced privacy, you can also keep your browsing history discreet using private tabs – searches, sites visited, cookies, and temporary files won’t be stored by Vivaldi.</p>


<div>
<figure><img decoding="async" loading="lazy" width="860" height="484" src="https://vivaldi.com/wp-content/uploads/860w_ios_Private-Tabs.png" alt=""><figcaption><em>For enhanced privacy, browse with private tabs </em></figcaption></figure></div>


<h2>Search and switch Search engines</h2>



<p>You can switch from one search engine to another instantly – another powerful feature that makes various search engines easily accessible.</p>



<p>We offer you several privacy-focused alternatives that protect you from surveillance and believe in the neutrality of search results.</p>


<div>
<figure><img decoding="async" loading="lazy" width="860" height="484" src="https://vivaldi.com/wp-content/uploads/860w_ios_Search-engine.png" alt=""><figcaption><em>Switch and perform search with a different search engine</em></figcaption></figure></div>


<h2>Make it personal with Custom App icons</h2>



<p>Are you looking to add some flair to your browsing? Now you can simply select a Custom App icon to reflect your style or mood.</p>


<div>
<figure><img decoding="async" loading="lazy" width="860" height="484" src="https://vivaldi.com/wp-content/uploads/860w_ios_Custom-icon.png" alt=""><figcaption><em>Get a personal touch with Custom App Icons</em></figcaption></figure></div>


<p>You can also add more Vivaldi to your home screen with a Vivaldi widget. The widgets let you quickly enter a private tab, search the web, and easily scan QR codes.</p>



<h2>Go big with Vivaldi on the iPad and its big screen</h2>


<div>
<figure><img decoding="async" loading="lazy" width="860" height="484" src="https://vivaldi.com/wp-content/uploads/860w_ios_iPad.png" alt=""><figcaption><em>Vivaldi is designed perfectly for the big screen of an iPad with a unique interface</em></figcaption></figure></div>


<p>A bigger screen opens up a lot of possibilities for how the app’s user interface (UI) is presented. That is why we have designed the browser’s functionality for larger mobile screens so that it suits iPads — and you.&nbsp;</p>



<p>You’ll find our distinctive Start Page with <a href="https://help.vivaldi.com/ios/ios-bookmarks/speed-dials-in-vivaldi-on-ios/" data-type="link" data-id="https://help.vivaldi.com/ios/ios-bookmarks/speed-dials-in-vivaldi-on-ios/">Speed Dials</a> displaying thumbnail galleries of bookmarks. You can add multiple Speed Dials to your Start Page and use these to organize and collect links to your favorite web pages.</p>



<p>Panels now pop up on the left of the screen, just like Vivaldi’s default desktop configuration. With Panels, you can optimize the available screen space on your iPad. Other buttons like the Tab Switcher History back/forward are on the top of the screen.</p>



<p>Your go-to tools are within easy reach in the browser’s sidebar, and allow you to work with your <a href="https://help.vivaldi.com/ios/ios-panels/history-in-vivaldi-on-ios/" data-type="link" data-id="https://help.vivaldi.com/ios/ios-panels/history-in-vivaldi-on-ios/">History</a>, <a href="https://help.vivaldi.com/ios/ios-browse/manage-downloads-in-vivaldi-on-ios/" data-type="link" data-id="https://help.vivaldi.com/ios/ios-browse/manage-downloads-in-vivaldi-on-ios/">Downloads</a>, <a href="https://help.vivaldi.com/ios/ios-bookmarks/bookmarks-in-vivaldi-on-ios/" data-type="link" data-id="https://help.vivaldi.com/ios/ios-bookmarks/bookmarks-in-vivaldi-on-ios/">Bookmarks</a>, <a href="https://help.vivaldi.com/ios/ios-browse/reading-list-on-ios/" data-type="link" data-id="https://help.vivaldi.com/ios/ios-browse/reading-list-on-ios/">Reading List</a>, and <a href="https://help.vivaldi.com/ios/ios-panels/notes-in-vivaldi-on-ios/" data-type="link" data-id="https://help.vivaldi.com/ios/ios-panels/notes-in-vivaldi-on-ios/">Notes</a> in split-screen with your main browser window.</p>



<p>Toggling the Panel on and off is as easy as tapping the panel button in the top-left corner of the location bar, allowing more screen space and facilitating efficient workflows.</p>


<div>
<figure><img decoding="async" loading="lazy" width="860" height="484" src="https://vivaldi.com/wp-content/uploads/860w_ios_iPad-Panel-1.png" alt=""><figcaption><em>A browser first – Panels are on the left side for more screen space</em></figcaption></figure></div>


<h2>Watch how the browser works in this quick video</h2>



<figure><p>
<iframe loading="lazy" title="Get started with Vivaldi Browser on iOS" src="https://player.vimeo.com/video/868333178?h=4c2661bce3&amp;dnt=1&amp;app_id=122963" width="500" height="281" frameborder="0" allow="autoplay; fullscreen; picture-in-picture"></iframe>
</p></figure>



<h2>Ready for seasons to come</h2>



<p>We’re incredibly excited to bring Vivaldi to iOS. And this is just the beginning. To our whole community, thank you for your unwavering support on this journey.</p>


<div>
<figure><img decoding="async" loading="lazy" src="https://vivaldi.com/wp-content/uploads/860w_iPad-Keyboard-and-Pen.png" alt="" width="860" height="484"></figure></div>


<div><p>Stay tuned to our <a href="https://vivaldi.com/blog/" data-type="link" data-id="https://vivaldi.com/blog/">blog</a> and social media channels for more updates, tips, and tricks about Vivaldi on iOS. And do subscribe to our <a href="https://vivaldi.com/ios/">newsletter</a>.</p><p>We’ll continue to build Vivaldi on iOS based on your feedback. We are eager to hear what you think about it, and we look forward to your experiences browsing with Vivaldi.</p></div>



<h2>Pick it from the App Store</h2>



<p>Want to give Vivaldi on iOS a try? Download from the App Store for devices running iOS/iPadOS 15 or above, and bring Vivaldi with you everywhere, and experience browsing that is powerful, personal, and private.</p>



<p>By setting up Vivaldi as your default browser, you also take a step to break free from Big Tech for an independent tech company that puts its users first.</p>



<div><p>Spread the word! And do not forget to rate us on the App Store.</p><p>Welcome to the world of Vivaldi on iOS!</p></div>


<div>
<figure><a href="https://apps.apple.com/app/vivaldi-browser/id1633234600" target="_blank" rel="noreferrer noopener"><img decoding="async" src="https://vivaldi.com/wp-content/uploads/app-store.png" alt=""></a></figure></div>									</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Booking.com makes a fortune – so why is it leaving its bills to hotels unpaid? (229 pts)]]></title>
            <link>https://www.theguardian.com/business/2023/oct/03/bookingcom-makes-a-fortune-so-why-is-it-leaving-its-bills-to-small-hotels-unpaid</link>
            <guid>37781022</guid>
            <pubDate>Thu, 05 Oct 2023 16:56:56 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.theguardian.com/business/2023/oct/03/bookingcom-makes-a-fortune-so-why-is-it-leaving-its-bills-to-small-hotels-unpaid">https://www.theguardian.com/business/2023/oct/03/bookingcom-makes-a-fortune-so-why-is-it-leaving-its-bills-to-small-hotels-unpaid</a>, See on <a href="https://news.ycombinator.com/item?id=37781022">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="maincontent"><p>There is something wrong at Booking.com.</p><p>While its parent company has been making record profits – $1.3bn for the second quarter of 2023 alone – and its CEO and executives have been cashing in millions of dollars in shares this year, many of the people who helped Booking.com make that fortune claim to have not been paid since July, some say longer.</p><p><a href="https://www.theguardian.com/business/2023/oct/01/booking-com-hotel-fees-unpaid-millions-technical-issue" data-link-name="in body link">Many Booking.com accommodation partners</a> from Australia to Europe to the Americas have faced silence from the company as they’ve chased payments for months while struggling to keep businesses afloat – particularly during the lucrative northern hemisphere peak summer season, when many guests were essentially staying free of charge, as Booking.com hadn’t passed on payments.</p><p>You don’t need me to tell you the full impact of this. You only have to read the comments posted on social media and websites referencing the holiday booking site.</p><figure id="63eff0d6-94db-4348-81dc-1c05e51fb270" data-spacefinder-role="richLink" data-spacefinder-type="model.dotcomrendering.pageElements.RichLinkBlockElement"><gu-island name="RichLinkComponent" priority="feature" deferuntil="idle" props="{&quot;richLinkIndex&quot;:4,&quot;element&quot;:{&quot;_type&quot;:&quot;model.dotcomrendering.pageElements.RichLinkBlockElement&quot;,&quot;url&quot;:&quot;https://www.theguardian.com/business/2023/oct/01/booking-com-hotel-fees-unpaid-millions-technical-issue&quot;,&quot;text&quot;:&quot;Travel website Booking.com leaves hoteliers thousands of dollars out of pocket&quot;,&quot;prefix&quot;:&quot;Related: &quot;,&quot;role&quot;:&quot;richLink&quot;,&quot;elementId&quot;:&quot;63eff0d6-94db-4348-81dc-1c05e51fb270&quot;},&quot;ajaxUrl&quot;:&quot;https://api.nextgen.guardianapps.co.uk&quot;,&quot;format&quot;:{&quot;display&quot;:0,&quot;theme&quot;:1,&quot;design&quot;:8}}" config="{&quot;renderingTarget&quot;:&quot;Web&quot;}"></gu-island></figure><p>One of the most distressing stories is beneath a post about Booking.com’s investment in AI and cutting-edge technology by the company’s highly remunerated CEO, Glenn Fogel, on his LinkedIn page.</p><p>Many partners have complained directly to the CEO about Booking.com’s silence on late payments and staff’s lack of response to calls, emails and cases opened on the platform that are closed without being resolved.</p><p>“I am a widow raising a child on my own,” reads one post by a woman I have since confirmed is called Claudia Arnull. “Because l have not been paid properly since the end of June my credit history is ruined and all my savings have gone and l am now in so much debt there is nothing left to use. As of this moment all l have to feed my child is porridge.”</p><p>The post appears genuine – and is genuinely heartbreaking – and you would hope that it will be investigated by the company. After all, nobody knows exactly how many families have been left in similar positions, with stress over credit histories and depleted savings due to Booking.com’s inability to pay partners.</p><p>We know that it’s likely that hundreds or thousands of partners have been affected. It could be many many more. We can’t know for sure, because despite dozens of emails to Booking.com’s media relations and Booking Holding’s communications departments, questions as to how many partners were affected, were never answered.</p><p>The only Booking.com spokesperson to respond to me, from their UK press office, emailed a standard reply. The official response blames payment issues on a technical glitch resulting from a planned two-week July maintenance intended to secure and enhance the travel reservations platform.<a href="https://www.theguardian.com/business/2023/oct/01/booking-com-hotel-fees-unpaid-millions-technical-issue" data-link-name="in body link"> A similar statement was given to the Guardian</a> this week in which it said it understood “the frustration of the accommodation hosts and owners” and that the “system errors that affected the payments have now been corrected”.</p><p>A Booking.com market manager in south-east Asia admitted at a recent industry event that payment delays were caused by the installation of a new payment system. Staff salaries were also affected, she said, explaining it as a risk they had to take.</p><p>It’s hard for partners to get excited about new initiatives when Booking.com hasn’t paid them in months, which means they can’t pay staff or utilities, get laundry done, buy ingredients for guest breakfasts or pay loans or investors and have to borrow from family and friends.</p><p>I’ve heard scores of heartbreaking stories in Facebook groups and online forums in recent months as I’ve connected with other accommodation partners and affiliate partners like myself to share experiences and tips to getting paid. My own three-month-long journey in chasing payments only ended last week after a partner shared direct emails for Booking.com finance department heads. I was paid three days later without an explanation or an apology.</p><p>Booking.com has 90 million accommodation partners with lodgings listed on their platform. It’s worth noting that it’s not the big brand hotels or luxury resorts that have been affected – they take payments from guests and send commissions to Booking.com. It appears to be couples, families and individuals; the independent operators of smaller lodgings that might not have a credit card facility to accept payments, such as apartment rentals, cottages, villas, bed and breakfasts and rooms in homes. A British owner of one such property says she is owed £2,500 (A$4,759).</p><figure id="1abf59a7-750d-46d9-9cec-09e44764b6d6" data-spacefinder-role="richLink" data-spacefinder-type="model.dotcomrendering.pageElements.RichLinkBlockElement"><gu-island name="RichLinkComponent" priority="feature" deferuntil="idle" props="{&quot;richLinkIndex&quot;:15,&quot;element&quot;:{&quot;_type&quot;:&quot;model.dotcomrendering.pageElements.RichLinkBlockElement&quot;,&quot;url&quot;:&quot;https://www.theguardian.com/money/2023/aug/14/how-can-we-prove-our-bookingcom-accommodation-didnt-exist&quot;,&quot;text&quot;:&quot;Fake or not fake? Booking.com’s hotel or apartment was ‘a private house’&quot;,&quot;prefix&quot;:&quot;Related: &quot;,&quot;role&quot;:&quot;richLink&quot;,&quot;elementId&quot;:&quot;1abf59a7-750d-46d9-9cec-09e44764b6d6&quot;},&quot;ajaxUrl&quot;:&quot;https://api.nextgen.guardianapps.co.uk&quot;,&quot;format&quot;:{&quot;display&quot;:0,&quot;theme&quot;:1,&quot;design&quot;:8}}" config="{&quot;renderingTarget&quot;:&quot;Web&quot;}"></gu-island></figure><p>“What I cannot understand is why there has been zero public apology from the CEO of this organisation,” she told me. “Surely damage limitation and PR is important to them? Why no proper explanation as to why this continues to not be resolved? Why aren’t we getting an apology from the board?”</p><p>One partner, who rents out an apartment in the Canary Islands, described finally making headway in her months-long fight to get paid. On Sunday, she says, she received notice that June-September payments of €13,000 (A$21,458) would be paid in November. But why should she wait another month when Booking’s finance team can make manual payments in a few days?</p><p>Booking.com partners aren’t alone in their battle for payments, responses and explanations. On consumer site TrustPilot, Booking.com has a “bad” one-star rating (out of five stars) from 48,872 reviewers. They complain about appalling customer service, staff who don’t appear to read emails or follow up and refunds promised but allegedly not paid.</p><p>Of course, none of these complaints are new – it’s just these problems have never appeared to have been as widespread.</p><p>It’s time that Booking.com directed some of those billions in profits and so-called cutting-edge technology to fixing the long-term payment problems and communication issues. Glenn Fogel needs to explain what’s been going on and he needs to apologise.</p><p>Regulators around the globe need to hold the company to account, to immediately put pressure on the company to pay up now and pay on time and legislate for greater transparency and accountability. Booking.com shouldn’t be able to continue to reap wealth from partners struggling to keep their accommodation open because the world’s No 1 travel site hasn’t paid them their earnings.</p><ul>
 <li><p>Lara Dunston is a travel writer and a Booking.com affiliate</p></li>
</ul></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Astronomers Watched a Star Disappear. Now JWST Might Have Some Answers (113 pts)]]></title>
            <link>https://www.universetoday.com/163473/astronomers-watched-a-massive-star-just-disappear-now-jwst-might-have-some-answers/</link>
            <guid>37780514</guid>
            <pubDate>Thu, 05 Oct 2023 16:17:37 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.universetoday.com/163473/astronomers-watched-a-massive-star-just-disappear-now-jwst-might-have-some-answers/">https://www.universetoday.com/163473/astronomers-watched-a-massive-star-just-disappear-now-jwst-might-have-some-answers/</a>, See on <a href="https://news.ycombinator.com/item?id=37780514">Hacker News</a></p>
<div id="readability-page-1" class="page"><article id="post-163473">

<div>
<p>In 2009 a giant star 25 times more massive than the Sun simply…vanished. Okay, it wasn’t quite that simple. It underwent a period of brightening, increasing in luminosity to a million Suns, just as if it was ready to explode into a supernova. But then it faded rather than exploding. And when astronomers tried to see the star, using the Large Binocular Telescope (LBT), Hubble, and the Spitzer space telescope, they couldn’t see anything.</p>
<p>The star, known as N6946-BH1, is now considered a failed supernova. The BH1 in its name is due to the fact that astronomers think the star collapsed to become a black hole rather than triggering a supernova. But that has been conjecture. All we’ve known for sure is that it brightened for a time then grew too dim for our telescopes to observe. But that has changed, thanks to the James Webb Space Telescope (JWST).</p>
<p>The new study, published on the <em>arXiv</em>, analyzes data gathered by JWST’s NIRCam and MIRI instruments. It shows a bright infrared source that appears to be a remnant dust shell surrounding the position of the original star. This would be consistent with material ejected from the star as it brightened rapidly. It could also be an infrared glow from material infalling into the black hole, though that seems less likely.</p>
<figure><img decoding="async" width="1024" height="345" src="https://www.universetoday.com/wp-content/uploads/2023/10/panel-1024x345.jpg" alt="" srcset="https://www.universetoday.com/wp-content/uploads/2023/10/panel-1024x345.jpg 1024w, https://www.universetoday.com/wp-content/uploads/2023/10/panel-580x196.jpg 580w, https://www.universetoday.com/wp-content/uploads/2023/10/panel-250x84.jpg 250w, https://www.universetoday.com/wp-content/uploads/2023/10/panel-768x259.jpg 768w, https://www.universetoday.com/wp-content/uploads/2023/10/panel-1536x518.jpg 1536w, https://www.universetoday.com/wp-content/uploads/2023/10/panel-2048x691.jpg 2048w" sizes="(max-width: 767px) 89vw, (max-width: 1000px) 54vw, (max-width: 1071px) 543px, 580px"><figcaption>Images of BH1 show three sources, not one. Credit: Beasor, et al</figcaption></figure>
<p>Surprisingly, the team also found not one remnant object, but three. This makes the failed supernova model less likely. Earlier observations of N6946-BH1 were a blend of these three sources since the resolution wasn’t high enough to distinguish them. So a more likely model is that the 2009 brightening was caused by a stellar merger. What appeared to be a bright massive star was a star system that brightened as two stars merged, then faded.</p>
<p>While the data leans toward the merger model, it can’t rule out the failed supernova model. And that makes our understanding of supernovae and stellar mass black holes more complicated. We know from black hole mergers observed by LIGO and other gravitational wave observatories that stellar-mass black holes exist and are relatively common. So some massive stars do become black holes. But whether they become supernovae first is still in question. Regular supernovae can have enough remnant mass to become a black hole, but it’s hard to imagine how the largest stellar black holes could have formed after supernovae.</p>
<p>N6946-BH1 is in a galaxy 22 million light-years away, so the fact that JWST can distinguish multiple sources is impressive. It also gives astronomers hope that similar stars will be observed in time. With more data, we should be able to distinguish between stellar mergers and true failed supernovae, which will help us understand the last stages of stars as they move toward becoming stellar-mass black holes.</p>
<p><strong>Reference:</strong> Beasor, Emma R., et al. “<a href="https://arxiv.org/abs/2309.16121">JWST reveals a luminous infrared source at the position of the failed supernova candidate N6946-BH1</a>.” <em>arXiv preprint</em> arXiv:2309.16121 (2023).</p>
 </div>
 
</article></div>]]></description>
        </item>
        <item>
            <title><![CDATA[OpenAI's justification for why training data is fair use, not infringement [pdf] (187 pts)]]></title>
            <link>https://www.uspto.gov/sites/default/files/documents/OpenAI_RFC-84-FR-58141.pdf</link>
            <guid>37780199</guid>
            <pubDate>Thu, 05 Oct 2023 15:52:01 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.uspto.gov/sites/default/files/documents/OpenAI_RFC-84-FR-58141.pdf">https://www.uspto.gov/sites/default/files/documents/OpenAI_RFC-84-FR-58141.pdf</a>, See on <a href="https://news.ycombinator.com/item?id=37780199">Hacker News</a></p>
&lt;Not HTML&gt;]]></description>
        </item>
        <item>
            <title><![CDATA[Microsoft introduces AI meddling to your files with Copilot in OneDrive (111 pts)]]></title>
            <link>https://www.theregister.com/2023/10/04/onedrive_to_acquire_copilot_skills/</link>
            <guid>37779457</guid>
            <pubDate>Thu, 05 Oct 2023 14:59:23 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.theregister.com/2023/10/04/onedrive_to_acquire_copilot_skills/">https://www.theregister.com/2023/10/04/onedrive_to_acquire_copilot_skills/</a>, See on <a href="https://news.ycombinator.com/item?id=37779457">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="body">
<p>Microsoft is to overhaul OneDrive in a move that will bring Copilot to the cloud storage service and herd users towards the tool's web interface.</p>
<p>In a presentation that combined both consumer and business editions of OneDrive, Microsoft <a target="_blank" rel="nofollow" href="https://techcommunity.microsoft.com/t5/microsoft-onedrive-blog/unveiling-the-next-generation-of-onedrive/ba-p/3935612">was keen to show off</a> OneDrive Home – the experience to be enjoyed by users of the the product's web interface.</p>
<p>For business customers, OneDrive Home is intended to be a portal into the user's files, wherever they might lurk in an organization. One slightly worrying panel on this interface is captioned "For You," and surfaces files that Microsoft's AI reckons will be of interest. One can but hope that administrators are on the ball sufficiently to ensure that nothing that shouldn't be there inadvertently pops up.</p>

    

<p>Other views include Meetings, showing upcoming and past meetings, along with files and recordings; People, which organizes files by the people a user works with; and Shared, which, as its name suggests, shows files shared with the user.</p>

        


        

<p>Users can also select colors for folders, flag favorites, or create shortcuts.</p>
<div><p><img src="https://regmedia.co.uk/2023/09/21/handout_windows_copilot.jpg?x=174&amp;amp;y=115&amp;amp;crop=1" width="174" height="115" alt="Microsoft's Copilot logo"></p><h2 title="Windows gets its own Copilot to help operate the operating system – Edge, Bing, Outlook, 365 not spared, either">Beneath Microsoft's Surface event, AI spreads everywhere</h2>
<p><a href="https://www.theregister.com/2023/09/21/microsoft_surface_ai_copilot/"><span>MORE CONTEXT</span></a></p></div>
<p>Microsoft floated the new design for work and school <a target="_blank" rel="nofollow" href="https://techcommunity.microsoft.com/t5/microsoft-onedrive-blog/experience-the-new-onedrive-fast-organized-and-personalized/ba-p/3804985">in May</a>, but it is the items flagged as coming soon that will pique the interest of customers, even with the inevitable mentions of AI and Copilot.</p>
<p>New features announced include the ability to fire up desktop apps from files in the browser interface via "Open-in-app" – due worldwide in December. This might be useful for some, but we suspect many would opt for the File Explorer incarnation of OneDrive to do the same thing.</p>
<p>While adding OneDrive into Teams and Outlook will be handy for customers keen to link files without having to jump interfaces – integration into the Windows Outlook app or the web version is due in December – the offline functionality is the most intriguing.</p>

        

<p>It is already possible to use desktop synchronization to keep some files always available and others in the cloud. Microsoft intends to bring this functionality to the browser and permit users to select files or folders to always be available locally via OneDrive for the Web. It also plans to allow users to open and work on files flagged for offline access in the browser without internet access.</p>
<ul>

<li><a href="https://www.theregister.com/2023/09/25/ai_in_brief/">OpenAI's DALL·E 3 teams up with ChatGPT to turn brainfarts into art</a></li>

<li><a href="https://www.theregister.com/2023/09/19/github_copilot_amazon_api/">GitHub Copilot, Amazon Code Whisperer sometimes emit other people's API keys</a></li>

<li><a href="https://www.theregister.com/2023/09/07/microsoft_copilot_copyright/">Microsoft to shield paid-up Copilot customers from any AI copyright brawls it starts</a></li>
</ul>
<p>Rename, move, copy, and delete functionality will all be available to offline browser users, with changes synchronized when the internet connection is restored.</p>
<p>According to Microsoft, Files On-Demand for Web and Offline mode in the browser are due in early 2024.</p>
<p>Inevitably, Copilot skills are due to arrive in OneDrive. Microsoft hopes these will help users find files and stay organized. Worryingly, in the example given, Copilot can move files around and create folders depending on its interpretation of the user's instructions. What could possibly go wrong?</p>
<div>
<h2 title="Teams gets a bot, OneNote gets a bot, PowerPoint gets a bot, Outlook gets a bot, everybody* gets a bot!">Microsoft can't stop injecting Copilot AI into every corner of its app empire</h2>
<p><a href="https://www.theregister.com/2023/05/10/microsoft_copilot_ai/"><span>PREVIOUSLY</span></a></p></div>
<p>Copilot in OneDrive is due to turn up in December – although you'll need a Microsoft 365 Copilot license – for questions about individual files. The delivery date for the other new skills remains vague for now.</p>
<p>Finally, and more useful for users, security tools will arrive that restrict access to files, set conditional access policies at a granular level, and deal with moving OneDrive accounts across tenants. Plus, due in preview from January 2024, administration reports will be available as part of Microsoft Graph Data Connect for SharePoint.</p>
<p>Missing from the announcement was mention of a Linux client or any potential increase in storage. The company <a target="_blank" href="https://techcommunity.microsoft.com/t5/microsoft-onedrive-blog/experience-the-new-onedrive-fast-organized-and-personalized/ba-p/3804985">moved away from unlimited storage in 2015</a>, and for many users the only way to breach the 1TB OneDrive limit is <a target="_blank" href="https://www.theregister.com/2019/09/25/microsoft_onedrive_storage_price/">to hand over more cash to Microsoft</a>. ®</p>                                


                    </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Adam? ... is there a reason your laptop is in the fridge? (2006) (115 pts)]]></title>
            <link>https://www.kempa.com/adam-is-there-a-reason-your-laptop-is-in-the-fridge/</link>
            <guid>37778996</guid>
            <pubDate>Thu, 05 Oct 2023 14:23:54 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.kempa.com/adam-is-there-a-reason-your-laptop-is-in-the-fridge/">https://www.kempa.com/adam-is-there-a-reason-your-laptop-is-in-the-fridge/</a>, See on <a href="https://news.ycombinator.com/item?id=37778996">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
	
			<article id="post-305">
			
							
				<div>

							<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I’d read a few times that bringing the temperature of a failing drive down will increase its reliability long enough to salvage important files.   When the drive in my trusty Powerbook decided one day last week to stop booting and make horrible clicking sounds, I decided to test the theory.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Not feeling particularly motivated to dissect the powerbook, since that would void the warranty I planned to invoke to get the drive replaced, I set it on a relatively uncluttered shelf of the fridge when I got home from work.  Ten minutes later, I took it out, and the drive booted like new.  I copied my iphoto libraries to an external drive and once that was successful, begun the copying of the only other important file on the drive: a giant iMovie project (~ 30 GB).  About halfway through, the drive had warmed up, the copy progress bar had stalled and the clicking was back.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fair enough.  Back in the fridge, for 20 minutes this time.  I took it out, booted up (painlessly), hooked it up to the external drive and started the copy again.  This time it made it to 75% before the clicking took hold.  At this point I considered going after the video clips that made up the iMovie project in small batches, but decided I didn’t feel like doing that if it wasn’t absolutely necessary.  I also didn’t want to play guess and check to discover the ideal length of time to chill a powerbook, so I devised a devious plot.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This plot consisted of cooling the powerbook down again, carting my external drive to the kitchen, booting the laptop in the fridge, beginning the copy, and closing the door.  Success!  I share this experience with you, the internet, in the hopes that it is useful.</p>
<p><img decoding="async" src="http://www.kempa.com/images/blog/20061002_fridge_01.jpg" alt="Devious plot.  Will it work?"><br>
<img decoding="async" src="http://www.kempa.com/images/blog/20061002_fridge_03.jpg" alt="Yes.  It will work."></p>

						</div><!-- .post-inner -->

			</article><!-- .post -->

		</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Lenovo PC boss: 4 in 5 of our devices will be repairable by 2025 (193 pts)]]></title>
            <link>https://www.theregister.com/2023/10/05/lenovo_pc_boss_4_in/</link>
            <guid>37778771</guid>
            <pubDate>Thu, 05 Oct 2023 14:04:30 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.theregister.com/2023/10/05/lenovo_pc_boss_4_in/">https://www.theregister.com/2023/10/05/lenovo_pc_boss_4_in/</a>, See on <a href="https://news.ycombinator.com/item?id=37778771">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="body">
<p><span>Canalys EMEA Forum 2023</span> Lenovo is forecasting that the vast majority of its devices will be repairable by 2025 – as will the repair parts themselves – but it is not intending to specify where customers should have their kit fixed.</p>
<p>Talking on stage at the Canalys EMEA Forum 2023, Luca Rossi, senior vice resident at Lenovo and president of its Intelligent Devices Group, said the company has committed to a net zero emission policy by 2050, and analyzing the components used in its hardware is part of the equation.</p>
<div><p><img src="https://regmedia.co.uk/2019/05/02/shutterstock_smashed_screen.jpg?x=174&amp;amp;y=115&amp;amp;crop=1" width="174" height="115" alt="smashed screen"></p><h2 title="Smartphones and tablets would also be added to the EU's list of devices that must be repairable under new rule">Europe's right-to-repair law asks hardware makers for fixes for up to 10 years</h2>
<p><a href="https://www.theregister.com/2023/03/22/new_eu_right_to_repair/"><span>READ MORE</span></a></p></div>
<p>"On repairability, we have a plan that by 2025 more than 80 percent of the repair parts will be repaired again so that they they enter into the circular economy to reduce the impact to the environment."</p>
<p>He added: "More than 80 percent of our devices will be able to be repaired at the customer, by the customer or by the channel and we are enabling this with a design for serviceability kind of approach."</p>
<p>This means that "batteries, SSD, many things, will not any longer be sealed into the product but will be available for the customer to be to repaired on site and then save a lot of waste."</p>

    

<p>The world's largest PC maker doesn't have a terrible reputation in terms of the ease at which its gadgets can be mended, unlike Apple. The ThinkPad T14 Gen 3, for example, was assigned a fixability score of <a target="_blank" rel="nofollow" href="https://www.ifixit.com/repairability/laptop-scores">7 out of 10</a> by Fixit; and the Framework 13 got top marks.</p>

        


        

<p>Lenovo and other vendors aren't going to make hardware easier to fix out of the goodness of their own hearts: the <a target="_blank" href="https://www.theregister.com/2023/09/21/right_to_repair/">European Council last month started to update EU rules</a> to ensure consumers are better informed about the lifespan and repairability of the tech devices they buy. The requirements should be finalized before June next year.</p>
<ul>

<li><a href="https://www.theregister.com/2023/09/01/right_to_repair_scientology/">Right to repair advocates have a new opponent: Scientologists</a></li>

<li><a href="https://www.theregister.com/2023/08/31/ifixit_ice_cream_machine/">We all scream for ice cream – so why are McDonald's machines always broken?</a></li>

<li><a href="https://www.theregister.com/2023/08/24/apple_california_right_repair/">After years of fighting Right to Repair, Apple U-turns-ish in California</a></li>

<li><a href="https://www.theregister.com/2023/05/17/logitech_teams_up_with_ifixit/">Logitech, iFixit to offer parts to stop folks binning their computer mouse</a></li>

<li><a href="https://www.theregister.com/2023/04/18/chromebook_expiration_date_and_repair/">Chromebook expiration date, repair issues 'bad for people and planet'</a></li>

<li><a href="https://www.theregister.com/2022/12/30/new_york_repair_bill/">New York gets right-to-repair law – after some industry-friendly repairs to the rules</a></li>
</ul>
<p>Similar right to repair movements are also happening stateside, including in <a target="_blank" href="https://www.theregister.com/2023/09/13/apple_california_right_repair/">California</a> and <a target="_blank" href="https://www.theregister.com/2022/12/30/new_york_repair_bill/">New York</a>.</p>
<p>Yet won't easing repairability hit Lenovo in the pocket as consumers and businesses, in theory at least, get a simpler solution to keep their devices running for longer? Canalys CEO Steve Brazier put this question to Rossi on stage.</p>
<p>"I think you cannot you cannot look at this in this way," he said, adding the future looks very rosy for tech companies. "There are so many opportunities that frankly thinking I'm not worried that we will damage our business by doing what is right for the planet. Not at all." ®</p>                                


                    </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Ron Patrick's Street-Legal Jet Powered Volkswagen Beetle (2006) (186 pts)]]></title>
            <link>https://www.ronpatrickstuff.com/</link>
            <guid>37778531</guid>
            <pubDate>Thu, 05 Oct 2023 13:45:28 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.ronpatrickstuff.com/">https://www.ronpatrickstuff.com/</a>, See on <a href="https://news.ycombinator.com/item?id=37778531">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
   <!-- ParagraphBodyStart --><div>
   <p><img src="https://www.ronpatrickstuff.com/images/AB12_15_05copy.jpg" width="800" height="600"></p><p><span size="5" color="White">This is my street-legal jet car on full afterburner.  The car has two engines: the production gasoline engine in the front driving the front wheels and the jet engine in the back.  The idea is that you drive around legally on the gasoline engine and when you want to have some fun, you spin up the jet and get on the burner (you can start the jet while driving along on the gasoline engine).  The car was built because I wanted the wildest street-legal ride possible.  With this project, I was able to use some stuff I learned while getting my fancy engineering degree (I have a PhD in Mechanical Engineering from Stanford University) to design a street-legal jet car without the distraction of how other people have done it in the past - because no one has.  I don't know how fast the car will go and probably never will.  The car was built to thrill me, not kill me.  That doesn't stop me from the occasional blast on the highway though.
   </span></p><p>
   <img src="https://www.ronpatrickstuff.com/images/VW_Rear_Pa1_PScopy.jpg" width="800" height="600"></p><p><span size="5" color="White">The car is licensed here in California.  In California, new cars have bi-annual smog inspections so if you modify the engine, it is likely to fail the inspection and you won't be able to drive it on the street.  There are some exempt engine modifications (ex. after-cat mufflers - big deal) but none that will allow you to add 1350 hp to a new car.
   </span>
   <img src="https://www.ronpatrickstuff.com/images/VW_Side1_PScopy.jpg" width="800" height="600"></p><p><span size="5" color="White">Car was built to look as if VW delivered the car this way.  It handles fine and is safe.  I was thinking of putting it into an import car show but the promoter told me that it looked too plain and recommended that I put some decals on it, lower it, and put on some aftermarket wheels.  Sure kid, put on some flimsy wheels won't take a curb and don't center on the hubs, lower the car so the tires rub and get cut by the body using springs that bounce me all over the road, and advertise for companies that couldn't engineer themselves out of a paper bag.  I would have thought the 14" diameter tailpipe was enough for him but I guess it wasn't.  Response from the hot rod magazines has been slow.  One editor told me that is because I didn't use anything they advertise.  But the response to driving it on the street and going to the hot rod shows (San Francisco Custom Car Show, Grand National Roadster Show in Pomona, and the Detroit Autorama) has been fantastic.  This car attracts crowds better than any '32 Ford, '69 Camaro, or decaled Honda.
   </span>
   <img src="https://www.ronpatrickstuff.com/images/VW_Rear_Dr1_PScopy.jpg" width="800" height="600"></p><p><span size="5" color="White">The Beetle was chosen because it looks cool with the jet and it shows it off well.  Remember the Hurst wheelstanding Barracuda "Hemi Under Glass"?  Well, this is "Jet Under Glass".  Air for the jet enters the car through the two side windows and the sunroof.  It's a little windy inside but not unbearable.
   </span>
   <img src="https://www.ronpatrickstuff.com/images/VW_Rear_Dr_Open1_PScopy.jpg" width="800" height="600"></p><p><span size="5" color="White">The production hatch release switch on the driver's door activates two new latches (one on each side) and the hatch pops open just like a production car.  The "hatch not closed" warning light works too.
   </span>
   <img src="https://www.ronpatrickstuff.com/images/VW_Rear_Open1_PScopy.jpg" width="600" height="800"></p><p><span size="5" color="White">Here you can see the split in the tailpipe after a particularily rude burner pop.  All fixed and reinforced now.  The heat blanket keeps the plastic bumper from melting when the jet is operating.
   </span><img src="https://www.ronpatrickstuff.com/images/VW_BackDash1_PScopy.jpg" width="800" height="600"></p><p><span size="5" color="White">The back of the gauge panel was kept open to give the car a techie look.  Something to talk about.  The car's an engineering device, let's see some engineering thingies.  The aluminum panel was designed in SolidWorks and cut out of billet, bead blasted, clear annodized, and then the labels for the switches were milled into the front using a font matching the VW cluster.  Little details like the holes having flat sides so the switches don't spin and exactly matching the contour of the dash added time to the project.  Several versions were made out of styrofoam first to get the layout and lighting right.  From the back, the panel reminds me of the 1970s McLaren CanAm cars.
   </span><img src="https://www.ronpatrickstuff.com/images/VW_Back_Pa_Window1_PScopy.jpg" width="800" height="600"></p><p><span size="5" color="White">The first thing I did when I got the car was to cut the hole in the back for the engine.  Made a fancy jig out of a tripod, a rod, and a lawnmower wheel to mark out the cut and went at it with a pneumatic saw.  Then finished it off with jeweler's files.  No paint required.  Didn't even chip.  The hole was tricky because it goes through 3 layers (bumper and two layers of metal) and it's a circle projected onto angled surfaces.   Just finding the centerline of the car wasn't trivial.  Worrying what my neighbors would say if I ruined the back of a brand-new car made me REAL careful.  I believe the hole is within 2 mm.
   </span><img src="https://www.ronpatrickstuff.com/images/VW_Dash_Pa1_PScopy.jpg" width="600" height="800"></p><p><span size="5" color="White">There are three gauges for the jet: %RPM, Oil Pressure, and Turbine Inlet Temperature.  The most important is turbine inlet temperature.  If you exceed about 650 degrees C for very long, you damage the engine.  This is critical on start-up.  You don't want a "hot-start".  The throttle for the jet engine is located next to the gear selector.  It is a lever and has three buttons: Cool, Big-Fire, and Afterburner.  "Cool" leans out the engine and is used to lower the turbine inlet temperature if you get a hot-start.  To light big-fire or the afterburner, you hold a button down and 1/2 second later, press the hot-streak button on the floor.  Then things happen!  Notice the kerosene level gauge in front of the gear selector (jet fuel is mostly kerosene) and the bud vase missing a rose.  Where did it go?
   </span></p></div>
<div><p>
<img src="https://www.ronpatrickstuff.com/images/VW_FUBB_PScopy.jpg" width="800" height="600"></p><p><span size="5" color="White">Lotsa stuff back here.  The force from the jet is tied to the vehicle through sandwich plates inside the car bolted to contoured aluminum billets that were slid into the frame rails.  You can see the billet on the left side with a hole in its center, welded to the plate with 4 bolts.  Used helium as the inert gas and a lot of current to weld that chunk of aluminum.  To return the car to its production height, adjustable spring perches were used.  Same spring rate, just corrected the ride height.  Drives and handles fine.  Kerosene is stored in a custom 14 gallon, baffled, foam-filled kevlar fuel cell in the spare tire well.  Two fuel exits in the back: a -12 on the left side and a -10 on the right.  The -10 goes to a shutoff, then a Barry Grant pump (one of the few hot rod parts on the car), then up into the car where it sees a filter, a regulator, and an electrical shutoff valve before feeding the engine.  The -12 goes into a shutoff, then a 1.5 hp, 11,000 rpm, 24V custom electric pump.   Pump is magnesium and can maintain 100 psi at 550 gph.  From the pump it goes into the car to a filter, then a large regulator, and then to the afterburner solenoid and the big-fire solenoid (to left of pump and feeding bottom of tailpipe through orange covered hose).  Fuel system was tested for flow capability.  Above the big pump you can see the relocated gasoline cap actuator and all that black stuff on the right side is the stock fuel evaporative control equipment.  All circuits feeding solenoids and pumps have fuses, relays, kick-back diodes to minimize contact arcing, sealed connectors, and use automotive wires of a gauge giving a maximum of 1V drop over the circuit loop.
</span><img src="https://www.ronpatrickstuff.com/images/VW_Engine_Dr1_PScopy.jpg" width="800" height="600"></p><p><span size="5" color="White">The engine is a General Electric Model T58-8F.  This is a helicopter turboshaft engine that was converted to a jet engine by some internal modifications and a custom tailpipe.  The engine spins up to 26,000 RPM (idle is 13,000 RPM), draws air at 11,000 CFM, and is rated at 1350 hp.  It weighs only 300 lbm.  It grows as it warms up so the engine mounts have to account for this.  The mounts in the front are rubber and the back are sliding mounts on rubber.  The structure holding the engine was designed using finite element analysis and is redundant.  Strong, damage tolerant, and light.  Second battery and fuse/relay panel on the right, halon fire system and 5 gallon dry sump tank on left.  24V starter motor is in the nose of the engine.  700 A of current goes into that motor for 20 seconds during start-up.  Due to heat, must limit starts to three in one hour.  Big screen is to avoid FOD (foreign object damage).  Jet keeps sucking the rose out of the bud vase on the dash!
</span><img src="https://www.ronpatrickstuff.com/images/VW_Fire_Ext1_PScopy.jpg" width="800" height="600"></p><p><span size="5" color="White">A lot of attention to details in the car.  Note the aluminum block holding/protecting the halon gas line, pull line, harness to engine, and oil pressure line.  Rectangular tank under inlet screen is for various fuel drains.  Note temperature gauge and shutoff valve for dry sump tank.  3 gallons of turbine oil at $25/quart (ouch!).  Two-stage PPG paint matching exterior of car was used inside the car.  It is not easy to paint around a lot of bars, etc while crouched in a car, in your dusty home garage, avoiding drips, and with your wife screaming that the fumes will cause brain damage in the kids.  Especially with two-stage where you have multiple coats and critical drying times.  Kids passed their grades so I guess damage was minimal, but more importantly, the paint turned out great!
</span><img src="https://www.ronpatrickstuff.com/images/VW_Fire1copy.jpg" width="800" height="494"></p><p><span size="5" color="White">Street racing action.  The other guy wimped out after a few "big-fire" demonstrations.  What you see in the picture is about one-twentieth the full size of the fireball.  Guy standing beside car had never seen it run before and was smiling ear-to-ear throughout the show.  Had I launched, I would have burned him to a crisp.  Well, live and learn.
</span><img src="https://www.ronpatrickstuff.com/images/VW_BUS1PScopy.jpg" width="800" height="600"></p><p><span size="5" color="White">We get this a lot.  A police officer picking at his nose while trying to figure out what to charge me with.  Notice the hopeful anticipation of us on the right.  We're rooting for him and offer suggestions but unfortunately, the California Department of Motor Vehicles did not anticipate such a vehicle so he's out of luck.  Hmmm, the car has two engines making the car a hybrid so maybe we can drive in the commuter lanes along with the Toyota Priuses.
<p>*** Update 7/18/06 *** You have to give the California Department of Motor Vehicles (the DMV) credit for 
creativity on this one.� A DMV insider has disclosed to me that the DMV has 
made a formal request to a federal agency to rule if my Beetle constitutes a 
threat to national security based on what could happen if it got into the wrong 
hands. �This raises three questions in my mind: #1 Does this mean I�m the 
right hands?� #2 If someone with the name "b_laden13" is the highest eBay 
bidder for my Beetle can I refuse his offer even if he has the prestigious eBay 
Red Shooting Star feedback rating (the highest)? �#3 Would this affect my 
eBay rating?</p></span>

</p></div>
<div><p><span size="5"><br></span>
<img src="https://www.ronpatrickstuff.com/images/VW_Repair1_PScopy.jpg" width="800" height="600"></p><p><span size="5" color="White">The car was built in this garage.  Paint, welding, everything except some mill work.  That's me standing beside the engine that is out of the car for some fuel controller work.  The orange line is for the afterburner.  There's one on the other side too.  Here you can make out the four rows of variable inlets/stators at the front of the engine.  Their angle changes with engine speed and are used to avoid compressor stall.  There are 11 compressor stages and 2 turbine stages.  The engine's pressure ratio is 8.3:1.  That's how you work on a jet engine.  Stick it on its end.  Easy to store them that way too.
</span>
<img src="https://www.ronpatrickstuff.com/images/SCOOTE2PScopy.jpg" width="800" height="600"></p><p><span size="5" color="White">Here's my wife's Honda Metropolitan scooter.  She wants it to go faster than 40 mph.  So I have these two little JFS 100 jet engines and I am thinking how to put them on the scooter.  Engines are 50 lbm each so weight is an issue.  Will probably use air-start with a carbon fiber tank of compressed air.  That saves weight since batteries will then not be needed.
</span>
<img src="https://www.ronpatrickstuff.com/images/SCOOTE3PScopy.jpg" width="600" height="800"></p><p><span size="5" color="White">Looks cool from the top.  Will want to make aluminum housings to go over the engines just like on a DC-9.
</span>
<img src="https://www.ronpatrickstuff.com/images/SCOOTE1PScopy.jpg" width="800" height="600"></p><p><span size="5" color="White">Bitchin' from the back too.  Should get the scooter going.  On one jet engine alone, this engine will get a kart up to 60 mph.  Looks like I have a lot of spare wire left over from the Beetle job to do the scooter.
</span><br></p></div><!-- ParagraphBodyEnd -->
  </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Where does my computer get the time from? (646 pts)]]></title>
            <link>https://dotat.at/@/2023-05-26-whence-time.html</link>
            <guid>37778496</guid>
            <pubDate>Thu, 05 Oct 2023 13:42:37 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://dotat.at/@/2023-05-26-whence-time.html">https://dotat.at/@/2023-05-26-whence-time.html</a>, See on <a href="https://news.ycombinator.com/item?id=37778496">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
  <p>This week I was in Rotterdam for <a href="https://ripe86.ripe.net/">a RIPE meeting</a>.
On Friday morning I gave a lightning talk called <a href="https://ripe86.ripe.net/archives/video/1126/">where does my
computer get the time from?</a>
The RIPE meeting website has a copy of my slides and a video of the talk;
this is a blogified version, not an exact transcript.</p>
<blockquote>
<p>I wrote a follow-up note, <a href="https://dotat.at/@/2023-05-28-whence-whence-time.html">“Where does ‘where does my computer get
the time from?’ come from?”</a> about some things I left
out of the talk.</p>
</blockquote>
<p><img src="https://dotat.at/@/2023-04-whence-time.001.jpeg" alt="Where does my computer get the time from?"></p>
<p>Where does my computer get the time from?</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.002.jpeg" alt="from NTP"></p>
<p>from NTP - here’s a picture of an NTP packet</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.003.jpeg" alt="David Mills surrounded by clocks"></p>
<p>and here’s a picture of David Mills who invented NTP</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.004.jpeg" alt="Where does my computer get the time from? NTP"></p>
<p>simple question, easy answer, end of talk? No!</p>
<p>let’s peel off some layers…</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.005.jpeg" alt="Where does NTP get the time from? NTP"></p>
<p>stratum 3 NTP servers get the time from stratum 2 NTP servers,</p>
<p>stratum 2 NTP servers get the time from stratum 1 NTP servers,</p>
<p>stratum 1 NTP servers get the time from some reference clock</p>
<p>maybe a radio signal such as MSF in Britain or DCF77 in Germany</p>
<p>but in most cases the reference clock is probably a GPS receiver</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.006.jpeg" alt="Where does NTP get the time from? GPS"></p>
<p>here’s a GPS timing receiver</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.007.jpeg" alt="Where does NTP get the time from? GPS"></p>
<p>and here’s a GPS satellite</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.008.jpeg" alt="Where does GPS get the time from?"></p>
<p>where does GPS get the time from?</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.009.jpeg" alt="Schriever space force base entrance sign"></p>
<p>Schriever Space Force Base in Colorado</p>
<p>they look after a lot of different top secret satellites and other
stuff at Schriever, as you can see from all the mission logos</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.010.jpeg" alt="Schriever space force base aerial photo"></p>
<p>so you can’t get close enough to take a nice photo</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.011.jpeg" alt="Where does Schriever SFB get the time from?"></p>
<p>Where does Schriever SFB get the time from?</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.012.jpeg" alt="racks of time-keeping equipment with smart blue blanking panels"></p>
<p>the US Naval Observatory Alternate Master Clock
is on site at Schriever in Colorado</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.013.jpeg" alt="the USNO main building"></p>
<p>the US Naval Observatory Alternate Master Clock
gets the time from the US Naval Observatory in Washington DC</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.014.jpeg" alt="where does the USNO get the time from?"></p>
<p>there are three answers</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.015.jpeg" alt="USNO atomic clocks"></p>
<p>the first answer is atomic clocks, lots of atomic clocks</p>
<p>in the background there are dozens of rack mounted caesium beam clocks</p>
<p>in the foreground the black boxes house hydrogen masers</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.016.jpeg" alt="more USNO atomic clocks"></p>
<p>these shiny cylinders are <a href="https://www.cnmoc.usff.navy.mil/Our-Commands/United-States-Naval-Observatory/Precise-Time-Department/The-USNO-Master-Clock/The-USNO-Master-Clock/Rubidium-Fountain-Clocks/">rubidium fountains</a></p>
<p><img src="https://dotat.at/@/2023-04-whence-time.017.jpeg" alt="aerial photograph of the USNO campus, which is a perfect circle"></p>
<p>the USNO has so many atomic clocks they have entire buildings dedicated to them</p>
<p>When I was preparing this talk I noticed on Apple Maps that there’s a
huge building site in the middle of the USNO campus. It turns out they
are building a fancy new clock house; the main limit on the accuracy
of their clocks is environmental stability: temperature, humidity,
etc. so the new building will have serious air handling.</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.018.jpeg" alt="where does the USNO get the time from?"></p>
<p>the second answer is that UTC is a horrible compromise between time
from atomic clocks and time from earth rotation</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.019.jpeg" alt="the Paris observatory"></p>
<p>so the USNO gets the time from the international earth rotation
service, which is based at the Paris Observatory</p>
<p>twice a year the IERS sends out
<a href="https://datacenter.iers.org/availableVersions.php?id=16">Bulletin C</a>,
which says whether or not there will be a leap second in six months
time; leap seconds are added (or maybe removed) from UTC to keep it in
sync with earth rotation</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.020.jpeg" alt="where does the IERS get the time from?"></p>
<p>the IERS is spread across several organizations which contribute
to its scientific work</p>
<p>for example, you can subscribe to <a href="https://datacenter.iers.org/availableVersions.php?id=6">IERS Bulletin A</a>,
which is a weekly notice with precise details of the earth orientation parameters</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.021.jpeg" alt="the USNO main building"></p>
<p>Bulletin A is sent out by the US Naval observatory</p>
<p>they need to know the exact orientation of the earth under the GPS
satellites, so they can provide precise positioning</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.022.jpeg" alt="where does the USNO get the time from?"></p>
<p>the third answer is, how does the USNO know its atomic clocks are working well?</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.023.jpeg" alt="the pavillion de breteuil"></p>
<p>that information comes from the international bureau of weights and
measures in Paris, who maintain the global standard UTC</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.024.jpeg" alt="where does the BIPM get the time from?"></p>
<p>how does the BIPM determine what UTC is?</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.025.jpeg" alt="Circular T"></p>
<p>the BIPM collects time measurements from national timing laboratories
around the world, and uses those measurements to determine official
UTC</p>
<p>periodically they send out <a href="https://www.bipm.org/en/time-ftp/circular-t">Circular T</a>
which has information about the discrepencies between official UTC and
UTC from the various national time labs</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.026.jpeg" alt="diagram of the new SI"></p>
<p>the BIPM is responsible for maintaining the international system of
units, which is defined by the general conference on weights and
measures</p>
<p>the CGPM is an international treaty organization established by the
metre convention of 1875</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.027.jpeg" alt="diagram of the SI highlighting the second"></p>
<p>UTC is an implementation of the SI unit of time, based on quantum
measurements of caesium atoms</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.028.jpeg" alt="where did the CGPM get the time from?"></p>
<p>where did this magic number, about 9.2 GHz, come from?</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.029.jpeg" alt="Essen and Parry standing next to their atomic clock"></p>
<p>in 1955, Louis Essen (on the right) and Jack Parry (left) built
the first caesium atomic clock</p>
<p>the current definition of the second came from the calibration of this clock</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.030.jpeg" alt="where did Essen and Parry get the time from?"></p>
<p>before atomic clocks, the definition of the second was based on
astronomy, so Essen and Parry needed help from astronomers to find out
how fast their clock ticks according to the existing standard of time</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.031.jpeg" alt="the USNO main building"></p>
<p>they got help from the astronomers at the US Naval Observatory</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.032.jpeg" alt="Markowitz and Essen"></p>
<p>the way it worked was William Markowitz measured time by looking at
the skies, and Louis Essen measured time by looking at his atomic
clock, and to correlate their measurements, they both listened to the
WWV radio time signal broadcast by the national bureau of standards in
Washington DC</p>
<p>this project took 3 years, 1955 - 1958</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.033.jpeg" alt="where did Markowitz get the time from?"></p>
<p>Markowitz was measuring the “ephemeris second”</p>
<p>in 1952 the international astronomical union changed the definition of
time so that instead of being based on the rotation of the earth about
its axis, it was based on the orbit of the earth around the sun</p>
<p>in the 1930s they had discovered that the earth’s rotation is not
perfectly even: it slows down and speeds up slightly</p>
<p>clocks were now more precise than the rotation of the earth, so the
ephemeris second was a new more precise standard of time</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.034.jpeg" alt="where did the IAU get the time from?"></p>
<p>the ephemeris second is based on an astronomical ephemeris, which is a
mathematical model of the solar system</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.035.jpeg" alt="tables of the motion of the earth on its axis and around the sun"></p>
<p>the standard ephemeris was produced by Simon Newcomb in the late 1800s</p>
<p>he collected a vast amount of historical astronomical data to create
his mathematical model</p>
<p>it remained the standard until the mid 1980s</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.036.jpeg" alt="Simon Newcomb"></p>
<p>here’s a picture of Simon Newcomb</p>
<p>he is a fine-looking Victorian gentleman</p>
<p>where did he work?</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.037.jpeg" alt="the USNO main building"></p>
<p>at the US naval observatory!</p>
<p>(and the US nautical almanac office)</p>
<p><img src="https://dotat.at/@/2023-04-whence-time.038.jpeg" alt="the Royal Greenwich Observatory"></p>
<p>I have now run out of layers: before this point, clocks were set more
straightforwardly by watching stars cross the sky</p>
<p>so, to summarise my talk, where does my computer get the time from?</p>
<p>it does <em>not</em> get it from the Royal Greenwich Observatory!</p>

</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Fluid Simulation (148 pts)]]></title>
            <link>https://kyndinfo.notion.site/Fluid-Simulation-f0516d9d12e245a08ae5c7545ac822dd</link>
            <guid>37778334</guid>
            <pubDate>Thu, 05 Oct 2023 13:27:38 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://kyndinfo.notion.site/Fluid-Simulation-f0516d9d12e245a08ae5c7545ac822dd">https://kyndinfo.notion.site/Fluid-Simulation-f0516d9d12e245a08ae5c7545ac822dd</a>, See on <a href="https://news.ycombinator.com/item?id=37778334">Hacker News</a></p>
&lt;Unparsable&gt;]]></description>
        </item>
        <item>
            <title><![CDATA[Introducing “Database Performance at Scale”: A Free, Open Source Book (304 pts)]]></title>
            <link>https://www.scylladb.com/2023/10/02/introducing-database-performance-at-scale-a-free-open-source-book/</link>
            <guid>37778069</guid>
            <pubDate>Thu, 05 Oct 2023 13:02:24 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.scylladb.com/2023/10/02/introducing-database-performance-at-scale-a-free-open-source-book/">https://www.scylladb.com/2023/10/02/introducing-database-performance-at-scale-a-free-open-source-book/</a>, See on <a href="https://news.ycombinator.com/item?id=37778069">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
                        <p><strong>Discover new ways to optimize database performance and avoid common mistakes that impact latency and throughput</strong></p>
<p>So many things have to align perfectly for impressive database performance. You need to think hard about factors like:</p>
<ul>
<li>The infrastructure your database sits on</li>
<li>How it’s set up</li>
<li>How you’re managing it</li>
<li>How your application interacts with the driver</li>
<li>How the driver interacts with your database</li>
<li>How that database is designed</li>
<li>How well its approach aligns with your specific workload characteristics and requirements</li>
</ul>
<p>And that’s just scratching the surface. Behind each of those elements, there’s likely years of engineering efforts from the database side – not to mention all the user-side strategizing, trial-and-error optimization, and high-pressure triaging.</p>
<p>Most teams don’t have that level of time and patience. They need performance, and they want it now.</p>
<p><img decoding="async" src="https://www.scylladb.com/wp-content/uploads/database-performance-thumb.png" alt="database performance at scale guide" width="250" height="250" srcset="https://www.scylladb.com/wp-content/uploads//database-performance-thumb.png 1000w, https://www.scylladb.com/wp-content/uploads//database-performance-thumb-300x300.png 300w, https://www.scylladb.com/wp-content/uploads//database-performance-thumb-150x150.png 150w, https://www.scylladb.com/wp-content/uploads//database-performance-thumb-768x768.png 768w" sizes="(max-width: 250px) 100vw, 250px" data-old-src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20width='250'%20height='250'%20viewBox='0%200%20250%20250'%3E%3C/svg%3E" data-src="https://www.scylladb.com/wp-content/uploads/database-performance-thumb.png" data-srcset="https://www.scylladb.com/wp-content/uploads//database-performance-thumb.png 1000w, https://www.scylladb.com/wp-content/uploads//database-performance-thumb-300x300.png 300w, https://www.scylladb.com/wp-content/uploads//database-performance-thumb-150x150.png 150w, https://www.scylladb.com/wp-content/uploads//database-performance-thumb-768x768.png 768w">Enter <em><strong>Database Performance at Scale</strong></em>, a new (free) open source book written by ScyllaDB employees and contributors Felipe Cardeneti Mendes, Piotr Sarna, Pavel Emelyanov, and Cynthia Dunlop. The authors set out to cover the many different elements that impact database performance, offering clear, practical recommendations based on their own engineering efforts and experience with thousands of real-world database deployments.</p>
<p><a href="https://lp.scylladb.com/database-performance-book-offer">Digital Download + Request Printed Book</a></p>
<p>The complete 270-page book is available now, for free.</p>
<p>Here are a few important things to note…</p>
<h2>It’s not “about” ScyllaDB – but it’s highly relevant for anyone using or considering it</h2>
<p>While this book was written by people who have been working at ScyllaDB, it’s not a book “about” ScyllaDB per se. The authors wanted to explore the topic of database performance at a broader level so the book would be relevant even beyond the ScyllaDB community. It doesn’t matter what database you’re currently using (MongoDB, MySQL, Postgres, Cassandra, DynamoDB…). If you’re experiencing some pain related to database latency and/or throughput – or you fear you will suffer soon – this is a book for you.</p>
<p>If you’re considering or already using ScyllaDB, you’ll definitely want to look at this book. It features the collective wisdom of teams who develop ScyllaDB and guide our customers through their most complex challenges. And if you want to discuss these topics in relation to your specific use case, we’d be happy to chat more – <a href="https://www.scylladb.com/company/contact-us/">just contact us</a>.</p>
<p>Also, if you are interested in a book specifically about ScyllaDB, stay tuned to our social media handles. There will be some exciting news on that front quite soon. 😉</p>
<h2>It’s highly opinionated</h2>
<p>When ScyllaDB started working with Discord 5 years ago, one of the things they appreciated most was “<a href="https://www.scylladb.com/2019/03/20/discord-on-the-joy-of-opinionated-systems/">the joy of opinionated systems</a>.” In other words, “people who are good stewards of the system have already figured out what is important.”</p>
<p>This opinionated approach is a hallmark of the <em>Database Performance at Scale</em> book. Whether explaining a performance-critical decision that a database user will likely face or sharing the rationale behind various engineering optimizations, the authors present their perspective on the associated tradeoffs, along with their recommendations on what’s best from the perspective of performance.</p>
<h2>It’s free, it’s open source… and it’s fun</h2>
<p>The authors, and all the engineers throughout both <a href="https://www.scylladb.com/">ScyllaDB</a> and <a href="https://turso.tech/">Turso</a>, are avid open source supporters and contributors. When presented with the opportunity to write a book, everyone agreed that taking an “open source” approach would be the best way to make the finished product readily accessible to all interested readers.</p>
<h2><img decoding="async" src="https://www.scylladb.com/wp-content/uploads/DatabasePerformanceChapter1.png" alt="" width="300" height="425" srcset="https://www.scylladb.com/wp-content/uploads//DatabasePerformanceChapter1.png 572w, https://www.scylladb.com/wp-content/uploads//DatabasePerformanceChapter1-212x300.png 212w" sizes="(max-width: 300px) 100vw, 300px" data-old-src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20width='300'%20height='425'%20viewBox='0%200%20300%20425'%3E%3C/svg%3E" data-src="https://www.scylladb.com/wp-content/uploads/DatabasePerformanceChapter1.png" data-srcset="https://www.scylladb.com/wp-content/uploads//DatabasePerformanceChapter1.png 572w, https://www.scylladb.com/wp-content/uploads//DatabasePerformanceChapter1-212x300.png 212w"></h2>
<p>Apress, the book’s publisher, offers an “Open Access” series of books – and that’s what we selected. This means that the digital version is available free of charge, and the entire book is licensed under the terms of the Creative Commons Attribution 4.0 International License. Print editions are available at cost through all the standard booksellers, and ScyllaDB will be featuring printed books at our events (like <a href="https://www.p99conf.io/">P99 CONF</a>) and through special book giveaways (become eligible by <a href="https://lp.scylladb.com/database-performance-book-offer">signing up here</a>).</p>
<p><a href="https://lp.scylladb.com/database-performance-book-offer">Digital Download + Request Printed Book</a></p>
<p><a href="https://link.springer.com/content/pdf/10.1007/978-1-4842-9711-7.pdf?pdf=button">Just the PDF Please</a></p>
<p>Finally, you might not expect a book on databases to be a fun read. That’s fair. But as you might have sensed by now, these authors like to do things a bit differently. Delve into Chapter 1, and see for yourself!</p>
                    </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[HNInternal: Ask HN: Does your microwave interfere with Bluetooth? Mine does (102 pts)]]></title>
            <link>https://news.ycombinator.com/item?id=37777897</link>
            <guid>37777897</guid>
            <pubDate>Thu, 05 Oct 2023 12:47:24 GMT</pubDate>
            <description><![CDATA[<p>See on <a href="https://news.ycombinator.com/item?id=37777897">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
            <tbody><tr id="37783020"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37783020" href="https://news.ycombinator.com/vote?id=37783020&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>Bluetooth and WiFi both borrow their spectrum <i>from</i> microwave ovens. It's typical and expected that microwave ovens will cause some interference with other users of the 2.4GHz ISM band that are very nearby. Microwaves operate at very high power levels and are required to be shielded for human safety, but the permissible leakage power is relatively high compared to typical WiFi and Bluetooth devices---there's a simple reason why. From a legal perspective, Bluetooth is essentially pretending to be a microwave oven and making use of the permitted leakage power.<p>This is the cost of the historical regulatory situation that most of these unlicensed radio services use the ISM bands originally allocated for microwave heating. One of the advantages of newer WiFI standards, particularly WiFi 6E, is that they finally change this situation by using the U-NII bands allocated specifically for unlicensed short-range digital communications, rather than for microwave heating.</p><p>Mind that this is all in the context of US spectrum regulations, although other countries have largely harmonized their approach. I have a lengthier treatment of the topic here: <a href="https://computer.rip/2022-04-14-unlicensed-radio.html" rel="nofollow noreferrer">https://computer.rip/2022-04-14-unlicensed-radio.html</a>
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                <tr id="37784405"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_37784405" href="https://news.ycombinator.com/vote?id=37784405&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>And on the follow-up, "Why use 2.4(5) GHz for microwaves?"<p>Because it happens to be a convenient frequency that water absorbs readily, which is the easiest way of heating up what we'd want to heat with a microwave (read: food).</p><p><a href="https://en.wikipedia.org/wiki/Electromagnetic_absorption_by_water#Microwaves_and_radio_waves" rel="nofollow noreferrer">https://en.wikipedia.org/wiki/Electromagnetic_absorption_by_...</a></p><p>And once we'd polluted the frequency for any stable commercial use, why not use this weird carve-out for a little thing called WiFi?</p><p>Rabbit hole: Apparently the precise mechanics of EM heating of molecules are surprisingly complex, and offer a number of frequency options. But this would have been the 1950s(?), so I'd assume they empirically determined a balance of functionality + technical feasibility for water, called it a lunch, and went to have five martinis in a practical fashion.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                <tr id="37786373"><td><table>  <tbody><tr>    <td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td>
      <center><a id="up_37786373" href="https://news.ycombinator.com/vote?id=37786373&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>&gt; "<i>But this would have been the 1950s(?), so I'd assume they empirically determined a balance of functionality + technical feasibility for water, called it a lunch, and went to have five martinis in a practical fashion.</i>"<p>Or maybe they just wanted to revive frozen hamsters more humanely: "I promise this story about microwaves is interesting." by Tom Scott, about scientist James Lovelock - <a href="https://www.youtube.com/watch?v=2tdiKTSdE9Y">https://www.youtube.com/watch?v=2tdiKTSdE9Y</a>
              </p></span></p></td></tr>
        </tbody></table></td></tr>
            <tr id="37786223"><td><table>  <tbody><tr>    <td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td>
      <center><a id="up_37786223" href="https://news.ycombinator.com/vote?id=37786223&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>To further build off your rabbit hole, this is also why 2.4ghz long range wifi connections (like via a yagi antenna) is also problematic. Foliage fucks with your range. Also why central air conditioners and wet walls create wifi shadows.</span></p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="37786095"><td><table>  <tbody><tr>    <td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td>
      <center><a id="up_37786095" href="https://news.ycombinator.com/vote?id=37786095&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>To build off your rabbit hole, I've read about using the way microwaves selectively heat molecules in cooking. In particular, they can heat oil molecules in a way that increases flavor extraction without causing thermal breakdown of the flavors like uniform heating would.</span></p></div></td></tr>
        </tbody></table></td></tr>
                  <tr id="37786325"><td></td></tr>
            <tr id="37786087"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_37786087" href="https://news.ycombinator.com/vote?id=37786087&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>Also, to the best of my understanding, the only known risk to human safety of a microwave without proper shielding is injury due to the heating of human tissue. Not like that's a good reason to ignore any potential health concerns, but I used to have the misconception that it was much more dangerous, e.g. could cause cancer, but, of course, ionizing radiation is much, <i>much</i> higher frequency.</span></p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="37786094"><td><table>  <tbody><tr>    <td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td>
      <center><a id="up_37786094" href="https://news.ycombinator.com/vote?id=37786094&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>The heating part can still be very bad news for your eyes, being the most delicate exposed tissue.</span></p></div></td></tr>
        </tbody></table></td></tr>
                  <tr id="37783840"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_37783840" href="https://news.ycombinator.com/vote?id=37783840&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>The international allocation of 2.4GHz spectrum for microwaves happened at lobbying of USA, but is global - and exists in order for airplane galleys to be equipped with microwave heaters and be allowed to travel internationally.</span></p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="37784675"><td></td></tr>
                <tr id="37785070"><td></td></tr>
            <tr id="37785065"><td><table>  <tbody><tr>    <td indent="3"><img src="https://news.ycombinator.com/s.gif" height="1" width="120"></td><td>
      <center><a id="up_37785065" href="https://news.ycombinator.com/vote?id=37785065&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span><a href="https://en.wikipedia.org/wiki/List_of_common_misconceptions" rel="nofollow noreferrer">https://en.wikipedia.org/wiki/List_of_common_misconceptions</a>:<p>&gt; Microwave ovens are not tuned to any specific resonance frequency for water molecules in the food, but rather produce a broad spectrum of frequencies, cooking food via dielectric heating of polar molecules, including water. Several absorption peaks for water lie within the microwave range, and while it is true that these peaks are caused by quantization of molecular energy levels corresponding to a single frequency, water absorbs radiation across the entire microwave spectrum.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                <tr id="37785186"><td><table>  <tbody><tr>    <td indent="4"><img src="https://news.ycombinator.com/s.gif" height="1" width="160"></td><td>
      <center><a id="up_37785186" href="https://news.ycombinator.com/vote?id=37785186&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>I would contest Wikipedia's description here a bit because I think it confuses the issue of microwave emissions. A number of ISM bands were allocated for RF heating applications originally, 6.78MHz, 13.560MHz, 27.12MHz, 40.68MHz, 915MHz (commonly referred to as 900MHz), 2.45GHz (commonly referred to as 2.4GHz), 61.25GHz, 122.5GHz. These are just examples taken from my NTIA chart which doesn't call all of them out.<p>The lower ones are largely historic, the very first RF heating experiments used HF and VHF low band which were easier to produce with the radio transmitter technology of the time, but not very efficient at all. The invention of the magnetron changed that, suddenly it was much easier to produce microwave radiation at high power levels, and so the inefficient HF/VHF RF heating devices have all but faded away (there are some specific technical applications that remain exceptions, as usual).</p><p>The low frequencies are inefficient and difficult to produce with compact electronics, the high frequencies aren't very attractive for food heating applications because of the limited skin depth. So every microwave oven you're likely to run into operates at 2.4GHz, which is pretty much the sweet spot for food heating <i>among the allocated ISM bands</i>. That band is defined as 2.4GHz through 2.5GHz. So I quibble with describing microwaves as "broad spectrum." Magnetrons do not produce very narrow output, one of the reasons they aren't often used for radio transmitters today, but microwave ovens are required to constrain their meaningful output to within 50MHz of 2.45GHz. 100MHz is a <i>lot</i> of bandwidth from a modern radio communications perspective, but isn't really that wide from a perspective of physical effects.</p><p>2.45GHz was chosen as an ISM band in part because it had good properties for heating, but it wasn't put exactly on a resonance frequency for water or anything like that. The exact details of the selection process are obscure but 2.45GHz was already being used for experimental microwave heating before the ISM band was allocated, and I would imagine came out of some combination of ease of magnetron construction and reasonably good heating properties. It is documented, for example, that the EHF bands were never popular for consumer microwave heating because of poor efficacy with food, although they do have industrial applications (especially in welding).</p><p>Given the history of the topic there's a decent chance that 2.45GHz came about because it was being used by experimental radar at the time, the main thing that magnetrons were being built for. Microwave heating was basically a byproduct of radar development during its early days of development.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                        <tr id="37784417"><td></td></tr>
                <tr id="37784423"><td><table>  <tbody><tr>    <td indent="3"><img src="https://news.ycombinator.com/s.gif" height="1" width="120"></td><td>
      <center><a id="up_37784423" href="https://news.ycombinator.com/vote?id=37784423&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>Depends on equipment of the plane - the original reasoning for making 2.4GHz the international dumpster spectrum was to install microwaves</span></p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="37784607"><td></td></tr>
                <tr id="37784763"><td><table>  <tbody><tr>    <td indent="5"><img src="https://news.ycombinator.com/s.gif" height="1" width="200"></td><td>
      <center><a id="up_37784763" href="https://news.ycombinator.com/vote?id=37784763&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>That's because the equipment installed in the galley is going to be tested for operation with the specific aircraft.<p>Meanwhile <i>phone</i> radios (not WiFi, not Bluetooth) used to have interference issues with various aviation systems (with some 5G bands still causing issues).</p><p>Additionally, outside of interference issues from <i>phone</i> systems (and various other non-ISM band radios), the order helps preventing people from doing stupid things with electronics during takeoff and landing, where sudden deceleration can cause things to go awry.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                <tr id="37786321"><td><table>  <tbody><tr>    <td indent="6"><img src="https://news.ycombinator.com/s.gif" height="1" width="240"></td><td>
      <center><a id="up_37786321" href="https://news.ycombinator.com/vote?id=37786321&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>The restriction on cellular phone use on a plane comes from the FCC not FAA.<p>As far as the FAA is concerned as long as you can demonstrate (through standard tests) that a class of aircraft is tolerant of electronic devices (which the manufacturers can do), it’s up to the airline if they want to allow it. They’ve even greatly simplified the process due to the explosion of different electronic devices over the last couple decades. This covers your cell phone in the same way it does an e reader or anything else. [0] There are basically no substantiated instances of portable electronics interfering with aircraft. Certainly not the number you’d expect given the massive number of devices that transit on a massive number of planes every day at this point.</p><p>The restriction on usage comes from the FCC, applies specifically to using land mobile frequencies from aircraft, and is not out of concern for safety of the aircraft.</p><p>Things getting up into VHF, UHF and above are “line of sight” propagation. If you can draw a straight line between two points without hitting anything that will attenuate the signal… it’ll pretty much go anywhere. Voyager 1 is transmitting 15 billion miles to us on 8GHz with a 23 watt radio. Your cell phone can put out around 3 watts. People called in to ham radio nets in Vancouver, BC from Seattle, WA on a 5W handheld radio just by going to the top of the Space Needle. People regularly make contact with the ISS or satellites on similar power. A large limiting factor to the distance is the height of the transmitter. Thanks to the curvature of the Earth, over enough distance, that straight line between the two points will begin to intersect the Earth which works great to attenuate the signals to nothing. Getting higher up lets you "shout" further out.</p><p>Your cell phone transmitting at 3 watts from that kind of altitude is potentially hitting dozens or hundreds of cell towers. Frequencies which are intended to be shared among inhabitatants in a maybe dozen mile radius now need to be shared across hundreds of miles, reducing the bandwidth available for everyone. And the weak signal will cause interference substantially further.</p><p>The FCC limited transmissions while on an aircraft to prevent interference with ground communications, and continues to because there isn’t enough evidence that they won’t.</p><p>[0] <a href="https://www.faa.gov/documentLibrary/media/Advisory_Circular/AC_91.21-1D.pdf" rel="nofollow noreferrer">https://www.faa.gov/documentLibrary/media/Advisory_Circular/...</a>
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                                          <tr id="37785893"><td></td></tr>
            <tr id="37785536"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_37785536" href="https://news.ycombinator.com/vote?id=37785536&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>I've read that the way to determine if your microwave is properly sealed is to put a phone inside of it, close the door, and then try calling it. I've been unable to get the phone to ring last time I did this ~12 years ago, though if there's some expected leakage, I suppose proximity to the cell tower is a factor</span></p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="37785870"><td></td></tr>
                  <tr id="37778318"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37778318" href="https://news.ycombinator.com/vote?id=37778318&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>There's about 1000 watts of RF inside the microwave, it has to be attenuated to less than a few microwatts on the outside to avoid congestion, as they use the same frequency band.<p>I'm amazed WiFi or Bluetooth ever works at all. 8)  You can thank Hedy Lamar for that.</p><p>Try cleaning the mating surfaces around the door thoroughly. If that doesn't work, consider replacing the microwave or relocating the speaker.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                <tr id="37782515"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_37782515" href="https://news.ycombinator.com/vote?id=37782515&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>Wifi has an "interference robustness" option which is designed with microwave ovens in mind.  The power output of a microwave is a sine wave, because it's powered from your AC line power, and doesn't emit energy during the zero crossings.  "Interference robustness" times packet sends (and lengths) to be when the microwave is producing the least amount of power.  Thus, you spend half of every 60th of a second irradiating your food, and the other half downloading videos.  (Needless to say, having this on and your microwave going in the background reduces throughput.  But, dropped packets are worse than small packets that always get through, and this aims to eliminate completely stomped-on packets.)<p>Wifi also has a listen-before-talk model.  If it "hears" a microwave running, it thinks it's another station transmitting, and backs off.  This feature of the protocol is why long-range networks worked so poorly in the past.  If station A can't hear station B, but the AP can hear both of them, then A and B are going to step on each other and the AP won't be able to communicate with either station.  This is why the "enterprise" way of deploying networks was to have a ton of access points running at low power; that works well with the listen-before-talk model since the AP likely can't talk to or hear stations that are too far away for the stations in its range to hear.</p><p>I don't know if interference robustness still exists in modern standards, as I haven't seen it in a control panel for decades, but it was definitely in 802.11b.  I have never tested Bluetooth (or read the standard), but basically... the industry knows this is a problem, and handled it a long time ago.  Bluetooth might ignore the problem because it plans on frequency-hopping (away from the microwave) anyway, but like all software, that can easily be bugged.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                <tr id="37783975"><td><table>  <tbody><tr>    <td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td>
      <center><a id="up_37783975" href="https://news.ycombinator.com/vote?id=37783975&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>I have an inverter microwave. Before I went crazy with APs around my house, that microwave would win the war; no zero-crossings to sneak a packet by it.<p>Now my bluetooth only drops when I'm fairly close to the microwave as it runs. (EDIT: my WiFi, not my Bluetooth)
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                <tr id="37784873"><td><table>  <tbody><tr>    <td indent="3"><img src="https://news.ycombinator.com/s.gif" height="1" width="120"></td><td>
      <center><a id="up_37784873" href="https://news.ycombinator.com/vote?id=37784873&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>Are you saying that adding WiFi APs improved your Bluetooth connections when the microwave is running? Or is there such a thing as Bluetooth APs? Pardon my confusion.</span></p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="37784901"><td><table>  <tbody><tr>    <td indent="4"><img src="https://news.ycombinator.com/s.gif" height="1" width="160"></td><td>
      <center><a id="up_37784901" href="https://news.ycombinator.com/vote?id=37784901&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>Wow. I have no idea how I confused that.<p>Yeah, the WiFi is improved. The Bluetooth is the same as it ever was.</p><p>I pardon your confusion.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                <tr id="37785004"><td></td></tr>
                                    <tr id="37779141"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_37779141" href="https://news.ycombinator.com/vote?id=37779141&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>The microwave RF emission is actually very narrowband, though the frequency drifts all the time. Bluetooth uses FHSS so it will eventually go though, unless the noise is so powerful that it saturates the receiver.<p>I'd post a screenshot from a HackRF-produced waterfall, but I don't have a microwave :). Some wifi controllers can measure energy in the spectrum and can be used to plot a simple waterfall.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                <tr id="37779703"><td></td></tr>
                  <tr id="37786247"><td></td></tr>
            <tr id="37784544"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_37784544" href="https://news.ycombinator.com/vote?id=37784544&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>&gt; <i>Try cleaning the mating surfaces around the door thoroughly.</i><p>(I'm obviously not an electrical engineer, given this is 10x stuff) If we're talking a 2.45 GHz microwave signal, that's a 12.2 cm wavelength.</p><p>But I thought for shielding you only needed to have gaps of &lt;wavelength to null emissions.</p><p>Is there some fractional-wavelength propagation, or is my understanding of EM shielding off-base? How are microwaves noisy? E.g. <a href="https://physics.stackexchange.com/questions/269672/does-a-faraday-cage-block-outgoing-signals" rel="nofollow noreferrer">https://physics.stackexchange.com/questions/269672/does-a-fa...</a>
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                <tr id="37785143"><td><table>  <tbody><tr>    <td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td>
      <center><a id="up_37785143" href="https://news.ycombinator.com/vote?id=37785143&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>You're right. The rule of thumb for EMC engineers is to bond joints at no further than wavelength/10 where the wavelength corresponds to the highest frequency that you wish to maintain good shielding effectiveness. Some MIL projects use wavelength/100.</span></p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="37784620"><td></td></tr>
                  <tr id="37779312"><td></td></tr>
            <tr id="37780642"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_37780642" href="https://news.ycombinator.com/vote?id=37780642&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>&gt; You can thank Hedy Lamar for that.<p>eh... maybe. Don't forget the microwave isn't CW so there's plenty of transmission slots available on the off cycle.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                  <tr id="37782435"><td></td></tr>
                <tr id="37786129"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_37786129" href="https://news.ycombinator.com/vote?id=37786129&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>Now I'm imagining a collaboration among radio-astronomers to microwave their lunches at the same time around the globe.  Who would set up the prank: grad students making a secret pact at a conference to prank their professors, or vice verse?</span></p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="37784570"><td></td></tr>
            <tr id="37784431"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_37784431" href="https://news.ycombinator.com/vote?id=37784431&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>"Honey! I'm detecting some some major CMB! You gotta see this! Can you pop my lunch outta the micro too?! Thanks!"</span></p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="37785350"><td><table>  <tbody><tr>    <td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td>
      <center><a id="up_37785350" href="https://news.ycombinator.com/vote?id=37785350&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>I had a colleague who "discovered" a pulsar that later turned out to be a radar at San Francisco International Airport. I occasionally still text them photos of the "pulsar" when I have a layover at SFO.</span></p></div></td></tr>
        </tbody></table></td></tr>
                        <tr id="37786304"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37786304" href="https://news.ycombinator.com/vote?id=37786304&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>Everyone, who see possible interference from microwave, should ask nearest service and make checks, as this could be manufacturer defect or just leakage of old insulation (rust under paint), and it could be dangerous for health.<p>PS and yes, my friend once found rust hole in old microwave, so this is not very rare thing.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                <tr id="37786362"><td></td></tr>
                  <tr id="37779107"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37779107" href="https://news.ycombinator.com/vote?id=37779107&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>That's inconvenient, but it's definitely expected.<p>From <a href="https://en.wikipedia.org/wiki/ISM_radio_band" rel="nofollow noreferrer">https://en.wikipedia.org/wiki/ISM_radio_band</a> :</p><p>&gt; <i>The ISM radio bands are portions of the radio spectrum reserved internationally for industrial, scientific, and medical (ISM) purposes, excluding applications in telecommunications. Examples of applications for the use of radio frequency (RF) energy in these bands include radio-frequency process heating, microwave ovens, and medical diathermy machines. The powerful emissions of these devices can create electromagnetic interference and disrupt radio communication using the same frequency, so these devices are limited to certain bands of frequencies. In general, communications equipment operating in ISM bands must tolerate any interference generated by ISM applications, and users have no regulatory protection from ISM device operation in these bands.</i></p><p>&gt; <i>Despite the intent of the original allocations, in recent years the fastest-growing use of these bands has been for short-range, low-power wireless communications systems, since these bands are often approved for such devices, which can be used without a government license, as would otherwise be required for transmitters; ISM frequencies are often chosen for this purpose as they already must tolerate interference issues. Cordless phones, Bluetooth devices, near-field communication (NFC) devices, garage door openers, baby monitors, and wireless computer networks (Wi-Fi) may all use the ISM frequencies, although these low-power transmitters are not considered to be ISM devices.</i></p><p>So basically the microwave oven's Faraday cage needs to block enough for safety. There are regulations about the radio spectrum, but they allow it to emit some.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
            <tr id="37778685"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37778685" href="https://news.ycombinator.com/vote?id=37778685&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>My data is anecdotal, but I've observed that Panasonic inverter ovens that I've used interfered in the 2.4GHz range, while models of other brands (e.g. GE) have not.<p>(This is unfortunate because Panasonic seems to be the only brand that can actually adjust power output, whereas the others simulate lower power levels by cycling on and off.)
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                <tr id="37778777"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_37778777" href="https://news.ycombinator.com/vote?id=37778777&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>Adjusting the power output is the definition of “inverter” basically. A few brands offer it, it seems like it was probably patented as it was only 3-4 higher end well known brands at least in Australia.<p>Inverters themselves are potential noise sources though so may be part of the issue but other implementations may not interfere.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
            <tr id="37783667"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_37783667" href="https://news.ycombinator.com/vote?id=37783667&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>I know of at least two Panasonic inverter microwaves that failed within a 5 year period of ownership.<p>Mine emitted white smoke warming up some tea while I was in another room. I hope to God it wasn’t beryllium.</p><p>I still have a Panasonic OTR microwave, but it’s inverterless. It appears to be an improved design of a GE model from the same OEM.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                <tr id="37786145"><td><table>  <tbody><tr>    <td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td>
      <center><a id="up_37786145" href="https://news.ycombinator.com/vote?id=37786145&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>We have a Panasonic Inverter microwave here, must be 20 years old. It works great and I have never noticed any interference with WiFi or Bluetooth, both of which also get a lot of use in the kitchen. Just another anecdata point!</span></p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="37785063"><td></td></tr>
                  <tr id="37782562"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_37782562" href="https://news.ycombinator.com/vote?id=37782562&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>LG now sells inverter microwaves under the NeoChef brand, I believe. I saw one in a second hand store recently so they've existed for a while now. I haven't tested one to see if it interferes with anything, though.</span></p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="37784497"><td></td></tr>
                  <tr id="37784963"><td></td></tr>
            <tr id="37782216"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_37782216" href="https://news.ycombinator.com/vote?id=37782216&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>You can thank terribly written intellectual property laws for that exclusivity. It’s not like inverters are some kind of new technology, and yet here we are.</span></p></div></td></tr>
        </tbody></table></td></tr>
                  <tr id="37782067"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37782067" href="https://news.ycombinator.com/vote?id=37782067&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>My neighbors have something crazy emanating from their house.  None of my Bluetooth devices, from Bose to Plantronic to new AirPods Pro, survive signal connectivity when I walk past their house. The connection gets very disrupted and the devices have trouble reconnecting.<p>So I have to leave everything off when I go for a run and not connect headphones until I make it to the end of the street. It’s weird.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                <tr id="37782324"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_37782324" href="https://news.ycombinator.com/vote?id=37782324&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>Crazy story that someone at the local radio astronomy observatory told me.<p>Context: Radio observatories need to minimize as much radio interference as possible. Typically, they are some distance away from population, and people are asked not to use phones within a couple of km of them. Inside the premises no unshielded electronics are allowed. If any are used, you can immediately see the effects on the data being collected by the telescope.</p><p>Anyway, these guys were getting some sort of strong interference signal at 4 pm every day. They could not figure out where it was coming from. They eventually decided that it was not coming from within, but from somewhere outside the observatory. They got some triangulation equipment out and over the course of several days, finally determined that the signal was coming from a house a couple of km away.</p><p>So they went over and knocked. Asked the owner what was going on. Turned out, the guy had a electric can opener, and every day at 4 pm he would open a can to feed his dogs. That was the interference signal they were getting all the way to the observatory!</p><p>Eventually, after some back and forth, they got the guy a new can opener they had vetted to not cause an interference signal.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
            <tr id="37785298"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_37785298" href="https://news.ycombinator.com/vote?id=37785298&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>Sounds like they have something pretty powerful swamping out that band.<p>Even though the ISM (2.4 GHz) band is unlicensed, there are still regulatory limits to the maximum emission levels. Devices that exceed those levels are illegal to use. The FCC can apply hefty fines in certain cases.</p><p>Fun story, I used to live in an apartment building and my car key fob wouldn't work when I parked close to the building. It would work on the other side of the parking lot though. Turns out someone was using a jammer because they hated the noise that cars make when they lock and unlock. They tried to blame a nearby military base, but I had some RF test gear and located the culprit. They turned it off pretty quick when I showed that they could be fined $10k per day.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
            <tr id="37783630"><td></td></tr>
                <tr id="37785745"><td></td></tr>
                  <tr id="37783962"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_37783962" href="https://news.ycombinator.com/vote?id=37783962&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>The same can also be very localized. On my way to work there is a 2x2m spot in the middle of open space that does that too</span></p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="37783588"><td></td></tr>
                <tr id="37784673"><td><table>  <tbody><tr>    <td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td>
      <center><a id="up_37784673" href="https://news.ycombinator.com/vote?id=37784673&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>I live in deep suburban/exurbs and this feels quite likely, given the neighborhood. Everyone’s wired for cameras and Amazon Key, etc.</span></p></div></td></tr>
        </tbody></table></td></tr>
                        <tr id="37779951"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37779951" href="https://news.ycombinator.com/vote?id=37779951&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>At an old apartment my Chromecast would become unusable whenever I'd use the microwave in the other room. It took me a bit to understand why every now and then it would just take a dump, turns out it was my roommate cooking dinner.<p>Meanwhile my current microwave I can cook and be on bluetooth headphones paired to my laptop across the house and there's no issue.</p><p>Some microwaves are better shielded than others. It might be leakage from the actual cook box, it might be leakage from all the extra circuitry.</p><p>Even though the frequency of most microwave's primary element is going to be a little higher than what Bluetooth is supposed to run on, if there's enough energy leaking you'll still potentially drown out the signal. Filters, especially ones made to be kind of cheap, aren't perfect and can't always filter out everything.</p><p>And as mentioned you're trying to catch a few milliwatt signal right next to something that's trying to generate and contain a 1,000,000 milliwatt signal.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
            <tr id="37785999"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37785999" href="https://news.ycombinator.com/vote?id=37785999&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>There is this very popular night market where I live, and whenever I drive through a corner of this market, the Bluetooth in my car just stops. I always wondered what this was. There is just so much interference on a square meter.</span></p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="37778593"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37778593" href="https://news.ycombinator.com/vote?id=37778593&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>Microwaves typically run 2.500GHz, most bluetooth and wifi is from 2.400 to 2.480GHz to keep some space between them (so if you want to minimise WiFi/Microwave issues on 2.4Ghz, use a low WiFi channel).<p>Bluetooth is adaptive and will hop frequencies to find quiet space in the range above, however microwaves are an intermittent source so when they go on the leakage will kill any bluetooth that's on a nearby frequency.</p><p>An easy way to see this is with a BBC microbit; you can measure the signal strength on channels 1 to 100 (2.4 to 2.5GHz in 1MHz steps) and so plot the local RF sources (WiFi, Bluetooth, Microwave, etc.).
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                <tr id="37780668"><td></td></tr>
                  <tr id="37784221"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37784221" href="https://news.ycombinator.com/vote?id=37784221&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>Tangentially related: knowing they use the same frequency band, I actually used the work microwave oven as a faraday cage for testing our product which used bluetooth. (Close door, observe signal drop behavior). I was bemused to note that you could still connect to a device inside the oven, over short distances... Hopefully the attenuation was sufficient for safety when using it to cook!<p>[ For clarity - the oven wasn't on when I used it as a faraday cage]
              </p></span></p></td></tr>
        </tbody></table></td></tr>
            <tr id="37783949"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37783949" href="https://news.ycombinator.com/vote?id=37783949&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>There's a particular spot on a local highway that interrupts my wireless CarPlay connection if I spend too long in it (eg when traffic is slow).  It's right next to an exit with a bunch of buildings (including a hospital) so I'm sure there is some massive emitter in one of those buildings.  I'm still at a loss about what could cause that kind of interference inside a major city and still be legal.</span></p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="37784691"><td></td></tr>
                  <tr id="37778768"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37778768" href="https://news.ycombinator.com/vote?id=37778768&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>Around 15 years ago my wireless Magic Mouse's pointer movements would become so choppy as to become unusable not just if my microwave was in use, but also if a neighbor's was.<p>But upgrading to a new laptop+mouse fixed it, and I've never had a problem since.</p><p>Since they're on roughly the same frequency, interference makes sense. Microwave ovens are high-energy, Bluetooth is low-energy, so minor leakage can still have a big effect. But there's no health concerns or anything, precisely because it's still so low-energy. (You can't cook food with Bluetooth!)</p><p>But it does seem like some Bluetooth chips/stacks are better at hopping around frequencies to avoid it than others, or that particular devices just develop bugs.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                <tr id="37779167"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_37779167" href="https://news.ycombinator.com/vote?id=37779167&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>I've never seen this with a microwave, but this exact thing (Bluetooth mouse choppiness) happens with interference from other Bluetooth devices in the vicinity, especially when pairing. Most microwaves do produce some BT interference, so I am not surprised that the symptoms would be similar.</span></p></div></td></tr>
        </tbody></table></td></tr>
                  <tr id="37785969"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37785969" href="https://news.ycombinator.com/vote?id=37785969&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>Related question:<p>I <i>used</i> to be able to use wifi when my microwave was running. Then one day with no apparent change it started interfering, so that I can no longer use wifi if the microwave is roughly between the two devices connecting over wifi.</p><p>Of other microwaves I’ve encountered, most haven’t interfered with wifi, but one or two have.</p><p>Is <i>this</i> a problem?
              </p></span></p></td></tr>
        </tbody></table></td></tr>
            <tr id="37785481"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37785481" href="https://news.ycombinator.com/vote?id=37785481&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>London Underground announcements in certain stations seem to break Bluetooth really frequently. I suspect that at some point, the message is being transmitted by radio and this must be at a frequency that interferes.<p>Also seen on platform WiFi messed up in a similar fashion - this causes the most grief when calling over WiFi kicks in, you make a call only to find it get wrecked the moment they start announcing. Luckily in some stations you actually get a better signal over mobile, so simply turning off WiFi resolves the problem.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
            <tr id="37784594"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37784594" href="https://news.ycombinator.com/vote?id=37784594&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>Yes, my flatmate had a very old 20+ yrs old microwave (the type with a mechanical dial) and when he used it my WiFi would completely drop out until the cooking was done.<p>I bought him a new microwave because I was sick of dropping zoom calls. The modern LG microwave was much better and has virtually no effect on the WiFi.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
            <tr id="37784731"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37784731" href="https://news.ycombinator.com/vote?id=37784731&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>An interesting construction detail of the cheap modern microwave is that it only operates on one half of the mains electric waveform: microwaves use a single high-voltage diode which acts both as half-wave rectifier and voltage doubler. Thus the magnetron only operates for 10 ms in every 20 ms.<p>In theory 2.4 GHz communication protocols can easily time their transmissions to fit in the gaps left by the microwave. 50% bandwidth loss but no other effect.</p><p>This obviously isn't foolproof in practice, when 2.4 GHz was a thing I remember my WiFi dropping off whenever somebody was nuking some food. But perhaps this  might have been a quirk of my Panasonic inverter microwave - which obviously is not the simple standard circuit.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
            <tr id="37779606"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37779606" href="https://news.ycombinator.com/vote?id=37779606&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>Anytime somebody runs the microwave in my office, my headphones start crackling.  I'm sitting probably 20 feet from the microwave and my computer (source of the bluetooth signal) is right next to me.</span></p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="37779740"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_37779740" href="https://news.ycombinator.com/vote?id=37779740&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>Office microwaves (assuming it's not just a retail one that happens to be in an office) can be overpowered.  Think the last one I was near was a 2.5kW unit.</span></p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="37782095"><td><table>  <tbody><tr>    <td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td>
      <center><a id="up_37782095" href="https://news.ycombinator.com/vote?id=37782095&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>Good lord, who uses that much power in a microwave? 600W are enough.<p>(Clearly, the idiots microwaving fish in them. In one office I know they put a sticker with a crossed-through fish symbol after one particularly pungent incident)
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                <tr id="37785789"><td><table>  <tbody><tr>    <td indent="3"><img src="https://news.ycombinator.com/s.gif" height="1" width="120"></td><td>
      <center><a id="up_37785789" href="https://news.ycombinator.com/vote?id=37785789&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>I do. I've got a 1650 watt microwave. It's nice being able to reheat things dang quick. And it cooks a mean baked potato in no time!<p>Loads of recipes I run into assume at least 800W, usually 1,000W. I'd be pretty frustrated with only 600W. I can always run a high power one at less power, I can't run a low power one higher. I'll always take the more powerful microwave.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
            <tr id="37785210"><td><table>  <tbody><tr>    <td indent="3"><img src="https://news.ycombinator.com/s.gif" height="1" width="120"></td><td>
      <center><a id="up_37785210" href="https://news.ycombinator.com/vote?id=37785210&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>&gt; <i>Good lord, who uses that much power in a microwave? 600W are enough.</i><p>And next thing you'll say is that 1000W is enough for a kettle? 110V 15A AC is enough for an outlet?</p><p>Here in Europe, we don't have the patience for slow-boil kettles and slow-boil microwaves :).</p><p>(FWIW, I always stick to the full 1000W available on my microwave, and sorely miss the 1250W that my dad brought from Sweden when I was a kid.)
              </p></span></p></td></tr>
        </tbody></table></td></tr>
            <tr id="37782322"><td><table>  <tbody><tr>    <td indent="3"><img src="https://news.ycombinator.com/s.gif" height="1" width="120"></td><td>
      <center><a id="up_37782322" href="https://news.ycombinator.com/vote?id=37782322&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>Yes 600W are enough, but I once had a 1750W microwave and it was luxurious and ridiculously fast at warming.  I would pop a bad of popcorn in like 30 seconds, or warm up a slice of pizza in 15 seconds.  Makes me think like the difference between a Camaro and a Geo Metro</span></p></div></td></tr>
        </tbody></table></td></tr>
                        <tr id="37779669"><td></td></tr>
                <tr id="37779754"><td><table>  <tbody><tr>    <td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td>
      <center><a id="up_37779754" href="https://news.ycombinator.com/vote?id=37779754&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>I think we should adapt it into devices like phones, after all who doesnt like cheap quality audio hardware that just works (TM), and for some reason doesnt degrade or die after few years due to batteries?</span></p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="37780043"><td><table>  <tbody><tr>    <td indent="3"><img src="https://news.ycombinator.com/s.gif" height="1" width="120"></td><td>
      <center><a id="up_37780043" href="https://news.ycombinator.com/vote?id=37780043&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>I hate cabled headphones on a portable device<p>Physically tethering to something designed to be slipped into a pocket, put in case, set down on the table while I walk around, etc is stupid</p><p>Physically tethering to a stationary object (that you can't really <i>use</i> if you walk away form it) makes sense in some cases
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                <tr id="37780184"><td><table>  <tbody><tr>    <td indent="4"><img src="https://news.ycombinator.com/s.gif" height="1" width="160"></td><td>
      <center><a id="up_37780184" href="https://news.ycombinator.com/vote?id=37780184&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>I like headphones primarily on devices that go in my pocket because they move with me.  When I use headphones at a non-portable device I'm likely to damage them by walking away with them on.<p>I use a BT headset at my PC for this reason; I can get up and pace &amp;c. without worrying.</p><p>Quick tip if you are using wired headphones while doing chores: run the cable under your shirt; that should leave little-to-no exposed cable to snag on things.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                <tr id="37781053"><td><table>  <tbody><tr>    <td indent="5"><img src="https://news.ycombinator.com/s.gif" height="1" width="200"></td><td>
      <center><a id="up_37781053" href="https://news.ycombinator.com/vote?id=37781053&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>&gt;run the cable under your shirt; that should leave little-to-no exposed cable to snag on things<p>...except your shirt when you take your phone out of your pocket to change what's playing, answer a message, etc :|
              </p></span></p></td></tr>
        </tbody></table></td></tr>
            <tr id="37781367"><td></td></tr>
                <tr id="37783253"><td><table>  <tbody><tr>    <td indent="6"><img src="https://news.ycombinator.com/s.gif" height="1" width="240"></td><td>
      <center><a id="up_37783253" href="https://news.ycombinator.com/vote?id=37783253&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>I pace, too .. but not if I'm using a desktop - only when on the phone (and occasionally) with a laptop</span></p></div></td></tr>
        </tbody></table></td></tr>
                                                <tr id="37784699"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37784699" href="https://news.ycombinator.com/vote?id=37784699&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>The 2.4GHz spectrum is shared between Bluetooth and WiFi 802.11b/g. A few years ago, I was doing some work using an Ubertooth-One scanner (<a href="https://greatscottgadgets.com/ubertoothone/" rel="nofollow noreferrer">https://greatscottgadgets.com/ubertoothone/</a>). It was showing the traffic on different channels.<p>My wife stuck a burrito to warm up in the microwave a room away (30-40 ft). This was with a brand-name model, so presumably properly shielded, etc.</p><p>Nope. The entire spectrum just went white with noise on all channels.</p><p>Once the microwave cycle ended, it still took a good 15-30 seconds before the airwaves calmed down and went back to normal traffic.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
            <tr id="37785408"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37785408" href="https://news.ycombinator.com/vote?id=37785408&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>I have a waterpik whose motor absolutely obliterates 2.4ghz.  I sometimes use it while wearing bluetooth headphones, and music immediately stops.  It took me awhile to figure it out (I thought it was my head leaning down and putting a metal pegboard between me and my work machine, but nope).</span></p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="37778651"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37778651" href="https://news.ycombinator.com/vote?id=37778651&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>What happens when you place your phone in the microwave (don't turn the oven on, obviously) and walk away with your speaker? I'm curious what kind of range you're getting.<p>For reference: I just tried this with iPhone 13 mini + WH-1000XM3 and the connection dropped after ~5 meters.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
            <tr id="37778545"><td></td></tr>
            <tr id="37780263"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37780263" href="https://news.ycombinator.com/vote?id=37780263&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>I used an SDR to check my microwave's emissions. They were pretty narrow and stable-ish. Not stable like an actual radio, but not all over the place wrecking all of the wifi channels.<p>I've not had it interfere with bluetooth or wifi. Bluetooth frequency hops, and moves away from channels with interference (dropped frames), doesn't it?</p><p>I have a couple of illustrations at <a href="https://blog.habets.se/2017/06/Microwave.html" rel="nofollow noreferrer">https://blog.habets.se/2017/06/Microwave.html</a>
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                <tr id="37780732"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_37780732" href="https://news.ycombinator.com/vote?id=37780732&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>&gt; Bluetooth frequency hops, and moves away from channels with interference (dropped frames), doesn't it?<p>Hops yes, remembers to avoid certain channels, maybe. IIRC the hop sequence is controlled by the master device so that might add a layer of confusion if it isn't experiencing the issue.</p><p>&gt; I used an SDR to check my microwave's emissions. They were pretty narrow and stable-ish.</p><p>Yes, the issue is it's manufacturing dependent, so a different batch of those same magnetrons the next weeek would have different properties. Hence the wide band.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                  <tr id="37785648"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37785648" href="https://news.ycombinator.com/vote?id=37785648&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>Somewhat related, my bluetooth headphones get some static noise when I use my induction oven. On max power ~1900w it disrupts my headphones in a ~2m range haha</span></p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="37785219"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37785219" href="https://news.ycombinator.com/vote?id=37785219&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>My microwave oven definitely interferes with anything Bluetooth, like headsets etc.  Although audio still somewhat works from a laptop upstairs ~30-50 ft away.<p>Anyways, this is normal. Microwave oven generates a lot of 2400-2500 MHz ISM band noise. You're fine.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
            <tr id="37782434"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37782434" href="https://news.ycombinator.com/vote?id=37782434&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>You can demonstrate WiFi interference by putting a laptop next to your microwave and running a ping test to your WiFi router.  I can put my laptop about 4 feet away from my microwave and the ping test hangs as soon as the microwave starts. The ping test resumes as soon as the microwave stops.</span></p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="37783986"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_37783986" href="https://news.ycombinator.com/vote?id=37783986&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>I haven’t had my afternoon coffee yet, and I read this as though the ping test stops when you put your laptop in the microwave and turn it on.</span></p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="37785179"><td><table>  <tbody><tr>    <td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td>
      <center><a id="up_37785179" href="https://news.ycombinator.com/vote?id=37785179&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>It should stop as soon as you close the doors, I think, or else RF interference is the <i>least</i> of your problems with the microwave.</span></p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="37785699"><td></td></tr>
                        <tr id="37784724"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37784724" href="https://news.ycombinator.com/vote?id=37784724&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>The microwave became a second class citizen in our kitchen when we got the toaster oven/air fryer combo unit and then was relegated to the garage on top of the fridge. We still use it for popcorn and the occasional hot cocoa and if my coffee gets cold on the weekend I'll wander out there to warm it up. It is almost unneeded.<p>WiFi is better as a result.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
            <tr id="37784344"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37784344" href="https://news.ycombinator.com/vote?id=37784344&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>Nope, this is completely normal.<p>Many commenters are saying microwaves are pretty narrowband.</p><p>Maybe some are, but I've done spectrum analysis on a few college-dorm-level microwaves in our office with a Wi-Spy and all 3 of these microwaves spam all of the 3 usable 2.4ghz wi-fi channels when cooking.</p><p>We see similar fun in iMac labs, when they're all (attempting to) use Bluetooth Apple Magic Keyboards at once.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
            <tr id="37784517"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37784517" href="https://news.ycombinator.com/vote?id=37784517&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>I once worked for a startup that was trying to stream ads over bluetooth using microwavable foods. It _worked_, but ultimately used too much bandwidth to be practical at the resolutions advertisers wanted.</span></p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="37784645"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_37784645" href="https://news.ycombinator.com/vote?id=37784645&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>Can you explain a bit more how this worked?  The food item harvested energy from the microwave, and modulated the leaked microwaves/transmitted its own signal to hijack nearby bluetooth audio devices to play audio ads?</span></p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="37784612"><td></td></tr>
                <tr id="37785518"><td><table>  <tbody><tr>    <td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td>
      <center><a id="up_37785518" href="https://news.ycombinator.com/vote?id=37785518&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>I agree, technically fascinating, but also... incredibly scummy. As if adtech didn't have enough invasive tools in their arsenal</span></p></div></td></tr>
        </tbody></table></td></tr>
                        <tr id="37779180"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37779180" href="https://news.ycombinator.com/vote?id=37779180&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>It did with anything 2.4 GHz (BT, WiFi, Logitech nRF, etc etc). I threw my microwave away. Not really missed it, it was a waste of space, but anyone who wants to do a deauth attack can also get you to disconnect from WiFi.<p>Right now we got two airfryers, an oven (airfryers are basically mini ovens), and a mini pizza oven. The latter is pretty bad and hard to operate but because our main oven is broken, its as good as it gets. Not much edible comes out of a microwave. The tastes are almost always bland. I'd rather <i>not</i> eat. For my young kids I get to cook plain stuff, they don't enjoy anything complex but like the same stuff like pasta over and over again. We used au bain-marie in past. It requires a little bit more planning but nothing dramatic.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                <tr id="37779585"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_37779585" href="https://news.ycombinator.com/vote?id=37779585&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>I use my microwave constantly, but it's all for defrosting.<p>Once the food is no longer frozen but not yet piping hot, it then goes into the toaster oven or skillet or whatever to finish heating including crisping/browning.</p><p>It's great because it not only saves significant time, but loses less moisture. Heating from frozen in an oven dries things out too much, or you have to use up aluminum foil to wrap it, which is annoying and a waste.</p><p>Also obviously microwaves are great for soup.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                <tr id="37782581"><td><table>  <tbody><tr>    <td indent="2"><img src="https://news.ycombinator.com/s.gif" height="1" width="80"></td><td>
      <center><a id="up_37782581" href="https://news.ycombinator.com/vote?id=37782581&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>We eat soup once a week, on Saturday usually. I open the package (like this [1]), put it in a pan. Warm it up and... have soup. With a fresh baguette, some hummus or aioli or whatever. No microwave required.<p>If its frozen soup (made in bulk it is very cheap) then it just has to be put out early enough. A microwave could help to defeat bad planning or tough time schedule.</p><p>[1] <a href="https://www.ah.nl/producten/product/wi920/ah-rijkgevulde-tomatensoep" rel="nofollow noreferrer">https://www.ah.nl/producten/product/wi920/ah-rijkgevulde-tom...</a>
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                <tr id="37784280"><td><table>  <tbody><tr>    <td indent="3"><img src="https://news.ycombinator.com/s.gif" height="1" width="120"></td><td>
      <center><a id="up_37784280" href="https://news.ycombinator.com/vote?id=37784280&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>Well sure. Like I said, the main benefit of the microwave is to defrost <i>faster</i>. Nothing <i>requires</i> a microwave.<p>And soup doesn't benefit from browning or crispness so you can heat it up in the microwave the whole way.</p><p>There's nothing wrong with the pan, it just takes longer. And there isn't any taste/texture benefit over the microwave in the case of soup.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                              <tr id="37780217"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37780217" href="https://news.ycombinator.com/vote?id=37780217&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>Yes. I've wondered about this for a while. Because although the microwave is supposed to be fully shielded, when I take EMF readings on it with my TriField TF2 EMF meter, it's spitting out &gt;100mW/m^2 when it's turned on. And I've seen this happen with just about every microwave I've tried this on. The only ones that haven't seem to be those expensive integrated under-counter ones where the tray slides out rather than opens like a door. Also my phone still works/receives calls when I put it in there, so it can't be as good of a faraday cage as it's supposed to be...</span></p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="37782779"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_37782779" href="https://news.ycombinator.com/vote?id=37782779&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>"Microwaves are supposed to be perfectly shielded" is one of those myths that just won't die. Microwaves are allowed to leak <i>a lot</i>, with exactly "how much" dependent on whatever agency writes the rules where you live of course =)<p>In the US, for instance, it's the Center for Devices and Radiological Health (CDRH), part of the FDA, that sets the rules for microwaves, with the performance standard set forth by CDRH allowing leakage (measured at five centimeters from the oven surface) of 1 mW/cm² at the time of manufacture, and a maximum level of 5 mW/cm² during the lifetime of the oven.[1]</p><p>A strong wifi router or bluetooth transmitter may be transmitting at one or two orders of magnitude greater than the microwave's allowed to leak, but if you're closer to the microwave than the wifi/bluetooth transmitter, or the microwave is simply between you and the wifi/blueooth transmitter, or especially if you have a low power transmitter, that microwave's going to wreak havoc.</p><p>[1] <a href="https://transition.fcc.gov/Bureaus/Engineering_Technology/Documents/bulletins/oet56/oet56e3.pdf" rel="nofollow noreferrer">https://transition.fcc.gov/Bureaus/Engineering_Technology/Do...</a>
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                  <tr id="37780120"><td></td></tr>
            <tr id="37783995"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37783995" href="https://news.ycombinator.com/vote?id=37783995&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>My bluetooth headphones occasionally drop the connection for a moment when I'm standing to my microwave which is warming up food. 2.4GHz after all. Bluetooth and USB 3 don't play along that well either btw.</span></p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="37779727"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37779727" href="https://news.ycombinator.com/vote?id=37779727&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>Is the interference from leaking microwaves themselves or resonant leakage from the magnetron and/or support circuitry which is desired to be as cheap as possible?<p>Also you can’t really see the cage: that mesh you see in the window is indeed designed to block emission, but in a cheap one you can often see a gap between the mesh and the bezel, and of course the shell is a cheaply assembled rectangle without tight corner fittings so is probably leaking a small amount here, especially at the back, where they assume a wall will catch any leaks.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
            <tr id="37782248"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37782248" href="https://news.ycombinator.com/vote?id=37782248&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>I once had a microwave I called "The WiFi Killer". I work from home, and did then too, and every time one of my kids, or my wife, would use the microwave, I'd get knocked offline. They do work at 2.4Ghz, and this microwave was pretty old. Replaced it and never had another problem.</span></p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="37782509"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37782509" href="https://news.ycombinator.com/vote?id=37782509&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>In the early days of Wifi, it was pretty common to have your connection drop out whenever someone used the microwave.  Both systems use the same frequency band.<p>I assume modern Wifi has gotten better at chugging through the interference (and perhaps microwave-makers better at shielding).
              </p></span></p></td></tr>
        </tbody></table></td></tr>
            <tr id="37780812"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37780812" href="https://news.ycombinator.com/vote?id=37780812&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>I have the same interference with the microwaves at work.<p>There's also a small plaza in what's considered the very center of my city where I get tons of interference (sound basically keeps cutting as if I was losing connection). There's a subway station underground, and some trolley cables suspended in the air, so maybe there's some sort of power converter underground.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
            <tr id="37779706"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37779706" href="https://news.ycombinator.com/vote?id=37779706&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>My microwave is less than 2 feet from my wifi router :D  (but yeah, mostly use 5GHz channels for wifi)<p>I have no issue listening to podcasts in the kitchen while the microwave is running. I'm using Logitech H800 headphones (modified with wires going to my hearing aids).</p><p>If I put my phone in my GE microwave, I have sound breakup issues within 2-3 feet away from the microwave.  Sounds like it's better "shielded" than some others mentioned here.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
            <tr id="37785590"><td></td></tr>
            <tr id="37779357"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37779357" href="https://news.ycombinator.com/vote?id=37779357&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>I had a microwave that interfered with my 2.4 Ghz WiFi signal. If the microwave ran for more than 30 seconds any devices connected to the 2.4 Ghz SSIDs would "stop working". I assume is was due to too much noise caused by the microwave. Devices connected to the 5 Ghz SSIDs worked fine.</span></p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="37778544"><td></td></tr>
                <tr id="37778646"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_37778646" href="https://news.ycombinator.com/vote?id=37778646&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>I understand this is a (good) attempt at humor but this might be an interesting idea to see if Bluetooth leaks from inside the microwave oven (or from the outside in). Of course, the microwave has to stay off, naturally :)</span></p></div></td></tr>
        </tbody></table></td></tr>
                  <tr id="37780135"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37780135" href="https://news.ycombinator.com/vote?id=37780135&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>My Bluetooth headphones usually experience connectivity issues if I have line of sight with my running microwave. Interestingly it only happens sometimes. Usually audio will stop playing or cut off until there's a wall between me and the microwave.</span></p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="37782208"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37782208" href="https://news.ycombinator.com/vote?id=37782208&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>I used to have to time my gaming around when  roommates would be eating. Anything in the microwave was an instant dead connection</span></p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="37780196"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37780196" href="https://news.ycombinator.com/vote?id=37780196&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>My first microwave absolutely wrecked 2.4 ghz wifi, replaced it after a few years and the new one didn’t. Didn’t have many BT devices back then, but bet it would jam them as well.</span></p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="37780295"><td></td></tr>
                  <tr id="37782718"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37782718" href="https://news.ycombinator.com/vote?id=37782718&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>&gt; Ask HN: Does your microwave interfere with Bluetooth? Mine does<p>As far as i know you can make a complain by the FCC.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
            <tr id="37779128"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37779128" href="https://news.ycombinator.com/vote?id=37779128&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><p><span>Yes. My work microwave is just at the end of my Bluetooth range for my Airpods Pro.<p>If the microwave is off, then my signal is basically fine and won't cut out.</p><p>Once I turn the microwave on, all are bets off, and it cuts in and out.
              </p></span></p></td></tr>
        </tbody></table></td></tr>
                <tr id="37779365"><td></td></tr>
                  <tr id="37782599"><td></td></tr>
            <tr id="37783977"><td></td></tr>
            <tr id="37779037"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37779037" href="https://news.ycombinator.com/vote?id=37779037&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>Didn't Wi-Fi originally use 2,4 GHz because it was free to use (without needing a license), because of the noise produced by microwaves on this frequency?</span></p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="37780769"><td><table>  <tbody><tr>    <td indent="1"><img src="https://news.ycombinator.com/s.gif" height="1" width="40"></td><td>
      <center><a id="up_37780769" href="https://news.ycombinator.com/vote?id=37780769&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>Yes, 1946 was when the FCC opened up 2450 +/- 50 Mc (later MHz), for microwave and medical diathermy use. It was later, in the 80s that they allowed intentional emission. Either as CDMA or FHSS. Within a year we had Wi-Fi (CDMA) and Bluetooth (FHSS).</span></p></div></td></tr>
        </tbody></table></td></tr>
                  <tr id="37779602"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37779602" href="https://news.ycombinator.com/vote?id=37779602&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>I think microwaves ovens are allowed to emit up to 1W of energy. As mikewarot said - it's amazing Wifi/BT works at all.</span></p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="37778845"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37778845" href="https://news.ycombinator.com/vote?id=37778845&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>My neighbour's microwave nukes my bluetooth entirely. I have moved to wired everything and life is good finally!</span></p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="37780835"><td></td></tr>
            <tr id="37778517"><td></td></tr>
            <tr id="37784324"><td></td></tr>
            <tr id="37781050"><td></td></tr>
            <tr id="37778964"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37778964" href="https://news.ycombinator.com/vote?id=37778964&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>Yep. I've seen Bluetooth be affected by microwaves. Also seen WiFi be affected by Bluetooth.
It doesn't mean your microwave is unsafe.</span></p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="37784345"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37784345" href="https://news.ycombinator.com/vote?id=37784345&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>In a related question, does anyone know why my Bluetooth earbuds frequently experience brief disruptions when crossing the street at intersections? It happens far too reliably to be a coincidence.</span></p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="37778698"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37778698" href="https://news.ycombinator.com/vote?id=37778698&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>Microwaves aren't perfect faraday cages and a little spectrum bleed does happen. Not enough to cook you but definitely enough to make your wifi call or Bluetooth device can get iffy if the microwave is in the path of the sender and receiver.</span></p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="37778274"><td></td></tr>
            <tr id="37782141"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37782141" href="https://news.ycombinator.com/vote?id=37782141&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>My bluetooth often dies when I'm near tram tracks and their overhead electric lines in my city. Kind of annoying given that there are tram tracks everywhere.</span></p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="37779227"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37779227" href="https://news.ycombinator.com/vote?id=37779227&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>I noticed a quirk in my microwave recently if you apply pressure to the door handle it'll turn on the microwave. Kinda spooky.</span></p></div></td></tr>
        </tbody></table></td></tr>
                <tr id="37784821"><td></td></tr>
                  <tr id="37778587"><td><table>  <tbody><tr>    <td indent="0"><img src="https://news.ycombinator.com/s.gif" height="1" width="0"></td><td>
      <center><a id="up_37778587" href="https://news.ycombinator.com/vote?id=37778587&amp;how=up&amp;goto=item%3Fid%3D37777897"></a></center>    </td><td><br><div>
                  <p><span>Depends on both the microwave and the bluetooth device in question. My favorite pair of headphones are rather inexpensive and my microwave is a couple decades old and very high-wattage, and I get interference if I stand within a couple feet of it. I haven't had any other microwave or any other bluetooth device experience noticeable interference.</span></p></div></td></tr>
        </tbody></table></td></tr>
            <tr id="37778984"><td></td></tr>
            </tbody></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[US Government issues first-ever space debris penalty to Dish Network (255 pts)]]></title>
            <link>https://www.theguardian.com/science/2023/oct/02/fcc-space-debris-fine-dish-network-satellite</link>
            <guid>37777440</guid>
            <pubDate>Thu, 05 Oct 2023 11:54:33 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.theguardian.com/science/2023/oct/02/fcc-space-debris-fine-dish-network-satellite">https://www.theguardian.com/science/2023/oct/02/fcc-space-debris-fine-dish-network-satellite</a>, See on <a href="https://news.ycombinator.com/item?id=37777440">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="maincontent"><p>The US Federal Communications Commission (FCC) has issued its first fine to a company that violated its anti-space debris rule, <a href="https://docs.fcc.gov/public/attachments/DOC-397412A1.pdf" data-link-name="in body link">the commission announced</a> on Monday.</p><p>Dish Network has to pay $150,000 to the commission over its failure to deorbit its EchoStar-7 satellite, which has been in space for more than two decades. Instead of properly deorbiting the satellite, Dish sent it into a “disposal orbit” at an altitude low enough to pose an orbital debris risk.</p><figure id="5fe93f1d-8e03-4c99-8082-5686b9e09de2" data-spacefinder-role="richLink" data-spacefinder-type="model.dotcomrendering.pageElements.RichLinkBlockElement"><gu-island name="RichLinkComponent" priority="feature" deferuntil="idle" props="{&quot;richLinkIndex&quot;:2,&quot;element&quot;:{&quot;_type&quot;:&quot;model.dotcomrendering.pageElements.RichLinkBlockElement&quot;,&quot;url&quot;:&quot;https://www.theguardian.com/science/2023/oct/02/astronomers-light-pollution-tetris-block-satellite-bluewalker-3-stars-bright&quot;,&quot;text&quot;:&quot;Astronomers sound alarm over light pollution from huge new satellite&quot;,&quot;prefix&quot;:&quot;Related: &quot;,&quot;role&quot;:&quot;richLink&quot;,&quot;elementId&quot;:&quot;5fe93f1d-8e03-4c99-8082-5686b9e09de2&quot;},&quot;ajaxUrl&quot;:&quot;https://api.nextgen.guardianapps.co.uk&quot;,&quot;format&quot;:{&quot;display&quot;:0,&quot;theme&quot;:0,&quot;design&quot;:0}}" config="{&quot;renderingTarget&quot;:&quot;Web&quot;}"></gu-island></figure><p>“As satellite operations become more prevalent and the space economy accelerates, we must be certain that operators comply with their commitments,” said Loyaan A Egal, the FCC’s enforcement bureau chief, in the statement announcing the Dish settlement. “This is a breakthrough settlement, making very clear the FCC has strong enforcement authority and capability to enforce its vitally important space debris rules.”</p><p>In 2002, Dish launched the satellite into geostationary orbit – a field of space that begins 22,000 miles (36,000km) above Earth. It agreed in 2012 to an orbital debris mitigation plan that, upon completion of EchoStar-7’s mission, would send the the satellite 186 miles (300km) above where it was stationed, into a “graveyard orbit” where it would not be a risk to other active satellites.</p><p>But in 2022, Dish realized that the satellite was low on propellant, and would not have enough to move to its intended destination. Instead, the satellite ended up only 76 miles (122 km) above the active geostationary orbit areas – 178 km off its mark.</p><p>Space debris, broadly defined by the FCC as artificial objects orbiting Earth that are not functional spacecraft, has been a growing concern for the agency. It says that the more old material that stays in orbit, the harder it is for incoming satellites to start and complete new missions. In 2022, the FCC adopted a rule that would require satellite operators to dispose of their satellites within five years of mission completion.</p><figure data-spacefinder-role="inline" data-spacefinder-type="model.dotcomrendering.pageElements.NewsletterSignupBlockElement"><a data-ignore="global-link-styling" href="#EmailSignup-skip-link-7">skip past newsletter promotion</a><p id="EmailSignup-skip-link-7" tabindex="0" aria-label="after newsletter promotion" role="note">after newsletter promotion</p></figure><p>“Right now there are thousands of metric tons of orbital debris in the air above – and it is going to grow,” FCC chair Jessica Rosenworcel said in a 2022 statement that accompanied the announcement of the rule. “We need to address it. Because if we don’t, this space junk could constrain new opportunities.”</p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Bitmagnet: A self-hosted BitTorrent indexer, DHT crawler, and torrent search (335 pts)]]></title>
            <link>https://bitmagnet.io/</link>
            <guid>37777347</guid>
            <pubDate>Thu, 05 Oct 2023 11:44:17 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://bitmagnet.io/">https://bitmagnet.io/</a>, See on <a href="https://news.ycombinator.com/item?id=37777347">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="main-content"> <main> <h2 id="bitmagnet"> <a href="#bitmagnet" aria-labelledby="bitmagnet"></a> bitmagnet </h2> <p><strong>A self-hosted BitTorrent indexer, DHT crawler, content classifier and torrent search engine with web UI, GraphQL API and Servarr stack integration.</strong></p> <p><img src="https://bitmagnet.io/assets/images/webui-1.png" alt="bitmagnet WebUI screenshot"></p> <blockquote> <p>Important</p> <p>This software is currently in alpha. It is ready to preview some interesting and unique features, but there will likely be bugs, as well as API and database schema changes before the (currently theoretical) 1.0 release. If you’d like to support this project and help it gain momentum, <strong><a href="https://github.com/bitmagnet-io/bitmagnet" target="\_blank">please give it a star on GitHub</a></strong>.</p> <p><a href="https://bitmagnet.io/internals-development.html">If you’re interested in getting involved and you’re a backend GoLang or frontend TypeScript/Angular developer, or you’re knowledgeable about BitTorrent protocols then <strong>I’d like to hear from you</strong></a> - let’s get this thing over the line!</p> </blockquote> <h2 id="dht-what-now"> <a href="#dht-what-now" aria-labelledby="dht-what-now"></a> DHT what now…? </h2> <p>The DHT crawler is <strong>bitmagnet</strong>’s killer feature that (currently) makes it unique. Well, almost unique, read on…</p> <p>So what is it? You might be aware that you can enable DHT in your BitTorrent client, and that this allows you find peers who are announcing a torrent’s hash to a Distributed Hash Table (DHT), rather than to a centralized tracker. DHT’s lesser known feature is that it allows you to crawl the info hashes it knows about. This is how <strong>bitmagnet</strong>’s DHT crawler works works - it crawls the DHT network, requesting metadata about each info hash it discovers. It then further enriches this metadata by attempting to classify it and associate it with known pieces of content, such as movies and TV shows. It then allows you to search everything it has indexed.</p> <p>This means that <strong>bitmagnet</strong> is not reliant on any external trackers or torrent indexers. It’s a self-contained, self-hosted torrent indexer, connected via DHT to a global network of peers and constantly discovering new content.</p> <p>The DHT crawler is <em>not quite</em> unique to <strong>bitmagnet</strong>; another open-source project, <a href="https://github.com/boramalper/magnetico" target="\_blank">magnetico</a> was first (as far as I know) to implement a usable DHT crawler, and was a crucial reference point for implementing this feature. However this project is no longer maintained, and does not provide the other features such as content classification, and integration with other software in the ecosystem, that greatly improve usability.</p> <p><a href="https://bitmagnet.io/internals-development/dht-crawler.html">You can find some more technical details about <strong>bitmagnet</strong>’s DHT crawler here</a>.</p> <h2 id="features--roadmap"> <a href="#features--roadmap" aria-labelledby="features--roadmap"></a> Features &amp; Roadmap </h2> <h3 id="currently-implemented-features"> <a href="#currently-implemented-features" aria-labelledby="currently-implemented-features"></a> Currently implemented features </h3> <ul> <li>A DHT crawler</li> <li>A generic BitTorrent indexer: <strong>bitmagnet</strong> can index torrents from any source, not only the DHT network - currently this is only possible via <a href="https://bitmagnet.io/tutorials/importing.html">the <code>/import</code> endpoint</a>; more user-friendly methods are in the pipeline, see high-priority features below</li> <li>A content classifier that can currently identify movie and television content, along with key related attributes such as language, resolution, source (BluRay, webrip etc.) and enriches this with data from <a href="https://www.themoviedb.org/">The Movie Database</a></li> <li><a href="https://bitmagnet.io/tutorials/importing.html">An import facility for ingesting torrents from any source, for example the RARBG backup</a></li> <li>A torrent search engine</li> <li>A GraphQL API: currently this provides a single search query; there is also an embedded GraphQL playground at <code>/graphql</code></li> <li>A web user interface implemented in Angular: currently this is a simple single-page application providing a user interface for search queries via the GraphQL API</li> <li><a href="https://bitmagnet.io/tutorials/servarr-integration.html">A Torznab-compatible endpoint for integration with the Serverr stack</a></li> </ul> <h3 id="high-priority-features-not-yet-implemented"> <a href="#high-priority-features-not-yet-implemented" aria-labelledby="high-priority-features-not-yet-implemented"></a> High priority features not yet implemented </h3> <ul> <li>Classifiers for other types of content; enrich current classifiers and weed out incorrect classifications.</li> <li>Ordering of search results: the current alpha preview has no facility for specifying the ordering of results.</li> <li>Search performance optimisations: search is currently fast enough to be usable; it becomes more sluggish once millions of torrents have been indexed - there are some low-hanging fruit in terms of optimisation that will be a near-term priority.</li> <li>A monitoring API and WebUI dashboard showing things like crawler throughput, task queue, database size etc.</li> <li>Authentication, API keys, access levels etc.</li> <li>An admin API, and in general a more complete GraphQL API</li> <li>A more complete web UI</li> <li>Saved searches for content of particular interest, enabling custom feeds in addition to the following feature</li> <li>Smart deletion: there’s a lot of crap out there; crawling DHT can quickly use lots of database disk space, and search becomes slower with millions of indexed torrents of which 90% are of no interest. A smart deletion feature would use saved searches to identify content that you’re <em>not</em> interested in, including but not limited to <abbr title="child sexual abuse material">CSAM</abbr>, and low quality content (such as low resolution movies). It would automatically delete associated metadata and add the info hash to a bloom filter, preventing the torrent from being re-indexed in future.</li> <li>Bi-directional integration with the <a href="https://prowlarr.com/" target="\_blank">Prowlarr indexer proxy</a>: Currently <strong>bitmagnet</strong> can be added as an indexer in Prowlarr; bi-directional integration would allow <strong>bitmagnet</strong> to crawl content from any indexer configured in Prowlarr, unlocking many new sources of content</li> <li>More documentation and more tests!</li> </ul> <h3 id="pipe-dream-features"> <a href="#pipe-dream-features" aria-labelledby="pipe-dream-features"></a> Pipe dream features </h3> <p>This is where things start to get a bit nebulous. For now all focus is on delivering the core features above, but some of these ideas could be explored in future:</p> <ul> <li>In-place seeding: identify files on your computer that are part of an indexed torrent, and allow them to be seeded in place after having moved, renamed or deleted parts of the torrent</li> <li>Integration with popular BitTorrent clients</li> <li>Federation of some sort: allow friends to connect instances and pool the indexing effort, perhaps involving crowd sourcing manual content curation to supplement the automated classifiers</li> <li>Something that looks like a decentralized private tracker; by this I probably mean something that’s based partly on personal trust and manually weeding out any bad actors; I’d be wary of creating something that looks a bit like <a href="https://github.com/Tribler/tribler" target="\_blank">Tribler</a>, which while an interesting project seems to have demonstrated that implementing trust, reputation and privacy at the protocol level carries too much overhead to be a compelling alternative to plain old BitTorrent, for all its imperfections</li> <li>Support for the <a href="https://blog.libtorrent.org/2020/09/bittorrent-v2/" target="\_blank">BitTorrent v2 protocol</a>: It remains to be seen if wider adoption will ever make this a valuable feature</li> </ul> </main> </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Krita fund has 0 corporate support (281 pts)]]></title>
            <link>https://fund.krita.org/</link>
            <guid>37777301</guid>
            <pubDate>Thu, 05 Oct 2023 11:38:18 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://fund.krita.org/">https://fund.krita.org/</a>, See on <a href="https://news.ycombinator.com/item?id=37777301">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
    
      

<div role="navigation">
  <p>
    <a href="https://fund.krita.org/">
      <img src="https://krita.org/wp-content/themes/krita-org-theme/images/krita-logo.png" alt="Krita Logo">
    </a>
  </p>
  <div>
    <ul>
      <li>
        <a href="https://krita.org/en">
          <img src="https://krita.org/wp-content/themes/krita-org-theme/images/krita-logo.png" alt="Krita Logo">
        </a>
      </li>
      <li><a href="https://fund.krita.org/">Home</a></li>

      
      
      


<li><a href="https://fund.krita.org/about/">About</a></li>
<li><a href="https://fund.krita.org/grants/">Sponsored Development</a></li>

      <li><a href="https://fund.krita.org/oauth/login">Login</a></li>
      
      
      <li id="menu-item-3416">
        <a href="https://krita.org/en/shop/">Shop</a>
      </li>
    </ul>
  </div>
</div>

    
    
  <div id="frontpage-slideshow">
      <svg width="0" height="0">
      <defs>
      <clipPath id="clip-1" clipPathUnits="objectBoundingBox">
      <polygon points="0 0, 1 0, 1 1, 0 .7"></polygon>
      </clipPath>
      </defs>
      </svg>
      <div id="slogan">
          <h3>The Krita Development Fund</h3>
          
          <div>
            <p>Campaign 2023: support 10+ full time Krita developers</p>
            
            <p><strong>5 developers</strong> <span>$&nbsp;17k / month</span></p>
          </div>
          
        </div>
      
      </div>
  

  

  
  


    
<div>
    <div>
      <p>Join the Development Fund and support<br> the Krita Foundation to work on<br> <a href="https://fund.krita.org/about/">Krita development</a>.</p>
    </div>
    <div>
        <p><span>$</span><span>5051</span></p>
        <h5>MONTHLY <br> CONTRIBUTION <small><a href="#donation-notice">**</a></small></h5>
      </div>
  </div>
<section>
  <a href="https://fund.krita.org/corporate-memberships">
        </a>
      
    
    <p><small>
        * Other pricing options available.
        Displaying your badge, name or company is opt-in.
        You control it being public or private.
      </small>
    </p>
    <p><small>
        ** The donation amount displayed on this page also
        include the donation from our
        <a href="https://krita.org/en/support-us/donations/">old system</a>.
      </small>
    </p>
  
</section>

<div id="credits"><a href="#credits">
    <h2>Credits</h2></a>
    
    
    
    
    
    
    
    
    
    
    <div id="credits-platinum"><a href="#credits-platinum">
        <h2>Platinum</h2></a>
      <ul>
        <li><span title="Amanda Choi">Amanda Choi</span></li>
        <li><span title="Scott Petrovic">Scott Petrovic</span></li>
        <li><span title="HatschYuh">HatschYuh</span></li>
      </ul>
    </div>
    
    
    <div id="credits-gold"><a href="#credits-gold">
        <h2>Gold</h2></a>
      <ul>
        <li><span title="BiBiANA DE LA O">BiBiANA DE LA O</span></li>
        <li><span title="Ki">Ki</span></li>
        <li><span title="Patrick Garraud">Patrick Garraud</span></li>
        <li><span title="Portland Digital Dabblers">Portland Digital Dabblers</span></li>
        <li><span title="Laurent Valentin Jospin">Laurent Valentin Jospin</span></li>
        <li><span title="Martin Weidenauer">Martin Weidenauer</span></li>
        <li><span title="Luke Kaalim">Luke Kaalim</span></li>
        <li><span title="Liam Smyth">Liam Smyth</span></li>
        <li><span title="Tyson Tan">Tyson Tan</span></li>
        <li><span title="Scott Wilson">Scott Wilson</span></li>
        <li><span title="damien dupont">damien dupont</span></li>
        <li><span title="Takiro Ryo">Takiro Ryo</span></li>
        <li><span title="Mara Huldra">Mara Huldra</span></li>
        <li><span title="Flo Tasser">Flo Tasser</span></li>
        <li><span title="Liuuzaki（刘）">Liuuzaki（刘）</span></li>
        <li><span title="Duduf">Duduf</span></li>
        <li><span title="Johnathan Andersen">Johnathan Andersen</span></li>
        <li><span title="Wojtek Trybus">Wojtek Trybus</span></li>
        <li><span title="David Garcia">David Garcia</span></li>
        <li><span title="David Sanchez-Cuberos">David Sanchez-Cuberos</span></li>
        <li><span title="Livio Fania">Livio Fania</span></li>
        <li><span title="fullmontis">fullmontis</span></li>
        <li><span title="Jack Vanlightly">Jack Vanlightly</span></li>
        <li><span title="Philipp Brodersen">Philipp Brodersen</span></li>
        <li><span title="Merlijn Sebrechts">Merlijn Sebrechts</span></li>
        <li><span title="Foli Ayivoh">Foli Ayivoh</span></li>
        <li><span title="Erik Broeders">Erik Broeders</span></li>
      </ul>
    </div>
    
  </div>



    
    



    

    
  </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Why HTTP/3 is eating the world (509 pts)]]></title>
            <link>https://blog.apnic.net/2023/09/25/why-http-3-is-eating-the-world/</link>
            <guid>37777050</guid>
            <pubDate>Thu, 05 Oct 2023 10:59:52 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://blog.apnic.net/2023/09/25/why-http-3-is-eating-the-world/">https://blog.apnic.net/2023/09/25/why-http-3-is-eating-the-world/</a>, See on <a href="https://news.ycombinator.com/item?id=37777050">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="article-content">
                            <p><img width="555" height="202" src="https://blog.apnic.net/wp-content/uploads/2023/09/Pacman-555x202.png?v=c01599b7481a47a2d71a7421368e510d" alt="" decoding="async" fetchpriority="high" srcset="https://blog.apnic.net/wp-content/uploads/2023/09/Pacman-555x202.png?v=c01599b7481a47a2d71a7421368e510d 555w, https://blog.apnic.net/wp-content/uploads/2023/09/Pacman-300x109.png?v=c01599b7481a47a2d71a7421368e510d 300w, https://blog.apnic.net/wp-content/uploads/2023/09/Pacman-1024x373.png?v=c01599b7481a47a2d71a7421368e510d 1024w, https://blog.apnic.net/wp-content/uploads/2023/09/Pacman-768x280.png?v=c01599b7481a47a2d71a7421368e510d 768w, https://blog.apnic.net/wp-content/uploads/2023/09/Pacman-624x227.png?v=c01599b7481a47a2d71a7421368e510d 624w, https://blog.apnic.net/wp-content/uploads/2023/09/Pacman-206x75.png?v=c01599b7481a47a2d71a7421368e510d 206w, https://blog.apnic.net/wp-content/uploads/2023/09/Pacman-256x93.png?v=c01599b7481a47a2d71a7421368e510d 256w, https://blog.apnic.net/wp-content/uploads/2023/09/Pacman.png?v=c01599b7481a47a2d71a7421368e510d 1110w" sizes="(max-width: 555px) 100vw, 555px"></p><p>Adapted from Sven Mieke's orginal at <a href="https://unsplash.com/photos/Xg2kpP3bomw" target="_blank" rel="noopener">Unsplash</a>.</p>                            
<p>The HyperText Transfer Protocol (HTTP) is a cornerstone of the Internet, helping to load web pages, stream videos, and fetch data for your favourite apps.</p>



<p>Last year&nbsp;a new version of the protocol, HTTP/3, was standardized&nbsp;by the Internet Engineering Task Force (IETF), the organization in charge of defining Internet technologies. Since then, HTTP/3 and the related QUIC protocol have seen a rapid uptake on the public web. The exact numbers depend on the source and measurement methodology, with HTTP/3 support ranging from&nbsp;<a href="https://httparchive.org/reports/state-of-the-web#h3" target="_blank" rel="noreferrer noopener">19%</a>&nbsp;to&nbsp;<a href="https://2023.apricot.net/assets/files/APPS314/2023-03-01-quic-apri_1677636425.pdf" target="_blank" rel="noreferrer noopener">50+%</a>&nbsp;of web servers and networks worldwide.</p>







<p>Because these new protocols are heavily used by large companies such as Google and Meta, we can safely say that&nbsp;a large chunk of current Internet traffic already uses HTTP/3 today. In fact, the blog post you’re reading right now was probably loaded over HTTP/3!</p>



<p>In this series, I’ll provide some context on what problems HTTP/3 solves, how it performs, why it’s seen such swift adoption, and what limitations it is still working to overcome.</p>



<h2>Why do we need HTTP/3?</h2>



<p>A network protocol describes how data is communicated between two entities on the network, typically the user’s device and a web server. As there are many different companies building software for the web, the protocol needs to be standardized so that all this software can be ‘interoperable’, that is, they can all understand each other because&nbsp;they follow the same rules.</p>



<p>In practice,&nbsp;we don’t use a single protocol but a combination of several at the same time, each with its own responsibilities and rules (Figure 1). This is to make things flexible and reusable — you can still use the exact same HTTP logic, regardless if you’re using Wi-Fi, cable, or 4G/5G.</p>



<figure><a href="https://blog.apnic.net/wp-content/uploads/2023/09/fig1protocol-stack-h2-h3-995x1024-1.png"><img decoding="async" width="995" height="1024" src="https://blog.apnic.net/wp-content/uploads/2023/09/fig1protocol-stack-h2-h3-995x1024-1.png" alt="Figure 1 — The protocol stack for HTTP/2 and HTTP/3, showing how multiple protocols are combined to deliver the full Internet functionality." srcset="https://blog.apnic.net/wp-content/uploads/2023/09/fig1protocol-stack-h2-h3-995x1024-1.png 995w, https://blog.apnic.net/wp-content/uploads/2023/09/fig1protocol-stack-h2-h3-995x1024-1-292x300.png 292w, https://blog.apnic.net/wp-content/uploads/2023/09/fig1protocol-stack-h2-h3-995x1024-1-768x790.png 768w, https://blog.apnic.net/wp-content/uploads/2023/09/fig1protocol-stack-h2-h3-995x1024-1-624x642.png 624w" sizes="(max-width: 995px) 100vw, 995px"></a><figcaption>Figure 1 — The protocol stack for HTTP/2 and HTTP/3, showing how multiple protocols are combined to deliver the full Internet functionality.</figcaption></figure>



<p>Many of the original protocols for the Internet were standardized in the 80s and 90s, meaning they were built with the goals and restrictions of those decades in mind.&nbsp;While some of these protocols have stood the test of time, others have started to show their age. Most problems have been solved by workarounds and clever tricks. However, it was clear something would have to change. This is especially true for the Transport Control Protocol (TCP), which ensures your data reliably gets across the Internet.</p>



<h2>Why TCP is not optimal for today’s web</h2>



<p>HTTP/1.1 and HTTP/2 rely on TCP to successfully do their job.&nbsp;Before a client and server can exchange an HTTP request/response, they must establish a TCP connection.</p>



<p>Over time, there have been many efforts to update TCP and resolve some of its inefficiencies —&nbsp;TCP still loads webpages as if they were single files instead of a collection of hundreds of individual files. Some of these updates have been successful, but most of the more impactful ones (for example, TCP multipath and TCP Fast Open)&nbsp;took nearly a decade to be practically usable on the public Internet.</p>



<p>The main challenge with implementing changes to TCP is thousands of devices on the Internet all have their own implementation of the TCP protocol. These include phones, laptops, and servers, as well as routers, firewalls, load balancers, and other types of ‘middleboxes’. As such,&nbsp;if we want to update TCP, we have to wait for a significant portion of all these devices to update&nbsp;their implementation, which in practice can take years.</p>



<h3>The QUIC solution</h3>



<p>This became a problem to the point that the most practical way forward was to replace TCP with something entirely new.&nbsp;This replacement is the QUIC protocol, though many still (jokingly) refer to it as TCP 2.0. This nickname is appropriate because QUIC includes many of the same high-level features of TCP but with a couple of crucial changes.</p>



<p>The main change is that&nbsp;QUIC heavily integrates with the Transport Layer Security (TLS) protocol. TLS is responsible for encrypting sensitive data on the web — it’s the thing that provides the S (secure) in HTTPS. With TCP, TLS only encrypts the actual HTTP data (Figure 2). With QUIC,&nbsp;TLS also encrypts large parts of the QUIC protocol itself. This means that metadata, such as packet numbers and connection-close signals, which were visible to (and changeable by) all middleboxes in TCP, are now only available to the client and server in QUIC.</p>



<figure><a href="https://blog.apnic.net/wp-content/uploads/2023/09/fig2-tcp-vs-quic-packetization-1024x531-1.png"><img decoding="async" width="1024" height="531" src="https://blog.apnic.net/wp-content/uploads/2023/09/fig2-tcp-vs-quic-packetization-1024x531-1.png" alt="Figure 2 — Encryption differences between TCP+TLS and QUIC. QUIC encrypts much more than just the HTTP data." srcset="https://blog.apnic.net/wp-content/uploads/2023/09/fig2-tcp-vs-quic-packetization-1024x531-1.png 1024w, https://blog.apnic.net/wp-content/uploads/2023/09/fig2-tcp-vs-quic-packetization-1024x531-1-300x156.png 300w, https://blog.apnic.net/wp-content/uploads/2023/09/fig2-tcp-vs-quic-packetization-1024x531-1-768x398.png 768w, https://blog.apnic.net/wp-content/uploads/2023/09/fig2-tcp-vs-quic-packetization-1024x531-1-624x324.png 624w" sizes="(max-width: 1024px) 100vw, 1024px"></a><figcaption>Figure 2 — Encryption differences between TCP+TLS and QUIC. QUIC encrypts much more than just the HTTP data.</figcaption></figure>



<p>Furthermore, because QUIC is more extensively encrypted, it will be much easier than it was for TCP to change it or to add new features — we only need to update the clients and servers, as the middleboxes can’t decrypt the metadata anyway. This makes&nbsp;QUIC a future-proof protocol that will allow us to more quickly solve new challenges.</p>



<p>Of course,&nbsp;this extra encryption is good for the general security and privacy of the new protocol too. While TCP + TLS are perfect for securing sensitive personal data, such as credit cards or email content, they can still be vulnerable to complex (privacy) attacks, which have become ever more practical to execute due to recent advances in AI. By further encrypting this type of metadata, QUIC is more resilient to sophisticated threat actors.</p>



<p>QUIC also has many other security-related features, including defences against Distributed Denial of Service (DDoS) attacks, with features such as amplification prevention and RETRY packets.</p>



<p>Finally,&nbsp;QUIC also includes a large amount of efficiency and performance improvements compared to TCP, including a faster connection handshake (see Figure 3),&nbsp;<a href="https://calendar.perfplanet.com/2020/head-of-line-blocking-in-quic-and-http-3-the-details/" target="_blank" rel="noreferrer noopener">the removal of the ‘head-of-line blocking’ problem</a>, better packet loss detection/recovery, and ways to deal with users switching networks (I’ll go into more detail on this in my next post).</p>



<figure><a href="https://blog.apnic.net/wp-content/uploads/2023/09/fig3-connection-setup.png"><img decoding="async" loading="lazy" width="1024" height="558" src="https://blog.apnic.net/wp-content/uploads/2023/09/fig3-connection-setup-1024x558.png" alt="Figure 3 — QUIC has a faster connection setup, as it combines the ‘transport’ three-way handshake with the TLS cryptographic session establishment, which in TCP+TLS are two separate processes." srcset="https://blog.apnic.net/wp-content/uploads/2023/09/fig3-connection-setup-1024x558.png 1024w, https://blog.apnic.net/wp-content/uploads/2023/09/fig3-connection-setup-300x164.png 300w, https://blog.apnic.net/wp-content/uploads/2023/09/fig3-connection-setup-768x419.png 768w, https://blog.apnic.net/wp-content/uploads/2023/09/fig3-connection-setup-624x340.png 624w, https://blog.apnic.net/wp-content/uploads/2023/09/fig3-connection-setup.png 1200w" sizes="(max-width: 1024px) 100vw, 1024px"></a><figcaption>Figure 3 — QUIC has a faster connection setup, as it combines the ‘transport’ three-way handshake with the TLS cryptographic session establishment, which in TCP+TLS are two separate processes.</figcaption></figure>



<h2>We didn’t need HTTP/3; what we needed was QUIC</h2>



<p>Initially, there were attempts to keep HTTP/2 and make minimal adjustments so we could also use QUIC in the lower layers (after all, that’s the whole point of having these different cooperating and reusable protocols). However, it became clear QUIC was just different enough from TCP to make it HTTP/2-incompatible. As such, the decision was made to make a new version of HTTP, just for QUIC, which eventually became HTTP/3.</p>



<p>HTTP/3 is almost identical to HTTP/2. They mainly differ in the technical implementation of the features on top of QUIC or TCP. However, because HTTP/3 can use all of QUIC’s new features,&nbsp;it is expected to be more performant when loading web pages and streaming videos. In practice, it’s especially this aspect that has led to HTTP/3’s rapid adoption.</p>



<p>In my <a href="https://blog.apnic.net/2023/10/02/how-quic-helps-you-seamlessly-connect-to-different-networks/">next post</a>, I’ll go into more detail on a common connectivity problem you’ve most likely experienced and how QUIC can help reduce calls and videos from cutting out when your mobile device changes from using Wi-Fi to cellular connectivity.</p>



<p><em><a href="https://twitter.com/programmingart" target="_blank" rel="noreferrer noopener">Robin Marx</a>&nbsp;is a Web Protocol and Performance Expert at&nbsp;<a href="http://akamai.com/" target="_blank" rel="noreferrer noopener">Akamai</a>.</em></p>



<p><em>This post was originally published on the Internet Society’s <a href="https://pulse.internetsociety.org/blog/why-http-3-is-eating-the-world" target="_blank" rel="noreferrer noopener">Pulse Blog</a>.</em></p>

                            <!-- DISCUSS ON HN BUTTON: START -->
                            
                                                        <hr>

                            <p id="views-disclaimer">The views expressed by the authors of this blog are their own
                                and do not necessarily reflect the views of APNIC. Please note a <a href="https://blog.apnic.net/?p=395">Code of Conduct</a> applies to this blog.
                            </p>
                        </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[September was the most anomalously hot month ever (230 pts)]]></title>
            <link>https://www.scientificamerican.com/article/september-was-the-most-anomalously-hot-month-ever/</link>
            <guid>37776854</guid>
            <pubDate>Thu, 05 Oct 2023 10:27:51 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.scientificamerican.com/article/september-was-the-most-anomalously-hot-month-ever/">https://www.scientificamerican.com/article/september-was-the-most-anomalously-hot-month-ever/</a>, See on <a href="https://news.ycombinator.com/item?id=37776854">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><p>September shattered a record for the highest temperature anomaly of any month and could help push 2023 to be the first year to exceed 1.5 degrees Celsius above preindustrial temperatures</p></div><section data-behavior="article_progress"><figure aria-label="media" itemscope="" itemid="https://static.scientificamerican.com/sciam/cache/file/CA2232AC-B303-4975-B96CCACE3E5E5192_source.png?w=590&amp;h=800&amp;402B3B2D-C6EC-48C1-A9DB9963A34B77D4" itemprop="image" itemtype="http://schema.org/ImageObject" id="image-1"><div><picture><source media="(min-width: 768px) and (max-width: 1023px)" srcset="https://static.scientificamerican.com/sciam/cache/file/CA2232AC-B303-4975-B96CCACE3E5E5192_source.png?w=690&amp;h=930&amp;402B3B2D-C6EC-48C1-A9DB9963A34B77D4"><source media="(max-width: 767px)" srcset="https://static.scientificamerican.com/sciam/cache/file/CA2232AC-B303-4975-B96CCACE3E5E5192_source.png?w=390&amp;h=520&amp;402B3B2D-C6EC-48C1-A9DB9963A34B77D4"><source media="(min-width: 768px) and (max-width: 1023px)" srcset="https://static.scientificamerican.com/sciam/cache/file/CA2232AC-B303-4975-B96CCACE3E5E5192_source.png?w=690&amp;h=930&amp;402B3B2D-C6EC-48C1-A9DB9963A34B77D4"><source media="(max-width: 767px)" srcset="https://static.scientificamerican.com/sciam/cache/file/CA2232AC-B303-4975-B96CCACE3E5E5192_source.png?w=390&amp;h=520&amp;402B3B2D-C6EC-48C1-A9DB9963A34B77D4"><img importance="high" src="https://static.scientificamerican.com/sciam/cache/file/CA2232AC-B303-4975-B96CCACE3E5E5192_source.png?w=590&amp;h=800&amp;402B3B2D-C6EC-48C1-A9DB9963A34B77D4" width="590" height="800" alt="September Was the Most Anomalously Hot Month Ever" itemprop="url"></picture></div><figcaption itemprop="caption description"> Credit: Zeke Hausfather, restyled by John Knight</figcaption></figure><div data-behavior="newsletter_promo dfp_article_rendering" data-dfp-adword="Advertisement" data-newsletterpromo_article-text="<p>Sign up for <em>Scientific American</em>&amp;rsquo;s free newsletters.</p>" data-newsletterpromo_article-image="https://static.scientificamerican.com/sciam/cache/file/4641809D-B8F1-41A3-9E5A87C21ADB2FD8_source.png" data-newsletterpromo_article-button-text="Sign Up" data-newsletterpromo_article-button-link="https://www.scientificamerican.com/page/newsletter-sign-up/?origincode=2018_sciam_ArticlePromo_NewsletterSignUp" name="articleBody" itemprop="articleBody"><p>In a year already overloaded with so many climate-related superlatives, it’s time to add another to the list: September was the most anomalously warm month ever recorded.</p>

<p>And the steady heat building this year could make 2023 not only the hottest year on record but the first to exceed 1.5 degrees Celsius (2.7 degrees Fahrenheit) above preindustrial temperatures, or the stable climate that preceded the massive release of greenhouse gases into the atmosphere from burning fossil fuels. Under the landmark Paris climate accord, nations have pledged to try to keep global warming under that threshold. “It’s very worrying,” says Kate Marvel, a senior climate scientist at Project Drawdown, a nonprofit organization that develops roadmaps for climate solutions.</p>

<p>According to data kept by the Japan Meteorological Agency, this September was about 0.5 degree C (0.9 degree F) hotter than the previous hottest September in 2020. It was also about 0.2 degree C (0.4 degree F) warmer than the previous record high temperature anomaly—a measure of how much warmer or colder a given time period is, compared with the average—which had been set in February 2016 during a blockbuster El Niño.</p>

<p>The September anomaly “is so far above anything we’ve seen before,” says Zeke Hausfather, a climate scientist who works at the payment processing firm Stripe and <a href="https://www.theclimatebrink.com/p/visualizing-a-summer-of-extremes">wrote about September’s heat in a recent blog post</a>. On X, formerly known as Twitter, <a href="https://x.com/hausfath/status/1709217151452954998?s=20">he called the feat “absolutely gobsmackingly bananas.”</a></p>

<p>The milestone reached last month comes on the heels <a href="https://www.scientificamerican.com/article/july-2023-is-hottest-month-ever-recorded-on-earth/">of July setting the record for the hottest month overall</a>. (July is always the hottest month of the year globally because it occurs at the peak of the Northern Hemisphere summer. The Northern Hemisphere has much more landmass to soak up the sun’s rays than the Southern Hemisphere, so it has the bigger influence on the global annual temperature cycle.)</p>

<p>In a marker of just how much global temperatures have risen in recent decades, Hausfather observes, “this September will be hotter than most Julys before the last decade or two.”</p>

<figure data-responsive-image="responsive-image">
<div><picture><source media="(min-width: 768px) and (max-width: 1023px)" srcset="https://static.scientificamerican.com/sciam/assets/Image/2023/thompson%201_d.png"><source media="(max-width: 767px)" srcset="https://static.scientificamerican.com/sciam/assets/Image/2023/thompson%201_m.png"><img alt="Heat map shows the daily temperature anomaly in 2023 through September. The anomaly is greatest in September, compared with the 1991–2020 baseline. " src="https://static.scientificamerican.com/sciam/assets/Image/2023/thompson%201_d.png"></picture></div>

<figcaption>Credit: Zeke Hausfather, restyled by John Knight; Source: <a href="https://climatlas.com/temperature/jra55_temperature.php">Japanese 55-Year Reanalysis data on global mean temperature, processed by Ryan Maue</a></figcaption>
</figure>

<p>Two main factors are at play in driving temperatures to such extremes: their inexorable increase from burning fossil fuels and an El Niño event that is shaping up to be a strong one. <a href="https://www.scientificamerican.com/article/el-nino-may-break-a-record-and-reshape-weather-around-the-globe/">El Niño is a part of a natural climate cycle</a> that features a tongue of unusually warm waters across the eastern Pacific Ocean. Those waters release heat into the atmosphere and can cause a cascade of changes to key atmospheric circulation patterns linked to the weather around the world.</p>

<p>Heat waves have broken records all over the globe during the past few months, including prolonged events called heat domes that plagued the southern stretch of the U.S. and parts of the Mediterranean. Summerlike temperatures were even felt in South America during the Southern Hemisphere’s winter. Two of the heat waves—one in the U.S. Southwest and one in Europe—were found to be <a href="https://www.scientificamerican.com/article/this-summers-record-breaking-heat-waves-would-not-have-happened-without-climate-change/">virtually impossible without global warming</a>. And summerlike heat has continued in places into October.</p>

<p>The most drastic temperature anomalies typically come in the winter months, when El Niño peaks in strength. In fact, the previous most anomalously warm month was February 2016, during one of the strongest El Niños on record. But this year “we’re seeing these [big anomalies] in the Northern Hemisphere summer,” Hausfather says. That leaves open the possibility of even larger anomalies when this event peaks this winter, particularly if it ends up being another strong event.</p>

<p>It is possible there is also some influence from the phasing out of sulfur-containing fuels used by ships because the aerosols spewed into the air from burning those fuels tend to have a slight cooling effect. The eruption of the Hunga Tonga–Hunga Haʻapai volcano in the southern Pacific Ocean last year may also be nudging up temperatures because of the huge amounts of water vapor—also a greenhouse gas—it injected into the atmosphere. But both factors have very small influences, compared with climate change and El Niño.</p>

<p>Given that this El Niño is expected to persist and likely to strengthen, there’s a good chance that 2023 or 2024—or both—will become the hottest year on record, besting 2016 (and 2020, which some agencies who monitor climate have tied with 2016). That isn’t surprising, given that there has been a tenth of a degree of warming since 2016, though it is “remarkable just how quickly we’ve seen warmth this year,” Hausfather says. Part of the apparent rapid warming is because 2023 began in the tail end of an unusual string of three back-to-back La Niña events. These tend to have a cooling impact on the global climate, though La Niñas today are hotter than even El Niños of several decades ago.</p>

<p>Beyond potentially becoming the hottest year on record, 2023 could also be the first year to top 1.5 degrees C above preindustrial temperatures (some individual months have already passed that threshold). But even if that happens, all hope is not lost for meeting the Paris accord goals. That threshold is measured as an average of several decades, and climate scientists have long expected that a single year would pass that mark a decade or so before the world could be considered permanently above that limit. “There is still time to limit global warming to 1.5 degrees,” Marvel says. “It is going to be incredibly difficult. The pathways are narrowing.”</p>

<p>But this year should be considered a warning of the future we face if we don’t take rapid, ambitious action. “This is what the world looks like when it’s 1.5 degrees hotter in a year, and it’s terrible,” she says. When the world does permanently pass 1.5 degrees C, the climate anomalies for individual years will reach higher than that mark.</p>

<p>To stave off that future, every bit of carbon we can keep, or take, out of the atmosphere is crucial. “Every tenth of a degree matters,” Hausfather says.</p></div><section><h3>ABOUT THE AUTHOR(S)</h3><section><p><img src="https://static.scientificamerican.com/sciam/cache/file/1CA8FD9A-9A98-483D-AE3E18788CF77E53_small.png?h=65&amp;w=65" alt="author-avatar" width="65" height="65"></p><div><ul></ul><p><strong>Andrea Thompson</strong>, an associate editor at <em>Scientific American</em>, covers sustainability.&nbsp;<a href="https://twitter.com/@AndreaTWeather">Follow Andrea Thompson on Twitter</a><span>&nbsp;Credit: Nick Higgins</span></p></div></section></section></section></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Google Docs adds tracking to links in document exports (331 pts)]]></title>
            <link>https://fosstodon.org/@Joe_0237/111145684757912952</link>
            <guid>37776492</guid>
            <pubDate>Thu, 05 Oct 2023 09:21:19 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://fosstodon.org/@Joe_0237/111145684757912952">https://fosstodon.org/@Joe_0237/111145684757912952</a>, See on <a href="https://news.ycombinator.com/item?id=37776492">Hacker News</a></p>
&lt;Unparsable&gt;]]></description>
        </item>
    </channel>
</rss>