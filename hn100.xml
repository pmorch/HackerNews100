<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
    <channel>
        <title>HN100 - Readable Contents</title>
        <link>https://hn.algolia.com/api/v1/search_by_date?tags=%28story,poll%29&amp;numericFilters=points%3E100</link>
        <description>Uses Readability to add bodies to the RSS feed</description>
        <lastBuildDate>Thu, 11 Sep 2025 01:30:06 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[KDE launches its own distribution (181 pts)]]></title>
            <link>https://lwn.net/SubscriberLink/1037166/caa6979c16a99c9e/</link>
            <guid>45204393</guid>
            <pubDate>Wed, 10 Sep 2025 21:49:36 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://lwn.net/SubscriberLink/1037166/caa6979c16a99c9e/">https://lwn.net/SubscriberLink/1037166/caa6979c16a99c9e/</a>, See on <a href="https://news.ycombinator.com/item?id=45204393">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
<blockquote>
<div>
<h3>Welcome to LWN.net</h3>
<p>
The following subscription-only content has been made available to you 
by an LWN subscriber.  Thousands of subscribers depend on LWN for the 
best news from the Linux and free software communities.  If you enjoy this 
article, please consider <a href="https://lwn.net/subscribe/">subscribing to LWN</a>.  Thank you
for visiting LWN.net!
</p></div>
</blockquote>

<p>At <a href="https://akademy.kde.org/2025/">Akademy 2025</a>, the
KDE Project <a href="https://floss.social/@kde/115157115844689060">released</a> an
alpha version of <a href="https://kde.org/linux/">KDE Linux</a>, a
distribution built by the project to "<q>include the best
implementation of everything KDE has to offer, using the most advanced
technologies</q>". It is aimed at providing an operating system
suitable for home use, business use, OEM installations, and more
"<q>eventually</q>". For now there are many rough edges and missing
features that users should be aware of before taking the plunge; but
it is an interesting look at the kind of complete Linux system that
KDE developers would like to see.</p>

<h4>Development and goals</h4>

<p>KDE contributor Nate Graham wrote an <a href="https://pointieststick.com/2025/09/06/announcing-the-alpha-release-of-kde-linux/">announcement
blog post</a> on September&nbsp;6 to accompany the release of KDE
Linux. Harald Sitter had introduced the project as "Project Banana"
during a talk (<a href="https://www.youtube.com/live/gTxRaBEUe-I?t=25936s">video</a>, <a href="https://conf.kde.org/event/6/contributions/202/attachments/135/171/The%20Operating%20System.pdf">slides</a>)
at <a href="https://akademy.kde.org/2024/">Akademy in 2024</a>, and has
been leading its development along with major contributions from Hadi Chokr, Lasath Fernando,
Justin Zobel, Graham, and <a href="https://invent.kde.org/kde-linux/kde-linux/-/graphs/master?ref_type=heads">others</a>.</p>

<p>KDE Linux is an immutable distribution that uses Arch Linux
packages as its base, but Graham notes that it is "<q>definitely not
an 'Arch-based distro!'</q>" Pacman is not included, and Arch is used
only for the base operating system. Everything else, he said, is
either compiled from source using <a href="https://kde-builder.kde.org/en/introduction/brief-intro.html#what-is-kde-builder">KDE Builder</a> or installed
using Flatpak.</p>

<p>Some may wonder why another Linux distribution is needed; Graham
said that he has expressed that sentiment himself in the past
regarding other distributions, but he thinks that KDE Linux is justified:</p>

<blockquote>
<p>KDE is a huge producer of software. It's awkward for us to not have
our own method of distributing it. Yes, KDE produces source code that
others distribute, but we self-distribute our apps on app stores like
Flathub and the Snap and Microsoft stores, so I think it's a natural
thing for us to have our own platform for doing that distribution too,
and that's an operating system. I think all the major producers of
free software desktop environments should have their own OS, and many
already do: <a href="https://www.linuxmint.com/">Linux Mint</a> and <a href="https://elementary.io/">ElementaryOS</a> spring to mind, and <a href="https://os.gnome.org/">GNOME is working on one too</a>.</p>

<p>Besides, this matter was settled 10 years ago with the creation of
KDE neon, our first bite at the "in-house OS" apple. The sky did not
fall; everything was beautiful and nothing hurt.</p>
</blockquote>

<p>Speaking of <a href="https://neon.kde.org/">neon</a>, Graham points
out that it is "<q>being held together by a heroic volunteer</q>"
(singular) and that no decision has been made as of yet about its
future. Neon has "<q>served admirably for a decade</q>", he said, but
it "<q>has somewhat reached its limit in terms of what we can do with
it</q>" because of its Ubuntu base. According to the <a href="https://community.kde.org/KDE_Linux#Differences_from_KDE_neon/Prior_art">wiki
page</a>, neon's Ubuntu LTS base is built on old technology and
requires "<q>a lot of packaging busywork</q>". It also becomes less
stable as time goes on, "<q>because it needs to be tinkered with to
get Plasma to build on it, breaking the LTS promise</q>".</p>

<h4>Architecture and plans</h4>

<p>KDE Linux, on the other hand, is designed to be a greenfield
project that allows KDE to make use of newer technologies and more
modern approaches to a Linux distribution unhampered by the needs of a
general-purpose distribution. If KDE Linux's technology choices are
not appealing, Graham says, "<q>feel free to ignore KDE Linux and
continue using the operating system of your choice. There are plenty
of them!</q>"</p>

<p>KDE Linux is Wayland-only; there is no X.org session and no plan
to add one. Users with some of the older NVIDIA cards will need to
<a href="https://invent.kde.org/kde-linux/kde-linux/-/issues/269">manually
configure the system</a> to work properly with KDE Linux. The
distribution also only supports UEFI systems, and there are no plans
to add support for BIOS-only systems.</p>

<p>The root filesystem (<tt>/</tt>) is a read/write Btrfs
volume, while <tt>/usr</tt> is a read-only <a href="https://docs.kernel.org/filesystems/erofs.html">Enhanced
Read-Only File System</a> (EROFS) volume backed by a single file. The
system is updated atomically by swapping out the EROFS volume;
currently KDE Linux caches up to five of the files to allow users to
roll back to previous versions if the most recent updates are
broken.</p>

<p>The files have names like <tt>kde-linux_202509082242.erofs</tt> and
are stored in <tt>/system</tt>. The most recent releases are about
4.8GB in size. The project uses <a href="https://www.freedesktop.org/software/systemd/man/latest/systemd-sysupdate.html"><tt>systemd-sysupdate</tt></a>
under the hood, which <a href="https://github.com/systemd/systemd/issues/28227">does not have
support for delta updates</a> yet. Users should expect to set aside at least 30GB
just to cache the EROFS files for now.</p>

<p>Unlike Fedora's image-based <a href="https://fedoraproject.org/atomic-desktops/">Atomic Desktops</a>,
KDE Linux does not supply a way for users to add packages to the base
system. So, for example, users have no way to add packages with
additional kernel modules. Users <em>can</em> add applications packaged as 
Flatpaks using KDE's Discover graphical software manager; the 
Snap format is also supported, but it is not integrated with
Discover—the <tt>snap</tt> command-line
utility can be used to do install Snaps for now. KDE Linux also includes <a href="https://distrobox.it/">Distrobox</a>, which allows users to set
up a container with the distribution of their choice and install
software in the container that is integrated with the system. LWN <a href="https://lwn.net/Articles/954059/">touched on</a> Distrobox in
our coverage of the Bluefin image-based operating system in December
2023.</p>

<p>Unfortunately, it <a href="https://invent.kde.org/kde-linux/kde-linux/-/issues/283">looks
like users are not set up correctly</a> for Podman, which Distrobox
needs, on KDE Linux; trying to set up a new container gives a
"potentially insufficient UIDs or GIDs available in user namespace"
error when trying to test Distrobox on the latest KDE Linux build. <a href="https://github.com/containers/podman/issues/12715#issuecomment-1003135032">This
comment</a> in the Podman repository on GitHub set me on the right
path to fix the problem. This kind of bug is to be expected in an
alpha release; no doubt it will be ironed out in the coming weeks or
months.</p>

<p>System updates are also performed using Discover: when a new system
image is available, it will show up in the Updates tab and can be
installed from there. (Or using "<tt>sudo updatectl update</tt>" from
the command line, for those who prefer doing it that way.) Likewise,
installed Flatpaks with updates will show up in the Updates tab. For
now, at least, users will have to manually manage any applications
installed in a Distrobox container.</p>

<p>The default software selection is a good start for a desktop
distribution; it includes the Gwenview image viewer, Okular document
viewer, Haruna media player, Kate text editor, and Konsole for
terminal emulation. Firefox is the only prominent non-KDE application
included with the default install. The base system currently includes
GNU Bash 5.3.3, curl 8.15, Linux 6.16.5, GCC 15.2.1, Perl 5.42, Python 3.13.7, Vim
9.1, and wget 1.25. It does not include some utilities users might
want or expect, such as GNU Screen, Emacs, tmux, pip, or alternate shells like Fish.</p>

<blockquote>
<a href="https://lwn.net/Articles/1037367/">
<img src="https://static.lwn.net/images/2025/kde-linux-alpha-sm.png" alt="[KDE Linux desktop]" title="KDE Linux desktop">
</a>
</blockquote>

<p>KDE Linux's base packages are not meant to be user-customizable,
but it should be possible to create custom images using systemd's <a href="https://mkosi.systemd.io/">mkosi</a> tool, which is what is used
by the project itself. The <a href="https://invent.kde.org/kde-linux/kde-linux/-/tree/master/mkosi.conf.d?ref_type=heads"><tt>mkosi.conf.d</tt></a>
directory in the KDE Linux repository contains the various
configuration files for managing the packages included in the system image.</p>

<!-- middle-ad -->

<h4>Development and what's next</h4>

<p>The plan, longer term, is to have three editions of KDE Linux: the
testing edition, which is what is available now, an enthusiast
edition, and a stable edition. The testing edition is meant for
developers and quality assurance folks; it is to be built daily from
Git and to be similar in quality to KDE neon's unstable release. The
enthusiast edition will include beta or released software, depending
on the status of a given application at the time; this edition is
aimed at "<q>KDE enthusiasts, power users, and influencers</q>". The
stable edition, as the name suggests, will include only released
software that meets quality metrics (which are not yet defined),
indicating it's ready for users not in the other categories.</p>

<p>KDE Linux can be <a href="https://kde.org/linux/install/">installed
on bare metal</a> or in a <a href="https://community.kde.org/KDE_Linux#Getting_it">virtual
machine</a> using <a href="https://en.wikipedia.org/wiki/Virt-manager">virt-manager</a>. Support
for UEFI Secure Boot is currently missing. Since KDE Linux uses a lot
of space for cached images, users should provision more disk space for
a virtual machine than they might ordinarily; I allocated 50GB, but
probably should have gone with 75GB or more.</p>

<p>Those wishing to follow along with KDE Linux development can check
out the milestone trackers for the <a href="https://invent.kde.org/groups/kde-linux/-/milestones/2#tab-issues">enthusiast</a>
and <a href="https://invent.kde.org/groups/kde-linux/-/milestones/1#tab-issues">stable</a>
editions. All of the <a href="https://invent.kde.org/groups/kde-linux/-/milestones/3#tab-issues">milestones</a>
have been reached for the testing edition. There are quite a few items
to complete before KDE Linux reaches beta status; for example, the
project is currently using packages from the Arch User Repository (AUR) but
the plan is to <a href="https://invent.kde.org/kde-linux/kde-linux/-/issues/225">move
away from using AUR</a> soon. The project also needs to <a href="https://invent.kde.org/kde-linux/kde-linux/-/work_items/241">move
production to official KDE infrastructure</a> rather than depending on
Sitter's personal systems.</p>

<p>At the moment, the project does not have a security announcement mailing
list or other notification mechanism; those using KDE Linux for more
than testing should keep an eye on <a href="https://security.archlinux.org/">Arch's security tracker</a> and
<a href="https://kde.org/info/security/">KDE security advisories</a>.
Since KDE Linux is an immutable derivative of Arch Linux, with no
way to immediately pull updated Arch packages, users should remember
that they will be at a disadvantage when there are security
vulnerabilities in the base operating system. Any security update would
need to be created by Arch Linux, pushed out as an Arch package, and
then incorporated into a build for KDE Linux. Conservatively, that
will add at least a day for any security updates to reach KDE Linux
users.</p>

<p>One of the downsides of having no package manager is that there is
no easy way to take stock of what is installed on the system. Normally,
one might do an inventory of software using a package manager's query
tools; a quick "<tt>rpm -qa</tt>" shows all of the system software on
my desktop's Fedora&nbsp;42 install. There is no such mechanism for
KDE Linux, and it's not clear that there are any plans for that type
of feature long term. To be suitable for some of the target audiences,
KDE Linux will need (for example) ways to manage the base operating
system and easily query what is installed.</p>

<p>The project's governance is <a href="https://community.kde.org/KDE_Linux#Governance_%26_policies">described
as</a> a "<q>'Council of elders' model with major contributors being
the elders</q>". Sitter has final decision-making authority in cases
of disagreement.</p>

<p>Obviously the team working on KDE Linux wants the project to
succeed, but it has put some thought into what will happen if the
distribution is put out to pasture at some point. There is an <a href="https://community.kde.org/KDE_Linux#Long-term_maintenance_and_EOL_plan">end-of-life
contingency plan</a> to "<q>push a final update shipping an OS image
that transforms the system into a completely different
distro</q>". The successor distribution has not been chosen yet; it 
would be picked based on the KDE Linux team's relationship with the other
distribution and its ability to take on all of the new users.</p>

<p>Part of the rationale for KDE Linux is to satisfy an impulse that
is common to many open-source developers: the desire to ship software
directly to users without an intermediary tampering with it.
The process of creating and refining KDE Linux will satisfy
that for KDE developers, but it may also serve another purpose: to
demonstrate just how difficult it is to create and maintain a
desktop distribution for widespread use. Whether KDE Linux succeeds as a
standalone distribution or not, it may be a useful exercise to
illustrate <em>why</em> projects like Debian, Fedora, openSUSE, Ubuntu,
and others make choices that ultimately frustrate application
developers.</p>

<br clear="all">
               <br clear="all">
               <hr>
            </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Minerals represent potential biosignatures in the search for life on Mars (101 pts)]]></title>
            <link>https://www.nature.com/articles/s41586-025-09413-0</link>
            <guid>45202613</guid>
            <pubDate>Wed, 10 Sep 2025 19:42:27 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.nature.com/articles/s41586-025-09413-0">https://www.nature.com/articles/s41586-025-09413-0</a>, See on <a href="https://news.ycombinator.com/item?id=45202613">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
                    
                        <div id="Sec1-section" data-title="Main"><h2 id="Sec1">Main</h2><div id="Sec1-content"><p>NASA’s Mars 2020 Perseverance rover mission is the first in a sequence of missions designed to return a scientifically selected suite of Martian rock, regolith and atmosphere samples to Earth for laboratory investigation. The goals of the mission are to explore the Jezero Crater landing site and its surroundings, constrain the geologic history and habitability of the site, seek signs of past life, and prepare a cache of samples for potential return to Earth<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 1" title="Farley, K. A. et al. Mars 2020 mission overview. Space Sci. Rev. 
                  https://doi.org/10.1007/s11214-020-00762-y
                  
                 (2020)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR1" id="ref-link-section-d33770877e2719">1</a></sup>. The Perseverance rover carries an instrument payload designed to fulfil these goals, with the capability to characterize rock targets, their submillimetre-scale textural attributes, and potential organic and inorganic biosignatures, placing these features into an outcrop-scale context<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 1" title="Farley, K. A. et al. Mars 2020 mission overview. Space Sci. Rev. 
                  https://doi.org/10.1007/s11214-020-00762-y
                  
                 (2020)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR1" id="ref-link-section-d33770877e2723">1</a></sup>.</p><p>Perseverance has explored three geologic terrains in Jezero Crater (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">1</a>): (1) the crater floor, which includes lava flows and igneous cumulates that have experienced aqueous alteration under a variety of conditions<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 2" title="Farley, K. A. et al. Aqueously altered igneous rocks sampled on the floor of Jezero Crater, Mars. Science 377, eabo2196 (2022)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR2" id="ref-link-section-d33770877e2733">2</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 3" title="Simon, J. I. et al. Samples collected from the floor of Jezero Crater with the Mars 2020 Perseverance rover. J. Geophys. Res. Planets 
                  https://doi.org/10.1029/2022JE007474
                  
                 (2023)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR3" id="ref-link-section-d33770877e2736">3</a></sup>; (2) the Western Fan, a sequence of sedimentary rocks derived from mafic to ultramafic sources and deposited in a fluvial-deltaic-lacustrine setting<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" title="Mangold, N. et al. Perseverance rover reveals an ancient delta-lake system and flood deposits at Jezero Crater, Mars. Science 374, 711–717 (2021)." href="#ref-CR4" id="ref-link-section-d33770877e2740">4</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" title="Stack, K. M. et al. Sedimentology and stratigraphy of the Shenandoah Formation, Western Fan, Jezero Crater, Mars. J. Geophys. Res. Planets 
                  https://doi.org/10.1029/2023JE008187
                  
                 (2024)." href="#ref-CR5" id="ref-link-section-d33770877e2740_1">5</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 6" title="Bosak, T. et al. Astrobiological potential of rocks acquired by the Perseverance rover at a sedimentary fan front in Jezero Crater, Mars. AGU Adv. 
                  https://doi.org/10.1029/2024AV001241
                  
                 (2024)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR6" id="ref-link-section-d33770877e2743">6</a></sup>; (3) the Margin Unit, a layered-to-massive sequence of rocks with strong orbital spectroscopic signatures of olivine and carbonate that is exposed between the crater rim and the Western Fan<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 7" title="Horgan, B. H. N., Anderson, R. B., Dromart, G., Amador, E. S. &amp; Rice, M. S. The mineral diversity of Jezero Crater: evidence for possible lacustrine carbonates on Mars. Icarus 
                  https://doi.org/10.1016/j.icarus.2019.113526
                  
                 (2020)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR7" id="ref-link-section-d33770877e2747">7</a></sup>. This study focuses on a suite of rocks exposed in Neretva Vallis, a valley incised through the Jezero Crater rim and Margin Unit, which was the feeder channel for the Western Fan<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 8" title="Goudge, T. A., Mustard, J. F., Head, J. W., Fassett, C. I. &amp; Wiseman, S. M. Assessing the mineralogy of the watershed and fan deposits of the Jezero Crater paleolake system, Mars. J. Geophys. Res. Planets 120, 775–808 (2015)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR8" id="ref-link-section-d33770877e2751">8</a></sup> (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">1</a>). Perseverance initially explored a distinct, bright-toned outcrop exposed on the northern margin of Neretva Vallis. This outcrop area is informally named ‘Bright Angel’ (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig1">1a</a>). In High Resolution Imaging Science Experiment (HiRISE) images of this deposit, albedo variations appeared to indicate layering at the metre scale. Subsequently, Perseverance explored strata exposed along the southern margin of Neretva Vallis, in an area informally named ‘Masonic Temple’ (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig1">1a</a>), where rocks with similar characteristics crop out. As described below, the outcrops in these areas share many characteristics and are referred to collectively as the Bright Angel formation. Subsurface structures detected by the Radar Imager for Mars’ subsurface experiment (RIMFAX) ground-penetrating radar (GPR;&nbsp;<a data-track="click" data-track-label="link" data-track-action="section anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Sec7">Methods</a> and Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">2</a>) can be interpreted to indicate that the Bright Angel formation lies stratigraphically above the Margin Unit, but at the present time, we cannot rule out the possibility that the Bright Angel formation represents a part of an older unit.</p><div data-test="figure" data-container-section="figure" id="figure-1" data-title="Perseverance’s path through Neretva Vallis and views of the Bright Angel formation."><figure><figcaption><b id="Fig1" data-test="figure-caption-text">Fig. 1: Perseverance’s path through Neretva Vallis and views of the Bright Angel formation.</b></figcaption><div><div><a data-test="img-link" data-track="click" data-track-label="image" data-track-action="view figure" href="https://www.nature.com/articles/s41586-025-09413-0/figures/1" rel="nofollow"><picture><source type="image/webp" srcset="https://media.springernature.com/lw685/springer-static/image/art%3A10.1038%2Fs41586-025-09413-0/MediaObjects/41586_2025_9413_Fig1_HTML.png?as=webp"><img aria-describedby="Fig1" src="https://media.springernature.com/lw685/springer-static/image/art%3A10.1038%2Fs41586-025-09413-0/MediaObjects/41586_2025_9413_Fig1_HTML.png" alt="figure 1" loading="lazy" width="685" height="510"></picture></a></div><p><b>a</b>, Orbital context image with the rover traverse overlain in white. White line and arrows show the direction of the rover traverse from the southern contact between the Margin Unit and Neretva Vallis to the Bright Angel outcrop area and then to the Masonic Temple outcrop area. Labelled orange triangles show the locations of proximity science targets discussed in the text. <b>b</b>, Mastcam-Z 360° image mosaic looking at the contact between the light-toned Bright Angel Formation (foreground) and the topographically higher-standing Margin Unit from within the Neretva Vallis channel. This mosaic was collected on sol 1178 from the location of the Walhalla Glades target before abrasion. Upslope, about 110 m distant, the approximate location of the Beaver Falls workspace (containing the targets Cheyava Falls, Apollo Temple and Steamboat Mountain and the Sapphire Canyon sample) is shown. Downslope, about 50 m distant, the approximate location of the target Grapevine Canyon is also shown. In the distance, at the southern side of Neretva Vallis, the Masonic Temple outcrop area is just visible. Mastcam-Z enhanced colour RGB cylindrical projection mosaic from sol 1178, sequence IDs zcam09219 and zcam09220, acquired at 63-mm focal length. A flyover of this area is available at <a href="https://www.youtube.com/watch?v=5FAYABW-c_Q">https://www.youtube.com/watch?v=5FAYABW-c_Q</a>. Scale bars (white), 100 m (<b>a</b>), 50 m (<b>b</b>, top) and 50 cm (<b>b</b>, bottom left). Credit: NASA/JPL-Caltech/ASU/MSSS.</p></div><p><a data-test="article-link" data-track="click" data-track-label="button" data-track-action="view figure" href="https://www.nature.com/articles/s41586-025-09413-0/figures/1" data-track-dest="link:Figure1 Full size image" aria-label="Full size image figure 1" rel="nofollow"><span>Full size image</span></a></p></figure></div></div></div><div id="Sec2-section" data-title="Outcrop-scale observations"><h2 id="Sec2">Outcrop-scale observations</h2><div id="Sec2-content"><p>The Bright Angel formation consists of approximately metre-scale blocks formed by fracturing and physical weathering of the exposed outcrop (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig1">1b</a>). In RIMFAX GPR profiles, radar-reflective layers express a range of apparent dip angles, from horizontal up to about 30° at the northern contact with the Margin Unit (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">2</a>). The Bright Angel formation appears to be subdivided into concave-upwards to flat-lying bodies of layered rock lying within the Neretva Vallis channel (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">2</a>). Assuming that the observed layer orientations formed during deposition of the Bright Angel formation, the topographically highest-standing outcrops near the contact with the Margin Unit are stratigraphically lower than outcrops farther from the contact.</p><p>A representative example of Bright Angel formation outcrop is visible in the ‘Beaver Falls’ workspace (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig2">2</a>). Here, the Planetary Instrument for X-ray Lithochemistry (PIXL), Scanning Habitable Environments with Raman and Luminescence for Organics and Chemicals (SHERLOC) and Wide Angle Topographic Sensor for Operations and Engineering (WATSON), SuperCam, and Mastcam-Z instruments (<a data-track="click" data-track-label="link" data-track-action="section anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Sec7">Methods</a>) analysed a rock containing the targets ‘Cheyava Falls’ and ‘Apollo Temple’ and a core sample, named ‘Sapphire Canyon’, was subsequently collected. In this rock, centimetre-scale, reddish-to-tan-coloured, recessive layers are separated by thinner, relatively resistant, light-toned layers (Figs. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig2">2</a> and <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig3">3a</a>). The layers in this rock dip more steeply and strike at an angle to layers in the nearby outcrop, implying that it may have been displaced from its original orientation. Topographically above but stratigraphically below this rock is a darker-toned rock with a coarsely granular texture, the site of the target ‘Steamboat Mountain’ (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig2">2</a>). This darker-toned rock was investigated as a possible transitional lithology between the Bright Angel formation and the Margin Unit.</p><div data-test="figure" data-container-section="figure" id="figure-2" data-title="The Beaver Falls workspace."><figure><figcaption><b id="Fig2" data-test="figure-caption-text">Fig. 2: The Beaver Falls workspace.</b></figcaption><div><div><a data-test="img-link" data-track="click" data-track-label="image" data-track-action="view figure" href="https://www.nature.com/articles/s41586-025-09413-0/figures/2" rel="nofollow"><picture><source type="image/webp" srcset="https://media.springernature.com/lw685/springer-static/image/art%3A10.1038%2Fs41586-025-09413-0/MediaObjects/41586_2025_9413_Fig2_HTML.png?as=webp"><img aria-describedby="Fig2" src="https://media.springernature.com/lw685/springer-static/image/art%3A10.1038%2Fs41586-025-09413-0/MediaObjects/41586_2025_9413_Fig2_HTML.png" alt="figure 2" loading="lazy" width="685" height="475"></picture></a></div><p>Mastcam-Z image mosaic of the Beaver Falls workspace on sol 1217. The light-toned layered block contains the Cheyava Falls natural surface target, the Apollo Temple abrasion and the Sapphire Canyon core sample location. The Sapphire Canyon sample was collected from approximately the same location as Cheyava Falls after analysis of the target was completed. The red box shows the location of the SuperCam target Kolb Arch (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">11</a>). The darker-toned granular block contains the Steamboat Mountain abrasion. Downhill is to the left on this image. Mastcam-Z enhanced colour RGB vertical projection mosaic from sol 1217, sequence zcam09264, acquired at 110-mm focal length. Scale bar, 10 cm. Credit: NASA/JPL-Caltech/ASU/MSSS.</p></div><p><a data-test="article-link" data-track="click" data-track-label="button" data-track-action="view figure" href="https://www.nature.com/articles/s41586-025-09413-0/figures/2" data-track-dest="link:Figure2 Full size image" aria-label="Full size image figure 2" rel="nofollow"><span>Full size image</span></a></p></figure></div><div data-test="figure" data-container-section="figure" id="figure-3" data-title="Layering, nodules, reaction fronts and organic detections."><figure><figcaption><b id="Fig3" data-test="figure-caption-text">Fig. 3: Layering, nodules, reaction fronts and organic detections.</b></figcaption><div><div><a data-test="img-link" data-track="click" data-track-label="image" data-track-action="view figure" href="https://www.nature.com/articles/s41586-025-09413-0/figures/3" rel="nofollow"><picture><source type="image/webp" srcset="https://media.springernature.com/lw685/springer-static/image/art%3A10.1038%2Fs41586-025-09413-0/MediaObjects/41586_2025_9413_Fig3_HTML.png?as=webp"><img aria-describedby="Fig3" src="https://media.springernature.com/lw685/springer-static/image/art%3A10.1038%2Fs41586-025-09413-0/MediaObjects/41586_2025_9413_Fig3_HTML.png" alt="figure 3" loading="lazy" width="685" height="520"></picture></a></div><p><b>a</b>, WATSON nighttime image of Cheyava Falls with both white-light LED groups on acquired on sol 1188 at a stand-off distance of 3.91 cm. Image resolution: 21.0 ± 0.4 µm per pixel. <b>b</b>, Colourized SHERLOC ACI image acquired on sols 1201–1202 outlined with a white box and overlain on the WATSON image from <b>a</b>. The ACI image is a focus merge of 13 ACI images acquired between stand-off distances of 4.035 cm and 4.335 cm and has an image resolution of about 10 µm per pixel. Three 1 × 1 mm SHERLOC spectral scans were acquired at the orange square location at stand-off distances of 4.01 cm, 4.035 cm and 4.06 cm. One 1 × 1 mm spectral scan was acquired at the blue square location at a stand-off distance of 4.035 cm. The black dotted rectangle shows the footprint of the PIXL scan acquired from this target. The magenta cross at the corner of the scan provides a reference point for comparison with <b>c</b>, which is the colourized SHERLOC ACI image from <b>b</b>. The image shows the authigenic nodule and reaction front features as well as the SHERLOC and PIXL scan locations. <b>d</b>, SHERLOC Raman spectra from representative targets in the Bright Angel unit with fits to an instrument –O-stretching overtone feature from the SHERLOC fused-silica optics (light grey, labelled ‘Bknd’) and the G-band signal at about 1,600 cm<sup>−1</sup> associated with organic carbon in the targets Walhalla Glades (blue), Cheyava Falls (red) and Apollo Temple (green fit on grey spectrum). Malgosa Crest (yellow) shows no G-band signal above the instrument background. Scale bars, 5 mm. Credit: NASA/JPL-Caltech/MSSS.</p></div><p><a data-test="article-link" data-track="click" data-track-label="button" data-track-action="view figure" href="https://www.nature.com/articles/s41586-025-09413-0/figures/3" data-track-dest="link:Figure3 Full size image" aria-label="Full size image figure 3" rel="nofollow"><span>Full size image</span></a></p></figure></div><p>In general, macroscopic rock textures in the Bright Angel outcrop area are diverse and complex. Intervals of rock are wind-fluted and massive in appearance (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">3a</a>), show large (centimetre scale) nodular features (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">3b</a>), and are layered and cross-cut by light-toned erosionally resistant and mineralized fractures and veins (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig2">2</a> and Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">3a,b</a>). Primary textures include layered and structureless intervals with limited evidence for transport and deposition by currents, such as cross bedding or plane bed laminations. Across Neretva Vallis, in the Masonic Temple area (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig1">1a</a>), outcrops express wind-fluted, massive, layered and granular surface textures such as those seen in the Bright Angel area (Supplementary Figs. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">4–6</a>). However, the Masonic Temple area also includes poorly sorted conglomerates composed of rounded to subangular millimetre- to centimetre-scale clasts embedded in a fine-grained matrix, as seen in the targets ‘Bass Camp‘ (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">7</a>) and ‘Wallace Butte’ (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">8a,b</a>).</p></div></div><div id="Sec3-section" data-title="Petrographic relationships"><h2 id="Sec3">Petrographic relationships</h2><div id="Sec3-content"><p>Despite the textural diversity of rocks in the Bright Angel formation, they all contain a fine-grained component, or facies, that comprises much of the rock volume. Individual grains in this facies are not visible in WATSON images (17.9–36.3 μm per pixel) or in SHERLOC Autofocus and Context Imager (ACI) images (10.1 μm per pixel) of the Cheyava Falls target (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig3">3b,c</a>), indicating grains approximately ≤30–110 μm in diameter, that is, finer than coarse silt or very fine sand. The image resolution is insufficient to determine the relative proportions of clay and silt; accordingly, we classify this facies as mudstone. The Masonic Temple conglomerates contain a matrix made of the same mudstone, as well as abundant millimetre- to centimetre-scale clasts, also composed of mudstone (Supplementary Figs. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">7</a> and <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">8a,b</a>). These clasts formed by mud deposition, partial consolidation, and later erosion and transport as intraclasts.</p><p>The mud facies is red, tan or whitish-grey coloured in different rocks. These colour differences are apparent in visible-light reflectance spectra collected by Mastcam-Z (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">9a,b</a> and Supplementary Table <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">1</a>) and SuperCam (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">10</a> and Supplementary Table <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">1</a>). Masonic Temple targets are characterized by long-wavelength spectral features that indicate high abundances of ferric iron. This Fe<sup>3+</sup> imparts strong red colouration. Targets in Bright Angel show spectral features that indicate less Fe<sup>3+</sup>, resulting in tan to whitish-grey colouration. Near-infrared (NIR) absorption spectra collected by SuperCam (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">11a–c</a>) are characterized by shallow, approximately 1.92-μm band depths, indicating that Bright Angel formation rocks are weakly hydrated, especially when compared with sedimentary rocks from the Western Fan (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">11d</a> and Supplementary Table <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">1</a>). Other NIR spectral features are also relatively weak and cannot be uniquely attributed to specific minerals; however, candidate phases include phyllosilicate clays and opaline silica, consistent with expectations for a mudstone. Calcium sulfate with spectral features consistent with bassanite, CaSO<sub>4</sub>·0.5H<sub>2</sub>O, is also identified in NIR spectra (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">11e,f</a>).</p><p>Organic matter was detected in the Bright Angel area mudstone targets Cheyava Falls, Walhalla Glades and Apollo Temple by the SHERLOC instrument based on the presence of an approximately 1,600-cm<sup>−1</sup> G band in the Raman spectra<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" title="Steele, A. et al. Comprehensive imaging and Raman spectroscopy of carbonate globules from Martian meteorite ALH 84001 and a terrestrial analogue from Svalbard. Meteorit. Planet. Sci. 42, 1549–1566 (2007)." href="#ref-CR9" id="ref-link-section-d33770877e2998">9</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" title="Steele, A. et al. Macromolecular carbon in Martian basalts. Meteorit. Planet. Sci. 47, A357–A357 (2012)." href="#ref-CR10" id="ref-link-section-d33770877e2998_1">10</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" title="Bhartia, R. et al. Perseverance’s Scanning Habitable Environments with Raman and Luminescence for Organics and Chemicals (SHERLOC) investigation. Space Sci. Rev. 217, 58 (2021)." href="#ref-CR11" id="ref-link-section-d33770877e2998_2">11</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 12" title="Scheller, E. L. et al. Inorganic interpretation of luminescent materials encountered by the Perseverance rover on Mars. Sci. Adv. 10, eadm8241 (2024)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR12" id="ref-link-section-d33770877e3001">12</a></sup> (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig3">3d</a> and <a data-track="click" data-track-label="link" data-track-action="section anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Sec7">Methods</a>). The G band is most intense in Apollo Temple and less intense in Walhalla Glades and Cheyava Falls (<a data-track="click" data-track-label="link" data-track-action="section anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Sec7">Methods</a>). In contrast, no G band was detected at Masonic Temple in the abrasion target ‘Malgosa Crest’. SuperCam Raman spectra collected from Apollo Temple show a strong continuum fluorescence signature (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">12</a>) consistent with, but not uniquely attributable to, organic matter; this signature is weak to absent in Malgosa Crest.</p><p>PIXL micro-X-ray fluorescence (XRF) elemental analyses indicate that Bright Angel formation mudstone is rich in SiO<sub>2</sub>, Al<sub>2</sub>O<sub>3</sub> and FeO, and poor in MgO and MnO (<a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">Supplementary Information</a>). On ternary diagrams used to infer mineralogy (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig4">4a,b</a>), the mudstone plots in locations consistent with abundant silica and aluminosilicate clays. PIXL analysis of the X-ray diffraction properties of the mudstone in abraded patches (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">13a–d</a>) shows that it contains only randomly distributed, low-intensity diffraction peaks with no large domains that exhibit coherent monocrystalline diffraction<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" title="Jones, M. W. M. et al. In situ crystallographic mapping constrains sulfate precipitation and timing in Jezero Crater, Mars. Sci. Adv. 11, eadt3048 (2025)." href="#ref-CR13" id="ref-link-section-d33770877e3037">13</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" title="Orenstein, B. J. et al. In-situ mapping of monocrystalline regions on Mars. Icarus 420, 116202 (2024)." href="#ref-CR14" id="ref-link-section-d33770877e3037_1">14</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 15" title="Tice, M. M. et al. Alteration history of Seitah Formation rocks inferred by PIXL X-ray fluorescence, X-ray diffraction, and multispectral imaging on Mars. Sci. Adv. 8, eabp9084 (2022)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR15" id="ref-link-section-d33770877e3040">15</a></sup>. These properties indicate crystalline domain sizes at or near the PIXL diffraction detection limit of 40–60 μm (ref. <sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 15" title="Tice, M. M. et al. Alteration history of Seitah Formation rocks inferred by PIXL X-ray fluorescence, X-ray diffraction, and multispectral imaging on Mars. Sci. Adv. 8, eabp9084 (2022)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR15" id="ref-link-section-d33770877e3044">15</a></sup>), in accord with image-based grain size estimates. There is no variation in the crystallinity or textural properties of the mudstone with stratigraphic position or elevation (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">13a–d</a>), and thus no evidence for contact metamorphic recrystallization in proximity to adjacent geologic units. Analysis of diffraction peaks detected in calcium-sulfate veins and nodules in three abrasion targets indicates that Ca-sulfate is predominantly non-diffracting as well (Supplementary Figs. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">14a–j</a> and <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">15a–c</a>). Where diffraction was detected and peaks could be indexed<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 13" title="Jones, M. W. M. et al. In situ crystallographic mapping constrains sulfate precipitation and timing in Jezero Crater, Mars. Sci. Adv. 11, eadt3048 (2025)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR13" id="ref-link-section-d33770877e3058">13</a></sup> (<a data-track="click" data-track-label="link" data-track-action="section anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Sec7">Methods</a> and Supplementary Table <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">2</a>), gypsum and anhydrite were identified in isolated small domains. A possible explanation for the high proportion of non-diffracting Ca-sulfate is that it represents fine-grained bassanite, consistent with SuperCam spectra (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">11e,f</a>). On Mars, bassanite is known to form by dehydration of gypsum<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 16" title="Vaniman, D. T. et al. Gypsum, bassanite, and anhydrite at Gale Crater, Mars. Am. Mineral. 103, 1011–1020 (2018)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR16" id="ref-link-section-d33770877e3071">16</a></sup>, with gypsum precipitation implying low temperature and salinity for Ca-sulfate-precipitating fluids<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 17" title="Hardie, L. A. Gypsum-anhydrite equilibrium at one atmosphere pressure. Am. Mineral. 52, 171–17 (1967)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR17" id="ref-link-section-d33770877e3075">17</a></sup>.</p><div data-test="figure" data-container-section="figure" id="figure-4" data-title="Elemental relationships in Bright Angel and Masonic Temple from PIXL."><figure><figcaption><b id="Fig4" data-test="figure-caption-text">Fig. 4: Elemental relationships in Bright Angel and Masonic Temple from PIXL.</b></figcaption><div><div><a data-test="img-link" data-track="click" data-track-label="image" data-track-action="view figure" href="https://www.nature.com/articles/s41586-025-09413-0/figures/4" rel="nofollow"><picture><source type="image/webp" srcset="https://media.springernature.com/lw685/springer-static/image/art%3A10.1038%2Fs41586-025-09413-0/MediaObjects/41586_2025_9413_Fig4_HTML.png?as=webp"><img aria-describedby="Fig4" src="https://media.springernature.com/lw685/springer-static/image/art%3A10.1038%2Fs41586-025-09413-0/MediaObjects/41586_2025_9413_Fig4_HTML.png" alt="figure 4" loading="lazy" width="685" height="576"></picture></a></div><p>Ternary diagrams plotting molar proportions of the indicated oxides and elements. FeO<sub>T</sub> is total iron reported as FeO.&nbsp;Green points are all XRF analyses from the Bright Angel area and black points are from the Masonic Temple area. <b>a</b>,<b>b</b>, Complementary diagrams that plot SiO<sub>2</sub> (<b>a</b>) and Al<sub>2</sub>O<sub>3</sub> (<b>b</b>) at their apices.&nbsp;Expected trajectories for oxidative chemical weathering of igneous rocks shown as black arrows; most data points cluster in locations on the diagrams expected for sediments rich in SiO<sub>2</sub>, Al<sub>2</sub>O<sub>3</sub> and FeO<sub>T</sub>, formed by weathering of their sources. In <b>a</b>, the cluster of green points near olivine (Ol) represents olivine grains in Steamboat Mountain and Cheyava Falls. Additional linear trends shown with dashed arrowheaded lines indicate mixing with Ca-sulfate (CaSO<sub>4</sub>) and Fe-rich phases that include Fe-phosphates, Fe-oxides, Fe-sulfides, (Mg, Fe)SO<sub>4</sub> and (Mg, Fe)CO<sub>3</sub>. Kln, kaolinite; Opx, orthopyroxene; Cpx, clinopyroxene; An, anorthite; Ab, albite; Fld, all feldspars. <b>c</b>, Compositional arrays in Bright Angel indicate that an iron-phosphate with a molar 3FeO:2P ratio (stoichiometrically like vivianite, Fe<sub>3</sub>(PO<sub>4</sub>)<sub>2</sub>∙8H<sub>2</sub>O and its oxidation products) is the primary P-bearing phase. The location of 1FeO:1P ferric phosphate (typically strengite, FePO<sub>4</sub>·2H<sub>2</sub>O) is also shown. Ap, apatite; Mer, merrillite. <b>d</b>, Compositional arrays in Bright Angel and Masonic Temple indicate the presence of CaSO<sub>4</sub>. In Bright Angel, an endmember with a molar 3Fe:4S ratio (stoichiometrically like greigite, Fe<sub>3</sub>S<sub>4</sub>) is also present. Pyrite (FeS<sub>2</sub>), troilite (FeS) and jarosite (Jar; KFe<sup>3+</sup><sub>3</sub>(SO<sub>4</sub>)<sub>2</sub>(OH)<sub>6</sub>) are also plotted. The location of the Fe-sulfide minerals on <b>d</b> is based on calculations described in <a data-track="click" data-track-label="link" data-track-action="section anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Sec7">Methods</a>.</p></div><p><a data-test="article-link" data-track="click" data-track-label="button" data-track-action="view figure" href="https://www.nature.com/articles/s41586-025-09413-0/figures/4" data-track-dest="link:Figure4 Full size image" aria-label="Full size image figure 4" rel="nofollow"><span>Full size image</span></a></p></figure></div><p>Finally, olivine sand grains and particulate and intragranular Fe–Mg carbonate were observed in Cheyava Falls and Steamboat Mountain. In Cheyava Falls, PIXL analysed an approximately 0.5–1-mm-diameter olivine grain in an approximately centimetre-thick, light-toned Ca-sulfate layer (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig3">3a,b</a>). In Steamboat Mountain, coarse to very coarse sand-sized grains (0.5–2 mm) of olivine and Fe–Mg carbonate are locally surrounded by Ca-sulfate and set within mudstone (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">13a–h</a>). Mixing relationships between mudstone, olivine, carbonate and Ca-sulfate are illustrated on Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig4">4a,b</a>. Where coarse-crystalline olivine grains and mudstone are in contact with each other (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">13b,f</a>), there is no indication that the mudstone has been recrystallized by interaction with this igneous mineral, indicating that olivine is a detrital phase. In Steamboat Mountain, SHERLOC targeted an area containing olivine, carbonate and Ca-sulfate, rather than mudstone. No organic matter was detected, indicating that these phases are not important carriers of organic matter. SuperCam Raman spectra from the Steamboat Mountain mudstone, however, do show the same continuum fluorescence seen in the organic-matter-bearing Apollo Temple target (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">12</a>).</p></div></div><div id="Sec4-section" data-title="Provenance and depositional environments"><h2 id="Sec4">Provenance and depositional environments</h2><p>Observations of the Bright Angel outcrop area are consistent with their interpretation as mudstones deposited from suspension as layered and massive beds. Major element systematics and spectroscopic properties indicate that the mudstone provenance was chemically weathered and oxidized, resulting in Si, Al and Fe<sup>3+</sup> enrichment and Mg and Mn depletion<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 18" title="Babechuk, M. G., Widdowson, M. &amp; Kamber, B. S. Quantifying chemical weathering intensity and trace element release from two contrasting basalt profiles, Deccan Traps, India. Chem. Geol. 363, 56–75 (2014)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR18" id="ref-link-section-d33770877e3212">18</a></sup>. These characteristics are unlike those observed in Western Fan sedimentary rocks, which show little to no fractionation of Fe from Mg or Mn (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">16</a>), indicating that they were formed under anoxic conditions<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 18" title="Babechuk, M. G., Widdowson, M. &amp; Kamber, B. S. Quantifying chemical weathering intensity and trace element release from two contrasting basalt profiles, Deccan Traps, India. Chem. Geol. 363, 56–75 (2014)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR18" id="ref-link-section-d33770877e3219">18</a></sup>. At the contact with the Margin Unit (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig2">2</a>), we observe interstratified bedsets containing both fine-grained mudstone and coarse-grained olivine-bearing layers (for example, Cheyava Falls). We also observe poorly sorted, mud-rich olivine- and carbonate-bearing lithologies (for example, Steamboat Mountain). These coarser-grained lithologies appear to have provided a higher permeability medium through which later Ca-sulfate-precipitating fluids could migrate. Given the olivine- and carbonate-rich nature of the Margin Unit<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 7" title="Horgan, B. H. N., Anderson, R. B., Dromart, G., Amador, E. S. &amp; Rice, M. S. The mineral diversity of Jezero Crater: evidence for possible lacustrine carbonates on Mars. Icarus 
                  https://doi.org/10.1016/j.icarus.2019.113526
                  
                 (2020)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR7" id="ref-link-section-d33770877e3227">7</a></sup>, reworking of grains derived from the Margin Unit into the Bright Angel formation seems plausible. Across Neretva Vallis, at Masonic Temple, the poorly sorted, coarse conglomeratic nature of some outcrops (Supplementary Figs. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">7</a> and <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">8a,b</a>), and the fine-grained, mud-rich nature of others (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">6</a>), indicate significant local or temporal variation in current velocities. Accordingly, we interpret the Bright Angel formation to have formed from sedimentary processes that included weathering, erosion, transport and deposition from water by fallout from suspension and energetic currents or debris flows, forming mudstone and coarser-grained and conglomeratic lithologies, respectively.</p></div><div id="Sec5-section" data-title="Nodules and reaction fronts"><h2 id="Sec5">Nodules and reaction fronts</h2><div id="Sec5-content"><p>Dispersed throughout the fine-grained mudstone in the Bright Angel outcrop area, we observe approximately 100–200 μm circular to irregularly shaped masses (informally referred to as ‘poppy seeds’ by the Mars 2020 Science Team) that are black to dark blue to dark green coloured in daytime and nighttime white light-emitting diode (LED) illumination (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig3">3a–c</a> and Supplementary Figs. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">17a,b</a>–<a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">19a,b</a>). WATSON (Supplementary Figs. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">17c</a>–<a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">19c</a>) and PIXL Micro Context Camera (MCC; Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">20</a>) decorrelation stretch images enhance the blue to green colour of these features relative to the mudstone they occur in. PIXL XRF data indicate that the masses are enriched in Fe, P and Zn relative to their host mudstone (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig4">4c</a> and Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">21a–g</a>). On a ternary diagram of FeO–P–CaO (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig4">4c</a>), they extrapolate towards a molar FeO:P ratio of about 3:2 (see also Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">21f</a>). The X-ray diffraction properties of these masses are indistinguishable from the surrounding mudstone, indicating crystallites smaller than 40–60 μm (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">13a–d</a>). In the Apollo Temple abrasion, PIXL analyses also reveal abundant Fe-phosphate masses. The colour properties of some of the Fe-phosphate masses in this target are distinctive: colourless in daytime WATSON images, tan/orange-toned under nighttime white-light LED illumination, and red in decorrelation stretch images relative to the surrounding white–grey mud (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">22a–c</a>). Combined, these properties are consistent with accumulations of microcrystalline vivianite (Fe<sup>2+</sup><sub>3</sub>(PO<sub>4</sub>)<sub>2</sub>·8H<sub>2</sub>O) or lower-hydration-state ferrous phosphates (for example, phosphoferrite: Fe<sup>2+</sup><sub>3</sub>(PO<sub>4</sub>)<sub>2</sub>·3H<sub>2</sub>O) and their oxidation products, for example, metavivianite (Fe<sup>2+</sup><sub>2.5</sub>Fe<sup>3+</sup><sub>0.5</sub>(PO<sub>4</sub>)<sub>2</sub>·7.5H<sub>2</sub>O), ferrostrunzite (Fe<sup>2+</sup>Fe<sup>3+</sup><sub>2</sub>(PO<sub>4</sub>)<sub>2</sub>(OH)<sub>2</sub>·6H<sub>2</sub>O) and santabarbaraite (Fe<sup>3+</sup><sub>3</sub>(PO<sub>4</sub>)<sub>2</sub>(OH)<sub>3</sub>·5H<sub>2</sub>O), all of which have molar FeO:P ratios of 3:2 and colour properties that match our observations in Bright Angel.</p><p>The Fe-phosphate masses do not appear to have been sorted into laminations or lenses of relative enrichment, as might be expected for 100–200 μm accumulations of vivianite co-deposited with finer-grained aluminosilicates and silica. They are thus unlikely to have been transported and deposited as grains along with the surrounding muddy sediment. Instead, the distribution of the Fe-phosphate masses indicates they formed as the result of chemical processes after mudstone deposition and accordingly can be considered authigenic nodules. In the proximity targets ‘Grapevine Canyon’ and Walhalla Glades, Fe-phosphate nodules are encased in larger, centimetre-scale Ca-sulfate nodules (Supplementary Figs. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">13h</a> and <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">20</a>), which are themselves cross-cut by a later generation of light-toned, mineralized fractures (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">3b</a>). Fe-phosphate nodule abundances and sizes seem unrelated to their proximity to either generation of Ca-sulfate, indicating that Ca-sulfate nodule and vein emplacement occurred after Fe-phosphate nodule formation. Fe-phosphate is rare in Masonic Temple area targets. A few isolated spots that might contain Fe-phosphate masses were detected by PIXL in the Malgosa Crest abrasion target and WATSON images showed a few large (about 1–5 mm) blue–green masses (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">23a–c</a>), but they were not analysed. These could be authigenic nodules of a different scale or transported Fe-phosphate-enriched clasts.</p><p>A striking feature observed in the Cheyava Falls target (and the corresponding Sapphire Canyon core sample), is distinct spots (informally referred to as ‘leopard spots’ by the Mars 2020 Science Team) that have circular to crenulated dark-toned rims and lighter-toned cores (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig3">3a–c</a>). The spots range in size from about 200 μm to 1 mm in diameter and their cores are less red than their surrounding mudstone. Like the previously described authigenic nodules they co-occur with, the spots are not concentrated in layers or laminae; together with their irregular shapes, this indicates that they were not deposited as grains. Instead, these multi-coloured features appear to represent in situ reaction fronts.</p><p>PIXL XRF analyses of reaction front rims reveal they are enriched in Fe, P and Zn relative to the mudstone they occur in (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig5">5a,b</a>); we interpret the rims to be made of the same Fe-phosphate minerals found in authigenic nodules. In the reaction front cores, a phase enriched in S-, Fe-, Ni- and Zn was detected (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig5">5a,b</a>). Insight into the identity of this phase comes from comparison with PIXL analyses of the Apollo Temple target in the same outcrop block as Cheyava Falls (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig2">2</a>). A ternary diagram of the molar proportions of Fe, S and Ca (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig4">4d</a>) shows that several spot analyses trend towards a composition on the Fe–S join with an Fe:S ratio of about 3:4. Most of these points are associated with a non-diffracting, millimetre-scale region in the sol 1213 Apollo Temple XRF map shown in Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">13c,g</a>. This region, like the reaction front cores, is also enriched in Zn and Ni, approaching values as high as 2,300 ± 670 ppm and 2,000 ± 570 ppm, respectively (<a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">Supplementary Information</a>), We also detect copper in this region at a concentration of 419 ± 355 ppm (<a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">Supplementary Information</a>). X-ray scattering properties indicate that both this region and the reaction front cores are light-element-deficient relative to FeO and SO<sub>3</sub> (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">24</a>). In LED-illuminated colour images, the high Fe–S region of Apollo Temple contains small dull brown-to-black-coloured masses (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">25</a>). Taken together, these chemical and colour properties are consistent with the Fe-sulfide mineral greigite (Fe<sup>3+</sup><sub>2</sub>Fe<sup>2+</sup>S<sub>4</sub>; also see Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">26</a>). The sulfide-bearing region is adjacent to other submillimetre-scale mineral accumulations having properties consistent with Fe and S in a range of oxidation states, including jarosite [KFe<sup>3+</sup><sub>2</sub>(SO<sub>4</sub>)<sub>3</sub>(OH)<sub>6</sub>], which is an oxidation product of Fe-sulfide<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 19" title="Burns, R. G. &amp; Fisher, D. S. Iron–sulfur mineralogy of Mars—magmatic evolution and chemical-weathering products. J. Geophys. Res. Solid Earth 95, 14415–14421 (1990)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR19" id="ref-link-section-d33770877e3419">19</a></sup>, and a red–brown Fe-rich phase with low SO<sub>3</sub>, SiO<sub>2</sub>, Al<sub>2</sub>O<sub>3</sub> and analytical totals, consistent with siderite (Supplementary Figs. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">13g</a> and <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">25</a>).</p><div data-test="figure" data-container-section="figure" id="figure-5" data-title="Redox processes in Bright Angel and Masonic Temple."><figure><figcaption><b id="Fig5" data-test="figure-caption-text">Fig. 5: Redox processes in Bright Angel and Masonic Temple.</b></figcaption><div><div><a data-test="img-link" data-track="click" data-track-label="image" data-track-action="view figure" href="https://www.nature.com/articles/s41586-025-09413-0/figures/5" rel="nofollow"><picture><source type="image/webp" srcset="https://media.springernature.com/lw685/springer-static/image/art%3A10.1038%2Fs41586-025-09413-0/MediaObjects/41586_2025_9413_Fig5_HTML.png?as=webp"><img aria-describedby="Fig5" src="https://media.springernature.com/lw685/springer-static/image/art%3A10.1038%2Fs41586-025-09413-0/MediaObjects/41586_2025_9413_Fig5_HTML.png" alt="figure 5" loading="lazy" width="685" height="542"></picture></a></div><p><b>a</b>, PIXL MCC colour image of the target Cheyava Falls showing the outline of the PIXL scan area, and the individual XRF analysis points summed together to determine the bulk chemical composition (Supplementary Tables <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">1–3</a>) of mudstone (tan), reaction front cores (purple), and nodule and reaction front rims (green). Scale bar, 3 mm. <b>b</b>, Element mobility index (<i>τ</i><sub>i,TiO2</sub>; <a data-track="click" data-track-label="link" data-track-action="section anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Sec7">Methods</a>) for the indicated elements in Cheyava Falls showing enrichment and depletion patterns for nodules and reaction front rims (green) and reaction front cores (purple) relative to the mudstone they are contained in. <b>c</b>, Normalized probability density function for the NIR/blue reflectance value of individual pixels in PIXL MCC images of the mudstone facies in each of the indicated targets. A higher NIR/blue ratio is associated with higher Fe<sup>3+</sup> concentration, consistent with a more oxidized substrate (and vice versa). <b>d</b>, Maximum percentage of the total iron in each of the indicated targets that could be present as vivianite (bars with stippled fill), greigite (bars with diagonal line fill) and their sum (grey bars); calculations described in <a data-track="click" data-track-label="link" data-track-action="section anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Sec7">Methods</a>. The Apollo Temple target has the highest calculated vivianite + greigite abundance, the strongest Raman G band (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig3">3d</a>) and is the least-red target of the group (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig5">5c</a>). Malgosa Crest has the lowest calculated vivianite + greigite abundance, organic matter is not detected in this target and it is the reddest target of the group (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig5">5c</a>). Walhalla Glades and Cheyava Falls fall between these two extremes. Steamboat Mountain is separated from the group owing to the lack of constraints on the presence of organic matter in the mudstone in this target. Error bars in <b>b</b> and <b>d</b> represent propagated standard errors.</p></div><p><a data-test="article-link" data-track="click" data-track-label="button" data-track-action="view figure" href="https://www.nature.com/articles/s41586-025-09413-0/figures/5" data-track-dest="link:Figure5 Full size image" aria-label="Full size image figure 5" rel="nofollow"><span>Full size image</span></a></p></figure></div><p>Finally, in the Bright Angel formation mudstone facies, there is an inverse relationship between the inferred abundances of vivianite and greigite (<a data-track="click" data-track-label="link" data-track-action="section anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Sec7">Methods</a> and <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">Supplementary Information</a>) versus mudstone oxidation state, inferred from the NIR/blue reflectance ratio in PIXL MCC images<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 20" title="Henneke, J. et al. A radiometric correction method and performance characteristics for PIXL’s multispectral analysis using LEDs. Space Sci. Rev. 
                  https://doi.org/10.1007/s11214-023-01014-5
                  
                 (2023)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR20" id="ref-link-section-d33770877e3511">20</a></sup>. The NIR/blue ratio is sensitive to the relative abundance of Fe<sup>3+</sup>, like observations from Mastcam-Z (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">9a,b</a>) and SuperCam (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">10</a>). This inverse relationship is shown in Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig5">5c,d</a>. Mudstone oxidation state also appears to be inversely related to the strength of the SHERLOC Raman G band. As shown in Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig5">5c,d</a>, the Apollo Temple mudstone has the strongest G band, the highest inferred vivianite + greigite abundance, and the least-oxidized colour properties. In contrast, Malgosa Crest has no detectable organic matter, the lowest inferred vivianite + greigite abundance, and is the most-oxidized target analysed in the Bright Angel formation. Walhalla Glades and Cheyava Falls are intermediate between these two extremes.</p></div></div><div id="Sec6-section" data-title="An exploration of reaction mechanisms"><h2 id="Sec6">An exploration of reaction mechanisms</h2><div id="Sec6-content"><p>Chemical and sedimentological data indicate that reduced iron and sulfur were generated, mobilized and precipitated following the deposition of fine-grained oxidized iron- and phosphorous-bearing sediment. Except when found in authigenic nodules and reaction front rims, phosphate is not associated with a mineral phase (for example, there is no indication that apatite or merrillite are present; Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig4">4c</a>). Accordingly, we suggest that during deposition, phosphate was adsorbed on Fe<sup>3+</sup>-, Al- and Si-rich sediment grains<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 21" title="Rampe, E. B., Morris, R. V., Archer, P. D., Agresti, D. G. &amp; Ming, D. W. Recognizing sulfate and phosphate complexes chemisorbed onto nanophase weathering products on Mars using in-situ and remote observations. Am. Mineral. 101, 678–689 (2016)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR21" id="ref-link-section-d33770877e3544">21</a></sup>. In the Bright Angel area, iron and phosphate have been redistributed into authigenic nodules and reaction front rims; mass balance calculations suggest closed-system reorganization of these chemical components into vivianite (<a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">Supplementary Text</a>). Fe-phosphate-enriched masses are not associated with Al<sub>2</sub>O<sub>3</sub> (Supplementary Fig. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">21h</a>), which might otherwise suggest the co-existence of Al-phosphate minerals typical of transport of Al<sup>3+</sup> and Fe<sup>3+</sup> under oxidizing, low-pH conditions, such as variscite (AlPO<sub>4</sub>·2H<sub>2</sub>O) and strengite (FePO<sub>4</sub>·2H<sub>2</sub>O)<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 22" title="Roncal-Herrero, T., Rodríguez-Blanco, J. D., Benning, L. G. &amp; Oelkers, E. H. Precipitation of iron and aluminum phosphates directly from aqueous solution as a function of temperature from 50 to 200 °C. Crys. Growth Des. 9, 5197–5205 (2009)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR22" id="ref-link-section-d33770877e3572">22</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 23" title="Nriagu, J. &amp; Dell, C. Diagenetic formation of iron phosphates in recent lake sediments. Am. Mineral. 59, 934–946 (1974)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR23" id="ref-link-section-d33770877e3575">23</a></sup> (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig4">4c</a>). Instead, transport of Fe<sup>2+</sup>, Zn<sup>2+</sup> and PO<sub>4</sub><sup>3−</sup> probably occurred under non-oxidizing conditions, which, combined with moderate pH, prevented mobilization of Al<sup>3+</sup>. Such conditions favour the precipitation of vivianite<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 23" title="Nriagu, J. &amp; Dell, C. Diagenetic formation of iron phosphates in recent lake sediments. Am. Mineral. 59, 934–946 (1974)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR23" id="ref-link-section-d33770877e3592">23</a></sup>. The apparent absence of Fe-phosphate nodules and reaction fronts in most of the conglomerate-bearing Masonic Temple area suggests a depositional facies control on the development of these specific features.</p><p>In the Bright Angel area, Fe-phosphate minerals are associated with organic matter (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig3">3d</a>). A pathway to the formation of vivianite is via the oxidation of this organic matter, which would have been coupled to the reductive dissolution of Fe<sup>3+</sup> in sediment grains. This process would have liberated Fe<sup>2+</sup> and PO<sub>4</sub><sup>3−</sup> to solution and precipitated Fe<sup>2+</sup>-phosphate. Similar precipitation and redox reactions have been considered for an occurrence of Mn–P-rich nodules in Gale Crater<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 24" title="Treiman, A. H. et al. Manganese–iron phosphate nodules at the Groken Site, Gale Crater, Mars. Minerals 
                  https://doi.org/10.3390/min13091122
                  
                 (2023)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR24" id="ref-link-section-d33770877e3612">24</a></sup>, and for submillimetre-scale mixed valence Fe-phosphate grains in a conglomerate outcrop in the Jezero Western Fan<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 25" title="Hausrath, E. M. et al. Phosphates on Mars and their importance as igneous, aqueous, and astrobiological indicators. Minerals 
                  https://doi.org/10.3390/min14060591
                  
                 (2024)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR25" id="ref-link-section-d33770877e3616">25</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 26" title="Kizovski, T. et al. Fe-phosphates in Jezero Crater as evidence for an ancient habitable environment on Mars. Nat. Commun. 16, 6470 (2025)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR26" id="ref-link-section-d33770877e3619">26</a></sup>. Sulfate reduction coupled to organic matter oxidation could also be responsible for precipitation of Fe-sulfide in the Apollo Temple target and in the cores of reaction fronts in Cheyava Falls. As reduced Fe- and S-bearing phases formed, the mudstone colour properties were modified by iron reduction, bleaching it of its red colour in proportion to the abundance of available organic matter (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig5">5c,d</a>).</p><p>Here we consider the null hypothesis: that within the low-temperature sedimentary-diagenetic setting we have proposed for the Bright Angel formation, abiotic reactions produced ferrous Fe and reduced S and concentrated them in authigenic nodules and reaction fronts. The null hypothesis predicts that abiotic reactions can reduce sedimentary Fe<sup>3+</sup> to aqueous Fe<sup>2+</sup>, which is then incorporated in the Fe-phosphate and Fe-sulfide minerals we have identified. A wide variety of organic carbon compounds are known to promote the abiotic reductive dissolution of ferric iron oxide minerals at temperatures between 10 °C and 80 °C (refs. <sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" title="Miller, W. P., Zelazny, L. W. &amp; Martens, D. C. Dissolution of synthetic crystalline and noncrystalline iron oxides by organic acids. Geoderma 37, 1–13 (1986)." href="#ref-CR27" id="ref-link-section-d33770877e3633">27</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" title="Torres, R., Blesa, M. A. &amp; Matijević, E. Interactions of metal hydrous oxides with chelating agents: IX. Reductive dissolution of hermatite and magnetite by aminocarboxylic acids. J. Colloid Interface Sci. 134, 475–485 (1990)." href="#ref-CR28" id="ref-link-section-d33770877e3633_1">28</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 29" title="Ionescu, D., Heim, C., Polerecky, L., Thiel, V. &amp; De Beer, D. Biotic and abiotic oxidation and reduction of iron at circumneutral pH are inseparable processes under natural conditions. Geomicrobiol. J. 32, 221–230 (2015)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR29" id="ref-link-section-d33770877e3636">29</a></sup>). The presence of organic matter in Bright Angel formation mudstone (Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig3">3d</a>), which could have been produced on Mars through abiotic synthesis<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 30" title="Eigenbrode, J. L. et al. Organic matter preserved in 3-billion-year-old mudstones at Gale Crater, Mars. Science 360, 1096–1101 (2018)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR30" id="ref-link-section-d33770877e3643">30</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 31" title="Steele, A. et al. Organic synthesis associated with serpentinization and carbonation on early Mars. Science 375, 172–177 (2022)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR31" id="ref-link-section-d33770877e3646">31</a></sup> or delivered from non-biological exogenic sources<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 30" title="Eigenbrode, J. L. et al. Organic matter preserved in 3-billion-year-old mudstones at Gale Crater, Mars. Science 360, 1096–1101 (2018)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR30" id="ref-link-section-d33770877e3651">30</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 32" title="Flynn, G. J., Nittler, L. R. &amp; Engrand, C. Composition of cosmic dust: sources and implications for the early Solar System. Elements 12, 177–183 (2016)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR32" id="ref-link-section-d33770877e3654">32</a></sup>, suggests that such reactions could have occurred. Further analysis is required to determine whether the specific organic compounds present in the Bright Angel formation can drive the reduction of mineral-hosted sedimentary Fe<sup>3+</sup> at low temperature. Another possible pathway to the production of Fe<sup>2+</sup> is through the abiotic oxidation of pyrite by Fe<sup>3+</sup> (aq)<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 33" title="Rimstidt, J. D. &amp; Vaughan, D. J. Pyrite oxidation: a state-of-the-art assessment of the reaction mechanism. Geochim. Cosmochim. Acta 67, 873–880 (2003)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR33" id="ref-link-section-d33770877e3664">33</a></sup>. This process would require both the presence of detrital pyrite and low solution pH, which would permit Fe<sup>3+</sup> (aq) to be present. As previously discussed, neither condition appears to be met in the Bright Angel formation.</p><p>The null hypothesis also predicts that an abiotic source of dissolved sulfide was available to be incorporated in authigenic Fe-sulfide. Dissolved sulfide facilitates the reductive dissolution of ferric iron oxides, with half-lives ranging from years to hours depending on Fe-oxide mineralogy, crystallinity and pH<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 34" title="Afonso, M. D. &amp; Stumm, W. Reductive dissolution of iron(III) (hydr)oxides by hydrogen-sulfide. Langmuir 8, 1671–1675 (1992)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR34" id="ref-link-section-d33770877e3673">34</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 35" title="Canfield, D. E., Raiswell, R. &amp; Bottrell, S. The reactivity of sedimentary iron minerals toward sulfide. Am. J. Sci. 292, 659–683 (1992)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR35" id="ref-link-section-d33770877e3676">35</a></sup>, providing another potential pathway to the production of Fe<sup>2+</sup> (aq). Magmatic degassing of reduced sulfur-bearing gases&nbsp;(for example, ref. <sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 36" title="Gaillard, F. &amp; Scaillet, B. The sulfur content of volcanic gases on Mars. Earth Planet. Sci. Lett. 279, 34–43 (2009)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR36" id="ref-link-section-d33770877e3682">36</a></sup>) to local groundwater could provide a potential source of dissolved sulfide during diagenesis. However, geological constraints demand that this sulfide migrate in from a distal, high-temperature sulfide-gas-producing system, to the low-temperature depositional-diagenetic environment of the Bright Angel formation. No evidence for sulfide-producing hydrothermal or magmatic systems was observed in the Crater Floor, Western Fan or Margin Unit before investigation of the Bright Angel formation. Abiotic reduction of sulfate to sulfide by organic matter is another possible source of dissolved sulfide that could both reduce Fe<sup>3+</sup>-bearing sediment and provide the reduced sulfur required to form Fe-sulfide minerals<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 37" title="Machel, H. G. Bacterial and thermochemical sulfate reduction in diagenetic settings—old and new insights. Sediment. Geol. 140, 143–175 (2001)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR37" id="ref-link-section-d33770877e3688">37</a></sup>. However, sulfate reduction by reduced carbon compounds is energetically demanding and kinetically inhibited by the symmetry of the SO<sub>4</sub><sup>2−</sup> ion<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 38" title="Rickard, D. &amp; Luther, G. W. Chemistry of iron sulfides. Chem. Rev. 107, 514–562 (2007)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR38" id="ref-link-section-d33770877e3696">38</a></sup>, so abiotic reaction rates are exceedingly slow at temperatures &lt;150–200 °C (refs. <sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 37" title="Machel, H. G. Bacterial and thermochemical sulfate reduction in diagenetic settings—old and new insights. Sediment. Geol. 140, 143–175 (2001)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR37" id="ref-link-section-d33770877e3700">37</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 38" title="Rickard, D. &amp; Luther, G. W. Chemistry of iron sulfides. Chem. Rev. 107, 514–562 (2007)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR38" id="ref-link-section-d33770877e3703">38</a></sup>). As discussed previously, the Bright Angel formation shows no unambiguous evidence that it was heated in contact with adjacent geologic units, and burial to depths in excess of about 5 km would be required to achieve temperatures &gt;150 °C during the Noachian<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 39" title="McSween, H. Y. Jr., Labotka, T. C. &amp; Viviano-Beck, C. E. Metamorphism in the Martian crust. Meteorit. Planet. Sci. 50, 590–603 (2015)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR39" id="ref-link-section-d33770877e3707">39</a></sup>.</p><p>Given the potential challenges to the null hypothesis, we consider here an alternative biological pathway for the formation of authigenic nodules and reaction fronts. On Earth, vivianite nodules are known to form in fresh water<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 23" title="Nriagu, J. &amp; Dell, C. Diagenetic formation of iron phosphates in recent lake sediments. Am. Mineral. 59, 934–946 (1974)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR23" id="ref-link-section-d33770877e3715">23</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 40" title="Cosmidis, J. et al. Biomineralization of iron-phosphates in the water column of Lake Pavin (Massif Central, France). Geochim. Cosmochim. Acta 126, 78–96 (2014)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR40" id="ref-link-section-d33770877e3718">40</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 41" title="Vuillemin, A. et al. Vivianite formation in ferruginous sediments from Lake Towuti, Indonesia. Biogeosciences 17, 1955–1973 (2020)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR41" id="ref-link-section-d33770877e3721">41</a></sup> and marine<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 42" title="Hsu, T. W., Jiang, W. T. &amp; Wang, Y. S. Authigenesis of vivianite as influenced by methane-induced sulfidization in cold-seep sediments off southwestern Taiwan. J. Asian Earth Sci. 89, 88–97 (2014)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR42" id="ref-link-section-d33770877e3725">42</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 43" title="Liu, J. R. et al. Vivianite formation in methane-rich deep-sea sediments from the South China Sea. Biogeosciences 15, 6329–6348 (2018)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR43" id="ref-link-section-d33770877e3728">43</a></sup> settings as a by-product of low-temperature microbially mediated Fe-reduction reactions. Fe-sulfide minerals, such as greigite, pyrite and mackinawite, can also be formed as products of microbial sulfate reduction<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 44" title="Rickard, D., Roberts, A. P. &amp; Navrotsky, A. Sedimentary greigite formation. Am. J. Sci. 
                  https://doi.org/10.2475/001c.121855
                  
                 (2024)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR44" id="ref-link-section-d33770877e3732">44</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 45" title="Picard, A., Gartman, A., Clarke, D. R. &amp; Girguis, P. R. Sulfate-reducing bacteria influence the nucleation and growth of mackinawite and greigite. Geochim. Cosmochim. Acta 220, 367–384 (2018)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR45" id="ref-link-section-d33770877e3735">45</a></sup>, and have been observed in close spatial association with vivianite<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 42" title="Hsu, T. W., Jiang, W. T. &amp; Wang, Y. S. Authigenesis of vivianite as influenced by methane-induced sulfidization in cold-seep sediments off southwestern Taiwan. J. Asian Earth Sci. 89, 88–97 (2014)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR42" id="ref-link-section-d33770877e3739">42</a></sup>. Greigite precipitation, from precursor mackinawite, is favoured by a high dissolved Fe<sup>2+</sup>/SO<sub>4</sub><sup>2−</sup> ratio, typical of diagenetic fluids in freshwater and ferruginous marine environments<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 44" title="Rickard, D., Roberts, A. P. &amp; Navrotsky, A. Sedimentary greigite formation. Am. J. Sci. 
                  https://doi.org/10.2475/001c.121855
                  
                 (2024)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR44" id="ref-link-section-d33770877e3749">44</a></sup>. Repeated sulfidation of Fe<sup>2+</sup> in vivianite followed by sulfide oxidation promotes stable incorporation of Zn and other heavy metals into vivianite<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 46" title="Xu, Z. Y. et al. Sulfidation-reoxidation enhances heavy metal immobilization by vivianite. Water Res. 263, 122195 (2024)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR46" id="ref-link-section-d33770877e3755">46</a></sup>. Thus, Zn enrichment in nodules is consistent with a hybrid iron- and sulfate-reducing mechanism. Minerals like these, produced by Fe- and S-based metabolisms, provide some of the earliest chemical evidence for life on Earth<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 47" title="Craddock, P. R. &amp; Dauphas, N. Iron and carbon isotope evidence for microbial iron respiration throughout the Archean. Earth Planet. Sci. Lett. 303, 121–132 (2011)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR47" id="ref-link-section-d33770877e3759">47</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 48" title="Marin-Carbonne, J. et al. In situ Fe and S isotope analyses in pyrite from the 3.2 Ga Mendon Formation (Barberton Greenstone Belt, South Africa): evidence for early microbial iron reduction. Geobiology 18, 306–325 (2020)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR48" id="ref-link-section-d33770877e3762">48</a></sup>, and are thought to represent potential biosignatures in the search for life on Mars<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 49" title="Banfield, J. F., Moreau, J. W., Chan, C. S., Welch, S. A. &amp; Little, B. Mineralogical biosignatures and the search for life on Mars. Astrobiology 1, 447–465 (2001)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR49" id="ref-link-section-d33770877e3767">49</a></sup>. The fact that the reaction fronts observed in the Cheyava Falls target are defined by small, spot-shaped, bleached zones in an overall Fe-oxide-bearing, red-coloured rock invites comparison to terrestrial ‘reduction halos’ in modern marine sediments<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 50" title="Thomson, J., Higgs, N. C. &amp; Colley, S. A geochemical investigation of reduction haloes developed under turbidites in brown clay. Mar. Geol. 89, 315–330 (1989)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR50" id="ref-link-section-d33770877e3771">50</a></sup> and ‘reduction spots’, which are concentrically zoned features found in rocks of Precambrian and younger age on Earth<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 51" title="Spinks, S. C., Parnell, J. &amp; Bowden, S. A. Reduction spots in the Mesoproterozoic age: implications for life in the early terrestrial record. Int. J. Astrobiol. 9, 209–216 (2010)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR51" id="ref-link-section-d33770877e3775">51</a></sup>. A biologically influenced origin has been proposed by some for reduction spots<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 51" title="Spinks, S. C., Parnell, J. &amp; Bowden, S. A. Reduction spots in the Mesoproterozoic age: implications for life in the early terrestrial record. Int. J. Astrobiol. 9, 209–216 (2010)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR51" id="ref-link-section-d33770877e3779">51</a></sup>, although this is not a universally held perspective<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 52" title="Kawahara, H. et al. Bleached-spot formation in Fe-oxide-rich rock by inorganic process. Chem. Geol. 609, 121049 (2022)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR52" id="ref-link-section-d33770877e3783">52</a></sup>.</p><p>Under a biological scenario, the mixture of reactants available in the Bright Angel formation at the time of deposition could have provided raw ingredients for a set of biological redox reactions that drove Fe and S reduction, organic matter oxidation, and precipitation of Fe<sup>2+</sup>-phosphate and Fe-sulfide minerals. In this scenario, oxidized iron and sulfate would be used as terminal electron acceptors for organic matter consumption, promoting the formation of minerals through the release of chemical by-products: Fe-phosphate minerals in the case of iron reduction and Fe-sulfide minerals in the case of sulfate reduction. Where authigenic nodules were formed, the reaction would have shut off before additional reductive processes occurred. In the places where larger reaction fronts formed, the presence of sulfide-bearing cores suggests that sulfate-reducing metabolisms with lower energy yields could have taken hold once those regions of the rock had been depleted of available Fe<sup>3+</sup>, but had not yet exhausted organic carbon in the reaction front core.</p><p>In summary, our analysis leads us to conclude that the Bright Angel formation contains textures, chemical and mineral characteristics, and organic signatures that warrant consideration as ‘potential biosignatures’<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" title="Des Marais, D. J. et al. The NASA astrobiology roadmap. Astrobiology 3, 219–235 (2003)." href="#ref-CR53" id="ref-link-section-d33770877e3797">53</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" title="Gillen, C., Jeancolas, C., McMahon, S. &amp; Vickers, P. The call for a new definition of biosignature. Astrobiology 23, 1228–1237 (2023)." href="#ref-CR54" id="ref-link-section-d33770877e3797_1">54</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 55" title="Mustard, J. F. et al. Report of the Mars 2020 Science Definition Team (Mars Exploration Program Analysis Group, 2013)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR55" id="ref-link-section-d33770877e3800">55</a></sup>, that is, “a feature that is consistent with biological processes and that, when encountered, challenges the researcher to attribute it either to inanimate or to biological processes, compelling them to gather more data before reaching a conclusion as to the presence or absence of life<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 53" title="Des Marais, D. J. et al. The NASA astrobiology roadmap. Astrobiology 3, 219–235 (2003)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR53" id="ref-link-section-d33770877e3804">53</a></sup>”. This assessment is further supported by the geological context of the Bright Angel formation, which indicates that it is sedimentary in origin and deposited from water under habitable conditions. Many significant questions remain about the origin of the nodules and reaction fronts encountered by Perseverance. We suggest that further in situ, laboratory, modelling and field analogue research into both abiotic and biological processes that give rise to the suite of mineral and organic phases observed in the Bright Angel formation will improve our understanding of the conditions under which they formed. Ultimately, the return of samples from Mars for study on Earth, including the Sapphire Canyon sample collected from the Bright Angel formation, would provide the best opportunity to understand the processes that gave rise to the unique features described here.</p></div></div><div id="Sec7-section" data-title="Methods"><h2 id="Sec7">Methods</h2><div id="Sec7-content"><h3 id="Sec8">Science instruments</h3><p>The data used in this contribution were produced by: (1) the RIMFAX ground-penetrating radar<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 56" title="Hamran, S.-E. et al. Radar Imager for Mars’ Subsurface Experiment—RIMFAX. Space Sci. Rev. 216, 128 (2020)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR56" id="ref-link-section-d33770877e3820">56</a></sup>; (2) PIXL and its associated MCC<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 57" title="Allwood, A. C. et al. PIXL: Planetary Instrument for X-ray Lithochemistry. Space Sci. Rev. 216, 134 (2020)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR57" id="ref-link-section-d33770877e3824">57</a></sup>; (3) the SHERLOC instrument and its associated WATSON and ACI camera systems<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 11" title="Bhartia, R. et al. Perseverance’s Scanning Habitable Environments with Raman and Luminescence for Organics and Chemicals (SHERLOC) investigation. Space Sci. Rev. 217, 58 (2021)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR11" id="ref-link-section-d33770877e3828">11</a></sup>; (4) the SuperCam instrument<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 58" title="Maurice, S. et al. The SuperCam instrument suite on the Mars 2020 rover: science objectives and mast-unit description. Space Sci. Rev. 217, 47 (2021)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR58" id="ref-link-section-d33770877e3832">58</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 59" title="Wiens, R. C. et al. The SuperCam instrument suite on the NASA Mars 2020 rover: body unit and combined system tests. Space Sci. Rev. 217, 4 (2021)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR59" id="ref-link-section-d33770877e3835">59</a></sup>; and (5) the Mastcam-Z instrument<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 60" title="Bell, J. F. et al. The Mars 2020 Perseverance rover Mast Camera Zoom (Mastcam-Z) multispectral, stereoscopic imaging investigation. Space Sci. Rev. 217, 24 (2021)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR60" id="ref-link-section-d33770877e3839">60</a></sup>.</p><h3 id="Sec9">Rock-surface preparation for analysis</h3><p>Naturally exposed rock surfaces were prepared by removing surface dust with the gas dust removal tool<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 61" title="Moeller, R. C. et al. The Sampling and Caching Subsystem (SCS) for the scientific exploration of Jezero Crater by the Mars 2020 Perseverance rover. Space Sci. Rev. 217, 5 (2020)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR61" id="ref-link-section-d33770877e3851">61</a></sup>. To observe less weathered or flatter surfaces, several rocks were abraded using the rover’s abrading bit<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 61" title="Moeller, R. C. et al. The Sampling and Caching Subsystem (SCS) for the scientific exploration of Jezero Crater by the Mars 2020 Perseverance rover. Space Sci. Rev. 217, 5 (2020)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR61" id="ref-link-section-d33770877e3855">61</a></sup> to produce circular approximately 5-cm-diameter-wide by approximately 5–10-mm-deep ‘abrasion patches’. Target names, surface preparation techniques, unit and outcrop associations, and the images that each target appears in are tabulated in Supplementary Table <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">3</a>.</p><h3 id="Sec10">SHERLOC measurements</h3><p>An overview of SHERLOC image and spectral map acquisition and standard processing methods are described in refs. <sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 11" title="Bhartia, R. et al. Perseverance’s Scanning Habitable Environments with Raman and Luminescence for Organics and Chemicals (SHERLOC) investigation. Space Sci. Rev. 217, 58 (2021)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR11" id="ref-link-section-d33770877e3870">11</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 62" title="Sharma, S. et al. Diverse organic-mineral associations in Jezero Crater, Mars. Nature 619, 724–72 (2023)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR62" id="ref-link-section-d33770877e3873">62</a></sup>. Colourized ACI images were produced using methods described in ref. <sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 62" title="Sharma, S. et al. Diverse organic-mineral associations in Jezero Crater, Mars. Nature 619, 724–72 (2023)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR62" id="ref-link-section-d33770877e3877">62</a></sup>. A focus mechanism motor failure on sol 1024 required SHERLOC measurements reported here&nbsp;to rely entirely on positioning by Perseverence’s robotic arm, without the capability to refine focus internally. Bright Angel measurements were therefore made at a systematic offset from best focus: sol 1180 Walhalla Glades was collected at approximately 1.2-mm offset, sol 1201 Cheyava Falls was collected at approximately 1.8-mm offset, and sol 1217 Apollo Temple was collected at approximately 1.1-mm offset. Sol 1242 Malgosa Crest was collected at &lt;0.3-mm offset from best focus; the absence of a G-band signal at Malgosa Crest, despite its better placement, provides further confidence in the G-band peak classification of the other Bright Angel spectra. The spectral intensity is attenuated for measurements collected out of focus, with approximately 35% signal loss expected for 1.5-mm focus offsets. No other spectral artefacts are expected for out of focus measurements. The Raman D band, normally associated in visible Raman spectra with disordered carbonaceous matter such as kerogen, is not present in SHERLOC spectra from the Bright Angel targets. The D band is generally less prominent in deep-ultraviolet (for SHERLOC, 248.6 nm) Raman spectra than Raman spectra that rely on visible-light-wavelength excitation sources<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 63" title="Osterhout, J. T., Schopf, J. W., Kudryavtsev, A. B., Czaja, A. D. &amp; Williford, K. H. Deep-UV Raman spectroscopy of carbonaceous Precambrian microfossils: insights into the search for past life on Mars. Astrobiology 22, 1239–1254 (2022)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR63" id="ref-link-section-d33770877e3881">63</a></sup>. Furthermore, the focus offset associated with measurements collected at Bright Angel is expected to reduce the observed Raman signal of a potential D-band peak to the instrument noise level, as confirmed with focus offset tests on the organic-rich SaU 008 SHERLOC calibration target and with SHERLOC analogue laboratory instruments. The SHERLOC fused-silica window generates a minor optical background contribution that must be accounted for in SHERLOC spectra, as described by ref. <sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 64" title="Jakubek, R. S. et al. Spectral Background Calibration of Scanning Habitable Environments with Raman and Luminescence for Organics and Chemicals (SHERLOC) spectrometer onboard the rover enables identification of a ubiquitous Martian spectral component. Appl. Spectrosc. 
                  https://doi.org/10.1177/00037028241280081
                  
                 (2024)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR64" id="ref-link-section-d33770877e3885">64</a></sup>. The Si–O-stretching overtone feature in the 1,600 cm<sup>−1</sup> region is shown in Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig3">3d</a> (grey traces) for comparison with target spectra, demonstrating the significantly larger contribution of the G-band signal to this spectral region for Bright Angel measurements.</p><h3 id="Sec11">PIXL element and mineral abundance estimates</h3><p>In the <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM2">Supplementary Data Tables</a>, the bulk chemical composition determined from the sum of all XRF spectra collected by PIXL from each target is provided along with a black-and-white PIXL MCC image showing the footprint of the PIXL XRF scan area on the target. The sol number that the XRF and MCC data were collected on is shown, along with the number of XRF spectra (‘# XRF points’) that were collected from each target. The bulk element oxide and element abundances provided were calculated using the PIQUANT software package<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 57" title="Allwood, A. C. et al. PIXL: Planetary Instrument for X-ray Lithochemistry. Space Sci. Rev. 216, 134 (2020)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR57" id="ref-link-section-d33770877e3906">57</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 65" title="Heirwegh, C. M., Elam, W. T., O’Neil, L. P., Sinclair, K. P. &amp; Das, A. The focused beam X-ray fluorescence elemental quantification software package PIQUANT. Spectrochim. Acta Part B 196, 106520 (2022)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR65" id="ref-link-section-d33770877e3909">65</a></sup> and have been corrected to remove the effects of diffraction and topographic roughness using the methods described in refs. <sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 15" title="Tice, M. M. et al. Alteration history of Seitah Formation rocks inferred by PIXL X-ray fluorescence, X-ray diffraction, and multispectral imaging on Mars. Sci. Adv. 8, eabp9084 (2022)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR15" id="ref-link-section-d33770877e3913">15</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 66" title="Schmidt, M. E. et al. Diverse and highly differentiated lava suite in Jezero Crater, Mars: constraints on intracrustal magmatism revealed by Mars 2020 PIXL. Sci. Adv. 11, eadr2613 (2025)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR66" id="ref-link-section-d33770877e3916">66</a></sup>.</p><p>Where needed to support discussion in the paper or <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">Supplementary Text</a>, the bulk chemical composition of regions of interest (ROIs) within PIXL XRF scans are also shown. These are accompanied by PIXL MCC images that show the locations of the individual PIXL XRF points that are included in the ROI. For all ROIs included in the <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM2">Supplementary Data Tables</a>, we have also included a list of the PIXL Motion Counter (PMC #s) positions<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 57" title="Allwood, A. C. et al. PIXL: Planetary Instrument for X-ray Lithochemistry. Space Sci. Rev. 216, 134 (2020)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR57" id="ref-link-section-d33770877e3929">57</a></sup> for each XRF point in the ROI. These PMC locations describe which individual points are included in the ROI.</p><p>The element mobility index (<i>τ</i><sub>i,TiO2</sub>), shown in Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig5">5b</a>, was calculated using the methods described in ref. <sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 67" title="Chadwick, O. A., Brimhall, G. H. &amp; Hendricks, D. M. From a black to a gray box—a mass balance interpretation of pedogenesis. Geomorphology 3, 369–390 (1990)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR67" id="ref-link-section-d33770877e3943">67</a></sup>. The calculation of %Fe in vivianite and %Fe in greigite, shown in Fig. <a data-track="click" data-track-label="link" data-track-action="figure anchor" href="https://www.nature.com/articles/s41586-025-09413-0#Fig5">5d</a>, was performed using chemical abundance data for individual PMCs in the ‘mudstone’ ROIs shown in the <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM2">Supplementary Data Tables</a> for the targets Apollo Temple, Cheyava Falls, Walhalla Glades, Steamboat Mountain and Malgosa Crest. For each PMC in each mudstone ROI, the Fe and P abundances (in mmol g<sup>−1</sup>) were combined in a molar Fe:P ratio of 3:2 until all P had been combined with Fe to form vivianite. The individual PMC results for the number of mmol g<sup>−1</sup> of Fe in vivianite were then summed and compared with the total abundance of Fe in the mudstone ROI to determine the %Fe in vivianite parameter. In the next step, the remaining Fe in each PMC (after calculation of vivianite abundance) was combined with S in the appropriate molar Fe:S ratio until either all the Fe or all the S had been combined to form greigite. The individual PMC results for the number of mmol g<sup>−1</sup> of Fe in greigite were then summed and compared with the total abundance of Fe in the mudstone ROI to determine the %Fe in greigite parameter.</p><p>Because PIQUANT assumes that elements are paired with oxygen atoms for the purposes of determining element abundances from the fitting of X-ray spectra, the Fe:S stoichiometry used for estimation of greigite abundance was modified to a value 3:4.42, which differs slightly from idealized griegite stoichiometry (Fe:S = 3:4). The oxide assumption in PIQUANT causes it to overestimate the abundance of S in greigite because it expects the S fluorescence signal to be attenuated by matrix oxygen. To account for this effect, we modelled idealized spectra in PIQUANT for Fe<sub>3</sub>S<sub>4</sub> and FeOSO<sub>3</sub> and then determined the ratio of Fe/S K<sub>α1</sub> fluorescence from each calculated spectrum. PIQUANT correctly reports a 1:1 molar ratio for FeOSO<sub>3</sub>. The adjusted greigite stoichiometric ratio was calculated from the Fe/S K<sub>α1</sub> ratio from Fe<sub>3</sub>S<sub>4</sub> divided by the Fe/S K<sub>α1</sub> ratio from FeOSO<sub>3</sub>. The same calculation for the Fe-sulfide minerals troilite (FeS), pyrrhotite (Fe<sub>0.875</sub>S) and pyrite (FeS<sub>2</sub>) yields Fe:S ratios of 1:1.15, 1:1.29 and 1:2.11, respectively.</p><h3 id="Sec12">PIXL diffraction indexing of Ca-sulfate</h3><p>PIXL has two detectors and so can detect X-ray diffraction from crystalline materials when energies of PIXL’s incident radiation happen to be in a diffracting condition with <i>d-</i>spacings and orientations of crystal lattices in the target materials<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 14" title="Orenstein, B. J. et al. In-situ mapping of monocrystalline regions on Mars. Icarus 420, 116202 (2024)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR14" id="ref-link-section-d33770877e4001">14</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 15" title="Tice, M. M. et al. Alteration history of Seitah Formation rocks inferred by PIXL X-ray fluorescence, X-ray diffraction, and multispectral imaging on Mars. Sci. Adv. 8, eabp9084 (2022)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR15" id="ref-link-section-d33770877e4004">15</a></sup>. When detected, X-ray diffraction can also be used to assess crystallinity, grain size and grain texture of a target<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 14" title="Orenstein, B. J. et al. In-situ mapping of monocrystalline regions on Mars. Icarus 420, 116202 (2024)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR14" id="ref-link-section-d33770877e4008">14</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 15" title="Tice, M. M. et al. Alteration history of Seitah Formation rocks inferred by PIXL X-ray fluorescence, X-ray diffraction, and multispectral imaging on Mars. Sci. Adv. 8, eabp9084 (2022)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR15" id="ref-link-section-d33770877e4011">15</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 66" title="Schmidt, M. E. et al. Diverse and highly differentiated lava suite in Jezero Crater, Mars: constraints on intracrustal magmatism revealed by Mars 2020 PIXL. Sci. Adv. 11, eadr2613 (2025)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR66" id="ref-link-section-d33770877e4014">66</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 68" title="Liu, Y. et al. An olivine cumulate outcrop on the floor of Jezero Crater, Mars. Science 377, 1513–151 (2022)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR68" id="ref-link-section-d33770877e4017">68</a></sup> and to distinguish among minerals with similar elemental compositions<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 13" title="Jones, M. W. M. et al. In situ crystallographic mapping constrains sulfate precipitation and timing in Jezero Crater, Mars. Sci. Adv. 11, eadt3048 (2025)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR13" id="ref-link-section-d33770877e4021">13</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 26" title="Kizovski, T. et al. Fe-phosphates in Jezero Crater as evidence for an ancient habitable environment on Mars. Nat. Commun. 16, 6470 (2025)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR26" id="ref-link-section-d33770877e4024">26</a></sup>. Here diffraction from the Ca-sulfate-rich areas in PIXL scans in Apollo Temple, Walhalla Glades and Steamboat Mountain abrasion patches were compared with modelled diffraction patterns for gypsum, anhydrite and bassanite to identify the most likely mineral phase that matches the observed diffraction as described in detail in ref. <sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 13" title="Jones, M. W. M. et al. In situ crystallographic mapping constrains sulfate precipitation and timing in Jezero Crater, Mars. Sci. Adv. 11, eadt3048 (2025)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR13" id="ref-link-section-d33770877e4028">13</a></sup>. A mineral was selected as indexed when the <i>P</i> value from the Fisher-transformed cross-correlation results<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 13" title="Jones, M. W. M. et al. In situ crystallographic mapping constrains sulfate precipitation and timing in Jezero Crater, Mars. Sci. Adv. 11, eadt3048 (2025)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR13" id="ref-link-section-d33770877e4036">13</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 69" title="Fisher, R. A. Frequency distribution of the values of the correlation coefficient in samples from an indefinitely large population. Biometrika 10, 507–521 (1914)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR69" id="ref-link-section-d33770877e4039">69</a></sup> was ≤0.01. Where <i>P</i> &gt; 0.01, no mineral was selected as indexed. Owing to the difficulty phasing bassanite<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 16" title="Vaniman, D. T. et al. Gypsum, bassanite, and anhydrite at Gale Crater, Mars. Am. Mineral. 103, 1011–1020 (2018)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR16" id="ref-link-section-d33770877e4046">16</a></sup>, beam locations that indexed as bassanite were also treated as not indexed. A summary of the PIXL diffraction results is presented in Supplementary Table <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM1">2</a>.</p></div></div>
                    
                </div><div>
                <div id="data-availability-section" data-title="Data availability"><h2 id="data-availability">Data availability</h2><div id="data-availability-content">
              
              <p>The data presented in this paper are available on the NASA Planetary Data System Geoscience Node and Imaging and Cartography Node, which host dedicated repositories for data derived from the Mars 2020 Rover mission. The DOIs for these repositories are: Mars 2020 Mission bundle, <a href="https://doi.org/10.17189/1522642">https://doi.org/10.17189/1522642</a>; PIXL Instrument bundle, <a href="https://doi.org/10.17189/1522645">https://doi.org/10.17189/1522645</a>; derived data collection for PIXL individual PMC oxide quantifications, <a href="https://doi.org/10.17189/vth5-0676">https://doi.org/10.17189/vth5-0676</a>; RIMFAX Instrument bundle, <a href="https://doi.org/10.17189/1522644">https://doi.org/10.17189/1522644</a>; SHERLOC Instrument bundle, <a href="https://doi.org/10.17189/1522643">https://doi.org/10.17189/1522643</a>; SuperCam Instrument bundle, <a href="https://doi.org/10.17189/1522646">https://doi.org/10.17189/1522646</a>; Mastcam-Z Science Imaging bundle, <a href="https://doi.org/10.17189/q3ts-c749">https://doi.org/10.17189/q3ts-c749</a>; WATSON, ACI, and MCC imager bundle, <a href="https://doi.org/10.17189/1522846">https://doi.org/10.17189/1522846</a>.</p>
            </div></div><div id="code-availability-section" data-title="Code availability"><h2 id="code-availability">Code availability</h2><p>Quantification of PIXL XRF data was conducted using PIQUANT<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 65" title="Heirwegh, C. M., Elam, W. T., O’Neil, L. P., Sinclair, K. P. &amp; Das, A. The focused beam X-ray fluorescence elemental quantification software package PIQUANT. Spectrochim. Acta Part B 196, 106520 (2022)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR65" id="ref-link-section-d33770877e4203">65</a></sup>, a fundamental parameters XRF analysis software package developed for PIXL<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 57" title="Allwood, A. C. et al. PIXL: Planetary Instrument for X-ray Lithochemistry. Space Sci. Rev. 216, 134 (2020)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR57" id="ref-link-section-d33770877e4207">57</a></sup>. PIQUANT is embedded in the data visualization software package called PIXLISE<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 57" title="Allwood, A. C. et al. PIXL: Planetary Instrument for X-ray Lithochemistry. Space Sci. Rev. 216, 134 (2020)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR57" id="ref-link-section-d33770877e4211">57</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 70" title="Wright, A. P., Nemere, P., Galvin, A., Chau, D. H. &amp; Davidoff, S. Lessons from the development of an anomaly detection interface on the Mars Perseverance Rover using the ISHMAP framework. In Proc. 28th International Conference on Intelligent User Interfaces 91–105 (Association for Computing Machinery, 2023)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR70" id="ref-link-section-d33770877e4214">70</a>,<a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 71" title="Schurman, D. et al. PIXELATE: novel visualization and computational methods for the analysis of astrobiological spectroscopy data. In AbSciCon 2019, 401-8 (American Geophysical Union, 2019)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR71" id="ref-link-section-d33770877e4217">71</a></sup>, which was used for analysis of quantified PIXL XRF data. The PIXLISE and PIQUANT software packages can be accessed at PIXLISE.org. PIXLISE source code versions are archived for reproducibility at OFS.io<sup><a data-track="click" data-track-action="reference anchor" data-track-label="link" data-test="citation-ref" aria-label="Reference 72" title="Davidoff, S. et al. PIXLISE spectroscopy analysis software: released versions for published analyses. OSF 
                  https://doi.org/10.17605/OSF.IO/URE2F
                  
                 (2024)." href="https://www.nature.com/articles/s41586-025-09413-0#ref-CR72" id="ref-link-section-d33770877e4221">72</a></sup>.</p></div><div id="MagazineFulltextArticleBodySuffix" aria-labelledby="Bib1" data-title="References"><h2 id="Bib1">References</h2><div data-container-section="references" id="Bib1-content"><ol data-track-component="outbound reference" data-track-context="references section"><li data-counter="1."><p id="ref-CR1">Farley, K. A. et al. Mars 2020 mission overview. <i>Space Sci. Rev.</i> <a href="https://doi.org/10.1007/s11214-020-00762-y" data-track="click_references" data-track-action="external reference" data-track-value="external reference" data-track-label="10.1007/s11214-020-00762-y">https://doi.org/10.1007/s11214-020-00762-y</a> (2020).</p></li><li data-counter="2."><p id="ref-CR2">Farley, K. A. et al. Aqueously altered igneous rocks sampled on the floor of Jezero Crater, Mars. <i>Science</i> <b>377</b>, eabo2196 (2022).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1126/science.abo2196" data-track-item_id="10.1126/science.abo2196" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1126%2Fscience.abo2196" aria-label="Article reference 2" data-doi="10.1126/science.abo2196">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2022Sci...377.2196F" aria-label="ADS reference 2">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BB38XisFOru7%2FI" aria-label="CAS reference 2">CAS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="pubmed reference" data-track-action="pubmed reference" href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&amp;db=PubMed&amp;dopt=Abstract&amp;list_uids=36007009" aria-label="PubMed reference 2">PubMed</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 2" href="http://scholar.google.com/scholar_lookup?&amp;title=Aqueously%20altered%20igneous%20rocks%20sampled%20on%20the%20floor%20of%20Jezero%20Crater%2C%20Mars&amp;journal=Science&amp;doi=10.1126%2Fscience.abo2196&amp;volume=377&amp;publication_year=2022&amp;author=Farley%2CKA">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="3."><p id="ref-CR3">Simon, J. I. et al. Samples collected from the floor of Jezero Crater with the Mars 2020 Perseverance rover. <i>J. Geophys. Res. Planets</i> <a href="https://doi.org/10.1029/2022JE007474" data-track="click_references" data-track-action="external reference" data-track-value="external reference" data-track-label="10.1029/2022JE007474">https://doi.org/10.1029/2022JE007474</a> (2023).</p></li><li data-counter="4."><p id="ref-CR4">Mangold, N. et al. Perseverance rover reveals an ancient delta-lake system and flood deposits at Jezero Crater, Mars. <i>Science</i> <b>374</b>, 711–717 (2021).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1126/science.abl4051" data-track-item_id="10.1126/science.abl4051" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1126%2Fscience.abl4051" aria-label="Article reference 4" data-doi="10.1126/science.abl4051">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2021Sci...374..711M" aria-label="ADS reference 4">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BB3MXisFalsb3F" aria-label="CAS reference 4">CAS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="pubmed reference" data-track-action="pubmed reference" href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&amp;db=PubMed&amp;dopt=Abstract&amp;list_uids=34618548" aria-label="PubMed reference 4">PubMed</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 4" href="http://scholar.google.com/scholar_lookup?&amp;title=Perseverance%20rover%20reveals%20an%20ancient%20delta-lake%20system%20and%20flood%20deposits%20at%20Jezero%20Crater%2C%20Mars&amp;journal=Science&amp;doi=10.1126%2Fscience.abl4051&amp;volume=374&amp;pages=711-717&amp;publication_year=2021&amp;author=Mangold%2CN">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="5."><p id="ref-CR5">Stack, K. M. et al. Sedimentology and stratigraphy of the Shenandoah Formation, Western Fan, Jezero Crater, Mars. J. Geophys. Res. Planets <a href="https://doi.org/10.1029/2023JE008187" data-track="click_references" data-track-action="external reference" data-track-value="external reference" data-track-label="10.1029/2023JE008187">https://doi.org/10.1029/2023JE008187</a> (2024).</p></li><li data-counter="6."><p id="ref-CR6">Bosak, T. et al. Astrobiological potential of rocks acquired by the Perseverance rover at a sedimentary fan front in Jezero Crater, Mars. <i>AGU Adv.</i> <a href="https://doi.org/10.1029/2024AV001241" data-track="click_references" data-track-action="external reference" data-track-value="external reference" data-track-label="10.1029/2024AV001241">https://doi.org/10.1029/2024AV001241</a> (2024).</p></li><li data-counter="7."><p id="ref-CR7">Horgan, B. H. N., Anderson, R. B., Dromart, G., Amador, E. S. &amp; Rice, M. S. The mineral diversity of Jezero Crater: evidence for possible lacustrine carbonates on Mars. <i>Icarus</i> <a href="https://doi.org/10.1016/j.icarus.2019.113526" data-track="click_references" data-track-action="external reference" data-track-value="external reference" data-track-label="10.1016/j.icarus.2019.113526">https://doi.org/10.1016/j.icarus.2019.113526</a> (2020).</p></li><li data-counter="8."><p id="ref-CR8">Goudge, T. A., Mustard, J. F., Head, J. W., Fassett, C. I. &amp; Wiseman, S. M. Assessing the mineralogy of the watershed and fan deposits of the Jezero Crater paleolake system, Mars. <i>J. Geophys. Res. Planets</i> <b>120</b>, 775–808 (2015).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1002/2014JE004782" data-track-item_id="10.1002/2014JE004782" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1002%2F2014JE004782" aria-label="Article reference 8" data-doi="10.1002/2014JE004782">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2015JGRE..120..775G" aria-label="ADS reference 8">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BC2MXotlKmtrc%3D" aria-label="CAS reference 8">CAS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 8" href="http://scholar.google.com/scholar_lookup?&amp;title=Assessing%20the%20mineralogy%20of%20the%20watershed%20and%20fan%20deposits%20of%20the%20Jezero%20Crater%20paleolake%20system%2C%20Mars&amp;journal=J.%20Geophys.%20Res.%20Planets&amp;doi=10.1002%2F2014JE004782&amp;volume=120&amp;pages=775-808&amp;publication_year=2015&amp;author=Goudge%2CTA&amp;author=Mustard%2CJF&amp;author=Head%2CJW&amp;author=Fassett%2CCI&amp;author=Wiseman%2CSM">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="9."><p id="ref-CR9">Steele, A. et al. Comprehensive imaging and Raman spectroscopy of carbonate globules from Martian meteorite ALH 84001 and a terrestrial analogue from Svalbard. <i>Meteorit. Planet. Sci.</i> <b>42</b>, 1549–1566 (2007).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1111/j.1945-5100.2007.tb00590.x" data-track-item_id="10.1111/j.1945-5100.2007.tb00590.x" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1111%2Fj.1945-5100.2007.tb00590.x" aria-label="Article reference 9" data-doi="10.1111/j.1945-5100.2007.tb00590.x">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2007M%26PS...42.1549S" aria-label="ADS reference 9">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BD2sXhsVOrtr7M" aria-label="CAS reference 9">CAS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 9" href="http://scholar.google.com/scholar_lookup?&amp;title=Comprehensive%20imaging%20and%20Raman%20spectroscopy%20of%20carbonate%20globules%20from%20Martian%20meteorite%20ALH%2084001%20and%20a%20terrestrial%20analogue%20from%20Svalbard&amp;journal=Meteorit.%20Planet.%20Sci.&amp;doi=10.1111%2Fj.1945-5100.2007.tb00590.x&amp;volume=42&amp;pages=1549-1566&amp;publication_year=2007&amp;author=Steele%2CA">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="10."><p id="ref-CR10">Steele, A. et al. Macromolecular carbon in Martian basalts. <i>Meteorit. Planet. Sci.</i> <b>47</b>, A357–A357 (2012).</p><p><a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 10" href="http://scholar.google.com/scholar_lookup?&amp;title=Macromolecular%20carbon%20in%20Martian%20basalts&amp;journal=Meteorit.%20Planet.%20Sci.&amp;volume=47&amp;pages=A357-A357&amp;publication_year=2012&amp;author=Steele%2CA">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="11."><p id="ref-CR11">Bhartia, R. et al. Perseverance’s Scanning Habitable Environments with Raman and Luminescence for Organics and Chemicals (SHERLOC) investigation. <i>Space Sci. Rev.</i> <b>217</b>, 58 (2021).</p><p><a data-track="click_references" rel="noopener" data-track-label="10.1007/s11214-021-00812-z" data-track-item_id="10.1007/s11214-021-00812-z" data-track-value="article reference" data-track-action="article reference" href="https://link.springer.com/doi/10.1007/s11214-021-00812-z" aria-label="Article reference 11" data-doi="10.1007/s11214-021-00812-z">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2021SSRv..217...58B" aria-label="ADS reference 11">ADS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 11" href="http://scholar.google.com/scholar_lookup?&amp;title=Perseverance%E2%80%99s%20Scanning%20Habitable%20Environments%20with%20Raman%20and%20Luminescence%20for%20Organics%20and%20Chemicals%20%28SHERLOC%29%20investigation&amp;journal=Space%20Sci.%20Rev.&amp;doi=10.1007%2Fs11214-021-00812-z&amp;volume=217&amp;publication_year=2021&amp;author=Bhartia%2CR">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="12."><p id="ref-CR12">Scheller, E. L. et al. Inorganic interpretation of luminescent materials encountered by the Perseverance rover on Mars. <i>Sci. Adv.</i> <b>10</b>, eadm8241 (2024).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1126/sciadv.adm8241" data-track-item_id="10.1126/sciadv.adm8241" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1126%2Fsciadv.adm8241" aria-label="Article reference 12" data-doi="10.1126/sciadv.adm8241">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BB2cXisVentr%2FL" aria-label="CAS reference 12">CAS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="pubmed reference" data-track-action="pubmed reference" href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&amp;db=PubMed&amp;dopt=Abstract&amp;list_uids=39321302" aria-label="PubMed reference 12">PubMed</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="pubmed central reference" data-track-action="pubmed central reference" href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC11423895" aria-label="PubMed Central reference 12">PubMed Central</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 12" href="http://scholar.google.com/scholar_lookup?&amp;title=Inorganic%20interpretation%20of%20luminescent%20materials%20encountered%20by%20the%20Perseverance%20rover%20on%20Mars&amp;journal=Sci.%20Adv.&amp;doi=10.1126%2Fsciadv.adm8241&amp;volume=10&amp;publication_year=2024&amp;author=Scheller%2CEL">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="13."><p id="ref-CR13">Jones, M. W. M. et al. In situ crystallographic mapping constrains sulfate precipitation and timing in Jezero Crater, Mars. <i>Sci. Adv.</i> <b>11</b>, eadt3048 (2025).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1126/sciadv.adt3048" data-track-item_id="10.1126/sciadv.adt3048" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1126%2Fsciadv.adt3048" aria-label="Article reference 13" data-doi="10.1126/sciadv.adt3048">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BB2MXpvVWkur4%3D" aria-label="CAS reference 13">CAS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="pubmed reference" data-track-action="pubmed reference" href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&amp;db=PubMed&amp;dopt=Abstract&amp;list_uids=40238880" aria-label="PubMed reference 13">PubMed</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="pubmed central reference" data-track-action="pubmed central reference" href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC12002120" aria-label="PubMed Central reference 13">PubMed Central</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 13" href="http://scholar.google.com/scholar_lookup?&amp;title=In%20situ%20crystallographic%20mapping%20constrains%20sulfate%20precipitation%20and%20timing%20in%20Jezero%20Crater%2C%20Mars&amp;journal=Sci.%20Adv.&amp;doi=10.1126%2Fsciadv.adt3048&amp;volume=11&amp;publication_year=2025&amp;author=Jones%2CMWM">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="14."><p id="ref-CR14">Orenstein, B. J. et al. In-situ mapping of monocrystalline regions on Mars. <i>Icarus</i> <b>420</b>, 116202 (2024).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1016/j.icarus.2024.116202" data-track-item_id="10.1016/j.icarus.2024.116202" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1016%2Fj.icarus.2024.116202" aria-label="Article reference 14" data-doi="10.1016/j.icarus.2024.116202">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BB2cXhsFClsbnK" aria-label="CAS reference 14">CAS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 14" href="http://scholar.google.com/scholar_lookup?&amp;title=In-situ%20mapping%20of%20monocrystalline%20regions%20on%20Mars&amp;journal=Icarus&amp;doi=10.1016%2Fj.icarus.2024.116202&amp;volume=420&amp;publication_year=2024&amp;author=Orenstein%2CBJ">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="15."><p id="ref-CR15">Tice, M. M. et al. Alteration history of Seitah Formation rocks inferred by PIXL X-ray fluorescence, X-ray diffraction, and multispectral imaging on Mars. <i>Sci. Adv.</i> <b>8</b>, eabp9084 (2022).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1126/sciadv.abp9084" data-track-item_id="10.1126/sciadv.abp9084" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1126%2Fsciadv.abp9084" aria-label="Article reference 15" data-doi="10.1126/sciadv.abp9084">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BB38XjtFKqsrbE" aria-label="CAS reference 15">CAS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="pubmed reference" data-track-action="pubmed reference" href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&amp;db=PubMed&amp;dopt=Abstract&amp;list_uids=36417516" aria-label="PubMed reference 15">PubMed</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="pubmed central reference" data-track-action="pubmed central reference" href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC9683721" aria-label="PubMed Central reference 15">PubMed Central</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 15" href="http://scholar.google.com/scholar_lookup?&amp;title=Alteration%20history%20of%20Seitah%20Formation%20rocks%20inferred%20by%20PIXL%20X-ray%20fluorescence%2C%20X-ray%20diffraction%2C%20and%20multispectral%20imaging%20on%20Mars&amp;journal=Sci.%20Adv.&amp;doi=10.1126%2Fsciadv.abp9084&amp;volume=8&amp;publication_year=2022&amp;author=Tice%2CMM">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="16."><p id="ref-CR16">Vaniman, D. T. et al. Gypsum, bassanite, and anhydrite at Gale Crater, Mars. <i>Am. Mineral.</i> <b>103</b>, 1011–1020 (2018).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.2138/am-2018-6346" data-track-item_id="10.2138/am-2018-6346" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.2138%2Fam-2018-6346" aria-label="Article reference 16" data-doi="10.2138/am-2018-6346">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2018AmMin.103.1011V" aria-label="ADS reference 16">ADS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 16" href="http://scholar.google.com/scholar_lookup?&amp;title=Gypsum%2C%20bassanite%2C%20and%20anhydrite%20at%20Gale%20Crater%2C%20Mars&amp;journal=Am.%20Mineral.&amp;doi=10.2138%2Fam-2018-6346&amp;volume=103&amp;pages=1011-1020&amp;publication_year=2018&amp;author=Vaniman%2CDT">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="17."><p id="ref-CR17">Hardie, L. A. Gypsum-anhydrite equilibrium at one atmosphere pressure. <i>Am. Mineral.</i> <b>52</b>, 171–17 (1967).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DyaF2sXks1yjurw%3D" aria-label="CAS reference 17">CAS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 17" href="http://scholar.google.com/scholar_lookup?&amp;title=Gypsum-anhydrite%20equilibrium%20at%20one%20atmosphere%20pressure&amp;journal=Am.%20Mineral.&amp;volume=52&amp;pages=171-17&amp;publication_year=1967&amp;author=Hardie%2CLA">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="18."><p id="ref-CR18">Babechuk, M. G., Widdowson, M. &amp; Kamber, B. S. Quantifying chemical weathering intensity and trace element release from two contrasting basalt profiles, Deccan Traps, India. <i>Chem. Geol.</i> <b>363</b>, 56–75 (2014).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1016/j.chemgeo.2013.10.027" data-track-item_id="10.1016/j.chemgeo.2013.10.027" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1016%2Fj.chemgeo.2013.10.027" aria-label="Article reference 18" data-doi="10.1016/j.chemgeo.2013.10.027">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2014ChGeo.363...56B" aria-label="ADS reference 18">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BC2cXksFSgsg%3D%3D" aria-label="CAS reference 18">CAS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 18" href="http://scholar.google.com/scholar_lookup?&amp;title=Quantifying%20chemical%20weathering%20intensity%20and%20trace%20element%20release%20from%20two%20contrasting%20basalt%20profiles%2C%20Deccan%20Traps%2C%20India&amp;journal=Chem.%20Geol.&amp;doi=10.1016%2Fj.chemgeo.2013.10.027&amp;volume=363&amp;pages=56-75&amp;publication_year=2014&amp;author=Babechuk%2CMG&amp;author=Widdowson%2CM&amp;author=Kamber%2CBS">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="19."><p id="ref-CR19">Burns, R. G. &amp; Fisher, D. S. Iron–sulfur mineralogy of Mars—magmatic evolution and chemical-weathering products. <i>J. Geophys. Res. Solid Earth</i> <b>95</b>, 14415–14421 (1990).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1029/JB095iB09p14415" data-track-item_id="10.1029/JB095iB09p14415" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1029%2FJB095iB09p14415" aria-label="Article reference 19" data-doi="10.1029/JB095iB09p14415">Article</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 19" href="http://scholar.google.com/scholar_lookup?&amp;title=Iron%E2%80%93sulfur%20mineralogy%20of%20Mars%E2%80%94magmatic%20evolution%20and%20chemical-weathering%20products&amp;journal=J.%20Geophys.%20Res.%20Solid%20Earth&amp;doi=10.1029%2FJB095iB09p14415&amp;volume=95&amp;pages=14415-14421&amp;publication_year=1990&amp;author=Burns%2CRG&amp;author=Fisher%2CDS">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="20."><p id="ref-CR20">Henneke, J. et al. A radiometric correction method and performance characteristics for PIXL’s multispectral analysis using LEDs. <i>Space Sci. Rev.</i> <a href="https://doi.org/10.1007/s11214-023-01014-5" data-track="click_references" data-track-action="external reference" data-track-value="external reference" data-track-label="10.1007/s11214-023-01014-5">https://doi.org/10.1007/s11214-023-01014-5</a> (2023).</p></li><li data-counter="21."><p id="ref-CR21">Rampe, E. B., Morris, R. V., Archer, P. D., Agresti, D. G. &amp; Ming, D. W. Recognizing sulfate and phosphate complexes chemisorbed onto nanophase weathering products on Mars using in-situ and remote observations. <i>Am. Mineral.</i> <b>101</b>, 678–689 (2016).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.2138/am-2016-5408CCBYNCND" data-track-item_id="10.2138/am-2016-5408CCBYNCND" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.2138%2Fam-2016-5408CCBYNCND" aria-label="Article reference 21" data-doi="10.2138/am-2016-5408CCBYNCND">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2016AmMin.101..678R" aria-label="ADS reference 21">ADS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 21" href="http://scholar.google.com/scholar_lookup?&amp;title=Recognizing%20sulfate%20and%20phosphate%20complexes%20chemisorbed%20onto%20nanophase%20weathering%20products%20on%20Mars%20using%20in-situ%20and%20remote%20observations&amp;journal=Am.%20Mineral.&amp;doi=10.2138%2Fam-2016-5408CCBYNCND&amp;volume=101&amp;pages=678-689&amp;publication_year=2016&amp;author=Rampe%2CEB&amp;author=Morris%2CRV&amp;author=Archer%2CPD&amp;author=Agresti%2CDG&amp;author=Ming%2CDW">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="22."><p id="ref-CR22">Roncal-Herrero, T., Rodríguez-Blanco, J. D., Benning, L. G. &amp; Oelkers, E. H. Precipitation of iron and aluminum phosphates directly from aqueous solution as a function of temperature from 50 to 200 °C. <i>Crys. Growth Des.</i> <b>9</b>, 5197–5205 (2009).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1021/cg900654m" data-track-item_id="10.1021/cg900654m" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1021%2Fcg900654m" aria-label="Article reference 22" data-doi="10.1021/cg900654m">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BD1MXhtleksLbF" aria-label="CAS reference 22">CAS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 22" href="http://scholar.google.com/scholar_lookup?&amp;title=Precipitation%20of%20iron%20and%20aluminum%20phosphates%20directly%20from%20aqueous%20solution%20as%20a%20function%20of%20temperature%20from%2050%20to%20200%E2%80%89%C2%B0C&amp;journal=Crys.%20Growth%20Des.&amp;doi=10.1021%2Fcg900654m&amp;volume=9&amp;pages=5197-5205&amp;publication_year=2009&amp;author=Roncal-Herrero%2CT&amp;author=Rodr%C3%ADguez-Blanco%2CJD&amp;author=Benning%2CLG&amp;author=Oelkers%2CEH">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="23."><p id="ref-CR23">Nriagu, J. &amp; Dell, C. Diagenetic formation of iron phosphates in recent lake sediments. <i>Am. Mineral.</i> <b>59</b>, 934–946 (1974).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DyaE2MXhvFeqsA%3D%3D" aria-label="CAS reference 23">CAS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 23" href="http://scholar.google.com/scholar_lookup?&amp;title=Diagenetic%20formation%20of%20iron%20phosphates%20in%20recent%20lake%20sediments&amp;journal=Am.%20Mineral.&amp;volume=59&amp;pages=934-946&amp;publication_year=1974&amp;author=Nriagu%2CJ&amp;author=Dell%2CC">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="24."><p id="ref-CR24">Treiman, A. H. et al. Manganese–iron phosphate nodules at the Groken Site, Gale Crater, Mars. <i>Minerals</i> <a href="https://doi.org/10.3390/min13091122" data-track="click_references" data-track-action="external reference" data-track-value="external reference" data-track-label="10.3390/min13091122">https://doi.org/10.3390/min13091122</a> (2023).</p></li><li data-counter="25."><p id="ref-CR25">Hausrath, E. M. et al. Phosphates on Mars and their importance as igneous, aqueous, and astrobiological indicators. <i>Minerals</i> <a href="https://doi.org/10.3390/min14060591" data-track="click_references" data-track-action="external reference" data-track-value="external reference" data-track-label="10.3390/min14060591">https://doi.org/10.3390/min14060591</a> (2024).</p></li><li data-counter="26."><p id="ref-CR26">Kizovski, T. et al. Fe-phosphates in Jezero Crater as evidence for an ancient habitable environment on Mars. <i>Nat. Commun.</i> <b>16</b>, 6470 (2025).</p></li><li data-counter="27."><p id="ref-CR27">Miller, W. P., Zelazny, L. W. &amp; Martens, D. C. Dissolution of synthetic crystalline and noncrystalline iron oxides by organic acids. <i>Geoderma</i> <b>37</b>, 1–13 (1986).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1016/0016-7061(86)90039-X" data-track-item_id="10.1016/0016-7061(86)90039-X" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1016%2F0016-7061%2886%2990039-X" aria-label="Article reference 27" data-doi="10.1016/0016-7061(86)90039-X">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=1986Geode..37....1M" aria-label="ADS reference 27">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DyaL28XhslWqsr0%3D" aria-label="CAS reference 27">CAS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 27" href="http://scholar.google.com/scholar_lookup?&amp;title=Dissolution%20of%20synthetic%20crystalline%20and%20noncrystalline%20iron%20oxides%20by%20organic%20acids&amp;journal=Geoderma&amp;doi=10.1016%2F0016-7061%2886%2990039-X&amp;volume=37&amp;pages=1-13&amp;publication_year=1986&amp;author=Miller%2CWP&amp;author=Zelazny%2CLW&amp;author=Martens%2CDC">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="28."><p id="ref-CR28">Torres, R., Blesa, M. A. &amp; Matijević, E. Interactions of metal hydrous oxides with chelating agents: IX. Reductive dissolution of hermatite and magnetite by aminocarboxylic acids. <i>J. Colloid Interface Sci.</i> <b>134</b>, 475–485 (1990).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1016/0021-9797(90)90157-J" data-track-item_id="10.1016/0021-9797(90)90157-J" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1016%2F0021-9797%2890%2990157-J" aria-label="Article reference 28" data-doi="10.1016/0021-9797(90)90157-J">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=1990JCIS..134..475T" aria-label="ADS reference 28">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DyaK3cXhsVKnsL4%3D" aria-label="CAS reference 28">CAS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 28" href="http://scholar.google.com/scholar_lookup?&amp;title=Interactions%20of%20metal%20hydrous%20oxides%20with%20chelating%20agents%3A%20IX.%20Reductive%20dissolution%20of%20hermatite%20and%20magnetite%20by%20aminocarboxylic%20acids&amp;journal=J.%20Colloid%20Interface%20Sci.&amp;doi=10.1016%2F0021-9797%2890%2990157-J&amp;volume=134&amp;pages=475-485&amp;publication_year=1990&amp;author=Torres%2CR&amp;author=Blesa%2CMA&amp;author=Matijevi%C4%87%2CE">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="29."><p id="ref-CR29">Ionescu, D., Heim, C., Polerecky, L., Thiel, V. &amp; De Beer, D. Biotic and abiotic oxidation and reduction of iron at circumneutral pH are inseparable processes under natural conditions. <i>Geomicrobiol. J.</i> <b>32</b>, 221–230 (2015).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1080/01490451.2014.887393" data-track-item_id="10.1080/01490451.2014.887393" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1080%2F01490451.2014.887393" aria-label="Article reference 29" data-doi="10.1080/01490451.2014.887393">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BC2MXmsVeksL0%3D" aria-label="CAS reference 29">CAS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 29" href="http://scholar.google.com/scholar_lookup?&amp;title=Biotic%20and%20abiotic%20oxidation%20and%20reduction%20of%20iron%20at%20circumneutral%20pH%20are%20inseparable%20processes%20under%20natural%20conditions&amp;journal=Geomicrobiol.%20J.&amp;doi=10.1080%2F01490451.2014.887393&amp;volume=32&amp;pages=221-230&amp;publication_year=2015&amp;author=Ionescu%2CD&amp;author=Heim%2CC&amp;author=Polerecky%2CL&amp;author=Thiel%2CV&amp;author=Beer%2CD">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="30."><p id="ref-CR30">Eigenbrode, J. L. et al. Organic matter preserved in 3-billion-year-old mudstones at Gale Crater, Mars. <i>Science</i> <b>360</b>, 1096–1101 (2018).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1126/science.aas9185" data-track-item_id="10.1126/science.aas9185" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1126%2Fscience.aas9185" aria-label="Article reference 30" data-doi="10.1126/science.aas9185">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2018Sci...360.1096E" aria-label="ADS reference 30">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BC1cXhtV2mt7vK" aria-label="CAS reference 30">CAS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="pubmed reference" data-track-action="pubmed reference" href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&amp;db=PubMed&amp;dopt=Abstract&amp;list_uids=29880683" aria-label="PubMed reference 30">PubMed</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 30" href="http://scholar.google.com/scholar_lookup?&amp;title=Organic%20matter%20preserved%20in%203-billion-year-old%20mudstones%20at%20Gale%20Crater%2C%20Mars&amp;journal=Science&amp;doi=10.1126%2Fscience.aas9185&amp;volume=360&amp;pages=1096-1101&amp;publication_year=2018&amp;author=Eigenbrode%2CJL">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="31."><p id="ref-CR31">Steele, A. et al. Organic synthesis associated with serpentinization and carbonation on early Mars. <i>Science</i> <b>375</b>, 172–177 (2022).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1126/science.abg7905" data-track-item_id="10.1126/science.abg7905" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1126%2Fscience.abg7905" aria-label="Article reference 31" data-doi="10.1126/science.abg7905">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2022Sci...375..172S" aria-label="ADS reference 31">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BB38XhvV2lsbw%3D" aria-label="CAS reference 31">CAS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="pubmed reference" data-track-action="pubmed reference" href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&amp;db=PubMed&amp;dopt=Abstract&amp;list_uids=35025630" aria-label="PubMed reference 31">PubMed</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 31" href="http://scholar.google.com/scholar_lookup?&amp;title=Organic%20synthesis%20associated%20with%20serpentinization%20and%20carbonation%20on%20early%20Mars&amp;journal=Science&amp;doi=10.1126%2Fscience.abg7905&amp;volume=375&amp;pages=172-177&amp;publication_year=2022&amp;author=Steele%2CA">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="32."><p id="ref-CR32">Flynn, G. J., Nittler, L. R. &amp; Engrand, C. Composition of cosmic dust: sources and implications for the early Solar System. <i>Elements</i> <b>12</b>, 177–183 (2016).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.2113/gselements.12.3.177" data-track-item_id="10.2113/gselements.12.3.177" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.2113%2Fgselements.12.3.177" aria-label="Article reference 32" data-doi="10.2113/gselements.12.3.177">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2016Eleme..12..177F" aria-label="ADS reference 32">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BC1cXkt1yjsbY%3D" aria-label="CAS reference 32">CAS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 32" href="http://scholar.google.com/scholar_lookup?&amp;title=Composition%20of%20cosmic%20dust%3A%20sources%20and%20implications%20for%20the%20early%20Solar%20System&amp;journal=Elements&amp;doi=10.2113%2Fgselements.12.3.177&amp;volume=12&amp;pages=177-183&amp;publication_year=2016&amp;author=Flynn%2CGJ&amp;author=Nittler%2CLR&amp;author=Engrand%2CC">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="33."><p id="ref-CR33">Rimstidt, J. D. &amp; Vaughan, D. J. Pyrite oxidation: a state-of-the-art assessment of the reaction mechanism. <i>Geochim. Cosmochim. Acta</i> <b>67</b>, 873–880 (2003).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1016/S0016-7037(02)01165-1" data-track-item_id="10.1016/S0016-7037(02)01165-1" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1016%2FS0016-7037%2802%2901165-1" aria-label="Article reference 33" data-doi="10.1016/S0016-7037(02)01165-1">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2003GeCoA..67..873R" aria-label="ADS reference 33">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BD3sXht1Wgt7c%3D" aria-label="CAS reference 33">CAS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 33" href="http://scholar.google.com/scholar_lookup?&amp;title=Pyrite%20oxidation%3A%20a%20state-of-the-art%20assessment%20of%20the%20reaction%20mechanism&amp;journal=Geochim.%20Cosmochim.%20Acta&amp;doi=10.1016%2FS0016-7037%2802%2901165-1&amp;volume=67&amp;pages=873-880&amp;publication_year=2003&amp;author=Rimstidt%2CJD&amp;author=Vaughan%2CDJ">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="34."><p id="ref-CR34">Afonso, M. D. &amp; Stumm, W. Reductive dissolution of iron(III) (hydr)oxides by hydrogen-sulfide. <i>Langmuir</i> <b>8</b>, 1671–1675 (1992).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1021/la00042a030" data-track-item_id="10.1021/la00042a030" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1021%2Fla00042a030" aria-label="Article reference 34" data-doi="10.1021/la00042a030">Article</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 34" href="http://scholar.google.com/scholar_lookup?&amp;title=Reductive%20dissolution%20of%20iron%28III%29%20%28hydr%29oxides%20by%20hydrogen-sulfide&amp;journal=Langmuir&amp;doi=10.1021%2Fla00042a030&amp;volume=8&amp;pages=1671-1675&amp;publication_year=1992&amp;author=Afonso%2CMD&amp;author=Stumm%2CW">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="35."><p id="ref-CR35">Canfield, D. E., Raiswell, R. &amp; Bottrell, S. The reactivity of sedimentary iron minerals toward sulfide. <i>Am. J. Sci.</i> <b>292</b>, 659–683 (1992).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.2475/ajs.292.9.659" data-track-item_id="10.2475/ajs.292.9.659" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.2475%2Fajs.292.9.659" aria-label="Article reference 35" data-doi="10.2475/ajs.292.9.659">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=1992AmJS..292..659C" aria-label="ADS reference 35">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DyaK3sXkvF2qu7k%3D" aria-label="CAS reference 35">CAS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 35" href="http://scholar.google.com/scholar_lookup?&amp;title=The%20reactivity%20of%20sedimentary%20iron%20minerals%20toward%20sulfide&amp;journal=Am.%20J.%20Sci.&amp;doi=10.2475%2Fajs.292.9.659&amp;volume=292&amp;pages=659-683&amp;publication_year=1992&amp;author=Canfield%2CDE&amp;author=Raiswell%2CR&amp;author=Bottrell%2CS">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="36."><p id="ref-CR36">Gaillard, F. &amp; Scaillet, B. The sulfur content of volcanic gases on Mars. <i>Earth Planet. Sci. Lett.</i> <b>279</b>, 34–43 (2009).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1016/j.epsl.2008.12.028" data-track-item_id="10.1016/j.epsl.2008.12.028" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1016%2Fj.epsl.2008.12.028" aria-label="Article reference 36" data-doi="10.1016/j.epsl.2008.12.028">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2009E%26PSL.279...34G" aria-label="ADS reference 36">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BD1MXitFKmsrg%3D" aria-label="CAS reference 36">CAS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 36" href="http://scholar.google.com/scholar_lookup?&amp;title=The%20sulfur%20content%20of%20volcanic%20gases%20on%20Mars&amp;journal=Earth%20Planet.%20Sci.%20Lett.&amp;doi=10.1016%2Fj.epsl.2008.12.028&amp;volume=279&amp;pages=34-43&amp;publication_year=2009&amp;author=Gaillard%2CF&amp;author=Scaillet%2CB">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="37."><p id="ref-CR37">Machel, H. G. Bacterial and thermochemical sulfate reduction in diagenetic settings—old and new insights. <i>Sediment. Geol.</i> <b>140</b>, 143–175 (2001).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1016/S0037-0738(00)00176-7" data-track-item_id="10.1016/S0037-0738(00)00176-7" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1016%2FS0037-0738%2800%2900176-7" aria-label="Article reference 37" data-doi="10.1016/S0037-0738(00)00176-7">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2001SedG..140..143M" aria-label="ADS reference 37">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BD3MXitF2lsbs%3D" aria-label="CAS reference 37">CAS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 37" href="http://scholar.google.com/scholar_lookup?&amp;title=Bacterial%20and%20thermochemical%20sulfate%20reduction%20in%20diagenetic%20settings%E2%80%94old%20and%20new%20insights&amp;journal=Sediment.%20Geol.&amp;doi=10.1016%2FS0037-0738%2800%2900176-7&amp;volume=140&amp;pages=143-175&amp;publication_year=2001&amp;author=Machel%2CHG">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="38."><p id="ref-CR38">Rickard, D. &amp; Luther, G. W. Chemistry of iron sulfides. <i>Chem. Rev.</i> <b>107</b>, 514–562 (2007).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1021/cr0503658" data-track-item_id="10.1021/cr0503658" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1021%2Fcr0503658" aria-label="Article reference 38" data-doi="10.1021/cr0503658">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BD2sXhtVOmtr8%3D" aria-label="CAS reference 38">CAS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="pubmed reference" data-track-action="pubmed reference" href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&amp;db=PubMed&amp;dopt=Abstract&amp;list_uids=17261073" aria-label="PubMed reference 38">PubMed</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 38" href="http://scholar.google.com/scholar_lookup?&amp;title=Chemistry%20of%20iron%20sulfides&amp;journal=Chem.%20Rev.&amp;doi=10.1021%2Fcr0503658&amp;volume=107&amp;pages=514-562&amp;publication_year=2007&amp;author=Rickard%2CD&amp;author=Luther%2CGW">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="39."><p id="ref-CR39">McSween, H. Y. Jr., Labotka, T. C. &amp; Viviano-Beck, C. E. Metamorphism in the Martian crust. <i>Meteorit. Planet. Sci.</i> <b>50</b>, 590–603 (2015).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1111/maps.12330" data-track-item_id="10.1111/maps.12330" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1111%2Fmaps.12330" aria-label="Article reference 39" data-doi="10.1111/maps.12330">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2015M%26PS...50..590M" aria-label="ADS reference 39">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BC2MXlslCqsbk%3D" aria-label="CAS reference 39">CAS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 39" href="http://scholar.google.com/scholar_lookup?&amp;title=Metamorphism%20in%20the%20Martian%20crust&amp;journal=Meteorit.%20Planet.%20Sci.&amp;doi=10.1111%2Fmaps.12330&amp;volume=50&amp;pages=590-603&amp;publication_year=2015&amp;author=McSween%2CHY&amp;author=Labotka%2CTC&amp;author=Viviano-Beck%2CCE">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="40."><p id="ref-CR40">Cosmidis, J. et al. Biomineralization of iron-phosphates in the water column of Lake Pavin (Massif Central, France). <i>Geochim. Cosmochim. Acta</i> <b>126</b>, 78–96 (2014).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1016/j.gca.2013.10.037" data-track-item_id="10.1016/j.gca.2013.10.037" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1016%2Fj.gca.2013.10.037" aria-label="Article reference 40" data-doi="10.1016/j.gca.2013.10.037">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2014GeCoA.126...78C" aria-label="ADS reference 40">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BC2cXps1yjtQ%3D%3D" aria-label="CAS reference 40">CAS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 40" href="http://scholar.google.com/scholar_lookup?&amp;title=Biomineralization%20of%20iron-phosphates%20in%20the%20water%20column%20of%20Lake%20Pavin%20%28Massif%20Central%2C%20France%29&amp;journal=Geochim.%20Cosmochim.%20Acta&amp;doi=10.1016%2Fj.gca.2013.10.037&amp;volume=126&amp;pages=78-96&amp;publication_year=2014&amp;author=Cosmidis%2CJ">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="41."><p id="ref-CR41">Vuillemin, A. et al. Vivianite formation in ferruginous sediments from Lake Towuti, Indonesia. <i>Biogeosciences</i> <b>17</b>, 1955–1973 (2020).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.5194/bg-17-1955-2020" data-track-item_id="10.5194/bg-17-1955-2020" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.5194%2Fbg-17-1955-2020" aria-label="Article reference 41" data-doi="10.5194/bg-17-1955-2020">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2020BGeo...17.1955V" aria-label="ADS reference 41">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BB3cXit1ynu7jI" aria-label="CAS reference 41">CAS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 41" href="http://scholar.google.com/scholar_lookup?&amp;title=Vivianite%20formation%20in%20ferruginous%20sediments%20from%20Lake%20Towuti%2C%20Indonesia&amp;journal=Biogeosciences&amp;doi=10.5194%2Fbg-17-1955-2020&amp;volume=17&amp;pages=1955-1973&amp;publication_year=2020&amp;author=Vuillemin%2CA">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="42."><p id="ref-CR42">Hsu, T. W., Jiang, W. T. &amp; Wang, Y. S. Authigenesis of vivianite as influenced by methane-induced sulfidization in cold-seep sediments off southwestern Taiwan. <i>J. Asian Earth Sci.</i> <b>89</b>, 88–97 (2014).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1016/j.jseaes.2014.03.027" data-track-item_id="10.1016/j.jseaes.2014.03.027" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1016%2Fj.jseaes.2014.03.027" aria-label="Article reference 42" data-doi="10.1016/j.jseaes.2014.03.027">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2014JAESc..89...88H" aria-label="ADS reference 42">ADS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 42" href="http://scholar.google.com/scholar_lookup?&amp;title=Authigenesis%20of%20vivianite%20as%20influenced%20by%20methane-induced%20sulfidization%20in%20cold-seep%20sediments%20off%20southwestern%20Taiwan&amp;journal=J.%20Asian%20Earth%20Sci.&amp;doi=10.1016%2Fj.jseaes.2014.03.027&amp;volume=89&amp;pages=88-97&amp;publication_year=2014&amp;author=Hsu%2CTW&amp;author=Jiang%2CWT&amp;author=Wang%2CYS">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="43."><p id="ref-CR43">Liu, J. R. et al. Vivianite formation in methane-rich deep-sea sediments from the South China Sea. <i>Biogeosciences</i> <b>15</b>, 6329–6348 (2018).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.5194/bg-15-6329-2018" data-track-item_id="10.5194/bg-15-6329-2018" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.5194%2Fbg-15-6329-2018" aria-label="Article reference 43" data-doi="10.5194/bg-15-6329-2018">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2018BGeo...15.6329L" aria-label="ADS reference 43">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BB3cXitFygtL4%3D" aria-label="CAS reference 43">CAS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 43" href="http://scholar.google.com/scholar_lookup?&amp;title=Vivianite%20formation%20in%20methane-rich%20deep-sea%20sediments%20from%20the%20South%20China%20Sea&amp;journal=Biogeosciences&amp;doi=10.5194%2Fbg-15-6329-2018&amp;volume=15&amp;pages=6329-6348&amp;publication_year=2018&amp;author=Liu%2CJR">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="44."><p id="ref-CR44">Rickard, D., Roberts, A. P. &amp; Navrotsky, A. Sedimentary greigite formation. <i>Am. J. Sci.</i> <a href="https://doi.org/10.2475/001c.121855" data-track="click_references" data-track-action="external reference" data-track-value="external reference" data-track-label="10.2475/001c.121855">https://doi.org/10.2475/001c.121855</a> (2024).</p></li><li data-counter="45."><p id="ref-CR45">Picard, A., Gartman, A., Clarke, D. R. &amp; Girguis, P. R. Sulfate-reducing bacteria influence the nucleation and growth of mackinawite and greigite. <i>Geochim. Cosmochim. Acta</i> <b>220</b>, 367–384 (2018).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1016/j.gca.2017.10.006" data-track-item_id="10.1016/j.gca.2017.10.006" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1016%2Fj.gca.2017.10.006" aria-label="Article reference 45" data-doi="10.1016/j.gca.2017.10.006">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2018GeCoA.220..367P" aria-label="ADS reference 45">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BC2sXhslShs7bO" aria-label="CAS reference 45">CAS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 45" href="http://scholar.google.com/scholar_lookup?&amp;title=Sulfate-reducing%20bacteria%20influence%20the%20nucleation%20and%20growth%20of%20mackinawite%20and%20greigite&amp;journal=Geochim.%20Cosmochim.%20Acta&amp;doi=10.1016%2Fj.gca.2017.10.006&amp;volume=220&amp;pages=367-384&amp;publication_year=2018&amp;author=Picard%2CA&amp;author=Gartman%2CA&amp;author=Clarke%2CDR&amp;author=Girguis%2CPR">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="46."><p id="ref-CR46">Xu, Z. Y. et al. Sulfidation-reoxidation enhances heavy metal immobilization by vivianite. <i>Water Res.</i> <b>263</b>, 122195 (2024).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1016/j.watres.2024.122195" data-track-item_id="10.1016/j.watres.2024.122195" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1016%2Fj.watres.2024.122195" aria-label="Article reference 46" data-doi="10.1016/j.watres.2024.122195">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BB2cXhslWhtbvO" aria-label="CAS reference 46">CAS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="pubmed reference" data-track-action="pubmed reference" href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&amp;db=PubMed&amp;dopt=Abstract&amp;list_uids=39116713" aria-label="PubMed reference 46">PubMed</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 46" href="http://scholar.google.com/scholar_lookup?&amp;title=Sulfidation-reoxidation%20enhances%20heavy%20metal%20immobilization%20by%20vivianite&amp;journal=Water%20Res.&amp;doi=10.1016%2Fj.watres.2024.122195&amp;volume=263&amp;publication_year=2024&amp;author=Xu%2CZY">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="47."><p id="ref-CR47">Craddock, P. R. &amp; Dauphas, N. Iron and carbon isotope evidence for microbial iron respiration throughout the Archean. <i>Earth Planet. Sci. Lett.</i> <b>303</b>, 121–132 (2011).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1016/j.epsl.2010.12.045" data-track-item_id="10.1016/j.epsl.2010.12.045" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1016%2Fj.epsl.2010.12.045" aria-label="Article reference 47" data-doi="10.1016/j.epsl.2010.12.045">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2011E%26PSL.303..121C" aria-label="ADS reference 47">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BC3MXisFags7w%3D" aria-label="CAS reference 47">CAS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 47" href="http://scholar.google.com/scholar_lookup?&amp;title=Iron%20and%20carbon%20isotope%20evidence%20for%20microbial%20iron%20respiration%20throughout%20the%20Archean&amp;journal=Earth%20Planet.%20Sci.%20Lett.&amp;doi=10.1016%2Fj.epsl.2010.12.045&amp;volume=303&amp;pages=121-132&amp;publication_year=2011&amp;author=Craddock%2CPR&amp;author=Dauphas%2CN">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="48."><p id="ref-CR48">Marin-Carbonne, J. et al. In situ Fe and S isotope analyses in pyrite from the 3.2 Ga Mendon Formation (Barberton Greenstone Belt, South Africa): evidence for early microbial iron reduction. <i>Geobiology</i> <b>18</b>, 306–325 (2020).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1111/gbi.12385" data-track-item_id="10.1111/gbi.12385" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1111%2Fgbi.12385" aria-label="Article reference 48" data-doi="10.1111/gbi.12385">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BB3cXnslKkt7g%3D" aria-label="CAS reference 48">CAS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="pubmed reference" data-track-action="pubmed reference" href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&amp;db=PubMed&amp;dopt=Abstract&amp;list_uids=32118348" aria-label="PubMed reference 48">PubMed</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="pubmed central reference" data-track-action="pubmed central reference" href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC7217181" aria-label="PubMed Central reference 48">PubMed Central</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 48" href="http://scholar.google.com/scholar_lookup?&amp;title=In%20situ%20Fe%20and%20S%20isotope%20analyses%20in%20pyrite%20from%20the%203.2%20Ga%20Mendon%20Formation%20%28Barberton%20Greenstone%20Belt%2C%20South%20Africa%29%3A%20evidence%20for%20early%20microbial%20iron%20reduction&amp;journal=Geobiology&amp;doi=10.1111%2Fgbi.12385&amp;volume=18&amp;pages=306-325&amp;publication_year=2020&amp;author=Marin-Carbonne%2CJ">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="49."><p id="ref-CR49">Banfield, J. F., Moreau, J. W., Chan, C. S., Welch, S. A. &amp; Little, B. Mineralogical biosignatures and the search for life on Mars. <i>Astrobiology</i> <b>1</b>, 447–465 (2001).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1089/153110701753593856" data-track-item_id="10.1089/153110701753593856" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1089%2F153110701753593856" aria-label="Article reference 49" data-doi="10.1089/153110701753593856">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2001AsBio...1..447B" aria-label="ADS reference 49">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BD38XjtFaks74%3D" aria-label="CAS reference 49">CAS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="pubmed reference" data-track-action="pubmed reference" href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&amp;db=PubMed&amp;dopt=Abstract&amp;list_uids=12448978" aria-label="PubMed reference 49">PubMed</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 49" href="http://scholar.google.com/scholar_lookup?&amp;title=Mineralogical%20biosignatures%20and%20the%20search%20for%20life%20on%20Mars&amp;journal=Astrobiology&amp;doi=10.1089%2F153110701753593856&amp;volume=1&amp;pages=447-465&amp;publication_year=2001&amp;author=Banfield%2CJF&amp;author=Moreau%2CJW&amp;author=Chan%2CCS&amp;author=Welch%2CSA&amp;author=Little%2CB">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="50."><p id="ref-CR50">Thomson, J., Higgs, N. C. &amp; Colley, S. A geochemical investigation of reduction haloes developed under turbidites in brown clay. <i>Mar. Geol.</i> <b>89</b>, 315–330 (1989).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1016/0025-3227(89)90083-2" data-track-item_id="10.1016/0025-3227(89)90083-2" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1016%2F0025-3227%2889%2990083-2" aria-label="Article reference 50" data-doi="10.1016/0025-3227(89)90083-2">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=1989MGeol..89..315T" aria-label="ADS reference 50">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DyaK3cXlvFGjur4%3D" aria-label="CAS reference 50">CAS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 50" href="http://scholar.google.com/scholar_lookup?&amp;title=A%20geochemical%20investigation%20of%20reduction%20haloes%20developed%20under%20turbidites%20in%20brown%20clay&amp;journal=Mar.%20Geol.&amp;doi=10.1016%2F0025-3227%2889%2990083-2&amp;volume=89&amp;pages=315-330&amp;publication_year=1989&amp;author=Thomson%2CJ&amp;author=Higgs%2CNC&amp;author=Colley%2CS">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="51."><p id="ref-CR51">Spinks, S. C., Parnell, J. &amp; Bowden, S. A. Reduction spots in the Mesoproterozoic age: implications for life in the early terrestrial record. <i>Int. J. Astrobiol.</i> <b>9</b>, 209–216 (2010).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1017/S1473550410000273" data-track-item_id="10.1017/S1473550410000273" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1017%2FS1473550410000273" aria-label="Article reference 51" data-doi="10.1017/S1473550410000273">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2010IJAsB...9..209S" aria-label="ADS reference 51">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BC3cXht1aktLnN" aria-label="CAS reference 51">CAS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 51" href="http://scholar.google.com/scholar_lookup?&amp;title=Reduction%20spots%20in%20the%20Mesoproterozoic%20age%3A%20implications%20for%20life%20in%20the%20early%20terrestrial%20record&amp;journal=Int.%20J.%20Astrobiol.&amp;doi=10.1017%2FS1473550410000273&amp;volume=9&amp;pages=209-216&amp;publication_year=2010&amp;author=Spinks%2CSC&amp;author=Parnell%2CJ&amp;author=Bowden%2CSA">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="52."><p id="ref-CR52">Kawahara, H. et al. Bleached-spot formation in Fe-oxide-rich rock by inorganic process. <i>Chem. Geol.</i> <b>609</b>, 121049 (2022).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1016/j.chemgeo.2022.121049" data-track-item_id="10.1016/j.chemgeo.2022.121049" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1016%2Fj.chemgeo.2022.121049" aria-label="Article reference 52" data-doi="10.1016/j.chemgeo.2022.121049">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BB38XitFSkurvE" aria-label="CAS reference 52">CAS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 52" href="http://scholar.google.com/scholar_lookup?&amp;title=Bleached-spot%20formation%20in%20Fe-oxide-rich%20rock%20by%20inorganic%20process&amp;journal=Chem.%20Geol.&amp;doi=10.1016%2Fj.chemgeo.2022.121049&amp;volume=609&amp;publication_year=2022&amp;author=Kawahara%2CH">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="53."><p id="ref-CR53">Des Marais, D. J. et al. The NASA astrobiology roadmap. <i>Astrobiology</i> <b>3</b>, 219–235 (2003).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1089/153110703769016299" data-track-item_id="10.1089/153110703769016299" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1089%2F153110703769016299" aria-label="Article reference 53" data-doi="10.1089/153110703769016299">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2003AsBio...3..219D" aria-label="ADS reference 53">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="pubmed reference" data-track-action="pubmed reference" href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&amp;db=PubMed&amp;dopt=Abstract&amp;list_uids=14577870" aria-label="PubMed reference 53">PubMed</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 53" href="http://scholar.google.com/scholar_lookup?&amp;title=The%20NASA%20astrobiology%20roadmap&amp;journal=Astrobiology&amp;doi=10.1089%2F153110703769016299&amp;volume=3&amp;pages=219-235&amp;publication_year=2003&amp;author=Des%20Marais%2CDJ">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="54."><p id="ref-CR54">Gillen, C., Jeancolas, C., McMahon, S. &amp; Vickers, P. The call for a new definition of biosignature. <i>Astrobiology</i> <b>23</b>, 1228–1237 (2023).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1089/ast.2023.0010" data-track-item_id="10.1089/ast.2023.0010" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1089%2Fast.2023.0010" aria-label="Article reference 54" data-doi="10.1089/ast.2023.0010">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2023AsBio..23.1228G" aria-label="ADS reference 54">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BB3sXisVSrtrfO" aria-label="CAS reference 54">CAS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="pubmed reference" data-track-action="pubmed reference" href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&amp;db=PubMed&amp;dopt=Abstract&amp;list_uids=37819715" aria-label="PubMed reference 54">PubMed</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 54" href="http://scholar.google.com/scholar_lookup?&amp;title=The%20call%20for%20a%20new%20definition%20of%20biosignature&amp;journal=Astrobiology&amp;doi=10.1089%2Fast.2023.0010&amp;volume=23&amp;pages=1228-1237&amp;publication_year=2023&amp;author=Gillen%2CC&amp;author=Jeancolas%2CC&amp;author=McMahon%2CS&amp;author=Vickers%2CP">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="55."><p id="ref-CR55">Mustard, J. F. et al. <i>Report of the Mars 2020 Science Definition Team</i> (Mars Exploration Program Analysis Group, 2013).</p></li><li data-counter="56."><p id="ref-CR56">Hamran, S.-E. et al. Radar Imager for Mars’ Subsurface Experiment—RIMFAX. <i>Space Sci. Rev.</i> <b>216</b>, 128 (2020).</p><p><a data-track="click_references" rel="noopener" data-track-label="10.1007/s11214-020-00740-4" data-track-item_id="10.1007/s11214-020-00740-4" data-track-value="article reference" data-track-action="article reference" href="https://link.springer.com/doi/10.1007/s11214-020-00740-4" aria-label="Article reference 56" data-doi="10.1007/s11214-020-00740-4">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2020SSRv..216..128H" aria-label="ADS reference 56">ADS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 56" href="http://scholar.google.com/scholar_lookup?&amp;title=Radar%20Imager%20for%20Mars%E2%80%99%20Subsurface%20Experiment%E2%80%94RIMFAX&amp;journal=Space%20Sci.%20Rev.&amp;doi=10.1007%2Fs11214-020-00740-4&amp;volume=216&amp;publication_year=2020&amp;author=Hamran%2CS-E">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="57."><p id="ref-CR57">Allwood, A. C. et al. PIXL: Planetary Instrument for X-ray Lithochemistry. <i>Space Sci. Rev.</i> <b>216</b>, 134 (2020).</p><p><a data-track="click_references" rel="noopener" data-track-label="10.1007/s11214-020-00767-7" data-track-item_id="10.1007/s11214-020-00767-7" data-track-value="article reference" data-track-action="article reference" href="https://link.springer.com/doi/10.1007/s11214-020-00767-7" aria-label="Article reference 57" data-doi="10.1007/s11214-020-00767-7">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2020SSRv..216..134A" aria-label="ADS reference 57">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BB3cXisVWjtLzO" aria-label="CAS reference 57">CAS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 57" href="http://scholar.google.com/scholar_lookup?&amp;title=PIXL%3A%20Planetary%20Instrument%20for%20X-ray%20Lithochemistry&amp;journal=Space%20Sci.%20Rev.&amp;doi=10.1007%2Fs11214-020-00767-7&amp;volume=216&amp;publication_year=2020&amp;author=Allwood%2CAC">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="58."><p id="ref-CR58">Maurice, S. et al. The SuperCam instrument suite on the Mars 2020 rover: science objectives and mast-unit description. <i>Space Sci. Rev.</i> <b>217</b>, 47 (2021).</p><p><a data-track="click_references" rel="noopener" data-track-label="10.1007/s11214-021-00807-w" data-track-item_id="10.1007/s11214-021-00807-w" data-track-value="article reference" data-track-action="article reference" href="https://link.springer.com/doi/10.1007/s11214-021-00807-w" aria-label="Article reference 58" data-doi="10.1007/s11214-021-00807-w">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2021SSRv..217...47M" aria-label="ADS reference 58">ADS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 58" href="http://scholar.google.com/scholar_lookup?&amp;title=The%20SuperCam%20instrument%20suite%20on%20the%20Mars%202020%20rover%3A%20science%20objectives%20and%20mast-unit%20description&amp;journal=Space%20Sci.%20Rev.&amp;doi=10.1007%2Fs11214-021-00807-w&amp;volume=217&amp;publication_year=2021&amp;author=Maurice%2CS">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="59."><p id="ref-CR59">Wiens, R. C. et al. The SuperCam instrument suite on the NASA Mars 2020 rover: body unit and combined system tests. <i>Space Sci. Rev.</i> <b>217</b>, 4 (2021).</p><p><a data-track="click_references" rel="noopener" data-track-label="10.1007/s11214-020-00777-5" data-track-item_id="10.1007/s11214-020-00777-5" data-track-value="article reference" data-track-action="article reference" href="https://link.springer.com/doi/10.1007/s11214-020-00777-5" aria-label="Article reference 59" data-doi="10.1007/s11214-020-00777-5">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2021SSRv..217....4W" aria-label="ADS reference 59">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="pubmed reference" data-track-action="pubmed reference" href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&amp;db=PubMed&amp;dopt=Abstract&amp;list_uids=33380752" aria-label="PubMed reference 59">PubMed</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 59" href="http://scholar.google.com/scholar_lookup?&amp;title=The%20SuperCam%20instrument%20suite%20on%20the%20NASA%20Mars%202020%20rover%3A%20body%20unit%20and%20combined%20system%20tests&amp;journal=Space%20Sci.%20Rev.&amp;doi=10.1007%2Fs11214-020-00777-5&amp;volume=217&amp;publication_year=2021&amp;author=Wiens%2CRC">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="60."><p id="ref-CR60">Bell, J. F. et al. The Mars 2020 Perseverance rover Mast Camera Zoom (Mastcam-Z) multispectral, stereoscopic imaging investigation. <i>Space Sci. Rev.</i> <b>217</b>, 24 (2021).</p><p><a data-track="click_references" rel="noopener" data-track-label="10.1007/s11214-020-00755-x" data-track-item_id="10.1007/s11214-020-00755-x" data-track-value="article reference" data-track-action="article reference" href="https://link.springer.com/doi/10.1007/s11214-020-00755-x" aria-label="Article reference 60" data-doi="10.1007/s11214-020-00755-x">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2021SSRv..217...24B" aria-label="ADS reference 60">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="pubmed reference" data-track-action="pubmed reference" href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&amp;db=PubMed&amp;dopt=Abstract&amp;list_uids=33612866" aria-label="PubMed reference 60">PubMed</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="pubmed central reference" data-track-action="pubmed central reference" href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC7883548" aria-label="PubMed Central reference 60">PubMed Central</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 60" href="http://scholar.google.com/scholar_lookup?&amp;title=The%20Mars%202020%20Perseverance%20rover%20Mast%20Camera%20Zoom%20%28Mastcam-Z%29%20multispectral%2C%20stereoscopic%20imaging%20investigation&amp;journal=Space%20Sci.%20Rev.&amp;doi=10.1007%2Fs11214-020-00755-x&amp;volume=217&amp;publication_year=2021&amp;author=Bell%2CJF">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="61."><p id="ref-CR61">Moeller, R. C. et al. The Sampling and Caching Subsystem (SCS) for the scientific exploration of Jezero Crater by the Mars 2020 Perseverance rover. <i>Space Sci. Rev.</i> <b>217</b>, 5 (2020).</p><p><a data-track="click_references" rel="noopener" data-track-label="10.1007/s11214-020-00783-7" data-track-item_id="10.1007/s11214-020-00783-7" data-track-value="article reference" data-track-action="article reference" href="https://link.springer.com/doi/10.1007/s11214-020-00783-7" aria-label="Article reference 61" data-doi="10.1007/s11214-020-00783-7">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2021SSRv..217....5M" aria-label="ADS reference 61">ADS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 61" href="http://scholar.google.com/scholar_lookup?&amp;title=The%20Sampling%20and%20Caching%20Subsystem%20%28SCS%29%20for%20the%20scientific%20exploration%20of%20Jezero%20Crater%20by%20the%20Mars%202020%20Perseverance%20rover&amp;journal=Space%20Sci.%20Rev.&amp;doi=10.1007%2Fs11214-020-00783-7&amp;volume=217&amp;publication_year=2020&amp;author=Moeller%2CRC">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="62."><p id="ref-CR62">Sharma, S. et al. Diverse organic-mineral associations in Jezero Crater, Mars. <i>Nature</i> <b>619</b>, 724–72 (2023).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1038/s41586-023-06143-z" data-track-item_id="10.1038/s41586-023-06143-z" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1038%2Fs41586-023-06143-z" aria-label="Article reference 62" data-doi="10.1038/s41586-023-06143-z">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2023Natur.619..724S" aria-label="ADS reference 62">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BB3sXhsVKju7zN" aria-label="CAS reference 62">CAS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="pubmed reference" data-track-action="pubmed reference" href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&amp;db=PubMed&amp;dopt=Abstract&amp;list_uids=37438522" aria-label="PubMed reference 62">PubMed</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="pubmed central reference" data-track-action="pubmed central reference" href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC10371864" aria-label="PubMed Central reference 62">PubMed Central</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 62" href="http://scholar.google.com/scholar_lookup?&amp;title=Diverse%20organic-mineral%20associations%20in%20Jezero%20Crater%2C%20Mars&amp;journal=Nature&amp;doi=10.1038%2Fs41586-023-06143-z&amp;volume=619&amp;pages=724-72&amp;publication_year=2023&amp;author=Sharma%2CS">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="63."><p id="ref-CR63">Osterhout, J. T., Schopf, J. W., Kudryavtsev, A. B., Czaja, A. D. &amp; Williford, K. H. Deep-UV Raman spectroscopy of carbonaceous Precambrian microfossils: insights into the search for past life on Mars. <i>Astrobiology</i> <b>22</b>, 1239–1254 (2022).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1089/ast.2021.0135" data-track-item_id="10.1089/ast.2021.0135" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1089%2Fast.2021.0135" aria-label="Article reference 63" data-doi="10.1089/ast.2021.0135">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2022AsBio..22.1239O" aria-label="ADS reference 63">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BB38XisFChu7bO" aria-label="CAS reference 63">CAS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="pubmed reference" data-track-action="pubmed reference" href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&amp;db=PubMed&amp;dopt=Abstract&amp;list_uids=36194869" aria-label="PubMed reference 63">PubMed</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 63" href="http://scholar.google.com/scholar_lookup?&amp;title=Deep-UV%20Raman%20spectroscopy%20of%20carbonaceous%20Precambrian%20microfossils%3A%20insights%20into%20the%20search%20for%20past%20life%20on%20Mars&amp;journal=Astrobiology&amp;doi=10.1089%2Fast.2021.0135&amp;volume=22&amp;pages=1239-1254&amp;publication_year=2022&amp;author=Osterhout%2CJT&amp;author=Schopf%2CJW&amp;author=Kudryavtsev%2CAB&amp;author=Czaja%2CAD&amp;author=Williford%2CKH">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="64."><p id="ref-CR64">Jakubek, R. S. et al. Spectral Background Calibration of Scanning Habitable Environments with Raman and Luminescence for Organics and Chemicals (SHERLOC) spectrometer onboard the rover enables identification of a ubiquitous Martian spectral component. <i>Appl. Spectrosc.</i> <a href="https://doi.org/10.1177/00037028241280081" data-track="click_references" data-track-action="external reference" data-track-value="external reference" data-track-label="10.1177/00037028241280081">https://doi.org/10.1177/00037028241280081</a> (2024).</p></li><li data-counter="65."><p id="ref-CR65">Heirwegh, C. M., Elam, W. T., O’Neil, L. P., Sinclair, K. P. &amp; Das, A. The focused beam X-ray fluorescence elemental quantification software package PIQUANT. <i>Spectrochim. Acta Part B</i> <b>196</b>, 106520 (2022).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1016/j.sab.2022.106520" data-track-item_id="10.1016/j.sab.2022.106520" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1016%2Fj.sab.2022.106520" aria-label="Article reference 65" data-doi="10.1016/j.sab.2022.106520">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BB38XitlersbfI" aria-label="CAS reference 65">CAS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 65" href="http://scholar.google.com/scholar_lookup?&amp;title=The%20focused%20beam%20X-ray%20fluorescence%20elemental%20quantification%20software%20package%20PIQUANT&amp;journal=Spectrochim.%20Acta%20Part%20B&amp;doi=10.1016%2Fj.sab.2022.106520&amp;volume=196&amp;publication_year=2022&amp;author=Heirwegh%2CCM&amp;author=Elam%2CWT&amp;author=O%E2%80%99Neil%2CLP&amp;author=Sinclair%2CKP&amp;author=Das%2CA">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="66."><p id="ref-CR66">Schmidt, M. E. et al. Diverse and highly differentiated lava suite in Jezero Crater, Mars: constraints on intracrustal magmatism revealed by Mars 2020 PIXL. <i>Sci. Adv.</i> <b>11</b>, eadr2613 (2025).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1126/sciadv.adr2613" data-track-item_id="10.1126/sciadv.adr2613" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1126%2Fsciadv.adr2613" aria-label="Article reference 66" data-doi="10.1126/sciadv.adr2613">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BB2MXivVGksL0%3D" aria-label="CAS reference 66">CAS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="pubmed reference" data-track-action="pubmed reference" href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&amp;db=PubMed&amp;dopt=Abstract&amp;list_uids=39854469" aria-label="PubMed reference 66">PubMed</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="pubmed central reference" data-track-action="pubmed central reference" href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC11778241" aria-label="PubMed Central reference 66">PubMed Central</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 66" href="http://scholar.google.com/scholar_lookup?&amp;title=Diverse%20and%20highly%20differentiated%20lava%20suite%20in%20Jezero%20Crater%2C%20Mars%3A%20constraints%20on%20intracrustal%20magmatism%20revealed%20by%20Mars%202020%20PIXL&amp;journal=Sci.%20Adv.&amp;doi=10.1126%2Fsciadv.adr2613&amp;volume=11&amp;publication_year=2025&amp;author=Schmidt%2CME">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="67."><p id="ref-CR67">Chadwick, O. A., Brimhall, G. H. &amp; Hendricks, D. M. From a black to a gray box—a mass balance interpretation of pedogenesis. <i>Geomorphology</i> <b>3</b>, 369–390 (1990).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1016/0169-555X(90)90012-F" data-track-item_id="10.1016/0169-555X(90)90012-F" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1016%2F0169-555X%2890%2990012-F" aria-label="Article reference 67" data-doi="10.1016/0169-555X(90)90012-F">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=1990Geomo...3..369C" aria-label="ADS reference 67">ADS</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 67" href="http://scholar.google.com/scholar_lookup?&amp;title=From%20a%20black%20to%20a%20gray%20box%E2%80%94a%20mass%20balance%20interpretation%20of%20pedogenesis&amp;journal=Geomorphology&amp;doi=10.1016%2F0169-555X%2890%2990012-F&amp;volume=3&amp;pages=369-390&amp;publication_year=1990&amp;author=Chadwick%2COA&amp;author=Brimhall%2CGH&amp;author=Hendricks%2CDM">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="68."><p id="ref-CR68">Liu, Y. et al. An olivine cumulate outcrop on the floor of Jezero Crater, Mars. <i>Science</i> <b>377</b>, 1513–151 (2022).</p><p><a data-track="click_references" rel="nofollow noopener" data-track-label="10.1126/science.abo2756" data-track-item_id="10.1126/science.abo2756" data-track-value="article reference" data-track-action="article reference" href="https://doi.org/10.1126%2Fscience.abo2756" aria-label="Article reference 68" data-doi="10.1126/science.abo2756">Article</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="ads reference" data-track-action="ads reference" href="http://adsabs.harvard.edu/cgi-bin/nph-data_query?link_type=ABSTRACT&amp;bibcode=2022Sci...377.1513L" aria-label="ADS reference 68">ADS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="cas reference" data-track-action="cas reference" href="https://www.nature.com/articles/cas-redirect/1:CAS:528:DC%2BB38XisFOru77P" aria-label="CAS reference 68">CAS</a>&nbsp;
    <a data-track="click_references" rel="nofollow noopener" data-track-label="link" data-track-item_id="link" data-track-value="pubmed reference" data-track-action="pubmed reference" href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&amp;db=PubMed&amp;dopt=Abstract&amp;list_uids=36007094" aria-label="PubMed reference 68">PubMed</a>&nbsp;
    <a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 68" href="http://scholar.google.com/scholar_lookup?&amp;title=An%20olivine%20cumulate%20outcrop%20on%20the%20floor%20of%20Jezero%20Crater%2C%20Mars&amp;journal=Science&amp;doi=10.1126%2Fscience.abo2756&amp;volume=377&amp;pages=1513-151&amp;publication_year=2022&amp;author=Liu%2CY">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="69."><p id="ref-CR69">Fisher, R. A. Frequency distribution of the values of the correlation coefficient in samples from an indefinitely large population. <i>Biometrika</i> <b>10</b>, 507–521 (1914).</p><p><a data-track="click_references" data-track-action="google scholar reference" data-track-value="google scholar reference" data-track-label="link" data-track-item_id="link" rel="nofollow noopener" aria-label="Google Scholar reference 69" href="http://scholar.google.com/scholar_lookup?&amp;title=Frequency%20distribution%20of%20the%20values%20of%20the%20correlation%20coefficient%20in%20samples%20from%20an%20indefinitely%20large%20population&amp;journal=Biometrika&amp;volume=10&amp;pages=507-521&amp;publication_year=1914&amp;author=Fisher%2CRA">
                    Google Scholar</a>&nbsp;
                </p></li><li data-counter="70."><p id="ref-CR70">Wright, A. P., Nemere, P., Galvin, A., Chau, D. H. &amp; Davidoff, S. Lessons from the development of an anomaly detection interface on the Mars Perseverance Rover using the ISHMAP framework. In <i>Proc. 28th International Conference on Intelligent User Interfaces</i> 91–105 (Association for Computing Machinery, 2023).</p></li><li data-counter="71."><p id="ref-CR71">Schurman, D. et al. PIXELATE: novel visualization and computational methods for the analysis of astrobiological spectroscopy data. In <i>AbSciCon 2019</i>, 401-8 (American Geophysical Union, 2019).</p></li><li data-counter="72."><p id="ref-CR72">Davidoff, S. et al. PIXLISE spectroscopy analysis software: released versions for published analyses. <i>OSF</i> <a href="https://doi.org/10.17605/OSF.IO/URE2F" data-track="click_references" data-track-action="external reference" data-track-value="external reference" data-track-label="10.17605/OSF.IO/URE2F">https://doi.org/10.17605/OSF.IO/URE2F</a> (2024).</p></li></ol><p><a data-track="click" data-track-action="download citation references" data-track-label="link" rel="nofollow" href="https://citation-needed.springer.com/v2/references/10.1038/s41586-025-09413-0?format=refman&amp;flavour=references">Download references</a></p></div></div><div id="Ack1-section" data-title="Acknowledgements"><h2 id="Ack1">Acknowledgements</h2><p>We acknowledge the efforts of the Mars 2020 Science and Engineering Teams. This work was carried out by A.C.A., M.L.C., K.P.H., K.U., S.D., K.A.F., S.W.L., Y.L., K.M.S., L.A.W., C.M.H. and J.N.M. at the Jet Propulsion Laboratory, California Institute of Technology, under a contract with the National Aeronautics and Space Administration (80NM0018D0004).</p></div><div id="author-information-section" aria-labelledby="author-information" data-title="Author information"><h2 id="author-information">Author information</h2><div id="author-information-content"><h3 id="affiliations">Authors and Affiliations</h3><ol><li id="Aff1"><p>Department of Geosciences, Stony Brook University, Stony Brook, NY, USA</p><p>Joel A. Hurowitz</p></li><li id="Aff2"><p>Department of Geology and Geophysics, Texas A&amp;M University, College Station, TX, USA</p><p>M. M. Tice&nbsp;&amp;&nbsp;L. P. O’Neil</p></li><li id="Aff3"><p>Jet Propulsion Laboratory, California Institute of Technology, Pasadena, CA, USA</p><p>A. C. Allwood,&nbsp;M. L. Cable,&nbsp;K. P. Hand,&nbsp;K. Uckert,&nbsp;S. Davidoff,&nbsp;Y. Liu,&nbsp;K. M. Stack,&nbsp;L. A. Wade,&nbsp;C. M. Heirwegh,&nbsp;S. W. Lee&nbsp;&amp;&nbsp;J. N. Maki</p></li><li id="Aff4"><p>Planetary Science Institute, Tucson, AZ, USA</p><p>A. E. Murphy</p></li><li id="Aff5"><p>School of Earth and Space Exploration, Arizona State University, Tempe, AZ, USA</p><p>J. F. Bell III</p></li><li id="Aff6"><p>Department of Earth, Atmospheric and Planetary Sciences, Massachusetts Institute of Technology, Cambridge, MA, USA</p><p>T. Bosak,&nbsp;B. P. Weiss&nbsp;&amp;&nbsp;E. Scheller</p></li><li id="Aff7"><p>Department of Earth, Atmospheric, and Planetary Sciences, Purdue University, West Lafayette, IN, USA</p><p>A. P. Broz&nbsp;&amp;&nbsp;R. C. Wiens</p></li><li id="Aff8"><p>Deutsches Zentrum für Luft- und Raumfahrt (DLR), Institute of Optical Sensor Systems, Berlin, Germany</p><p>E. Clavé</p></li><li id="Aff9"><p>Institut de Recherche en Astrophysique et Planétologie, CNRS, Univ. Toulouse, CNES, Toulouse, France</p><p>A. Cousin&nbsp;&amp;&nbsp;G. Caravaca</p></li><li id="Aff10"><p>Université Claude Bernard Lyon 1, ENS de Lyon, CNRS, UJM, LGL-TPE, UMR 5276, Villeurbanne, France</p><p>E. Dehouck&nbsp;&amp;&nbsp;C. Quantin-Nataf</p></li><li id="Aff11"><p>Division of Geological and Planetary Sciences, California Institute of Technology, Pasadena, CA, USA</p><p>K. A. Farley,&nbsp;H. Kalucha&nbsp;&amp;&nbsp;L. Mandon</p></li><li id="Aff12"><p>Department of Earth Science and Engineering, Imperial College London, London, UK</p><p>S. Gupta,&nbsp;A. J. Jones&nbsp;&amp;&nbsp;R. Barnes</p></li><li id="Aff13"><p>Center for Space Sensors and Systems, University of Oslo, Oslo, Norway</p><p>S.-E. Hamran</p></li><li id="Aff14"><p>School of Natural Sciences, Birkbeck, University of London, London, UK</p><p>K. Hickman-Lewis</p></li><li id="Aff15"><p>Johns Hopkins University Applied Physics Laboratory, Laurel, MD, USA</p><p>J. R. Johnson&nbsp;&amp;&nbsp;J. I. Núñez</p></li><li id="Aff16"><p>Central Analytical Research Facility, Queensland University of Technology, Brisbane, Queensland, Australia</p><p>M. W. M. Jones</p></li><li id="Aff17"><p>School of Chemistry and Physics, Queensland University of Technology, Brisbane, Queensland, Australia</p><p>M. W. M. Jones</p></li><li id="Aff18"><p>Technicial University of Denmark, DTU Space, Kongens Lyngby, Denmark</p><p>P. S. Jørgensen,&nbsp;D. A. Klevang&nbsp;&amp;&nbsp;J. L. Jørgensen</p></li><li id="Aff19"><p>Earth, Environmental and Planetary Sciences, University of Tennessee, Knoxville, TN, USA</p><p>L. C. Kah&nbsp;&amp;&nbsp;B. V. Wogsland</p></li><li id="Aff20"><p>Department of Earth Sciences, Brock University, St. Catharines, Ontario, Canada</p><p>T. V. Kizovski&nbsp;&amp;&nbsp;M. E. Schmidt</p></li><li id="Aff21"><p>Astromaterials Research and Exploration Science Division, NASA Johnson Space Center, Houston, TX, USA</p><p>F. M. McCubbin&nbsp;&amp;&nbsp;J. I. Simon</p></li><li id="Aff22"><p>Department of Earth, Environmental, and Planetary Sciences, Rice University, Houston, TX, USA</p><p>E. L. Moreland&nbsp;&amp;&nbsp;K. L. Siebach</p></li><li id="Aff23"><p>Joanneum Research Institute for Digital Technologies, Graz, Austria</p><p>G. Paar</p></li><li id="Aff24"><p>Department of Earth, Planetary and Space Sciences, University of California Los Angeles, Los Angeles, CA, USA</p><p>D. A. Paige,&nbsp;E. L. Cardarelli&nbsp;&amp;&nbsp;P. Russell</p></li><li id="Aff25"><p>Malin Space Science Systems, San Diego, CA, USA</p><p>A. C. Pascuzzo,&nbsp;P. A. Barr,&nbsp;J. E. Huggett&nbsp;&amp;&nbsp;N. Phelan</p></li><li id="Aff26"><p>Geology Department, Western Washington University, Bellingham, WA, USA</p><p>M. S. Rice&nbsp;&amp;&nbsp;B. Garczynski</p></li><li id="Aff27"><p>RISE Research Institutes of Sweden, Stockholm, Sweden</p><p>S. Siljeström</p></li><li id="Aff28"><p>Carnegie Science Earth and Planets Laboratory, Washington DC, USA</p><p>A. Steele,&nbsp;S. Sharma&nbsp;&amp;&nbsp;A. Srivastava</p></li><li id="Aff29"><p>Department of Earth Sciences, University of Cambridge, Cambridge, UK</p><p>N. J. Tosca</p></li><li id="Aff30"><p>Lunar and Planetary Institute, Houston, TX, USA</p><p>A. H. Treiman</p></li><li id="Aff31"><p>Department of Earth, Environmental, and Planetary Sciences, Washington University in St. Louis, St. Louis, MO, USA</p><p>S. J. VanBommel</p></li><li id="Aff32"><p>Blue Marble Space Institute of Science, Seattle, USA</p><p>K. H. Williford</p></li><li id="Aff33"><p>Department of Lithospheric Research, University of Vienna, Vienna, Austria</p><p>A. Bechtold</p></li><li id="Aff34"><p>Institut d’astrophysique et de planétologie de Grenoble/ISTerre, Grenoble, France</p><p>P. Beck</p></li><li id="Aff35"><p>IMPMC, UMR 7590 SU, CNRS, MNHN, IRD Biomineralogy Team Jussieu Campus, Paris, France</p><p>K. Benzerara</p></li><li id="Aff36"><p>Museum National d’Histoire Naturel, CNRS UMR 7590, Sorbonne Université, IMPMC, Paris, France</p><p>S. Bernard</p></li><li id="Aff37"><p>Institut de Minéralogie, de Physique des Matériaux et de Cosmochimie, CNRS UMR 7590, Sorbonne Université, Muséum National d’Histoire Naturelle, Paris, France</p><p>O. Beyssac</p></li><li id="Aff38"><p>Photon Systems Inc., Covina, CA, USA</p><p>R. Bhartia</p></li><li id="Aff39"><p>Plancius Research, Manlius, NY, USA</p><p>A. J. Brown</p></li><li id="Aff40"><p>Géosciences Environnement Toulouse, UMR 5563 Université de Toulouse, CNRS, IRD, CNES, Toulouse, France</p><p>G. Caravaca</p></li><li id="Aff41"><p>Centre for Terrestrial and Planetary Exploration, University of Winnipeg, Winnipeg, Manitoba, Canada</p><p>E. A. Cloutis</p></li><li id="Aff42"><p>Centro de Astrobiología (CAB), CSIC-INTA, Madrid, Spain</p><p>A. G. Fairén&nbsp;&amp;&nbsp;F. Goméz</p></li><li id="Aff43"><p>School of Earth and Atmospheric Sciences, Queensland University of Technology, Brisbane, Queensland, Australia</p><p>D. T. Flannery&nbsp;&amp;&nbsp;B. J. Orenstein</p></li><li id="Aff44"><p>INAF-Astrophysical Observatory of Arcetri, Florence, Italy</p><p>T. Fornaro</p></li><li id="Aff45"><p>Observatoire de Paris, PSL, Paris, France</p><p>T. Fouchet</p></li><li id="Aff46"><p>Department of Geoscience, UNLV, Las Vegas, NV, USA</p><p>E. M. Hausrath</p></li><li id="Aff47"><p>Department of Earth and Atmospheric Sciences, University of Alberta, Edmonton, Alberta, Canada</p><p>C. D. K. Herd</p></li><li id="Aff48"><p>Department of Earth and Space Sciences/Astrobiology Program, University of Washington, Seattle, WA, USA</p><p>A. Y. Li</p></li><li id="Aff49"><p>Univ. Grenoble Alpes, CNRS, IPAG, Grenoble, France</p><p>L. Mandon</p></li><li id="Aff50"><p>Laboratoire Planétologie et Géosciences, CNRS UMR6112, Nantes Université, Univ. Angers, Nantes, France</p><p>N. Mangold</p></li><li id="Aff51"><p>ERICA Research Group and LaDIS Laboratory, University of Valladolid, Valladolid, Spain</p><p>J. A. Manrique</p></li><li id="Aff52"><p>Institute of Geosciences, CSIC-UCM, Madrid, Spain</p><p>J. Martínez-Frías</p></li><li id="Aff53"><p>Mars Exploration Program, NASA Headquarters, Washington DC, USA</p><p>M. D. Schulte</p></li><li id="Aff54"><p>Department of Earth and Planetary Science, University of California Berkeley, Berkeley, CA, USA</p><p>D. L. Shuster</p></li><li id="Aff55"><p>Los Alamos National Laboratory, Los Alamos, NM, USA</p><p>Z. U. Wolf</p></li></ol><div data-test="author-info"><p><span>Authors</span></p><ol><li id="auth-Joel_A_-Hurowitz-Aff1"><span>Joel A. Hurowitz</span></li><li id="auth-M__M_-Tice-Aff2"><span>M. M. Tice</span></li><li id="auth-A__C_-Allwood-Aff3"><span>A. C. Allwood</span></li><li id="auth-M__L_-Cable-Aff3"><span>M. L. Cable</span></li><li id="auth-K__P_-Hand-Aff3"><span>K. P. Hand</span></li><li id="auth-A__E_-Murphy-Aff4"><span>A. E. Murphy</span></li><li id="auth-K_-Uckert-Aff3"><span>K. Uckert</span></li><li id="auth-J__F_-Bell-Aff5"><span>J. F. Bell III</span></li><li id="auth-T_-Bosak-Aff6"><span>T. Bosak</span></li><li id="auth-A__P_-Broz-Aff7"><span>A. P. Broz</span></li><li id="auth-E_-Clav_-Aff8"><span>E. Clavé</span></li><li id="auth-A_-Cousin-Aff9"><span>A. Cousin</span></li><li id="auth-S_-Davidoff-Aff3"><span>S. Davidoff</span></li><li id="auth-E_-Dehouck-Aff10"><span>E. Dehouck</span></li><li id="auth-K__A_-Farley-Aff11"><span>K. A. Farley</span></li><li id="auth-S_-Gupta-Aff12"><span>S. Gupta</span></li><li id="auth-S__E_-Hamran-Aff13"><span>S.-E. Hamran</span></li><li id="auth-K_-Hickman_Lewis-Aff14"><span>K. Hickman-Lewis</span></li><li id="auth-J__R_-Johnson-Aff15"><span>J. R. Johnson</span></li><li id="auth-A__J_-Jones-Aff12"><span>A. J. Jones</span></li><li id="auth-M__W__M_-Jones-Aff16-Aff17"><span>M. W. M. Jones</span></li><li id="auth-P__S_-J_rgensen-Aff18"><span>P. S. Jørgensen</span></li><li id="auth-L__C_-Kah-Aff19"><span>L. C. Kah</span></li><li id="auth-H_-Kalucha-Aff11"><span>H. Kalucha</span></li><li id="auth-T__V_-Kizovski-Aff20"><span>T. V. Kizovski</span></li><li id="auth-D__A_-Klevang-Aff18"><span>D. A. Klevang</span></li><li id="auth-Y_-Liu-Aff3"><span>Y. Liu</span></li><li id="auth-F__M_-McCubbin-Aff21"><span>F. M. McCubbin</span></li><li id="auth-E__L_-Moreland-Aff22"><span>E. L. Moreland</span></li><li id="auth-G_-Paar-Aff23"><span>G. Paar</span></li><li id="auth-D__A_-Paige-Aff24"><span>D. A. Paige</span></li><li id="auth-A__C_-Pascuzzo-Aff25"><span>A. C. Pascuzzo</span></li><li id="auth-M__S_-Rice-Aff26"><span>M. S. Rice</span></li><li id="auth-M__E_-Schmidt-Aff20"><span>M. E. Schmidt</span></li><li id="auth-K__L_-Siebach-Aff22"><span>K. L. Siebach</span></li><li id="auth-S_-Siljestr_m-Aff27"><span>S. Siljeström</span></li><li id="auth-J__I_-Simon-Aff21"><span>J. I. Simon</span></li><li id="auth-K__M_-Stack-Aff3"><span>K. M. Stack</span></li><li id="auth-A_-Steele-Aff28"><span>A. Steele</span></li><li id="auth-N__J_-Tosca-Aff29"><span>N. J. Tosca</span></li><li id="auth-A__H_-Treiman-Aff30"><span>A. H. Treiman</span></li><li id="auth-S__J_-VanBommel-Aff31"><span>S. J. VanBommel</span></li><li id="auth-L__A_-Wade-Aff3"><span>L. A. Wade</span></li><li id="auth-B__P_-Weiss-Aff6"><span>B. P. Weiss</span></li><li id="auth-R__C_-Wiens-Aff7"><span>R. C. Wiens</span></li><li id="auth-K__H_-Williford-Aff32"><span>K. H. Williford</span></li><li id="auth-R_-Barnes-Aff12"><span>R. Barnes</span></li><li id="auth-P__A_-Barr-Aff25"><span>P. A. Barr</span></li><li id="auth-A_-Bechtold-Aff33"><span>A. Bechtold</span></li><li id="auth-P_-Beck-Aff34"><span>P. Beck</span></li><li id="auth-K_-Benzerara-Aff35"><span>K. Benzerara</span></li><li id="auth-S_-Bernard-Aff36"><span>S. Bernard</span></li><li id="auth-O_-Beyssac-Aff37"><span>O. Beyssac</span></li><li id="auth-R_-Bhartia-Aff38"><span>R. Bhartia</span></li><li id="auth-A__J_-Brown-Aff39"><span>A. J. Brown</span></li><li id="auth-G_-Caravaca-Aff9-Aff40"><span>G. Caravaca</span></li><li id="auth-E__L_-Cardarelli-Aff24"><span>E. L. Cardarelli</span></li><li id="auth-E__A_-Cloutis-Aff41"><span>E. A. Cloutis</span></li><li id="auth-A__G_-Fair_n-Aff42"><span>A. G. Fairén</span></li><li id="auth-D__T_-Flannery-Aff43"><span>D. T. Flannery</span></li><li id="auth-T_-Fornaro-Aff44"><span>T. Fornaro</span></li><li id="auth-T_-Fouchet-Aff45"><span>T. Fouchet</span></li><li id="auth-B_-Garczynski-Aff26"><span>B. Garczynski</span></li><li id="auth-F_-Gom_z-Aff42"><span>F. Goméz</span></li><li id="auth-E__M_-Hausrath-Aff46"><span>E. M. Hausrath</span></li><li id="auth-C__M_-Heirwegh-Aff3"><span>C. M. Heirwegh</span></li><li id="auth-C__D__K_-Herd-Aff47"><span>C. D. K. Herd</span></li><li id="auth-J__E_-Huggett-Aff25"><span>J. E. Huggett</span></li><li id="auth-J__L_-J_rgensen-Aff18"><span>J. L. Jørgensen</span></li><li id="auth-S__W_-Lee-Aff3"><span>S. W. Lee</span></li><li id="auth-A__Y_-Li-Aff48"><span>A. Y. Li</span></li><li id="auth-J__N_-Maki-Aff3"><span>J. N. Maki</span></li><li id="auth-L_-Mandon-Aff11-Aff49"><span>L. Mandon</span></li><li id="auth-N_-Mangold-Aff50"><span>N. Mangold</span></li><li id="auth-J__A_-Manrique-Aff51"><span>J. A. Manrique</span></li><li id="auth-J_-Mart_nez_Fr_as-Aff52"><span>J. Martínez-Frías</span></li><li id="auth-J__I_-N__ez-Aff15"><span>J. I. Núñez</span></li><li id="auth-L__P_-O_Neil-Aff2"><span>L. P. O’Neil</span></li><li id="auth-B__J_-Orenstein-Aff43"><span>B. J. Orenstein</span></li><li id="auth-N_-Phelan-Aff25"><span>N. Phelan</span></li><li id="auth-C_-Quantin_Nataf-Aff10"><span>C. Quantin-Nataf</span></li><li id="auth-P_-Russell-Aff24"><span>P. Russell</span></li><li id="auth-M__D_-Schulte-Aff53"><span>M. D. Schulte</span></li><li id="auth-E_-Scheller-Aff6"><span>E. Scheller</span></li><li id="auth-S_-Sharma-Aff28"><span>S. Sharma</span></li><li id="auth-D__L_-Shuster-Aff54"><span>D. L. Shuster</span></li><li id="auth-A_-Srivastava-Aff28"><span>A. Srivastava</span></li><li id="auth-B__V_-Wogsland-Aff19"><span>B. V. Wogsland</span></li><li id="auth-Z__U_-Wolf-Aff55"><span>Z. U. Wolf</span></li></ol></div><h3 id="contributions">Contributions</h3><p>Conceptualization: A.C.A., S.B., A.B., A.P.B., K.A.F., D.T.F., B.G., S.G., K.P.H., J.A.H., M.S.R., E.S., M.E.S., M.D.S., D.L.S., K.M.S., M.M.T., A.H.T., K.U., R.C.W. and K.H.W. Methodology: J.F.B., O.B., R. Bhartia, E.A.C., D.T.F., B.G., S.-E.H., K.P.H., J.A.H., J.R.J., M.W.M.J., Y.L., L.M., L.P.O’N, M.S.R., P.R., E.S., A. Steele, M.M.T., K.U., S.J.V., L.A.W., B.P.W. and K.H.W. Software: S.D., D.T.F., T. Fouchet, S.-E.H., P.S.J., D.A.K., L.P.O’N., G.P., E.S., S. Sharma, M.M.T., K.U., S.J.V. and K.H.W. Validation: J.A.H., J.R.J., E.S., M.M.T., L.A.W. and K.H.W. Formal analysis: A.C.A., E.L.C., E.D., T. Fornaro, K.P.H., J.A.H., M.W.M.J., H.K., L.P.O’N., B.J.O., M.S.R., E.S., S. Siljeström, A. Steele, M.M.T., K.U., S.J.V. and K.H.W. Investigation: R. Barnes, A.B., P.B., K.B., S.B., O.B., R. Bhartia, T.B., A.J.B., A.P.B., G.C., E.L.C., E.C., E.A.C., A.C., E.D., K.A.F., D.T.F., T. Fornaro, T. Fouchet, B.G., S.G., S.-E.H., K.P.H., K.H.-L., J.A.H., J.R.J., A.J.J., M.W.M.J., P.S.J., L.C.K., H.K., T.V.K., D.A.K., S.W.L., A.Y.L., Y.L., J.N.M., L.M., N.M., J.A.M., J.M.-F., E.L.M., A.E.M., J.I.N., L.P.O’N., B.J.O., D.A.P., C.Q.-N., M.S.R., P.R., E.S., M.E.S., M.D.S., S. Sharma, D.L.S., K.L.S., S. Siljeström, J.I.S., K.M.S., A. Steele, M.M.T., A.H.T., K.U., S.J.V., L.A.W., B.P.W., R.C.W., K.H.W. and B.V.W. Resources: J.F.B., A.P.B., M.L.C., K.P.H., J.A.H., S.W.L. and D.A.P. Data curation: P.A.B., A.B., J.F.B., E.L.C., S.D., B.G., C.M.H., J.E.H., H.K., J.N.M., J.A.M., E.L.M., G.P., A.C.P., N.P., M.S.R., A.H.T., K.U., S.J.V., B.V.W and Z.U.W. Writing—original draft: A.C.A., E.L.C., E.D., F.G., S.G., J.A.H., M.S.R., L.A.W. and R.C.W. Writing—review and editing: R. Barnes, P.B., K.B., S.B., O.B., R. Bhartia, T.B., A.B., A.P.B., M.L.C., G.C., E.L.C., E.C., E.A.C., E.D., A.G.F., D.T.F., T. Fornaro, T. Fouchet, F.G., S.G., K.P.H., E.M.H., C.D.K.H., K.H.-L., J.A.H., J.R.J., A.J.J., M.W.M.J., P.S.J., L.C.K., T.V.K., D.A.K., A.Y.L., Y.L., L.M., N.M., J.A.M., J.M.-F., F.M.M., E.L.M., A.E.M., J.I.N., L.P.O’N., B.J.O., C.Q.-N., M.S.R., P.R., M.E.S., M.D.S., S. Sharma, D.L.S., K.L.S., S. Siljeström, J.I.S., A. Srivastava, K.M.S., A. Steele, M.M.T., N.J.T., A.H.T., K.U., S.J.V., L.A.W., B.P.W., R.C.W. and K.H.W. Visualization: R. Barnes, P.A.B., A.B., J.F.B., E.L.C., E.C., S.D., E.D., B.G., S.-E.H., J.E.H., J.A.H., J.R.J., M.W.M.J., P.S.J., J.L.J., D.A.K., J.N.M., J.M.-F., G.P., A.C.P., N.P., M.S.R., P.R., M.M.T., K.U. and S.J.V. Supervision: J.F.B., M.L.C., A.C., K.A.F., S.G., K.P.H., J.A.H., J.R.J., J.L.J., S.W.L., J.N.M., M.D.S., K.M.S., M.M.T., K.U. and R.C.W. Project administration: J.F.B., M.L.C., A.C., K.A.F., T. Fouchet, S.-E.H., K.P.H., J.A.H., J.L.J., L.C.K., S.W.L., J.N.M., D.A.P., M.D.S., K.M.S. and R.C.W. Funding acquisition: A.C.A., J.F.B., M.L.C., T. Fouchet, S.G., K.P.H., J.A.H., J.L.J., S.W.L., D.A.P. and R.C.W.</p><h3 id="corresponding-author">Corresponding author</h3><p id="corresponding-author-list">Correspondence to
                <a id="corresp-c1" href="mailto:joel.hurowitz@stonybrook.edu">Joel A. Hurowitz</a>.</p></div></div><div id="ethics-section" data-title="Ethics declarations"><h2 id="ethics">Ethics declarations</h2><div id="ethics-content">
              
                <h3 id="FPar2">Competing interests</h3>
                <p>The authors declare no competing interests.</p>
              
            </div></div><div id="peer-review-section" data-title="Peer review"><h2 id="peer-review">Peer review</h2><div id="peer-review-content">
              
              
                <h3 id="FPar1">Peer review information</h3>
                <p><i>Nature</i> thanks Janice Bishop, Aude Picard and the other, anonymous, reviewer(s) for their contribution to the peer review of this work. <a data-track="click" data-track-label="link" data-track-action="supplementary material anchor" href="https://www.nature.com/articles/s41586-025-09413-0#MOESM3">Peer reviewer reports</a> are available.</p>
              
            </div></div><div id="additional-information-section" data-title="Additional information"><h2 id="additional-information">Additional information</h2><p><b>Publisher’s note</b> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p></div><div id="Sec14-section" data-title="Supplementary information"><h2 id="Sec14">Supplementary information</h2><div data-test="supplementary-info" id="Sec14-content"><div data-test="supp-item" id="MOESM1"><h3><a data-track="click" data-track-action="view supplementary info" data-test="supp-info-link" data-track-label="supplementary information" href="https://static-content.springer.com/esm/art%3A10.1038%2Fs41586-025-09413-0/MediaObjects/41586_2025_9413_MOESM1_ESM.docx" data-supp-info-image="">Supplementary Information</a></h3><p>This file contains Supplementary Text, Tables 1–3, Figs. 1–26 and References.</p></div><div data-test="supp-item" id="MOESM2"><h3><a data-track="click" data-track-action="view supplementary info" data-test="supp-info-link" data-track-label="supplementary data" href="https://static-content.springer.com/esm/art%3A10.1038%2Fs41586-025-09413-0/MediaObjects/41586_2025_9413_MOESM2_ESM.xlsx" data-supp-info-image="">Supplementary Data</a></h3><p>File containing tabulated PIXL XRF data for rock bulk and region of interest compositions, as well as data used in the construction of Supplementary Figs. 21f–h and 26.</p></div><p data-test="supp-item" id="MOESM3"><h3><a data-track="click" data-track-action="view supplementary info" data-test="supp-info-link" data-track-label="peer review file" href="https://static-content.springer.com/esm/art%3A10.1038%2Fs41586-025-09413-0/MediaObjects/41586_2025_9413_MOESM3_ESM.pdf" data-supp-info-image="">Peer Review File</a></h3></p></div></div><div id="rightslink-section" data-title="Rights and permissions"><h2 id="rightslink">Rights and permissions</h2><div id="rightslink-content">
                <p><b>Open Access</b>  This article is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License, which permits any non-commercial use, sharing, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if you modified the licensed material. You do not have permission under this licence to share adapted material derived from this article or parts of it. The images or other third party material in this article are included in the article’s Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" rel="license">http://creativecommons.org/licenses/by-nc-nd/4.0/</a>.</p>
              <p><a data-track="click" data-track-action="view rights and permissions" data-track-label="link" href="https://s100.copyright.com/AppDispatchServlet?title=Redox-driven%20mineral%20and%20organic%20associations%20in%20Jezero%20Crater%2C%20Mars&amp;author=Joel%20A.%20Hurowitz%20et%20al&amp;contentID=10.1038%2Fs41586-025-09413-0&amp;copyright=The%20Author%28s%29&amp;publication=0028-0836&amp;publicationDate=2025-09-10&amp;publisherName=SpringerNature&amp;orderBeanReset=true&amp;oa=CC%20BY-NC-ND">Reprints and permissions</a></p></div></div><div id="article-info-section" aria-labelledby="article-info" data-title="About this article"><h2 id="article-info">About this article</h2><div id="article-info-content"><p><a data-crossmark="10.1038/s41586-025-09413-0" target="_blank" rel="noopener" href="https://crossmark.crossref.org/dialog/?doi=10.1038/s41586-025-09413-0" data-track="click" data-track-action="Click Crossmark" data-track-label="link" data-test="crossmark"><img loading="lazy" width="57" height="81" alt="Check for updates. Verify currency and authenticity via CrossMark" src="data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjgxIiB3aWR0aD0iNTciIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJtMTcuMzUgMzUuNDUgMjEuMy0xNC4ydi0xNy4wM2gtMjEuMyIgZmlsbD0iIzk4OTg5OCIvPjxwYXRoIGQ9Im0zOC42NSAzNS40NS0yMS4zLTE0LjJ2LTE3LjAzaDIxLjMiIGZpbGw9IiM3NDc0NzQiLz48cGF0aCBkPSJtMjggLjVjLTEyLjk4IDAtMjMuNSAxMC41Mi0yMy41IDIzLjVzMTAuNTIgMjMuNSAyMy41IDIzLjUgMjMuNS0xMC41MiAyMy41LTIzLjVjMC02LjIzLTIuNDgtMTIuMjEtNi44OC0xNi42Mi00LjQxLTQuNC0xMC4zOS02Ljg4LTE2LjYyLTYuODh6bTAgNDEuMjVjLTkuOCAwLTE3Ljc1LTcuOTUtMTcuNzUtMTcuNzVzNy45NS0xNy43NSAxNy43NS0xNy43NSAxNy43NSA3Ljk1IDE3Ljc1IDE3Ljc1YzAgNC43MS0xLjg3IDkuMjItNS4yIDEyLjU1cy03Ljg0IDUuMi0xMi41NSA1LjJ6IiBmaWxsPSIjNTM1MzUzIi8+PHBhdGggZD0ibTQxIDM2Yy01LjgxIDYuMjMtMTUuMjMgNy40NS0yMi40MyAyLjktNy4yMS00LjU1LTEwLjE2LTEzLjU3LTcuMDMtMjEuNWwtNC45Mi0zLjExYy00Ljk1IDEwLjctMS4xOSAyMy40MiA4Ljc4IDI5LjcxIDkuOTcgNi4zIDIzLjA3IDQuMjIgMzAuNi00Ljg2eiIgZmlsbD0iIzljOWM5YyIvPjxwYXRoIGQ9Im0uMiA1OC40NWMwLS43NS4xMS0xLjQyLjMzLTIuMDFzLjUyLTEuMDkuOTEtMS41Yy4zOC0uNDEuODMtLjczIDEuMzQtLjk0LjUxLS4yMiAxLjA2LS4zMiAxLjY1LS4zMi41NiAwIDEuMDYuMTEgMS41MS4zNS40NC4yMy44MS41IDEuMS44MWwtLjkxIDEuMDFjLS4yNC0uMjQtLjQ5LS40Mi0uNzUtLjU2LS4yNy0uMTMtLjU4LS4yLS45My0uMi0uMzkgMC0uNzMuMDgtMS4wNS4yMy0uMzEuMTYtLjU4LjM3LS44MS42Ni0uMjMuMjgtLjQxLjYzLS41MyAxLjA0LS4xMy40MS0uMTkuODgtLjE5IDEuMzkgMCAxLjA0LjIzIDEuODYuNjggMi40Ni40NS41OSAxLjA2Ljg4IDEuODQuODguNDEgMCAuNzctLjA3IDEuMDctLjIzcy41OS0uMzkuODUtLjY4bC45MSAxYy0uMzguNDMtLjguNzYtMS4yOC45OS0uNDcuMjItMSAuMzQtMS41OC4zNC0uNTkgMC0xLjEzLS4xLTEuNjQtLjMxLS41LS4yLS45NC0uNTEtMS4zMS0uOTEtLjM4LS40LS42Ny0uOS0uODgtMS40OC0uMjItLjU5LS4zMy0xLjI2LS4zMy0yLjAyem04LjQtNS4zM2gxLjYxdjIuNTRsLS4wNSAxLjMzYy4yOS0uMjcuNjEtLjUxLjk2LS43MnMuNzYtLjMxIDEuMjQtLjMxYy43MyAwIDEuMjcuMjMgMS42MS43MS4zMy40Ny41IDEuMTQuNSAyLjAydjQuMzFoLTEuNjF2LTQuMWMwLS41Ny0uMDgtLjk3LS4yNS0xLjIxLS4xNy0uMjMtLjQ1LS4zNS0uODMtLjM1LS4zIDAtLjU2LjA4LS43OS4yMi0uMjMuMTUtLjQ5LjM2LS43OC42NHY0LjhoLTEuNjF6bTcuMzcgNi40NWMwLS41Ni4wOS0xLjA2LjI2LTEuNTEuMTgtLjQ1LjQyLS44My43MS0xLjE0LjI5LS4zLjYzLS41NCAxLjAxLS43MS4zOS0uMTcuNzgtLjI1IDEuMTgtLjI1LjQ3IDAgLjg4LjA4IDEuMjMuMjQuMzYuMTYuNjUuMzguODkuNjdzLjQyLjYzLjU0IDEuMDNjLjEyLjQxLjE4Ljg0LjE4IDEuMzIgMCAuMzItLjAyLjU3LS4wNy43NmgtNC4zNmMuMDcuNjIuMjkgMS4xLjY1IDEuNDQuMzYuMzMuODIuNSAxLjM4LjUuMjkgMCAuNTctLjA0LjgzLS4xM3MuNTEtLjIxLjc2LS4zN2wuNTUgMS4wMWMtLjMzLjIxLS42OS4zOS0xLjA5LjUzLS40MS4xNC0uODMuMjEtMS4yNi4yMS0uNDggMC0uOTItLjA4LTEuMzQtLjI1LS40MS0uMTYtLjc2LS40LTEuMDctLjctLjMxLS4zMS0uNTUtLjY5LS43Mi0xLjEzLS4xOC0uNDQtLjI2LS45NS0uMjYtMS41MnptNC42LS42MmMwLS41NS0uMTEtLjk4LS4zNC0xLjI4LS4yMy0uMzEtLjU4LS40Ny0xLjA2LS40Ny0uNDEgMC0uNzcuMTUtMS4wNy40NS0uMzEuMjktLjUuNzMtLjU4IDEuM3ptMi41LjYyYzAtLjU3LjA5LTEuMDguMjgtMS41My4xOC0uNDQuNDMtLjgyLjc1LTEuMTNzLjY5LS41NCAxLjEtLjcxYy40Mi0uMTYuODUtLjI0IDEuMzEtLjI0LjQ1IDAgLjg0LjA4IDEuMTcuMjNzLjYxLjM0Ljg1LjU3bC0uNzcgMS4wMmMtLjE5LS4xNi0uMzgtLjI4LS41Ni0uMzctLjE5LS4wOS0uMzktLjE0LS42MS0uMTQtLjU2IDAtMS4wMS4yMS0xLjM1LjYzLS4zNS40MS0uNTIuOTctLjUyIDEuNjcgMCAuNjkuMTcgMS4yNC41MSAxLjY2LjM0LjQxLjc4LjYyIDEuMzIuNjIuMjggMCAuNTQtLjA2Ljc4LS4xNy4yNC0uMTIuNDUtLjI2LjY0LS40MmwuNjcgMS4wM2MtLjMzLjI5LS42OS41MS0xLjA4LjY1LS4zOS4xNS0uNzguMjMtMS4xOC4yMy0uNDYgMC0uOS0uMDgtMS4zMS0uMjQtLjQtLjE2LS43NS0uMzktMS4wNS0uN3MtLjUzLS42OS0uNy0xLjEzYy0uMTctLjQ1LS4yNS0uOTYtLjI1LTEuNTN6bTYuOTEtNi40NWgxLjU4djYuMTdoLjA1bDIuNTQtMy4xNmgxLjc3bC0yLjM1IDIuOCAyLjU5IDQuMDdoLTEuNzVsLTEuNzctMi45OC0xLjA4IDEuMjN2MS43NWgtMS41OHptMTMuNjkgMS4yN2MtLjI1LS4xMS0uNS0uMTctLjc1LS4xNy0uNTggMC0uODcuMzktLjg3IDEuMTZ2Ljc1aDEuMzR2MS4yN2gtMS4zNHY1LjZoLTEuNjF2LTUuNmgtLjkydi0xLjJsLjkyLS4wN3YtLjcyYzAtLjM1LjA0LS42OC4xMy0uOTguMDgtLjMxLjIxLS41Ny40LS43OXMuNDItLjM5LjcxLS41MWMuMjgtLjEyLjYzLS4xOCAxLjA0LS4xOC4yNCAwIC40OC4wMi42OS4wNy4yMi4wNS40MS4xLjU3LjE3em0uNDggNS4xOGMwLS41Ny4wOS0xLjA4LjI3LTEuNTMuMTctLjQ0LjQxLS44Mi43Mi0xLjEzLjMtLjMxLjY1LS41NCAxLjA0LS43MS4zOS0uMTYuOC0uMjQgMS4yMy0uMjRzLjg0LjA4IDEuMjQuMjRjLjQuMTcuNzQuNCAxLjA0Ljcxcy41NC42OS43MiAxLjEzYy4xOS40NS4yOC45Ni4yOCAxLjUzcy0uMDkgMS4wOC0uMjggMS41M2MtLjE4LjQ0LS40Mi44Mi0uNzIgMS4xM3MtLjY0LjU0LTEuMDQuNy0uODEuMjQtMS4yNC4yNC0uODQtLjA4LTEuMjMtLjI0LS43NC0uMzktMS4wNC0uN2MtLjMxLS4zMS0uNTUtLjY5LS43Mi0xLjEzLS4xOC0uNDUtLjI3LS45Ni0uMjctMS41M3ptMS42NSAwYzAgLjY5LjE0IDEuMjQuNDMgMS42Ni4yOC40MS42OC42MiAxLjE4LjYyLjUxIDAgLjktLjIxIDEuMTktLjYyLjI5LS40Mi40NC0uOTcuNDQtMS42NiAwLS43LS4xNS0xLjI2LS40NC0xLjY3LS4yOS0uNDItLjY4LS42My0xLjE5LS42My0uNSAwLS45LjIxLTEuMTguNjMtLjI5LjQxLS40My45Ny0uNDMgMS42N3ptNi40OC0zLjQ0aDEuMzNsLjEyIDEuMjFoLjA1Yy4yNC0uNDQuNTQtLjc5Ljg4LTEuMDIuMzUtLjI0LjctLjM2IDEuMDctLjM2LjMyIDAgLjU5LjA1Ljc4LjE0bC0uMjggMS40LS4zMy0uMDljLS4xMS0uMDEtLjIzLS4wMi0uMzgtLjAyLS4yNyAwLS41Ni4xLS44Ni4zMXMtLjU1LjU4LS43NyAxLjF2NC4yaC0xLjYxem0tNDcuODcgMTVoMS42MXY0LjFjMCAuNTcuMDguOTcuMjUgMS4yLjE3LjI0LjQ0LjM1LjgxLjM1LjMgMCAuNTctLjA3LjgtLjIyLjIyLS4xNS40Ny0uMzkuNzMtLjczdi00LjdoMS42MXY2Ljg3aC0xLjMybC0uMTItMS4wMWgtLjA0Yy0uMy4zNi0uNjMuNjQtLjk4Ljg2LS4zNS4yMS0uNzYuMzItMS4yNC4zMi0uNzMgMC0xLjI3LS4yNC0xLjYxLS43MS0uMzMtLjQ3LS41LTEuMTQtLjUtMi4wMnptOS40NiA3LjQzdjIuMTZoLTEuNjF2LTkuNTloMS4zM2wuMTIuNzJoLjA1Yy4yOS0uMjQuNjEtLjQ1Ljk3LS42My4zNS0uMTcuNzItLjI2IDEuMS0uMjYuNDMgMCAuODEuMDggMS4xNS4yNC4zMy4xNy42MS40Ljg0LjcxLjI0LjMxLjQxLjY4LjUzIDEuMTEuMTMuNDIuMTkuOTEuMTkgMS40NCAwIC41OS0uMDkgMS4xMS0uMjUgMS41Ny0uMTYuNDctLjM4Ljg1LS42NSAxLjE2LS4yNy4zMi0uNTguNTYtLjk0LjczLS4zNS4xNi0uNzIuMjUtMS4xLjI1LS4zIDAtLjYtLjA3LS45LS4ycy0uNTktLjMxLS44Ny0uNTZ6bTAtMi4zYy4yNi4yMi41LjM3LjczLjQ1LjI0LjA5LjQ2LjEzLjY2LjEzLjQ2IDAgLjg0LS4yIDEuMTUtLjYuMzEtLjM5LjQ2LS45OC40Ni0xLjc3IDAtLjY5LS4xMi0xLjIyLS4zNS0xLjYxLS4yMy0uMzgtLjYxLS41Ny0xLjEzLS41Ny0uNDkgMC0uOTkuMjYtMS41Mi43N3ptNS44Ny0xLjY5YzAtLjU2LjA4LTEuMDYuMjUtMS41MS4xNi0uNDUuMzctLjgzLjY1LTEuMTQuMjctLjMuNTgtLjU0LjkzLS43MXMuNzEtLjI1IDEuMDgtLjI1Yy4zOSAwIC43My4wNyAxIC4yLjI3LjE0LjU0LjMyLjgxLjU1bC0uMDYtMS4xdi0yLjQ5aDEuNjF2OS44OGgtMS4zM2wtLjExLS43NGgtLjA2Yy0uMjUuMjUtLjU0LjQ2LS44OC42NC0uMzMuMTgtLjY5LjI3LTEuMDYuMjctLjg3IDAtMS41Ni0uMzItMi4wNy0uOTVzLS43Ni0xLjUxLS43Ni0yLjY1em0xLjY3LS4wMWMwIC43NC4xMyAxLjMxLjQgMS43LjI2LjM4LjY1LjU4IDEuMTUuNTguNTEgMCAuOTktLjI2IDEuNDQtLjc3di0zLjIxYy0uMjQtLjIxLS40OC0uMzYtLjctLjQ1LS4yMy0uMDgtLjQ2LS4xMi0uNy0uMTItLjQ1IDAtLjgyLjE5LTEuMTMuNTktLjMxLjM5LS40Ni45NS0uNDYgMS42OHptNi4zNSAxLjU5YzAtLjczLjMyLTEuMy45Ny0xLjcxLjY0LS40IDEuNjctLjY4IDMuMDgtLjg0IDAtLjE3LS4wMi0uMzQtLjA3LS41MS0uMDUtLjE2LS4xMi0uMy0uMjItLjQzcy0uMjItLjIyLS4zOC0uM2MtLjE1LS4wNi0uMzQtLjEtLjU4LS4xLS4zNCAwLS42OC4wNy0xIC4ycy0uNjMuMjktLjkzLjQ3bC0uNTktMS4wOGMuMzktLjI0LjgxLS40NSAxLjI4LS42My40Ny0uMTcuOTktLjI2IDEuNTQtLjI2Ljg2IDAgMS41MS4yNSAxLjkzLjc2cy42MyAxLjI1LjYzIDIuMjF2NC4wN2gtMS4zMmwtLjEyLS43NmgtLjA1Yy0uMy4yNy0uNjMuNDgtLjk4LjY2cy0uNzMuMjctMS4xNC4yN2MtLjYxIDAtMS4xLS4xOS0xLjQ4LS41Ni0uMzgtLjM2LS41Ny0uODUtLjU3LTEuNDZ6bTEuNTctLjEyYzAgLjMuMDkuNTMuMjcuNjcuMTkuMTQuNDIuMjEuNzEuMjEuMjggMCAuNTQtLjA3Ljc3LS4ycy40OC0uMzEuNzMtLjU2di0xLjU0Yy0uNDcuMDYtLjg2LjEzLTEuMTguMjMtLjMxLjA5LS41Ny4xOS0uNzYuMzFzLS4zMy4yNS0uNDEuNGMtLjA5LjE1LS4xMy4zMS0uMTMuNDh6bTYuMjktMy42M2gtLjk4di0xLjJsMS4wNi0uMDcuMi0xLjg4aDEuMzR2MS44OGgxLjc1djEuMjdoLTEuNzV2My4yOGMwIC44LjMyIDEuMi45NyAxLjIuMTIgMCAuMjQtLjAxLjM3LS4wNC4xMi0uMDMuMjQtLjA3LjM0LS4xMWwuMjggMS4xOWMtLjE5LjA2LS40LjEyLS42NC4xNy0uMjMuMDUtLjQ5LjA4LS43Ni4wOC0uNCAwLS43NC0uMDYtMS4wMi0uMTgtLjI3LS4xMy0uNDktLjMtLjY3LS41Mi0uMTctLjIxLS4zLS40OC0uMzctLjc4LS4wOC0uMy0uMTItLjY0LS4xMi0xLjAxem00LjM2IDIuMTdjMC0uNTYuMDktMS4wNi4yNy0xLjUxcy40MS0uODMuNzEtMS4xNGMuMjktLjMuNjMtLjU0IDEuMDEtLjcxLjM5LS4xNy43OC0uMjUgMS4xOC0uMjUuNDcgMCAuODguMDggMS4yMy4yNC4zNi4xNi42NS4zOC44OS42N3MuNDIuNjMuNTQgMS4wM2MuMTIuNDEuMTguODQuMTggMS4zMiAwIC4zMi0uMDIuNTctLjA3Ljc2aC00LjM3Yy4wOC42Mi4yOSAxLjEuNjUgMS40NC4zNi4zMy44Mi41IDEuMzguNS4zIDAgLjU4LS4wNC44NC0uMTMuMjUtLjA5LjUxLS4yMS43Ni0uMzdsLjU0IDEuMDFjLS4zMi4yMS0uNjkuMzktMS4wOS41M3MtLjgyLjIxLTEuMjYuMjFjLS40NyAwLS45Mi0uMDgtMS4zMy0uMjUtLjQxLS4xNi0uNzctLjQtMS4wOC0uNy0uMy0uMzEtLjU0LS42OS0uNzItMS4xMy0uMTctLjQ0LS4yNi0uOTUtLjI2LTEuNTJ6bTQuNjEtLjYyYzAtLjU1LS4xMS0uOTgtLjM0LTEuMjgtLjIzLS4zMS0uNTgtLjQ3LTEuMDYtLjQ3LS40MSAwLS43Ny4xNS0xLjA4LjQ1LS4zMS4yOS0uNS43My0uNTcgMS4zem0zLjAxIDIuMjNjLjMxLjI0LjYxLjQzLjkyLjU3LjMuMTMuNjMuMi45OC4yLjM4IDAgLjY1LS4wOC44My0uMjNzLjI3LS4zNS4yNy0uNmMwLS4xNC0uMDUtLjI2LS4xMy0uMzctLjA4LS4xLS4yLS4yLS4zNC0uMjgtLjE0LS4wOS0uMjktLjE2LS40Ny0uMjNsLS41My0uMjJjLS4yMy0uMDktLjQ2LS4xOC0uNjktLjMtLjIzLS4xMS0uNDQtLjI0LS42Mi0uNHMtLjMzLS4zNS0uNDUtLjU1Yy0uMTItLjIxLS4xOC0uNDYtLjE4LS43NSAwLS42MS4yMy0xLjEuNjgtMS40OS40NC0uMzggMS4wNi0uNTcgMS44My0uNTcuNDggMCAuOTEuMDggMS4yOS4yNXMuNzEuMzYuOTkuNTdsLS43NC45OGMtLjI0LS4xNy0uNDktLjMyLS43My0uNDItLjI1LS4xMS0uNTEtLjE2LS43OC0uMTYtLjM1IDAtLjYuMDctLjc2LjIxLS4xNy4xNS0uMjUuMzMtLjI1LjU0IDAgLjE0LjA0LjI2LjEyLjM2cy4xOC4xOC4zMS4yNmMuMTQuMDcuMjkuMTQuNDYuMjFsLjU0LjE5Yy4yMy4wOS40Ny4xOC43LjI5cy40NC4yNC42NC40Yy4xOS4xNi4zNC4zNS40Ni41OC4xMS4yMy4xNy41LjE3LjgyIDAgLjMtLjA2LjU4LS4xNy44My0uMTIuMjYtLjI5LjQ4LS41MS42OC0uMjMuMTktLjUxLjM0LS44NC40NS0uMzQuMTEtLjcyLjE3LTEuMTUuMTctLjQ4IDAtLjk1LS4wOS0xLjQxLS4yNy0uNDYtLjE5LS44Ni0uNDEtMS4yLS42OHoiIGZpbGw9IiM1MzUzNTMiLz48L2c+PC9zdmc+"></a></p><div><h3 id="citeas">Cite this article</h3><p>Hurowitz, J.A., Tice, M.M., Allwood, A.C. <i>et al.</i> Redox-driven mineral and organic associations in Jezero Crater, Mars.
                    <i>Nature</i> <b>645</b>, 332–340 (2025). https://doi.org/10.1038/s41586-025-09413-0</p><p><a data-test="citation-link" data-track="click" data-track-action="download article citation" data-track-label="link" data-track-external="" rel="nofollow" href="https://citation-needed.springer.com/v2/references/10.1038/s41586-025-09413-0?format=refman&amp;flavour=citation">Download citation</a></p><ul data-test="publication-history"><li><p>Received<span>: </span><span><time datetime="2024-11-13">13 November 2024</time></span></p></li><li><p>Accepted<span>: </span><span><time datetime="2025-07-15">15 July 2025</time></span></p></li><li><p>Published<span>: </span><span><time datetime="2025-09-10">10 September 2025</time></span></p></li><li><p>Issue Date<span>: </span><span><time datetime="2025-09-11">11 September 2025</time></span></p></li><li><p><abbr title="Digital Object Identifier">DOI</abbr><span>: </span><span>https://doi.org/10.1038/s41586-025-09413-0</span></p></li></ul></div></div></div>
            </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Charlie Kirk shot at event in Utah (674 pts)]]></title>
            <link>https://www.nbcnews.com/news/us-news/live-blog/live-updates-shooting-charlie-kirk-event-utah-rcna230437</link>
            <guid>45202200</guid>
            <pubDate>Wed, 10 Sep 2025 19:02:48 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.nbcnews.com/news/us-news/live-blog/live-updates-shooting-charlie-kirk-event-utah-rcna230437">https://www.nbcnews.com/news/us-news/live-blog/live-updates-shooting-charlie-kirk-event-utah-rcna230437</a>, See on <a href="https://news.ycombinator.com/item?id=45202200">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="liveBlogCards" data-testid="live-blog-posts"><div id="rcrd88079" data-testid="intersection-observer"><h2 data-testid="chat-card-headline">No suspect in custody, university says</h2><div data-testid="chat-card-authors-container"><p><span data-testid="chatCardByline-name"><span><span>Lindsay Good</span></span></span> and <span data-testid="chatCardByline-name"><span><span>Doha Madani</span></span></span></p></div><div data-icid="live-blog-card-link" data-testid="chat-card-body-container"><p>Authorities do not have a suspect in custody, according to Utah Valley University spokesperson Ellen Treanor.</p><p>The school had said earlier in an alert that police had detained a suspect.</p></div></div><div id="rcrd88076" data-testid="chat-card-container"><h2 data-testid="chat-card-headline">No security to get into Kirk's event, bystander says</h2><div data-icid="live-blog-card-link" data-testid="chat-card-body-container"><p>Despite the large crowd Kirk drew to Utah Valley University, witness Tyler McGettigan said he was surprised that he didn't have to pass any security to get in. </p><p>The event required a ticket with a scannable code, which McGettigan told NBC News that he printed out and brought with him. But he said that he didn't need it to get into the amphitheater where Kirk was speaking. </p><p>"I was expecting when I got here that I'd have to pass through some kind of security, but that just wasn't a thing," McGettigan said. "No one checked the barcode or the QR code. There was no checkpoint to get in. It was literally, anyone could walk in if they wanted." </p></div></div><div id="rcrd88078" data-testid="chat-card-container"><h2 data-testid="chat-card-headline">Suspect shot Kirk from nearby building, university says</h2><div data-testid="chat-card-authors-container"><div data-testid="author-thumbnails"><picture data-testid="picture" data-flavor="focal" data-original-height="48" data-original-width="48"><source media="(min-width: 320px)" srcset="https://media-cldnry.s-nbcnews.com/image/upload/t_focal-60x60,f_avif,q_auto:eco,dpr_2/newscms/2022_46/3581062/matt-lavietes-byline-jm.jpg 2x, https://media-cldnry.s-nbcnews.com/image/upload/t_focal-60x60,f_auto,q_auto:best/newscms/2022_46/3581062/matt-lavietes-byline-jm.jpg 1x"><img loading="lazy" src="https://media-cldnry.s-nbcnews.com/image/upload/t_focal-60x60,f_auto,q_auto:best/newscms/2022_46/3581062/matt-lavietes-byline-jm.jpg" alt="" height="48" width="48"></picture></div><p><span data-testid="chatCardByline-name"><span><span>Lindsay Good</span></span></span> and <span data-testid="chatCardByline-name"><span><span>Matt Lavietes</span></span></span></p></div><div data-icid="live-blog-card-link" data-testid="chat-card-body-container"><p>A spokesperson for Utah Valley University said in a statement that the suspect shot Kirk from the university's Losee Center, roughly 200 feet away from where he was sitting.  </p><p>The suspect, who has been taken into custody, is not a student, the spokesperson added.</p></div></div><div id="rcrd88077" data-testid="chat-card-container"><h2 data-testid="chat-card-headline">Vance shares photo with Kirk</h2><div data-testid="chat-card-authors-container"><p><span data-testid="chatCardByline-name"><span><span>Ben Kamisar</span></span></span> and <span data-testid="chatCardByline-name"><span><span>Henry J. Gomez</span></span></span></p></div><div data-icid="live-blog-card-link" data-testid="chat-card-body-container"><p>Vice President JD Vance shared a photo of him with Charlie Kirk, as well as Donald Trump Jr. and political aide Andy Surabian, as he asked for prayers for Kirk after he was shot. </p><p>Kirk is a well-known conservative activist who is close with key members of President Trump's political operation, including Vance and Donald Trump Jr. And Kirk helped push for Vance to be chosen as Trump's running mate, <a href="https://www.nbcnews.com/politics/donald-trump/trump-chose-jd-vance-running-mate-vp-pick-rcna161982" target="_blank">NBC News reported at the time</a>.  </p></div></div><div id="rcrd88075" data-testid="chat-card-container"><h2 data-testid="chat-card-headline">Utah Valley University cancels classes, tells people to leave campus</h2><div data-icid="live-blog-card-link" data-testid="chat-card-body-container"><p>Campus is closed and classes are canceled until further notice at Utah Valley University. </p><p>The school urged everyone to leave campus immediately <a href="https://x.com/UVU/status/1965862097624957395" target="_blank">in a post on X </a>following the shooting. </p></div></div><div id="rcrd88074" data-testid="chat-card-container"><h2 data-testid="chat-card-headline">Kirk is shot and hospitalized, Turning Point USA says</h2><div data-testid="chat-card-authors-container"><div data-testid="author-thumbnails"><picture data-testid="picture" data-flavor="focal" data-original-height="48" data-original-width="48"><source media="(min-width: 320px)" srcset="https://media-cldnry.s-nbcnews.com/image/upload/t_focal-60x60,f_avif,q_auto:eco,dpr_2/newscms/2025_34/3701353/image_17.png 2x, https://media-cldnry.s-nbcnews.com/image/upload/t_focal-60x60,f_auto,q_auto:best/newscms/2025_34/3701353/image_17.png 1x"><img loading="lazy" src="https://media-cldnry.s-nbcnews.com/image/upload/t_focal-60x60,f_auto,q_auto:best/newscms/2025_34/3701353/image_17.png" alt="" height="48" width="48"></picture></div><p><span data-testid="chatCardByline-name"><span><span>Doha Madani</span></span></span> and <span data-testid="chatCardByline-name"><span><span>Cristian Santana</span></span></span></p></div><div data-icid="live-blog-card-link" data-testid="chat-card-body-container"><p>A spokesperson for Turning Point USA confirmed to NBC News that Kirk has been shot.</p><p>"He is in the hospital, and we are praying for him at this time," the organization said.</p></div></div><div id="rcrd88069" data-testid="chat-card-container"><h2 data-testid="chat-card-headline">Witness describes a loud shot and 'a bunch of blood'</h2><div data-testid="chat-card-authors-container"><div data-testid="author-thumbnails"><picture data-testid="picture" data-flavor="focal" data-original-height="48" data-original-width="48"><source media="(min-width: 320px)" srcset="https://media-cldnry.s-nbcnews.com/image/upload/t_focal-60x60,f_avif,q_auto:eco,dpr_2/newscms/2024_26/3653062/240627-ben-kamisar.jpg 2x, https://media-cldnry.s-nbcnews.com/image/upload/t_focal-60x60,f_auto,q_auto:best/newscms/2024_26/3653062/240627-ben-kamisar.jpg 1x"><img loading="lazy" src="https://media-cldnry.s-nbcnews.com/image/upload/t_focal-60x60,f_auto,q_auto:best/newscms/2024_26/3653062/240627-ben-kamisar.jpg" alt="" height="48" width="48"></picture></div><p><span data-testid="chatCardByline-name"><span><span>Doha Madani</span></span></span> and <span data-testid="chatCardByline-name"><span><span>Ben Kamisar</span></span></span></p></div><div data-icid="live-blog-card-link" data-testid="chat-card-body-container"><p>Justin Hickens, who said he was about 20 yards from the shooting, told NBC News’ Tom Llamas that he saw Kirk get hit after a gunshot rang out during the event at Utah Valley University. </p><p>“We heard a big loud shot, I saw a bunch of blood come out of Charlie, I saw his body kind of kick back and go limp, and everybody dropped to the ground,” Hickens said. </p><p>After a few moments, people started running out of the outdoor pavilion area, knocking over barricades. Hickens said he slowed down once he realized there were no more shots being fired and he felt safe. </p><p>"I kind of turned around and all of a sudden I saw officers walking with this very elderly gentleman with white hair," Hickens said. "They had him arrested, they had him on his knees and he was screaming about his rights and all that stuff. They cuffed him and put him away."  </p><p>There was no metal detectors to get into the event, Hickens said, though there was security by Kirk himself. </p></div></div><div id="rcrd88071" data-testid="chat-card-container"><h2 data-testid="chat-card-headline">Trump has often complimented, appeared with Kirk</h2><div data-testid="chat-card-authors-container"><div data-testid="author-thumbnails"><div data-testid="chat-card-byline-thumbnail"><picture data-testid="picture" data-flavor="focal" data-original-height="48" data-original-width="48"><source media="(min-width: 320px)" srcset="https://media-cldnry.s-nbcnews.com/image/upload/t_focal-60x60,f_avif,q_auto:eco,dpr_2/newscms/2024_31/3656901/240729-sarah-dean.jpg 2x, https://media-cldnry.s-nbcnews.com/image/upload/t_focal-60x60,f_auto,q_auto:best/newscms/2024_31/3656901/240729-sarah-dean.jpg 1x"><img loading="lazy" src="https://media-cldnry.s-nbcnews.com/image/upload/t_focal-60x60,f_auto,q_auto:best/newscms/2024_31/3656901/240729-sarah-dean.jpg" alt="" height="48" width="48"></picture></div><p>+2</p></div><p><span data-testid="chatCardByline-name"><span><span>Sarah Dean</span></span></span>, <span data-testid="chatCardByline-name"><span><span>Megan Shannon</span></span></span> and <span data-testid="chatCardByline-name"><span><span>Alexandra Marquez</span></span></span></p></div><div data-icid="live-blog-card-link" data-testid="chat-card-body-container"><p>President Donald Trump has often spoken favorably about Kirk, including multiple times on the campaign trail last year.</p><p>During a rally in Washington the day before he was sworn in to a second term in January, Trump told attendees: "Charlie Kirk is here. And I want to thank Charlie. Charlie is fantastic. I mean, this guy."</p><p>A few weeks before, during a rally in Las Vegas on Dec. 22, 2024, Trump called Kirk "incredible," adding that he "is a special talent, and he’s out there fighting."</p><p>The president, then a candidate for the White House, also appeared last October at a Turning Point USA political rally in Phoenix.</p><p>"I want to express my tremendous gratitude to Charlie Kirk. He’s really an amazing guy. Amazing guy," Trump said.</p><p>The president, on the campaign trail last June, also lauded Kirk at a Turning Point Action town hall in Phoenix, saying, "I want to thank a special person, Charlie Kirk, for his tremendous leadership."</p></div></div><div id="rcrd88068" data-testid="chat-card-container"><h2 data-testid="chat-card-headline">Who is Charlie Kirk: A prominent young conservative activist </h2><div data-icid="live-blog-card-link" data-testid="chat-card-body-container"><p>Kirk is a 31-year-old conservative activist and father of two who helped found Turning Point USA, a prominent nonprofit that activates conservative youth on school campuses. </p><p>A well-known supporter of President Donald Trump and a close ally of many in his circle, Kirk spoke at the 2024 presidential convention just days after an assassination attempt on Trump. </p></div></div><div id="rcrd88066" data-testid="chat-card-container"><h2 data-testid="chat-card-headline">Elected officials react to reports of shooting, ask for thoughts and prayers for Kirk family</h2><div data-testid="chat-card-authors-container"><p><span data-testid="chatCardByline-name"><span><span>Alexandra Marquez</span></span></span> and <span data-testid="chatCardByline-name"><span><span>Rebecca Kaplan</span></span></span></p></div><div data-icid="live-blog-card-link" data-testid="chat-card-body-container"><p>Lawmakers on both sides of the aisle reacted to reports that Charlie Kirk had been shot, with many sending prayers to the Kirk family.</p><p>"Pls join me in praying for Charlie Kirk," Sen. Chuck Grassley, R-Iowa, <a href="https://x.com/ChuckGrassley/status/1965853091942814054" target="_blank">said</a> in a post on X.</p><p>"Our prayers are with Charlie Kirk," Sen. Ted Cruz, R-Texas, <a href="https://x.com/tedcruz/status/1965850719409549746" target="_blank">said</a>, also on X.</p><p>Rep. Marjorie Taylor Greene, R-Ga., <a href="https://x.com/RepMTG/status/1965849464637399481" target="_blank">wrote</a> in her own post that, "Charlie Kirk has been shot!&nbsp;Pray for him!"</p><p>Several other senators, who were in and around the U.S. Capitol during the shooting, reacted to the news.</p><p>"Charlie is a very, actually, a very good friend of mine. It's, it scares you to death for he and his family," Sen. Rick Scott, R-Fla., told reporters,</p><p>Sen. John Cornyn, R-Texas, told reporters that news of the shooting was, "shocking and tragic."</p><p>"We’re all praying Charlie is going to be okay," Cornyn added.</p><p>Among notable Democrats, California Gov. Gavin Newsom also weighed in on X, <a href="https://x.com/GavinNewsom/status/1965851236630192261" target="_blank">writing</a>, "The attack on Charlie Kirk is disgusting, vile, and reprehensible. In the United States of America, we must reject political violence in EVERY form."</p><p>Sen. Ruben Gallego, D-Ariz., also posted about the shooting, writing on X that the news is "horrific."</p><p>"Let’s hope he is well and keep him and his families in your prayers," Gallego added.</p><p>Sen. Mark Kelly, D-Ariz., wrote in his own post on X that, "The news that Charlie Kirk was shot while speaking in Utah is shocking and horrible. It’s an example of political violence that has no place in our country."</p><p>Kelly added that he and his wife, former Rep. Gabby Giffords, who was the victim of a shooting in 2010, are "thinking of him and his family."</p><p>Sen. Chris Murphy, D-Conn., was giving a speech on the Senate floor this afternoon and addressed reports of the shooting, saying that, "we are all horrified watching images and following the news out of Utah, and we are sending all of our thoughts to Mr. Kirk, to his family, to survivors there."</p></div></div><div id="rcrd88064" data-testid="chat-card-container"><h2 data-testid="chat-card-headline">Utah Valley is the state's largest public university </h2><div data-icid="live-blog-card-link" data-testid="chat-card-body-container"><p>While <a href="https://kslsports.com/ncaa/utah/introducing-the-big-12-to-the-byu-utah-football-rivalry-brief-rundown-of-the-series-2/529774" target="_blank">BYU, the University of Utah</a> and Utah Valley are probably the best-known schools in Utah, UVU calls itself the<a href="https://www.uvu.edu/about/" target="_blank"> Beehive State’s biggest </a>public university with more than 46,000 students.</p><p>The school was<a href="https://www.uvu.edu/visitors/history.html" target="_blank">&nbsp;established in 1941</a> as Central Utah Vocational School&nbsp;and renamed Utah Valley College in 1993.</p><p>The Orem institution is about 40 miles south of the state capital, Salt Lake City.</p></div></div><div id="rcrd88067" data-testid="chat-card-container"><h2 data-testid="chat-card-headline">Trump addresses shooting</h2><div data-icid="live-blog-card-link" data-testid="chat-card-body-container"><p>President Donald Trump just addressed the shooting on his social media site, Truth Social.</p><p>"We must all pray for Charlie Kirk, who has been shot," <a href="https://truthsocial.com/@realDonaldTrump" target="_blank">Trump wrote</a>. "A great guy from top to bottom. GOD BLESS HIM!"</p></div></div><div id="rcrd88065" data-testid="chat-card-container"><h2 data-testid="chat-card-headline">Suspect in custody, university says</h2><div data-icid="live-blog-card-link" data-testid="chat-card-body-container"><p>A suspect is in custody and police are investigating the shooting, Utah Valley University told students in an alert this afternoon.</p></div></div><div id="rcrd88063" data-testid="chat-card-container"><h2 data-testid="chat-card-headline">Videos online show Kirk recoiling after shot heard</h2><div data-icid="live-blog-card-link" data-testid="chat-card-body-container"><p>Videos circulating across social media show the moment a shot is heard in the crowd. </p><p>Kirk was sat in a tent with the "American Comeback Tour" logo when a shot is heard and Kirk physically recoils, slumping down in his seat. Blood is seen flowing down from his neck and the crowd audibly panics and begins to run. </p></div></div><div id="rcrd88062" data-testid="chat-card-container"><h2 data-testid="chat-card-headline">FBI monitoring shooting reports; Vance asks people to pray for Kirk</h2><div data-icid="live-blog-card-link" data-testid="chat-card-body-container"><p>The FBI is closely monitoring reports of a shooting involving Kirk, according to FBI Director Kash Patel. </p><p>"Our thoughts are with Charlie, his loved ones, and everyone affected," Patel wrote in a post on X. "Agents will be on the scene quickly and the FBI stands in full support of the ongoing response and investigation."</p><p>Vice President JD Vance responded to reports that Kirk was shot, encouraging others to "say a prayer" for the right-wing activist in a post on X. </p></div></div><div id="rcrd88059" data-testid="chat-card-container"><h2 data-testid="chat-card-headline">Kirk on campus for 'American Comeback Tour' appearance</h2><div data-icid="live-blog-card-link" data-testid="chat-card-body-container"><p>Kirk was being hosted by the Utah Valley University chapter of Turning Point USA. </p><p>The organization's website shows a series of dates at college campuses across the country. The University of Minesosta at Northrop described it as a "high-energy evening featuring a candid conversation about conservative values." </p></div></div><div id="rcrd88061" data-testid="chat-card-container"><h2 data-testid="chat-card-headline">Kirk was the only person shot, university says</h2><div data-icid="live-blog-card-link" data-testid="chat-card-body-container"><p>A spokesperson for Utah Valley University said that Kirk was the sole person shot at the event.</p></div></div><div id="rcrd88057" data-testid="chat-card-container"><h2 data-testid="chat-card-headline">Sen. Mike Lee says he's 'praying for Charlie Kirk' </h2></div><div id="rcrd88058" data-testid="chat-card-container"><h2 data-testid="chat-card-headline">Charlie Kirk taken off campus after shots heard, university says</h2><div data-testid="chat-card-authors-container"><p><span data-testid="chatCardByline-name"><span><span>Doha Madani</span></span></span> and <span data-testid="chatCardByline-name"><span><span>Lindsay Good</span></span></span></p></div><div data-icid="live-blog-card-link" data-testid="chat-card-body-container"><p>Turning Point USA founder Charlie Kirk was about 20 minutes into a presentation when witnesses heard shots fired from a nearby building, a spokesperson for Utah Valley University told NBC News.</p><p>The spokesperson said, to the best of the university's knowledge, Kirk was hit and taken with his security team away from the premises, and the courtyard was cleared.</p></div></div></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Defeating Nondeterminism in LLM Inference (189 pts)]]></title>
            <link>https://thinkingmachines.ai/blog/defeating-nondeterminism-in-llm-inference/</link>
            <guid>45200925</guid>
            <pubDate>Wed, 10 Sep 2025 17:26:08 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://thinkingmachines.ai/blog/defeating-nondeterminism-in-llm-inference/">https://thinkingmachines.ai/blog/defeating-nondeterminism-in-llm-inference/</a>, See on <a href="https://news.ycombinator.com/item?id=45200925">Hacker News</a></p>
<div id="readability-page-1" class="page"><article>
    
    <nav id="left-toc" aria-label="Table of contents"></nav>
    
    <p>Reproducibility is a bedrock of scientific progress. However, it’s remarkably difficult to get reproducible results out of large language models.</p>
<p>For example, you might observe that asking ChatGPT the same question multiple times provides different results. This by itself is not surprising, since getting a result from a language model involves “sampling”, a process that converts the language model’s output into a probability distribution and probabilistically selects a token.</p>
<p>What might be more surprising is that even when we adjust the temperature down to 0<label for="sn1"></label><span>This means that the LLM always chooses the highest probability token, which is called greedy sampling.</span> (thus making the sampling theoretically deterministic), LLM APIs are still <strong>not</strong> deterministic in practice (see past discussions <a href="https://152334h.github.io/blog/non-determinism-in-gpt-4/">here</a>, <a href="https://community.openai.com/t/a-question-on-determinism/8185/2">here</a>, or <a href="https://cookbook.openai.com/examples/reproducible_outputs_with_the_seed_parameter">here</a>). Even when running inference on your own hardware with an OSS inference library like vLLM or SGLang, sampling still isn’t deterministic (see <a href="https://docs.vllm.ai/en/v0.7.0/getting_started/faq.html">here</a> or <a href="https://docs.sglang.ai/references/faq.html">here</a>).</p>
<p>But why <em>aren’t</em> LLM inference engines deterministic? One common hypothesis is that some combination of floating-point non-associativity and concurrent execution leads to nondeterminism based on which concurrent core finishes first. We will call this the “concurrency + floating point” hypothesis for LLM inference nondeterminism. For example, <a href="https://arxiv.org/abs/2506.09501">a recent arXiv preprint</a> writes:</p>
<blockquote>
<p>Floating-point arithmetic in GPUs exhibits non-associativity, meaning $(a + b) + c \neq a + (b + c)$ due to finite precision and rounding errors. This property directly impacts the computation of attention scores and logits in the transformer architecture, where parallel operations across multiple threads can yield different results based on execution order.</p>
</blockquote>
<p><label for="mn1"></label>
<span>You can also find the “concurrency + floating point” hypothesis repeated by others, like <a href="https://community.openai.com/t/a-question-on-determinism/8185">here</a> (<i>“There are speed tradeoffs, and in order to make the endpoints fast GPUs are used, which do parallel [nondeterministic] calculations. Any modern GPU neural net calculations will be subject to these."</i>), or <a href="https://x.com/hosseeb/status/1773146428594090473">here</a> (<i>“Because GPUs are highly parallelized, the ordering of additions or multiplications might be different on each execution, which can cascade into small differences in output."</i>).</span></p>
<p>While this hypothesis is not entirely wrong, it doesn’t reveal the full picture. For example, even on a GPU, running the same matrix multiplication on the same data repeatedly will always provide bitwise equal results. We’re definitely using floating-point numbers. And our GPU definitely has a lot of concurrency. Why don’t we see nondeterminism in this test?</p>
<div><pre tabindex="0"><code data-lang="python"><span><span><span>A</span> <span>=</span> <span>torch</span><span>.</span><span>randn</span><span>(</span><span>2048</span><span>,</span> <span>2048</span><span>,</span> <span>device</span><span>=</span><span>'cuda'</span><span>,</span> <span>dtype</span><span>=</span><span>torch</span><span>.</span><span>bfloat16</span><span>)</span>
</span></span><span><span><span>B</span> <span>=</span> <span>torch</span><span>.</span><span>randn</span><span>(</span><span>2048</span><span>,</span> <span>2048</span><span>,</span> <span>device</span><span>=</span><span>'cuda'</span><span>,</span> <span>dtype</span><span>=</span><span>torch</span><span>.</span><span>bfloat16</span><span>)</span>
</span></span><span><span><span>ref</span> <span>=</span> <span>torch</span><span>.</span><span>mm</span><span>(</span><span>A</span><span>,</span> <span>B</span><span>)</span>
</span></span><span><span><span>for</span> <span>_</span> <span>in</span> <span>range</span><span>(</span><span>1000</span><span>):</span>
</span></span><span><span>    <span>assert</span> <span>(</span><span>torch</span><span>.</span><span>mm</span><span>(</span><span>A</span><span>,</span> <span>B</span><span>)</span> <span>-</span> <span>ref</span><span>)</span><span>.</span><span>abs</span><span>()</span><span>.</span><span>max</span><span>()</span><span>.</span><span>item</span><span>()</span> <span>==</span> <span>0</span>
</span></span></code></pre></div><p>To understand the true cause of LLM inference nondeterminism, we must look deeper.</p>
<p>Unfortunately, even <em>defining</em> what it means for LLM inference to be deterministic is difficult. Perhaps confusingly, the following statements are all simultaneously true:</p>
<ol>
<li>Some kernels on GPUs are <b>nondeterministic</b>.</li>
<li>However, all the kernels used in a language model’s forward pass are <b>deterministic</b>.</li>
<li>Moreover, the forward pass of an LLM inference server (like vLLM) can also be claimed to be <b>deterministic</b>.</li>
<li>Nevertheless, from the perspective of anybody using the inference server, the results are <b>nondeterministic</b>.</li>
</ol>
<p>In this post, we will explain why the “concurrency + floating point” hypothesis misses the mark, unmask the true culprit behind LLM inference nondeterminism, and explain how to defeat nondeterminism and obtain truly reproducible results in LLM inference.</p>
<h2 id="the-original-sin-floating-point-non-associativity">The original sin: floating-point non-associativity</h2>
<p>Before talking about nondeterminism, it’s useful to explain why there are numerical differences at all. After all, we typically think of machine learning models as mathematical functions following structural rules such as commutativity or associativity. Shouldn’t there be a “mathematically correct” result that our machine learning libraries should provide us?</p>
<p>The culprit is <strong>floating-point non-associativity.</strong> That is, with floating-point numbers:</p>
$$ (a + b) + c \neq a + (b + c) $$<div><pre tabindex="0"><code data-lang="python"><span><span><span>(</span><span>0.1</span> <span>+</span> <span>1e20</span><span>)</span> <span>-</span> <span>1e20</span>
</span></span><span><span><span>&gt;&gt;&gt;</span> <span>0</span>
</span></span><span><span><span>0.1</span> <span>+</span> <span>(</span><span>1e20</span> <span>-</span> <span>1e20</span><span>)</span>
</span></span><span><span><span>&gt;&gt;&gt;</span> <span>0.1</span>
</span></span></code></pre></div><p>Ironically, breaking associativity is what makes floating-point numbers useful.</p>
<p>Floating-point numbers are useful because they allow for a “dynamic” level of precision. For the purposes of explanation, we will use base 10 (instead of binary), where floating-point numbers are in the format $\text{mantissa} * 10^\text{exponent}$. We will also use 3 digits for the mantissa and 1 digit for the exponent.</p>
<p>For example, for the value 3450, we can represent it exactly as $3.45 * 10^3$. We can also represent much smaller values like 0.486 as $4.86 * 10^{-1}$. In this way, floating point allows us to represent both very small as well as very large values. In the sciences, we might say that floating point allows us to maintain a constant number of “significant figures”.</p>
<p>If you add together two floating-point numbers with the same exponent, it looks similar to integer addition. For example, 123 ($1.23 * 10^2$) + 456 ($4.56 * 10^2$) results in 579 ($5.79 * 10^2$).</p>
<p>But what happens when we add two floating-point numbers with different exponents, such as 1230 and 23.4?  In this case, the exact result is 1253.4. However, we can only maintain 3 digits of precision at a time. Floating-point addition will thus <em>drop</em> the last 2 digits and obtain the value $1.25 * 10^3$ (or 1250).</p>
<figure>
<div>
        <div>
            <p>1.23 × 10²</p>
        </div>
        <p>+</p>
        <div>
            <p>3.45 × 10¹</p>
        </div>
        <p>=</p>
        <div>
            <p>1.57<span>5</span> × 10²</p>
            <p>Exact: 1575</p>
        </div>
    </div>
<!-- javascript must go below figure html -->


<figcaption>We require 3 digits of precision to represent 1230 and 3 digits of precision to represent 23.4. However, adding these 2 numbers together results in a number that requires 5 digits of precision to represent (1253.4). Our floating-point format must then drop the 34 off the end. In some sense, we have effectively rounded our original 23.4 to 20.0 before adding it. </figcaption>
</figure>
<p>At this point, however, we’ve destroyed information. Note that this can happen every time we add two floating-point numbers with different “scales” (i.e. different exponents). And adding together floating-point numbers with different exponents happens all of the time. In fact, if we could guarantee that we never needed different exponents, we could just use integers!</p>
<p>In other words, every time we add together floating-point numbers in a different order, we can get a completely different result. To take an extreme example, there are 102 possible different results for summing this array depending on the order.</p>
<div><pre tabindex="0"><code data-lang="python"><span><span><span>import</span> <span>random</span>
</span></span><span><span>
</span></span><span><span><span>vals</span> <span>=</span> <span>[</span><span>1e-10</span><span>,</span> <span>1e-5</span><span>,</span> <span>1e-2</span><span>,</span> <span>1</span><span>]</span>
</span></span><span><span><span>vals</span> <span>=</span> <span>vals</span> <span>+</span> <span>[</span><span>-</span><span>v</span> <span>for</span> <span>v</span> <span>in</span> <span>vals</span><span>]</span>
</span></span><span><span>
</span></span><span><span><span>results</span> <span>=</span> <span>[]</span>
</span></span><span><span><span>random</span><span>.</span><span>seed</span><span>(</span><span>42</span><span>)</span>
</span></span><span><span><span>for</span> <span>_</span> <span>in</span> <span>range</span><span>(</span><span>10000</span><span>):</span>
</span></span><span><span>    <span>random</span><span>.</span><span>shuffle</span><span>(</span><span>vals</span><span>)</span>
</span></span><span><span>    <span>results</span><span>.</span><span>append</span><span>(</span><span>sum</span><span>(</span><span>vals</span><span>))</span>
</span></span><span><span>
</span></span><span><span><span>results</span> <span>=</span> <span>sorted</span><span>(</span><span>set</span><span>(</span><span>results</span><span>))</span>
</span></span><span><span><span>print</span><span>(</span><span>f</span><span>"There are </span><span>{</span><span>len</span><span>(</span><span>results</span><span>)</span><span>}</span><span> unique results: </span><span>{</span><span>results</span><span>}</span><span>"</span><span>)</span>
</span></span><span><span>
</span></span><span><span><span># Output:</span>
</span></span><span><span><span># There are 102 unique results: [-8.326672684688674e-17, -7.45931094670027e-17, ..., 8.326672684688674e-17]</span>
</span></span></code></pre></div><p>Although this is the underlying cause for non-identical outputs, it does not directly answer where the nondeterminism comes from. It doesn’t help us understand why floating-point values get added in different orders, when that happens, nor how it can be avoided.</p>
<p>The answers lie in how kernels are implemented.</p>
<h2 id="why-dont-kernels-always-add-numbers-in-the-same-order">Why don’t kernels always add numbers in the same order?</h2>
<p>As mentioned above, one common explanation for why kernels add numbers in different orders is the “concurrency + floating point” hypothesis. The hypothesis states that if the order in which concurrent threads finish is nondeterministic and the accumulation order depends on the order in which concurrent threads finish (such as with an atomic add), our accumulation order will be nondeterministic as well.</p>
<p>Confusingly, although this can lead to nondeterministic kernels, concurrency (and atomic adds) end up being completely uninvolved in LLM inference nondeterminism! To explain what the real culprit is, let’s first understand why modern GPU kernels rarely need atomic adds.</p>
<h2 id="when-are-atomic-adds-needed">When are atomic adds needed?</h2>
<p>Typically a GPU launches a program concurrently across many “cores” (i.e. SMs). As the cores have no inherent synchronization among them, this poses a challenge if the cores need to communicate among each other. For example, if all cores must accumulate to the same element, you can use an “atomic add” (sometimes known as a “<a href="https://en.wikipedia.org/wiki/Fetch-and-add">fetch-and-add</a>”). The atomic add is “nondeterministic” — the order in which the results accumulate is purely dependent on which core finishes first.</p>
<p>Concretely, imagine that you are reducing a 100-element vector with 100 cores (e.g. <code>torch.sum()</code>). Although you can load all 100 elements in parallel, we must eventually reduce down to a single element. One way to accomplish this is with some kind of “atomic add” primitive, where the hardware guarantees that all additions will be processed but does not guarantee the order.</p>
<figure>



<figcaption> The atomic add ensures that every core's contributions will be reflected in the final sum. However, it makes no guarantee about what <i>order</i> the contributions will be added. The order depends entirely on which core finishes first, a nondeterministic property. Thus, executing the same parallel program multiple times can result in nondeterministic outputs. </figcaption>
</figure>
<p>This is usually what folks mean by “nondeterminism” — you execute the same kernel twice with exactly the same inputs and you get a different result out. This is known as <i>run-to-run nondeterminism</i>, where you run the same python script twice with the exact same dependencies but get a different result.</p>
<p>Although concurrent atomic adds <strong>do</strong> make a kernel nondeterministic, <i>atomic adds are not necessary for the vast majority of kernels.</i> In fact, in the typical forward pass of an LLM, there is usually <i>not a single atomic add present.</i></p>
<p>This may be surprising, given that parallelizing a reduction can benefit from atomic adds. There are two main reasons why atomic adds do not end up being needed.</p>
<ol>
<li>There is often sufficient parallelism along the “batch” dimension that we don’t need to parallelize along the reduction dimension. For example, let’s say that instead of reducing a single 100-dim vector we were reducing 500 vectors in parallel. In this case, we can reduce an entire vector in each core and allow every core to operate on a different vector.</li>
<li>Over time, most neural network libraries have adopted a variety of strategies for achieving determinism without sacrificing performance. For example, we can perform a “split” (or tree) reduction, where we split the 100-element reduction into five 20-element reductions (thus achieving five-way parallelism). Then, to combine the remaining five elements, we can either perform a separate “clean-up” reduction (which isn’t parallelized, but operates over few enough elements to be cheap) or utilize a semaphore (which ensures that each concurrent thread-block will accumulate in a deterministic order).<label for="sn2"></label><span>The semaphore strategy can be found described <a href="https://github.com/NVIDIA/cutlass/issues/1421#issuecomment-2016942675">here</a>.</span></li>
</ol>
<p>Due to these two factors, avoiding atomics adds is a negligible performance penalty for the vast majority of neural network operations.</p>
<p>There are still a couple of common operations that have significant performance penalties for avoiding atomics. For example, <code>scatter_add</code> in PyTorch (<code>a[b] += c</code>). The only one commonly used in LLMs, however, is FlashAttention backward.<label for="sn3"></label><span>Fun fact: did you know that the widely used Triton implementations of FlashAttention backward actually differ algorithmically from Tri Dao’s FlashAttention-2 <a href="https://arxiv.org/abs/2307.08691">paper</a>? The standard Triton implementation does additional recomputation in the backward pass, avoiding atomics but costing 40% more FLOPs!</span></p>
<p>However, the forward pass of an LLM involves <i>no operations that require atomic adds.</i> Thus, the forward pass in an LLM is in fact “run-to-run deterministic.”</p>
<figure>
<svg width="600" height="250" viewBox="0 0 600 250" fill="none" xmlns="http://www.w3.org/2000/svg">

<rect width="600" height="250" fill="#F5F5F5"></rect>
<rect width="600" height="250" fill="white"></rect>
<g filter="url(#filter0_f_249_8276-deterministic-svg)">
<rect x="269" y="44" width="166" height="163" rx="4" fill="#EAF4BF"></rect>
</g>
<g filter="url(#filter1_d_249_8276-deterministic-svg)">
<rect x="311" y="86" width="82" height="82" rx="4" fill="white" shape-rendering="crispEdges"></rect>
<rect x="310.5" y="85.5" width="83" height="83" rx="4.5" stroke="black" stroke-opacity="0.2" shape-rendering="crispEdges"></rect>
<text fill="#393939" xml:space="preserve" style="white-space: pre" font-family="GT America" font-size="15" letter-spacing="0em"><tspan x="331" y="132.565">Model</tspan></text>
</g>
<text fill="#5A850C" xml:space="preserve" style="white-space: pre" font-family="GT America" font-size="15" letter-spacing="0em"><tspan x="279" y="65.065">Deterministic</tspan></text>
<g filter="url(#filter2_d_249_8276-deterministic-svg)">
<rect x="67" y="47" width="115" height="35" rx="4" fill="white" shape-rendering="crispEdges"></rect>
<rect x="66.5" y="46.5" width="116" height="36" rx="4.5" stroke="black" stroke-opacity="0.2" shape-rendering="crispEdges"></rect>
<text fill="#393939" xml:space="preserve" style="white-space: pre" font-family="GT America" font-size="15" letter-spacing="0em"><tspan x="77" y="70.065">User requests</tspan></text>
</g>
<g filter="url(#filter3_d_249_8276-deterministic-svg)">
<rect x="26" y="172" width="156" height="35" rx="4" fill="white" shape-rendering="crispEdges"></rect>
<rect x="25.5" y="171.5" width="157" height="36" rx="4.5" stroke="black" stroke-opacity="0.2" shape-rendering="crispEdges"></rect>
<text fill="#393939" xml:space="preserve" style="white-space: pre" font-family="GT America" font-size="15" letter-spacing="0em"><tspan x="36" y="195.065">Other user requests</tspan></text>
</g>
<g filter="url(#filter4_d_249_8276-deterministic-svg)">
<rect x="506" y="110" width="69" height="35" rx="4" fill="white" shape-rendering="crispEdges"></rect>
<rect x="505.5" y="109.5" width="70" height="36" rx="4.5" stroke="black" stroke-opacity="0.2" shape-rendering="crispEdges"></rect>
<text fill="#393939" xml:space="preserve" style="white-space: pre" font-family="GT America" font-size="15" letter-spacing="0em"><tspan x="516" y="133.065">Output</tspan></text>
</g>
<path d="M496.354 127.354C496.549 127.158 496.549 126.842 496.354 126.646L493.172 123.464C492.976 123.269 492.66 123.269 492.464 123.464C492.269 123.66 492.269 123.976 492.464 124.172L495.293 127L492.464 129.828C492.269 130.024 492.269 130.34 492.464 130.536C492.66 130.731 492.976 130.731 493.172 130.536L496.354 127.354ZM402 127V127.5H496V127V126.5H402V127Z" fill="black" fill-opacity="0.5"></path>
<path d="M207.54 64.5137C213.088 64.7948 217.5 69.3821 217.5 75V117C217.5 122.247 221.753 126.5 227 126.5H299.793L297.465 124.172C297.27 123.977 297.27 123.66 297.465 123.465C297.66 123.27 297.977 123.27 298.172 123.465L301.354 126.646C301.549 126.842 301.549 127.158 301.354 127.354L298.172 130.535C297.977 130.73 297.66 130.73 297.465 130.535C297.27 130.34 297.27 130.023 297.465 129.828L299.793 127.5H227C221.753 127.5 217.5 131.753 217.5 137V180.5C217.5 186.299 212.799 191 207 191H192.5V190H207C212.247 190 216.5 185.747 216.5 180.5V137C216.5 132.319 219.563 128.355 223.794 127C219.563 125.645 216.5 121.681 216.5 117V75C216.5 69.9174 212.509 65.7673 207.489 65.5127L207 65.5H192V64.5H207L207.54 64.5137Z" fill="black" fill-opacity="0.5"></path>
<defs>
<filter id="filter0_f_249_8276-deterministic-svg" x="261" y="36" width="182" height="179" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
<feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend>
<feGaussianBlur stdDeviation="4" result="effect1_foregroundBlur_249_8276"></feGaussianBlur>
</filter>
<filter id="filter1_d_249_8276-deterministic-svg" x="306" y="83" width="92" height="92" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix>
<feOffset dy="2"></feOffset>
<feGaussianBlur stdDeviation="2"></feGaussianBlur>
<feComposite in2="hardAlpha" operator="out"></feComposite>
<feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.08 0"></feColorMatrix>
<feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_249_8276"></feBlend>
<feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_249_8276" result="shape"></feBlend>
</filter>
<filter id="filter2_d_249_8276-deterministic-svg" x="62" y="44" width="125" height="45" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix>
<feOffset dy="2"></feOffset>
<feGaussianBlur stdDeviation="2"></feGaussianBlur>
<feComposite in2="hardAlpha" operator="out"></feComposite>
<feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.08 0"></feColorMatrix>
<feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_249_8276"></feBlend>
<feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_249_8276" result="shape"></feBlend>
</filter>
<filter id="filter3_d_249_8276-deterministic-svg" x="21" y="169" width="166" height="45" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix>
<feOffset dy="2"></feOffset>
<feGaussianBlur stdDeviation="2"></feGaussianBlur>
<feComposite in2="hardAlpha" operator="out"></feComposite>
<feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.08 0"></feColorMatrix>
<feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_249_8276"></feBlend>
<feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_249_8276" result="shape"></feBlend>
</filter>
<filter id="filter4_d_249_8276-deterministic-svg" x="501" y="107" width="79" height="45" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix>
<feOffset dy="2"></feOffset>
<feGaussianBlur stdDeviation="2"></feGaussianBlur>
<feComposite in2="hardAlpha" operator="out"></feComposite>
<feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.08 0"></feColorMatrix>
<feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_249_8276"></feBlend>
<feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_249_8276" result="shape"></feBlend>
</filter>
</defs>
</svg>

<figcaption>From the perspective of the inference server, it <i>is</i> deterministic. Given the exact same user requests, it will always provide the same deterministic output. </figcaption>
</figure>
<p>Wikipedia writes that “a deterministic algorithm is an algorithm that, given a particular input, will always produce the same output.” And in this case, given the exact same inputs (i.e. the exact requests the inference server is processing), the forward pass always produces the exact same outputs.</p>
<p>However, the forward pass itself being “deterministic” is not sufficient to ensure that a system that includes it is deterministic. For example, what if our request’s output depended on the parallel user requests (e.g. batch-norm)? Since each individual request has no way of knowing what the parallel requests will be, from their perspective our overall LLM inference is also nondeterministic!</p>
<p>As it turns out, our request’s output <em>does</em> depend on the parallel user requests. Not because we’re somehow leaking information across batches — instead, it’s because our forward pass lacks “batch invariance”, causing our request’s output to depend on the <strong>batch size</strong> of our forward pass.</p>
<h3 id="batch-invariance-and-determinism">Batch Invariance and “Determinism”</h3>
<p>To explain batch invariance, let’s simplify the system and look solely at matmuls. You can assume that all matmul implementations are “run-to-run deterministic."<label for="sn4"></label><span>This is not totally true, but most common matmul implementations do have this property.</span>  However, they are not “batch-invariant.” In other words, when the batch size changes, each element in the batch can get different results.</p>
<p>This is a fairly unusual property from a mathematical perspective. Matrix multiplication should be “independent” along every element in the batch — neither the other elements in the batch nor how large the batch is should affect the computation results of a specific element in the batch.</p>
<p>However, as we can observe empirically, this isn’t true.</p>
<div><pre tabindex="0"><code data-lang="python"><span><span><span>import</span> <span>torch</span>
</span></span><span><span><span>torch</span><span>.</span><span>set_default_device</span><span>(</span><span>'cuda'</span><span>)</span> 
</span></span><span><span>
</span></span><span><span><span>B</span> <span>=</span> <span>2048</span>
</span></span><span><span><span>D</span> <span>=</span> <span>4096</span>
</span></span><span><span><span>a</span> <span>=</span> <span>torch</span><span>.</span><span>linspace</span><span>(</span><span>-</span><span>1000</span><span>,</span> <span>1000</span><span>,</span> <span>B</span><span>*</span><span>D</span><span>)</span><span>.</span><span>reshape</span><span>(</span><span>B</span><span>,</span> <span>D</span><span>)</span>
</span></span><span><span><span>b</span> <span>=</span> <span>torch</span><span>.</span><span>linspace</span><span>(</span><span>-</span><span>1000</span><span>,</span> <span>1000</span><span>,</span> <span>D</span><span>*</span><span>D</span><span>)</span><span>.</span><span>reshape</span><span>(</span><span>D</span><span>,</span> <span>D</span><span>)</span>
</span></span><span><span><span># Doing a matrix vector multiplication by taking</span>
</span></span><span><span><span># the first element of the batch</span>
</span></span><span><span><span>out1</span> <span>=</span> <span>torch</span><span>.</span><span>mm</span><span>(</span><span>a</span><span>[:</span><span>1</span><span>],</span> <span>b</span><span>)</span>
</span></span><span><span><span># Doing a matrix matrix multiplication and then taking</span>
</span></span><span><span><span># the first element of the batch</span>
</span></span><span><span><span>out2</span> <span>=</span> <span>torch</span><span>.</span><span>mm</span><span>(</span><span>a</span><span>,</span> <span>b</span><span>)[:</span><span>1</span><span>]</span>
</span></span><span><span><span>print</span><span>((</span><span>out1</span> <span>-</span> <span>out2</span><span>)</span><span>.</span><span>abs</span><span>()</span><span>.</span><span>max</span><span>())</span> <span># tensor(1669.2500, device='cuda:0')</span>
</span></span></code></pre></div><p>Note that this <i>is</i> “run-to-run deterministic.” If you run the script multiple times, it will deterministically return the same result.<label for="sn5"></label><span>It is not “hardware/software version invariant” — your GPU/PyTorch version may return a different value, but it should deterministically return the same value.</span></p>
<p>However, when a non-batch-invariant kernel is used as part of a larger inference system, the system can become nondeterministic. When you make a query to an inference endpoint, the amount of load the server is under is effectively “nondeterministic” from the user’s perspective. The load determines the batch size that the kernels are run under, and thus changes the eventual result of each individual request!</p>
<figure>
<svg width="600" height="250" viewBox="0 0 600 250" fill="none" xmlns="http://www.w3.org/2000/svg">

<rect width="600" height="250" fill="#F5F5F5"></rect>
<g clip-path="url(#nd_clip0_249_8276-nondeterministic-svg)">
<rect width="600" height="250" fill="white"></rect>
<g filter="url(#nd_filter0_f_249_8276-nondeterministic-svg)">
<rect x="252" y="6" width="222" height="238" rx="4" fill="#FAF9D3"></rect>
</g>
<g filter="url(#nd_filter1_f_249_8276-nondeterministic-svg)">
<rect x="9" y="153" width="247" height="91" rx="4" fill="#FAF9D3"></rect>
</g>
<g filter="url(#nd_filter2_f_249_8276-nondeterministic-svg)">
<rect x="280" y="53" width="166" height="163" rx="4" fill="#E3EEB0"></rect>
</g>
<g filter="url(#nd_filter3_d_249_8276-nondeterministic-svg)">
<rect x="322" y="95" width="82" height="82" rx="4" fill="white" shape-rendering="crispEdges"></rect>
<rect x="321.5" y="94.5" width="83" height="83" rx="4.5" stroke="black" stroke-opacity="0.2" shape-rendering="crispEdges"></rect>
<text fill="#393939" xml:space="preserve" style="white-space: pre" font-family="GT America" font-size="15" letter-spacing="0em"><tspan x="342" y="141.565">Model</tspan></text>
</g>
<text fill="#5A850C" xml:space="preserve" style="white-space: pre" font-family="GT America" font-size="15" letter-spacing="0em"><tspan x="290" y="74.065">Deterministic</tspan></text>
<text fill="#9C960A" xml:space="preserve" style="white-space: pre" font-family="GT America" font-size="15" letter-spacing="0em"><tspan x="262" y="27.065">Nondeterministic</tspan></text>
<g filter="url(#nd_filter4_d_249_8276-nondeterministic-svg)">
<rect x="78" y="56" width="115" height="35" rx="4" fill="white" shape-rendering="crispEdges"></rect>
<rect x="77.5" y="55.5" width="116" height="36" rx="4.5" stroke="black" stroke-opacity="0.2" shape-rendering="crispEdges"></rect>
<text fill="#393939" xml:space="preserve" style="white-space: pre" font-family="GT America" font-size="15" letter-spacing="0em"><tspan x="88" y="79.065">User requests</tspan></text>
</g>
<g filter="url(#nd_filter5_d_249_8276-nondeterministic-svg)">
<rect x="37" y="181" width="156" height="35" rx="4" fill="white" shape-rendering="crispEdges"></rect>
<rect x="36.5" y="180.5" width="157" height="36" rx="4.5" stroke="black" stroke-opacity="0.2" shape-rendering="crispEdges"></rect>
<text fill="#393939" xml:space="preserve" style="white-space: pre" font-family="GT America" font-size="15" letter-spacing="0em"><tspan x="47" y="204.065">Other user requests</tspan></text>
</g>
<g filter="url(#nd_filter6_d_249_8276-nondeterministic-svg)">
<rect x="517" y="119" width="69" height="35" rx="4" fill="white" shape-rendering="crispEdges"></rect>
<rect x="516.5" y="118.5" width="70" height="36" rx="4.5" stroke="black" stroke-opacity="0.2" shape-rendering="crispEdges"></rect>
<text fill="#393939" xml:space="preserve" style="white-space: pre" font-family="GT America" font-size="15" letter-spacing="0em"><tspan x="527" y="142.065">Output</tspan></text>
</g>
<path d="M507.354 136.354C507.549 136.158 507.549 135.842 507.354 135.646L504.172 132.464C503.976 132.269 503.66 132.269 503.464 132.464C503.269 132.66 503.269 132.976 503.464 133.172L506.293 136L503.464 138.828C503.269 139.024 503.269 139.34 503.464 139.536C503.66 139.731 503.976 139.731 504.172 139.536L507.354 136.354ZM413 136V136.5H507V136V135.5H413V136Z" fill="black" fill-opacity="0.5"></path>
<path d="M218.54 73.5137C224.088 73.7948 228.5 78.3821 228.5 84V126C228.5 131.247 232.753 135.5 238 135.5H310.793L308.465 133.172C308.27 132.977 308.27 132.66 308.465 132.465C308.66 132.27 308.977 132.27 309.172 132.465L312.354 135.646C312.549 135.842 312.549 136.158 312.354 136.354L309.172 139.535C308.977 139.73 308.66 139.73 308.465 139.535C308.27 139.34 308.27 139.023 308.465 138.828L310.793 136.5H238C232.753 136.5 228.5 140.753 228.5 146V189.5C228.5 195.299 223.799 200 218 200H203.5V199H218C223.247 199 227.5 194.747 227.5 189.5V146C227.5 141.319 230.563 137.355 234.794 136C230.563 134.645 227.5 130.681 227.5 126V84C227.5 78.9174 223.509 74.7673 218.489 74.5127L218 74.5H203V73.5H218L218.54 73.5137Z" fill="black" fill-opacity="0.5"></path>
</g>
<defs>
<filter id="nd_filter0_f_249_8276-nondeterministic-svg" x="244" y="-2" width="238" height="254" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
<feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend>
<feGaussianBlur stdDeviation="4" result="nd_effect1_foregroundBlur_249_8276"></feGaussianBlur>
</filter>
<filter id="nd_filter1_f_249_8276-nondeterministic-svg" x="1" y="145" width="263" height="107" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
<feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend>
<feGaussianBlur stdDeviation="4" result="nd_effect2_foregroundBlur_249_8276"></feGaussianBlur>
</filter>
<filter id="nd_filter2_f_249_8276-nondeterministic-svg" x="272" y="45" width="182" height="179" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
<feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend>
<feGaussianBlur stdDeviation="4" result="nd_effect3_foregroundBlur_249_8276"></feGaussianBlur>
</filter>
<filter id="nd_filter3_d_249_8276-nondeterministic-svg" x="317" y="92" width="92" height="92" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix>
<feOffset dy="2"></feOffset>
<feGaussianBlur stdDeviation="2"></feGaussianBlur>
<feComposite in2="hardAlpha" operator="out"></feComposite>
<feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.08 0"></feColorMatrix>
<feBlend mode="normal" in2="BackgroundImageFix" result="nd_effect1_dropShadow_249_8276"></feBlend>
<feBlend mode="normal" in="SourceGraphic" in2="nd_effect1_dropShadow_249_8276" result="shape"></feBlend>
</filter>
<filter id="nd_filter4_d_249_8276-nondeterministic-svg" x="73" y="53" width="125" height="45" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix>
<feOffset dy="2"></feOffset>
<feGaussianBlur stdDeviation="2"></feGaussianBlur>
<feComposite in2="hardAlpha" operator="out"></feComposite>
<feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.08 0"></feColorMatrix>
<feBlend mode="normal" in2="BackgroundImageFix" result="nd_effect2_dropShadow_249_8276"></feBlend>
<feBlend mode="normal" in="SourceGraphic" in2="nd_effect2_dropShadow_249_8276" result="shape"></feBlend>
</filter>
<filter id="nd_filter5_d_249_8276-nondeterministic-svg" x="32" y="178" width="166" height="45" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix>
<feOffset dy="2"></feOffset>
<feGaussianBlur stdDeviation="2"></feGaussianBlur>
<feComposite in2="hardAlpha" operator="out"></feComposite>
<feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.08 0"></feColorMatrix>
<feBlend mode="normal" in2="BackgroundImageFix" result="nd_effect3_dropShadow_249_8276"></feBlend>
<feBlend mode="normal" in="SourceGraphic" in2="nd_effect3_dropShadow_249_8276" result="shape"></feBlend>
</filter>
<filter id="nd_filter6_d_249_8276-nondeterministic-svg" x="512" y="116" width="79" height="45" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix>
<feOffset dy="2"></feOffset>
<feGaussianBlur stdDeviation="2"></feGaussianBlur>
<feComposite in2="hardAlpha" operator="out"></feComposite>
<feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.08 0"></feColorMatrix>
<feBlend mode="normal" in2="BackgroundImageFix" result="nd_effect4_dropShadow_249_8276"></feBlend>
<feBlend mode="normal" in="SourceGraphic" in2="nd_effect4_dropShadow_249_8276" result="shape"></feBlend>
</filter>
<clipPath id="nd_clip0_249_8276-nondeterministic-svg">
<rect width="600" height="250" fill="white"></rect>
</clipPath>
</defs>
</svg>

<figcaption>Although the inference server itself can be claimed to be "deterministic", the story is different for an individual user. From the perspective of an individual user, the other concurrent users are not an "input" to the system but rather a nondeterministic property of the system. This makes LLM inference "nondeterministic" from the perspective of each user.</figcaption>
</figure>
<p>If you compose some property under which the kernel is not invariant (i.e. batch-size) with nondeterminism of that property (i.e. the load the server is under), you get a nondeterministic system.</p>
<p>In other words, <b>the primary reason nearly all LLM inference endpoints are nondeterministic is that the load (and thus batch-size) nondeterministically varies!</b> This nondeterminism is not unique to GPUs — LLM inference endpoints served from CPUs or TPUs will also have this source of nondeterminism.</p>
<p>So, if we’d like to avoid nondeterminism in our inference servers, we must achieve batch invariance in our kernels. In order to understand how that can be achieved, let’s first take a look at why kernels don’t have batch invariance in the first place.</p>
<h2 id="how-do-we-make-kernels-batch-invariant">How do we make kernels batch-invariant?</h2>
<p>In order to make a transformer implementation batch-invariant, we must make every kernel batch-invariant. Luckily, we can assume that every pointwise operation is batch-invariant.<label for="sn6"></label><span>Although this is true for all kernels in say, PyTorch, it’s not inherently true. For example, there are some kernel implementations on CPU that will use vectorized intrinsics on some parts of the array and non-vectorized intrinsics on other parts, and these intrinsics don’t necessarily always have bitwise identical numerics.</span> Thus, we only need to worry about the 3 operations that involve reductions — RMSNorm, matrix multiplication, and attention.<label for="sn7"></label><span>Reductions related to parallelism are out of the scope of this discussion, but the same principles apply. One factoid that may be useful is that NVLink-Sharp in-switch reductions are deterministic on Blackwell as well as Hopper with CUDA 12.8+. As is the case with many things, this information can be found on NCCL’s <a href="https://github.com/NVIDIA/nccl/issues/1497#issuecomment-3210819243">github issues</a></span></p>
<p>Conveniently, these are also ordered in ascending levels of difficulty. Each one requires some additional considerations to achieve batch invariance with reasonable performance. Let’s talk about RMSNorm first.</p>
<h3 id="batch-invariant-rmsnorm">Batch-Invariant RMSNorm</h3>
<figure>
<svg width="480" height="350" viewBox="0 0 480 350" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="480" height="350" fill="#F5F5F5"></rect>
<rect width="480" height="350" fill="white"></rect>
<g clip-path="url(#clip0_249_8276-rmsnorm-1-svg)">
<rect x="111" y="79.9023" width="45" height="45" fill="#EF402C"></rect>
<rect opacity="0.86" x="157" y="79.9023" width="45" height="45" fill="#EF402C"></rect>
<rect opacity="0.72" x="203" y="79.9023" width="45" height="45" fill="#EF402C"></rect>
<rect opacity="0.58" x="249" y="79.9023" width="45" height="45" fill="#EF402C"></rect>
<rect opacity="0.44" x="295" y="79.9023" width="45" height="45" fill="#EF402C"></rect>
<rect opacity="0.3" x="341" y="79.9023" width="45" height="45" fill="#EF402C"></rect>
<rect x="111" y="125.902" width="45" height="45" fill="#F7A224"></rect>
<rect opacity="0.86" x="157" y="125.902" width="45" height="45" fill="#F7A224"></rect>
<rect opacity="0.72" x="203" y="125.902" width="45" height="45" fill="#F7A224"></rect>
<rect opacity="0.58" x="249" y="125.902" width="45" height="45" fill="#F7A224"></rect>
<rect opacity="0.44" x="295" y="125.902" width="45" height="45" fill="#F7A224"></rect>
<rect opacity="0.3" x="341" y="125.902" width="45" height="45" fill="#F7A224"></rect>
<rect x="111" y="171.902" width="45" height="45" fill="#009DE4"></rect>
<rect opacity="0.86" x="157" y="171.902" width="45" height="45" fill="#009DE4"></rect>
<rect opacity="0.72" x="203" y="171.902" width="45" height="45" fill="#009DE4"></rect>
<rect opacity="0.58" x="249" y="171.902" width="45" height="45" fill="#009DE4"></rect>
<rect opacity="0.44" x="295" y="171.902" width="45" height="45" fill="#009DE4"></rect>
<rect opacity="0.3" x="341" y="171.902" width="45" height="45" fill="#009DE4"></rect>
<rect x="111" y="217.902" width="45" height="45" fill="#6D2764"></rect>
<rect opacity="0.86" x="157" y="217.902" width="45" height="45" fill="#6D2764"></rect>
<rect opacity="0.72" x="203" y="217.902" width="45" height="45" fill="#6D2764"></rect>
<rect opacity="0.58" x="249" y="217.902" width="45" height="45" fill="#6D2764"></rect>
<rect opacity="0.44" x="295" y="217.902" width="45" height="45" fill="#6D2764"></rect>
<rect opacity="0.3" x="341" y="217.902" width="45" height="45" fill="#6D2764"></rect>
</g>
<path d="M220.557 37.5239C220.596 37.5288 220.632 37.5337 220.667 37.5386C220.706 37.5386 220.764 37.5386 220.842 37.5386C221.233 37.5386 221.497 37.4116 221.633 37.1577C221.775 36.8989 221.846 36.3252 221.846 35.4365C221.846 35.29 221.843 35.0288 221.838 34.6528C221.833 34.2769 221.831 33.9668 221.831 33.7227V31.7305C221.831 31.4619 221.833 31.042 221.838 30.4707C221.843 29.8945 221.846 29.4551 221.846 29.1523C221.846 28.7373 221.765 28.4492 221.604 28.2881C221.448 28.1221 221.172 28.0391 220.776 28.0391H220.659V27.5483C221.67 27.5728 222.488 27.5923 223.113 27.6069C223.743 27.6167 224.275 27.6216 224.709 27.6216C225.183 27.6216 225.693 27.6167 226.24 27.6069C226.792 27.5923 227.407 27.5728 228.086 27.5483C228.086 27.8853 228.096 28.2417 228.115 28.6177C228.14 28.9888 228.174 29.4111 228.218 29.8848L227.712 29.9434C227.678 29.3232 227.505 28.9058 227.192 28.6909C226.88 28.4761 226.182 28.3687 225.098 28.3687C224.717 28.3687 224.124 28.3784 223.318 28.3979H223.274C223.264 29.1206 223.25 29.9263 223.23 30.8149C223.21 31.6987 223.198 32.1895 223.193 32.2871H223.435C223.708 32.2871 224.048 32.2896 224.453 32.2944C224.858 32.2993 225.134 32.3018 225.281 32.3018C225.999 32.3018 226.472 32.2358 226.702 32.104C226.936 31.9722 227.063 31.728 227.083 31.3716L227.544 31.4009C227.505 31.7671 227.478 32.0698 227.463 32.3091C227.449 32.5435 227.441 32.7607 227.441 32.9609C227.441 33.1074 227.444 33.2808 227.449 33.481C227.458 33.6812 227.471 33.9058 227.485 34.1548L227.002 34.1914V34.0669C227.002 33.6665 226.882 33.3955 226.643 33.2539C226.404 33.1074 225.85 33.0342 224.98 33.0342H223.721H223.193V35.8833C223.193 36.5864 223.271 37.0308 223.428 37.2163C223.584 37.397 223.901 37.4873 224.38 37.4873H224.666V38C224.294 37.9805 223.928 37.9658 223.567 37.9561C223.21 37.9463 222.861 37.9414 222.52 37.9414C222.349 37.9414 222.087 37.9463 221.736 37.9561C221.389 37.9658 220.996 37.9805 220.557 38V37.5239ZM235.044 33.9058H231.47C231.191 33.9058 230.935 33.9106 230.701 33.9204C230.466 33.9302 230.249 33.9448 230.049 33.9644V34.2354C230.049 35.1924 230.269 35.9321 230.708 36.4546C231.152 36.9771 231.777 37.2383 232.583 37.2383C232.939 37.2383 233.291 37.1797 233.638 37.0625C233.984 36.9404 234.353 36.7524 234.744 36.4985L235.029 36.9673C234.526 37.3774 234.023 37.6875 233.521 37.8975C233.022 38.1074 232.529 38.2124 232.041 38.2124C231.094 38.2124 230.312 37.8755 229.697 37.2017C229.082 36.5229 228.774 35.6538 228.774 34.5942C228.774 33.4663 229.097 32.519 229.741 31.7524C230.386 30.9858 231.172 30.6025 232.1 30.6025C232.964 30.6025 233.652 30.8906 234.165 31.4668C234.678 32.043 234.971 32.856 235.044 33.9058ZM233.689 33.1367C233.542 32.5361 233.32 32.0771 233.022 31.7598C232.725 31.4375 232.368 31.2764 231.953 31.2764C231.484 31.2764 231.082 31.4644 230.745 31.8403C230.413 32.2163 230.195 32.7241 230.093 33.3638C231.06 33.3638 231.819 33.3467 232.371 33.3125C232.927 33.2783 233.367 33.2197 233.689 33.1367ZM242.595 36.938L242.8 37.3994C242.434 37.6631 242.1 37.8657 241.797 38.0073C241.494 38.1538 241.25 38.2271 241.064 38.2271C240.752 38.2271 240.518 38.1367 240.361 37.9561C240.205 37.7705 240.12 37.4922 240.105 37.1211C239.573 37.4775 239.131 37.7339 238.779 37.8901C238.428 38.0415 238.113 38.1172 237.834 38.1172C237.341 38.1172 236.929 37.9316 236.597 37.5605C236.265 37.1895 236.099 36.7354 236.099 36.1982C236.099 35.2852 237.083 34.5967 239.05 34.1328C239.514 34.0254 239.875 33.9399 240.134 33.8765C240.134 33.7935 240.137 33.6738 240.142 33.5176C240.156 33.1953 240.164 32.9854 240.164 32.8877C240.164 32.3799 240.059 32.0063 239.849 31.7671C239.639 31.5229 239.319 31.4009 238.889 31.4009C238.469 31.4009 238.137 31.479 237.893 31.6353C237.654 31.7866 237.534 31.9941 237.534 32.2578C237.534 32.2822 237.537 32.3164 237.542 32.3604C237.546 32.3994 237.549 32.4287 237.549 32.4482C237.549 32.5996 237.476 32.7266 237.329 32.8291C237.183 32.9268 237.007 32.9756 236.802 32.9756C236.626 32.9756 236.497 32.9463 236.414 32.8877C236.331 32.8291 236.289 32.7388 236.289 32.6167C236.289 32.2261 236.619 31.7915 237.278 31.313C237.937 30.8296 238.618 30.5879 239.321 30.5879C240 30.5879 240.515 30.7759 240.867 31.1519C241.218 31.5229 241.394 32.0698 241.394 32.7925C241.394 33.1831 241.37 33.7837 241.321 34.5942C241.277 35.4048 241.255 36.02 241.255 36.4399C241.255 36.7573 241.289 36.9722 241.357 37.0845C241.431 37.1968 241.558 37.2529 241.738 37.2529C241.816 37.2529 241.917 37.231 242.039 37.187C242.166 37.1382 242.351 37.0552 242.595 36.938ZM240.098 34.4624C240.005 34.4868 239.866 34.5234 239.68 34.5723C238.093 35.0068 237.3 35.5195 237.3 36.1104C237.3 36.4326 237.402 36.6963 237.607 36.9014C237.812 37.1016 238.083 37.2017 238.42 37.2017C238.625 37.2017 238.862 37.1479 239.131 37.0405C239.399 36.9331 239.712 36.7622 240.068 36.5278L240.098 34.4624ZM245.085 29.4233L245.569 29.5698C245.54 29.8384 245.515 30.0801 245.496 30.2949C245.481 30.5049 245.471 30.7124 245.466 30.9175H245.986C246.265 30.9175 246.548 30.915 246.836 30.9102C247.124 30.9004 247.415 30.8882 247.708 30.8735L247.532 31.6719C247.219 31.6475 246.924 31.6328 246.646 31.6279C246.372 31.6182 246.099 31.6133 245.825 31.6133H245.481C245.452 32.4531 245.43 33.0977 245.415 33.5469C245.405 33.9912 245.4 34.3599 245.4 34.6528C245.4 35.7563 245.476 36.4766 245.627 36.8135C245.779 37.1455 246.05 37.3115 246.44 37.3115C246.602 37.3115 246.78 37.2773 246.975 37.209C247.175 37.1406 247.417 37.0283 247.7 36.8721L247.942 37.3555C247.473 37.6387 247.048 37.8535 246.667 38C246.287 38.1416 245.955 38.2124 245.671 38.2124C245.149 38.2124 244.768 38.0342 244.529 37.6777C244.29 37.3164 244.17 36.7378 244.17 35.9419C244.17 35.7856 244.18 35.229 244.199 34.272C244.224 33.3101 244.236 32.4287 244.236 31.6279C244.192 31.6279 244.128 31.6304 244.045 31.6353C243.64 31.6499 243.362 31.6572 243.21 31.6572V31.1299C243.689 31.0615 244.084 30.8857 244.397 30.6025C244.709 30.3145 244.939 29.9214 245.085 29.4233ZM250.872 30.5952C250.837 31.5522 250.811 32.3921 250.791 33.1147C250.771 33.8325 250.762 34.3306 250.762 34.6089C250.762 35.6538 250.869 36.3521 251.084 36.7036C251.299 37.0503 251.667 37.2236 252.19 37.2236C252.449 37.2236 252.737 37.1602 253.054 37.0332C253.372 36.9062 253.733 36.7134 254.138 36.4546C254.153 35.7026 254.163 35.0825 254.167 34.5942C254.177 34.106 254.182 33.7471 254.182 33.5176V33.0195C254.182 32.4043 254.131 32.0186 254.028 31.8623C253.926 31.7061 253.728 31.6279 253.435 31.6279C253.386 31.6279 253.333 31.6304 253.274 31.6353C253.22 31.6353 253.164 31.6377 253.105 31.6426L253.062 31.1738C253.477 31.1445 253.884 31.0981 254.285 31.0347C254.69 30.9712 255.085 30.8931 255.471 30.8003C255.442 31.6353 255.42 32.3799 255.405 33.0342C255.391 33.6885 255.383 34.2598 255.383 34.748C255.383 34.9482 255.381 35.1997 255.376 35.5024C255.371 35.8003 255.369 35.998 255.369 36.0957C255.369 36.5498 255.408 36.8477 255.486 36.9893C255.564 37.1309 255.71 37.2017 255.925 37.2017C255.974 37.2017 256.03 37.1968 256.094 37.187C256.162 37.1772 256.25 37.1577 256.357 37.1284L256.416 37.5825L254.182 38.1465L254.153 37.0552C253.625 37.4556 253.162 37.7485 252.761 37.9341C252.366 38.1196 252.004 38.2124 251.677 38.2124C251.008 38.2124 250.486 38.0195 250.11 37.6338C249.734 37.248 249.546 36.7109 249.546 36.0225C249.546 35.8467 249.553 35.478 249.568 34.9165C249.573 34.6821 249.575 34.499 249.575 34.3672L249.597 33.5469C249.597 33.4102 249.6 33.2368 249.604 33.0269C249.609 32.812 249.612 32.6655 249.612 32.5874C249.612 32.1675 249.575 31.8892 249.502 31.7524C249.434 31.6157 249.304 31.5474 249.114 31.5474C249.055 31.5474 248.987 31.5522 248.909 31.562C248.831 31.5718 248.75 31.5815 248.667 31.5913L248.616 31.1152C248.967 31.0566 249.329 30.9858 249.7 30.9028C250.076 30.8149 250.466 30.7124 250.872 30.5952ZM259.749 30.5146C259.714 30.8467 259.688 31.1836 259.668 31.5254C259.648 31.8623 259.634 32.2212 259.624 32.6021C260.02 31.9038 260.383 31.4009 260.715 31.0933C261.052 30.7856 261.399 30.6318 261.755 30.6318C262.034 30.6318 262.253 30.7075 262.415 30.8589C262.576 31.0054 262.656 31.2056 262.656 31.4595C262.656 31.6401 262.603 31.7964 262.495 31.9282C262.393 32.0552 262.271 32.1187 262.129 32.1187C262.041 32.1187 261.904 32.0723 261.719 31.9795C261.538 31.8818 261.382 31.833 261.25 31.833C260.996 31.833 260.742 31.9453 260.488 32.1699C260.234 32.3896 259.968 32.7339 259.69 33.2026V34.0083C259.69 34.7896 259.695 35.4243 259.705 35.9126C259.719 36.396 259.739 36.7036 259.763 36.8354C259.807 37.0845 259.9 37.2554 260.042 37.3481C260.188 37.4409 260.435 37.4873 260.781 37.4873H260.994V38C260.613 37.9707 260.273 37.9487 259.976 37.9341C259.678 37.9194 259.426 37.9121 259.221 37.9121C258.938 37.9121 258.645 37.9194 258.342 37.9341C258.044 37.9487 257.732 37.9707 257.405 38V37.4873H257.573C257.93 37.4873 258.171 37.4019 258.298 37.231C258.425 37.0601 258.489 36.6621 258.489 36.0371V35.2681V32.8877C258.489 32.3604 258.452 32.021 258.379 31.8696C258.306 31.7183 258.171 31.6426 257.976 31.6426C257.937 31.6426 257.896 31.645 257.852 31.6499C257.808 31.6499 257.734 31.6572 257.632 31.6719L257.544 31.2178C257.891 31.1396 258.247 31.042 258.613 30.9248C258.979 30.8076 259.358 30.6709 259.749 30.5146ZM269.673 33.9058H266.099C265.82 33.9058 265.564 33.9106 265.33 33.9204C265.095 33.9302 264.878 33.9448 264.678 33.9644V34.2354C264.678 35.1924 264.897 35.9321 265.337 36.4546C265.781 36.9771 266.406 37.2383 267.212 37.2383C267.568 37.2383 267.92 37.1797 268.267 37.0625C268.613 36.9404 268.982 36.7524 269.373 36.4985L269.658 36.9673C269.155 37.3774 268.652 37.6875 268.149 37.8975C267.651 38.1074 267.158 38.2124 266.67 38.2124C265.723 38.2124 264.941 37.8755 264.326 37.2017C263.711 36.5229 263.403 35.6538 263.403 34.5942C263.403 33.4663 263.726 32.519 264.37 31.7524C265.015 30.9858 265.801 30.6025 266.729 30.6025C267.593 30.6025 268.281 30.8906 268.794 31.4668C269.307 32.043 269.6 32.856 269.673 33.9058ZM268.318 33.1367C268.171 32.5361 267.949 32.0771 267.651 31.7598C267.354 31.4375 266.997 31.2764 266.582 31.2764C266.113 31.2764 265.71 31.4644 265.374 31.8403C265.042 32.2163 264.824 32.7241 264.722 33.3638C265.688 33.3638 266.448 33.3467 267 33.3125C267.556 33.2783 267.996 33.2197 268.318 33.1367ZM275.598 30.9028C275.598 31.2007 275.613 31.501 275.642 31.8037C275.676 32.1064 275.723 32.4116 275.781 32.7192L275.225 32.8071C275.166 32.2993 275.005 31.9209 274.741 31.6719C274.478 31.4229 274.109 31.2983 273.635 31.2983C273.225 31.2983 272.888 31.4106 272.625 31.6353C272.361 31.855 272.229 32.1357 272.229 32.4775C272.229 33.0195 272.805 33.4492 273.958 33.7666C274.158 33.8203 274.312 33.8618 274.419 33.8911C274.995 34.0522 275.415 34.2817 275.679 34.5796C275.947 34.8774 276.082 35.2681 276.082 35.7515C276.082 36.4644 275.801 37.0527 275.239 37.5166C274.683 37.9805 273.967 38.2124 273.093 38.2124C272.776 38.2124 272.451 38.1782 272.119 38.1099C271.787 38.0415 271.448 37.939 271.101 37.8022C271.106 37.7534 271.108 37.7021 271.108 37.6484C271.113 37.5947 271.116 37.5117 271.116 37.3994C271.116 37.1748 271.101 36.9331 271.072 36.6743C271.047 36.4106 271.008 36.1323 270.955 35.8394L271.504 35.7075C271.582 36.313 271.772 36.7671 272.075 37.0698C272.378 37.3677 272.798 37.5166 273.335 37.5166C273.823 37.5166 274.221 37.3994 274.529 37.165C274.841 36.9258 274.998 36.6182 274.998 36.2422C274.998 35.7148 274.48 35.2949 273.445 34.9824C273.342 34.9482 273.267 34.9238 273.218 34.9092C272.476 34.6846 271.953 34.4087 271.65 34.0815C271.353 33.7544 271.204 33.3198 271.204 32.7778C271.204 32.1528 271.453 31.6353 271.951 31.2251C272.449 30.8101 273.086 30.6025 273.862 30.6025C274.102 30.6025 274.36 30.627 274.639 30.6758C274.922 30.7246 275.242 30.8003 275.598 30.9028Z" fill="black"></path>
<path d="M36.1348 174.138C36.2471 174.148 36.3667 174.155 36.4937 174.16C36.6255 174.16 36.8208 174.16 37.0796 174.16C37.3579 174.16 37.6143 174.155 37.8486 174.146C38.0879 174.136 38.3174 174.119 38.5371 174.094C38.8936 173.84 39.1621 173.555 39.3428 173.237C39.5234 172.915 39.6138 172.561 39.6138 172.175C39.6138 171.555 39.416 171.067 39.0205 170.71C38.625 170.349 38.083 170.168 37.3945 170.168C37.2432 170.168 37.0674 170.178 36.8672 170.198C36.6719 170.217 36.4497 170.247 36.2007 170.286C36.186 170.94 36.1714 171.699 36.1567 172.563C36.147 173.428 36.1396 173.953 36.1348 174.138ZM36.1494 178.95C36.4326 179.033 36.7109 179.097 36.9844 179.141C37.2578 179.18 37.5239 179.199 37.7827 179.199C38.5835 179.199 39.2036 179.004 39.6431 178.613C40.0825 178.223 40.3022 177.678 40.3022 176.98C40.3022 176.238 40.0557 175.688 39.5625 175.332C39.0693 174.971 38.3125 174.79 37.292 174.79C37.126 174.79 36.9575 174.792 36.7866 174.797C36.6206 174.797 36.4033 174.805 36.1348 174.819C36.1348 175.024 36.1323 175.327 36.1274 175.728C36.1226 176.123 36.1201 176.414 36.1201 176.599C36.1201 176.902 36.1226 177.224 36.1274 177.566C36.1323 177.903 36.1396 178.364 36.1494 178.95ZM33.5566 179.426C33.5908 179.431 33.6226 179.436 33.6519 179.441C33.686 179.441 33.7349 179.441 33.7983 179.441C34.4478 179.441 34.7773 178.528 34.7871 176.702C34.792 176.243 34.7969 175.884 34.8018 175.625L34.8311 173.625C34.8359 173.196 34.8384 172.778 34.8384 172.373C34.8433 171.968 34.8457 171.528 34.8457 171.055C34.8457 170.635 34.7676 170.344 34.6113 170.183C34.4551 170.022 34.1768 169.941 33.7764 169.941H33.7178V169.429C34.0303 169.453 34.3354 169.47 34.6333 169.48C34.936 169.49 35.2412 169.495 35.5488 169.495C35.8906 169.495 36.3105 169.485 36.8086 169.465C37.3066 169.441 37.6313 169.429 37.7827 169.429C38.7886 169.429 39.582 169.653 40.1631 170.103C40.749 170.547 41.042 171.147 41.042 171.904C41.042 172.437 40.8979 172.898 40.6099 173.289C40.3267 173.674 39.8555 174.048 39.1963 174.409C40.0557 174.575 40.6978 174.868 41.1226 175.288C41.5474 175.708 41.7598 176.262 41.7598 176.951C41.7598 177.844 41.4058 178.564 40.6978 179.111C39.9897 179.658 39.0449 179.932 37.8633 179.932C37.6484 179.932 37.2456 179.919 36.6548 179.895C36.064 179.871 35.5757 179.858 35.1899 179.858C35.0288 179.858 34.8042 179.863 34.5161 179.873C34.2329 179.883 33.9131 179.897 33.5566 179.917V179.426ZM49.3696 178.84L49.5747 179.302C49.2085 179.565 48.874 179.768 48.5713 179.91C48.2686 180.056 48.0244 180.129 47.8389 180.129C47.5264 180.129 47.292 180.039 47.1357 179.858C46.9795 179.673 46.894 179.395 46.8794 179.023C46.3472 179.38 45.9053 179.636 45.5537 179.792C45.2021 179.944 44.8872 180.02 44.6089 180.02C44.1157 180.02 43.7031 179.834 43.3711 179.463C43.0391 179.092 42.873 178.638 42.873 178.101C42.873 177.188 43.8569 176.499 45.8247 176.035C46.2886 175.928 46.6499 175.842 46.9087 175.779C46.9087 175.696 46.9111 175.576 46.916 175.42C46.9307 175.098 46.938 174.888 46.938 174.79C46.938 174.282 46.833 173.909 46.623 173.669C46.4131 173.425 46.0933 173.303 45.6636 173.303C45.2437 173.303 44.9116 173.381 44.6675 173.538C44.4282 173.689 44.3086 173.896 44.3086 174.16C44.3086 174.185 44.311 174.219 44.3159 174.263C44.3208 174.302 44.3232 174.331 44.3232 174.351C44.3232 174.502 44.25 174.629 44.1035 174.731C43.957 174.829 43.7812 174.878 43.5762 174.878C43.4004 174.878 43.271 174.849 43.188 174.79C43.105 174.731 43.0635 174.641 43.0635 174.519C43.0635 174.128 43.3931 173.694 44.0522 173.215C44.7114 172.732 45.3926 172.49 46.0957 172.49C46.7744 172.49 47.2896 172.678 47.6411 173.054C47.9927 173.425 48.1685 173.972 48.1685 174.695C48.1685 175.085 48.144 175.686 48.0952 176.497C48.0513 177.307 48.0293 177.922 48.0293 178.342C48.0293 178.66 48.0635 178.875 48.1318 178.987C48.2051 179.099 48.332 179.155 48.5127 179.155C48.5908 179.155 48.6909 179.133 48.813 179.089C48.9399 179.041 49.1255 178.958 49.3696 178.84ZM46.8721 176.365C46.7793 176.389 46.6401 176.426 46.4546 176.475C44.8677 176.909 44.0742 177.422 44.0742 178.013C44.0742 178.335 44.1768 178.599 44.3818 178.804C44.5869 179.004 44.8579 179.104 45.1948 179.104C45.3999 179.104 45.6367 179.05 45.9053 178.943C46.1738 178.835 46.4863 178.665 46.8428 178.43L46.8721 176.365ZM51.8599 171.326L52.3433 171.472C52.314 171.741 52.2896 171.982 52.27 172.197C52.2554 172.407 52.2456 172.615 52.2407 172.82H52.7607C53.0391 172.82 53.3223 172.817 53.6104 172.812C53.8984 172.803 54.189 172.791 54.4819 172.776L54.3062 173.574C53.9937 173.55 53.6982 173.535 53.4199 173.53C53.1465 173.521 52.873 173.516 52.5996 173.516H52.2554C52.2261 174.355 52.2041 175 52.1895 175.449C52.1797 175.894 52.1748 176.262 52.1748 176.555C52.1748 177.659 52.2505 178.379 52.4019 178.716C52.5532 179.048 52.8242 179.214 53.2148 179.214C53.376 179.214 53.5542 179.18 53.7495 179.111C53.9497 179.043 54.1914 178.931 54.4746 178.774L54.7163 179.258C54.2476 179.541 53.8228 179.756 53.4419 179.902C53.061 180.044 52.729 180.115 52.4458 180.115C51.9233 180.115 51.5425 179.937 51.3032 179.58C51.064 179.219 50.9443 178.64 50.9443 177.844C50.9443 177.688 50.9541 177.131 50.9736 176.174C50.998 175.212 51.0103 174.331 51.0103 173.53C50.9663 173.53 50.9028 173.533 50.8198 173.538C50.4146 173.552 50.1362 173.56 49.9849 173.56V173.032C50.4634 172.964 50.8589 172.788 51.1714 172.505C51.4839 172.217 51.7134 171.824 51.8599 171.326ZM61.0298 178.459L61.396 179.016C60.9224 179.377 60.4561 179.651 59.9971 179.836C59.5381 180.022 59.1035 180.115 58.6934 180.115C57.7363 180.115 56.9551 179.773 56.3496 179.089C55.7441 178.401 55.4414 177.522 55.4414 176.453C55.4414 175.344 55.8247 174.407 56.5913 173.64C57.3579 172.874 58.293 172.49 59.3965 172.49C59.9629 172.49 60.3999 172.571 60.7075 172.732C61.0151 172.888 61.1689 173.108 61.1689 173.391C61.1689 173.596 61.1055 173.774 60.9785 173.926C60.8564 174.072 60.7148 174.146 60.5537 174.146C60.5 174.146 60.2729 174.023 59.8726 173.779C59.4771 173.53 59.0986 173.406 58.7373 173.406C58.1025 173.406 57.5972 173.635 57.2212 174.094C56.8501 174.548 56.6646 175.168 56.6646 175.955C56.6646 176.946 56.8892 177.72 57.3384 178.276C57.7925 178.828 58.4199 179.104 59.2207 179.104C59.5186 179.104 59.814 179.053 60.1069 178.95C60.4048 178.848 60.7124 178.684 61.0298 178.459ZM64.3916 168.579C64.3721 169.399 64.355 170.237 64.3403 171.091C64.3257 171.946 64.3159 172.822 64.311 173.721C64.8579 173.306 65.3462 173 65.7759 172.805C66.2056 172.605 66.5962 172.505 66.9478 172.505C67.6655 172.505 68.2051 172.708 68.5664 173.113C68.9277 173.518 69.1084 174.126 69.1084 174.937C69.1084 174.941 69.106 175.156 69.1011 175.581C69.0962 176.006 69.0938 176.431 69.0938 176.855C69.0938 177.036 69.0913 177.263 69.0864 177.537C69.0815 177.805 69.0791 177.988 69.0791 178.086C69.0791 178.633 69.1279 178.989 69.2256 179.155C69.3232 179.321 69.5088 179.404 69.7822 179.404C69.7969 179.404 69.8237 179.402 69.8628 179.397C69.9067 179.392 69.9409 179.39 69.9653 179.39V179.902C69.521 179.873 69.1865 179.854 68.9619 179.844C68.7373 179.834 68.5518 179.829 68.4053 179.829C68.1709 179.829 67.917 179.836 67.6436 179.851C67.375 179.861 67.0942 179.878 66.8013 179.902L66.7939 179.39H66.9038C67.5288 179.39 67.8486 178.818 67.8633 177.676C67.8633 177.612 67.8633 177.563 67.8633 177.529L67.8779 175.955V175.654C67.8779 174.766 67.7729 174.177 67.563 173.889C67.353 173.596 66.9917 173.45 66.479 173.45C66.2007 173.45 65.8906 173.518 65.5488 173.655C65.2119 173.792 64.814 174.009 64.355 174.307L64.3184 176.914C64.3184 177.061 64.3159 177.249 64.311 177.478C64.3062 177.708 64.3037 177.866 64.3037 177.954C64.3037 178.56 64.3525 178.953 64.4502 179.133C64.5479 179.314 64.7358 179.404 65.0142 179.404C65.0337 179.404 65.063 179.402 65.1021 179.397C65.146 179.392 65.1802 179.39 65.2046 179.39V179.902C64.897 179.878 64.6064 179.861 64.333 179.851C64.0645 179.836 63.8301 179.829 63.6299 179.829C63.4395 179.829 63.2197 179.834 62.9707 179.844C62.7217 179.854 62.397 179.871 61.9966 179.895V179.39C62.0259 179.39 62.0674 179.392 62.1211 179.397C62.1748 179.402 62.2139 179.404 62.2383 179.404C62.5752 179.404 62.8022 179.316 62.9194 179.141C63.0366 178.96 63.0952 178.44 63.0952 177.581V177.039L63.1245 171.531V170.271C63.1245 170.061 63.0781 169.905 62.9854 169.802C62.8975 169.695 62.7632 169.641 62.5825 169.641C62.5142 169.641 62.4019 169.656 62.2456 169.685C62.2065 169.695 62.1797 169.7 62.165 169.7L62.0552 169.224C62.4556 169.146 62.8486 169.055 63.2344 168.953C63.6201 168.845 64.0059 168.721 64.3916 168.579Z" fill="black"></path>
<path d="M134 68V49.5H363V68" stroke="black"></path>
<path d="M99.5 106.902H82.5V242.402H99.5" stroke="black"></path>
<path d="M329.398 313.137C329.462 313.146 329.528 313.151 329.596 313.151C329.665 313.151 329.767 313.151 329.904 313.151C330.939 313.151 331.752 312.934 332.343 312.5C332.938 312.065 333.236 311.474 333.236 310.727C333.236 310.058 333.053 309.55 332.687 309.204C332.321 308.857 331.789 308.684 331.09 308.684C330.983 308.684 330.849 308.688 330.688 308.698C330.531 308.708 330.355 308.723 330.16 308.742C329.955 309.885 329.792 310.8 329.669 311.489C329.552 312.177 329.462 312.727 329.398 313.137ZM326.308 317.517H326.593C326.896 317.517 327.111 317.431 327.238 317.26C327.37 317.084 327.504 316.601 327.641 315.81L328.703 309.482C328.717 309.409 328.729 309.34 328.739 309.277C328.749 309.213 328.754 309.162 328.754 309.123C328.754 308.923 328.686 308.776 328.549 308.684C328.417 308.586 328.214 308.537 327.941 308.537H327.743L327.838 307.995C328.146 308.024 328.427 308.046 328.681 308.061C328.935 308.076 329.164 308.083 329.369 308.083C329.687 308.083 330.109 308.068 330.636 308.039C331.168 308.01 331.54 307.995 331.75 307.995C332.648 307.995 333.349 308.203 333.852 308.618C334.359 309.028 334.613 309.594 334.613 310.317C334.613 311.005 334.394 311.611 333.954 312.133C333.515 312.651 332.87 313.071 332.021 313.393L333.134 315.51C333.163 315.573 333.209 315.668 333.273 315.795C333.893 317.006 334.555 317.612 335.258 317.612C335.282 317.612 335.319 317.609 335.368 317.604C335.421 317.6 335.46 317.597 335.485 317.597L335.397 318.088C335.172 318.127 334.984 318.154 334.833 318.168C334.682 318.188 334.55 318.198 334.438 318.198C333.993 318.198 333.615 318.117 333.302 317.956C332.99 317.79 332.733 317.539 332.533 317.202C332.392 316.972 332.128 316.447 331.742 315.627C331.361 314.807 331.054 314.157 330.819 313.679C330.663 313.693 330.504 313.706 330.343 313.715C330.187 313.72 330.026 313.723 329.86 313.723C329.796 313.723 329.701 313.72 329.574 313.715C329.452 313.71 329.357 313.708 329.289 313.708L328.871 316.469C328.856 316.572 328.844 316.662 328.834 316.74C328.83 316.813 328.827 316.875 328.827 316.923C328.827 317.163 328.878 317.321 328.981 317.399C329.088 317.478 329.311 317.517 329.647 317.517H329.816L329.721 318C329.56 317.995 329.333 317.985 329.04 317.971C328.468 317.951 328.102 317.941 327.941 317.941C327.692 317.941 327.252 317.956 326.623 317.985C326.452 317.99 326.315 317.995 326.212 318L326.308 317.517ZM337.858 314.697L337.931 314.66C339.669 313.771 340.539 313.085 340.539 312.602C340.539 312.343 340.446 312.119 340.26 311.928C340.075 311.738 339.857 311.643 339.608 311.643C339.223 311.643 338.876 311.909 338.568 312.441C338.261 312.973 338.024 313.725 337.858 314.697ZM340.062 314.191L337.821 315.349V315.422C337.821 316.003 337.912 316.445 338.092 316.748C338.278 317.05 338.544 317.202 338.891 317.202C339.096 317.202 339.352 317.111 339.66 316.931C339.972 316.745 340.37 316.447 340.854 316.037L341.11 316.499C340.412 317.143 339.855 317.59 339.44 317.839C339.03 318.088 338.656 318.212 338.319 318.212C337.807 318.212 337.392 317.99 337.074 317.546C336.757 317.102 336.598 316.518 336.598 315.795C336.598 315.283 336.681 314.733 336.847 314.147C337.018 313.557 337.238 313.042 337.506 312.602C337.843 312.065 338.229 311.65 338.664 311.357C339.098 311.064 339.547 310.917 340.011 310.917C340.485 310.917 340.88 311.069 341.198 311.372C341.52 311.669 341.681 312.033 341.681 312.463C341.681 312.81 341.583 313.098 341.388 313.327C341.198 313.552 340.756 313.84 340.062 314.191ZM346.405 315.378L346.955 312.06C346.686 311.904 346.447 311.792 346.237 311.723C346.027 311.65 345.832 311.613 345.651 311.613C345.05 311.613 344.545 311.999 344.135 312.771C343.725 313.537 343.52 314.494 343.52 315.642C343.52 316.105 343.573 316.457 343.681 316.696C343.793 316.936 343.957 317.055 344.171 317.055C344.318 317.055 344.589 316.906 344.984 316.608C345.385 316.311 345.858 315.9 346.405 315.378ZM346.42 316.125L345.175 317.253C344.809 317.585 344.516 317.814 344.296 317.941C344.081 318.068 343.878 318.132 343.688 318.132C343.249 318.132 342.912 317.946 342.677 317.575C342.443 317.199 342.326 316.66 342.326 315.957C342.326 314.57 342.675 313.378 343.373 312.382C344.076 311.386 344.911 310.888 345.878 310.888C346.073 310.888 346.271 310.915 346.471 310.969C346.676 311.018 346.889 311.091 347.108 311.188L347.526 308.537C347.541 308.435 347.55 308.332 347.555 308.229C347.565 308.122 347.57 308.015 347.57 307.907C347.57 307.712 347.531 307.578 347.453 307.504C347.375 307.431 347.23 307.395 347.021 307.395C346.957 307.395 346.891 307.397 346.823 307.402C346.759 307.402 346.688 307.404 346.61 307.409L346.581 306.977C346.986 306.938 347.394 306.884 347.804 306.816C348.219 306.748 348.637 306.665 349.057 306.567C348.603 308.911 348.229 311.027 347.936 312.917C347.643 314.802 347.497 315.947 347.497 316.352C347.497 316.601 347.519 316.777 347.562 316.879C347.611 316.977 347.689 317.026 347.797 317.026C347.855 317.026 347.924 317.001 348.002 316.953C348.085 316.904 348.188 316.823 348.31 316.711L348.756 316.308L348.998 316.726L348.156 317.553C347.863 317.836 347.65 318.017 347.519 318.095C347.387 318.173 347.26 318.212 347.138 318.212C346.879 318.212 346.688 318.09 346.566 317.846C346.449 317.602 346.391 317.224 346.391 316.711C346.391 316.599 346.393 316.499 346.398 316.411C346.403 316.318 346.41 316.223 346.42 316.125ZM356.491 316.77L355.48 317.714C355.299 317.89 355.136 318.015 354.989 318.088C354.848 318.161 354.701 318.198 354.55 318.198C354.33 318.198 354.152 318.093 354.015 317.883C353.883 317.668 353.817 317.382 353.817 317.026C353.817 316.923 353.825 316.801 353.839 316.66C353.859 316.513 353.896 316.286 353.949 315.979C353.046 316.901 352.406 317.502 352.03 317.78C351.654 318.059 351.334 318.198 351.071 318.198C350.792 318.198 350.561 318.068 350.375 317.81C350.189 317.551 350.097 317.219 350.097 316.813C350.097 316.472 350.243 315.703 350.536 314.506C350.609 314.223 350.663 314.008 350.697 313.862C350.8 313.457 350.875 313.132 350.924 312.888C350.973 312.639 350.998 312.453 350.998 312.331C350.998 312.233 350.973 312.155 350.924 312.097C350.875 312.033 350.814 312.001 350.741 312.001C350.692 312.001 350.597 312.036 350.456 312.104C350.314 312.172 350.119 312.277 349.87 312.419L349.665 312.016C350.119 311.679 350.517 311.418 350.858 311.232C351.2 311.042 351.442 310.947 351.583 310.947C351.784 310.947 351.94 311.032 352.052 311.203C352.169 311.374 352.228 311.611 352.228 311.914C352.228 312.294 352.077 313.032 351.774 314.125C351.476 315.219 351.327 316.04 351.327 316.586C351.327 316.757 351.356 316.884 351.415 316.967C351.474 317.045 351.564 317.084 351.686 317.084C351.823 317.084 352.055 316.95 352.382 316.682C352.714 316.408 353.268 315.888 354.044 315.122C354.23 314.243 354.379 313.5 354.491 312.895C354.608 312.285 354.699 311.74 354.762 311.262L356.081 310.947L355.919 311.672C355.641 312.858 355.49 313.52 355.465 313.657L355.29 314.594C355.202 315.039 355.131 315.463 355.077 315.869C355.028 316.274 355.004 316.56 355.004 316.726C355.004 316.838 355.026 316.926 355.07 316.989C355.114 317.053 355.172 317.084 355.246 317.084C355.314 317.084 355.441 317.019 355.626 316.887C355.812 316.755 356.024 316.577 356.264 316.352L356.491 316.77ZM361.793 312.177L361.405 312.558C361.083 312.231 360.824 312.014 360.629 311.906C360.438 311.799 360.243 311.745 360.043 311.745C359.594 311.745 359.203 312.08 358.871 312.749C358.539 313.413 358.373 314.233 358.373 315.209C358.373 315.864 358.458 316.357 358.629 316.689C358.8 317.021 359.052 317.187 359.384 317.187C359.569 317.187 359.823 317.082 360.146 316.872C360.468 316.657 360.807 316.364 361.164 315.993L361.464 316.513C360.897 317.114 360.414 317.548 360.014 317.817C359.613 318.081 359.247 318.212 358.915 318.212C358.388 318.212 357.965 317.983 357.648 317.524C357.335 317.065 357.179 316.445 357.179 315.664C357.179 314.326 357.521 313.198 358.205 312.28C358.893 311.362 359.74 310.903 360.746 310.903C361.112 310.903 361.425 310.981 361.684 311.137C361.947 311.293 362.079 311.472 362.079 311.672C362.079 311.75 362.057 311.828 362.013 311.906C361.974 311.984 361.901 312.075 361.793 312.177ZM365.792 309.24C365.7 309.567 365.57 310.08 365.404 310.778C365.355 310.983 365.319 311.135 365.294 311.232C365.583 311.232 365.875 311.23 366.173 311.225C366.476 311.215 366.793 311.203 367.125 311.188L366.95 311.921C366.818 311.916 366.671 311.914 366.51 311.914C366.349 311.914 366.09 311.914 365.734 311.914H365.148C364.918 312.919 364.748 313.798 364.635 314.55C364.528 315.302 364.474 315.932 364.474 316.44C364.474 316.655 364.508 316.823 364.577 316.945C364.65 317.067 364.75 317.128 364.877 317.128C364.975 317.128 365.128 317.05 365.338 316.894C365.548 316.738 365.834 316.486 366.195 316.14L366.452 316.608C365.749 317.331 365.265 317.792 365.001 317.993C364.738 318.188 364.516 318.286 364.335 318.286C363.998 318.286 363.729 318.127 363.529 317.81C363.329 317.492 363.229 317.06 363.229 316.513C363.229 316.157 363.285 315.646 363.397 314.982C363.51 314.313 363.722 313.278 364.035 311.877C363.957 311.877 363.854 311.879 363.727 311.884C363.605 311.889 363.522 311.892 363.478 311.892H362.973L363.061 311.401C363.285 311.391 363.49 311.352 363.676 311.284C363.866 311.215 364.057 311.108 364.247 310.961C364.291 310.786 364.34 310.603 364.394 310.412C364.452 310.217 364.518 310.012 364.591 309.797L365.792 309.24ZM370.634 316.337L370.89 316.77C370.29 317.39 369.872 317.785 369.638 317.956C369.403 318.127 369.196 318.212 369.015 318.212C368.756 318.212 368.549 318.105 368.393 317.89C368.236 317.67 368.158 317.377 368.158 317.011C368.158 316.552 368.302 315.786 368.59 314.711C368.883 313.637 369.03 312.863 369.03 312.39C369.03 312.268 369 312.17 368.942 312.097C368.883 312.023 368.808 311.987 368.715 311.987C368.637 311.987 368.534 312.019 368.407 312.082C368.28 312.146 368.122 312.243 367.931 312.375L367.711 311.987L368.686 311.276C368.871 311.14 369.032 311.042 369.169 310.983C369.306 310.92 369.435 310.888 369.557 310.888C369.787 310.888 369.967 310.983 370.099 311.174C370.236 311.359 370.304 311.616 370.304 311.943C370.304 312.299 370.177 312.998 369.923 314.038C369.865 314.272 369.821 314.448 369.792 314.565C369.655 315.117 369.55 315.573 369.477 315.935C369.408 316.296 369.374 316.545 369.374 316.682C369.374 316.804 369.401 316.904 369.455 316.982C369.508 317.06 369.577 317.099 369.66 317.099C369.738 317.099 369.84 317.05 369.967 316.953C370.094 316.855 370.316 316.65 370.634 316.337ZM370.575 306.896L370.993 307.365C371.11 307.487 371.19 307.597 371.234 307.695C371.283 307.788 371.308 307.883 371.308 307.98C371.308 308.083 371.271 308.181 371.198 308.273C371.129 308.366 371.027 308.454 370.89 308.537L370.246 308.896L369.777 308.339C369.679 308.217 369.616 308.122 369.586 308.054C369.557 307.98 369.542 307.905 369.542 307.827C369.542 307.714 369.572 307.617 369.63 307.534C369.689 307.446 369.789 307.36 369.931 307.277L370.575 306.896ZM375.167 311.628C374.601 311.628 374.113 312.016 373.703 312.792C373.292 313.569 373.087 314.526 373.087 315.664C373.087 316.264 373.19 316.723 373.395 317.041C373.605 317.358 373.908 317.517 374.303 317.517C374.899 317.517 375.404 317.136 375.819 316.374C376.239 315.607 376.449 314.67 376.449 313.562C376.449 312.902 376.344 312.417 376.134 312.104C375.924 311.787 375.602 311.628 375.167 311.628ZM375.482 310.917C376.21 310.917 376.762 311.145 377.138 311.599C377.519 312.048 377.709 312.707 377.709 313.576C377.709 314.074 377.611 314.606 377.416 315.173C377.221 315.734 376.957 316.242 376.625 316.696C376.269 317.185 375.863 317.561 375.409 317.824C374.96 318.083 374.486 318.212 373.988 318.212C373.334 318.212 372.812 317.976 372.421 317.502C372.035 317.028 371.842 316.394 371.842 315.598C371.842 315.007 371.938 314.431 372.128 313.869C372.318 313.308 372.592 312.8 372.948 312.346C373.3 311.892 373.698 311.54 374.142 311.291C374.591 311.042 375.038 310.917 375.482 310.917ZM380.888 313.02L382.074 311.862C382.489 311.467 382.802 311.206 383.012 311.079C383.227 310.952 383.429 310.888 383.62 310.888C383.942 310.888 384.203 311.03 384.403 311.313C384.608 311.596 384.711 311.97 384.711 312.434C384.711 312.907 384.591 313.64 384.352 314.631C384.113 315.617 383.993 316.32 383.993 316.74C383.993 316.867 384.018 316.965 384.066 317.033C384.115 317.097 384.186 317.128 384.279 317.128C384.323 317.128 384.376 317.111 384.44 317.077C384.508 317.038 384.574 316.987 384.638 316.923L385.194 316.381L385.451 316.77L384.652 317.583C384.462 317.778 384.271 317.932 384.081 318.044C383.896 318.156 383.732 318.212 383.59 318.212C383.346 318.212 383.146 318.107 382.99 317.897C382.838 317.683 382.763 317.402 382.763 317.055C382.763 316.64 382.887 315.91 383.136 314.865C383.385 313.815 383.51 313.051 383.51 312.573C383.51 312.392 383.471 312.248 383.393 312.141C383.319 312.028 383.219 311.972 383.092 311.972C382.902 311.972 382.318 312.424 381.342 313.327C381.083 313.566 380.88 313.754 380.734 313.891L380.272 316.469C380.263 316.518 380.248 316.591 380.229 316.689C380.126 317.211 380.065 317.612 380.045 317.89L378.742 318.212C379.064 316.811 379.318 315.593 379.503 314.558C379.694 313.522 379.789 312.844 379.789 312.521C379.789 312.326 379.767 312.187 379.723 312.104C379.679 312.016 379.608 311.972 379.511 311.972C379.452 311.972 379.354 312.006 379.218 312.075C379.086 312.143 378.917 312.243 378.712 312.375L378.515 311.987C378.568 311.943 378.646 311.879 378.749 311.796C379.501 311.191 380.004 310.888 380.258 310.888C380.502 310.888 380.683 310.981 380.8 311.167C380.917 311.347 380.976 311.63 380.976 312.016C380.976 312.153 380.968 312.307 380.954 312.478C380.939 312.648 380.917 312.829 380.888 313.02Z" fill="black"></path>
<path d="M386.354 296.854C386.549 296.658 386.549 296.342 386.354 296.146L383.172 292.964C382.976 292.769 382.66 292.769 382.464 292.964C382.269 293.16 382.269 293.476 382.464 293.672L385.293 296.5L382.464 299.328C382.269 299.524 382.269 299.84 382.464 300.036C382.66 300.231 382.976 300.231 383.172 300.036L386.354 296.854ZM150 296.5V297H386V296.5V296H150V296.5Z" fill="black"></path>
<defs>
<clipPath id="clip0_249_8276-rmsnorm-1-svg">
<rect x="111" y="79.9023" width="275" height="183" rx="2" fill="white"></rect>
</clipPath>
</defs>
</svg>

<figcaption><b>Data Parallel RMSNorm</b> Ideally, we'd like to avoid communication between cores in our parallelization strategy. One way to achieve that is by assigning one batch-element to each core, thus guaranteeing that each reduction is done entirely within a single core. This is what's known as a "data-parallel" strategy, since we're simply parallelizing along a dimension that doesn't require communication. In this example, we have four rows and four cores, saturating our cores. </figcaption>
</figure>
RMSNorm can be implemented as:
<div><pre tabindex="0"><code data-lang="python"><span><span><span># x: [batch_size, hidden_dim]</span>
</span></span><span><span><span># weight: [hidden_dim]</span>
</span></span><span><span><span>def</span> <span>rms_norm</span><span>(</span><span>x</span><span>,</span> <span>weight</span><span>):</span>
</span></span><span><span>    <span>return</span> <span>x</span> <span>*</span> <span>torch</span><span>.</span><span>rsqrt</span><span>(</span><span>torch</span><span>.</span><span>mean</span><span>(</span><span>x</span> <span>**</span> <span>2</span><span>,</span> <span>dim</span><span>=-</span><span>1</span><span>,</span> <span>keepdim</span><span>=</span><span>True</span><span>))</span> <span>*</span> <span>weight</span>
</span></span></code></pre></div><p>The requirement for batch invariance is that the <b>reduction order for each element must be fixed regardless of the batch-size of the kernel.</b> Note that this doesn’t mean we must always use the same reduction strategy. For example, if we change the number of elements we’re reducing over, we can still be batch-invariant even if our reduction strategy changes.<label for="sn8"></label><span><a href="https://github.com/Dao-AILab/quack/blob/main/media/2025-07-10-membound-sol.md">The Quack</a> blog post has some nice examples showing the hierarchy of various reduction strategies you can do (e.g. thread reduction, warp reduction, block reduction, cluster reduction).</span></p>
<p>Thus, we only break batch invariance when our batch-size affects the reduction strategy.</p>
<p>Let’s look at the standard parallelism strategy for RMSNorm. Generally, parallel algorithms benefit from minimizing communication across cores. <label for="sn9"></label><span>For the purpose of this discussion you can assume that when we refer to “cores” we mean SMs. More specifically, the property here that’s important is that the # of threadblocks our kernel launches is greater than the # of SMs.</span> So, one strategy we can start with is to assign each batch element to one core, as seen in the above figure.</p>
<p>Increasing our batch size doesn’t affect our reduction strategy; if a batch size of 200 provides sufficient parallelism to our kernel then a batch size of 2000 will <em>definitely</em> provide sufficient parallelism.</p>
<figure>
<svg width="430" height="500" viewBox="0 0 430 500" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="430" height="500" fill="#F5F5F5"></rect>
<rect width="430" height="500" fill="white"></rect>
<g clip-path="url(#clip0_249_8276-rmsnorm-2-svg)">
<rect x="111" y="79.9023" width="40" height="40" fill="#EF402C"></rect>
<rect opacity="0.86" x="152" y="79.9023" width="40" height="40" fill="#EF402C"></rect>
<rect opacity="0.72" x="193" y="79.9023" width="40" height="40" fill="#EF402C"></rect>
<rect opacity="0.58" x="234" y="79.9023" width="40" height="40" fill="#EF402C"></rect>
<rect opacity="0.44" x="275" y="79.9023" width="40" height="40" fill="#EF402C"></rect>
<rect opacity="0.3" x="316" y="79.9023" width="40" height="40" fill="#EF402C"></rect>
<rect x="111" y="120.902" width="40" height="40" fill="#F7A224"></rect>
<rect opacity="0.86" x="152" y="120.902" width="40" height="40" fill="#F7A224"></rect>
<rect opacity="0.72" x="193" y="120.902" width="40" height="40" fill="#F7A224"></rect>
<rect opacity="0.58" x="234" y="120.902" width="40" height="40" fill="#F7A224"></rect>
<rect opacity="0.44" x="275" y="120.902" width="40" height="40" fill="#F7A224"></rect>
<rect opacity="0.3" x="316" y="120.902" width="40" height="40" fill="#F7A224"></rect>
<rect x="111" y="161.902" width="40" height="40" fill="#009DE4"></rect>
<rect opacity="0.86" x="152" y="161.902" width="40" height="40" fill="#009DE4"></rect>
<rect opacity="0.72" x="193" y="161.902" width="40" height="40" fill="#009DE4"></rect>
<rect opacity="0.58" x="234" y="161.902" width="40" height="40" fill="#009DE4"></rect>
<rect opacity="0.44" x="275" y="161.902" width="40" height="40" fill="#009DE4"></rect>
<rect opacity="0.3" x="316" y="161.902" width="40" height="40" fill="#009DE4"></rect>
<rect x="111" y="202.902" width="40" height="40" fill="#6D274C"></rect>
<rect opacity="0.86" x="152" y="202.902" width="40" height="40" fill="#6D274C"></rect>
<rect opacity="0.72" x="193" y="202.902" width="40" height="40" fill="#6D274C"></rect>
<rect opacity="0.58" x="234" y="202.902" width="40" height="40" fill="#6D274C"></rect>
<rect opacity="0.44" x="275" y="202.902" width="40" height="40" fill="#6D274C"></rect>
<rect opacity="0.3" x="316" y="202.902" width="40" height="40" fill="#6D274C"></rect>
<rect x="111" y="243.902" width="40" height="40" fill="#EF402C"></rect>
<rect opacity="0.86" x="152" y="243.902" width="40" height="40" fill="#EF402C"></rect>
<rect opacity="0.72" x="193" y="243.902" width="40" height="40" fill="#EF402C"></rect>
<rect opacity="0.58" x="234" y="243.902" width="40" height="40" fill="#EF402C"></rect>
<rect opacity="0.44" x="275" y="243.902" width="40" height="40" fill="#EF402C"></rect>
<rect opacity="0.3" x="316" y="243.902" width="40" height="40" fill="#EF402C"></rect>
<rect x="111" y="284.902" width="40" height="40" fill="#F7A224"></rect>
<rect opacity="0.86" x="152" y="284.902" width="40" height="40" fill="#F7A224"></rect>
<rect opacity="0.72" x="193" y="284.902" width="40" height="40" fill="#F7A224"></rect>
<rect opacity="0.58" x="234" y="284.902" width="40" height="40" fill="#F7A224"></rect>
<rect opacity="0.44" x="275" y="284.902" width="40" height="40" fill="#F7A224"></rect>
<rect opacity="0.3" x="316" y="284.902" width="40" height="40" fill="#F7A224"></rect>
<rect x="111" y="325.902" width="40" height="40" fill="#009DE4"></rect>
<rect opacity="0.86" x="152" y="325.902" width="40" height="40" fill="#009DE4"></rect>
<rect opacity="0.72" x="193" y="325.902" width="40" height="40" fill="#009DE4"></rect>
<rect opacity="0.58" x="234" y="325.902" width="40" height="40" fill="#009DE4"></rect>
<rect opacity="0.44" x="275" y="325.902" width="40" height="40" fill="#009DE4"></rect>
<rect opacity="0.3" x="316" y="325.902" width="40" height="40" fill="#009DE4"></rect>
<rect x="111" y="366.902" width="40" height="40" fill="#6D274C"></rect>
<rect opacity="0.86" x="152" y="366.902" width="40" height="40" fill="#6D274C"></rect>
<rect opacity="0.72" x="193" y="366.902" width="40" height="40" fill="#6D274C"></rect>
<rect opacity="0.58" x="234" y="366.902" width="40" height="40" fill="#6D274C"></rect>
<rect opacity="0.44" x="275" y="366.902" width="40" height="40" fill="#6D274C"></rect>
<rect opacity="0.3" x="316" y="366.902" width="40" height="40" fill="#6D274C"></rect>
</g>
<path d="M205.557 37.5239C205.596 37.5288 205.632 37.5337 205.667 37.5386C205.706 37.5386 205.764 37.5386 205.842 37.5386C206.233 37.5386 206.497 37.4116 206.633 37.1577C206.775 36.8989 206.846 36.3252 206.846 35.4365C206.846 35.29 206.843 35.0288 206.838 34.6528C206.833 34.2769 206.831 33.9668 206.831 33.7227V31.7305C206.831 31.4619 206.833 31.042 206.838 30.4707C206.843 29.8945 206.846 29.4551 206.846 29.1523C206.846 28.7373 206.765 28.4492 206.604 28.2881C206.448 28.1221 206.172 28.0391 205.776 28.0391H205.659V27.5483C206.67 27.5728 207.488 27.5923 208.113 27.6069C208.743 27.6167 209.275 27.6216 209.709 27.6216C210.183 27.6216 210.693 27.6167 211.24 27.6069C211.792 27.5923 212.407 27.5728 213.086 27.5483C213.086 27.8853 213.096 28.2417 213.115 28.6177C213.14 28.9888 213.174 29.4111 213.218 29.8848L212.712 29.9434C212.678 29.3232 212.505 28.9058 212.192 28.6909C211.88 28.4761 211.182 28.3687 210.098 28.3687C209.717 28.3687 209.124 28.3784 208.318 28.3979H208.274C208.264 29.1206 208.25 29.9263 208.23 30.8149C208.21 31.6987 208.198 32.1895 208.193 32.2871H208.435C208.708 32.2871 209.048 32.2896 209.453 32.2944C209.858 32.2993 210.134 32.3018 210.281 32.3018C210.999 32.3018 211.472 32.2358 211.702 32.104C211.936 31.9722 212.063 31.728 212.083 31.3716L212.544 31.4009C212.505 31.7671 212.478 32.0698 212.463 32.3091C212.449 32.5435 212.441 32.7607 212.441 32.9609C212.441 33.1074 212.444 33.2808 212.449 33.481C212.458 33.6812 212.471 33.9058 212.485 34.1548L212.002 34.1914V34.0669C212.002 33.6665 211.882 33.3955 211.643 33.2539C211.404 33.1074 210.85 33.0342 209.98 33.0342H208.721H208.193V35.8833C208.193 36.5864 208.271 37.0308 208.428 37.2163C208.584 37.397 208.901 37.4873 209.38 37.4873H209.666V38C209.294 37.9805 208.928 37.9658 208.567 37.9561C208.21 37.9463 207.861 37.9414 207.52 37.9414C207.349 37.9414 207.087 37.9463 206.736 37.9561C206.389 37.9658 205.996 37.9805 205.557 38V37.5239ZM220.044 33.9058H216.47C216.191 33.9058 215.935 33.9106 215.701 33.9204C215.466 33.9302 215.249 33.9448 215.049 33.9644V34.2354C215.049 35.1924 215.269 35.9321 215.708 36.4546C216.152 36.9771 216.777 37.2383 217.583 37.2383C217.939 37.2383 218.291 37.1797 218.638 37.0625C218.984 36.9404 219.353 36.7524 219.744 36.4985L220.029 36.9673C219.526 37.3774 219.023 37.6875 218.521 37.8975C218.022 38.1074 217.529 38.2124 217.041 38.2124C216.094 38.2124 215.312 37.8755 214.697 37.2017C214.082 36.5229 213.774 35.6538 213.774 34.5942C213.774 33.4663 214.097 32.519 214.741 31.7524C215.386 30.9858 216.172 30.6025 217.1 30.6025C217.964 30.6025 218.652 30.8906 219.165 31.4668C219.678 32.043 219.971 32.856 220.044 33.9058ZM218.689 33.1367C218.542 32.5361 218.32 32.0771 218.022 31.7598C217.725 31.4375 217.368 31.2764 216.953 31.2764C216.484 31.2764 216.082 31.4644 215.745 31.8403C215.413 32.2163 215.195 32.7241 215.093 33.3638C216.06 33.3638 216.819 33.3467 217.371 33.3125C217.927 33.2783 218.367 33.2197 218.689 33.1367ZM227.595 36.938L227.8 37.3994C227.434 37.6631 227.1 37.8657 226.797 38.0073C226.494 38.1538 226.25 38.2271 226.064 38.2271C225.752 38.2271 225.518 38.1367 225.361 37.9561C225.205 37.7705 225.12 37.4922 225.105 37.1211C224.573 37.4775 224.131 37.7339 223.779 37.8901C223.428 38.0415 223.113 38.1172 222.834 38.1172C222.341 38.1172 221.929 37.9316 221.597 37.5605C221.265 37.1895 221.099 36.7354 221.099 36.1982C221.099 35.2852 222.083 34.5967 224.05 34.1328C224.514 34.0254 224.875 33.9399 225.134 33.8765C225.134 33.7935 225.137 33.6738 225.142 33.5176C225.156 33.1953 225.164 32.9854 225.164 32.8877C225.164 32.3799 225.059 32.0063 224.849 31.7671C224.639 31.5229 224.319 31.4009 223.889 31.4009C223.469 31.4009 223.137 31.479 222.893 31.6353C222.654 31.7866 222.534 31.9941 222.534 32.2578C222.534 32.2822 222.537 32.3164 222.542 32.3604C222.546 32.3994 222.549 32.4287 222.549 32.4482C222.549 32.5996 222.476 32.7266 222.329 32.8291C222.183 32.9268 222.007 32.9756 221.802 32.9756C221.626 32.9756 221.497 32.9463 221.414 32.8877C221.331 32.8291 221.289 32.7388 221.289 32.6167C221.289 32.2261 221.619 31.7915 222.278 31.313C222.937 30.8296 223.618 30.5879 224.321 30.5879C225 30.5879 225.515 30.7759 225.867 31.1519C226.218 31.5229 226.394 32.0698 226.394 32.7925C226.394 33.1831 226.37 33.7837 226.321 34.5942C226.277 35.4048 226.255 36.02 226.255 36.4399C226.255 36.7573 226.289 36.9722 226.357 37.0845C226.431 37.1968 226.558 37.2529 226.738 37.2529C226.816 37.2529 226.917 37.231 227.039 37.187C227.166 37.1382 227.351 37.0552 227.595 36.938ZM225.098 34.4624C225.005 34.4868 224.866 34.5234 224.68 34.5723C223.093 35.0068 222.3 35.5195 222.3 36.1104C222.3 36.4326 222.402 36.6963 222.607 36.9014C222.812 37.1016 223.083 37.2017 223.42 37.2017C223.625 37.2017 223.862 37.1479 224.131 37.0405C224.399 36.9331 224.712 36.7622 225.068 36.5278L225.098 34.4624ZM230.085 29.4233L230.569 29.5698C230.54 29.8384 230.515 30.0801 230.496 30.2949C230.481 30.5049 230.471 30.7124 230.466 30.9175H230.986C231.265 30.9175 231.548 30.915 231.836 30.9102C232.124 30.9004 232.415 30.8882 232.708 30.8735L232.532 31.6719C232.219 31.6475 231.924 31.6328 231.646 31.6279C231.372 31.6182 231.099 31.6133 230.825 31.6133H230.481C230.452 32.4531 230.43 33.0977 230.415 33.5469C230.405 33.9912 230.4 34.3599 230.4 34.6528C230.4 35.7563 230.476 36.4766 230.627 36.8135C230.779 37.1455 231.05 37.3115 231.44 37.3115C231.602 37.3115 231.78 37.2773 231.975 37.209C232.175 37.1406 232.417 37.0283 232.7 36.8721L232.942 37.3555C232.473 37.6387 232.048 37.8535 231.667 38C231.287 38.1416 230.955 38.2124 230.671 38.2124C230.149 38.2124 229.768 38.0342 229.529 37.6777C229.29 37.3164 229.17 36.7378 229.17 35.9419C229.17 35.7856 229.18 35.229 229.199 34.272C229.224 33.3101 229.236 32.4287 229.236 31.6279C229.192 31.6279 229.128 31.6304 229.045 31.6353C228.64 31.6499 228.362 31.6572 228.21 31.6572V31.1299C228.689 31.0615 229.084 30.8857 229.397 30.6025C229.709 30.3145 229.939 29.9214 230.085 29.4233ZM235.872 30.5952C235.837 31.5522 235.811 32.3921 235.791 33.1147C235.771 33.8325 235.762 34.3306 235.762 34.6089C235.762 35.6538 235.869 36.3521 236.084 36.7036C236.299 37.0503 236.667 37.2236 237.19 37.2236C237.449 37.2236 237.737 37.1602 238.054 37.0332C238.372 36.9062 238.733 36.7134 239.138 36.4546C239.153 35.7026 239.163 35.0825 239.167 34.5942C239.177 34.106 239.182 33.7471 239.182 33.5176V33.0195C239.182 32.4043 239.131 32.0186 239.028 31.8623C238.926 31.7061 238.728 31.6279 238.435 31.6279C238.386 31.6279 238.333 31.6304 238.274 31.6353C238.22 31.6353 238.164 31.6377 238.105 31.6426L238.062 31.1738C238.477 31.1445 238.884 31.0981 239.285 31.0347C239.69 30.9712 240.085 30.8931 240.471 30.8003C240.442 31.6353 240.42 32.3799 240.405 33.0342C240.391 33.6885 240.383 34.2598 240.383 34.748C240.383 34.9482 240.381 35.1997 240.376 35.5024C240.371 35.8003 240.369 35.998 240.369 36.0957C240.369 36.5498 240.408 36.8477 240.486 36.9893C240.564 37.1309 240.71 37.2017 240.925 37.2017C240.974 37.2017 241.03 37.1968 241.094 37.187C241.162 37.1772 241.25 37.1577 241.357 37.1284L241.416 37.5825L239.182 38.1465L239.153 37.0552C238.625 37.4556 238.162 37.7485 237.761 37.9341C237.366 38.1196 237.004 38.2124 236.677 38.2124C236.008 38.2124 235.486 38.0195 235.11 37.6338C234.734 37.248 234.546 36.7109 234.546 36.0225C234.546 35.8467 234.553 35.478 234.568 34.9165C234.573 34.6821 234.575 34.499 234.575 34.3672L234.597 33.5469C234.597 33.4102 234.6 33.2368 234.604 33.0269C234.609 32.812 234.612 32.6655 234.612 32.5874C234.612 32.1675 234.575 31.8892 234.502 31.7524C234.434 31.6157 234.304 31.5474 234.114 31.5474C234.055 31.5474 233.987 31.5522 233.909 31.562C233.831 31.5718 233.75 31.5815 233.667 31.5913L233.616 31.1152C233.967 31.0566 234.329 30.9858 234.7 30.9028C235.076 30.8149 235.466 30.7124 235.872 30.5952ZM244.749 30.5146C244.714 30.8467 244.688 31.1836 244.668 31.5254C244.648 31.8623 244.634 32.2212 244.624 32.6021C245.02 31.9038 245.383 31.4009 245.715 31.0933C246.052 30.7856 246.399 30.6318 246.755 30.6318C247.034 30.6318 247.253 30.7075 247.415 30.8589C247.576 31.0054 247.656 31.2056 247.656 31.4595C247.656 31.6401 247.603 31.7964 247.495 31.9282C247.393 32.0552 247.271 32.1187 247.129 32.1187C247.041 32.1187 246.904 32.0723 246.719 31.9795C246.538 31.8818 246.382 31.833 246.25 31.833C245.996 31.833 245.742 31.9453 245.488 32.1699C245.234 32.3896 244.968 32.7339 244.69 33.2026V34.0083C244.69 34.7896 244.695 35.4243 244.705 35.9126C244.719 36.396 244.739 36.7036 244.763 36.8354C244.807 37.0845 244.9 37.2554 245.042 37.3481C245.188 37.4409 245.435 37.4873 245.781 37.4873H245.994V38C245.613 37.9707 245.273 37.9487 244.976 37.9341C244.678 37.9194 244.426 37.9121 244.221 37.9121C243.938 37.9121 243.645 37.9194 243.342 37.9341C243.044 37.9487 242.732 37.9707 242.405 38V37.4873H242.573C242.93 37.4873 243.171 37.4019 243.298 37.231C243.425 37.0601 243.489 36.6621 243.489 36.0371V35.2681V32.8877C243.489 32.3604 243.452 32.021 243.379 31.8696C243.306 31.7183 243.171 31.6426 242.976 31.6426C242.937 31.6426 242.896 31.645 242.852 31.6499C242.808 31.6499 242.734 31.6572 242.632 31.6719L242.544 31.2178C242.891 31.1396 243.247 31.042 243.613 30.9248C243.979 30.8076 244.358 30.6709 244.749 30.5146ZM254.673 33.9058H251.099C250.82 33.9058 250.564 33.9106 250.33 33.9204C250.095 33.9302 249.878 33.9448 249.678 33.9644V34.2354C249.678 35.1924 249.897 35.9321 250.337 36.4546C250.781 36.9771 251.406 37.2383 252.212 37.2383C252.568 37.2383 252.92 37.1797 253.267 37.0625C253.613 36.9404 253.982 36.7524 254.373 36.4985L254.658 36.9673C254.155 37.3774 253.652 37.6875 253.149 37.8975C252.651 38.1074 252.158 38.2124 251.67 38.2124C250.723 38.2124 249.941 37.8755 249.326 37.2017C248.711 36.5229 248.403 35.6538 248.403 34.5942C248.403 33.4663 248.726 32.519 249.37 31.7524C250.015 30.9858 250.801 30.6025 251.729 30.6025C252.593 30.6025 253.281 30.8906 253.794 31.4668C254.307 32.043 254.6 32.856 254.673 33.9058ZM253.318 33.1367C253.171 32.5361 252.949 32.0771 252.651 31.7598C252.354 31.4375 251.997 31.2764 251.582 31.2764C251.113 31.2764 250.71 31.4644 250.374 31.8403C250.042 32.2163 249.824 32.7241 249.722 33.3638C250.688 33.3638 251.448 33.3467 252 33.3125C252.556 33.2783 252.996 33.2197 253.318 33.1367ZM260.598 30.9028C260.598 31.2007 260.613 31.501 260.642 31.8037C260.676 32.1064 260.723 32.4116 260.781 32.7192L260.225 32.8071C260.166 32.2993 260.005 31.9209 259.741 31.6719C259.478 31.4229 259.109 31.2983 258.635 31.2983C258.225 31.2983 257.888 31.4106 257.625 31.6353C257.361 31.855 257.229 32.1357 257.229 32.4775C257.229 33.0195 257.805 33.4492 258.958 33.7666C259.158 33.8203 259.312 33.8618 259.419 33.8911C259.995 34.0522 260.415 34.2817 260.679 34.5796C260.947 34.8774 261.082 35.2681 261.082 35.7515C261.082 36.4644 260.801 37.0527 260.239 37.5166C259.683 37.9805 258.967 38.2124 258.093 38.2124C257.776 38.2124 257.451 38.1782 257.119 38.1099C256.787 38.0415 256.448 37.939 256.101 37.8022C256.106 37.7534 256.108 37.7021 256.108 37.6484C256.113 37.5947 256.116 37.5117 256.116 37.3994C256.116 37.1748 256.101 36.9331 256.072 36.6743C256.047 36.4106 256.008 36.1323 255.955 35.8394L256.504 35.7075C256.582 36.313 256.772 36.7671 257.075 37.0698C257.378 37.3677 257.798 37.5166 258.335 37.5166C258.823 37.5166 259.221 37.3994 259.529 37.165C259.841 36.9258 259.998 36.6182 259.998 36.2422C259.998 35.7148 259.48 35.2949 258.445 34.9824C258.342 34.9482 258.267 34.9238 258.218 34.9092C257.476 34.6846 256.953 34.4087 256.65 34.0815C256.353 33.7544 256.204 33.3198 256.204 32.7778C256.204 32.1528 256.453 31.6353 256.951 31.2251C257.449 30.8101 258.086 30.6025 258.862 30.6025C259.102 30.6025 259.36 30.627 259.639 30.6758C259.922 30.7246 260.242 30.8003 260.598 30.9028Z" fill="black"></path>
<path d="M36.1348 246.236C36.2471 246.246 36.3667 246.253 36.4937 246.258C36.6255 246.258 36.8208 246.258 37.0796 246.258C37.3579 246.258 37.6143 246.253 37.8486 246.243C38.0879 246.233 38.3174 246.216 38.5371 246.192C38.8936 245.938 39.1621 245.652 39.3428 245.335C39.5234 245.013 39.6138 244.659 39.6138 244.273C39.6138 243.653 39.416 243.165 39.0205 242.808C38.625 242.447 38.083 242.266 37.3945 242.266C37.2432 242.266 37.0674 242.276 36.8672 242.295C36.6719 242.315 36.4497 242.344 36.2007 242.383C36.186 243.038 36.1714 243.797 36.1567 244.661C36.147 245.525 36.1396 246.05 36.1348 246.236ZM36.1494 251.048C36.4326 251.131 36.7109 251.194 36.9844 251.238C37.2578 251.277 37.5239 251.297 37.7827 251.297C38.5835 251.297 39.2036 251.102 39.6431 250.711C40.0825 250.32 40.3022 249.776 40.3022 249.078C40.3022 248.335 40.0557 247.786 39.5625 247.43C39.0693 247.068 38.3125 246.888 37.292 246.888C37.126 246.888 36.9575 246.89 36.7866 246.895C36.6206 246.895 36.4033 246.902 36.1348 246.917C36.1348 247.122 36.1323 247.425 36.1274 247.825C36.1226 248.221 36.1201 248.511 36.1201 248.697C36.1201 249 36.1226 249.322 36.1274 249.664C36.1323 250 36.1396 250.462 36.1494 251.048ZM33.5566 251.524C33.5908 251.529 33.6226 251.534 33.6519 251.539C33.686 251.539 33.7349 251.539 33.7983 251.539C34.4478 251.539 34.7773 250.625 34.7871 248.799C34.792 248.34 34.7969 247.981 34.8018 247.723L34.8311 245.723C34.8359 245.293 34.8384 244.876 34.8384 244.471C34.8433 244.065 34.8457 243.626 34.8457 243.152C34.8457 242.732 34.7676 242.442 34.6113 242.281C34.4551 242.12 34.1768 242.039 33.7764 242.039H33.7178V241.526C34.0303 241.551 34.3354 241.568 34.6333 241.578C34.936 241.587 35.2412 241.592 35.5488 241.592C35.8906 241.592 36.3105 241.583 36.8086 241.563C37.3066 241.539 37.6313 241.526 37.7827 241.526C38.7886 241.526 39.582 241.751 40.1631 242.2C40.749 242.645 41.042 243.245 41.042 244.002C41.042 244.534 40.8979 244.996 40.6099 245.386C40.3267 245.772 39.8555 246.146 39.1963 246.507C40.0557 246.673 40.6978 246.966 41.1226 247.386C41.5474 247.806 41.7598 248.36 41.7598 249.048C41.7598 249.942 41.4058 250.662 40.6978 251.209C39.9897 251.756 39.0449 252.029 37.8633 252.029C37.6484 252.029 37.2456 252.017 36.6548 251.993C36.064 251.968 35.5757 251.956 35.1899 251.956C35.0288 251.956 34.8042 251.961 34.5161 251.971C34.2329 251.98 33.9131 251.995 33.5566 252.015V251.524ZM49.3696 250.938L49.5747 251.399C49.2085 251.663 48.874 251.866 48.5713 252.007C48.2686 252.154 48.0244 252.227 47.8389 252.227C47.5264 252.227 47.292 252.137 47.1357 251.956C46.9795 251.771 46.894 251.492 46.8794 251.121C46.3472 251.478 45.9053 251.734 45.5537 251.89C45.2021 252.042 44.8872 252.117 44.6089 252.117C44.1157 252.117 43.7031 251.932 43.3711 251.561C43.0391 251.189 42.873 250.735 42.873 250.198C42.873 249.285 43.8569 248.597 45.8247 248.133C46.2886 248.025 46.6499 247.94 46.9087 247.876C46.9087 247.793 46.9111 247.674 46.916 247.518C46.9307 247.195 46.938 246.985 46.938 246.888C46.938 246.38 46.833 246.006 46.623 245.767C46.4131 245.523 46.0933 245.401 45.6636 245.401C45.2437 245.401 44.9116 245.479 44.6675 245.635C44.4282 245.787 44.3086 245.994 44.3086 246.258C44.3086 246.282 44.311 246.316 44.3159 246.36C44.3208 246.399 44.3232 246.429 44.3232 246.448C44.3232 246.6 44.25 246.727 44.1035 246.829C43.957 246.927 43.7812 246.976 43.5762 246.976C43.4004 246.976 43.271 246.946 43.188 246.888C43.105 246.829 43.0635 246.739 43.0635 246.617C43.0635 246.226 43.3931 245.792 44.0522 245.313C44.7114 244.83 45.3926 244.588 46.0957 244.588C46.7744 244.588 47.2896 244.776 47.6411 245.152C47.9927 245.523 48.1685 246.07 48.1685 246.792C48.1685 247.183 48.144 247.784 48.0952 248.594C48.0513 249.405 48.0293 250.02 48.0293 250.44C48.0293 250.757 48.0635 250.972 48.1318 251.084C48.2051 251.197 48.332 251.253 48.5127 251.253C48.5908 251.253 48.6909 251.231 48.813 251.187C48.9399 251.138 49.1255 251.055 49.3696 250.938ZM46.8721 248.462C46.7793 248.487 46.6401 248.523 46.4546 248.572C44.8677 249.007 44.0742 249.52 44.0742 250.11C44.0742 250.433 44.1768 250.696 44.3818 250.901C44.5869 251.102 44.8579 251.202 45.1948 251.202C45.3999 251.202 45.6367 251.148 45.9053 251.041C46.1738 250.933 46.4863 250.762 46.8428 250.528L46.8721 248.462ZM51.8599 243.423L52.3433 243.57C52.314 243.838 52.2896 244.08 52.27 244.295C52.2554 244.505 52.2456 244.712 52.2407 244.917H52.7607C53.0391 244.917 53.3223 244.915 53.6104 244.91C53.8984 244.9 54.189 244.888 54.4819 244.874L54.3062 245.672C53.9937 245.647 53.6982 245.633 53.4199 245.628C53.1465 245.618 52.873 245.613 52.5996 245.613H52.2554C52.2261 246.453 52.2041 247.098 52.1895 247.547C52.1797 247.991 52.1748 248.36 52.1748 248.653C52.1748 249.756 52.2505 250.477 52.4019 250.813C52.5532 251.146 52.8242 251.312 53.2148 251.312C53.376 251.312 53.5542 251.277 53.7495 251.209C53.9497 251.141 54.1914 251.028 54.4746 250.872L54.7163 251.355C54.2476 251.639 53.8228 251.854 53.4419 252C53.061 252.142 52.729 252.212 52.4458 252.212C51.9233 252.212 51.5425 252.034 51.3032 251.678C51.064 251.316 50.9443 250.738 50.9443 249.942C50.9443 249.786 50.9541 249.229 50.9736 248.272C50.998 247.31 51.0103 246.429 51.0103 245.628C50.9663 245.628 50.9028 245.63 50.8198 245.635C50.4146 245.65 50.1362 245.657 49.9849 245.657V245.13C50.4634 245.062 50.8589 244.886 51.1714 244.603C51.4839 244.314 51.7134 243.921 51.8599 243.423ZM61.0298 250.557L61.396 251.114C60.9224 251.475 60.4561 251.749 59.9971 251.934C59.5381 252.12 59.1035 252.212 58.6934 252.212C57.7363 252.212 56.9551 251.871 56.3496 251.187C55.7441 250.499 55.4414 249.62 55.4414 248.55C55.4414 247.442 55.8247 246.504 56.5913 245.738C57.3579 244.971 58.293 244.588 59.3965 244.588C59.9629 244.588 60.3999 244.668 60.7075 244.83C61.0151 244.986 61.1689 245.206 61.1689 245.489C61.1689 245.694 61.1055 245.872 60.9785 246.023C60.8564 246.17 60.7148 246.243 60.5537 246.243C60.5 246.243 60.2729 246.121 59.8726 245.877C59.4771 245.628 59.0986 245.503 58.7373 245.503C58.1025 245.503 57.5972 245.733 57.2212 246.192C56.8501 246.646 56.6646 247.266 56.6646 248.052C56.6646 249.043 56.8892 249.817 57.3384 250.374C57.7925 250.926 58.4199 251.202 59.2207 251.202C59.5186 251.202 59.814 251.15 60.1069 251.048C60.4048 250.945 60.7124 250.782 61.0298 250.557ZM64.3916 240.677C64.3721 241.497 64.355 242.334 64.3403 243.189C64.3257 244.043 64.3159 244.92 64.311 245.818C64.8579 245.403 65.3462 245.098 65.7759 244.903C66.2056 244.703 66.5962 244.603 66.9478 244.603C67.6655 244.603 68.2051 244.805 68.5664 245.21C68.9277 245.616 69.1084 246.224 69.1084 247.034C69.1084 247.039 69.106 247.254 69.1011 247.679C69.0962 248.104 69.0938 248.528 69.0938 248.953C69.0938 249.134 69.0913 249.361 69.0864 249.634C69.0815 249.903 69.0791 250.086 69.0791 250.184C69.0791 250.73 69.1279 251.087 69.2256 251.253C69.3232 251.419 69.5088 251.502 69.7822 251.502C69.7969 251.502 69.8237 251.5 69.8628 251.495C69.9067 251.49 69.9409 251.487 69.9653 251.487V252C69.521 251.971 69.1865 251.951 68.9619 251.941C68.7373 251.932 68.5518 251.927 68.4053 251.927C68.1709 251.927 67.917 251.934 67.6436 251.949C67.375 251.958 67.0942 251.976 66.8013 252L66.7939 251.487H66.9038C67.5288 251.487 67.8486 250.916 67.8633 249.773C67.8633 249.71 67.8633 249.661 67.8633 249.627L67.8779 248.052V247.752C67.8779 246.863 67.7729 246.275 67.563 245.987C67.353 245.694 66.9917 245.547 66.479 245.547C66.2007 245.547 65.8906 245.616 65.5488 245.752C65.2119 245.889 64.814 246.106 64.355 246.404L64.3184 249.012C64.3184 249.158 64.3159 249.346 64.311 249.576C64.3062 249.805 64.3037 249.964 64.3037 250.052C64.3037 250.657 64.3525 251.05 64.4502 251.231C64.5479 251.412 64.7358 251.502 65.0142 251.502C65.0337 251.502 65.063 251.5 65.1021 251.495C65.146 251.49 65.1802 251.487 65.2046 251.487V252C64.897 251.976 64.6064 251.958 64.333 251.949C64.0645 251.934 63.8301 251.927 63.6299 251.927C63.4395 251.927 63.2197 251.932 62.9707 251.941C62.7217 251.951 62.397 251.968 61.9966 251.993V251.487C62.0259 251.487 62.0674 251.49 62.1211 251.495C62.1748 251.5 62.2139 251.502 62.2383 251.502C62.5752 251.502 62.8022 251.414 62.9194 251.238C63.0366 251.058 63.0952 250.538 63.0952 249.678V249.136L63.1245 243.628V242.369C63.1245 242.159 63.0781 242.002 62.9854 241.9C62.8975 241.792 62.7632 241.739 62.5825 241.739C62.5142 241.739 62.4019 241.753 62.2456 241.783C62.2065 241.792 62.1797 241.797 62.165 241.797L62.0552 241.321C62.4556 241.243 62.8486 241.153 63.2344 241.05C63.6201 240.943 64.0059 240.818 64.3916 240.677Z" fill="black"></path>
<path d="M134 68V49.5H333V68" stroke="black"></path>
<path d="M99.5 107H82.5V386.5H99.5" stroke="black"></path>
<path d="M299.398 457.637C299.462 457.646 299.528 457.651 299.596 457.651C299.665 457.651 299.767 457.651 299.904 457.651C300.939 457.651 301.752 457.434 302.343 457C302.938 456.565 303.236 455.974 303.236 455.227C303.236 454.558 303.053 454.05 302.687 453.704C302.321 453.357 301.789 453.184 301.09 453.184C300.983 453.184 300.849 453.188 300.688 453.198C300.531 453.208 300.355 453.223 300.16 453.242C299.955 454.385 299.792 455.3 299.669 455.989C299.552 456.677 299.462 457.227 299.398 457.637ZM296.308 462.017H296.593C296.896 462.017 297.111 461.931 297.238 461.76C297.37 461.584 297.504 461.101 297.641 460.31L298.703 453.982C298.717 453.909 298.729 453.84 298.739 453.777C298.749 453.713 298.754 453.662 298.754 453.623C298.754 453.423 298.686 453.276 298.549 453.184C298.417 453.086 298.214 453.037 297.941 453.037H297.743L297.838 452.495C298.146 452.524 298.427 452.546 298.681 452.561C298.935 452.576 299.164 452.583 299.369 452.583C299.687 452.583 300.109 452.568 300.636 452.539C301.168 452.51 301.54 452.495 301.75 452.495C302.648 452.495 303.349 452.703 303.852 453.118C304.359 453.528 304.613 454.094 304.613 454.817C304.613 455.505 304.394 456.111 303.954 456.633C303.515 457.151 302.87 457.571 302.021 457.893L303.134 460.01C303.163 460.073 303.209 460.168 303.273 460.295C303.893 461.506 304.555 462.112 305.258 462.112C305.282 462.112 305.319 462.109 305.368 462.104C305.421 462.1 305.46 462.097 305.485 462.097L305.397 462.588C305.172 462.627 304.984 462.654 304.833 462.668C304.682 462.688 304.55 462.698 304.438 462.698C303.993 462.698 303.615 462.617 303.302 462.456C302.99 462.29 302.733 462.039 302.533 461.702C302.392 461.472 302.128 460.947 301.742 460.127C301.361 459.307 301.054 458.657 300.819 458.179C300.663 458.193 300.504 458.206 300.343 458.215C300.187 458.22 300.026 458.223 299.86 458.223C299.796 458.223 299.701 458.22 299.574 458.215C299.452 458.21 299.357 458.208 299.289 458.208L298.871 460.969C298.856 461.072 298.844 461.162 298.834 461.24C298.83 461.313 298.827 461.375 298.827 461.423C298.827 461.663 298.878 461.821 298.981 461.899C299.088 461.978 299.311 462.017 299.647 462.017H299.816L299.721 462.5C299.56 462.495 299.333 462.485 299.04 462.471C298.468 462.451 298.102 462.441 297.941 462.441C297.692 462.441 297.252 462.456 296.623 462.485C296.452 462.49 296.315 462.495 296.212 462.5L296.308 462.017ZM307.858 459.197L307.931 459.16C309.669 458.271 310.539 457.585 310.539 457.102C310.539 456.843 310.446 456.619 310.26 456.428C310.075 456.238 309.857 456.143 309.608 456.143C309.223 456.143 308.876 456.409 308.568 456.941C308.261 457.473 308.024 458.225 307.858 459.197ZM310.062 458.691L307.821 459.849V459.922C307.821 460.503 307.912 460.945 308.092 461.248C308.278 461.55 308.544 461.702 308.891 461.702C309.096 461.702 309.352 461.611 309.66 461.431C309.972 461.245 310.37 460.947 310.854 460.537L311.11 460.999C310.412 461.643 309.855 462.09 309.44 462.339C309.03 462.588 308.656 462.712 308.319 462.712C307.807 462.712 307.392 462.49 307.074 462.046C306.757 461.602 306.598 461.018 306.598 460.295C306.598 459.783 306.681 459.233 306.847 458.647C307.018 458.057 307.238 457.542 307.506 457.102C307.843 456.565 308.229 456.15 308.664 455.857C309.098 455.564 309.547 455.417 310.011 455.417C310.485 455.417 310.88 455.569 311.198 455.872C311.52 456.169 311.681 456.533 311.681 456.963C311.681 457.31 311.583 457.598 311.388 457.827C311.198 458.052 310.756 458.34 310.062 458.691ZM316.405 459.878L316.955 456.56C316.686 456.404 316.447 456.292 316.237 456.223C316.027 456.15 315.832 456.113 315.651 456.113C315.05 456.113 314.545 456.499 314.135 457.271C313.725 458.037 313.52 458.994 313.52 460.142C313.52 460.605 313.573 460.957 313.681 461.196C313.793 461.436 313.957 461.555 314.171 461.555C314.318 461.555 314.589 461.406 314.984 461.108C315.385 460.811 315.858 460.4 316.405 459.878ZM316.42 460.625L315.175 461.753C314.809 462.085 314.516 462.314 314.296 462.441C314.081 462.568 313.878 462.632 313.688 462.632C313.249 462.632 312.912 462.446 312.677 462.075C312.443 461.699 312.326 461.16 312.326 460.457C312.326 459.07 312.675 457.878 313.373 456.882C314.076 455.886 314.911 455.388 315.878 455.388C316.073 455.388 316.271 455.415 316.471 455.469C316.676 455.518 316.889 455.591 317.108 455.688L317.526 453.037C317.541 452.935 317.55 452.832 317.555 452.729C317.565 452.622 317.57 452.515 317.57 452.407C317.57 452.212 317.531 452.078 317.453 452.004C317.375 451.931 317.23 451.895 317.021 451.895C316.957 451.895 316.891 451.897 316.823 451.902C316.759 451.902 316.688 451.904 316.61 451.909L316.581 451.477C316.986 451.438 317.394 451.384 317.804 451.316C318.219 451.248 318.637 451.165 319.057 451.067C318.603 453.411 318.229 455.527 317.936 457.417C317.643 459.302 317.497 460.447 317.497 460.852C317.497 461.101 317.519 461.277 317.562 461.379C317.611 461.477 317.689 461.526 317.797 461.526C317.855 461.526 317.924 461.501 318.002 461.453C318.085 461.404 318.188 461.323 318.31 461.211L318.756 460.808L318.998 461.226L318.156 462.053C317.863 462.336 317.65 462.517 317.519 462.595C317.387 462.673 317.26 462.712 317.138 462.712C316.879 462.712 316.688 462.59 316.566 462.346C316.449 462.102 316.391 461.724 316.391 461.211C316.391 461.099 316.393 460.999 316.398 460.911C316.403 460.818 316.41 460.723 316.42 460.625ZM326.491 461.27L325.48 462.214C325.299 462.39 325.136 462.515 324.989 462.588C324.848 462.661 324.701 462.698 324.55 462.698C324.33 462.698 324.152 462.593 324.015 462.383C323.883 462.168 323.817 461.882 323.817 461.526C323.817 461.423 323.825 461.301 323.839 461.16C323.859 461.013 323.896 460.786 323.949 460.479C323.046 461.401 322.406 462.002 322.03 462.28C321.654 462.559 321.334 462.698 321.071 462.698C320.792 462.698 320.561 462.568 320.375 462.31C320.189 462.051 320.097 461.719 320.097 461.313C320.097 460.972 320.243 460.203 320.536 459.006C320.609 458.723 320.663 458.508 320.697 458.362C320.8 457.957 320.875 457.632 320.924 457.388C320.973 457.139 320.998 456.953 320.998 456.831C320.998 456.733 320.973 456.655 320.924 456.597C320.875 456.533 320.814 456.501 320.741 456.501C320.692 456.501 320.597 456.536 320.456 456.604C320.314 456.672 320.119 456.777 319.87 456.919L319.665 456.516C320.119 456.179 320.517 455.918 320.858 455.732C321.2 455.542 321.442 455.447 321.583 455.447C321.784 455.447 321.94 455.532 322.052 455.703C322.169 455.874 322.228 456.111 322.228 456.414C322.228 456.794 322.077 457.532 321.774 458.625C321.476 459.719 321.327 460.54 321.327 461.086C321.327 461.257 321.356 461.384 321.415 461.467C321.474 461.545 321.564 461.584 321.686 461.584C321.823 461.584 322.055 461.45 322.382 461.182C322.714 460.908 323.268 460.388 324.044 459.622C324.23 458.743 324.379 458 324.491 457.395C324.608 456.785 324.699 456.24 324.762 455.762L326.081 455.447L325.919 456.172C325.641 457.358 325.49 458.02 325.465 458.157L325.29 459.094C325.202 459.539 325.131 459.963 325.077 460.369C325.028 460.774 325.004 461.06 325.004 461.226C325.004 461.338 325.026 461.426 325.07 461.489C325.114 461.553 325.172 461.584 325.246 461.584C325.314 461.584 325.441 461.519 325.626 461.387C325.812 461.255 326.024 461.077 326.264 460.852L326.491 461.27ZM331.793 456.677L331.405 457.058C331.083 456.731 330.824 456.514 330.629 456.406C330.438 456.299 330.243 456.245 330.043 456.245C329.594 456.245 329.203 456.58 328.871 457.249C328.539 457.913 328.373 458.733 328.373 459.709C328.373 460.364 328.458 460.857 328.629 461.189C328.8 461.521 329.052 461.687 329.384 461.687C329.569 461.687 329.823 461.582 330.146 461.372C330.468 461.157 330.807 460.864 331.164 460.493L331.464 461.013C330.897 461.614 330.414 462.048 330.014 462.317C329.613 462.581 329.247 462.712 328.915 462.712C328.388 462.712 327.965 462.483 327.648 462.024C327.335 461.565 327.179 460.945 327.179 460.164C327.179 458.826 327.521 457.698 328.205 456.78C328.893 455.862 329.74 455.403 330.746 455.403C331.112 455.403 331.425 455.481 331.684 455.637C331.947 455.793 332.079 455.972 332.079 456.172C332.079 456.25 332.057 456.328 332.013 456.406C331.974 456.484 331.901 456.575 331.793 456.677ZM335.792 453.74C335.7 454.067 335.57 454.58 335.404 455.278C335.355 455.483 335.319 455.635 335.294 455.732C335.583 455.732 335.875 455.73 336.173 455.725C336.476 455.715 336.793 455.703 337.125 455.688L336.95 456.421C336.818 456.416 336.671 456.414 336.51 456.414C336.349 456.414 336.09 456.414 335.734 456.414H335.148C334.918 457.419 334.748 458.298 334.635 459.05C334.528 459.802 334.474 460.432 334.474 460.94C334.474 461.155 334.508 461.323 334.577 461.445C334.65 461.567 334.75 461.628 334.877 461.628C334.975 461.628 335.128 461.55 335.338 461.394C335.548 461.238 335.834 460.986 336.195 460.64L336.452 461.108C335.749 461.831 335.265 462.292 335.001 462.493C334.738 462.688 334.516 462.786 334.335 462.786C333.998 462.786 333.729 462.627 333.529 462.31C333.329 461.992 333.229 461.56 333.229 461.013C333.229 460.657 333.285 460.146 333.397 459.482C333.51 458.813 333.722 457.778 334.035 456.377C333.957 456.377 333.854 456.379 333.727 456.384C333.605 456.389 333.522 456.392 333.478 456.392H332.973L333.061 455.901C333.285 455.891 333.49 455.852 333.676 455.784C333.866 455.715 334.057 455.608 334.247 455.461C334.291 455.286 334.34 455.103 334.394 454.912C334.452 454.717 334.518 454.512 334.591 454.297L335.792 453.74ZM340.634 460.837L340.89 461.27C340.29 461.89 339.872 462.285 339.638 462.456C339.403 462.627 339.196 462.712 339.015 462.712C338.756 462.712 338.549 462.605 338.393 462.39C338.236 462.17 338.158 461.877 338.158 461.511C338.158 461.052 338.302 460.286 338.59 459.211C338.883 458.137 339.03 457.363 339.03 456.89C339.03 456.768 339 456.67 338.942 456.597C338.883 456.523 338.808 456.487 338.715 456.487C338.637 456.487 338.534 456.519 338.407 456.582C338.28 456.646 338.122 456.743 337.931 456.875L337.711 456.487L338.686 455.776C338.871 455.64 339.032 455.542 339.169 455.483C339.306 455.42 339.435 455.388 339.557 455.388C339.787 455.388 339.967 455.483 340.099 455.674C340.236 455.859 340.304 456.116 340.304 456.443C340.304 456.799 340.177 457.498 339.923 458.538C339.865 458.772 339.821 458.948 339.792 459.065C339.655 459.617 339.55 460.073 339.477 460.435C339.408 460.796 339.374 461.045 339.374 461.182C339.374 461.304 339.401 461.404 339.455 461.482C339.508 461.56 339.577 461.599 339.66 461.599C339.738 461.599 339.84 461.55 339.967 461.453C340.094 461.355 340.316 461.15 340.634 460.837ZM340.575 451.396L340.993 451.865C341.11 451.987 341.19 452.097 341.234 452.195C341.283 452.288 341.308 452.383 341.308 452.48C341.308 452.583 341.271 452.681 341.198 452.773C341.129 452.866 341.027 452.954 340.89 453.037L340.246 453.396L339.777 452.839C339.679 452.717 339.616 452.622 339.586 452.554C339.557 452.48 339.542 452.405 339.542 452.327C339.542 452.214 339.572 452.117 339.63 452.034C339.689 451.946 339.789 451.86 339.931 451.777L340.575 451.396ZM345.167 456.128C344.601 456.128 344.113 456.516 343.703 457.292C343.292 458.069 343.087 459.026 343.087 460.164C343.087 460.764 343.19 461.223 343.395 461.541C343.605 461.858 343.908 462.017 344.303 462.017C344.899 462.017 345.404 461.636 345.819 460.874C346.239 460.107 346.449 459.17 346.449 458.062C346.449 457.402 346.344 456.917 346.134 456.604C345.924 456.287 345.602 456.128 345.167 456.128ZM345.482 455.417C346.21 455.417 346.762 455.645 347.138 456.099C347.519 456.548 347.709 457.207 347.709 458.076C347.709 458.574 347.611 459.106 347.416 459.673C347.221 460.234 346.957 460.742 346.625 461.196C346.269 461.685 345.863 462.061 345.409 462.324C344.96 462.583 344.486 462.712 343.988 462.712C343.334 462.712 342.812 462.476 342.421 462.002C342.035 461.528 341.842 460.894 341.842 460.098C341.842 459.507 341.938 458.931 342.128 458.369C342.318 457.808 342.592 457.3 342.948 456.846C343.3 456.392 343.698 456.04 344.142 455.791C344.591 455.542 345.038 455.417 345.482 455.417ZM350.888 457.52L352.074 456.362C352.489 455.967 352.802 455.706 353.012 455.579C353.227 455.452 353.429 455.388 353.62 455.388C353.942 455.388 354.203 455.53 354.403 455.813C354.608 456.096 354.711 456.47 354.711 456.934C354.711 457.407 354.591 458.14 354.352 459.131C354.113 460.117 353.993 460.82 353.993 461.24C353.993 461.367 354.018 461.465 354.066 461.533C354.115 461.597 354.186 461.628 354.279 461.628C354.323 461.628 354.376 461.611 354.44 461.577C354.508 461.538 354.574 461.487 354.638 461.423L355.194 460.881L355.451 461.27L354.652 462.083C354.462 462.278 354.271 462.432 354.081 462.544C353.896 462.656 353.732 462.712 353.59 462.712C353.346 462.712 353.146 462.607 352.99 462.397C352.838 462.183 352.763 461.902 352.763 461.555C352.763 461.14 352.887 460.41 353.136 459.365C353.385 458.315 353.51 457.551 353.51 457.073C353.51 456.892 353.471 456.748 353.393 456.641C353.319 456.528 353.219 456.472 353.092 456.472C352.902 456.472 352.318 456.924 351.342 457.827C351.083 458.066 350.88 458.254 350.734 458.391L350.272 460.969C350.263 461.018 350.248 461.091 350.229 461.189C350.126 461.711 350.065 462.112 350.045 462.39L348.742 462.712C349.064 461.311 349.318 460.093 349.503 459.058C349.694 458.022 349.789 457.344 349.789 457.021C349.789 456.826 349.767 456.687 349.723 456.604C349.679 456.516 349.608 456.472 349.511 456.472C349.452 456.472 349.354 456.506 349.218 456.575C349.086 456.643 348.917 456.743 348.712 456.875L348.515 456.487C348.568 456.443 348.646 456.379 348.749 456.296C349.501 455.691 350.004 455.388 350.258 455.388C350.502 455.388 350.683 455.481 350.8 455.667C350.917 455.847 350.976 456.13 350.976 456.516C350.976 456.653 350.968 456.807 350.954 456.978C350.939 457.148 350.917 457.329 350.888 457.52Z" fill="black"></path>
<path d="M356.354 441.354C356.549 441.158 356.549 440.842 356.354 440.646L353.172 437.464C352.976 437.269 352.66 437.269 352.464 437.464C352.269 437.66 352.269 437.976 352.464 438.172L355.293 441L352.464 443.828C352.269 444.024 352.269 444.34 352.464 444.536C352.66 444.731 352.976 444.731 353.172 444.536L356.354 441.354ZM120 441V441.5H356V441V440.5H120V441Z" fill="black"></path>
<defs>
<clipPath id="clip0_249_8276-rmsnorm-2-svg">
<rect x="111" y="79.9023" width="245" height="327" rx="2" fill="white"></rect>
</clipPath>
</defs>
</svg>

<figcaption><b>Data Parallel RMSNorm for larger batches</b> Extending the data-parallel strategy to larger batches is fairly straightforward --- instead of having each core handle one row you allow each core to handle different rows sequentially. This <i>preserves batch invariance</i> as the reduction strategy for each batch element remains identical. </figcaption>
</figure>
<p>On the other hand, decreasing the batch size can pose challenges. Because we assign each batch element to one core, decreasing our batch size will eventually lead to having more cores than batch elements, leaving some cores idle.</p>
<p>Upon encountering this situation, a good kernel engineer would reach for one of the solutions mentioned in the prior section (atomic adds or split reductions), maintaining good parallelism and thus, good performance. Unfortunately, this changes the reduction strategy, preventing this kernel from being batch-invariant.</p>
<figure>
<svg width="480" height="269" viewBox="0 0 480 269" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="480" height="269" fill="#F5F5F5"></rect>
<rect width="480" height="269" fill="white"></rect>
<g clip-path="url(#clip0_249_8276-rmsnorm-3-svg)">
<path d="M122 82C122 80.8954 122.895 80 124 80H167V125H122V82Z" fill="#EF402C"></path>
<rect opacity="0.65" x="168" y="80" width="45" height="45" fill="#EF402C"></rect>
<rect opacity="0.3" x="214" y="80" width="45" height="45" fill="#EF402C"></rect>
<rect x="260" y="80" width="45" height="45" fill="#6D274C"></rect>
<rect opacity="0.65" x="306" y="80" width="45" height="45" fill="#6D274C"></rect>
<path opacity="0.3" d="M352 80H395C396.105 80 397 80.8954 397 82V125H352V80Z" fill="#6D274C"></path>
<rect x="122" y="126" width="45" height="45" fill="#009DE4"></rect>
<rect opacity="0.65" x="168" y="126" width="45" height="45" fill="#009DE4"></rect>
<rect opacity="0.3" x="214" y="126" width="45" height="45" fill="#009DE4"></rect>
<rect x="260" y="126" width="45" height="45" fill="#F7A224"></rect>
<rect opacity="0.65" x="306" y="126" width="45" height="45" fill="#F7A224"></rect>
<rect opacity="0.3" x="352" y="126" width="45" height="45" fill="#F7A224"></rect>
</g>
<path d="M231.557 37.5239C231.596 37.5288 231.632 37.5337 231.667 37.5386C231.706 37.5386 231.764 37.5386 231.842 37.5386C232.233 37.5386 232.497 37.4116 232.633 37.1577C232.775 36.8989 232.846 36.3252 232.846 35.4365C232.846 35.29 232.843 35.0288 232.838 34.6528C232.833 34.2769 232.831 33.9668 232.831 33.7227V31.7305C232.831 31.4619 232.833 31.042 232.838 30.4707C232.843 29.8945 232.846 29.4551 232.846 29.1523C232.846 28.7373 232.765 28.4492 232.604 28.2881C232.448 28.1221 232.172 28.0391 231.776 28.0391H231.659V27.5483C232.67 27.5728 233.488 27.5923 234.113 27.6069C234.743 27.6167 235.275 27.6216 235.709 27.6216C236.183 27.6216 236.693 27.6167 237.24 27.6069C237.792 27.5923 238.407 27.5728 239.086 27.5483C239.086 27.8853 239.096 28.2417 239.115 28.6177C239.14 28.9888 239.174 29.4111 239.218 29.8848L238.712 29.9434C238.678 29.3232 238.505 28.9058 238.192 28.6909C237.88 28.4761 237.182 28.3687 236.098 28.3687C235.717 28.3687 235.124 28.3784 234.318 28.3979H234.274C234.264 29.1206 234.25 29.9263 234.23 30.8149C234.21 31.6987 234.198 32.1895 234.193 32.2871H234.435C234.708 32.2871 235.048 32.2896 235.453 32.2944C235.858 32.2993 236.134 32.3018 236.281 32.3018C236.999 32.3018 237.472 32.2358 237.702 32.104C237.936 31.9722 238.063 31.728 238.083 31.3716L238.544 31.4009C238.505 31.7671 238.478 32.0698 238.463 32.3091C238.449 32.5435 238.441 32.7607 238.441 32.9609C238.441 33.1074 238.444 33.2808 238.449 33.481C238.458 33.6812 238.471 33.9058 238.485 34.1548L238.002 34.1914V34.0669C238.002 33.6665 237.882 33.3955 237.643 33.2539C237.404 33.1074 236.85 33.0342 235.98 33.0342H234.721H234.193V35.8833C234.193 36.5864 234.271 37.0308 234.428 37.2163C234.584 37.397 234.901 37.4873 235.38 37.4873H235.666V38C235.294 37.9805 234.928 37.9658 234.567 37.9561C234.21 37.9463 233.861 37.9414 233.52 37.9414C233.349 37.9414 233.087 37.9463 232.736 37.9561C232.389 37.9658 231.996 37.9805 231.557 38V37.5239ZM246.044 33.9058H242.47C242.191 33.9058 241.935 33.9106 241.701 33.9204C241.466 33.9302 241.249 33.9448 241.049 33.9644V34.2354C241.049 35.1924 241.269 35.9321 241.708 36.4546C242.152 36.9771 242.777 37.2383 243.583 37.2383C243.939 37.2383 244.291 37.1797 244.638 37.0625C244.984 36.9404 245.353 36.7524 245.744 36.4985L246.029 36.9673C245.526 37.3774 245.023 37.6875 244.521 37.8975C244.022 38.1074 243.529 38.2124 243.041 38.2124C242.094 38.2124 241.312 37.8755 240.697 37.2017C240.082 36.5229 239.774 35.6538 239.774 34.5942C239.774 33.4663 240.097 32.519 240.741 31.7524C241.386 30.9858 242.172 30.6025 243.1 30.6025C243.964 30.6025 244.652 30.8906 245.165 31.4668C245.678 32.043 245.971 32.856 246.044 33.9058ZM244.689 33.1367C244.542 32.5361 244.32 32.0771 244.022 31.7598C243.725 31.4375 243.368 31.2764 242.953 31.2764C242.484 31.2764 242.082 31.4644 241.745 31.8403C241.413 32.2163 241.195 32.7241 241.093 33.3638C242.06 33.3638 242.819 33.3467 243.371 33.3125C243.927 33.2783 244.367 33.2197 244.689 33.1367ZM253.595 36.938L253.8 37.3994C253.434 37.6631 253.1 37.8657 252.797 38.0073C252.494 38.1538 252.25 38.2271 252.064 38.2271C251.752 38.2271 251.518 38.1367 251.361 37.9561C251.205 37.7705 251.12 37.4922 251.105 37.1211C250.573 37.4775 250.131 37.7339 249.779 37.8901C249.428 38.0415 249.113 38.1172 248.834 38.1172C248.341 38.1172 247.929 37.9316 247.597 37.5605C247.265 37.1895 247.099 36.7354 247.099 36.1982C247.099 35.2852 248.083 34.5967 250.05 34.1328C250.514 34.0254 250.875 33.9399 251.134 33.8765C251.134 33.7935 251.137 33.6738 251.142 33.5176C251.156 33.1953 251.164 32.9854 251.164 32.8877C251.164 32.3799 251.059 32.0063 250.849 31.7671C250.639 31.5229 250.319 31.4009 249.889 31.4009C249.469 31.4009 249.137 31.479 248.893 31.6353C248.654 31.7866 248.534 31.9941 248.534 32.2578C248.534 32.2822 248.537 32.3164 248.542 32.3604C248.546 32.3994 248.549 32.4287 248.549 32.4482C248.549 32.5996 248.476 32.7266 248.329 32.8291C248.183 32.9268 248.007 32.9756 247.802 32.9756C247.626 32.9756 247.497 32.9463 247.414 32.8877C247.331 32.8291 247.289 32.7388 247.289 32.6167C247.289 32.2261 247.619 31.7915 248.278 31.313C248.937 30.8296 249.618 30.5879 250.321 30.5879C251 30.5879 251.515 30.7759 251.867 31.1519C252.218 31.5229 252.394 32.0698 252.394 32.7925C252.394 33.1831 252.37 33.7837 252.321 34.5942C252.277 35.4048 252.255 36.02 252.255 36.4399C252.255 36.7573 252.289 36.9722 252.357 37.0845C252.431 37.1968 252.558 37.2529 252.738 37.2529C252.816 37.2529 252.917 37.231 253.039 37.187C253.166 37.1382 253.351 37.0552 253.595 36.938ZM251.098 34.4624C251.005 34.4868 250.866 34.5234 250.68 34.5723C249.093 35.0068 248.3 35.5195 248.3 36.1104C248.3 36.4326 248.402 36.6963 248.607 36.9014C248.812 37.1016 249.083 37.2017 249.42 37.2017C249.625 37.2017 249.862 37.1479 250.131 37.0405C250.399 36.9331 250.712 36.7622 251.068 36.5278L251.098 34.4624ZM256.085 29.4233L256.569 29.5698C256.54 29.8384 256.515 30.0801 256.496 30.2949C256.481 30.5049 256.471 30.7124 256.466 30.9175H256.986C257.265 30.9175 257.548 30.915 257.836 30.9102C258.124 30.9004 258.415 30.8882 258.708 30.8735L258.532 31.6719C258.219 31.6475 257.924 31.6328 257.646 31.6279C257.372 31.6182 257.099 31.6133 256.825 31.6133H256.481C256.452 32.4531 256.43 33.0977 256.415 33.5469C256.405 33.9912 256.4 34.3599 256.4 34.6528C256.4 35.7563 256.476 36.4766 256.627 36.8135C256.779 37.1455 257.05 37.3115 257.44 37.3115C257.602 37.3115 257.78 37.2773 257.975 37.209C258.175 37.1406 258.417 37.0283 258.7 36.8721L258.942 37.3555C258.473 37.6387 258.048 37.8535 257.667 38C257.287 38.1416 256.955 38.2124 256.671 38.2124C256.149 38.2124 255.768 38.0342 255.529 37.6777C255.29 37.3164 255.17 36.7378 255.17 35.9419C255.17 35.7856 255.18 35.229 255.199 34.272C255.224 33.3101 255.236 32.4287 255.236 31.6279C255.192 31.6279 255.128 31.6304 255.045 31.6353C254.64 31.6499 254.362 31.6572 254.21 31.6572V31.1299C254.689 31.0615 255.084 30.8857 255.397 30.6025C255.709 30.3145 255.939 29.9214 256.085 29.4233ZM261.872 30.5952C261.837 31.5522 261.811 32.3921 261.791 33.1147C261.771 33.8325 261.762 34.3306 261.762 34.6089C261.762 35.6538 261.869 36.3521 262.084 36.7036C262.299 37.0503 262.667 37.2236 263.19 37.2236C263.449 37.2236 263.737 37.1602 264.054 37.0332C264.372 36.9062 264.733 36.7134 265.138 36.4546C265.153 35.7026 265.163 35.0825 265.167 34.5942C265.177 34.106 265.182 33.7471 265.182 33.5176V33.0195C265.182 32.4043 265.131 32.0186 265.028 31.8623C264.926 31.7061 264.728 31.6279 264.435 31.6279C264.386 31.6279 264.333 31.6304 264.274 31.6353C264.22 31.6353 264.164 31.6377 264.105 31.6426L264.062 31.1738C264.477 31.1445 264.884 31.0981 265.285 31.0347C265.69 30.9712 266.085 30.8931 266.471 30.8003C266.442 31.6353 266.42 32.3799 266.405 33.0342C266.391 33.6885 266.383 34.2598 266.383 34.748C266.383 34.9482 266.381 35.1997 266.376 35.5024C266.371 35.8003 266.369 35.998 266.369 36.0957C266.369 36.5498 266.408 36.8477 266.486 36.9893C266.564 37.1309 266.71 37.2017 266.925 37.2017C266.974 37.2017 267.03 37.1968 267.094 37.187C267.162 37.1772 267.25 37.1577 267.357 37.1284L267.416 37.5825L265.182 38.1465L265.153 37.0552C264.625 37.4556 264.162 37.7485 263.761 37.9341C263.366 38.1196 263.004 38.2124 262.677 38.2124C262.008 38.2124 261.486 38.0195 261.11 37.6338C260.734 37.248 260.546 36.7109 260.546 36.0225C260.546 35.8467 260.553 35.478 260.568 34.9165C260.573 34.6821 260.575 34.499 260.575 34.3672L260.597 33.5469C260.597 33.4102 260.6 33.2368 260.604 33.0269C260.609 32.812 260.612 32.6655 260.612 32.5874C260.612 32.1675 260.575 31.8892 260.502 31.7524C260.434 31.6157 260.304 31.5474 260.114 31.5474C260.055 31.5474 259.987 31.5522 259.909 31.562C259.831 31.5718 259.75 31.5815 259.667 31.5913L259.616 31.1152C259.967 31.0566 260.329 30.9858 260.7 30.9028C261.076 30.8149 261.466 30.7124 261.872 30.5952ZM270.749 30.5146C270.714 30.8467 270.688 31.1836 270.668 31.5254C270.648 31.8623 270.634 32.2212 270.624 32.6021C271.02 31.9038 271.383 31.4009 271.715 31.0933C272.052 30.7856 272.399 30.6318 272.755 30.6318C273.034 30.6318 273.253 30.7075 273.415 30.8589C273.576 31.0054 273.656 31.2056 273.656 31.4595C273.656 31.6401 273.603 31.7964 273.495 31.9282C273.393 32.0552 273.271 32.1187 273.129 32.1187C273.041 32.1187 272.904 32.0723 272.719 31.9795C272.538 31.8818 272.382 31.833 272.25 31.833C271.996 31.833 271.742 31.9453 271.488 32.1699C271.234 32.3896 270.968 32.7339 270.69 33.2026V34.0083C270.69 34.7896 270.695 35.4243 270.705 35.9126C270.719 36.396 270.739 36.7036 270.763 36.8354C270.807 37.0845 270.9 37.2554 271.042 37.3481C271.188 37.4409 271.435 37.4873 271.781 37.4873H271.994V38C271.613 37.9707 271.273 37.9487 270.976 37.9341C270.678 37.9194 270.426 37.9121 270.221 37.9121C269.938 37.9121 269.645 37.9194 269.342 37.9341C269.044 37.9487 268.732 37.9707 268.405 38V37.4873H268.573C268.93 37.4873 269.171 37.4019 269.298 37.231C269.425 37.0601 269.489 36.6621 269.489 36.0371V35.2681V32.8877C269.489 32.3604 269.452 32.021 269.379 31.8696C269.306 31.7183 269.171 31.6426 268.976 31.6426C268.937 31.6426 268.896 31.645 268.852 31.6499C268.808 31.6499 268.734 31.6572 268.632 31.6719L268.544 31.2178C268.891 31.1396 269.247 31.042 269.613 30.9248C269.979 30.8076 270.358 30.6709 270.749 30.5146ZM280.673 33.9058H277.099C276.82 33.9058 276.564 33.9106 276.33 33.9204C276.095 33.9302 275.878 33.9448 275.678 33.9644V34.2354C275.678 35.1924 275.897 35.9321 276.337 36.4546C276.781 36.9771 277.406 37.2383 278.212 37.2383C278.568 37.2383 278.92 37.1797 279.267 37.0625C279.613 36.9404 279.982 36.7524 280.373 36.4985L280.658 36.9673C280.155 37.3774 279.652 37.6875 279.149 37.8975C278.651 38.1074 278.158 38.2124 277.67 38.2124C276.723 38.2124 275.941 37.8755 275.326 37.2017C274.711 36.5229 274.403 35.6538 274.403 34.5942C274.403 33.4663 274.726 32.519 275.37 31.7524C276.015 30.9858 276.801 30.6025 277.729 30.6025C278.593 30.6025 279.281 30.8906 279.794 31.4668C280.307 32.043 280.6 32.856 280.673 33.9058ZM279.318 33.1367C279.171 32.5361 278.949 32.0771 278.651 31.7598C278.354 31.4375 277.997 31.2764 277.582 31.2764C277.113 31.2764 276.71 31.4644 276.374 31.8403C276.042 32.2163 275.824 32.7241 275.722 33.3638C276.688 33.3638 277.448 33.3467 278 33.3125C278.556 33.2783 278.996 33.2197 279.318 33.1367ZM286.598 30.9028C286.598 31.2007 286.613 31.501 286.642 31.8037C286.676 32.1064 286.723 32.4116 286.781 32.7192L286.225 32.8071C286.166 32.2993 286.005 31.9209 285.741 31.6719C285.478 31.4229 285.109 31.2983 284.635 31.2983C284.225 31.2983 283.888 31.4106 283.625 31.6353C283.361 31.855 283.229 32.1357 283.229 32.4775C283.229 33.0195 283.805 33.4492 284.958 33.7666C285.158 33.8203 285.312 33.8618 285.419 33.8911C285.995 34.0522 286.415 34.2817 286.679 34.5796C286.947 34.8774 287.082 35.2681 287.082 35.7515C287.082 36.4644 286.801 37.0527 286.239 37.5166C285.683 37.9805 284.967 38.2124 284.093 38.2124C283.776 38.2124 283.451 38.1782 283.119 38.1099C282.787 38.0415 282.448 37.939 282.101 37.8022C282.106 37.7534 282.108 37.7021 282.108 37.6484C282.113 37.5947 282.116 37.5117 282.116 37.3994C282.116 37.1748 282.101 36.9331 282.072 36.6743C282.047 36.4106 282.008 36.1323 281.955 35.8394L282.504 35.7075C282.582 36.313 282.772 36.7671 283.075 37.0698C283.378 37.3677 283.798 37.5166 284.335 37.5166C284.823 37.5166 285.221 37.3994 285.529 37.165C285.841 36.9258 285.998 36.6182 285.998 36.2422C285.998 35.7148 285.48 35.2949 284.445 34.9824C284.342 34.9482 284.267 34.9238 284.218 34.9092C283.476 34.6846 282.953 34.4087 282.65 34.0815C282.353 33.7544 282.204 33.3198 282.204 32.7778C282.204 32.1528 282.453 31.6353 282.951 31.2251C283.449 30.8101 284.086 30.6025 284.862 30.6025C285.102 30.6025 285.36 30.627 285.639 30.6758C285.922 30.7246 286.242 30.8003 286.598 30.9028Z" fill="black"></path>
<path d="M145 68V49.5H374V68" stroke="black"></path>
<path d="M47.1348 124.236C47.2471 124.246 47.3667 124.253 47.4937 124.258C47.6255 124.258 47.8208 124.258 48.0796 124.258C48.3579 124.258 48.6143 124.253 48.8486 124.243C49.0879 124.233 49.3174 124.216 49.5371 124.192C49.8936 123.938 50.1621 123.652 50.3428 123.335C50.5234 123.013 50.6138 122.659 50.6138 122.273C50.6138 121.653 50.416 121.165 50.0205 120.808C49.625 120.447 49.083 120.266 48.3945 120.266C48.2432 120.266 48.0674 120.276 47.8672 120.295C47.6719 120.315 47.4497 120.344 47.2007 120.383C47.186 121.038 47.1714 121.797 47.1567 122.661C47.147 123.525 47.1396 124.05 47.1348 124.236ZM47.1494 129.048C47.4326 129.131 47.7109 129.194 47.9844 129.238C48.2578 129.277 48.5239 129.297 48.7827 129.297C49.5835 129.297 50.2036 129.102 50.6431 128.711C51.0825 128.32 51.3022 127.776 51.3022 127.078C51.3022 126.335 51.0557 125.786 50.5625 125.43C50.0693 125.068 49.3125 124.888 48.292 124.888C48.126 124.888 47.9575 124.89 47.7866 124.895C47.6206 124.895 47.4033 124.902 47.1348 124.917C47.1348 125.122 47.1323 125.425 47.1274 125.825C47.1226 126.221 47.1201 126.511 47.1201 126.697C47.1201 127 47.1226 127.322 47.1274 127.664C47.1323 128 47.1396 128.462 47.1494 129.048ZM44.5566 129.524C44.5908 129.529 44.6226 129.534 44.6519 129.539C44.686 129.539 44.7349 129.539 44.7983 129.539C45.4478 129.539 45.7773 128.625 45.7871 126.799C45.792 126.34 45.7969 125.981 45.8018 125.723L45.8311 123.723C45.8359 123.293 45.8384 122.876 45.8384 122.471C45.8433 122.065 45.8457 121.626 45.8457 121.152C45.8457 120.732 45.7676 120.442 45.6113 120.281C45.4551 120.12 45.1768 120.039 44.7764 120.039H44.7178V119.526C45.0303 119.551 45.3354 119.568 45.6333 119.578C45.936 119.587 46.2412 119.592 46.5488 119.592C46.8906 119.592 47.3105 119.583 47.8086 119.563C48.3066 119.539 48.6313 119.526 48.7827 119.526C49.7886 119.526 50.582 119.751 51.1631 120.2C51.749 120.645 52.042 121.245 52.042 122.002C52.042 122.534 51.8979 122.996 51.6099 123.386C51.3267 123.772 50.8555 124.146 50.1963 124.507C51.0557 124.673 51.6978 124.966 52.1226 125.386C52.5474 125.806 52.7598 126.36 52.7598 127.048C52.7598 127.942 52.4058 128.662 51.6978 129.209C50.9897 129.756 50.0449 130.029 48.8633 130.029C48.6484 130.029 48.2456 130.017 47.6548 129.993C47.064 129.968 46.5757 129.956 46.1899 129.956C46.0288 129.956 45.8042 129.961 45.5161 129.971C45.2329 129.98 44.9131 129.995 44.5566 130.015V129.524ZM60.3696 128.938L60.5747 129.399C60.2085 129.663 59.874 129.866 59.5713 130.007C59.2686 130.154 59.0244 130.227 58.8389 130.227C58.5264 130.227 58.292 130.137 58.1357 129.956C57.9795 129.771 57.894 129.492 57.8794 129.121C57.3472 129.478 56.9053 129.734 56.5537 129.89C56.2021 130.042 55.8872 130.117 55.6089 130.117C55.1157 130.117 54.7031 129.932 54.3711 129.561C54.0391 129.189 53.873 128.735 53.873 128.198C53.873 127.285 54.8569 126.597 56.8247 126.133C57.2886 126.025 57.6499 125.94 57.9087 125.876C57.9087 125.793 57.9111 125.674 57.916 125.518C57.9307 125.195 57.938 124.985 57.938 124.888C57.938 124.38 57.833 124.006 57.623 123.767C57.4131 123.523 57.0933 123.401 56.6636 123.401C56.2437 123.401 55.9116 123.479 55.6675 123.635C55.4282 123.787 55.3086 123.994 55.3086 124.258C55.3086 124.282 55.311 124.316 55.3159 124.36C55.3208 124.399 55.3232 124.429 55.3232 124.448C55.3232 124.6 55.25 124.727 55.1035 124.829C54.957 124.927 54.7812 124.976 54.5762 124.976C54.4004 124.976 54.271 124.946 54.188 124.888C54.105 124.829 54.0635 124.739 54.0635 124.617C54.0635 124.226 54.3931 123.792 55.0522 123.313C55.7114 122.83 56.3926 122.588 57.0957 122.588C57.7744 122.588 58.2896 122.776 58.6411 123.152C58.9927 123.523 59.1685 124.07 59.1685 124.792C59.1685 125.183 59.144 125.784 59.0952 126.594C59.0513 127.405 59.0293 128.02 59.0293 128.44C59.0293 128.757 59.0635 128.972 59.1318 129.084C59.2051 129.197 59.332 129.253 59.5127 129.253C59.5908 129.253 59.6909 129.231 59.813 129.187C59.9399 129.138 60.1255 129.055 60.3696 128.938ZM57.8721 126.462C57.7793 126.487 57.6401 126.523 57.4546 126.572C55.8677 127.007 55.0742 127.52 55.0742 128.11C55.0742 128.433 55.1768 128.696 55.3818 128.901C55.5869 129.102 55.8579 129.202 56.1948 129.202C56.3999 129.202 56.6367 129.148 56.9053 129.041C57.1738 128.933 57.4863 128.762 57.8428 128.528L57.8721 126.462ZM62.8599 121.423L63.3433 121.57C63.314 121.838 63.2896 122.08 63.27 122.295C63.2554 122.505 63.2456 122.712 63.2407 122.917H63.7607C64.0391 122.917 64.3223 122.915 64.6104 122.91C64.8984 122.9 65.189 122.888 65.4819 122.874L65.3062 123.672C64.9937 123.647 64.6982 123.633 64.4199 123.628C64.1465 123.618 63.873 123.613 63.5996 123.613H63.2554C63.2261 124.453 63.2041 125.098 63.1895 125.547C63.1797 125.991 63.1748 126.36 63.1748 126.653C63.1748 127.756 63.2505 128.477 63.4019 128.813C63.5532 129.146 63.8242 129.312 64.2148 129.312C64.376 129.312 64.5542 129.277 64.7495 129.209C64.9497 129.141 65.1914 129.028 65.4746 128.872L65.7163 129.355C65.2476 129.639 64.8228 129.854 64.4419 130C64.061 130.142 63.729 130.212 63.4458 130.212C62.9233 130.212 62.5425 130.034 62.3032 129.678C62.064 129.316 61.9443 128.738 61.9443 127.942C61.9443 127.786 61.9541 127.229 61.9736 126.272C61.998 125.31 62.0103 124.429 62.0103 123.628C61.9663 123.628 61.9028 123.63 61.8198 123.635C61.4146 123.65 61.1362 123.657 60.9849 123.657V123.13C61.4634 123.062 61.8589 122.886 62.1714 122.603C62.4839 122.314 62.7134 121.921 62.8599 121.423ZM72.0298 128.557L72.396 129.114C71.9224 129.475 71.4561 129.749 70.9971 129.934C70.5381 130.12 70.1035 130.212 69.6934 130.212C68.7363 130.212 67.9551 129.871 67.3496 129.187C66.7441 128.499 66.4414 127.62 66.4414 126.55C66.4414 125.442 66.8247 124.504 67.5913 123.738C68.3579 122.971 69.293 122.588 70.3965 122.588C70.9629 122.588 71.3999 122.668 71.7075 122.83C72.0151 122.986 72.1689 123.206 72.1689 123.489C72.1689 123.694 72.1055 123.872 71.9785 124.023C71.8564 124.17 71.7148 124.243 71.5537 124.243C71.5 124.243 71.2729 124.121 70.8726 123.877C70.4771 123.628 70.0986 123.503 69.7373 123.503C69.1025 123.503 68.5972 123.733 68.2212 124.192C67.8501 124.646 67.6646 125.266 67.6646 126.052C67.6646 127.043 67.8892 127.817 68.3384 128.374C68.7925 128.926 69.4199 129.202 70.2207 129.202C70.5186 129.202 70.814 129.15 71.1069 129.048C71.4048 128.945 71.7124 128.782 72.0298 128.557ZM75.3916 118.677C75.3721 119.497 75.355 120.334 75.3403 121.189C75.3257 122.043 75.3159 122.92 75.311 123.818C75.8579 123.403 76.3462 123.098 76.7759 122.903C77.2056 122.703 77.5962 122.603 77.9478 122.603C78.6655 122.603 79.2051 122.805 79.5664 123.21C79.9277 123.616 80.1084 124.224 80.1084 125.034C80.1084 125.039 80.106 125.254 80.1011 125.679C80.0962 126.104 80.0938 126.528 80.0938 126.953C80.0938 127.134 80.0913 127.361 80.0864 127.634C80.0815 127.903 80.0791 128.086 80.0791 128.184C80.0791 128.73 80.1279 129.087 80.2256 129.253C80.3232 129.419 80.5088 129.502 80.7822 129.502C80.7969 129.502 80.8237 129.5 80.8628 129.495C80.9067 129.49 80.9409 129.487 80.9653 129.487V130C80.521 129.971 80.1865 129.951 79.9619 129.941C79.7373 129.932 79.5518 129.927 79.4053 129.927C79.1709 129.927 78.917 129.934 78.6436 129.949C78.375 129.958 78.0942 129.976 77.8013 130L77.7939 129.487H77.9038C78.5288 129.487 78.8486 128.916 78.8633 127.773C78.8633 127.71 78.8633 127.661 78.8633 127.627L78.8779 126.052V125.752C78.8779 124.863 78.7729 124.275 78.563 123.987C78.353 123.694 77.9917 123.547 77.479 123.547C77.2007 123.547 76.8906 123.616 76.5488 123.752C76.2119 123.889 75.814 124.106 75.355 124.404L75.3184 127.012C75.3184 127.158 75.3159 127.346 75.311 127.576C75.3062 127.805 75.3037 127.964 75.3037 128.052C75.3037 128.657 75.3525 129.05 75.4502 129.231C75.5479 129.412 75.7358 129.502 76.0142 129.502C76.0337 129.502 76.063 129.5 76.1021 129.495C76.146 129.49 76.1802 129.487 76.2046 129.487V130C75.897 129.976 75.6064 129.958 75.333 129.949C75.0645 129.934 74.8301 129.927 74.6299 129.927C74.4395 129.927 74.2197 129.932 73.9707 129.941C73.7217 129.951 73.397 129.968 72.9966 129.993V129.487C73.0259 129.487 73.0674 129.49 73.1211 129.495C73.1748 129.5 73.2139 129.502 73.2383 129.502C73.5752 129.502 73.8022 129.414 73.9194 129.238C74.0366 129.058 74.0952 128.538 74.0952 127.678V127.136L74.1245 121.628V120.369C74.1245 120.159 74.0781 120.002 73.9854 119.9C73.8975 119.792 73.7632 119.739 73.5825 119.739C73.5142 119.739 73.4019 119.753 73.2456 119.783C73.2065 119.792 73.1797 119.797 73.165 119.797L73.0552 119.321C73.4556 119.243 73.8486 119.153 74.2344 119.05C74.6201 118.943 75.0059 118.818 75.3916 118.677Z" fill="black"></path>
<path d="M105.5 99H88.5V151.5H105.5" stroke="black"></path>
<path d="M340.398 227.637C340.462 227.646 340.528 227.651 340.596 227.651C340.665 227.651 340.767 227.651 340.904 227.651C341.939 227.651 342.752 227.434 343.343 227C343.938 226.565 344.236 225.974 344.236 225.227C344.236 224.558 344.053 224.05 343.687 223.704C343.321 223.357 342.789 223.184 342.09 223.184C341.983 223.184 341.849 223.188 341.688 223.198C341.531 223.208 341.355 223.223 341.16 223.242C340.955 224.385 340.792 225.3 340.669 225.989C340.552 226.677 340.462 227.227 340.398 227.637ZM337.308 232.017H337.593C337.896 232.017 338.111 231.931 338.238 231.76C338.37 231.584 338.504 231.101 338.641 230.31L339.703 223.982C339.717 223.909 339.729 223.84 339.739 223.777C339.749 223.713 339.754 223.662 339.754 223.623C339.754 223.423 339.686 223.276 339.549 223.184C339.417 223.086 339.214 223.037 338.941 223.037H338.743L338.838 222.495C339.146 222.524 339.427 222.546 339.681 222.561C339.935 222.576 340.164 222.583 340.369 222.583C340.687 222.583 341.109 222.568 341.636 222.539C342.168 222.51 342.54 222.495 342.75 222.495C343.648 222.495 344.349 222.703 344.852 223.118C345.359 223.528 345.613 224.094 345.613 224.817C345.613 225.505 345.394 226.111 344.954 226.633C344.515 227.151 343.87 227.571 343.021 227.893L344.134 230.01C344.163 230.073 344.209 230.168 344.273 230.295C344.893 231.506 345.555 232.112 346.258 232.112C346.282 232.112 346.319 232.109 346.368 232.104C346.421 232.1 346.46 232.097 346.485 232.097L346.397 232.588C346.172 232.627 345.984 232.654 345.833 232.668C345.682 232.688 345.55 232.698 345.438 232.698C344.993 232.698 344.615 232.617 344.302 232.456C343.99 232.29 343.733 232.039 343.533 231.702C343.392 231.472 343.128 230.947 342.742 230.127C342.361 229.307 342.054 228.657 341.819 228.179C341.663 228.193 341.504 228.206 341.343 228.215C341.187 228.22 341.026 228.223 340.86 228.223C340.796 228.223 340.701 228.22 340.574 228.215C340.452 228.21 340.357 228.208 340.289 228.208L339.871 230.969C339.856 231.072 339.844 231.162 339.834 231.24C339.83 231.313 339.827 231.375 339.827 231.423C339.827 231.663 339.878 231.821 339.981 231.899C340.088 231.978 340.311 232.017 340.647 232.017H340.816L340.721 232.5C340.56 232.495 340.333 232.485 340.04 232.471C339.468 232.451 339.102 232.441 338.941 232.441C338.692 232.441 338.252 232.456 337.623 232.485C337.452 232.49 337.315 232.495 337.212 232.5L337.308 232.017ZM348.858 229.197L348.931 229.16C350.669 228.271 351.539 227.585 351.539 227.102C351.539 226.843 351.446 226.619 351.26 226.428C351.075 226.238 350.857 226.143 350.608 226.143C350.223 226.143 349.876 226.409 349.568 226.941C349.261 227.473 349.024 228.225 348.858 229.197ZM351.062 228.691L348.821 229.849V229.922C348.821 230.503 348.912 230.945 349.092 231.248C349.278 231.55 349.544 231.702 349.891 231.702C350.096 231.702 350.352 231.611 350.66 231.431C350.972 231.245 351.37 230.947 351.854 230.537L352.11 230.999C351.412 231.643 350.855 232.09 350.44 232.339C350.03 232.588 349.656 232.712 349.319 232.712C348.807 232.712 348.392 232.49 348.074 232.046C347.757 231.602 347.598 231.018 347.598 230.295C347.598 229.783 347.681 229.233 347.847 228.647C348.018 228.057 348.238 227.542 348.506 227.102C348.843 226.565 349.229 226.15 349.664 225.857C350.098 225.564 350.547 225.417 351.011 225.417C351.485 225.417 351.88 225.569 352.198 225.872C352.52 226.169 352.681 226.533 352.681 226.963C352.681 227.31 352.583 227.598 352.388 227.827C352.198 228.052 351.756 228.34 351.062 228.691ZM357.405 229.878L357.955 226.56C357.686 226.404 357.447 226.292 357.237 226.223C357.027 226.15 356.832 226.113 356.651 226.113C356.05 226.113 355.545 226.499 355.135 227.271C354.725 228.037 354.52 228.994 354.52 230.142C354.52 230.605 354.573 230.957 354.681 231.196C354.793 231.436 354.957 231.555 355.171 231.555C355.318 231.555 355.589 231.406 355.984 231.108C356.385 230.811 356.858 230.4 357.405 229.878ZM357.42 230.625L356.175 231.753C355.809 232.085 355.516 232.314 355.296 232.441C355.081 232.568 354.878 232.632 354.688 232.632C354.249 232.632 353.912 232.446 353.677 232.075C353.443 231.699 353.326 231.16 353.326 230.457C353.326 229.07 353.675 227.878 354.373 226.882C355.076 225.886 355.911 225.388 356.878 225.388C357.073 225.388 357.271 225.415 357.471 225.469C357.676 225.518 357.889 225.591 358.108 225.688L358.526 223.037C358.541 222.935 358.55 222.832 358.555 222.729C358.565 222.622 358.57 222.515 358.57 222.407C358.57 222.212 358.531 222.078 358.453 222.004C358.375 221.931 358.23 221.895 358.021 221.895C357.957 221.895 357.891 221.897 357.823 221.902C357.759 221.902 357.688 221.904 357.61 221.909L357.581 221.477C357.986 221.438 358.394 221.384 358.804 221.316C359.219 221.248 359.637 221.165 360.057 221.067C359.603 223.411 359.229 225.527 358.936 227.417C358.643 229.302 358.497 230.447 358.497 230.852C358.497 231.101 358.519 231.277 358.562 231.379C358.611 231.477 358.689 231.526 358.797 231.526C358.855 231.526 358.924 231.501 359.002 231.453C359.085 231.404 359.188 231.323 359.31 231.211L359.756 230.808L359.998 231.226L359.156 232.053C358.863 232.336 358.65 232.517 358.519 232.595C358.387 232.673 358.26 232.712 358.138 232.712C357.879 232.712 357.688 232.59 357.566 232.346C357.449 232.102 357.391 231.724 357.391 231.211C357.391 231.099 357.393 230.999 357.398 230.911C357.403 230.818 357.41 230.723 357.42 230.625ZM367.491 231.27L366.48 232.214C366.299 232.39 366.136 232.515 365.989 232.588C365.848 232.661 365.701 232.698 365.55 232.698C365.33 232.698 365.152 232.593 365.015 232.383C364.883 232.168 364.817 231.882 364.817 231.526C364.817 231.423 364.825 231.301 364.839 231.16C364.859 231.013 364.896 230.786 364.949 230.479C364.046 231.401 363.406 232.002 363.03 232.28C362.654 232.559 362.334 232.698 362.071 232.698C361.792 232.698 361.561 232.568 361.375 232.31C361.189 232.051 361.097 231.719 361.097 231.313C361.097 230.972 361.243 230.203 361.536 229.006C361.609 228.723 361.663 228.508 361.697 228.362C361.8 227.957 361.875 227.632 361.924 227.388C361.973 227.139 361.998 226.953 361.998 226.831C361.998 226.733 361.973 226.655 361.924 226.597C361.875 226.533 361.814 226.501 361.741 226.501C361.692 226.501 361.597 226.536 361.456 226.604C361.314 226.672 361.119 226.777 360.87 226.919L360.665 226.516C361.119 226.179 361.517 225.918 361.858 225.732C362.2 225.542 362.442 225.447 362.583 225.447C362.784 225.447 362.94 225.532 363.052 225.703C363.169 225.874 363.228 226.111 363.228 226.414C363.228 226.794 363.077 227.532 362.774 228.625C362.476 229.719 362.327 230.54 362.327 231.086C362.327 231.257 362.356 231.384 362.415 231.467C362.474 231.545 362.564 231.584 362.686 231.584C362.823 231.584 363.055 231.45 363.382 231.182C363.714 230.908 364.268 230.388 365.044 229.622C365.23 228.743 365.379 228 365.491 227.395C365.608 226.785 365.699 226.24 365.762 225.762L367.081 225.447L366.919 226.172C366.641 227.358 366.49 228.02 366.465 228.157L366.29 229.094C366.202 229.539 366.131 229.963 366.077 230.369C366.028 230.774 366.004 231.06 366.004 231.226C366.004 231.338 366.026 231.426 366.07 231.489C366.114 231.553 366.172 231.584 366.246 231.584C366.314 231.584 366.441 231.519 366.626 231.387C366.812 231.255 367.024 231.077 367.264 230.852L367.491 231.27ZM372.793 226.677L372.405 227.058C372.083 226.731 371.824 226.514 371.629 226.406C371.438 226.299 371.243 226.245 371.043 226.245C370.594 226.245 370.203 226.58 369.871 227.249C369.539 227.913 369.373 228.733 369.373 229.709C369.373 230.364 369.458 230.857 369.629 231.189C369.8 231.521 370.052 231.687 370.384 231.687C370.569 231.687 370.823 231.582 371.146 231.372C371.468 231.157 371.807 230.864 372.164 230.493L372.464 231.013C371.897 231.614 371.414 232.048 371.014 232.317C370.613 232.581 370.247 232.712 369.915 232.712C369.388 232.712 368.965 232.483 368.648 232.024C368.335 231.565 368.179 230.945 368.179 230.164C368.179 228.826 368.521 227.698 369.205 226.78C369.893 225.862 370.74 225.403 371.746 225.403C372.112 225.403 372.425 225.481 372.684 225.637C372.947 225.793 373.079 225.972 373.079 226.172C373.079 226.25 373.057 226.328 373.013 226.406C372.974 226.484 372.901 226.575 372.793 226.677ZM376.792 223.74C376.7 224.067 376.57 224.58 376.404 225.278C376.355 225.483 376.319 225.635 376.294 225.732C376.583 225.732 376.875 225.73 377.173 225.725C377.476 225.715 377.793 225.703 378.125 225.688L377.95 226.421C377.818 226.416 377.671 226.414 377.51 226.414C377.349 226.414 377.09 226.414 376.734 226.414H376.148C375.918 227.419 375.748 228.298 375.635 229.05C375.528 229.802 375.474 230.432 375.474 230.94C375.474 231.155 375.508 231.323 375.577 231.445C375.65 231.567 375.75 231.628 375.877 231.628C375.975 231.628 376.128 231.55 376.338 231.394C376.548 231.238 376.834 230.986 377.195 230.64L377.452 231.108C376.749 231.831 376.265 232.292 376.001 232.493C375.738 232.688 375.516 232.786 375.335 232.786C374.998 232.786 374.729 232.627 374.529 232.31C374.329 231.992 374.229 231.56 374.229 231.013C374.229 230.657 374.285 230.146 374.397 229.482C374.51 228.813 374.722 227.778 375.035 226.377C374.957 226.377 374.854 226.379 374.727 226.384C374.605 226.389 374.522 226.392 374.478 226.392H373.973L374.061 225.901C374.285 225.891 374.49 225.852 374.676 225.784C374.866 225.715 375.057 225.608 375.247 225.461C375.291 225.286 375.34 225.103 375.394 224.912C375.452 224.717 375.518 224.512 375.591 224.297L376.792 223.74ZM381.634 230.837L381.89 231.27C381.29 231.89 380.872 232.285 380.638 232.456C380.403 232.627 380.196 232.712 380.015 232.712C379.756 232.712 379.549 232.605 379.393 232.39C379.236 232.17 379.158 231.877 379.158 231.511C379.158 231.052 379.302 230.286 379.59 229.211C379.883 228.137 380.03 227.363 380.03 226.89C380.03 226.768 380 226.67 379.942 226.597C379.883 226.523 379.808 226.487 379.715 226.487C379.637 226.487 379.534 226.519 379.407 226.582C379.28 226.646 379.122 226.743 378.931 226.875L378.711 226.487L379.686 225.776C379.871 225.64 380.032 225.542 380.169 225.483C380.306 225.42 380.435 225.388 380.557 225.388C380.787 225.388 380.967 225.483 381.099 225.674C381.236 225.859 381.304 226.116 381.304 226.443C381.304 226.799 381.177 227.498 380.923 228.538C380.865 228.772 380.821 228.948 380.792 229.065C380.655 229.617 380.55 230.073 380.477 230.435C380.408 230.796 380.374 231.045 380.374 231.182C380.374 231.304 380.401 231.404 380.455 231.482C380.508 231.56 380.577 231.599 380.66 231.599C380.738 231.599 380.84 231.55 380.967 231.453C381.094 231.355 381.316 231.15 381.634 230.837ZM381.575 221.396L381.993 221.865C382.11 221.987 382.19 222.097 382.234 222.195C382.283 222.288 382.308 222.383 382.308 222.48C382.308 222.583 382.271 222.681 382.198 222.773C382.129 222.866 382.027 222.954 381.89 223.037L381.246 223.396L380.777 222.839C380.679 222.717 380.616 222.622 380.586 222.554C380.557 222.48 380.542 222.405 380.542 222.327C380.542 222.214 380.572 222.117 380.63 222.034C380.689 221.946 380.789 221.86 380.931 221.777L381.575 221.396ZM386.167 226.128C385.601 226.128 385.113 226.516 384.703 227.292C384.292 228.069 384.087 229.026 384.087 230.164C384.087 230.764 384.19 231.223 384.395 231.541C384.605 231.858 384.908 232.017 385.303 232.017C385.899 232.017 386.404 231.636 386.819 230.874C387.239 230.107 387.449 229.17 387.449 228.062C387.449 227.402 387.344 226.917 387.134 226.604C386.924 226.287 386.602 226.128 386.167 226.128ZM386.482 225.417C387.21 225.417 387.762 225.645 388.138 226.099C388.519 226.548 388.709 227.207 388.709 228.076C388.709 228.574 388.611 229.106 388.416 229.673C388.221 230.234 387.957 230.742 387.625 231.196C387.269 231.685 386.863 232.061 386.409 232.324C385.96 232.583 385.486 232.712 384.988 232.712C384.334 232.712 383.812 232.476 383.421 232.002C383.035 231.528 382.842 230.894 382.842 230.098C382.842 229.507 382.938 228.931 383.128 228.369C383.318 227.808 383.592 227.3 383.948 226.846C384.3 226.392 384.698 226.04 385.142 225.791C385.591 225.542 386.038 225.417 386.482 225.417ZM391.888 227.52L393.074 226.362C393.489 225.967 393.802 225.706 394.012 225.579C394.227 225.452 394.429 225.388 394.62 225.388C394.942 225.388 395.203 225.53 395.403 225.813C395.608 226.096 395.711 226.47 395.711 226.934C395.711 227.407 395.591 228.14 395.352 229.131C395.113 230.117 394.993 230.82 394.993 231.24C394.993 231.367 395.018 231.465 395.066 231.533C395.115 231.597 395.186 231.628 395.279 231.628C395.323 231.628 395.376 231.611 395.44 231.577C395.508 231.538 395.574 231.487 395.638 231.423L396.194 230.881L396.451 231.27L395.652 232.083C395.462 232.278 395.271 232.432 395.081 232.544C394.896 232.656 394.732 232.712 394.59 232.712C394.346 232.712 394.146 232.607 393.99 232.397C393.838 232.183 393.763 231.902 393.763 231.555C393.763 231.14 393.887 230.41 394.136 229.365C394.385 228.315 394.51 227.551 394.51 227.073C394.51 226.892 394.471 226.748 394.393 226.641C394.319 226.528 394.219 226.472 394.092 226.472C393.902 226.472 393.318 226.924 392.342 227.827C392.083 228.066 391.88 228.254 391.734 228.391L391.272 230.969C391.263 231.018 391.248 231.091 391.229 231.189C391.126 231.711 391.065 232.112 391.045 232.39L389.742 232.712C390.064 231.311 390.318 230.093 390.503 229.058C390.694 228.022 390.789 227.344 390.789 227.021C390.789 226.826 390.767 226.687 390.723 226.604C390.679 226.516 390.608 226.472 390.511 226.472C390.452 226.472 390.354 226.506 390.218 226.575C390.086 226.643 389.917 226.743 389.712 226.875L389.515 226.487C389.568 226.443 389.646 226.379 389.749 226.296C390.501 225.691 391.004 225.388 391.258 225.388C391.502 225.388 391.683 225.481 391.8 225.667C391.917 225.847 391.976 226.13 391.976 226.516C391.976 226.653 391.968 226.807 391.954 226.978C391.939 227.148 391.917 227.329 391.888 227.52Z" fill="black"></path>
<path d="M397.354 211.354C397.549 211.158 397.549 210.842 397.354 210.646L394.172 207.464C393.976 207.269 393.66 207.269 393.464 207.464C393.269 207.66 393.269 207.976 393.464 208.172L396.293 211L393.464 213.828C393.269 214.024 393.269 214.34 393.464 214.536C393.66 214.731 393.976 214.731 394.172 214.536L397.354 211.354ZM161 211V211.5H397V211V210.5H161V211Z" fill="black"></path>
<defs>
<clipPath id="clip0_249_8276-rmsnorm-3-svg">
<rect x="122" y="80" width="275" height="91" rx="2" fill="white"></rect>
</clipPath>
</defs>
</svg>

<figcaption><b>Split-Reduction RMSNorm</b> If we have a small batch size, our data-parallel strategy may no longer have sufficient parallelism to saturate our cores. In this case, it may be more efficient to "split" a reduction among multiple cores, allowing us to fully utilize our GPU. However, this <i>loses</i> batch invariance, as we are no longer reducing each element in the same order.</figcaption>
</figure>
<p>The easiest solution is to simply ignore these cases altogether. This is not completely <em>unreasonable</em> — a small batch size means that the kernel is likely to execute quickly anyways, and so a slowdown may not be catastrophic.</p>
<p>If we <em>were</em> compelled to optimize this use case, one approach would be to consistently use a reduction strategy that has enough parallelism even for very small batch sizes. Such a reduction strategy would lead to an excess amount of parallelism for larger batch sizes but would allow us to achieve decent (but not peak) performance across the entire range of sizes.</p>
<h3 id="batch-invariant-matrix-multiplication">Batch-Invariant Matrix Multiplication</h3>
<figure>
<svg width="537" height="458" viewBox="0 0 537 458" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="537" height="458" fill="#F5F5F5"></rect>
<rect width="537" height="458" fill="white"></rect>
<g clip-path="url(#clip0_249_8276-matmul-1-svg)">
<rect x="145" y="236" width="35" height="35" fill="#DFE2E7"></rect>
<rect opacity="0.8" x="181" y="236" width="35" height="35" fill="#DFE2E7"></rect>
<rect opacity="0.6" x="217" y="236" width="35" height="35" fill="#DFE2E7"></rect>
<rect opacity="0.4" x="253" y="236" width="35" height="35" fill="#DFE2E7"></rect>
<rect x="145" y="272" width="35" height="35" fill="#DFE2E7"></rect>
<rect opacity="0.8" x="181" y="272" width="35" height="35" fill="#DFE2E7"></rect>
<rect opacity="0.6" x="217" y="272" width="35" height="35" fill="#DFE2E7"></rect>
<rect opacity="0.4" x="253" y="272" width="35" height="35" fill="#DFE2E7"></rect>
<rect x="145" y="308" width="35" height="35" fill="#DFE2E7"></rect>
<rect opacity="0.8" x="181" y="308" width="35" height="35" fill="#DFE2E7"></rect>
<rect opacity="0.6" x="217" y="308" width="35" height="35" fill="#DFE2E7"></rect>
<rect opacity="0.4" x="253" y="308" width="35" height="35" fill="#DFE2E7"></rect>
<rect x="145" y="344" width="35" height="35" fill="#DFE2E7"></rect>
<rect opacity="0.8" x="181" y="344" width="35" height="35" fill="#DFE2E7"></rect>
<rect opacity="0.6" x="217" y="344" width="35" height="35" fill="#DFE2E7"></rect>
<rect opacity="0.4" x="253" y="344" width="35" height="35" fill="#DFE2E7"></rect>
</g>
<g clip-path="url(#clip1_249_8276-matmul-1-svg)">
<path d="M318 238C318 236.895 318.895 236 320 236H353V271H318V238Z" fill="#3870FC"></path>
<rect x="354" y="236" width="35" height="35" fill="#F63236"></rect>
<rect x="390" y="236" width="35" height="35" fill="#F360A5"></rect>
<rect x="426" y="236" width="35" height="35" fill="#FFA8AA"></rect>
<rect x="318" y="272" width="35" height="35" fill="#160E8A"></rect>
<rect x="354" y="272" width="35" height="35" fill="#856AD1"></rect>
<rect x="390" y="272" width="35" height="35" fill="#C35980"></rect>
<rect x="426" y="272" width="35" height="35" fill="#EA3B40"></rect>
<path d="M318 310C318 308.895 318.895 308 320 308H353V343H318V310Z" fill="#3870FC"></path>
<rect x="354" y="308" width="35" height="35" fill="#F63236"></rect>
<rect x="390" y="308" width="35" height="35" fill="#F360A5"></rect>
<rect x="426" y="308" width="35" height="35" fill="#FFA8AA"></rect>
<rect x="318" y="344" width="35" height="35" fill="#160E8A"></rect>
<rect x="354" y="344" width="35" height="35" fill="#856AD1"></rect>
<rect x="390" y="344" width="35" height="35" fill="#C35980"></rect>
<rect x="426" y="344" width="35" height="35" fill="#EA3B40"></rect>
</g>
<g clip-path="url(#clip2_249_8276-matmul-1-svg)">
<rect x="461" y="63" width="35" height="35" transform="rotate(90 461 63)" fill="#DFE2E7"></rect>
<rect opacity="0.8" x="461" y="99" width="35" height="35" transform="rotate(90 461 99)" fill="#DFE2E7"></rect>
<rect opacity="0.6" x="461" y="135" width="35" height="35" transform="rotate(90 461 135)" fill="#DFE2E7"></rect>
<rect opacity="0.4" x="461" y="171" width="35" height="35" transform="rotate(90 461 171)" fill="#DFE2E7"></rect>
<rect x="425" y="63" width="35" height="35" transform="rotate(90 425 63)" fill="#DFE2E7"></rect>
<rect opacity="0.8" x="425" y="99" width="35" height="35" transform="rotate(90 425 99)" fill="#DFE2E7"></rect>
<rect opacity="0.6" x="425" y="135" width="35" height="35" transform="rotate(90 425 135)" fill="#DFE2E7"></rect>
<rect opacity="0.4" x="425" y="171" width="35" height="35" transform="rotate(90 425 171)" fill="#DFE2E7"></rect>
<rect x="389" y="63" width="35" height="35" transform="rotate(90 389 63)" fill="#DFE2E7"></rect>
<rect opacity="0.8" x="389" y="99" width="35" height="35" transform="rotate(90 389 99)" fill="#DFE2E7"></rect>
<rect opacity="0.6" x="389" y="135" width="35" height="35" transform="rotate(90 389 135)" fill="#DFE2E7"></rect>
<rect opacity="0.4" x="389" y="171" width="35" height="35" transform="rotate(90 389 171)" fill="#DFE2E7"></rect>
<rect x="353" y="63" width="35" height="35" transform="rotate(90 353 63)" fill="#DFE2E7"></rect>
<rect opacity="0.8" x="353" y="99" width="35" height="35" transform="rotate(90 353 99)" fill="#DFE2E7"></rect>
<rect opacity="0.6" x="353" y="135" width="35" height="35" transform="rotate(90 353 135)" fill="#DFE2E7"></rect>
<rect opacity="0.4" x="353" y="171" width="35" height="35" transform="rotate(90 353 171)" fill="#DFE2E7"></rect>
</g>
<path d="M231.398 415.137C231.462 415.146 231.528 415.151 231.596 415.151C231.665 415.151 231.767 415.151 231.904 415.151C232.939 415.151 233.752 414.934 234.343 414.5C234.938 414.065 235.236 413.474 235.236 412.727C235.236 412.058 235.053 411.55 234.687 411.204C234.321 410.857 233.789 410.684 233.09 410.684C232.983 410.684 232.849 410.688 232.688 410.698C232.531 410.708 232.355 410.723 232.16 410.742C231.955 411.885 231.792 412.8 231.669 413.489C231.552 414.177 231.462 414.727 231.398 415.137ZM228.308 419.517H228.593C228.896 419.517 229.111 419.431 229.238 419.26C229.37 419.084 229.504 418.601 229.641 417.81L230.703 411.482C230.717 411.409 230.729 411.34 230.739 411.277C230.749 411.213 230.754 411.162 230.754 411.123C230.754 410.923 230.686 410.776 230.549 410.684C230.417 410.586 230.214 410.537 229.941 410.537H229.743L229.838 409.995C230.146 410.024 230.427 410.046 230.681 410.061C230.935 410.076 231.164 410.083 231.369 410.083C231.687 410.083 232.109 410.068 232.636 410.039C233.168 410.01 233.54 409.995 233.75 409.995C234.648 409.995 235.349 410.203 235.852 410.618C236.359 411.028 236.613 411.594 236.613 412.317C236.613 413.005 236.394 413.611 235.954 414.133C235.515 414.651 234.87 415.071 234.021 415.393L235.134 417.51C235.163 417.573 235.209 417.668 235.273 417.795C235.893 419.006 236.555 419.612 237.258 419.612C237.282 419.612 237.319 419.609 237.368 419.604C237.421 419.6 237.46 419.597 237.485 419.597L237.397 420.088C237.172 420.127 236.984 420.154 236.833 420.168C236.682 420.188 236.55 420.198 236.438 420.198C235.993 420.198 235.615 420.117 235.302 419.956C234.99 419.79 234.733 419.539 234.533 419.202C234.392 418.972 234.128 418.447 233.742 417.627C233.361 416.807 233.054 416.157 232.819 415.679C232.663 415.693 232.504 415.706 232.343 415.715C232.187 415.72 232.026 415.723 231.86 415.723C231.796 415.723 231.701 415.72 231.574 415.715C231.452 415.71 231.357 415.708 231.289 415.708L230.871 418.469C230.856 418.572 230.844 418.662 230.834 418.74C230.83 418.813 230.827 418.875 230.827 418.923C230.827 419.163 230.878 419.321 230.981 419.399C231.088 419.478 231.311 419.517 231.647 419.517H231.816L231.721 420C231.56 419.995 231.333 419.985 231.04 419.971C230.468 419.951 230.102 419.941 229.941 419.941C229.692 419.941 229.252 419.956 228.623 419.985C228.452 419.99 228.315 419.995 228.212 420L228.308 419.517ZM239.858 416.697L239.931 416.66C241.669 415.771 242.539 415.085 242.539 414.602C242.539 414.343 242.446 414.119 242.26 413.928C242.075 413.738 241.857 413.643 241.608 413.643C241.223 413.643 240.876 413.909 240.568 414.441C240.261 414.973 240.024 415.725 239.858 416.697ZM242.062 416.191L239.821 417.349V417.422C239.821 418.003 239.912 418.445 240.092 418.748C240.278 419.05 240.544 419.202 240.891 419.202C241.096 419.202 241.352 419.111 241.66 418.931C241.972 418.745 242.37 418.447 242.854 418.037L243.11 418.499C242.412 419.143 241.855 419.59 241.44 419.839C241.03 420.088 240.656 420.212 240.319 420.212C239.807 420.212 239.392 419.99 239.074 419.546C238.757 419.102 238.598 418.518 238.598 417.795C238.598 417.283 238.681 416.733 238.847 416.147C239.018 415.557 239.238 415.042 239.506 414.602C239.843 414.065 240.229 413.65 240.664 413.357C241.098 413.064 241.547 412.917 242.011 412.917C242.485 412.917 242.88 413.069 243.198 413.372C243.52 413.669 243.681 414.033 243.681 414.463C243.681 414.81 243.583 415.098 243.388 415.327C243.198 415.552 242.756 415.84 242.062 416.191ZM248.405 417.378L248.955 414.06C248.686 413.904 248.447 413.792 248.237 413.723C248.027 413.65 247.832 413.613 247.651 413.613C247.05 413.613 246.545 413.999 246.135 414.771C245.725 415.537 245.52 416.494 245.52 417.642C245.52 418.105 245.573 418.457 245.681 418.696C245.793 418.936 245.957 419.055 246.171 419.055C246.318 419.055 246.589 418.906 246.984 418.608C247.385 418.311 247.858 417.9 248.405 417.378ZM248.42 418.125L247.175 419.253C246.809 419.585 246.516 419.814 246.296 419.941C246.081 420.068 245.878 420.132 245.688 420.132C245.249 420.132 244.912 419.946 244.677 419.575C244.443 419.199 244.326 418.66 244.326 417.957C244.326 416.57 244.675 415.378 245.373 414.382C246.076 413.386 246.911 412.888 247.878 412.888C248.073 412.888 248.271 412.915 248.471 412.969C248.676 413.018 248.889 413.091 249.108 413.188L249.526 410.537C249.541 410.435 249.55 410.332 249.555 410.229C249.565 410.122 249.57 410.015 249.57 409.907C249.57 409.712 249.531 409.578 249.453 409.504C249.375 409.431 249.23 409.395 249.021 409.395C248.957 409.395 248.891 409.397 248.823 409.402C248.759 409.402 248.688 409.404 248.61 409.409L248.581 408.977C248.986 408.938 249.394 408.884 249.804 408.816C250.219 408.748 250.637 408.665 251.057 408.567C250.603 410.911 250.229 413.027 249.936 414.917C249.643 416.802 249.497 417.947 249.497 418.352C249.497 418.601 249.519 418.777 249.562 418.879C249.611 418.977 249.689 419.026 249.797 419.026C249.855 419.026 249.924 419.001 250.002 418.953C250.085 418.904 250.188 418.823 250.31 418.711L250.756 418.308L250.998 418.726L250.156 419.553C249.863 419.836 249.65 420.017 249.519 420.095C249.387 420.173 249.26 420.212 249.138 420.212C248.879 420.212 248.688 420.09 248.566 419.846C248.449 419.602 248.391 419.224 248.391 418.711C248.391 418.599 248.393 418.499 248.398 418.411C248.403 418.318 248.41 418.223 248.42 418.125ZM258.491 418.77L257.48 419.714C257.299 419.89 257.136 420.015 256.989 420.088C256.848 420.161 256.701 420.198 256.55 420.198C256.33 420.198 256.152 420.093 256.015 419.883C255.883 419.668 255.817 419.382 255.817 419.026C255.817 418.923 255.825 418.801 255.839 418.66C255.859 418.513 255.896 418.286 255.949 417.979C255.046 418.901 254.406 419.502 254.03 419.78C253.654 420.059 253.334 420.198 253.071 420.198C252.792 420.198 252.561 420.068 252.375 419.81C252.189 419.551 252.097 419.219 252.097 418.813C252.097 418.472 252.243 417.703 252.536 416.506C252.609 416.223 252.663 416.008 252.697 415.862C252.8 415.457 252.875 415.132 252.924 414.888C252.973 414.639 252.998 414.453 252.998 414.331C252.998 414.233 252.973 414.155 252.924 414.097C252.875 414.033 252.814 414.001 252.741 414.001C252.692 414.001 252.597 414.036 252.456 414.104C252.314 414.172 252.119 414.277 251.87 414.419L251.665 414.016C252.119 413.679 252.517 413.418 252.858 413.232C253.2 413.042 253.442 412.947 253.583 412.947C253.784 412.947 253.94 413.032 254.052 413.203C254.169 413.374 254.228 413.611 254.228 413.914C254.228 414.294 254.077 415.032 253.774 416.125C253.476 417.219 253.327 418.04 253.327 418.586C253.327 418.757 253.356 418.884 253.415 418.967C253.474 419.045 253.564 419.084 253.686 419.084C253.823 419.084 254.055 418.95 254.382 418.682C254.714 418.408 255.268 417.888 256.044 417.122C256.23 416.243 256.379 415.5 256.491 414.895C256.608 414.285 256.699 413.74 256.762 413.262L258.081 412.947L257.919 413.672C257.641 414.858 257.49 415.52 257.465 415.657L257.29 416.594C257.202 417.039 257.131 417.463 257.077 417.869C257.028 418.274 257.004 418.56 257.004 418.726C257.004 418.838 257.026 418.926 257.07 418.989C257.114 419.053 257.172 419.084 257.246 419.084C257.314 419.084 257.441 419.019 257.626 418.887C257.812 418.755 258.024 418.577 258.264 418.352L258.491 418.77ZM263.793 414.177L263.405 414.558C263.083 414.231 262.824 414.014 262.629 413.906C262.438 413.799 262.243 413.745 262.043 413.745C261.594 413.745 261.203 414.08 260.871 414.749C260.539 415.413 260.373 416.233 260.373 417.209C260.373 417.864 260.458 418.357 260.629 418.689C260.8 419.021 261.052 419.187 261.384 419.187C261.569 419.187 261.823 419.082 262.146 418.872C262.468 418.657 262.807 418.364 263.164 417.993L263.464 418.513C262.897 419.114 262.414 419.548 262.014 419.817C261.613 420.081 261.247 420.212 260.915 420.212C260.388 420.212 259.965 419.983 259.648 419.524C259.335 419.065 259.179 418.445 259.179 417.664C259.179 416.326 259.521 415.198 260.205 414.28C260.893 413.362 261.74 412.903 262.746 412.903C263.112 412.903 263.425 412.981 263.684 413.137C263.947 413.293 264.079 413.472 264.079 413.672C264.079 413.75 264.057 413.828 264.013 413.906C263.974 413.984 263.901 414.075 263.793 414.177ZM267.792 411.24C267.7 411.567 267.57 412.08 267.404 412.778C267.355 412.983 267.319 413.135 267.294 413.232C267.583 413.232 267.875 413.23 268.173 413.225C268.476 413.215 268.793 413.203 269.125 413.188L268.95 413.921C268.818 413.916 268.671 413.914 268.51 413.914C268.349 413.914 268.09 413.914 267.734 413.914H267.148C266.918 414.919 266.748 415.798 266.635 416.55C266.528 417.302 266.474 417.932 266.474 418.44C266.474 418.655 266.508 418.823 266.577 418.945C266.65 419.067 266.75 419.128 266.877 419.128C266.975 419.128 267.128 419.05 267.338 418.894C267.548 418.738 267.834 418.486 268.195 418.14L268.452 418.608C267.749 419.331 267.265 419.792 267.001 419.993C266.738 420.188 266.516 420.286 266.335 420.286C265.998 420.286 265.729 420.127 265.529 419.81C265.329 419.492 265.229 419.06 265.229 418.513C265.229 418.157 265.285 417.646 265.397 416.982C265.51 416.313 265.722 415.278 266.035 413.877C265.957 413.877 265.854 413.879 265.727 413.884C265.605 413.889 265.522 413.892 265.478 413.892H264.973L265.061 413.401C265.285 413.391 265.49 413.352 265.676 413.284C265.866 413.215 266.057 413.108 266.247 412.961C266.291 412.786 266.34 412.603 266.394 412.412C266.452 412.217 266.518 412.012 266.591 411.797L267.792 411.24ZM272.634 418.337L272.89 418.77C272.29 419.39 271.872 419.785 271.638 419.956C271.403 420.127 271.196 420.212 271.015 420.212C270.756 420.212 270.549 420.105 270.393 419.89C270.236 419.67 270.158 419.377 270.158 419.011C270.158 418.552 270.302 417.786 270.59 416.711C270.883 415.637 271.03 414.863 271.03 414.39C271.03 414.268 271 414.17 270.942 414.097C270.883 414.023 270.808 413.987 270.715 413.987C270.637 413.987 270.534 414.019 270.407 414.082C270.28 414.146 270.122 414.243 269.931 414.375L269.711 413.987L270.686 413.276C270.871 413.14 271.032 413.042 271.169 412.983C271.306 412.92 271.435 412.888 271.557 412.888C271.787 412.888 271.967 412.983 272.099 413.174C272.236 413.359 272.304 413.616 272.304 413.943C272.304 414.299 272.177 414.998 271.923 416.038C271.865 416.272 271.821 416.448 271.792 416.565C271.655 417.117 271.55 417.573 271.477 417.935C271.408 418.296 271.374 418.545 271.374 418.682C271.374 418.804 271.401 418.904 271.455 418.982C271.508 419.06 271.577 419.099 271.66 419.099C271.738 419.099 271.84 419.05 271.967 418.953C272.094 418.855 272.316 418.65 272.634 418.337ZM272.575 408.896L272.993 409.365C273.11 409.487 273.19 409.597 273.234 409.695C273.283 409.788 273.308 409.883 273.308 409.98C273.308 410.083 273.271 410.181 273.198 410.273C273.129 410.366 273.027 410.454 272.89 410.537L272.246 410.896L271.777 410.339C271.679 410.217 271.616 410.122 271.586 410.054C271.557 409.98 271.542 409.905 271.542 409.827C271.542 409.714 271.572 409.617 271.63 409.534C271.689 409.446 271.789 409.36 271.931 409.277L272.575 408.896ZM277.167 413.628C276.601 413.628 276.113 414.016 275.703 414.792C275.292 415.569 275.087 416.526 275.087 417.664C275.087 418.264 275.19 418.723 275.395 419.041C275.605 419.358 275.908 419.517 276.303 419.517C276.899 419.517 277.404 419.136 277.819 418.374C278.239 417.607 278.449 416.67 278.449 415.562C278.449 414.902 278.344 414.417 278.134 414.104C277.924 413.787 277.602 413.628 277.167 413.628ZM277.482 412.917C278.21 412.917 278.762 413.145 279.138 413.599C279.519 414.048 279.709 414.707 279.709 415.576C279.709 416.074 279.611 416.606 279.416 417.173C279.221 417.734 278.957 418.242 278.625 418.696C278.269 419.185 277.863 419.561 277.409 419.824C276.96 420.083 276.486 420.212 275.988 420.212C275.334 420.212 274.812 419.976 274.421 419.502C274.035 419.028 273.842 418.394 273.842 417.598C273.842 417.007 273.938 416.431 274.128 415.869C274.318 415.308 274.592 414.8 274.948 414.346C275.3 413.892 275.698 413.54 276.142 413.291C276.591 413.042 277.038 412.917 277.482 412.917ZM282.888 415.02L284.074 413.862C284.489 413.467 284.802 413.206 285.012 413.079C285.227 412.952 285.429 412.888 285.62 412.888C285.942 412.888 286.203 413.03 286.403 413.313C286.608 413.596 286.711 413.97 286.711 414.434C286.711 414.907 286.591 415.64 286.352 416.631C286.113 417.617 285.993 418.32 285.993 418.74C285.993 418.867 286.018 418.965 286.066 419.033C286.115 419.097 286.186 419.128 286.279 419.128C286.323 419.128 286.376 419.111 286.44 419.077C286.508 419.038 286.574 418.987 286.638 418.923L287.194 418.381L287.451 418.77L286.652 419.583C286.462 419.778 286.271 419.932 286.081 420.044C285.896 420.156 285.732 420.212 285.59 420.212C285.346 420.212 285.146 420.107 284.99 419.897C284.838 419.683 284.763 419.402 284.763 419.055C284.763 418.64 284.887 417.91 285.136 416.865C285.385 415.815 285.51 415.051 285.51 414.573C285.51 414.392 285.471 414.248 285.393 414.141C285.319 414.028 285.219 413.972 285.092 413.972C284.902 413.972 284.318 414.424 283.342 415.327C283.083 415.566 282.88 415.754 282.734 415.891L282.272 418.469C282.263 418.518 282.248 418.591 282.229 418.689C282.126 419.211 282.065 419.612 282.045 419.89L280.742 420.212C281.064 418.811 281.318 417.593 281.503 416.558C281.694 415.522 281.789 414.844 281.789 414.521C281.789 414.326 281.767 414.187 281.723 414.104C281.679 414.016 281.608 413.972 281.511 413.972C281.452 413.972 281.354 414.006 281.218 414.075C281.086 414.143 280.917 414.243 280.712 414.375L280.515 413.987C280.568 413.943 280.646 413.879 280.749 413.796C281.501 413.191 282.004 412.888 282.258 412.888C282.502 412.888 282.683 412.981 282.8 413.167C282.917 413.347 282.976 413.63 282.976 414.016C282.976 414.153 282.968 414.307 282.954 414.478C282.939 414.648 282.917 414.829 282.888 415.02Z" fill="black"></path>
<path d="M288.354 399.354C288.549 399.158 288.549 398.842 288.354 398.646L285.172 395.464C284.976 395.269 284.66 395.269 284.464 395.464C284.269 395.66 284.269 395.976 284.464 396.172L287.293 399L284.464 401.828C284.269 402.024 284.269 402.34 284.464 402.536C284.66 402.731 284.976 402.731 285.172 402.536L288.354 399.354ZM152 399V399.5H288V399V398.5H152V399Z" fill="black"></path>
<path d="M480.65 206.354C480.846 206.549 481.162 206.549 481.357 206.354L484.539 203.172C484.735 202.976 484.735 202.66 484.539 202.464C484.344 202.269 484.028 202.269 483.832 202.464L481.004 205.293L478.175 202.464C477.98 202.269 477.664 202.269 477.468 202.464C477.273 202.66 477.273 202.976 477.468 203.172L480.65 206.354ZM481.004 90L480.504 90L480.504 206L481.004 206L481.504 206L481.504 90L481.004 90Z" fill="black"></path>
<path d="M383.318 18.5483C383.547 18.5679 383.77 18.5825 383.984 18.5923C384.204 18.6021 384.419 18.6069 384.629 18.6069C384.785 18.6069 384.968 18.6021 385.178 18.5923C385.388 18.5825 385.615 18.5679 385.859 18.5483C385.923 18.7095 386.011 18.8755 386.123 19.0464C386.235 19.2173 386.377 19.4053 386.548 19.6104L392.59 26.7588C392.576 26.0166 392.561 25.0327 392.546 23.8071C392.507 21.2339 392.463 19.8496 392.415 19.6543C392.356 19.4297 392.251 19.2734 392.1 19.1855C391.953 19.0977 391.711 19.0537 391.375 19.0537H391.147V18.5483C391.206 18.5483 391.294 18.5508 391.411 18.5557C392.104 18.5898 392.593 18.6069 392.876 18.6069C393.164 18.6069 393.667 18.5898 394.385 18.5557C394.487 18.5508 394.565 18.5483 394.619 18.5483L394.612 19.0537C394.583 19.0488 394.551 19.0464 394.517 19.0464C394.482 19.0415 394.436 19.0391 394.377 19.0391C393.723 19.0391 393.391 19.9497 393.381 21.771C393.376 22.23 393.374 22.5889 393.374 22.8477L393.345 24.7959C393.335 25.084 393.328 25.3818 393.323 25.6895C393.323 25.9922 393.323 26.4097 393.323 26.9419C393.323 27.5327 393.33 27.9941 393.345 28.3262C393.359 28.6533 393.384 28.917 393.418 29.1172H392.605C392.522 28.9219 392.227 28.5312 391.719 27.9453L391.646 27.8574L385.361 20.4673V20.6357C385.391 25.2061 385.439 27.623 385.508 27.8867C385.566 28.1113 385.669 28.2676 385.815 28.3555C385.967 28.4434 386.206 28.4873 386.533 28.4873H386.753V29C386.68 28.9951 386.572 28.9902 386.431 28.9854C385.747 28.9561 385.281 28.9414 385.032 28.9414C384.792 28.9414 384.526 28.9463 384.233 28.9561C383.945 28.9658 383.64 28.9805 383.318 29V28.4946C383.347 28.4946 383.379 28.4971 383.413 28.502C383.452 28.502 383.501 28.502 383.56 28.502C384.214 28.502 384.546 27.5962 384.556 25.7847C384.561 25.3257 384.563 24.9668 384.563 24.708L384.6 22.7598C384.604 22.3398 384.607 21.9321 384.607 21.5366C384.612 21.1362 384.614 20.6797 384.614 20.167C384.614 19.7471 384.534 19.4565 384.373 19.2954C384.211 19.1343 383.926 19.0537 383.516 19.0537H383.318V18.5483Z" fill="black"></path>
<path d="M337 53V38.5H440V53" stroke="black"></path>
<path d="M37.2832 309.236C37.3955 309.246 37.5151 309.253 37.6421 309.258C37.7739 309.258 37.9692 309.258 38.228 309.258C38.5063 309.258 38.7627 309.253 38.9971 309.243C39.2363 309.233 39.4658 309.216 39.6855 309.192C40.042 308.938 40.3105 308.652 40.4912 308.335C40.6719 308.013 40.7622 307.659 40.7622 307.273C40.7622 306.653 40.5645 306.165 40.1689 305.808C39.7734 305.447 39.2314 305.266 38.543 305.266C38.3916 305.266 38.2158 305.276 38.0156 305.295C37.8203 305.315 37.5981 305.344 37.3491 305.383C37.3345 306.038 37.3198 306.797 37.3052 307.661C37.2954 308.525 37.2881 309.05 37.2832 309.236ZM37.2979 314.048C37.5811 314.131 37.8594 314.194 38.1328 314.238C38.4062 314.277 38.6724 314.297 38.9312 314.297C39.7319 314.297 40.3521 314.102 40.7915 313.711C41.231 313.32 41.4507 312.776 41.4507 312.078C41.4507 311.335 41.2041 310.786 40.7109 310.43C40.2178 310.068 39.4609 309.888 38.4404 309.888C38.2744 309.888 38.106 309.89 37.9351 309.895C37.769 309.895 37.5518 309.902 37.2832 309.917C37.2832 310.122 37.2808 310.425 37.2759 310.825C37.271 311.221 37.2686 311.511 37.2686 311.697C37.2686 312 37.271 312.322 37.2759 312.664C37.2808 313 37.2881 313.462 37.2979 314.048ZM34.7051 314.524C34.7393 314.529 34.771 314.534 34.8003 314.539C34.8345 314.539 34.8833 314.539 34.9468 314.539C35.5962 314.539 35.9258 313.625 35.9355 311.799C35.9404 311.34 35.9453 310.981 35.9502 310.723L35.9795 308.723C35.9844 308.293 35.9868 307.876 35.9868 307.471C35.9917 307.065 35.9941 306.626 35.9941 306.152C35.9941 305.732 35.916 305.442 35.7598 305.281C35.6035 305.12 35.3252 305.039 34.9248 305.039H34.8662V304.526C35.1787 304.551 35.4839 304.568 35.7817 304.578C36.0845 304.587 36.3896 304.592 36.6973 304.592C37.0391 304.592 37.459 304.583 37.957 304.563C38.4551 304.539 38.7798 304.526 38.9312 304.526C39.937 304.526 40.7305 304.751 41.3115 305.2C41.8975 305.645 42.1904 306.245 42.1904 307.002C42.1904 307.534 42.0464 307.996 41.7583 308.386C41.4751 308.772 41.0039 309.146 40.3447 309.507C41.2041 309.673 41.8462 309.966 42.271 310.386C42.6958 310.806 42.9082 311.36 42.9082 312.048C42.9082 312.942 42.5542 313.662 41.8462 314.209C41.1382 314.756 40.1934 315.029 39.0117 315.029C38.7969 315.029 38.394 315.017 37.8032 314.993C37.2124 314.968 36.7241 314.956 36.3384 314.956C36.1772 314.956 35.9526 314.961 35.6646 314.971C35.3813 314.98 35.0615 314.995 34.7051 315.015V314.524ZM50.5181 313.938L50.7231 314.399C50.3569 314.663 50.0225 314.866 49.7197 315.007C49.417 315.154 49.1729 315.227 48.9873 315.227C48.6748 315.227 48.4404 315.137 48.2842 314.956C48.1279 314.771 48.0425 314.492 48.0278 314.121C47.4956 314.478 47.0537 314.734 46.7021 314.89C46.3506 315.042 46.0356 315.117 45.7573 315.117C45.2642 315.117 44.8516 314.932 44.5195 314.561C44.1875 314.189 44.0215 313.735 44.0215 313.198C44.0215 312.285 45.0054 311.597 46.9731 311.133C47.437 311.025 47.7983 310.94 48.0571 310.876C48.0571 310.793 48.0596 310.674 48.0645 310.518C48.0791 310.195 48.0864 309.985 48.0864 309.888C48.0864 309.38 47.9814 309.006 47.7715 308.767C47.5615 308.523 47.2417 308.401 46.812 308.401C46.3921 308.401 46.0601 308.479 45.8159 308.635C45.5767 308.787 45.457 308.994 45.457 309.258C45.457 309.282 45.4595 309.316 45.4644 309.36C45.4692 309.399 45.4717 309.429 45.4717 309.448C45.4717 309.6 45.3984 309.727 45.252 309.829C45.1055 309.927 44.9297 309.976 44.7246 309.976C44.5488 309.976 44.4194 309.946 44.3364 309.888C44.2534 309.829 44.2119 309.739 44.2119 309.617C44.2119 309.226 44.5415 308.792 45.2007 308.313C45.8599 307.83 46.541 307.588 47.2441 307.588C47.9229 307.588 48.438 307.776 48.7896 308.152C49.1411 308.523 49.3169 309.07 49.3169 309.792C49.3169 310.183 49.2925 310.784 49.2437 311.594C49.1997 312.405 49.1777 313.02 49.1777 313.44C49.1777 313.757 49.2119 313.972 49.2803 314.084C49.3535 314.197 49.4805 314.253 49.6611 314.253C49.7393 314.253 49.8394 314.231 49.9614 314.187C50.0884 314.138 50.2739 314.055 50.5181 313.938ZM48.0205 311.462C47.9277 311.487 47.7886 311.523 47.603 311.572C46.0161 312.007 45.2227 312.52 45.2227 313.11C45.2227 313.433 45.3252 313.696 45.5303 313.901C45.7354 314.102 46.0063 314.202 46.3433 314.202C46.5483 314.202 46.7852 314.148 47.0537 314.041C47.3223 313.933 47.6348 313.762 47.9912 313.528L48.0205 311.462ZM53.0083 306.423L53.4917 306.57C53.4624 306.838 53.438 307.08 53.4185 307.295C53.4038 307.505 53.394 307.712 53.3892 307.917H53.9092C54.1875 307.917 54.4707 307.915 54.7588 307.91C55.0469 307.9 55.3374 307.888 55.6304 307.874L55.4546 308.672C55.1421 308.647 54.8467 308.633 54.5684 308.628C54.2949 308.618 54.0215 308.613 53.748 308.613H53.4038C53.3745 309.453 53.3525 310.098 53.3379 310.547C53.3281 310.991 53.3232 311.36 53.3232 311.653C53.3232 312.756 53.3989 313.477 53.5503 313.813C53.7017 314.146 53.9727 314.312 54.3633 314.312C54.5244 314.312 54.7026 314.277 54.8979 314.209C55.0981 314.141 55.3398 314.028 55.623 313.872L55.8647 314.355C55.396 314.639 54.9712 314.854 54.5903 315C54.2095 315.142 53.8774 315.212 53.5942 315.212C53.0718 315.212 52.6909 315.034 52.4517 314.678C52.2124 314.316 52.0928 313.738 52.0928 312.942C52.0928 312.786 52.1025 312.229 52.1221 311.272C52.1465 310.31 52.1587 309.429 52.1587 308.628C52.1147 308.628 52.0513 308.63 51.9683 308.635C51.563 308.65 51.2847 308.657 51.1333 308.657V308.13C51.6118 308.062 52.0073 307.886 52.3198 307.603C52.6323 307.314 52.8618 306.921 53.0083 306.423ZM62.1782 313.557L62.5444 314.114C62.0708 314.475 61.6045 314.749 61.1455 314.934C60.6865 315.12 60.252 315.212 59.8418 315.212C58.8848 315.212 58.1035 314.871 57.498 314.187C56.8926 313.499 56.5898 312.62 56.5898 311.55C56.5898 310.442 56.9731 309.504 57.7397 308.738C58.5063 307.971 59.4414 307.588 60.5449 307.588C61.1113 307.588 61.5483 307.668 61.856 307.83C62.1636 307.986 62.3174 308.206 62.3174 308.489C62.3174 308.694 62.2539 308.872 62.127 309.023C62.0049 309.17 61.8633 309.243 61.7021 309.243C61.6484 309.243 61.4214 309.121 61.021 308.877C60.6255 308.628 60.2471 308.503 59.8857 308.503C59.251 308.503 58.7456 308.733 58.3696 309.192C57.9985 309.646 57.813 310.266 57.813 311.052C57.813 312.043 58.0376 312.817 58.4868 313.374C58.9409 313.926 59.5684 314.202 60.3691 314.202C60.667 314.202 60.9624 314.15 61.2554 314.048C61.5532 313.945 61.8608 313.782 62.1782 313.557ZM65.54 303.677C65.5205 304.497 65.5034 305.334 65.4888 306.189C65.4741 307.043 65.4644 307.92 65.4595 308.818C66.0063 308.403 66.4946 308.098 66.9243 307.903C67.354 307.703 67.7446 307.603 68.0962 307.603C68.814 307.603 69.3535 307.805 69.7148 308.21C70.0762 308.616 70.2568 309.224 70.2568 310.034C70.2568 310.039 70.2544 310.254 70.2495 310.679C70.2446 311.104 70.2422 311.528 70.2422 311.953C70.2422 312.134 70.2397 312.361 70.2349 312.634C70.23 312.903 70.2275 313.086 70.2275 313.184C70.2275 313.73 70.2764 314.087 70.374 314.253C70.4717 314.419 70.6572 314.502 70.9307 314.502C70.9453 314.502 70.9722 314.5 71.0112 314.495C71.0552 314.49 71.0894 314.487 71.1138 314.487V315C70.6694 314.971 70.335 314.951 70.1104 314.941C69.8857 314.932 69.7002 314.927 69.5537 314.927C69.3193 314.927 69.0654 314.934 68.792 314.949C68.5234 314.958 68.2427 314.976 67.9497 315L67.9424 314.487H68.0522C68.6772 314.487 68.9971 313.916 69.0117 312.773C69.0117 312.71 69.0117 312.661 69.0117 312.627L69.0264 311.052V310.752C69.0264 309.863 68.9214 309.275 68.7114 308.987C68.5015 308.694 68.1401 308.547 67.6274 308.547C67.3491 308.547 67.0391 308.616 66.6973 308.752C66.3604 308.889 65.9624 309.106 65.5034 309.404L65.4668 312.012C65.4668 312.158 65.4644 312.346 65.4595 312.576C65.4546 312.805 65.4521 312.964 65.4521 313.052C65.4521 313.657 65.501 314.05 65.5986 314.231C65.6963 314.412 65.8843 314.502 66.1626 314.502C66.1821 314.502 66.2114 314.5 66.2505 314.495C66.2944 314.49 66.3286 314.487 66.353 314.487V315C66.0454 314.976 65.7549 314.958 65.4814 314.949C65.2129 314.934 64.9785 314.927 64.7783 314.927C64.5879 314.927 64.3682 314.932 64.1191 314.941C63.8701 314.951 63.5454 314.968 63.145 314.993V314.487C63.1743 314.487 63.2158 314.49 63.2695 314.495C63.3232 314.5 63.3623 314.502 63.3867 314.502C63.7236 314.502 63.9507 314.414 64.0679 314.238C64.1851 314.058 64.2437 313.538 64.2437 312.678V312.136L64.2729 306.628V305.369C64.2729 305.159 64.2266 305.002 64.1338 304.9C64.0459 304.792 63.9116 304.739 63.731 304.739C63.6626 304.739 63.5503 304.753 63.394 304.783C63.355 304.792 63.3281 304.797 63.3135 304.797L63.2036 304.321C63.604 304.243 63.9971 304.153 64.3828 304.05C64.7686 303.943 65.1543 303.818 65.54 303.677ZM81.3604 303.494L81.7339 303.882C80.8306 304.883 80.147 305.957 79.6831 307.104C79.2192 308.252 78.9873 309.443 78.9873 310.679C78.9873 311.914 79.2192 313.083 79.6831 314.187C80.147 315.291 80.8501 316.357 81.7925 317.388L81.4043 317.834C80.1787 316.887 79.2632 315.813 78.6577 314.612C78.0571 313.411 77.7568 312.061 77.7568 310.562C77.7568 309.16 78.062 307.859 78.6724 306.658C79.2876 305.457 80.1836 304.402 81.3604 303.494ZM88.8896 312.437L91.0063 307.632L91.0942 307.434C91.7925 305.857 92.1416 304.924 92.1416 304.636C92.1416 304.626 92.1392 304.612 92.1343 304.592C92.1294 304.573 92.127 304.558 92.127 304.548C92.415 304.563 92.6738 304.575 92.9033 304.585C93.1377 304.59 93.3452 304.592 93.5259 304.592C93.6968 304.592 93.8945 304.59 94.1191 304.585C94.3438 304.575 94.5903 304.563 94.8589 304.548V305.054H94.771C94.3462 305.054 94.0532 305.127 93.8921 305.273C93.7358 305.42 93.6577 305.681 93.6577 306.057C93.6577 306.204 93.6675 306.531 93.687 307.039C93.7065 307.546 93.731 308.096 93.7603 308.687L93.8848 310.745L93.8921 310.942C93.9995 312.769 94.0825 313.801 94.1411 314.041C94.1704 314.182 94.2607 314.292 94.4121 314.37C94.5635 314.448 94.7612 314.487 95.0054 314.487H95.1885V315C94.8027 314.98 94.4438 314.966 94.1118 314.956C93.7798 314.946 93.5039 314.941 93.2842 314.941C93.0254 314.941 92.7349 314.946 92.4126 314.956C92.0903 314.966 91.7461 314.98 91.3799 315V314.473C91.4238 314.473 91.48 314.475 91.5483 314.48C91.6167 314.485 91.6655 314.487 91.6948 314.487C92.0659 314.487 92.3223 314.421 92.4639 314.29C92.6104 314.158 92.6836 313.918 92.6836 313.572C92.6836 313.411 92.6812 313.252 92.6763 313.096C92.6714 312.939 92.6641 312.778 92.6543 312.612L92.3687 306.313L89.3657 313.22C89.3608 313.23 89.3511 313.252 89.3364 313.286C89.1021 313.77 88.9287 314.285 88.8164 314.832H88.333C88.2646 314.529 88.0938 314.065 87.8203 313.44L87.791 313.374L84.8394 306.687C84.8101 307.209 84.7686 307.927 84.7148 308.84C84.5781 311.106 84.5098 312.524 84.5098 313.096V313.169C84.5098 313.789 84.5781 314.165 84.7148 314.297C84.8564 314.424 85.1421 314.487 85.5718 314.487H85.7256V315C85.4082 314.98 85.103 314.966 84.8101 314.956C84.522 314.946 84.2412 314.941 83.9678 314.941C83.7725 314.941 83.5283 314.946 83.2354 314.956C82.9473 314.966 82.6372 314.98 82.3052 315V314.487H82.5103C82.7886 314.487 82.9961 314.453 83.1328 314.385C83.2695 314.316 83.377 314.197 83.4551 314.026C83.5479 313.826 83.6431 313.015 83.7407 311.594C83.7651 311.204 83.7871 310.894 83.8066 310.664L83.9385 308.892V308.87C84.0703 307.117 84.1362 306.121 84.1362 305.881C84.1362 305.574 84.0605 305.359 83.9092 305.237C83.7627 305.115 83.4819 305.054 83.0669 305.054H82.9497V304.548C82.9888 304.548 83.0522 304.551 83.1401 304.556C83.7065 304.59 84.1021 304.607 84.3267 304.607C84.4976 304.607 84.8223 304.592 85.3008 304.563C85.4521 304.553 85.5669 304.548 85.645 304.548V304.592C85.645 305.027 86.4727 307.078 88.1279 310.745L88.8896 312.437ZM96.4336 303.494C97.6055 304.402 98.4966 305.459 99.1069 306.665C99.7173 307.866 100.022 309.165 100.022 310.562C100.022 312.061 99.7222 313.413 99.1216 314.619C98.521 315.82 97.6104 316.892 96.3896 317.834L96.0015 317.388C96.9438 316.362 97.647 315.303 98.1108 314.209C98.5747 313.11 98.8066 311.963 98.8066 310.767C98.8066 309.487 98.5771 308.274 98.1182 307.126C97.6592 305.979 96.9731 304.897 96.0601 303.882L96.4336 303.494Z" fill="black"></path>
<path d="M130.5 256H113.5V364.5H130.5" stroke="black"></path>
<defs>
<clipPath id="clip0_249_8276-matmul-1-svg">
<rect width="143" height="143" fill="white" transform="translate(145 236)"></rect>
</clipPath>
<clipPath id="clip1_249_8276-matmul-1-svg">
<rect x="318" y="236" width="143" height="143" rx="2" fill="white"></rect>
</clipPath>
<clipPath id="clip2_249_8276-matmul-1-svg">
<rect width="143" height="143" fill="white" transform="translate(461 63) rotate(90)"></rect>
</clipPath>
</defs>
</svg>

<figcaption><b>Data Parallel Matmul</b> Similar to RMSNorm, the standard parallelism strategy for matmuls is a "data-parallel" strategy, keeping the entire reduction in one core. It is most straightforward to think about splitting the output tensor into 2D tiles and assigning each tile to a different core. Each core then computes the dot products that belong to that tile, once again performing the entire reduction within one core.
<p>Unlike for RMSNorm, additional constraints around arithmetic intensity and utilizing tensorcores force us to split 2D tiles instead of individual output elements for efficient matmul kernels.</p>
</figcaption>
</figure>
<p>At its core, you can view matrix multiplication as simply a pointwise operation followed by a reduction. Then, if we parallelize our matrix multiplication by chunking the <strong>output</strong> into tiles, we have an analogous “data-parallel” kernel strategy that keeps each reduction within one core.</p>
<p>Also similar to RMSNorm, it is possible for our “batch” dimensions (M and N) to become too small, forcing us to split along the reduction dimension (K). Despite having two “batch” dimensions, matmuls also require us to have much more “work” per core in order to leverage tensorcores effectively. For example, if you have a [1024, K] x [K, 1024] matmul and a standard 2D tile size of [128, 128], a data-parallel strategy would only be able to split this matmul into 64 cores, insufficient to saturate the GPU.</p>
<p>Splitting along the reduction dimension in a matmul is known as a <a href="https://github.com/NVIDIA/cutlass/blob/main/media/docs/cpp/efficient_gemm.md#parallelized-reductions">Split-K Matmul</a>. And just like RMSNorm, using this strategy breaks batch invariance.
<label for="sn10"></label><span>
Another interesting parallelism strategy for matmuls is stream-k. Stream-k is interesting because it has even <i>less</i> invariance than typical matmuls. As discussed, most matmul libraries are not batch-invariant, but they’re at least what you could call batch-position-invariant (i.e. changing the position of the element <em>within</em> the batch does not affect numerics). However, stream-k is not batch-position-invariant either! Its core insight is that you can get cleaner load-balancing by splitting along k in different ways for different output tiles, but taking advantage of this makes our kernel not batch-position-invariant either. </span></p>
<figure>
<svg width="527" height="342" viewBox="0 0 527 342" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="527" height="342" fill="#F5F5F5"></rect>
<rect width="527" height="342" fill="white"></rect>
<rect x="145" y="236" width="35" height="35" fill="#DFE2E7"></rect>
<rect x="181" y="236" width="35" height="35" fill="#DFE2E7"></rect>
<rect x="217" y="236" width="35" height="35" fill="#ECEEF1"></rect>
<rect x="253" y="236" width="35" height="35" fill="#ECEEF1"></rect>
<rect x="461" y="63" width="35" height="35" transform="rotate(90 461 63)" fill="#EA3B40"></rect>
<rect x="461" y="99" width="35" height="35" transform="rotate(90 461 99)" fill="#EA3B40"></rect>
<rect opacity="0.7" x="461" y="135" width="35" height="35" transform="rotate(90 461 135)" fill="#EA3B40"></rect>
<rect opacity="0.7" x="461" y="171" width="35" height="35" transform="rotate(90 461 171)" fill="#EA3B40"></rect>
<rect x="425" y="63" width="35" height="35" transform="rotate(90 425 63)" fill="#C35980"></rect>
<rect x="425" y="99" width="35" height="35" transform="rotate(90 425 99)" fill="#C35980"></rect>
<rect opacity="0.7" x="425" y="135" width="35" height="35" transform="rotate(90 425 135)" fill="#C35980"></rect>
<rect opacity="0.7" x="425" y="171" width="35" height="35" transform="rotate(90 425 171)" fill="#C35980"></rect>
<rect x="389" y="63" width="35" height="35" transform="rotate(90 389 63)" fill="#856AD1"></rect>
<rect x="389" y="99" width="35" height="35" transform="rotate(90 389 99)" fill="#856AD1"></rect>
<rect opacity="0.7" x="389" y="135" width="35" height="35" transform="rotate(90 389 135)" fill="#856AD1"></rect>
<rect opacity="0.7" x="389" y="171" width="35" height="35" transform="rotate(90 389 171)" fill="#856AD1"></rect>
<rect x="353" y="63" width="35" height="35" transform="rotate(90 353 63)" fill="#160E8A"></rect>
<rect x="353" y="99" width="35" height="35" transform="rotate(90 353 99)" fill="#160E8A"></rect>
<rect opacity="0.7" x="353" y="135" width="35" height="35" transform="rotate(90 353 135)" fill="#160E8A"></rect>
<rect opacity="0.7" x="353" y="171" width="35" height="35" transform="rotate(90 353 171)" fill="#160E8A"></rect>
<path d="M231.398 307.137C231.462 307.146 231.528 307.151 231.596 307.151C231.665 307.151 231.767 307.151 231.904 307.151C232.939 307.151 233.752 306.934 234.343 306.5C234.938 306.065 235.236 305.474 235.236 304.727C235.236 304.058 235.053 303.55 234.687 303.204C234.321 302.857 233.789 302.684 233.09 302.684C232.983 302.684 232.849 302.688 232.688 302.698C232.531 302.708 232.355 302.723 232.16 302.742C231.955 303.885 231.792 304.8 231.669 305.489C231.552 306.177 231.462 306.727 231.398 307.137ZM228.308 311.517H228.593C228.896 311.517 229.111 311.431 229.238 311.26C229.37 311.084 229.504 310.601 229.641 309.81L230.703 303.482C230.717 303.409 230.729 303.34 230.739 303.277C230.749 303.213 230.754 303.162 230.754 303.123C230.754 302.923 230.686 302.776 230.549 302.684C230.417 302.586 230.214 302.537 229.941 302.537H229.743L229.838 301.995C230.146 302.024 230.427 302.046 230.681 302.061C230.935 302.076 231.164 302.083 231.369 302.083C231.687 302.083 232.109 302.068 232.636 302.039C233.168 302.01 233.54 301.995 233.75 301.995C234.648 301.995 235.349 302.203 235.852 302.618C236.359 303.028 236.613 303.594 236.613 304.317C236.613 305.005 236.394 305.611 235.954 306.133C235.515 306.651 234.87 307.071 234.021 307.393L235.134 309.51C235.163 309.573 235.209 309.668 235.273 309.795C235.893 311.006 236.555 311.612 237.258 311.612C237.282 311.612 237.319 311.609 237.368 311.604C237.421 311.6 237.46 311.597 237.485 311.597L237.397 312.088C237.172 312.127 236.984 312.154 236.833 312.168C236.682 312.188 236.55 312.198 236.438 312.198C235.993 312.198 235.615 312.117 235.302 311.956C234.99 311.79 234.733 311.539 234.533 311.202C234.392 310.972 234.128 310.447 233.742 309.627C233.361 308.807 233.054 308.157 232.819 307.679C232.663 307.693 232.504 307.706 232.343 307.715C232.187 307.72 232.026 307.723 231.86 307.723C231.796 307.723 231.701 307.72 231.574 307.715C231.452 307.71 231.357 307.708 231.289 307.708L230.871 310.469C230.856 310.572 230.844 310.662 230.834 310.74C230.83 310.813 230.827 310.875 230.827 310.923C230.827 311.163 230.878 311.321 230.981 311.399C231.088 311.478 231.311 311.517 231.647 311.517H231.816L231.721 312C231.56 311.995 231.333 311.985 231.04 311.971C230.468 311.951 230.102 311.941 229.941 311.941C229.692 311.941 229.252 311.956 228.623 311.985C228.452 311.99 228.315 311.995 228.212 312L228.308 311.517ZM239.858 308.697L239.931 308.66C241.669 307.771 242.539 307.085 242.539 306.602C242.539 306.343 242.446 306.119 242.26 305.928C242.075 305.738 241.857 305.643 241.608 305.643C241.223 305.643 240.876 305.909 240.568 306.441C240.261 306.973 240.024 307.725 239.858 308.697ZM242.062 308.191L239.821 309.349V309.422C239.821 310.003 239.912 310.445 240.092 310.748C240.278 311.05 240.544 311.202 240.891 311.202C241.096 311.202 241.352 311.111 241.66 310.931C241.972 310.745 242.37 310.447 242.854 310.037L243.11 310.499C242.412 311.143 241.855 311.59 241.44 311.839C241.03 312.088 240.656 312.212 240.319 312.212C239.807 312.212 239.392 311.99 239.074 311.546C238.757 311.102 238.598 310.518 238.598 309.795C238.598 309.283 238.681 308.733 238.847 308.147C239.018 307.557 239.238 307.042 239.506 306.602C239.843 306.065 240.229 305.65 240.664 305.357C241.098 305.064 241.547 304.917 242.011 304.917C242.485 304.917 242.88 305.069 243.198 305.372C243.52 305.669 243.681 306.033 243.681 306.463C243.681 306.81 243.583 307.098 243.388 307.327C243.198 307.552 242.756 307.84 242.062 308.191ZM248.405 309.378L248.955 306.06C248.686 305.904 248.447 305.792 248.237 305.723C248.027 305.65 247.832 305.613 247.651 305.613C247.05 305.613 246.545 305.999 246.135 306.771C245.725 307.537 245.52 308.494 245.52 309.642C245.52 310.105 245.573 310.457 245.681 310.696C245.793 310.936 245.957 311.055 246.171 311.055C246.318 311.055 246.589 310.906 246.984 310.608C247.385 310.311 247.858 309.9 248.405 309.378ZM248.42 310.125L247.175 311.253C246.809 311.585 246.516 311.814 246.296 311.941C246.081 312.068 245.878 312.132 245.688 312.132C245.249 312.132 244.912 311.946 244.677 311.575C244.443 311.199 244.326 310.66 244.326 309.957C244.326 308.57 244.675 307.378 245.373 306.382C246.076 305.386 246.911 304.888 247.878 304.888C248.073 304.888 248.271 304.915 248.471 304.969C248.676 305.018 248.889 305.091 249.108 305.188L249.526 302.537C249.541 302.435 249.55 302.332 249.555 302.229C249.565 302.122 249.57 302.015 249.57 301.907C249.57 301.712 249.531 301.578 249.453 301.504C249.375 301.431 249.23 301.395 249.021 301.395C248.957 301.395 248.891 301.397 248.823 301.402C248.759 301.402 248.688 301.404 248.61 301.409L248.581 300.977C248.986 300.938 249.394 300.884 249.804 300.816C250.219 300.748 250.637 300.665 251.057 300.567C250.603 302.911 250.229 305.027 249.936 306.917C249.643 308.802 249.497 309.947 249.497 310.352C249.497 310.601 249.519 310.777 249.562 310.879C249.611 310.977 249.689 311.026 249.797 311.026C249.855 311.026 249.924 311.001 250.002 310.953C250.085 310.904 250.188 310.823 250.31 310.711L250.756 310.308L250.998 310.726L250.156 311.553C249.863 311.836 249.65 312.017 249.519 312.095C249.387 312.173 249.26 312.212 249.138 312.212C248.879 312.212 248.688 312.09 248.566 311.846C248.449 311.602 248.391 311.224 248.391 310.711C248.391 310.599 248.393 310.499 248.398 310.411C248.403 310.318 248.41 310.223 248.42 310.125ZM258.491 310.77L257.48 311.714C257.299 311.89 257.136 312.015 256.989 312.088C256.848 312.161 256.701 312.198 256.55 312.198C256.33 312.198 256.152 312.093 256.015 311.883C255.883 311.668 255.817 311.382 255.817 311.026C255.817 310.923 255.825 310.801 255.839 310.66C255.859 310.513 255.896 310.286 255.949 309.979C255.046 310.901 254.406 311.502 254.03 311.78C253.654 312.059 253.334 312.198 253.071 312.198C252.792 312.198 252.561 312.068 252.375 311.81C252.189 311.551 252.097 311.219 252.097 310.813C252.097 310.472 252.243 309.703 252.536 308.506C252.609 308.223 252.663 308.008 252.697 307.862C252.8 307.457 252.875 307.132 252.924 306.888C252.973 306.639 252.998 306.453 252.998 306.331C252.998 306.233 252.973 306.155 252.924 306.097C252.875 306.033 252.814 306.001 252.741 306.001C252.692 306.001 252.597 306.036 252.456 306.104C252.314 306.172 252.119 306.277 251.87 306.419L251.665 306.016C252.119 305.679 252.517 305.418 252.858 305.232C253.2 305.042 253.442 304.947 253.583 304.947C253.784 304.947 253.94 305.032 254.052 305.203C254.169 305.374 254.228 305.611 254.228 305.914C254.228 306.294 254.077 307.032 253.774 308.125C253.476 309.219 253.327 310.04 253.327 310.586C253.327 310.757 253.356 310.884 253.415 310.967C253.474 311.045 253.564 311.084 253.686 311.084C253.823 311.084 254.055 310.95 254.382 310.682C254.714 310.408 255.268 309.888 256.044 309.122C256.23 308.243 256.379 307.5 256.491 306.895C256.608 306.285 256.699 305.74 256.762 305.262L258.081 304.947L257.919 305.672C257.641 306.858 257.49 307.52 257.465 307.657L257.29 308.594C257.202 309.039 257.131 309.463 257.077 309.869C257.028 310.274 257.004 310.56 257.004 310.726C257.004 310.838 257.026 310.926 257.07 310.989C257.114 311.053 257.172 311.084 257.246 311.084C257.314 311.084 257.441 311.019 257.626 310.887C257.812 310.755 258.024 310.577 258.264 310.352L258.491 310.77ZM263.793 306.177L263.405 306.558C263.083 306.231 262.824 306.014 262.629 305.906C262.438 305.799 262.243 305.745 262.043 305.745C261.594 305.745 261.203 306.08 260.871 306.749C260.539 307.413 260.373 308.233 260.373 309.209C260.373 309.864 260.458 310.357 260.629 310.689C260.8 311.021 261.052 311.187 261.384 311.187C261.569 311.187 261.823 311.082 262.146 310.872C262.468 310.657 262.807 310.364 263.164 309.993L263.464 310.513C262.897 311.114 262.414 311.548 262.014 311.817C261.613 312.081 261.247 312.212 260.915 312.212C260.388 312.212 259.965 311.983 259.648 311.524C259.335 311.065 259.179 310.445 259.179 309.664C259.179 308.326 259.521 307.198 260.205 306.28C260.893 305.362 261.74 304.903 262.746 304.903C263.112 304.903 263.425 304.981 263.684 305.137C263.947 305.293 264.079 305.472 264.079 305.672C264.079 305.75 264.057 305.828 264.013 305.906C263.974 305.984 263.901 306.075 263.793 306.177ZM267.792 303.24C267.7 303.567 267.57 304.08 267.404 304.778C267.355 304.983 267.319 305.135 267.294 305.232C267.583 305.232 267.875 305.23 268.173 305.225C268.476 305.215 268.793 305.203 269.125 305.188L268.95 305.921C268.818 305.916 268.671 305.914 268.51 305.914C268.349 305.914 268.09 305.914 267.734 305.914H267.148C266.918 306.919 266.748 307.798 266.635 308.55C266.528 309.302 266.474 309.932 266.474 310.44C266.474 310.655 266.508 310.823 266.577 310.945C266.65 311.067 266.75 311.128 266.877 311.128C266.975 311.128 267.128 311.05 267.338 310.894C267.548 310.738 267.834 310.486 268.195 310.14L268.452 310.608C267.749 311.331 267.265 311.792 267.001 311.993C266.738 312.188 266.516 312.286 266.335 312.286C265.998 312.286 265.729 312.127 265.529 311.81C265.329 311.492 265.229 311.06 265.229 310.513C265.229 310.157 265.285 309.646 265.397 308.982C265.51 308.313 265.722 307.278 266.035 305.877C265.957 305.877 265.854 305.879 265.727 305.884C265.605 305.889 265.522 305.892 265.478 305.892H264.973L265.061 305.401C265.285 305.391 265.49 305.352 265.676 305.284C265.866 305.215 266.057 305.108 266.247 304.961C266.291 304.786 266.34 304.603 266.394 304.412C266.452 304.217 266.518 304.012 266.591 303.797L267.792 303.24ZM272.634 310.337L272.89 310.77C272.29 311.39 271.872 311.785 271.638 311.956C271.403 312.127 271.196 312.212 271.015 312.212C270.756 312.212 270.549 312.105 270.393 311.89C270.236 311.67 270.158 311.377 270.158 311.011C270.158 310.552 270.302 309.786 270.59 308.711C270.883 307.637 271.03 306.863 271.03 306.39C271.03 306.268 271 306.17 270.942 306.097C270.883 306.023 270.808 305.987 270.715 305.987C270.637 305.987 270.534 306.019 270.407 306.082C270.28 306.146 270.122 306.243 269.931 306.375L269.711 305.987L270.686 305.276C270.871 305.14 271.032 305.042 271.169 304.983C271.306 304.92 271.435 304.888 271.557 304.888C271.787 304.888 271.967 304.983 272.099 305.174C272.236 305.359 272.304 305.616 272.304 305.943C272.304 306.299 272.177 306.998 271.923 308.038C271.865 308.272 271.821 308.448 271.792 308.565C271.655 309.117 271.55 309.573 271.477 309.935C271.408 310.296 271.374 310.545 271.374 310.682C271.374 310.804 271.401 310.904 271.455 310.982C271.508 311.06 271.577 311.099 271.66 311.099C271.738 311.099 271.84 311.05 271.967 310.953C272.094 310.855 272.316 310.65 272.634 310.337ZM272.575 300.896L272.993 301.365C273.11 301.487 273.19 301.597 273.234 301.695C273.283 301.788 273.308 301.883 273.308 301.98C273.308 302.083 273.271 302.181 273.198 302.273C273.129 302.366 273.027 302.454 272.89 302.537L272.246 302.896L271.777 302.339C271.679 302.217 271.616 302.122 271.586 302.054C271.557 301.98 271.542 301.905 271.542 301.827C271.542 301.714 271.572 301.617 271.63 301.534C271.689 301.446 271.789 301.36 271.931 301.277L272.575 300.896ZM277.167 305.628C276.601 305.628 276.113 306.016 275.703 306.792C275.292 307.569 275.087 308.526 275.087 309.664C275.087 310.264 275.19 310.723 275.395 311.041C275.605 311.358 275.908 311.517 276.303 311.517C276.899 311.517 277.404 311.136 277.819 310.374C278.239 309.607 278.449 308.67 278.449 307.562C278.449 306.902 278.344 306.417 278.134 306.104C277.924 305.787 277.602 305.628 277.167 305.628ZM277.482 304.917C278.21 304.917 278.762 305.145 279.138 305.599C279.519 306.048 279.709 306.707 279.709 307.576C279.709 308.074 279.611 308.606 279.416 309.173C279.221 309.734 278.957 310.242 278.625 310.696C278.269 311.185 277.863 311.561 277.409 311.824C276.96 312.083 276.486 312.212 275.988 312.212C275.334 312.212 274.812 311.976 274.421 311.502C274.035 311.028 273.842 310.394 273.842 309.598C273.842 309.007 273.938 308.431 274.128 307.869C274.318 307.308 274.592 306.8 274.948 306.346C275.3 305.892 275.698 305.54 276.142 305.291C276.591 305.042 277.038 304.917 277.482 304.917ZM282.888 307.02L284.074 305.862C284.489 305.467 284.802 305.206 285.012 305.079C285.227 304.952 285.429 304.888 285.62 304.888C285.942 304.888 286.203 305.03 286.403 305.313C286.608 305.596 286.711 305.97 286.711 306.434C286.711 306.907 286.591 307.64 286.352 308.631C286.113 309.617 285.993 310.32 285.993 310.74C285.993 310.867 286.018 310.965 286.066 311.033C286.115 311.097 286.186 311.128 286.279 311.128C286.323 311.128 286.376 311.111 286.44 311.077C286.508 311.038 286.574 310.987 286.638 310.923L287.194 310.381L287.451 310.77L286.652 311.583C286.462 311.778 286.271 311.932 286.081 312.044C285.896 312.156 285.732 312.212 285.59 312.212C285.346 312.212 285.146 312.107 284.99 311.897C284.838 311.683 284.763 311.402 284.763 311.055C284.763 310.64 284.887 309.91 285.136 308.865C285.385 307.815 285.51 307.051 285.51 306.573C285.51 306.392 285.471 306.248 285.393 306.141C285.319 306.028 285.219 305.972 285.092 305.972C284.902 305.972 284.318 306.424 283.342 307.327C283.083 307.566 282.88 307.754 282.734 307.891L282.272 310.469C282.263 310.518 282.248 310.591 282.229 310.689C282.126 311.211 282.065 311.612 282.045 311.89L280.742 312.212C281.064 310.811 281.318 309.593 281.503 308.558C281.694 307.522 281.789 306.844 281.789 306.521C281.789 306.326 281.767 306.187 281.723 306.104C281.679 306.016 281.608 305.972 281.511 305.972C281.452 305.972 281.354 306.006 281.218 306.075C281.086 306.143 280.917 306.243 280.712 306.375L280.515 305.987C280.568 305.943 280.646 305.879 280.749 305.796C281.501 305.191 282.004 304.888 282.258 304.888C282.502 304.888 282.683 304.981 282.8 305.167C282.917 305.347 282.976 305.63 282.976 306.016C282.976 306.153 282.968 306.307 282.954 306.478C282.939 306.648 282.917 306.829 282.888 307.02Z" fill="black"></path>
<path d="M288.354 291.354C288.549 291.158 288.549 290.842 288.354 290.646L285.172 287.464C284.976 287.269 284.66 287.269 284.464 287.464C284.269 287.66 284.269 287.976 284.464 288.172L287.293 291L284.464 293.828C284.269 294.024 284.269 294.34 284.464 294.536C284.66 294.731 284.976 294.731 285.172 294.536L288.354 291.354ZM152 291V291.5H288V291V290.5H152V291Z" fill="black"></path>
<path d="M480.65 206.354C480.846 206.549 481.162 206.549 481.357 206.354L484.539 203.172C484.735 202.976 484.735 202.66 484.539 202.464C484.344 202.269 484.028 202.269 483.832 202.464L481.004 205.293L478.175 202.464C477.98 202.269 477.664 202.269 477.468 202.464C477.273 202.66 477.273 202.976 477.468 203.172L480.65 206.354ZM481.004 90L480.504 90L480.504 206L481.004 206L481.504 206L481.504 90L481.004 90Z" fill="black"></path>
<path d="M383.318 18.5483C383.547 18.5679 383.77 18.5825 383.984 18.5923C384.204 18.6021 384.419 18.6069 384.629 18.6069C384.785 18.6069 384.968 18.6021 385.178 18.5923C385.388 18.5825 385.615 18.5679 385.859 18.5483C385.923 18.7095 386.011 18.8755 386.123 19.0464C386.235 19.2173 386.377 19.4053 386.548 19.6104L392.59 26.7588C392.576 26.0166 392.561 25.0327 392.546 23.8071C392.507 21.2339 392.463 19.8496 392.415 19.6543C392.356 19.4297 392.251 19.2734 392.1 19.1855C391.953 19.0977 391.711 19.0537 391.375 19.0537H391.147V18.5483C391.206 18.5483 391.294 18.5508 391.411 18.5557C392.104 18.5898 392.593 18.6069 392.876 18.6069C393.164 18.6069 393.667 18.5898 394.385 18.5557C394.487 18.5508 394.565 18.5483 394.619 18.5483L394.612 19.0537C394.583 19.0488 394.551 19.0464 394.517 19.0464C394.482 19.0415 394.436 19.0391 394.377 19.0391C393.723 19.0391 393.391 19.9497 393.381 21.771C393.376 22.23 393.374 22.5889 393.374 22.8477L393.345 24.7959C393.335 25.084 393.328 25.3818 393.323 25.6895C393.323 25.9922 393.323 26.4097 393.323 26.9419C393.323 27.5327 393.33 27.9941 393.345 28.3262C393.359 28.6533 393.384 28.917 393.418 29.1172H392.605C392.522 28.9219 392.227 28.5312 391.719 27.9453L391.646 27.8574L385.361 20.4673V20.6357C385.391 25.2061 385.439 27.623 385.508 27.8867C385.566 28.1113 385.669 28.2676 385.815 28.3555C385.967 28.4434 386.206 28.4873 386.533 28.4873H386.753V29C386.68 28.9951 386.572 28.9902 386.431 28.9854C385.747 28.9561 385.281 28.9414 385.032 28.9414C384.792 28.9414 384.526 28.9463 384.233 28.9561C383.945 28.9658 383.64 28.9805 383.318 29V28.4946C383.347 28.4946 383.379 28.4971 383.413 28.502C383.452 28.502 383.501 28.502 383.56 28.502C384.214 28.502 384.546 27.5962 384.556 25.7847C384.561 25.3257 384.563 24.9668 384.563 24.708L384.6 22.7598C384.604 22.3398 384.607 21.9321 384.607 21.5366C384.612 21.1362 384.614 20.6797 384.614 20.167C384.614 19.7471 384.534 19.4565 384.373 19.2954C384.211 19.1343 383.926 19.0537 383.516 19.0537H383.318V18.5483Z" fill="black"></path>
<path d="M337 53V38.5H440V53" stroke="black"></path>
<path d="M64.2832 253.236C64.3955 253.246 64.5151 253.253 64.6421 253.258C64.7739 253.258 64.9692 253.258 65.228 253.258C65.5063 253.258 65.7627 253.253 65.9971 253.243C66.2363 253.233 66.4658 253.216 66.6855 253.192C67.042 252.938 67.3105 252.652 67.4912 252.335C67.6719 252.013 67.7622 251.659 67.7622 251.273C67.7622 250.653 67.5645 250.165 67.1689 249.808C66.7734 249.447 66.2314 249.266 65.543 249.266C65.3916 249.266 65.2158 249.276 65.0156 249.295C64.8203 249.315 64.5981 249.344 64.3491 249.383C64.3345 250.038 64.3198 250.797 64.3052 251.661C64.2954 252.525 64.2881 253.05 64.2832 253.236ZM64.2979 258.048C64.5811 258.131 64.8594 258.194 65.1328 258.238C65.4062 258.277 65.6724 258.297 65.9312 258.297C66.7319 258.297 67.3521 258.102 67.7915 257.711C68.231 257.32 68.4507 256.776 68.4507 256.078C68.4507 255.335 68.2041 254.786 67.7109 254.43C67.2178 254.068 66.4609 253.888 65.4404 253.888C65.2744 253.888 65.106 253.89 64.9351 253.895C64.769 253.895 64.5518 253.902 64.2832 253.917C64.2832 254.122 64.2808 254.425 64.2759 254.825C64.271 255.221 64.2686 255.511 64.2686 255.697C64.2686 256 64.271 256.322 64.2759 256.664C64.2808 257 64.2881 257.462 64.2979 258.048ZM61.7051 258.524C61.7393 258.529 61.771 258.534 61.8003 258.539C61.8345 258.539 61.8833 258.539 61.9468 258.539C62.5962 258.539 62.9258 257.625 62.9355 255.799C62.9404 255.34 62.9453 254.981 62.9502 254.723L62.9795 252.723C62.9844 252.293 62.9868 251.876 62.9868 251.471C62.9917 251.065 62.9941 250.626 62.9941 250.152C62.9941 249.732 62.916 249.442 62.7598 249.281C62.6035 249.12 62.3252 249.039 61.9248 249.039H61.8662V248.526C62.1787 248.551 62.4839 248.568 62.7817 248.578C63.0845 248.587 63.3896 248.592 63.6973 248.592C64.0391 248.592 64.459 248.583 64.957 248.563C65.4551 248.539 65.7798 248.526 65.9312 248.526C66.937 248.526 67.7305 248.751 68.3115 249.2C68.8975 249.645 69.1904 250.245 69.1904 251.002C69.1904 251.534 69.0464 251.996 68.7583 252.386C68.4751 252.772 68.0039 253.146 67.3447 253.507C68.2041 253.673 68.8462 253.966 69.271 254.386C69.6958 254.806 69.9082 255.36 69.9082 256.048C69.9082 256.942 69.5542 257.662 68.8462 258.209C68.1382 258.756 67.1934 259.029 66.0117 259.029C65.7969 259.029 65.394 259.017 64.8032 258.993C64.2124 258.968 63.7241 258.956 63.3384 258.956C63.1772 258.956 62.9526 258.961 62.6646 258.971C62.3813 258.98 62.0615 258.995 61.7051 259.015V258.524ZM77.5181 257.938L77.7231 258.399C77.3569 258.663 77.0225 258.866 76.7197 259.007C76.417 259.154 76.1729 259.227 75.9873 259.227C75.6748 259.227 75.4404 259.137 75.2842 258.956C75.1279 258.771 75.0425 258.492 75.0278 258.121C74.4956 258.478 74.0537 258.734 73.7021 258.89C73.3506 259.042 73.0356 259.117 72.7573 259.117C72.2642 259.117 71.8516 258.932 71.5195 258.561C71.1875 258.189 71.0215 257.735 71.0215 257.198C71.0215 256.285 72.0054 255.597 73.9731 255.133C74.437 255.025 74.7983 254.94 75.0571 254.876C75.0571 254.793 75.0596 254.674 75.0645 254.518C75.0791 254.195 75.0864 253.985 75.0864 253.888C75.0864 253.38 74.9814 253.006 74.7715 252.767C74.5615 252.523 74.2417 252.401 73.812 252.401C73.3921 252.401 73.0601 252.479 72.8159 252.635C72.5767 252.787 72.457 252.994 72.457 253.258C72.457 253.282 72.4595 253.316 72.4644 253.36C72.4692 253.399 72.4717 253.429 72.4717 253.448C72.4717 253.6 72.3984 253.727 72.252 253.829C72.1055 253.927 71.9297 253.976 71.7246 253.976C71.5488 253.976 71.4194 253.946 71.3364 253.888C71.2534 253.829 71.2119 253.739 71.2119 253.617C71.2119 253.226 71.5415 252.792 72.2007 252.313C72.8599 251.83 73.541 251.588 74.2441 251.588C74.9229 251.588 75.438 251.776 75.7896 252.152C76.1411 252.523 76.3169 253.07 76.3169 253.792C76.3169 254.183 76.2925 254.784 76.2437 255.594C76.1997 256.405 76.1777 257.02 76.1777 257.44C76.1777 257.757 76.2119 257.972 76.2803 258.084C76.3535 258.197 76.4805 258.253 76.6611 258.253C76.7393 258.253 76.8394 258.231 76.9614 258.187C77.0884 258.138 77.2739 258.055 77.5181 257.938ZM75.0205 255.462C74.9277 255.487 74.7886 255.523 74.603 255.572C73.0161 256.007 72.2227 256.52 72.2227 257.11C72.2227 257.433 72.3252 257.696 72.5303 257.901C72.7354 258.102 73.0063 258.202 73.3433 258.202C73.5483 258.202 73.7852 258.148 74.0537 258.041C74.3223 257.933 74.6348 257.762 74.9912 257.528L75.0205 255.462ZM80.0083 250.423L80.4917 250.57C80.4624 250.838 80.438 251.08 80.4185 251.295C80.4038 251.505 80.394 251.712 80.3892 251.917H80.9092C81.1875 251.917 81.4707 251.915 81.7588 251.91C82.0469 251.9 82.3374 251.888 82.6304 251.874L82.4546 252.672C82.1421 252.647 81.8467 252.633 81.5684 252.628C81.2949 252.618 81.0215 252.613 80.748 252.613H80.4038C80.3745 253.453 80.3525 254.098 80.3379 254.547C80.3281 254.991 80.3232 255.36 80.3232 255.653C80.3232 256.756 80.3989 257.477 80.5503 257.813C80.7017 258.146 80.9727 258.312 81.3633 258.312C81.5244 258.312 81.7026 258.277 81.8979 258.209C82.0981 258.141 82.3398 258.028 82.623 257.872L82.8647 258.355C82.396 258.639 81.9712 258.854 81.5903 259C81.2095 259.142 80.8774 259.212 80.5942 259.212C80.0718 259.212 79.6909 259.034 79.4517 258.678C79.2124 258.316 79.0928 257.738 79.0928 256.942C79.0928 256.786 79.1025 256.229 79.1221 255.272C79.1465 254.31 79.1587 253.429 79.1587 252.628C79.1147 252.628 79.0513 252.63 78.9683 252.635C78.563 252.65 78.2847 252.657 78.1333 252.657V252.13C78.6118 252.062 79.0073 251.886 79.3198 251.603C79.6323 251.314 79.8618 250.921 80.0083 250.423ZM89.1782 257.557L89.5444 258.114C89.0708 258.475 88.6045 258.749 88.1455 258.934C87.6865 259.12 87.252 259.212 86.8418 259.212C85.8848 259.212 85.1035 258.871 84.498 258.187C83.8926 257.499 83.5898 256.62 83.5898 255.55C83.5898 254.442 83.9731 253.504 84.7397 252.738C85.5063 251.971 86.4414 251.588 87.5449 251.588C88.1113 251.588 88.5483 251.668 88.856 251.83C89.1636 251.986 89.3174 252.206 89.3174 252.489C89.3174 252.694 89.2539 252.872 89.127 253.023C89.0049 253.17 88.8633 253.243 88.7021 253.243C88.6484 253.243 88.4214 253.121 88.021 252.877C87.6255 252.628 87.2471 252.503 86.8857 252.503C86.251 252.503 85.7456 252.733 85.3696 253.192C84.9985 253.646 84.813 254.266 84.813 255.052C84.813 256.043 85.0376 256.817 85.4868 257.374C85.9409 257.926 86.5684 258.202 87.3691 258.202C87.667 258.202 87.9624 258.15 88.2554 258.048C88.5532 257.945 88.8608 257.782 89.1782 257.557ZM92.54 247.677C92.5205 248.497 92.5034 249.334 92.4888 250.189C92.4741 251.043 92.4644 251.92 92.4595 252.818C93.0063 252.403 93.4946 252.098 93.9243 251.903C94.354 251.703 94.7446 251.603 95.0962 251.603C95.814 251.603 96.3535 251.805 96.7148 252.21C97.0762 252.616 97.2568 253.224 97.2568 254.034C97.2568 254.039 97.2544 254.254 97.2495 254.679C97.2446 255.104 97.2422 255.528 97.2422 255.953C97.2422 256.134 97.2397 256.361 97.2349 256.634C97.23 256.903 97.2275 257.086 97.2275 257.184C97.2275 257.73 97.2764 258.087 97.374 258.253C97.4717 258.419 97.6572 258.502 97.9307 258.502C97.9453 258.502 97.9722 258.5 98.0112 258.495C98.0552 258.49 98.0894 258.487 98.1138 258.487V259C97.6694 258.971 97.335 258.951 97.1104 258.941C96.8857 258.932 96.7002 258.927 96.5537 258.927C96.3193 258.927 96.0654 258.934 95.792 258.949C95.5234 258.958 95.2427 258.976 94.9497 259L94.9424 258.487H95.0522C95.6772 258.487 95.9971 257.916 96.0117 256.773C96.0117 256.71 96.0117 256.661 96.0117 256.627L96.0264 255.052V254.752C96.0264 253.863 95.9214 253.275 95.7114 252.987C95.5015 252.694 95.1401 252.547 94.6274 252.547C94.3491 252.547 94.0391 252.616 93.6973 252.752C93.3604 252.889 92.9624 253.106 92.5034 253.404L92.4668 256.012C92.4668 256.158 92.4644 256.346 92.4595 256.576C92.4546 256.805 92.4521 256.964 92.4521 257.052C92.4521 257.657 92.501 258.05 92.5986 258.231C92.6963 258.412 92.8843 258.502 93.1626 258.502C93.1821 258.502 93.2114 258.5 93.2505 258.495C93.2944 258.49 93.3286 258.487 93.353 258.487V259C93.0454 258.976 92.7549 258.958 92.4814 258.949C92.2129 258.934 91.9785 258.927 91.7783 258.927C91.5879 258.927 91.3682 258.932 91.1191 258.941C90.8701 258.951 90.5454 258.968 90.145 258.993V258.487C90.1743 258.487 90.2158 258.49 90.2695 258.495C90.3232 258.5 90.3623 258.502 90.3867 258.502C90.7236 258.502 90.9507 258.414 91.0679 258.238C91.1851 258.058 91.2437 257.538 91.2437 256.678V256.136L91.2729 250.628V249.369C91.2729 249.159 91.2266 249.002 91.1338 248.9C91.0459 248.792 90.9116 248.739 90.731 248.739C90.6626 248.739 90.5503 248.753 90.394 248.783C90.355 248.792 90.3281 248.797 90.3135 248.797L90.2036 248.321C90.604 248.243 90.9971 248.153 91.3828 248.05C91.7686 247.943 92.1543 247.818 92.54 247.677ZM108.36 247.494L108.734 247.882C107.831 248.883 107.147 249.957 106.683 251.104C106.219 252.252 105.987 253.443 105.987 254.679C105.987 255.914 106.219 257.083 106.683 258.187C107.147 259.291 107.85 260.357 108.792 261.388L108.404 261.834C107.179 260.887 106.263 259.813 105.658 258.612C105.057 257.411 104.757 256.061 104.757 254.562C104.757 253.16 105.062 251.859 105.672 250.658C106.288 249.457 107.184 248.402 108.36 247.494ZM115.89 256.437L118.006 251.632L118.094 251.434C118.792 249.857 119.142 248.924 119.142 248.636C119.142 248.626 119.139 248.612 119.134 248.592C119.129 248.573 119.127 248.558 119.127 248.548C119.415 248.563 119.674 248.575 119.903 248.585C120.138 248.59 120.345 248.592 120.526 248.592C120.697 248.592 120.895 248.59 121.119 248.585C121.344 248.575 121.59 248.563 121.859 248.548V249.054H121.771C121.346 249.054 121.053 249.127 120.892 249.273C120.736 249.42 120.658 249.681 120.658 250.057C120.658 250.204 120.667 250.531 120.687 251.039C120.707 251.546 120.731 252.096 120.76 252.687L120.885 254.745L120.892 254.942C121 256.769 121.083 257.801 121.141 258.041C121.17 258.182 121.261 258.292 121.412 258.37C121.563 258.448 121.761 258.487 122.005 258.487H122.188V259C121.803 258.98 121.444 258.966 121.112 258.956C120.78 258.946 120.504 258.941 120.284 258.941C120.025 258.941 119.735 258.946 119.413 258.956C119.09 258.966 118.746 258.98 118.38 259V258.473C118.424 258.473 118.48 258.475 118.548 258.48C118.617 258.485 118.666 258.487 118.695 258.487C119.066 258.487 119.322 258.421 119.464 258.29C119.61 258.158 119.684 257.918 119.684 257.572C119.684 257.411 119.681 257.252 119.676 257.096C119.671 256.939 119.664 256.778 119.654 256.612L119.369 250.313L116.366 257.22C116.361 257.23 116.351 257.252 116.336 257.286C116.102 257.77 115.929 258.285 115.816 258.832H115.333C115.265 258.529 115.094 258.065 114.82 257.44L114.791 257.374L111.839 250.687C111.81 251.209 111.769 251.927 111.715 252.84C111.578 255.106 111.51 256.524 111.51 257.096V257.169C111.51 257.789 111.578 258.165 111.715 258.297C111.856 258.424 112.142 258.487 112.572 258.487H112.726V259C112.408 258.98 112.103 258.966 111.81 258.956C111.522 258.946 111.241 258.941 110.968 258.941C110.772 258.941 110.528 258.946 110.235 258.956C109.947 258.966 109.637 258.98 109.305 259V258.487H109.51C109.789 258.487 109.996 258.453 110.133 258.385C110.27 258.316 110.377 258.197 110.455 258.026C110.548 257.826 110.643 257.015 110.741 255.594C110.765 255.204 110.787 254.894 110.807 254.664L110.938 252.892V252.87C111.07 251.117 111.136 250.121 111.136 249.881C111.136 249.574 111.061 249.359 110.909 249.237C110.763 249.115 110.482 249.054 110.067 249.054H109.95V248.548C109.989 248.548 110.052 248.551 110.14 248.556C110.707 248.59 111.102 248.607 111.327 248.607C111.498 248.607 111.822 248.592 112.301 248.563C112.452 248.553 112.567 248.548 112.645 248.548V248.592C112.645 249.027 113.473 251.078 115.128 254.745L115.89 256.437ZM123.434 247.494C124.605 248.402 125.497 249.459 126.107 250.665C126.717 251.866 127.022 253.165 127.022 254.562C127.022 256.061 126.722 257.413 126.122 258.619C125.521 259.82 124.61 260.892 123.39 261.834L123.001 261.388C123.944 260.362 124.647 259.303 125.111 258.209C125.575 257.11 125.807 255.963 125.807 254.767C125.807 253.487 125.577 252.274 125.118 251.126C124.659 249.979 123.973 248.897 123.06 247.882L123.434 247.494Z" fill="black"></path>
<path d="M164.538 258H157.17V256.865H160.29V248.896H160.173L157.148 250.852V249.475L160.297 247.431H161.564V256.865H164.538V258ZM171.53 253.1V252.016H172.68C173.866 252.016 174.694 251.24 174.694 250.134C174.694 249.057 173.903 248.347 172.709 248.347C171.522 248.347 170.731 249.042 170.629 250.178H169.391C169.516 248.347 170.805 247.211 172.76 247.211C174.65 247.211 175.998 248.347 175.998 249.951C175.998 251.225 175.331 252.133 174.196 252.412V252.529C175.602 252.712 176.437 253.701 176.437 255.144C176.437 256.938 174.928 258.22 172.819 258.22C170.731 258.22 169.281 257.019 169.186 255.195H170.409C170.526 256.323 171.464 257.055 172.782 257.055C174.232 257.055 175.133 256.308 175.133 255.114C175.133 253.884 174.203 253.1 172.738 253.1H171.53ZM185.003 258.212C183.033 258.212 181.642 256.997 181.532 255.18H182.777C182.894 256.286 183.839 257.048 185.077 257.048C186.439 257.048 187.347 256.088 187.347 254.653C187.347 253.203 186.432 252.221 185.077 252.221C184.132 252.221 183.348 252.653 182.931 253.4H181.708L182.242 247.431H188.021V248.596H183.26L182.967 252.045H183.084C183.604 251.416 184.359 251.086 185.289 251.086C187.245 251.086 188.607 252.543 188.607 254.624C188.607 256.762 187.149 258.212 185.003 258.212ZM194.83 258L199.627 248.684V248.588H193.892V247.431H200.945V248.625L196.207 258H194.83Z" fill="black"></path>
<path d="M230.722 250.405C230.722 248.544 232.099 247.211 234.025 247.211C235.966 247.211 237.299 248.413 237.299 250.178C237.299 251.276 236.801 252.155 235.117 253.994L232.626 256.704V256.828H237.468V258H230.781V257.106L234.355 253.129C235.695 251.628 236.018 251.064 236.018 250.229C236.018 249.094 235.219 248.347 233.989 248.347C232.773 248.347 231.967 249.16 231.967 250.405V250.449H230.722V250.405ZM247.602 258V255.766H242.782V254.719L246.371 247.431H247.689L244.152 254.55V254.646H247.616V251.628H248.788V254.631H250.399V255.766H248.781V258H247.602ZM262.262 254.609C262.262 256.704 260.753 258.22 258.658 258.22C256.578 258.22 255.077 256.711 255.077 254.609C255.077 253.371 255.494 252.25 256.505 250.778C256.6 250.617 258.797 247.541 258.871 247.431H260.357L257.472 251.394C257.149 251.848 257.179 251.818 257.127 251.936L257.237 251.994C257.552 251.569 258.314 251.254 258.988 251.254C260.87 251.254 262.262 252.683 262.262 254.609ZM258.666 257.07C259.999 257.07 261.009 256.03 261.009 254.675C261.009 253.312 259.999 252.272 258.666 252.272C257.34 252.272 256.329 253.312 256.329 254.675C256.329 256.03 257.34 257.07 258.666 257.07ZM270.945 258.234C268.748 258.234 267.217 256.975 267.217 255.173C267.217 253.862 268.067 252.792 269.371 252.478V252.36C268.309 252.067 267.642 251.159 267.642 250.009C267.642 248.361 269.019 247.197 270.945 247.197C272.872 247.197 274.241 248.361 274.241 250.009C274.241 251.159 273.589 252.06 272.513 252.36V252.478C273.794 252.749 274.666 253.84 274.666 255.173C274.666 256.975 273.143 258.234 270.945 258.234ZM270.945 251.921C272.168 251.921 272.974 251.203 272.974 250.119C272.974 249.042 272.168 248.325 270.945 248.325C269.722 248.325 268.909 249.042 268.909 250.119C268.909 251.203 269.722 251.921 270.945 251.921ZM270.945 257.114C272.381 257.114 273.37 256.279 273.37 255.07C273.37 253.862 272.381 253.027 270.945 253.027C269.51 253.027 268.521 253.862 268.521 255.07C268.521 256.279 269.51 257.114 270.945 257.114Z" fill="black"></path>
<path d="M318 236H353L335.5 253.5L318 271V236Z" fill="#160E8A"></path>
<path d="M335.5 253.5L353 236V271H318L335.5 253.5Z" fill="#5C56AD"></path>
<path d="M356.498 232L357.205 232.707L318.5 271.5L317.793 270.793L356.498 232Z" fill="white"></path>
<path d="M353.979 236H388.979L371.479 253.5L353.979 271V236Z" fill="#856AD1"></path>
<path d="M371.479 253.5L388.979 236V271H353.979L371.479 253.5Z" fill="#AA97DF"></path>
<rect x="392.477" y="232" width="1" height="70" transform="rotate(45 392.477 232)" fill="white"></rect>
<path d="M389.973 236H424.973L407.473 253.5L389.973 271V236Z" fill="#C35980"></path>
<path d="M407.473 253.5L424.973 236V271H389.973L407.473 253.5Z" fill="#D58BA6"></path>
<rect x="428.471" y="232" width="1" height="70" transform="rotate(45 428.471 232)" fill="white"></rect>
<path d="M425.992 236H460.992L443.492 253.5L425.992 271V236Z" fill="#EA3B40"></path>
<path d="M443.492 253.5L460.992 236V271H425.992L443.492 253.5Z" fill="#F07679"></path>
<rect x="464.49" y="232" width="1" height="70" transform="rotate(45 464.49 232)" fill="white"></rect>
<path d="M329.959 250H323.574V249.016H326.278V242.11H326.176L323.555 243.805V242.611L326.284 240.84H327.382V249.016H329.959V250Z" fill="white"></path>
<path d="M362.383 245.753V244.814H363.379C364.408 244.814 365.125 244.141 365.125 243.183C365.125 242.25 364.439 241.634 363.405 241.634C362.376 241.634 361.691 242.237 361.602 243.221H360.529C360.637 241.634 361.754 240.65 363.449 240.65C365.087 240.65 366.255 241.634 366.255 243.024C366.255 244.128 365.677 244.916 364.693 245.157V245.258C365.912 245.417 366.636 246.274 366.636 247.524C366.636 249.08 365.328 250.19 363.5 250.19C361.691 250.19 360.434 249.149 360.352 247.569H361.412C361.513 248.546 362.326 249.181 363.468 249.181C364.725 249.181 365.506 248.534 365.506 247.499C365.506 246.433 364.7 245.753 363.43 245.753H362.383Z" fill="white"></path>
<path d="M399.424 250.184C397.716 250.184 396.51 249.13 396.415 247.556H397.494C397.596 248.515 398.415 249.175 399.487 249.175C400.668 249.175 401.455 248.343 401.455 247.099C401.455 245.842 400.662 244.992 399.487 244.992C398.668 244.992 397.989 245.366 397.627 246.014H396.567L397.031 240.84H402.039V241.85H397.913L397.659 244.839H397.761C398.211 244.293 398.865 244.008 399.671 244.008C401.366 244.008 402.547 245.271 402.547 247.074C402.547 248.927 401.284 250.184 399.424 250.184Z" fill="white"></path>
<path d="M432.304 250L436.461 241.926V241.843H431.491V240.84H437.604V241.875L433.497 250H432.304Z" fill="white"></path>
<path d="M340.58 258.417C340.58 256.805 341.773 255.65 343.443 255.65C345.125 255.65 346.28 256.691 346.28 258.221C346.28 259.173 345.849 259.935 344.389 261.528L342.23 263.876V263.984H346.426V265H340.631V264.226L343.729 260.779C344.89 259.478 345.169 258.989 345.169 258.265C345.169 257.281 344.478 256.634 343.411 256.634C342.357 256.634 341.659 257.338 341.659 258.417V258.456H340.58V258.417Z" fill="white"></path>
<path d="M379.573 265V263.064H375.396V262.156L378.506 255.84H379.649L376.583 262.01V262.093H379.585V259.478H380.601V262.08H381.998V263.064H380.595V265H379.573Z" fill="white"></path>
<path d="M418.642 262.061C418.642 263.876 417.334 265.19 415.519 265.19C413.716 265.19 412.415 263.883 412.415 262.061C412.415 260.988 412.777 260.017 413.653 258.741C413.735 258.602 415.64 255.936 415.703 255.84H416.992L414.491 259.274C414.211 259.668 414.237 259.643 414.192 259.744L414.288 259.795C414.561 259.427 415.221 259.154 415.805 259.154C417.436 259.154 418.642 260.392 418.642 262.061ZM415.525 264.194C416.681 264.194 417.557 263.292 417.557 262.118C417.557 260.938 416.681 260.036 415.525 260.036C414.376 260.036 413.5 260.938 413.5 262.118C413.5 263.292 414.376 264.194 415.525 264.194Z" fill="white"></path>
<path d="M450.532 265.203C448.627 265.203 447.301 264.111 447.301 262.55C447.301 261.414 448.037 260.487 449.167 260.214V260.112C448.247 259.858 447.669 259.071 447.669 258.075C447.669 256.646 448.862 255.637 450.532 255.637C452.201 255.637 453.388 256.646 453.388 258.075C453.388 259.071 452.823 259.852 451.89 260.112V260.214C453.001 260.449 453.756 261.395 453.756 262.55C453.756 264.111 452.436 265.203 450.532 265.203ZM450.532 259.731C451.592 259.731 452.29 259.109 452.29 258.17C452.29 257.237 451.592 256.615 450.532 256.615C449.472 256.615 448.767 257.237 448.767 258.17C448.767 259.109 449.472 259.731 450.532 259.731ZM450.532 264.232C451.776 264.232 452.633 263.508 452.633 262.461C452.633 261.414 451.776 260.69 450.532 260.69C449.288 260.69 448.431 261.414 448.431 262.461C448.431 263.508 449.288 264.232 450.532 264.232Z" fill="white"></path>
</svg>

<figcaption><b>Split-K Matmul</b> If our batch dimension is fairly small we may not have enough parallelism and require a split-k matmul. In this example, we split each reduction across two cores, which would accumulate separately and then combine their results at the end. However, splitting each reduction across two cores allows us to still leverage eight cores.
</figcaption>
</figure>
<!-- Todo (lowpri): Clean up writing here a bit more -->
<p>There’s an additional complexity with matmuls — tensor core instructions. Whereas with reductions we could simply operate on one row at a time, efficient matrix multiplication kernels must operate on an entire “tile” at a time.</p>
<p>Each tensor-core instruction (like say, <a href="https://docs.nvidia.com/cuda/parallel-thread-execution/#asynchronous-warpgroup-level-matrix-instructions-wgmma-mma"><code>wgmma.mma_async.sync.aligned.m64n128k16</code></a>) may have a different reduction order internally. One reason to use a different tensor-core instruction might be that the batch size is very small. For example, if we use a tensor-core PTX instruction that operates on a tile of length 256 but the batch size is only 32, we’re wasting almost all of that compute! At a batch-size of 1, the fastest kernels usually don’t use tensor cores at all.</p>
<figure>
<svg width="527" height="322" viewBox="0 0 527 322" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="527" height="322" fill="#F5F5F5"></rect>
<rect width="527" height="322" fill="white"></rect>
<rect x="145" y="241" width="35" height="8" fill="#DFE2E7"></rect>
<rect x="145" y="241" width="35" height="8" fill="black" fill-opacity="0.05"></rect>
<rect x="181" y="241" width="35" height="8" fill="#E5E8EC"></rect>
<rect x="181" y="241" width="35" height="8" fill="black" fill-opacity="0.05"></rect>
<rect x="217" y="241" width="35" height="8" fill="#ECEEF1"></rect>
<rect x="217" y="241" width="35" height="8" fill="black" fill-opacity="0.05"></rect>
<rect x="253" y="241" width="35" height="8" fill="#F2F3F5"></rect>
<rect x="253" y="241" width="35" height="8" fill="black" fill-opacity="0.05"></rect>
<rect x="354" y="241" width="35" height="8" fill="#856AD1"></rect>
<g opacity="0.5">
<mask id="path-10-inside-1_249_8276-matmul-2-svg" fill="white">
<path d="M354 241H389V276H354V241Z"></path>
</mask>
<path d="M389 276V276.5H389.5V276H389ZM354 276H353.5V276.5H354V276ZM354 241H353.5V241.972H354H354.5V241H354ZM354 243.917H353.5V245.861H354H354.5V243.917H354ZM354 247.806H353.5V249.75H354H354.5V247.806H354ZM354 251.694H353.5V253.639H354H354.5V251.694H354ZM354 255.583H353.5V257.528H354H354.5V255.583H354ZM354 259.472H353.5V261.417H354H354.5V259.472H354ZM354 263.361H353.5V265.306H354H354.5V263.361H354ZM354 267.25H353.5V269.194H354H354.5V267.25H354ZM354 271.139H353.5V273.083H354H354.5V271.139H354ZM354 275.028H353.5V276H354H354.5V275.028H354ZM354 276V276.5H354.972V276V275.5H354V276ZM356.917 276V276.5H358.861V276V275.5H356.917V276ZM360.806 276V276.5H362.75V276V275.5H360.806V276ZM364.694 276V276.5H366.639V276V275.5H364.694V276ZM368.583 276V276.5H370.528V276V275.5H368.583V276ZM372.472 276V276.5H374.417V276V275.5H372.472V276ZM376.361 276V276.5H378.306V276V275.5H376.361V276ZM380.25 276V276.5H382.194V276V275.5H380.25V276ZM384.139 276V276.5H386.083V276V275.5H384.139V276ZM388.028 276V276.5H389V276V275.5H388.028V276ZM389 276H389.5V275.028H389H388.5V276H389ZM389 273.083H389.5V271.139H389H388.5V273.083H389ZM389 269.194H389.5V267.25H389H388.5V269.194H389ZM389 265.306H389.5V263.361H389H388.5V265.306H389ZM389 261.417H389.5V259.472H389H388.5V261.417H389ZM389 257.528H389.5V255.583H389H388.5V257.528H389ZM389 253.639H389.5V251.694H389H388.5V253.639H389ZM389 249.75H389.5V247.806H389H388.5V249.75H389ZM389 245.861H389.5V243.917H389H388.5V245.861H389ZM389 241.972H389.5V241H389H388.5V241.972H389ZM389 276V277H390V276H389ZM354 276H353V277H354V276ZM354 241H353V241.972H354H355V241H354ZM354 243.917H353V245.861H354H355V243.917H354ZM354 247.806H353V249.75H354H355V247.806H354ZM354 251.694H353V253.639H354H355V251.694H354ZM354 255.583H353V257.528H354H355V255.583H354ZM354 259.472H353V261.417H354H355V259.472H354ZM354 263.361H353V265.306H354H355V263.361H354ZM354 267.25H353V269.194H354H355V267.25H354ZM354 271.139H353V273.083H354H355V271.139H354ZM354 275.028H353V276H354H355V275.028H354ZM354 276V277H354.972V276V275H354V276ZM356.917 276V277H358.861V276V275H356.917V276ZM360.806 276V277H362.75V276V275H360.806V276ZM364.694 276V277H366.639V276V275H364.694V276ZM368.583 276V277H370.528V276V275H368.583V276ZM372.472 276V277H374.417V276V275H372.472V276ZM376.361 276V277H378.306V276V275H376.361V276ZM380.25 276V277H382.194V276V275H380.25V276ZM384.139 276V277H386.083V276V275H384.139V276ZM388.028 276V277H389V276V275H388.028V276ZM389 276H390V275.028H389H388V276H389ZM389 273.083H390V271.139H389H388V273.083H389ZM389 269.194H390V267.25H389H388V269.194H389ZM389 265.306H390V263.361H389H388V265.306H389ZM389 261.417H390V259.472H389H388V261.417H389ZM389 257.528H390V255.583H389H388V257.528H389ZM389 253.639H390V251.694H389H388V253.639H389ZM389 249.75H390V247.806H389H388V249.75H389ZM389 245.861H390V243.917H389H388V245.861H389ZM389 241.972H390V241H389H388V241.972H389Z" fill="#856AD1" mask="url(#path-10-inside-1_249_8276-matmul-2-svg)"></path>
</g>
<rect x="390" y="241" width="35" height="8" fill="#C35980"></rect>
<g opacity="0.5">
<mask id="path-13-inside-2_249_8276-matmul-2-svg" fill="white">
<path d="M390 241H425V276H390V241Z"></path>
</mask>
<path d="M425 276V276.5H425.5V276H425ZM390 276H389.5V276.5H390V276ZM390 241H389.5V241.972H390H390.5V241H390ZM390 243.917H389.5V245.861H390H390.5V243.917H390ZM390 247.806H389.5V249.75H390H390.5V247.806H390ZM390 251.694H389.5V253.639H390H390.5V251.694H390ZM390 255.583H389.5V257.528H390H390.5V255.583H390ZM390 259.472H389.5V261.417H390H390.5V259.472H390ZM390 263.361H389.5V265.306H390H390.5V263.361H390ZM390 267.25H389.5V269.194H390H390.5V267.25H390ZM390 271.139H389.5V273.083H390H390.5V271.139H390ZM390 275.028H389.5V276H390H390.5V275.028H390ZM390 276V276.5H390.972V276V275.5H390V276ZM392.917 276V276.5H394.861V276V275.5H392.917V276ZM396.806 276V276.5H398.75V276V275.5H396.806V276ZM400.694 276V276.5H402.639V276V275.5H400.694V276ZM404.583 276V276.5H406.528V276V275.5H404.583V276ZM408.472 276V276.5H410.417V276V275.5H408.472V276ZM412.361 276V276.5H414.306V276V275.5H412.361V276ZM416.25 276V276.5H418.194V276V275.5H416.25V276ZM420.139 276V276.5H422.083V276V275.5H420.139V276ZM424.028 276V276.5H425V276V275.5H424.028V276ZM425 276H425.5V275.028H425H424.5V276H425ZM425 273.083H425.5V271.139H425H424.5V273.083H425ZM425 269.194H425.5V267.25H425H424.5V269.194H425ZM425 265.306H425.5V263.361H425H424.5V265.306H425ZM425 261.417H425.5V259.472H425H424.5V261.417H425ZM425 257.528H425.5V255.583H425H424.5V257.528H425ZM425 253.639H425.5V251.694H425H424.5V253.639H425ZM425 249.75H425.5V247.806H425H424.5V249.75H425ZM425 245.861H425.5V243.917H425H424.5V245.861H425ZM425 241.972H425.5V241H425H424.5V241.972H425ZM425 276V277H426V276H425ZM390 276H389V277H390V276ZM390 241H389V241.972H390H391V241H390ZM390 243.917H389V245.861H390H391V243.917H390ZM390 247.806H389V249.75H390H391V247.806H390ZM390 251.694H389V253.639H390H391V251.694H390ZM390 255.583H389V257.528H390H391V255.583H390ZM390 259.472H389V261.417H390H391V259.472H390ZM390 263.361H389V265.306H390H391V263.361H390ZM390 267.25H389V269.194H390H391V267.25H390ZM390 271.139H389V273.083H390H391V271.139H390ZM390 275.028H389V276H390H391V275.028H390ZM390 276V277H390.972V276V275H390V276ZM392.917 276V277H394.861V276V275H392.917V276ZM396.806 276V277H398.75V276V275H396.806V276ZM400.694 276V277H402.639V276V275H400.694V276ZM404.583 276V277H406.528V276V275H404.583V276ZM408.472 276V277H410.417V276V275H408.472V276ZM412.361 276V277H414.306V276V275H412.361V276ZM416.25 276V277H418.194V276V275H416.25V276ZM420.139 276V277H422.083V276V275H420.139V276ZM424.028 276V277H425V276V275H424.028V276ZM425 276H426V275.028H425H424V276H425ZM425 273.083H426V271.139H425H424V273.083H425ZM425 269.194H426V267.25H425H424V269.194H425ZM425 265.306H426V263.361H425H424V265.306H425ZM425 261.417H426V259.472H425H424V261.417H425ZM425 257.528H426V255.583H425H424V257.528H425ZM425 253.639H426V251.694H425H424V253.639H425ZM425 249.75H426V247.806H425H424V249.75H425ZM425 245.861H426V243.917H425H424V245.861H425ZM425 241.972H426V241H425H424V241.972H425Z" fill="#C35980" mask="url(#path-13-inside-2_249_8276-matmul-2-svg)"></path>
</g>
<rect x="426" y="241" width="35" height="8" fill="#EA3B40"></rect>
<g opacity="0.5">
<mask id="path-16-inside-3_249_8276-matmul-2-svg" fill="white">
<path d="M426 241H461V276H426V241Z"></path>
</mask>
<path d="M461 276V276.5H461.5V276H461ZM426 276H425.5V276.5H426V276ZM426 241H425.5V241.972H426H426.5V241H426ZM426 243.917H425.5V245.861H426H426.5V243.917H426ZM426 247.806H425.5V249.75H426H426.5V247.806H426ZM426 251.694H425.5V253.639H426H426.5V251.694H426ZM426 255.583H425.5V257.528H426H426.5V255.583H426ZM426 259.472H425.5V261.417H426H426.5V259.472H426ZM426 263.361H425.5V265.306H426H426.5V263.361H426ZM426 267.25H425.5V269.194H426H426.5V267.25H426ZM426 271.139H425.5V273.083H426H426.5V271.139H426ZM426 275.028H425.5V276H426H426.5V275.028H426ZM426 276V276.5H426.972V276V275.5H426V276ZM428.917 276V276.5H430.861V276V275.5H428.917V276ZM432.806 276V276.5H434.75V276V275.5H432.806V276ZM436.694 276V276.5H438.639V276V275.5H436.694V276ZM440.583 276V276.5H442.528V276V275.5H440.583V276ZM444.472 276V276.5H446.417V276V275.5H444.472V276ZM448.361 276V276.5H450.306V276V275.5H448.361V276ZM452.25 276V276.5H454.194V276V275.5H452.25V276ZM456.139 276V276.5H458.083V276V275.5H456.139V276ZM460.028 276V276.5H461V276V275.5H460.028V276ZM461 276H461.5V275.028H461H460.5V276H461ZM461 273.083H461.5V271.139H461H460.5V273.083H461ZM461 269.194H461.5V267.25H461H460.5V269.194H461ZM461 265.306H461.5V263.361H461H460.5V265.306H461ZM461 261.417H461.5V259.472H461H460.5V261.417H461ZM461 257.528H461.5V255.583H461H460.5V257.528H461ZM461 253.639H461.5V251.694H461H460.5V253.639H461ZM461 249.75H461.5V247.806H461H460.5V249.75H461ZM461 245.861H461.5V243.917H461H460.5V245.861H461ZM461 241.972H461.5V241H461H460.5V241.972H461ZM461 276V277H462V276H461ZM426 276H425V277H426V276ZM426 241H425V241.972H426H427V241H426ZM426 243.917H425V245.861H426H427V243.917H426ZM426 247.806H425V249.75H426H427V247.806H426ZM426 251.694H425V253.639H426H427V251.694H426ZM426 255.583H425V257.528H426H427V255.583H426ZM426 259.472H425V261.417H426H427V259.472H426ZM426 263.361H425V265.306H426H427V263.361H426ZM426 267.25H425V269.194H426H427V267.25H426ZM426 271.139H425V273.083H426H427V271.139H426ZM426 275.028H425V276H426H427V275.028H426ZM426 276V277H426.972V276V275H426V276ZM428.917 276V277H430.861V276V275H428.917V276ZM432.806 276V277H434.75V276V275H432.806V276ZM436.694 276V277H438.639V276V275H436.694V276ZM440.583 276V277H442.528V276V275H440.583V276ZM444.472 276V277H446.417V276V275H444.472V276ZM448.361 276V277H450.306V276V275H448.361V276ZM452.25 276V277H454.194V276V275H452.25V276ZM456.139 276V277H458.083V276V275H456.139V276ZM460.028 276V277H461V276V275H460.028V276ZM461 276H462V275.028H461H460V276H461ZM461 273.083H462V271.139H461H460V273.083H461ZM461 269.194H462V267.25H461H460V269.194H461ZM461 265.306H462V263.361H461H460V265.306H461ZM461 261.417H462V259.472H461H460V261.417H461ZM461 257.528H462V255.583H461H460V257.528H461ZM461 253.639H462V251.694H461H460V253.639H461ZM461 249.75H462V247.806H461H460V249.75H461ZM461 245.861H462V243.917H461H460V245.861H461ZM461 241.972H462V241H461H460V241.972H461Z" fill="#EA3B40" mask="url(#path-16-inside-3_249_8276-matmul-2-svg)"></path>
</g>
<rect x="318" y="241" width="35" height="8" fill="#160E8A"></rect>
<g opacity="0.5">
<mask id="path-19-inside-4_249_8276-matmul-2-svg" fill="white">
<path d="M318 241H353V276H318V241Z"></path>
</mask>
<path d="M353 276V276.5H353.5V276H353ZM318 276H317.5V276.5H318V276ZM318 241H317.5V241.972H318H318.5V241H318ZM318 243.917H317.5V245.861H318H318.5V243.917H318ZM318 247.806H317.5V249.75H318H318.5V247.806H318ZM318 251.694H317.5V253.639H318H318.5V251.694H318ZM318 255.583H317.5V257.528H318H318.5V255.583H318ZM318 259.472H317.5V261.417H318H318.5V259.472H318ZM318 263.361H317.5V265.306H318H318.5V263.361H318ZM318 267.25H317.5V269.194H318H318.5V267.25H318ZM318 271.139H317.5V273.083H318H318.5V271.139H318ZM318 275.028H317.5V276H318H318.5V275.028H318ZM318 276V276.5H318.972V276V275.5H318V276ZM320.917 276V276.5H322.861V276V275.5H320.917V276ZM324.806 276V276.5H326.75V276V275.5H324.806V276ZM328.694 276V276.5H330.639V276V275.5H328.694V276ZM332.583 276V276.5H334.528V276V275.5H332.583V276ZM336.472 276V276.5H338.417V276V275.5H336.472V276ZM340.361 276V276.5H342.306V276V275.5H340.361V276ZM344.25 276V276.5H346.194V276V275.5H344.25V276ZM348.139 276V276.5H350.083V276V275.5H348.139V276ZM352.028 276V276.5H353V276V275.5H352.028V276ZM353 276H353.5V275.028H353H352.5V276H353ZM353 273.083H353.5V271.139H353H352.5V273.083H353ZM353 269.194H353.5V267.25H353H352.5V269.194H353ZM353 265.306H353.5V263.361H353H352.5V265.306H353ZM353 261.417H353.5V259.472H353H352.5V261.417H353ZM353 257.528H353.5V255.583H353H352.5V257.528H353ZM353 253.639H353.5V251.694H353H352.5V253.639H353ZM353 249.75H353.5V247.806H353H352.5V249.75H353ZM353 245.861H353.5V243.917H353H352.5V245.861H353ZM353 241.972H353.5V241H353H352.5V241.972H353ZM353 276V277H354V276H353ZM318 276H317V277H318V276ZM318 241H317V241.972H318H319V241H318ZM318 243.917H317V245.861H318H319V243.917H318ZM318 247.806H317V249.75H318H319V247.806H318ZM318 251.694H317V253.639H318H319V251.694H318ZM318 255.583H317V257.528H318H319V255.583H318ZM318 259.472H317V261.417H318H319V259.472H318ZM318 263.361H317V265.306H318H319V263.361H318ZM318 267.25H317V269.194H318H319V267.25H318ZM318 271.139H317V273.083H318H319V271.139H318ZM318 275.028H317V276H318H319V275.028H318ZM318 276V277H318.972V276V275H318V276ZM320.917 276V277H322.861V276V275H320.917V276ZM324.806 276V277H326.75V276V275H324.806V276ZM328.694 276V277H330.639V276V275H328.694V276ZM332.583 276V277H334.528V276V275H332.583V276ZM336.472 276V277H338.417V276V275H336.472V276ZM340.361 276V277H342.306V276V275H340.361V276ZM344.25 276V277H346.194V276V275H344.25V276ZM348.139 276V277H350.083V276V275H348.139V276ZM352.028 276V277H353V276V275H352.028V276ZM353 276H354V275.028H353H352V276H353ZM353 273.083H354V271.139H353H352V273.083H353ZM353 269.194H354V267.25H353H352V269.194H353ZM353 265.306H354V263.361H353H352V265.306H353ZM353 261.417H354V259.472H353H352V261.417H353ZM353 257.528H354V255.583H353H352V257.528H353ZM353 253.639H354V251.694H353H352V253.639H353ZM353 249.75H354V247.806H353H352V249.75H353ZM353 245.861H354V243.917H353H352V245.861H353ZM353 241.972H354V241H353H352V241.972H353Z" fill="#160E8A" mask="url(#path-19-inside-4_249_8276-matmul-2-svg)"></path>
</g>
<g clip-path="url(#clip0_249_8276-matmul-2-svg)">
<rect x="461" y="68" width="35" height="35" transform="rotate(90 461 68)" fill="#DFE2E7"></rect>
<rect opacity="0.8" x="461" y="104" width="35" height="35" transform="rotate(90 461 104)" fill="#DFE2E7"></rect>
<rect opacity="0.6" x="461" y="140" width="35" height="35" transform="rotate(90 461 140)" fill="#DFE2E7"></rect>
<rect opacity="0.4" x="461" y="176" width="35" height="35" transform="rotate(90 461 176)" fill="#DFE2E7"></rect>
<rect x="425" y="68" width="35" height="35" transform="rotate(90 425 68)" fill="#DFE2E7"></rect>
<rect opacity="0.8" x="425" y="104" width="35" height="35" transform="rotate(90 425 104)" fill="#DFE2E7"></rect>
<rect opacity="0.6" x="425" y="140" width="35" height="35" transform="rotate(90 425 140)" fill="#DFE2E7"></rect>
<rect opacity="0.4" x="425" y="176" width="35" height="35" transform="rotate(90 425 176)" fill="#DFE2E7"></rect>
<rect x="389" y="68" width="35" height="35" transform="rotate(90 389 68)" fill="#DFE2E7"></rect>
<rect opacity="0.8" x="389" y="104" width="35" height="35" transform="rotate(90 389 104)" fill="#DFE2E7"></rect>
<rect opacity="0.6" x="389" y="140" width="35" height="35" transform="rotate(90 389 140)" fill="#DFE2E7"></rect>
<rect opacity="0.4" x="389" y="176" width="35" height="35" transform="rotate(90 389 176)" fill="#DFE2E7"></rect>
<rect x="353" y="68" width="35" height="35" transform="rotate(90 353 68)" fill="#DFE2E7"></rect>
<rect opacity="0.8" x="353" y="104" width="35" height="35" transform="rotate(90 353 104)" fill="#DFE2E7"></rect>
<rect opacity="0.6" x="353" y="140" width="35" height="35" transform="rotate(90 353 140)" fill="#DFE2E7"></rect>
<rect opacity="0.4" x="353" y="176" width="35" height="35" transform="rotate(90 353 176)" fill="#DFE2E7"></rect>
</g>
<path d="M231.398 282.137C231.462 282.146 231.528 282.151 231.596 282.151C231.665 282.151 231.767 282.151 231.904 282.151C232.939 282.151 233.752 281.934 234.343 281.5C234.938 281.065 235.236 280.474 235.236 279.727C235.236 279.058 235.053 278.55 234.687 278.204C234.321 277.857 233.789 277.684 233.09 277.684C232.983 277.684 232.849 277.688 232.688 277.698C232.531 277.708 232.355 277.723 232.16 277.742C231.955 278.885 231.792 279.8 231.669 280.489C231.552 281.177 231.462 281.727 231.398 282.137ZM228.308 286.517H228.593C228.896 286.517 229.111 286.431 229.238 286.26C229.37 286.084 229.504 285.601 229.641 284.81L230.703 278.482C230.717 278.409 230.729 278.34 230.739 278.277C230.749 278.213 230.754 278.162 230.754 278.123C230.754 277.923 230.686 277.776 230.549 277.684C230.417 277.586 230.214 277.537 229.941 277.537H229.743L229.838 276.995C230.146 277.024 230.427 277.046 230.681 277.061C230.935 277.076 231.164 277.083 231.369 277.083C231.687 277.083 232.109 277.068 232.636 277.039C233.168 277.01 233.54 276.995 233.75 276.995C234.648 276.995 235.349 277.203 235.852 277.618C236.359 278.028 236.613 278.594 236.613 279.317C236.613 280.005 236.394 280.611 235.954 281.133C235.515 281.651 234.87 282.071 234.021 282.393L235.134 284.51C235.163 284.573 235.209 284.668 235.273 284.795C235.893 286.006 236.555 286.612 237.258 286.612C237.282 286.612 237.319 286.609 237.368 286.604C237.421 286.6 237.46 286.597 237.485 286.597L237.397 287.088C237.172 287.127 236.984 287.154 236.833 287.168C236.682 287.188 236.55 287.198 236.438 287.198C235.993 287.198 235.615 287.117 235.302 286.956C234.99 286.79 234.733 286.539 234.533 286.202C234.392 285.972 234.128 285.447 233.742 284.627C233.361 283.807 233.054 283.157 232.819 282.679C232.663 282.693 232.504 282.706 232.343 282.715C232.187 282.72 232.026 282.723 231.86 282.723C231.796 282.723 231.701 282.72 231.574 282.715C231.452 282.71 231.357 282.708 231.289 282.708L230.871 285.469C230.856 285.572 230.844 285.662 230.834 285.74C230.83 285.813 230.827 285.875 230.827 285.923C230.827 286.163 230.878 286.321 230.981 286.399C231.088 286.478 231.311 286.517 231.647 286.517H231.816L231.721 287C231.56 286.995 231.333 286.985 231.04 286.971C230.468 286.951 230.102 286.941 229.941 286.941C229.692 286.941 229.252 286.956 228.623 286.985C228.452 286.99 228.315 286.995 228.212 287L228.308 286.517ZM239.858 283.697L239.931 283.66C241.669 282.771 242.539 282.085 242.539 281.602C242.539 281.343 242.446 281.119 242.26 280.928C242.075 280.738 241.857 280.643 241.608 280.643C241.223 280.643 240.876 280.909 240.568 281.441C240.261 281.973 240.024 282.725 239.858 283.697ZM242.062 283.191L239.821 284.349V284.422C239.821 285.003 239.912 285.445 240.092 285.748C240.278 286.05 240.544 286.202 240.891 286.202C241.096 286.202 241.352 286.111 241.66 285.931C241.972 285.745 242.37 285.447 242.854 285.037L243.11 285.499C242.412 286.143 241.855 286.59 241.44 286.839C241.03 287.088 240.656 287.212 240.319 287.212C239.807 287.212 239.392 286.99 239.074 286.546C238.757 286.102 238.598 285.518 238.598 284.795C238.598 284.283 238.681 283.733 238.847 283.147C239.018 282.557 239.238 282.042 239.506 281.602C239.843 281.065 240.229 280.65 240.664 280.357C241.098 280.064 241.547 279.917 242.011 279.917C242.485 279.917 242.88 280.069 243.198 280.372C243.52 280.669 243.681 281.033 243.681 281.463C243.681 281.81 243.583 282.098 243.388 282.327C243.198 282.552 242.756 282.84 242.062 283.191ZM248.405 284.378L248.955 281.06C248.686 280.904 248.447 280.792 248.237 280.723C248.027 280.65 247.832 280.613 247.651 280.613C247.05 280.613 246.545 280.999 246.135 281.771C245.725 282.537 245.52 283.494 245.52 284.642C245.52 285.105 245.573 285.457 245.681 285.696C245.793 285.936 245.957 286.055 246.171 286.055C246.318 286.055 246.589 285.906 246.984 285.608C247.385 285.311 247.858 284.9 248.405 284.378ZM248.42 285.125L247.175 286.253C246.809 286.585 246.516 286.814 246.296 286.941C246.081 287.068 245.878 287.132 245.688 287.132C245.249 287.132 244.912 286.946 244.677 286.575C244.443 286.199 244.326 285.66 244.326 284.957C244.326 283.57 244.675 282.378 245.373 281.382C246.076 280.386 246.911 279.888 247.878 279.888C248.073 279.888 248.271 279.915 248.471 279.969C248.676 280.018 248.889 280.091 249.108 280.188L249.526 277.537C249.541 277.435 249.55 277.332 249.555 277.229C249.565 277.122 249.57 277.015 249.57 276.907C249.57 276.712 249.531 276.578 249.453 276.504C249.375 276.431 249.23 276.395 249.021 276.395C248.957 276.395 248.891 276.397 248.823 276.402C248.759 276.402 248.688 276.404 248.61 276.409L248.581 275.977C248.986 275.938 249.394 275.884 249.804 275.816C250.219 275.748 250.637 275.665 251.057 275.567C250.603 277.911 250.229 280.027 249.936 281.917C249.643 283.802 249.497 284.947 249.497 285.352C249.497 285.601 249.519 285.777 249.562 285.879C249.611 285.977 249.689 286.026 249.797 286.026C249.855 286.026 249.924 286.001 250.002 285.953C250.085 285.904 250.188 285.823 250.31 285.711L250.756 285.308L250.998 285.726L250.156 286.553C249.863 286.836 249.65 287.017 249.519 287.095C249.387 287.173 249.26 287.212 249.138 287.212C248.879 287.212 248.688 287.09 248.566 286.846C248.449 286.602 248.391 286.224 248.391 285.711C248.391 285.599 248.393 285.499 248.398 285.411C248.403 285.318 248.41 285.223 248.42 285.125ZM258.491 285.77L257.48 286.714C257.299 286.89 257.136 287.015 256.989 287.088C256.848 287.161 256.701 287.198 256.55 287.198C256.33 287.198 256.152 287.093 256.015 286.883C255.883 286.668 255.817 286.382 255.817 286.026C255.817 285.923 255.825 285.801 255.839 285.66C255.859 285.513 255.896 285.286 255.949 284.979C255.046 285.901 254.406 286.502 254.03 286.78C253.654 287.059 253.334 287.198 253.071 287.198C252.792 287.198 252.561 287.068 252.375 286.81C252.189 286.551 252.097 286.219 252.097 285.813C252.097 285.472 252.243 284.703 252.536 283.506C252.609 283.223 252.663 283.008 252.697 282.862C252.8 282.457 252.875 282.132 252.924 281.888C252.973 281.639 252.998 281.453 252.998 281.331C252.998 281.233 252.973 281.155 252.924 281.097C252.875 281.033 252.814 281.001 252.741 281.001C252.692 281.001 252.597 281.036 252.456 281.104C252.314 281.172 252.119 281.277 251.87 281.419L251.665 281.016C252.119 280.679 252.517 280.418 252.858 280.232C253.2 280.042 253.442 279.947 253.583 279.947C253.784 279.947 253.94 280.032 254.052 280.203C254.169 280.374 254.228 280.611 254.228 280.914C254.228 281.294 254.077 282.032 253.774 283.125C253.476 284.219 253.327 285.04 253.327 285.586C253.327 285.757 253.356 285.884 253.415 285.967C253.474 286.045 253.564 286.084 253.686 286.084C253.823 286.084 254.055 285.95 254.382 285.682C254.714 285.408 255.268 284.888 256.044 284.122C256.23 283.243 256.379 282.5 256.491 281.895C256.608 281.285 256.699 280.74 256.762 280.262L258.081 279.947L257.919 280.672C257.641 281.858 257.49 282.52 257.465 282.657L257.29 283.594C257.202 284.039 257.131 284.463 257.077 284.869C257.028 285.274 257.004 285.56 257.004 285.726C257.004 285.838 257.026 285.926 257.07 285.989C257.114 286.053 257.172 286.084 257.246 286.084C257.314 286.084 257.441 286.019 257.626 285.887C257.812 285.755 258.024 285.577 258.264 285.352L258.491 285.77ZM263.793 281.177L263.405 281.558C263.083 281.231 262.824 281.014 262.629 280.906C262.438 280.799 262.243 280.745 262.043 280.745C261.594 280.745 261.203 281.08 260.871 281.749C260.539 282.413 260.373 283.233 260.373 284.209C260.373 284.864 260.458 285.357 260.629 285.689C260.8 286.021 261.052 286.187 261.384 286.187C261.569 286.187 261.823 286.082 262.146 285.872C262.468 285.657 262.807 285.364 263.164 284.993L263.464 285.513C262.897 286.114 262.414 286.548 262.014 286.817C261.613 287.081 261.247 287.212 260.915 287.212C260.388 287.212 259.965 286.983 259.648 286.524C259.335 286.065 259.179 285.445 259.179 284.664C259.179 283.326 259.521 282.198 260.205 281.28C260.893 280.362 261.74 279.903 262.746 279.903C263.112 279.903 263.425 279.981 263.684 280.137C263.947 280.293 264.079 280.472 264.079 280.672C264.079 280.75 264.057 280.828 264.013 280.906C263.974 280.984 263.901 281.075 263.793 281.177ZM267.792 278.24C267.7 278.567 267.57 279.08 267.404 279.778C267.355 279.983 267.319 280.135 267.294 280.232C267.583 280.232 267.875 280.23 268.173 280.225C268.476 280.215 268.793 280.203 269.125 280.188L268.95 280.921C268.818 280.916 268.671 280.914 268.51 280.914C268.349 280.914 268.09 280.914 267.734 280.914H267.148C266.918 281.919 266.748 282.798 266.635 283.55C266.528 284.302 266.474 284.932 266.474 285.44C266.474 285.655 266.508 285.823 266.577 285.945C266.65 286.067 266.75 286.128 266.877 286.128C266.975 286.128 267.128 286.05 267.338 285.894C267.548 285.738 267.834 285.486 268.195 285.14L268.452 285.608C267.749 286.331 267.265 286.792 267.001 286.993C266.738 287.188 266.516 287.286 266.335 287.286C265.998 287.286 265.729 287.127 265.529 286.81C265.329 286.492 265.229 286.06 265.229 285.513C265.229 285.157 265.285 284.646 265.397 283.982C265.51 283.313 265.722 282.278 266.035 280.877C265.957 280.877 265.854 280.879 265.727 280.884C265.605 280.889 265.522 280.892 265.478 280.892H264.973L265.061 280.401C265.285 280.391 265.49 280.352 265.676 280.284C265.866 280.215 266.057 280.108 266.247 279.961C266.291 279.786 266.34 279.603 266.394 279.412C266.452 279.217 266.518 279.012 266.591 278.797L267.792 278.24ZM272.634 285.337L272.89 285.77C272.29 286.39 271.872 286.785 271.638 286.956C271.403 287.127 271.196 287.212 271.015 287.212C270.756 287.212 270.549 287.105 270.393 286.89C270.236 286.67 270.158 286.377 270.158 286.011C270.158 285.552 270.302 284.786 270.59 283.711C270.883 282.637 271.03 281.863 271.03 281.39C271.03 281.268 271 281.17 270.942 281.097C270.883 281.023 270.808 280.987 270.715 280.987C270.637 280.987 270.534 281.019 270.407 281.082C270.28 281.146 270.122 281.243 269.931 281.375L269.711 280.987L270.686 280.276C270.871 280.14 271.032 280.042 271.169 279.983C271.306 279.92 271.435 279.888 271.557 279.888C271.787 279.888 271.967 279.983 272.099 280.174C272.236 280.359 272.304 280.616 272.304 280.943C272.304 281.299 272.177 281.998 271.923 283.038C271.865 283.272 271.821 283.448 271.792 283.565C271.655 284.117 271.55 284.573 271.477 284.935C271.408 285.296 271.374 285.545 271.374 285.682C271.374 285.804 271.401 285.904 271.455 285.982C271.508 286.06 271.577 286.099 271.66 286.099C271.738 286.099 271.84 286.05 271.967 285.953C272.094 285.855 272.316 285.65 272.634 285.337ZM272.575 275.896L272.993 276.365C273.11 276.487 273.19 276.597 273.234 276.695C273.283 276.788 273.308 276.883 273.308 276.98C273.308 277.083 273.271 277.181 273.198 277.273C273.129 277.366 273.027 277.454 272.89 277.537L272.246 277.896L271.777 277.339C271.679 277.217 271.616 277.122 271.586 277.054C271.557 276.98 271.542 276.905 271.542 276.827C271.542 276.714 271.572 276.617 271.63 276.534C271.689 276.446 271.789 276.36 271.931 276.277L272.575 275.896ZM277.167 280.628C276.601 280.628 276.113 281.016 275.703 281.792C275.292 282.569 275.087 283.526 275.087 284.664C275.087 285.264 275.19 285.723 275.395 286.041C275.605 286.358 275.908 286.517 276.303 286.517C276.899 286.517 277.404 286.136 277.819 285.374C278.239 284.607 278.449 283.67 278.449 282.562C278.449 281.902 278.344 281.417 278.134 281.104C277.924 280.787 277.602 280.628 277.167 280.628ZM277.482 279.917C278.21 279.917 278.762 280.145 279.138 280.599C279.519 281.048 279.709 281.707 279.709 282.576C279.709 283.074 279.611 283.606 279.416 284.173C279.221 284.734 278.957 285.242 278.625 285.696C278.269 286.185 277.863 286.561 277.409 286.824C276.96 287.083 276.486 287.212 275.988 287.212C275.334 287.212 274.812 286.976 274.421 286.502C274.035 286.028 273.842 285.394 273.842 284.598C273.842 284.007 273.938 283.431 274.128 282.869C274.318 282.308 274.592 281.8 274.948 281.346C275.3 280.892 275.698 280.54 276.142 280.291C276.591 280.042 277.038 279.917 277.482 279.917ZM282.888 282.02L284.074 280.862C284.489 280.467 284.802 280.206 285.012 280.079C285.227 279.952 285.429 279.888 285.62 279.888C285.942 279.888 286.203 280.03 286.403 280.313C286.608 280.596 286.711 280.97 286.711 281.434C286.711 281.907 286.591 282.64 286.352 283.631C286.113 284.617 285.993 285.32 285.993 285.74C285.993 285.867 286.018 285.965 286.066 286.033C286.115 286.097 286.186 286.128 286.279 286.128C286.323 286.128 286.376 286.111 286.44 286.077C286.508 286.038 286.574 285.987 286.638 285.923L287.194 285.381L287.451 285.77L286.652 286.583C286.462 286.778 286.271 286.932 286.081 287.044C285.896 287.156 285.732 287.212 285.59 287.212C285.346 287.212 285.146 287.107 284.99 286.897C284.838 286.683 284.763 286.402 284.763 286.055C284.763 285.64 284.887 284.91 285.136 283.865C285.385 282.815 285.51 282.051 285.51 281.573C285.51 281.392 285.471 281.248 285.393 281.141C285.319 281.028 285.219 280.972 285.092 280.972C284.902 280.972 284.318 281.424 283.342 282.327C283.083 282.566 282.88 282.754 282.734 282.891L282.272 285.469C282.263 285.518 282.248 285.591 282.229 285.689C282.126 286.211 282.065 286.612 282.045 286.89L280.742 287.212C281.064 285.811 281.318 284.593 281.503 283.558C281.694 282.522 281.789 281.844 281.789 281.521C281.789 281.326 281.767 281.187 281.723 281.104C281.679 281.016 281.608 280.972 281.511 280.972C281.452 280.972 281.354 281.006 281.218 281.075C281.086 281.143 280.917 281.243 280.712 281.375L280.515 280.987C280.568 280.943 280.646 280.879 280.749 280.796C281.501 280.191 282.004 279.888 282.258 279.888C282.502 279.888 282.683 279.981 282.8 280.167C282.917 280.347 282.976 280.63 282.976 281.016C282.976 281.153 282.968 281.307 282.954 281.478C282.939 281.648 282.917 281.829 282.888 282.02Z" fill="black"></path>
<path d="M288.354 266.354C288.549 266.158 288.549 265.842 288.354 265.646L285.172 262.464C284.976 262.269 284.66 262.269 284.464 262.464C284.269 262.66 284.269 262.976 284.464 263.172L287.293 266L284.464 268.828C284.269 269.024 284.269 269.34 284.464 269.536C284.66 269.731 284.976 269.731 285.172 269.536L288.354 266.354ZM152 266V266.5H288V266V265.5H152V266Z" fill="black"></path>
<path d="M480.65 211.354C480.846 211.549 481.162 211.549 481.357 211.354L484.539 208.172C484.735 207.976 484.735 207.66 484.539 207.464C484.344 207.269 484.028 207.269 483.832 207.464L481.004 210.293L478.175 207.464C477.98 207.269 477.664 207.269 477.468 207.464C477.273 207.66 477.273 207.976 477.468 208.172L480.65 211.354ZM481.004 95L480.504 95L480.504 211L481.004 211L481.504 211L481.504 95L481.004 95Z" fill="black"></path>
<path d="M383.318 23.5483C383.547 23.5679 383.77 23.5825 383.984 23.5923C384.204 23.6021 384.419 23.6069 384.629 23.6069C384.785 23.6069 384.968 23.6021 385.178 23.5923C385.388 23.5825 385.615 23.5679 385.859 23.5483C385.923 23.7095 386.011 23.8755 386.123 24.0464C386.235 24.2173 386.377 24.4053 386.548 24.6104L392.59 31.7588C392.576 31.0166 392.561 30.0327 392.546 28.8071C392.507 26.2339 392.463 24.8496 392.415 24.6543C392.356 24.4297 392.251 24.2734 392.1 24.1855C391.953 24.0977 391.711 24.0537 391.375 24.0537H391.147V23.5483C391.206 23.5483 391.294 23.5508 391.411 23.5557C392.104 23.5898 392.593 23.6069 392.876 23.6069C393.164 23.6069 393.667 23.5898 394.385 23.5557C394.487 23.5508 394.565 23.5483 394.619 23.5483L394.612 24.0537C394.583 24.0488 394.551 24.0464 394.517 24.0464C394.482 24.0415 394.436 24.0391 394.377 24.0391C393.723 24.0391 393.391 24.9497 393.381 26.771C393.376 27.23 393.374 27.5889 393.374 27.8477L393.345 29.7959C393.335 30.084 393.328 30.3818 393.323 30.6895C393.323 30.9922 393.323 31.4097 393.323 31.9419C393.323 32.5327 393.33 32.9941 393.345 33.3262C393.359 33.6533 393.384 33.917 393.418 34.1172H392.605C392.522 33.9219 392.227 33.5312 391.719 32.9453L391.646 32.8574L385.361 25.4673V25.6357C385.391 30.2061 385.439 32.623 385.508 32.8867C385.566 33.1113 385.669 33.2676 385.815 33.3555C385.967 33.4434 386.206 33.4873 386.533 33.4873H386.753V34C386.68 33.9951 386.572 33.9902 386.431 33.9854C385.747 33.9561 385.281 33.9414 385.032 33.9414C384.792 33.9414 384.526 33.9463 384.233 33.9561C383.945 33.9658 383.64 33.9805 383.318 34V33.4946C383.347 33.4946 383.379 33.4971 383.413 33.502C383.452 33.502 383.501 33.502 383.56 33.502C384.214 33.502 384.546 32.5962 384.556 30.7847C384.561 30.3257 384.563 29.9668 384.563 29.708L384.6 27.7598C384.604 27.3398 384.607 26.9321 384.607 26.5366C384.612 26.1362 384.614 25.6797 384.614 25.167C384.614 24.7471 384.534 24.4565 384.373 24.2954C384.211 24.1343 383.926 24.0537 383.516 24.0537H383.318V23.5483Z" fill="black"></path>
<path d="M337 58V43.5H440V58" stroke="black"></path>
<path d="M35.0889 244.236C35.2012 244.246 35.3208 244.253 35.4478 244.258C35.5796 244.258 35.7749 244.258 36.0337 244.258C36.312 244.258 36.5684 244.253 36.8027 244.243C37.042 244.233 37.2715 244.216 37.4912 244.192C37.8477 243.938 38.1162 243.652 38.2969 243.335C38.4775 243.013 38.5679 242.659 38.5679 242.273C38.5679 241.653 38.3701 241.165 37.9746 240.808C37.5791 240.447 37.0371 240.266 36.3486 240.266C36.1973 240.266 36.0215 240.276 35.8213 240.295C35.626 240.315 35.4038 240.344 35.1548 240.383C35.1401 241.038 35.1255 241.797 35.1108 242.661C35.1011 243.525 35.0938 244.05 35.0889 244.236ZM35.1035 249.048C35.3867 249.131 35.665 249.194 35.9385 249.238C36.2119 249.277 36.478 249.297 36.7368 249.297C37.5376 249.297 38.1577 249.102 38.5972 248.711C39.0366 248.32 39.2563 247.776 39.2563 247.078C39.2563 246.335 39.0098 245.786 38.5166 245.43C38.0234 245.068 37.2666 244.888 36.2461 244.888C36.0801 244.888 35.9116 244.89 35.7407 244.895C35.5747 244.895 35.3574 244.902 35.0889 244.917C35.0889 245.122 35.0864 245.425 35.0815 245.825C35.0767 246.221 35.0742 246.511 35.0742 246.697C35.0742 247 35.0767 247.322 35.0815 247.664C35.0864 248 35.0938 248.462 35.1035 249.048ZM32.5107 249.524C32.5449 249.529 32.5767 249.534 32.606 249.539C32.6401 249.539 32.689 249.539 32.7524 249.539C33.4019 249.539 33.7314 248.625 33.7412 246.799C33.7461 246.34 33.751 245.981 33.7559 245.723L33.7852 243.723C33.79 243.293 33.7925 242.876 33.7925 242.471C33.7974 242.065 33.7998 241.626 33.7998 241.152C33.7998 240.732 33.7217 240.442 33.5654 240.281C33.4092 240.12 33.1309 240.039 32.7305 240.039H32.6719V239.526C32.9844 239.551 33.2896 239.568 33.5874 239.578C33.8901 239.587 34.1953 239.592 34.5029 239.592C34.8447 239.592 35.2646 239.583 35.7627 239.563C36.2607 239.539 36.5854 239.526 36.7368 239.526C37.7427 239.526 38.5361 239.751 39.1172 240.2C39.7031 240.645 39.9961 241.245 39.9961 242.002C39.9961 242.534 39.8521 242.996 39.564 243.386C39.2808 243.772 38.8096 244.146 38.1504 244.507C39.0098 244.673 39.6519 244.966 40.0767 245.386C40.5015 245.806 40.7139 246.36 40.7139 247.048C40.7139 247.942 40.3599 248.662 39.6519 249.209C38.9438 249.756 37.999 250.029 36.8174 250.029C36.6025 250.029 36.1997 250.017 35.6089 249.993C35.0181 249.968 34.5298 249.956 34.144 249.956C33.9829 249.956 33.7583 249.961 33.4702 249.971C33.187 249.98 32.8672 249.995 32.5107 250.015V249.524ZM48.3237 248.938L48.5288 249.399C48.1626 249.663 47.8281 249.866 47.5254 250.007C47.2227 250.154 46.9785 250.227 46.793 250.227C46.4805 250.227 46.2461 250.137 46.0898 249.956C45.9336 249.771 45.8481 249.492 45.8335 249.121C45.3013 249.478 44.8594 249.734 44.5078 249.89C44.1562 250.042 43.8413 250.117 43.563 250.117C43.0698 250.117 42.6572 249.932 42.3252 249.561C41.9932 249.189 41.8271 248.735 41.8271 248.198C41.8271 247.285 42.811 246.597 44.7788 246.133C45.2427 246.025 45.604 245.94 45.8628 245.876C45.8628 245.793 45.8652 245.674 45.8701 245.518C45.8848 245.195 45.8921 244.985 45.8921 244.888C45.8921 244.38 45.7871 244.006 45.5771 243.767C45.3672 243.523 45.0474 243.401 44.6177 243.401C44.1978 243.401 43.8657 243.479 43.6216 243.635C43.3823 243.787 43.2627 243.994 43.2627 244.258C43.2627 244.282 43.2651 244.316 43.27 244.36C43.2749 244.399 43.2773 244.429 43.2773 244.448C43.2773 244.6 43.2041 244.727 43.0576 244.829C42.9111 244.927 42.7354 244.976 42.5303 244.976C42.3545 244.976 42.2251 244.946 42.1421 244.888C42.0591 244.829 42.0176 244.739 42.0176 244.617C42.0176 244.226 42.3472 243.792 43.0063 243.313C43.6655 242.83 44.3467 242.588 45.0498 242.588C45.7285 242.588 46.2437 242.776 46.5952 243.152C46.9468 243.523 47.1226 244.07 47.1226 244.792C47.1226 245.183 47.0981 245.784 47.0493 246.594C47.0054 247.405 46.9834 248.02 46.9834 248.44C46.9834 248.757 47.0176 248.972 47.0859 249.084C47.1592 249.197 47.2861 249.253 47.4668 249.253C47.5449 249.253 47.645 249.231 47.7671 249.187C47.894 249.138 48.0796 249.055 48.3237 248.938ZM45.8262 246.462C45.7334 246.487 45.5942 246.523 45.4087 246.572C43.8218 247.007 43.0283 247.52 43.0283 248.11C43.0283 248.433 43.1309 248.696 43.3359 248.901C43.541 249.102 43.812 249.202 44.1489 249.202C44.354 249.202 44.5908 249.148 44.8594 249.041C45.1279 248.933 45.4404 248.762 45.7969 248.528L45.8262 246.462ZM50.814 241.423L51.2974 241.57C51.2681 241.838 51.2437 242.08 51.2241 242.295C51.2095 242.505 51.1997 242.712 51.1948 242.917H51.7148C51.9932 242.917 52.2764 242.915 52.5645 242.91C52.8525 242.9 53.1431 242.888 53.436 242.874L53.2603 243.672C52.9478 243.647 52.6523 243.633 52.374 243.628C52.1006 243.618 51.8271 243.613 51.5537 243.613H51.2095C51.1802 244.453 51.1582 245.098 51.1436 245.547C51.1338 245.991 51.1289 246.36 51.1289 246.653C51.1289 247.756 51.2046 248.477 51.356 248.813C51.5073 249.146 51.7783 249.312 52.1689 249.312C52.3301 249.312 52.5083 249.277 52.7036 249.209C52.9038 249.141 53.1455 249.028 53.4287 248.872L53.6704 249.355C53.2017 249.639 52.7769 249.854 52.396 250C52.0151 250.142 51.6831 250.212 51.3999 250.212C50.8774 250.212 50.4966 250.034 50.2573 249.678C50.0181 249.316 49.8984 248.738 49.8984 247.942C49.8984 247.786 49.9082 247.229 49.9277 246.272C49.9521 245.31 49.9644 244.429 49.9644 243.628C49.9204 243.628 49.8569 243.63 49.7739 243.635C49.3687 243.65 49.0903 243.657 48.939 243.657V243.13C49.4175 243.062 49.813 242.886 50.1255 242.603C50.438 242.314 50.6675 241.921 50.814 241.423ZM59.9839 248.557L60.3501 249.114C59.8765 249.475 59.4102 249.749 58.9512 249.934C58.4922 250.12 58.0576 250.212 57.6475 250.212C56.6904 250.212 55.9092 249.871 55.3037 249.187C54.6982 248.499 54.3955 247.62 54.3955 246.55C54.3955 245.442 54.7788 244.504 55.5454 243.738C56.312 242.971 57.2471 242.588 58.3506 242.588C58.917 242.588 59.354 242.668 59.6616 242.83C59.9692 242.986 60.123 243.206 60.123 243.489C60.123 243.694 60.0596 243.872 59.9326 244.023C59.8105 244.17 59.6689 244.243 59.5078 244.243C59.4541 244.243 59.2271 244.121 58.8267 243.877C58.4312 243.628 58.0527 243.503 57.6914 243.503C57.0566 243.503 56.5513 243.733 56.1753 244.192C55.8042 244.646 55.6187 245.266 55.6187 246.052C55.6187 247.043 55.8433 247.817 56.2925 248.374C56.7466 248.926 57.374 249.202 58.1748 249.202C58.4727 249.202 58.7681 249.15 59.061 249.048C59.3589 248.945 59.6665 248.782 59.9839 248.557ZM63.3457 238.677C63.3262 239.497 63.3091 240.334 63.2944 241.189C63.2798 242.043 63.27 242.92 63.2651 243.818C63.812 243.403 64.3003 243.098 64.73 242.903C65.1597 242.703 65.5503 242.603 65.9019 242.603C66.6196 242.603 67.1592 242.805 67.5205 243.21C67.8818 243.616 68.0625 244.224 68.0625 245.034C68.0625 245.039 68.0601 245.254 68.0552 245.679C68.0503 246.104 68.0479 246.528 68.0479 246.953C68.0479 247.134 68.0454 247.361 68.0405 247.634C68.0356 247.903 68.0332 248.086 68.0332 248.184C68.0332 248.73 68.082 249.087 68.1797 249.253C68.2773 249.419 68.4629 249.502 68.7363 249.502C68.751 249.502 68.7778 249.5 68.8169 249.495C68.8608 249.49 68.895 249.487 68.9194 249.487V250C68.4751 249.971 68.1406 249.951 67.916 249.941C67.6914 249.932 67.5059 249.927 67.3594 249.927C67.125 249.927 66.8711 249.934 66.5977 249.949C66.3291 249.958 66.0483 249.976 65.7554 250L65.748 249.487H65.8579C66.4829 249.487 66.8027 248.916 66.8174 247.773C66.8174 247.71 66.8174 247.661 66.8174 247.627L66.832 246.052V245.752C66.832 244.863 66.7271 244.275 66.5171 243.987C66.3071 243.694 65.9458 243.547 65.4331 243.547C65.1548 243.547 64.8447 243.616 64.5029 243.752C64.166 243.889 63.7681 244.106 63.3091 244.404L63.2725 247.012C63.2725 247.158 63.27 247.346 63.2651 247.576C63.2603 247.805 63.2578 247.964 63.2578 248.052C63.2578 248.657 63.3066 249.05 63.4043 249.231C63.502 249.412 63.6899 249.502 63.9683 249.502C63.9878 249.502 64.0171 249.5 64.0562 249.495C64.1001 249.49 64.1343 249.487 64.1587 249.487V250C63.8511 249.976 63.5605 249.958 63.2871 249.949C63.0186 249.934 62.7842 249.927 62.584 249.927C62.3936 249.927 62.1738 249.932 61.9248 249.941C61.6758 249.951 61.3511 249.968 60.9507 249.993V249.487C60.98 249.487 61.0215 249.49 61.0752 249.495C61.1289 249.5 61.168 249.502 61.1924 249.502C61.5293 249.502 61.7563 249.414 61.8735 249.238C61.9907 249.058 62.0493 248.538 62.0493 247.678V247.136L62.0786 241.628V240.369C62.0786 240.159 62.0322 240.002 61.9395 239.9C61.8516 239.792 61.7173 239.739 61.5366 239.739C61.4683 239.739 61.356 239.753 61.1997 239.783C61.1606 239.792 61.1338 239.797 61.1191 239.797L61.0093 239.321C61.4097 239.243 61.8027 239.153 62.1885 239.05C62.5742 238.943 62.96 238.818 63.3457 238.677ZM79.166 238.494L79.5396 238.882C78.6362 239.883 77.9526 240.957 77.4888 242.104C77.0249 243.252 76.793 244.443 76.793 245.679C76.793 246.914 77.0249 248.083 77.4888 249.187C77.9526 250.291 78.6558 251.357 79.5981 252.388L79.21 252.834C77.9844 251.887 77.0688 250.813 76.4634 249.612C75.8628 248.411 75.5625 247.061 75.5625 245.562C75.5625 244.16 75.8677 242.859 76.478 241.658C77.0933 240.457 77.9893 239.402 79.166 238.494ZM86.6953 247.437L88.812 242.632L88.8999 242.434C89.5981 240.857 89.9473 239.924 89.9473 239.636C89.9473 239.626 89.9448 239.612 89.9399 239.592C89.9351 239.573 89.9326 239.558 89.9326 239.548C90.2207 239.563 90.4795 239.575 90.709 239.585C90.9434 239.59 91.1509 239.592 91.3315 239.592C91.5024 239.592 91.7002 239.59 91.9248 239.585C92.1494 239.575 92.396 239.563 92.6646 239.548V240.054H92.5767C92.1519 240.054 91.8589 240.127 91.6978 240.273C91.5415 240.42 91.4634 240.681 91.4634 241.057C91.4634 241.204 91.4731 241.531 91.4927 242.039C91.5122 242.546 91.5366 243.096 91.5659 243.687L91.6904 245.745L91.6978 245.942C91.8052 247.769 91.8882 248.801 91.9468 249.041C91.9761 249.182 92.0664 249.292 92.2178 249.37C92.3691 249.448 92.5669 249.487 92.811 249.487H92.9941V250C92.6084 249.98 92.2495 249.966 91.9175 249.956C91.5854 249.946 91.3096 249.941 91.0898 249.941C90.8311 249.941 90.5405 249.946 90.2183 249.956C89.896 249.966 89.5518 249.98 89.1855 250V249.473C89.2295 249.473 89.2856 249.475 89.354 249.48C89.4224 249.485 89.4712 249.487 89.5005 249.487C89.8716 249.487 90.1279 249.421 90.2695 249.29C90.416 249.158 90.4893 248.918 90.4893 248.572C90.4893 248.411 90.4868 248.252 90.4819 248.096C90.4771 247.939 90.4697 247.778 90.46 247.612L90.1743 241.313L87.1714 248.22C87.1665 248.23 87.1567 248.252 87.1421 248.286C86.9077 248.77 86.7344 249.285 86.6221 249.832H86.1387C86.0703 249.529 85.8994 249.065 85.626 248.44L85.5967 248.374L82.645 241.687C82.6157 242.209 82.5742 242.927 82.5205 243.84C82.3838 246.106 82.3154 247.524 82.3154 248.096V248.169C82.3154 248.789 82.3838 249.165 82.5205 249.297C82.6621 249.424 82.9478 249.487 83.3774 249.487H83.5312V250C83.2139 249.98 82.9087 249.966 82.6157 249.956C82.3276 249.946 82.0469 249.941 81.7734 249.941C81.5781 249.941 81.334 249.946 81.041 249.956C80.7529 249.966 80.4429 249.98 80.1108 250V249.487H80.3159C80.5942 249.487 80.8018 249.453 80.9385 249.385C81.0752 249.316 81.1826 249.197 81.2607 249.026C81.3535 248.826 81.4487 248.015 81.5464 246.594C81.5708 246.204 81.5928 245.894 81.6123 245.664L81.7441 243.892V243.87C81.876 242.117 81.9419 241.121 81.9419 240.881C81.9419 240.574 81.8662 240.359 81.7148 240.237C81.5684 240.115 81.2876 240.054 80.8726 240.054H80.7554V239.548C80.7944 239.548 80.8579 239.551 80.9458 239.556C81.5122 239.59 81.9077 239.607 82.1323 239.607C82.3032 239.607 82.6279 239.592 83.1064 239.563C83.2578 239.553 83.3726 239.548 83.4507 239.548V239.592C83.4507 240.027 84.2783 242.078 85.9336 245.745L86.6953 247.437ZM94.2393 238.494C95.4111 239.402 96.3022 240.459 96.9126 241.665C97.5229 242.866 97.8281 244.165 97.8281 245.562C97.8281 247.061 97.5278 248.413 96.9272 249.619C96.3267 250.82 95.416 251.892 94.1953 252.834L93.8071 252.388C94.7495 251.362 95.4526 250.303 95.9165 249.209C96.3804 248.11 96.6123 246.963 96.6123 245.767C96.6123 244.487 96.3828 243.274 95.9238 242.126C95.4648 240.979 94.7788 239.897 93.8657 238.882L94.2393 238.494ZM105.841 246.506H114.615V247.363H105.841V246.506ZM105.841 243.701H114.615V244.558H105.841V243.701ZM125.704 239.409C125.655 240.322 125.621 241.262 125.602 242.229C125.582 243.196 125.572 244.487 125.572 246.104C125.572 246.289 125.567 246.533 125.558 246.836C125.553 247.139 125.55 247.349 125.55 247.466C125.55 248.335 125.636 248.892 125.807 249.136C125.982 249.38 126.312 249.502 126.795 249.502C126.825 249.502 126.874 249.5 126.942 249.495C127.01 249.49 127.062 249.487 127.096 249.487V250C126.656 249.98 126.241 249.966 125.851 249.956C125.465 249.946 125.116 249.941 124.803 249.941C124.549 249.941 124.234 249.946 123.858 249.956C123.487 249.966 123.077 249.98 122.628 250V249.502H122.855C123.373 249.502 123.722 249.451 123.902 249.348C124.083 249.246 124.208 249.043 124.276 248.74C124.32 248.555 124.356 247.915 124.386 246.821C124.415 245.728 124.43 244.363 124.43 242.727C124.43 242.473 124.422 242.09 124.408 241.577C124.398 241.06 124.391 240.693 124.386 240.479C124.103 240.483 123.802 240.5 123.485 240.53C123.167 240.554 122.828 240.591 122.467 240.64L122.372 240.083C122.904 239.995 123.448 239.895 124.005 239.783C124.562 239.67 125.128 239.546 125.704 239.409Z" fill="black"></path>
<defs>
<clipPath id="clip0_249_8276-matmul-2-svg">
<rect width="143" height="143" fill="white" transform="translate(461 68) rotate(90)"></rect>
</clipPath>
</defs>
</svg>

<figcaption><b>Padded Tensor-Core Instructions</b> If the batch size is too small, we may be in our situation where we can't fit even one of our 2D tiles in the output. In this case, it is most efficient to switch to a smaller tensor-core instruction or eschew tensor-cores altogether! However, both of these options prevent our kernel from being batch-invariant.</figcaption>
</figure>
<p>So, the easiest way to ensure batch invariance for matmuls is to compile one kernel configuration and use that for all shapes. Although we will lose some performance, this isn’t typically disastrous in LLM inference. In particular, split-k is most needed when <strong>both</strong> M and N are small, and luckily in our case, N (i.e. the model dim) is usually pretty large!</p>
<figure data-src="/data/batch-vs-cublas.txt" data-seriesmeta="{&quot;names&quot;:[&quot;CuBLAS&quot;,&quot;Batch-Invariant&quot;],&quot;colors&quot;:[&quot;var(--blue)&quot;,&quot;#f59e0b&quot;]}" data-show-points="false" data-smooth="5" data-x="{&quot;label&quot;:&quot;Batch-size&quot;,&quot;ticks&quot;:[0,1000,2000,3000,4000,5000,6000,7000,8200]}" data-y="{&quot;label&quot;:&quot;TFLOPS&quot;,&quot;ticks&quot;:[0,100,200,300,400,500,600,700]}" data-labels="{&quot;CuBLAS&quot;:{&quot;x&quot;:7700,&quot;y&quot;:668,&quot;dx&quot;:-4,&quot;dy&quot;:-8},&quot;Batch-Invariant&quot;:{&quot;x&quot;:7700,&quot;y&quot;:590,&quot;dx&quot;:-4,&quot;dy&quot;:-8}}" data-series="[{&quot;lineWidth&quot;:1.4},{&quot;lineWidth&quot;:1.4}]">
  <figcaption>Despite obtaining batch invariance, we only lose about 20% performance compared to cuBLAS. Note that this is not an optimized Triton kernel either (e.g. no TMA). However, some of the patterns in performance are illustrative of where our batch-invariant requirement loses performance. First, note that we lose a significant amount of performance at very small batch sizes due to an overly large instruction and insufficient parallelism. Second, there is a "jigsaw" pattern as we increase the batch-size that is caused by quantization effects (both tile and wave) that are typically ameliorated through changing tile sizes. You can find more on these quantization effects <a href="https://www.thonking.ai/p/what-shapes-do-matrix-multiplications">here</a>.</figcaption>
  <svg viewBox="0 0 800 520" width="100%" height="auto"></svg>
  
</figure>
<h3 id="batch-invariant-attention">Batch-Invariant Attention</h3>
<figure>
<svg width="416" height="438" viewBox="0 0 416 438" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="416" height="438" fill="#F5F5F5"></rect>
<rect width="416" height="438" fill="white"></rect>
<path d="M48.311 264.817L49.9883 265.828C50.8086 266.311 51.4604 266.641 51.9438 266.816C52.4272 266.997 52.8862 267.087 53.3208 267.087C53.4624 267.087 53.6284 267.075 53.8188 267.051C54.0093 267.026 54.2388 266.987 54.5073 266.934L54.5952 267.388C53.9019 267.583 53.3867 267.71 53.0498 267.769C52.7178 267.832 52.4224 267.864 52.1636 267.864C51.1235 267.864 49.3853 267.039 46.9487 265.388L46.6484 265.183C46.6143 265.183 46.5605 265.186 46.4873 265.19C46.4189 265.195 46.3677 265.198 46.3335 265.198C44.8394 265.198 43.604 264.685 42.6274 263.66C41.6558 262.634 41.1699 261.34 41.1699 259.778C41.1699 258.997 41.314 258.264 41.6021 257.581C41.895 256.897 42.3174 256.289 42.8691 255.757C43.3574 255.288 43.9141 254.929 44.5391 254.68C45.1641 254.431 45.8159 254.307 46.4946 254.307C47.2271 254.307 47.8838 254.414 48.4648 254.629C49.0508 254.844 49.5806 255.171 50.0542 255.61C50.6255 256.152 51.0625 256.777 51.3652 257.485C51.668 258.193 51.8193 258.943 51.8193 259.734C51.8193 260.945 51.5142 261.995 50.9038 262.883C50.2935 263.772 49.4292 264.417 48.311 264.817ZM50.2007 259.99C50.2007 258.569 49.8345 257.405 49.1021 256.497C48.3696 255.583 47.4468 255.127 46.3335 255.127C45.2642 255.127 44.4048 255.518 43.7554 256.299C43.1108 257.08 42.7886 258.125 42.7886 259.434C42.7886 260.903 43.1572 262.1 43.8945 263.022C44.6318 263.94 45.5693 264.399 46.707 264.399C47.752 264.399 48.5942 263.999 49.2339 263.198C49.8784 262.393 50.2007 261.323 50.2007 259.99Z" fill="black"></path>
<path d="M195.883 103.548C196.195 103.568 196.505 103.583 196.813 103.592C197.121 103.602 197.421 103.607 197.714 103.607C197.924 103.607 198.166 103.602 198.439 103.592C198.712 103.583 199.013 103.568 199.34 103.548V104.039H199.274C198.717 104.039 198.183 104.281 197.67 104.764L197.597 104.837L193.964 108.316L197.311 111.678C197.399 111.766 197.523 111.891 197.685 112.052C198.627 113.019 199.318 113.502 199.757 113.502C199.811 113.502 199.853 113.502 199.882 113.502C199.911 113.497 199.933 113.492 199.948 113.487L199.955 114C199.877 113.995 199.772 113.99 199.64 113.985C199.132 113.956 198.786 113.941 198.6 113.941C198.415 113.941 198.202 113.946 197.963 113.956C197.729 113.966 197.477 113.98 197.208 114C197.213 113.985 197.216 113.976 197.216 113.971C197.221 113.961 197.223 113.946 197.223 113.927C197.223 113.673 196.444 112.772 194.887 111.224C193.944 110.282 193.178 109.508 192.587 108.902L195.407 105.855C195.534 105.714 195.707 105.528 195.927 105.299C196.42 104.767 196.667 104.452 196.667 104.354C196.667 104.247 196.618 104.168 196.52 104.12C196.427 104.066 196.276 104.039 196.066 104.039H195.883V103.548ZM190.053 103.548C190.399 103.568 190.731 103.583 191.049 103.592C191.366 103.602 191.654 103.607 191.913 103.607C192.216 103.607 192.523 103.602 192.836 103.592C193.148 103.583 193.466 103.568 193.788 103.548V104.039H193.693C193.253 104.039 192.958 104.149 192.807 104.369C192.66 104.588 192.587 105.155 192.587 106.068V111.422C192.587 112.379 192.658 112.965 192.799 113.18C192.941 113.395 193.224 113.502 193.649 113.502C193.673 113.502 193.712 113.5 193.766 113.495C193.82 113.49 193.861 113.487 193.891 113.487V114C193.524 113.98 193.173 113.966 192.836 113.956C192.504 113.946 192.196 113.941 191.913 113.941C191.688 113.941 191.413 113.946 191.085 113.956C190.758 113.966 190.399 113.98 190.009 114V113.495C190.038 113.495 190.07 113.497 190.104 113.502C190.138 113.502 190.185 113.502 190.243 113.502C190.629 113.502 190.89 113.368 191.027 113.099C191.168 112.826 191.239 112.22 191.239 111.283C191.239 111.156 191.237 110.917 191.232 110.565C191.227 110.213 191.225 109.928 191.225 109.708V107.76C191.225 107.516 191.227 107.206 191.232 106.83C191.237 106.449 191.239 106.19 191.239 106.053C191.239 105.208 191.168 104.662 191.027 104.413C190.89 104.164 190.629 104.039 190.243 104.039C190.229 104.039 190.199 104.042 190.155 104.046C190.111 104.051 190.077 104.054 190.053 104.054V103.548Z" fill="black"></path>
<path d="M169.366 348.863C169.366 349.225 169.386 349.581 169.425 349.933C169.469 350.284 169.535 350.631 169.623 350.973L169.051 351.083C168.968 350.477 168.734 350.028 168.348 349.735C167.967 349.442 167.428 349.295 166.729 349.295C166.085 349.295 165.56 349.452 165.155 349.764C164.754 350.077 164.554 350.479 164.554 350.973C164.554 351.783 165.414 352.477 167.132 353.053C167.362 353.126 167.538 353.185 167.66 353.229C168.446 353.502 169.024 353.854 169.396 354.283C169.767 354.708 169.952 355.235 169.952 355.865C169.952 356.837 169.583 357.625 168.846 358.231C168.109 358.832 167.132 359.132 165.917 359.132C165.453 359.132 164.999 359.093 164.554 359.015C164.115 358.941 163.668 358.824 163.214 358.663C163.219 358.614 163.221 358.558 163.221 358.495C163.226 358.426 163.229 358.329 163.229 358.202C163.229 357.855 163.209 357.513 163.17 357.176C163.131 356.839 163.072 356.502 162.994 356.166L163.653 356.012C163.736 356.812 163.988 357.398 164.408 357.77C164.828 358.141 165.45 358.326 166.275 358.326C166.998 358.326 167.586 358.146 168.041 357.784C168.495 357.418 168.722 356.949 168.722 356.378C168.722 355.567 168.014 354.938 166.598 354.488C166.397 354.425 166.241 354.374 166.129 354.334C165.147 354.017 164.444 353.629 164.02 353.17C163.595 352.711 163.382 352.125 163.382 351.412C163.382 350.572 163.714 349.872 164.378 349.31C165.042 348.749 165.875 348.468 166.876 348.468C167.242 348.468 167.613 348.497 167.989 348.556C168.365 348.614 168.824 348.717 169.366 348.863ZM176.668 357.557L177.035 358.114C176.561 358.475 176.095 358.749 175.636 358.934C175.177 359.12 174.742 359.212 174.332 359.212C173.375 359.212 172.594 358.871 171.988 358.187C171.383 357.499 171.08 356.62 171.08 355.55C171.08 354.442 171.463 353.504 172.23 352.738C172.997 351.971 173.932 351.588 175.035 351.588C175.602 351.588 176.039 351.668 176.346 351.83C176.654 351.986 176.808 352.206 176.808 352.489C176.808 352.694 176.744 352.872 176.617 353.023C176.495 353.17 176.354 353.243 176.192 353.243C176.139 353.243 175.912 353.121 175.511 352.877C175.116 352.628 174.737 352.503 174.376 352.503C173.741 352.503 173.236 352.733 172.86 353.192C172.489 353.646 172.303 354.266 172.303 355.052C172.303 356.043 172.528 356.817 172.977 357.374C173.431 357.926 174.059 358.202 174.859 358.202C175.157 358.202 175.453 358.15 175.746 358.048C176.043 357.945 176.351 357.782 176.668 357.557ZM181.327 352.372C180.672 352.372 180.145 352.611 179.745 353.089C179.349 353.563 179.151 354.203 179.151 355.008C179.151 356.039 179.371 356.874 179.811 357.513C180.255 358.153 180.831 358.473 181.539 358.473C182.223 358.473 182.767 358.219 183.172 357.711C183.583 357.203 183.788 356.512 183.788 355.638C183.788 354.681 183.556 353.897 183.092 353.287C182.633 352.677 182.044 352.372 181.327 352.372ZM181.517 351.603C182.547 351.603 183.399 351.949 184.073 352.643C184.752 353.331 185.091 354.186 185.091 355.206C185.091 356.329 184.735 357.276 184.022 358.048C183.309 358.814 182.43 359.198 181.385 359.198C180.34 359.198 179.481 358.846 178.807 358.143C178.138 357.44 177.804 356.551 177.804 355.477C177.804 354.403 178.167 353.49 178.895 352.738C179.627 351.981 180.501 351.603 181.517 351.603ZM188.314 351.515C188.28 351.847 188.253 352.184 188.233 352.525C188.214 352.862 188.199 353.221 188.189 353.602C188.585 352.904 188.949 352.401 189.281 352.093C189.618 351.786 189.964 351.632 190.321 351.632C190.599 351.632 190.819 351.708 190.98 351.859C191.141 352.005 191.222 352.206 191.222 352.459C191.222 352.64 191.168 352.796 191.061 352.928C190.958 353.055 190.836 353.119 190.694 353.119C190.606 353.119 190.47 353.072 190.284 352.979C190.104 352.882 189.947 352.833 189.815 352.833C189.562 352.833 189.308 352.945 189.054 353.17C188.8 353.39 188.534 353.734 188.255 354.203V355.008C188.255 355.79 188.26 356.424 188.27 356.913C188.285 357.396 188.304 357.704 188.329 357.835C188.373 358.084 188.465 358.255 188.607 358.348C188.753 358.441 189 358.487 189.347 358.487H189.559V359C189.178 358.971 188.839 358.949 188.541 358.934C188.243 358.919 187.992 358.912 187.787 358.912C187.503 358.912 187.21 358.919 186.908 358.934C186.61 358.949 186.297 358.971 185.97 359V358.487H186.139C186.495 358.487 186.737 358.402 186.864 358.231C186.991 358.06 187.054 357.662 187.054 357.037V356.268V353.888C187.054 353.36 187.018 353.021 186.944 352.87C186.871 352.718 186.737 352.643 186.542 352.643C186.502 352.643 186.461 352.645 186.417 352.65C186.373 352.65 186.3 352.657 186.197 352.672L186.109 352.218C186.456 352.14 186.812 352.042 187.179 351.925C187.545 351.808 187.923 351.671 188.314 351.515ZM198.238 354.906H194.664C194.386 354.906 194.129 354.911 193.895 354.92C193.661 354.93 193.443 354.945 193.243 354.964V355.235C193.243 356.192 193.463 356.932 193.902 357.455C194.347 357.977 194.972 358.238 195.777 358.238C196.134 358.238 196.485 358.18 196.832 358.062C197.179 357.94 197.547 357.752 197.938 357.499L198.224 357.967C197.721 358.377 197.218 358.688 196.715 358.897C196.217 359.107 195.724 359.212 195.235 359.212C194.288 359.212 193.507 358.875 192.892 358.202C192.276 357.523 191.969 356.654 191.969 355.594C191.969 354.466 192.291 353.519 192.936 352.752C193.58 351.986 194.366 351.603 195.294 351.603C196.158 351.603 196.847 351.891 197.359 352.467C197.872 353.043 198.165 353.856 198.238 354.906ZM196.883 354.137C196.737 353.536 196.515 353.077 196.217 352.76C195.919 352.438 195.562 352.276 195.147 352.276C194.679 352.276 194.276 352.464 193.939 352.84C193.607 353.216 193.39 353.724 193.287 354.364C194.254 354.364 195.013 354.347 195.565 354.312C196.122 354.278 196.561 354.22 196.883 354.137ZM204.164 351.903C204.164 352.201 204.178 352.501 204.208 352.804C204.242 353.106 204.288 353.412 204.347 353.719L203.79 353.807C203.731 353.299 203.57 352.921 203.307 352.672C203.043 352.423 202.674 352.298 202.201 352.298C201.791 352.298 201.454 352.411 201.19 352.635C200.926 352.855 200.794 353.136 200.794 353.478C200.794 354.02 201.371 354.449 202.523 354.767C202.723 354.82 202.877 354.862 202.984 354.891C203.561 355.052 203.98 355.282 204.244 355.58C204.513 355.877 204.647 356.268 204.647 356.751C204.647 357.464 204.366 358.053 203.805 358.517C203.248 358.98 202.533 359.212 201.659 359.212C201.341 359.212 201.017 359.178 200.685 359.11C200.353 359.042 200.013 358.939 199.667 358.802C199.671 358.753 199.674 358.702 199.674 358.648C199.679 358.595 199.681 358.512 199.681 358.399C199.681 358.175 199.667 357.933 199.637 357.674C199.613 357.411 199.574 357.132 199.52 356.839L200.069 356.708C200.147 357.313 200.338 357.767 200.641 358.07C200.943 358.368 201.363 358.517 201.9 358.517C202.389 358.517 202.787 358.399 203.094 358.165C203.407 357.926 203.563 357.618 203.563 357.242C203.563 356.715 203.045 356.295 202.01 355.982C201.908 355.948 201.832 355.924 201.783 355.909C201.041 355.685 200.519 355.409 200.216 355.082C199.918 354.754 199.769 354.32 199.769 353.778C199.769 353.153 200.018 352.635 200.516 352.225C201.014 351.81 201.651 351.603 202.428 351.603C202.667 351.603 202.926 351.627 203.204 351.676C203.487 351.725 203.807 351.8 204.164 351.903ZM215.919 347.582L216.703 347.948C214.789 351.507 213.348 354.198 212.381 356.019C211.419 357.835 210.66 359.293 210.104 360.392L209.32 360.047C210.736 357.445 211.988 355.116 213.077 353.06C214.171 351 215.118 349.173 215.919 347.582ZM223.829 353.932C224.034 353.961 224.22 353.983 224.386 353.998C224.552 354.012 224.715 354.02 224.876 354.02C225.794 354.02 226.49 353.817 226.964 353.412C227.442 353.001 227.682 352.403 227.682 351.617C227.682 350.909 227.447 350.345 226.979 349.925C226.51 349.505 225.875 349.295 225.074 349.295C224.854 349.295 224.645 349.305 224.444 349.325C224.249 349.339 224.056 349.364 223.866 349.398C223.851 350.057 223.841 350.724 223.836 351.397C223.832 352.066 223.829 352.911 223.829 353.932ZM221.222 358.524C221.261 358.529 221.297 358.534 221.332 358.539C221.371 358.539 221.429 358.539 221.507 358.539C221.898 358.539 222.162 358.407 222.298 358.143C222.44 357.875 222.511 357.281 222.511 356.363C222.511 356.227 222.508 355.975 222.503 355.609C222.499 355.243 222.496 354.947 222.496 354.723V350.138C222.496 349.718 222.42 349.43 222.269 349.273C222.118 349.117 221.842 349.039 221.441 349.039H221.383V348.526C221.715 348.551 222.044 348.568 222.372 348.578C222.704 348.587 223.031 348.592 223.353 348.592C223.714 348.592 224.144 348.583 224.642 348.563C225.145 348.539 225.47 348.526 225.616 348.526C226.686 348.526 227.54 348.792 228.18 349.325C228.819 349.857 229.139 350.558 229.139 351.427C229.139 352.457 228.788 353.26 228.084 353.836C227.386 354.408 226.397 354.693 225.118 354.693C224.991 354.693 224.818 354.686 224.598 354.671C224.383 354.657 224.127 354.635 223.829 354.605V356.81C223.829 357.562 223.905 358.036 224.056 358.231C224.212 358.421 224.522 358.517 224.986 358.517C225.001 358.517 225.025 358.514 225.06 358.509C225.099 358.504 225.128 358.502 225.147 358.502C225.172 358.502 225.189 358.504 225.199 358.509C225.213 358.509 225.226 358.512 225.235 358.517L225.243 359C224.886 358.98 224.527 358.966 224.166 358.956C223.805 358.946 223.448 358.941 223.097 358.941C222.926 358.941 222.674 358.946 222.342 358.956C222.015 358.966 221.642 358.98 221.222 359V358.524Z" fill="black"></path>
<path d="M345.201 255.99C345.201 254.569 344.834 253.405 344.102 252.497C343.37 251.583 342.447 251.127 341.333 251.127C340.264 251.127 339.405 251.518 338.755 252.299C338.111 253.08 337.789 254.125 337.789 255.434C337.789 256.889 338.155 258.083 338.887 259.015C339.625 259.948 340.545 260.414 341.648 260.414C342.713 260.414 343.57 260.014 344.219 259.213C344.874 258.407 345.201 257.333 345.201 255.99ZM341.495 250.307C342.237 250.307 342.898 250.414 343.479 250.629C344.065 250.839 344.595 251.166 345.069 251.61C345.635 252.147 346.067 252.77 346.365 253.478C346.668 254.186 346.819 254.938 346.819 255.734C346.819 256.544 346.661 257.311 346.343 258.034C346.026 258.756 345.574 259.379 344.988 259.901C344.52 260.321 343.973 260.651 343.348 260.89C342.728 261.125 342.105 261.242 341.48 261.242C340.699 261.242 339.979 261.098 339.319 260.81C338.665 260.521 338.086 260.094 337.583 259.528C337.125 259.01 336.773 258.429 336.529 257.785C336.29 257.14 336.17 256.461 336.17 255.749C336.17 254.977 336.314 254.25 336.602 253.566C336.895 252.877 337.317 252.274 337.869 251.757C338.367 251.288 338.929 250.929 339.554 250.68C340.179 250.431 340.826 250.307 341.495 250.307Z" fill="black"></path>
<path d="M335.584 88.5483C335.95 88.5679 336.297 88.5825 336.624 88.5923C336.951 88.6021 337.239 88.6069 337.488 88.6069C337.801 88.6069 338.118 88.6021 338.44 88.5923C338.768 88.5825 339.102 88.5679 339.444 88.5483L339.437 89.0098C339.026 89.0439 338.753 89.0977 338.616 89.1709C338.484 89.2441 338.418 89.3711 338.418 89.5518C338.418 89.6885 338.443 89.8618 338.492 90.0718C338.545 90.2769 338.638 90.5625 338.77 90.9287L340.975 97.0957C342.151 94.1416 342.891 92.2275 343.194 91.3535C343.501 90.4746 343.655 89.8984 343.655 89.625C343.655 89.4004 343.594 89.2466 343.472 89.1636C343.355 89.0806 343.082 89.0293 342.652 89.0098V88.5483C342.945 88.5679 343.233 88.5825 343.516 88.5923C343.804 88.6021 344.085 88.6069 344.358 88.6069C344.593 88.6069 344.854 88.6021 345.142 88.5923C345.43 88.5825 345.73 88.5679 346.043 88.5483V89.0098H345.933C345.396 89.0098 344.939 89.4834 344.563 90.4307C344.48 90.6455 344.412 90.8115 344.358 90.9287C342.981 94.2344 342.095 96.3853 341.7 97.3813C341.304 98.3774 341.097 98.9561 341.077 99.1172H340.176C340.176 99 339.949 98.27 339.495 96.9272C339.041 95.5845 338.492 94.0635 337.847 92.3643C337.803 92.2422 337.74 92.0688 337.657 91.8442C336.949 89.9448 336.324 88.9951 335.782 88.9951C335.733 88.9951 335.694 88.9976 335.665 89.0024C335.64 89.0024 335.613 89.0049 335.584 89.0098V88.5483Z" fill="black"></path>
<g clip-path="url(#clip0_249_8276-attention-1-svg)">
<rect x="124.481" y="185" width="35" height="35" fill="#EF402C"></rect>
<rect opacity="0.75" x="160.481" y="185" width="35" height="35" fill="#EF402C"></rect>
<rect opacity="0.5" x="196.481" y="185" width="35" height="35" fill="#EF402C"></rect>
<rect opacity="0.25" x="232.481" y="185" width="35" height="35" fill="#EF402C"></rect>
<rect x="124.481" y="221" width="35" height="35" fill="#F78427"></rect>
<rect opacity="0.75" x="160.481" y="221" width="35" height="35" fill="#F78427"></rect>
<rect opacity="0.5" x="196.481" y="221" width="35" height="35" fill="#F78427"></rect>
<rect opacity="0.25" x="232.481" y="221" width="35" height="35" fill="#F78427"></rect>
<rect x="124.481" y="257" width="35" height="35" fill="#FFA8AA"></rect>
<rect opacity="0.75" x="160.481" y="257" width="35" height="35" fill="#FFA8AA"></rect>
<rect opacity="0.5" x="196.481" y="257" width="35" height="35" fill="#FFA8AA"></rect>
<rect opacity="0.25" x="232.481" y="257" width="35" height="35" fill="#FFA8AA"></rect>
<rect x="124.481" y="293" width="35" height="35" fill="#824665"></rect>
<rect opacity="0.75" x="160.481" y="293" width="35" height="35" fill="#824665"></rect>
<rect opacity="0.5" x="196.481" y="293" width="35" height="35" fill="#824665"></rect>
<rect opacity="0.25" x="232.481" y="293" width="35" height="35" fill="#824665"></rect>
</g>
<path d="M124.481 132C124.481 130.895 125.377 130 126.481 130H159.481V165H124.481V132Z" fill="#E7E1DF"></path>
<rect opacity="0.75" x="160.481" y="130" width="35" height="35" fill="#E7E1DF"></rect>
<rect opacity="0.5" x="196.481" y="130" width="35" height="35" fill="#E7E1DF"></rect>
<rect opacity="0.25" x="232.481" y="130" width="35" height="35" fill="#E7E1DF"></rect>
<path d="M69.4814 184H104.481V219H69.4814V184Z" fill="#EF402C"></path>
<path d="M69.4814 220H104.481V255H69.4814V220Z" fill="#F78427"></path>
<path d="M69.4814 256H104.481V291H69.4814V256Z" fill="#FFA8AA"></path>
<path d="M69.4814 292H104.481V327H69.4814V292Z" fill="#824665"></path>
<path d="M287.481 184H322.481V219H287.481V184Z" fill="#EF402C"></path>
<path d="M287.481 220H322.481V255H287.481V220Z" fill="#F78427"></path>
<path d="M287.481 256H322.481V291H287.481V256Z" fill="#FFA8AA"></path>
<path d="M287.481 292H322.481V327H287.481V292Z" fill="#824665"></path>
<rect x="287.481" y="22" width="35" height="35" fill="#E7E1DF"></rect>
<rect opacity="0.75" x="287.481" y="58" width="35" height="35" fill="#E7E1DF"></rect>
<rect opacity="0.5" x="287.481" y="94" width="35" height="35" fill="#E7E1DF"></rect>
<rect opacity="0.25" x="287.481" y="130" width="35" height="35" fill="#E7E1DF"></rect>
<path d="M375.166 161.74C375.361 161.936 375.678 161.936 375.873 161.74L379.055 158.558C379.25 158.363 379.25 158.046 379.055 157.851C378.86 157.656 378.543 157.656 378.348 157.851L375.52 160.68L372.691 157.851C372.496 157.656 372.179 157.656 371.984 157.851C371.789 158.046 371.789 158.363 371.984 158.558L375.166 161.74ZM375.52 45.3867L375.02 45.3867L375.02 161.387L375.52 161.387L376.02 161.387L376.02 45.3867L375.52 45.3867Z" fill="black"></path>
<path d="M210.88 406.137C210.943 406.146 211.009 406.151 211.078 406.151C211.146 406.151 211.249 406.151 211.385 406.151C212.42 406.151 213.233 405.934 213.824 405.5C214.42 405.065 214.718 404.474 214.718 403.727C214.718 403.058 214.535 402.55 214.168 402.204C213.802 401.857 213.27 401.684 212.572 401.684C212.464 401.684 212.33 401.688 212.169 401.698C212.013 401.708 211.837 401.723 211.642 401.742C211.437 402.885 211.273 403.8 211.151 404.489C211.034 405.177 210.943 405.727 210.88 406.137ZM207.789 410.517H208.075C208.377 410.517 208.592 410.431 208.719 410.26C208.851 410.084 208.985 409.601 209.122 408.81L210.184 402.482C210.199 402.409 210.211 402.34 210.221 402.277C210.23 402.213 210.235 402.162 210.235 402.123C210.235 401.923 210.167 401.776 210.03 401.684C209.898 401.586 209.696 401.537 209.422 401.537H209.225L209.32 400.995C209.627 401.024 209.908 401.046 210.162 401.061C210.416 401.076 210.646 401.083 210.851 401.083C211.168 401.083 211.59 401.068 212.118 401.039C212.65 401.01 213.021 400.995 213.231 400.995C214.129 400.995 214.83 401.203 215.333 401.618C215.841 402.028 216.095 402.594 216.095 403.317C216.095 404.005 215.875 404.611 215.436 405.133C214.996 405.651 214.352 406.071 213.502 406.393L214.615 408.51C214.645 408.573 214.691 408.668 214.754 408.795C215.375 410.006 216.036 410.612 216.739 410.612C216.764 410.612 216.8 410.609 216.849 410.604C216.903 410.6 216.942 410.597 216.966 410.597L216.878 411.088C216.654 411.127 216.466 411.154 216.314 411.168C216.163 411.188 216.031 411.198 215.919 411.198C215.475 411.198 215.096 411.117 214.784 410.956C214.471 410.79 214.215 410.539 214.015 410.202C213.873 409.972 213.609 409.447 213.224 408.627C212.843 407.807 212.535 407.157 212.301 406.679C212.145 406.693 211.986 406.706 211.825 406.715C211.668 406.72 211.507 406.723 211.341 406.723C211.278 406.723 211.183 406.72 211.056 406.715C210.934 406.71 210.838 406.708 210.77 406.708L210.353 409.469C210.338 409.572 210.326 409.662 210.316 409.74C210.311 409.813 210.309 409.875 210.309 409.923C210.309 410.163 210.36 410.321 210.462 410.399C210.57 410.478 210.792 410.517 211.129 410.517H211.297L211.202 411C211.041 410.995 210.814 410.985 210.521 410.971C209.95 410.951 209.583 410.941 209.422 410.941C209.173 410.941 208.734 410.956 208.104 410.985C207.933 410.99 207.796 410.995 207.694 411L207.789 410.517ZM219.339 407.697L219.413 407.66C221.151 406.771 222.02 406.085 222.02 405.602C222.02 405.343 221.927 405.119 221.742 404.928C221.556 404.738 221.339 404.643 221.09 404.643C220.704 404.643 220.357 404.909 220.05 405.441C219.742 405.973 219.505 406.725 219.339 407.697ZM221.544 407.191L219.303 408.349V408.422C219.303 409.003 219.393 409.445 219.574 409.748C219.759 410.05 220.025 410.202 220.372 410.202C220.577 410.202 220.833 410.111 221.141 409.931C221.454 409.745 221.852 409.447 222.335 409.037L222.591 409.499C221.893 410.143 221.336 410.59 220.921 410.839C220.511 411.088 220.138 411.212 219.801 411.212C219.288 411.212 218.873 410.99 218.556 410.546C218.238 410.102 218.08 409.518 218.08 408.795C218.08 408.283 218.163 407.733 218.329 407.147C218.5 406.557 218.719 406.042 218.988 405.602C219.325 405.065 219.71 404.65 220.145 404.357C220.58 404.064 221.029 403.917 221.493 403.917C221.966 403.917 222.362 404.069 222.679 404.372C223.001 404.669 223.163 405.033 223.163 405.463C223.163 405.81 223.065 406.098 222.87 406.327C222.679 406.552 222.237 406.84 221.544 407.191ZM227.887 408.378L228.436 405.06C228.167 404.904 227.928 404.792 227.718 404.723C227.508 404.65 227.313 404.613 227.132 404.613C226.532 404.613 226.026 404.999 225.616 405.771C225.206 406.537 225.001 407.494 225.001 408.642C225.001 409.105 225.055 409.457 225.162 409.696C225.274 409.936 225.438 410.055 225.653 410.055C225.799 410.055 226.07 409.906 226.466 409.608C226.866 409.311 227.34 408.9 227.887 408.378ZM227.901 409.125L226.656 410.253C226.29 410.585 225.997 410.814 225.777 410.941C225.562 411.068 225.36 411.132 225.169 411.132C224.73 411.132 224.393 410.946 224.159 410.575C223.924 410.199 223.807 409.66 223.807 408.957C223.807 407.57 224.156 406.378 224.854 405.382C225.558 404.386 226.393 403.888 227.359 403.888C227.555 403.888 227.752 403.915 227.953 403.969C228.158 404.018 228.37 404.091 228.59 404.188L229.007 401.537C229.022 401.435 229.032 401.332 229.037 401.229C229.046 401.122 229.051 401.015 229.051 400.907C229.051 400.712 229.012 400.578 228.934 400.504C228.856 400.431 228.712 400.395 228.502 400.395C228.438 400.395 228.373 400.397 228.304 400.402C228.241 400.402 228.17 400.404 228.092 400.409L228.062 399.977C228.468 399.938 228.875 399.884 229.286 399.816C229.701 399.748 230.118 399.665 230.538 399.567C230.084 401.911 229.71 404.027 229.417 405.917C229.125 407.802 228.978 408.947 228.978 409.352C228.978 409.601 229 409.777 229.044 409.879C229.093 409.977 229.171 410.026 229.278 410.026C229.337 410.026 229.405 410.001 229.483 409.953C229.566 409.904 229.669 409.823 229.791 409.711L230.238 409.308L230.479 409.726L229.637 410.553C229.344 410.836 229.132 411.017 229 411.095C228.868 411.173 228.741 411.212 228.619 411.212C228.36 411.212 228.17 411.09 228.048 410.846C227.931 410.602 227.872 410.224 227.872 409.711C227.872 409.599 227.875 409.499 227.879 409.411C227.884 409.318 227.892 409.223 227.901 409.125ZM237.972 409.77L236.961 410.714C236.781 410.89 236.617 411.015 236.471 411.088C236.329 411.161 236.183 411.198 236.031 411.198C235.812 411.198 235.633 411.093 235.497 410.883C235.365 410.668 235.299 410.382 235.299 410.026C235.299 409.923 235.306 409.801 235.321 409.66C235.34 409.513 235.377 409.286 235.431 408.979C234.527 409.901 233.888 410.502 233.512 410.78C233.136 411.059 232.816 411.198 232.552 411.198C232.274 411.198 232.042 411.068 231.856 410.81C231.671 410.551 231.578 410.219 231.578 409.813C231.578 409.472 231.725 408.703 232.018 407.506C232.091 407.223 232.145 407.008 232.179 406.862C232.281 406.457 232.357 406.132 232.406 405.888C232.455 405.639 232.479 405.453 232.479 405.331C232.479 405.233 232.455 405.155 232.406 405.097C232.357 405.033 232.296 405.001 232.223 405.001C232.174 405.001 232.079 405.036 231.937 405.104C231.795 405.172 231.6 405.277 231.351 405.419L231.146 405.016C231.6 404.679 231.998 404.418 232.34 404.232C232.682 404.042 232.923 403.947 233.065 403.947C233.265 403.947 233.421 404.032 233.534 404.203C233.651 404.374 233.709 404.611 233.709 404.914C233.709 405.294 233.558 406.032 233.255 407.125C232.958 408.219 232.809 409.04 232.809 409.586C232.809 409.757 232.838 409.884 232.896 409.967C232.955 410.045 233.045 410.084 233.167 410.084C233.304 410.084 233.536 409.95 233.863 409.682C234.195 409.408 234.75 408.888 235.526 408.122C235.711 407.243 235.86 406.5 235.973 405.895C236.09 405.285 236.18 404.74 236.244 404.262L237.562 403.947L237.401 404.672C237.123 405.858 236.971 406.52 236.947 406.657L236.771 407.594C236.683 408.039 236.612 408.463 236.559 408.869C236.51 409.274 236.485 409.56 236.485 409.726C236.485 409.838 236.507 409.926 236.551 409.989C236.595 410.053 236.654 410.084 236.727 410.084C236.795 410.084 236.922 410.019 237.108 409.887C237.293 409.755 237.506 409.577 237.745 409.352L237.972 409.77ZM243.275 405.177L242.887 405.558C242.564 405.231 242.306 405.014 242.11 404.906C241.92 404.799 241.725 404.745 241.524 404.745C241.075 404.745 240.685 405.08 240.353 405.749C240.021 406.413 239.854 407.233 239.854 408.209C239.854 408.864 239.94 409.357 240.111 409.689C240.282 410.021 240.533 410.187 240.865 410.187C241.051 410.187 241.305 410.082 241.627 409.872C241.949 409.657 242.289 409.364 242.645 408.993L242.945 409.513C242.379 410.114 241.896 410.548 241.495 410.817C241.095 411.081 240.729 411.212 240.396 411.212C239.869 411.212 239.447 410.983 239.129 410.524C238.817 410.065 238.661 409.445 238.661 408.664C238.661 407.326 239.002 406.198 239.686 405.28C240.375 404.362 241.222 403.903 242.228 403.903C242.594 403.903 242.906 403.981 243.165 404.137C243.429 404.293 243.561 404.472 243.561 404.672C243.561 404.75 243.539 404.828 243.495 404.906C243.456 404.984 243.382 405.075 243.275 405.177ZM247.274 402.24C247.181 402.567 247.052 403.08 246.886 403.778C246.837 403.983 246.8 404.135 246.776 404.232C247.064 404.232 247.357 404.23 247.655 404.225C247.958 404.215 248.275 404.203 248.607 404.188L248.431 404.921C248.299 404.916 248.153 404.914 247.992 404.914C247.831 404.914 247.572 404.914 247.215 404.914H246.629C246.4 405.919 246.229 406.798 246.117 407.55C246.009 408.302 245.956 408.932 245.956 409.44C245.956 409.655 245.99 409.823 246.058 409.945C246.131 410.067 246.231 410.128 246.358 410.128C246.456 410.128 246.61 410.05 246.82 409.894C247.03 409.738 247.315 409.486 247.677 409.14L247.933 409.608C247.23 410.331 246.747 410.792 246.483 410.993C246.219 411.188 245.997 411.286 245.816 411.286C245.479 411.286 245.211 411.127 245.011 410.81C244.811 410.492 244.71 410.06 244.71 409.513C244.71 409.157 244.767 408.646 244.879 407.982C244.991 407.313 245.204 406.278 245.516 404.877C245.438 404.877 245.335 404.879 245.208 404.884C245.086 404.889 245.003 404.892 244.959 404.892H244.454L244.542 404.401C244.767 404.391 244.972 404.352 245.157 404.284C245.348 404.215 245.538 404.108 245.729 403.961C245.772 403.786 245.821 403.603 245.875 403.412C245.934 403.217 246 403.012 246.073 402.797L247.274 402.24ZM252.115 409.337L252.372 409.77C251.771 410.39 251.354 410.785 251.119 410.956C250.885 411.127 250.677 411.212 250.497 411.212C250.238 411.212 250.03 411.105 249.874 410.89C249.718 410.67 249.64 410.377 249.64 410.011C249.64 409.552 249.784 408.786 250.072 407.711C250.365 406.637 250.511 405.863 250.511 405.39C250.511 405.268 250.482 405.17 250.423 405.097C250.365 405.023 250.289 404.987 250.196 404.987C250.118 404.987 250.016 405.019 249.889 405.082C249.762 405.146 249.603 405.243 249.413 405.375L249.193 404.987L250.167 404.276C250.353 404.14 250.514 404.042 250.65 403.983C250.787 403.92 250.917 403.888 251.039 403.888C251.268 403.888 251.449 403.983 251.581 404.174C251.717 404.359 251.786 404.616 251.786 404.943C251.786 405.299 251.659 405.998 251.405 407.038C251.346 407.272 251.302 407.448 251.273 407.565C251.136 408.117 251.031 408.573 250.958 408.935C250.89 409.296 250.855 409.545 250.855 409.682C250.855 409.804 250.882 409.904 250.936 409.982C250.99 410.06 251.058 410.099 251.141 410.099C251.219 410.099 251.322 410.05 251.449 409.953C251.576 409.855 251.798 409.65 252.115 409.337ZM252.057 399.896L252.474 400.365C252.591 400.487 252.672 400.597 252.716 400.695C252.765 400.788 252.789 400.883 252.789 400.98C252.789 401.083 252.752 401.181 252.679 401.273C252.611 401.366 252.508 401.454 252.372 401.537L251.727 401.896L251.258 401.339C251.161 401.217 251.097 401.122 251.068 401.054C251.039 400.98 251.024 400.905 251.024 400.827C251.024 400.714 251.053 400.617 251.112 400.534C251.17 400.446 251.271 400.36 251.412 400.277L252.057 399.896ZM256.649 404.628C256.083 404.628 255.594 405.016 255.184 405.792C254.774 406.569 254.569 407.526 254.569 408.664C254.569 409.264 254.671 409.723 254.876 410.041C255.086 410.358 255.389 410.517 255.785 410.517C256.38 410.517 256.886 410.136 257.301 409.374C257.721 408.607 257.931 407.67 257.931 406.562C257.931 405.902 257.826 405.417 257.616 405.104C257.406 404.787 257.083 404.628 256.649 404.628ZM256.964 403.917C257.691 403.917 258.243 404.145 258.619 404.599C259 405.048 259.19 405.707 259.19 406.576C259.19 407.074 259.093 407.606 258.897 408.173C258.702 408.734 258.438 409.242 258.106 409.696C257.75 410.185 257.345 410.561 256.891 410.824C256.441 411.083 255.968 411.212 255.47 411.212C254.815 411.212 254.293 410.976 253.902 410.502C253.517 410.028 253.324 409.394 253.324 408.598C253.324 408.007 253.419 407.431 253.609 406.869C253.8 406.308 254.073 405.8 254.43 405.346C254.781 404.892 255.179 404.54 255.624 404.291C256.073 404.042 256.52 403.917 256.964 403.917ZM262.369 406.02L263.556 404.862C263.971 404.467 264.283 404.206 264.493 404.079C264.708 403.952 264.911 403.888 265.101 403.888C265.423 403.888 265.685 404.03 265.885 404.313C266.09 404.596 266.192 404.97 266.192 405.434C266.192 405.907 266.073 406.64 265.833 407.631C265.594 408.617 265.475 409.32 265.475 409.74C265.475 409.867 265.499 409.965 265.548 410.033C265.597 410.097 265.667 410.128 265.76 410.128C265.804 410.128 265.858 410.111 265.921 410.077C265.99 410.038 266.056 409.987 266.119 409.923L266.676 409.381L266.932 409.77L266.134 410.583C265.943 410.778 265.753 410.932 265.562 411.044C265.377 411.156 265.213 411.212 265.072 411.212C264.828 411.212 264.627 411.107 264.471 410.897C264.32 410.683 264.244 410.402 264.244 410.055C264.244 409.64 264.369 408.91 264.618 407.865C264.867 406.815 264.991 406.051 264.991 405.573C264.991 405.392 264.952 405.248 264.874 405.141C264.801 405.028 264.701 404.972 264.574 404.972C264.383 404.972 263.8 405.424 262.823 406.327C262.564 406.566 262.362 406.754 262.215 406.891L261.754 409.469C261.744 409.518 261.729 409.591 261.71 409.689C261.607 410.211 261.546 410.612 261.527 410.89L260.223 411.212C260.545 409.811 260.799 408.593 260.985 407.558C261.175 406.522 261.271 405.844 261.271 405.521C261.271 405.326 261.249 405.187 261.205 405.104C261.161 405.016 261.09 404.972 260.992 404.972C260.934 404.972 260.836 405.006 260.699 405.075C260.567 405.143 260.399 405.243 260.194 405.375L259.996 404.987C260.05 404.943 260.128 404.879 260.23 404.796C260.982 404.191 261.485 403.888 261.739 403.888C261.983 403.888 262.164 403.981 262.281 404.167C262.398 404.347 262.457 404.63 262.457 405.016C262.457 405.153 262.45 405.307 262.435 405.478C262.42 405.648 262.398 405.829 262.369 406.02Z" fill="black"></path>
<path d="M267.835 390.354C268.03 390.158 268.03 389.842 267.835 389.646L264.653 386.464C264.458 386.269 264.141 386.269 263.946 386.464C263.751 386.66 263.751 386.976 263.946 387.172L266.774 390L263.946 392.828C263.751 393.024 263.751 393.34 263.946 393.536C264.141 393.731 264.458 393.731 264.653 393.536L267.835 390.354ZM131.481 390V390.5H267.481V390V389.5H131.481V390Z" fill="black"></path>
<defs>
<clipPath id="clip0_249_8276-attention-1-svg">
<rect width="143" height="143" fill="white" transform="translate(124.481 185)"></rect>
</clipPath>
</defs>
</svg>

<figcaption><b>FlashAttention2 Strategy</b> We parallelize along Q, and reduce along K/V simultaneously. This means that our entire reduction can be kept within a single core, making it another data-parallel strategy.</figcaption>
</figure>
<p>After obtaining batch invariance for matmuls, attention introduces two additional wrinkles — fittingly,  because it contains two matmuls.</p>
<ol>
<li>As opposed to only reducing over the feature dimension like both RMSNorm and matmuls, we now reduce over the feature dimension <em>and</em> sequence dimension.</li>
<li>Due to the above, attention must deal with a variety of inference optimizations that affect how sequences get processed (chunked prefill, prefix caching, etc.).</li>
</ol>
<p>Thus, to achieve determinism in LLM inference our numerics must be invariant to both how many requests are processed at once <strong>and</strong> how each request gets sliced up in the inference engine.</p>
<p>Let’s first walk through the standard parallelism strategy for attention, first introduced in FlashAttention2. Similar to RMSNorm and Matmul, the default strategy is a “data-parallel” strategy. Since we reduce along the key/value tensors, a data-parallel strategy can only parallelize along the query tensor.</p>
<p>For example, depending on the inference engine’s choices, it’s possible that a sequence might get processed in several parts (such as in chunked prefill) or perhaps all at once (if the prefill isn’t split up). In order to achieve “batch invariance”, it’s necessary that the <em>reduction order for a given token does not depend on how many other tokens from its sequence are being simultaneously processed</em>. If you reduce over the K/V values in the KV cache separately from the K/V values in the current tokens being processed (like in vLLM’s <a href="https://github.com/vllm-project/vllm/blob/0ae43dbf8cb28a299ae724fc742b0c5bcddea868/vllm/attention/ops/prefix_prefill.py#L36">Triton attention kernel</a>), this can’t be achieved. For example, when processing the 1000th query token in a sequence, the reduction order must be identical regardless of whether 0 tokens are in the KV cache (prefill) or 999 tokens are in the KV cache (decoding).</p>
<figure>
<svg width="416" height="453" viewBox="0 0 416 453" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="416" height="453" fill="#F5F5F5"></rect>
<rect width="416" height="453" fill="white"></rect>
<path d="M31.8296 281.817L33.5068 282.828C34.3271 283.311 34.979 283.641 35.4624 283.816C35.9458 283.997 36.4048 284.087 36.8394 284.087C36.981 284.087 37.147 284.075 37.3374 284.051C37.5278 284.026 37.7573 283.987 38.0259 283.934L38.1138 284.388C37.4204 284.583 36.9053 284.71 36.5684 284.769C36.2363 284.832 35.9409 284.864 35.6821 284.864C34.6421 284.864 32.9038 284.039 30.4673 282.388L30.167 282.183C30.1328 282.183 30.0791 282.186 30.0059 282.19C29.9375 282.195 29.8862 282.198 29.8521 282.198C28.3579 282.198 27.1226 281.685 26.146 280.66C25.1743 279.634 24.6885 278.34 24.6885 276.778C24.6885 275.997 24.8325 275.264 25.1206 274.581C25.4136 273.897 25.8359 273.289 26.3877 272.757C26.876 272.288 27.4326 271.929 28.0576 271.68C28.6826 271.431 29.3345 271.307 30.0132 271.307C30.7456 271.307 31.4023 271.414 31.9834 271.629C32.5693 271.844 33.0991 272.171 33.5728 272.61C34.144 273.152 34.5811 273.777 34.8838 274.485C35.1865 275.193 35.3379 275.943 35.3379 276.734C35.3379 277.945 35.0327 278.995 34.4224 279.883C33.812 280.772 32.9478 281.417 31.8296 281.817ZM33.7192 276.99C33.7192 275.569 33.353 274.405 32.6206 273.497C31.8882 272.583 30.9653 272.127 29.8521 272.127C28.7827 272.127 27.9233 272.518 27.2739 273.299C26.6294 274.08 26.3071 275.125 26.3071 276.434C26.3071 277.903 26.6758 279.1 27.4131 280.022C28.1504 280.94 29.0879 281.399 30.2256 281.399C31.2705 281.399 32.1128 280.999 32.7524 280.198C33.397 279.393 33.7192 278.323 33.7192 276.99Z" fill="black"></path>
<path d="M142.401 120.548C142.714 120.568 143.024 120.583 143.332 120.592C143.639 120.602 143.939 120.607 144.232 120.607C144.442 120.607 144.684 120.602 144.958 120.592C145.231 120.583 145.531 120.568 145.858 120.548V121.039H145.792C145.236 121.039 144.701 121.281 144.188 121.764L144.115 121.837L140.482 125.316L143.83 128.678C143.917 128.766 144.042 128.891 144.203 129.052C145.146 130.019 145.836 130.502 146.276 130.502C146.33 130.502 146.371 130.502 146.4 130.502C146.43 130.497 146.452 130.492 146.466 130.487L146.474 131C146.396 130.995 146.291 130.99 146.159 130.985C145.651 130.956 145.304 130.941 145.119 130.941C144.933 130.941 144.721 130.946 144.481 130.956C144.247 130.966 143.996 130.98 143.727 131C143.732 130.985 143.734 130.976 143.734 130.971C143.739 130.961 143.742 130.946 143.742 130.927C143.742 130.673 142.963 129.772 141.405 128.224C140.463 127.282 139.696 126.508 139.105 125.902L141.925 122.855C142.052 122.714 142.226 122.528 142.445 122.299C142.938 121.767 143.185 121.452 143.185 121.354C143.185 121.247 143.136 121.168 143.039 121.12C142.946 121.066 142.794 121.039 142.584 121.039H142.401V120.548ZM136.571 120.548C136.918 120.568 137.25 120.583 137.567 120.592C137.885 120.602 138.173 120.607 138.432 120.607C138.734 120.607 139.042 120.602 139.354 120.592C139.667 120.583 139.984 120.568 140.307 120.548V121.039H140.211C139.772 121.039 139.477 121.149 139.325 121.369C139.179 121.588 139.105 122.155 139.105 123.068V128.422C139.105 129.379 139.176 129.965 139.318 130.18C139.459 130.395 139.743 130.502 140.167 130.502C140.192 130.502 140.231 130.5 140.285 130.495C140.338 130.49 140.38 130.487 140.409 130.487V131C140.043 130.98 139.691 130.966 139.354 130.956C139.022 130.946 138.715 130.941 138.432 130.941C138.207 130.941 137.931 130.946 137.604 130.956C137.277 130.966 136.918 130.98 136.527 131V130.495C136.557 130.495 136.588 130.497 136.623 130.502C136.657 130.502 136.703 130.502 136.762 130.502C137.147 130.502 137.409 130.368 137.545 130.099C137.687 129.826 137.758 129.22 137.758 128.283C137.758 128.156 137.755 127.917 137.75 127.565C137.746 127.213 137.743 126.928 137.743 126.708V124.76C137.743 124.516 137.746 124.206 137.75 123.83C137.755 123.449 137.758 123.19 137.758 123.053C137.758 122.208 137.687 121.662 137.545 121.413C137.409 121.164 137.147 121.039 136.762 121.039C136.747 121.039 136.718 121.042 136.674 121.046C136.63 121.051 136.596 121.054 136.571 121.054V120.548ZM156.647 129.557L157.013 130.114C156.54 130.475 156.073 130.749 155.614 130.934C155.155 131.12 154.721 131.212 154.311 131.212C153.354 131.212 152.572 130.871 151.967 130.187C151.361 129.499 151.059 128.62 151.059 127.55C151.059 126.442 151.442 125.504 152.208 124.738C152.975 123.971 153.91 123.588 155.014 123.588C155.58 123.588 156.017 123.668 156.325 123.83C156.632 123.986 156.786 124.206 156.786 124.489C156.786 124.694 156.723 124.872 156.596 125.023C156.474 125.17 156.332 125.243 156.171 125.243C156.117 125.243 155.89 125.121 155.49 124.877C155.094 124.628 154.716 124.503 154.354 124.503C153.72 124.503 153.214 124.733 152.838 125.192C152.467 125.646 152.282 126.266 152.282 127.052C152.282 128.043 152.506 128.817 152.956 129.374C153.41 129.926 154.037 130.202 154.838 130.202C155.136 130.202 155.431 130.15 155.724 130.048C156.022 129.945 156.33 129.782 156.647 129.557ZM164.323 129.938L164.528 130.399C164.162 130.663 163.827 130.866 163.524 131.007C163.222 131.154 162.978 131.227 162.792 131.227C162.479 131.227 162.245 131.137 162.089 130.956C161.933 130.771 161.847 130.492 161.833 130.121C161.3 130.478 160.858 130.734 160.507 130.89C160.155 131.042 159.84 131.117 159.562 131.117C159.069 131.117 158.656 130.932 158.324 130.561C157.992 130.189 157.826 129.735 157.826 129.198C157.826 128.285 158.81 127.597 160.778 127.133C161.242 127.025 161.603 126.94 161.862 126.876C161.862 126.793 161.864 126.674 161.869 126.518C161.884 126.195 161.891 125.985 161.891 125.888C161.891 125.38 161.786 125.006 161.576 124.767C161.366 124.523 161.046 124.401 160.617 124.401C160.197 124.401 159.865 124.479 159.621 124.635C159.381 124.787 159.262 124.994 159.262 125.258C159.262 125.282 159.264 125.316 159.269 125.36C159.274 125.399 159.276 125.429 159.276 125.448C159.276 125.6 159.203 125.727 159.057 125.829C158.91 125.927 158.734 125.976 158.529 125.976C158.354 125.976 158.224 125.946 158.141 125.888C158.058 125.829 158.017 125.739 158.017 125.617C158.017 125.226 158.346 124.792 159.005 124.313C159.665 123.83 160.346 123.588 161.049 123.588C161.728 123.588 162.243 123.776 162.594 124.152C162.946 124.523 163.122 125.07 163.122 125.792C163.122 126.183 163.097 126.784 163.048 127.594C163.004 128.405 162.982 129.02 162.982 129.44C162.982 129.757 163.017 129.972 163.085 130.084C163.158 130.197 163.285 130.253 163.466 130.253C163.544 130.253 163.644 130.231 163.766 130.187C163.893 130.138 164.079 130.055 164.323 129.938ZM161.825 127.462C161.732 127.487 161.593 127.523 161.408 127.572C159.821 128.007 159.027 128.52 159.027 129.11C159.027 129.433 159.13 129.696 159.335 129.901C159.54 130.102 159.811 130.202 160.148 130.202C160.353 130.202 160.59 130.148 160.858 130.041C161.127 129.933 161.439 129.762 161.796 129.528L161.825 127.462ZM170.578 129.557L170.944 130.114C170.47 130.475 170.004 130.749 169.545 130.934C169.086 131.12 168.651 131.212 168.241 131.212C167.284 131.212 166.503 130.871 165.897 130.187C165.292 129.499 164.989 128.62 164.989 127.55C164.989 126.442 165.373 125.504 166.139 124.738C166.906 123.971 167.841 123.588 168.944 123.588C169.511 123.588 169.948 123.668 170.255 123.83C170.563 123.986 170.717 124.206 170.717 124.489C170.717 124.694 170.653 124.872 170.526 125.023C170.404 125.17 170.263 125.243 170.102 125.243C170.048 125.243 169.821 125.121 169.42 124.877C169.025 124.628 168.646 124.503 168.285 124.503C167.65 124.503 167.145 124.733 166.769 125.192C166.398 125.646 166.212 126.266 166.212 127.052C166.212 128.043 166.437 128.817 166.886 129.374C167.34 129.926 167.968 130.202 168.769 130.202C169.066 130.202 169.362 130.15 169.655 130.048C169.953 129.945 170.26 129.782 170.578 129.557ZM173.939 119.677C173.92 120.497 173.903 121.334 173.888 122.189C173.874 123.043 173.864 123.92 173.859 124.818C174.406 124.403 174.894 124.098 175.324 123.903C175.753 123.703 176.144 123.603 176.496 123.603C177.213 123.603 177.753 123.805 178.114 124.21C178.476 124.616 178.656 125.224 178.656 126.034C178.656 126.039 178.654 126.254 178.649 126.679C178.644 127.104 178.642 127.528 178.642 127.953C178.642 128.134 178.639 128.361 178.634 128.634C178.629 128.903 178.627 129.086 178.627 129.184C178.627 129.73 178.676 130.087 178.773 130.253C178.871 130.419 179.057 130.502 179.33 130.502C179.345 130.502 179.372 130.5 179.411 130.495C179.455 130.49 179.489 130.487 179.513 130.487V131C179.069 130.971 178.734 130.951 178.51 130.941C178.285 130.932 178.1 130.927 177.953 130.927C177.719 130.927 177.465 130.934 177.191 130.949C176.923 130.958 176.642 130.976 176.349 131L176.342 130.487H176.452C177.077 130.487 177.396 129.916 177.411 128.773C177.411 128.71 177.411 128.661 177.411 128.627L177.426 127.052V126.752C177.426 125.863 177.321 125.275 177.111 124.987C176.901 124.694 176.54 124.547 176.027 124.547C175.749 124.547 175.438 124.616 175.097 124.752C174.76 124.889 174.362 125.106 173.903 125.404L173.866 128.012C173.866 128.158 173.864 128.346 173.859 128.576C173.854 128.805 173.852 128.964 173.852 129.052C173.852 129.657 173.9 130.05 173.998 130.231C174.096 130.412 174.284 130.502 174.562 130.502C174.582 130.502 174.611 130.5 174.65 130.495C174.694 130.49 174.728 130.487 174.752 130.487V131C174.445 130.976 174.154 130.958 173.881 130.949C173.612 130.934 173.378 130.927 173.178 130.927C172.987 130.927 172.768 130.932 172.519 130.941C172.27 130.951 171.945 130.968 171.544 130.993V130.487C171.574 130.487 171.615 130.49 171.669 130.495C171.723 130.5 171.762 130.502 171.786 130.502C172.123 130.502 172.35 130.414 172.467 130.238C172.584 130.058 172.643 129.538 172.643 128.678V128.136L172.672 122.628V121.369C172.672 121.159 172.626 121.002 172.533 120.9C172.445 120.792 172.311 120.739 172.13 120.739C172.062 120.739 171.95 120.753 171.793 120.783C171.754 120.792 171.728 120.797 171.713 120.797L171.603 120.321C172.003 120.243 172.396 120.153 172.782 120.05C173.168 119.943 173.554 119.818 173.939 119.677ZM186.815 126.906H183.241C182.963 126.906 182.707 126.911 182.472 126.92C182.238 126.93 182.021 126.945 181.82 126.964V127.235C181.82 128.192 182.04 128.932 182.479 129.455C182.924 129.977 183.549 130.238 184.354 130.238C184.711 130.238 185.062 130.18 185.409 130.062C185.756 129.94 186.125 129.752 186.515 129.499L186.801 129.967C186.298 130.377 185.795 130.688 185.292 130.897C184.794 131.107 184.301 131.212 183.812 131.212C182.865 131.212 182.084 130.875 181.469 130.202C180.854 129.523 180.546 128.654 180.546 127.594C180.546 126.466 180.868 125.519 181.513 124.752C182.157 123.986 182.943 123.603 183.871 123.603C184.735 123.603 185.424 123.891 185.937 124.467C186.449 125.043 186.742 125.856 186.815 126.906ZM185.46 126.137C185.314 125.536 185.092 125.077 184.794 124.76C184.496 124.438 184.14 124.276 183.725 124.276C183.256 124.276 182.853 124.464 182.516 124.84C182.184 125.216 181.967 125.724 181.864 126.364C182.831 126.364 183.59 126.347 184.142 126.312C184.699 126.278 185.138 126.22 185.46 126.137Z" fill="black"></path>
<path d="M244.401 120.548C244.714 120.568 245.024 120.583 245.332 120.592C245.639 120.602 245.939 120.607 246.232 120.607C246.442 120.607 246.684 120.602 246.958 120.592C247.231 120.583 247.531 120.568 247.858 120.548V121.039H247.792C247.236 121.039 246.701 121.281 246.188 121.764L246.115 121.837L242.482 125.316L245.83 128.678C245.917 128.766 246.042 128.891 246.203 129.052C247.146 130.019 247.836 130.502 248.276 130.502C248.33 130.502 248.371 130.502 248.4 130.502C248.43 130.497 248.452 130.492 248.466 130.487L248.474 131C248.396 130.995 248.291 130.99 248.159 130.985C247.651 130.956 247.304 130.941 247.119 130.941C246.933 130.941 246.721 130.946 246.481 130.956C246.247 130.966 245.996 130.98 245.727 131C245.732 130.985 245.734 130.976 245.734 130.971C245.739 130.961 245.742 130.946 245.742 130.927C245.742 130.673 244.963 129.772 243.405 128.224C242.463 127.282 241.696 126.508 241.105 125.902L243.925 122.855C244.052 122.714 244.226 122.528 244.445 122.299C244.938 121.767 245.185 121.452 245.185 121.354C245.185 121.247 245.136 121.168 245.039 121.12C244.946 121.066 244.794 121.039 244.584 121.039H244.401V120.548ZM238.571 120.548C238.918 120.568 239.25 120.583 239.567 120.592C239.885 120.602 240.173 120.607 240.432 120.607C240.734 120.607 241.042 120.602 241.354 120.592C241.667 120.583 241.984 120.568 242.307 120.548V121.039H242.211C241.772 121.039 241.477 121.149 241.325 121.369C241.179 121.588 241.105 122.155 241.105 123.068V128.422C241.105 129.379 241.176 129.965 241.318 130.18C241.459 130.395 241.743 130.502 242.167 130.502C242.192 130.502 242.231 130.5 242.285 130.495C242.338 130.49 242.38 130.487 242.409 130.487V131C242.043 130.98 241.691 130.966 241.354 130.956C241.022 130.946 240.715 130.941 240.432 130.941C240.207 130.941 239.931 130.946 239.604 130.956C239.277 130.966 238.918 130.98 238.527 131V130.495C238.557 130.495 238.588 130.497 238.623 130.502C238.657 130.502 238.703 130.502 238.762 130.502C239.147 130.502 239.409 130.368 239.545 130.099C239.687 129.826 239.758 129.22 239.758 128.283C239.758 128.156 239.755 127.917 239.75 127.565C239.746 127.213 239.743 126.928 239.743 126.708V124.76C239.743 124.516 239.746 124.206 239.75 123.83C239.755 123.449 239.758 123.19 239.758 123.053C239.758 122.208 239.687 121.662 239.545 121.413C239.409 121.164 239.147 121.039 238.762 121.039C238.747 121.039 238.718 121.042 238.674 121.046C238.63 121.051 238.596 121.054 238.571 121.054V120.548Z" fill="black"></path>
<path d="M140.164 370.932C140.369 370.961 140.555 370.983 140.721 370.998C140.887 371.012 141.05 371.02 141.211 371.02C142.129 371.02 142.825 370.817 143.299 370.412C143.777 370.001 144.017 369.403 144.017 368.617C144.017 367.909 143.782 367.345 143.313 366.925C142.845 366.505 142.21 366.295 141.409 366.295C141.189 366.295 140.979 366.305 140.779 366.325C140.584 366.339 140.391 366.364 140.201 366.398C140.186 367.057 140.176 367.724 140.171 368.397C140.167 369.066 140.164 369.911 140.164 370.932ZM137.557 375.524C137.596 375.529 137.632 375.534 137.667 375.539C137.706 375.539 137.764 375.539 137.842 375.539C138.233 375.539 138.497 375.407 138.633 375.143C138.775 374.875 138.846 374.281 138.846 373.363C138.846 373.227 138.843 372.975 138.838 372.609C138.833 372.243 138.831 371.947 138.831 371.723V367.138C138.831 366.718 138.755 366.43 138.604 366.273C138.453 366.117 138.177 366.039 137.776 366.039H137.718V365.526C138.05 365.551 138.379 365.568 138.707 365.578C139.039 365.587 139.366 365.592 139.688 365.592C140.049 365.592 140.479 365.583 140.977 365.563C141.48 365.539 141.805 365.526 141.951 365.526C143.021 365.526 143.875 365.792 144.515 366.325C145.154 366.857 145.474 367.558 145.474 368.427C145.474 369.457 145.123 370.26 144.419 370.836C143.721 371.408 142.732 371.693 141.453 371.693C141.326 371.693 141.153 371.686 140.933 371.671C140.718 371.657 140.462 371.635 140.164 371.605V373.81C140.164 374.562 140.24 375.036 140.391 375.231C140.547 375.421 140.857 375.517 141.321 375.517C141.336 375.517 141.36 375.514 141.395 375.509C141.434 375.504 141.463 375.502 141.482 375.502C141.507 375.502 141.524 375.504 141.534 375.509C141.548 375.509 141.561 375.512 141.57 375.517L141.578 376C141.221 375.98 140.862 375.966 140.501 375.956C140.14 375.946 139.783 375.941 139.432 375.941C139.261 375.941 139.009 375.946 138.677 375.956C138.35 375.966 137.977 375.98 137.557 376V375.524ZM156.08 374.557L156.446 375.114C155.972 375.475 155.506 375.749 155.047 375.934C154.588 376.12 154.153 376.212 153.743 376.212C152.786 376.212 152.005 375.871 151.399 375.187C150.794 374.499 150.491 373.62 150.491 372.55C150.491 371.442 150.875 370.504 151.641 369.738C152.408 368.971 153.343 368.588 154.446 368.588C155.013 368.588 155.45 368.668 155.757 368.83C156.065 368.986 156.219 369.206 156.219 369.489C156.219 369.694 156.155 369.872 156.028 370.023C155.906 370.17 155.765 370.243 155.604 370.243C155.55 370.243 155.323 370.121 154.922 369.877C154.527 369.628 154.148 369.503 153.787 369.503C153.152 369.503 152.647 369.733 152.271 370.192C151.9 370.646 151.714 371.266 151.714 372.052C151.714 373.043 151.939 373.817 152.388 374.374C152.842 374.926 153.47 375.202 154.271 375.202C154.568 375.202 154.864 375.15 155.157 375.048C155.455 374.945 155.762 374.782 156.08 374.557ZM163.755 374.938L163.96 375.399C163.594 375.663 163.26 375.866 162.957 376.007C162.654 376.154 162.41 376.227 162.225 376.227C161.912 376.227 161.678 376.137 161.521 375.956C161.365 375.771 161.28 375.492 161.265 375.121C160.733 375.478 160.291 375.734 159.939 375.89C159.588 376.042 159.273 376.117 158.995 376.117C158.501 376.117 158.089 375.932 157.757 375.561C157.425 375.189 157.259 374.735 157.259 374.198C157.259 373.285 158.243 372.597 160.21 372.133C160.674 372.025 161.036 371.94 161.294 371.876C161.294 371.793 161.297 371.674 161.302 371.518C161.316 371.195 161.324 370.985 161.324 370.888C161.324 370.38 161.219 370.006 161.009 369.767C160.799 369.523 160.479 369.401 160.049 369.401C159.629 369.401 159.297 369.479 159.053 369.635C158.814 369.787 158.694 369.994 158.694 370.258C158.694 370.282 158.697 370.316 158.702 370.36C158.707 370.399 158.709 370.429 158.709 370.448C158.709 370.6 158.636 370.727 158.489 370.829C158.343 370.927 158.167 370.976 157.962 370.976C157.786 370.976 157.657 370.946 157.574 370.888C157.491 370.829 157.449 370.739 157.449 370.617C157.449 370.226 157.779 369.792 158.438 369.313C159.097 368.83 159.778 368.588 160.481 368.588C161.16 368.588 161.675 368.776 162.027 369.152C162.378 369.523 162.554 370.07 162.554 370.792C162.554 371.183 162.53 371.784 162.481 372.594C162.437 373.405 162.415 374.02 162.415 374.44C162.415 374.757 162.449 374.972 162.518 375.084C162.591 375.197 162.718 375.253 162.898 375.253C162.977 375.253 163.077 375.231 163.199 375.187C163.326 375.138 163.511 375.055 163.755 374.938ZM161.258 372.462C161.165 372.487 161.026 372.523 160.84 372.572C159.253 373.007 158.46 373.52 158.46 374.11C158.46 374.433 158.562 374.696 158.768 374.901C158.973 375.102 159.244 375.202 159.581 375.202C159.786 375.202 160.022 375.148 160.291 375.041C160.56 374.933 160.872 374.762 161.229 374.528L161.258 372.462ZM170.01 374.557L170.376 375.114C169.903 375.475 169.437 375.749 168.978 375.934C168.519 376.12 168.084 376.212 167.674 376.212C166.717 376.212 165.936 375.871 165.33 375.187C164.725 374.499 164.422 373.62 164.422 372.55C164.422 371.442 164.805 370.504 165.572 369.738C166.338 368.971 167.273 368.588 168.377 368.588C168.943 368.588 169.38 368.668 169.688 368.83C169.996 368.986 170.149 369.206 170.149 369.489C170.149 369.694 170.086 369.872 169.959 370.023C169.837 370.17 169.695 370.243 169.534 370.243C169.48 370.243 169.253 370.121 168.853 369.877C168.458 369.628 168.079 369.503 167.718 369.503C167.083 369.503 166.578 369.733 166.202 370.192C165.831 370.646 165.645 371.266 165.645 372.052C165.645 373.043 165.87 373.817 166.319 374.374C166.773 374.926 167.4 375.202 168.201 375.202C168.499 375.202 168.794 375.15 169.087 375.048C169.385 374.945 169.693 374.782 170.01 374.557ZM173.372 364.677C173.353 365.497 173.335 366.334 173.321 367.189C173.306 368.043 173.296 368.92 173.292 369.818C173.838 369.403 174.327 369.098 174.756 368.903C175.186 368.703 175.577 368.603 175.928 368.603C176.646 368.603 177.186 368.805 177.547 369.21C177.908 369.616 178.089 370.224 178.089 371.034C178.089 371.039 178.086 371.254 178.082 371.679C178.077 372.104 178.074 372.528 178.074 372.953C178.074 373.134 178.072 373.361 178.067 373.634C178.062 373.903 178.06 374.086 178.06 374.184C178.06 374.73 178.108 375.087 178.206 375.253C178.304 375.419 178.489 375.502 178.763 375.502C178.777 375.502 178.804 375.5 178.843 375.495C178.887 375.49 178.921 375.487 178.946 375.487V376C178.501 375.971 178.167 375.951 177.942 375.941C177.718 375.932 177.532 375.927 177.386 375.927C177.151 375.927 176.897 375.934 176.624 375.949C176.355 375.958 176.075 375.976 175.782 376L175.774 375.487H175.884C176.509 375.487 176.829 374.916 176.844 373.773C176.844 373.71 176.844 373.661 176.844 373.627L176.858 372.052V371.752C176.858 370.863 176.753 370.275 176.543 369.987C176.333 369.694 175.972 369.547 175.459 369.547C175.181 369.547 174.871 369.616 174.529 369.752C174.192 369.889 173.794 370.106 173.335 370.404L173.299 373.012C173.299 373.158 173.296 373.346 173.292 373.576C173.287 373.805 173.284 373.964 173.284 374.052C173.284 374.657 173.333 375.05 173.431 375.231C173.528 375.412 173.716 375.502 173.995 375.502C174.014 375.502 174.043 375.5 174.083 375.495C174.126 375.49 174.161 375.487 174.185 375.487V376C173.877 375.976 173.587 375.958 173.313 375.949C173.045 375.934 172.811 375.927 172.61 375.927C172.42 375.927 172.2 375.932 171.951 375.941C171.702 375.951 171.377 375.968 170.977 375.993V375.487C171.006 375.487 171.048 375.49 171.102 375.495C171.155 375.5 171.194 375.502 171.219 375.502C171.556 375.502 171.783 375.414 171.9 375.238C172.017 375.058 172.076 374.538 172.076 373.678V373.136L172.105 367.628V366.369C172.105 366.159 172.059 366.002 171.966 365.9C171.878 365.792 171.744 365.739 171.563 365.739C171.495 365.739 171.382 365.753 171.226 365.783C171.187 365.792 171.16 365.797 171.146 365.797L171.036 365.321C171.436 365.243 171.829 365.153 172.215 365.05C172.601 364.943 172.986 364.818 173.372 364.677ZM186.248 371.906H182.674C182.396 371.906 182.139 371.911 181.905 371.92C181.67 371.93 181.453 371.945 181.253 371.964V372.235C181.253 373.192 181.473 373.932 181.912 374.455C182.356 374.977 182.981 375.238 183.787 375.238C184.144 375.238 184.495 375.18 184.842 375.062C185.188 374.94 185.557 374.752 185.948 374.499L186.233 374.967C185.73 375.377 185.228 375.688 184.725 375.897C184.227 376.107 183.733 376.212 183.245 376.212C182.298 376.212 181.517 375.875 180.901 375.202C180.286 374.523 179.979 373.654 179.979 372.594C179.979 371.466 180.301 370.519 180.945 369.752C181.59 368.986 182.376 368.603 183.304 368.603C184.168 368.603 184.856 368.891 185.369 369.467C185.882 370.043 186.175 370.856 186.248 371.906ZM184.893 371.137C184.747 370.536 184.524 370.077 184.227 369.76C183.929 369.438 183.572 369.276 183.157 369.276C182.688 369.276 182.286 369.464 181.949 369.84C181.617 370.216 181.399 370.724 181.297 371.364C182.264 371.364 183.023 371.347 183.575 371.312C184.131 371.278 184.571 371.22 184.893 371.137Z" fill="black"></path>
<path d="M242.164 370.932C242.369 370.961 242.555 370.983 242.721 370.998C242.887 371.012 243.05 371.02 243.211 371.02C244.129 371.02 244.825 370.817 245.299 370.412C245.777 370.001 246.017 369.403 246.017 368.617C246.017 367.909 245.782 367.345 245.313 366.925C244.845 366.505 244.21 366.295 243.409 366.295C243.189 366.295 242.979 366.305 242.779 366.325C242.584 366.339 242.391 366.364 242.201 366.398C242.186 367.057 242.176 367.724 242.171 368.397C242.167 369.066 242.164 369.911 242.164 370.932ZM239.557 375.524C239.596 375.529 239.632 375.534 239.667 375.539C239.706 375.539 239.764 375.539 239.842 375.539C240.233 375.539 240.497 375.407 240.633 375.143C240.775 374.875 240.846 374.281 240.846 373.363C240.846 373.227 240.843 372.975 240.838 372.609C240.833 372.243 240.831 371.947 240.831 371.723V367.138C240.831 366.718 240.755 366.43 240.604 366.273C240.453 366.117 240.177 366.039 239.776 366.039H239.718V365.526C240.05 365.551 240.379 365.568 240.707 365.578C241.039 365.587 241.366 365.592 241.688 365.592C242.049 365.592 242.479 365.583 242.977 365.563C243.48 365.539 243.805 365.526 243.951 365.526C245.021 365.526 245.875 365.792 246.515 366.325C247.154 366.857 247.474 367.558 247.474 368.427C247.474 369.457 247.123 370.26 246.419 370.836C245.721 371.408 244.732 371.693 243.453 371.693C243.326 371.693 243.153 371.686 242.933 371.671C242.718 371.657 242.462 371.635 242.164 371.605V373.81C242.164 374.562 242.24 375.036 242.391 375.231C242.547 375.421 242.857 375.517 243.321 375.517C243.336 375.517 243.36 375.514 243.395 375.509C243.434 375.504 243.463 375.502 243.482 375.502C243.507 375.502 243.524 375.504 243.534 375.509C243.548 375.509 243.561 375.512 243.57 375.517L243.578 376C243.221 375.98 242.862 375.966 242.501 375.956C242.14 375.946 241.783 375.941 241.432 375.941C241.261 375.941 241.009 375.946 240.677 375.956C240.35 375.966 239.977 375.98 239.557 376V375.524Z" fill="black"></path>
<path d="M312.719 370.99C312.719 369.569 312.353 368.405 311.621 367.497C310.888 366.583 309.965 366.127 308.852 366.127C307.783 366.127 306.923 366.518 306.274 367.299C305.629 368.08 305.307 369.125 305.307 370.434C305.307 371.889 305.673 373.083 306.406 374.015C307.143 374.948 308.063 375.414 309.167 375.414C310.231 375.414 311.088 375.014 311.738 374.213C312.392 373.407 312.719 372.333 312.719 370.99ZM309.013 365.307C309.755 365.307 310.417 365.414 310.998 365.629C311.584 365.839 312.114 366.166 312.587 366.61C313.154 367.147 313.586 367.77 313.884 368.478C314.187 369.186 314.338 369.938 314.338 370.734C314.338 371.544 314.179 372.311 313.862 373.034C313.544 373.756 313.093 374.379 312.507 374.901C312.038 375.321 311.491 375.651 310.866 375.89C310.246 376.125 309.624 376.242 308.999 376.242C308.217 376.242 307.497 376.098 306.838 375.81C306.184 375.521 305.605 375.094 305.102 374.528C304.643 374.01 304.292 373.429 304.047 372.785C303.808 372.14 303.688 371.461 303.688 370.749C303.688 369.977 303.833 369.25 304.121 368.566C304.414 367.877 304.836 367.274 305.388 366.757C305.886 366.288 306.447 365.929 307.072 365.68C307.697 365.431 308.344 365.307 309.013 365.307Z" fill="black"></path>
<path d="M340.103 150.548C340.469 150.568 340.815 150.583 341.143 150.592C341.47 150.602 341.758 150.607 342.007 150.607C342.319 150.607 342.637 150.602 342.959 150.592C343.286 150.583 343.621 150.568 343.962 150.548L343.955 151.01C343.545 151.044 343.271 151.098 343.135 151.171C343.003 151.244 342.937 151.371 342.937 151.552C342.937 151.688 342.961 151.862 343.01 152.072C343.064 152.277 343.157 152.562 343.289 152.929L345.493 159.096C346.67 156.142 347.41 154.228 347.712 153.354C348.02 152.475 348.174 151.898 348.174 151.625C348.174 151.4 348.113 151.247 347.991 151.164C347.874 151.081 347.6 151.029 347.17 151.01V150.548C347.463 150.568 347.751 150.583 348.035 150.592C348.323 150.602 348.604 150.607 348.877 150.607C349.111 150.607 349.373 150.602 349.661 150.592C349.949 150.583 350.249 150.568 350.562 150.548V151.01H350.452C349.915 151.01 349.458 151.483 349.082 152.431C348.999 152.646 348.931 152.812 348.877 152.929C347.5 156.234 346.614 158.385 346.218 159.381C345.823 160.377 345.615 160.956 345.596 161.117H344.695C344.695 161 344.468 160.27 344.014 158.927C343.56 157.584 343.01 156.063 342.366 154.364C342.322 154.242 342.258 154.069 342.175 153.844C341.467 151.945 340.842 150.995 340.3 150.995C340.251 150.995 340.212 150.998 340.183 151.002C340.159 151.002 340.132 151.005 340.103 151.01V150.548Z" fill="black"></path>
<path d="M340.103 30.5483C340.469 30.5679 340.815 30.5825 341.143 30.5923C341.47 30.6021 341.758 30.6069 342.007 30.6069C342.319 30.6069 342.637 30.6021 342.959 30.5923C343.286 30.5825 343.621 30.5679 343.962 30.5483L343.955 31.0098C343.545 31.0439 343.271 31.0977 343.135 31.1709C343.003 31.2441 342.937 31.3711 342.937 31.5518C342.937 31.6885 342.961 31.8618 343.01 32.0718C343.064 32.2769 343.157 32.5625 343.289 32.9287L345.493 39.0957C346.67 36.1416 347.41 34.2275 347.712 33.3535C348.02 32.4746 348.174 31.8984 348.174 31.625C348.174 31.4004 348.113 31.2466 347.991 31.1636C347.874 31.0806 347.6 31.0293 347.17 31.0098V30.5483C347.463 30.5679 347.751 30.5825 348.035 30.5923C348.323 30.6021 348.604 30.6069 348.877 30.6069C349.111 30.6069 349.373 30.6021 349.661 30.5923C349.949 30.5825 350.249 30.5679 350.562 30.5483V31.0098H350.452C349.915 31.0098 349.458 31.4834 349.082 32.4307C348.999 32.6455 348.931 32.8115 348.877 32.9287C347.5 36.2344 346.614 38.3853 346.218 39.3813C345.823 40.3774 345.615 40.9561 345.596 41.1172H344.695C344.695 41 344.468 40.27 344.014 38.9272C343.56 37.5845 343.01 36.0635 342.366 34.3643C342.322 34.2422 342.258 34.0688 342.175 33.8442C341.467 31.9448 340.842 30.9951 340.3 30.9951C340.251 30.9951 340.212 30.9976 340.183 31.0024C340.159 31.0024 340.132 31.0049 340.103 31.0098V30.5483ZM360.999 39.5571L361.365 40.1138C360.891 40.4751 360.425 40.7485 359.966 40.9341C359.507 41.1196 359.072 41.2124 358.662 41.2124C357.705 41.2124 356.924 40.8706 356.318 40.187C355.713 39.4985 355.41 38.6196 355.41 37.5503C355.41 36.4419 355.793 35.5044 356.56 34.7378C357.327 33.9712 358.262 33.5879 359.365 33.5879C359.932 33.5879 360.369 33.6685 360.676 33.8296C360.984 33.9858 361.138 34.2056 361.138 34.4888C361.138 34.6938 361.074 34.8721 360.947 35.0234C360.825 35.1699 360.684 35.2432 360.522 35.2432C360.469 35.2432 360.242 35.1211 359.841 34.877C359.446 34.6279 359.067 34.5034 358.706 34.5034C358.071 34.5034 357.566 34.7329 357.19 35.1919C356.819 35.646 356.633 36.2661 356.633 37.0522C356.633 38.0435 356.858 38.8174 357.307 39.374C357.761 39.9258 358.389 40.2017 359.189 40.2017C359.487 40.2017 359.783 40.1504 360.076 40.0479C360.374 39.9453 360.681 39.7817 360.999 39.5571ZM368.674 39.938L368.879 40.3994C368.513 40.6631 368.179 40.8657 367.876 41.0073C367.573 41.1538 367.329 41.2271 367.144 41.2271C366.831 41.2271 366.597 41.1367 366.44 40.9561C366.284 40.7705 366.199 40.4922 366.184 40.1211C365.652 40.4775 365.21 40.7339 364.858 40.8901C364.507 41.0415 364.192 41.1172 363.914 41.1172C363.42 41.1172 363.008 40.9316 362.676 40.5605C362.344 40.1895 362.178 39.7354 362.178 39.1982C362.178 38.2852 363.162 37.5967 365.129 37.1328C365.593 37.0254 365.955 36.9399 366.213 36.8765C366.213 36.7935 366.216 36.6738 366.221 36.5176C366.235 36.1953 366.243 35.9854 366.243 35.8877C366.243 35.3799 366.138 35.0063 365.928 34.7671C365.718 34.5229 365.398 34.4009 364.968 34.4009C364.548 34.4009 364.216 34.479 363.972 34.6353C363.733 34.7866 363.613 34.9941 363.613 35.2578C363.613 35.2822 363.616 35.3164 363.621 35.3604C363.625 35.3994 363.628 35.4287 363.628 35.4482C363.628 35.5996 363.555 35.7266 363.408 35.8291C363.262 35.9268 363.086 35.9756 362.881 35.9756C362.705 35.9756 362.576 35.9463 362.493 35.8877C362.41 35.8291 362.368 35.7388 362.368 35.6167C362.368 35.2261 362.698 34.7915 363.357 34.313C364.016 33.8296 364.697 33.5879 365.4 33.5879C366.079 33.5879 366.594 33.7759 366.946 34.1519C367.297 34.5229 367.473 35.0698 367.473 35.7925C367.473 36.1831 367.449 36.7837 367.4 37.5942C367.356 38.4048 367.334 39.02 367.334 39.4399C367.334 39.7573 367.368 39.9722 367.437 40.0845C367.51 40.1968 367.637 40.2529 367.817 40.2529C367.896 40.2529 367.996 40.231 368.118 40.187C368.245 40.1382 368.43 40.0552 368.674 39.938ZM366.177 37.4624C366.084 37.4868 365.945 37.5234 365.759 37.5723C364.172 38.0068 363.379 38.5195 363.379 39.1104C363.379 39.4326 363.481 39.6963 363.687 39.9014C363.892 40.1016 364.163 40.2017 364.5 40.2017C364.705 40.2017 364.941 40.1479 365.21 40.0405C365.479 39.9331 365.791 39.7622 366.147 39.5278L366.177 37.4624ZM374.929 39.5571L375.295 40.1138C374.822 40.4751 374.355 40.7485 373.896 40.9341C373.438 41.1196 373.003 41.2124 372.593 41.2124C371.636 41.2124 370.854 40.8706 370.249 40.187C369.644 39.4985 369.341 38.6196 369.341 37.5503C369.341 36.4419 369.724 35.5044 370.491 34.7378C371.257 33.9712 372.192 33.5879 373.296 33.5879C373.862 33.5879 374.299 33.6685 374.607 33.8296C374.915 33.9858 375.068 34.2056 375.068 34.4888C375.068 34.6938 375.005 34.8721 374.878 35.0234C374.756 35.1699 374.614 35.2432 374.453 35.2432C374.399 35.2432 374.172 35.1211 373.772 34.877C373.376 34.6279 372.998 34.5034 372.637 34.5034C372.002 34.5034 371.497 34.7329 371.121 35.1919C370.75 35.646 370.564 36.2661 370.564 37.0522C370.564 38.0435 370.789 38.8174 371.238 39.374C371.692 39.9258 372.319 40.2017 373.12 40.2017C373.418 40.2017 373.713 40.1504 374.006 40.0479C374.304 39.9453 374.612 39.7817 374.929 39.5571ZM378.291 29.6768C378.271 30.4971 378.254 31.3345 378.24 32.189C378.225 33.0435 378.215 33.9199 378.21 34.8184C378.757 34.4033 379.246 34.0981 379.675 33.9028C380.105 33.7026 380.496 33.6025 380.847 33.6025C381.565 33.6025 382.104 33.8052 382.466 34.2104C382.827 34.6157 383.008 35.2236 383.008 36.0342C383.008 36.0391 383.005 36.2539 383 36.6787C382.996 37.1035 382.993 37.5283 382.993 37.9531C382.993 38.1338 382.991 38.3608 382.986 38.6343C382.981 38.9028 382.979 39.0859 382.979 39.1836C382.979 39.7305 383.027 40.0869 383.125 40.2529C383.223 40.4189 383.408 40.502 383.682 40.502C383.696 40.502 383.723 40.4995 383.762 40.4946C383.806 40.4897 383.84 40.4873 383.865 40.4873V41C383.42 40.9707 383.086 40.9512 382.861 40.9414C382.637 40.9316 382.451 40.9268 382.305 40.9268C382.07 40.9268 381.816 40.9341 381.543 40.9487C381.274 40.9585 380.994 40.9756 380.701 41L380.693 40.4873H380.803C381.428 40.4873 381.748 39.916 381.763 38.7734C381.763 38.71 381.763 38.6611 381.763 38.627L381.777 37.0522V36.752C381.777 35.8633 381.672 35.2749 381.462 34.9868C381.252 34.6938 380.891 34.5474 380.378 34.5474C380.1 34.5474 379.79 34.6157 379.448 34.7524C379.111 34.8892 378.713 35.1064 378.254 35.4043L378.218 38.0117C378.218 38.1582 378.215 38.3462 378.21 38.5757C378.206 38.8052 378.203 38.9639 378.203 39.0518C378.203 39.6572 378.252 40.0503 378.35 40.231C378.447 40.4116 378.635 40.502 378.914 40.502C378.933 40.502 378.962 40.4995 379.001 40.4946C379.045 40.4897 379.08 40.4873 379.104 40.4873V41C378.796 40.9756 378.506 40.9585 378.232 40.9487C377.964 40.9341 377.729 40.9268 377.529 40.9268C377.339 40.9268 377.119 40.9316 376.87 40.9414C376.621 40.9512 376.296 40.9683 375.896 40.9927V40.4873C375.925 40.4873 375.967 40.4897 376.021 40.4946C376.074 40.4995 376.113 40.502 376.138 40.502C376.475 40.502 376.702 40.4141 376.819 40.2383C376.936 40.0576 376.995 39.5376 376.995 38.6782V38.1362L377.024 32.6284V31.3687C377.024 31.1587 376.978 31.0024 376.885 30.8999C376.797 30.7925 376.663 30.7388 376.482 30.7388C376.414 30.7388 376.301 30.7534 376.145 30.7827C376.106 30.7925 376.079 30.7974 376.064 30.7974L375.955 30.3213C376.355 30.2432 376.748 30.1528 377.134 30.0503C377.52 29.9429 377.905 29.8184 378.291 29.6768ZM391.167 36.9058H387.593C387.314 36.9058 387.058 36.9106 386.824 36.9204C386.589 36.9302 386.372 36.9448 386.172 36.9644V37.2354C386.172 38.1924 386.392 38.9321 386.831 39.4546C387.275 39.9771 387.9 40.2383 388.706 40.2383C389.062 40.2383 389.414 40.1797 389.761 40.0625C390.107 39.9404 390.476 39.7524 390.867 39.4985L391.152 39.9673C390.649 40.3774 390.146 40.6875 389.644 40.8975C389.146 41.1074 388.652 41.2124 388.164 41.2124C387.217 41.2124 386.436 40.8755 385.82 40.2017C385.205 39.5229 384.897 38.6538 384.897 37.5942C384.897 36.4663 385.22 35.519 385.864 34.7524C386.509 33.9858 387.295 33.6025 388.223 33.6025C389.087 33.6025 389.775 33.8906 390.288 34.4668C390.801 35.043 391.094 35.856 391.167 36.9058ZM389.812 36.1367C389.666 35.5361 389.443 35.0771 389.146 34.7598C388.848 34.4375 388.491 34.2764 388.076 34.2764C387.607 34.2764 387.205 34.4644 386.868 34.8403C386.536 35.2163 386.318 35.7241 386.216 36.3638C387.183 36.3638 387.942 36.3467 388.494 36.3125C389.05 36.2783 389.49 36.2197 389.812 36.1367Z" fill="black"></path>
<g clip-path="url(#clip0_249_8276-attention-2-svg)">
<rect x="108" y="202" width="35" height="35" fill="#EF402C"></rect>
<rect opacity="0.75" x="144" y="202" width="35" height="35" fill="#EF402C"></rect>
<rect opacity="0.5" x="180" y="202" width="17.5" height="35" fill="#EF402C"></rect>
<rect x="108" y="238" width="35" height="35" fill="#F78427"></rect>
<rect opacity="0.75" x="144" y="238" width="35" height="35" fill="#F78427"></rect>
<rect opacity="0.5" x="180" y="238" width="17.5" height="35" fill="#F78427"></rect>
<rect x="108" y="274" width="35" height="35" fill="#FFA8AA"></rect>
<rect opacity="0.8" x="144" y="274" width="35" height="35" fill="#FFA8AA"></rect>
<rect opacity="0.5" x="180" y="274" width="17.5" height="35" fill="#FFA8AA"></rect>
<rect x="108" y="310" width="35" height="35" fill="#824665"></rect>
<rect opacity="0.8" x="144" y="310" width="35" height="35" fill="#824665"></rect>
<rect opacity="0.5" x="180" y="310" width="17.5" height="35" fill="#824665"></rect>
</g>
<rect opacity="0.5" x="218" y="202" width="35" height="35" fill="#EF402C"></rect>
<rect opacity="0.5" x="218" y="238" width="35" height="35" fill="#F78427"></rect>
<rect opacity="0.5" x="218" y="274" width="35" height="35" fill="#FFA8AA"></rect>
<rect opacity="0.5" x="218" y="310" width="35" height="35" fill="#824665"></rect>
<rect opacity="0.25" x="254" y="202" width="17.5" height="35" fill="#EF402C"></rect>
<rect opacity="0.25" x="254" y="238" width="17.5" height="35" fill="#F78427"></rect>
<rect opacity="0.25" x="254" y="310" width="17.5" height="35" fill="#824665"></rect>
<rect opacity="0.25" x="254" y="274" width="17.5" height="35" fill="#FFA8AA"></rect>
<path d="M108 149C108 147.895 108.895 147 110 147H143V182H108V149Z" fill="#E7E1DF"></path>
<rect opacity="0.75" x="144" y="147" width="35" height="35" fill="#E7E1DF"></rect>
<rect opacity="0.5" x="180" y="147" width="17.5" height="35" fill="#E7E1DF"></rect>
<rect opacity="0.5" x="217" y="147" width="35" height="35" fill="#E7E1DF"></rect>
<rect opacity="0.4" x="253" y="147" width="17.5" height="35" fill="#E7E1DF"></rect>
<path d="M53 202H88V237H53V202Z" fill="#EF402C"></path>
<path d="M53 238H88V273H53V238Z" fill="#F78427"></path>
<path d="M53 274H88V309H53V274Z" fill="#FFA8AA"></path>
<path d="M53 310H88V345H53V310Z" fill="#824665"></path>
<path d="M292 202H327V237H292V202Z" fill="#EF402C"></path>
<path d="M292 238H327V273H292V238Z" fill="#F78427"></path>
<path d="M292 274H327V309H292V274Z" fill="#FFA8AA"></path>
<path d="M292 310H327V345H292V310Z" fill="#824665"></path>
<rect opacity="0.5" x="328" y="129.5" width="35" height="35" transform="rotate(90 328 129.5)" fill="#E7E1DF"></rect>
<rect opacity="0.4" x="328" y="165.5" width="17.5" height="35" transform="rotate(90 328 165.5)" fill="#E7E1DF"></rect>
<path d="M326 22C327.105 22 328 22.8954 328 24L328 57L293 57L293 22L326 22Z" fill="#E7E1DF"></path>
<rect opacity="0.75" x="328" y="58" width="35" height="35" transform="rotate(90 328 58)" fill="#E7E1DF"></rect>
<rect opacity="0.5" x="328" y="94" width="17.5" height="35" transform="rotate(90 328 94)" fill="#E7E1DF"></rect>
<path d="M366.646 345.354C366.842 345.549 367.158 345.549 367.354 345.354L370.536 342.172C370.731 341.976 370.731 341.66 370.536 341.464C370.34 341.269 370.024 341.269 369.828 341.464L367 344.293L364.172 341.464C363.976 341.269 363.66 341.269 363.464 341.464C363.269 341.66 363.269 341.976 363.464 342.172L366.646 345.354ZM367 229L366.5 229L366.5 345L367 345L367.5 345L367.5 229L367 229Z" fill="black"></path>
<path d="M214.398 417.137C214.462 417.146 214.528 417.151 214.596 417.151C214.665 417.151 214.767 417.151 214.904 417.151C215.939 417.151 216.752 416.934 217.343 416.5C217.938 416.065 218.236 415.474 218.236 414.727C218.236 414.058 218.053 413.55 217.687 413.204C217.321 412.857 216.789 412.684 216.09 412.684C215.983 412.684 215.849 412.688 215.688 412.698C215.531 412.708 215.355 412.723 215.16 412.742C214.955 413.885 214.792 414.8 214.669 415.489C214.552 416.177 214.462 416.727 214.398 417.137ZM211.308 421.517H211.593C211.896 421.517 212.111 421.431 212.238 421.26C212.37 421.084 212.504 420.601 212.641 419.81L213.703 413.482C213.717 413.409 213.729 413.34 213.739 413.277C213.749 413.213 213.754 413.162 213.754 413.123C213.754 412.923 213.686 412.776 213.549 412.684C213.417 412.586 213.214 412.537 212.941 412.537H212.743L212.838 411.995C213.146 412.024 213.427 412.046 213.681 412.061C213.935 412.076 214.164 412.083 214.369 412.083C214.687 412.083 215.109 412.068 215.636 412.039C216.168 412.01 216.54 411.995 216.75 411.995C217.648 411.995 218.349 412.203 218.852 412.618C219.359 413.028 219.613 413.594 219.613 414.317C219.613 415.005 219.394 415.611 218.954 416.133C218.515 416.651 217.87 417.071 217.021 417.393L218.134 419.51C218.163 419.573 218.209 419.668 218.273 419.795C218.893 421.006 219.555 421.612 220.258 421.612C220.282 421.612 220.319 421.609 220.368 421.604C220.421 421.6 220.46 421.597 220.485 421.597L220.397 422.088C220.172 422.127 219.984 422.154 219.833 422.168C219.682 422.188 219.55 422.198 219.438 422.198C218.993 422.198 218.615 422.117 218.302 421.956C217.99 421.79 217.733 421.539 217.533 421.202C217.392 420.972 217.128 420.447 216.742 419.627C216.361 418.807 216.054 418.157 215.819 417.679C215.663 417.693 215.504 417.706 215.343 417.715C215.187 417.72 215.026 417.723 214.86 417.723C214.796 417.723 214.701 417.72 214.574 417.715C214.452 417.71 214.357 417.708 214.289 417.708L213.871 420.469C213.856 420.572 213.844 420.662 213.834 420.74C213.83 420.813 213.827 420.875 213.827 420.923C213.827 421.163 213.878 421.321 213.981 421.399C214.088 421.478 214.311 421.517 214.647 421.517H214.816L214.721 422C214.56 421.995 214.333 421.985 214.04 421.971C213.468 421.951 213.102 421.941 212.941 421.941C212.692 421.941 212.252 421.956 211.623 421.985C211.452 421.99 211.315 421.995 211.212 422L211.308 421.517ZM222.858 418.697L222.931 418.66C224.669 417.771 225.539 417.085 225.539 416.602C225.539 416.343 225.446 416.119 225.26 415.928C225.075 415.738 224.857 415.643 224.608 415.643C224.223 415.643 223.876 415.909 223.568 416.441C223.261 416.973 223.024 417.725 222.858 418.697ZM225.062 418.191L222.821 419.349V419.422C222.821 420.003 222.912 420.445 223.092 420.748C223.278 421.05 223.544 421.202 223.891 421.202C224.096 421.202 224.352 421.111 224.66 420.931C224.972 420.745 225.37 420.447 225.854 420.037L226.11 420.499C225.412 421.143 224.855 421.59 224.44 421.839C224.03 422.088 223.656 422.212 223.319 422.212C222.807 422.212 222.392 421.99 222.074 421.546C221.757 421.102 221.598 420.518 221.598 419.795C221.598 419.283 221.681 418.733 221.847 418.147C222.018 417.557 222.238 417.042 222.506 416.602C222.843 416.065 223.229 415.65 223.664 415.357C224.098 415.064 224.547 414.917 225.011 414.917C225.485 414.917 225.88 415.069 226.198 415.372C226.52 415.669 226.681 416.033 226.681 416.463C226.681 416.81 226.583 417.098 226.388 417.327C226.198 417.552 225.756 417.84 225.062 418.191ZM231.405 419.378L231.955 416.06C231.686 415.904 231.447 415.792 231.237 415.723C231.027 415.65 230.832 415.613 230.651 415.613C230.05 415.613 229.545 415.999 229.135 416.771C228.725 417.537 228.52 418.494 228.52 419.642C228.52 420.105 228.573 420.457 228.681 420.696C228.793 420.936 228.957 421.055 229.171 421.055C229.318 421.055 229.589 420.906 229.984 420.608C230.385 420.311 230.858 419.9 231.405 419.378ZM231.42 420.125L230.175 421.253C229.809 421.585 229.516 421.814 229.296 421.941C229.081 422.068 228.878 422.132 228.688 422.132C228.249 422.132 227.912 421.946 227.677 421.575C227.443 421.199 227.326 420.66 227.326 419.957C227.326 418.57 227.675 417.378 228.373 416.382C229.076 415.386 229.911 414.888 230.878 414.888C231.073 414.888 231.271 414.915 231.471 414.969C231.676 415.018 231.889 415.091 232.108 415.188L232.526 412.537C232.541 412.435 232.55 412.332 232.555 412.229C232.565 412.122 232.57 412.015 232.57 411.907C232.57 411.712 232.531 411.578 232.453 411.504C232.375 411.431 232.23 411.395 232.021 411.395C231.957 411.395 231.891 411.397 231.823 411.402C231.759 411.402 231.688 411.404 231.61 411.409L231.581 410.977C231.986 410.938 232.394 410.884 232.804 410.816C233.219 410.748 233.637 410.665 234.057 410.567C233.603 412.911 233.229 415.027 232.936 416.917C232.643 418.802 232.497 419.947 232.497 420.352C232.497 420.601 232.519 420.777 232.562 420.879C232.611 420.977 232.689 421.026 232.797 421.026C232.855 421.026 232.924 421.001 233.002 420.953C233.085 420.904 233.188 420.823 233.31 420.711L233.756 420.308L233.998 420.726L233.156 421.553C232.863 421.836 232.65 422.017 232.519 422.095C232.387 422.173 232.26 422.212 232.138 422.212C231.879 422.212 231.688 422.09 231.566 421.846C231.449 421.602 231.391 421.224 231.391 420.711C231.391 420.599 231.393 420.499 231.398 420.411C231.403 420.318 231.41 420.223 231.42 420.125ZM241.491 420.77L240.48 421.714C240.299 421.89 240.136 422.015 239.989 422.088C239.848 422.161 239.701 422.198 239.55 422.198C239.33 422.198 239.152 422.093 239.015 421.883C238.883 421.668 238.817 421.382 238.817 421.026C238.817 420.923 238.825 420.801 238.839 420.66C238.859 420.513 238.896 420.286 238.949 419.979C238.046 420.901 237.406 421.502 237.03 421.78C236.654 422.059 236.334 422.198 236.071 422.198C235.792 422.198 235.561 422.068 235.375 421.81C235.189 421.551 235.097 421.219 235.097 420.813C235.097 420.472 235.243 419.703 235.536 418.506C235.609 418.223 235.663 418.008 235.697 417.862C235.8 417.457 235.875 417.132 235.924 416.888C235.973 416.639 235.998 416.453 235.998 416.331C235.998 416.233 235.973 416.155 235.924 416.097C235.875 416.033 235.814 416.001 235.741 416.001C235.692 416.001 235.597 416.036 235.456 416.104C235.314 416.172 235.119 416.277 234.87 416.419L234.665 416.016C235.119 415.679 235.517 415.418 235.858 415.232C236.2 415.042 236.442 414.947 236.583 414.947C236.784 414.947 236.94 415.032 237.052 415.203C237.169 415.374 237.228 415.611 237.228 415.914C237.228 416.294 237.077 417.032 236.774 418.125C236.476 419.219 236.327 420.04 236.327 420.586C236.327 420.757 236.356 420.884 236.415 420.967C236.474 421.045 236.564 421.084 236.686 421.084C236.823 421.084 237.055 420.95 237.382 420.682C237.714 420.408 238.268 419.888 239.044 419.122C239.23 418.243 239.379 417.5 239.491 416.895C239.608 416.285 239.699 415.74 239.762 415.262L241.081 414.947L240.919 415.672C240.641 416.858 240.49 417.52 240.465 417.657L240.29 418.594C240.202 419.039 240.131 419.463 240.077 419.869C240.028 420.274 240.004 420.56 240.004 420.726C240.004 420.838 240.026 420.926 240.07 420.989C240.114 421.053 240.172 421.084 240.246 421.084C240.314 421.084 240.441 421.019 240.626 420.887C240.812 420.755 241.024 420.577 241.264 420.352L241.491 420.77ZM246.793 416.177L246.405 416.558C246.083 416.231 245.824 416.014 245.629 415.906C245.438 415.799 245.243 415.745 245.043 415.745C244.594 415.745 244.203 416.08 243.871 416.749C243.539 417.413 243.373 418.233 243.373 419.209C243.373 419.864 243.458 420.357 243.629 420.689C243.8 421.021 244.052 421.187 244.384 421.187C244.569 421.187 244.823 421.082 245.146 420.872C245.468 420.657 245.807 420.364 246.164 419.993L246.464 420.513C245.897 421.114 245.414 421.548 245.014 421.817C244.613 422.081 244.247 422.212 243.915 422.212C243.388 422.212 242.965 421.983 242.648 421.524C242.335 421.065 242.179 420.445 242.179 419.664C242.179 418.326 242.521 417.198 243.205 416.28C243.893 415.362 244.74 414.903 245.746 414.903C246.112 414.903 246.425 414.981 246.684 415.137C246.947 415.293 247.079 415.472 247.079 415.672C247.079 415.75 247.057 415.828 247.013 415.906C246.974 415.984 246.901 416.075 246.793 416.177ZM250.792 413.24C250.7 413.567 250.57 414.08 250.404 414.778C250.355 414.983 250.319 415.135 250.294 415.232C250.583 415.232 250.875 415.23 251.173 415.225C251.476 415.215 251.793 415.203 252.125 415.188L251.95 415.921C251.818 415.916 251.671 415.914 251.51 415.914C251.349 415.914 251.09 415.914 250.734 415.914H250.148C249.918 416.919 249.748 417.798 249.635 418.55C249.528 419.302 249.474 419.932 249.474 420.44C249.474 420.655 249.508 420.823 249.577 420.945C249.65 421.067 249.75 421.128 249.877 421.128C249.975 421.128 250.128 421.05 250.338 420.894C250.548 420.738 250.834 420.486 251.195 420.14L251.452 420.608C250.749 421.331 250.265 421.792 250.001 421.993C249.738 422.188 249.516 422.286 249.335 422.286C248.998 422.286 248.729 422.127 248.529 421.81C248.329 421.492 248.229 421.06 248.229 420.513C248.229 420.157 248.285 419.646 248.397 418.982C248.51 418.313 248.722 417.278 249.035 415.877C248.957 415.877 248.854 415.879 248.727 415.884C248.605 415.889 248.522 415.892 248.478 415.892H247.973L248.061 415.401C248.285 415.391 248.49 415.352 248.676 415.284C248.866 415.215 249.057 415.108 249.247 414.961C249.291 414.786 249.34 414.603 249.394 414.412C249.452 414.217 249.518 414.012 249.591 413.797L250.792 413.24ZM255.634 420.337L255.89 420.77C255.29 421.39 254.872 421.785 254.638 421.956C254.403 422.127 254.196 422.212 254.015 422.212C253.756 422.212 253.549 422.105 253.393 421.89C253.236 421.67 253.158 421.377 253.158 421.011C253.158 420.552 253.302 419.786 253.59 418.711C253.883 417.637 254.03 416.863 254.03 416.39C254.03 416.268 254 416.17 253.942 416.097C253.883 416.023 253.808 415.987 253.715 415.987C253.637 415.987 253.534 416.019 253.407 416.082C253.28 416.146 253.122 416.243 252.931 416.375L252.711 415.987L253.686 415.276C253.871 415.14 254.032 415.042 254.169 414.983C254.306 414.92 254.435 414.888 254.557 414.888C254.787 414.888 254.967 414.983 255.099 415.174C255.236 415.359 255.304 415.616 255.304 415.943C255.304 416.299 255.177 416.998 254.923 418.038C254.865 418.272 254.821 418.448 254.792 418.565C254.655 419.117 254.55 419.573 254.477 419.935C254.408 420.296 254.374 420.545 254.374 420.682C254.374 420.804 254.401 420.904 254.455 420.982C254.508 421.06 254.577 421.099 254.66 421.099C254.738 421.099 254.84 421.05 254.967 420.953C255.094 420.855 255.316 420.65 255.634 420.337ZM255.575 410.896L255.993 411.365C256.11 411.487 256.19 411.597 256.234 411.695C256.283 411.788 256.308 411.883 256.308 411.98C256.308 412.083 256.271 412.181 256.198 412.273C256.129 412.366 256.027 412.454 255.89 412.537L255.246 412.896L254.777 412.339C254.679 412.217 254.616 412.122 254.586 412.054C254.557 411.98 254.542 411.905 254.542 411.827C254.542 411.714 254.572 411.617 254.63 411.534C254.689 411.446 254.789 411.36 254.931 411.277L255.575 410.896ZM260.167 415.628C259.601 415.628 259.113 416.016 258.703 416.792C258.292 417.569 258.087 418.526 258.087 419.664C258.087 420.264 258.19 420.723 258.395 421.041C258.605 421.358 258.908 421.517 259.303 421.517C259.899 421.517 260.404 421.136 260.819 420.374C261.239 419.607 261.449 418.67 261.449 417.562C261.449 416.902 261.344 416.417 261.134 416.104C260.924 415.787 260.602 415.628 260.167 415.628ZM260.482 414.917C261.21 414.917 261.762 415.145 262.138 415.599C262.519 416.048 262.709 416.707 262.709 417.576C262.709 418.074 262.611 418.606 262.416 419.173C262.221 419.734 261.957 420.242 261.625 420.696C261.269 421.185 260.863 421.561 260.409 421.824C259.96 422.083 259.486 422.212 258.988 422.212C258.334 422.212 257.812 421.976 257.421 421.502C257.035 421.028 256.842 420.394 256.842 419.598C256.842 419.007 256.938 418.431 257.128 417.869C257.318 417.308 257.592 416.8 257.948 416.346C258.3 415.892 258.698 415.54 259.142 415.291C259.591 415.042 260.038 414.917 260.482 414.917ZM265.888 417.02L267.074 415.862C267.489 415.467 267.802 415.206 268.012 415.079C268.227 414.952 268.429 414.888 268.62 414.888C268.942 414.888 269.203 415.03 269.403 415.313C269.608 415.596 269.711 415.97 269.711 416.434C269.711 416.907 269.591 417.64 269.352 418.631C269.113 419.617 268.993 420.32 268.993 420.74C268.993 420.867 269.018 420.965 269.066 421.033C269.115 421.097 269.186 421.128 269.279 421.128C269.323 421.128 269.376 421.111 269.44 421.077C269.508 421.038 269.574 420.987 269.638 420.923L270.194 420.381L270.451 420.77L269.652 421.583C269.462 421.778 269.271 421.932 269.081 422.044C268.896 422.156 268.732 422.212 268.59 422.212C268.346 422.212 268.146 422.107 267.99 421.897C267.838 421.683 267.763 421.402 267.763 421.055C267.763 420.64 267.887 419.91 268.136 418.865C268.385 417.815 268.51 417.051 268.51 416.573C268.51 416.392 268.471 416.248 268.393 416.141C268.319 416.028 268.219 415.972 268.092 415.972C267.902 415.972 267.318 416.424 266.342 417.327C266.083 417.566 265.88 417.754 265.734 417.891L265.272 420.469C265.263 420.518 265.248 420.591 265.229 420.689C265.126 421.211 265.065 421.612 265.045 421.89L263.742 422.212C264.064 420.811 264.318 419.593 264.503 418.558C264.694 417.522 264.789 416.844 264.789 416.521C264.789 416.326 264.767 416.187 264.723 416.104C264.679 416.016 264.608 415.972 264.511 415.972C264.452 415.972 264.354 416.006 264.218 416.075C264.086 416.143 263.917 416.243 263.712 416.375L263.515 415.987C263.568 415.943 263.646 415.879 263.749 415.796C264.501 415.191 265.004 414.888 265.258 414.888C265.502 414.888 265.683 414.981 265.8 415.167C265.917 415.347 265.976 415.63 265.976 416.016C265.976 416.153 265.968 416.307 265.954 416.478C265.939 416.648 265.917 416.829 265.888 417.02Z" fill="black"></path>
<path d="M271.354 401.354C271.549 401.158 271.549 400.842 271.354 400.646L268.172 397.464C267.976 397.269 267.66 397.269 267.464 397.464C267.269 397.66 267.269 397.976 267.464 398.172L270.293 401L267.464 403.828C267.269 404.024 267.269 404.34 267.464 404.536C267.66 404.731 267.976 404.731 268.172 404.536L271.354 401.354ZM135 401V401.5H271V401V400.5H135V401Z" fill="black"></path>
<defs>
<clipPath id="clip0_249_8276-attention-2-svg">
<rect width="89.5" height="143" fill="white" transform="translate(108 202)"></rect>
</clipPath>
</defs>
</svg>

<figcaption><b>FlashAttention with a KV Cache</b> The reason why explicitly handling the KV cache separately from the current KV values breaks batch invariance is a bit subtle and is related to "boundary conditions". In particular, imagine your block size is 32 but we currently have 80 elements in our KV cache. We then compute an additional 48 elements that aren't cached. In this case, we need three blocks (two full and one masked) to compute "P cache" and another two blocks (one full and one masked) to compute "P". This is therefore five total blocks to compute our reduction when we only have four total blocks (i.e. 128) of elements to compute, which will definitely change our reduction order. 
<p>For example, if we instead had no elements in our KV Cache and were processing 128 elements altogether, we need to have identical numerics in both of these situations to ensure “batch invariance” for attention.</p>
 </figcaption>
</figure>
<p>To resolve this, we can just update the KV cache and page table before the attention kernel itself, ensuring that our keys and values are always consistently laid out regardless of how many tokens are being processed.</p>
<p>With this additional detail (as well as all the things mentioned in the previous section, like consistent tile sizes), we are able to achieve a batch-invariant attention implementation!</p>
<p>However, there is a significant problem here. Unlike with matrix multiplication, the attention shapes we see in LLM inference often do require a split-reduction kernel, often known as Split-KV or FlashDecoding. This is because if we don’t parallelize along the reduction, we can only parallelize along the batch dimension, head dimension, and “query length” dimension. In the decode stage of attention, query length is very small, and so unless we have a very large batch size we are often unable to saturate the GPU.</p>
<p>Unfortunately, it’s not as easy to ignore this case as it was for RMSNorm and Matmuls. For example, if you have a very long KV cache, the attention kernel may take a very long time despite only processing one request.</p>
<figure>
<svg width="386" height="298" viewBox="0 0 386 298" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="386" height="298" fill="#F5F5F5"></rect>
<rect width="386" height="298" fill="white"></rect>
<path d="M29.4461 211.483L31.1271 212.488C31.9492 212.968 32.6022 213.295 33.0863 213.469C33.5704 213.648 34.0297 213.737 34.4642 213.735C34.6058 213.734 34.7718 213.722 34.9622 213.696C35.1525 213.671 35.3818 213.631 35.6502 213.577L35.7398 214.03C35.0471 214.228 34.5325 214.357 34.1958 214.417C33.864 214.482 33.5687 214.515 33.3099 214.516C32.2699 214.519 30.5285 213.701 28.0859 212.059L27.7849 211.855C27.7507 211.856 27.697 211.858 27.6238 211.863C27.5554 211.868 27.5041 211.871 27.47 211.871C25.9758 211.877 24.7386 211.369 23.7582 210.347C22.7827 209.325 22.2921 208.033 22.2863 206.471C22.2834 205.689 22.4247 204.956 22.7103 204.272C23.0007 203.587 23.4208 202.978 23.9706 202.443C24.4571 201.973 25.0124 201.612 25.6365 201.36C26.2606 201.109 26.912 200.982 27.5907 200.98C28.3231 200.977 28.9802 201.082 29.5621 201.295C30.1488 201.507 30.6798 201.832 31.155 202.27C31.7283 202.81 32.1677 203.433 32.473 204.14C32.7784 204.847 32.9325 205.596 32.9355 206.387C32.94 207.598 32.6387 208.649 32.0317 209.54C31.4246 210.431 30.5628 211.078 29.4461 211.483ZM31.3178 206.649C31.3125 205.228 30.942 204.065 30.2062 203.16C29.4704 202.249 28.5458 201.796 27.4326 201.8C26.3632 201.804 25.5053 202.198 24.8588 202.982C24.2172 203.766 23.8988 204.812 23.9037 206.12C23.9091 207.59 24.2822 208.785 25.0229 209.705C25.7637 210.62 26.7029 211.076 27.8405 211.072C28.8855 211.068 29.7262 210.664 30.3629 209.861C31.0045 209.053 31.3227 207.982 31.3178 206.649Z" fill="black"></path>
<path d="M177.559 87.6652C177.871 87.6835 178.182 87.697 178.489 87.7057C178.797 87.7143 179.097 87.718 179.39 87.717C179.6 87.7162 179.842 87.7104 180.115 87.6996C180.389 87.6888 180.689 87.6731 181.016 87.6523L181.018 88.143L180.952 88.1433C180.395 88.1454 179.861 88.389 179.35 88.8743L179.277 88.9479L175.658 92.4403L179.017 95.7897C179.105 95.8772 179.23 96.0013 179.392 96.1618C180.338 97.1251 181.031 97.606 181.47 97.6043C181.524 97.6041 181.565 97.604 181.595 97.6039C181.624 97.5989 181.646 97.5939 181.661 97.589L181.67 98.1016C181.592 98.097 181.487 98.0925 181.355 98.0881C180.847 98.0607 180.5 98.0474 180.315 98.0481C180.129 98.0488 179.917 98.0544 179.678 98.0651C179.443 98.0757 179.192 98.0913 178.923 98.1118C178.928 98.0972 178.931 98.0874 178.931 98.0825C178.935 98.0727 178.938 98.0581 178.938 98.0385C178.937 97.7846 178.155 96.8866 176.591 95.3446C175.645 94.4057 174.876 93.6346 174.283 93.0314L177.091 89.974C177.218 89.832 177.39 89.6458 177.609 89.4155C178.1 88.8814 178.346 88.5656 178.346 88.4679C178.345 88.3605 178.296 88.2825 178.198 88.2341C178.105 88.1807 177.954 88.1544 177.744 88.1552L177.561 88.1559L177.559 87.6652ZM171.729 87.6868C172.076 87.7051 172.408 87.7185 172.725 87.7271C173.042 87.7356 173.331 87.7395 173.589 87.7385C173.892 87.7374 174.2 87.7313 174.512 87.7204C174.825 87.7095 175.142 87.6937 175.464 87.6729L175.466 88.1637L175.371 88.164C174.931 88.1656 174.636 88.2766 174.486 88.4969C174.34 88.7172 174.269 89.2838 174.272 90.1969L174.292 95.5509C174.296 96.5079 174.369 97.0936 174.511 97.3079C174.654 97.5222 174.937 97.6286 175.362 97.627C175.386 97.6269 175.425 97.6243 175.479 97.6192C175.533 97.6142 175.574 97.6116 175.604 97.6115L175.605 98.1241C175.239 98.106 174.888 98.0926 174.551 98.0841C174.219 98.0756 173.911 98.0718 173.628 98.0729C173.403 98.0737 173.127 98.0796 172.8 98.0906C172.473 98.1016 172.114 98.1176 171.724 98.1386L171.722 97.6332C171.751 97.6331 171.783 97.6354 171.817 97.6402C171.851 97.64 171.898 97.6399 171.956 97.6396C172.342 97.6382 172.603 97.503 172.738 97.2339C172.879 96.9599 172.948 96.3542 172.944 95.4167C172.944 95.2898 172.94 95.0505 172.934 94.699C172.928 94.3474 172.924 94.0618 172.924 93.8421L172.916 91.8939C172.915 91.6497 172.917 91.3397 172.92 90.9637C172.924 90.5828 172.925 90.324 172.925 90.1873C172.921 89.3426 172.849 88.7959 172.706 88.5474C172.568 88.2989 172.307 88.1754 171.921 88.1768C171.906 88.1769 171.877 88.1794 171.833 88.1845C171.789 88.1895 171.755 88.1921 171.731 88.1922L171.729 87.6868Z" fill="black"></path>
<path d="M316.274 91.1495C316.64 91.1677 316.987 91.181 317.314 91.1896C317.641 91.1981 317.929 91.2019 318.178 91.201C318.491 91.1999 318.808 91.1938 319.13 91.1828C319.457 91.1718 319.792 91.156 320.134 91.1352L320.128 91.5966C319.718 91.6323 319.445 91.687 319.308 91.7608C319.177 91.8345 319.111 91.9617 319.112 92.1424C319.112 92.2791 319.137 92.4523 319.187 92.6621C319.242 92.867 319.335 93.1523 319.469 93.518L321.696 99.6768C322.862 96.7183 323.594 94.8015 323.894 93.9264C324.198 93.0463 324.35 92.4696 324.349 92.1962C324.348 91.9716 324.287 91.818 324.164 91.7354C324.047 91.6529 323.773 91.6026 323.343 91.5847L323.342 91.1232C323.635 91.1417 323.923 91.1553 324.206 91.164C324.494 91.1727 324.775 91.1765 325.048 91.1755C325.283 91.1746 325.544 91.1688 325.832 91.1579C326.12 91.1471 326.42 91.1313 326.733 91.1107L326.734 91.5721L326.624 91.5725C326.087 91.5745 325.633 92.0498 325.26 92.9985C325.178 93.2136 325.11 93.3799 325.057 93.4973C323.692 96.808 322.814 98.9622 322.422 99.9597C322.03 100.957 321.825 101.537 321.806 101.698L320.905 101.701C320.905 101.584 320.675 100.855 320.216 99.5138C319.757 98.1727 319.202 96.6538 318.551 94.957C318.507 94.8351 318.443 94.662 318.359 94.4377C317.644 92.5409 317.015 91.5935 316.473 91.5955C316.424 91.5957 316.385 91.5983 316.356 91.6033C316.332 91.6034 316.305 91.6059 316.275 91.6109L316.274 91.1495Z" fill="black"></path>
<rect x="105.531" y="188.383" width="35" height="35" transform="rotate(-0.212766 105.531 188.383)" fill="#EF402C"></rect>
<rect x="141.531" y="188.25" width="35" height="35" transform="rotate(-0.212766 141.531 188.25)" fill="#F78427"></rect>
<rect x="177.53" y="188.117" width="35" height="35" transform="rotate(-0.212766 177.53 188.117)" fill="#FFA8AA"></rect>
<rect x="213.53" y="187.98" width="35" height="35" transform="rotate(-0.212766 213.53 187.98)" fill="#824665"></rect>
<rect x="105.327" y="133.383" width="35" height="35" transform="rotate(-0.212766 105.327 133.383)" fill="#EF402C"></rect>
<rect x="141.327" y="133.25" width="35" height="35" transform="rotate(-0.212766 141.327 133.25)" fill="#F78427"></rect>
<rect x="177.326" y="133.117" width="35" height="35" transform="rotate(-0.212766 177.326 133.117)" fill="#FFA8AA"></rect>
<rect x="213.326" y="132.98" width="35" height="35" transform="rotate(-0.212766 213.326 132.98)" fill="#824665"></rect>
<path d="M50.5312 188.59L85.531 188.46L85.661 223.46L50.6612 223.59L50.5312 188.59Z" fill="#E7E1DF"></path>
<rect x="267.926" y="24.7812" width="35" height="35" transform="rotate(-0.212766 267.926 24.7812)" fill="#EF402C"></rect>
<rect opacity="0.8" x="268.059" y="60.7812" width="35" height="35" transform="rotate(-0.212766 268.059 60.7812)" fill="#F78427"></rect>
<rect opacity="0.6" x="268.193" y="96.7812" width="35" height="35" transform="rotate(-0.212766 268.193 96.7812)" fill="#FFA8AA"></rect>
<rect x="268.326" y="132.781" width="35" height="35" transform="rotate(-0.212766 268.326 132.781)" fill="#824665"></rect>
<path d="M344.084 162.819C344.28 163.013 344.597 163.012 344.791 162.816L347.962 159.623C348.156 159.427 348.155 159.11 347.959 158.915C347.763 158.721 347.446 158.722 347.252 158.918L344.434 161.757L341.595 158.939C341.399 158.744 341.083 158.746 340.888 158.942C340.693 159.138 340.695 159.454 340.891 159.649L344.084 162.819ZM344.006 46.4648L343.506 46.4667L343.937 162.466L344.437 162.464L344.937 162.462L344.506 46.463L344.006 46.4648Z" fill="black"></path>
<path d="M192.208 263.202C192.271 263.212 192.337 263.216 192.405 263.216C192.474 263.216 192.576 263.215 192.713 263.215C193.748 263.211 194.56 262.991 195.149 262.554C195.744 262.117 196.039 261.525 196.036 260.778C196.034 260.109 195.849 259.602 195.481 259.257C195.114 258.912 194.581 258.74 193.883 258.743C193.775 258.743 193.641 258.749 193.48 258.759C193.324 258.769 193.148 258.785 192.953 258.805C192.752 259.948 192.592 260.864 192.472 261.553C192.358 262.242 192.269 262.792 192.208 263.202ZM189.133 267.593L189.419 267.592C189.721 267.591 189.936 267.505 190.062 267.334C190.193 267.157 190.326 266.674 190.46 265.882L191.498 259.55C191.513 259.477 191.525 259.408 191.534 259.345C191.544 259.281 191.548 259.23 191.548 259.191C191.547 258.991 191.478 258.844 191.341 258.752C191.209 258.655 191.006 258.607 190.733 258.608L190.535 258.609L190.628 258.066C190.936 258.095 191.217 258.115 191.471 258.129C191.725 258.143 191.954 258.149 192.159 258.149C192.477 258.147 192.899 258.131 193.426 258.1C193.959 258.069 194.33 258.053 194.54 258.052C195.438 258.049 196.139 258.253 196.644 258.667C197.153 259.075 197.409 259.64 197.412 260.363C197.414 261.051 197.197 261.658 196.759 262.182C196.322 262.701 195.679 263.123 194.831 263.449L195.952 265.561C195.981 265.625 196.028 265.72 196.092 265.846C196.717 267.055 197.38 267.658 198.083 267.655C198.108 267.655 198.145 267.653 198.193 267.648C198.247 267.643 198.286 267.64 198.31 267.64L198.224 268.131C198 268.171 197.812 268.198 197.661 268.214C197.509 268.234 197.378 268.244 197.265 268.244C196.821 268.246 196.442 268.167 196.129 268.007C195.816 267.842 195.559 267.592 195.357 267.255C195.215 267.026 194.949 266.503 194.561 265.684C194.177 264.865 193.867 264.217 193.63 263.739C193.474 263.754 193.316 263.767 193.155 263.777C192.998 263.783 192.837 263.786 192.671 263.786C192.608 263.787 192.512 263.785 192.385 263.78C192.263 263.776 192.168 263.774 192.1 263.774L191.693 266.537C191.678 266.639 191.666 266.73 191.657 266.808C191.652 266.881 191.65 266.942 191.65 266.991C191.651 267.23 191.703 267.389 191.806 267.466C191.914 267.544 192.136 267.582 192.473 267.581L192.641 267.58L192.548 268.064C192.387 268.06 192.16 268.051 191.867 268.037C191.295 268.02 190.929 268.012 190.768 268.012C190.519 268.013 190.079 268.029 189.45 268.061C189.279 268.067 189.142 268.072 189.04 268.077L189.133 267.593ZM200.673 264.731L200.746 264.694C202.481 263.799 203.347 263.11 203.346 262.626C203.345 262.367 203.251 262.143 203.065 261.953C202.879 261.764 202.661 261.669 202.412 261.67C202.026 261.672 201.68 261.939 201.375 262.472C201.069 263.006 200.835 263.758 200.673 264.731ZM202.875 264.217L200.639 265.383L200.639 265.456C200.641 266.037 200.733 266.479 200.915 266.781C201.101 267.083 201.368 267.233 201.715 267.232C201.92 267.231 202.176 267.14 202.483 266.958C202.795 266.771 203.191 266.472 203.673 266.06L203.931 266.52C203.236 267.168 202.681 267.616 202.266 267.867C201.857 268.118 201.484 268.243 201.147 268.245C200.635 268.247 200.219 268.026 199.9 267.583C199.581 267.14 199.42 266.557 199.417 265.834C199.415 265.321 199.496 264.772 199.66 264.185C199.829 263.594 200.046 263.078 200.313 262.637C200.648 262.099 201.033 261.683 201.466 261.388C201.899 261.093 202.348 260.945 202.812 260.944C203.286 260.942 203.682 261.092 204 261.393C204.324 261.69 204.486 262.053 204.488 262.483C204.489 262.829 204.392 263.118 204.198 263.348C204.008 263.573 203.567 263.863 202.875 264.217ZM209.223 265.38L209.76 262.06C209.49 261.905 209.251 261.794 209.041 261.726C208.83 261.654 208.635 261.618 208.454 261.618C207.854 261.621 207.35 262.008 206.942 262.781C206.535 263.549 206.334 264.507 206.338 265.655C206.34 266.118 206.395 266.47 206.503 266.709C206.616 266.948 206.78 267.067 206.995 267.066C207.141 267.065 207.412 266.915 207.806 266.616C208.206 266.317 208.678 265.905 209.223 265.38ZM209.24 266.127L207.999 267.26C207.634 267.593 207.342 267.824 207.123 267.951C206.908 268.079 206.706 268.143 206.516 268.144C206.076 268.146 205.738 267.962 205.503 267.591C205.267 267.216 205.148 266.677 205.145 265.974C205.14 264.587 205.485 263.395 206.179 262.396C206.879 261.397 207.712 260.896 208.679 260.892C208.874 260.892 209.072 260.918 209.272 260.971C209.477 261.019 209.69 261.091 209.91 261.188L210.318 258.535C210.332 258.433 210.341 258.33 210.346 258.228C210.355 258.12 210.36 258.013 210.359 257.905C210.359 257.71 210.319 257.576 210.241 257.503C210.162 257.43 210.018 257.394 209.808 257.395C209.745 257.395 209.679 257.397 209.61 257.403C209.547 257.403 209.476 257.406 209.398 257.411L209.367 256.979C209.772 256.938 210.18 256.883 210.59 256.813C211.004 256.743 211.422 256.659 211.841 256.559C211.396 258.905 211.03 261.023 210.744 262.914C210.458 264.799 210.316 265.945 210.318 266.35C210.318 266.599 210.341 266.775 210.385 266.877C210.435 266.975 210.513 267.023 210.62 267.023C210.679 267.023 210.747 266.998 210.825 266.949C210.908 266.9 211.01 266.819 211.132 266.706L211.577 266.302L211.82 266.718L210.981 267.549C210.689 267.833 210.477 268.015 210.346 268.093C210.214 268.172 210.088 268.211 209.966 268.212C209.707 268.213 209.516 268.092 209.393 267.848C209.275 267.604 209.215 267.226 209.213 266.713C209.212 266.601 209.215 266.501 209.219 266.413C209.224 266.32 209.231 266.225 209.24 266.127ZM219.313 266.734L218.306 267.683C218.126 267.859 217.963 267.984 217.817 268.058C217.675 268.132 217.529 268.169 217.378 268.17C217.158 268.171 216.979 268.066 216.842 267.857C216.709 267.642 216.642 267.357 216.641 267.001C216.64 266.898 216.647 266.776 216.661 266.634C216.68 266.488 216.716 266.261 216.769 265.953C215.869 266.879 215.231 267.482 214.856 267.762C214.482 268.041 214.162 268.182 213.899 268.183C213.62 268.184 213.388 268.055 213.201 267.797C213.015 267.539 212.921 267.207 212.919 266.802C212.918 266.46 213.062 265.691 213.35 264.493C213.422 264.21 213.475 263.995 213.509 263.848C213.61 263.443 213.684 263.118 213.732 262.873C213.78 262.624 213.804 262.438 213.804 262.316C213.803 262.219 213.778 262.141 213.729 262.082C213.68 262.019 213.619 261.987 213.546 261.988C213.497 261.988 213.402 262.022 213.261 262.091C213.119 262.16 212.924 262.266 212.676 262.408L212.469 262.006C212.922 261.668 213.319 261.405 213.66 261.218C214.001 261.026 214.243 260.93 214.384 260.93C214.585 260.929 214.741 261.014 214.854 261.184C214.972 261.355 215.031 261.592 215.032 261.894C215.034 262.275 214.885 263.013 214.587 264.108C214.293 265.203 214.147 266.024 214.149 266.57C214.15 266.741 214.179 266.868 214.238 266.951C214.297 267.029 214.388 267.068 214.51 267.067C214.646 267.067 214.878 266.931 215.204 266.662C215.535 266.387 216.087 265.865 216.861 265.095C217.043 264.216 217.189 263.473 217.299 262.867C217.414 262.256 217.502 261.712 217.564 261.233L218.881 260.913L218.723 261.639C218.449 262.826 218.3 263.489 218.276 263.625L218.104 264.564C218.018 265.008 217.948 265.433 217.896 265.839C217.849 266.244 217.826 266.53 217.826 266.696C217.827 266.808 217.849 266.896 217.893 266.959C217.937 267.023 217.996 267.054 218.069 267.054C218.138 267.054 218.264 266.987 218.449 266.855C218.634 266.722 218.846 266.543 219.085 266.318L219.313 266.734ZM224.599 262.122L224.212 262.505C223.889 262.179 223.629 261.962 223.433 261.856C223.242 261.749 223.047 261.696 222.847 261.697C222.397 261.698 222.008 262.034 221.679 262.705C221.349 263.37 221.186 264.191 221.19 265.167C221.192 265.822 221.279 266.314 221.451 266.646C221.624 266.977 221.876 267.142 222.208 267.141C222.393 267.14 222.647 267.034 222.968 266.823C223.29 266.607 223.628 266.313 223.983 265.941L224.285 266.46C223.721 267.062 223.239 267.499 222.84 267.769C222.441 268.034 222.075 268.167 221.743 268.168C221.215 268.17 220.792 267.942 220.473 267.484C220.159 267.027 220 266.407 219.997 265.626C219.993 264.288 220.33 263.159 221.01 262.238C221.695 261.318 222.541 260.856 223.547 260.852C223.913 260.851 224.226 260.927 224.485 261.083C224.749 261.238 224.882 261.416 224.883 261.616C224.883 261.694 224.861 261.772 224.817 261.851C224.779 261.929 224.706 262.019 224.599 262.122ZM228.587 259.171C228.495 259.498 228.368 260.011 228.204 260.71C228.156 260.915 228.12 261.067 228.096 261.165C228.384 261.164 228.677 261.16 228.975 261.154C229.278 261.143 229.595 261.13 229.927 261.114L229.754 261.847C229.622 261.843 229.476 261.841 229.315 261.841C229.153 261.842 228.895 261.843 228.538 261.844L227.952 261.846C227.727 262.853 227.559 263.733 227.449 264.485C227.345 265.237 227.293 265.867 227.295 266.375C227.296 266.59 227.331 266.758 227.4 266.88C227.473 267.002 227.574 267.063 227.701 267.062C227.798 267.062 227.952 266.983 228.161 266.826C228.371 266.669 228.655 266.416 229.015 266.068L229.273 266.536C228.573 267.261 228.091 267.725 227.828 267.926C227.565 268.122 227.344 268.221 227.163 268.221C226.826 268.223 226.557 268.065 226.356 267.748C226.154 267.432 226.052 267 226.05 266.453C226.049 266.097 226.103 265.586 226.213 264.922C226.323 264.252 226.532 263.216 226.839 261.814C226.761 261.814 226.658 261.817 226.531 261.822C226.409 261.828 226.326 261.83 226.282 261.83L225.777 261.832L225.863 261.341C226.088 261.331 226.292 261.291 226.478 261.222C226.668 261.153 226.858 261.045 227.048 260.897C227.091 260.722 227.139 260.538 227.192 260.348C227.25 260.152 227.315 259.947 227.388 259.732L228.587 259.171ZM233.454 266.25L233.712 266.681C233.114 267.303 232.698 267.7 232.464 267.872C232.231 268.044 232.023 268.13 231.843 268.131C231.584 268.132 231.376 268.025 231.219 267.811C231.062 267.592 230.983 267.299 230.981 266.933C230.98 266.474 231.121 265.707 231.405 264.631C231.694 263.556 231.838 262.782 231.836 262.308C231.835 262.186 231.806 262.088 231.747 262.015C231.688 261.942 231.612 261.906 231.519 261.906C231.441 261.907 231.339 261.939 231.212 262.003C231.085 262.067 230.927 262.165 230.737 262.297L230.516 261.91L231.487 261.196C231.673 261.059 231.833 260.96 231.97 260.901C232.106 260.837 232.236 260.805 232.358 260.805C232.587 260.804 232.768 260.898 232.901 261.088C233.038 261.273 233.107 261.529 233.109 261.856C233.11 262.213 232.986 262.912 232.736 263.953C232.678 264.187 232.634 264.363 232.606 264.48C232.471 265.033 232.368 265.49 232.296 265.851C232.229 266.213 232.196 266.462 232.196 266.599C232.196 266.721 232.224 266.821 232.278 266.899C232.332 266.977 232.4 267.015 232.483 267.015C232.561 267.015 232.664 266.966 232.79 266.867C232.917 266.769 233.138 266.563 233.454 266.25ZM233.361 256.809L233.78 257.276C233.898 257.398 233.979 257.507 234.023 257.605C234.072 257.698 234.097 257.793 234.097 257.89C234.098 257.993 234.061 258.091 233.989 258.184C233.92 258.277 233.818 258.365 233.682 258.448L233.039 258.81L232.568 258.255C232.47 258.133 232.406 258.038 232.376 257.97C232.347 257.897 232.332 257.821 232.332 257.743C232.331 257.631 232.36 257.533 232.418 257.45C232.477 257.362 232.576 257.276 232.718 257.192L233.361 256.809ZM237.971 261.523C237.404 261.526 236.917 261.916 236.51 262.693C236.103 263.471 235.901 264.429 235.906 265.567C235.908 266.167 236.012 266.626 236.218 266.943C236.429 267.259 236.733 267.417 237.128 267.415C237.724 267.413 238.228 267.03 238.64 266.267C239.057 265.499 239.264 264.561 239.26 263.452C239.257 262.793 239.15 262.308 238.939 261.996C238.728 261.679 238.405 261.522 237.971 261.523ZM238.283 260.812C239.01 260.809 239.563 261.034 239.941 261.487C240.323 261.935 240.516 262.593 240.519 263.462C240.521 263.96 240.426 264.493 240.232 265.06C240.039 265.622 239.777 266.131 239.447 266.586C239.092 267.076 238.688 267.453 238.235 267.719C237.787 267.979 237.314 268.11 236.816 268.112C236.162 268.115 235.638 267.88 235.246 267.408C234.858 266.935 234.663 266.301 234.66 265.505C234.658 264.915 234.751 264.338 234.939 263.776C235.128 263.214 235.399 262.705 235.754 262.249C236.104 261.794 236.501 261.441 236.944 261.19C237.392 260.94 237.839 260.813 238.283 260.812ZM243.696 262.894L244.878 261.732C245.292 261.335 245.603 261.073 245.813 260.945C246.027 260.817 246.23 260.753 246.42 260.752C246.742 260.751 247.004 260.892 247.205 261.174C247.411 261.457 247.515 261.83 247.517 262.294C247.519 262.767 247.402 263.5 247.166 264.492C246.931 265.479 246.814 266.183 246.815 266.603C246.816 266.73 246.841 266.827 246.89 266.896C246.939 266.959 247.01 266.99 247.102 266.99C247.146 266.99 247.2 266.973 247.263 266.938C247.332 266.899 247.397 266.847 247.46 266.784L248.015 266.24L248.273 266.627L247.478 267.443C247.288 267.639 247.098 267.793 246.908 267.906C246.723 268.019 246.56 268.076 246.418 268.077C246.174 268.077 245.973 267.973 245.816 267.764C245.664 267.55 245.587 267.269 245.586 266.922C245.584 266.507 245.706 265.777 245.951 264.731C246.197 263.68 246.318 262.916 246.316 262.437C246.316 262.257 246.276 262.113 246.198 262.006C246.124 261.894 246.024 261.838 245.897 261.838C245.706 261.839 245.124 262.293 244.151 263.2C243.893 263.44 243.691 263.629 243.545 263.766L243.094 266.346C243.084 266.395 243.07 266.468 243.05 266.566C242.95 267.088 242.89 267.489 242.872 267.767L241.569 268.095C241.886 266.692 242.136 265.473 242.317 264.437C242.504 263.401 242.597 262.722 242.596 262.4C242.595 262.204 242.572 262.065 242.528 261.983C242.484 261.895 242.413 261.851 242.315 261.852C242.257 261.852 242.159 261.886 242.023 261.955C241.891 262.024 241.723 262.125 241.518 262.257L241.319 261.87C241.373 261.826 241.451 261.762 241.553 261.679C242.303 261.07 242.804 260.766 243.058 260.765C243.302 260.764 243.483 260.856 243.601 261.041C243.719 261.221 243.779 261.504 243.78 261.89C243.781 262.027 243.774 262.181 243.76 262.352C243.746 262.522 243.725 262.703 243.696 262.894Z" fill="black"></path>
<path d="M249.104 247.207C249.298 247.011 249.297 246.694 249.101 246.499L245.908 243.329C245.712 243.135 245.395 243.136 245.2 243.332C245.006 243.528 245.007 243.845 245.203 244.039L248.042 246.857L245.224 249.696C245.03 249.892 245.031 250.208 245.227 250.403C245.423 250.598 245.739 250.596 245.934 250.4L249.104 247.207ZM112.75 247.359L112.752 247.859L248.751 247.354L248.749 246.854L248.747 246.354L112.748 246.859L112.75 247.359Z" fill="black"></path>
<path d="M113.805 117.775C113.799 116.163 114.988 115.003 116.658 114.997C118.34 114.991 119.499 116.027 119.504 117.557C119.508 118.509 119.079 119.272 117.625 120.871L115.476 123.228L115.476 123.336L119.672 123.32L119.676 124.336L113.88 124.357L113.877 123.583L116.962 120.125C118.119 118.819 118.397 118.329 118.394 117.606C118.39 116.622 117.696 115.977 116.629 115.981C115.576 115.985 114.88 116.692 114.884 117.771L114.884 117.809L113.805 117.813L113.805 117.775ZM124.71 124.501C123.002 124.507 121.793 123.458 121.691 121.884L122.771 121.88C122.876 122.839 123.697 123.496 124.77 123.492C125.95 123.487 126.734 122.653 126.73 121.409C126.725 120.152 125.929 119.304 124.754 119.309C123.935 119.312 123.258 119.689 122.898 120.337L121.838 120.341L122.282 115.166L127.291 115.148L127.294 116.157L123.168 116.172L122.926 119.163L123.027 119.163C123.476 118.615 124.128 118.327 124.935 118.324C126.629 118.318 127.815 119.576 127.821 121.379C127.828 123.233 126.57 124.494 124.71 124.501ZM132.829 124.496C130.836 124.504 129.731 122.807 129.72 119.722C129.708 116.637 130.8 114.932 132.793 114.924C134.78 114.917 135.891 116.614 135.902 119.699C135.914 122.784 134.815 124.489 132.829 124.496ZM130.83 119.718C130.832 120.079 130.852 120.416 130.879 120.727L134.562 117.628C134.259 116.493 133.66 115.911 132.797 115.914C131.502 115.919 130.821 117.229 130.83 119.718ZM132.825 123.506C134.12 123.501 134.794 122.185 134.785 119.703C134.784 119.335 134.77 118.998 134.737 118.681L131.067 121.805C131.369 122.928 131.962 123.509 132.825 123.506Z" fill="black"></path>
<path d="M148.805 117.642C148.799 116.03 149.988 114.87 151.658 114.864C153.34 114.858 154.499 115.894 154.504 117.424C154.508 118.376 154.079 119.14 152.625 120.738L150.476 123.095L150.476 123.203L154.672 123.187L154.676 124.203L148.88 124.224L148.877 123.45L151.962 119.992C153.119 118.686 153.397 118.196 153.394 117.473C153.39 116.489 152.696 115.844 151.629 115.848C150.576 115.852 149.88 116.559 149.884 117.638L149.884 117.676L148.805 117.68L148.805 117.642ZM159.71 124.368C158.002 124.375 156.793 123.325 156.691 121.752L157.771 121.748C157.876 122.706 158.697 123.363 159.77 123.359C160.95 123.354 161.734 122.52 161.73 121.276C161.725 120.019 160.929 119.171 159.754 119.176C158.935 119.179 158.258 119.556 157.898 120.205L156.838 120.209L157.282 115.034L162.291 115.015L162.294 116.024L158.168 116.04L157.926 119.03L158.027 119.03C158.476 118.482 159.128 118.194 159.935 118.191C161.629 118.185 162.815 119.444 162.821 121.246C162.828 123.1 161.57 124.361 159.71 124.368ZM167.829 124.364C165.836 124.371 164.731 122.674 164.72 119.589C164.708 116.504 165.8 114.799 167.793 114.791C169.78 114.784 170.891 116.481 170.902 119.566C170.914 122.651 169.815 124.356 167.829 124.364ZM165.83 119.585C165.832 119.947 165.852 120.283 165.879 120.594L169.562 117.495C169.259 116.36 168.66 115.778 167.797 115.782C166.502 115.786 165.821 117.097 165.83 119.585ZM167.825 123.373C169.12 123.369 169.794 122.052 169.785 119.57C169.784 119.202 169.77 118.866 169.737 118.548L166.067 121.672C166.369 122.795 166.962 123.377 167.825 123.373Z" fill="black"></path>
<path d="M184.805 117.505C184.799 115.893 185.988 114.733 187.658 114.727C189.34 114.721 190.499 115.758 190.504 117.288C190.508 118.24 190.079 119.003 188.625 120.602L186.476 122.958L186.476 123.066L190.672 123.051L190.676 124.066L184.88 124.088L184.877 123.313L187.962 119.855C189.119 118.549 189.397 118.06 189.394 117.336C189.39 116.352 188.696 115.707 187.629 115.711C186.576 115.715 185.88 116.422 185.884 117.501L185.884 117.54L184.805 117.544L184.805 117.505ZM195.71 124.232C194.002 124.238 192.793 123.189 192.691 121.615L193.771 121.611C193.876 122.569 194.697 123.226 195.77 123.222C196.95 123.218 197.734 122.383 197.73 121.139C197.725 119.882 196.929 119.035 195.754 119.039C194.935 119.042 194.258 119.419 193.898 120.068L192.838 120.072L193.282 114.897L198.291 114.878L198.294 115.887L194.168 115.903L193.926 118.893L194.027 118.893C194.476 118.346 195.128 118.057 195.935 118.054C197.629 118.048 198.815 119.307 198.821 121.11C198.828 122.963 197.57 124.225 195.71 124.232ZM203.829 124.227C201.836 124.234 200.731 122.537 200.72 119.452C200.708 116.367 201.8 114.662 203.793 114.655C205.78 114.647 206.891 116.344 206.902 119.429C206.914 122.514 205.815 124.219 203.829 124.227ZM201.83 119.448C201.832 119.81 201.852 120.146 201.879 120.457L205.562 117.359C205.259 116.223 204.66 115.642 203.797 115.645C202.502 115.65 201.821 116.96 201.83 119.448ZM203.825 123.237C205.12 123.232 205.794 121.915 205.785 119.433C205.784 119.065 205.77 118.729 205.737 118.412L202.067 121.536C202.369 122.658 202.962 123.24 203.825 123.237Z" fill="black"></path>
<path d="M220.806 117.377C220.8 115.764 221.989 114.605 223.659 114.598C225.341 114.592 226.5 115.629 226.505 117.159C226.509 118.111 226.08 118.874 224.626 120.473L222.477 122.829L222.477 122.937L226.673 122.922L226.677 123.937L220.881 123.959L220.878 123.184L223.963 119.726C225.12 118.421 225.397 117.931 225.395 117.207C225.391 116.223 224.697 115.578 223.63 115.582C222.577 115.586 221.881 116.293 221.885 117.373L221.885 117.411L220.806 117.415L220.806 117.377ZM231.711 124.103C230.003 124.109 228.794 123.06 228.692 121.486L229.772 121.482C229.877 122.44 230.698 123.097 231.771 123.093C232.951 123.089 233.735 122.254 233.731 121.01C233.726 119.753 232.929 118.906 231.755 118.91C230.936 118.913 230.259 119.29 229.899 119.939L228.839 119.943L229.283 114.768L234.292 114.749L234.295 115.759L230.169 115.774L229.926 118.765L230.028 118.764C230.477 118.217 231.129 117.929 231.936 117.926C233.63 117.919 234.816 119.178 234.822 120.981C234.829 122.834 233.571 124.096 231.711 124.103ZM239.83 124.098C237.837 124.105 236.732 122.408 236.721 119.323C236.709 116.238 237.801 114.533 239.794 114.526C241.781 114.518 242.892 116.215 242.903 119.3C242.915 122.385 241.816 124.091 239.83 124.098ZM237.831 119.319C237.833 119.681 237.853 120.017 237.88 120.328L241.562 117.23C241.26 116.095 240.661 115.513 239.798 115.516C238.503 115.521 237.822 116.831 237.831 119.319ZM239.826 123.108C241.121 123.103 241.795 121.786 241.786 119.305C241.785 118.936 241.771 118.6 241.738 118.283L238.068 121.407C238.37 122.529 238.963 123.111 239.826 123.108Z" fill="black"></path>
<rect x="268.531" y="187.781" width="35" height="35" transform="rotate(-0.212766 268.531 187.781)" fill="#824665"></rect>
<path d="M269.537 222.75L285.895 206.344L302.125 222.599L269.537 222.75Z" fill="#F99D52"></path>
<path d="M303.387 187.332L304.094 188.039L265.389 226.832L264.682 226.125L303.387 187.332Z" fill="white"></path>
<path d="M266.137 186.582L266.844 185.875L305.637 224.58L304.93 225.287L266.137 186.582Z" fill="white"></path>
<path d="M301.8 188.219L285.856 204.173L270.142 188.219H301.8Z" fill="#EF402C" stroke="#EF402C"></path>
<path d="M303.666 222.62L303.566 188.609L286.594 205.591L303.666 222.62Z" fill="#FFCBCC"></path>
</svg>

<figcaption><b>Fixed # Split-KV Strategy (i.e. FlashDecode)</b> If our query length becomes very small (like it does during decoding), we may end up in a situation where there is very little parallelism in our kernel at all. In these cases, we'll need to once again split along the reduction dimension --- the KV dimension this time. The typical strategy for how to split along the KV dimension is to figure out how much parallelism we need and then divide the KV dimension evenly. For example, if our KV length was 1000 and we needed 4 splits, each core would handle 250 elements.
<p>This unfortunately also breaks batch invariance, as our precise reduction strategy depends on how many query tokens from the sequence we’re processing in any given request.</p>
</figcaption>
</figure>
<p>Furthermore, the split-reduction strategies commonly used for attention also pose challenges for batch invariance. For example, FlashInfer’s “balanced scheduling algorithm” chooses the largest split-size that can still saturate all the GPU’s cores, thus making the reduction strategy not “batch-invariant”. However, unlike with RMSNorm/Matmuls, it’s not sufficient to choose a fixed number of splits regardless of the batch size.</p>
<p>Instead, to achieve batch invariance, we must adopt a “fixed split-size” strategy. In other words, instead of fixing the # of splits, we fix the size of each split and then end up with a varying number of splits. In this manner, we can guarantee that regardless of how many tokens we’re processing, we always perform the identical reduction order. <label for="sn11"></label><span>This requires some internal FlexAttention changes that are not included in our code release. We will upstream them in the near future!</span></p>
<figure>
<svg width="386" height="288" viewBox="0 0 386 288" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="386" height="288" fill="#F5F5F5"></rect>
<rect width="386" height="288" fill="white"></rect>
<path d="M29.8296 205.817L31.5068 206.828C32.3271 207.311 32.979 207.641 33.4624 207.816C33.9458 207.997 34.4048 208.087 34.8394 208.087C34.981 208.087 35.147 208.075 35.3374 208.051C35.5278 208.026 35.7573 207.987 36.0259 207.934L36.1138 208.388C35.4204 208.583 34.9053 208.71 34.5684 208.769C34.2363 208.832 33.9409 208.864 33.6821 208.864C32.6421 208.864 30.9038 208.039 28.4673 206.388L28.167 206.183C28.1328 206.183 28.0791 206.186 28.0059 206.19C27.9375 206.195 27.8862 206.198 27.8521 206.198C26.3579 206.198 25.1226 205.685 24.146 204.66C23.1743 203.634 22.6885 202.34 22.6885 200.778C22.6885 199.997 22.8325 199.264 23.1206 198.581C23.4136 197.897 23.8359 197.289 24.3877 196.757C24.876 196.288 25.4326 195.929 26.0576 195.68C26.6826 195.431 27.3345 195.307 28.0132 195.307C28.7456 195.307 29.4023 195.414 29.9834 195.629C30.5693 195.844 31.0991 196.171 31.5728 196.61C32.144 197.152 32.5811 197.777 32.8838 198.485C33.1865 199.193 33.3379 199.943 33.3379 200.734C33.3379 201.945 33.0327 202.995 32.4224 203.883C31.812 204.772 30.9478 205.417 29.8296 205.817ZM31.7192 200.99C31.7192 199.569 31.353 198.405 30.6206 197.497C29.8882 196.583 28.9653 196.127 27.8521 196.127C26.7827 196.127 25.9233 196.518 25.2739 197.299C24.6294 198.08 24.3071 199.125 24.3071 200.434C24.3071 201.903 24.6758 203.1 25.4131 204.022C26.1504 204.94 27.0879 205.399 28.2256 205.399C29.2705 205.399 30.1128 204.999 30.7524 204.198C31.397 203.393 31.7192 202.323 31.7192 200.99Z" fill="black"></path>
<path d="M178.401 82.5483C178.714 82.5679 179.024 82.5825 179.332 82.5923C179.639 82.6021 179.939 82.6069 180.232 82.6069C180.442 82.6069 180.684 82.6021 180.958 82.5923C181.231 82.5825 181.531 82.5679 181.858 82.5483V83.0391H181.792C181.236 83.0391 180.701 83.2808 180.188 83.7642L180.115 83.8374L176.482 87.3164L179.83 90.6782C179.917 90.7661 180.042 90.8906 180.203 91.0518C181.146 92.0186 181.836 92.502 182.276 92.502C182.33 92.502 182.371 92.502 182.4 92.502C182.43 92.4971 182.452 92.4922 182.466 92.4873L182.474 93C182.396 92.9951 182.291 92.9902 182.159 92.9854C181.651 92.9561 181.304 92.9414 181.119 92.9414C180.933 92.9414 180.721 92.9463 180.481 92.9561C180.247 92.9658 179.996 92.9805 179.727 93C179.732 92.9854 179.734 92.9756 179.734 92.9707C179.739 92.9609 179.742 92.9463 179.742 92.9268C179.742 92.6729 178.963 91.772 177.405 90.2241C176.463 89.2817 175.696 88.5078 175.105 87.9023L177.925 84.8555C178.052 84.7139 178.226 84.5283 178.445 84.2988C178.938 83.7666 179.185 83.4517 179.185 83.354C179.185 83.2466 179.136 83.1685 179.039 83.1196C178.946 83.0659 178.794 83.0391 178.584 83.0391H178.401V82.5483ZM172.571 82.5483C172.918 82.5679 173.25 82.5825 173.567 82.5923C173.885 82.6021 174.173 82.6069 174.432 82.6069C174.734 82.6069 175.042 82.6021 175.354 82.5923C175.667 82.5825 175.984 82.5679 176.307 82.5483V83.0391H176.211C175.772 83.0391 175.477 83.1489 175.325 83.3687C175.179 83.5884 175.105 84.1548 175.105 85.0679V90.4219C175.105 91.3789 175.176 91.9648 175.318 92.1797C175.459 92.3945 175.743 92.502 176.167 92.502C176.192 92.502 176.231 92.4995 176.285 92.4946C176.338 92.4897 176.38 92.4873 176.409 92.4873V93C176.043 92.9805 175.691 92.9658 175.354 92.9561C175.022 92.9463 174.715 92.9414 174.432 92.9414C174.207 92.9414 173.931 92.9463 173.604 92.9561C173.277 92.9658 172.918 92.9805 172.527 93V92.4946C172.557 92.4946 172.588 92.4971 172.623 92.502C172.657 92.502 172.703 92.502 172.762 92.502C173.147 92.502 173.409 92.3677 173.545 92.0991C173.687 91.8257 173.758 91.2202 173.758 90.2827C173.758 90.1558 173.755 89.9165 173.75 89.5649C173.746 89.2134 173.743 88.9277 173.743 88.708V86.7598C173.743 86.5156 173.746 86.2056 173.75 85.8296C173.755 85.4487 173.758 85.1899 173.758 85.0532C173.758 84.2085 173.687 83.6616 173.545 83.4126C173.409 83.1636 173.147 83.0391 172.762 83.0391C172.747 83.0391 172.718 83.0415 172.674 83.0464C172.63 83.0513 172.596 83.0537 172.571 83.0537V82.5483Z" fill="black"></path>
<path d="M297.103 86.5483C297.469 86.5679 297.815 86.5825 298.143 86.5923C298.47 86.6021 298.758 86.6069 299.007 86.6069C299.319 86.6069 299.637 86.6021 299.959 86.5923C300.286 86.5825 300.621 86.5679 300.962 86.5483L300.955 87.0098C300.545 87.0439 300.271 87.0977 300.135 87.1709C300.003 87.2441 299.937 87.3711 299.937 87.5518C299.937 87.6885 299.961 87.8618 300.01 88.0718C300.064 88.2769 300.157 88.5625 300.289 88.9287L302.493 95.0957C303.67 92.1416 304.41 90.2275 304.712 89.3535C305.02 88.4746 305.174 87.8984 305.174 87.625C305.174 87.4004 305.113 87.2466 304.991 87.1636C304.874 87.0806 304.6 87.0293 304.17 87.0098V86.5483C304.463 86.5679 304.751 86.5825 305.035 86.5923C305.323 86.6021 305.604 86.6069 305.877 86.6069C306.111 86.6069 306.373 86.6021 306.661 86.5923C306.949 86.5825 307.249 86.5679 307.562 86.5483V87.0098H307.452C306.915 87.0098 306.458 87.4834 306.082 88.4307C305.999 88.6455 305.931 88.8115 305.877 88.9287C304.5 92.2344 303.614 94.3853 303.218 95.3813C302.823 96.3774 302.615 96.9561 302.596 97.1172H301.695C301.695 97 301.468 96.27 301.014 94.9272C300.56 93.5845 300.01 92.0635 299.366 90.3643C299.322 90.2422 299.258 90.0688 299.175 89.8442C298.467 87.9448 297.842 86.9951 297.3 86.9951C297.251 86.9951 297.212 86.9976 297.183 87.0024C297.159 87.0024 297.132 87.0049 297.103 87.0098V86.5483Z" fill="black"></path>
<rect x="106" y="183" width="35" height="35" fill="#EF402C"></rect>
<rect x="142" y="183" width="35" height="35" fill="#F78427"></rect>
<rect x="178" y="183" width="35" height="35" fill="#FFA8AA"></rect>
<rect x="214" y="183" width="17.5" height="35" fill="#824665"></rect>
<rect x="106" y="128" width="35" height="35" fill="#EF402C"></rect>
<rect x="142" y="128" width="35" height="35" fill="#F78427"></rect>
<rect x="178" y="128" width="35" height="35" fill="#FFA8AA"></rect>
<rect x="214" y="128" width="17.5" height="35" fill="#824665"></rect>
<path d="M51 183H86V218H51V183Z" fill="#E7E1DF"></path>
<rect x="249" y="20.1289" width="35" height="35" transform="rotate(-0.212766 249 20.1289)" fill="#EF402C"></rect>
<rect opacity="0.8" x="249.133" y="56.1289" width="35" height="35" transform="rotate(-0.212766 249.133 56.1289)" fill="#F78427"></rect>
<rect opacity="0.6" x="249.268" y="92.1289" width="35" height="35" transform="rotate(-0.212766 249.268 92.1289)" fill="#FFA8AA"></rect>
<rect x="249.4" y="128.129" width="35" height="35" transform="rotate(-0.212766 249.4 128.129)" fill="#824665"></rect>
<path d="M334.646 158.354C334.842 158.549 335.158 158.549 335.354 158.354L338.536 155.172C338.731 154.976 338.731 154.66 338.536 154.464C338.34 154.269 338.024 154.269 337.828 154.464L335 157.293L332.172 154.464C331.976 154.269 331.66 154.269 331.464 154.464C331.269 154.66 331.269 154.976 331.464 155.172L334.646 158.354ZM335 42L334.5 42L334.5 158L335 158L335.5 158L335.5 42L335 42Z" fill="black"></path>
<path d="M192.398 258.137C192.462 258.146 192.528 258.151 192.596 258.151C192.665 258.151 192.767 258.151 192.904 258.151C193.939 258.151 194.752 257.934 195.343 257.5C195.938 257.065 196.236 256.474 196.236 255.727C196.236 255.058 196.053 254.55 195.687 254.204C195.321 253.857 194.789 253.684 194.09 253.684C193.983 253.684 193.849 253.688 193.688 253.698C193.531 253.708 193.355 253.723 193.16 253.742C192.955 254.885 192.792 255.8 192.669 256.489C192.552 257.177 192.462 257.727 192.398 258.137ZM189.308 262.517H189.593C189.896 262.517 190.111 262.431 190.238 262.26C190.37 262.084 190.504 261.601 190.641 260.81L191.703 254.482C191.717 254.409 191.729 254.34 191.739 254.277C191.749 254.213 191.754 254.162 191.754 254.123C191.754 253.923 191.686 253.776 191.549 253.684C191.417 253.586 191.214 253.537 190.941 253.537H190.743L190.838 252.995C191.146 253.024 191.427 253.046 191.681 253.061C191.935 253.076 192.164 253.083 192.369 253.083C192.687 253.083 193.109 253.068 193.636 253.039C194.168 253.01 194.54 252.995 194.75 252.995C195.648 252.995 196.349 253.203 196.852 253.618C197.359 254.028 197.613 254.594 197.613 255.317C197.613 256.005 197.394 256.611 196.954 257.133C196.515 257.651 195.87 258.071 195.021 258.393L196.134 260.51C196.163 260.573 196.209 260.668 196.273 260.795C196.893 262.006 197.555 262.612 198.258 262.612C198.282 262.612 198.319 262.609 198.368 262.604C198.421 262.6 198.46 262.597 198.485 262.597L198.397 263.088C198.172 263.127 197.984 263.154 197.833 263.168C197.682 263.188 197.55 263.198 197.438 263.198C196.993 263.198 196.615 263.117 196.302 262.956C195.99 262.79 195.733 262.539 195.533 262.202C195.392 261.972 195.128 261.447 194.742 260.627C194.361 259.807 194.054 259.157 193.819 258.679C193.663 258.693 193.504 258.706 193.343 258.715C193.187 258.72 193.026 258.723 192.86 258.723C192.796 258.723 192.701 258.72 192.574 258.715C192.452 258.71 192.357 258.708 192.289 258.708L191.871 261.469C191.856 261.572 191.844 261.662 191.834 261.74C191.83 261.813 191.827 261.875 191.827 261.923C191.827 262.163 191.878 262.321 191.981 262.399C192.088 262.478 192.311 262.517 192.647 262.517H192.816L192.721 263C192.56 262.995 192.333 262.985 192.04 262.971C191.468 262.951 191.102 262.941 190.941 262.941C190.692 262.941 190.252 262.956 189.623 262.985C189.452 262.99 189.315 262.995 189.212 263L189.308 262.517ZM200.858 259.697L200.931 259.66C202.669 258.771 203.539 258.085 203.539 257.602C203.539 257.343 203.446 257.119 203.26 256.928C203.075 256.738 202.857 256.643 202.608 256.643C202.223 256.643 201.876 256.909 201.568 257.441C201.261 257.973 201.024 258.725 200.858 259.697ZM203.062 259.191L200.821 260.349V260.422C200.821 261.003 200.912 261.445 201.092 261.748C201.278 262.05 201.544 262.202 201.891 262.202C202.096 262.202 202.352 262.111 202.66 261.931C202.972 261.745 203.37 261.447 203.854 261.037L204.11 261.499C203.412 262.143 202.855 262.59 202.44 262.839C202.03 263.088 201.656 263.212 201.319 263.212C200.807 263.212 200.392 262.99 200.074 262.546C199.757 262.102 199.598 261.518 199.598 260.795C199.598 260.283 199.681 259.733 199.847 259.147C200.018 258.557 200.238 258.042 200.506 257.602C200.843 257.065 201.229 256.65 201.664 256.357C202.098 256.064 202.547 255.917 203.011 255.917C203.485 255.917 203.88 256.069 204.198 256.372C204.52 256.669 204.681 257.033 204.681 257.463C204.681 257.81 204.583 258.098 204.388 258.327C204.198 258.552 203.756 258.84 203.062 259.191ZM209.405 260.378L209.955 257.06C209.686 256.904 209.447 256.792 209.237 256.723C209.027 256.65 208.832 256.613 208.651 256.613C208.05 256.613 207.545 256.999 207.135 257.771C206.725 258.537 206.52 259.494 206.52 260.642C206.52 261.105 206.573 261.457 206.681 261.696C206.793 261.936 206.957 262.055 207.171 262.055C207.318 262.055 207.589 261.906 207.984 261.608C208.385 261.311 208.858 260.9 209.405 260.378ZM209.42 261.125L208.175 262.253C207.809 262.585 207.516 262.814 207.296 262.941C207.081 263.068 206.878 263.132 206.688 263.132C206.249 263.132 205.912 262.946 205.677 262.575C205.443 262.199 205.326 261.66 205.326 260.957C205.326 259.57 205.675 258.378 206.373 257.382C207.076 256.386 207.911 255.888 208.878 255.888C209.073 255.888 209.271 255.915 209.471 255.969C209.676 256.018 209.889 256.091 210.108 256.188L210.526 253.537C210.541 253.435 210.55 253.332 210.555 253.229C210.565 253.122 210.57 253.015 210.57 252.907C210.57 252.712 210.531 252.578 210.453 252.504C210.375 252.431 210.23 252.395 210.021 252.395C209.957 252.395 209.891 252.397 209.823 252.402C209.759 252.402 209.688 252.404 209.61 252.409L209.581 251.977C209.986 251.938 210.394 251.884 210.804 251.816C211.219 251.748 211.637 251.665 212.057 251.567C211.603 253.911 211.229 256.027 210.936 257.917C210.643 259.802 210.497 260.947 210.497 261.352C210.497 261.601 210.519 261.777 210.562 261.879C210.611 261.977 210.689 262.026 210.797 262.026C210.855 262.026 210.924 262.001 211.002 261.953C211.085 261.904 211.188 261.823 211.31 261.711L211.756 261.308L211.998 261.726L211.156 262.553C210.863 262.836 210.65 263.017 210.519 263.095C210.387 263.173 210.26 263.212 210.138 263.212C209.879 263.212 209.688 263.09 209.566 262.846C209.449 262.602 209.391 262.224 209.391 261.711C209.391 261.599 209.393 261.499 209.398 261.411C209.403 261.318 209.41 261.223 209.42 261.125ZM219.491 261.77L218.48 262.714C218.299 262.89 218.136 263.015 217.989 263.088C217.848 263.161 217.701 263.198 217.55 263.198C217.33 263.198 217.152 263.093 217.015 262.883C216.883 262.668 216.817 262.382 216.817 262.026C216.817 261.923 216.825 261.801 216.839 261.66C216.859 261.513 216.896 261.286 216.949 260.979C216.046 261.901 215.406 262.502 215.03 262.78C214.654 263.059 214.334 263.198 214.071 263.198C213.792 263.198 213.561 263.068 213.375 262.81C213.189 262.551 213.097 262.219 213.097 261.813C213.097 261.472 213.243 260.703 213.536 259.506C213.609 259.223 213.663 259.008 213.697 258.862C213.8 258.457 213.875 258.132 213.924 257.888C213.973 257.639 213.998 257.453 213.998 257.331C213.998 257.233 213.973 257.155 213.924 257.097C213.875 257.033 213.814 257.001 213.741 257.001C213.692 257.001 213.597 257.036 213.456 257.104C213.314 257.172 213.119 257.277 212.87 257.419L212.665 257.016C213.119 256.679 213.517 256.418 213.858 256.232C214.2 256.042 214.442 255.947 214.583 255.947C214.784 255.947 214.94 256.032 215.052 256.203C215.169 256.374 215.228 256.611 215.228 256.914C215.228 257.294 215.077 258.032 214.774 259.125C214.476 260.219 214.327 261.04 214.327 261.586C214.327 261.757 214.356 261.884 214.415 261.967C214.474 262.045 214.564 262.084 214.686 262.084C214.823 262.084 215.055 261.95 215.382 261.682C215.714 261.408 216.268 260.888 217.044 260.122C217.23 259.243 217.379 258.5 217.491 257.895C217.608 257.285 217.699 256.74 217.762 256.262L219.081 255.947L218.919 256.672C218.641 257.858 218.49 258.52 218.465 258.657L218.29 259.594C218.202 260.039 218.131 260.463 218.077 260.869C218.028 261.274 218.004 261.56 218.004 261.726C218.004 261.838 218.026 261.926 218.07 261.989C218.114 262.053 218.172 262.084 218.246 262.084C218.314 262.084 218.441 262.019 218.626 261.887C218.812 261.755 219.024 261.577 219.264 261.352L219.491 261.77ZM224.793 257.177L224.405 257.558C224.083 257.231 223.824 257.014 223.629 256.906C223.438 256.799 223.243 256.745 223.043 256.745C222.594 256.745 222.203 257.08 221.871 257.749C221.539 258.413 221.373 259.233 221.373 260.209C221.373 260.864 221.458 261.357 221.629 261.689C221.8 262.021 222.052 262.187 222.384 262.187C222.569 262.187 222.823 262.082 223.146 261.872C223.468 261.657 223.807 261.364 224.164 260.993L224.464 261.513C223.897 262.114 223.414 262.548 223.014 262.817C222.613 263.081 222.247 263.212 221.915 263.212C221.388 263.212 220.965 262.983 220.648 262.524C220.335 262.065 220.179 261.445 220.179 260.664C220.179 259.326 220.521 258.198 221.205 257.28C221.893 256.362 222.74 255.903 223.746 255.903C224.112 255.903 224.425 255.981 224.684 256.137C224.947 256.293 225.079 256.472 225.079 256.672C225.079 256.75 225.057 256.828 225.013 256.906C224.974 256.984 224.901 257.075 224.793 257.177ZM228.792 254.24C228.7 254.567 228.57 255.08 228.404 255.778C228.355 255.983 228.319 256.135 228.294 256.232C228.583 256.232 228.875 256.23 229.173 256.225C229.476 256.215 229.793 256.203 230.125 256.188L229.95 256.921C229.818 256.916 229.671 256.914 229.51 256.914C229.349 256.914 229.09 256.914 228.734 256.914H228.148C227.918 257.919 227.748 258.798 227.635 259.55C227.528 260.302 227.474 260.932 227.474 261.44C227.474 261.655 227.508 261.823 227.577 261.945C227.65 262.067 227.75 262.128 227.877 262.128C227.975 262.128 228.128 262.05 228.338 261.894C228.548 261.738 228.834 261.486 229.195 261.14L229.452 261.608C228.749 262.331 228.265 262.792 228.001 262.993C227.738 263.188 227.516 263.286 227.335 263.286C226.998 263.286 226.729 263.127 226.529 262.81C226.329 262.492 226.229 262.06 226.229 261.513C226.229 261.157 226.285 260.646 226.397 259.982C226.51 259.313 226.722 258.278 227.035 256.877C226.957 256.877 226.854 256.879 226.727 256.884C226.605 256.889 226.522 256.892 226.478 256.892H225.973L226.061 256.401C226.285 256.391 226.49 256.352 226.676 256.284C226.866 256.215 227.057 256.108 227.247 255.961C227.291 255.786 227.34 255.603 227.394 255.412C227.452 255.217 227.518 255.012 227.591 254.797L228.792 254.24ZM233.634 261.337L233.89 261.77C233.29 262.39 232.872 262.785 232.638 262.956C232.403 263.127 232.196 263.212 232.015 263.212C231.756 263.212 231.549 263.105 231.393 262.89C231.236 262.67 231.158 262.377 231.158 262.011C231.158 261.552 231.302 260.786 231.59 259.711C231.883 258.637 232.03 257.863 232.03 257.39C232.03 257.268 232 257.17 231.942 257.097C231.883 257.023 231.808 256.987 231.715 256.987C231.637 256.987 231.534 257.019 231.407 257.082C231.28 257.146 231.122 257.243 230.931 257.375L230.711 256.987L231.686 256.276C231.871 256.14 232.032 256.042 232.169 255.983C232.306 255.92 232.435 255.888 232.557 255.888C232.787 255.888 232.967 255.983 233.099 256.174C233.236 256.359 233.304 256.616 233.304 256.943C233.304 257.299 233.177 257.998 232.923 259.038C232.865 259.272 232.821 259.448 232.792 259.565C232.655 260.117 232.55 260.573 232.477 260.935C232.408 261.296 232.374 261.545 232.374 261.682C232.374 261.804 232.401 261.904 232.455 261.982C232.508 262.06 232.577 262.099 232.66 262.099C232.738 262.099 232.84 262.05 232.967 261.953C233.094 261.855 233.316 261.65 233.634 261.337ZM233.575 251.896L233.993 252.365C234.11 252.487 234.19 252.597 234.234 252.695C234.283 252.788 234.308 252.883 234.308 252.98C234.308 253.083 234.271 253.181 234.198 253.273C234.129 253.366 234.027 253.454 233.89 253.537L233.246 253.896L232.777 253.339C232.679 253.217 232.616 253.122 232.586 253.054C232.557 252.98 232.542 252.905 232.542 252.827C232.542 252.714 232.572 252.617 232.63 252.534C232.689 252.446 232.789 252.36 232.931 252.277L233.575 251.896ZM238.167 256.628C237.601 256.628 237.113 257.016 236.703 257.792C236.292 258.569 236.087 259.526 236.087 260.664C236.087 261.264 236.19 261.723 236.395 262.041C236.605 262.358 236.908 262.517 237.303 262.517C237.899 262.517 238.404 262.136 238.819 261.374C239.239 260.607 239.449 259.67 239.449 258.562C239.449 257.902 239.344 257.417 239.134 257.104C238.924 256.787 238.602 256.628 238.167 256.628ZM238.482 255.917C239.21 255.917 239.762 256.145 240.138 256.599C240.519 257.048 240.709 257.707 240.709 258.576C240.709 259.074 240.611 259.606 240.416 260.173C240.221 260.734 239.957 261.242 239.625 261.696C239.269 262.185 238.863 262.561 238.409 262.824C237.96 263.083 237.486 263.212 236.988 263.212C236.334 263.212 235.812 262.976 235.421 262.502C235.035 262.028 234.842 261.394 234.842 260.598C234.842 260.007 234.938 259.431 235.128 258.869C235.318 258.308 235.592 257.8 235.948 257.346C236.3 256.892 236.698 256.54 237.142 256.291C237.591 256.042 238.038 255.917 238.482 255.917ZM243.888 258.02L245.074 256.862C245.489 256.467 245.802 256.206 246.012 256.079C246.227 255.952 246.429 255.888 246.62 255.888C246.942 255.888 247.203 256.03 247.403 256.313C247.608 256.596 247.711 256.97 247.711 257.434C247.711 257.907 247.591 258.64 247.352 259.631C247.113 260.617 246.993 261.32 246.993 261.74C246.993 261.867 247.018 261.965 247.066 262.033C247.115 262.097 247.186 262.128 247.279 262.128C247.323 262.128 247.376 262.111 247.44 262.077C247.508 262.038 247.574 261.987 247.638 261.923L248.194 261.381L248.451 261.77L247.652 262.583C247.462 262.778 247.271 262.932 247.081 263.044C246.896 263.156 246.732 263.212 246.59 263.212C246.346 263.212 246.146 263.107 245.99 262.897C245.838 262.683 245.763 262.402 245.763 262.055C245.763 261.64 245.887 260.91 246.136 259.865C246.385 258.815 246.51 258.051 246.51 257.573C246.51 257.392 246.471 257.248 246.393 257.141C246.319 257.028 246.219 256.972 246.092 256.972C245.902 256.972 245.318 257.424 244.342 258.327C244.083 258.566 243.88 258.754 243.734 258.891L243.272 261.469C243.263 261.518 243.248 261.591 243.229 261.689C243.126 262.211 243.065 262.612 243.045 262.89L241.742 263.212C242.064 261.811 242.318 260.593 242.503 259.558C242.694 258.522 242.789 257.844 242.789 257.521C242.789 257.326 242.767 257.187 242.723 257.104C242.679 257.016 242.608 256.972 242.511 256.972C242.452 256.972 242.354 257.006 242.218 257.075C242.086 257.143 241.917 257.243 241.712 257.375L241.515 256.987C241.568 256.943 241.646 256.879 241.749 256.796C242.501 256.191 243.004 255.888 243.258 255.888C243.502 255.888 243.683 255.981 243.8 256.167C243.917 256.347 243.976 256.63 243.976 257.016C243.976 257.153 243.968 257.307 243.954 257.478C243.939 257.648 243.917 257.829 243.888 258.02Z" fill="black"></path>
<path d="M249.354 242.354C249.549 242.158 249.549 241.842 249.354 241.646L246.172 238.464C245.976 238.269 245.66 238.269 245.464 238.464C245.269 238.66 245.269 238.976 245.464 239.172L248.293 242L245.464 244.828C245.269 245.024 245.269 245.34 245.464 245.536C245.66 245.731 245.976 245.731 246.172 245.536L249.354 242.354ZM113 242V242.5H249V242V241.5H113V242Z" fill="black"></path>
<path d="M113.568 113.505C113.562 111.893 114.751 110.733 116.42 110.727C118.102 110.721 119.262 111.758 119.267 113.288C119.271 114.24 118.842 115.003 117.388 116.602L115.238 118.958L115.239 119.066L119.435 119.051L119.438 120.066L113.643 120.088L113.64 119.313L116.725 115.855C117.882 114.549 118.159 114.06 118.157 113.336C118.153 112.352 117.459 111.707 116.392 111.711C115.338 111.715 114.643 112.422 114.647 113.501L114.647 113.54L113.568 113.544L113.568 113.505ZM124.473 120.232C122.765 120.238 121.555 119.189 121.454 117.615L122.533 117.611C122.638 118.569 123.46 119.226 124.532 119.222C125.713 119.218 126.497 118.383 126.492 117.139C126.488 115.882 125.691 115.035 124.517 115.039C123.698 115.042 123.02 115.419 122.661 116.068L121.601 116.072L122.045 110.897L127.053 110.878L127.057 111.887L122.931 111.903L122.688 114.893L122.79 114.893C123.238 114.346 123.891 114.057 124.697 114.054C126.392 114.048 127.577 115.307 127.584 117.11C127.591 118.963 126.333 120.225 124.473 120.232ZM132.591 120.227C130.598 120.234 129.494 118.537 129.482 115.452C129.471 112.367 130.563 110.662 132.556 110.655C134.543 110.647 135.653 112.344 135.665 115.429C135.676 118.514 134.578 120.219 132.591 120.227ZM130.593 115.448C130.595 115.81 130.615 116.146 130.641 116.457L134.324 113.359C134.022 112.223 133.423 111.642 132.56 111.645C131.265 111.65 130.584 112.96 130.593 115.448ZM132.588 119.237C133.883 119.232 134.557 117.915 134.548 115.433C134.546 115.065 134.532 114.729 134.499 114.412L130.829 117.536C131.132 118.658 131.724 119.24 132.588 119.237Z" fill="black"></path>
<path d="M148.568 113.505C148.562 111.893 149.751 110.733 151.42 110.727C153.102 110.721 154.262 111.758 154.267 113.288C154.271 114.24 153.842 115.003 152.388 116.602L150.238 118.958L150.239 119.066L154.435 119.051L154.438 120.066L148.643 120.088L148.64 119.313L151.725 115.855C152.882 114.549 153.159 114.06 153.157 113.336C153.153 112.352 152.459 111.707 151.392 111.711C150.338 111.715 149.643 112.422 149.647 113.501L149.647 113.54L148.568 113.544L148.568 113.505ZM159.473 120.232C157.765 120.238 156.555 119.189 156.454 117.615L157.533 117.611C157.638 118.569 158.46 119.226 159.532 119.222C160.713 119.218 161.497 118.383 161.492 117.139C161.488 115.882 160.691 115.035 159.517 115.039C158.698 115.042 158.02 115.419 157.661 116.068L156.601 116.072L157.045 110.897L162.053 110.878L162.057 111.887L157.931 111.903L157.688 114.893L157.79 114.893C158.238 114.346 158.891 114.057 159.697 114.054C161.392 114.048 162.577 115.307 162.584 117.11C162.591 118.963 161.333 120.225 159.473 120.232ZM167.591 120.227C165.598 120.234 164.494 118.537 164.482 115.452C164.471 112.367 165.563 110.662 167.556 110.655C169.543 110.647 170.653 112.344 170.665 115.429C170.676 118.514 169.578 120.219 167.591 120.227ZM165.593 115.448C165.595 115.81 165.615 116.146 165.641 116.457L169.324 113.359C169.022 112.223 168.423 111.642 167.56 111.645C166.265 111.65 165.584 112.96 165.593 115.448ZM167.588 119.237C168.883 119.232 169.557 117.915 169.548 115.433C169.546 115.065 169.532 114.729 169.499 114.412L165.829 117.536C166.132 118.658 166.724 119.24 167.588 119.237Z" fill="black"></path>
<path d="M184.568 113.505C184.562 111.893 185.751 110.733 187.42 110.727C189.102 110.721 190.262 111.758 190.267 113.288C190.271 114.24 189.842 115.003 188.388 116.602L186.238 118.958L186.239 119.066L190.435 119.051L190.438 120.066L184.643 120.088L184.64 119.313L187.725 115.855C188.882 114.549 189.159 114.06 189.157 113.336C189.153 112.352 188.459 111.707 187.392 111.711C186.338 111.715 185.643 112.422 185.647 113.501L185.647 113.54L184.568 113.544L184.568 113.505ZM195.473 120.232C193.765 120.238 192.555 119.189 192.454 117.615L193.533 117.611C193.638 118.569 194.46 119.226 195.532 119.222C196.713 119.218 197.497 118.383 197.492 117.139C197.488 115.882 196.691 115.035 195.517 115.039C194.698 115.042 194.02 115.419 193.661 116.068L192.601 116.072L193.045 110.897L198.053 110.878L198.057 111.887L193.931 111.903L193.688 114.893L193.79 114.893C194.238 114.346 194.891 114.057 195.697 114.054C197.392 114.048 198.577 115.307 198.584 117.11C198.591 118.963 197.333 120.225 195.473 120.232ZM203.591 120.227C201.598 120.234 200.494 118.537 200.482 115.452C200.471 112.367 201.563 110.662 203.556 110.655C205.543 110.647 206.653 112.344 206.665 115.429C206.676 118.514 205.578 120.219 203.591 120.227ZM201.593 115.448C201.595 115.81 201.615 116.146 201.641 116.457L205.324 113.359C205.022 112.223 204.423 111.642 203.56 111.645C202.265 111.65 201.584 112.96 201.593 115.448ZM203.588 119.237C204.883 119.232 205.557 117.915 205.548 115.433C205.546 115.065 205.532 114.729 205.499 114.412L201.829 117.536C202.132 118.658 202.724 119.24 203.588 119.237Z" fill="black"></path>
<path d="M211.568 86.5055C211.562 84.8932 212.751 83.7335 214.42 83.7273C216.102 83.721 217.262 84.7577 217.267 86.2875C217.271 87.2397 216.842 88.003 215.388 89.6016L213.238 91.9583L213.239 92.0662L217.435 92.0506L217.438 93.0662L211.643 93.0877L211.64 92.3133L214.725 88.8551C215.882 87.5495 216.159 87.0597 216.157 86.3361C216.153 85.3522 215.459 84.7073 214.392 84.7113C213.338 84.7152 212.643 85.4224 212.647 86.5014L212.647 86.5395L211.568 86.5435L211.568 86.5055ZM221.415 88.8048L221.412 87.8654L222.408 87.8617C223.437 87.8579 224.151 87.1824 224.148 86.2239C224.144 85.2908 223.457 84.6776 222.422 84.6814C221.394 84.6853 220.71 85.2908 220.625 86.275L219.552 86.279C219.654 84.6917 220.768 83.7037 222.463 83.6974C224.1 83.6913 225.272 84.6709 225.277 86.061C225.281 87.1655 224.707 87.9547 223.724 88.1996L223.724 88.3011C224.943 88.4553 225.67 89.3095 225.675 90.56C225.68 92.1152 224.377 93.2309 222.549 93.2377C220.74 93.2444 219.479 92.208 219.391 90.6278L220.451 90.6239C220.556 91.601 221.371 92.2328 222.513 92.2285C223.77 92.2239 224.549 91.5735 224.545 90.5388C224.541 89.4724 223.732 88.7962 222.463 88.8009L221.415 88.8048ZM227.64 86.4458C227.634 84.8335 228.823 83.6738 230.492 83.6676C232.175 83.6613 233.334 84.6981 233.339 86.2278C233.343 87.18 232.914 87.9433 231.46 89.542L229.311 91.8986L229.311 92.0065L233.507 91.9909L233.511 93.0065L227.715 93.0281L227.712 92.2536L230.797 88.7954C231.954 87.4898 232.231 87 232.229 86.2764C232.225 85.2925 231.531 84.6476 230.464 84.6516C229.411 84.6555 228.715 85.3627 228.719 86.4418L228.719 86.4798L227.64 86.4839L227.64 86.4458Z" fill="black"></path>
<path d="M222.406 99.625V138.168" stroke="black"></path>
<rect x="249.531" y="182.809" width="35" height="35" transform="rotate(-0.212766 249.531 182.809)" fill="#824665"></rect>
<path d="M250.537 217.777L266.895 201.371L283.125 217.627L250.537 217.777Z" fill="#F99D52"></path>
<path d="M284.387 182.359L285.094 183.066L246.389 221.859L245.682 221.152L284.387 182.359Z" fill="white"></path>
<path d="M247.137 181.609L247.844 180.902L286.637 219.607L285.93 220.315L247.137 181.609Z" fill="white"></path>
<path d="M282.8 183.246L266.856 199.2L251.142 183.246H282.8Z" fill="#EF402C" stroke="#EF402C"></path>
<path d="M284.666 217.647L284.566 183.637L267.594 200.619L284.666 217.647Z" fill="#FFCBCC"></path>
</svg>

<figcaption><b>Fixed Size Split-KV Strategy</b> 
The only difference between this strategy and the previous strategy is that our splits are now "fixed size". For example, if our KV length was 1000, instead of splitting it into four even length 250 splits, we would split it into three fixed-size length 256 splits and one length 232 split.
<p>This allows us to <em>preserve</em> batch invariance as our reduction strategy is no longer dependent on how many query tokens we’re processing at once!</p>
 </figcaption>
</figure>
<h2 id="implementation">Implementation</h2>
<p>We provide a demonstration of deterministic inference on top of vLLM by leveraging its FlexAttention backend as well as torch.Library.
Through torch.Library, we’re able to substitute out most of the relevant PyTorch operators in an unintrusive way. You can find the library of “batch-invariant” kernels at <a href="https://github.com/thinking-machines-lab/batch_invariant_ops">thinking-machines-lab/batch-invariant-ops</a>, as well as the vLLM example of running in “deterministic” mode.</p>
<h2 id="experiments">Experiments</h2>
<h3 id="how-nondeterministic-are-completions">How nondeterministic are completions?</h3>
<p>We use <code>Qwen/Qwen3-235B-A22B-Instruct-2507</code> and sample 1000 completions at temperature 0 with the prompt “Tell me about Richard Feynman” (non-thinking mode), generating 1000 tokens each. Surprisingly, we generate <em>80</em> unique completions, with the most common of these occuring 78 times.</p>
<p>Looking at where the completions differ, we see that the completions are actually identical for the first 102 tokens! The first instance of diverging completions occurs at the 103rd token. All completions generate the sequence “Feynman was born on May 11, 1918, in” However, 992 of the completions go on to generate “Queens, New York” whereas 8 of the completions generate “New York City”.</p>
<!-- At this point, we can also inspect the logprobs of each generation. # TODO: Fill this out a little more. -->
<p>On the other hand, when we enable our batch-invariant kernels, all of our 1000 completions are identical. This is what we would mathematically expect from our sampler, but we aren’t able to achieve deterministic results without our batch-invariant kernels.</p>
<!-- ### Deterministic evals
One implication of deterministic completions is deterministic evals.
One benefit we’ve found of fully deterministic LLM inference is that we can also get deterministic evals. This can be advantageous for experiment reproducibility, validating small performance improvements, or simply writing reliable unit tests.

Running X eval, we can see that there is a Y variance in eval scores normally. However, when run in deterministic mode, we get exactly the same eval scores every time. -->
<h3 id="performance">Performance</h3>
<p>We have not put a significant effort into optimizing the performance of the batch-invariant kernels here. However, let’s run some experiments to verify that our performance remains usable.</p>
<p>We will set up an API server with one GPU running Qwen-3-8B, and request 1000 sequences with an output length of between 90 and 110.</p>
<table>
  <thead>
      <tr>
          <th>Configuration</th>
          <th>Time (seconds)</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>vLLM default</td>
          <td>26</td>
      </tr>
      <tr>
          <td>Unoptimized Deterministic vLLM</td>
          <td>55</td>
      </tr>
      <tr>
          <td>+ Improved Attention Kernel</td>
          <td>42</td>
      </tr>
  </tbody>
</table>
<p>Much of the slowdown comes from the fact that the FlexAttention integration in vLLM has not been heavily optimized yet. Nevertheless, we see that performance is not <em>disastrous</em>.</p>
<h3 id="true-on-policy-rl">True on-policy RL</h3>
<p>As <a href="https://fengyao.notion.site/off-policy-rl">researchers have noted</a>, the different numerics between training and inference implicitly turns our on-policy RL into off-policy RL.</p>
<p>Of course, it is impossible to get bitwise identical results between training and inference if we can’t even get bitwise identical results from two identical inference requests. Then, deterministic inference enables us to also modify our training stack to obtain bitwise identical results between sampling and training, thus resulting in true on-policy RL.</p>
<p>We run experiments in a RLVR setup on <a href="https://arxiv.org/abs/2502.17387">Bigmath</a> with the RL policy initialized from the Qwen 2.5-VL instruct 8B with a max rollout length of 4096.</p>
<p>If we train without off-policy correction (i.e. importance weighting), our reward collapses partway through training, whereas adding an off-policy correction term  allows training to proceed smoothly. But, if we achieve bitwise identical results between our sampler and trainer, we are fully on policy (i.e. 0 KL divergence) and can also train smoothly.</p>
<p>We can also plot the KL-divergence in logprobs between our sampler and trainer, where all 3 runs have notably different behavior. When running with importance weighting, it stays around 0.001 with occasional spikes. However, running <em>without</em> importance weighting eventually leads to a spike in KL-divergence around the same time that reward crashes. And, of course, when running “True On-Policy RL”, our KL-divergence stays flat at 0, indicating that there is <em>no</em> divergence between the training policy and sampling policy.</p>
<!-- <figure class="chart-line"
        data-src="/data/wandb_export_2025-09-08T11_16_51.917-07_00.csv"
        data-seriesmeta='{"names":["With importance weighting","No importance weighting"],"colors":["#8ac926","#007f86"]}'
        data-show-points="false"
        data-smooth="35"
        data-x='{"label":"Step","ticks":[0,100,200,400,600,800,900,1000,1100]}'
        data-y='{"label":"Mean_reward","ticks":[-0.1,0.0,0.1,0.2,0.3,0.4,0.5]}'
        data-labels='{"With Importance Weighting":{"x":850,"y":0.5,"dx":-8,"dy":-6},"No Importance Weighting":{"x":850,"y":-0.03,"dx":-8,"dy":-6}}'
        data-series='[{"lineWidth":1.6},{"lineWidth":1.6}]'>
  <figcaption>Without off-policy correction like importance weighting, RL is prone to catastrophic failure due to the "off-policyness" induced by numerical mismatches between the trainer and the sampler. However, if we obtain bitwise equivalence between the trainer and the sampler, we don't need any off-policy correction to train smoothly.</figcaption>
  <svg viewBox="0 0 800 520" width="100%" height="auto"></svg>
  <script src="/js/chart-line.js?v=2"></script>
</figure> -->
<!-- <figure class="chart-line"
        data-srcs='["/data/reward.csv","/data/kl.csv"]'
        data-seriesmeta='{"colors":["#1f78b4","#e31a1c","#33a02c"],"names":["True On-Policy","No Importance Weighting","With Importance Weighting"]}'
        data-show-points="false"
        data-smooth="0.1"
        data-x='{"label":"Step","ticks":[0,50,100,150,200,250,300,318],"domain":[0,319]}'
        data-y='{"label":"Mean reward","ticks":[0.0,0.1,0.2,0.3,0.4,0.5,0.6], "domain":[-0.1,0.6]}'
        data-y2='{"label":"KL-Divergence","ticks":[0.0,0.001,0.002,0.003,0.004,0.005,0.0055],"domain":[-0.001,0.0055]}'
        data-labels='{"True On-Policy":{"x":215,"y":0.32,"dx":-16,"dy":-4},"No Importance Weighting":{"x":215,"y":0.27,"dx":-16,"dy":-4},"With Importance Weighting":{"x":215,"y":0.22,"dx":-16,"dy":-4}}'
        data-series='[{"lineWidth":1.5},{"lineWidth":1.4},{"lineWidth":2.4}]'>
  <figcaption>Note that the run without importance weighting has a significant loss spike around Step 318, and this comes with a corresponding spike in KL-divergence of logprobs. Meanwhile, either using an off-policy correction or running with "True On-Policy" allows RL to continue smoothly. The blue line showing "True On-Policy" is not a bug --- it's just a flat line at 0. </figcaption>
  <svg viewBox="0 0 800 520" width="100%" height="auto"></svg>
  <script src="/js/chart-line.js"></script>
</figure> -->
<figure data-srcs="[&quot;/data/reward.csv&quot;,&quot;/data/kl.csv&quot;]" data-seriesmeta="{&quot;colors&quot;:[&quot;#1f78b4&quot;,&quot;#e31a1c&quot;,&quot;#33a02c&quot;],&quot;names&quot;:[&quot;True On-Policy&quot;,&quot;No Importance Weighting&quot;,&quot;With Importance Weighting&quot;]}" data-show-points="false" data-smooth="0.1" data-x="{&quot;label&quot;:&quot;Step&quot;,&quot;ticks&quot;:[0,50,100,150,200,250,300,318],&quot;domain&quot;:[0,319]}" data-top-y="{&quot;label&quot;:&quot;Mean reward&quot;,&quot;ticks&quot;:[0.0,0.1,0.2,0.3,0.4,0.5,0.6], &quot;domain&quot;:[-0.1,0.6]}" data-bottom-y="{&quot;label&quot;:&quot;KL-Divergence&quot;,&quot;ticks&quot;:[0.0,0.001,0.002,0.003,0.004,0.005],&quot;domain&quot;:[-0.001,0.0055]}" data-labels="{&quot;True On-Policy&quot;:{&quot;x&quot;:215,&quot;y&quot;:0.32,&quot;dx&quot;:-16,&quot;dy&quot;:-4},&quot;No Importance Weighting&quot;:{&quot;x&quot;:215,&quot;y&quot;:0.27,&quot;dx&quot;:-16,&quot;dy&quot;:-4},&quot;With Importance Weighting&quot;:{&quot;x&quot;:215,&quot;y&quot;:0.22,&quot;dx&quot;:-16,&quot;dy&quot;:-4}}" data-top-series="[{&quot;lineWidth&quot;:1.5},{&quot;lineWidth&quot;:1.4},{&quot;lineWidth&quot;:2.4}]" data-bottom-series="[{&quot;lineWidth&quot;:1.5},{&quot;lineWidth&quot;:1.4},{&quot;lineWidth&quot;:2.4}]">
  <figcaption>Note that the run without importance weighting has a significant loss spike around Step 318, and this comes with a correspond ing spike in KL-divergence of logprobs. Meanwhile, either using an off-policy correction or running with "True On-Policy" allows RL to continue smoothly. The blue line showing "True On-Policy" is not a bug - it's just a flat line at 0. </figcaption>
  <svg viewBox="0 0 800 520" width="100%" height="auto"></svg>
  
</figure>
<h2 id="conclusion">Conclusion</h2>
<p>Modern software systems contain many layers of abstractions. In machine learning, when we run into nondeterminism and subtle numerical differences it can often be tempting to paper over them. After all, our systems are already “probabilistic”, so what’s wrong with a little more nondeterminism? What’s wrong with bumping up the atol/rtol on the failing unit test? The difference in logprobs between the trainer and the sampler probably isn’t a real bug, right?</p>
<p>We reject this defeatism. With a little bit of work, we <em>can</em> understand the root causes of our nondeterminism and even solve them! We hope that this blog post provides the community with a solid understanding of how to resolve nondeterminism in our inference systems and inspires others to obtain a full understanding of their systems.</p>
<h2 id="citation">Citation</h2>
<p>Please cite this work as:</p>
<pre tabindex="0"><code>He, Horace and Thinking Machines Lab, "Defeating Nondeterminism in LLM Inference", 
Thinking Machines Lab: Connectionism, Sep 2025.
</code></pre><p>Or use the BibTeX citation:</p>
<pre tabindex="0"><code>@article{he2025nondeterminism,
  author = {Horace He and Thinking Machines Lab},
  title = {Defeating Nondeterminism in LLM Inference},
  journal = {Thinking Machines Lab: Connectionism},
  year = {2025},
  note = {https://thinkingmachines.ai/blog/defeating-nondeterminism-in-llm-inference/},
  doi = {10.64434/tml.20250910}
}
</code></pre>
    
  </article></div>]]></description>
        </item>
        <item>
            <title><![CDATA['Block Everything' protests sweep across France, scores arrested (117 pts)]]></title>
            <link>https://www.reuters.com/world/europe/block-everything-protests-sweep-across-france-scores-arrested-2025-09-10/</link>
            <guid>45200357</guid>
            <pubDate>Wed, 10 Sep 2025 16:44:53 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.reuters.com/world/europe/block-everything-protests-sweep-across-france-scores-arrested-2025-09-10/">https://www.reuters.com/world/europe/block-everything-protests-sweep-across-france-scores-arrested-2025-09-10/</a>, See on <a href="https://news.ycombinator.com/item?id=45200357">Hacker News</a></p>
Couldn't get https://www.reuters.com/world/europe/block-everything-protests-sweep-across-france-scores-arrested-2025-09-10/: Error: Request failed with status code 401]]></description>
        </item>
        <item>
            <title><![CDATA[Anthropic Services Down (160 pts)]]></title>
            <link>https://status.anthropic.com/incidents/k6gkm2b8cjk9</link>
            <guid>45200118</guid>
            <pubDate>Wed, 10 Sep 2025 16:31:34 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://status.anthropic.com/incidents/k6gkm2b8cjk9">https://status.anthropic.com/incidents/k6gkm2b8cjk9</a>, See on <a href="https://news.ycombinator.com/item?id=45200118">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
      <!-- postmortem if it's published -->

      <!-- incident updates in reverse order -->
        <div>
          <h2>
            Resolved
          </h2>
          <div>
            <p><span>This incident has been resolved.</span>
            </p>
            <p>
              Posted <span data-datetime-unix="1757525764000"></span>Sep <var data-var="date">10</var>, <var data-var="year">2025</var> - <var data-var="time">17:36</var> UTC
            </p>
          </div>
        </div>
        <div>
          <h2>
            Update
          </h2>
          <div>
            <p><span>We are continuing to monitor services.</span>
            </p>
            <p>
              Posted <span data-datetime-unix="1757525415000"></span>Sep <var data-var="date">10</var>, <var data-var="year">2025</var> - <var data-var="time">17:30</var> UTC
            </p>
          </div>
        </div>
        <div>
          <h2>
            Monitoring
          </h2>
          <div>
            <p><span>A fix has been implemented and we are monitoring the results.</span>
            </p>
            <p>
              Posted <span data-datetime-unix="1757524516000"></span>Sep <var data-var="date">10</var>, <var data-var="year">2025</var> - <var data-var="time">17:15</var> UTC
            </p>
          </div>
        </div>
        <div>
          <h2>
            Update
          </h2>
          <div>
            <p><span>A fix has been implemented and we are monitoring the results.</span>
            </p>
            <p>
              Posted <span data-datetime-unix="1757523323000"></span>Sep <var data-var="date">10</var>, <var data-var="year">2025</var> - <var data-var="time">16:55</var> UTC
            </p>
          </div>
        </div>
        <div>
          <h2>
            Update
          </h2>
          <div>
            <p><span>A fix has been implemented and we are monitoring the results.</span>
            </p>
            <p>
              Posted <span data-datetime-unix="1757522248000"></span>Sep <var data-var="date">10</var>, <var data-var="year">2025</var> - <var data-var="time">16:37</var> UTC
            </p>
          </div>
        </div>
        <div>
          <h2>
            Identified
          </h2>
          <div>
            <p><span>APIs, Console, and Claude.ai are down. Services will be restored as soon as possible.</span>
            </p>
            <p>
              Posted <span data-datetime-unix="1757521717000"></span>Sep <var data-var="date">10</var>, <var data-var="year">2025</var> - <var data-var="time">16:28</var> UTC
            </p>
          </div>
        </div>

      <!-- affected components -->
        <p>
          This incident affected: claude.ai, console.anthropic.com, and api.anthropic.com.
        </p>
    </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[I didn't bring my son to a museum to look at screens (783 pts)]]></title>
            <link>https://sethpurcell.com/writing/screens-in-museums/</link>
            <guid>45199931</guid>
            <pubDate>Wed, 10 Sep 2025 16:20:55 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://sethpurcell.com/writing/screens-in-museums/">https://sethpurcell.com/writing/screens-in-museums/</a>, See on <a href="https://news.ycombinator.com/item?id=45199931">Hacker News</a></p>
<div id="readability-page-1" class="page"><div> <p>When I was a kid in the ’80s, one of my two favorite places on Earth was <a href="https://fi.edu/en">The Franklin Institute</a> (TFI) in downtown Philadelphia. We lived a couple hours away so a visit was a rare and precious thing. I think I only visited two or three times but it left an indelible impression on me. I remember wandering in amazement through its enormous spaces getting to <em>actually play with</em> amazing and interesting things. I remember sweeping off a table and then filling an overhanging funnel pendulum with sand, setting it going, and watching it create unexpected patterns on the table. I remember running through the gigantic model heart with other kids. I remember the overpowering joy of being in an actual monumental marble temple of curiosity and fascination. So I was filled with anticipation a couple weeks ago when, during a family trip to the East Coast, we managed to squeeze in a visit to TFI with our six-year-old son.</p>
<p>We parked and ran in, paid close to <em>ninety bucks</em> (ouch! but I love you, so take my money), and started off on the top floor with the Wondrous Space exhibit.</p>
<p>And were met with screens.</p>
<p>Design your own rocket! it said (or something like that). No, I thought, this isn’t designing a rocket, this is playing a lame video game on a touchscreen. Yes, there were space-related artifacts around the walls, and a spacesuit in its own large case, but you couldn’t <em>touch</em> any of this stuff, you couldn’t <em>play with it</em>, you could just look at it for a few seconds, read the placard, say “huh”, and maybe point out some interesting feature to the kiddo.</p>
<p>But the screens were given pride of place, dead center in the dimly-lit space. And so they beckoned. My wife —&nbsp;a science writer who used to be the only staff writer covering space for New Scientist and before that, worked at NASA — poked at one of these with my son, added too many boosters to their launch vehicle, and were told it failed “for reasons” in a way she found totally unhelpful and pointless. She led our son gently but firmly away to the glorious four-story Foucault pendulum which hangs in a stairwell.</p>
<p>Here are some images from the <a href="https://fi.edu/en/exhibits-and-experiences/wondrous-space">website</a> showing patrons interacting with (or running past) screens so you can see what I’m talking about:</p>
<p><img src="https://sethpurcell.com/images/Pasted%20image%2020250908092440.png" alt="" title="What are they interacting with? Screens, of course."></p>
<p><img src="https://sethpurcell.com/images/Pasted%20image%2020250908092857.png" alt="" title="Another screen. Kids love screens!"></p>
<p><img src="https://sethpurcell.com/images/Pasted%20image%2020250908093454.png" alt="" title="Here are some screens in slick circular frames!"></p>
<p>But the screens were all over the place. There were on the main floor, in another section of Wondrous Space, and in the Body Odyssey exhibit. They were all over the SportsZone exhibit on the top floor. Many of them are connected to body motion sensors a la Xbox Kinect so you don’t need to touch them, but they’re still just video games, where the action-response feedback loop is provided by software, not the <em>universe itself</em>.</p>
<p>And the wonderful hands-on physical stuff that I loved as a kid? Jammed into out-of-the-way spaces in the Sir Isaac’s Loft and Air Show rooms. These rooms are terrific, and I was delighted to see they were absolutely packed with kids playing with stuff. No screens, just objects and forces — you don’t even need to read anything to enjoy many of the exhibits, such as the one where you sit in one of two chairs hanging from different configurations of block-and-tackle and haul yourself up — and then just let yourself drop, cushioned by a damping piston. Tucked far away in a desolate corner by a hallway we discovered an engaging exhibit where you pluck rods with your finger to generate Lissajous curves from the vibrations. My son was fascinated; he had never seen anything behave like that. And in the Air Show room he liked many of the exhibits, like the one where you (apparently) evacuate a cylinder to see the effect that has on objects moving through it (versus a control). And the “shimmer wall”, where kids generate sound waves using a variety of devices and can then see the sound waves <em>impacting</em> on a reflective and reactive surface was wonderful and really conveys the mechanical nature of sound.</p>
<p>But these physical exhibits require maintenance, and I was dismayed to see that several are in bad repair; some of them weren’t even <em>working</em> anymore, some seemed worn out, or didn’t seem well-designed to begin with. For instance, they have the classic “bicycle wheel and rotating stool” gyro effect demonstration, but the wheel was too large a diameter for my son to hold, and the stool seemed to have too much friction to work properly for my wife. There was no one trying to use it before or after us; I’d be curious to see the data on how many visitors attempt it, and how well it usually works for them. And that one should be trivial to design and implement properly: for crying out loud, our local ice cream shop has stools that spin on ball bearings, and I think that would be a big improvement. Every time something didn’t work right I couldn’t help thinking: we paid almost ninety bucks to visit this place. TFI doesn’t seem poor; it seems like its budgetary priorities lie elsewhere.</p>
<p>And where it looks like the budget has been going are the screen rooms. They occupy the huge central spaces on the main floor of the museum, and I’m sure a lot of time, money, and passion went into these things. But it’s misguided.</p>
<p>I believe museums exist to present the <em>real thing</em> for the visitor to experience with their own senses. Here’s the sculpture — the actual piece of stone, two thousand years old, Greek sculptor unknown —&nbsp;now go ahead and form your impressions. Come back to it when you’re an old man or woman, it will still be here, and you will see it with different eyes. This is a tiny but, to me, beautiful part of the human condition. And what made the Franklin Institute so amazingly special to me as a kid was that the exhibits sat at the intersection of things that kids want to play with, things that kids <em>are allowed to play with</em>, and things that demonstrate some “hey, that’s cool!” scientific phenomenon. And it was all <em>real</em>.</p>
<p>But a lame video game? I can do that on my goddamn <em>phone</em>. TFI “was one of the first museums in the nation to offer a hands-on approach to learning about the physical world”, but — and I can’t emphasize this enough, it’s my whole reason for writing this — touchscreens <em>are not actually hands-on</em>. Digital representations aren’t tangible, and touchscreen experiences just don’t activate a kid’s brain (including, I’d say, a sense of delight) the same way a genuinely hands-on experience, like pulling hard on a rope to raise your chair, does.</p>
<p>I don’t know why museums are doing this; my idle speculation is that they see themselves as competing with screens for attention, so in a kind of experiential race to the bottom, they feel compelled to bring screens into their exhibits (see: <em>Amusing Ourselves to Death</em>). But now more than ever in history, <em>kids need a break</em> from the screens that all too many of them are sadly often plugged into by default, and connection to the real world instead. <strong>Now is the time for TFI — and all museums — to take a stand against the tidal wave of digital garbage that is consuming humanity, especially kids, by eliminating all of their touchscreen “exhibits”.</strong></p>
<p>To be fair, TFI is still pretty damn great if you just ignore all the screens. The Franklin Memorial rotunda (free to visit!) is gorgeous. The hands-on stuff, tucked away and apparently suffering from neglect though it is, should be replicated in every city in the world. But it would be so much better if they removed all the screens and put that budget and real estate toward the real, tangible, interactive science exhibits that were the reason the museum was created in the first place, and what made me love it as a child.</p> </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[TikTok has turned culture into a feedback loop of impulse and machine learning (255 pts)]]></title>
            <link>https://www.thenexus.media/tiktok-won-now-everything-is-60-seconds/</link>
            <guid>45199760</guid>
            <pubDate>Wed, 10 Sep 2025 16:08:39 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.thenexus.media/tiktok-won-now-everything-is-60-seconds/">https://www.thenexus.media/tiktok-won-now-everything-is-60-seconds/</a>, See on <a href="https://news.ycombinator.com/item?id=45199760">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
        <figure><img src="https://images.unsplash.com/flagged/photo-1594319622311-0b930abb17cf?crop=entropy&amp;cs=tinysrgb&amp;fit=max&amp;fm=jpg&amp;ixid=M3wzMDAzMzh8MHwxfHNlYXJjaHw4fHx0aWt0b2t8ZW58MHx8fHwxNzU3NDQ3Njc5fDA&amp;ixlib=rb-4.1.0&amp;q=80&amp;w=1080" alt="black iphone 4 on black textile" loading="lazy" title="black iphone 4 on black textile" width="3240" height="2160" srcset="https://images.unsplash.com/flagged/photo-1594319622311-0b930abb17cf?crop=entropy&amp;cs=tinysrgb&amp;fit=max&amp;fm=jpg&amp;ixid=M3wzMDAzMzh8MHwxfHNlYXJjaHw4fHx0aWt0b2t8ZW58MHx8fHwxNzU3NDQ3Njc5fDA&amp;ixlib=rb-4.1.0&amp;q=80&amp;w=600 600w, https://images.unsplash.com/flagged/photo-1594319622311-0b930abb17cf?crop=entropy&amp;cs=tinysrgb&amp;fit=max&amp;fm=jpg&amp;ixid=M3wzMDAzMzh8MHwxfHNlYXJjaHw4fHx0aWt0b2t8ZW58MHx8fHwxNzU3NDQ3Njc5fDA&amp;ixlib=rb-4.1.0&amp;q=80&amp;w=1000 1000w, https://images.unsplash.com/flagged/photo-1594319622311-0b930abb17cf?crop=entropy&amp;cs=tinysrgb&amp;fit=max&amp;fm=jpg&amp;ixid=M3wzMDAzMzh8MHwxfHNlYXJjaHw4fHx0aWt0b2t8ZW58MHx8fHwxNzU3NDQ3Njc5fDA&amp;ixlib=rb-4.1.0&amp;q=80&amp;w=1600 1600w, https://images.unsplash.com/flagged/photo-1594319622311-0b930abb17cf?crop=entropy&amp;cs=tinysrgb&amp;fit=max&amp;fm=jpg&amp;ixid=M3wzMDAzMzh8MHwxfHNlYXJjaHw4fHx0aWt0b2t8ZW58MHx8fHwxNzU3NDQ3Njc5fDA&amp;ixlib=rb-4.1.0&amp;q=80&amp;w=2400 2400w" sizes="(min-width: 720px) 720px"><figcaption><span>Photo by </span><a href="https://unsplash.com/@solenfeyissa?ref=thenexus.media" target="_blank" rel="noopener noreferrer nofollow"><span>Solen Feyissa</span></a><span> on </span><a href="https://unsplash.com/?ref=thenexus.media" target="_blank" rel="noopener noreferrer nofollow"><span>Unsplash</span></a></figcaption></figure><p>As of September 2025, approximately 170 million Americans spend, on average, one hour every day in an app that is designed to maximize psychological grip. While Congress fixates on TikTok’s data collection usages, what hasn’t received enough attention is how the platform has successfully industrialized human attention itself. Where earlier media relied on polished narratives (films with arcs, shows with seasons), TikTok turned culture into a never-ending feedback loop of impulse and machine learning.</p><p>TikTok didn’t invent short videos or algorithmic feeds, though. Vine created looping six-second clips in 2013, YouTube has used recommendations for over a decade, Instagram rolled out Stories in 2016, and MTV conditioned audiences to rapid cuts long before any of them. What TikTok did was fuse these scattered experiments into a full-scale system for harvesting attention.&nbsp;</p><p>Most platforms’ “For You” pages are far less finely tuned. They adjust slowly, learning from signs like likes, follows, or finished videos. TikTok's algorithm learns instantly from micro-behaviors. You can nuke your feed in minutes just by deliberately watching only one type of video—say, pottery clips or capybara memes. That’s because the algorithm heavily weights engagement signs per video rather than long-term user profiles. Public documentation and leaked papers suggest TikTok may also track micro-behaviors such as how long users hover before swiping away. This results in a recommender system that feels uncannily perceptive.</p><p>However, before today, each medium we’ve invented reshaped how we think and consume information. The printing press trained readers in linear, sequential thought, encouraging sustained focus and complex argumentation. Television created visual storytelling and shared cultural moments, with families watching the same shows at the same time and building collective references. The internet introduced hyperlinked thinking, enabling rapid information switching, comparison of perspectives, and knowledge-building through exploration.</p><p>Now, the world is picking up on the TikTok model.</p><p>News organizations like The Washington Post have invested in and expanded a dedicated TikTok team since 2019, producing short and snappy newsroom videos that regularly go viral. In education, students are struggling with assignments longer than a few minutes and expect information delivered in rapid, visually engaging bursts. In entertainment, traditional stand-up comedy builds tension over minutes before a punchline, but TikTok comedians deliver the absurd immediately — a person discovering their roommate has been using their toothbrush as a cleaning brush — and increasingly structure shows around "clippable moments" designed to go viral. Song introductions have shortened dramatically, with <a href="https://www.washingtontimes.com/news/2025/apr/14/songs-getting-shorter-thanks-part-spotify-tiktok-algorithms/?ref=thenexus.media#"><u>one study</u></a> finding average intros fell from more than 20 seconds in the 1980s to just five, while movie trailers increasingly resemble TikTok compilations: rapid-fire montages of action sequences and emotional beats rather than traditional narrative setups.</p><p>Cultural consumption itself has also become a form of algorithmic training. Instead of browsing Netflix and choosing what to watch, users scroll TikTok to see what the algorithm predicts. This means that you're not consuming culture; you're teaching a machine how to feed you culture more efficiently.</p><p>TikTok also rewards hyper-specialization. Entire followings are built on carpet-cleaning videos, paint-mixing shots, or the same dance repeated in new locations. Success comes less from broad talent or universal appeal than from perfecting a narrow niche optimized for the algorithm. In other words, creators who identify and double down on the smallest engagement signals are algorithmically incentivized to specialize, turning micro-content into a precise science of attention capture. This hyper-optimization emerged in markets where dozens of apps competed brutally for user attention. Platforms that kept people engaged survived; the rest died. That evolutionary pressure produced increasingly sophisticated ways to capture attention, and the most successful apps learned to treat human psychology like an engineering problem to be solved through data and iteration.</p><p>As American platforms adopt TikTok-style optimization, the format sets expectations for all digital content. Micro-optimization techniques are spreading worldwide, establishing a new standard for how human attention is structured algorithmically. TikTok delivers exactly what we want: immediate satisfaction, personalized content, and endless novelty. But efficiency always involves trade-offs. We gain instant access to exactly the content that triggers our reward systems, but we lose the ability to be bored, to sit with incomplete thoughts, to wrestle with ideas that don't immediately pay off. We lose the serendipity of discovering things we didn't know we wanted.</p><p>Are we making this trade consciously? Most users have never considered that their scrolling patterns are training an algorithm, or that their entertainment has been optimized for maximum psychological grip rather than maximum meaning.</p><p>The irony, of course, is that if you've read this far, it may mean you’ve already mastered a rare skill: sustained attention in a world of distraction.</p><p><em>Subscribe to get weekly insights on China's tech culture that Western media misses.</em></p>
      </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[ChatGPT Developer Mode (371 pts)]]></title>
            <link>https://platform.openai.com/docs/guides/developer-mode</link>
            <guid>45199713</guid>
            <pubDate>Wed, 10 Sep 2025 16:04:49 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://platform.openai.com/docs/guides/developer-mode">https://platform.openai.com/docs/guides/developer-mode</a>, See on <a href="https://news.ycombinator.com/item?id=45199713">Hacker News</a></p>
Couldn't get https://platform.openai.com/docs/guides/developer-mode: Error: Request failed with status code 403]]></description>
        </item>
        <item>
            <title><![CDATA[Microsoft PowerToys (105 pts)]]></title>
            <link>https://learn.microsoft.com/en-us/windows/powertoys/</link>
            <guid>45199191</guid>
            <pubDate>Wed, 10 Sep 2025 15:31:27 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://learn.microsoft.com/en-us/windows/powertoys/">https://learn.microsoft.com/en-us/windows/powertoys/</a>, See on <a href="https://news.ycombinator.com/item?id=45199191">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><p>Microsoft PowerToys is a set of free Microsoft Windows utilities for power users to tune and streamline their Windows experience for greater productivity. These utilities and shell enhancement tools are designed to help you customize Windows 10 and Windows 11 to suit your needs.</p>

<h2 id="system-requirements">System requirements</h2>
<p>PowerToys requires Windows 10 version 2004 (build 19041) or later, or any version of Windows 11. It isn't supported on earlier versions of Windows. For a complete list of system requirements, see <a href="https://learn.microsoft.com/en-us/windows/powertoys/install#requirements" data-linktype="absolute-path">Installing PowerToys | Requirements</a>.</p>
<h3 id="processor-architecture-support">Processor architecture support</h3>
<ul>
<li><strong>x64</strong>: Supported</li>
<li><strong>ARM64</strong>: Supported</li>
</ul>
<h2 id="powertoys-utilities-for-windows-10-and-11">PowerToys Utilities for Windows 10 and 11</h2>
<p>The currently available utilities include:</p>
<h3 id="advanced-paste">Advanced Paste</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/advanced-paste" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/pt-advanced-paste.png" alt="A screenshot of the Advanced Paste PowerToys utility for Windows." data-linktype="relative-path"></a></p>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/advanced-paste" data-linktype="relative-path">Advanced Paste</a> is a tool that enables you to paste the text from your clipboard into any format needed. It can be enhanced with an AI-powered option that is 100% opt-in and requires an OpenAI key.</p>
</section>
<h3 id="always-on-top">Always On Top</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/always-on-top" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/pt-always-on-top-menu.png" alt="A screenshot of the Always On Top PowerToys utility for Windows." data-linktype="relative-path"></a></p>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/always-on-top" data-linktype="relative-path">Always On Top</a> enables you to pin windows above other windows with a quick key shortcut (<kbd>⊞ Win</kbd>+<kbd>Ctrl</kbd>+<kbd>T</kbd>).</p>
</section>
<h3 id="powertoys-awake">PowerToys Awake</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/awake" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/powertoys-awake/pt-awake-menu.png" alt="A screenshot of the PowerToys Awake utility for Windows." data-linktype="relative-path"></a></p>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/awake" data-linktype="relative-path">PowerToys Awake</a> is designed to keep a computer awake without having to manage its power &amp; sleep settings. This behavior can be helpful when running time-consuming tasks, ensuring that the computer doesn't go to sleep or turn off its displays.</p>
</section>
<h3 id="color-picker">Color Picker</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/color-picker" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/pt-color-picker.png" alt="A screenshot of the Color Picker PowerToys utility for Windows." data-linktype="relative-path"></a></p>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/color-picker" data-linktype="relative-path">Color Picker</a> is a system-wide color picking utility activated with <kbd>⊞ Win</kbd>+<kbd>Shift</kbd>+<kbd>C</kbd>. It allows you to pick colors from anywhere on the screen, and the picker automatically copies the color to your clipboard in a specified format.
Color Picker contains an editor that shows a history of previously picked colors and allows you to fine-tune the selected color and to copy different string representations. The code for this utility is based on <a href="https://github.com/martinchrzan/ColorPicker" data-linktype="external">Martin Chrzan's Color Picker</a>.</p>
</section>
<h3 id="command-not-found">Command Not Found</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/cmd-not-found" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/pt-cmd-not-found.png" alt="A screenshot of the Command Not Found PowerToys utility for Windows." data-linktype="relative-path"></a></p>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/cmd-not-found" data-linktype="relative-path">Command Not Found</a> is a PowerShell 7 module that detects an error thrown by a command and suggests a relevant WinGet package to install, if one is available.</p>
</section>
<h3 id="command-palette">Command Palette</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/command-palette/overview" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/pt-cmdpal.png" alt="A screenshot of the Command Palette PowerToys utility for Windows." data-linktype="relative-path"></a></p>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/command-palette/overview" data-linktype="relative-path">Command Palette</a> allows you to easily access all of your most frequently used commands, apps, and development tools - all from a single solution that is fast, customizable to your unique preferences, and extensible to include your favorite apps. The Command Palette is intended to be the successor of <a href="https://learn.microsoft.com/en-us/windows/powertoys/run" data-linktype="relative-path">PowerToys Run</a>.</p>
</section>
<h3 id="crop-and-lock">Crop And Lock</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/crop-and-lock" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/powertoys-crop-and-lock.png" alt="A screenshot of the Crop And Lock PowerToys utility for Windows." data-linktype="relative-path"></a></p>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/crop-and-lock" data-linktype="relative-path">Crop And Lock</a> is a utility that creates a new, fully-interactive window that's a crop or a thumbnail of another window.</p>
</section>
<h3 id="environment-variables">Environment Variables</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/environment-variables" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/powertoys-environment-variables.png" alt="A screenshot of the Environment Variables PowerToys utility for Windows." data-linktype="relative-path"></a></p>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/environment-variables" data-linktype="relative-path">Environment Variables</a> offers an easy and convenient way to manage environment variables. You can create profiles to manage a set of variables together.</p>
</section>
<h3 id="fancyzones">FancyZones</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/fancyzones" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/pt-fancy-zones.png" alt="A screenshot of the FancyZones PowerToys utility for Windows." data-linktype="relative-path"></a></p>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/fancyzones" data-linktype="relative-path">FancyZones</a> is a window manager that makes it easy to create complex window layouts and quickly position windows into those layouts.</p>
</section>
<h3 id="file-explorer-add-ons">File Explorer add-ons</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/file-explorer" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/pt-file-explorer.png" alt="A screenshot of the PowerToys File Explorer add-ons for Windows." data-linktype="relative-path"></a></p>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/file-explorer" data-linktype="relative-path">File Explorer add-ons</a> enable Preview pane and thumbnail rendering in File Explorer to display a variety of file types. To open the Preview pane, go to <strong>View</strong> in File Explorer and select <strong>Preview Pane</strong>.</p>
</section>
<h3 id="file-locksmith">File Locksmith</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/file-locksmith" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/powertoys-file-locksmith.png" alt="A screenshot of the File Locksmith PowerToys shell extension for Windows." data-linktype="relative-path"></a></p>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/file-locksmith" data-linktype="relative-path">File Locksmith</a> is a Windows shell extension to check which files are in use and by which processes. Right-click on one or more selected files in File Explorer and select <strong>Unlock with File Locksmith</strong>.</p>
</section>
<h3 id="hosts-file-editor">Hosts File Editor</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/hosts-file-editor" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/pt-hosts-file-editor-facade.png" alt="A screenshot of the Hosts File Editor PowerToys utility for Windows." data-linktype="relative-path"></a></p>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/hosts-file-editor" data-linktype="relative-path">Hosts File Editor</a> is a utility that provides a convenient way to edit the 'Hosts' file in Windows that contains domain names and matching IP addresses, acting as a map to identify and locate hosts on IP networks.</p>
</section>
<h3 id="image-resizer">Image Resizer</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/image-resizer" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/pt-image-resizer.png" alt="A screenshot of the PowerToys Image Resizer shell extension for Windows." data-linktype="relative-path"></a></p>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/image-resizer" data-linktype="relative-path">Image Resizer</a> is a Windows Shell extension for quickly resizing images. With a right-click in File Explorer, instantly resize one or many images. The code in this extension is based on <a href="https://github.com/bricelam/ImageResizer" data-linktype="external">Brice Lambson's Image Resizer</a>.</p>
</section>
<h3 id="keyboard-manager">Keyboard Manager</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/keyboard-manager" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/pt-keyboard-manager.png" alt="A screenshot of the Keyboard Manager PowerToys utility for Windows." data-linktype="relative-path"></a></p>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/keyboard-manager" data-linktype="relative-path">Keyboard Manager</a> allows you to customize the keyboard to be more productive by remapping keys and creating your own keyboard shortcuts.</p>
</section>
<h3 id="mouse-utilities">Mouse utilities</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/mouse-utilities" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/pt-mouse-utils.png" alt="A screenshot of the PowerToys Mouse utilities for Windows." data-linktype="relative-path"></a></p>
<div>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/mouse-utilities" data-linktype="relative-path">Mouse utilities</a> add functionality to enhance your mouse and cursor.</p>
<ul>
<li><strong>Find My Mouse</strong>: Quickly locate your mouse pointer with a spotlight that focuses on its current position. This feature is based on source code developed by <a href="https://github.com/oldnewthing" data-linktype="external">Raymond Chen</a>.</li>
<li><strong>Mouse Highlighter</strong>: Displays visual indicators when basic mouse buttons are clicked.</li>
<li><strong>Mouse Jump</strong>: Allows a quick jump on large displays.</li>
<li><strong>Mouse Pointer Crosshairs</strong>: Draws crosshairs centered on the mouse pointer.</li>
</ul>
</div>
</section>
<h3 id="mouse-without-borders">Mouse Without Borders</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/mouse-without-borders" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/pt-mouse-without-borders.png" alt="A screenshot of the Mouse without Borders PowerToys utility for Windows." data-linktype="relative-path"></a></p>
<p>Use <a href="https://learn.microsoft.com/en-us/windows/powertoys/mouse-without-borders" data-linktype="relative-path">Mouse Without Borders</a> to interact with multiple computers from the same keyboard and mouse, while seamlessly sharing clipboard contents and files between the machines.</p>
</section>
<h3 id="new">New+</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/newplus" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/pt-newplus.png" alt="A screenshot of the New+ PowerToys utility for Windows." data-linktype="relative-path"></a></p>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/newplus" data-linktype="relative-path">New+</a> enables you to create files and folders from a personalized set of templates in File Explorer.</p>
</section>
<h3 id="peek">Peek</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/peek" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/powertoys-peek.png" alt="A screenshot of the Peek PowerToys utility for Windows." data-linktype="relative-path"></a></p>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/peek" data-linktype="relative-path">Peek</a> allows you to preview file content without the need to open multiple applications or interrupt your workflow. You can simply select a file and use the shortcut (<kbd>Ctrl</kbd>+<kbd>Space</kbd>).</p>
</section>
<h3 id="powerrename">PowerRename</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/powerrename" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/pt-rename.png" alt="A screenshot of the PowerRename PowerToys utility for Windows." data-linktype="relative-path"></a></p>
<p>Use <a href="https://learn.microsoft.com/en-us/windows/powertoys/powerrename" data-linktype="relative-path">PowerRename</a> to perform bulk renaming; searching and replacing file names. It includes advanced features, such as using regular expressions, targeting specific file types, previewing expected results, and the ability to undo changes. The code in this utility is based on <a href="https://github.com/chrdavis/SmartRename" data-linktype="external">Chris Davis's SmartRename</a>.</p>
</section>
<h3 id="powertoys-run">PowerToys Run</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/run" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/pt-run.png" alt="A screenshot of the PowerToys Run utility for Windows." data-linktype="relative-path"></a></p>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/run" data-linktype="relative-path">PowerToys Run</a> can help you search and open your apps instantly. To open Run, use the shortcut <kbd>Alt</kbd>+<kbd>Space</kbd> and start typing. It's open source and modular, and it supports additional plugins.</p>
</section>
<h3 id="quick-accent">Quick Accent</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/quick-accent" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/pt-keyboard-accent.png" alt="A screenshot of the Quick Accent PowerToys utility for Windows." data-linktype="relative-path"></a></p>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/quick-accent" data-linktype="relative-path">Quick Accent</a> provides an alternative way to type accented characters. It's useful when a keyboard doesn't support a specific character with a quick key combo.</p>
</section>
<h3 id="registry-preview">Registry Preview</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/registry-preview" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/pt-registrypreview.png" alt="A screenshot of the Registry Preview PowerToys utility for Windows." data-linktype="relative-path"></a></p>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/registry-preview" data-linktype="relative-path">Registry Preview</a> is a utility to visualize and edit Windows Registry files.</p>
</section>
<h3 id="screen-ruler">Screen Ruler</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/screen-ruler" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/pt-screen-ruler.png" alt="A screenshot of the Screen Ruler PowerToys utility for Windows." data-linktype="relative-path"></a></p>
<p>Use <a href="https://learn.microsoft.com/en-us/windows/powertoys/screen-ruler" data-linktype="relative-path">Screen Ruler</a> to quickly measure pixels on your screen based on image edge detection. To activate, use the shortcut <kbd>⊞ Win</kbd>+<kbd>Shift</kbd>+<kbd>M</kbd>. This tool was inspired by <a href="https://github.com/peteblois/rooler" data-linktype="external">Pete Blois's Rooler</a>.</p>
</section>
<h3 id="shortcut-guide">Shortcut Guide</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/shortcut-guide" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/pt-shortcut-guide.png" alt="A screenshot of the Shortcut Guide PowerToys utility for Windows." data-linktype="relative-path"></a></p>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/shortcut-guide" data-linktype="relative-path">Windows key shortcut guide</a> appears when you press <kbd>⊞ Win</kbd>+<kbd>Shift</kbd>+<kbd>/</kbd> (or as we like to think, <kbd>⊞ Win</kbd>+<kbd>?</kbd>) and shows the available shortcuts for the current state of the desktop. You can also use it by pressing and holding <kbd>⊞ Win</kbd>.</p>
</section>

<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/text-extractor" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/pt-image-to-text.png" alt="A screenshot of the Text Extractor PowerToys utility for Windows." data-linktype="relative-path"></a></p>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/text-extractor" data-linktype="relative-path">Text Extractor</a> is a convenient way to copy text from anywhere on your screen. To activate, use the shortcut <kbd>⊞ Win</kbd>+<kbd>Shift</kbd>+<kbd>T</kbd>. This code is based on <a href="https://github.com/TheJoeFin/Text-Grab" data-linktype="external">Joe Finney's Text Grab</a>.</p>
</section>
<h3 id="workspaces">Workspaces</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/workspaces" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/powertoys-workspaces/workspaces_editor.png" alt="A screenshot of the Workspaces PowerToys utility for Windows." data-linktype="relative-path"></a></p>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/workspaces" data-linktype="relative-path">Workspaces</a> is a desktop manager utility for launching a set of applications to custom positions and configurations with a single click. Open the editor by selecting "Launch editor" from settings or by using the shortcut <kbd>⊞ Win</kbd>+<kbd>Ctrl</kbd>+<kbd>`</kbd>.</p>
</section>
<h3 id="zoomit">ZoomIt</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/zoomit" data-linktype="relative-path"><img src="https://learn.microsoft.com/en-us/windows/images/powertoys-zoomit.png" alt="A screenshot of the ZoomIt by Sysinternals utility for Windows, now available with PowerToys." data-linktype="relative-path"></a></p>
<p><a href="https://learn.microsoft.com/en-us/windows/powertoys/zoomit" data-linktype="relative-path">ZoomIt</a> is a screen zoom, annotation, and recording tool for technical presentations and demos. It's one of the most popular <a href="https://learn.microsoft.com/en-us/sysinternals/" data-linktype="absolute-path">Sysinternals</a> utilities, and it's now available in PowerToys.</p>
</section>
<h2 id="languages">Languages</h2>
<p>PowerToys is available in the following languages: Arabic (Saudi Arabia), Chinese (simplified), Chinese (traditional), Czech, Dutch, English, French, German, Hebrew, Hungarian, Italian, Japanese, Korean, Persian, Polish, Portuguese, Portuguese (Brazil), Russian, Spanish, Turkish, Ukrainian.</p>
<h2 id="powertoys-video-walk-through">PowerToys video walk-through</h2>
<p>In this video, Clint Rutkas (PM for PowerToys) walks through how to install and use the various power user productivity tools available. He also shares some tips, information about how to contribute, and more.</p>

<h2 id="powertoys-known-issues-and-troubleshooting">PowerToys known issues and troubleshooting</h2>
<p>You can search known issues or file a new issue in the <a href="https://github.com/microsoft/PowerToys/issues" data-linktype="external">Issues</a> tab of the PowerToys repository on GitHub. If you don't find the issue you are experiencing, you can <a href="https://github.com/microsoft/PowerToys/issues/new/choose" data-linktype="external">Report a Bug</a> on the PowerToys product repo.</p>
<h2 id="how-to-contribute-to-powertoys-open-source-project">How to contribute to PowerToys open source project</h2>
<p>PowerToys welcomes your contributions! The PowerToys development team is excited to partner with the power user community to build the best Windows utilities that help users get the most out of their workflows. There are a variety of ways to contribute:</p>
<ul>
<li>Write a <a href="https://codeburst.io/on-writing-tech-specs-6404c9791159" data-linktype="external">tech spec</a></li>
<li>Submit a <a href="https://www.microsoft.com/design/inclusive/" data-linktype="external">design concept or recommendation</a></li>
<li><a href="https://learn.microsoft.com/en-us/contribute/" data-linktype="absolute-path">Contribute to documentation</a></li>
<li>Identify and fix bugs in the <a href="https://github.com/microsoft/PowerToys/tree/main/src" data-linktype="external">source code</a></li>
<li><a href="https://github.com/microsoft/PowerToys/tree/main/doc/devdocs" data-linktype="external">Code new features and PowerToy utilities</a></li>
</ul>
<p>Before starting work on a feature that you would like to contribute, <strong>read the <a href="https://github.com/microsoft/PowerToys/blob/main/CONTRIBUTING.md" data-linktype="external">Contributor's Guide</a></strong>. The PowerToys team will be happy to work with you to figure out the best approach, provide guidance and mentorship throughout feature development, and help avoid any wasted or duplicate effort.</p>
<p>You can consult the <a href="https://github.com/microsoft/PowerToys/tree/main/doc/devdocs" data-linktype="external">PowerToys Developer Documentation</a> for more information on how to get started with PowerToys development and work through any issues you may encounter. These docs have recently been updated to provide development and debugging guidance for the various PowerToys utilities, including how to set up your development environment, build the code, and run the utilities.</p>
<h2 id="powertoys-release-notes">PowerToys release notes</h2>
<p>PowerToys <a href="https://github.com/microsoft/PowerToys/releases/" data-linktype="external">release notes</a> are listed on the install page of the GitHub repo. For reference, you can also find the <a href="https://github.com/microsoft/PowerToys/wiki/Release-check-list" data-linktype="external">Release checklist</a> on the PowerToys wiki.</p>
<h2 id="powertoys-history">PowerToys history</h2>
<p>Inspired by the <a href="https://wikipedia.org/wiki/Microsoft_PowerToys" data-linktype="external">Windows 95 era PowerToys project</a>, this reboot provides power users with ways to squeeze more efficiency out of the Windows shell and customize it for individual workflows. An overview of the original PowerToys can be found here: <a href="https://socket3.wordpress.com/2016/10/22/using-windows-95-powertoys/" data-linktype="external">Using Windows 95 PowerToys</a>.</p>
<h2 id="powertoys-roadmap">PowerToys roadmap</h2>
<p>PowerToys is a rapid-incubation, open source team aimed at providing power users ways to squeeze more efficiency out of the Windows shell and customize it for individual workflows. Work priorities will consistently be examined, reassessed, and adjusted with the aim of improving our users productivity.</p>
<ul>
<li><a href="https://github.com/microsoft/PowerToys/wiki/Specs" data-linktype="external">New specs for possible PowerToys</a></li>
<li><a href="https://github.com/microsoft/PowerToys/wiki/Roadmap#backlog-priority-list-in-order" data-linktype="external">Backlog priority list</a></li>
</ul>
<h2 id="deprecated-powertoy-utilities">Deprecated PowerToy utilities</h2>
<p>These utilities have been deprecated and removed from PowerToys:</p>
<h3 id="video-conference-mute-deprecated-and-removed-starting-in-powertoys-088">Video Conference Mute (Deprecated and removed starting in PowerToys 0.88)</h3>
<section>
<p><a href="https://learn.microsoft.com/en-us/previous-versions/windows/powertoys/video-conference-mute" data-linktype="absolute-path"><img src="https://learn.microsoft.com/en-us/windows/images/pt-video-conference-mute.png" alt="Video Conference Mute screenshot" data-linktype="relative-path"></a></p>
<p><a href="https://learn.microsoft.com/en-us/previous-versions/windows/powertoys/video-conference-mute" data-linktype="absolute-path">Video Conference Mute</a> is a quick way to globally "mute" both your microphone and camera using <kbd>⊞ Win</kbd>+<kbd>Shift</kbd>+<kbd>Q</kbd> while on a conference call, regardless of the application that currently has focus.</p>
</section>
</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Zoox launches its robotaxi service to the public in Las Vegas (165 pts)]]></title>
            <link>https://zoox.com/journal/las-vegas</link>
            <guid>45199031</guid>
            <pubDate>Wed, 10 Sep 2025 15:18:12 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://zoox.com/journal/las-vegas">https://zoox.com/journal/las-vegas</a>, See on <a href="https://news.ycombinator.com/item?id=45199031">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 80 20" role="img" aria-label="Zoox Logo"><path fill="currentColor" d="M56.75 8.019c0-1.184-.178-2.521-1.351-3.675s-2.54-1.326-3.746-1.326H48.46c-1.207 0-2.57.175-3.746 1.326s-1.344 2.491-1.355 3.675v3.131c0 1.184.181 2.521 1.355 3.675s2.54 1.318 3.749 1.318h3.192c1.206 0 2.57-.175 3.746-1.326s1.343-2.491 1.352-3.675c.008-1.015.008-2.09-.003-3.123m-1.672 3.303c0 .758-.114 1.608-.864 2.344s-1.616.84-2.389.848h-3.542c-.772 0-1.64-.113-2.389-.848-.75-.736-.856-1.586-.864-2.344V7.847c0-.758.114-1.608.864-2.344s1.617-.84 2.389-.847h3.542c.773 0 1.64.112 2.39.847.749.736.855 1.586.863 2.344.014 1.143.014 2.332.003 3.475zM36.637 8.018c0-1.184-.178-2.521-1.355-3.675-1.176-1.154-2.536-1.326-3.743-1.326h-3.192c-1.21 0-2.57.175-3.746 1.326s-1.343 2.491-1.354 3.675v3.131c0 1.184.178 2.521 1.354 3.675s2.537 1.318 3.746 1.318h3.192c1.207 0 2.57-.175 3.743-1.326s1.344-2.491 1.355-3.675c.008-1.015.008-2.09 0-3.123m-1.672 3.303c0 .758-.112 1.608-.862 2.344s-1.62.837-2.391.837h-3.54c-.772 0-1.642-.113-2.392-.848-.75-.736-.853-1.586-.861-2.344V7.835c0-.758.114-1.608.861-2.344s1.62-.834 2.392-.834h3.54c.772 0 1.641.112 2.391.848s.856 1.586.861 2.343c.014 1.14.014 2.33 0 3.473M4.803 14.46a.08.08 0 0 1 .03-.062L16.187 5.75a.93.93 0 0 0 .338-.678V3.935a.8.8 0 0 0-.242-.691.84.84 0 0 0-.709-.227H3.367a.24.24 0 0 0-.163.067.23.23 0 0 0-.07.16v1.18c0 .061.026.119.07.162a.24.24 0 0 0 .163.068h11.448q.015 0 .028.012a.04.04 0 0 1 .011.027v.027a.076.076 0 0 1-.03.06L3.47 13.438a.93.93 0 0 0-.338.678v1.113a.82.82 0 0 0 .248.677.85.85 0 0 0 .692.236H16.29a.24.24 0 0 0 .163-.068.23.23 0 0 0 .07-.159v-1.173a.23.23 0 0 0-.07-.16.24.24 0 0 0-.163-.07H4.842a.04.04 0 0 1-.028-.01.04.04 0 0 1-.011-.028M63.426 15.826l5.636-6.208a.054.054 0 0 0 0-.068 5961 5961 0 0 0-5.664-6.238.18.18 0 0 1-.043-.205A.187.187 0 0 1 63.54 3h1.527a.5.5 0 0 1 .34.15q2.362 2.601 4.722 5.196a.06.06 0 0 0 .081 0l4.722-5.196a.5.5 0 0 1 .34-.15h1.527a.19.19 0 0 1 .185.106.18.18 0 0 1-.042.205L71.278 9.55a.054.054 0 0 0 0 .068l5.636 6.208a.18.18 0 0 1-.031.286.2.2 0 0 1-.109.025h-1.527a.5.5 0 0 1-.34-.15 2750 2750 0 0 1-4.703-5.174.06.06 0 0 0-.08 0 1144 1144 0 0 1-4.691 5.174.5.5 0 0 1-.34.15h-1.525a.19.19 0 0 1-.185-.106.18.18 0 0 1 .043-.205"></path></svg><p>Copyright Zoox, Inc. 2025All Rights Reserved.</p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Jiratui – A Textual UI for interacting with Atlassian Jira from your shell (136 pts)]]></title>
            <link>https://jiratui.sh/</link>
            <guid>45198481</guid>
            <pubDate>Wed, 10 Sep 2025 14:42:15 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://jiratui.sh/">https://jiratui.sh/</a>, See on <a href="https://news.ycombinator.com/item?id=45198481">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="top"><!--    Main Content-->
      <nav data-navbar-darken-on-scroll="900">
        
      </nav>

      <div>
            
            <p>JiraTUI revolutionizes task management for developers by enabling seamless interaction with Jira from the terminal. Create, update, and track tasks efficiently, all while maintaining focus on your code and workflow.</p>
          </div><!-- <section> close ============================-->


      <section><!-- <section> begin ============================-->
        <p><img src="https://jiratui.sh/assets/img/gallery/app-homepage.png" alt="The initial screen of the JiraTUI application">
        </p><!-- end of .container-->
      </section><!-- <section> close ============================-->

      <div>
          <p>
            <h2>Features</h2>
          </p>
          <div>
            <div id="carouselSearchTasks" data-bs-ride="carousel">
                  <p><img src="https://jiratui.sh/assets/img/gallery/jiratui-search-issues.png" alt="The screen of the JiraTUI after the user clicks the button to search work items">
                  </p>
                  <p><img src="https://jiratui.sh/assets/img/gallery/jiratui-search-issue.png" alt="The screen of the JiraTUI after the user clicks the button to search a single work item">
                  </p>
                </div>
            <div>
              <h3>Search Tasks</h3>
              <p>Quickly locate your Jira tasks using the powerful search functionality in JiraTUI. With just a few commands, you can filter tasks by status, assignee, or priority. This feature saves time and enhances productivity, allowing you to focus on what matters most in your projects.</p>
            </div>
          </div>
          <div>
            <p><img src="https://jiratui.sh/assets/img/gallery/jiratui-add-new-issue.png" alt="The screen of the JiraTUI that allow users to create work items">
            </p>
            <div>
              <h3>Create Tasks</h3>
              <p> Easily create new Jira tasks directly from the terminal with JiraTUI. This feature simplifies the task creation process, enabling you to specify details like title, description, and priority in a streamlined manner. Spend less time navigating interfaces and more time getting things done.</p>
            </div>
          </div>
          <div>
            <div id="carouselUpdateTasks" data-bs-ride="carousel">
                  <p><img src="https://jiratui.sh/assets/img/gallery/jiratui-issue-details.png" alt="The screen of the JiraTUI that shows the details of a work item">
                  </p>
                  <p><img src="https://jiratui.sh/assets/img/gallery/jiratui-issue-description.png" alt="The screen of the JiraTUI that shows the description of a work item">
                  </p>
                </div>
            <div>
              <h3>Update Tasks</h3>
              <p>Keep your tasks up to date effortlessly with JiraTUI's update feature. Modify task details such as status, assignee, summary, labels and due dates directly from the command line. This functionality ensures that your project remains organized and current, enhancing collaboration and workflow efficiency.</p>
            </div>
          </div>
          <div>
            <p><img src="https://jiratui.sh/assets/img/gallery/jiratui-comments.png" alt="The screen of the JiraTUI that shows the comments of a work item">
            </p>
            <div>
              <h3>Comments</h3>
              <p>Engage with your team by managing comments on tasks through JiraTUI. Add or delete comments directly from the terminal, fostering clear communication and collaboration. This feature helps keep discussions organized and accessible, ensuring everyone stays informed about task progress.</p>
            </div>
          </div>
          <div>
              <h3>Manage Related Tasks</h3>
              <p>Easily manage related tasks with JiraTUI, allowing you to link and unlink tasks directly from the terminal. This feature helps you visualize dependencies and relationships between tasks, ensuring a more cohesive project management experience and improving overall workflow.</p>
            </div>
          <div>
            <div id="carouselJQLExpressions" data-bs-ride="carousel">
                  <p><img src="https://jiratui.sh/assets/img/gallery/jiratui-jql-expression-editor.png" alt="The screen of the JiraTUI that shows a screen to edit JQL expressions for searching work item">
                  </p>
                  <p><img src="https://jiratui.sh/assets/img/gallery/jiratui-jql-expression-editor-2.png" alt="The screen of the JiraTUI that shows the JQL expression editor">
                  </p>
                </div>
            <div>
              <h3>JQL Search</h3>
              <p>Leverage the power of Jira Query Language (JQL) with JiraTUI to perform advanced searches. This feature allows you to create complex queries to filter tasks based on specific criteria, providing greater flexibility and precision in managing your projects and enhancing your productivity. Expressions can be saved to use at any time.</p>
            </div>
          </div>
        </div><!-- <section> close ============================-->

      <div>
          <h2>Advantages</h2>
          <p>Discover the key advantages of JiraTUI that make it an essential tool for developers seeking efficient and effective task management.</p>
          <div>
            <div>
                  <svg xmlns="http://www.w3.org/2000/svg" width="76" height="76" fill="currentColor" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M11.5 2a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3M9.05 3a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0V3zM4.5 7a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3M2.05 8a2.5 2.5 0 0 1 4.9 0H16v1H6.95a2.5 2.5 0 0 1-4.9 0H0V8zm9.45 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m-2.45 1a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0v-1z"></path>
                  </svg>
                  <h3>Configurable</h3>
                  <p>JiraTUI is highly configurable, allowing users to tailor the tool to their specific needs. Customize command shortcuts, settings, and preferences to create a personalized experience that enhances productivity. This flexibility ensures that JiraTUI adapts to your workflow, making it a perfect fit for any development environment.</p>
                </div>
            <div>
                  <svg xmlns="http://www.w3.org/2000/svg" width="76" height="76" fill="currentColor" viewBox="0 0 16 16">
  <path d="M2 6a6 6 0 1 1 10.174 4.31c-.203.196-.359.4-.453.619l-.762 1.769A.5.5 0 0 1 10.5 13a.5.5 0 0 1 0 1 .5.5 0 0 1 0 1l-.224.447a1 1 0 0 1-.894.553H6.618a1 1 0 0 1-.894-.553L5.5 15a.5.5 0 0 1 0-1 .5.5 0 0 1 0-1 .5.5 0 0 1-.46-.302l-.761-1.77a2 2 0 0 0-.453-.618A5.98 5.98 0 0 1 2 6m6-5a5 5 0 0 0-3.479 8.592c.263.254.514.564.676.941L5.83 12h4.342l.632-1.467c.162-.377.413-.687.676-.941A5 5 0 0 0 8 1"></path>
</svg>
                  <h3>Simplicity</h3>
                  <p>JiraTUI offers a straightforward command-line interface that simplifies task management. By eliminating unnecessary clicks and navigation, it allows developers to focus on their work. The intuitive commands make it easy to perform actions quickly, ensuring that managing Jira tasks is a seamless part of your development workflow.</p>
                </div>
          </div>
          <div>
            <div>
                  <svg xmlns="http://www.w3.org/2000/svg" width="76" height="76" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M8 4a.5.5 0 0 1 .5.5V6a.5.5 0 0 1-1 0V4.5A.5.5 0 0 1 8 4M3.732 5.732a.5.5 0 0 1 .707 0l.915.914a.5.5 0 1 1-.708.708l-.914-.915a.5.5 0 0 1 0-.707M2 10a.5.5 0 0 1 .5-.5h1.586a.5.5 0 0 1 0 1H2.5A.5.5 0 0 1 2 10m9.5 0a.5.5 0 0 1 .5-.5h1.5a.5.5 0 0 1 0 1H12a.5.5 0 0 1-.5-.5m.754-4.246a.39.39 0 0 0-.527-.02L7.547 9.31a.91.91 0 1 0 1.302 1.258l3.434-4.297a.39.39 0 0 0-.029-.518z"></path>
                    <path fill-rule="evenodd" d="M0 10a8 8 0 1 1 15.547 2.661c-.442 1.253-1.845 1.602-2.932 1.25C11.309 13.488 9.475 13 8 13c-1.474 0-3.31.488-4.615.911-1.087.352-2.49.003-2.932-1.25A8 8 0 0 1 0 10m8-7a7 7 0 0 0-6.603 9.329c.203.575.923.876 1.68.63C4.397 12.533 6.358 12 8 12s3.604.532 4.923.96c.757.245 1.477-.056 1.68-.631A7 7 0 0 0 8 3"></path>
                  </svg>
                  <h3>Speed</h3>
                  <p>Experience unparalleled speed with JiraTUI, designed for efficiency in task management. The command-line interface allows for rapid execution of commands, enabling developers to create, update, and search tasks in seconds. This speed not only saves time but also enhances overall productivity, allowing you to focus on delivering quality work.</p>
                </div>
            <div>
                  <svg xmlns="http://www.w3.org/2000/svg" width="76" height="76" fill="currentColor" viewBox="0 0 16 16">
  <path d="M3.112 3.645A1.5 1.5 0 0 1 4.605 2H7a.5.5 0 0 1 .5.5v.382c0 .696-.497 1.182-.872 1.469a.5.5 0 0 0-.115.118l-.012.025L6.5 4.5v.003l.003.01q.005.015.036.053a.9.9 0 0 0 .27.194C7.09 4.9 7.51 5 8 5c.492 0 .912-.1 1.19-.24a.9.9 0 0 0 .271-.194.2.2 0 0 0 .039-.063v-.009l-.012-.025a.5.5 0 0 0-.115-.118c-.375-.287-.872-.773-.872-1.469V2.5A.5.5 0 0 1 9 2h2.395a1.5 1.5 0 0 1 1.493 1.645L12.645 6.5h.237c.195 0 .42-.147.675-.48.21-.274.528-.52.943-.52.568 0 .947.447 1.154.862C15.877 6.807 16 7.387 16 8s-.123 1.193-.346 1.638c-.207.415-.586.862-1.154.862-.415 0-.733-.246-.943-.52-.255-.333-.48-.48-.675-.48h-.237l.243 2.855A1.5 1.5 0 0 1 11.395 14H9a.5.5 0 0 1-.5-.5v-.382c0-.696.497-1.182.872-1.469a.5.5 0 0 0 .115-.118l.012-.025.001-.006v-.003a.2.2 0 0 0-.039-.064.9.9 0 0 0-.27-.193C8.91 11.1 8.49 11 8 11s-.912.1-1.19.24a.9.9 0 0 0-.271.194.2.2 0 0 0-.039.063v.003l.001.006.012.025c.016.027.05.068.115.118.375.287.872.773.872 1.469v.382a.5.5 0 0 1-.5.5H4.605a1.5 1.5 0 0 1-1.493-1.645L3.356 9.5h-.238c-.195 0-.42.147-.675.48-.21.274-.528.52-.943.52-.568 0-.947-.447-1.154-.862C.123 9.193 0 8.613 0 8s.123-1.193.346-1.638C.553 5.947.932 5.5 1.5 5.5c.415 0 .733.246.943.52.255.333.48.48.675.48h.238zM4.605 3a.5.5 0 0 0-.498.55l.001.007.29 3.4A.5.5 0 0 1 3.9 7.5h-.782c-.696 0-1.182-.497-1.469-.872a.5.5 0 0 0-.118-.115l-.025-.012L1.5 6.5h-.003a.2.2 0 0 0-.064.039.9.9 0 0 0-.193.27C1.1 7.09 1 7.51 1 8s.1.912.24 1.19c.07.14.14.225.194.271a.2.2 0 0 0 .063.039H1.5l.006-.001.025-.012a.5.5 0 0 0 .118-.115c.287-.375.773-.872 1.469-.872H3.9a.5.5 0 0 1 .498.542l-.29 3.408a.5.5 0 0 0 .497.55h1.878c-.048-.166-.195-.352-.463-.557-.274-.21-.52-.528-.52-.943 0-.568.447-.947.862-1.154C6.807 10.123 7.387 10 8 10s1.193.123 1.638.346c.415.207.862.586.862 1.154 0 .415-.246.733-.52.943-.268.205-.415.39-.463.557h1.878a.5.5 0 0 0 .498-.55l-.001-.007-.29-3.4A.5.5 0 0 1 12.1 8.5h.782c.696 0 1.182.497 1.469.872.05.065.091.099.118.115l.025.012.006.001h.003a.2.2 0 0 0 .064-.039.9.9 0 0 0 .193-.27c.14-.28.24-.7.24-1.191s-.1-.912-.24-1.19a.9.9 0 0 0-.194-.271.2.2 0 0 0-.063-.039H14.5l-.006.001-.025.012a.5.5 0 0 0-.118.115c-.287.375-.773.872-1.469.872H12.1a.5.5 0 0 1-.498-.543l.29-3.407a.5.5 0 0 0-.497-.55H9.517c.048.166.195.352.463.557.274.21.52.528.52.943 0 .568-.447.947-.862 1.154C9.193 5.877 8.613 6 8 6s-1.193-.123-1.638-.346C5.947 5.447 5.5 5.068 5.5 4.5c0-.415.246-.733.52-.943.268-.205.415-.39.463-.557z"></path>
</svg>
                  <h3>Easy to Use</h3>
                  <p>JiraTUI is designed with user-friendliness in mind, making it accessible for developers of all skill levels. The clear command structure and helpful prompts guide users through task management effortlessly. With minimal learning curve, you can quickly harness the power of JiraTUI and integrate it into your daily workflow.</p>
                </div>
          </div>
        </div><!-- <section> close ============================-->

      <!-- <section> close ============================-->

    </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[The Scam Called "You Don't Have to Remember Anything" (323 pts)]]></title>
            <link>https://zettelkasten.de/posts/the-scam-called-you-dont-have-to-remember-anything/</link>
            <guid>45198420</guid>
            <pubDate>Wed, 10 Sep 2025 14:38:59 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://zettelkasten.de/posts/the-scam-called-you-dont-have-to-remember-anything/">https://zettelkasten.de/posts/the-scam-called-you-dont-have-to-remember-anything/</a>, See on <a href="https://news.ycombinator.com/item?id=45198420">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
    
    <main id="content">
      
<section id="posts">
    <article>
        <header>
            

            <ul>
                <li><time datetime="2025-09-09 17:02:25 +0100"><time datetime="2025-09-09 17:02:25 +0100">Sep 9th, 2025</time></time></li>
                
                <li></li>
                <li>
            </li></ul>

            <img src="https://vg05.met.vgwort.de/na/82f66c9a980046ad91abab0ddb442e73" width="1" height="1" alt="">

            
        </header>

        <p>Dear Zettlers,</p>

<p>This scam is decades old now and it is quite surprising that people still fall for it.</p>

<p>The search engines, old note-taking apps (you know, those with an elephant icon and the like) and AI have something in common: They claim that the effort of remembering things is outdated like <a href="https://www.youtube.com/watch?v=4VuePDTgSDo">using a candle in the age of electric light</a>.</p>

<p>The following is, by the way, from my Zettelkasten (2016):</p>

<blockquote>
  <p>To find what you need online, you require a solid general education and, above all, prior knowledge in the area related to your search.<sup id="fnref:spitzer2012"><a href="#fn:spitzer2012" rel="footnote" role="doc-noteref">1</a></sup></p>
</blockquote>

<p>Original in German:</p>

<blockquote>
  <p>Was man braucht, um im Netz fündig zu werden, ist eine solide Grundbildung und vor allem Vorwissen in dem Bereich, in dem sich die Suche bewegt.  <br>
—Manfred Spitzer, Digitale Demenz<sup id="fnref:spitzer2012:1"><a href="#fn:spitzer2012" rel="footnote" role="doc-noteref">1</a></sup></p>
</blockquote>

<p>Culturally, it is increasingly the case that the first step is to go online, search for the a desired end result of a thinking process instead of engaging in learning. This means that we are using the internet less and less to our advantage, because we have less and less prior knowledge: We detrain ourselves out of the ability to access the quality of the information and turn it into actual knowledge.</p>

<p>Rowlands et al. wrote about the so called “digital natives” that they lack the critical and analytical thinking skills to evaluate the information they find on the internet.<sup id="fnref:rowlands2008"><a href="#fn:rowlands2008" rel="footnote" role="doc-noteref">2</a></sup> We need a fully developed mental map of the subject in order to derive value from the results of an internet search.</p>

<p>In short: You need a trained brain to actually benefit from the internet.</p>

<p><strong>The advertised benefits of all these tools come with a specific hidden cost: Your ability to think.</strong></p>

<p>Let’t take a closer look at the digital natives, since this issue is more accessible. They put themselves in a situation in which there is a vastly reduced incentive structure to evaluate the information critically. They use surface level indicators if the information matches the request. This behaviour has some obvious effects (in hindsight):</p>

<ol>
  <li>The reduced engagement with the material reduces the emotional weight of the whole line of action. You mind is an engine that is fuelled by emotion. Without any emotion, you don’t think. Rather, you try to imitate thinking efficiently.</li>
  <li>The more you interact with information being emotionally disengaged and keeping it on the surface level, the more you develop the habit to engage with information in a way that it doesn’t change your brain.</li>
</ol>

<p>So the more you work in a superficial way, the more brittle the knowledge foundation in your mind will be on which you base your cognitive actions.</p>

<p>This drives us to one of the most important conclusions of the entire field of note-taking, knowledge work, critical thinking and alike: <em>You</em>, not AI, not your PKM or whatever need to build the knowledge because only then it is in your brain and you can go the next step.</p>

<p>Let me try to give you a demonstration of the issue:</p>

<p>I asked ChatGPT to design an optimal weekly training schedule for health span and fitness. This is the answer:</p>

<p>Here’s a table outlining the optimal weekly workout schedule for <strong>health span and longevity</strong> based on the assumption that you should focus on <strong>aerobic capacity</strong>, <strong>muscle strength</strong>, <strong>mobility/flexibility</strong>, and <strong>neuromuscular coordination</strong>:</p>

<table>
  <thead>
    <tr>
      <th><strong>Day</strong></th>
      <th><strong>Workout Type</strong></th>
      <th><strong>Focus</strong></th>
      <th><strong>Duration</strong></th>
      <th><strong>Details</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Monday</strong></td>
      <td>Full-Body Strength Training</td>
      <td>Muscle mass, metabolic health</td>
      <td>45–60 min</td>
      <td>Warm-up: Dynamic stretches (5 min)  - Squats, Deadlifts, Push-ups, Pull-ups (3x 8–12 reps)  - Core: Plank (3x 30–60 sec)  - Cool-down: Static stretches (5 min)</td>
    </tr>
    <tr>
      <td><strong>Tuesday</strong></td>
      <td>Low-Intensity Cardio &amp; Mobility</td>
      <td>Heart health, joint function</td>
      <td>30–60 min</td>
      <td>Brisk walking, cycling, or swimming (30–45 min)  - Yoga or joint mobility exercises (15 min)</td>
    </tr>
    <tr>
      <td><strong>Wednesday</strong></td>
      <td>High-Intensity Interval Training (HIIT)</td>
      <td>Cardiovascular fitness, metabolism</td>
      <td>20–30 min</td>
      <td>Warm-up: Light jogging (5 min)  - 30 sec sprint / 90 sec walk (15–20 min) OR Bodyweight circuit (40 sec on/20 sec rest)  - Cool-down: Stretching (5 min)</td>
    </tr>
    <tr>
      <td><strong>Thursday</strong></td>
      <td>Active Recovery &amp; Balance</td>
      <td>Recovery, neuromuscular coordination</td>
      <td>30–45 min</td>
      <td>Easy yoga, tai chi, or a nature walk (20–30 min)  - Balance drills: Single-leg stands, heel-to-toe walking (10–15 min)</td>
    </tr>
    <tr>
      <td><strong>Friday</strong></td>
      <td>Upper-Body Strength &amp; Core</td>
      <td>Upper-body strength, core stability</td>
      <td>45–60 min</td>
      <td>Warm-up: Arm/shoulder stretches (5 min)  - Overhead Press, Pull-ups, Push-ups, Rows (3x 8–12 reps)  - Core: Russian twists or bird-dogs (3 sets)  - Cool-down: Static stretches (5 min)</td>
    </tr>
    <tr>
      <td><strong>Saturday</strong></td>
      <td>Moderate-Intensity Cardio</td>
      <td>Endurance, cardiovascular health</td>
      <td>45–60 min</td>
      <td>Steady activity: Jogging, cycling, swimming, rowing, or hiking (60–70% max heart rate)  - Cool-down: Easy pace and stretches (5 min)</td>
    </tr>
    <tr>
      <td><strong>Sunday</strong></td>
      <td>Mobility &amp; Flexibility</td>
      <td>Recovery, flexibility</td>
      <td>30–60 min</td>
      <td>Yoga session focusing on stretching major muscle groups  - Foam rolling or myofascial release</td>
    </tr>
  </tbody>
</table>

<p>Looks good alright? Or does it? How do you know? You can’t if you don’t have sufficient background knowledge. Here is a little quiz if you have the sufficient background knowledge:</p>

<ol>
  <li>How do volume and intensity factor in strength gains?</li>
  <li>What is the difference between aerobic capacity and aerobic power?</li>
  <li>How do you weigh each minute spend on flexibility against the minutes spent on aerobic capacity and strength?</li>
</ol>

<p>If you can’t produce a comprehensive answer <em>with confidence and on the whim</em> the second you read the question, you don’t have the sufficient background knowledge.</p>

<p>“I just ask ChatGPT for that, too!”, the AI generation might ask. Ok, and then what? How can you assess the answers to those three questions (which represent only a fraction of needed knowledge!)?</p>

<p>What is going wrong? You are taking on an impossible task, because you can’t use enough of your brain for your cognitive operations. Assuming that you have no comprehensive knowledge in health and fitness, terms like “aerobic capacity” or “core stability” only activate some superficial level associations. But if you are deeply involved with the topic the term “aerobic capacity” activates <em>way more</em>. Here are some examples (just a small fraction):</p>

<ul>
  <li>Two discussions of Olaf Alexander Bu on the difference between capacity and power numbers in measuring endurance performances.</li>
  <li>A mental map on the aerobic metabolism.</li>
  <li>The tension between peripheral endurance improvements (like mitochondrial biogenesis) central improvements (like improved cardiac output) and their connection (like angiogenesis)</li>
  <li>The still ongoing discussion between low intensity exercise and high intensity exercise as the best tool to build aerobic capacity for the non-professional athlete.</li>
  <li>The differences between running, cycling, rowing and all the other movements to build aerobic capacity.</li>
  <li>An open task to review a paper on interval length that you found in “Textbook of Work Physiology” by Astrand and Rodahl.</li>
</ul>

<p>This is a small fraction of what I can observe in my mind and there is a lot more going on unconsciously. Now consider that I might be very well-read in the domain of health and fitness. But multiply this by a factor of 100 if you replace me with an expert like Olaf Alexander Bu when it comes to the term “aerobic capacity”.</p>

<p>In knowledge work the bottleneck is not the external availability of information. It is the internal bandwidth of processing power which is determined by your innate abilities and the training status of your mind.</p>

<p>So, coming back to the initial starting point that “you don’t have to remember anything”. <em>The opposite is true.</em></p>

<p><strong>You have to remember EVERYTHING.</strong> Only then you can perform the cognitive tasks necessary to perform meaningful knowledge work.</p>

<p>The way you train your mind is the way your mind can perform. Simple tools like spaced repetition allow your mind to perform simple tasks, complex tools like the Zettelkasten Method allow your mind to master complex tasks. Remember my mantra of depth of processing? Perhaps, you can rephrase it to train your mind for depth.</p>

<p>The field of knowledge work will not advance if we don’t come to terms that we can’t circumvent the work needed to train our minds.</p>

<p>Live long and prosper  <br>
Sascha</p>



        
    </article>

    
  



    
      
        
      
    
</section>

    </main>
  </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Performance Improvements in .NET 10 (161 pts)]]></title>
            <link>https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-10/</link>
            <guid>45197608</guid>
            <pubDate>Wed, 10 Sep 2025 13:46:02 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-10/">https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-10/</a>, See on <a href="https://news.ycombinator.com/item?id=45197608">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="single-wrapper">
    
    <article data-clarity-region="article" id="post-57952">
        <div data-bi-area="body_article" data-bi-id="post_page_body_article">
            <p>My kids <em>love</em> “Frozen”. They can sing every word, re-enact every scene, and provide detailed notes on the proper sparkle of Elsa’s ice dress. I’ve seen the movie more times than I can recount, to the point where, if you’ve seen me do any live coding, you’ve probably seen my subconscious incorporate an Arendelle reference or two. After so many viewings, I began paying closer attention to the details, like how at the very beginning of the film the ice harvesters are singing a song that subtly foreshadows the story’s central conflicts, the characters’ journeys, and even the key to resolving the climax. I’m slightly ashamed to admit I didn’t comprehend this connection until viewing number ten or so, at which point I also realized I had no idea if this ice harvesting was actually “a thing” or if it was just a clever vehicle for Disney to spin a yarn. Turns out, as I subsequently researched, it’s quite real.</p>
<p>In the 19th century, before refrigeration, ice was an incredibly valuable commodity. Winters in the northern United States turned ponds and lakes into seasonal gold mines. The most successful operations ran with precision: workers cleared snow from the surface so the ice would grow thicker and stronger, and they scored the surface into perfect rectangles using horse-drawn plows, turning the lake into a frozen checkerboard. Once the grid was cut, teams with long saws worked to free uniform blocks weighing several hundred pounds each. These blocks were floated along channels of open water toward the shore, at which point men with poles levered the blocks up ramps and hauled them into storage. Basically, what the movie shows.</p>
<p>The storage itself was an art. Massive wooden ice houses, sometimes holding tens of thousands of tons, were lined with insulation, typically straw. Done well, this insulation could keep the ice solid for months, even through summer heat. Done poorly, you would open the doors to slush. And for those moving ice over long distances, typically by ship, every degree, every crack in the insulation, every extra day in transit meant more melting and more loss.</p>
<p>Enter Frederic Tudor, the “Ice King” of Boston. He was obsessed with systemic efficiency. Where competitors saw unavoidable loss, Tudor saw a solvable problem. After experimenting with different insulators, he leaned on cheap sawdust, a lumber mill byproduct that outperformed straw, packing it densely around the ice to cut melt losses significantly. For harvesting efficiency, his operations adopted Nathaniel Jarvis Wyeth’s grid-scoring system, which produced uniform blocks that could be packed tightly, minimizing air gaps that would otherwise increase exposure in a ship’s hold. And to shorten the critical time between shore and ship, Tudor built out port infrastructure and depots near docks, allowing ships to load and unload much faster. Each change, from tools to ice house design to logistics, amplified the last, turning a risky local harvest into a reliable global trade. With Tudor’s enhancements, he had solid ice arriving in places like Havana, Rio de Janeiro, and even Calcutta (a voyage of four months in the 1830s). His performance gains allowed the product to survive journeys that were previously unthinkable.</p>
<p>What made Tudor’s ice last halfway around the world wasn’t one big idea. It was a plethora of small improvements, each multiplying the effect of the last. In software development, the same principle holds: big leaps forward in performance rarely come from a single sweeping change, rather from hundreds or thousands of targeted optimizations that compound into something transformative. .NET 10’s performance story isn’t about one Disney-esque magical idea; it’s about carefully shaving off nanoseconds here and tens of bytes there, streamlining operations that are executed trillions of times.</p>
<p>In the rest of this post, just as we did in Performance Improvements in <a href="https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-9/">.NET 9</a>, <a href="https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-8/">.NET 8</a>, <a href="https://devblogs.microsoft.com/dotnet/performance_improvements_in_net_7/">.NET 7</a>, <a href="https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-6">.NET 6</a>, <a href="https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-5">.NET 5</a>, <a href="https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-core-3-0">.NET Core 3.0</a>, <a href="https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-core-2-1">.NET Core 2.1</a>, and <a href="https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-core">.NET Core 2.0</a>, we’ll dig into hundreds of the small but meaningful and compounding performance improvements since .NET 9 that make up .NET 10’s story (if you instead stay on LTS releases and thus are upgrading from .NET 8 instead of from .NET 9, you’ll see even more improvements based on the aggregation from all the <a href="https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-9/">improvements in .NET 9</a> as well). So, without further ado, go grab a cup of your favorite hot beverage (or, given my intro, maybe something a bit more frosty), sit back, relax, and “Let It Go”!</p>
<p>Or, hmm, maybe, let’s push performance “Into the Unknown”?</p>
<p>Let .NET 10 performance “Show Yourself”?</p>
<p>“Do You Want To Build a <del>Snowman</del> Fast Service?”</p>
<p>I’ll see myself out.</p>
<h2>Benchmarking Setup</h2>
<p>As in previous posts, this tour is chock full of micro-benchmarks intended to showcase various performance improvements. Most of these benchmarks are implemented using <a href="https://www.nuget.org/packages/BenchmarkDotNet/0.15.2">BenchmarkDotNet 0.15.2</a>, with a simple setup for each.</p>
<p>To follow along, make sure you have <a href="https://dotnet.microsoft.com/download/dotnet/9.0">.NET 9</a> and <a href="https://dotnet.microsoft.com/download/dotnet/10.0">.NET 10</a> installed, as most of the benchmarks compare the same test running on each. Then, create a new C# project in a new <code>benchmarks</code> directory:</p>
<pre><code>dotnet new console -o benchmarks
cd benchmarks</code></pre>
<p>That will produce two files in the <code>benchmarks</code> directory: <code>benchmarks.csproj</code>, which is the project file with information about how the application should be compiled, and <code>Program.cs</code>, which contains the code for the application. Finally, replace everything in <code>benchmarks.csproj</code> with this:</p>
<pre><code>&lt;Project Sdk="Microsoft.NET.Sdk"&gt;

  &lt;PropertyGroup&gt;
    &lt;OutputType&gt;Exe&lt;/OutputType&gt;
    &lt;TargetFrameworks&gt;net10.0;net9.0&lt;/TargetFrameworks&gt;
    &lt;LangVersion&gt;Preview&lt;/LangVersion&gt;
    &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;
    &lt;Nullable&gt;enable&lt;/Nullable&gt;
    &lt;ServerGarbageCollection&gt;true&lt;/ServerGarbageCollection&gt;
  &lt;/PropertyGroup&gt;

  &lt;ItemGroup&gt;
    &lt;PackageReference Include="BenchmarkDotNet" Version="0.15.2" /&gt;
  &lt;/ItemGroup&gt;

&lt;/Project&gt;</code></pre>
<p>With that, we’re good to go. Unless otherwise noted, I’ve tried to make each benchmark standalone; just copy/paste its whole contents into the Program.cs file, overwriting everything that’s there, and then run the benchmarks. Each test includes at its top a comment for the <code>dotnet</code> command to use to run the benchmark. It’s typically something like this:</p>
<pre><code>dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0</code></pre>
<p>which will run the benchmark in release on both .NET 9 and .NET 10 and show the compared results. The other common variation, used when the benchmark should only be run on .NET 10 (typically because it’s comparing two approaches rather than comparing one thing on two versions), is the following:</p>
<pre><code>dotnet run -c Release -f net10.0 --filter "*"</code></pre>
<p>Throughout the post, I’ve shown many benchmarks and the results I received from running them. Unless otherwise stated (e.g. because I’m demonstrating an OS-specific improvement), the results shown are from running them on Linux (Ubuntu 24.04.1) on an x64 processor.</p>
<pre><code>BenchmarkDotNet v0.15.2, Linux Ubuntu 24.04.1 LTS (Noble Numbat)
11th Gen Intel Core i9-11950H 2.60GHz, 1 CPU, 16 logical and 8 physical cores
.NET SDK 10.0.100-rc.1.25451.107
  [Host]     : .NET 9.0.9 (9.0.925.41916), X64 RyuJIT AVX-512F+CD+BW+DQ+VL+VBMI</code></pre>
<p>As always, a quick disclaimer: these are micro-benchmarks, timing operations so short you’d miss them by blinking (but when such operations run millions of times, the savings really add up). The exact numbers you get will depend on your hardware, your operating system, what else your machine is juggling at the moment, how much coffee you’ve had since breakfast, and perhaps whether Mercury is in retrograde. In other words, don’t expect your results to match mine exactly, but I’ve picked tests that should still be reasonably reproducible in the real world.</p>
<p>Now, let’s start at the bottom of the stack. Code generation.</p>
<h2>JIT</h2>
<p>Among all areas of .NET, the Just-In-Time (JIT) compiler stands out as one of the most impactful. Every .NET application, whether a small console tool or a large-scale enterprise service, ultimately relies on the JIT to turn intermediate language (IL) code into optimized machine code. Any enhancement to the JIT’s generated code quality has a ripple effect, improving performance across the entire ecosystem without requiring developers to change any of their own code or even recompile their C#. And with .NET 10, there’s no shortage of these improvements.</p>
<h3>Deabstraction</h3>
<p>As with many languages, .NET historically has had an “abstraction penalty,” those extra allocations and indirections that can occur when using high-level language features like interfaces, iterators, and delegates. Each year, the JIT gets better and better at optimizing away layers of abstraction, so that developers get to write simple code and still get great performance. .NET 10 continues this tradition. The result is that idiomatic C# (using interfaces, <code>foreach</code> loops, lambdas, etc.) runs even closer to the raw speed of meticulously crafted and hand-tuned code.</p>
<h4>Object Stack Allocation</h4>
<p>One of the most exciting areas of deabstraction progress in .NET 10 is the expanded use of escape analysis to enable stack allocation of objects. Escape analysis is a compiler technique to determine whether an object allocated in a method escapes that method, meaning determining whether that object is reachable after the method returns (for example, by being stored in a field or returned to the caller) or used in some way that the runtime can’t track within the method (like passed to an unknown callee). If the compiler can prove an object doesn’t escape, then that object’s lifetime is bounded by the method, and it can be allocated on the stack instead of on the heap. Stack allocation is much cheaper (just pointer bumping for allocation and automatic freeing when the method exits) and reduces GC pressure because, well, the object doesn’t need to be tracked by the GC. .NET 9 had already introduced some limited escape analysis and stack allocation support; .NET 10 takes this significantly further.</p>
<p><a href="https://github.com/dotnet/runtime/pull/115172">dotnet/runtime#115172</a> teaches the JIT how to perform escape analysis related to delegates, and in particular that a delegate’s <code>Invoke</code> method (which is implemented by the runtime) does not stash away the <code>this</code> reference. Then if escape analysis can prove that the delegate’s object reference is something that otherwise hasn’t escaped, the delegate can effectively evaporate. Consider this benchmark:</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "y")]
public partial class Tests
{
    [Benchmark]
    [Arguments(42)]
    public int Sum(int y)
    {
        Func&lt;int, int&gt; addY = x =&gt; x + y;
        return DoubleResult(addY, y);
    }

    private int DoubleResult(Func&lt;int, int&gt; func, int arg)
    {
        int result = func(arg);
        return result + result;
    }
}</code></pre>
<p>If we just run this benchmark and compare .NET 9 and .NET 10, we can immediately tell something interesting is happening.</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>Code Size</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sum</td>
<td>.NET 9.0</td>
<td>19.530 ns</td>
<td>1.00</td>
<td>118 B</td>
<td>88 B</td>
<td>1.00</td>
</tr>
<tr>
<td>Sum</td>
<td>.NET 10.0</td>
<td>6.685 ns</td>
<td>0.34</td>
<td>32 B</td>
<td>24 B</td>
<td>0.27</td>
</tr>
</tbody>
</table>
<p>The C# code for <code>Sum</code> belies complicated code generation by the C# compiler. It needs to create a <code>Func&lt;int, int&gt;</code>, which is “closing over” the <code>y</code> “local”. That means the compiler needs to “lift” <code>y</code> to no longer be an actual local, and instead live as a field on an object; the delegate can then point to a method on that object, giving it access to <code>y</code>. This is approximately what the IL generated by the C# compiler looks like when decompiled to C#:</p>
<pre><code>public int Sum(int y)
{
    &lt;&gt;c__DisplayClass0_0 c = new();
    c.y = y;

    Func&lt;int, int&gt; func = new(c.&lt;Sum&gt;b__0);

    return DoubleResult(func, c.y);
}

private sealed class &lt;&gt;c__DisplayClass0_0
{
    public int y;

    internal int &lt;Sum&gt;b__0(int x) =&gt; x + y;
}</code></pre>
<p>From that, we can see the closure is resulting in two allocations: an allocation for the “display class” (what the C# compiler calls these closure types) and an allocation for the delegate that points to the <code>&lt;Sum&gt;b__0</code> method on that display class instance. That’s what’s accounting for the <code>88</code> bytes of allocation in the .NET 9 results: the display class is 24 bytes, and the delegate is 64 bytes. In the .NET 10 version, though, we only see a 24 byte allocation; that’s because the JIT has successfully elided the delegate allocation. Here is the resulting assembly code:</p>
<pre><code>; .NET 9
; Tests.Sum(Int32)
       push      rbp
       push      r15
       push      rbx
       lea       rbp,[rsp+10]
       mov       ebx,esi
       mov       rdi,offset MT_Tests+&lt;&gt;c__DisplayClass0_0
       call      CORINFO_HELP_NEWSFAST
       mov       r15,rax
       mov       [r15+8],ebx
       mov       rdi,offset MT_System.Func&lt;System.Int32, System.Int32&gt;
       call      CORINFO_HELP_NEWSFAST
       mov       rbx,rax
       lea       rdi,[rbx+8]
       mov       rsi,r15
       call      CORINFO_HELP_ASSIGN_REF
       mov       rax,offset Tests+&lt;&gt;c__DisplayClass0_0.&lt;Sum&gt;b__0(Int32)
       mov       [rbx+18],rax
       mov       esi,[r15+8]
       cmp       [rbx+18],rax
       jne       short M00_L01
       mov       rax,[rbx+8]
       add       esi,[rax+8]
       mov       eax,esi
M00_L00:
       add       eax,eax
       pop       rbx
       pop       r15
       pop       rbp
       ret
M00_L01:
       mov       rdi,[rbx+8]
       call      qword ptr [rbx+18]
       jmp       short M00_L00
; Total bytes of code 112

; .NET 10
; Tests.Sum(Int32)
       push      rbx
       mov       ebx,esi
       mov       rdi,offset MT_Tests+&lt;&gt;c__DisplayClass0_0
       call      CORINFO_HELP_NEWSFAST
       mov       [rax+8],ebx
       mov       eax,[rax+8]
       mov       ecx,eax
       add       eax,ecx
       add       eax,eax
       pop       rbx
       ret
; Total bytes of code 32</code></pre>
<p>In both .NET 9 and .NET 10, the JIT successfully inlined <code>DoubleResult</code>, such that the delegate doesn’t escape, but then in .NET 10, it’s able to stack allocate it. Woo hoo! There’s obviously still future opportunity here, as the JIT doesn’t elide the allocation of the closure object, but that should be addressable with some more effort, hopefully in the near future.</p>
<p><a href="https://github.com/dotnet/runtime/pull/104906">dotnet/runtime#104906</a> from <a href="https://github.com/hez2010">@hez2010</a> and <a href="https://github.com/dotnet/runtime/pull/112250">dotnet/runtime#112250</a> extend this kind of analysis and stack allocation to arrays. How many times have you written code like this?</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Runtime.CompilerServices;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    [Benchmark]
    public void Test()
    {
        Process(new string[] { "a", "b", "c" });

        static void Process(string[] inputs)
        {
            foreach (string input in inputs)
            {
                Use(input);
            }

            [MethodImpl(MethodImplOptions.NoInlining)]
            static void Use(string input) { }
        }
    }
}</code></pre>
<p>Some method I want to call accepts an array of inputs and does something for each input. I need to allocate an array to pass my inputs in, either explicitly, or maybe implicitly due to using <code>params</code> or a collection expression. Ideally moving forward there would be an overload of such a <code>Process</code> method that accepted a <code>ReadOnlySpan&lt;string&gt;</code> instead of a <code>string[]</code>, and I could then avoid the allocation by construction. But for all of these cases where I’m forced to create an array, .NET 10 comes to the rescue.</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Test</td>
<td>.NET 9.0</td>
<td>11.580 ns</td>
<td>1.00</td>
<td>48 B</td>
<td>1.00</td>
</tr>
<tr>
<td>Test</td>
<td>.NET 10.0</td>
<td>3.960 ns</td>
<td>0.34</td>
<td>–</td>
<td>0.00</td>
</tr>
</tbody>
</table>
<p>The JIT was able to inline <code>Process</code>, see that the array never leaves the frame, and stack allocate it.</p>
<p>Of course, now that we’re able to stack allocate arrays, we also want to be able to deal with a common way those arrays are used: via spans. <a href="https://github.com/dotnet/runtime/pull/113977">dotnet/runtime#113977</a> and <a href="https://github.com/dotnet/runtime/pull/116124">dotnet/runtime#116124</a> teach escape analysis to be able to reason about the fields in structs, which includes <code>Span&lt;T&gt;</code>, as it’s “just” a struct that stores a <code>ref T</code> field and an <code>int</code> length field.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Runtime.CompilerServices;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private byte[] _buffer = new byte[3];

    [Benchmark]
    public void Test() =&gt; Copy3Bytes(0x12345678, _buffer);

    [MethodImpl(MethodImplOptions.NoInlining)]
    private static void Copy3Bytes(int value, Span&lt;byte&gt; dest) =&gt;
        BitConverter.GetBytes(value).AsSpan(0, 3).CopyTo(dest);
}</code></pre>
<p>Here, we’re using <code>BitConverter.GetBytes</code>, which allocates a <code>byte[]</code> containing the bytes from the input (in this case, it’ll be a four-byte array for the <code>int</code>), then we slice off three of the four bytes, and we copy them to the destination span.</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Test</td>
<td>.NET 9.0</td>
<td>9.7717 ns</td>
<td>1.04</td>
<td>32 B</td>
<td>1.00</td>
</tr>
<tr>
<td>Test</td>
<td>.NET 10.0</td>
<td>0.8718 ns</td>
<td>0.09</td>
<td>–</td>
<td>0.00</td>
</tr>
</tbody>
</table>
<p>In .NET 9, we get the 32-byte allocation we’d expect for the <code>byte[]</code> in <code>GetBytes</code> (every object on 64-bit is at least 24 bytes, which will include the four bytes for the array’s length, and then the four bytes for the data will be in slots 24-27, and the size will be padded up to the next word boundary, for 32). In .NET 10, with <code>GetBytes</code> and <code>AsSpan</code> inlined, the JIT can see that the array doesn’t escape, and a stack allocated version of it can be used to seed the span, just as if it were created from any other stack allocation (like <code>stackalloc</code>). (This case also needed a little help from <a href="https://github.com/dotnet/runtime/pull/113093">dotnet/runtime#113093</a>, which taught the JIT that certain span operations, like the <code>Memmove</code> used internally by <code>CopyTo</code>, are non-escaping.)</p>
<h4>Devirtualization</h4>
<p>Interfaces and virtual methods are a critical aspect of .NET and the abstractions it enables. Being able to unwind these abstractions and “devirtualize” is then an important job for the JIT, which has taken notable leaps in capabilities here in .NET 10.</p>
<p>While arrays are one of the most central features provided by C# and .NET, and while the JIT exerts a lot of energy and does a great job optimizing many aspects of arrays, one area in particular has caused it pain: an array’s interface implementations. The runtime manufactures a bunch of interface implementations for <code>T[]</code>, and because they’re implemented differently from literally every other interface implementation in .NET, the JIT hasn’t been able to apply the same devirtualization capabilities it’s applied elsewhere. And, for anyone who’s dived deep into micro-benchmarks, this can lead to some odd observations. Here’s a performance comparison between iterating over a <code>ReadOnlyCollection&lt;T&gt;</code> using a <code>foreach</code> loop (going through its enumerator) and using a <code>for</code> loop (indexing on each element).</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*"
// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Collections.ObjectModel;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private ReadOnlyCollection&lt;int&gt; _list = new(Enumerable.Range(1, 1000).ToArray());

    [Benchmark]
    public int SumEnumerable()
    {
        int sum = 0;
        foreach (var item in _list)
        {
            sum += item;
        }
        return sum;
    }

    [Benchmark]
    public int SumForLoop()
    {
        ReadOnlyCollection&lt;int&gt; list = _list;
        int sum = 0;
        int count = list.Count;
        for (int i = 0; i &lt; count; i++)
        {
            sum += _list[i];
        }
        return sum;
    }
}</code></pre>
<p>When asked “which of these will be faster”, the obvious answer is “<code>SumForLoop</code>“. After all, <code>SumEnumerable</code> is going to allocate an enumerator and has to make twice the number of interface calls (<code>MoveNext</code>+<code>Current</code> per iteration vs <code>this[int]</code> per iteration). As it turns out, the obvious answer is also wrong. Here are the timings on my machine for .NET 9:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Mean</th>
</tr>
</thead>
<tbody>
<tr>
<td>SumEnumerable</td>
<td>949.5 ns</td>
</tr>
<tr>
<td>SumForLoop</td>
<td>1,932.7 ns</td>
</tr>
</tbody>
</table>
<p>What the what?? If I change the <code>ToArray</code> to instead be <code>ToList</code>, however, the numbers are much more in line with our expectations.</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Mean</th>
</tr>
</thead>
<tbody>
<tr>
<td>SumEnumerable</td>
<td>1,542.0 ns</td>
</tr>
<tr>
<td>SumForLoop</td>
<td>894.1 ns</td>
</tr>
</tbody>
</table>
<p>So what’s going on here? It’s super subtle. First, it’s necessary to know that <code>ReadOnlyCollection&lt;T&gt;</code> just wraps an arbitrary <code>IList&lt;T&gt;</code>, the <code>ReadOnlyCollection&lt;T&gt;</code>‘s <code>GetEnumerator()</code> returns <code>_list.GetEnumerator()</code> (I’m ignoring for this discussion the special-case where the list is empty), and <code>ReadOnlyCollection&lt;T&gt;</code>‘s indexer just indexes into the <code>IList&lt;T&gt;</code>‘s indexer. So far presumably this all sounds like what you’d expect. But where things gets interesting is around what the JIT is able to devirtualize. In .NET 9, it struggles to devirtualize calls to the interface implementations specifically on <code>T[]</code>, so it won’t devirtualize either the <code>_list.GetEnumerator()</code> call nor the <code>_list[index]</code> call. However, the enumerator that’s returned is just a normal type that implements <code>IEnumerator&lt;T&gt;</code>, and the JIT has no problem devirtualizing its <code>MoveNext</code> and <code>Current</code> members. Which means that we’re actually paying a lot more going through the indexer, because for <code>N</code> elements, we’re having to make <code>N</code> interface calls, whereas with the enumerator, we only need the one with <code>GetEnumerator</code> interface call and then no more after that.</p>
<p>Thankfully, this is now addressed in .NET 10. <a href="https://github.com/dotnet/runtime/pull/108153">dotnet/runtime#108153</a>, <a href="https://github.com/dotnet/runtime/pull/109209">dotnet/runtime#109209</a>, <a href="https://github.com/dotnet/runtime/pull/109237">dotnet/runtime#109237</a>, and <a href="https://github.com/dotnet/runtime/pull/116771">dotnet/runtime#116771</a> all make it possible for the JIT to devirtualize array’s interface method implementations. Now when we run the same benchmark (reverted back to using <code>ToArray</code>), we get results much more in line with our expectations, with both benchmarks improving from .NET 9 to .NET 10, and with <code>SumForLoop</code> on .NET 10 being the fastest.</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>SumEnumerable</td>
<td>.NET 9.0</td>
<td>968.5 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>SumEnumerable</td>
<td>.NET 10.0</td>
<td>775.5 ns</td>
<td>0.80</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>SumForLoop</td>
<td>.NET 9.0</td>
<td>1,960.5 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>SumForLoop</td>
<td>.NET 10.0</td>
<td>624.6 ns</td>
<td>0.32</td>
</tr>
</tbody>
</table>
<p>One of the really interesting things about this is how many libraries are implemented on the premise that it’s faster to use an <code>IList&lt;T&gt;</code>‘s indexer for iteration than it is to use its <code>IEnumerable&lt;T&gt;</code> for iteration, and that includes <code>System.Linq</code>. All these years, where LINQ has had specialized code paths for working with <code>IList&lt;T&gt;</code> when possible, while in many cases it’s been a welcome optimization, in <em>some</em> cases (such as when the concrete type is a <code>ReadOnlyCollection&lt;T&gt;</code>), it’s actually been a deoptimization.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Collections.ObjectModel;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private ReadOnlyCollection&lt;int&gt; _list = new(Enumerable.Range(1, 1000).ToArray());

    [Benchmark]
    public int SkipTakeSum() =&gt; _list.Skip(100).Take(800).Sum();
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>SkipTakeSum</td>
<td>.NET 9.0</td>
<td>3.525 us</td>
<td>1.00</td>
</tr>
<tr>
<td>SkipTakeSum</td>
<td>.NET 10.0</td>
<td>1.773 us</td>
<td>0.50</td>
</tr>
</tbody>
</table>
<p>Fixing devirtualization for array’s interface implementation then also has this transitive effect on LINQ.</p>
<p>Guarded Devirtualization (GDV) is also improved in .NET 10, such as from <a href="https://github.com/dotnet/runtime/pull/116453">dotnet/runtime#116453</a> and <a href="https://github.com/dotnet/runtime/pull/109256">dotnet/runtime#109256</a>. With <a href="https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-8/#tiering-and-dynamic-pgo">dynamic PGO</a>, the JIT is able to instrument a method’s compilation and then use the resulting profiling data as part of emitting an optimized version of the method. One of the things it can profile are which types are used in a virtual dispatch. If one type dominates, it can special-case that type in the code gen and emit a customized implementation specific to that type. That then enables devirtualization in that dedicated path, which is “guarded” by the relevant type check, hence “GDV”. In some cases, however, such as if a virtual call was being made in a shared generic context, GDV would not kick in. Now it will.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Runtime.CompilerServices;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    [Benchmark]
    public bool Test() =&gt; GenericEquals("abc", "abc");

    [MethodImpl(MethodImplOptions.NoInlining)]
    private static bool GenericEquals&lt;T&gt;(T a, T b) =&gt; EqualityComparer&lt;T&gt;.Default.Equals(a, b);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Test</td>
<td>.NET 9.0</td>
<td>2.816 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>Test</td>
<td>.NET 10.0</td>
<td>1.511 ns</td>
<td>0.54</td>
</tr>
</tbody>
</table>
<p><a href="https://github.com/dotnet/runtime/pull/110827">dotnet/runtime#110827</a> from <a href="https://github.com/hez2010">@hez2010</a> also helps more methods to be inlined by doing another pass looking for opportunities after later phases of devirtualization. The JIT’s optimizations are split up into multiple phases; each phase can make improvements, and those improvements can expose additional opportunities. If those opportunities would only be capitalized on by a phase that already ran, they can be missed. But for phases that are relatively cheap to perform, such as doing a pass looking for additional inlining opportunities, those phases can be repeated once enough other optimization has happened that it’s likely productive to do so again.</p>
<h3>Bounds Checking</h3>
<p>C# is a memory-safe language, an important aspect of modern programming languages. A key component of this is the inability to walk off the beginning or end of an array, string, or span. The runtime ensures that any such invalid attempt produces an exception, rather than being allowed to perform the invalid memory access. We can see what this looks like with a small benchmark:</p>
<pre><code>// dotnet run -c Release -f net10.0 --filter "*"

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private int[] _array = new int[3];

    [Benchmark]
    public int Read() =&gt; _array[2];
}</code></pre>
<p>This is a valid access: the <code>_array</code> contains three elements, and the <code>Read</code> method is reading its last element. However, the JIT can’t be 100% certain that this access is in bounds (something could have changed what’s in the <code>_array</code> field to be a shorter array), and thus it needs to emit a check to ensure we’re not walking off the end of the array. Here’s what the generated assembly code for <code>Read</code> looks like:</p>
<pre><code>; .NET 10
; Tests.Read()
       push      rax
       mov       rax,[rdi+8]
       cmp       dword ptr [rax+8],2
       jbe       short M00_L00
       mov       eax,[rax+18]
       add       rsp,8
       ret
M00_L00:
       call      CORINFO_HELP_RNGCHKFAIL
       int       3
; Total bytes of code 25</code></pre>
<p>The <code>this</code> reference is passed into the <code>Read</code> instance method in the <code>rdi</code> register, and the <code>_array</code> field is at offset 8, so the <code>mov rax,[rdi+8]</code> instruction is loading the address of the array into the <code>rax</code> register. Then the <code>cmp</code> is loading the value at offset 8 from that address; it so happens that’s where the length of the array is stored in the array object. So, this <code>cmp</code> instruction is the bounds check; it’s comparing <code>2</code> against that length to ensure it’s in bounds. If the array were too short for this access, the next <code>jbe</code> instruction would branch to the <code>M00_L00</code> label, which calls the <code>CORINFO_HELP_RNGCHKFAIL</code> helper function that throws an <code>IndexOutOfRangeException</code>. Any time you see this pair of <code>call CORINFO_HELP_RNGCHKFAIL</code>/<code>int 3</code> at the end of a method, there was at least one bounds check emitted by the JIT in that method.</p>
<p>Of course, we not only want safety, we also want great performance, and it’d be terrible for performance if every single read from an array (or string or span) incurred such an additional check. As such, the JIT strives to avoid emitting these checks when they’d be redundant, when it can prove by construction that the accesses are safe. For example, let me tweak my benchmark slightly, moving the array from an instance field into a <code>static readonly</code> field:</p>
<pre><code>// dotnet run -c Release -f net10.0 --filter "*"

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private static readonly int[] s_array = new int[3];

    [Benchmark]
    public int Read() =&gt; s_array[2];
}</code></pre>
<p>We now get this assembly:</p>
<pre><code>; .NET 10
; Tests.Read()
       mov       rax,705D5419FA20
       mov       eax,[rax+18]
       ret
; Total bytes of code 14</code></pre>
<p>The <code>static readonly</code> field is immutable, arrays can’t be resized, and the JIT can guarantee that the field is initialized prior to generating the code for <code>Read</code>. Therefore, when generating the code for <code>Read</code>, it can know with certainty that the array is of length three, and we’re accessing the element at index two. Therefore, the specified array index is guaranteed to be within bounds, and there’s no need for a bounds check. We simply get two <code>mov</code>s, the first <code>mov</code> to load the address of the array (which, thanks to improvements in previous releases, is allocated on a heap that doesn’t need to be compacted such that the array lives at a fixed address), and the second <code>mov</code> to read the <code>int</code> value at the location of index two (these are <code>int</code>s, so index two lives <code>2 * sizeof(int) = 8</code> bytes from the start of the array’s data, which itself on 64-bit is offset 16 bytes from the start of the array reference, for a total offset of 24 bytes, or in hex 0x18, hence the <code>rax+18</code> in the disassembly).</p>
<p>Every release of .NET, more and more opportunities are found and implemented to eschew bounds checks that were previously being generated. .NET 10 continues this trend.</p>
<p>Our first example comes from <a href="https://github.com/dotnet/runtime/pull/109900">dotnet/runtime#109900</a>, which was inspired by the implementation of <code>BitOperations.Log2</code>. The operation has intrinsic hardware support on many architectures, and generally <code>BitOperations.Log2</code> will use one of the hardware intrinsics available to it for a very efficient implementation (e.g. <code>Lscnt.LeadingZeroCount</code>, <code>ArmBase.LeadingZeroCount</code>, or <code>X86Base.BitScanReverse</code>), however as a fallback implementation it uses a lookup table. The lookup table has 32 elements, and the operation involves computing a <code>uint</code> value and then shifting it down by 27 in order to get the top 5 bits. Any possible result is guaranteed to be a non-negative number less than 32, but indexing into the span with that result still produced a bounds check, and, as this is a critical path, “unsafe” code (meaning code that eschews the guardrails the runtime supplies by default) was then used to avoid the bounds check.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "value")]
public partial class Tests
{
    [Benchmark]
    [Arguments(42)]
    public int Log2SoftwareFallback2(uint value)
    {
        ReadOnlySpan&lt;byte&gt; Log2DeBruijn =
        [
            00, 09, 01, 10, 13, 21, 02, 29,
            11, 14, 16, 18, 22, 25, 03, 30,
            08, 12, 20, 28, 15, 17, 24, 07,
            19, 27, 23, 06, 26, 05, 04, 31
        ];

        value |= value &gt;&gt; 01;
        value |= value &gt;&gt; 02;
        value |= value &gt;&gt; 04;
        value |= value &gt;&gt; 08;
        value |= value &gt;&gt; 16;

        return Log2DeBruijn[(int)((value * 0x07C4ACDDu) &gt;&gt; 27)];
    }
}</code></pre>
<p>Now in .NET 10, the bounds check is gone (note the presence of the <code>call CORINFO_HELP_RNGCHKFAIL</code> in the .NET 9 assembly and the lack of it in the .NET 10 assembly).</p>
<pre><code>; .NET 9
; Tests.Log2SoftwareFallback2(UInt32)
       push      rax
       mov       eax,esi
       shr       eax,1
       or        esi,eax
       mov       eax,esi
       shr       eax,2
       or        esi,eax
       mov       eax,esi
       shr       eax,4
       or        esi,eax
       mov       eax,esi
       shr       eax,8
       or        esi,eax
       mov       eax,esi
       shr       eax,10
       or        eax,esi
       imul      eax,7C4ACDD
       shr       eax,1B
       cmp       eax,20
       jae       short M00_L00
       mov       rcx,7913CA812E10
       movzx     eax,byte ptr [rax+rcx]
       add       rsp,8
       ret
M00_L00:
       call      CORINFO_HELP_RNGCHKFAIL
       int       3
; Total bytes of code 74

; .NET 10
; Tests.Log2SoftwareFallback2(UInt32)
       mov       eax,esi
       shr       eax,1
       or        esi,eax
       mov       eax,esi
       shr       eax,2
       or        esi,eax
       mov       eax,esi
       shr       eax,4
       or        esi,eax
       mov       eax,esi
       shr       eax,8
       or        esi,eax
       mov       eax,esi
       shr       eax,10
       or        eax,esi
       imul      eax,7C4ACDD
       shr       eax,1B
       mov       rcx,7CA298325E10
       movzx     eax,byte ptr [rcx+rax]
       ret
; Total bytes of code 58</code></pre>
<p>This improvement then enabled <a href="https://github.com/dotnet/runtime/pull/118560">dotnet/runtime#118560</a> to simplify the code in the real <code>Log2SoftwareFallback</code>, avoiding manual use of unsafe constructs.</p>
<p><a href="https://github.com/dotnet/runtime/pull/113790">dotnet/runtime#113790</a> implements a similar case, where the result of a mathematical operation is guaranteed to be in bounds. In this case, it’s the result of <code>Log2</code>. The change teaches the JIT to understand the maximum possible value that <code>Log2</code> could produce, and if that maximum is in bounds, then any result is guaranteed to be in bounds as well.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "value")]
public partial class Tests
{
    [Benchmark]
    [Arguments(12345)]
    public nint CountDigits(ulong value)
    {
        ReadOnlySpan&lt;byte&gt; log2ToPow10 =
        [
            1,  1,  1,  2,  2,  2,  3,  3,  3,  4,  4,  4,  4,  5,  5,  5,
            6,  6,  6,  7,  7,  7,  7,  8,  8,  8,  9,  9,  9,  10, 10, 10,
            10, 11, 11, 11, 12, 12, 12, 13, 13, 13, 13, 14, 14, 14, 15, 15,
            15, 16, 16, 16, 16, 17, 17, 17, 18, 18, 18, 19, 19, 19, 19, 20
        ];

        return log2ToPow10[(int)ulong.Log2(value)];
    }
}</code></pre>
<p>We can see the bounds check present in the .NET 9 output and absent in the .NET 10 output:</p>
<pre><code>; .NET 9
; Tests.CountDigits(UInt64)
       push      rax
       or        rsi,1
       xor       eax,eax
       lzcnt     rax,rsi
       xor       eax,3F
       cmp       eax,40
       jae       short M00_L00
       mov       rcx,7C2D0A213DF8
       movzx     eax,byte ptr [rax+rcx]
       add       rsp,8
       ret
M00_L00:
       call      CORINFO_HELP_RNGCHKFAIL
       int       3
; Total bytes of code 45

; .NET 10
; Tests.CountDigits(UInt64)
       or        rsi,1
       xor       eax,eax
       lzcnt     rax,rsi
       xor       eax,3F
       mov       rcx,71EFA9400DF8
       movzx     eax,byte ptr [rcx+rax]
       ret
; Total bytes of code 29</code></pre>
<p>My choice of benchmark in this case was not coincidental. This pattern shows up in the <code>FormattingHelpers.CountDigits</code> internal method that’s used by the core primitive types in their <code>ToString</code> and <code>TryFormat</code> implementations, in order to determine how much space will be needed to store rendered digits for a number. As with the previous example, this routine is considered core enough that it was using unsafe code to avoid the bounds check. With this fix, the code was able to be changed back to using a simple span access, and even with the simpler code, it’s now also faster.</p>
<p>Now, consider this code:</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "ids")]
public partial class Tests
{
    public IEnumerable&lt;int[]&gt; Ids { get; } = [[1, 2, 3, 4, 5, 1]];

    [Benchmark]
    [ArgumentsSource(nameof(Ids))]
    public bool StartAndEndAreSame(int[] ids) =&gt; ids[0] == ids[^1];
}</code></pre>
<p>I have a method that’s accepting an <code>int[]</code> and checking to see whether it starts and ends with the same value. The JIT has no way of knowing whether the <code>int[]</code> is empty or not, so it <em>does</em> need a bounds check; otherwise, accessing <code>ids[0]</code> could walk off the end of the array. However, this is what we see on .NET 9:</p>
<pre><code>; .NET 9
; Tests.StartAndEndAreSame(Int32[])
       push      rax
       mov       eax,[rsi+8]
       test      eax,eax
       je        short M00_L00
       mov       ecx,[rsi+10]
       lea       edx,[rax-1]
       cmp       edx,eax
       jae       short M00_L00
       mov       eax,edx
       cmp       ecx,[rsi+rax*4+10]
       sete      al
       movzx     eax,al
       add       rsp,8
       ret
M00_L00:
       call      CORINFO_HELP_RNGCHKFAIL
       int       3
; Total bytes of code 41</code></pre>
<p>Note there are two jumps to the <code>M00_L00</code> label that handles failed bounds checks… that’s because there are two bounds checks here, one for the start access and one for the end access. But that shouldn’t be necessary. <code>ids[^1]</code> is the same as <code>ids[ids.Length - 1]</code>. If the code has successfully accessed <code>ids[0]</code>, that means the array is at least one element in length, and if it’s at least one element in length, <code>ids[ids.Length - 1]</code> will always be in bounds. Thus, the second bounds check shouldn’t be needed. Indeed, thanks to <a href="https://github.com/dotnet/runtime/pull/116105">dotnet/runtime#116105</a>, this is what we now get on .NET 10 (one branch to <code>M00_L00</code> instead of two):</p>
<pre><code>; .NET 10
; Tests.StartAndEndAreSame(Int32[])
       push      rax
       mov       eax,[rsi+8]
       test      eax,eax
       je        short M00_L00
       mov       ecx,[rsi+10]
       dec       eax
       cmp       ecx,[rsi+rax*4+10]
       sete      al
       movzx     eax,al
       add       rsp,8
       ret
M00_L00:
       call      CORINFO_HELP_RNGCHKFAIL
       int       3
; Total bytes of code 34</code></pre>
<p>What’s really interesting to me here is the knock-on effect of having removed the bounds check. It didn’t just eliminate the <code>cmp/jae</code> pair of instructions that’s typical of a bounds check. The .NET 9 version of the code had this:</p>
<pre><code>lea edx,[rax-1]
cmp edx,eax
jae short M00_L00
mov eax,edx</code></pre>
<p>At this point in the assembly, the <code>rax</code> register is storing the length of the array. It’s calculating <code>ids.Length - 1</code> and storing the result into <code>edx</code>, and then checking to see whether <code>ids.Length-1</code> is in bounds of <code>ids.Length</code> (the only way it wouldn’t be is if the array were empty such that <code>ids.Length-1</code> wrapped around to <code>uint.MaxValue</code>); if it’s not, it jumps to the fail handler, and if it is, it stores the already computed <code>ids.Length - 1</code> into <code>eax</code>. By removing the bounds check, we get rid of those two intervening instructions, leaving these:</p>
<pre><code>lea edx,[rax-1]
mov eax,edx</code></pre>
<p>which is a little silly, as this sequence is just computing a decrement, and as long as it’s ok that flags get modified, it could instead just be:</p>
<pre><code>dec eax</code></pre>
<p>which, as you can see in the .NET 10 output, is exactly what .NET 10 now does.</p>
<p><a href="https://github.com/dotnet/runtime/pull/115980">dotnet/runtime#115980</a> addresses another case. Let’s say I have this method:</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "start", "text")]
public partial class Tests
{
    [Benchmark]
    [Arguments("abc", "abc.")]
    public bool IsFollowedByPeriod(string start, string text) =&gt;
        start.Length &lt; text.Length &amp;&amp; text[start.Length] == '.';
}</code></pre>
<p>We’re validating that one input’s length is less than the other, and then checking to see what comes immediately after it in the other. We know that <code>string.Length</code> is immutable, so a bounds check here is redundant, but until .NET 10, the JIT couldn’t see that.</p>
<pre><code>; .NET 9
; Tests.IsFollowedByPeriod(System.String, System.String)
       push      rbp
       mov       rbp,rsp
       mov       eax,[rsi+8]
       mov       ecx,[rdx+8]
       cmp       eax,ecx
       jge       short M00_L00
       cmp       eax,ecx
       jae       short M00_L01
       cmp       word ptr [rdx+rax*2+0C],2E
       sete      al
       movzx     eax,al
       pop       rbp
       ret
M00_L00:
       xor       eax,eax
       pop       rbp
       ret
M00_L01:
       call      CORINFO_HELP_RNGCHKFAIL
       int       3
; Total bytes of code 42

; .NET 10
; Tests.IsFollowedByPeriod(System.String, System.String)
       mov       eax,[rsi+8]
       mov       ecx,[rdx+8]
       cmp       eax,ecx
       jge       short M00_L00
       cmp       word ptr [rdx+rax*2+0C],2E
       sete      al
       movzx     eax,al
       ret
M00_L00:
       xor       eax,eax
       ret
; Total bytes of code 26</code></pre>
<p>The removal of the bounds check almost halves the size of the function. If we don’t need to do a bounds check, we get to elide the <code>cmp/jae</code>. Without that branch, nothing is targeting <code>M00_L01</code>, and we can remove the <code>call/int</code> pair that were only necessary to support a bounds check. Then without the <code>call</code> in <code>M00_L01</code>, which was the only <code>call</code> in the whole method, the prologue and epilogue can be elided, meaning we also don’t need the opening and closing <code>push</code> and <code>pop</code> instructions.</p>
<p><a href="https://github.com/dotnet/runtime/pull/113233">dotnet/runtime#113233</a> improved handling “assertions” (facts the JIT claims and based on which the JIT makes optimizations) to be less order dependent. In .NET 9, this code:</p>
<pre><code>static bool Test(ReadOnlySpan&lt;char&gt; span, int pos) =&gt;
    pos &gt; 0 &amp;&amp;
    pos &lt;= span.Length - 42 &amp;&amp;
    span[pos - 1] != '\n';</code></pre>
<p>was successfully removing the bounds check on the span access, but the following variant, which just switches the order of the first two conditions, was still incurring the bounds check.</p>
<pre><code>static bool Test(ReadOnlySpan&lt;char&gt; span, int pos) =&gt;
    pos &lt;= span.Length - 42 &amp;&amp;
    pos &gt; 0 &amp;&amp;
    span[pos - 1] != '\n';</code></pre>
<p>Note that both conditions contribute an assertion (fact) that need to be merged in order to know the bounds check can be avoided. Now in .NET 10, the bounds check is elided, regardless of the order.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private string _s = new string('s', 100);
    private int _pos = 10;

    [Benchmark]
    public bool Test()
    {
        string s = _s;
        int pos = _pos;
        return
            pos &lt;= s.Length - 42 &amp;&amp;
            pos &gt; 0 &amp;&amp;
            s[pos - 1] != '\n';
    }
}</code></pre>
<pre><code>; .NET 9
; Tests.Test()
       push      rbp
       mov       rbp,rsp
       mov       rax,[rdi+8]
       mov       ecx,[rdi+10]
       mov       edx,[rax+8]
       lea       edi,[rdx-2A]
       cmp       edi,ecx
       jl        short M00_L00
       test      ecx,ecx
       jle       short M00_L00
       dec       ecx
       cmp       ecx,edx
       jae       short M00_L01
       cmp       word ptr [rax+rcx*2+0C],0A
       setne     al
       movzx     eax,al
       pop       rbp
       ret
M00_L00:
       xor       eax,eax
       pop       rbp
       ret
M00_L01:
       call      CORINFO_HELP_RNGCHKFAIL
       int       3
; Total bytes of code 55

; .NET 10
; Tests.Test()
       push      rbp
       mov       rbp,rsp
       mov       rax,[rdi+8]
       mov       ecx,[rdi+10]
       mov       edx,[rax+8]
       add       edx,0FFFFFFD6
       cmp       edx,ecx
       jl        short M00_L00
       test      ecx,ecx
       jle       short M00_L00
       dec       ecx
       cmp       word ptr [rax+rcx*2+0C],0A
       setne     al
       movzx     eax,al
       pop       rbp
       ret
M00_L00:
       xor       eax,eax
       pop       rbp
       ret
; Total bytes of code 45</code></pre>
<p><a href="https://github.com/dotnet/runtime/pull/113862">dotnet/runtime#113862</a> addresses a similar case where assertions weren’t being handled as precisely as they could have been. Consider this code:</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private int[] _arr = Enumerable.Range(0, 10).ToArray();

    [Benchmark]
    public int Sum()
    {
        int[] arr = _arr;
        int sum = 0;

        int i;
        for (i = 0; i &lt; arr.Length - 3; i += 4)
        {
            sum += arr[i + 0];
            sum += arr[i + 1];
            sum += arr[i + 2];
            sum += arr[i + 3];
        }

        for (; i &lt; arr.Length; i++)
        {
            sum += arr[i];
        }

        return sum;
    }
}</code></pre>
<p>The <code>Sum</code> method is trying to do manual loop unrolling. Rather than incurring a branch on each element, it’s handling four elements per iteration. Then, for the case where the length of the input isn’t evenly divisible by four, it’s handling the remaining elements in a separate loop. In .NET 9, the JIT successfully elides the bounds checks in the main unrolled loop:</p>
<pre><code>; .NET 9
; Tests.Sum()
       push      rbp
       mov       rbp,rsp
       mov       rax,[rdi+8]
       xor       ecx,ecx
       xor       edx,edx
       mov       edi,[rax+8]
       lea       esi,[rdi-3]
       test      esi,esi
       jle       short M00_L02
M00_L00:
       mov       r8d,edx
       add       ecx,[rax+r8*4+10]
       lea       r8d,[rdx+1]
       add       ecx,[rax+r8*4+10]
       lea       r8d,[rdx+2]
       add       ecx,[rax+r8*4+10]
       lea       r8d,[rdx+3]
       add       ecx,[rax+r8*4+10]
       add       edx,4
       cmp       esi,edx
       jg        short M00_L00
       jmp       short M00_L02
M00_L01:
       cmp       edx,edi
       jae       short M00_L03
       mov       esi,edx
       add       ecx,[rax+rsi*4+10]
       inc       edx
M00_L02:
       cmp       edi,edx
       jg        short M00_L01
       mov       eax,ecx
       pop       rbp
       ret
M00_L03:
       call      CORINFO_HELP_RNGCHKFAIL
       int       3
; Total bytes of code 92</code></pre>
<p>You can see this in the <code>M00_L00</code> section, which has the five <code>add</code> instructions (four for the summed elements, and one for the index). However, we still see the <code>CORINFO_HELP_RNGCHKFAIL</code> at the end, indicating this method has a bounds check. That’s coming from the final loop, due to the JIT losing track of the fact that <code>i</code> is guaranteed to be non-negative. Now in .NET 10, that bounds check is removed as well (again, just look for the lack of the <code>CORINFO_HELP_RNGCHKFAIL</code> call).</p>
<pre><code>; .NET 10
; Tests.Sum()
       push      rbp
       mov       rbp,rsp
       mov       rax,[rdi+8]
       xor       ecx,ecx
       xor       edx,edx
       mov       edi,[rax+8]
       lea       esi,[rdi-3]
       test      esi,esi
       jle       short M00_L01
M00_L00:
       mov       r8d,edx
       add       ecx,[rax+r8*4+10]
       lea       r8d,[rdx+1]
       add       ecx,[rax+r8*4+10]
       lea       r8d,[rdx+2]
       add       ecx,[rax+r8*4+10]
       lea       r8d,[rdx+3]
       add       ecx,[rax+r8*4+10]
       add       edx,4
       cmp       esi,edx
       jg        short M00_L00
M00_L01:
       cmp       edi,edx
       jle       short M00_L03
       test      edx,edx
       jl        short M00_L04
M00_L02:
       mov       esi,edx
       add       ecx,[rax+rsi*4+10]
       inc       edx
       cmp       edi,edx
       jg        short M00_L02
M00_L03:
       mov       eax,ecx
       pop       rbp
       ret
M00_L04:
       mov       esi,edx
       add       ecx,[rax+rsi*4+10]
       inc       edx
       cmp       edi,edx
       jg        short M00_L04
       jmp       short M00_L03
; Total bytes of code 102</code></pre>
<p>Another nice improvement comes from <a href="https://github.com/dotnet/runtime/pull/112824">dotnet/runtime#112824</a>, which teaches the JIT to turn facts it already learned from earlier checks into concrete numeric ranges, and then use those ranges to fold away later relational tests and bounds checks. Consider this example:</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Runtime.CompilerServices;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private int[] _array = new int[10];

    [Benchmark]
    public void Test() =&gt; SetAndSlice(_array);

    [MethodImpl(MethodImplOptions.NoInlining)]
    private static Span&lt;int&gt; SetAndSlice(Span&lt;int&gt; src)
    {
        src[5] = 42;
        return src.Slice(4);
    }
}</code></pre>
<p>We have to incur a bounds check for the <code>src[5]</code>, as the JIT has no evidence that <code>src</code> is at least six elements long. However, by the time we get to the <code>Slice</code> call, we know the span has a length of at least six, or else writing into <code>src[5]</code> would have failed. We can use that knowledge to remove the length check from within the <code>Slice</code> call (note the removal of the <code>call qword ptr [7F8DDB3A7810]</code>/<code>int 3</code> sequence, which is the manual length check and call to a throw helper method in <code>Slice</code>).</p>
<pre><code>; .NET 9
; Tests.SetAndSlice(System.Span`1&lt;Int32&gt;)
       push      rbp
       mov       rbp,rsp
       cmp       esi,5
       jbe       short M01_L01
       mov       dword ptr [rdi+14],2A
       cmp       esi,4
       jb        short M01_L00
       add       rdi,10
       mov       rax,rdi
       add       esi,0FFFFFFFC
       mov       edx,esi
       pop       rbp
       ret
M01_L00:
       call      qword ptr [7F8DDB3A7810]
       int       3
M01_L01:
       call      CORINFO_HELP_RNGCHKFAIL
       int       3
; Total bytes of code 48

; .NET 10
; Tests.SetAndSlice(System.Span`1&lt;Int32&gt;)
       push      rax
       cmp       esi,5
       jbe       short M01_L00
       mov       dword ptr [rdi+14],2A
       lea       rax,[rdi+10]
       lea       edx,[rsi-4]
       add       rsp,8
       ret
M01_L00:
       call      CORINFO_HELP_RNGCHKFAIL
       int       3
; Total bytes of code 31</code></pre>
<p>Let’s look at one more, which has a very nice impact on bounds checking, even though technically the optimization is broader than just that. <a href="https://github.com/dotnet/runtime/pull/113998">dotnet/runtime#113998</a> creates assertions from <code>switch</code> targets. This means that the body of a <code>switch</code> case statement inherits facts about what was switched over based on what the <code>case</code> was, e.g. in a <code>case 3</code> for <code>switch (x)</code>, the body of that case will now “know” that <code>x</code> is three. This is great for very popular patterns with arrays, strings, and spans, where developers switch over the length and then index into available indices in the appropriate branches. Consider this:</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Runtime.CompilerServices;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private int[] _array = [1, 2];

    [Benchmark]
    public int SumArray() =&gt; Sum(_array);

    [MethodImpl(MethodImplOptions.NoInlining)]
    public int Sum(ReadOnlySpan&lt;int&gt; span)
    {
        switch (span.Length)
        {
            case 0: return 0;
            case 1: return span[0];
            case 2: return span[0] + span[1];
            case 3: return span[0] + span[1] + span[2];
            default: return -1;
        }
    }
}</code></pre>
<p>On .NET 9, each of those six <code>span</code> dereferences ends up with a bounds check:</p>
<pre><code>; .NET 9
; Tests.Sum(System.ReadOnlySpan`1&lt;Int32&gt;)
       push      rbp
       mov       rbp,rsp
M01_L00:
       cmp       edx,2
       jne       short M01_L02
       test      edx,edx
       je        short M01_L04
       mov       eax,[rsi]
       cmp       edx,1
       jbe       short M01_L04
       add       eax,[rsi+4]
M01_L01:
       pop       rbp
       ret
M01_L02:
       cmp       edx,3
       ja        short M01_L03
       mov       eax,edx
       lea       rcx,[783DA42091B8]
       mov       ecx,[rcx+rax*4]
       lea       rdi,[M01_L00]
       add       rcx,rdi
       jmp       rcx
M01_L03:
       mov       eax,0FFFFFFFF
       pop       rbp
       ret
       test      edx,edx
       je        short M01_L04
       mov       eax,[rsi]
       cmp       edx,1
       jbe       short M01_L04
       add       eax,[rsi+4]
       cmp       edx,2
       jbe       short M01_L04
       add       eax,[rsi+8]
       jmp       short M01_L01
       test      edx,edx
       je        short M01_L04
       mov       eax,[rsi]
       jmp       short M01_L01
       xor       eax,eax
       pop       rbp
       ret
M01_L04:
       call      CORINFO_HELP_RNGCHKFAIL
       int       3
; Total bytes of code 103</code></pre>
<p>You can see the tell-tale bounds check sign (<code>CORINFO_HELP_RNGCHKFAIL</code>) under <code>M01_L04</code>, and no fewer than six jumps targeting that label, one for each <code>span[...]</code> access. But on .NET 10, we get this:</p>
<pre><code>; .NET 10
; Tests.Sum(System.ReadOnlySpan`1&lt;Int32&gt;)
       push      rbp
       mov       rbp,rsp
M01_L00:
       cmp       edx,2
       jne       short M01_L02
       mov       eax,[rsi]
       add       eax,[rsi+4]
M01_L01:
       pop       rbp
       ret
M01_L02:
       cmp       edx,3
       ja        short M01_L03
       mov       eax,edx
       lea       rcx,[72C15C0F8FD8]
       mov       ecx,[rcx+rax*4]
       lea       rdx,[M01_L00]
       add       rcx,rdx
       jmp       rcx
M01_L03:
       mov       eax,0FFFFFFFF
       pop       rbp
       ret
       xor       eax,eax
       pop       rbp
       ret
       mov       eax,[rsi]
       jmp       short M01_L01
       mov       eax,[rsi]
       add       eax,[rsi+4]
       add       eax,[rsi+8]
       jmp       short M01_L01
; Total bytes of code 70</code></pre>
<p>The <code>CORINFO_HELP_RNGCHKFAIL</code> and all the jumps to it have evaporated.</p>
<h3>Cloning</h3>
<p>There are other ways the JIT can remove bounds checking even when it can’t prove statically that every individual access is safe. Consider this method:</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private int[] _arr = new int[16];

    [Benchmark]
    public void Test()
    {
        int[] arr = _arr;
        arr[0] = 2;
        arr[1] = 3;
        arr[2] = 5;
        arr[3] = 8;
        arr[4] = 13;
        arr[5] = 21;
        arr[6] = 34;
        arr[7] = 55;
    }
}</code></pre>
<p>Here’s the assembly code generated on .NET 9:</p>
<pre><code>; .NET 9
; Tests.Test()
       push      rax
       mov       rax,[rdi+8]
       mov       ecx,[rax+8]
       test      ecx,ecx
       je        short M00_L00
       mov       dword ptr [rax+10],2
       cmp       ecx,1
       jbe       short M00_L00
       mov       dword ptr [rax+14],3
       cmp       ecx,2
       jbe       short M00_L00
       mov       dword ptr [rax+18],5
       cmp       ecx,3
       jbe       short M00_L00
       mov       dword ptr [rax+1C],8
       cmp       ecx,4
       jbe       short M00_L00
       mov       dword ptr [rax+20],0D
       cmp       ecx,5
       jbe       short M00_L00
       mov       dword ptr [rax+24],15
       cmp       ecx,6
       jbe       short M00_L00
       mov       dword ptr [rax+28],22
       cmp       ecx,7
       jbe       short M00_L00
       mov       dword ptr [rax+2C],37
       add       rsp,8
       ret
M00_L00:
       call      CORINFO_HELP_RNGCHKFAIL
       int       3
; Total bytes of code 114</code></pre>
<p>Even if you’re not proficient at reading assembly, the pattern should still be obvious. In the C# code, we have eight writes into the array, and in the assembly code, we have eight repetitions of the same pattern: <code>cmp ecx,LENGTH</code> to compare the length of the array against the required <code>LENGTH</code>, <code>jbe short M00_L00</code> to jump to the <code>CORINFO_HELP_RNGCHKFAIL</code> helper if the bounds check fails, and <code>mov dword ptr [rax+OFFSET],VALUE</code> to store <code>VALUE</code> into the array at byte offset <code>OFFSET</code>. Inside the <code>Test</code> method, the JIT can’t know how long <code>_arr</code> is, so it must include bounds checks. Moreover, it must include all of the bounds checks, rather than coalescing them, because it is forbidden from introducing behavioral changes as part of optimizations. Imagine instead if it chose to coalesce all of the bounds checks into a single check, and emitted this method as if it were the equivalent of the following:</p>
<pre><code>if (arr.Length &gt;= 8)
{
    arr[0] = 2;
    arr[1] = 3;
    arr[2] = 5;
    arr[3] = 8;
    arr[4] = 13;
    arr[5] = 21;
    arr[6] = 34;
    arr[7] = 55;
}
else
{
    throw new IndexOutOfRangeException();
}</code></pre>
<p>Now, let’s say the array was actually of length four. The original program would have filled the array with values <code>[2, 3, 5, 8]</code> before throwing an exception, but this transformed code wouldn’t (there wouldn’t be any writes to the array). That’s an observable behavioral change. An enterprising developer could of course <em>choose</em> to rewrite their code to avoid some of these checks, e.g.</p>
<pre><code>arr[7] = 55;
arr[0] = 2;
arr[1] = 3;
arr[2] = 5;
arr[3] = 8;
arr[4] = 13;
arr[5] = 21;
arr[6] = 34;</code></pre>
<p>By moving the last store to the beginning, the developer has given the JIT extra knowledge. The JIT can now see that <em>if</em> the first store succeeds, the rest are guaranteed to succeed as well, and the JIT will emit a single bounds check. But, again, that’s the developer choosing to change their program in a way the JIT must not. However, there are other things the JIT <em>can</em> do. Imagine the JIT chose to rewrite the method like this instead:</p>
<pre><code>if (arr.Length &gt;= 8)
{
    arr[0] = 2;
    arr[1] = 3;
    arr[2] = 5;
    arr[3] = 8;
    arr[4] = 13;
    arr[5] = 21;
    arr[6] = 34;
    arr[7] = 55;
}
else
{
    arr[0] = 2;
    arr[1] = 3;
    arr[2] = 5;
    arr[3] = 8;
    arr[4] = 13;
    arr[5] = 21;
    arr[6] = 34;
    arr[7] = 55;
}</code></pre>
<p>To our C# sensibilities, that looks unnecessarily complicated; the <code>if</code> and the <code>else</code> block contain <em>exactly</em> the same C# code. But, knowing what we now know about how the JIT can use known length information to elide bounds checks, it starts to make a bit more sense. Here’s what the JIT emits for this variant on .NET 9:</p>
<pre><code>; .NET 9
; Tests.Test()
       push      rbp
       mov       rbp,rsp
       mov       rax,[rdi+8]
       mov       ecx,[rax+8]
       cmp       ecx,8
       jl        short M00_L00
       mov       rcx,300000002
       mov       [rax+10],rcx
       mov       rcx,800000005
       mov       [rax+18],rcx
       mov       rcx,150000000D
       mov       [rax+20],rcx
       mov       rcx,3700000022
       mov       [rax+28],rcx
       pop       rbp
       ret
M00_L00:
       test      ecx,ecx
       je        short M00_L01
       mov       dword ptr [rax+10],2
       cmp       ecx,1
       jbe       short M00_L01
       mov       dword ptr [rax+14],3
       cmp       ecx,2
       jbe       short M00_L01
       mov       dword ptr [rax+18],5
       cmp       ecx,3
       jbe       short M00_L01
       mov       dword ptr [rax+1C],8
       cmp       ecx,4
       jbe       short M00_L01
       mov       dword ptr [rax+20],0D
       cmp       ecx,5
       jbe       short M00_L01
       mov       dword ptr [rax+24],15
       cmp       ecx,6
       jbe       short M00_L01
       mov       dword ptr [rax+28],22
       cmp       ecx,7
       jbe       short M00_L01
       mov       dword ptr [rax+2C],37
       pop       rbp
       ret
M00_L01:
       call      CORINFO_HELP_RNGCHKFAIL
       int       3
; Total bytes of code 177</code></pre>
<p>The <code>else</code> block is compiled to the <code>M00_L00</code> label, which contains those same eight repeated blocks we saw earlier. But the <code>if</code> block (above the <code>M00_L00</code> label) is interesting. The only branch there is the initial <code>array.Length &gt;= 8</code> check I wrote in the C# code, emitted as the <code>cmp ecx,8</code>/<code>jl short M00_L00</code> pair of instructions. The rest of the block is just <code>mov</code> instructions (and you can see there are only four writes into the array rather than eight… the JIT has optimized the eight four-byte writes into four eight-byte writes). In our rewrite, we’ve manually cloned the code, so that in what we expect to be the vast, vast, vast majority case (presumably we wouldn’t have written the array writes in the first place if we thought they’d fail), we only incur the single length check, and then we have our “hopefully this is never needed” fallback case for the rare situation where it is. Of course, you shouldn’t (and shouldn’t need to) do such manual cloning. But, the JIT can do such cloning for you, and does.</p>
<p>“Cloning” is an optimization long employed by the JIT, where it will do this kind of code duplication, typically of loops, when it believes that in doing so, it can heavily optimize a common case. Now in .NET 10, thanks to <a href="https://github.com/dotnet/runtime/pull/112595">dotnet/runtime#112595</a>, it can employ this same technique for these kinds of sequences of writes. Going back to our original benchmark, here’s what we now get on .NET 10:</p>
<pre><code>; .NET 10
; Tests.Test()
       push      rbp
       mov       rbp,rsp
       mov       rax,[rdi+8]
       mov       ecx,[rax+8]
       mov       edx,ecx
       cmp       edx,7
       jle       short M00_L01
       mov       rdx,300000002
       mov       [rax+10],rdx
       mov       rcx,800000005
       mov       [rax+18],rcx
       mov       rcx,150000000D
       mov       [rax+20],rcx
       mov       rcx,3700000022
       mov       [rax+28],rcx
M00_L00:
       pop       rbp
       ret
M00_L01:
       test      edx,edx
       je        short M00_L02
       mov       dword ptr [rax+10],2
       cmp       ecx,1
       jbe       short M00_L02
       mov       dword ptr [rax+14],3
       cmp       ecx,2
       jbe       short M00_L02
       mov       dword ptr [rax+18],5
       cmp       ecx,3
       jbe       short M00_L02
       mov       dword ptr [rax+1C],8
       cmp       ecx,4
       jbe       short M00_L02
       mov       dword ptr [rax+20],0D
       cmp       ecx,5
       jbe       short M00_L02
       mov       dword ptr [rax+24],15
       cmp       ecx,6
       jbe       short M00_L02
       mov       dword ptr [rax+28],22
       cmp       ecx,7
       jbe       short M00_L02
       mov       dword ptr [rax+2C],37
       jmp       short M00_L00
M00_L02:
       call      CORINFO_HELP_RNGCHKFAIL
       int       3
; Total bytes of code 179</code></pre>
<p>This structure looks almost identical to what we got when we manually cloned: the JIT has emitted the same code twice, except in one case, there are no bounds checks, and in the other case, there are all the bounds checks, and a single length check determines which path to follow. Pretty neat.</p>
<p>As noted, the JIT has been doing cloning for years, in particular for loops over arrays. However, more and more code is being written against spans instead of arrays, and unfortunately this valuable optimization didn’t apply to spans. Now with <a href="https://github.com/dotnet/runtime/pull/113575">dotnet/runtime#113575</a>, it does! We can see this with a basic looping example:</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private int[] _arr = new int[16];
    private int _count = 8;

    [Benchmark]
    public void WithSpan()
    {
        Span&lt;int&gt; span = _arr;
        int count = _count;

        for (int i = 0; i &lt; count; i++)
        {
            span[i] = i;
        }
    }

    [Benchmark]
    public void WithArray()
    {
        int[] arr = _arr;
        int count = _count;

        for (int i = 0; i &lt; count; i++)
        {
            arr[i] = i;
        }
    }
}</code></pre>
<p>In both <code>WithArray</code> and <code>WithSpan</code>, we have the same loop, iterating from 0 to a <code>_count</code> with an unknown relationship to the length of <code>_arr</code>, so there has to be some kind of bounds checking emitted. Here’s what we get on .NET 9 for <code>WithSpan</code>:</p>
<pre><code>; .NET 9
; Tests.WithSpan()
       push      rbp
       mov       rbp,rsp
       mov       rax,[rdi+8]
       test      rax,rax
       je        short M00_L03
       lea       rcx,[rax+10]
       mov       eax,[rax+8]
M00_L00:
       mov       edi,[rdi+10]
       xor       edx,edx
       test      edi,edi
       jle       short M00_L02
       nop       dword ptr [rax]
M00_L01:
       cmp       edx,eax
       jae       short M00_L04
       mov       [rcx+rdx*4],edx
       inc       edx
       cmp       edx,edi
       jl        short M00_L01
M00_L02:
       pop       rbp
       ret
M00_L03:
       xor       ecx,ecx
       xor       eax,eax
       jmp       short M00_L00
M00_L04:
       call      CORINFO_HELP_RNGCHKFAIL
       int       3
; Total bytes of code 59</code></pre>
<p>There’s some upfront assembly here associated with loading <code>_array</code> into a span, loading <code>_count</code>, and checking to see whether the count is 0 (in which case the whole loop can be skipped). Then the core of the loop is at <code>M00_L01</code>, which is repeatedly checking <code>edx</code> (which contains <code>i</code>) against the length of the span (in <code>eax</code>), jumping to <code>CORINFO_HELP_RNGCHKFAIL</code> if it’s an out-of-bounds access, writing <code>edx</code> (<code>i</code>) into the span at the next position, bumping up <code>i</code>, and then jumping back to <code>M00_L01</code> to keep iterating if <code>i</code> is still less than <code>count</code> (stored in <code>edi</code>). In other words, we have two checks per iteration: is <code>i</code> still within the bounds of the span, and is <code>i</code> still less than <code>count</code>. Now here’s what we get on .NET 9 for <code>WithArray</code>:</p>
<pre><code>; .NET 9
; Tests.WithArray()
       push      rbp
       mov       rbp,rsp
       mov       rax,[rdi+8]
       mov       ecx,[rdi+10]
       xor       edx,edx
       test      ecx,ecx
       jle       short M00_L01
       test      rax,rax
       je        short M00_L02
       cmp       [rax+8],ecx
       jl        short M00_L02
       nop       dword ptr [rax+rax]
M00_L00:
       mov       edi,edx
       mov       [rax+rdi*4+10],edx
       inc       edx
       cmp       edx,ecx
       jl        short M00_L00
M00_L01:
       pop       rbp
       ret
M00_L02:
       cmp       edx,[rax+8]
       jae       short M00_L03
       mov       edi,edx
       mov       [rax+rdi*4+10],edx
       inc       edx
       cmp       edx,ecx
       jl        short M00_L02
       jmp       short M00_L01
M00_L03:
       call      CORINFO_HELP_RNGCHKFAIL
       int       3
; Total bytes of code 71</code></pre>
<p>Here, label <code>M00_L02</code> looks very similar to the loop we just saw in <code>WithSpan</code>, incurring both the check against <code>count</code> and the bounds check on every iteration. But note section <code>M00_L00</code>: it’s a clone of the same loop, still with the <code>cmp edx,ecx</code> that checks <code>i</code> against <code>count</code> on each iteration, but no additional bounds checking in sight. The JIT has cloned the loop, specializing one to not have bounds checks, and then in the upfront section, it determines which path to follow based on a single check against the array’s length (<code>cmp [rax+8],ecx</code>/<code>jl short M00_L02</code>). Now in .NET 10, here’s what we get for <code>WithSpan</code>:</p>
<pre><code>; .NET 10
; Tests.WithSpan()
       push      rbp
       mov       rbp,rsp
       mov       rax,[rdi+8]
       test      rax,rax
       je        short M00_L04
       lea       rcx,[rax+10]
       mov       eax,[rax+8]
M00_L00:
       mov       edx,[rdi+10]
       xor       edi,edi
       test      edx,edx
       jle       short M00_L02
       cmp       edx,eax
       jg        short M00_L03
M00_L01:
       mov       eax,edi
       mov       [rcx+rax*4],edi
       inc       edi
       cmp       edi,edx
       jl        short M00_L01
M00_L02:
       pop       rbp
       ret
M00_L03:
       cmp       edi,eax
       jae       short M00_L05
       mov       esi,edi
       mov       [rcx+rsi*4],edi
       inc       edi
       cmp       edi,edx
       jl        short M00_L03
       jmp       short M00_L02
M00_L04:
       xor       ecx,ecx
       xor       eax,eax
       jmp       short M00_L00
M00_L05:
       call      CORINFO_HELP_RNGCHKFAIL
       int       3
; Total bytes of code 75</code></pre>
<p>As with <code>WithArray</code> in .NET 9, <code>WithSpan</code> for .NET 10 has the loop cloned, with the <code>M00_L03</code> block containing the bounds check on each iteration, and the <code>M00_L01</code> block eliding the bounds check on each iteration.</p>
<p>The JIT gains more cloning abilities in .NET 10, as well. <a href="https://github.com/dotnet/runtime/pull/110020">dotnet/runtime#110020</a>, <a href="https://github.com/dotnet/runtime/pull/108604">dotnet/runtime#108604</a>, and <a href="https://github.com/dotnet/runtime/pull/110483">dotnet/runtime#110483</a> make it possible for the JIT to clone <code>try/finally</code> blocks, whereas previously it would immediately bail out of cloning any regions containing such constructs. This might seem niche, but it’s actually quite valuable when you consider that <code>foreach</code>‘ing over an enumerable typically involves a hidden <code>try</code>/<code>finally</code> for the <code>finally</code> to call the enumerator’s <code>Dispose</code>.</p>
<p>Many of these different optimizations interact with each other. Dynamic PGO triggers a form of cloning, as part of the guarded devirtualization (GDV) mentioned earlier: if the instrumentation data reveals that a particular virtual call is generally performed on an instance of a specific type, the JIT can clone the resulting code into one path specific to that type and another path that handles any type. That then enables the specific-type code path to devirtualize the call and possibly inline it. And if it inlines it, that then provides more opportunities for the JIT to see that an object doesn’t escape, and potentially stack allocate it.
<a href="https://github.com/dotnet/runtime/pull/111473">dotnet/runtime#111473</a>,
<a href="https://github.com/dotnet/runtime/pull/116978">dotnet/runtime#116978</a>, <a href="https://github.com/dotnet/runtime/pull/116992">dotnet/runtime#116992</a>,
<a href="https://github.com/dotnet/runtime/pull/117222">dotnet/runtime#117222</a>, and <a href="https://github.com/dotnet/runtime/pull/117295">dotnet/runtime#117295</a> enable that, enhancing escape analysis to determine if an object only escapes when such a generated type test fails (when the target object isn’t of the expected common type).</p>
<p>I want to pause for a moment, because my words thus far aren’t nearly enthusiastic enough to highlight the magnitude of what this enables. The <code>dotnet/runtime</code> repo uses an automated performance analysis system which flags when benchmarks significantly improve or regress and ties those changes back to the responsible PR. This is what it looked like for this PR:
<img decoding="async" src="https://devblogs.microsoft.com/dotnet/wp-content/uploads/sites/10/2025/09/ConditionalEscapeAnalysisImprovements.png" alt="Conditional Escape Analysis Triggering Many Benchmark Improvements">
We can see why this is so good from a simple example:</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Runtime.CompilerServices;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private int[] _values = Enumerable.Range(1, 100).ToArray();

    [Benchmark]
    public int Sum() =&gt; Sum(_values);

    [MethodImpl(MethodImplOptions.NoInlining)]
    private static int Sum(IEnumerable&lt;int&gt; values)
    {
        int sum = 0;
        foreach (int value in values)
        {
            sum += value;
        }
        return sum;
    }
}</code></pre>
<p>With dynamic PGO, the instrumented code for <code>Sum</code> will see that <code>values</code> is generally an <code>int[]</code>, and it’ll be able to emit a specialized code path in the optimized <code>Sum</code> implementation for when it is. And then with this ability to do conditional escape analysis, for the common path the JIT can see that the resulting <code>GetEnumerator</code> produces an <code>IEnumerator&lt;int&gt;</code> that never escapes, such that along with all of the relevant methods being devirtualized and inlined, the enumerator can be stack allocated.</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sum</td>
<td>.NET 9.0</td>
<td>109.86 ns</td>
<td>1.00</td>
<td>32 B</td>
<td>1.00</td>
</tr>
<tr>
<td>Sum</td>
<td>.NET 10.0</td>
<td>35.45 ns</td>
<td>0.32</td>
<td>–</td>
<td>0.00</td>
</tr>
</tbody>
</table>
<p>Just think about how many places in your apps and services you enumerate collections like this, and you can see why it’s such an exciting improvement. Note that these cases don’t always even require PGO. Consider a case like this:</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private static readonly IEnumerable&lt;int&gt; s_values = new int[] { 1, 2, 3, 4, 5 };

    [Benchmark]
    public int Sum()
    {
        int sum = 0;
        foreach (int value in s_values)
        {
            sum += value;
        }
        return sum;
    }
}</code></pre>
<p>Here, the JIT can see that even though the <code>s_values</code> is typed as <code>IEnumerable&lt;int&gt;</code>, it’s always actually an <code>int[]</code>. In that case, <a href="https://github.com/dotnet/runtime/pull/111948">dotnet/runtime#111948</a> enables the return type to be retyped in the JIT as <code>int[]</code> and the enumerator can be stack allocated.</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sum</td>
<td>.NET 9.0</td>
<td>16.341 ns</td>
<td>1.00</td>
<td>32 B</td>
<td>1.00</td>
</tr>
<tr>
<td>Sum</td>
<td>.NET 10.0</td>
<td>2.059 ns</td>
<td>0.13</td>
<td>–</td>
<td>0.00</td>
</tr>
</tbody>
</table>
<p>Of course, too much cloning can be a bad thing, in particular as it increases code size. <a href="https://github.com/dotnet/runtime/pull/108771">dotnet/runtime#108771</a> employs a heuristic to determine whether loops that <em>can</em> be cloned <em>should</em> be cloned; the larger the loop, the less likely it’ll be to be cloned.</p>
<h3>Inlining</h3>
<p>“Inlining”, which replaces a call to a function with a copy of that function’s implementation, has always been a critically important optimization. It’s easy to think about the benefits of inlining as just being about avoiding the overhead of a call, and while that can be meaningful (especially when considering security mechanisms like Intel’s Control-Flow Enforcement Technology, which slightly increases the cost of calls), generally the most benefit from inlining comes from knock-on benefits. Just as a simple example, if you have code like:</p>
<pre><code>int i = Divide(10, 5);

static int Divide(int n, int d) =&gt; n / d;</code></pre>
<p>if <code>Divide</code> doesn’t get inlined, then when <code>Divide</code> is called, it’ll need to perform the actual <code>idiv</code>, which is a relatively expensive operation. In contrast, if <code>Divide</code> is inlined, then the call site becomes:</p>
<pre><code>int i = 10 / 5;</code></pre>
<p>which can be evaluated at compile time and becomes just:</p>
<pre><code>int i = 2;</code></pre>
<p>More compelling examples were already seen throughout the discussion of escape analysis and stack allocation, which depend heavily on the ability to inline methods. Given the increased importance of inlining, it’s gotten even more focus in .NET 10.</p>
<p>Some of the .NET work related to inlining is about enabling more kinds of things to be inlined. Historically, a variety of constructs present in a method would prevent that method from even being considered for inlining. Arguably the most well known of these is exception handling: methods with exception handling clauses, e.g. <code>try/catch</code> or <code>try/finally</code>, would not be inlined. Even a simple method like <code>M</code> in this example:</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private readonly object _o = new();

    [Benchmark]
    public int Test()
    {
        M(_o);
        return 42;
    }

    private static void M(object o)
    {
        Monitor.Enter(o);
        try
        {
        }
        finally
        {
            Monitor.Exit(o);
        }
    }
}</code></pre>
<p>does not get inlined on .NET 9:</p>
<pre><code>; .NET 9
; Tests.Test()
       push      rax
       mov       rdi,[rdi+8]
       call      qword ptr [78F199864EE8]; Tests.M(System.Object)
       mov       eax,2A
       add       rsp,8
       ret
; Total bytes of code 21</code></pre>
<p>But with a plethora of PRs, in particular <a href="https://github.com/dotnet/runtime/pull/112968">dotnet/runtime#112968</a>, <a href="https://github.com/dotnet/runtime/pull/113023">dotnet/runtime#113023</a>, <a href="https://github.com/dotnet/runtime/pull/113497">dotnet/runtime#113497</a>, and <a href="https://github.com/dotnet/runtime/pull/112998">dotnet/runtime#112998</a>, methods containing <code>try/finally</code> are no longer blocked from inlining (<code>try/catch</code> regions are still a challenge). For the same benchmark on .NET 10, we now get this assembly:</p>
<pre><code>; .NET 10
; Tests.Test()
       push      rbp
       push      rbx
       push      rax
       lea       rbp,[rsp+10]
       mov       rbx,[rdi+8]
       test      rbx,rbx
       je        short M00_L03
       mov       rdi,rbx
       call      00007920A0EE65E0
       test      eax,eax
       je        short M00_L02
M00_L00:
       mov       rdi,rbx
       call      00007920A0EE6D50
       test      eax,eax
       jne       short M00_L04
M00_L01:
       mov       eax,2A
       add       rsp,8
       pop       rbx
       pop       rbp
       ret
M00_L02:
       mov       rdi,rbx
       call      qword ptr [79202393C1F8]
       jmp       short M00_L00
M00_L03:
       xor       edi,edi
       call      qword ptr [79202393C1C8]
       int       3
M00_L04:
       mov       edi,eax
       mov       rsi,rbx
       call      qword ptr [79202393C1E0]
       jmp       short M00_L01
; Total bytes of code 86</code></pre>
<p>The details of the assembly don’t matter, other than it’s a whole lot more than was there before, because we’re now looking in large part at the implementation of <code>M</code>. In addition to methods with <code>try/finally</code> now being inlineable, other improvements have also been made around exception handling. For example, <a href="https://github.com/dotnet/runtime/pull/110273">dotnet/runtime#110273</a> and <a href="https://github.com/dotnet/runtime/pull/110464">dotnet/runtime#110464</a> enable the removal of <code>try/catch</code> and <code>try/fault</code> blocks if it can prove the <code>try</code> block can’t possibly throw. Consider this:</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "i")]
public partial class Tests
{
    [Benchmark]
    [Arguments(42)]
    public int Test(int i)
    {
        try
        {
            i++;
        }
        catch
        {
            Console.WriteLine("Exception caught");
        }

        return i;
    }
}</code></pre>
<p>There’s nothing the <code>try</code> block here can do that will result in an exception being thrown (assuming the developer hasn’t enabled checked arithmetic, in which case it could possibly throw an <code>OverflowException</code>), yet on .NET 9 we get this assembly:</p>
<pre><code>; .NET 9
; Tests.Test(Int32)
       push      rbp
       sub       rsp,10
       lea       rbp,[rsp+10]
       mov       [rbp-10],rsp
       mov       [rbp-4],esi
       mov       eax,[rbp-4]
       inc       eax
       mov       [rbp-4],eax
M00_L00:
       mov       eax,[rbp-4]
       add       rsp,10
       pop       rbp
       ret
       push      rbp
       sub       rsp,10
       mov       rbp,[rdi]
       mov       [rsp],rbp
       lea       rbp,[rbp+10]
       mov       rdi,784B08950018
       call      qword ptr [784B0DE44EE8]
       lea       rax,[M00_L00]
       add       rsp,10
       pop       rbp
       ret
; Total bytes of code 79</code></pre>
<p>Now on .NET 10, the JIT is able to elide the <code>catch</code> and remove all ceremony related to the <code>try</code> because it can see that ceremony is pointless overhead.</p>
<pre><code>; .NET 10
; Tests.Test(Int32)
       lea       eax,[rsi+1]
       ret
; Total bytes of code 4</code></pre>
<p>That’s true even when the contents of the <code>try</code> calls into other methods that are then inlined, exposing their contents to the JIT’s analysis.</p>
<p>(As an aside, the JIT was already able to remove <code>try/finally</code> when the <code>finally</code> was empty, but <a href="https://github.com/dotnet/runtime/pull/108003">dotnet/runtime#108003</a> catches even more cases of checking for empty <code>finally</code>s again after most other optimizations have been run, in case they revealed additional empty blocks.)</p>
<p>Another example is “GVM”. Previously, any method that called a GVM, or generic virtual method (a virtual method with a generic type parameter), would be blocked from being inlined.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private Base _base = new();

    [Benchmark]
    public int Test()
    {
        M();
        return 42;
    }

    private void M() =&gt; _base.M&lt;object&gt;();
}

class Base
{
    public virtual void M&lt;T&gt;() { }
}</code></pre>
<p>On .NET 9, the above results in this assembly:</p>
<pre><code>; .NET 9
; Tests.Test()
       push      rax
       call      qword ptr [728ED5664FD8]; Tests.M()
       mov       eax,2A
       add       rsp,8
       ret
; Total bytes of code 17</code></pre>
<p>Now on .NET 10, with <a href="https://github.com/dotnet/runtime/pull/116773">dotnet/runtime#116773</a>, <code>M</code> can now be inlined.</p>
<pre><code>; .NET 10
; Tests.Test()
       push      rbp
       push      rbx
       push      rax
       lea       rbp,[rsp+10]
       mov       rbx,[rdi+8]
       mov       rdi,rbx
       mov       rsi,offset MT_Base
       mov       rdx,78034C95D2A0
       call      System.Runtime.CompilerServices.VirtualDispatchHelpers.VirtualFunctionPointer(System.Object, IntPtr, IntPtr)
       mov       rdi,rbx
       call      rax
       mov       eax,2A
       add       rsp,8
       pop       rbx
       pop       rbp
       ret
; Total bytes of code 57</code></pre>
<p>Another area of investment with inlining is to do with the heuristics around when methods should be inlined. Just inlining everything would be bad; inlining copies code, which results in more code, which can have significant negative repercussions. For example, inlining’s increased code size puts more pressure on caches. Processors have an instruction cache, a small amount of super fast memory in a CPU that stores recently used instructions, making them really fast to access again the next time they’re needed (such as the next iteration through a loop, or the next time that same function is called). Consider a method <code>M</code>, and 100 call sites to <code>M</code> that are all being accessed. If all of those share the same instructions for <code>M</code>, because the 100 call sites are all actually calling <code>M</code>, the instruction cache will only need to load <code>M</code>‘s instructions once. If all of those 100 call sites each have their own copy of <code>M</code>‘s instructions, then all 100 copies will separately be loaded through the cache, fighting with each other and other instructions for residence. The less likely it is that instructions are in the cache, the more likely it is that the CPU will stall waiting for the instructions to be loaded from memory.</p>
<p>For this reason, the JIT needs to be careful what it inlines. It tries hard to avoid inlining anything that won’t benefit (e.g. a larger method whose instructions won’t be materially influenced by the caller’s context) while also trying hard to inline anything that will materially benefit (e.g. small functions where the code required to call the function is similar in size to the contents of the function, functions with instructions that could be materially impacted by information from the call site, etc.) As part of these heuristics, the JIT has the notion of “boosts,” where observations it makes about things methods do boost the chances of that method being inlined. <a href="https://github.com/dotnet/runtime/pull/114806">dotnet/runtime#114806</a> gives a boost to methods that appear to be returning new arrays of a small, fixed length; if those arrays can instead be allocated in the caller’s frame, the JIT might then be able to discover they don’t escape and enable them to be stack allocated. <a href="https://github.com/dotnet/runtime/pull/110596">dotnet/runtime#110596</a> similarly looks for boxing, as the caller could possibly instead avoid the box entirely.</p>
<p>For the same purpose (and also just to minimize time spent performing compilation), the JIT also maintains a budget for how much it allows to be inlined into a method compilation… once it hits that budget, it might stop inlining anything. The budgeting scheme overall works <em>ok</em>, however in certain circumstances it can run out of budget at very inopportune times, for example doing a lot of inlining at top-level call sites but then running out of budget by the time it gets to small methods that are critically-important to inline for good performance. To help mitigate these scenarios, <a href="https://github.com/dotnet/runtime/pull/114191">dotnet/runtime#114191</a> and <a href="https://github.com/dotnet/runtime/pull/118641">dotnet/runtime#118641</a> more than double the JIT’s default inlining budget.</p>
<p>The JIT also pays a lot of attention to the number of local variables (e.g. parameters/locals explicitly in the IL, JIT-created temporary locals, promoted struct fields, etc.) it tracks. To avoid creating too many, the JIT would stop inlining once it was already tracking 512. But as other changes have made inlining more aggressive, this (strangely hardcoded) limit gets hit more often, leaving very valuable inlinees out in the cold. <a href="https://github.com/dotnet/runtime/pull/118515">dotnet/runtime#118515</a> removed this fixed limit and instead ties it to a large percentage of the number of locals the JIT is allowed to track (by default, this ends up almost doubling the limit used by the inliner).</p>
<h3>Constant Folding</h3>
<p>Constant folding is a compiler’s ability to perform operations, typically math, at compile-time rather than at run-time: given multiple constants and an expressed relationship between them, the compiler can “fold” those constants together into a new constant. So, if you have the C# code <code>int M(int i) =&gt; i + 2 * 3;</code>, the C# compiler does constant folding and emits that into your compilation as if you’d written <code>int M(int i) =&gt; i + 6;</code>. The JIT can and does also do constant folding, which is valuable especially when it’s based on information not available to the C# compiler. For example, the JIT can treat <code>static readonly</code> fields or <code>IntPtr.Size</code> or <code>Vector128&lt;T&gt;.Count</code> as constants. And the JIT can do folding across inlines. For example, if you have:</p>
<pre><code>int M1(int i) =&gt; i + M2(2 * 3);
int M2(int j) =&gt; j * Environment.ProcessorCount;</code></pre>
<p>the C# compiler will only be able to fold the <code>2 * 3</code>, and will emit the equivalent of:</p>
<pre><code>int M1(int i) =&gt; i + M2(6);
int M2(int j) =&gt; j * Environment.ProcessorCount;</code></pre>
<p>but when compiling <code>M1</code>, the JIT can inline <code>M2</code> and treat <code>ProcessorCount</code> as a constant (on my machine it’s 16), and produce the following assembly code for <code>M1</code>:</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*"

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "i")]
public partial class Tests
{
    [Benchmark]
    [Arguments(42)]
    public int M1(int i) =&gt; i + M2(6);

    private int M2(int j) =&gt; j * Environment.ProcessorCount;
}</code></pre>
<pre><code>; .NET 9
; Tests.M1(Int32)
       lea       eax,[rsi+60]
       ret
; Total bytes of code 4</code></pre>
<p>That’s as if the code for <code>M1</code> had been <code>public int M1(int i) =&gt; i + 96;</code> (the displayed assembly renders hexadecimal, so the <code>60</code> is hexadecimal <code>0x60</code> and thus decimal <code>96</code>).</p>
<p>Or consider:</p>
<pre><code>string M() =&gt; GetString() ?? throw new Exception();

static string GetString() =&gt; "test";</code></pre>
<p>The JIT will be able to inline <code>GetString</code>, at which point it can see that the result is non-<code>null</code> and can fold away the check for the <code>null</code> constant, at which point it can also dead-code eliminate the <code>throw</code>. Constant folding is useful on its own in avoiding unnecessary work, but it also often unlocks other optimizations, like dead-code elimination and bounds-check elimination. The JIT is already quite good at finding constant folding opportunities, and gets better in .NET 10. Consider this benchmark:</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "s")]
public partial class Tests
{
    [Benchmark]
    [Arguments("test")]
    public ReadOnlySpan&lt;char&gt; Test(string s)
    {
        s ??= "";
        return s.AsSpan();
    }
}</code></pre>
<p>Here’s the assembly that gets produced for .NET 9:</p>
<pre><code>; .NET 9
; Tests.Test(System.String)
       push      rbp
       mov       rbp,rsp
       mov       rax,75B5D6200008
       test      rsi,rsi
       cmove     rsi,rax
       test      rsi,rsi
       jne       short M00_L01
       xor       eax,eax
       xor       edx,edx
M00_L00:
       pop       rbp
       ret
M00_L01:
       lea       rax,[rsi+0C]
       mov       edx,[rsi+8]
       jmp       short M00_L00
; Total bytes of code 41</code></pre>
<p>Of particular note are those two <code>test rsi,rsi</code> instructions, which are <code>null</code> checks. The assembly starts by loading a value into <code>rax</code>; that value is the address of the <code>""</code> string literal. It then uses <code>test rsi,rsi</code> to check whether the <code>s</code> parameter, which was passed into this instance method in the <code>rsi</code> register, is <code>null</code>. If it is <code>null</code>, the <code>cmove rsi,rax</code> instruction sets it to the address of the <code>""</code> literal. And then… it does <code>test rsi,rsi</code> again? That second test is the <code>null</code> check at the beginning of <code>AsSpan</code>, which looks like this:</p>
<pre><code>public static ReadOnlySpan&lt;char&gt; AsSpan(this string? text)
{
    if (text is null) return default;
    return new ReadOnlySpan&lt;char&gt;(ref text.GetRawStringData(), text.Length);
}</code></pre>
<p>Now with <a href="https://github.com/dotnet/runtime/pull/111985">dotnet/runtime#111985</a>, that second <code>null</code> check, along with others, can be folded, resulting in this:</p>
<pre><code>; .NET 10
; Tests.Test(System.String)
       mov       rax,7C01C4600008
       test      rsi,rsi
       cmove     rsi,rax
       lea       rax,[rsi+0C]
       mov       edx,[rsi+8]
       ret
; Total bytes of code 25</code></pre>
<p>Similar impact comes from <a href="https://github.com/dotnet/runtime/pull/108420">dotnet/runtime#108420</a>, which is also able to fold a different class of <code>null</code> checks.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "condition")]
public partial class Tests
{
    [Benchmark]
    [Arguments(true)]
    public bool Test(bool condition)
    {
        string tmp = condition ? GetString1() : GetString2();
        return tmp is not null;
    }

    private static string GetString1() =&gt; "Hello";
    private static string GetString2() =&gt; "World";
}</code></pre>
<p>In this benchmark, <em>we</em> can see that neither <code>GetString1</code> nor <code>GetString2</code> return <code>null</code>, and thus the <code>is not null</code> check shouldn’t be necessary. The JIT in .NET 9 couldn’t see that, but its improved .NET 10 self can.</p>
<pre><code>; .NET 9
; Tests.Test(Boolean)
       mov       rax,7407F000A018
       mov       rcx,7407F000A050
       test      sil,sil
       cmove     rax,rcx
       test      rax,rax
       setne     al
       movzx     eax,al
       ret
; Total bytes of code 37

; .NET 10
; Tests.Test(Boolean)
       mov       eax,1
       ret
; Total bytes of code 6</code></pre>
<p>Constant folding also applies to SIMD (Single Instruction Multiple Data), instructions that enable processing multiple pieces of data at once rather than only one element at a time. <a href="https://github.com/dotnet/runtime/pull/117099">dotnet/runtime#117099</a> and <a href="https://github.com/dotnet/runtime/pull/117572">dotnet/runtime#117572</a> both enable more SIMD comparison operations to participate in folding.</p>
<h3>Code Layout</h3>
<p>When the JIT compiler generates assembly from the IL emitted by the C# compiler, it organizes that code into “basic blocks,” a sequence of instructions with one entry point and one exit point, no jumps inside, no branches out except at the end. These blocks can then be moved around as a unit, and the order in which these blocks are placed in memory is referred to as “code layout” or “basic block layout.” This ordering can have a significant performance impact because modern CPUs rely heavily on an instruction cache and on branch prediction to keep things moving fast. If frequently executed (“hot”) blocks are close together and follow a common execution path, the CPU can execute them with fewer cache misses and fewer mispredicted jumps. If the layout is poor, where the hot code is split into pieces far apart from each other, or where rarely executed (“cold”) code sits in between, the CPU can spend more time jumping around and refilling caches than doing actual work. Consider a tight loop executed millions of times. A good layout keeps the loop entry, body, and backward edge (the jump back to the beginning of the body to do the next iteration) right next to each other, letting the CPU fetch them straight from the cache. In a bad layout, that loop might be interwoven with unrelated cold blocks (say, a <code>catch</code> block for a <code>try</code> in the loop), forcing the CPU to load instructions from different places and disrupting the flow. Similarly, for an <code>if</code> block, the likely path should generally be the next block so no jump is required, with the unlikely branch behind a short jump away, as that better aligns with the sensibilities of branch predictors. Code layout heuristics control how that happens, and as a result, how efficient the resulting code is able to execute.</p>
<p>When determining the starting layout of the blocks (before additional optimizations are done for the layout), <a href="https://github.com/dotnet/runtime/pull/108903">dotnet/runtime#108903</a> employs a “loop-aware reverse post-order” traversal. A reverse post-order traversal is an algorithm for visiting the nodes in a control flow graph such that each block appears after its predecessors. The “loop aware” part means the traversal recognizes loops as units, effectively creating a block around the whole loop, and tries to keep the whole loop together as the layout algorithm moves things around. The intent here is to start the larger layout optimizations from a more sensible place, reducing the amount of later reshuffling and situations where loop bodies get broken up.</p>
<p>In the extreme, layout is essentially the <a href="https://en.wikipedia.org/wiki/Travelling_salesman_problem">traveling salesman problem</a>. The JIT must decide the order of basic blocks so that control transfers follow short, predictable paths and make efficient use of instruction cache and branch prediction. Just like the salesman visiting cities with minimal total travel distance, the compiler is trying to arrange blocks so that the “distance” between blocks, which might be measured in bytes or instruction fetch cost or something similar, is minimized. For any meaningfully-sized set of blocks, this is prohibitively expensive to compute optimally, as the number of possible orderings grows factorially with the number of blocks. Thus, the JIT has to rely on approximations rather than attempting an exact solution. One such approximation it employs now as of <a href="https://github.com/dotnet/runtime/pull/103450">dotnet/runtime#103450</a> (and then tweaked further in <a href="https://github.com/dotnet/runtime/pull/109741">dotnet/runtime#109741</a> and <a href="https://github.com/dotnet/runtime/pull/109835">dotnet/runtime#109835</a>) is a “3-opt,” which really just means that rather than considering all blocks together, it looks at only three and tries to produce an optimal ordering amongst those (there are only eight possible orderings to be checked). The JIT can choose to iterate through sets of three blocks until either it doesn’t see any more improvements or hits a self-imposed limit. Specifically when handling backward jumps, with <a href="https://github.com/dotnet/runtime/pull/110277">dotnet/runtime#110277</a>, it expands this “3-opt” to “4-opt” (four blocks).</p>
<p>.NET 10 also does a better job of factoring PGO data into layout. With dynamic PGO, the JIT is able to gather instrumentation data from an initial compilation and then use the results of that profiling to impact an optimized re-compilation. That data can lead to conclusions about what blocks are hot or cold, and which direction branches take, all information that’s valuable for layout optimization. However, data can sometimes be missing from these profiles, so the JIT has a “profile synthesis” algorithm that makes realistic guesses for these gaps in order to fill them in (if you’ve read or seen “Jurassic Park,” this is the JIT-equivalent to filling in gaps in the dinosaur DNA sequences with that from present-day frogs.) With <a href="https://github.com/dotnet/runtime/pull/111915">dotnet/runtime#111915</a>, that repairing of the profile data is now performed just before layout, so that layout has a more complete picture.</p>
<p>Let’s take a concrete example of all this. Here I’ve extracted the core function from <code>MemoryExtensions.BinarySearch</code>:</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Runtime.CompilerServices;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private int[] _values = Enumerable.Range(0, 512).ToArray();

    [Benchmark]
    public int BinarySearch()
    {
        int[] values = _values;
        return BinarySearch(ref values[0], values.Length, 256);
    }

    [MethodImpl(MethodImplOptions.NoInlining)]
    private static int BinarySearch&lt;T, TComparable&gt;(
        ref T spanStart, int length, TComparable comparable)
        where TComparable : IComparable&lt;T&gt;, allows ref struct
    {
        int lo = 0;
        int hi = length - 1;
        while (lo &lt;= hi)
        {
            int i = (int)(((uint)hi + (uint)lo) &gt;&gt; 1);

            int c = comparable.CompareTo(Unsafe.Add(ref spanStart, i));
            if (c == 0)
            {
                return i;
            }
            else if (c &gt; 0)
            {
                lo = i + 1;
            }
            else
            {
                hi = i - 1;
            }
        }

        return ~lo;
    }
}</code></pre>
<p>And here’s the assembly we get for .NET 9 and .NET 10, diff’d from the former to the latter:</p>
<pre><code>; Tests.BinarySearch[[System.Int32, System.Private.CoreLib],[System.Int32, System.Private.CoreLib]](Int32 ByRef, Int32, Int32)
       push      rbp
       mov       rbp,rsp
       xor       ecx,ecx
       dec       esi
       js        short M01_L07
+      jmp       short M01_L03
M01_L00:
-      lea       eax,[rsi+rcx]
-      shr       eax,1
-      movsxd    r8,eax
-      mov       r8d,[rdi+r8*4]
-      cmp       edx,r8d
-      jge       short M01_L03
       mov       r9d,0FFFFFFFF
M01_L01:
       test      r9d,r9d
       je        short M01_L06
       test      r9d,r9d
       jg        short M01_L05
       lea       esi,[rax-1]
M01_L02:
       cmp       ecx,esi
-      jle       short M01_L00
-      jmp       short M01_L07
+      jg        short M01_L07
M01_L03:
+      lea       eax,[rsi+rcx]
+      shr       eax,1
+      movsxd    r8,eax
+      mov       r8d,[rdi+r8*4]
       cmp       edx,r8d
-      jg        short M01_L04
-      xor       r9d,r9d
+      jl        short M01_L00
+      cmp       edx,r8d
+      jle       short M01_L04
+      mov       r9d,1
       jmp       short M01_L01
M01_L04:
-      mov       r9d,1
+      xor       r9d,r9d
       jmp       short M01_L01
M01_L05:
       lea       ecx,[rax+1]
       jmp       short M01_L02
M01_L06:
       pop       rbp
       ret
M01_L07:
       mov       eax,ecx
       not       eax
       pop       rbp
       ret
; Total bytes of code 83</code></pre>
<p>We can see that the main change here is a block that’s moved (the bulk of <code>M01_L00</code> moving down to <code>M01_L03</code>). In .NET 9, the <code>lo &lt;= hi</code> “stay in the loop check” (<code>cmp ecx,esi</code>) is a backward conditional branch (<code>jle short M01_L00</code>), where every iteration of the loop except for the last jumps back to the top (<code>M01_L00</code>). In .NET 10, it instead does a forward branch to exit the loop only in the rarer case, otherwise falling through to the body of the loop in the common case, and then unconditionally branching back.</p>
<h3>GC Write Barriers</h3>
<p>The .NET garbage collector (GC) works on a generational model, organizing the managed heap according to how long objects have been alive. The newest allocations land in “generation 0” (gen0), objects that have survived at least one collection are promoted to “generation 1” (gen1), and those that have been around for longer end up in “generation 2” (gen2). This is based on the premise that most objects are temporary, and that once an object has been around for a while, it’s likely to stick around for a while longer. Splitting up the heap into generations enables for quickly collecting gen0 objects by only scanning the gen0 heap for remaining references to that object. The expectation is that all, or at least the vast majority, of references to a gen0 object are also in gen0. Of course, if a reference to a gen0 object snuck into gen1 or gen2, not scanning gen1 or gen2 during a gen0 collection could be, well, bad. To avoid that case, the JIT collaborates with the GC to track references from older to younger generations. Whenever there’s a reference write that could cross a generation, the JIT emits a call to a helper that tracks the information in a “card table,” and when the GC runs, it consults this table to see if it needs to scan a portion of the higher generations. That helper is referred to as a “GC write barrier.” Since a write barrier is potentially employed on every reference write, it must be super fast, and in fact the runtime has several different variations of write barriers so that the JIT can pick one optimized for the given situation. Of course, the fastest write barrier is one that doesn’t need to exist at all, so as with bounds checks, the JIT also exerts energy to try to prove when write barriers aren’t needed, eliding them when it can. And it can even more in .NET 10.</p>
<p><code>ref structs</code>, referred to in runtime vernacular as “byref-like types,” can never live on the heap, which means any reference fields in them will similarly never live on the heap. As such, if the JIT can prove that a reference write is targeting a field of a <code>ref struct</code>, it can elide the write barrier. Consider this example:</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private object _object = new();

    [Benchmark]
    public MyRefStruct Test() =&gt; new MyRefStruct() { Obj1 = _object, Obj2 = _object, Obj3 = _object };

    public ref struct MyRefStruct
    {
        public object Obj1;
        public object Obj2;
        public object Obj3;
    }
}</code></pre>
<p>In the .NET 9 assembly, we can see three write barriers (<code>CORINFO_HELP_CHECKED_ASSIGN_REF</code>) corresponding to the three fields in <code>MyRefStruct</code> in the benchmark:</p>
<pre><code>; .NET 9
; Tests.Test()
       push      r15
       push      r14
       push      rbx
       mov       rbx,rsi
       mov       r15,[rdi+8]
       mov       rsi,r15
       mov       r14,r15
       mov       rdi,rbx
       call      CORINFO_HELP_CHECKED_ASSIGN_REF
       lea       rdi,[rbx+8]
       mov       rsi,r14
       call      CORINFO_HELP_CHECKED_ASSIGN_REF
       lea       rdi,[rbx+10]
       mov       rsi,r15
       call      CORINFO_HELP_CHECKED_ASSIGN_REF
       mov       rax,rbx
       pop       rbx
       pop       r14
       pop       r15
       ret
; Total bytes of code 59</code></pre>
<p>With <a href="https://github.com/dotnet/runtime/pull/111576">dotnet/runtime#111576</a> and <a href="https://github.com/dotnet/runtime/pull/111733">dotnet/runtime#111733</a> in .NET 10, all of those write barriers are elided:</p>
<pre><code>; .NET 10
; Tests.Test()
       mov       rax,[rdi+8]
       mov       rcx,rax
       mov       rdx,rax
       mov       [rsi],rcx
       mov       [rsi+8],rdx
       mov       [rsi+10],rax
       mov       rax,rsi
       ret
; Total bytes of code 25</code></pre>
<p>Much more impactful, however, are <a href="https://github.com/dotnet/runtime/pull/112060">dotnet/runtime#112060</a> and <a href="https://github.com/dotnet/runtime/pull/112227">dotnet/runtime#112227</a>, which have to do with “return buffers.” When a .NET method is typed to return a value, the runtime has to decide how that value gets from the callee back to the caller. For small types, like integers, floating-point numbers, pointers, or object references, the answer is simple: the value can be passed back via one or more CPU registers reserved for return values, making the operation essentially free. But not all values fit neatly into registers. Larger value types, such as structs with multiple fields, require a different strategy. In these cases, the caller allocates a “return buffer,” a block of memory, typically in the caller’s stack frame, and the caller passes a pointer to that buffer as a hidden argument to the method. The method then writes the return value directly into that buffer in order to provide the caller with the data. When it comes to write barriers, the challenge here is that there historically hasn’t been a requirement that the return buffer be on the stack; it’s technically feasible it could have been allocated on the heap, even if it rarely or never is. And since the callee doesn’t know where the buffer lives, any object reference writes needed to be tracked with GC write barriers. We can see that with a simple benchmark:</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private string _firstName = "Jane", _lastName = "Smith", _address = "123 Main St", _city = "Anytown";

    [Benchmark]
    public Person GetPerson() =&gt; new(_firstName, _lastName, _address, _city);

    public record struct Person(string FirstName, string LastName, string Address, string City);
}</code></pre>
<p>On .NET 9, each field of the returned value type is incurring a <code>CORINFO_HELP_CHECKED_ASSIGN_REF</code> write barrier:</p>
<pre><code>; .NET 9
; Tests.GetPerson()
       push      r15
       push      r14
       push      r13
       push      rbx
       mov       rbx,rsi
       mov       rsi,[rdi+8]
       mov       r15,[rdi+10]
       mov       r14,[rdi+18]
       mov       r13,[rdi+20]
       mov       rdi,rbx
       call      CORINFO_HELP_CHECKED_ASSIGN_REF
       lea       rdi,[rbx+8]
       mov       rsi,r15
       call      CORINFO_HELP_CHECKED_ASSIGN_REF
       lea       rdi,[rbx+10]
       mov       rsi,r14
       call      CORINFO_HELP_CHECKED_ASSIGN_REF
       lea       rdi,[rbx+18]
       mov       rsi,r13
       call      CORINFO_HELP_CHECKED_ASSIGN_REF
       mov       rax,rbx
       pop       rbx
       pop       r13
       pop       r14
       pop       r15
       ret
; Total bytes of code 81</code></pre>
<p>Now in .NET 10, the calling convention has been updated to require that the return buffer live on the stack (if the caller wants the data somewhere else, it’s responsible for subsequently doing that copy). And because the return buffer is now guaranteed to be on the stack, the JIT can elide all GC write barriers as part of returning values.</p>
<pre><code>; .NET 10
; Tests.GetPerson()
       mov       rax,[rdi+8]
       mov       rcx,[rdi+10]
       mov       rdx,[rdi+18]
       mov       rdi,[rdi+20]
       mov       [rsi],rax
       mov       [rsi+8],rcx
       mov       [rsi+10],rdx
       mov       [rsi+18],rdi
       mov       rax,rsi
       ret
; Total bytes of code 35</code></pre>
<p><a href="https://github.com/dotnet/runtime/pull/111636">dotnet/runtime#111636</a> from <a href="https://github.com/a74nh">@a74nh</a> is also interesting from a performance perspective because, as is common in optimization, it trades off one thing for another. Prior to this change, Arm64 had one universal write barrier helper for all GC modes. This change brings Arm64 in line with x64 by routing through a <code>WriteBarrierManager</code> that selects among multiple <code>JIT_WriteBarrier</code> variants based on runtime configuration. In doing so, it makes each Arm64 write barrier a bit more expensive, by adding region checks and moving to a region-aware card marking scheme, but in exchange it lets the GC do less work: fewer cards in the card table get marked, and the GC can scan more precisely. <a href="https://github.com/dotnet/runtime/pull/106191">dotnet/runtime#106191</a> also helps reduce the cost of write barriers on Arm64 by tightening the hot-path comparisons and eliminating some avoidable saves and restores.</p>
<h3>Instruction Sets</h3>
<p>.NET continues to see meaningful optimizations and improvements across all supported architectures, along with various architecture-specific improvements. Here are a handful of examples.</p>
<h4>Arm SVE</h4>
<p>APIs for Arm SVE were introduced in .NET 9. As noted in the <a href="https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-9/#arm-sve">Arm SVE</a> section of last year’s post, enabling SVE is a multi-year effort, and in .NET 10, support is still considered experimental. However, the support has continued to be improved and extended, with PRs like <a href="https://github.com/dotnet/runtime/pull/115775">dotnet/runtime#115775</a> from <a href="https://github.com/snickolls-arm">@snickolls-arm</a> adding <code>BitwiseSelect</code> methods, <a href="https://github.com/dotnet/runtime/pull/117711">dotnet/runtime#117711</a> from <a href="https://github.com/jacob-crawley">@jacob-crawley</a> adding <code>MaxPairwise</code> and <code>MinPairwise</code> methods, and <a href="https://github.com/dotnet/runtime/pull/117051">dotnet/runtime#117051</a> from <a href="https://github.com/jonathandavies-arm">@jonathandavies-arm</a> adding <code>VectorTableLookup</code> methods.</p>
<h4>Arm64</h4>
<p><a href="https://github.com/dotnet/runtime/pull/111893">dotnet/runtime#111893</a> from <a href="https://github.com/jonathandavies-arm">@jonathandavies-arm</a>, <a href="https://github.com/dotnet/runtime/pull/111904">dotnet/runtime#111904</a> from <a href="https://github.com/jonathandavies-arm">@jonathandavies-arm</a>, <a href="https://github.com/dotnet/runtime/pull/111452">dotnet/runtime#111452</a> from <a href="https://github.com/jonathandavies-arm">@jonathandavies-arm</a>, <a href="https://github.com/dotnet/runtime/pull/112235">dotnet/runtime#112235</a> from <a href="https://github.com/jonathandavies-arm">@jonathandavies-arm</a>, and <a href="https://github.com/dotnet/runtime/pull/111797">dotnet/runtime#111797</a> from <a href="https://github.com/snickolls-arm">@snickolls-arm</a> all improved .NET’s support for utilizing Arm64’s multi-operation compound instructions. For example, when implementing a compare and branch, rather than emitting a <code>cmp</code> against 0 followed by <code>beq</code> instruction, the JIT may now emit a <code>cbz</code> (“Compare and Branch on Zero”) instruction.</p>
<h4>APX</h4>
<p>Intel’s Advanced Performance Extensions (APX) was announced in 2023 as an extension of the x86/x64 instruction set. It expands the number of general-purpose registers from 16 to 32 and adds new instructions such as conditional operations designed to reduce memory traffic, improve performance, and lower power consumption. <a href="https://github.com/dotnet/runtime/pull/106557">dotnet/runtime#106557</a> from <a href="https://github.com/Ruihan-Yin">@Ruihan-Yin</a>, <a href="https://github.com/dotnet/runtime/pull/108796">dotnet/runtime#108796</a> from <a href="https://github.com/Ruihan-Yin">@Ruihan-Yin</a>, and <a href="https://github.com/dotnet/runtime/pull/113237">dotnet/runtime#113237</a> from <a href="https://github.com/Ruihan-Yin">@Ruihan-Yin</a> essentially teach the JIT how to speak the new dialect of assembly code (the REX and expanded EVEX encodings), and <a href="https://github.com/dotnet/runtime/pull/108799">dotnet/runtime#108799</a> from <a href="https://github.com/Ruihan-Yin">@Ruihan-Yin</a> updates the JIT to be able to use the expanded set of registers. The most impactful new instructions in APX are around conditional compares (<code>ccmp</code>), a concept the JIT already supports from targeting other instruction sets, and <a href="https://github.com/dotnet/runtime/pull/111072">dotnet/runtime#111072</a> from <a href="https://github.com/anthonycanino">@anthonycanino</a>, <a href="https://github.com/dotnet/runtime/pull/112153">dotnet/runtime#112153</a> from <a href="https://github.com/anthonycanino">@anthonycanino</a>, and <a href="https://github.com/dotnet/runtime/pull/116445">dotnet/runtime#116445</a> from <a href="https://github.com/khushal1996">@khushal1996</a> all teach the JIT how to make good use of these new instructions with APX.</p>
<h4>AVX512</h4>
<p>.NET 8 added broad support for AVX512, and .NET 9 significantly improved its handling and adoption throughout the core libraries. .NET 10 includes a plethora of additional related optimizations:</p>
<ul>
<li><a href="https://github.com/dotnet/runtime/pull/109258">dotnet/runtime#109258</a> from <a href="https://github.com/saucecontrol">@saucecontrol</a> and <a href="https://github.com/dotnet/runtime/pull/109267">dotnet/runtime#109267</a> from <a href="https://github.com/saucecontrol">@saucecontrol</a> expand the number of places the JIT is able to use EVEX embedded broadcasts, a feature that lets vector instructions read a single scalar element from memory and implicitly replicate it to all the lanes of the vector, without needing a separate broadcast or shuffle operation.</li>
<li><a href="https://github.com/dotnet/runtime/pull/108824">dotnet/runtime#108824</a> removes a redundant sign extension from broadcasts.</li>
<li><a href="https://github.com/dotnet/runtime/pull/116117">dotnet/runtime#116117</a> from <a href="https://github.com/alexcovington">@alexcovington</a> improves the code generated for <code>Vector.Max</code> and <code>Vector.Min</code> when AVX512 is supported.</li>
<li><a href="https://github.com/dotnet/runtime/pull/109474">dotnet/runtime#109474</a> from <a href="https://github.com/saucecontrol">@saucecontrol</a> improves “containment” (where an instruction can be eliminated by having its behaviors fully encapsulated by another instruction) for AVX512 widening intrinsics (similar containment-related improvements were made in <a href="https://github.com/dotnet/runtime/pull/110736">dotnet/runtime#110736</a> from <a href="https://github.com/saucecontrol">@saucecontrol</a> and <a href="https://github.com/dotnet/runtime/pull/111778">dotnet/runtime#111778</a> from <a href="https://github.com/saucecontrol">@saucecontrol</a>).</li>
<li><a href="https://github.com/dotnet/runtime/pull/111853">dotnet/runtime#111853</a> from <a href="https://github.com/saucecontrol">@saucecontrol</a> improves <code>Vector128/256/512.Dot</code> to be better accelerated with AVX512.</li>
<li><a href="https://github.com/dotnet/runtime/pull/110195">dotnet/runtime#110195</a>, <a href="https://github.com/dotnet/runtime/pull/110307">dotnet/runtime#110307</a>, and <a href="https://github.com/dotnet/runtime/pull/117118">dotnet/runtime#117118</a> all improve how vector masks are handled. In AVX512, masks are special registers that can be included as part of various instructions to control which subset of vector elements should be utilized (each bit in a mask corresponds to one element in the vector). This enables operating on only part of a vector without needing extra branching or shuffling.</li>
<li><a href="https://github.com/dotnet/runtime/pull/115981">dotnet/runtime#115981</a> improves zeroing (where the JIT emits instructions to zero out memory, often as part of initializing a stack frame) on AVX512. After zeroing as much as it can with 64-byte instructions, it was falling back to using 16-byte instructions, when it could have used 32-byte instructions.</li>
<li><a href="https://github.com/dotnet/runtime/pull/110662">dotnet/runtime#110662</a> improves the code generated for <code>ExtractMostSignificantBits</code> (which is used by many of the searching algorithms in the core libraries) when working with <code>short</code> and <code>ushort</code> (and <code>char</code>, as most of those core library implementations reinterpret cast <code>char</code> as one of the others) by using EVEX mask support.</li>
<li><a href="https://github.com/dotnet/runtime/pull/113864">dotnet/runtime#113864</a> from <a href="https://github.com/saucecontrol">@saucecontrol</a> improves the code generated for <code>ConditionalSelect</code> when not used with mask registers.</li>
</ul>
<h4>AVX10.2</h4>
<p>.NET 9 added support and intrinsics for the AVX10.1 instruction set. With <a href="https://github.com/dotnet/runtime/pull/111209">dotnet/runtime#111209</a> from <a href="https://github.com/khushal1996">@khushal1996</a>, .NET 10 adds support and intrinsics for the AVX10.2 instruction set. <a href="https://github.com/dotnet/runtime/pull/112535">dotnet/runtime#112535</a> from <a href="https://github.com/khushal1996">@khushal1996</a> optimizes floating-point min/max operations with AVX10.2 instructions, while <a href="https://github.com/dotnet/runtime/pull/111775">dotnet/runtime#111775</a> from <a href="https://github.com/khushal1996">@khushal1996</a> enables floating-point conversions to utilize AVX10.2.</p>
<h4>GFNI</h4>
<p><a href="https://github.com/dotnet/runtime/pull/109537">dotnet/runtime#109537</a> from <a href="https://github.com/saucecontrol">@saucecontrol</a> adds intrinsics for the GFNI (Galois Field New Instructions) instruction set, which can be used for accelerating operations over Galois fields GF(2^8). These are common in cryptography, error correction, and data encoding.</p>
<h4>VPCLMULQDQ</h4>
<p><code>VPCLMULQDQ</code> is an x86 instruction set extension that adds vector support to the older <code>PCLMULQDQ</code> instruction, which performs carry-less multiplication over 64-bit integers. <a href="https://github.com/dotnet/runtime/pull/109137">dotnet/runtime#109137</a> from <a href="https://github.com/saucecontrol">@saucecontrol</a> adds new intrinsic APIs for <code>VPCLMULQDQ</code>.</p>
<h3>Miscellaneous</h3>
<p>Many more PRs than the ones I’ve already called out have gone into the JIT this release. Here are a few more:</p>
<ul>
<li><strong>Eliminating some covariance checks</strong>. Writing into arrays of reference types can require “covariance checks.” Imagine you have a class <code>Base</code> and two derived types <code>Derived1 : Base</code> and <code>Derived2 : Base</code>. Since arrays in .NET are covariant, I can have a <code>Derived1[]</code> and cast it successfully to a <code>Base[]</code>, but under the covers that’s still a <code>Derived1[]</code>. That means, for example, that any attempt to store a <code>Derived2</code> into that array should fail at runtime, even if it compiles. To achieve that, the JIT needs to insert such covariance checks when writing into arrays, but just like with bounds checking and write barriers, the JIT can elide those checks when it can prove statically that they’re not necessary. Such an example is with sealed types. If the JIT sees an array of type <code>T[]</code> and <code>T</code> is known to be sealed, <code>T[]</code> must exactly be a <code>T[]</code> and not some <code>DerivedT[]</code>, because there can’t be a <code>DerivedT</code>. So with a benchmark like this:
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private List&lt;string&gt; _list = new() { "hello" };

    [Benchmark]
    public void Set() =&gt; _list[0] = "world";
}</code></pre>
<p>as long as the JIT can see that the array underlying the <code>List&lt;string&gt;</code> is a <code>string[]</code> (<code>string</code> is sealed), it shouldn’t need a covariance check. In .NET 9, we get this:</p>
<pre><code>; .NET 9
; Tests.Set()
       push      rbx
       mov       rbx,[rdi+8]
       cmp       dword ptr [rbx+10],0
       je        short M00_L00
       mov       rdi,[rbx+8]
       xor       esi,esi
       mov       rdx,78914920A038
       call      System.Runtime.CompilerServices.CastHelpers.StelemRef(System.Object[], IntPtr, System.Object)
       inc       dword ptr [rbx+14]
       pop       rbx
       ret
M00_L00:
       call      qword ptr [78D1F80558A8]
       int       3
; Total bytes of code 44</code></pre>
<p>Note that <code>CastHelpers.StelemRef</code> call… that’s the helper that performs the write with the covariance check. But now in .NET 10, thanks to <a href="https://github.com/dotnet/runtime/pull/107116">dotnet/runtime#107116</a> (which teaches the JIT how to resolve the exact type for the field of the closed generic), we get this:</p>
<pre><code>; .NET 10
; Tests.Set()
       push      rbp
       mov       rbp,rsp
       mov       rax,[rdi+8]
       cmp       dword ptr [rax+10],0
       je        short M00_L00
       mov       rcx,[rax+8]
       mov       edx,[rcx+8]
       test      rdx,rdx
       je        short M00_L01
       mov       rdx,75E2B9009A40
       mov       [rcx+10],rdx
       inc       dword ptr [rax+14]
       pop       rbp
       ret
M00_L00:
       call      qword ptr [762368116760]
       int       3
M00_L01:
       call      CORINFO_HELP_RNGCHKFAIL
       int       3
; Total bytes of code 58</code></pre>
<p>No covariance check, thank you very much.</p></li>
<li><strong>More strength reduction</strong>. “Strength reduction” is a classic compiler optimization that replaces more expensive operations, like multiplications, with cheaper ones, like additions. In .NET 9, this was used to transform indexed loops that used multiplied offsets (e.g. <code>index * elementSize</code>) into loops that simply incremented a pointer-like offset (e.g. <code>offset += elementSize</code>), cutting down on arithmetic overhead and improving performance. In .NET 10, strength reduction has been extended, in particular with <a href="https://github.com/dotnet/runtime/pull/110222">dotnet/runtime#110222</a>. This enables the JIT to detect multiple loop induction variables with different step sizes and strength-reduce them by leveraging their greatest common divisor (GCD). Essentially, it creates a single primary induction variable based on the GCD of the varying step sizes, and then recovers each original induction variable by appropriately scaling. Consider this example:
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "numbers")]
public partial class Tests
{
    [Benchmark]
    [Arguments("128514801826028643102849196099776734920914944609068831724328541639470403818631040")]
    public int[] Parse(string numbers)
    {
        int[] results = new int[numbers.Length];
        for (int i = 0; i &lt; numbers.Length; i++)
        {
            results[i] = numbers[i] - '0';
        }

        return results;
    }
}</code></pre>
<p>In this benchmark, we’re iterating through an input <code>string</code>, which is a collection of 2-byte <code>char</code> elements, and we’re storing the results into an array of 4-byte <code>int</code> elements. The core loop in the .NET 9 assembly looks like this:</p>
<pre><code>; .NET 9
M00_L00:
       mov       edx,ecx
       movzx     edi,word ptr [rbx+rdx*2+0C]
       add       edi,0FFFFFFD0
       mov       [rax+rdx*4+10],edi
       inc       ecx
       cmp       r15d,ecx
       jg        short M00_L00</code></pre>
<p>The <code>movzx edi,word ptr [rbx+rdx*2+0C]</code> is the read of <code>numbers[i]</code>, and the <code>mov [rax+rdx*4+10],edi</code> is the assignment to <code>results[i]</code>. <code>rdx</code> here is <code>i</code>, so each assignment is effectively having to do <code>i*2</code> to compute the byte offset of the <code>char</code> at index <code>i</code>, and similarly do <code>i*4</code> to compute the byte offset of the <code>int</code> at offset <code>i</code>. Now here’s the .NET 10 assembly:</p>
<pre><code>; .NET 10
M00_L00:
       movzx     edx,word ptr [rbx+rcx+0C]
       add       edx,0FFFFFFD0
       mov       [rax+rcx*2+10],edx
       add       rcx,2
       dec       r15d
       jne       short M00_L00</code></pre>
<p>The multiplication in the <code>numbers[i]</code> read is gone. Instead, it can just increment <code>rcx</code> by 2 on each iteration, treating that as the offset to the <code>i</code>th <code>char</code>, and then instead of multiplying by 4 to compute the <code>int</code> offset, it just multiples by 2.</p></li>
<li><strong>CSE integration with SSA</strong>. As with most compilers, the JIT employs common subexpression elimination (CSE) to find identical computations and avoid doing them repeatedly. <a href="https://github.com/dotnet/runtime/pull/106637">dotnet/runtime#106637</a> teaches the JIT how to do so in a more consistent manner by more fully integrating CSE with its Static Single Assignment (SSA) representation. This in turn allows for more optimizations to kick in, e.g. some of the strength reduction done around loop induction variables in .NET 9 wasn’t applying as much as it should have, and now it will.</li>
<li><strong><code>return someCondition ? true : false</code></strong>. There are often multiple ways to represent the same thing, but it often happens in compilers that certain patterns will be recognized during optimization while other equivalent ones won’t, and it can therefore behoove the compiler to first normalize the representations to all use the better recognized one. There’s a really common and interesting case of this with <code>return someCondition</code>, where, for reasons relating to the JIT’s internal representation, the JIT is better able to optimize with the equivalent <code>return someCondition ? true : false</code>. <a href="https://github.com/dotnet/runtime/pull/107499">dotnet/runtime#107499</a> normalizes to the latter. As an example of this, consider this benchmark:
<pre><code>// dotnet run -c Release -f net9.0 --filter "*"

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "i")]
public partial class Tests
{
    [Benchmark]
    [Arguments(42)]
    public bool Test1(int i)
    {
        if (i &gt; 10 &amp;&amp; i &lt; 20) return true;
        return false;
    }

    [Benchmark]
    [Arguments(42)]
    public bool Test2(int i) =&gt; i &gt; 10 &amp;&amp; i &lt; 20;
}</code></pre>
<p>On .NET 9, that results in this assembly code for <code>Test1</code>:</p>
<pre><code>; .NET 9
; Tests.Test1(Int32)
       sub       esi,0B
       cmp       esi,8
       setbe     al
       movzx     eax,al
       ret
; Total bytes of code 13</code></pre>
<p>The JIT has successfully recognized that it can change the two comparisons to instead be a subtraction and a single comparison, as if the <code>i &gt; 10 &amp;&amp; i &lt; 20</code> were instead written as <code>(uint)(i - 11) &lt;= 8</code>. But for <code>Test2</code>, .NET 9 produces this:</p>
<pre><code>; .NET 9
; Tests.Test2(Int32)
       xor       eax,eax
       cmp       esi,14
       setl      cl
       movzx     ecx,cl
       cmp       esi,0A
       cmovg     eax,ecx
       ret
; Total bytes of code 18</code></pre>
<p>Because of how the return condition is being represented internally by the JIT, it’s missing this particular optimization, and the assembly code more directly reflects what was written in the C#. But now in .NET 10, because of this normalization, we now get this for <code>Test2</code>, exactly what we got for <code>Test1</code>:</p>
<pre><code>; .NET 10
; Tests.Test2(Int32)
       sub       esi,0B
       cmp       esi,8
       setbe     al
       movzx     eax,al
       ret
; Total bytes of code 13</code></pre>
</li>
<li><strong>Bit tests</strong>. The C# compiler has a lot of flexibility in how it emits <code>switch</code> and <code>is</code> expressions. Consider a case like this: <code>c is ' ' or '\t' or '\r' or '\n'</code>. It could emit that as the equivalent of a series of cascading <code>if</code>/<code>else</code> branches, as an IL <code>switch</code> instruction, as a bit test, or as combinations of those. The C# compiler, though, doesn’t have all of the information the JIT has, such as whether the process is 32-bit or 64-bit, or knowledge of what instructions cost on given hardware. With <a href="https://github.com/dotnet/runtime/pull/107831">dotnet/runtime#107831</a>, the JIT will now recognize more such expressions that can be implemented as a bit test and generate the code accordingly.
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Runtime.CompilerServices;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "c")]
public partial class Tests
{
    [Benchmark]
    [Arguments('s')]
    public void Test(char c)
    {
        if (c is ' ' or '\t' or '\r' or '\n' or '.')
        {
            Handle(c);
        }

        [MethodImpl(MethodImplOptions.NoInlining)]
        static void Handle(char c) { }
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>Code Size</th>
</tr>
</thead>
<tbody>
<tr>
<td>Test</td>
<td>.NET 9.0</td>
<td>0.4537 ns</td>
<td>1.02</td>
<td>58 B</td>
</tr>
<tr>
<td>Test</td>
<td>.NET 10.0</td>
<td>0.1304 ns</td>
<td>0.29</td>
<td>44 B</td>
</tr>
</tbody>
</table>
<p>It’s also common to see bit tests implemented in C# against shifted values; a constant mask is created with bits set at various indices, and then an incoming value to check is tested by shifting a bit to the corresponding index and seeing whether it aligns with one in the mask. For example, here is how <code>Regex</code> tests to see whether a provided <code>UnicodeCategory</code> is one of those that composes the “word” class (`\w`):</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Globalization;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "uc")]
public partial class Tests
{
    [Benchmark]
    [Arguments(UnicodeCategory.DashPunctuation)]
    public bool Test(UnicodeCategory uc) =&gt; (WordCategoriesMask &amp; (1 &lt;&lt; (int)uc)) != 0;

    private const int WordCategoriesMask =
        1 &lt;&lt; (int)UnicodeCategory.UppercaseLetter |
        1 &lt;&lt; (int)UnicodeCategory.LowercaseLetter |
        1 &lt;&lt; (int)UnicodeCategory.TitlecaseLetter |
        1 &lt;&lt; (int)UnicodeCategory.ModifierLetter |
        1 &lt;&lt; (int)UnicodeCategory.OtherLetter |
        1 &lt;&lt; (int)UnicodeCategory.NonSpacingMark |
        1 &lt;&lt; (int)UnicodeCategory.DecimalDigitNumber |
        1 &lt;&lt; (int)UnicodeCategory.ConnectorPunctuation;
}</code></pre>
<p>Previously, the JIT would end up emitting that similar to how it’s written: a shift followed by a test. Now with <a href="https://github.com/dotnet/runtime/pull/111979">dotnet/runtime#111979</a> from <a href="https://github.com/varelen">@varelen</a>, it can emit it as a bit test.</p>
<pre><code>; .NET 9
; Tests.Test(System.Globalization.UnicodeCategory)
       mov       eax,1
       shlx      eax,eax,esi
       test      eax,4013F
       setne     al
       movzx     eax,al
       ret
; Total bytes of code 22

; .NET 10
; Tests.Test(System.Globalization.UnicodeCategory)
       mov       eax,4013F
       bt        eax,esi
       setb      al
       movzx     eax,al
       ret
; Total bytes of code 15</code></pre>
</li>
<li><strong>Redundant sign extensions</strong>. With <a href="https://github.com/dotnet/runtime/pull/111305">dotnet/runtime#111305</a>, the JIT can now remove more redundant sign extensions (when you take a smaller size type, e.g. <code>int</code>, and convert it to a larger size type, e.g. <code>long</code>, while preserving the value’s sign). For example, with a test like this <code>public ulong Test(int x) =&gt; (uint)x &lt; 10 ? (ulong)x &lt;&lt; 60 : 0</code>, the JIT can now emit a <code>mov</code> (just copy the bits) instead of <code>movsxd</code> (move with sign extension), since it knows from the first comparison that the shift will only ever be performed with a non-negative <code>x</code>.</li>
<li><strong>Better division with BMI2</strong>. If the BMI2 instruction set is available, with <a href="https://github.com/dotnet/runtime/pull/116198">dotnet/runtime#116198</a> from <a href="https://github.com/Daniel-Svensson">@Daniel-Svensson</a> the JIT can now use the <code>mulx</code> instruction (“Unsigned Multiply Without Affecting Flags”) to implement integer division, e.g.
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "value")]
public partial class Tests
{
    [Benchmark]
    [Arguments(12345)]
    public ulong Div10(ulong value) =&gt; value / 10;
}</code></pre>
<p>results in:</p>
<pre><code>; .NET 9
; Tests.Div10(UInt64)
       mov       rdx,0CCCCCCCCCCCCCCCD
       mov       rax,rsi
       mul       rdx
       mov       rax,rdx
       shr       rax,3
       ret
; Total bytes of code 24

; .NET 10
; Tests.Div10(UInt64)
       mov       rdx,0CCCCCCCCCCCCCCCD
       mulx      rax,rax,rsi
       shr       rax,3
       ret
; Total bytes of code 20</code></pre>
</li>
<li><strong>Better range comparison</strong>. When comparing a <code>ulong</code> expression against <code>uint.MaxValue</code>, rather than being emitted as a comparison, with <a href="https://github.com/dotnet/runtime/pull/113037">dotnet/runtime#113037</a> from <a href="https://github.com/shunkino">@shunkino</a> it can be handled more efficiently as a shift.
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "x")]
public partial class Tests
{
    [Benchmark]
    [Arguments(12345)]
    public bool Test(ulong x) =&gt; x &lt;= uint.MaxValue;
}</code></pre>
<p>resulting in:</p>
<pre><code>; .NET 9
; Tests.Test(UInt64)
       mov       eax,0FFFFFFFF
       cmp       rsi,rax
       setbe     al
       movzx     eax,al
       ret
; Total bytes of code 15

; .NET 10
; Tests.Test(UInt64)
       shr       rsi,20
       sete      al
       movzx     eax,al
       ret
; Total bytes of code 11</code></pre>
</li>
<li><strong>Better dead branch elimination</strong>. The JIT’s branch optimizer is already able to use implications from comparisons to statically determine the outcome of other branches. For example, if I have this:
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "x")]
public partial class Tests
{
    [Benchmark]
    [Arguments(42)]
    public void Test(int x)
    {
        if (x &gt; 100)
        {
            if (x &gt; 10)
            {
                Console.WriteLine();
            }
        }
    }
}</code></pre>
<p>the JIT generates this on .NET 9:</p>
<pre><code>; .NET 9
; Tests.Test(Int32)
       cmp       esi,64
       jg        short M00_L00
       ret
M00_L00:
       jmp       qword ptr [7766D3E64FA8]
; Total bytes of code 12</code></pre>
<p>Note there’s only a single comparison against 100 (0x64), with the comparison against 10 elided (as it’s implied by the previous comparison). However, there are many variations to this, and not all of them were handled equally well. Consider this:</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "x")]
public partial class Tests
{
    [Benchmark]
    [Arguments(42)]
    public void Test(int x)
    {
        if (x &lt; 16)
            return;

        if (x &lt; 8)
            Console.WriteLine();
    }
}</code></pre>
<p>Here, the <code>Console.WriteLine</code> ideally wouldn’t appear in the emitted assembly at all, as it’s never reachable. Alas, on .NET 9, we get this (the <code>jmp</code> instruction here is a tail call to <code>WriteLine</code>):</p>
<pre><code>; .NET 9
; Tests.Test(Int32)
       push      rbp
       mov       rbp,rsp
       cmp       esi,10
       jl        short M00_L00
       cmp       esi,8
       jge       short M00_L00
       pop       rbp
       jmp       qword ptr [731ED8054FA8]
M00_L00:
       pop       rbp
       ret
; Total bytes of code 23</code></pre>
<p>With <a href="https://github.com/dotnet/runtime/pull/111766">dotnet/runtime#111766</a> on .NET 10, it successfully recognizes that by the time it gets to the <code>x &lt; 8</code>, that condition will always be <code>false</code>, and it can be eliminated. And once it’s eliminated, the initial branch is also unnecessary. So the whole method reduces to this:</p>
<pre><code>; .NET 10
; Tests.Test(Int32)
       ret
; Total bytes of code 1</code></pre>
</li>
<li><strong>Better floating-point conversion</strong>. <a href="https://github.com/dotnet/runtime/pull/114410">dotnet/runtime#114410</a> from <a href="https://github.com/saucecontrol">@saucecontrol</a>, <a href="https://github.com/dotnet/runtime/pull/114597">dotnet/runtime#114597</a> from <a href="https://github.com/saucecontrol">@saucecontrol</a>, and <a href="https://github.com/dotnet/runtime/pull/111595">dotnet/runtime#111595</a> from <a href="https://github.com/saucecontrol">@saucecontrol</a> all speed up conversions between floating-point and integers, such as by using <code>vcvtusi2s</code> when AVX512 is available, or when it isn’t, avoiding the intermediate <code>double</code> conversion.
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "i")]
public partial class Tests
{
    [Benchmark]
    [Arguments(42)]
    public float Compute(uint i) =&gt; i;
}</code></pre>
<pre><code>; .NET 9
; Tests.Compute(UInt32)
       mov       eax,esi
       vxorps    xmm0,xmm0,xmm0
       vcvtsi2sd xmm0,xmm0,rax
       vcvtsd2ss xmm0,xmm0,xmm0
       ret
; Total bytes of code 16

; .NET 10
; Tests.Compute(UInt32)
       vxorps    xmm0,xmm0,xmm0
       vcvtusi2ss xmm0,xmm0,esi
       ret
; Total bytes of code 11</code></pre>
</li>
<li><strong>Unrolling</strong>. When using <code>CopyTo</code> (or other “memmove”-based operations) with a constant source, <a href="https://github.com/dotnet/runtime/pull/108576">dotnet/runtime#108576</a> reduces costs by avoiding a redundant memory load. <a href="https://github.com/dotnet/runtime/pull/109036">dotnet/runtime#109036</a> unblocks more unrolling on Arm64 for <code>Equals</code>/<code>StartsWith</code>/<code>EndsWith</code>. And <a href="https://github.com/dotnet/runtime/pull/110893">dotnet/runtime#110893</a> enables unrolling non-zero fills (unrolling already happened for zero fills).
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private char[] _chars = new char[100];

    [Benchmark]
    public void Fill() =&gt; _chars.AsSpan(0, 16).Fill('x');
}</code></pre>
<pre><code>; .NET 9
; Tests.Fill()
       push      rbp
       mov       rbp,rsp
       mov       rdi,[rdi+8]
       test      rdi,rdi
       je        short M00_L00
       cmp       dword ptr [rdi+8],10
       jb        short M00_L00
       add       rdi,10
       mov       esi,10
       mov       edx,78
       call      qword ptr [7F3093FBF1F8]; System.SpanHelpers.Fill[[System.Char, System.Private.CoreLib]](Char ByRef, UIntPtr, Char)
       nop
       pop       rbp
       ret
M00_L00:
       call      qword ptr [7F3093787810]
       int       3
; Total bytes of code 49

; .NET 10
; Tests.Fill()
       push      rbp
       mov       rbp,rsp
       mov       rax,[rdi+8]
       test      rax,rax
       je        short M00_L00
       cmp       dword ptr [rax+8],10
       jl        short M00_L00
       add       rax,10
       vbroadcastss ymm0,dword ptr [78EFC70C9340]
       vmovups   [rax],ymm0
       vzeroupper
       pop       rbp
       ret
M00_L00:
       call      qword ptr [78EFC7447B88]
       int       3
; Total bytes of code 48</code></pre>
<p>Note the call to <code>SpanHelpers.Fill</code> in the .NET 9 assembly and the absence of it in the .NET 10 assembly.</p></li>
</ul>
<h2>Native AOT</h2>
<p>Native AOT is the ability for a .NET application to be compiled directly to assembly code at build-time. The JIT is still used for code generation, but only at build time; the JIT isn’t part of the shipping app at all, and no code generation is performed at run-time. As such, most of the optimizations to the JIT already discussed, as well as optimizations throughput the rest of this post, apply to Native AOT equally. Native AOT presents some unique opportunities and challenges, however.</p>
<p>One super power of the Native AOT tool chain is the ability to interpret (some) code at build-time and use the results of that execution rather than performing the operation at run-time. This is particularly relevant for static constructors, where the constructor’s code can be interpreted to initialize various <code>static readonly</code> fields, and then the contents of those fields can be persisted into the generated assembly; at run-time, the contents needs only be rehydrated from the assembly rather than being recomputed. This also potentially helps to make more code redundant and removable, if for example the static constructor and anything it (and only it) referenced were no longer needed. Of course, it would be dangerous and problematic if any arbitrary code could be run during build, so instead there’s a very filtered allow list and specialized support for the most common and appropriate constructs. <a href="https://github.com/dotnet/runtime/pull/107575">dotnet/runtime#107575</a> augments this “preinitialization” capability to support spans sourced from arrays, such that using methods like <code>.AsSpan()</code> doesn’t cause preinitialization to bail out. <a href="https://github.com/dotnet/runtime/pull/114374">dotnet/runtime#114374</a> also improved preinitialization, removing restrictions around accessing static fields of other types, calling methods on other types that have their own static constructors, and dereferencing pointers.</p>
<p>Conversely, Native AOT has its own challenges, specifically that size really matters and is harder to control. With a JIT available at run-time, code generation for only exactly what’s needed can be deferred until run-time. With Native AOT, <em>all</em> assembly code generation needs to be done at build-time, which means the Native AOT tool chain needs to work hard to determine the least amount of code it needs to emit to support everything the app might need to do at run-time. Most of the effort on Native AOT in any given release ends up being about helping it to further decrease the size of generated code. For example:</p>
<ul>
<li><a href="https://github.com/dotnet/runtime/pull/117411">dotnet/runtime#117411</a> enables folding bodies of generic instantations of the same method, essentially avoiding duplication by using the same code for copies of the same method where possible.</li>
<li><a href="https://github.com/dotnet/runtime/pull/117080">dotnet/runtime#117080</a> similarly helps improve the existing method body deduplication logic.</li>
<li><a href="https://github.com/dotnet/runtime/pull/117345">dotnet/runtime#117345</a> from <a href="https://github.com/huoyaoyuan">@huoyaoyuan</a> tweaks a bit of code in reflection that would previously artificially force the code to be preserved for all enumerators of all generic instantations of every collection type.</li>
<li><a href="https://github.com/dotnet/runtime/pull/112782">dotnet/runtime#112782</a> adds the same distinction that already existed for <code>MethodTable</code>s for non-generic methods (“is this method table visible to user code or not”) to generic methods, allowing more metadata for the non-user visible ones to be optimized away.</li>
<li><a href="https://github.com/dotnet/runtime/pull/118718">dotnet/runtime#118718</a> and <a href="https://github.com/dotnet/runtime/pull/118832">dotnet/runtime#118832</a> enable size reductions related to boxed enums. The former tweaks a few methods in <code>Thread</code>, <code>GC</code>, and <code>CultureInfo</code> to avoid boxing some enums, which means the code for those needn’t be generated. The latter tweaks the implementation of <code>RuntimeHelpers.CreateSpan</code>, which is used by the C# compiler as part of creating spans with constructs like collection expressions. <code>CreateSpan</code> is a generic method, and the Native AOT toolchain’s whole-program analysis would end up treating the generic type parameter as being “reflected on,” meaning the compiler had to assume any type parameter would be used with reflection and thus had to preserve relevant metadata. When used with enums, it would need to ensure support for boxed enums was kept around, and <code>System.Console</code> has such a use with an enum. That in turn meant that a simple “hello, world” console app couldn’t trim away that boxed enum reflection support; now it can.</li>
</ul>
<h2>VM</h2>
<p>The .NET runtime offers a wide range of services to managed applications, most obviously the garbage collector and the JIT compiler, but it also encompasses a host of other capabilities: assembly and type loading, exception handling, virtual method dispatch, interoperability support, stub generation, and so on. Collectively, all of these features are referred to as being a part of the .NET Virtual Machine (VM).</p>
<p><a href="https://github.com/dotnet/runtime/pull/108167">dotnet/runtime#108167</a> and <a href="https://github.com/dotnet/runtime/pull/109135">dotnet/runtime#109135</a> rewrote various runtime helpers from C in the runtime to C# in <code>System.Private.CoreLib</code>, including the “unboxing” helpers, which are used to unbox <code>object</code>s to value types in niche scenarios. This rewrite avoids overheads associated with transitioning between native and managed and also enables the JIT an opportunity to optimize in the context of callers, such as with inlining. Note that these unboxing helpers are only used in obscure situations, so it requires a bit of a complicated benchmark to demonstrate the impact:</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Runtime.CompilerServices;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[DisassemblyDiagnoser(0)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private object[] _objects = [new GenericStruct&lt;MyStruct, object&gt;()];

    [Benchmark]
    public void Unbox() =&gt; Unbox&lt;GenericStruct&lt;MyStruct, object&gt;&gt;(_objects[0]);

    private void Unbox&lt;T&gt;(object o) where T : struct, IStaticMethod&lt;T&gt;
    {
        T? local = (T?)o;
        if (local.HasValue)
        {
            T localCopy = local.Value;
            T.Method(ref localCopy);
        }
    }

    public interface IStaticMethod&lt;T&gt;
    {
        public static abstract void Method(ref T param);
    }

    struct MyStruct : IStaticMethod&lt;MyStruct&gt;
    {
        public static void Method(ref MyStruct param) { }
    }

    struct GenericStruct&lt;T, V&gt; : IStaticMethod&lt;GenericStruct&lt;T, V&gt;&gt; where T : IStaticMethod&lt;T&gt;
    {
        public T Value;

        [MethodImpl(MethodImplOptions.NoInlining)]
        public static void Method(ref GenericStruct&lt;T, V&gt; value) =&gt; T.Method(ref value.Value);
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>Code Size</th>
</tr>
</thead>
<tbody>
<tr>
<td>Unbox</td>
<td>.NET 9.0</td>
<td>1.626 ns</td>
<td>1.00</td>
<td>148 B</td>
</tr>
<tr>
<td>Unbox</td>
<td>.NET 10.0</td>
<td>1.379 ns</td>
<td>0.85</td>
<td>148 B</td>
</tr>
</tbody>
</table>
<p>What it means to move the implementation from native to managed is most easily seen just by looking at the generated assembly. Other than uninteresting and non-impactful changes in which registers happen to get assigned, the only real difference between .NET 9 and .NET 10 is a single instruction:</p>
<pre><code>-      call      CORINFO_HELP_UNBOX_NULLABLE
+      call      System.Runtime.CompilerServices.CastHelpers.Unbox_Nullable(Byte ByRef, System.Runtime.CompilerServices.MethodTable*, System.Object)</code></pre>
<p><a href="https://github.com/dotnet/runtime/pull/115284">dotnet/runtime#115284</a> streamlines how the runtime sets up and tears down the little code blocks (“funclets”) the runtime uses to implement <code>catch</code>/<code>finally</code> on x64. Historically, these funclets acted a lot like tiny functions, saving and restoring non-volatile CPU registers on entry and exit (a “non-volatile” register is effectively one where the caller can expect it to contain the same value after a function call as it did before the function call). This PR changes the contract so that funclets no longer need to preserve those registers themselves; instead, the runtime takes care of preserving them. That shrinks the prologs and epilogs the JIT emits for funclets, reduces instruction count and code size, and lowers the cost of entering and exiting exception handlers.</p>
<p>With <a href="https://github.com/dotnet/runtime/pull/114462">dotnet/runtime#114462</a>, the runtime now uses a single shared “template” for many of the small executable “stubs” it needs at runtime; stubs are tiny chunks of machine code that act as jump points, call counters, or patchable trampolines. Previously, each memory allocation for stubs would regenerate the same instructions over and over. The new approach builds one copy of the stub code in a read-only page and then maps that same physical page into every place it’s needed, while giving each allocation its own writable page for the per-stub data that changes at runtime. This lets hundreds of virtual stub pages all point to one physical code page, cutting memory use, reducing startup work, and improving instruction cache locality.</p>
<p>Also interesting are <a href="https://github.com/dotnet/runtime/pull/117218">dotnet/runtime#117218</a> and <a href="https://github.com/dotnet/runtime/pull/116031">dotnet/runtime#116031</a>, which together help optimize the generation of stack traces in large, heavily multi-threaded applications when being profiled.</p>
<h2>Threading</h2>
<p>The <code>ThreadPool</code> underlies most work in most .NET apps and services. It’s a critical-path component that has to be able to deal with all manners of workloads efficiently.</p>
<p><a href="https://github.com/dotnet/runtime/pull/109841">dotnet/runtime#109841</a> implemented an opt-in feature that <a href="https://github.com/dotnet/runtime/pull/112796">dotnet/runtime#112796</a> then enabled by default for .NET 10. The idea behind it is fairly straightforward, but to understand it, we first need to examine how the thread pool queues work items. The thread pool has multiple queues, typically one “global” queue and then one “local” queue per thread in the pool. When threads outside of the pool queue work, that work goes to the global queue, and when a thread pool thread queues work, especially a <code>Task</code> or work related to an <code>await</code>, that work item typically goes to that thread’s local queue. Then when a thread pool thread finishes whatever it was doing and goes in search of more work, it first checks its own local queue (treating its local queue as highest priority), then if that’s empty it checks the global queue, and then if that’s empty it goes and helps out the other threads in the pool by searching their queues for work to be done. This is all in an attempt to a) minimize contention on the global queue (if threads are mainly queueing and dequeuing from their own local queue, they’re not contending with each other), and b) prioritize work that’s logically part of already started work (the only way for work to get into a local queue is if that thread was processing a work item that created it). Generally, this works out well, but sometimes we get into degenerate scenarios, typically when an app does something that goes against best practices… like blocking.</p>
<p>Blocking a thread pool thread means that thread can’t service other work coming into the pool. If the blocking is brief, it’s generally fine, and if it’s longer, the thread pool tries to accommodate it by injecting more threads and finding a steady state at which things hum along. But a certain kind of blocking can be really problematic: <a href="https://devblogs.microsoft.com/dotnet/should-i-expose-synchronous-wrappers-for-asynchronous-methods/">“sync over async”</a>. With “sync over async”, one thread blocks while waiting for an asynchronous operation to complete, and if <em>that</em> operation needs to do something on the thread pool in order to complete, you now have one thread pool thread blocked waiting for another thread pool thread to pick up a particular work item and process it. This can quickly lead to the whole pool getting into a jam… especially with the thread local queues. If a thread is blocked on an operation that depends on work items in that thread’s local queue getting processed, that work item being picked off now depends on the global queue being exhausted and another thread coming along and stealing the work item from this thread’s queue. If there’s a steady stream of incoming work into the global queue, though, that will never happen; essentially, the highest priority work item has become the lowest priority work item.</p>
<p>So, back to these PRs. The idea is fairly simple: when the thread is about to block, and in particular when it’s about to block waiting on a <code>Task</code>, it first dumps its entire local queue into the global queue. That way, this work which was highest priority for the blocked thread has a fairer chance of being processed by other threads, rather than it being the lowest priority work for everyone. We can try to see the impact of this with a specifically-crafted workload:</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*"
// dotnet run -c Release -f net10.0 --filter "*"

using System.Diagnostics;

int numThreads = Environment.ProcessorCount;
ThreadPool.SetMaxThreads(numThreads, 1);

ManualResetEventSlim start = new();
CountdownEvent allDone = new(numThreads);
new Thread(() =&gt;
{
    while (true)
    {
        for (int i = 0; i &lt; 10_000; i++)
        {
            ThreadPool.QueueUserWorkItem(_ =&gt; Thread.SpinWait(1));
        }

        Thread.Yield();
    }
}) { IsBackground = true }.Start();

for (int i = 0; i &lt; numThreads; i++)
{
    ThreadPool.QueueUserWorkItem(_ =&gt;
    {
        start.Wait();
        TaskCompletionSource tcs = new();

        const int LocalItemsPerThread = 4;
        var remaining = LocalItemsPerThread;
        for (int j = 0; j &lt; LocalItemsPerThread; j++)
        {
            Task.Run(() =&gt;
            {
                Thread.SpinWait(100);
                if (Interlocked.Decrement(ref remaining) == 0)
                {
                    tcs.SetResult();
                }
            });
        }

        tcs.Task.Wait();
        allDone.Signal();
    });
}

var sw = Stopwatch.StartNew();
start.Set();
Console.WriteLine(allDone.Wait(20_000) ?
    $"Completed: {sw.ElapsedMilliseconds}ms" :
    $"Timed out after {sw.ElapsedMilliseconds}ms");</code></pre>
<p>This is:</p>
<ul>
<li>creating a noise thread that tries to keep the global queue inundated with new work</li>
<li>queuing <code>Environment.ProcessorCount</code> work items, each of which queues four work items to the local queue that all do a little work and then blocks on a <code>Task</code> until they all complete</li>
<li>waiting for those <code>Environment.ProcessorCount</code> work items to complete</li>
</ul>
<p>When I run this on .NET 9, it hangs, because there’s so much work in the global queue, no threads are able to process those sub-work items that are necessary to unblock the main work items:</p>
<pre><code>Timed out after 20002ms</code></pre>
<p>On .NET 10, it generally completes almost instantly:</p>
<pre><code>Completed: 4ms</code></pre>
<p>Some other tweaks were made to the pool as well:</p>
<ul>
<li><a href="https://github.com/dotnet/runtime/pull/115402">dotnet/runtime#115402</a> reduced the amount of spin-waiting done on Arm processors, bringing it more in line with x64.</li>
<li><a href="https://github.com/dotnet/runtime/pull/112789">dotnet/runtime#112789</a> reduced the frequency at which the thread pool checked CPU utilization, as in some circumstances it was adding noticeable overhead, and makes the frequency configurable.</li>
<li><a href="https://github.com/dotnet/runtime/pull/108135">dotnet/runtime#108135</a> from <a href="https://github.com/AlanLiu90">@AlanLiu90</a> removed a bit of lock contention that could happen under load when starting new thread pool threads.</li>
</ul>
<p>On the subject of locking, and only for developers that find themselves with a strong need to do really low-level low-lock development, <a href="https://github.com/dotnet/runtime/pull/107843">dotnet/runtime#107843</a> from <a href="https://github.com/hamarb123">@hamarb123</a> adds two new methods to the <code>Volatile</code> class: <code>ReadBarrier</code> and <code>WriteBarrier</code>. A read barrier has “load acquire” semantics, and is sometimes referred to as a “downward fence”: it prevents instructions from being reordered in such a way that memory accesses below/after the barrier move to above/before it. In contrast, a write barrier has “store release” semantics, and is sometimes referred to as an “upwards fence”: it prevents instructions from being reordered in such a way that memory accesses above/before the barrier move to below/after it. I find it helps to think about this with regards to a <code>lock</code>:</p>
<pre><code>A;
lock (...)
{
    B;
}
C;</code></pre>
<p>While in practice the implementation may provide stronger fences, by specification entering a <code>lock</code> has acquire semantics and exiting a <code>lock</code> has release semantics. Imagine if the instructions in the above code could be reordered like this:</p>
<pre><code>A;
B;
lock (...)
{
}
C;</code></pre>
<p>or like this:</p>
<pre><code>A;
lock (...)
{
}
B;
C;</code></pre>
<p>Both of those would be really bad. Thankfully, the barriers help us here. The acquire / read barrier semantics of entering the lock are a downwards fence: logically the brace that starts the lock puts downwards pressure on everything inside the lock to not move to before it, and the brace that ends the lock puts upwards pressure on everything inside the lock to not move to after it. Interestingly, nothing about the semantics of these barriers prevents this from happening:</p>
<pre><code>lock (...)
{
    A;
    B;
    C;
}</code></pre>
<p>These barriers are referred to as “half fences”; the read barrier prevents later things from moving earlier, but not the other way around, and the write barrier prevents earlier things from moving later, but not the other way around. (As it happens, though, while not required by specification, today the implementation of <code>lock</code> does use a full barrier on both enter and exit, so nothing before or after a <code>lock</code> will move into it.)</p>
<p>For <code>Task</code> in .NET 10, <code>Task.WhenAll</code> has a few changes to improve its performance. <a href="https://github.com/dotnet/runtime/pull/110536">dotnet/runtime#110536</a> avoids a temporary collection allocation when needing to buffer up tasks from an <code>IEnumerable&lt;Task&gt;</code>.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Runtime.CompilerServices;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    [Benchmark]
    public Task WhenAllAlloc()
    {
        AsyncTaskMethodBuilder t = default;
        Task whenAll = Task.WhenAll(from i in Enumerable.Range(0, 2) select t.Task);
        t.SetResult();
        return whenAll;
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>WhenAllAlloc</td>
<td>.NET 9.0</td>
<td>216.8 ns</td>
<td>1.00</td>
<td>496 B</td>
<td>1.00</td>
</tr>
<tr>
<td>WhenAllAlloc</td>
<td>.NET 10.0</td>
<td>181.9 ns</td>
<td>0.84</td>
<td>408 B</td>
<td>0.82</td>
</tr>
</tbody>
</table>
<p>And <a href="https://github.com/dotnet/runtime/pull/117715">dotnet/runtime#117715</a> from <a href="https://github.com/CuteLeon">@CuteLeon</a> avoids the overhead of the <code>Task.WhenAll</code> altogether when the input ends up just being a single task, in which case it simply returns that task instance.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Runtime.CompilerServices;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    [Benchmark]
    public Task WhenAllAlloc()
    {
        AsyncTaskMethodBuilder t = default;
        Task whenAll = Task.WhenAll([t.Task]);
        t.SetResult();
        return whenAll;
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>WhenAllAlloc</td>
<td>.NET 9.0</td>
<td>72.73 ns</td>
<td>1.00</td>
<td>144 B</td>
<td>1.00</td>
</tr>
<tr>
<td>WhenAllAlloc</td>
<td>.NET 10.0</td>
<td>33.06 ns</td>
<td>0.45</td>
<td>72 B</td>
<td>0.50</td>
</tr>
</tbody>
</table>
<p><a href="https://devblogs.microsoft.com/dotnet/an-introduction-to-system-threading-channels/"><code>System.Threading.Channels</code></a> is one of the lesser-known but quite useful areas of threading in .NET (you can watch <a href="https://www.youtube.com/watch?v=J3IQBI5HVOw">Yet Another “Highly Technical Talk” with Hanselman and Toub</a> from Build 2025 to learn more about it). If you find yourself needing a queue to hand off some data between a producer and a consumer, you should likely look into <code>Channel&lt;T&gt;</code>. The library was introduced in .NET Core 3.0 as a small, robust, and fast producer/consumer queueing mechanism; it’s evolved since, such as gaining a <code>ReadAllAsync</code> method for consuming the contents of a channel as an <code>IAsyncEnumerable&lt;T&gt;</code> and a <code>PeekAsync</code> method for peeking at its contents without consuming. The original release supported <code>Channel.CreateUnbounded</code> and <code>Channel.CreateBounded</code> methods, and .NET 9 augmented those with a <code>Channel.CreateUnboundedPrioritized</code>. .NET 10 continues to expand on channels, both with functional improvements (such as with <a href="https://github.com/dotnet/runtime/pull/116097">dotnet/runtime#116097</a>, which adds an unbuffered channel implementation), and with performance improvements.</p>
<p>.NET 10 helps to to reduce overall memory consumption of an application using channels. One of the cross-cutting features channels supports is cancellation: you can cancel pretty much any interaction with a channel, which sports asynchronous methods for both producing and consuming data. When a reader or writer needs to pend, it creates (or reuses a pooled instance of) an <code>AsyncOperation</code> object that gets added to a queue; a later writer or reader that’s then able to satisfy a pending reader or writer dequeues one and marks it as completed. These queues were implemented with arrays, which makes it challenging to remove an entry from the middle of the queue if the associated operation gets canceled. So, rather than trying, it simply left the canceled object in the queue, and then when it would eventually get dequeued, it’s just thrown away and the dequeuer tries again. The theory was that, at steady state, you will quickly dequeue any canceled operations, and it’d be better to not exert a lot of effort to try to remove them more quickly. As it turns out, that assumption was problematic for some scenarios, where the workload wasn’t balanced, e.g. lots of readers would pend and timeout due to lack of writers, and each of those timed out readers would leave behind a canceled item in the queue. The next time a writer would come along, yes, all those canceled readers would get cleared out, but in the meantime, it would manifest as a notable increase in working set.</p>
<p><a href="https://github.com/dotnet/runtime/pull/116021">dotnet/runtime#116021</a> addresses that by switching from array-backed queues to linked-list-based queues. The waiter objects themselves double as the nodes in the linked lists, so the only additional memory overhead is a couple of fields for the previous and next nodes in the linked list. But even that modest increase is undesirable, so as part of the PR, it also tries to find compensating optimizations to balance things out. It’s able to remove a field from <code>Channel&lt;T&gt;</code>‘s custom implementation of <code>IValueTaskSource&lt;T&gt;</code> by applying a similar optimization that was made to <code>ManualResetValueTaskSourceCore&lt;T&gt;</code> in a previous release: it’s incredibly rare for an awaiter to supply an <code>ExecutionContext</code> (via use of the awaiter’s <code>OnCompleted</code> rather than <code>UnsafeOnCompleted</code> method), and even more so for that to happen when there’s also a non-default <code>TaskScheduler</code> or <code>SynchronizationContext</code> that needs to be stored, so rather than using two fields for those concepts, they just get grouped into one (which means that in the super duper rare case where both are needed, it incurs an extra allocation). Another field is removed for storing a <code>CancellationToken</code> on the instance, which on .NET Core can be retrieved from other available state. These changes then actually result in the size of the <code>AsyncOperation</code> waiter instance decreasing rather than increasing. Win win. It’s hard to see the impact of this change on throughput; it’s easier to just see what the impact is on working set in the degenerate case where canceled operations are never removed. If I run this code:</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*"
// dotnet run -c Release -f net10.0 --filter "*"

using System.Threading.Channels;

Channel&lt;int&gt; c = Channel.CreateUnbounded&lt;int&gt;();

for (int i = 0; ; i++)
{
    CancellationTokenSource cts = new();
    var vt = c.Reader.ReadAsync(cts.Token);
    cts.Cancel();
    await ((Task)vt.AsTask()).ConfigureAwait(ConfigureAwaitOptions.SuppressThrowing);

    if (i % 100_000 == 0)
    {
        Console.WriteLine($"Working set: {Environment.WorkingSet:N0}b");
    }
}</code></pre>
<p>in .NET 9 I get output like this, with an ever increasing working set:</p>
<pre><code>Working set: 31,588,352b
Working set: 164,884,480b
Working set: 210,698,240b
Working set: 293,711,872b
Working set: 385,495,040b
Working set: 478,158,848b
Working set: 553,385,984b
Working set: 608,206,848b
Working set: 699,695,104b
Working set: 793,034,752b
Working set: 885,309,440b
Working set: 986,103,808b
Working set: 1,094,234,112b
Working set: 1,156,239,360b
Working set: 1,255,198,720b
Working set: 1,347,604,480b
Working set: 1,439,879,168b
Working set: 1,532,284,928b</code></pre>
<p>and in .NET 10, I get output like this, with a nice level steady state working set:</p>
<pre><code>Working set: 33,030,144b
Working set: 44,826,624b
Working set: 45,481,984b
Working set: 45,613,056b
Working set: 45,875,200b
Working set: 45,875,200b
Working set: 46,006,272b
Working set: 46,006,272b
Working set: 46,006,272b
Working set: 46,006,272b
Working set: 46,006,272b
Working set: 46,006,272b
Working set: 46,006,272b
Working set: 46,006,272b
Working set: 46,006,272b
Working set: 46,006,272b
Working set: 46,006,272b
Working set: 46,006,272b</code></pre>
<h2>Reflection</h2>
<p>.NET 8 added the <code>[UnsafeAccessor]</code> attribute, which enables a developer to write an <code>extern</code> method that matches up with some non-visible member the developer wants to be able to use, and the runtime fixes up the accesses to be just as if the target member was being used directly. .NET 9 then extended it with generic support.</p>
<pre><code>// dotnet run -c Release -f net10.0 --filter "*"

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Reflection;
using System.Runtime.CompilerServices;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private List&lt;int&gt; _list = new List&lt;int&gt;(16);
    private FieldInfo _itemsField = typeof(List&lt;int&gt;).GetField("_items", BindingFlags.NonPublic | BindingFlags.Instance)!;

    private static class Accessors&lt;T&gt;
    {
        [UnsafeAccessor(UnsafeAccessorKind.Field, Name = "_items")]
        public static extern ref T[] GetItems(List&lt;T&gt; list);
    }

    [Benchmark]
    public int[] WithReflection() =&gt; (int[])_itemsField.GetValue(_list)!;

    [Benchmark]
    public int[] WithUnsafeAccessor() =&gt; Accessors&lt;int&gt;.GetItems(_list);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Mean</th>
</tr>
</thead>
<tbody>
<tr>
<td>WithReflection</td>
<td>2.6397 ns</td>
</tr>
<tr>
<td>WithUnsafeAccessor</td>
<td>0.7300 ns</td>
</tr>
</tbody>
</table>
<p>But there are still gaps in that story. The signature of the <code>UnsafeAccessor</code> member needs to align with the signature of the target member, but what if that target member has parameters that aren’t visible to the code writing the <code>UnsafeAccessor</code>? Or, what if the target member is static? There’s no way for the developer to express in the <code>UnsafeAccessor</code> on which type the target member exists.</p>
<p>For these scenarios, <a href="https://github.com/dotnet/runtime/pull/114881">dotnet/runtime#114881</a> augments the story with the <code>[UnsafeAccessorType]</code> attribute. The <code>UnsafeAccessor</code> method can type the relevant parameters as <code>object</code> but then adorn them with an <code>[UnsafeAccessorType("...")]</code> that provides a fully-qualified name of the target type. There are a bunch of examples then of this being used in <a href="https://github.com/dotnet/runtime/pull/115583">dotnet/runtime#115583</a>, which replaces most of the cross-library reflection done between libraries in .NET itself with use of <code>[UnsafeAccessor]</code>. An example of where this is handy is with a cyclic relationship between <code>System.Net.Http</code> and <code>System.Security.Cryptography</code>. <code>System.Net.Http</code> sits above <code>System.Security.Cryptography</code>, referencing it for critical features like <code>X509Certificate</code>. But <code>System.Security.Cryptography</code> needs to be able to make HTTP requests in order to download OCSP information, and with <code>System.Net.Http</code> referencing <code>System.Security.Cryptography</code>, <code>System.Security.Cryptography</code> can’t in turn explicitly reference <code>System.Net.Http</code>. It can, however, use reflection or <code>[UnsafeAccessor]</code> and <code>[UnsafeAccessorType]</code> to do so, and it does. It used to use reflection, now in .NET 10 it uses <code>[UnsafeAccessor]</code>.</p>
<p>There are a few other nice improvements in and around reflection. <a href="https://github.com/dotnet/runtime/pull/105814">dotnet/runtime#105814</a> from <a href="https://github.com/huoyaoyuan">@huoyaoyuan</a> updates <code>ActivatorUtilities.CreateFactory</code> to remove a layer of delegates. <code>CreateFactory</code> returns an <code>ObjectFactory</code> delegate, but under the covers the implementation was creating a <code>Func&lt;...&gt;</code> and then creating an <code>ObjectFactory</code> delegate for that <code>Func&lt;...&gt;</code>‘s <code>Invoke</code> method. The PR changes it to just create the <code>ObjectFactory</code> initially, which means every invocation avoids one layer of delegate invocation.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*"

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Configs;
using BenchmarkDotNet.Environments;
using BenchmarkDotNet.Jobs;
using BenchmarkDotNet.Running;
using Microsoft.Extensions.DependencyInjection;

var config = DefaultConfig.Instance
    .AddJob(Job.Default.WithRuntime(CoreRuntime.Core90).WithNuGet("Microsoft.Extensions.DependencyInjection.Abstractions", "9.0.9").AsBaseline())
    .AddJob(Job.Default.WithRuntime(CoreRuntime.Core10_0).WithNuGet("Microsoft.Extensions.DependencyInjection.Abstractions", "10.0.0-rc.1.25451.107"));

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args, config);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "NuGetReferences")]
public partial class Tests
{
    private IServiceProvider _sp = new ServiceCollection().BuildServiceProvider();
    private ObjectFactory _factory = ActivatorUtilities.CreateFactory(typeof(object), Type.EmptyTypes);

    [Benchmark]
    public object CreateInstance() =&gt; _factory(_sp, null);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>CreateInstance</td>
<td>.NET 9.0</td>
<td>8.136 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>CreateInstance</td>
<td>.NET 10.0</td>
<td>6.676 ns</td>
<td>0.82</td>
</tr>
</tbody>
</table>
<p><a href="https://github.com/dotnet/runtime/pull/112350">dotnet/runtime#112350</a> reduces some overheads and allocations as part of parsing and rendering <code>TypeName</code>s.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Reflection.Metadata;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "t")]
public partial class Tests
{
    [Benchmark]
    [Arguments(typeof(Dictionary&lt;List&lt;int[]&gt;[,], List&lt;int?[][][,]&gt;&gt;[]))]
    public string ParseAndGetName(Type t) =&gt; TypeName.Parse(t.FullName).FullName; 
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>ParseAndGetName</td>
<td>.NET 9.0</td>
<td>5.930 us</td>
<td>1.00</td>
<td>12.25 KB</td>
<td>1.00</td>
</tr>
<tr>
<td>ParseAndGetName</td>
<td>.NET 10.0</td>
<td>4.305 us</td>
<td>0.73</td>
<td>5.75 KB</td>
<td>0.47</td>
</tr>
</tbody>
</table>
<p>And <a href="https://github.com/dotnet/runtime/pull/113803">dotnet/runtime#113803</a> from <a href="https://github.com/teo-tsirpanis">@teo-tsirpanis</a> improves how <code>DebugDirectoryBuilder</code> in <code>System.Reflection.Metadata</code> uses <code>DeflateStream</code> to embed a PDB. The code was previously buffering the compressed output into an intermediate <code>MemoryStream</code>, and then that <code>MemoryStream</code> was being written to the <code>BlobBuilder</code>. With this change, the <code>DeflateStream</code> is wrapped directly around the <code>BlobBuilder</code>, enabling the compressed data to be propagated directly to <code>builder.WriteBytes</code>.</p>
<h2>Primitives and Numerics</h2>
<p>Every time I write one of these “Performance Improvements in .NET” posts, a part of me thinks “how could there possibly be more next time.” That’s especially true for core data types, which have received so much scrutiny over the years. Yet, here we are, with more to look at for .NET 10.</p>
<p><code>DateTime</code> and <code>DateTimeOffset</code> get some love in <a href="https://github.com/dotnet/runtime/pull/111112">dotnet/runtime#111112</a>, in particular with micro-optimizations around how instances are initialized. Similar tweaks show up in <a href="https://github.com/dotnet/runtime/pull/111244">dotnet/runtime#111244</a> for <code>DateOnly</code>, <code>TimeOnly</code>, and <code>ISOWeek</code>.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private DateTimeOffset _dto = new DateTimeOffset(2025, 9, 10, 0, 0, 0, TimeSpan.Zero);

    [Benchmark]
    public DateTimeOffset GetFutureTime() =&gt; _dto + TimeSpan.FromDays(1);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>GetFutureTime</td>
<td>.NET 9.0</td>
<td>6.012 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>GetFutureTime</td>
<td>.NET 10.0</td>
<td>1.029 ns</td>
<td>0.17</td>
</tr>
</tbody>
</table>
<p><code>Guid</code> gets several notable performance improvements in .NET 10. <a href="https://github.com/dotnet/runtime/pull/105654">dotnet/runtime#105654</a> from <a href="https://github.com/SirCxyrtyx">@SirCxyrtyx</a> imbues <code>Guid</code> with an implementation of <code>IUtf8SpanParsable</code>. This not only allows <code>Guid</code> to be used in places where a generic parameter is constrained to <code>IUtf8SpanParsable</code>, it gives <code>Guid</code> overloads of <code>Parse</code> and <code>TryParse</code> that operate on UTF8 bytes. This means if you have UTF8 data, you don’t first need to transcode it to UTF16 in order to parse it, nor use <code>Utf8Parser.TryParse</code>, which isn’t as optimized as is <code>Guid.TryParse</code> (but which does enable parsing out a <code>Guid</code> from the beginning of a larger input).</p>
<pre><code>// dotnet run -c Release -f net10.0 --filter "*"

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Buffers.Text;
using System.Text;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private byte[] _utf8 = Encoding.UTF8.GetBytes(Guid.NewGuid().ToString("N"));

    [Benchmark(Baseline = true)]
    public Guid TranscodeParse()
    {
        Span&lt;char&gt; scratch = stackalloc char[64];
        ReadOnlySpan&lt;char&gt; input = Encoding.UTF8.TryGetChars(_utf8, scratch, out int charsWritten) ?
            scratch.Slice(0, charsWritten) :
            Encoding.UTF8.GetString(_utf8);

        return Guid.Parse(input);
    }

    [Benchmark]
    public Guid Utf8ParserParse() =&gt; Utf8Parser.TryParse(_utf8, out Guid result, out _, 'N') ? result : Guid.Empty;

    [Benchmark]
    public Guid GuidParse() =&gt; Guid.Parse(_utf8);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>TranscodeParse</td>
<td>24.72 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>Utf8ParserParse</td>
<td>19.34 ns</td>
<td>0.78</td>
</tr>
<tr>
<td>GuidParse</td>
<td>16.47 ns</td>
<td>0.67</td>
</tr>
</tbody>
</table>
<p><code>Char</code>, <code>Rune</code>, and <code>Version</code> also gained <code>IUtf8SpanParsable</code> implementations, in <a href="https://github.com/dotnet/runtime/pull/105773">dotnet/runtime#105773</a> from <a href="https://github.com/lilinus">@lilinus</a> and <a href="https://github.com/dotnet/runtime/pull/109252">dotnet/runtime#109252</a> from <a href="https://github.com/lilinus">@lilinus</a>. There’s not much of a performance benefit here for <code>char</code> and <code>Rune</code>; implementing the interface mainly yields consistency and the ability to use these types with generic routines parameterized based on that interface. But <code>Version</code> gains the same kinds of performance (and usability) benefits as did <code>Guid</code>: it now sports support for parsing directly from UTF8, rather than needing to transcode first to UTF16 and then parse that.</p>
<pre><code>// dotnet run -c Release -f net10.0 --filter "*"

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Text;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private byte[] _utf8 = Encoding.UTF8.GetBytes(new Version("123.456.789.10").ToString());

    [Benchmark(Baseline = true)]
    public Version TranscodeParse()
    {
        Span&lt;char&gt; scratch = stackalloc char[64];
        ReadOnlySpan&lt;char&gt; input = Encoding.UTF8.TryGetChars(_utf8, scratch, out int charsWritten) ?
            scratch.Slice(0, charsWritten) :
            Encoding.UTF8.GetString(_utf8);

        return Version.Parse(input);
    }

    [Benchmark]
    public Version GuidParse() =&gt; Version.Parse(_utf8);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>TranscodeParse</td>
<td>46.48 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>GuidParse</td>
<td>35.75 ns</td>
<td>0.77</td>
</tr>
</tbody>
</table>
<p>Sometimes performance improvements come about as a side-effect of other work. <a href="https://github.com/dotnet/runtime/pull/110923">dotnet/runtime#110923</a> was intending to remove some pointer use from <code>Guid</code>‘s formatting implementation, but in doing so, it ended up also slightly improving throughput of the (admittedly rarely used) “X” format.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private char[] _dest = new char[64];
    private Guid _g = Guid.NewGuid();

    [Benchmark]
    public void FormatX() =&gt; _g.TryFormat(_dest, out int charsWritten, "X");
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>FormatX</td>
<td>.NET 9.0</td>
<td>3.0584 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>FormatX</td>
<td>.NET 10.0</td>
<td>0.7873 ns</td>
<td>0.26</td>
</tr>
</tbody>
</table>
<p><code>Random</code> (and its cryptographically-secure counterpart <code>RandomNumberGenerator</code>) continues to improve in .NET 10, with new methods (such as <code>Random.GetString</code> and <code>Random.GetHexString</code> from <a href="https://github.com/dotnet/runtime/pull/112162">dotnet/runtime#112162</a>) for usability, but also importantly with performance improvements to existing methods. Both <code>Random</code> and <code>RandomNumberGenerator</code> were given a handy <code>GetItems</code> method in .NET 8; this method allows a caller to supply a set of choices and the number of items desired, allowing <code>Random{NumberGenerator}</code> to perform “sampling with replacement”, selecting an item from the set that number of times. In .NET 9, these implementations were optimized to special-case a power-of-2 number of choices that’s less than or equal to 256. In such a case, we can avoid many trips to the underlying source of randomness by requesting bytes in bulk, rather than requesting an <code>int</code> per element. With the power-of-2 choice count, we can simply mask each byte to produce the index into the choices while not introducing bias. In .NET 10, <a href="https://github.com/dotnet/runtime/pull/107988">dotnet/runtime#107988</a> extends this to apply to non-power-of-2 cases, as well. We can’t just mask off bits as in the power-of-2 case, but we can do “rejection sampling,” which is just a fancy way of saying “if you randomly get a value outside of the allowed range, try again”.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Security.Cryptography;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private const string Base58 = "123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";

    [Params(30)]
    public int Length { get; set; }

    [Benchmark]
    public char[] WithRandom() =&gt; Random.Shared.GetItems&lt;char&gt;(Base58, Length);

    [Benchmark]
    public char[] WithRandomNumberGenerator() =&gt; RandomNumberGenerator.GetItems&lt;char&gt;(Base58, Length);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Length</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>WithRandom</td>
<td>.NET 9.0</td>
<td>30</td>
<td>144.42 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>WithRandom</td>
<td>.NET 10.0</td>
<td>30</td>
<td>73.68 ns</td>
<td>0.51</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>WithRandomNumberGenerator</td>
<td>.NET 9.0</td>
<td>30</td>
<td>23,179.73 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>WithRandomNumberGenerator</td>
<td>.NET 10.0</td>
<td>30</td>
<td>853.47 ns</td>
<td>0.04</td>
</tr>
</tbody>
</table>
<p><code>decimal</code> operations, specifically multiplication and division, get a performance bump, thanks to <a href="https://github.com/dotnet/runtime/pull/99212">dotnet/runtime#99212</a> from <a href="https://github.com/Daniel-Svensson">@Daniel-Svensson</a>.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private decimal _n = 9.87654321m;
    private decimal _d = 1.23456789m;

    [Benchmark]
    public decimal Divide() =&gt; _n / _d;
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Divide</td>
<td>.NET 9.0</td>
<td>27.09 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>Divide</td>
<td>.NET 10.0</td>
<td>23.68 ns</td>
<td>0.87</td>
</tr>
</tbody>
</table>
<p><code>UInt128</code> division similarly gets some assistance in <a href="https://github.com/dotnet/runtime/pull/99747">dotnet/runtime#99747</a> from <a href="https://github.com/Daniel-Svensson">@Daniel-Svensson</a>, utilizing the X86 <code>DivRem</code> hardware intrinsic when dividing a value that’s larger than a <code>ulong</code> by a value that could fit in a <code>ulong</code>.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private UInt128 _n = new UInt128(123, 456);
    private UInt128 _d = new UInt128(0, 789);

    [Benchmark]
    public UInt128 Divide() =&gt; _n / _d;
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Divide</td>
<td>.NET 9.0</td>
<td>27.3112 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>Divide</td>
<td>.NET 10.0</td>
<td>0.5522 ns</td>
<td>0.02</td>
</tr>
</tbody>
</table>
<p><code>BigInteger</code> gets a few improvements as well. <a href="https://github.com/dotnet/runtime/pull/115445">dotnet/runtime#115445</a> from <a href="https://github.com/Rob-Hague">@Rob-Hague</a> augments its <code>TryWriteBytes</code> method to use a direct memory copy when viable, namely when the number is non-negative such that it doesn’t need twos-complement tweaks.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Numerics;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private BigInteger _value = BigInteger.Parse(string.Concat(Enumerable.Repeat("1234567890", 20)));
    private byte[] _bytes = new byte[256];

    [Benchmark]
    public bool TryWriteBytes() =&gt; _value.TryWriteBytes(_bytes, out _);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>TryWriteBytes</td>
<td>.NET 9.0</td>
<td>27.814 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>TryWriteBytes</td>
<td>.NET 10.0</td>
<td>5.743 ns</td>
<td>0.21</td>
</tr>
</tbody>
</table>
<p>Also rare but fun, if you tried using <code>BigInteger.Parse</code> exactly with the string representation of <code>int.MinValue</code>, you’d end up allocating unnecessarily. That’s addressed by <a href="https://github.com/dotnet/runtime/pull/104666">dotnet/runtime#104666</a> from <a href="https://github.com/kzrnm">@kzrnm</a>, which tweaks the handling of this corner-case so that it’s appropriately recognized as a case that can be represented using a singleton for <code>int.MinValue</code> (the singleton already existed, it just wasn’t applied in this case).</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Numerics;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private string _int32min = int.MinValue.ToString();

    [Benchmark]
    public BigInteger ParseInt32Min() =&gt; BigInteger.Parse(_int32min);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>ParseInt32Min</td>
<td>.NET 9.0</td>
<td>80.54 ns</td>
<td>1.00</td>
<td>32 B</td>
<td>1.00</td>
</tr>
<tr>
<td>ParseInt32Min</td>
<td>.NET 10.0</td>
<td>71.59 ns</td>
<td>0.89</td>
<td>–</td>
<td>0.00</td>
</tr>
</tbody>
</table>
<p>One area that got a lot of attention in .NET 10 is <code>System.Numerics.Tensors</code>. The <code>System.Numerics.Tensors</code> library was introduced in .NET 8, focusing on a <code>TensorPrimitives</code> class that provided various numerical routines on spans of <code>float</code>. .NET 9 then expanded <code>TensorPrimitives</code> with more operations and generic versions of them. Now in .NET 10, <code>TensorPrimitives</code> gains even more operations, with many of the existing ones also made faster for various scenarios.</p>
<p>To start, <a href="https://github.com/dotnet/runtime/pull/112933">dotnet/runtime#112933</a> adds over 70 new overloads to <code>TensorPrimitives</code>, including operations like <code>StdDev</code>, <code>Average</code>, <code>Clamp</code>, <code>DivRem</code>, <code>IsNaN</code>, <code>IsPow2</code>, <code>Remainder</code>, and many more. The majority of these operations are also vectorized, using shared implementations that are parameterized with generic operators. For example, the entirety of the <code>Decrement&lt;T&gt;</code> implementation is:</p>
<pre><code>public static void Decrement&lt;T&gt;(ReadOnlySpan&lt;T&gt; x, Span&lt;T&gt; destination) where T : IDecrementOperators&lt;T&gt; =&gt;
    InvokeSpanIntoSpan&lt;T, DecrementOperator&lt;T&gt;&gt;(x, destination);</code></pre>
<p>where <code>InvokeSpanIntoSpan</code> is a shared routine used by almost 60 methods, each of which supplies its own operator that’s then used in the heavily-optimized routine. In this case, the <code>DecrementOperator&lt;T&gt;</code> is simply this:</p>
<pre><code>private readonly struct DecrementOperator&lt;T&gt; : IUnaryOperator&lt;T, T&gt; where T : IDecrementOperators&lt;T&gt;
{
    public static bool Vectorizable =&gt; true;
    public static T Invoke(T x) =&gt; --x;
    public static Vector128&lt;T&gt; Invoke(Vector128&lt;T&gt; x) =&gt; x - Vector128&lt;T&gt;.One;
    public static Vector256&lt;T&gt; Invoke(Vector256&lt;T&gt; x) =&gt; x - Vector256&lt;T&gt;.One;
    public static Vector512&lt;T&gt; Invoke(Vector512&lt;T&gt; x) =&gt; x - Vector512&lt;T&gt;.One;
}</code></pre>
<p>With that minimal implementation, which provides a decrement implementation for vectorized widths of 128 bits, 256 bits, 512 bits, and scalar, the workhorse routine is able to provide a very efficient implementation.</p>
<pre><code>// Update benchmark.csproj with a package reference to System.Numerics.Tensors.
// dotnet run -c Release -f net10.0 --filter "*"

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Numerics.Tensors;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private float[] _src = Enumerable.Range(0, 1000).Select(i =&gt; (float)i).ToArray();
    private float[] _dest = new float[1000];

    [Benchmark(Baseline = true)]
    public void DecrementManual()
    {
        ReadOnlySpan&lt;float&gt; src = _src;
        Span&lt;float&gt; dest = _dest;
        for (int i = 0; i &lt; src.Length; i++)
        {
            dest[i] = src[i] - 1f;
        }
    }

    [Benchmark]
    public void DecrementTP() =&gt; TensorPrimitives.Decrement(_src, _dest);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>DecrementManual</td>
<td>288.80 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>DecrementTP</td>
<td>22.46 ns</td>
<td>0.08</td>
</tr>
</tbody>
</table>
<p>Wherever possible, these methods also utilize APIs on the underlying <code>Vector128</code>, <code>Vector256</code>, and <code>Vector512</code> types, including new corresponding methods introduced in <a href="https://github.com/dotnet/runtime/pull/111179">dotnet/runtime#111179</a> and <a href="https://github.com/dotnet/runtime/pull/115525">dotnet/runtime#115525</a>, such as <code>IsNaN</code>.</p>
<p>Existing methods are also improved. <a href="https://github.com/dotnet/runtime/pull/111615">dotnet/runtime#111615</a> from <a href="https://github.com/BarionLP">@BarionLP</a> improves <code>TensorPrimitives.SoftMax</code> by avoiding unnecessary recomputation of <code>T.Exp</code>. The softmax function involves computing <code>exp</code> for every element and summing them all together. The output for an element with value <code>x</code> is then the <code>exp(x)</code> divided by that sum. The previous implementation was following that outline, resulting in computing <code>exp</code> twice for each element. We can instead compute <code>exp</code> just once for each element, caching them temporarily in the destination while creating the sum, and then reusing those for the subsequent division, overwriting each with the actual result. The net result is close to doubling the throughput:</p>
<pre><code>// Update benchmark.csproj with a package reference to System.Numerics.Tensors.
// dotnet run -c Release -f net9.0 --filter **

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Configs;
using BenchmarkDotNet.Environments;
using BenchmarkDotNet.Jobs;
using BenchmarkDotNet.Running;
using System.Numerics.Tensors;

var config = DefaultConfig.Instance
    .AddJob(Job.Default.WithRuntime(CoreRuntime.Core90).WithNuGet("System.Numerics.Tensors", "9.0.9").AsBaseline())
    .AddJob(Job.Default.WithRuntime(CoreRuntime.Core10_0).WithNuGet("System.Numerics.Tensors", "10.0.0-rc.1.25451.107"));

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args, config);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "NuGetReferences")]
public partial class Tests
{
    private float[] _src, _dst;

    [GlobalSetup]
    public void Setup()
    {
        Random r = new(42);
        _src = Enumerable.Range(0, 1000).Select(_ =&gt; r.NextSingle()).ToArray();
        _dst = new float[_src.Length];
    }

    [Benchmark]
    public void SoftMax() =&gt; TensorPrimitives.SoftMax(_src, _dst);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>SoftMax</td>
<td>.NET 9.0</td>
<td>1,047.9 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>SoftMax</td>
<td>.NET 10.0</td>
<td>649.8 ns</td>
<td>0.62</td>
</tr>
</tbody>
</table>
<p><a href="https://github.com/dotnet/runtime/pull/111505">dotnet/runtime#111505</a> from <a href="https://github.com/alexcovington">@alexcovington</a> enables <code>TensorPrimitives.Divide&lt;T&gt;</code> to be vectorized for <code>int</code>. The operation already supported vectorization for <code>float</code> and <code>double</code>, for which there’s SIMD hardware-accelerated support for division, but it didn’t support <code>int</code>, which lacks SIMD hardware-accelerated support. This PR teaches the JIT how to emulate SIMD integer division, by converting the <code>int</code>s to <code>double</code>s, doing <code>double</code> division, and then converting back.</p>
<pre><code>// Update benchmark.csproj with a package reference to System.Numerics.Tensors.
// dotnet run -c Release -f net9.0 --filter **

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Configs;
using BenchmarkDotNet.Environments;
using BenchmarkDotNet.Jobs;
using BenchmarkDotNet.Running;
using System.Numerics.Tensors;

var config = DefaultConfig.Instance
    .AddJob(Job.Default.WithRuntime(CoreRuntime.Core90).WithNuGet("System.Numerics.Tensors", "9.0.9").AsBaseline())
    .AddJob(Job.Default.WithRuntime(CoreRuntime.Core10_0).WithNuGet("System.Numerics.Tensors", "10.0.0-rc.1.25451.107"));

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args, config);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "NuGetReferences")]
public partial class Tests
{
    private int[] _n, _d, _dst;

    [GlobalSetup]
    public void Setup()
    {
        Random r = new(42);
        _n = Enumerable.Range(0, 1000).Select(_ =&gt; r.Next(1000, int.MaxValue)).ToArray();
        _d = Enumerable.Range(0, 1000).Select(_ =&gt; r.Next(1, 1000)).ToArray();
        _dst = new int[_n.Length];
    }

    [Benchmark]
    public void Divide() =&gt; TensorPrimitives.Divide(_n, _d, _dst);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Divide</td>
<td>.NET 9.0</td>
<td>1,293.9 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>Divide</td>
<td>.NET 10.0</td>
<td>458.4 ns</td>
<td>0.35</td>
</tr>
</tbody>
</table>
<p><a href="https://github.com/dotnet/runtime/pull/116945">dotnet/runtime#116945</a> further updates <code>TensorPrimitives.Divide</code> (as well as <code>TensorPrimitives.Sign</code> and <code>TensorPrimitives.ConvertToInteger</code>) to be vectorizable when used with <code>nint</code> or <code>nuint</code>. <code>nint</code> can be treated identically to <code>int</code> when in a 32-bit process and to <code>long</code> when in a 64-bit process; same for <code>nuint</code> with <code>uint</code> and <code>ulong</code>, respectively. So anywhere we’re successfully vectorizing for <code>int</code>/<code>uint</code> on 32-bit or <code>long</code>/<code>ulong</code> on 64-bit, we can also successfully vectorize for <code>nint</code>/<code>nuint</code>. <a href="https://github.com/dotnet/runtime/pull/116895">dotnet/runtime#116895</a> also enables vectorizing <code>TensorPrimitives.ConvertTruncating</code> when used to convert <code>float</code> to <code>int</code> or <code>uint</code> and <code>double</code> to <code>long</code> or <code>ulong</code>. Vectorization hadn’t previously been enabled because the underlying operations used had some undefined behavior; that behavior was fixed late in the .NET 9 cycle, such that this vectorization can now be enabled.</p>
<pre><code>// Update benchmark.csproj with a package reference to System.Numerics.Tensors.
// dotnet run -c Release -f net9.0 --filter **

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Configs;
using BenchmarkDotNet.Environments;
using BenchmarkDotNet.Jobs;
using BenchmarkDotNet.Running;
using System.Numerics.Tensors;

var config = DefaultConfig.Instance
    .AddJob(Job.Default.WithRuntime(CoreRuntime.Core90).WithNuGet("System.Numerics.Tensors", "9.0.9").AsBaseline())
    .AddJob(Job.Default.WithRuntime(CoreRuntime.Core10_0).WithNuGet("System.Numerics.Tensors", "10.0.0-rc.1.25451.107"));

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args, config);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "NuGetReferences")]
public partial class Tests
{
    private float[] _src;
    private int[] _dst;

    [GlobalSetup]
    public void Setup()
    {
        Random r = new(42);
        _src = Enumerable.Range(0, 1000).Select(_ =&gt; r.NextSingle() * 1000).ToArray();
        _dst = new int[_src.Length];
    }

    [Benchmark]
    public void ConvertTruncating() =&gt; TensorPrimitives.ConvertTruncating(_src, _dst);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>ConvertTruncating</td>
<td>.NET 9.0</td>
<td>933.86 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>ConvertTruncating</td>
<td>.NET 10.0</td>
<td>41.99 ns</td>
<td>0.04</td>
</tr>
</tbody>
</table>
<p>Not to be left out, <code>TensorPrimitives.LeadingZeroCount</code> is also improved in <a href="https://github.com/dotnet/runtime/pull/110333">dotnet/runtime#110333</a> from <a href="https://github.com/alexcovington">@alexcovington</a>. When AVX512 is available, the change utilizes AVX512 instructions like <code>PermuteVar16x8x2</code> to vectorize <code>LeadingZeroCount</code> for all types supported by <code>Vector512&lt;T&gt;</code>.</p>
<pre><code>// Update benchmark.csproj with a package reference to System.Numerics.Tensors.
// dotnet run -c Release -f net9.0 --filter **

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Configs;
using BenchmarkDotNet.Environments;
using BenchmarkDotNet.Jobs;
using BenchmarkDotNet.Running;
using System.Numerics.Tensors;

var config = DefaultConfig.Instance
    .AddJob(Job.Default.WithRuntime(CoreRuntime.Core90).WithNuGet("System.Numerics.Tensors", "9.0.9").AsBaseline())
    .AddJob(Job.Default.WithRuntime(CoreRuntime.Core10_0).WithNuGet("System.Numerics.Tensors", "10.0.0-rc.1.25451.107"));

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args, config);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "NuGetReferences")]
public partial class Tests
{
    private byte[] _src, _dst;

    [GlobalSetup]
    public void Setup()
    {
        _src = new byte[1000];
        _dst = new byte[_src.Length];
        new Random(42).NextBytes(_src);
    }

    [Benchmark]
    public void LeadingZeroCount() =&gt; TensorPrimitives.LeadingZeroCount(_src, _dst);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>LeadingZeroCount</td>
<td>.NET 9.0</td>
<td>401.60 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>LeadingZeroCount</td>
<td>.NET 10.0</td>
<td>12.33 ns</td>
<td>0.03</td>
</tr>
</tbody>
</table>
<p>In terms of changes that affected the most operations, <a href="https://github.com/dotnet/runtime/pull/116898">dotnet/runtime#116898</a> and <a href="https://github.com/dotnet/runtime/pull/116934">dotnet/runtime#116934</a> take the cake. Together, these PRs extend vectorization for almost 60 distinct operations to also accelerate for <code>Half</code>: <code>Abs</code>, <code>Add</code>, <code>AddMultiply</code>, <code>BitwiseAnd</code>, <code>BitwiseOr</code>, <code>Ceiling</code>, <code>Clamp</code>, <code>CopySign</code>, <code>Cos</code>, <code>CosPi</code>, <code>Cosh</code>, <code>CosineSimilarity</code>, <code>Decrement</code>, <code>DegreesToRadians</code>, <code>Divide</code>, <code>Exp</code>, <code>Exp10</code>, <code>Exp10M1</code>, <code>Exp2</code>, <code>Exp2M1</code>, <code>ExpM1</code>, <code>Floor</code>, <code>FusedAddMultiply</code>, <code>Hypot</code>, <code>Increment</code>, <code>Lerp</code>, <code>Log</code>, <code>Log10</code>, <code>Log10P1</code>, <code>Log2</code>, <code>Log2P1</code>, <code>LogP1</code>, <code>Max</code>, <code>MaxMagnitude</code>, <code>MaxMagnitudeNumber</code>, <code>MaxNumber</code>, <code>Min</code>, <code>MinMagnitude</code>, <code>MinMagnitudeNumber</code>, <code>MinNumber</code>, <code>Multiply</code>, <code>MultiplyAdd</code>, <code>MultiplyAddEstimate</code>, <code>Negate</code>, <code>OnesComplement</code>, <code>Reciprocal</code>, <code>Remainder</code>, <code>Round</code>, <code>Sigmoid</code>, <code>Sin</code>, <code>SinPi</code>, <code>Sinh</code>, <code>Sqrt</code>, <code>Subtract</code>, <code>Tan</code>, <code>TanPi</code>, <code>Tanh</code>, <code>Truncate</code>, and <code>Xor</code>. The challenge here is that <code>Half</code> doesn’t have accelerated hardware support, and today is not even supported by the vector types. In fact, even for its scalar operations, <code>Half</code> is manipulated internally by converting it to a <code>float</code>, performing the relevant operation as <code>float</code>, and then casting back, e.g. here’s the implementation of the <code>Half</code> multiplication operator:</p>
<pre><code>public static Half operator *(Half left, Half right) =&gt; (Half)((float)left * (float)right);</code></pre>
<p>For all of these <code>TensorPrimitives</code> operations, they previously would treat <code>Half</code> like any other unaccelerated type, and would just run a scalar loop that performed the operation on each <code>Half</code>. That means for each element, we’re converting it to <code>float</code>, then performing the operation, and then converting it back. As luck would have it, though, <code>TensorPrimitives</code> already defines the <code>ConvertToSingle</code> and <code>ConvertToHalf</code> methods, which are accelerated. We can then reuse those methods to do the same thing that’s already done for scalar operations but do it vectorized: take a vector of <code>Half</code>s, convert them all to <code>float</code>s, process all the <code>float</code>s, and convert them all back to <code>Half</code>s. Of course, I already stated that the vector types don’t support <code>Half</code>, so how can we “take a vector of <code>Half</code>“? By reinterpret casting the <code>Span&lt;Half&gt;</code> to <code>Span&lt;short&gt;</code> (or <code>Span&lt;ushort&gt;</code>), which allows us to smuggle the <code>Half</code>s through. And, as it turns out, even for scalar, the very first thing <code>Half</code>‘s <code>float</code> cast operator does is convert it to a <code>short</code>.</p>
<p>The net result is that a ton of operations can now be accelerated for <code>Half</code>.</p>
<pre><code>// Update benchmark.csproj with a package reference to System.Numerics.Tensors.
// dotnet run -c Release -f net9.0 --filter **

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Configs;
using BenchmarkDotNet.Environments;
using BenchmarkDotNet.Jobs;
using BenchmarkDotNet.Running;
using System.Numerics.Tensors;

var config = DefaultConfig.Instance
    .AddJob(Job.Default.WithRuntime(CoreRuntime.Core90).WithNuGet("System.Numerics.Tensors", "9.0.9").AsBaseline())
    .AddJob(Job.Default.WithRuntime(CoreRuntime.Core10_0).WithNuGet("System.Numerics.Tensors", "10.0.0-rc.1.25451.107"));
BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args, config);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "NuGetReferences")]
public partial class Tests
{
    private Half[] _x, _y, _dest;

    [GlobalSetup]
    public void Setup()
    {
        _x = new Half[1000];
        _y = new Half[_x.Length];
        _dest = new Half[_x.Length];
        var random = new Random(42);
        for (int i = 0; i &lt; _x.Length; i++)
        {
            _x[i] = (Half)random.NextSingle();
            _y[i] = (Half)random.NextSingle();
        }
    }

    [Benchmark]
    public void Add() =&gt; TensorPrimitives.Add(_x, _y, _dest);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Add</td>
<td>.NET 9.0</td>
<td>5,984.3 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>Add</td>
<td>.NET 10.0</td>
<td>481.7 ns</td>
<td>0.08</td>
</tr>
</tbody>
</table>
<p>The <code>System.Numerics.Tensors</code> library in .NET 10 now also includes stable APIs for tensor types (which use <code>TensorPrimitives</code> in their implementations). This includes a <code>Tensor&lt;T&gt;</code>, <code>ITensor&lt;,&gt;</code>, <code>TensorSpan&lt;T&gt;</code>, and <code>ReadOnlyTensorSpan&lt;T&gt;</code>. One of the really interesting things about these types is that they take advantage of the new C# 14 compound operators feature, and do so for a significant performance benefit. In previous versions of C#, you’re able to write custom operators, for example an addition operator:</p>
<pre><code>public class C 
{
    public int Value;

    public static C operator +(C left, C right) =&gt; new() { Value = left.Value + right.Value };
}</code></pre>
<p>With that type, I can write code like:</p>
<pre><code>C a = new() { Value = 42 };
C b = new() { Value = 84 };
C c = a + b;

Console.WriteLine(c.Value);</code></pre>
<p>which will print out <code>126</code>. I can also change the code to use a compound operator, <code>+=</code>, like this:</p>
<pre><code>C a = new() { Value = 42 };
C b = new() { Value = 84 };
a += b;

Console.WriteLine(a.Value);</code></pre>
<p>which will also print out <code>126</code>, because the <code>a += b</code> is always identical to <code>a = a + b</code>… or, at least it was. Now with C# 14, it’s possible for a type to not only define a <code>+</code> operator, it can also define a <code>+=</code> operator. If a type defines a <code>+=</code> operator, it will be used rather than expanding <code>a += b</code> as shorthand for <code>a = a + b</code>. And that has performance ramifications.</p>
<p>A tensor is basically a multidimensional array, and as with arrays, these can be big… really big. If I have a sequence of operations:</p>
<pre><code>Tensor&lt;int&gt; t1 = ...;
Tensor&lt;int&gt; t2 = ...;
for (int i = 0; i &lt; 3; i++)
{
    t1 += t2;
}</code></pre>
<p>and each of those <code>t1 += t2</code>s exands into <code>t1 = t1 + t2</code>, then for each I’m allocating a brand new tensor. If they’re big, that gets expensive right quick. But C# 14’s new user-defined compound operators, as initially added to the compiler in <a href="https://github.com/dotnet/roslyn/pull/78400">dotnet/roslyn#78400</a>, enable mutation of the target.</p>
<pre><code>public class C 
{
    public int Value;

    public static C operator +(C left, C right) =&gt; new() { Value = left.Value + right.Value };
    public static void operator +=(C other) =&gt; left.Value += other.Value;
}</code></pre>
<p>And that means that such compound operators on the tensor types can just update the target tensor in place rather than allocating a whole new (possibly very large) data structure for each computation. <a href="https://github.com/dotnet/runtime/pull/117997">dotnet/runtime#117997</a> adds all of these compound operators for the tensor types. (Not only are these using C# 14 user-defined compound operators, they’re doing so as extension operators, using the new C# 14 extension types feature. Fun!)</p>
<h2>Collections</h2>
<p>Handling collections of data is the lifeblood of any application, and as such every .NET release tries to eke out even more performance from collections and collection processing.</p>
<h3>Enumeration</h3>
<p>Iterating through collections is one of the most common things developers do. To make this as efficient as possible, the most prominent collection types in .NET (e.g. <code>List&lt;T&gt;</code>) expose struct-based enumerators (e.g. <code>List&lt;T&gt;.Enumerator</code>) which their public <code>GetEnumerator()</code> methods then return in a strongly-typed manner:</p>
<pre><code>public Enumerator GetEnumerator() =&gt; new Enumerator(this);</code></pre>
<p>This is in addition to their <code>IEnumerable&lt;T&gt;.GetEnumerator()</code> implementation, which ends up being implemented via an “explicit” interface implementation (“explicit” means the relevant method provides the interface method implementation but does not show up as a public method on the type itself), e.g. <code>List&lt;T&gt;</code>‘s implementation:</p>
<pre><code>IEnumerator&lt;T&gt; IEnumerable&lt;T&gt;.GetEnumerator() =&gt;
    Count == 0 ? SZGenericArrayEnumerator&lt;T&gt;.Empty :
    GetEnumerator();</code></pre>
<p>Directly <code>foreach</code>‘ing over the collection allows the C# compiler to bind to the struct-based enumerator, enabling avoiding the enumerator allocation and being able to directly see the non-virtual methods on the enumerator, rather than working with an <code>IEnumerator&lt;T&gt;</code> and the interface dispatch required to invoke methods on it. That, however, falls apart once the collection is used polymorphically as an <code>IEnumerable&lt;T&gt;</code>; at that point, the <code>IEnumerable&lt;T&gt;.GetEnumerator()</code> is used, which is forced to allocate a new enumerator instance (except for special-cases, such as how <code>List&lt;T&gt;</code>‘s implementation shown above returns a singleton enumerator when the collection is empty).</p>
<p>Thankfully, as noted earlier in the JIT section, the JIT has been gaining super powers around dynamic PGO, escape analysis, and stack allocation. This means that in many situations, the JIT is now able to see that the most common concrete type for a given call site is a specific enumerator type and generate code specific to when it is that type, devirtualizing the calls, possibly inlining them, and then, if it’s able to do so sufficiently, stack allocating the enumerator. With the progress that’s been made in .NET 10, this now happens very frequently for arrays and <code>List&lt;T&gt;</code>. While the JIT is able to do this in general regardless of an object’s type, the ubiquity of enumeration makes it all that much more important for <code>IEnumerator&lt;T&gt;</code>, so <a href="https://github.com/dotnet/runtime/pull/116978">dotnet/runtime#116978</a> marks <code>IEnumerator&lt;T&gt;</code> as an <code>[Intrinsic]</code>, giving the JIT the ability to better reason about it.</p>
<p>However, some enumerators still needed a bit of help. Besides <code>T[]</code>, <code>List&lt;T&gt;</code> is the most popular collection type in .NET, and with the JIT changes, many <code>foreach</code>s of an <code>IEnumerable&lt;T&gt;</code> that are actually <code>List&lt;T&gt;</code> will successfully have the enumerator stack allocated. Awesome. That awesomeness dwindled, however, when trying out different sized lists. This is a benchmark that tests out enumerating a <code>List&lt;T&gt;</code> typed as <code>IEnumerable&lt;T&gt;</code>, with different lengths, along with benchmark results from early August 2025 (around .NET 10 Preview 7).</p>
<pre><code>// dotnet run -c Release -f net10.0 --filter **

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private IEnumerable&lt;int&gt; _enumerable;

    [Params(500, 5000, 15000)]
    public int Count { get; set; }

    [GlobalSetup]
    public void Setup() =&gt; _enumerable = Enumerable.Range(0, Count).ToList();

    [Benchmark]
    public int Sum()
    {
        int sum = 0;
        foreach (int item in _enumerable) sum += item;
        return sum;
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Count</th>
<th>Mean</th>
<th>Allocated</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sum</td>
<td>500</td>
<td>214.1 ns</td>
<td>–</td>
</tr>
<tr>
<td>Sum</td>
<td>5000</td>
<td>4,767.1 ns</td>
<td>40 B</td>
</tr>
<tr>
<td>Sum</td>
<td>15000</td>
<td>13,824.4 ns</td>
<td>40 B</td>
</tr>
</tbody>
</table>
<p>Note that for the <code>500</code> element <code>List&lt;T&gt;</code>, the allocation column shows that nothing was allocated on the heap, as the enumerator was successfully stack allocated. Fabulous. But then just increasing the size of the list caused it to no longer be stack-allocated. Why? The reason for the allocation in the jump from <code>500</code> to <code>5000</code> has to do with dynamic PGO combined with how <code>List&lt;T&gt;</code>‘s enumerator was written oh so many years ago.</p>
<p><code>List&lt;T&gt;</code>‘s enumerator’s <code>MoveNext</code> was structured like this:</p>
<pre><code>public bool MoveNext()
{
    if (_version == _list._version &amp;&amp; ((uint)_index &lt; (uint)_list._size))
    {
        ... // handle successfully getting next element
        return true;
    }

    return MoveNextRare();
}

private bool MoveNextRare()
{
    ... // handle version mismatch and/or returning false for completed enumeration
}</code></pre>
<p>The <code>Rare</code> in the name gives a hint as to why it’s split like this. The <code>MoveNext</code> method was kept as thin as possible for the common case of invoking <code>MoveNext</code>, namely all successful calls that return <code>true</code>; the only time <code>MoveNextRare</code> is needed, other than when the enumerator is misused, is for the final call to it after all elements have been yielded. That streamlining of <code>MoveNext</code> itself was done to make <code>MoveNext</code> inlineable. However, a lot has changed since this code was written, making it less important, and the separating out of <code>MoveNextRare</code> has a really interesting interaction with dynamic PGO. One of the things dynamic PGO looks for is whether code is considered hot (used a lot) or cold (used rarely), and that data influences whether a method should be considered for inlining. For shorter lists, dynamic PGO will see <code>MoveNextRare</code> invoked a reasonable number of times, and will consider it for inlining. And if all of the calls to the enumerator are inlined, the enumerator instance can avoid escaping the call frame, and can then be stack allocated. But once the list length grows to a much larger amount, that <code>MoveNextRare</code> method will start to look really cold, will struggle to be inlined, and will then allow the enumerator instance to escape, preventing it from being stack allocated. <a href="https://github.com/dotnet/runtime/pull/118425">dotnet/runtime#118425</a> recognizes that times have changed since this enumerator was written, with many changes to inlining heuristics and PGO and the like; it undoes the separating out of <code>MoveNextRare</code> and simplifies the enumerator. With how the system works today, the re-combined <code>MoveNext</code> is still inlineable, with or without PGO, and we’re able to stack allocate at the larger size.</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Count</th>
<th>Mean</th>
<th>Allocated</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sum</td>
<td>500</td>
<td>221.2 ns</td>
<td>–</td>
</tr>
<tr>
<td>Sum</td>
<td>5000</td>
<td>2,153.6 ns</td>
<td>–</td>
</tr>
<tr>
<td>Sum</td>
<td>15000</td>
<td>14,724.9 ns</td>
<td>40 B</td>
</tr>
</tbody>
</table>
<p>With that fix, we still had an issue, though. We’re now avoiding the allocation at lengths 500 and 5000, but at 15,000 we still see the enumerator being allocated. Now why? This has to do with <a href="https://devblogs.microsoft.com/dotnet/performance_improvements_in_net_7/#on-stack-replacement">OSR (on-stack replacement)</a>, which was introduced in .NET 7 as a key enabler for allowing tiered compilation to be used with methods containing loops. OSR allows for a method to be recompiled with optimizations even while it’s executing, and for an invocation of the method to jump from the unoptimized code for the method to the corresponding location in the newly optimized method. While OSR is awesome, it unfortunately causes some complications here. Once the list gets long enough, an invocation of the tier 0 (unoptimized) method will transition to the OSR optimized method… but OSR methods don’t contain dynamic PGO instrumentation (they used to, but it was removed because it led to problems if the instrumented code never got recompiled again and thus suffered regressions due to forever-more running with the instrumentation probes in place). Without the instrumentation, and in particular without the instrumentation for the tail portion of the method (where the enumerator’s <code>Dispose</code> method is invoked), even though <code>List&lt;T&gt;.Dispose</code> is a nop, the JIT may not be able to do the guarded devirtualization that enables the <code>IEnumerator&lt;T&gt;.Dispose</code> to be devirtualized and inlined. Meaning, ironically, that the nop <code>Dispose</code> causes escape analysis to see the enumerator instance escape, such that it can’t be stack allocated. Whew.</p>
<p>Thankfully, <a href="https://github.com/dotnet/runtime/pull/118461">dotnet/runtime#118461</a> addresses that in the JIT. Specifically for enumerators, this PR enables dynamic PGO to infer the missing instrumentation based on the earlier probes used with the other enumerator methods, which then enables it to successfully devirtualize and inline <code>Dispose</code>. So, for .NET 10, and the same benchmark, we end up with this lovely sight:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Count</th>
<th>Mean</th>
<th>Allocated</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sum</td>
<td>500</td>
<td>216.5 ns</td>
<td>–</td>
</tr>
<tr>
<td>Sum</td>
<td>5000</td>
<td>2,082.4 ns</td>
<td>–</td>
</tr>
<tr>
<td>Sum</td>
<td>15000</td>
<td>6,525.3 ns</td>
<td>–</td>
</tr>
</tbody>
</table>
<p>Other types needed a bit of help as well. <a href="https://github.com/dotnet/runtime/pull/118467">dotnet/runtime#118467</a> addresses <code>PriorityQueue&lt;TElement, TPriority&gt;</code>‘s enumerator; it’s enumerator was a port of <code>List&lt;T&gt;</code>‘s and so was changed similarly.</p>
<p>Separately, <a href="https://github.com/dotnet/runtime/pull/117328">dotnet/runtime#117328</a> streamline’s <code>Stack&lt;T&gt;</code>‘s enumerator type, removing around half the lines of code that previously composed it. The previous enumerator’s <code>MoveNext</code> incurred five branches on the way to grabbing most next elements:</p>
<ul>
<li>It first did a version check, comparing the stack’s version number against the enumerator’s captured version number, to ensure the stack hadn’t been mutated since the time the enumerator was grabbed.</li>
<li>It then checked to see whether this was the first call to the enumerator, taking one path that lazily-initialized some state if it was and another path assuming already-initialized state if not.</li>
<li>Assuming this wasn’t the first call, it then checked whether enumeration had previously ended.</li>
<li>Assuming it hadn’t, it then checked whether there’s anything left to enumerate.</li>
<li>And finally, it dereferenced the underlying array, incurring a bounds check.</li>
</ul>
<p>The new implementation cuts that in half. It relies on the enumerator’s constructor initializing the current index to the length of the stack, such that each <code>MoveNext</code> call just decrements this value. When the data is exhausted, the count will go negative. This means that we can combine a whole bunch of these checks into a single check:</p>
<pre><code>if ((uint)index &lt; (uint)array.Length)</code></pre>
<p>and we’re left with just two branches on the way to reading any element: the version check and whether the index is in bounds. That reduction not only means there’s less code to process and fewer branches that might be improperly predicted, it also shrinks the size of the members to the point where they’re much more likely to be inlined, which in turns makes it much more likely that the enumerator object can be stack allocated.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private Stack&lt;int&gt; _direct = new Stack&lt;int&gt;(Enumerable.Range(0, 10));
    private IEnumerable&lt;int&gt; _enumerable = new Stack&lt;int&gt;(Enumerable.Range(0, 10));

    [Benchmark]
    public int SumDirect()
    {
        int sum = 0;
        foreach (int item in _direct) sum += item;
        return sum;
    }

    [Benchmark]
    public int SumEnumerable()
    {
        int sum = 0;
        foreach (int item in _enumerable) sum += item;
        return sum;
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>Code Size</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>SumDirect</td>
<td>.NET 9.0</td>
<td>23.317 ns</td>
<td>1.00</td>
<td>331 B</td>
<td>–</td>
<td>NA</td>
</tr>
<tr>
<td>SumDirect</td>
<td>.NET 10.0</td>
<td>4.502 ns</td>
<td>0.19</td>
<td>55 B</td>
<td>–</td>
<td>NA</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>SumEnumerable</td>
<td>.NET 9.0</td>
<td>30.893 ns</td>
<td>1.00</td>
<td>642 B</td>
<td>40 B</td>
<td>1.00</td>
</tr>
<tr>
<td>SumEnumerable</td>
<td>.NET 10.0</td>
<td>7.906 ns</td>
<td>0.26</td>
<td>381 B</td>
<td>–</td>
<td>0.00</td>
</tr>
</tbody>
</table>
<p><a href="https://github.com/dotnet/runtime/pull/117341">dotnet/runtime#117341</a> does something similar but for <code>Queue&lt;T&gt;</code>. <code>Queue&lt;T&gt;</code> has an interesting complication when compared to <code>Stack&lt;T&gt;</code>, which is that it can wrap around the length of the underlying array. Whereas with <code>Stack&lt;T&gt;</code>, we can always start at a particular index and just count down to 0, using that index as the offset into the array, with <code>Queue&lt;T&gt;</code>, the starting index can be anywhere in the array, and when walking from that index to the last element, we might need to wrap around back to the beginning. Such wrapping can be accomplished using <code>% array.Length</code> (which is what <code>Queue&lt;T&gt;</code> does on .NET Framework), but such a division operation can be relatively costly. An alternative, since we know the count can never be more than the array’s length, is to check whether we’ve already walked past the end of the array, and if we have, then subtract the array’s length to get to the corresponding location from the start of the array. The existing implementation in .NET 9 did just that:</p>
<pre><code>if (index &gt;= array.Length)
{
    index -= array.Length; // wrap around if needed
}

_currentElement = array[index];</code></pre>
<p>That is two branches, one for the check against the array length, and one for the bounds check. The bounds check can’t be eliminated here because the JIT hasn’t seen proof that the index is actually in-bounds and thus needs to be defensive. Instead, we can write it like this:</p>
<pre><code>if ((uint)index &lt; (uint)array.Length)
{
    _currentElement = array[index];
}
else
{
    index -= array.Length;
    _currentElement = array[index];
}</code></pre>
<p>An enumeration of a queue can logically be split into two parts: the elements from the head index to the end of the array, and the elements from the beginning of the array to the tail. All of the former now fall into the first block, which incurs only one branch because the JIT can use the knowledge gleaned from the comparison to eliminate the bounds check. It only incurs a bounds check when in the second portion of the enumeration.</p>
<p>We can more easily visualize the branch savings by using benchmarkdotnet’s <code>HardwareCounters</code> diagnoser, asking it to track <code>HardwareCounter.BranchInstructions</code> (this diagnoser only works on Windows). Note here, as well, that the changes not only improve throughput, they also enable the boxed enumerator to be stack allocated.</p>
<pre><code>// This benchmark was run on Windows for the HardwareCounters diagnoser to work.
// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using BenchmarkDotNet.Diagnosers;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HardwareCounters(HardwareCounter.BranchInstructions)]
[MemoryDiagnoser(displayGenColumns: false)]
[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private Queue&lt;int&gt; _direct;
    private IEnumerable&lt;int&gt; _enumerable;

    [GlobalSetup]
    public void Setup()
    {
        _direct = new Queue&lt;int&gt;(Enumerable.Range(0, 10));
        for (int i = 0; i &lt; 5; i++)
        {
            _direct.Enqueue(_direct.Dequeue());
        }

        _enumerable = _direct;
    }

    [Benchmark]
    public int SumDirect()
    {
        int sum = 0;
        foreach (int item in _direct) sum += item;
        return sum;
    }

    [Benchmark]
    public int SumEnumerable()
    {
        int sum = 0;
        foreach (int item in _enumerable) sum += item;
        return sum;
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>BranchInstructions/Op</th>
<th>Code Size</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>SumDirect</td>
<td>.NET 9.0</td>
<td>24.340 ns</td>
<td>1.00</td>
<td>79</td>
<td>251 B</td>
<td>–</td>
<td>NA</td>
</tr>
<tr>
<td>SumDirect</td>
<td>.NET 10.0</td>
<td>7.192 ns</td>
<td>0.30</td>
<td>37</td>
<td>96 B</td>
<td>–</td>
<td>NA</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>SumEnumerable</td>
<td>.NET 9.0</td>
<td>30.695 ns</td>
<td>1.00</td>
<td>103</td>
<td>531 B</td>
<td>40 B</td>
<td>1.00</td>
</tr>
<tr>
<td>SumEnumerable</td>
<td>.NET 10.0</td>
<td>8.672 ns</td>
<td>0.28</td>
<td>50</td>
<td>324 B</td>
<td>–</td>
<td>0.00</td>
</tr>
</tbody>
</table>
<p><code>ConcurrentDictionary&lt;TKey, TValue&gt;</code> also gets in on the fun. The dictionary is implemented as a collection of “buckets”, each of which of which is a linked list of entries. It had a fairly complicated enumerator for processing these structures, relying on jumping between cases of a switch statement, e.g.</p>
<pre><code>switch (_state)
{
    case StateUninitialized:
        ... // Initialize on first MoveNext.
        goto case StateOuterloop;

    case StateOuterloop:
        // Check if there are more buckets in the dictionary to enumerate.
        if ((uint)i &lt; (uint)buckets.Length)
        {
            // Move to the next bucket.
            ...
            goto case StateInnerLoop;
        }
        goto default;

    case StateInnerLoop:
        ... // Yield elements from the current bucket.
        goto case StateOuterloop;

    default:
        // Done iterating.
        ...
}</code></pre>
<p>If you squint, there are nested loops here, where we’re enumerating each bucket and for each bucket enumerating its contents. With how this is structured, however, from the JIT’s perspective, we could enter those loops from any of those <code>case</code>s, depending on the current value of <code>_state</code>. That produces something referred to as an “irreducible loop,” which is a loop that has multiple possible entry points. Imagine you have:</p>
<pre><code>A:
if (someCondition) goto B;
...

B:
if (someOtherCondition) goto A;</code></pre>
<p>Labels <code>A</code> and <code>B</code> form a loop, but that loop can be entered by jumping to either <code>A</code> or to <code>B</code>. If the compiler could prove that this loop were only ever enterable from <code>A</code> or only ever enterable from <code>B</code>, then the loop would be “reducible.” Irreducible loops are much more complex than reducible loops for a compiler to deal with, as they have more complex control and data flow and in general are harder to analyze. <a href="https://github.com/dotnet/runtime/pull/116949">dotnet/runtime#116949</a> rewrites the <code>MoveNext</code> method to be a more typical <code>while</code> loop, which is not only easier to read and maintain, it’s also reducible and more efficient, and because it’s more streamlined, it’s also inlineable and enables possible stack allocation.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Collections.Concurrent;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private ConcurrentDictionary&lt;int, int&gt; _ints = new(Enumerable.Range(0, 1000).ToDictionary(i =&gt; i, i =&gt; i));

    [Benchmark]
    public int EnumerateInts()
    {
        int sum = 0;
        foreach (var kvp in _ints) sum += kvp.Value;
        return sum;
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>EnumerateInts</td>
<td>.NET 9.0</td>
<td>4,232.8 ns</td>
<td>1.00</td>
<td>56 B</td>
<td>1.00</td>
</tr>
<tr>
<td>EnumerateInts</td>
<td>.NET 10.0</td>
<td>664.2 ns</td>
<td>0.16</td>
<td>–</td>
<td>0.00</td>
</tr>
</tbody>
</table>
<h3>LINQ</h3>
<p>All of these examples show enumerating collections using a <code>foreach</code> loop, and while that’s obviously incredibly common, so too is using LINQ (Language Integrated Query) to enumerate and process collections. For in-memory collections, LINQ provides literally hundreds of extension methods for performing maps, filters, sorts, and a plethora of other operations over enumerables. It is incredibly handy, is thus used <em>everywhere</em>, and is thus important to optimize. Every release of .NET has seen improvements to LINQ, and that continues in .NET 10.</p>
<p>Most prominent from a performance perspective in this release are the changes to <code>Contains</code>. As discussed in depth in <a href="https://www.youtube.com/watch?v=xKr96nIyCFM">Deep .NET: Deep Dive on LINQ with Stephen Toub and Scott Hanselman</a> and <a href="https://www.youtube.com/watch?v=W4-NVVNwCWs">Deep .NET: An even DEEPER Dive into LINQ with Stephen Toub and Scott Hanselman</a>, the LINQ methods are able to pass information between them by using specialized internal <code>IEnumerable&lt;T&gt;</code> implementations. When you call <code>Select</code>, that might return an <code>ArraySelectIterator&lt;TSource, TResult&gt;</code> or an <code>IListSelectIterator&lt;TSource, TResult&gt;</code> or an <code>IListSkipTakeSelectIterator&lt;TSource, TResult&gt;</code> or one of any number of other types. Each of these types has fields that carry information about the source (e.g. the <code>IListSkipTakeSelectIterator&lt;TSource, TResult&gt;</code> has fields not only for the <code>IList&lt;TSource&gt;</code> source and the <code>Func&lt;TSource, TResult&gt;</code> selector, but also for the tracked min and max bounds based on previous <code>Skip</code> and <code>Take</code> calls), and they have overrides of virtual methods that allow for various operations to be specialized. This means sequences of LINQ methods can be optimized. For example, <code>source.Where(...).Select(...)</code> is optimized a) to combine both the filter and the map delegates into a single <code>IEnumerable&lt;T&gt;</code>, thus removing the overhead of an extra layer of interface dispatch, and b) to perform operations specific to the original source data type (e.g. if <code>source</code> was an array, the processing can be done directly on that array rather than via <code>IEnumerator&lt;T&gt;</code>).</p>
<p>Many of these optimizations make the most sense when a method returns an <code>IEnumerable&lt;T&gt;</code> that happens to be the result of a LINQ query. The producer of that method doesn’t know how the consumer will be consuming it, and the consumer doesn’t know the details of how the producer produced it. But since the LINQ methods flow context via the concrete implementations of <code>IEnumerable&lt;T&gt;</code>, significant optimizations are possible for interesting combinations of consumer and producer methods. For example, let’s say a producer of an <code>IEnumerable&lt;T&gt;</code> decides they want to always return data in ascending order, so they do:</p>
<pre><code>public static IEnumerable&lt;T&gt; GetData()
{
    ...
    return data.OrderBy(s =&gt; s.CreatedAt);
}</code></pre>
<p>But as it turns out, the consumer won’t be looking at all of the elements, and instead just wants the first:</p>
<pre><code>T value = GetData().First();</code></pre>
<p>LINQ optimizes this by having the enumerable returned from <code>OrderBy</code> provide a specialized implementation of <code>First</code>/<code>FirstOrDefault</code>: it doesn’t need to perform an <code>O(N log N)</code> sort (or allocate a lot of memory to hold all of the keys), it can instead just do an <code>O(N)</code> search for the smallest element in the source, because the smallest element would be the first to be yielded from <code>OrderBy</code>.</p>
<p><code>Contains</code> is ripe for these kinds of optimizations as well, e.g. <code>OrderBy</code>, <code>Distinct</code>, and <code>Reverse</code> all entail non-trivial processing and/or allocation, but if followed by a <code>Contains</code>, all that work can be skipped, as the <code>Contains</code> can just search the source directly. With <a href="https://github.com/dotnet/runtime/pull/112684">dotnet/runtime#112684</a>, this set of optimizations is extended to <code>Contains</code>, with almost 30 specialized implementations of <code>Contains</code> across the various iterator specializations.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private IEnumerable&lt;int&gt; _source = Enumerable.Range(0, 1000).ToArray();

    [Benchmark]
    public bool AppendContains() =&gt; _source.Append(100).Contains(999);

    [Benchmark]
    public bool ConcatContains() =&gt; _source.Concat(_source).Contains(999);

    [Benchmark]
    public bool DefaultIfEmptyContains() =&gt; _source.DefaultIfEmpty(42).Contains(999);

    [Benchmark]
    public bool DistinctContains() =&gt; _source.Distinct().Contains(999);

    [Benchmark]
    public bool OrderByContains() =&gt; _source.OrderBy(x =&gt; x).Contains(999);

    [Benchmark]
    public bool ReverseContains() =&gt; _source.Reverse().Contains(999);

    [Benchmark]
    public bool UnionContains() =&gt; _source.Union(_source).Contains(999);

    [Benchmark]
    public bool SelectManyContains() =&gt; _source.SelectMany(x =&gt; _source).Contains(999);

    [Benchmark]
    public bool WhereSelectContains() =&gt; _source.Where(x =&gt; true).Select(x =&gt; x).Contains(999);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>AppendContains</td>
<td>.NET 9.0</td>
<td>2,931.97 ns</td>
<td>1.00</td>
<td>88 B</td>
<td>1.00</td>
</tr>
<tr>
<td>AppendContains</td>
<td>.NET 10.0</td>
<td>52.06 ns</td>
<td>0.02</td>
<td>56 B</td>
<td>0.64</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>ConcatContains</td>
<td>.NET 9.0</td>
<td>3,065.17 ns</td>
<td>1.00</td>
<td>88 B</td>
<td>1.00</td>
</tr>
<tr>
<td>ConcatContains</td>
<td>.NET 10.0</td>
<td>54.58 ns</td>
<td>0.02</td>
<td>56 B</td>
<td>0.64</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>DefaultIfEmptyContains</td>
<td>.NET 9.0</td>
<td>39.21 ns</td>
<td>1.00</td>
<td>–</td>
<td>NA</td>
</tr>
<tr>
<td>DefaultIfEmptyContains</td>
<td>.NET 10.0</td>
<td>32.89 ns</td>
<td>0.84</td>
<td>–</td>
<td>NA</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>DistinctContains</td>
<td>.NET 9.0</td>
<td>16,967.31 ns</td>
<td>1.000</td>
<td>58656 B</td>
<td>1.000</td>
</tr>
<tr>
<td>DistinctContains</td>
<td>.NET 10.0</td>
<td>46.72 ns</td>
<td>0.003</td>
<td>64 B</td>
<td>0.001</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>OrderByContains</td>
<td>.NET 9.0</td>
<td>12,884.28 ns</td>
<td>1.000</td>
<td>12280 B</td>
<td>1.000</td>
</tr>
<tr>
<td>OrderByContains</td>
<td>.NET 10.0</td>
<td>50.14 ns</td>
<td>0.004</td>
<td>88 B</td>
<td>0.007</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>ReverseContains</td>
<td>.NET 9.0</td>
<td>479.59 ns</td>
<td>1.00</td>
<td>4072 B</td>
<td>1.00</td>
</tr>
<tr>
<td>ReverseContains</td>
<td>.NET 10.0</td>
<td>51.80 ns</td>
<td>0.11</td>
<td>48 B</td>
<td>0.01</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>UnionContains</td>
<td>.NET 9.0</td>
<td>16,910.57 ns</td>
<td>1.000</td>
<td>58664 B</td>
<td>1.000</td>
</tr>
<tr>
<td>UnionContains</td>
<td>.NET 10.0</td>
<td>55.56 ns</td>
<td>0.003</td>
<td>72 B</td>
<td>0.001</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>SelectManyContains</td>
<td>.NET 9.0</td>
<td>2,950.64 ns</td>
<td>1.00</td>
<td>192 B</td>
<td>1.00</td>
</tr>
<tr>
<td>SelectManyContains</td>
<td>.NET 10.0</td>
<td>60.42 ns</td>
<td>0.02</td>
<td>128 B</td>
<td>0.67</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>WhereSelectContains</td>
<td>.NET 9.0</td>
<td>1,782.05 ns</td>
<td>1.00</td>
<td>104 B</td>
<td>1.00</td>
</tr>
<tr>
<td>WhereSelectContains</td>
<td>.NET 10.0</td>
<td>260.25 ns</td>
<td>0.15</td>
<td>104 B</td>
<td>1.00</td>
</tr>
</tbody>
</table>
<p>LINQ in .NET 10 also gains some new methods, including <code>Sequence</code> and <code>Shuffle</code>. While the primary purpose of these new methods is not performance, they can have a meaningful impact on performance, due to how they’ve been implemented and how they integrate with the rest of the optimizations in LINQ. Take <code>Sequence</code>, for example. <code>Sequence</code> is similar to <code>Range</code>, in that its a source for numbers:</p>
<pre><code>public static IEnumerable&lt;T&gt; Sequence&lt;T&gt;(T start, T endInclusive, T step) where T : INumber&lt;T&gt;</code></pre>
<p>Whereas <code>Range</code> only works with <code>int</code> and produces a contiguous series of non-overflowing numbers starting at the initial value, <code>Sequence</code> works with any <code>INumber&lt;&gt;</code>, supports <code>step</code> values other than <code>1</code> (including negative values), and allows for wrapping around <code>T</code>‘s maximum or minimum. However, when appropriate (e.g. <code>step</code> is <code>1</code>), <code>Sequence</code> will try to utilize <code>Range</code>‘s implementation, which has internally been updated to work with any <code>T : INumber&lt;T&gt;</code>, even though its public API is still tied to <code>int</code>. That means that all of the optimizations afforded to <code>Range&lt;T&gt;</code> propagate to <code>Sequence&lt;T&gt;</code>.</p>
<pre><code>// dotnet run -c Release -f net10.0 --filter "*"

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private List&lt;short&gt; _values = new();

    [Benchmark(Baseline = true)]
    public void Fill1()
    {
        _values.Clear();
        for (short i = 42; i &lt;= 1042; i++)
        {
            _values.Add(i);
        }
    }

    [Benchmark]
    public void Fill2()
    {
        _values.Clear();
        _values.AddRange(Enumerable.Sequence&lt;short&gt;(42, 1042, 1));
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Fill1</td>
<td>1,479.99 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>Fill2</td>
<td>37.42 ns</td>
<td>0.03</td>
</tr>
</tbody>
</table>
<p>My favorite new LINQ method, though, is <code>Shuffle</code> (introduced in <a href="https://github.com/dotnet/runtime/pull/112173">dotnet/runtime#112173</a>), in part because it’s very handy, but in part because of its implementation and performance focus. The purpose of <code>Shuffle</code> is to randomize the source input, and logically, it’s akin to a very simple implementation:</p>
<pre><code>public static IEnumerable&lt;T&gt; Shuffle&lt;T&gt;(IEnumerable&lt;T&gt; source)
{
    T[] arr = source.ToArray();
    Random.Shared.Shuffle(arr);
    foreach (T item in arr) yield return item;
}</code></pre>
<p>Worst case, this implementation is effectively what’s in LINQ. Just as in the worst case <code>OrderBy</code> needs to buffer up the whole input because it’s possible any item might be the smallest and thus need to be yielded first, <code>Shuffle</code> similarly needs to support the possibility that the last element should probabilistically be yielded first. However, there are a variety of special-cases in the implementation that allow it to perform significantly better than such a hand-rolled <code>Shuffle</code> implementation you might be using today.</p>
<p>First, <code>Shuffle</code> has some of the same characteristics as <code>OrderBy</code>, in that they’re both creating permutations of the input. That means that many of the ways we can specialize subsequent operations on the result of an <code>OrderBy</code> also apply to <code>Shuffle</code>. For example, <code>Shuffle.First</code> on an <code>IList&lt;T&gt;</code> can just select an element from the list at random. <code>Shuffle.Count</code> can just count the underlying source, since the order of the elements is irrelevant to the result. <code>Shuffle.Contains</code> can just perform the contains on the underlying source. Etc. But my two favorite sequences are <code>Shuffle.Take</code> and <code>Shuffle.Take.Contains</code>.</p>
<p><code>Shuffle.Take</code> provides an interesting optimization opportunity: whereas with <code>Shuffle</code> by itself we need to build the whole shuffled sequence, with a <code>Shuffle</code> followed immediately by a <code>Take(N)</code>, we only need to sample <code>N</code> items from the source. We still need those <code>N</code> items to be a uniformly random distribution, akin to what we’d get if we performed the buffering shuffle and then selected the first <code>N</code> items in the resulting array, but we can do so using an algorithm that allows us to avoid buffering everything. We need an algorithm that will let us iterate through the source data once, picking out elements as we go, and only ever buffering <code>N</code> items at a time. Enter “reservoir sampling.” I previously discussed reservoir sampling in <a href="https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-8/">Performance Improvements in .NET 8</a>, as it’s employed by the JIT as part of its dynamic PGO implementation, and we can use the algorithm here in <code>Shuffle</code> as well. Reservoir sampling provides exactly the single-pass, low-memory path we want: initialize a “reservoir” (an array) with the first <code>N</code> items, then as we scan the rest of the sequence, probabilistically overwrite one of the elements in our reservoir with the current item. The algorithm ensures that every element ends up in the reservoir with equal probability, yielding the same distribution as fully shuffling and taking <code>N</code>, but using only <code>O(N)</code> space and only making a single pass over an otherwise unknown-length source.</p>
<pre><code>// dotnet run -c Release -f net10.0 --filter "*"

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private IEnumerable&lt;int&gt; _source = Enumerable.Range(1, 1000).ToList();

    [Benchmark(Baseline = true)]
    public List&lt;int&gt; ShuffleTakeManual() =&gt; ShuffleManual(_source).Take(10).ToList();

    [Benchmark]
    public List&lt;int&gt; ShuffleTakeLinq() =&gt; _source.Shuffle().Take(10).ToList();

    private static IEnumerable&lt;int&gt; ShuffleManual(IEnumerable&lt;int&gt; source)
    {
        int[] arr = source.ToArray();
        Random.Shared.Shuffle(arr);
        foreach (var item in arr)
        {
            yield return item;
        }
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Mean</th>
<th>Ratio</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>ShuffleTakeManual</td>
<td>4.150 us</td>
<td>1.00</td>
<td>4232 B</td>
<td>1.00</td>
</tr>
<tr>
<td>ShuffleTakeLinq</td>
<td>3.801 us</td>
<td>0.92</td>
<td>192 B</td>
<td>0.05</td>
</tr>
</tbody>
</table>
<p><code>Shuffle.Take.Contains</code> is even more fun. We now have a probability problem that reads like a brain teaser or an SAT question. “I have <code>totalCount</code> items of which <code>equalCount</code> match my target value, and we’re going to pick <code>takeCount</code> items at random. What is the probability that at least one of those <code>takeCount</code> items is one of the <code>equalCount</code> items?” This is called a hypergeometric distribution, and we can use an implementation of it for <code>Shuffle.Take.Contains</code>.</p>
<p>To make this easier to reason about, let’s talk candy. Imagine you have a jar of 100 jelly beans, of which 20 are your favorite flavor, Watermelon, and you’re going to pick 5 of the 100 beans at random; what are the chances you get at least one Watermelon? To solve this, we could reason through all the different ways we might get 1, 2, 3, 4, or 5 Watermelons, but instead, let’s do the opposite and think through how likely it is that we don’t get any (sad panda):</p>
<ul>
<li>The chance that our first pick isn’t a Watermelon is the number of non-Watermelons divided by the total number of beans, so <code>(100-20)/100</code>.</li>
<li>Once we’ve picked a bean out of the jar, we’re not putting it back, so the chance that our second pick isn’t a Watermelon is now <code>(99-20)/99</code> (we have one fewer bean, but our first pick wasn’t a Watermelon, so there’s the same number of Watermelons as there was before).</li>
<li>For a third pick, it’s now <code>(98-20)/98</code>.</li>
<li>And so on.</li>
</ul>
<p>After five rounds, we end up with <code>(80/100) * (79/99) * (78/98) * (77/97) * (76/96)</code>, which is ~32%. If the chances I don’t get a Watermelon are ~32%, then the chances I do get a Watermelon are ~68%. Jelly beans aside, that’s our algorithm:</p>
<pre><code>double probOfDrawingZeroMatches = 1;
for (long i = 0; i &lt; _takeCount; i++)
{
    probOfDrawingZeroMatches *= (double)(totalCount - i - equalCount) / (totalCount - i);
}

return Random.Shared.NextDouble() &gt; probOfDrawingZeroMatches;</code></pre>
<p>The net effect is we can compute the answer much more efficiently than with a naive implementation that shuffles and then separately takes and separately contains.</p>
<pre><code>// dotnet run -c Release -f net10.0 --filter "*"

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private IEnumerable&lt;int&gt; _source = Enumerable.Range(1, 1000).ToList();

    [Benchmark(Baseline = true)]
    public bool ShuffleTakeContainsManual() =&gt; ShuffleManual(_source).Take(10).Contains(2000);

    [Benchmark]
    public bool ShuffleTakeContainsLinq() =&gt; _source.Shuffle().Take(10).Contains(2000);

    private static IEnumerable&lt;int&gt; ShuffleManual(IEnumerable&lt;int&gt; source)
    {
        int[] arr = source.ToArray();
        Random.Shared.Shuffle(arr);
        foreach (var item in arr)
        {
            yield return item;
        }
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Mean</th>
<th>Ratio</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>ShuffleTakeContainsManual</td>
<td>3,900.99 ns</td>
<td>1.00</td>
<td>4136 B</td>
<td>1.00</td>
</tr>
<tr>
<td>ShuffleTakeContainsLinq</td>
<td>79.12 ns</td>
<td>0.02</td>
<td>96 B</td>
<td>0.02</td>
</tr>
</tbody>
</table>
<p><code>LINQ</code> in .NET 10 also sports some new methods that <em>are</em> about performance (at least in part), in particular <code>LeftJoin</code> and <code>RightJoin</code>, from <a href="https://github.com/dotnet/runtime/pull/110872">dotnet/runtime#110872</a>. I say these are about performance because it’s already possible to achieve the left and right join semantics using existing LINQ surface area, and the new methods do it more efficiently.</p>
<p><code>Enumerable.Join</code> implements an “inner join,” meaning only matching pairs from the two supplied collections appear in the output. For example, this code, which is joining based on the first letter in each string:</p>
<pre><code>IEnumerable&lt;string&gt; left = ["apple", "banana", "cherry", "date", "grape", "honeydew"];
IEnumerable&lt;string&gt; right = ["aardvark", "dog", "elephant", "goat", "gorilla", "hippopotamus"];
foreach (string result in left.Join(right, s =&gt; s[0], s =&gt; s[0], (s1, s2) =&gt; $"{s1} {s2}"))
{
    Console.WriteLine(result);
}</code></pre>
<p>outputs:</p>
<pre><code>apple aardvark
date dog
grape goat
grape gorilla
honeydew hippopotamus</code></pre>
<p>In contrast, a “left join” (also known as a “left outer join”) would yield the following:</p>
<pre><code>apple aardvark
banana
cherry
date dog
grape goat
grape gorilla
honeydew hippopotamus</code></pre>
<p>Note that it has all of the same output as with the “inner join,” except it has at least one row for every <code>left</code> element, even if there’s no matching element in the <code>right</code> row. And then a “right join” (also known as a “right outer join”) would yield the following:</p>
<pre><code>apple aardvark
date dog
 elephant
grape goat
grape gorilla
honeydew hippopotamus</code></pre>
<p>Again, all the same output as with the “inner join,” except it has at least one row for every <code>right</code> element, even if there’s no matching element in the <code>left</code> row.</p>
<p>Prior to .NET 10, there was no <code>LeftJoin</code> or <code>RightJoin</code>, but their semantics could be achieved using a combination of <code>GroupJoin</code>, <code>SelectMany</code>, and <code>DefaultIfEmpty</code>:</p>
<pre><code>public static IEnumerable&lt;TResult&gt; LeftJoin&lt;TOuter, TInner, TKey, TResult&gt;(
    this IEnumerable&lt;TOuter&gt; outer, IEnumerable&lt;TInner&gt; inner,
    Func&lt;TOuter, TKey&gt; outerKeySelector, Func&lt;TInner, TKey&gt; innerKeySelector,
    Func&lt;TOuter, TInner?, TResult&gt; resultSelector) =&gt;
    outer
    .GroupJoin(inner, outerKeySelector, innerKeySelector, (o, inners) =&gt; (o, inners))
    .SelectMany(x =&gt; x.inners.DefaultIfEmpty(), (x, i) =&gt; resultSelector(x.o, i));</code></pre>
<p><code>GroupJoin</code> creates a group for each <code>outer</code> (“left”) element, where the group contains all matching items from <code>inner</code> (“right”). We can flatten those results by using <code>SelectMany</code>, such that we end up with an output for each pairing, using <code>DefaultIfEmpty</code> to ensure that there’s always at least a default inner element to pair. We can do the exact same thing for a <code>RightJoin</code>: in fact, we can implement the right join just by delegating to the left join and flipping all the arguments:</p>
<pre><code>public static IEnumerable&lt;TResult&gt; RightJoin&lt;TOuter, TInner, TKey, TResult&gt;(
    this IEnumerable&lt;TOuter&gt; outer, IEnumerable&lt;TInner&gt; inner,
    Func&lt;TOuter, TKey&gt; outerKeySelector, Func&lt;TInner, TKey&gt; innerKeySelector,
    Func&lt;TOuter, TInner?, TResult&gt; resultSelector) =&gt;
    inner.LeftJoin(outer, innerKeySelector, outerKeySelector, (i, o) =&gt; resultSelector(o, i));</code></pre>
<p>Thankfully, you no longer need to do that yourself, and this isn’t how the new <code>LeftJoin</code> and <code>RightJoin</code> methods are implemented in .NET 10. We can see the difference with a benchmark:</p>
<pre><code>// dotnet run -c Release -f net10.0 --filter "*"

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Linq;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private IEnumerable&lt;int&gt; Outer { get; } = Enumerable.Sequence(0, 1000, 2);
    private IEnumerable&lt;int&gt; Inner { get; } = Enumerable.Sequence(0, 1000, 3);

    [Benchmark(Baseline = true)]
    public void LeftJoin_Manual() =&gt;
        ManualLeftJoin(Outer, Inner, o =&gt; o, i =&gt; i, (o, i) =&gt; o + i).Count();

    [Benchmark]
    public int LeftJoin_Linq() =&gt;
        Outer.LeftJoin(Inner, o =&gt; o, i =&gt; i, (o, i) =&gt; o + i).Count();

    private static IEnumerable&lt;TResult&gt; ManualLeftJoin&lt;TOuter, TInner, TKey, TResult&gt;(
        IEnumerable&lt;TOuter&gt; outer, IEnumerable&lt;TInner&gt; inner,
        Func&lt;TOuter, TKey&gt; outerKeySelector, Func&lt;TInner, TKey&gt; innerKeySelector,
        Func&lt;TOuter, TInner?, TResult&gt; resultSelector) =&gt;
        outer
        .GroupJoin(inner, outerKeySelector, innerKeySelector, (o, inners) =&gt; (o, inners))
        .SelectMany(x =&gt; x.inners.DefaultIfEmpty(), (x, i) =&gt; resultSelector(x.o, i));
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Mean</th>
<th>Ratio</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>LeftJoin_Manual</td>
<td>29.02 us</td>
<td>1.00</td>
<td>65.84 KB</td>
<td>1.00</td>
</tr>
<tr>
<td>LeftJoin_Linq</td>
<td>15.23 us</td>
<td>0.53</td>
<td>36.95 KB</td>
<td>0.56</td>
</tr>
</tbody>
</table>
<p>Moving on from new methods, existing methods were also improved in other ways. <a href="https://github.com/dotnet/runtime/pull/112401">dotnet/runtime#112401</a> from <a href="https://github.com/miyaji255">@miyaji255</a> improved the performance of <code>ToArray</code> and <code>ToList</code> following <code>Skip</code> and/or <code>Take</code> calls. In the specialized iterator implementation used for <code>Take</code> and <code>Skip</code>, this PR simply checks in the <code>ToList</code> and <code>ToArray</code> implementations whether the source is something from which we can easily get a <code>ReadOnlySpan&lt;T&gt;</code> (namely a <code>T[]</code> or <code>List&lt;T&gt;</code>). If it is, rather than copying elements one by one into the destination, it can slice the retrieved span and use its <code>CopyTo</code>, which, depending on the <code>T</code>, may even be vectorized.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private readonly IEnumerable&lt;string&gt; _source = Enumerable.Range(0, 1000).Select(i =&gt; i.ToString()).ToArray();

    [Benchmark]
    public List&lt;string&gt; SkipTakeToList() =&gt; _source.Skip(200).Take(200).ToList();
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>SkipTakeToList</td>
<td>.NET 9.0</td>
<td>1,218.9 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>SkipTakeToList</td>
<td>.NET 10.0</td>
<td>257.4 ns</td>
<td>0.21</td>
</tr>
</tbody>
</table>
<p>LINQ in .NET 10 also sees a few notable enhancements for Native AOT. The code for LINQ has grown over time, as all of these various specializations have found their way into the codebase. These optimizations are generally implemented by deriving specialized iterators from a base <code>Iterator&lt;T&gt;</code>, which has a bunch of <code>abstract</code> or <code>virtual</code> methods for performing the subsequent operation (e.g. <code>Contains</code>). With Native AOT, any use of a method like <code>Enumerable.Contains</code> then prevents the corresponding implementations on <em>all</em> of those specializations from being trimmed away, leading to non-trivial increase in assembly code size. As such, years ago multiple builds of <code>System.Linq.dll</code> were introduced into the <code>dotnet/runtime</code> build system: one focused on speed, and one focused on size. When building <code>System.Linq.dll</code> to go with coreclr, you’d end up with the speed-optimized build that has all of these specializations. When building <code>System.Linq.dll</code> to go with other flavors, like Native AOT, you’d instead get the size-optimized build, which eschews many of the LINQ optimizations that have been added in the last decade. And as this was a build-time decision, developers using one of these platforms didn’t get a choice; as you learn in kindergarten, “you get what you get and you don’t get upset.” Now in .NET 10, if you do forget what you learned in kindergarten and you do get upset, you have recourse: thanks to <a href="https://github.com/dotnet/runtime/pull/111743">dotnet/runtime#111743</a> and <a href="https://github.com/dotnet/runtime/pull/109978">dotnet/runtime#109978</a>, this setting is now a feature switch rather than a build-time configuration. So, in particular if you’re publishing for Native AOT and you’d prefer all the speed-focused optimizations, you can add <code>&lt;UseSizeOptimizedLinq&gt;false&lt;/UseSizeOptimizedLinq&gt;</code> to your project file and be happy.</p>
<p>However, the need for that switch is now also reduced significantly by <a href="https://github.com/dotnet/runtime/pull/118156">dotnet/runtime#118156</a>. When this size/speed split was previously introduced into the <code>System.Linq.dll</code> build, all of these specializations were eschewed, without a lot of an analysis for tradeoffs involved; as this was focused on optimizing for size, any specialized overrides were removed, no matter how much space they actually saved. Many of those savings turned out to be minimal, however, and in a variety of situations, the throughput cost was significant. This PR brings back some of the more impactful specializations where the throughput gains significantly outweigh the relatively-minimal size cost.</p>
<h3>Frozen Collections</h3>
<p>The <code>FrozenDictionary&lt;TKey, TValue&gt;</code> and <code>FrozenSet&lt;T&gt;</code> collection types were introduced in .NET 8 as collections optimized for the common scenario of creating a long-lived collection that’s then read from <em>a lot</em>. They spend more time at construction in exchange for faster read operations. Under the covers, this is achieved in part by having specializations of the implementations that are optimized for different types of data or shapes of input. .NET 9 improved upon the implementations, and .NET 10 takes it even further.</p>
<p><code>FrozenDictionary&lt;TKey, TValue&gt;</code> exerts a lot of energy for <code>TKey</code> as <code>string</code>, as that is such a common use case. It also has specializations for <code>TKey</code> as <code>Int32</code>. <a href="https://github.com/dotnet/runtime/pull/111886">dotnet/runtime#111886</a> and <a href="https://github.com/dotnet/runtime/pull/112298">dotnet/runtime#112298</a> extend that further by adding specializations for when <code>TKey</code> is any primitive integral type that’s the size of an <code>int</code> or smaller (e.g. <code>byte</code>, <code>char</code>, <code>ushort</code>, etc.) as well as enums backed by such primitives (which represent the vast, vast majority of enums used in practice). In particular, they handle the common case where these values are densely packed, in which case they implement the dictionary as an array that it can index into based on the integer’s value. This makes for a very efficient lookup, while not consuming too much additional space: it’s only used when the values are dense and thus won’t be wasting many empty slots in the array.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Collections.Frozen;
using System.Net;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "status")]
public partial class Tests
{
    private static readonly FrozenDictionary&lt;HttpStatusCode, string&gt; s_statusDescriptions =
        Enum.GetValues&lt;HttpStatusCode&gt;().Distinct()
            .ToFrozenDictionary(status =&gt; status, status =&gt; status.ToString());

    [Benchmark]
    [Arguments(HttpStatusCode.OK)]
    public string Get(HttpStatusCode status) =&gt; s_statusDescriptions[status];
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Get</td>
<td>.NET 9.0</td>
<td>2.0660 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>Get</td>
<td>.NET 10.0</td>
<td>0.8735 ns</td>
<td>0.42</td>
</tr>
</tbody>
</table>
<p>Both <code>FrozenDictionary&lt;TKey, TValue&gt;</code> and <code>FrozenSet&lt;T&gt;</code> also improve with regards to the alternate lookup functionality introduced in .NET 9. Alternate lookups are a mechanism that enables getting a proxy for a dictionary or set that’s keyed with a different key from <code>TKey</code>, most commonly a <code>ReadOnlySpan&lt;char&gt;</code> when <code>TKey</code> is <code>string</code>. As noted, both <code>FrozenDictionary&lt;TKey, TValue&gt;</code> and <code>FrozenSet&lt;T&gt;</code> achieve their goals by having different implementations based on the nature of the indexed data, and that specialization is achieved by virtual methods that derived specializations override. The JIT is typically able to minimize the costs of such virtuals, especially if the collections are stored in <code>static readonly</code> fields. However, the alternate lookup support complicated things, as it introduced a virtual method with a generic method parameter (the alternate key type), otherwise known as GVM. “GVM” might as well be a four-letter word in performance circles, as they’re hard for the runtime to optimize. The purpose of these alternate lookups is primarily performance, but the use of a GVM significantly reduced those performance gains. <a href="https://github.com/dotnet/runtime/pull/108732">dotnet/runtime#108732</a> from <a href="https://github.com/andrewjsaid">@andrewjsaid</a> addresses this by changing the frequency with which a GVM needs to be invoked. Rather than the lookup operation itself being a generic virtual method, the PR introduces a separate generic virtual method that retrieves a delegate for performing the lookup; the retrieval of that delegate still incurs GVM penalties, but once the delegate is retrieved, it can be cached, and invoking it does not incur said overheads. This results in measurable improvements on throughput.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Collections.Frozen;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private static readonly FrozenDictionary&lt;string, int&gt; s_d = new Dictionary&lt;string, int&gt; 
    {
        ["one"] = 1, ["two"] = 2, ["three"] = 3, ["four"] = 4, ["five"] = 5, ["six"] = 6, 
        ["seven"] = 7, ["eight"] = 8, ["nine"] = 9, ["ten"] = 10, ["eleven"] = 11, ["twelve"] = 12,
    }.ToFrozenDictionary();

    [Benchmark]
    public int Get()
    {
        var alternate = s_d.GetAlternateLookup&lt;ReadOnlySpan&lt;char&gt;&gt;();
        return
            alternate["one"] + alternate["two"] + alternate["three"] + alternate["four"] + alternate["five"] +
            alternate["six"] + alternate["seven"] + alternate["eight"] + alternate["nine"] + alternate["ten"] + 
            alternate["eleven"] + alternate["twelve"];
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Get</td>
<td>.NET 9.0</td>
<td>133.46 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>Get</td>
<td>.NET 10.0</td>
<td>81.39 ns</td>
<td>0.61</td>
</tr>
</tbody>
</table>
<h3>BitArray</h3>
<p><code>BitArray</code> provides support for exactly what its name says, a bit array. You create it with the desired number of values and can then read and write a <code>bool</code> for each index, turning the corresponding bit to <code>1</code> or <code>0</code> accordingly. It also provides a variety of helper operations for processing the whole bit array, such as for Boolean logic operations like <code>And</code> and <code>Not</code>. Where possible, those operations are vectorized, taking advantage of SIMD to process many bits per instruction.</p>
<p>However, for situations where you want to write custom manipulations of the bits, you only have two options: use the indexer (or corresponding <code>Get</code> and <code>Set</code> methods), which means multiple instructions required to process each bit, or use <code>CopyTo</code> to extract all of the bits to a separate array, which means you need to allocate (or at least rent) such an array and pay for the memory copy before you can then manipulate the bits. There’s also not a great way to then copy those bits back if you wanted to manipulate the <code>BitArray</code> in place.</p>
<p><a href="https://github.com/dotnet/runtime/pull/116308">dotnet/runtime#116308</a> adds a <code>CollectionsMarshal.AsBytes(BitArray)</code> method that returns a <code>Span&lt;byte&gt;</code> directly referencing the <code>BitArray</code>‘s underlying storage. This provides a very efficient way to get access to all the bits, which then makes it possible to write (or reuse) vectorized algorithms. Say, for example, you wanted to use a <code>BitArray</code> to represent a binary embedding (an “embedding” is a vector representation of the semantic meaning of some data, basically an array of numbers, each one corresponding to some aspect of the data; a binary embedding uses a single bit for each number). To determine how semantically similar two inputs are, you get an embedding for each and then perform a distance or similarity calculation on the two. For binary embeddings, a common distance metric is “hamming distance,” which effectively lines up the bits and tells you the number of positions that have different values, e.g. <code>0b1100</code> and <code>0b1010</code> have a hamming distance of 2. Helpfully, <code>TensorPrimitives.HammingBitDistance</code> provides an implementation of this, accepting two <code>ReadOnlySpan&lt;T&gt;</code>s and computing the number of bits that differ between them. With <code>CollectionsMarshal.AsBytes</code>, we can now utilize that helper directly with the contents of <code>BitArray</code>s, both saving us the effort of having to write it manually and benefiting from any optimizations in <code>HammingBitDistance</code> itself.</p>
<pre><code>// Update benchmark.csproj with a package reference to System.Numerics.Tensors.
// dotnet run -c Release -f net10.0 --filter "*"

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Collections;
using System.Numerics.Tensors;
using System.Runtime.InteropServices;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private BitArray _bits1, _bits2;

    [GlobalSetup]
    public void Setup()
    {
        Random r = new(42);
        byte[] bytes = new byte[128];

        r.NextBytes(bytes);
        _bits1 = new BitArray(bytes);

        r.NextBytes(bytes);
        _bits2 = new BitArray(bytes);
    }

    [Benchmark(Baseline = true)]
    public long HammingDistanceManual()
    {
        long distance = 0;
        for (int i = 0; i &lt; _bits1.Length; i++)
        {
            if (_bits1[i] != _bits2[i])
            {
                distance++;
            }
        }

        return distance;
    }

    [Benchmark]
    public long HammingDistanceTensorPrimitives() =&gt;
        TensorPrimitives.HammingBitDistance(
            CollectionsMarshal.AsBytes(_bits1),
            CollectionsMarshal.AsBytes(_bits2));
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>HammingDistanceManual</td>
<td>1,256.72 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>HammingDistanceTensorPrimitives</td>
<td>63.29 ns</td>
<td>0.05</td>
</tr>
</tbody>
</table>
<p>The main motivation for this PR was adding the <code>AsBytes</code> method, but doing so triggered a series of other modifications that themselves help with performance. For example, rather than backing the <code>BitArray</code> with an <code>int[]</code> as was previously done, it’s now backed by a <code>byte[]</code>, and rather than reading elements one by one in the <code>byte[]</code>-based constructor, vectorized copy operations are now being used (they were already being used and continue to be used in the <code>int[]</code>-based constructor).</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Collections;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private byte[] _byteData = Enumerable.Range(0, 512).Select(i =&gt; (byte)i).ToArray();

    [Benchmark]
    public BitArray ByteCtor() =&gt; new BitArray(_byteData);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>ByteCtor</td>
<td>.NET 9.0</td>
<td>160.10 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>ByteCtor</td>
<td>.NET 10.0</td>
<td>83.07 ns</td>
<td>0.52</td>
</tr>
</tbody>
</table>
<h3>Other Collections</h3>
<p>There are a variety of other notable improvements in collections:</p>
<ul>
<li><strong><code>List&lt;T&gt;</code></strong>. <a href="https://github.com/dotnet/runtime/pull/107683">dotnet/runtime#107683</a> from <a href="https://github.com/karakasa">@karakasa</a> builds on a change that was made in .NET 9 to improve the performance of using <code>InsertRange</code> on a <code>List&lt;T&gt;</code> to insert a <code>ReadOnlySpan&lt;T&gt;</code>. When a full <code>List&lt;T&gt;</code> is appended to, the typical process is a new larger array is allocated, all of the existing elements are copied over (one array copy), and then the new element is stored into the array in the next available slot. If that same growth routine is used when <em>inserting</em> rather than <em>appending</em> an element, you possibly end up copying some elements twice: you first copy over all of the elements into the new array, and then to handle the insert, you may again need to copy some of the elements you already copied as part of shifting them to make room for the insertion at the new location. In the extreme, if you’re inserting at index 0, you copy all of the elements into the new array, and then you copy all of the elements again to shift them by one slot. The same applies when inserting a range of elements, so with this PR, rather than first copying over all of the elements and then shifting a subset, <code>List&lt;T&gt;</code> now grows by copying the elements above and below the target range for the insertion to their correct location and then fills in the target range with the inserted elements.
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private readonly int[] _data = [1, 2, 3, 4];

    [Benchmark]
    public List&lt;int&gt; Test()
    {
        List&lt;int&gt; list = new(4);
        list.AddRange(_data);
        list.InsertRange(0, _data);
        return list;
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Test</td>
<td>.NET 9.0</td>
<td>48.65 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>Test</td>
<td>.NET 10.0</td>
<td>30.07 ns</td>
<td>0.62</td>
</tr>
</tbody>
</table>
</li>
<li><strong><code>ConcurrentDictionary&lt;TKey, TValue&gt;</code></strong>. <a href="https://github.com/dotnet/runtime/pull/108065">dotnet/runtime#108065</a> from <a href="https://github.com/koenigst">@koenigst</a> changes how a <code>ConcurrentDictionary</code>‘s backing array is sized when it’s cleared. <code>ConcurrentDictionary</code> is implemented with an array of linked lists, and when the collection is constructed, a constructor parameter allows for presizing that array. Due to the concurrent nature of the dictionary and its implementation, <code>Clear</code>‘ing it necessitates creating a new array rather than just using part of the old one. When that new array was created, it reset to using the default size. This PR tweaks that to remember the initial capacity requested by the user, and using that initial size again when constructing the new array.
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Collections.Concurrent;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private ConcurrentDictionary&lt;int, int&gt; _data = new(concurrencyLevel: 1, capacity: 1024);

    [Benchmark]
    public void ClearAndAdd()
    {
        _data.Clear();
        for (int i = 0; i &lt; 1024; i++)
        {
            _data.TryAdd(i, i);
        }
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>ClearAndAdd</td>
<td>.NET 9.0</td>
<td>51.95 us</td>
<td>1.00</td>
<td>134.36 KB</td>
<td>1.00</td>
</tr>
<tr>
<td>ClearAndAdd</td>
<td>.NET 10.0</td>
<td>30.32 us</td>
<td>0.58</td>
<td>48.73 KB</td>
<td>0.36</td>
</tr>
</tbody>
</table>
</li>
<li><strong><code>Dictionary&lt;TKey, TValue&gt;</code></strong>. <code>Dictionary</code> is one of the most popular collection types across .NET, and <code>TKey</code> == <code>string</code> is one of (if not <em>the</em>) most popular forms. <a href="https://github.com/dotnet/runtime/pull/117427">dotnet/runtime#117427</a> makes dictionary lookups with constant <code>string</code>s much faster. You might expect it would be a complicated change, but it ends up being just a few strategic tweaks. A variety of methods for operating on <code>string</code>s are already known to the JIT and already have optimized implementations for when dealing with constants. All this PR needed to do was change which methods <code>Dictionary&lt;TKey, TValue&gt;</code> was using in its optimized <code>TryGetValue</code> lookup path, and because that path is often inlined, a constant argument to <code>TryGetValue</code> can be exposed as a constant to these helpers, e.g. <code>string.Equals</code>.
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private Dictionary&lt;string, int&gt; _data = new() { ["a"] = 1, ["b"] = 2, ["c"] = 3, ["d"] = 4, ["e"] = 5 };

    [Benchmark]
    public int Get() =&gt; _data["a"] + _data["b"] + _data["c"] + _data["d"] + _data["e"];
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Get</td>
<td>.NET 9.0</td>
<td>33.81 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>Get</td>
<td>.NET 10.0</td>
<td>14.02 ns</td>
<td>0.41</td>
</tr>
</tbody>
</table>
</li>
<li><strong><code>OrderedDictionary&lt;TKey, TValue&gt;</code></strong>. <a href="https://github.com/dotnet/runtime/pull/109324">dotnet/runtime#109324</a> adds new overloads of <code>TryAdd</code> and <code>TryGetValue</code> that provide the index of the added or retrieved element in the collection. This index can then be used in subsequent operations on the dictionary to access the same slot. For example, if you want to implement an <code>AddOrUpdate</code> operation on top of <code>OrderedDictionary</code>, you need to perform one or two operations, first trying to add the item, and then if found to already exist, updating it, and that update can benefit from targeting the exact index that contains the element rather than it needing to do another keyed lookup.
<pre><code>// dotnet run -c Release -f net10.0 --filter "*"

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private OrderedDictionary&lt;string, int&gt; _dictionary = new();

    [Benchmark(Baseline = true)]
    public void Old() =&gt; AddOrUpdate_Old(_dictionary, "key", k =&gt; 1, (k, v) =&gt; v + 1);

    [Benchmark]
    public void New() =&gt; AddOrUpdate_New(_dictionary, "key", k =&gt; 1, (k, v) =&gt; v + 1);

    private static void AddOrUpdate_Old(OrderedDictionary&lt;string, int&gt; d, string key, Func&lt;string, int&gt; addFunc, Func&lt;string, int, int&gt; updateFunc)
    {
        if (d.TryGetValue(key, out int existing))
        {
            d[key] = updateFunc(key, existing);
        }
        else
        {
            d.Add(key, addFunc(key));
        }
    }

    private static void AddOrUpdate_New(OrderedDictionary&lt;string, int&gt; d, string key, Func&lt;string, int&gt; addFunc, Func&lt;string, int, int&gt; updateFunc)
    {
        if (d.TryGetValue(key, out int existing, out int index))
        {
            d.SetAt(index, updateFunc(key, existing));
        }
        else
        {
            d.Add(key, addFunc(key));
        }
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Old</td>
<td>6.961 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>New</td>
<td>4.201 ns</td>
<td>0.60</td>
</tr>
</tbody>
</table>
</li>
<li><strong><code>ImmutableArray&lt;T&gt;</code></strong>. The <code>ImmutableCollectionsMarshal</code> class already exposes an <code>AsArray</code> method that enables retrieving the backing <code>T[]</code> from an <code>ImmutableArray&lt;T&gt;</code>. However, if you had an <code>ImmutableArray&lt;T&gt;.Builder</code>, there was previously no way to access the backing store it was using. <a href="https://github.com/dotnet/runtime/pull/112177">dotnet/runtime#112177</a> enables doing so, with an <code>AsMemory</code> method that retrieves the underlying storage as a <code>Memory&lt;T&gt;</code>.</li>
<li><strong><code>InlineArray</code></strong>. .NET 8 introduced <code>InlineArrayAttribute</code>, which can be used to attribute a struct containing a single field; the attribute accepts a count, and the runtime replicates the struct’s field that number of times, as if you’d logically copy/pasted the field repeatedly. The runtime also ensures that the storage is contiguous and appropriately aligned, such that if you had an indexible collection that pointed to the beginning of the struct, you could use it as an array. And it so happens such a collection exists: <code>Span&lt;T&gt;</code>. C# 12 then makes it easy to treat any such attributed struct as a span, e.g.
<pre><code>[InlineArray(8)]
internal struct EightStrings
{
    private string _field;
}
...
EightStrings strings = default;
Span&lt;string&gt; span = strings;</code></pre>
<p>The C# compiler will itself emit code that uses this capability. For example, if you use collection expressions to initialize a span, you’re likely triggering the compiler to emit an <code>InlineArray</code>. When I write this:</p>
<pre><code>public void M(int a, int b, int c, int d) 
{
    Span&lt;int&gt; span = [a, b, c, d];
}</code></pre>
<p>the compiler emits something like the following equivalent:</p>
<pre><code>public void M(int a, int b, int c, int d)
{
    &lt;&gt;y__InlineArray4&lt;int&gt; buffer = default(&lt;&gt;y__InlineArray4&lt;int&gt;);
    &lt;PrivateImplementationDetails&gt;.InlineArrayElementRef&lt;&lt;&gt;y__InlineArray4&lt;int&gt;, int&gt;(ref buffer, 0) = a;
    &lt;PrivateImplementationDetails&gt;.InlineArrayElementRef&lt;&lt;&gt;y__InlineArray4&lt;int&gt;, int&gt;(ref buffer, 1) = b;
    &lt;PrivateImplementationDetails&gt;.InlineArrayElementRef&lt;&lt;&gt;y__InlineArray4&lt;int&gt;, int&gt;(ref buffer, 2) = c;
    &lt;PrivateImplementationDetails&gt;.InlineArrayElementRef&lt;&lt;&gt;y__InlineArray4&lt;int&gt;, int&gt;(ref buffer, 3) = d;
    &lt;PrivateImplementationDetails&gt;.InlineArrayAsSpan&lt;&lt;&gt;y__InlineArray4&lt;int&gt;, int&gt;(ref buffer, 4);
}</code></pre>
<p>where it has defined that <code>&lt;&gt;y__InlineArray4</code> like this:</p>
<pre><code>[StructLayout(LayoutKind.Auto)]
[InlineArray(4)]
internal struct &lt;&gt;y__InlineArray4&lt;T&gt;
{
    [CompilerGenerated]
    private T _element0;
}</code></pre>
<p>This shows up elsewhere, too. For example, C# 13 introduced support for using <code>params</code> with collections other than arrays, including spans, so now I can write this:</p>
<pre><code>public void Caller(int a, int b, int c, int d) =&gt; M(a, b, c, d);

public void M(params ReadOnlySpan&lt;int&gt; span) { }</code></pre>
<p>and for <code>Caller</code> we’ll see very similar code emitted to what I previously showed, with the compiler manufacturing such an <code>InlineArray</code> type. As you might imagine, the popularity of the features that cause the compiler to produce these types has caused there to be a lot of them emitted. Each type is specific to a particular length, so while the compiler will reuse them, a) it can end up needing to emit a lot to cover different lengths, and b) it emits them as internal to each assembly that needs them, so there can end up being a lot of duplication. Looking just at the shared framework for .NET 9 (the core libraries like <code>System.Private.CoreLib</code> that ship as part of the runtime), there are ~140 of these types… all of which are for sizes no larger than 8. For .NET 10, <a href="https://github.com/dotnet/runtime/pull/113403">dotnet/runtime#113403</a> adds a set of public <code>InlineArray2&lt;T&gt;</code>, <code>InlineArray3&lt;T&gt;</code>, etc., that should cover the vast majority of sizes the compiler would otherwise need to emit types. In the near future, the C# compiler will be updated to use those new types when available instead of emitting its own, thereby yielding non-trivial size savings.</p></li>
</ul>
<h2>I/O</h2>
<p>In previous .NET releases, there have been concerted efforts that have invested a lot in improving specific areas of I/O performance, such as completely rewriting <code>FileStream</code> in .NET 6. Nothing as comprehensive as that was done for I/O in .NET 10, but there are some nice one-off improvements that can still have a measurable impact on certain scenarios.</p>
<p>On Unix, when a <code>MemoryMappedFile</code> is created and it’s not associated with a particular <code>FileStream</code>, it needs to create some kind of backing memory for the MMF’s data. On Linux, it’d try to use <code>shm_open</code>, which creates a shared memory object with appropriate semantics. However, in the years since <code>MemoryMappedFile</code> was initially enabled on Linux, the Linux kernel has added support for anonymous files and the <code>memfd_create</code> function that creates them. These are ideal for <code>MemoryMappedFile</code> and much more efficient, so <a href="https://github.com/dotnet/runtime/pull/105178">dotnet/runtime#105178</a> from <a href="https://github.com/am11">@am11</a> switches over to using <code>memfd_create</code> when it’s available.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.IO.MemoryMappedFiles;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    [Benchmark]
    public void MMF()
    {
        using MemoryMappedFile mff = MemoryMappedFile.CreateNew(null, 12345);
        using MemoryMappedViewAccessor accessor = mff.CreateViewAccessor();
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>MMF</td>
<td>.NET 9.0</td>
<td>9.916 us</td>
<td>1.00</td>
</tr>
<tr>
<td>MMF</td>
<td>.NET 10.0</td>
<td>6.358 us</td>
<td>0.64</td>
</tr>
</tbody>
</table>
<p><code>FileSystemWatcher</code> is improved in <a href="https://github.com/dotnet/runtime/pull/116830">dotnet/runtime#116830</a>. The primary purpose for this PR was to fix a memory leak, where on Windows disposing of a <code>FileSystemWatcher</code> while it was in use could end up leaking some objects. However, it also addresses a performance issue specific to Windows. <code>FileSystemWatcher</code> needs to pass a buffer to the OS for the OS to populate with file-changed information. That meant that <code>FileSystemWatcher</code> was allocating a managed array and then immediately pinning that buffer so it could pass a pointer to it into native code. For certain consumption of <code>FileSystemWatcher</code>, especially in scenarios where lots of <code>FileSystemWatcher</code> instances are created, that pinning could contribute to non-trivial heap fragmentation. Interestingly, though, this array is effectively never consumed as an array: all of the writes into it are performed in native code via the pointer that was passed to the OS, and all consumption of it in managed code to read out the events are done via a span. That means the array nature of it doesn’t really matter, and we’re better off just allocating a native rather than managed buffer that then requires pinning.</p>
<pre><code>// Run on Windows.
// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    [Benchmark]
    public void FSW()
    {
        using FileSystemWatcher fsw = new(Environment.CurrentDirectory);
        fsw.EnableRaisingEvents = true;
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>FSW</td>
<td>.NET 9</td>
<td>61.46 us</td>
<td>1.00</td>
<td>8944 B</td>
<td>1.00</td>
</tr>
<tr>
<td>FSW</td>
<td>.NET 10</td>
<td>61.21 us</td>
<td>1.00</td>
<td>744 B</td>
<td>0.08</td>
</tr>
</tbody>
</table>
<p><code>BufferedStream</code> gets a boost from <a href="https://github.com/dotnet/runtime/pull/104822">dotnet/runtime#104822</a> from <a href="https://github.com/ANahr">@ANahr</a>. There is a curious and problematic inconsistency in <code>BufferedStream</code> that’s been there since, well, forever as far as I can tell. It’s obviously been revisited in the past, and due to the super duper strong backwards compatibility concerns for .NET Framework (where a key feature is that the framework doesn’t change), the issue was never fixed. There’s even a <a href="https://github.com/microsoft/referencesource/blob/f7df9e2399ecd273e90908ac11caf1433e142448/mscorlib/system/io/bufferedstream.cs#L1263">comment in the code</a> to this point:</p>
<pre><code>// We should not be flushing here, but only writing to the underlying stream, but previous version flushed, so we keep this.</code></pre>
<p>A <code>BufferedStream</code> does what its name says. It wraps an underlying <code>Stream</code> and buffers access to it. So, for example, if it were configured with a buffer size of 1000, and you wrote 100 bytes to the <code>BufferedStream</code> at a time, your first 10 writes would just go to the buffer and the underlying <code>Stream</code> wouldn’t be touched at all. Only on the 11th write would the buffer be full and need to be flushed (meaning written) to the underlying <code>Stream</code>. So far, so good. Moreover, there’s a difference between flushing to the underlying stream and flushing the underlying stream. Those sound almost identical, but they’re not: in the former case, we’re effectively calling <code>_stream.Write(buffer)</code> to write the buffer to that stream, and in the latter case, we’re effectively calling <code>_stream.Flush()</code> to force any buffering <em>that</em> stream was doing to propagate it to <em>its</em> underlying destination. <code>BufferedStream</code> really shouldn’t be in the business of doing the latter when <code>Write</code>‘ing to the <code>BufferedStream</code>, and in general it wasn’t… except in one case. Whereas most of the writing-related methods would not call <code>_stream.Flush()</code>, for some reason <code>WriteByte</code> did. In particular for cases where the <code>BufferedStream</code> is configured with a small buffer, and where the underlying stream’s flush is relatively expensive (e.g. <code>DeflateStream.Flush</code> forces any buffered bytes to be compressed and emitted), that can be problematic for performance, nevermind the inconsistency. This change simply fixes the inconsistency, such that <code>WriteByte</code> no longer forces a flush on the underlying stream.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.IO.Compression;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private byte[] _bytes;

    [GlobalSetup]
    public void Setup()
    {
        _bytes = new byte[1024 * 1024];
        new Random(42).NextBytes(_bytes);
    }

    [Benchmark]
    public void WriteByte()
    {
        using Stream s = new BufferedStream(new DeflateStream(Stream.Null, CompressionLevel.SmallestSize), 256);
        foreach (byte b in _bytes)
        {
            s.WriteByte(b);
        }
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>WriteByte</td>
<td>.NET 9.0</td>
<td>73.87 ms</td>
<td>1.00</td>
</tr>
<tr>
<td>WriteByte</td>
<td>.NET 10.0</td>
<td>17.77 ms</td>
<td>0.24</td>
</tr>
</tbody>
</table>
<p>While on the subject of compression, it’s worth calling out several improvements in <code>System.IO.Compression</code> in .NET 10, too. As noted in <a href="https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-9/">Performance Improvements in .NET 9</a>, <code>DeflateStream</code>/<code>GZipStream</code>/<code>ZLibStream</code> are managed wrappers around an underlying native <code>zlib</code> library. For a long time, that was the original <code>zlib</code> (<a href="https://github.com/madler/zlib">madler/zlib</a>). Then it was Intel’s <code>zlib-intel</code> fork (<a href="https://github.com/intel/zlib">intel/zlib</a>), which is now archived and no longer maintained. In .NET 9, the library switched to using <code>zlib-ng</code> (<a href="https://github.com/zlib-ng/zlib-ng">zlib-ng/zlib-ng</a>), which is a modernized fork that’s well-maintained and optimized for a large number of hardware architectures. .NET 9 is based on <code>zlib-ng</code> 2.2.1. <a href="https://github.com/dotnet/runtime/pull/118457">dotnet/runtime#118457</a> updates it to use <code>zlib-ng</code> 2.2.5. Compared with the 2.2.1 release, there are a variety of performance improvements in <code>zlib-ng</code> itself, which .NET 10 then inherits, such as improved used of AVX2 and AVX512. Most importantly, though, the update includes a <a href="https://github.com/zlib-ng/zlib-ng/pull/1938">revert</a> that undoes a cleanup change in the 2.2.0 release; the original change removed a workaround for a function that had been slow and was found to no longer be slow, but as it turns out, it’s still slow in some circumstances (long, <em>highly</em> compressible data), resulting in a throughput regression. The fix in 2.2.5 puts back the workaround to fix the regression.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.IO.Compression;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private byte[] _data = new HttpClient().GetByteArrayAsync(@"https://raw.githubusercontent.com/dotnet/runtime-assets/8d362e624cde837ec896e7fff04f2167af68cba0/src/System.IO.Compression.TestData/DeflateTestData/xargs.1").Result;

    [Benchmark]
    public void Compress()
    {
        using ZLibStream z = new(Stream.Null, CompressionMode.Compress);
        for (int i = 0; i &lt; 100; i++)
        {
            z.Write(_data);
        }
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Compress</td>
<td>.NET 9.0</td>
<td>202.79 us</td>
<td>1.00</td>
</tr>
<tr>
<td>Compress</td>
<td>.NET 10.0</td>
<td>70.45 us</td>
<td>0.35</td>
</tr>
</tbody>
</table>
<p>The managed wrapper for <code>zlib</code> also gains some improvements. <a href="https://github.com/dotnet/runtime/pull/113587">dotnet/runtime#113587</a> from <a href="https://github.com/edwardneal">@edwardneal</a> improves the case where multiple gzip payloads are being read from the underlying <code>Stream</code>. Due to its nature, multiple complete gzip payloads can be written one after the other, and a single <code>GZipStream</code> can be used to decompress all of them as if they were one. Each time it hit a boundary between payloads, the managed wrapper was throwing away the old interop handles and creating new ones, but it can instead take advantage of reset capabilities in the underlying <code>zlib</code> library, shaving off some cycles associated with freeing and re-allocating the underlying data structures. This is a very biased micro-benchmark (a stream containing a 1000 gzip payloads that each decompresses into a single byte), highlighting the worst case, but it exemplifies the issue:</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.IO.Compression;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private MemoryStream _data;

    [GlobalSetup]
    public void Setup()
    {
        _data = new MemoryStream();
        for (int i = 0; i &lt; 1000; i++)
        {
            using GZipStream gzip = new(_data, CompressionMode.Compress, leaveOpen: true);
            gzip.WriteByte(42);
        }
    }

    [Benchmark]
    public void Decompress()
    {
        _data.Position = 0;
        using GZipStream gzip = new(_data, CompressionMode.Decompress, leaveOpen: true);
        gzip.CopyTo(Stream.Null);
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Decompress</td>
<td>.NET 9.0</td>
<td>331.3 us</td>
<td>1.00</td>
</tr>
<tr>
<td>Decompress</td>
<td>.NET 10.0</td>
<td>104.3 us</td>
<td>0.31</td>
</tr>
</tbody>
</table>
<p>Other components that sit above these streams, like <code>ZipArchive</code>, have also improved. <a href="https://github.com/dotnet/runtime/pull/103153">dotnet/runtime#103153</a> from <a href="https://github.com/edwardneal">@edwardneal</a> updates <code>ZipArchive</code> to not rely on <code>BinaryReader</code> and <code>BinaryWriter</code>, avoiding their underlying buffer allocations and having more fine-grained control over how and when exactly data is encoded/decoded and written/read. And <a href="https://github.com/dotnet/runtime/pull/102704">dotnet/runtime#102704</a> from <a href="https://github.com/edwardneal">@edwardneal</a> reduces memory consumption and allocation when updating <code>ZipArchive</code>s. A <code>ZipArchive</code> update used to be “rewrite the world”: it loaded every entry’s data into memory and rewrote all the file headers, all entry data, and the “central directory” (what the zip format calls its catalog of all the entries in the archive). A large archive would have proportionally large allocation. This PR introduces change tracking plus ordering of entries so that only the portion of the file from the first actually affected entry (or one whose variable‑length metadata/data changed) is rewritten, rather than always rewriting the whole thing. The effects can be significant.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.IO.Compression;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private Stream _zip = new MemoryStream();

    [GlobalSetup]
    public void Setup()
    {
        using ZipArchive zip = new(_zip, ZipArchiveMode.Create, leaveOpen: true);

        Random r = new(42);
        for (int i = 0; i &lt; 1000; i++)
        {
            byte[] fileBytes = new byte[r.Next(512, 2048)];
            r.NextBytes(fileBytes);
            using Stream s = zip.CreateEntry($"file{i}.txt").Open();
            s.Write(fileBytes);
        }
    }

    [Benchmark]
    public void Update()
    {
        _zip.Position = 0;
        using ZipArchive zip = new(_zip, ZipArchiveMode.Update, leaveOpen: true);
        zip.GetEntry("file987.txt")?.Delete();
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Update</td>
<td>.NET 9.0</td>
<td>987.8 us</td>
<td>1.00</td>
<td>2173.9 KB</td>
<td>1.00</td>
</tr>
<tr>
<td>Update</td>
<td>.NET 10.0</td>
<td>354.7 us</td>
<td>0.36</td>
<td>682.22 KB</td>
<td>0.31</td>
</tr>
</tbody>
</table>
<p>(<code>ZipArchive</code> and <code>ZipFile</code> also gain async APIs in <a href="https://github.com/dotnet/runtime/pull/114421">dotnet/runtime#114421</a>, a long requested feature that allows using async I/O while loading, manipulating, and saving zips.)</p>
<p>Finally, somewhere between performance and reliability, <a href="https://github.com/dotnet/roslyn-analyzers/pull/7390">dotnet/roslyn-analyzers#7390</a> from <a href="https://github.com/mpidash">@mpidash</a> adds a new analyzer for <code>StreamReader.EndOfStream</code>. <code>StreamReader.EndOfStream</code> seems like it should be harmless, but it’s quite the devious little property. The intent is to determine whether the reader is at the end up of the underlying <code>Stream</code>. Seems easy enough. If the <code>StreamReader</code> still has previously read data buffered, obviously it’s not at the end. And if the reader has previously seen EOF, e.g. <code>Read</code> returned <code>0</code>, then it obviously is at the end. But in all other situations, there’s no way to know you’re at the end of the stream (at least in the general case) without performing a read, which means this property does something properties should never do: perform I/O. Worse than just performing I/O, that read can be a blocking operation, e.g. if the <code>Stream</code> represents a network stream for a <code>Socket</code>, and performing a read actually means blocking until data is received. Even worse, though, is when it’s used in an asynchronous method, e.g.</p>
<pre><code>while (!reader.EndOfStream)
{
    string? line = await reader.ReadLineAsync();
    ...
}</code></pre>
<p>Now not only might <code>EndOfStream</code> do I/O and block, it’s doing that in a method that’s supposed to do all of its waiting asynchronously.</p>
<p>What makes this even more frustrating is that <code>EndOfStream</code> isn’t even useful in a loop like that above. <code>ReadLineAsync</code> will return a <code>null</code> string if it’s at the end of the stream, so the loop would instead be better as:</p>
<pre><code>while (await reader.ReadLineAsync() is string line)
{
    ...
}</code></pre>
<p>Simpler, cheaper, and no ticking time bombs of synchronous I/O. Thanks to this new analyzer, any such use of <code>EndOfStream</code> in an async method will trigger <code>CA2024</code>:</p>
<p><img decoding="async" src="https://devblogs.microsoft.com/dotnet/wp-content/uploads/sites/10/2025/09/CA2024.png" alt="CA2024 Analyzer"></p>
<h2>Networking</h2>
<p>Networking-related operations show up in almost every modern workload. Past releases of .NET have seen a lot of energy exerted on whittling away at networking overheads, as these components are used over and over and over, often in critical paths, and the overheads can add up. .NET 10 continues the streamlining trend.</p>
<p>As was seen with core primitives earlier, <code>IPAddress</code> and <code>IPNetwork</code> are both imbued with UTF8 parsing capabilities, thanks to <a href="https://github.com/dotnet/runtime/pull/102144">dotnet/runtime#102144</a> from <a href="https://github.com/edwardneal">@edwardneal</a>. As is the case with most other such types in the core libraries, the UTF8-based implementation and the UTF16-based implementation are mostly the same implementation, sharing most of their code via generic methods parameterized on <code>byte</code> vs <code>char</code>. And as a result of the focus on enabling UTF8, not only can you parse UTF8 bytes directly rather than needing to transcode first, the existing code actually gets a bit faster.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Net;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD", "s")]
public partial class Tests
{
    [Benchmark]
    [Arguments("Fe08::1%13542")]
    public IPAddress Parse(string s) =&gt; IPAddress.Parse(s);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Parse</td>
<td>.NET 9.0</td>
<td>71.35 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>Parse</td>
<td>.NET 10.0</td>
<td>54.60 ns</td>
<td>0.77</td>
</tr>
</tbody>
</table>
<p><code>IPAddress</code> is also imbued with <code>IsValid</code> and <code>IsValidUtf8</code> methods, thanks to <a href="https://github.com/dotnet/runtime/pull/111433">dotnet/runtime#111433</a>. It was previously possible to test the validity of an address via <code>TryParse</code>, but when successful, that would allocate the <code>IPAddress</code>; if you don’t need the resulting object but just need to know whether it’s valid, the extra allocation is wasteful.</p>
<pre><code>// dotnet run -c Release -f net10.0 --filter "*"

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Net;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private string _address = "123.123.123.123";

    [Benchmark(Baseline = true)]
    public bool TryParse() =&gt; IPAddress.TryParse(_address, out _);

    [Benchmark]
    public bool IsValid() =&gt; IPAddress.IsValid(_address);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Mean</th>
<th>Ratio</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>TryParse</td>
<td>26.26 ns</td>
<td>1.00</td>
<td>40 B</td>
<td>1.00</td>
</tr>
<tr>
<td>IsValid</td>
<td>21.88 ns</td>
<td>0.83</td>
<td>–</td>
<td>0.00</td>
</tr>
</tbody>
</table>
<p><code>Uri</code>, used in the above benchmark, also gets some notable improvements. In fact, one of my favorite improvements in all of .NET 10 is in <code>Uri</code>. The feature itself isn’t a performance improvement, but there are some interesting performance-related ramifications for it. In particular, since forever, <code>Uri</code> has had a length limitation due to implementation details. <code>Uri</code> keeps track of various offsets in the input, such as where the host portion starts, where the path starts, where the query starts, and so on. The implementer chose to use <code>ushort</code> for each of these values rather than <code>int</code>. That means the maximum length of a <code>Uri</code> is then constrained to the lengths a <code>ushort</code> can describe, namely 65,535 characters. That sounds like a ridiculously long <code>Uri</code>, one no one would ever need to go beyond… until you consider data URIs. Data URIs embed a representation of arbitrary bytes, typically Base64 encoded, in the URI itself. This allows for files to be represented directly in links, and it’s become a common way for AI-related services to send and receive data payloads, like images. It doesn’t take a very large image to exceed 65K characters, however, especially with Base64 encoding increasing the payload size by ~33%. <a href="https://github.com/dotnet/runtime/pull/117287">dotnet/runtime#117287</a> finally removes that limitation, so now <code>Uri</code> can be used to represent very large data URIs, if desired. This, however, has some performance ramifications (beyond the few percentage increase in the size of <code>Uri</code>, to accomodate the extra <code>ushort</code> to <code>int</code> bytes). In particular, <code>Uri</code> implements path compression, so for example this:</p>
<pre><code>Console.WriteLine(new Uri("http://test/hello/../hello/../hello"));</code></pre>
<p>prints out:</p>
<pre><code>http://test/hello</code></pre>
<p>As it turns out, the algorithm implementing that path compression is <code>O(N^2)</code>. Oops. With a limit of 65K characters, such a quadratic complexity isn’t a security concern (as <code>O(N^2)</code> operations can sometimes be, as if <code>N</code> is unbounded, it creates an attack vector where an attacker can do <code>N</code> work and get the attackee to do disproportionately more). But once the limit is removed entirely, it could be. As such, <a href="https://github.com/dotnet/runtime/pull/117820">dotnet/runtime#117820</a> compensates by making the path compression <code>O(N)</code>. And while in the general case, we don’t expect path compression to be a meaningfully impactful part of constructing <code>Uri</code>, in degenerate cases, even under the old limit, the change can still make a measurable improvement.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private string _input = $"http://host/{string.Concat(Enumerable.Repeat("a/../", 10_000))}{new string('a', 10_000)}";

    [Benchmark]
    public Uri Ctor() =&gt; new Uri(_input);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ctor</td>
<td>.NET 9.0</td>
<td>18.989 us</td>
<td>1.00</td>
</tr>
<tr>
<td>Ctor</td>
<td>.NET 10.0</td>
<td>2.228 us</td>
<td>0.12</td>
</tr>
</tbody>
</table>
<p>In the same vein, the longer the URI, the more effort is required to do whatever validation is needed in the constructor. <code>Uri</code>‘s constructor needs to check whether the input has any Unicode characters that might need to be handled. Rather than checking all the characters one at a time, with <a href="https://github.com/dotnet/runtime/pull/107357">dotnet/runtime#107357</a>, <code>Uri</code> can now use <code>SearchValues</code> to more quickly rule out or find the first location of a character that needs to be looked at more deeply.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private string _uri;

    [GlobalSetup]
    public void Setup()
    {
        byte[] bytes = new byte[40_000];
        new Random(42).NextBytes(bytes);
        _uri = $"data:application/octet-stream;base64,{Convert.ToBase64String(bytes)}";
    }

    [Benchmark]
    public Uri Ctor() =&gt; new Uri(_uri);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ctor</td>
<td>.NET 9.0</td>
<td>19.354 us</td>
<td>1.00</td>
</tr>
<tr>
<td>Ctor</td>
<td>.NET 10.0</td>
<td>2.041 us</td>
<td>0.11</td>
</tr>
</tbody>
</table>
<p>Other changes were made to <code>Uri</code> that further reduce construction costs in various other cases, too. For cases where the URI host is an IPv6 address, e.g. <code>http://[2603:1020:201:10::10f]</code>, <a href="https://github.com/dotnet/runtime/pull/117292">dotnet/runtime#117292</a> recognizes that scope IDs are relatively rare and makes the cases without a scope ID cheaper in exchange for making the cases with a scope ID a little more expensive.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    [Benchmark]
    public string CtorHost() =&gt; new Uri("http://[2603:1020:201:10::10f]").Host;
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>CtorHost</td>
<td>.NET 9.0</td>
<td>304.9 ns</td>
<td>1.00</td>
<td>208 B</td>
<td>1.00</td>
</tr>
<tr>
<td>CtorHost</td>
<td>.NET 10.0</td>
<td>254.2 ns</td>
<td>0.83</td>
<td>216 B</td>
<td>1.04</td>
</tr>
</tbody>
</table>
<p>(Note that the .NET 10 allocation is 8 bytes larger than the .NET 9 allocation due to the extra space required in this case for dropping the length limitation, as discussed earlier.)</p>
<p><a href="https://github.com/dotnet/runtime/pull/117289">dotnet/runtime#117289</a> also improves construction for cases where the URI requires normalization, saving some allocations by using normalization routines over spans (which were added in <a href="https://github.com/dotnet/runtime/pull/110465">dotnet/runtime#110465</a>) instead of needing to allocate <code>string</code>s for the inputs.</p>
<pre><code>using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    [Benchmark]
    public Uri Ctor() =&gt; new("http://some.host.with.ümlauts/");
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ctor</td>
<td>.NET 9.0</td>
<td>377.6 ns</td>
<td>1.00</td>
<td>440 B</td>
<td>1.00</td>
</tr>
<tr>
<td>Ctor</td>
<td>.NET 10.0</td>
<td>322.0 ns</td>
<td>0.85</td>
<td>376 B</td>
<td>0.85</td>
</tr>
</tbody>
</table>
<p>Various improvements have also found their way into the HTTP stack. For starters, the download helpers on <code>HttpClient</code> and <code>HttpContent</code> have improved. These types expose helper methods for some of the most common forms of grabbing data; while a developer can grab the response <code>Stream</code> and consume that efficiently, for simple and common cases like “just get the whole response as a <code>string</code>” or “just get the whole response as a <code>byte[]</code>“, the <code>GetStringAsync</code> and <code>GetByteArrayAsync</code> make that really easy to do. <a href="https://github.com/dotnet/runtime/pull/109642">dotnet/runtime#109642</a> changes how these methods operate in order to better manage the temporary buffers that are required, especially in the case where the server hasn’t advertised a <code>Content-Length</code>, such that the client doesn’t know ahead of time how much data to expect and thus how much space to allocate.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Net;
using System.Net.Sockets;
using System.Text;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private HttpClient _client = new();
    private Uri _uri;

    [GlobalSetup]
    public void Setup()
    {
        Socket listener = new(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
        listener.Bind(new IPEndPoint(IPAddress.Loopback, 0));
        listener.Listen(int.MaxValue);
        _ = Task.Run(async () =&gt;
        {
            byte[] header = "HTTP/1.1 200 OK\r\nTransfer-Encoding: chunked\r\n\r\n"u8.ToArray();
            byte[] chunkData = Enumerable.Range(0, 100).SelectMany(_ =&gt; "abcdefghijklmnopqrstuvwxyz").Select(c =&gt; (byte)c).ToArray();
            byte[] chunkHeader = Encoding.UTF8.GetBytes($"{chunkData.Length:X}\r\n");
            byte[] chunkFooter = "\r\n"u8.ToArray();
            byte[] footer = "0\r\n\r\n"u8.ToArray();
            while (true)
            {
                var server = await listener.AcceptAsync();
                server.NoDelay = true;
                using StreamReader reader = new(new NetworkStream(server), Encoding.ASCII);
                while (true)
                {
                    while (!string.IsNullOrEmpty(await reader.ReadLineAsync())) ;

                    await server.SendAsync(header);
                    for (int i = 0; i &lt; 100; i++)
                    {
                        await server.SendAsync(chunkHeader);
                        await server.SendAsync(chunkData);
                        await server.SendAsync(chunkFooter);
                    }
                    await server.SendAsync(footer);
                }
            }
        });

        var ep = (IPEndPoint)listener.LocalEndPoint!;
        _uri = new Uri($"http://{ep.Address}:{ep.Port}/");
    }

    [Benchmark]
    public async Task&lt;byte[]&gt; ResponseContentRead_ReadAsByteArrayAsync()
    {
        using HttpResponseMessage resp = await _client.GetAsync(_uri);
        return await resp.Content.ReadAsByteArrayAsync();
    }

    [Benchmark]
    public async Task&lt;string&gt; ResponseHeadersRead_ReadAsStringAsync()
    {
        using HttpResponseMessage resp = await _client.GetAsync(_uri, HttpCompletionOption.ResponseHeadersRead);
        return await resp.Content.ReadAsStringAsync();
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>ResponseContentRead_ReadAsByteArrayAsync</td>
<td>.NET 9.0</td>
<td>1.438 ms</td>
<td>1.00</td>
<td>912.71 KB</td>
<td>1.00</td>
</tr>
<tr>
<td>ResponseContentRead_ReadAsByteArrayAsync</td>
<td>.NET 10.0</td>
<td>1.166 ms</td>
<td>0.81</td>
<td>519.12 KB</td>
<td>0.57</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>ResponseHeadersRead_ReadAsStringAsync</td>
<td>.NET 9.0</td>
<td>1.528 ms</td>
<td>1.00</td>
<td>1166.77 KB</td>
<td>1.00</td>
</tr>
<tr>
<td>ResponseHeadersRead_ReadAsStringAsync</td>
<td>.NET 10.0</td>
<td>1.306 ms</td>
<td>0.86</td>
<td>773.3 KB</td>
<td>0.66</td>
</tr>
</tbody>
</table>
<p><a href="https://github.com/dotnet/runtime/pull/117071">dotnet/runtime#117071</a> reduces overheads associated with HTTP header validation. In the <code>System.Net.Http</code> implementation, some headers have dedicated parsers for them, while many (the majority of custom ones that services define) don’t. This PR recognizes that for these, the validation that needs to be performed amounts to only checking for forbidden newline characters, and the objects that were being created for all headers weren’t necessary for these.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Net.Http.Headers;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private readonly HttpResponseHeaders _headers = new HttpResponseMessage().Headers;

    [Benchmark]
    public void Add()
    {
        _headers.Clear();
        _headers.Add("X-Custom", "Value");
    }

    [Benchmark]
    public object GetValues()
    {
        _headers.Clear();
        _headers.TryAddWithoutValidation("X-Custom", "Value");
        return _headers.GetValues("X-Custom");
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Add</td>
<td>.NET 9.0</td>
<td>28.04 ns</td>
<td>1.00</td>
<td>32 B</td>
<td>1.00</td>
</tr>
<tr>
<td>Add</td>
<td>.NET 10.0</td>
<td>12.61 ns</td>
<td>0.45</td>
<td>–</td>
<td>0.00</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>GetValues</td>
<td>.NET 9.0</td>
<td>82.57 ns</td>
<td>1.00</td>
<td>64 B</td>
<td>1.00</td>
</tr>
<tr>
<td>GetValues</td>
<td>.NET 10.0</td>
<td>23.97 ns</td>
<td>0.29</td>
<td>32 B</td>
<td>0.50</td>
</tr>
</tbody>
</table>
<p>For folks using HTTP/2, <a href="https://github.com/dotnet/runtime/pull/112719">dotnet/runtime#112719</a> decreases per-connection memory consumption, by changing the <code>HPackDecoder</code> to lazily grow its buffers, starting from expected-case sizing rather than worst-case. (“HPACK” is the header compression algorithm used by HTTP/2, utilizing a table shared between client and server for managing commonly transmitted headers.) It’s a little hard to measure in a micro-benchmark, since in a real app the connections get reused (and the benefits here aren’t about temporary allocation but rather connection density and overall working set), but we can get a glimpse of it by doing what you’re not supposed to do and create a new <code>HttpClient</code> for each request (you’re not supposed to do that, or more specifically not supposed to create a new handler for each request, because doing so tears down the connection pool and the connections it contains… which is bad for an app but exactly what we want for our micro-benchmark).</p>
<pre><code>// For this benchmark, change the benchmark.csproj to start with:
//     &lt;Project Sdk="Microsoft.NET.Sdk.Web"&gt;
// instead of:
//     &lt;Project Sdk="Microsoft.NET.Sdk"&gt;
// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using System.Net;
using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using Microsoft.AspNetCore.Server.Kestrel.Core;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private WebApplication _app;

    [GlobalSetup]
    public async Task Setup()
    {
        var builder = WebApplication.CreateBuilder();
        builder.Logging.SetMinimumLevel(LogLevel.Warning);
        builder.WebHost.ConfigureKestrel(o =&gt; o.ListenLocalhost(5000, listen =&gt; listen.Protocols = HttpProtocols.Http2));

        _app = builder.Build();
        _app.MapGet("/hello", () =&gt; Results.Text("hi from kestrel over h2c\n"));
        var serverTask = _app.RunAsync();
        await Task.Delay(300);
    }

    [GlobalCleanup]
    public async Task Cleanup()
    {
        await _app.StopAsync();
        await _app.DisposeAsync();
    }

    [Benchmark]
    public async Task Get()
    {
        using var client = new HttpClient()
        {
            DefaultRequestVersion = HttpVersion.Version20,
            DefaultVersionPolicy = HttpVersionPolicy.RequestVersionExact
        };

        var response = await client.GetAsync("http://localhost:5000/hello");
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Get</td>
<td>.NET 9.0</td>
<td>485.9 us</td>
<td>1.00</td>
<td>83.19 KB</td>
<td>1.00</td>
</tr>
<tr>
<td>Get</td>
<td>.NET 10.0</td>
<td>445.0 us</td>
<td>0.92</td>
<td>51.79 KB</td>
<td>0.62</td>
</tr>
</tbody>
</table>
<p>Also, on Linux and macOS, all HTTP use (and, more generally, all socket interactions) gets a tad cheaper from <a href="https://github.com/dotnet/runtime/pull/109052">dotnet/runtime#109052</a>, which eliminates a <code>ConcurrentDictionary&lt;&gt;</code> lookup for each asynchronous operation that completes on a <code>Socket</code>.</p>
<p>And for all you Native AOT fans, <a href="https://github.com/dotnet/runtime/pull/117012">dotnet/runtime#117012</a> also adds a feature switch that enables trimming out the HTTP/3 implementation from <code>HttpClient</code>, which can represent a very sizeable and “free” space savings if you’re not using HTTP/3 at all.</p>
<h2>Searching</h2>
<p>Someone once told me that computer science was “all about sorting and searching.” That’s not far off. Searching in one way, shape, or form is an integral part of many applications and services.</p>
<h3>Regex</h3>
<p>Whether you love or hate the terse syntax, regular expressions (regex) continue to be an integral part of software development, with applications as part of both software and the software development process. As such, it’s had robust support in .NET since the early days of the platform, with the <code>System.Text.RegularExpressions</code> namespace providing a feature-rich set of regex capabilities. The performance of <code>Regex</code> was improved significantly in .NET 5 (<a href="https://devblogs.microsoft.com/dotnet/regex-performance-improvements-in-net-5/">Regex Performance Improvements in .NET 5</a>) and then again in .NET 7, which also saw a significant amount of new functionality added (<a href="https://devblogs.microsoft.com/dotnet/regular-expression-improvements-in-dotnet-7/">Regular Expression Improvements in .NET 7</a>). It’s continued to be improved in every release since, and .NET 10 is no exception.</p>
<p>As I’ve discussed in previous blog posts about regex and performance, there are two high-level ways regex engines are implemented, either with backtracking or without. Non-backtracking engines typically work by creating some form of finite automata that represents the pattern, and then for each character consumed from the input, moves around the deterministic finite automata (DFA, meaning you can be in only a single state at a time) or non-deterministic finite automata (NFA, meaning you can be in multiple states at a time), transitioning from one state to another. A key benefit of a non-backtracking engine is that it can often make linear guarantees about processing time, where an input string of length <code>N</code> can be processed in worst-case <code>O(N)</code> time. A key downside of a non-backtracking engine is it can’t support all of the features developers are familiar with in modern regex engines, like back references. Backtracking engines are named as such because they’re able to “backtrack,” trying one approach to see if there’s a match and then going back and trying another. If you have the regex pattern <code>\w*\d</code> (which matches any number of word characters followed by a single digit) and supply it with the string <code>"12"</code>, a backtracking engine is likely to first try treating both the <code>'1'</code> and the <code>'2'</code> as word characters, then find that it doesn’t have anything to fulfill the <code>\d</code>, and thus backtrack, instead treating only the <code>'1'</code> as being consumed by the <code>\w*</code>, and leaving the <code>'2'</code> to be consumed by the <code>\d</code>. Backtracking is how engines support features like back references, variable-length lookarounds, conditional expressions, and more. They can also have excellent performance, especially on the average and best cases. A key downside, however, is their worst case, where on some patterns they can suffer from “catastrophic backtracking.” That happens when all of that backtracking leads to exploring the same input over and over and over again, possibly consuming much more than linear time.</p>
<p>Since .NET 7, .NET has had an opt-in non-backtracking engine, which is what you get with <code>RegexOptions.NonBacktracking</code>, Otherwise, it uses a backtracking engine, whether using the default interpreter, or a regex compiled to IL (<code>RegexOptions.Compiled</code>), or a regex emitted as a custom C# implementation with the regex source generator (<code>[GeneratedRegex(...)]</code>). These backtracking engines can yield exceptional performance, but due to their backtracking nature, they are susceptible to bad worst-case performance, which is why specifying timeouts to a <code>Regex</code> is often encouraged, especially when using patterns of unknown provenance. Still, there are things backtracking engines can do to help mitigate some such backtracking, in particular avoiding the need for some of the backtracking in the first place.</p>
<p>One of the main tools backtracking engines offer for reduced backtracking is an “atomic” construct. Some regex syntaxes surface this via “possessive quantifiers,” while others, including .NET, surface it via “atomic groups.” They’re fundamentally the same thing, just expressed in the syntax differently. An atomic group in .NET’s regex syntax is a group that is never backtracked into. If we take our previous <code>\w*\d</code> example, we could wrap the <code>\w*</code> loop in an atomic group like this: <code>(?&gt;\w*)\d</code>. In doing so, whatever that <code>\w*</code> consumes won’t change via backtracking after exiting the group and moving on to whatever comes after it in the pattern. So if I try to match <code>"12"</code> with such a pattern, it’ll fail, because the <code>\w*</code> will consume both characters, the <code>\d</code> will have nothing to match, and no backtracking will be applied, because the <code>\w*</code> is wrapped in an atomic group and thus exposes no backtracking opportunities.</p>
<p>In that example, wrapping the <code>\w*</code> with an atomic group changes the meaning of the pattern, and thus it’s not something that a regex engine could choose to do automatically. However, there are many cases where wrapping otherwise backtracking constructs in an atomic group does not observably change behavior, because any backtracking that would otherwise happen would provably never be fruitful. Consider a pattern <code>a*b</code>. <code>a*b</code> is observably identical to <code>(?&gt;a*)b</code>, which says that the <code>a*</code> should not be backtracked into. That’s because there’s nothing the <code>a*</code> can “give back” (which can only be <code>a</code>s) that would satisfy what comes next in the pattern (which is only <code>b</code>). It’s thus valid for a backtracking engine to transform how it processes <code>a*b</code> to instead be the equivalent of how it processes <code>(?&gt;a*)b</code>. And the .NET regex engine has been capable of such transformations since .NET 5. This can result in massive improvements to throughput. With backtracking, waving my hands, we effectively need to execute everything after the backtracking construct for each possible position we could backtrack to. So, for example, with <code>\w*SOMEPATTERN</code>, if the <code>w*</code> successfully initially consumes 100 characters, we then possibly need to try to match <code>SOMEPATTERN</code> up to 100 different times, as we may need to backtrack up to 100 times and re-evaluate <code>SOMEPATTERN</code> each time we give back one of the things initially matched. If we instead make that <code>(?&gt;\w*)</code>, we eliminate all but one of those! That makes improvements to this ability to automatically transform backtracking constructs to be non-backtracking possibly massive improvements in performance, and practically every release of .NET since .NET 5 has increased the set of patterns that are automatically transformed. .NET 10 included.</p>
<p>Let’s start with <a href="https://github.com/dotnet/runtime/pull/117869">dotnet/runtime#117869</a>, which teaches the regex optimizer about more “disjoint” sets. Consider the previous example of <code>a*b</code>, and how I said we can make that <code>a*</code> loop atomic because there’s nothing <code>a*</code> can “give back” that matches <code>b</code>. That is a general statement about auto-atomicity: a loop can be made atomic if it’s guaranteed to end with something that can’t possibly match the thing that comes after it. So, if I have <code>[abc]+[def]</code>, that loop can be made atomic, because there’s nothing <code>[abc]</code> can match that <code>[def]</code> can also match. In contrast, if the expression were instead <code>[abc]+[cef]</code>, that loop must not be made atomic automatically, as doing so could change behavior. The sets <em>do</em> overlap, as both can match <code>'c'</code>. So, for example, if the input were just <code>"cc"</code>, the original expression should match it (the <code>[abc]*</code> loop would match <code>'c'</code> with one iteration of the loop and then the second <code>'c'</code> would satisfy the <code>[cef]</code> set), but if the expression were instead <code>(?&gt;[abc]+)[cef]</code>, it would no longer match, as the <code>[abc]+</code> would consume both <code>'c'</code>s, and there’d be nothing left for the <code>[cef]</code> set to match. Two sets that don’t have any overlap are referred to as being “disjoint,” and so the optimizer needs to be able to prove the disjointedness of sets in order to perform these kinds of auto-atomicity optimizations. The optimizer was already able to do so for many sets, in particular ones that were composed purely of characters or character ranges, e.g. <code>[ace]</code> or <code>[a-zA-Z0-9]</code>. But many sets are instead composed of entire Unicode categories. For example, when you write <code>\d</code>, unless you’ve specified <code>RegexOptions.ECMAScript</code> that’s the same as <code>\p{Nd}</code>, which says “match any character in the Unicode category of Number decimal digits”, aka all characters for which <code>char.GetUnicodeCategory</code> returns <code>UnicodeCategory.DecimalDigitNumber</code>. And the optimizer was unable to reason about overlap between such sets. So, for example, if you had the expression <code>\w*\p{Sm}</code>, that matches anything that’s any number of word characters followed by a math symbol (<code>UnicodeCategory.MathSymbol</code>). <code>\w</code> is actually just a set of eight specific Unicode categories, such that the previous expression behaves identically to if I’d written <code>[\p{Ll}\p{Lu}\p{Lt}\p{Lm}\p{Lo}\p{Mn}\p{Nd}\p{Pc}]*\p{Sm}</code> (<code>\w</code> is composed of <code>UnicodeCategory.UppercaseLetter</code>, <code>UnicodeCategory.LowercaseLetter</code>, <code>UnicodeCategory.TitlecaseLetter</code>, <code>UnicodeCategory.ModiferLetter</code>, <code>UnicodeCategory.OtherLetter</code>, <code>UnicodeCategory.NonSpacingMark</code>, <code>UnicodeCategory.ModiferLetter</code>, <code>UnicodeCategory.DecimalDigitNumber</code>, and <code>UnicodeCategory.ConnectorPunctuation</code>). Note that none of those eight categories is the same as <code>\p{Sm}</code>, which means they’re disjoint, which means we can safely change that loop to being atomic without impacting behavior; it just makes it faster. One of the easiest ways to see the effect of this is to look at the output from the regex source generator. Before the change, if I look at the XML comment generated for that expression, I get this:</p>
<pre><code>/// ○ Match a word character greedily any number of times.
/// ○ Match a character in the set [\p{Sm}].</code></pre>
<p>and after, I get this:</p>
<pre><code>/// ○ Match a word character atomically any number of times.
/// ○ Match a character in the set [\p{Sm}].</code></pre>
<p>That one word change in the first sentence makes a huge difference. Here’s the relevant portion of the C# code emitted by the source generator for the matching routine before the change:</p>
<pre><code>// Match a word character greedily any number of times.
//{
    charloop_starting_pos = pos;

    int iteration = 0;
    while ((uint)iteration &lt; (uint)slice.Length &amp;&amp; Utilities.IsWordChar(slice[iteration]))
    {
        iteration++;
    }

    slice = slice.Slice(iteration);
    pos += iteration;

    charloop_ending_pos = pos;
    goto CharLoopEnd;

    CharLoopBacktrack:

    if (Utilities.s_hasTimeout)
    {
        base.CheckTimeout();
    }

    if (charloop_starting_pos &gt;= charloop_ending_pos)
    {
        return false; // The input didn't match.
    }
    pos = --charloop_ending_pos;
    slice = inputSpan.Slice(pos);

    CharLoopEnd:
//}</code></pre>
<p>You can see how backtracking influences the emitted code. The core loop in there is iterating through as many word characters as it can match, but then before moving on, it remembers some position information about where it was. It also sets up a label for where subsequent code should jump to if it needs to backtrack; that code undoes one of the matched characters and then retries everything that came after it. If the code needs to backtrack again, it’ll again undo one of the characters and retry. And so on. Now, here’s what the code looks like after the change:</p>
<pre><code>// Match a word character atomically any number of times.
{
    int iteration = 0;
    while ((uint)iteration &lt; (uint)slice.Length &amp;&amp; Utilities.IsWordChar(slice[iteration]))
    {
        iteration++;
    }

    slice = slice.Slice(iteration);
    pos += iteration;
}</code></pre>
<p>All of that backtracking gunk is gone; the loop matches as much as it can, and that’s that. You can see the effect this has one some cases with a micro-benchmark like this:</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Text.RegularExpressions;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private static readonly string s_input = new string(' ', 100);
    private static readonly Regex s_regex = new Regex(@"\s+\S+", RegexOptions.Compiled);

    [Benchmark]
    public int Count() =&gt; s_regex.Count(s_input);
}</code></pre>
<p>This is a simple test where we’re trying to match any positive number of whitespace characters followed by any positive number of non-whitespace characters, giving it an input composed entirely of whitespace. Without atomicity, the engine is going to consume all of the whitespace as part of the <code>\s+</code> but will then find that there isn’t any non-whitespace available to match the <code>\S+</code>. What does it do then? It backtracks, gives back one of the hundred spaces consumed by <code>\s+</code>, and tries again to match the <code>\S+</code>. It won’t match, so it backtracks again. And again. And again. A hundred times, until it has nothing left to try and gives up. With atomicity, all that backtracking goes away, allowing it to fail faster.</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Count</td>
<td>.NET 9.0</td>
<td>183.31 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>Count</td>
<td>.NET 10.0</td>
<td>69.23 ns</td>
<td>0.38</td>
</tr>
</tbody>
</table>
<p><a href="https://github.com/dotnet/runtime/pull/117892">dotnet/runtime#117892</a> is a related improvement. In regex, <code>\b</code> is called a “word boundary”; it checks whether the wordness of the previous character (whether the previous character matches <code>\w</code>) matches the wordness of the next character, calling it a boundary if they differ. You can see this in the engine’s <code>IsBoundary</code> helper’s implementation, which follows (note that according to <a href="http://www.unicode.org/reports/tr18/">TR18</a> whether a character is considered a boundary word char is <em>almost</em> exactly the same as <code>\w</code>, except with two additional zero-width Unicode characters also included):</p>
<pre><code>internal static bool IsBoundary(ReadOnlySpan&lt;char&gt; inputSpan, int index)
{
    int indexM1 = index - 1;
    return ((uint)indexM1 &lt; (uint)inputSpan.Length &amp;&amp; RegexCharClass.IsBoundaryWordChar(inputSpan[indexM1])) !=
           ((uint)index &lt; (uint)inputSpan.Length &amp;&amp; RegexCharClass.IsBoundaryWordChar(inputSpan[index]));
}</code></pre>
<p>The optimizer already had a special-case in its auto-atomicity logic that had knowledge of boundaries and their relationship to <code>\w</code> and <code>\d</code>, specifically. So, if you had <code>\w+\b</code>, the optimizer would recognize that in order for the <code>\b</code> to match, what comes after what the <code>\w+</code> matches must necessarily not match <code>\w</code>, because then it wouldn’t be a boundary, and thus the <code>\w+</code> could be made atomic. Similarly, with a pattern of <code>\d+\b</code>, it would recognize that what came after must not be in <code>\d</code>, and could make the loop atomic. It didn’t generalize this, though. Now in .NET 10, it does. This PR teaches the optimizer how to recognize subsets of <code>\w</code>, because, as with the special-case of <code>\d</code>, any subset of <code>\w</code> can similarly benefit: if what comes before the <code>\b</code> is a word character, what comes after must not be. Thus, with this PR, an expression like <code>[a-zA-Z]+\b</code> will now have the loop made atomic.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Text.RegularExpressions;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private static readonly string s_input = "Supercalifragilisticexpialidocious1";
    private static readonly Regex s_regex = new Regex(@"^[A-Za-z]+\b", RegexOptions.Compiled);

    [Benchmark]
    public int Count() =&gt; s_regex.Count(s_input);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Count</td>
<td>.NET 9.0</td>
<td>116.57 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>Count</td>
<td>.NET 10.0</td>
<td>21.74 ns</td>
<td>0.19</td>
</tr>
</tbody>
</table>
<p>Just doing a better job of set disjointedness analysis is helpful, but more so is actually recognizing whole new classes of things that can be made atomic. In prior releases, the auto-atomicity optimizations only kicked in for loops over single characters, e.g. <code>a*</code>, <code>[abc]*?</code>, <code>[^abc]*</code>. That is obviously only a subset of loops, as many loops are composed of more than just a single character; loops can surround any regex construct. Even a capture group thrown into the mix would knock the auto-atomicity behavior off the rails. Now with <a href="https://github.com/dotnet/runtime/pull/117943">dotnet/runtime#117943</a>, a significant number of loops involving more complicated constructs can be made atomic. Loops larger than a single character are tricky, though, as there are more things that need to be taken into account when reasoning through atomicity. With a single character, we only need to prove disjointedness for that one character with what comes after it. But, consider an expression like <code>([a-z][0-9])+a1</code>. Can that loop be made atomic? What comes after the loop (<code>'a'</code>) is provably disjoint from what ends the loop (<code>[0-9]</code>), and yet making this loop atomic automatically would change behavior and be a no-no. Imagine if the input were <code>"b2a1"</code>. That matches; if this expression is processed normally, the loop would match a single iteration, consuming the <code>"b2"</code>, and then the <code>a1</code> after the loop would consume the corresponding <code>a1</code> in the input. But, if the loop were made atomic, e.g. <code>(?&gt;([a-z][0-9])+)a1</code>, the loop would end up performing two iterations and consuming both the <code>"b2"</code> and the <code>"a1"</code>, leaving nothing for the <code>a1</code> in the pattern. As it turns out, we not only need to ensure what ends the loop is disjoint from what comes after it, we also need to ensure that what starts the loop is disjoint from what comes after it. That’s not all, though. Now consider an expression <code>^(a|ab)+$</code>. This matches an entire input composed of <code>"a"</code>s and <code>"ab"</code>s. Given an input string like <code>"aba"</code>, this will match successfully, as it will consume the <code>"ab"</code> with the second branch of the alternation, and then consume the remaining <code>a</code> with the first branch of the alternation on the next iteration of the loop. But now consider what happens if we make the loop atomic: <code>^(?&gt;(a|ab)+)$</code>. Now on that same input, the initial <code>a</code> in the input will be consumed by the first branch of the alternation, and that will satisfy the loop’s minimum bound of 1 iteration, exiting the loop. It’ll then proceed to validate that it’s at the end of the string, and fail, but with the loop now atomic, there’s nothing to backtrack into, and the whole match fails. Oops. The problem here is that the loop’s ending must not only be disjoint with what comes next, and the loop’s beginning must not only be disjoint with what comes next, but because it’s a loop, what comes next can actually be itself, which means the loop’s beginning and ending must be disjoint from each other. Those criteria significantly limit to what patterns this can be applied, but even with that, it’s still surprisingly common: <code>dotnet/runtime-assets</code> (which contains test assets for use with <code>dotnet/runtime</code>) contains a <a href="https://github.com/dotnet/runtime-assets/blob/f9ac0b368d930728d6740686de29b5276958d15b/src/System.Text.RegularExpressions.TestData/Regex_RealWorldPatterns.json">database of regex patterns</a> sourced from appropriately-licensed nuget packages, yielding almost 20,000 unique patterns, and more than 7% of those were positively impacted by this.</p>
<p>Here is an example that’s searching <a href="https://www.gutenberg.org/cache/epub/3200/pg3200.txt">“The Entire Project Gutenberg Works of Mark Twain”</a> for sequences of all lowercase ASCII words, each followed by a space, and then all followed by an uppercase ASCII letter.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Text.RegularExpressions;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private static readonly string s_input = new HttpClient().GetStringAsync(@"https://www.gutenberg.org/cache/epub/3200/pg3200.txt").Result;
    private static readonly Regex s_regex = new Regex(@"([a-z]+ )+[A-Z]", RegexOptions.Compiled);

    [Benchmark]
    public int Count() =&gt; s_regex.Count(s_input);
}</code></pre>
<p>In previous releases, that inner loop would be made atomic, but the outerloop would remain greedy (backtracking). From the XML comment generated by the source generator, we get this:</p>
<pre><code>/// ○ Loop greedily at least once.
///     ○ 1st capture group.
///         ○ Match a character in the set [a-z] atomically at least once.
///         ○ Match ' '.
/// ○ Match a character in the set [A-Z].</code></pre>
<p>Now in .NET 10, we get this:</p>
<pre><code>/// ○ Loop atomically at least once.
///     ○ 1st capture group.
///         ○ Match a character in the set [a-z] atomically at least once.
///         ○ Match ' '.
/// ○ Match a character in the set [A-Z].</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Count</td>
<td>.NET 9.0</td>
<td>573.4 ms</td>
<td>1.00</td>
</tr>
<tr>
<td>Count</td>
<td>.NET 10.0</td>
<td>504.6 ms</td>
<td>0.88</td>
</tr>
</tbody>
</table>
<p>As with any optimization, auto-atomicity should never change observable behavior; it should just make things faster. And as such, every case where atomicity is automatically applied requires it being reasoned through to ensure that the optimization is of sound logic. In some cases, the optimization was written to be conservative, as the relevant reasoning through the logic wasn’t previously done. An example of that is addressed by <a href="https://github.com/dotnet/runtime/pull/118191">dotnet/runtime#118191</a>, which makes a few tweaks to how boundaries are handled in the auto-atomicity logic, removing some constraints that were put in place but which, as it turns out, are unnecessary. The core logic that implements the atomicity analysis is a method that looks like this:</p>
<pre><code>private static bool CanBeMadeAtomic(RegexNode node, RegexNode subsequent, ...)</code></pre>
<p><code>node</code> is the representation for the part of the regex that’s being considered for becoming atomic (e.g. a loop) and <code>subsequent</code> is what comes immediately after it in the pattern; the method then proceeds to validate <code>node</code> against <code>subsequent</code> to see whether it can prove there wouldn’t be any behavioral changes if <code>node</code> were made atomic. However, not all cases are sufficiently handled just by validating against <code>subsequent</code> itself. Consider a pattern like <code>a*b*\w</code>, where <code>node</code> represents <code>a*</code> and <code>subsequent</code> represents <code>b*</code>. <code>a</code> and <code>b</code> are obviously disjoint, and so <code>node</code> can be made atomic with regards to <code>subsequent</code>, but… here <code>subsequent</code> is also “nullable,” meaning it might successfully match 0 characters (the loop has a lower bound of 0). And in such a case, what comes after the <code>a*</code> won’t necessarily be a <code>b</code> but could be what comes after the <code>b*</code>, which here is a <code>\w</code>, which overlaps with <code>a</code>, and as such, it would be a behavioral change to make this into <code>(?&gt;a*)b*\w</code>. Consider an input of just <code>"a"</code>. With the original pattern, <code>a*</code> would successfully match the empty string with 0 iterations, <code>b*</code> would successfully match the empty string with 0 iterations, and then <code>\w</code> would successfully match the input <code>'a'</code>. But with the atomicized pattern, <code>(?&gt;a*)</code> would successfully match the input <code>'a'</code> with a single iteration, leaving nothing to match the <code>\w</code>. As such, when <code>CanBeMadeAtomic</code> detects that <code>subsequent</code> may be nullable and successfully match the empty string, it needs to iterate to also validate against what comes after <code>subsequent</code> (and possibly again and again if what comes next itself keeps being nullable).</p>
<p><code>CanBeMadeAtomic</code> already factored in boundaries (<code>\b</code> and <code>\B</code>), but it did so with the conservative logic that since a boundary is “zero-width” (meaning it doesn’t consume any input), it must always require checking what comes after it. But that’s not actually the case. Even though a boundary is zero-width, it still makes guarantees about what comes next: if the prior character is a word character, the next is guaranteed to not be with a successful match. And as such, we can safely make this more liberal and not require checking what comes next.</p>
<p>This last example also highlights an interesting aspect of this auto-atomicity optimization in general. There is nothing this optimization provides that the developer writing the regex in the first place couldn’t have done themselves. Instead of <code>a*b</code>, a developer can write <code>(?&gt;a*)b</code>. Instead of <code>[a-z]+(?= )</code>, a developer can write <code>(?&gt;[a-z]+)(?= )</code>. And so on. But when was the last time you explicitly added an atomic group to a regex you authored? Of the almost 20,000 regular expression patterns in the aforementioned database of real-world regexes sourced from nuget, care to guess how many include an explicitly written atomic group? The answer: ~100. It’s just not something developers in general think to do, so although the optimization transforms the user’s pattern into something they could have written themselves, it’s an incredibly valuable optimization, especially since now in .NET 10 over 70% of those patterns have at least one construct upgraded to be atomic.</p>
<p>The auto-atomicity optimization is an example of the optimizer removing unnecessary work. A key example of that, but certainly not the only example. Several additional PRs in .NET 10 have also eliminated unnecessary work, in other ways.</p>
<p><a href="https://github.com/dotnet/runtime/pull/118084">dotnet/runtime#118084</a> is a fun example of this, but to understand it, we first need to understand lookarounds. A “lookaround” is a regex construct that makes its contents zero-width. Whereas when a set like “[abc]” matches it consumes a single character from the input, or when a loop like “[abc]{3,5}” matches it’ll consume between 3-5 characters from the input, lookarounds (as with other zero-width constructs, like anchors) don’t consume anything. You wrap a lookaround around a regex expression, and it effectively makes the consumption temporary, e.g. if I wrap <code>[abc]{3,5}</code> in a positive lookahead as <code>(?=[abc]{3,5})</code>, that will end up performing the whole match for the 3-5 set characters, but those characters won’t remain consumed after exiting the lookaround; the lookaround is just performing a test to ensure the inner pattern matches but the position in the input is reset upon exiting the lookaround. This is again visualized easily by looking at the code emitted by the regex source generator for a pattern like <code>(?=[abc]{3,5})abc</code>:</p>
<pre><code>// Zero-width positive lookahead.
{
    int positivelookahead_starting_pos = pos;

    // Match a character in the set [a-c] atomically at least 3 and at most 5 times.
    {
        int iteration = 0;
        while (iteration &lt; 5 &amp;&amp; (uint)iteration &lt; (uint)slice.Length &amp;&amp; char.IsBetween(slice[iteration], 'a', 'c'))
        {
            iteration++;
        }

        if (iteration &lt; 3)
        {
            return false; // The input didn't match.
        }

        slice = slice.Slice(iteration);
        pos += iteration;
    }

    pos = positivelookahead_starting_pos;
    slice = inputSpan.Slice(pos);
}

// Match the string "abc".
if (!slice.StartsWith("abc"))
{
    return false; // The input didn't match.
}</code></pre>
<p>We can see that the lookaround is caching the starting position, then proceeding to try to match the loop it contains, and if successful, resetting the matching position to what it was when the lookaround was entered, then continuing on to perform the match for what comes after the lookaround.</p>
<p>These examples have been for a particular flavor of lookaround, called a positive lookahead. There are four variations of lookarounds composed of two choices: positive vs negative, and lookahead vs lookbehind. Lookaheads validate the pattern starting from the current position and proceeding forwards (as matching typically is), while lookbehinds validate the pattern starting from just before the current position and extending backwards. Positive indicates that the pattern should match, while negative indicates that the pattern should not match. So, for example, the negative lookbehind <code>(?&lt;!\w)</code> will match if what comes before the current position is not a word character.</p>
<p>Negative lookarounds are particularly interesting, because, unlike every other regex construct, they guarantee that the pattern they contain <em>doesn’t</em> match. That also makes them special in other regards, in particular around capture groups. For a positive lookaround, even though they’re zero width, anything capture groups inside of the lookaround capture still remain to outside of the lookaround, e.g. <code>^(?=(abc))\1$</code>, which entails a backreference successfully matching what’s captured by the capture group inside of the positive lookahead, will successfully match the input <code>"abc"</code>. But because <em>negative</em> lookarounds guarantee their content doesn’t match, it would be counter-intuitive if anything captured inside of a negative lookaround persisted past the lookaround… so it doesn’t. The capture groups inside of a negative lookaround are still possibly meaningful, in particular if there’s a backreference also <em>inside of</em> the same lookaround that refers back to the capture group, e.g. the pattern <code>^(?!(ab)\1cd)ababc</code> is checking to see whether the input does not begin with <code>ababcd</code> but does begin with <code>ababc</code>. But if there’s no backreference, the capture group is useless, and we don’t need to do any work for it as part of processing the regex (work like remembering where the capture occurred). Such capture groups can be completely eliminated from the node tree as part of the optimization phase, and that’s exactly what <a href="https://github.com/dotnet/runtime/pull/118084">dotnet/runtime#118084</a> does. Just as developers often use backtracking constructs without thinking to make them atomic, developers also often use capture groups purely as a grouping mechanism without thinking of the possibility of making them non-capturing groups. Since captures in general need to persist to be examined by the <code>Match</code> object returned from a <code>Regex</code>, we can’t just eliminate all capture groups that aren’t used internally in the pattern, but we can for these negative lookarounds. Consider a pattern like <code>(?&lt;!(access|auth)\s)token</code>, which is looking for the word <code>"token"</code> when it’s <em>not</em> preceeded by <code>"access "</code> or <code>"auth "</code>; the developer here (me, in this case) did what’s fairly natural, putting a group around the alternation so that the <code>\s</code> that follows either word can be factored out (if it were instead <code>access|auth\s</code>, the whitespace set would only be in the second branch of the alternation and wouldn’t apply to the first). But my “simple” grouping here is actually a capture group by default; to get it to be non-capturing, I’d either need to write it as a non-capturing group, i.e. <code>(?&lt;!(?:access|auth)\s)token</code>, or I’d need to use <code>RegexOptions.ExplicitCapture</code>, which turns all non-named capture groups into non-capturing groups.</p>
<p>We can similarly remove other work related to lookarounds. As noted, positive lookarounds exist to transform any pattern into a zero-width pattern, i.e. don’t consume anything. That’s all they do. If the pattern being wrapped by the positive lookaround is already zero-width, the lookaround contributes nothing to the behavior of the expression and can be removed. So, for example, if you have <code>(?=$)</code>, that can be transformed into just <code>$</code>. That’s exactly what <a href="https://github.com/dotnet/runtime/pull/118091">dotnet/runtime#118091</a> does.</p>
<p><a href="https://github.com/dotnet/runtime/pull/118079">dotnet/runtime#118079</a> and <a href="https://github.com/dotnet/runtime/pull/118111">dotnet/runtime#118111</a> handle other transformations relative to zero-width assertions, in particular with regards to loops. For whatever reason, you’ll see developers wrapping zero-width assertions inside of loops, either making such assertions optional (e.g. <code>\b?</code>) or with some larger upper bound (e.g. <code>(?=abc)*</code>). But these zero-width assertions don’t consume anything; their sole purpose is to flag whether something is true or false at the current position. If you make such a zero-width assertion optional, then you’re saying “check whether it’s true or false, and then immediately ignore the answer, because both answers are valid”; as such, the whole expression can be removed as a nop. Similarly, if you wrap a loop with an upper bound greater than 1 around such an expression, you’re saying “check whether it’s true or false, now without changing anything check again, and check again, and check again.” There’s a common English expression that’s something along the lines of “insanity is doing the same thing over and over again and expecting different results.” That applies here. There may be behavioral benefits to invoking the zero-width assertion once, but repeating it beyond that is a pure waste: if it was going to fail, it would have failed the first time. Mostly. There’s one specific case where the difference is actually observable, and that has to do with an interesting feature of .NET regexes: capture groups track <em>all</em> matched captures, not just the last. Consider this program:</p>
<pre><code>// dotnet run -c Release -f net10.0

using System.Diagnostics;
using System.Text.RegularExpressions;

Match m = Regex.Match("abc", "^(?=(\\w+)){3}abc$");
Debug.Assert(m.Success);

foreach (Group g in m.Groups)
{
    foreach (Capture c in g.Captures)
    {
        Console.WriteLine($"Group: {g.Name}, Capture: {c.Value}");
    }
}</code></pre>
<p>If you run that, you may be surprised to see that capture group #1 (the explicit group I have inside of the lookahead) provides three capture values:</p>
<pre><code>Group: 0, Capture: abc
Group: 1, Capture: abc
Group: 1, Capture: abc
Group: 1, Capture: abc</code></pre>
<p>That’s because the loop around the positive lookahead does three iterations, each iteration matches <code>"abc"</code>, and each successful capture is persisted for subsequent inspection via the <code>Regex</code> APIs. As such, we can’t optimize any loop around zero-width assertions by lowering the upper bound from greater than 1 to 1; we can only do so if it doesn’t contain any captures. And that’s what these PRs do. Given a loop that wraps a zero-width assertion that does not contain a capture, if the lower bound of the loop is 0, the whole loop and its contents can be eliminated, and if the upper bound of the loop is greater than 1, the loop itself can be removed, leaving only its contents in its stead.</p>
<p>Any time work like this is eliminated, it’s easy to construct monstrous, misleading micro-benchmarks… but it’s also a lot of fun, so, I’ll allow myself it this time.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Text.RegularExpressions;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private static readonly string s_input = new HttpClient().GetStringAsync(@"https://www.gutenberg.org/cache/epub/3200/pg3200.txt").Result;
    private static readonly Regex s_regex = new Regex(@"(?=.*\bTwain\b.*\bConnecticut\b)*.*Mark", RegexOptions.Compiled);

    [Benchmark]
    public int Count() =&gt; s_regex.Count(s_input);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Count</td>
<td>.NET 9.0</td>
<td>3,226.024 ms</td>
<td>1.000</td>
</tr>
<tr>
<td>Count</td>
<td>.NET 10.0</td>
<td>6.605 ms</td>
<td>0.002</td>
</tr>
</tbody>
</table>
<p><a href="https://github.com/dotnet/runtime/pull/118083">dotnet/runtime#118083</a> is similar. “Repeaters” are a name for a regex loop that has the same lower and upper bound, such that the contents of the loop “repeats” that fixed number of times. Typically you’ll see these written out using the <code>{N}</code> syntax, e.g. <code>[abc]{3}</code> is a repeater that requires three characters, any of which can be <code>'a'</code>, <code>'b'</code>, or <code>'c'</code>. But of course it could also be written out in long-form, just by manually repeating the contents, e.g. <code>[abc][abc][abc]</code>. Just as we saw how we can condense loops around zero-width assertions when specified in loop form, we can do the exact same thing when manually written out. So, for example, <code>\b\b</code> is the same as just <code>\b{2}</code>, which is just <code>\b</code>.</p>
<p>Another nice example of removing unnecessary work is <a href="https://github.com/dotnet/runtime/pull/118105">dotnet/runtime#118105</a>. Boundary assertions are used in many expressions, e.g. it’s quite common to see a simple pattern like <code>\b\w+\b</code>, which is trying to match an entire word. When the regex engine encounters such an assertion, historically it’s delegated to the <code>IsBoundary</code> helper shown earlier. There is, however, some subtle unnecessary work here, which is more obvious when you see what the regex source generator outputs for an expression like <code>\b\w+\b</code>. This is what the output looks like on .NET 9:</p>
<pre><code>// Match if at a word boundary.
if (!Utilities.IsBoundary(inputSpan, pos))
{
    return false; // The input didn't match.
}

// Match a word character atomically at least once.
{
    int iteration = 0;
    while ((uint)iteration &lt; (uint)slice.Length &amp;&amp; Utilities.IsWordChar(slice[iteration]))
    {
        iteration++;
    }

    if (iteration == 0)
    {
        return false; // The input didn't match.
    }

    slice = slice.Slice(iteration);
    pos += iteration;
}

// Match if at a word boundary.
if (!Utilities.IsBoundary(inputSpan, pos))
{
    return false; // The input didn't match.
}</code></pre>
<p>Pretty straightforward: match the boundary, consume as many word characters as possible, then again match a boundary. Except if you look back at the definition of <code>IsBoundary</code>, you’ll notice that it’s doing two checks, one against the previous character and one against the next character.</p>
<pre><code>internal static bool IsBoundary(ReadOnlySpan&lt;char&gt; inputSpan, int index)
{
    int indexM1 = index - 1;
    return ((uint)indexM1 &lt; (uint)inputSpan.Length &amp;&amp; RegexCharClass.IsBoundaryWordChar(inputSpan[indexM1])) !=
           ((uint)index &lt; (uint)inputSpan.Length &amp;&amp; RegexCharClass.IsBoundaryWordChar(inputSpan[index]));
}</code></pre>
<p>Now, look at that, and look back at the generated code, and look at this again, and back at the source generated code again. See anything unnecessary? When we perform the first boundary comparison, we are dutifully checking the previous character, which is necessary, but then we’re checking the current character, which is about to checked against <code>\w</code> by the subsequent <code>\w+</code> loop. Similarly for the second boundary check, we just finished matching <code>\w+</code>, which will have only successfully matched if there was at least one word character. While we still need to validate that the subsequent character is not a boundary character (there are two characters considered boundary characters that aren’t word characters), we don’t need to re-validate the previous character. So, <a href="https://github.com/dotnet/runtime/pull/118105">dotnet/runtime#118105</a> overhauls boundary handling in the compiler and source generator to emit customized boundary checks based on surrounding knowledge. If it can prove that the subsequent construct will validate that a character is a word character, then it only needs to validate that the previous character is not a boundary character; similarly, if it can prove that the previous construct will have already validated that a character is a word character, then it only needs to validate that the next character isn’t. This leads to this tweaked source generated code now on .NET 10:</p>
<pre><code>// Match if at a word boundary.
if (!Utilities.IsPreWordCharBoundary(inputSpan, pos))
{
    return false; // The input didn't match.
}

// Match a word character atomically at least once.
{
    int iteration = 0;
    while ((uint)iteration &lt; (uint)slice.Length &amp;&amp; Utilities.IsWordChar(slice[iteration]))
    {
        iteration++;
    }

    if (iteration == 0)
    {
        return false; // The input didn't match.
    }

    slice = slice.Slice(iteration);
    pos += iteration;
}

// Match if at a word boundary.
if (!Utilities.IsPostWordCharBoundary(inputSpan, pos))
{
    return false; // The input didn't match.
}</code></pre>
<p>Those <code>IsPreWordCharBoundary</code> and <code>IsPostWordCharBoundary</code> helpers are just half the checks in the main boundary helper. In cases where there are lots of boundary tests being performed, the reduced check count can add up.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Text.RegularExpressions;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private static readonly string s_input = new HttpClient().GetStringAsync(@"https://www.gutenberg.org/cache/epub/3200/pg3200.txt").Result;
    private static readonly Regex s_regex = new Regex(@"\ba\b", RegexOptions.Compiled | RegexOptions.IgnoreCase);

    [Benchmark]
    public int CountStandaloneAs() =&gt; s_regex.Count(s_input);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>CountStandaloneAs</td>
<td>.NET 9.0</td>
<td>20.58 ms</td>
<td>1.00</td>
</tr>
<tr>
<td>CountStandaloneAs</td>
<td>.NET 10.0</td>
<td>19.25 ms</td>
<td>0.94</td>
</tr>
</tbody>
</table>
<p>The <code>Regex</code> optimizer is all about pattern recognition: it looks for sequences and shapes it recognizes and performs transforms over those to put them into a more efficiently-processable form. One example of this is with alternations around coalescable branches. Let’s say you have an alternation <code>a|e|i|o|u</code>. You could process that as an alternation, but it’s also much more efficiently represented and processed as the equivalent set <code>[aeiou]</code>. There is an optimization that does such transformations as part of handling alternations. However, through .NET 9, it only handled single characters and sets, but not negated sets. For example, it would transform <code>a|e|i|o|u</code> into <code>[aeiou]</code>, and it would transform <code>[aei]|[ou]</code> into <code>[aeiou]</code>, but it would not merge negations like <code>[^\n]</code>, otherwise known as <code>.</code> (when not in <code>RegexOptions.Singleline</code> mode). When developers want a set that represents all characters, there are various idioms they employ, such as <code>[\s\S]</code>, which says “this is a set of all whitespace and non-whitespace characters”, aka everything. Another common idiom is <code>\n|.</code>, which is the same as <code>\n|[^\n]</code>, which says “this is an alternation that matches either a newline or anything other than a newline”, aka also everything. Unfortunately, while examples like <code>[\d\D]</code> have been handled well, <code>.|\n</code> has not, because of the gap in the alternation optimization. <a href="https://github.com/dotnet/runtime/pull/118109">dotnet/runtime#118109</a> improves that, such that such “not” cases are mergable as part of the existing optimization. That takes a relatively expensive alternation and converts it into a super fast set check. And while, in general, set containment checks are very efficient, this one is as efficient as you can get, as it’s always true. We can see an example of this with a pattern intended to match C-style comment blocks.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Text.RegularExpressions;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private const string Input = """
        /* This is a comment. */
        /* Another comment */
        /* Multi-line
           comment */
        """;
    private static readonly Regex s_regex = new Regex(@"/\*(?:.|\n)*?\*/", RegexOptions.Compiled);

    [Benchmark]
    public int Count() =&gt; s_regex.Count(Input);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Count</td>
<td>.NET 9.0</td>
<td>344.80 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>Count</td>
<td>.NET 10.0</td>
<td>93.59 ns</td>
<td>0.27</td>
</tr>
</tbody>
</table>
<p>Note that there’s another change that helps .NET 10 here, <a href="https://github.com/dotnet/runtime/pull/118373">dotnet/runtime#118373</a>, though I hesitate to call it out as a performance improvement since it’s really more of a bug fix. As part of writing this post, these benchmark numbers were showing some oddities (it’s important in general to be skeptical of benchmark results and to investigate anything that doesn’t align with reason and expectations). The result of investigating was a one-word change that yielded significant speedups on this test, specifically when using <code>RegexOptions.Compiled</code> (the bug didn’t exist in the source generator). As part of handling lazy loops, there’s a special-case for when the lazy loop is around a set that matches any character, which, thanks to the previous PR, <code>(?:.|\n)</code> now does. That special-case recognizes that if the lazy loop matches anything, we can efficiently find the end of the lazy loop by searching for whatever comes after the loop (e.g. in this test, the loop is followed by the literal <code>"*/"</code>). Unfortunately, the helper that emits that <code>IndexOf</code> call was passed the wrong node from the pattern: it was being passed the object representing the <code>(?:.|\n)</code> any-set rather than the <code>"*/"</code> literal, which resulted in it emitting the equivalent of <code>IndexOfAnyInRange((char)0, '\uFFFF')</code> rather than the equivalent of <code>IndexOf("*/")</code>. Oops. It was still functionally correct, in that the <code>IndexOfAnyInRange</code> call would successfully match the first character and the loop would re-evaluate from that location, but that means that rather than efficiently skipping using SIMD over a bunch of positions that couldn’t possibly match, we were doing non-trivial work for each and every position along the way.</p>
<p><a href="https://github.com/dotnet/runtime/pull/118087">dotnet/runtime#118087</a> represents another interesting transformation related to alternations. It’s very common to come across alternations with empty branches, possibly because that’s what the developer wrote, but more commonly as an outcome of other transformations that have happened. For example, given the pattern <code>\r\n|\r</code>, which is trying to match line endings that begin with <code>\r</code>, there is an optimization that will factor out a common prefix of all of the branches, producing the equivalent of <code>\r(?:\n|)</code>; in other words, <code>\r</code> followed by either a line feed or empty. Such an alternation is a perfectly valid representation for this concept, but there’s a more natural one: <code>?</code>. Behaviorally, this pattern is identical to <code>\r\n?</code>, and because the latter is more common and more canonical, the regex engine has more optimizations that recognize this loop-based form, for example coalescing with other loops, or auto-atomicity. As such, this PR finds all alternations of the form <code>X|</code> and transforms them into <code>X?</code>. Similarly, it finds all alternations of the form <code>|X</code> and transforms them into <code>X??</code>. The difference between <code>X|</code> and <code>|X</code> is whether <code>X</code> is tried first or empty is tried first; similarly, the difference between the greedy <code>X?</code> loop and the lazy <code>X??</code> loop is whether <code>X</code> is tried first or empty is tried first. The impact of this can be seen in the code generated for the previously cited example. Here is the source-generated code for the heart of the matching routine for <code>\r\n|\r</code> on .NET 9:</p>
<pre><code>// Match '\r'.
if (slice.IsEmpty || slice[0] != '\r')
{
    return false; // The input didn't match.
}

// Match with 2 alternative expressions, atomically.
{
    int alternation_starting_pos = pos;

    // Branch 0
    {
        // Match '\n'.
        if ((uint)slice.Length &lt; 2 || slice[1] != '\n')
        {
            goto AlternationBranch;
        }

        pos += 2;
        slice = inputSpan.Slice(pos);
        goto AlternationMatch;

        AlternationBranch:
        pos = alternation_starting_pos;
        slice = inputSpan.Slice(pos);
    }

    // Branch 1
    {      
        pos++;
        slice = inputSpan.Slice(pos);
    }

    AlternationMatch:;
}</code></pre>
<p>Now, here’s what’s produced on .NET 10:</p>
<pre><code>// Match '\r'.
if (slice.IsEmpty || slice[0] != '\r')
{
    return false; // The input didn't match.
}

// Match '\n' atomically, optionally.
if ((uint)slice.Length &gt; (uint)1 &amp;&amp; slice[1] == '\n')
{
    slice = slice.Slice(1);
    pos++;
}</code></pre>
<p>The optimizer recognized that the <code>\r\n|\r</code> was the same as <code>\r(?:\n|)</code>, which is the same as <code>\r\n?</code>, which is the same as <code>\r(?&gt;\n?)</code>, which it can produce much simplified code for, given that it no longer needs any backtracking.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Text.RegularExpressions;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private static readonly string s_input = new HttpClient().GetStringAsync(@"https://www.gutenberg.org/cache/epub/3200/pg3200.txt").Result;
    private static readonly Regex s_regex = new Regex(@"ab|a", RegexOptions.Compiled);

    [Benchmark]
    public int Count() =&gt; s_regex.Count(s_input);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Count</td>
<td>.NET 9.0</td>
<td>23.35 ms</td>
<td>1.00</td>
</tr>
<tr>
<td>Count</td>
<td>.NET 10.0</td>
<td>18.73 ms</td>
<td>0.80</td>
</tr>
</tbody>
</table>
<p>.NET 10 also features improvements to <code>Regex</code> that go beyond just this form of work elimination. <code>Regex</code>‘s matching routines are logically factored into two pieces: finding as quickly as possible the next place that could possibly match (<code>TryFindNextPossibleStartingPosition</code>), and then performing the full matching routine at that location (<code>TryMatchAtCurrentPosition</code>). It’s desirable that <code>TryFindNextPossibleStartingPosition</code> both does its work as quickly as possible while also significantly limiting the number of locations a full match should be performed. <code>TryFindNextPossibleStartingPosition</code>, for example, could operate very quickly just by always saying that the next index in the input should be tested, which would result in the full matching logic being performed at every index in the input; that’s not great for performance. Instead, the optimizer analyzes the pattern looking for things that would allow it to quickly search for viable starting locations, e.g. fixed strings or sets at known offsets in the pattern. Anchors are some of the most valuable things the optimizer can find, as they significantly inhibit the possible places matching is valid; the ideal pattern begins with a beginning anchor (<code>^</code>), which then means the only possible place matching can be successful is at index 0.</p>
<p>We previously discussed lookarounds, but as it turns out, until .NET 10, lookarounds weren’t factored into what <code>TryFindNextPossibleStartingPosition</code> should look for. <a href="https://github.com/dotnet/runtime/pull/112107">dotnet/runtime#112107</a> changes that. It teaches the optimizer when and how to explore positive lookaheads at the beginning of a pattern for constructs that could help it more efficiently find starting locations. For example, in .NET 9, for the pattern <code>(?=^)hello</code>, here’s what the source generator emits for <code>TryFindNextPossibleStartingPosition</code>:</p>
<pre><code>private bool TryFindNextPossibleStartingPosition(ReadOnlySpan&lt;char&gt; inputSpan)
{
    int pos = base.runtextpos;

    // Any possible match is at least 5 characters.
    if (pos &lt;= inputSpan.Length - 5)
    {
        // The pattern has the literal "hello" at the beginning of the pattern. Find the next occurrence.
        // If it can't be found, there's no match.
        int i = inputSpan.Slice(pos).IndexOfAny(Utilities.s_indexOfString_hello_Ordinal);
        if (i &gt;= 0)
        {
            base.runtextpos = pos + i;
            return true;
        }
    }

    // No match found.
    base.runtextpos = inputSpan.Length;
    return false;
}</code></pre>
<p>The optimizer found the <code>"hello"</code> string in the pattern and is thus searching for that as part of finding the next possible place to do the full match. That would be excellent, if it weren’t for the lookahead that also says any match must happen at the beginning of the input. Now in .NET 10, we get this:</p>
<pre><code>private bool TryFindNextPossibleStartingPosition(ReadOnlySpan&lt;char&gt; inputSpan)
{
    int pos = base.runtextpos;

    // Any possible match is at least 5 characters.
    if (pos &lt;= inputSpan.Length - 5)
    {
        // The pattern leads with a beginning (\A) anchor.
        if (pos == 0)
        {
            return true;
        }
    }

    // No match found.
    base.runtextpos = inputSpan.Length;
    return false;
}</code></pre>
<p>That <code>pos == 0</code> check is critical, because it means we will only ever attempt the full match in one location and we can avoid the search that would happen even if we never found a good location to perform the match. Again, any time you eliminate work like this, you can construct tantalizing micro-benchmarks…</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Text.RegularExpressions;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private static readonly string s_input = new HttpClient().GetStringAsync(@"https://www.gutenberg.org/cache/epub/3200/pg3200.txt").Result;
    private static readonly Regex s_regex = new Regex(@"(?=^)hello", RegexOptions.Compiled);

    [Benchmark]
    public int Count() =&gt; s_regex.Count(s_input);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Count</td>
<td>.NET 9.0</td>
<td>2,383,784.95 ns</td>
<td>1.000</td>
</tr>
<tr>
<td>Count</td>
<td>.NET 10.0</td>
<td>17.43 ns</td>
<td>0.000</td>
</tr>
</tbody>
</table>
<p>That same PR also improved optimizations over alternations. It’s already the case that the branches of alternations are analyzed looking for common prefixes that can be factored out. For example, given the pattern <code>abc|abd</code>, the optimizer will spot the shared <code>"ab"</code> prefix at the beginning of each branch and factor that out, resulting in <code>ab(?:c|d)</code>, and will then see that each branch of the remaining alternation are individual characters, which it can convert into a set, <code>ab[cd]</code>. If, however, the branches began with anchors, these optimizations wouldn’t be applied. Given the pattern <code>^abc|^abd</code>, the code generators would end up emitting this exactly as it’s written, with an alternation with two branches, the first branch checking for the beginning and then matching <code>"abc"</code>, the second branch also checking for the beginning and then matching <code>"abd"</code>. Now in .NET 10, the anchor can be factored out, such that <code>^abc|^abd</code> ends up being rewritten as <code>^ab[cd]</code>.</p>
<p>As a small tweak, <a href="https://github.com/dotnet/runtime/pull/112065">dotnet/runtime#112065</a> also helps improve the source generated code for repeaters by using a more efficient searching routine. Let’s take the pattern <code>[0-9a-f]{32}</code> as an example. This is looking for sequences of 32 lowercase hex digits. In .NET 9, the implementation of that ends up looking like this:</p>
<pre><code>// Match a character in the set [0-9a-f] exactly 32 times.
{
    if ((uint)slice.Length &lt; 32)
    {
        return false; // The input didn't match.
    }

    if (slice.Slice(0, 32).IndexOfAnyExcept(Utilities.s_asciiHexDigitsLower) &gt;= 0)
    {
        return false; // The input didn't match.
    }
}</code></pre>
<p>Simple, clean, fairly concise, and utilizing the vectorized <code>IndexOfAnyExcept</code> to very efficiently validate that the whole sequence of 32 characters are lowercase hex. We can do a tad bit better, though. The <code>IndexOfAnyExcept</code> method not only needs to find whether the span contains something other than one of the provided values, it needs to specify the index at which that found value occurs. That’s only a few instructions, but it’s a few unnecessary instructions, since here that exact index isn’t utilized… the implementation only cares whether it’s <code>&gt;= 0</code>, meaning whether anything was found or not. As such, we can instead use the <code>Contains</code> variant of this method, which doesn’t need to spend extra cycles determining the exact index. Now in .NET 10, this is generated:</p>
<pre><code>// Match a character in the set [0-9a-f] exactly 32 times.
if ((uint)slice.Length &lt; 32 || slice.Slice(0, 32).ContainsAnyExcept(Utilities.s_asciiHexDigitsLower))
{
    return false; // The input didn't match.
}</code></pre>
<p>Finally, the .NET 10 SDK includes a new analyzer related to <code>Regex</code>. It’s oddly common to see code that determines whether an input matches a <code>Regex</code> written like this: <code>Regex.Match(...).Success</code>. While functionally correct, that’s much more expensive than <code>Regex.IsMatch(...)</code>. For all of the engines, <code>Regex.Match(...)</code> requires allocating a new <code>Match</code> object and supporting data structures (except when there isn’t a match found, in which case it’s able to use an empty singleton); in contrast, <code>IsMatch</code> doesn’t need to allocate such an instance because it doesn’t need to return such an instance (as an implementation detail, it may still use a <code>Match</code> object, but it can reuse one rather than creating a new one each time). It can also avoid other inefficiencies. <code>RegexOptions.NonBacktracking</code> is “pay-for-play” with the information it needs to gather. Determining just <em>whether</em> there’s a match is cheaper than determining exactly where the match begins and ends, which is cheaper still than determining all of the captures that make up that match. <code>IsMatch</code> is thus the cheapest, only needing to determine that there is a match, not exactly where it is or what the exact captures are, whereas <code>Match</code> needs to determine all of that. <code>Regex.Matches(...).Count</code> is similar; it’s having to gather all of the relevant details and allocate a whole bunch of objects, whereas <code>Regex.Count(...)</code> can do so in a much more efficient manner. <a href="https://github.com/dotnet/roslyn-analyzers/pull/7547">dotnet/roslyn-analyzers#7547</a> adds CA1874 and CA1875, which flag these cases and recommend use of <code>IsMatch</code> and <code>Count</code>, respectively.</p>
<p><img decoding="async" src="https://devblogs.microsoft.com/dotnet/wp-content/uploads/sites/10/2025/09/CA1874.png" alt="Analyzer and fixer for CA1874"></p>
<p><img decoding="async" src="https://devblogs.microsoft.com/dotnet/wp-content/uploads/sites/10/2025/09/CA1875.png" alt="Analyzer and fixer for CA1875"></p>
<pre><code>// dotnet run -c Release -f net10.0 --filter **

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Text.RegularExpressions;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private static readonly string s_input = new HttpClient().GetStringAsync(@"https://www.gutenberg.org/cache/epub/3200/pg3200.txt").Result;
    private static readonly Regex s_regex = new Regex(@"\b\w+\b", RegexOptions.NonBacktracking);

    [Benchmark(Baseline = true)]
    public int MatchesCount() =&gt; s_regex.Matches(s_input).Count;

    [Benchmark]
    public int Count() =&gt; s_regex.Count(s_input);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Mean</th>
<th>Ratio</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>MatchesCount</td>
<td>680.4 ms</td>
<td>1.00</td>
<td>665530176 B</td>
<td>1.00</td>
</tr>
<tr>
<td>Count</td>
<td>219.0 ms</td>
<td>0.32</td>
<td>–</td>
<td>0.00</td>
</tr>
</tbody>
</table>
<p><code>Regex</code> is one form of searching, but there are other primitives and helpers throughout .NET for various forms of searching, and they’ve seen meaningful improvements in .NET 10, as well.</p>
<h3>SearchValues</h3>
<p>When discussing performance improvements in .NET 8, I called out two changes that were my favorites. The first was dynamic PGO. The second was <a href="https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-8/#searchvalues"><code>SearchValues</code></a>.</p>
<p><code>SearchValues</code> provides a mechanism for precomputing optimal strategies for searching. .NET 8 introduced overloads of <code>SearchValues.Create</code> that produce <code>SearchValues&lt;byte&gt;</code> and <code>SearchValues&lt;char&gt;</code>, and corresponding overloads of <code>IndexOfAny</code> and friends that accept such instances. If there’s a set of values you’ll be searching for over and over and over, you can create one of these instances once, cache it, and then use it for all subsequent searches for those values, e.g.</p>
<pre><code>private static readonly SearchValues&lt;char&gt; s_validBase64Chars = SearchValues.Create("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/");

internal static bool IsValidBase64(ReadOnlySpan&lt;char&gt; input) =&gt;
    input.ContainsAnyExcept(s_validBase64Chars);</code></pre>
<p>There are a plethora of different implementations used by <code>SearchValues&lt;T&gt;</code> behind the scenes, each of which is selected and configured based on the <code>T</code> and the exact nature of the target values for which we’re searching. <a href="https://github.com/dotnet/runtime/pull/106900">dotnet/runtime#106900</a> adds another, which both helps to shave off several instructions in the core vectorized search loop, and helps to highlight just how nuanced these different algorithms can be. Previously, if four target <code>byte</code> values were provided, and they weren’t in a contiguous range, <code>SearchValues.Create</code> would choose an implementation that just uses four vectors, one per target byte, and does four comparisons (one against each target vector) for each input vector being tested. However, there’s already a specialization that’s used for more than five target bytes when all of the target bytes are ASCII. This PR allows that specialization to be used for both four or five targets when the lower nibble (the bottom four bits) of each of the targets is unique, and in doing so, it becomes several instructions cheaper: rather than doing four comparisons, it can do a single shuffle and equality check.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Buffers;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private static readonly byte[] s_haystack = new HttpClient().GetByteArrayAsync(@"https://www.gutenberg.org/cache/epub/3200/pg3200.txt").Result;
    private static readonly SearchValues&lt;byte&gt; s_needle = SearchValues.Create("\0\r&amp;&lt;"u8);

    [Benchmark]
    public int Count()
    {
        int count = 0;

        ReadOnlySpan&lt;byte&gt; haystack = s_haystack.AsSpan();
        int pos;
        while ((pos = haystack.IndexOfAny(s_needle)) &gt;= 0)
        {
            count++;
            haystack = haystack.Slice(pos + 1);
        }

        return count;
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Count</td>
<td>.NET 9.0</td>
<td>3.704 ms</td>
<td>1.00</td>
</tr>
<tr>
<td>Count</td>
<td>.NET 10.0</td>
<td>2.668 ms</td>
<td>0.72</td>
</tr>
</tbody>
</table>
<p><a href="https://github.com/dotnet/runtime/pull/107798">dotnet/runtime#107798</a> improves another such algorithm, when AVX512 is available. One of the fallback strategies used by <code>SearchValues.Create&lt;char&gt;</code> is a vectorized “probabilistic map”, basically a Bloom filter. It has a bitmap that stores a bit for each <code>byte</code> of the <code>char</code>; when testing to see whether the <code>char</code> is in the target set, it checks to see whether the bit for each of the <code>char</code>‘s <code>byte</code>s is set. If at least one isn’t set, the <code>char</code> definitely isn’t in the target set. If both are set, more validation will need to be done to determine the actual inclusion of that value in the set. This can make it very efficient to rule out large amounts of input that definitely are not in the set and then only spend more effort on input that might be. The implementation involves various shuffle, shift, and permute operations, and this change is able to use a better set of instructions that reduce the number needed.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Buffers;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private static readonly SearchValues&lt;char&gt; s_searchValues = SearchValues.Create("ßäöüÄÖÜ");
    private string _input = new string('\n', 10_000);

    [Benchmark]
    public int IndexOfAny() =&gt; _input.AsSpan().IndexOfAny(s_searchValues);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>IndexOfAny</td>
<td>.NET 9.0</td>
<td>437.7 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>IndexOfAny</td>
<td>.NET 10.0</td>
<td>404.7 ns</td>
<td>0.92</td>
</tr>
</tbody>
</table>
<p>While .NET 8 introduced support for <code>SearchValues&lt;byte&gt;</code> and <code>SearchValues&lt;char&gt;</code>, .NET 9 introduced support for <code>SearchValues&lt;string&gt;</code>. <code>SearchValues&lt;string&gt;</code> is used a bit differently from <code>SearchValues&lt;byte&gt;</code> and <code>SearchValues&lt;char&gt;</code>; whereas <code>SearchValues&lt;byte&gt;</code> is used to search for target <code>byte</code>s within a collection of <code>byte</code>s and <code>SearchValues&lt;char&gt;</code> is used to search for target <code>char</code>s within a collection of <code>char</code>s, <code>SearchValues&lt;string&gt;</code> is used to search for target <code>string</code>s within a single <code>string</code> (or span of <code>char</code>s). In other words, it’s a multi-substring search. Let’s say you have the regular expression <code>(?i)hello|world</code>; that is specifying that it should look for either “hello” or “world” in a case-insensitive manner; the <code>SearchValues</code> equivalent of that is <code>SearchValues.Create(["hello", "world"], StringComparison.OrdinalIgnoreCase)</code> (in fact, if you specify that pattern, the <code>Regex</code> compiler and source generator will use such a <code>SearchValues.Create</code> call under the covers in order to optimize the search).</p>
<p><code>SearchValues&lt;string&gt;</code> also gets better in .NET 10. A key algorithm used by <code>SearchValues&lt;string&gt;</code> whenever possible and relevant is called “Teddy,” and enables performing a vectorized search for multiple substrings. In its core processing loop, when using AVX512, there are two instructions, a <code>PermuteVar8x64x2</code> and an <code>AlignRight</code>; <a href="https://github.com/dotnet/runtime/pull/107819">dotnet/runtime#107819</a> recognizes that those can be replaced by a single <code>PermuteVar64x8x2</code>. Similarly, when on Arm64, <a href="https://github.com/dotnet/runtime/pull/118110">dotnet/runtime#118110</a> plays the instructions game and replaces a use of <code>ExtractNarrowingSaturateUpper</code> with the slightly cheaper <code>UnzipEven</code>.</p>
<p><code>SearchValues&lt;string&gt;</code> is also able to optimize searching for a single string, spending more time to come up with optimal search parameters than does a simpler <code>IndexOf(string, StringComparison)</code> call. Similar to the approach with the probabilistic maps employed earlier, the vectorized search can yield false positives that then need to be weeded out. In some cases by construction, however, we know that false positives aren’t possible; <a href="https://github.com/dotnet/runtime/pull/108368">dotnet/runtime#108368</a> extends an existing optimization that was case-sensitive only to also apply in some case-insensitive uses, such that we can avoid doing the extra validation step in more cases. For the candidate verification that remains, <a href="https://github.com/dotnet/runtime/pull/108365">dotnet/runtime#108365</a> also significantly reduces overhead in a variety of cases, including adding specialized handling for needles (the things being searched for) of up to 16 characters (previously it was only up to 8), and precomputing more information to make the verification faster.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Buffers;
using System.Text.RegularExpressions;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private static readonly string s_haystack = new HttpClient().GetStringAsync(@"https://www.gutenberg.org/cache/epub/3200/pg3200.txt").Result;

    private static readonly Regex s_the = new("the", RegexOptions.IgnoreCase | RegexOptions.Compiled);
    private static readonly Regex s_something = new("something", RegexOptions.IgnoreCase | RegexOptions.Compiled);

    [Benchmark]
    public int CountThe() =&gt; s_the.Count(s_haystack);

    [Benchmark]
    public int CountSomething() =&gt; s_something.Count(s_haystack);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>CountThe</td>
<td>.NET 9.0</td>
<td>9.881 ms</td>
<td>1.00</td>
</tr>
<tr>
<td>CountThe</td>
<td>.NET 10.0</td>
<td>7.799 ms</td>
<td>0.79</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>CountSomething</td>
<td>.NET 9.0</td>
<td>2.466 ms</td>
<td>1.00</td>
</tr>
<tr>
<td>CountSomething</td>
<td>.NET 10.0</td>
<td>2.027 ms</td>
<td>0.82</td>
</tr>
</tbody>
</table>
<p><a href="https://github.com/dotnet/runtime/pull/118108">dotnet/runtime#118108</a> also adds a “packed” variant of the single-string implementation, meaning it’s able to handle common cases like ASCII more efficiently by ignoring a character’s upper zero byte in order to fit twice as much into a vector.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Buffers;
using System.Text.RegularExpressions;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private static readonly string s_haystack = string.Concat(Enumerable.Repeat("Sherlock Holm_s", 8_000));
    private static readonly SearchValues&lt;string&gt; s_needles = SearchValues.Create(["Sherlock Holmes"], StringComparison.OrdinalIgnoreCase);

    [Benchmark] 
    public bool ContainsAny() =&gt; s_haystack.AsSpan().ContainsAny(s_needles);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>ContainsAny</td>
<td>.NET 9.0</td>
<td>58.41 us</td>
<td>1.00</td>
</tr>
<tr>
<td>ContainsAny</td>
<td>.NET 10.0</td>
<td>16.32 us</td>
<td>0.28</td>
</tr>
</tbody>
</table>
<h3>MemoryExtensions</h3>
<p>The searching improvements continue beyond <code>SearchValues</code>, of course. Prior to .NET 10, the <code>MemoryExtensions</code> class already had a wealth of support for searching and manipulating spans, with extension methods like <code>IndexOf</code>, <code>IndexOfAnyExceptInRange</code>, <code>ContainsAny</code>, <code>Count</code>, <code>Replace</code>, <code>SequenceCompare</code>, and more (the set was further extended as well by <a href="https://github.com/dotnet/runtime/pull/112951">dotnet/runtime#112951</a>, which added <code>CountAny</code> and <code>ReplaceAny</code>), but the vast majority of these were limited to work with <code>T</code> types constrained to be <code>IEquatable&lt;T&gt;</code>. And in practice, many of the types you want to search do in fact implement <code>IEquatable&lt;T&gt;</code>. However, you might be in a generic context with an unconstrained <code>T</code>, such that even if the <code>T</code> used to instatiate the generic type or method is equatable, it’s not evident in the type system and thus the <code>MemoryExtensions</code> method couldn’t be used. And of course there are scenarios where you want to be able to supply a different comparison routine. Both of these scenarios show up, for example, in the implementation of LINQ’s <code>Enumerable.Contains</code>; if the source <code>IEnumerable&lt;TSource&gt;</code> is actually something we could treat as a span, like <code>TSource[]</code> or <code>List&lt;TSource&gt;</code>, it’d be nice to be able to just delegate to the optimized <code>MemoryExtensions.Contains&lt;T&gt;</code>, but a) <code>Enumerable.Contains</code> doesn’t constrain its <code>TSource : IEquatable&lt;TSource&gt;</code>, and b) <code>Enumerable.Contains</code> accepts an optional comparer.</p>
<p>To address this, <a href="https://github.com/dotnet/runtime/pull/110197">dotnet/runtime#110197</a> adds ~30 new overloads to the <code>MemoryExtensions</code> class. These overloads all parallel existing methods, but remove the <code>IEquatable&lt;T&gt;</code> (or <code>IComparable&lt;T&gt;</code>) constraint on the generic method parameter and accept an optional <code>IEqualityComparer&lt;T&gt;?</code> (or <code>IComparer&lt;T&gt;</code>). When no comparer or a default comparer is supplied, they can fall back to using the same vectorized logic for relevant types, and otherwise can provide as optimal an implementation as they can muster, based on the nature of <code>T</code> and the supplied comparer.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private IEnumerable&lt;int&gt; _data = Enumerable.Range(0, 1_000_000).ToArray();

    [Benchmark]
    public bool Contains() =&gt; _data.Contains(int.MaxValue, EqualityComparer&lt;int&gt;.Default);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Contains</td>
<td>.NET 9.0</td>
<td>213.94 us</td>
<td>1.00</td>
</tr>
<tr>
<td>Contains</td>
<td>.NET 10.0</td>
<td>67.86 us</td>
<td>0.32</td>
</tr>
</tbody>
</table>
<p>(It’s also worth highlighting that with the “first-class” span support in C# 14, many of these extensions from <code>MemoryExtensions</code> now naturally show up directly on types like <code>string</code>.)</p>
<p>This kind of searching often shows up as part of other APIs. For example, encoding APIs often need to first find something to be encoded, and that searching can be accelerated by using one of these efficiently implemented search APIs. There are dozens and dozens of existing examples of that throughout the core libraries, many of the places using <code>SearchValues</code> or these various <code>MemoryExtensions</code> methods. <a href="https://github.com/dotnet/runtime/pull/110574">dotnet/runtime#110574</a> adds another, speeding up <code>string.Normalize</code>‘s argument validation. The current implementation walks character by character looking for the first surrogate. The new implementation gives that a jump start by using <code>IndexOfAnyInRange</code>.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private string _input = "This is a test. This is only a test. Nothing to see here. \u263A\uFE0F";

    [Benchmark]
    public string Normalize() =&gt; _input.Normalize();
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Normalize</td>
<td>.NET 9.0</td>
<td>104.93 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>Normalize</td>
<td>.NET 10.0</td>
<td>88.94 ns</td>
<td>0.85</td>
</tr>
</tbody>
</table>
<p><a href="https://github.com/dotnet/runtime/pull/110478">dotnet/runtime#110478</a> similarly updates <code>HttpUtility.UrlDecode</code> to use the vectorized <code>IndexOfAnyInRange</code>. It also avoids allocating the resulting <code>string</code> if nothing needs to be decoded.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Web;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    [Benchmark]
    public string UrlDecode() =&gt; HttpUtility.UrlDecode("aaaaabbbbb%e2%98%ba%ef%b8%8f");
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>UrlDecode</td>
<td>.NET 9.0</td>
<td>59.42 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>UrlDecode</td>
<td>.NET 10.0</td>
<td>54.26 ns</td>
<td>0.91</td>
</tr>
</tbody>
</table>
<p>Similarly, <a href="https://github.com/dotnet/runtime/pull/114494">dotnet/runtime#114494</a> employs <code>SearchValues</code> in <code>OptimizedInboxTextEncoder</code>, which is the core implementation that backs the various encoders like <code>JavaScriptEncoder</code> and <code>HtmlEncoder</code> in the <code>System.Text.Encodings.Web</code> library.</p>
<h2>JSON</h2>
<p>JSON is at the heart of many different domains, having become the lingua franca of data interchange on the web. With <code>System.Text.Json</code> as the recommended library for working with JSON in .NET, it is constantly evolving to meet additional performance requirements. .NET 10 sees it updated with both improvements to the performance of existing methods as well as new methods specifically geared towards helping with performance.</p>
<p>The <code>JsonSerializer</code> type is layered on top of the lower-level <code>Utf8JsonReader</code> and <code>Utf8JsonWriter</code> types. When serializing, <code>JsonSerializer</code> needs an instance of <code>Utf8JsonWriter</code>, which is a <code>class</code>, and any associated objects, such as an <code>IBufferWriter</code> instance. For any temporary buffers it requires, it’ll use rented buffers from <code>ArrayPool&lt;byte&gt;</code>, but for these helper objects, it maintains its own cache, to avoid needing to recreate them at very high frequencies. That cache was being used for all asynchronous streaming serialization operations, but as it turns out, it wasn’t being used for synchronous streaming serialization operations. <a href="https://github.com/dotnet/runtime/pull/112745">dotnet/runtime#112745</a> fixes that to make the use of the cache consistent, avoiding these intermediate allocations.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Text.Json;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private Data _data = new();
    private MemoryStream _stream = new();

    [Benchmark]
    public void Serialize()
    {
        _stream.Position = 0;
        JsonSerializer.Serialize(_stream, _data);
    }

    public class Data
    {
        public int Value1 { get; set; }
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Serialize</td>
<td>.NET 9.0</td>
<td>115.36 ns</td>
<td>1.00</td>
<td>176 B</td>
<td>1.00</td>
</tr>
<tr>
<td>Serialize</td>
<td>.NET 10.0</td>
<td>77.73 ns</td>
<td>0.67</td>
<td>–</td>
<td>0.00</td>
</tr>
</tbody>
</table>
<p>Earlier when discussing collections, it was noted that <code>OrderedDictionary&lt;TKey, TValue&gt;</code> now exposes overloads of methods like <code>TryAdd</code> that return the relevant item’s index, which then allows subsequent access to avoid the more costly key-based lookup. As it turns out, <code>JsonObject</code>‘s indexer needs to do that, first indexing into the dictionary by key, doing some checks, and then indexing again. It’s now been updated to use these new overloads. As those lookups typically dominate the cost of using the setter, this can upwards of double throughput of <code>JsonObject</code>‘s indexer:</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Text.Json.Nodes;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private JsonObject _obj = new();

    [Benchmark]
    public void Set() =&gt; _obj["key"] = "value";
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Set</td>
<td>.NET 9.0</td>
<td>40.56 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>Set</td>
<td>.NET 10.0</td>
<td>16.96 ns</td>
<td>0.42</td>
</tr>
</tbody>
</table>
<p>Most of the improvements in <code>System.Text.Json</code>, however, are actually via new APIs. This same “avoid a double lookup” issue shows up in other places, for example wanting to add a property to a <code>JsonObject</code> but only if it doesn’t yet exist. With <a href="https://github.com/dotnet/runtime/pull/111229">dotnet/runtime#111229</a> from <a href="https://github.com/Flu">@Flu</a>, that’s addressed with a new <code>TryAdd</code> method (as well as a <code>TryAdd</code> overload and an overload of the existing <code>TryGetPropertyValue</code> that, as with <code>OrderedDictionary&lt;&gt;</code>, returns the index of the property).</p>
<pre><code>// dotnet run -c Release -f net10.0 --filter "*"

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Text.Json.Nodes;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private JsonObject _obj = new();
    private JsonNode _value = JsonValue.Create("value");

    [Benchmark(Baseline = true)]
    public void NonOverwritingSet_Manual()
    {
        _obj.Remove("key");
        if (!_obj.ContainsKey("key"))
        {
            _obj.Add("key", _value);
        }
    }

    [Benchmark]
    public void NonOverwritingSet_TryAdd()
    {
        _obj.Remove("key");
        _obj.TryAdd("key", _value);
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>NonOverwritingSet_Manual</td>
<td>16.59 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>NonOverwritingSet_TryAdd</td>
<td>14.31 ns</td>
<td>0.86</td>
</tr>
</tbody>
</table>
<p><a href="https://github.com/dotnet/runtime/pull/109472">dotnet/runtime#109472</a> from <a href="https://github.com/karakasa">@karakasa</a> also imbues <code>JsonArray</code> with new <code>RemoveAll</code> and <code>RemoveRange</code> methods. In addition to the usability benefits these can provide, they have the same performance benefits they have on <code>List&lt;T&gt;</code> (which is not a coincidence, given that <code>JsonArray</code> is, as an implementation detail, a wrapper for a <code>List&lt;JsonNode?&gt;</code>). Removing “incorrectly” from a <code>List&lt;T&gt;</code> can end up being an <code>O(N^2)</code> endeavor, e.g. when I run this:</p>
<pre><code>// dotnet run -c Release -f net10.0

using System.Diagnostics;

for (int i = 100_000; i &lt; 700_000; i += 100_000)
{
    List&lt;int&gt; items = Enumerable.Range(0, i).ToList();

    Stopwatch sw = Stopwatch.StartNew();
    while (items.Count &gt; 0)
    {
        items.RemoveAt(0); // uh oh
    }
    Console.WriteLine($"{i} =&gt; {sw.Elapsed}");
}</code></pre>
<p>I get output like this:</p>
<pre><code>100000 =&gt; 00:00:00.2271798
200000 =&gt; 00:00:00.8328727
300000 =&gt; 00:00:01.9820088
400000 =&gt; 00:00:03.9242008
500000 =&gt; 00:00:06.9549009
600000 =&gt; 00:00:11.1104903</code></pre>
<p>Note how as the list length grows linearly, the elapsed time is growing non-linearly. That’s primarily because each <code>RemoveAt(0)</code> is requiring the entire remainder of the list to shift down, which is <code>O(N)</code> in the length of the list. That means we get <code>N + (N-1) + (N-2) + ... + 1</code> operations, which is <code>N(N+1)/2</code>, which is <code>O(N^2)</code>. Both <code>RemoveRange</code> and <code>RemoveAll</code> are able to avoid those costs by doing the shifting only once per element. Of course, even without such methods, I could have written my previous removal loop in a way that keeps it linear, namely by repeatedly removing the last element rather than the first (and, of course, if I <em>really</em> intended on removing everything, I could have just used <code>Clear</code>). Typical use, however, ends up removing a smattering of elements, and being able to just delegate and not worry about accidentally incurring a non-linear overhead is helpful.</p>
<pre><code>// dotnet run -c Release -f net10.0 --filter "*"

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Text.Json.Nodes;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private JsonArray _arr;

    [IterationSetup]
    public void Setup() =&gt;
        _arr = new JsonArray(Enumerable.Range(0, 100_000).Select(i =&gt; (JsonNode)i).ToArray());

    [Benchmark]
    public void Manual()
    {
        int i = 0;
        while (i &lt; _arr.Count)
        {
            if (_arr[i]!.GetValue&lt;int&gt;() % 2 == 0)
            {
                _arr.RemoveAt(i);
            }
            else
            {
                i++;
            }
        }
    }

    [Benchmark]
    public void RemoveAll() =&gt; _arr.RemoveAll(static n =&gt; n!.GetValue&lt;int&gt;() % 2 == 0);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Mean</th>
<th>Allocated</th>
</tr>
</thead>
<tbody>
<tr>
<td>Manual</td>
<td>355.230 ms</td>
<td>–</td>
</tr>
<tr>
<td>RemoveAll</td>
<td>2.022 ms</td>
<td>24 B</td>
</tr>
</tbody>
</table>
<p>(Note that while <code>RemoveAll</code> in this micro-benchmark is more than 150x faster, it does have that small allocation that the manual implementation doesn’t. That’s due to a closure in the implementation while delegating to <code>List&lt;T&gt;.RemoveAll</code>. This could be avoided in the future if necessary.)</p>
<p>Another frequently-requested new method is from <a href="https://github.com/dotnet/runtime/pull/116363">dotnet/runtime#116363</a>, which adds new <code>Parse</code> methods to <code>JsonElement</code>. If a developer wants a <code>JsonElement</code> and only needs it temporarily, the most efficient mechanism available today is still the right answer: <code>Parse</code> a <code>JsonDocument</code>, use its <code>RootElement</code>, and then <em>only</em> when done with the <code>JsonElement</code>, dispose of the <code>JsonDocument</code>, e.g.</p>
<pre><code>using (JsonDocument doc = JsonDocument.Parse(json))
{
    DoSomething(doc.RootElement);
}</code></pre>
<p>That, however, is really only viable when the <code>JsonElement</code> is used in a scoped manner. If a developer needs to hand out the <code>JsonElement</code>, they’re left with three options:</p>
<ol>
<li><code>Parse</code> into a <code>JsonDocument</code>, clone its <code>RootElement</code>, dispose of the <code>JsonDocument</code>, hand out the clone. While using <code>JsonDocument</code> is good for the temporary case, making a clone like this entails a fair bit of overhead:
<pre><code>JsonElement clone;
using (JsonDocument doc = JsonDocument.Parse(json))
{
    clone = doc.RootElement.Clone();
}
return clone;</code></pre>
</li>
<li><code>Parse</code> into a <code>JsonDocument</code> and just hand out its <code>RootElement</code>. Please <em>do not do this</em>! <code>JsonDocument.Parse</code> creates a <code>JsonDocument</code> that’s backed by an array from the <code>ArrayPool&lt;&gt;</code>. If you don’t <code>Dispose</code> of the <code>JsonDocument</code> in this case, an array will be rented and then never returned to the pool. That’s not the end of the world; if someone else requests an array from the pool and the pool doesn’t have one cached to give them, it’ll just manufacture one, so eventually the pool’s arrays will be replenished. But the arrays in the pool are generally “more valuable” than others, because they’ve generally been around longer, and are thus more likely to be in higher generations. By using an <code>ArrayPool</code> array rather than a new array for a shorter-lived <code>JsonDocument</code>, you’re more likely throwing away an array that’ll have net more impact on the overall system. The impact of that is not easily seen in a micro-benchmark.
<pre><code>return JsonDocument.Parse(json).RootElement; // please don't do this</code></pre>
</li>
<li>Use <code>JsonSerializer</code> to deserialize a <code>JsonElement</code>. This is a simple and reasonable one-liner, but it does invoke the <code>JsonSerializer</code> machinery, which brings in more overhead.
<pre><code>return JsonSerializer.Deserialize&lt;JsonElement&gt;(json);</code></pre>
</li>
</ol>
<p>Now in .NET 10, there’s a fourth option:</p>
<ul>
<li>Use <code>JsonElement.Parse</code>. This is the right answer. Use this instead of (1), (2), or (3).
<pre><code>//  dotnet run -c Release -f net10.0 --filter "*"

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Text.Json;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private const string JsonString = """{ "name": "John", "age": 30, "city": "New York" }""";

    [Benchmark]
    public JsonElement WithClone()
    {
        using JsonDocument d = JsonDocument.Parse(JsonString);
        return d.RootElement.Clone();
    }

    [Benchmark]
    public JsonElement WithoutClone() =&gt;
        JsonDocument.Parse(JsonString).RootElement; // please don't do this in production code

    [Benchmark]
    public JsonElement WithDeserialize() =&gt;
        JsonSerializer.Deserialize&lt;JsonElement&gt;(JsonString);

    [Benchmark]
    public JsonElement WithParse() =&gt;
        JsonElement.Parse(JsonString);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Mean</th>
<th>Allocated</th>
</tr>
</thead>
<tbody>
<tr>
<td>WithClone</td>
<td>303.7 ns</td>
<td>344 B</td>
</tr>
<tr>
<td>WithoutClone</td>
<td>249.6 ns</td>
<td>312 B</td>
</tr>
<tr>
<td>WithDeserialize</td>
<td>397.3 ns</td>
<td>272 B</td>
</tr>
<tr>
<td>WithParse</td>
<td>261.9 ns</td>
<td>272 B</td>
</tr>
</tbody>
</table>
</li>
</ul>
<p>With JSON being used as an encoding for many modern protocols, streaming large JSON payloads has become very common. And for most use cases, it’s already possible to stream JSON well with <code>System.Text.Json</code>. However, in previous releases there wasn’t been a good way to stream partial string properties; string properties had to have their values written in one operation. If you’ve got small strings, that’s fine. If you’ve got really, really large strings, and those strings are lazily-produced in chunks, however, you ideally want the ability to write those chunks of the property as you have them, rather than needing to buffer up the value in its entirety. <a href="https://github.com/dotnet/runtime/pull/101356">dotnet/runtime#101356</a> augmented <code>Utf8JsonWriter</code> with a <code>WriteStringValueSegment</code> method, which enables such partial writes. That addresses the majority case, however there’s a very common case where additional encoding of the value is desirable, and an API that automatically handles that encoding helps to be both efficient and easy. These modern protocols often transmit large blobs of binary data within the JSON payloads. Typically, these blobs end up being Base64 strings as properties on some JSON object. Today, outputting such blobs requires Base64-encoding the whole input and then writing the resulting <code>byte</code>s or <code>char</code>s in their entirety into the <code>Utf8JsonWriter</code>. To address that, <a href="https://github.com/dotnet/runtime/pull/111041">dotnet/runtime#111041</a> adds a <code>WriteBase64StringSegment</code> method to <code>Utf8JsonWriter</code>. For those sufficiently motivated to reduce memory overheads, and to enable the streaming of such payloads, <code>WriteBase64StringSegment</code> enables passing in a span of bytes, which the implementation will Base64-encode and write to the JSON property; it can be called multiple times with <code>isFinalSegment=false</code>, such that the writer will continue appending the resulting Base64 data to the property, until it’s called with a final segment that ends the property. (<code>Utf8JsonWriter</code> has long had a <code>WriteBase64String</code> method, this new <code>WriteBase64StringSegment</code> simply enables it to be written in pieces.) The primary benefit of such a method is reduced latency and working set, as the entirety of the data payload needn’t be buffered before being written out, but we can still come up with a throughput benchmark that shows benefits:</p>
<pre><code>//  dotnet run -c Release -f net10.0 --filter "*"

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Buffers;
using System.Text.Json;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private Utf8JsonWriter _writer = new(Stream.Null);
    private Stream _source = new MemoryStream(Enumerable.Range(0, 10_000_000).Select(i =&gt; (byte)i).ToArray());

    [Benchmark]
    public async Task Buffered()
    {
        _source.Position = 0;
        _writer.Reset();

        byte[] buffer = ArrayPool&lt;byte&gt;.Shared.Rent(0x1000);

        int totalBytes = 0;
        int read;
        while ((read = await _source.ReadAsync(buffer.AsMemory(totalBytes))) &gt; 0)
        {
            totalBytes += read;
            if (totalBytes == buffer.Length)
            {
                byte[] newBuffer = ArrayPool&lt;byte&gt;.Shared.Rent(buffer.Length * 2);
                Array.Copy(buffer, newBuffer, totalBytes);
                ArrayPool&lt;byte&gt;.Shared.Return(buffer);
                buffer = newBuffer;
            }
        }

        _writer.WriteStartObject();
        _writer.WriteBase64String("data", buffer.AsSpan(0, totalBytes));
        _writer.WriteEndObject();
        await _writer.FlushAsync();

        ArrayPool&lt;byte&gt;.Shared.Return(buffer);
    }

    [Benchmark]
    public async Task Streaming()
    {
        _source.Position = 0;
        _writer.Reset();

        byte[] buffer = ArrayPool&lt;byte&gt;.Shared.Rent(0x1000);

        _writer.WriteStartObject();
        _writer.WritePropertyName("data");
        int read;
        while ((read = await _source.ReadAsync(buffer)) &gt; 0)
        {
            _writer.WriteBase64StringSegment(buffer.AsSpan(0, read), isFinalSegment: false);
        }
        _writer.WriteBase64StringSegment(default, isFinalSegment: true);
        _writer.WriteEndObject();
        await _writer.FlushAsync();

        ArrayPool&lt;byte&gt;.Shared.Return(buffer);
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Mean</th>
</tr>
</thead>
<tbody>
<tr>
<td>Buffered</td>
<td>3.925 ms</td>
</tr>
<tr>
<td>Streaming</td>
<td>1.555 ms</td>
</tr>
</tbody>
</table>
<p>.NET 9 saw the introduction of the <code>JsonMarshal</code> class and the <code>GetRawUtf8Value</code> method, which provides raw access to the underlying bytes of property values fronted by a <code>JsonElement</code>. For situations where the name of the property is also needed, <a href="https://github.com/dotnet/runtime/pull/107784">dotnet/runtime#107784</a> from <a href="https://github.com/mwadams">@mwadams</a> provides a corresponding <code>JsonMarshal.GetRawUtf8PropertyName</code> method.</p>
<h2>Diagnostics</h2>
<p>Over the years, I’ve seen a fair number of codebases introduce a <code>struct</code>-based <code>ValueStopwatch</code>; I think there are even a few still floating around the <code>Microsoft.Extensions</code> libraries. The premise behind these is that <code>System.Diagnostics.Stopwatch</code> is a <code>class</code>, but it simply wraps a <code>long</code> (a timestamp), so rather than writing code like the following that allocates:</p>
<pre><code>Stopwatch sw = Stopwatch.StartNew();
... // something being measured
sw.Stop();
TimeSpan elapsed = sw.Elapsed;</code></pre>
<p>you could write:</p>
<pre><code>ValueStopwatch sw = ValueStopwatch.StartNew();
... // something being measured
sw.Stop();
TimeSpan elapsed = sw.Elapsed;</code></pre>
<p>and avoid the allocation. <code>Stopwatch</code> subsequently gained helpers that make such a <code>ValueStopwatch</code> less appealing, since as of .NET 7, I can write it instead like this:</p>
<pre><code>long start = Stopwatch.GetTimestamp();
... // something being measured
long end = Stopwatch.GetTimestamp();
TimeSpan elapsed = Stopwatch.GetElapsedTime(start, end);</code></pre>
<p>However, that’s not quite as natural as the original example, that just uses <code>Stopwatch</code>. Wouldn’t it be nice if you could write the original example and have it executed as if it were the latter? With all the investments in .NET 9 and .NET 10 around escape analysis and stack allocation, you now can. <a href="https://github.com/dotnet/runtime/pull/111834">dotnet/runtime#111834</a> streamlines the <code>Stopwatch</code> implementation so that <code>StartNew</code>, <code>Elapsed</code>, and <code>Stop</code> are fully inlineable. At that point, the JIT can see that the allocated <code>Stopwatch</code> instance never escapes the frame, and it can be stack allocated.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Diagnostics;
using System.Runtime.CompilerServices;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[DisassemblyDiagnoser]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    [Benchmark]
    public TimeSpan WithGetTimestamp()
    {
        long start = Stopwatch.GetTimestamp();
        Nop();
        long end = Stopwatch.GetTimestamp();

        return Stopwatch.GetElapsedTime(start, end);
    }

    [Benchmark]
    public TimeSpan WithStartNew()
    {
        Stopwatch sw = Stopwatch.StartNew();
        Nop();
        sw.Stop();

        return sw.Elapsed;
    }

    [MethodImpl(MethodImplOptions.NoInlining)]
    private static void Nop() { }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>Code Size</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>WithGetTimestamp</td>
<td>.NET 9.0</td>
<td>28.95 ns</td>
<td>1.00</td>
<td>148 B</td>
<td>–</td>
<td>NA</td>
</tr>
<tr>
<td>WithGetTimestamp</td>
<td>.NET 10.0</td>
<td>28.32 ns</td>
<td>0.98</td>
<td>130 B</td>
<td>–</td>
<td>NA</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>WithStartNew</td>
<td>.NET 9.0</td>
<td>38.62 ns</td>
<td>1.00</td>
<td>341 B</td>
<td>40 B</td>
<td>1.00</td>
</tr>
<tr>
<td>WithStartNew</td>
<td>.NET 10.0</td>
<td>28.21 ns</td>
<td>0.73</td>
<td>130 B</td>
<td>–</td>
<td>0.00</td>
</tr>
</tbody>
</table>
<p><a href="https://github.com/dotnet/runtime/pull/117031">dotnet/runtime#117031</a> is a nice improvement that helps reduce working set for anyone using an <code>EventSource</code> and that has events with really large IDs. For efficiency purposes, <code>EventSource</code> was using an array to map event ID to the data for that ID; lookup needs to be really fast, since the lookup is performed on every event write in order to look up the metadata for the event being written. In many <code>EventSource</code>s, the developer authors events with a small, contiguous range of IDs, and the array ends up being very dense. But if a developer authors any event with a really large ID (which we’ve seen happen in multiple real-world projects, due to splitting events into multiple partial class definitions shared between different projects and selecting IDs for each file unlikely to conflict with each other), an array is still created with a length to accomodate that large ID, which can result in a really big allocation that persists for the lifetime of the event source, and a lot of that allocation ends up just being wasted space. Thankfully, since <code>EventSource</code> was written years ago, the performance of <code>Dictionary&lt;TKey, TValue&gt;</code> has increased significantly, to the point where it’s able to efficiently handle the lookups without needing the event IDs to be dense. Note that there should really only ever be one instance of a given <code>EventSource</code>-derived type; the recommended pattern is to store one into a static readonly field and just use that one. So the overheads incurred as part of this are primarily about the impact that single large allocation has on working set for the duration of the process. To make it easier to demonstrate, though, I’m doing something you’d never, ever do, and creating a new instance per event. Don’t try this at home, or at least not in production.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Diagnostics;
using System.Diagnostics.Tracing;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private MyListener _listener = new();

    [Benchmark]
    public void Oops()
    {
        using OopsEventSource oops = new();
        oops.Oops();
    }

    [EventSource(Name = "MyTestEventSource")]
    public sealed class OopsEventSource : EventSource
    {
        [Event(12_345_678, Level = EventLevel.Error)]
        public void Oops() =&gt; WriteEvent(12_345_678);
    }

    private sealed class MyListener : EventListener
    {
        protected override void OnEventSourceCreated(EventSource eventSource) =&gt; 
            EnableEvents(eventSource, EventLevel.Error);
    }
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Oops</td>
<td>.NET 9.0</td>
<td>1,876.21 us</td>
<td>1.00</td>
<td>1157428.01 KB</td>
<td>1.000</td>
</tr>
<tr>
<td>Oops</td>
<td>.NET 10.0</td>
<td>22.06 us</td>
<td>0.01</td>
<td>19.21 KB</td>
<td>0.000</td>
</tr>
</tbody>
</table>
<p><a href="https://github.com/dotnet/runtime/pull/107333">dotnet/runtime#107333</a> from <a href="https://github.com/AlgorithmsAreCool">@AlgorithmsAreCool</a> reduces thread contention involved in starting and stopping an <code>Activity</code>. <code>ActivitySource</code> maintains a thread-safe list of listeners, which only changes on the rare occasion that a listener is registered or unregistered. Any time an <code>Activity</code> is created or destroyed (which can happen at very high frequency), each listener gets notified, which requires walking through the list of listeners. The previous code used a lock to protect that listeners list, and to avoid notifying the listener while holding the lock, the implementation would take the lock, determine the next listener, release the lock, notify the listener, and rinse and repeat until it had notified all listeners. This could result in significant contention, as multiple threads started and stopped <code>Activity</code>s. Now with this PR, the list switches to be an immutable array. Each time the list changes, a new array is created with the modified set of listeners. This makes the act of changing the listeners list much more expensive, but, as noted, that’s generally a rarity. And in exchange, notifying listeners becomes much cheaper.</p>
<p><a href="https://github.com/dotnet/runtime/pull/117334">dotnet/runtime#117334</a> from <a href="https://github.com/petrroll">@petrroll</a> avoids the overheads of callers needing to interact with null loggers by excluding them in <code>LoggerFactory.CreateLoggers</code>, while <a href="https://github.com/dotnet/runtime/pull/117342">dotnet/runtime#117342</a> seals the <code>NullLogger</code> type so type checks against <code>NullLogger</code> (e.g. <code>if (logger is NullLogger</code>) can be made more efficient by the JIT. And <a href="https://github.com/dotnet/roslyn-analyzers/pull/7290">dotnet/roslyn-analyzers#</a> from <a href="https://github.com/mpidash">@mpidash</a> will help developers to realize that their logging operations aren’t as cheap as they thought they might be. Consider this code:</p>
<pre><code>[LoggerMessage(Level = LogLevel.Information, Message = "This happened: {Value}")]
private static partial void Oops(ILogger logger, string value);

public static void UnexpectedlyExpensive()
{
    Oops(NullLogger.Instance, $"{Guid.NewGuid()} {DateTimeOffset.UtcNow}");
}</code></pre>
<p>It’s using the logger source generator, which will emit an implementation dedicated to this log method, including a log level check so that it doesn’t pay the bulk of the costs associated with logging unless the associated level is enabled:</p>
<pre><code>[global::System.CodeDom.Compiler.GeneratedCodeAttribute("Microsoft.Extensions.Logging.Generators", "6.0.5.2210")]
private static partial void Oops(global::Microsoft.Extensions.Logging.ILogger logger, global::System.String value)
{
    if (logger.IsEnabled(global::Microsoft.Extensions.Logging.LogLevel.Information))
    {
        __OopsCallback(logger, value, null);
    }
}</code></pre>
<p>Except, the call site is doing non-trivial work, creating a new <code>Guid</code>, fetching the current time, and allocating a string via string interpolation, even though it might be wasted work if <code>LogLevel.Information</code> isn’t available. This CA1873 analyzer flags that:
<img decoding="async" src="https://devblogs.microsoft.com/dotnet/wp-content/uploads/sites/10/2025/09/CA1873.png" alt="Analyzer for expensive logging sites"></p>
<h2>Cryptography</h2>
<p>A ton of effort went into cryptography in .NET 10, almost entirely focused on post‑quantum cryptography (PQC). PQC refers to a class of cryptographic algorithms designed to resist attacks from quantum computers, machines that could one day render classic cryptographic algorithms like Rivest–Shamir–Adleman (RSA) or Elliptic Curve Cryptography (ECC) insecure by efficiently solving problems such as integer factorization and discrete logarithms. With the looming threat of “harvest now, decrypt later” attacks (where a well-funded attacker idly captures encrypted internet traffic, expecting that they’ll be able to decrypt and read it later) and the multi-year process required to migrate critical infrastructure, the transition to quantum‑safe cryptographic standards has become an urgent priority. In this light, .NET 10 adds support for ML-DSA (a National Institute of Standards and Technology PQC digital signature algorithm), Composite ML-DSA (a draft Internet Engineering Task Force specification for creating signatures that combine ML-DSA with a classical crypto algorithm like RSA), SLH-DSA (another NIST PQC signature algorithm), and ML-KEM (a NIST PQC key encapsulation algorithm). This is an important step towards quantum-resistant security, enabling developers to begin experimenting with and planning for post-quantum identity and authenticity scenarios. While this PQC effort is not about performance, the design of them is very much focused on more modern sensibilities that have performance as a key motivator. While older types, like those that derive from <code>AsymmetricAlgorithm</code>, are design around arrays, with support for spans tacked on later, the new types are design with spans at the center, and with array-based APIs available only for convenience.</p>
<p>There are, however, some cryptography-related changes in .NET 10 that are focused squarely on performance. One is around improving OpenSSL “digest” performance. .NET’s cryptography stack is built on top of the underlying platform’s native cryptographic libraries; on Linux, that means using OpenSSL, making it a hot path for common operations like hashing, signing, and TLS. “Digest algorithms” are the family of cryptographic hash functions (for example, SHA‑256, SHA‑512, SHA‑3) that turn arbitrary input into fixed‑size fingerprints; they’re used all of the place, from verifying packages to TLS handshakes to content de-duplication. While .NET can use OpenSSL 1.x if that’s what’s offered by the OS, since .NET 6 it’s been focusing more and more on optimizing for and lighting-up with OpenSSL 3 (the previously-discussed PQC support requires OpenSSL 3.5 or later). With OpenSSL 1.x, OpenSSL exposed getter functions like <code>EVP_sha256()</code>, which were cheap functions that just returned a direct pointer to the <code>EVP_MD</code> for the relevant hash implementation. OpenSSL 3.x introduced a provider model, with a fetch function (<code>EVP_MD_fetch</code>) for retrieving the provider-backed implementation. To keep source compatibility, the 1.x-era getter functions were changed to return pointers to compatibility shims: when you pass one of these legacy <code>EVP_MD</code> pointers into operations like <code>EVP_DigestInit_ex</code>, OpenSSL performs an “implicit fetch” under the covers to resolve the actual implementation. That implicit fetch path adds extra work, on each use. Instead, OpenSSL recommends consumers do an explicit fetch and then cache the result for reuse. That’s what <a href="https://github.com/dotnet/runtime/pull/118613">dotnet/runtime#118613</a> does. The result is leaner and faster cryptographic hash operations on OpenSSL‑based platforms.</p>
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Security.Cryptography;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private byte[] _src = new byte[1024];
    private byte[] _dst = new byte[SHA256.HashSizeInBytes];

    [GlobalSetup]
    public void Setup() =&gt; new Random(42).NextBytes(_src);

    [Benchmark]
    public void Hash() =&gt; SHA256.HashData(_src, _dst);
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Hash</td>
<td>.NET 9.0</td>
<td>1,206.8 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>Hash</td>
<td>.NET 10.0</td>
<td>960.6 ns</td>
<td>0.80</td>
</tr>
</tbody>
</table>
<p>A few other performance niceties have also found their way in.</p>
<ul>
<li><strong><code>AsnWriter.Encode</code></strong>. <a href="https://github.com/dotnet/runtime/pull/106728">dotnet/runtime#106728</a> and <a href="https://github.com/dotnet/runtime/pull/112638">dotnet/runtime#112638</a> add and then use throughout the crypto stack a callback-based mechanism to <code>AsnWriter</code> that enables encoding without forced allocation for the temporary encoded state.</li>
<li><strong><code>SafeHandle</code> singleton</strong>. <a href="https://github.com/dotnet/runtime/pull/109391">dotnet/runtime#109391</a> employs a singleton <code>SafeHandle</code> in more places in <code>X509Certificate</code> to avoid temporary handle allocation.</li>
<li><strong>Span-based <code>ProtectedData</code></strong>. <a href="https://github.com/dotnet/runtime/pull/109529">dotnet/runtime#109529</a> from <a href="https://github.com/ChadNedzlek">@ChadNedzlek</a> adds <code>Span&lt;byte&gt;</code>-based overloads to the <code>ProtectedData</code> class that enable protecting data without requiring the source or destinations to be in allocated arrays.</li>
<li><strong><code>PemEncoding</code> UTF-8</strong>. <a href="https://github.com/dotnet/runtime/pull/109438">dotnet/runtime#109438</a> adds UTF-8 support to <code>PemEncoding</code>. <code>PemEncoding</code>, a utility class for parsing and formatting PEM (Privacy-Enhanced Mail)-encoded data such as that used in certificates and keys, previously worked only with <code>char</code>s. As was then done in <a href="https://github.com/dotnet/runtime/pull/109564">dotnet/runtime#109564</a>, this change makes it possible to parse UTF8 data directly without first needing to transcode to UTF16.</li>
<li><strong><code>FindByThumbprint</code></strong>. <a href="https://github.com/dotnet/runtime/pull/109130">dotnet/runtime#109130</a> adds an <code>X509Certification2Collection.FindByThumbprint</code> method. The implementation uses a stack-based buffer for the thumbprint value for each candidate certificate, eliminating the arrays that would otherwise be created in a naive manual implementation. <a href="https://github.com/dotnet/runtime/pull/113606">dotnet/runtime#113606</a> then utilized this in <code>SslStream</code>.</li>
<li><strong><code>SetKey</code></strong> <a href="https://github.com/dotnet/runtime/pull/113146">dotnet/runtime#113146</a> adds a span-based <code>SymmetricAlgorithm.SetKey</code> method which can then be used to avoid creating unnecessary arrays.</li>
</ul>
<h2>Peanut Butter</h2>
<p>As in every .NET release, there are a large number of PRs that help with performance in some fashion. The more of these that are addressed, the more the overall overhead for applications and services is lowered. Here are a smattering from this release:</p>
<ul>
<li><strong>GC</strong>. DATAS (Dynamic Adaptation To Application Sizes) was introduced in .NET 8 and enabled by default in .NET 9. Now in .NET 10, <a href="https://github.com/dotnet/runtime/pull/105545">dotnet/runtime#105545</a> tuned DATAS to improve its overall behavior, cutting unnecessary work, smoothing out pauses (especially under high allocation rates), correcting fragmentation accounting that could cause extra short collections (gen1), and other such tweaks. The net result is fewer unnecessary collections, steadier throughput, and more predictable latency for allocation-heavy workloads. <a href="https://github.com/dotnet/runtime/pull/118762">dotnet/runtime#118762</a> also adds several knobs for configuring how DATAS behaves, and in particular settings to fine-tune how Gen0 grows.</li>
<li><strong>GCHandle</strong>. The GC supports various types of “handles” that allow for explicit management of resources in relation to GC operation. For example, you can create a “pinning handle,” which ensures that the GC will not move the object in question. Historically, these handles were surfaced to developers via the <code>GCHandle</code> type, but it has a variety of issues, including that it’s really easy to misuse due to lack of strong typing. To help address that, <a href="https://github.com/dotnet/runtime/pull/111307">dotnet/runtime#111307</a> introduces a few new strongly-typed flavors of handles, with <code>GCHandle&lt;T&gt;</code>, <code>PinnedGCHandle&lt;T&gt;</code>, and <code>WeakGCHandle&lt;T&gt;</code>. These should not only address some of the usability issues, they’re also able to shave off a bit of the overheads incurred by the old design.
<pre><code>// dotnet run -c Release -f net10.0 --filter "*"

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;
using System.Runtime.InteropServices;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private byte[] _array = new byte[16];

    [Benchmark(Baseline = true)]
    public void Old() =&gt; GCHandle.Alloc(_array, GCHandleType.Pinned).Free();

    [Benchmark]
    public void New() =&gt; new PinnedGCHandle&lt;byte[]&gt;(_array).Dispose();
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Old</td>
<td>27.80 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>New</td>
<td>22.73 ns</td>
<td>0.82</td>
</tr>
</tbody>
</table>
</li>
<li><strong>Mono interpreter</strong>. The mono interpreter gained optimized support for several opcodes, including switches (<a href="https://github.com/dotnet/runtime/pull/107423">dotnet/runtime#107423</a>), new arrays (<a href="https://github.com/dotnet/runtime/pull/107430">dotnet/runtime#107430</a>), and memory barriers (<a href="https://github.com/dotnet/runtime/pull/107325">dotnet/runtime#107325</a>). But arguably more impactful was a series of more than a dozen PRs that enabled the interpreter to vectorize more operations with WebAssembly (Wasm). This included contributions like <a href="https://github.com/dotnet/runtime/pull/114669">dotnet/runtime#114669</a>, which enabled vectorization of shift operations, and <a href="https://github.com/dotnet/runtime/pull/113743">dotnet/runtime#113743</a>, which enabled vectorization of a plethora of operations like <code>Abs</code>, <code>Divide</code>, and <code>Truncate</code>. Other PRs used the Wasm-specific intrinsic APIs in more places, in order to accelerate on Wasm routines that were already accelerated on other architectures using architecture-specific intrinsics, e.g. <a href="https://github.com/dotnet/runtime/pull/115062">dotnet/runtime#115062</a> used <code>PackedSimd</code> in the workhorse methods behind the hex conversion routines on <code>Convert</code>, like <code>Convert.FromBase64String</code>.</li>
<li><strong>FCALLs</strong>. There are many places in the lower-layers of <code>System.Private.CoreLib</code> where managed code needs to call into native code in the runtime. There are two primary ways this transition from managed to native has happened, historically. One method is through what’s called a “QCALL”, essentially just a DllImport (P/Invoke) into native functions exposed by the runtime. The other, which historically was the dominant mechansim, is an “FCALL,” which is a more complex and specialized pathway that allows direct access to managed objects from native code. FCALLs were once the standard, but over time, more of them were converted to QCALLs. This shift improves reliability (since FCALLs are notoriously tricky to implement correctly) and can also boost performance, as FCALLs require helper method frames, which QCALLs can often avoid. A ton of PRs in .NET 10 went into removing FCALLs, like <a href="https://github.com/dotnet/runtime/pull/107218">dotnet/runtime#107218</a> for helper method frames in <code>Exception</code>, <code>GC</code>, and <code>Thread</code>, <a href="https://github.com/dotnet/runtime/pull/106497">dotnet/runtime#106497</a> for helper method frames in <code>object</code>, <a href="https://github.com/dotnet/runtime/pull/107152">dotnet/runtime#107152</a> for those used in connecting to profilers, <a href="https://github.com/dotnet/runtime/pull/108415">dotnet/runtime#108415</a> and <a href="https://github.com/dotnet/runtime/pull/108535">dotnet/runtime#108535</a> for ones in reflection, and over a dozen others. In the end, all FCALLS that touched managed memory or threw exceptions were removed.</li>
<li><strong>Converting hex.</strong> Recent .NET releases added methods to <code>Convert</code> like <code>FromHexString</code> and <code>TryToHexStringLower</code>, but such methods all used UTF16. <a href="https://github.com/dotnet/runtime/pull/117965">dotnet/runtime#117965</a> adds overloads of these that work with UTF8 bytes.</li>
<li><strong>Formatting.</strong> String interpolation is backed by “interpolated string handlers.” When you interpolate with a string target type, by default you get the <code>DefaultInterpolatedStringHandler</code> that comes from <code>System.Runtime.CompilerServices</code>. That implementation is able to use stack-allocated memory and the <code>ArrayPool&lt;&gt;</code> for reduced allocation overheads as it’s buffering up text formatted to it. While very advanced, other code, including other interpolated string handlers, can use <code>DefaultInterpolatedStringHandler</code> as an implementation detail. However, when doing so, such code only could get access to the final output as a <code>string</code>; the underlying buffer wasn’t exposed. <a href="https://github.com/dotnet/runtime/pull/112171">dotnet/runtime#112171</a> adds a <code>Text</code> property to <code>DefaultInterpolatedStringHandler</code> for code that wants access to the already formatted text in a <code>ReadOnlySpan&lt;char&gt;</code>.</li>
<li><strong>Enumeration-related allocations.</strong> <a href="https://github.com/dotnet/runtime/pull/118288">dotnet/runtime#118288</a> removes a handful of allocations related to enumeration, for example removing a <code>string.Split</code> call in <code>EnumConverter</code> and replacing it with a <code>MemoryExtensions.Split</code> call that doesn’t need to allocate either the <code>string[]</code> or the individual <code>string</code> instances.</li>
<li><strong>NRBF decoding.</strong> <a href="https://github.com/dotnet/runtime/pull/107797">dotnet/runtime#107797</a> from <a href="https://github.com/teo-tsirpanis">@teo-tsirpanis</a> removes an array allocation used in a <code>decimal</code> constructor call, replacing it instead with a collection expression targeting a span, which will result in the state being stack allocated.</li>
<li><strong>TypeConverter allocations.</strong> <a href="https://github.com/dotnet/runtime/pull/111349">dotnet/runtime#111349</a> from <a href="https://github.com/AlexRadch">@AlexRadch</a> reduces some parsing overheads in the <code>TypeConverter</code>s for <code>Size</code>, <code>SizeF</code>, <code>Point</code>, and <code>Rectangle</code> by using more modern APIs and constructs, such as the span-based <code>Split</code> method and string interpolation.</li>
<li><strong>Generic math conversions.</strong> Most of the <code>TryConvertXx</code> methods using the various primitive’s implementations of the generic math interfaces are marked as <code>MethodImplOptions.AggressiveInlining</code>, to help the JIT realize they should always be inlined, but a few stragglers were left out. <a href="https://github.com/dotnet/runtime/pull/112061">dotnet/runtime#112061</a> from <a href="https://github.com/hez2010">@hez2010</a> fixes that.</li>
<li><strong>ThrowIfNull.</strong> C# 14 now supports the ability to write extension static methods. This is a huge boon for libraries that need to support downlevel targeting, as it means static methods can be polyfilled just as instance methods can be. There are many libraries in .NET that build not only for the latest runtimes but also for .NET Standard 2.0 and .NET Framework, and those libraries have been unable to use helper static methods like <code>ArgumentNullException.ThrowIfNull</code>, which can help to streamline call sites and make methods more inlineable (in addition, of course, to tidying up the code). Now that the dotnet/runtime repo builds with a C# 14 compiler, <a href="https://github.com/dotnet/runtime/pull/114644">dotnet/runtime#114644</a> replaced ~2500 call sites in such libraries with use of a <code>ThrowIfNull</code> polyfill.</li>
<li><strong>FileProvider Change Tokens</strong>. <a href="https://github.com/dotnet/runtime/pull/116175">dotnet/runtime#116175</a> reduces allocation in <code>PollingWildCardChangeToken</code> by using allocation-free mechanisms for computing hashes, while <a href="https://github.com/dotnet/runtime/pull/115684">dotnet/runtime#115684</a> from <a href="https://github.com/rameel">@rameel</a> reduces allocation in <code>CompositeFileProvider</code> by avoiding taking up space for nop <code>NullChangeToken</code>s.</li>
<li><strong>String interpolation.</strong> <a href="https://github.com/dotnet/runtime/pull/114497">dotnet/runtime#114497</a> removes a variety of null checks when dealing with nullable inputs, shaving off some overheads of the interpolation operation.
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    private string _value = " ";

    [Benchmark]
    public string Interpolate() =&gt; $"{_value} {_value} {_value} {_value}";
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Interpolate</td>
<td>.NET 9.0</td>
<td>34.21 ns</td>
<td>1.00</td>
</tr>
<tr>
<td>Interpolate</td>
<td>.NET 10.0</td>
<td>29.47 ns</td>
<td>0.86</td>
</tr>
</tbody>
</table>
</li>
<li><strong><code>AssemblyQualifiedName</code></strong>. <code>Type.AssemblyQualifiedName</code> previously recomputed the result on every access. As of <a href="https://github.com/dotnet/runtime/issues/118389">dotnet/runtime#118389</a>, it’s now cached.
<pre><code>// dotnet run -c Release -f net9.0 --filter "*" --runtimes net9.0 net10.0

using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

BenchmarkSwitcher.FromAssembly(typeof(Tests).Assembly).Run(args);

[MemoryDiagnoser(displayGenColumns: false)]
[HideColumns("Job", "Error", "StdDev", "Median", "RatioSD")]
public partial class Tests
{
    [Benchmark]
    public string AQN() =&gt; typeof(Dictionary&lt;int, string&gt;).AssemblyQualifiedName!;
}</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Runtime</th>
<th>Mean</th>
<th>Ratio</th>
<th>Allocated</th>
<th>Alloc Ratio</th>
</tr>
</thead>
<tbody>
<tr>
<td>AQN</td>
<td>.NET 9.0</td>
<td>132.345 ns</td>
<td>1.007</td>
<td>712 B</td>
<td>1.00</td>
</tr>
<tr>
<td>AQN</td>
<td>.NET 10.0</td>
<td>1.218 ns</td>
<td>0.009</td>
<td>–</td>
<td>0.00</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h2>What’s Next?</h2>
<p>Whew! After all of that, I hope you’re as excited as I am about .NET 10, and more generally, about the future of .NET.</p>
<p>As you’ve seen in this tour (and in those for previous releases), the story of .NET performance is one of relentless iteration, systemic thinking, and the compounding effect of many targeted improvements. While I’ve highlighted micro-benchmarks to show specific gains, the real story isn’t about these benchmarks… it’s about making real-world applications more responsive, more scalable, more sustainable, more economical, and ultimately, more enjoyable to build and use. Whether you’re shipping high-throughput services, interactive desktop apps, or resource-constrained mobile experiences, .NET 10 offers tangible performance benefits to you and your users.</p>
<p>The best way to appreciate these improvements is to try <a href="https://dotnet.microsoft.com/download/dotnet/10.0">.NET 10 RC1</a> yourself. Download it, run your workloads, measure the impact, and share your experiences. See awesome gains? Find a regression that needs fixing? Spot an opportunity for further improvement? Shout it out, open an issue, even send a PR. Every bit of feedback helps make .NET better, and we look forward to continuing to build with you.</p>
<p>Happy coding!</p>
        </div><!-- .entry-content -->

        <!-- AI Disclaimer -->
            </article>
    
</div><div><!-- Author section -->
            <h2>Author</h2>
            <div><div><p><img src="https://devblogs.microsoft.com/dotnet/wp-content/uploads/sites/10/2022/03/stoub_square-96x96.jpg" alt="Stephen Toub - MSFT"></p><div><p>Partner Software Engineer</p></div></div><p>Stephen Toub is a developer on the .NET team at Microsoft.</p></div>        </div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Guy running a Google rival from his laundry room (215 pts)]]></title>
            <link>https://www.fastcompany.com/91396271/searcha-page-seekninja-diy-search-engines</link>
            <guid>45197187</guid>
            <pubDate>Wed, 10 Sep 2025 13:17:25 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.fastcompany.com/91396271/searcha-page-seekninja-diy-search-engines">https://www.fastcompany.com/91396271/searcha-page-seekninja-diy-search-engines</a>, See on <a href="https://news.ycombinator.com/item?id=45197187">Hacker News</a></p>
Couldn't get https://www.fastcompany.com/91396271/searcha-page-seekninja-diy-search-engines: Error: Request failed with status code 403]]></description>
        </item>
        <item>
            <title><![CDATA[Tarsnap is cozy (101 pts)]]></title>
            <link>https://til.andrew-quinn.me/posts/tarsnap-is-cozy/</link>
            <guid>45196568</guid>
            <pubDate>Wed, 10 Sep 2025 12:17:45 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://til.andrew-quinn.me/posts/tarsnap-is-cozy/">https://til.andrew-quinn.me/posts/tarsnap-is-cozy/</a>, See on <a href="https://news.ycombinator.com/item?id=45196568">Hacker News</a></p>
<div id="readability-page-1" class="page"><div><p>I have been aware of
<a href="https://www.tarsnap.com/">tarsnap</a>
for a long time, but only recently did I actually
<a href="https://andrew-quinn.me/digital-resiliency-2025/#backing-up-the-crown-jewels-with-tarsnap-mac-linux">get around to using it</a>
for anything, as a result of my big
<a href="https://andrew-quinn.me/digital-resiliency-2025/">personal digital resiliency audit for 2025</a>.
For those of you not in the know, tarsnap is
“online backups for the truly paranoid”, and
<code>tarsnap</code> the command-line program is the client-side
tool you invoke to actually zip up and push your
archives into the vault. Its creator,
<a href="https://www.daemonology.net/">Dr. Colin Percival</a>,
is a really smart and interesting dude for a whole
bunch of reasons. I’m led to believe the whole
business is basically a two-man show between him and
his brother these days.</p><p>Tarsnap feels… <em>cozy</em> to use.
I know that’s a weird word to pick for something
most people use to back up, like, extreme
cryptocurrency wallet codes and the like, but
every single thing about it just feels well-considered
from both a Unix sysadmin’s usability standpoint
and from a general product standpoint. The client
side CLI tool is based off of how <code>tar</code> itself works.
The prepaid model means that at any point I can
effectively guarantee anonymity by just shredding
up my keyfiles and letting the $15.123412341234123412
or what have you I still have remaining in the account
quietly run out, at which point the digital noise that
corresponds to whatever I have in there will be
unceremoniously deleted. These two things mean I feel
extremely safe just sticking the whole thing into a
one-liner hourly cronjob if need be and let it rip.</p><p>People have often complained they don’t have a good
sense for the pricing, so I
<a href="https://hiandrewquinn.github.io/tarsnap-calculator/">hacked together a little Tarsnap cost estimator here</a>.
If you use it solely to back up the
few megabytes of
“crown jewels” data we all have lying around,
don’t be surprised if the calculator tells you
your initial $5 or such will last for over
1,000 years. About the only thing I could think
I might want more from a service like this is
the opportunity to use a hardware key instead of
a keyfile - I’m sure Colin has thought about this
possibility himself and has good reasons for or
against implementing it, however.</p><p>Hats off to you, Dr. Percival. This truly is a
dream product.</p></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Kerberoasting (147 pts)]]></title>
            <link>https://blog.cryptographyengineering.com/2025/09/10/kerberoasting/</link>
            <guid>45196437</guid>
            <pubDate>Wed, 10 Sep 2025 12:01:30 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://blog.cryptographyengineering.com/2025/09/10/kerberoasting/">https://blog.cryptographyengineering.com/2025/09/10/kerberoasting/</a>, See on <a href="https://news.ycombinator.com/item?id=45196437">Hacker News</a></p>
<div id="readability-page-1" class="page"><article id="post-8655">
	
	<div>
		
<p>I learn about cryptographic vulnerabilities all the time, and they generally fill me with some combination of jealousy (“oh, why didn’t I think of that”) or else they impress me with the brilliance of their inventors. But there’s also another class of vulnerabilities: these are the ones <em>that can’t possibly exist</em> in important production software, because <em>there’s no way anyone could still do that in 2025.</em></p>



<p>Today I want to talk about one of those ridiculous ones, something Microsoft calls “low tech, high-impact”. This vulnerability isn’t particularly new; in fact the worst part about it is that it’s <em><a href="https://www.redsiege.com/wp-content/uploads/2020/08/Kerberoastv4.pdf">had a name</a></em> for over a decade, and it’s existed for longer than that. I’ll bet most Windows people already know this stuff, but I only happened to learn about it today, after seeing a <a href="https://www.wyden.senate.gov/imo/media/doc/wyden_letter_to_ftc_on_microsoft_kerberoasting_ransomwarepdf.pdf" target="_blank" rel="noreferrer noopener">letter from Senator Wyden to Microsoft</a>, describing how this vulnerability was used in the May 2024 <a href="https://www.hipaajournal.com/ascension-cyberattack-2024/">ransomware attack on the Ascension Health hospital system</a>.</p>



<p>The vulnerability is called <a href="https://www.irongeek.com/i.php?page=videos%2Fderbycon4%2Ft120-attacking-microsoft-kerberos-kicking-the-guard-dog-of-hades-tim-medin">Kerberoasting</a>, and TL;DR it relies on the fact that Microsoft’s Active Directory is <em>very, very old</em>. And also: RC4. If you don’t already know where I’m going with this, please read on.</p>



<p><strong>A couple of updates: </strong><em>The <a href="https://news.ycombinator.com/item?id=45196437">folks on HN</a> pointed out that I was using some incorrect terms in here (sorry!) and added some good notes, so I’m updating below.</em></p>



<h3>What’s Kerberos, and what’s Active Directory?</h3>



<p>Microsoft’s Active Directory (AD) is a many-tentacled octopus that controls access to almost every network that runs Windows machines. The system uses centralized authentication servers to determine who gets access to which network resources. If an employee’s computer needs to access some network Service (a file server, say), an Active Directory server authenticates the user and helps them get securely connected to the Service.</p>



<p>This means that AD is also the main barrier ensuring that attackers can’t extend their reach deeper into a corporate network. If an attacker somehow gets a toehold inside an enterprise (for example, because <a href="https://www.audacy.com/wwjnewsradio/news/local/worker-who-clicked-bogus-link-led-to-ascension-cyber-attack">an employee clicks on a malicious Bing link</a>), they should <span>absolutely not</span> be able to move laterally and take over critical network services. That’s because any such access would require the employee’s machine to have access to specialized accounts (called “Service accounts”) with privileges to fully control those machines. A well-managed network obviously won’t allow this. This means that AD is the “guardian” that stands between most companies and total disaster.</p>



<p>Unfortunately, Active Directory is a monster dragged from the depths of time. It uses the Kerberos protocol, which was first introduced in early 1989. <a href="https://en.wikipedia.org/wiki/Fall_of_the_Berlin_Wall">A lot of things have happened since 1989!</a> In fairness to Microsoft, Active Directory itself didn’t actually debut until about 1999; but (in less fairness), large portions of its legacy cryptography from that time period appear to still be supported in AD. This is very bad, because the cryptography is exceptionally terrible. </p>



<p>Let me get specific.</p>



<p>When you want to obtain access to some network resource (a “Service” in AD parlance), you first contact an AD server (called a KDC) to obtain a “<a href="https://learn.microsoft.com/en-us/windows-server/security/kerberos/kerberos-authentication-overview">ticket</a>” that you can send to the Service to authenticate. This ticket is encrypted using a long-term Service “password” established at the KDC and the Service itself, and it’s handed to the user making the call.</p>



<p>Now, ideally, this Service password is not really a password at all: it’s actually a randomly-generated cryptographic key. Microsoft even has systems in place to generate and rotate these keys regularly. This means the encrypted ticket will be completely inscrutable to the user who receives it, even if they’re malicious. But occasionally network administrators will make mistakes, and one (apparently) somewhat common mistake is to set up a Service that’s connected to an ordinary <em>user</em> account, complete with a human-generated password.</p>



<p>Since human passwords probably <em>are not</em> cryptographically strong, the tickets encrypted using them are extremely vulnerable to cracking. This is very bad, since any random user — including our hypothetical laptop malware hacker —&nbsp;can now obtain a copy of such a ticket, and attempt to crack the Service’s password offline by trying many candidate passwords using a <a href="https://en.wikipedia.org/wiki/Dictionary_attack">dictionary attack</a>. The result of this is that the user learns an account password <em>that lets them completely control that essential Service. </em>And the result of that (with a few extra steps) is often ransomware.</p>



<p>Isn’t that cute?</p>



<h3>That doesn’t actually seem very cute?</h3>



<p>Of course, it’s not. It’s actually a terrible design that should have been done away with decades ago. We should not build systems where any random attacker who compromises a single employee laptop can ask for a message encrypted under a critical password! This basically invites offline cracking attacks, which do not need even to be executed on the compromised laptop — they can be exported out of the network to another location and performed using GPUs and other hardware.</p>



<p>There are a few things that can stop this attack in practice. As we noted above, if the account has a long enough (random!) password, then cracking it should be virtually impossible. Microsoft could prevent users from configuring services with weak human-generated passwords, but apparently they don’t — at least because this is something that’s happened many times (including at Ascension Health.) </p>



<p>So let’s say you did not use a strong cryptographic key as your Service’s password. Where are you?</p>



<p>Your best hope in this case is that the encrypted tickets are <em>extremely challenging</em> for an attacker to crack. That’s because at this point, the only thing preventing the attacker from accessing your Service is computing power. But — and this is a very weak “but” — computing power can still be a deterrent! In the “standard” authentication mode, tickets are encrypted with AES, using a key derived using 4,096 iterations of <a href="https://en.wikipedia.org/wiki/PBKDF2">PBKDF2 hashing</a>, based on the Service password and a per-account salt (<strong>Update</strong>: which is not truly random salt, it’s a combination of domain and principal name.) The salt means an attacker cannot easily pre-compute a dictionary of hashed passwords, and while the <a href="https://en.wikipedia.org/wiki/PBKDF2">PBKDF2</a> (plus AES) isn’t an <em>amazing</em> defense, it puts some limits on the number of password guesses that can be attempted in a given unit of time.</p>



<p><a href="https://gist.github.com/Chick3nman/09bac0775e6393468c2925c1e1363d5c">This page</a> by <a href="https://gist.github.com/Chick3nman">Chick3nman</a> gives some excellent password cracking statistics computed using an <a href="https://www.nvidia.com/en-us/geforce/graphics-cards/50-series/rtx-5090/">RTX 5090</a>. It implies that a hacker can try 6.8 million candidate passwords every second, using AES-128 and PBKDF2.</p>



<h3>So that’s not great. But also not terrible, right?</h3>



<p>This isn’t the end of the story. <em>In fact it’s self-evident</em> that this is not the end of the story, because Active Directory was invented in 1999, which means at some point <em>we’ll have to deal with RC4.</em></p>



<p>Here’s the thing. Anytime you see cryptography born in the 1990s and yet using AES, you cannot be dealing with the original. What you’re looking at is the modernized, “upgraded” version of the original. The original probably used an abacus and witchcraft, or (failing that) at least some combination of unsalted hash functions and <a href="https://blog.cryptographyengineering.com/2011/12/15/whats-deal-with-rc4/">RC4</a>. And here’s the worst part: it turns out that in Active Directory, when a user does not configure a Service account to use a more recent mode, then Kerberos will indeed fall back to RC4, combined with unsalted NT hashes (basically, one iteration of <a href="https://en.wikipedia.org/wiki/MD4">MD4</a>.)</p>



<p>The main implication of using RC4 (and NT hashing) is that tickets encrypted this way become hilariously, absurdly fast to crack. According to our friend <a href="https://gist.github.com/Chick3nman/09bac0775e6393468c2925c1e1363d5c">Chick3nman</a>, the same RTX 5090 can attempt 4.18 <span><em>billion</em></span> (with a “b”) password guesses every second. That’s roughly 1000x faster than the AES variant.</p>



<p>As an aside, the NT hashes are not salted, which means they’re vulnerable to pre-computation attacks that involve <a href="http://project-rainbowcrack.com/table.htm">rainbow tables</a>. I had been meaning to write about rainbow tables recently on this blog, but had convinced myself that they mostly don’t matter, given that these ancient unsalted hash functions are going away. I guess maybe I spoke too soon?</p>



<h3>So what is Microsoft doing about this?</h3>



<p>Clearly not enough. These “Kerberoasting” attacks have been around for ages: the technique and name is credited to <a href="https://www.irongeek.com/i.php?page=videos%2Fderbycon4%2Ft120-attacking-microsoft-kerberos-kicking-the-guard-dog-of-hades-tim-medin">Tim Medin</a> who presented it in 2014 (and many popular <a href="https://malicious.link/posts/2016/kerberoast-pt1/?utm_source=chatgpt.com">blogs</a> followed up on it) but the vulnerabilities themselves are much older. The fact that there are practical ransomware attacks using these ideas in 2024 indicates that (1) system administrators aren’t hardening things enough, but <span>more importantly</span>, (2) Microsoft is still not turning off the unsafe options that make these attacks possible.</p>



<figure><a href="https://blog.cryptographyengineering.com/wp-content/uploads/2025/09/image.png"><img data-attachment-id="8674" data-permalink="https://blog.cryptographyengineering.com/2025/09/10/kerberoasting/image-90/" data-orig-file="https://blog.cryptographyengineering.com/wp-content/uploads/2025/09/image.png" data-orig-size="2400,482" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://blog.cryptographyengineering.com/wp-content/uploads/2025/09/image.png?w=300" data-large-file="https://blog.cryptographyengineering.com/wp-content/uploads/2025/09/image.png?w=700" width="1024" height="205" src="https://blog.cryptographyengineering.com/wp-content/uploads/2025/09/image.png?w=1024" alt=""></a></figure>



<p>To give some sense of where we are, in October 2024, Microsoft <a href="https://www.microsoft.com/en-us/security/blog/2024/10/11/microsofts-guidance-to-help-mitigate-kerberoasting/">published a blog post on how to avoid Kerberos-based attacks</a> (<em>NB: I</em> <em>cannot say Kerberoasting again and take myself seriously)</em>. </p>



<p>The recommendations are all kind of dismal. They recommend that administrators should use proper automated key assignment, and if they can’t do that, then to try to pick “really good long passwords”, and if they can’t do that, to <em>pretty please </em>shut off RC4. But Microsoft doesn’t seem to do anything proactive, like <em>absolutely banning obsolete legacy stuff</em>, or being completely obnoxious and forcing admins to upgrade their weird and bad legacy configurations. Instead this all seems much more like a reluctant and half-baked bit of vulnerability management.</p>



<p>I’m sure there are some reasons why this is, but I refuse to believe they’re good reasons, and Microsoft should probably try a lot harder to make sure these obsolete services go away. It isn’t 1999 anymore, and it isn’t even 2014.</p>



<p>If you don’t believe me on these points, go ask Ascension Health.</p>
	</div><!-- .entry-content -->

			<!-- .entry-footer -->
	</article></div>]]></description>
        </item>
        <item>
            <title><![CDATA[Supabase OrioleDB Patent: now freely available to the Postgres community (363 pts)]]></title>
            <link>https://supabase.com/blog/orioledb-patent-free</link>
            <guid>45196173</guid>
            <pubDate>Wed, 10 Sep 2025 11:31:55 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://supabase.com/blog/orioledb-patent-free">https://supabase.com/blog/orioledb-patent-free</a>, See on <a href="https://news.ycombinator.com/item?id=45196173">Hacker News</a></p>
&lt;Unparsable&gt;]]></description>
        </item>
        <item>
            <title><![CDATA[Made for People, Not Cars: Reclaiming European Cities (666 pts)]]></title>
            <link>https://www.greeneuropeanjournal.eu/made-for-people-not-cars-reclaiming-european-cities/</link>
            <guid>45195520</guid>
            <pubDate>Wed, 10 Sep 2025 10:08:14 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://www.greeneuropeanjournal.eu/made-for-people-not-cars-reclaiming-european-cities/">https://www.greeneuropeanjournal.eu/made-for-people-not-cars-reclaiming-european-cities/</a>, See on <a href="https://news.ycombinator.com/item?id=45195520">Hacker News</a></p>
Couldn't get https://www.greeneuropeanjournal.eu/made-for-people-not-cars-reclaiming-european-cities/: Error: timeout of 10000ms exceeded]]></description>
        </item>
        <item>
            <title><![CDATA[Show HN: TailGuard – Bridge your WireGuard router into Tailscale via a container (103 pts)]]></title>
            <link>https://github.com/juhovh/tailguard</link>
            <guid>45192963</guid>
            <pubDate>Wed, 10 Sep 2025 03:42:55 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://github.com/juhovh/tailguard">https://github.com/juhovh/tailguard</a>, See on <a href="https://news.ycombinator.com/item?id=45192963">Hacker News</a></p>
<div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto"><h2 tabindex="-1" dir="auto">TailGuard</h2><a id="user-content-tailguard" aria-label="Permalink: TailGuard" href="#tailguard"></a></p>
<p dir="auto">A simple Docker container app which allows connecting existing WireGuard
servers to the Tailscale network, in case the device running WireGuard is
locked in and/or does not support Tailscale binaries.</p>
<p dir="auto">The network topology will look roughly like this:</p>
<div data-snippet-clipboard-copy-content="  +---------+
  | device1 |\
  +---------+ \                      VPS
  +---------+  \ +---------+    +-----------+      +-----------+
  | device2 |----| tailnet |----| TailGuard |<---->| WireGuard |
  +---------+  / +---------+    +-----------+      +-----------+
  +---------+ /
  | device3 |/
  +---------+"><pre><code>  +---------+
  | device1 |\
  +---------+ \                      VPS
  +---------+  \ +---------+    +-----------+      +-----------+
  | device2 |----| tailnet |----| TailGuard |&lt;----&gt;| WireGuard |
  +---------+  / +---------+    +-----------+      +-----------+
  +---------+ /
  | device3 |/
  +---------+
</code></pre></div>
<p dir="auto">As usual, the tailnet is virtual and in reality connections are point-to-point,
but all connections to WireGuard are tunneled through the TailGuard server with
a fixed and persistent connection. As long as you have access to a server as
close to the WireGuard server as possible (ideally with a minimal ping), for
example a VPS, you can connect any WireGuard device to your tailnet.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">Benefits</h2><a id="user-content-benefits" aria-label="Permalink: Benefits" href="#benefits"></a></p>
<p dir="auto">Why would you want to do this? For most use cases it may be easier to connect
your device with WireGuard directly, but there are a couple of benefits with
this bridged approach:</p>
<ul dir="auto">
<li>the WireGuard tunnel private key is stored only on a single machine, making
the key management less work</li>
<li>if you have a new device, you can simply log in to your tailnet with SSO,
without having to transfer keys</li>
<li>it's easier to switch between exit nodes in your tailnet, without having to
reconnect to different VPNs</li>
<li>you can have access to both your tailnet and WireGuard concurrently on your
mobile device, which doesn't support multiple VPNs</li>
<li>you can connect your home network to your tailnet using your router, which
only supports WireGuard but not Tailscale</li>
</ul>
<p dir="auto"><h2 tabindex="-1" dir="auto">Installation</h2><a id="user-content-installation" aria-label="Permalink: Installation" href="#installation"></a></p>
<p dir="auto">The simplest way to start TailGuard is to simply download a WireGuard client
config and save it as <code>wg0.conf</code>. After that you can create an IPv6 network
(optional, but recommended) and start the container:</p>
<div data-snippet-clipboard-copy-content="docker network create --ipv6 ip6net
docker run -it \
  -v ./wg0.conf:/etc/wireguard/wg0.conf -v ./state:/tailguard/state \
  --cap-add NET_ADMIN --device /dev/net/tun \
  --sysctl net.ipv4.ip_forward=1 --sysctl net.ipv6.conf.all.forwarding=1 \
  --sysctl net.ipv4.conf.all.src_valid_mark=1 \
  --network ip6net -p 41641:41641/udp \
  --name tailguard juhovh/tailguard:latest"><pre><code>docker network create --ipv6 ip6net
docker run -it \
  -v ./wg0.conf:/etc/wireguard/wg0.conf -v ./state:/tailguard/state \
  --cap-add NET_ADMIN --device /dev/net/tun \
  --sysctl net.ipv4.ip_forward=1 --sysctl net.ipv6.conf.all.forwarding=1 \
  --sysctl net.ipv4.conf.all.src_valid_mark=1 \
  --network ip6net -p 41641:41641/udp \
  --name tailguard juhovh/tailguard:latest
</code></pre></div>
<p dir="auto">Docker will print you an URL where you need to log in to your tailnet, and after
that you should be good to go.</p>
<p dir="auto">If you want to build the latest version of the image yourself, it might be best
to use <code>docker compose</code>. In that case you should store the <code>wg0.conf</code> file under
<code>config/</code>, build the latest image with <code>docker compose build</code> and finally run it
with <code>docker compose up</code>.</p>
<p dir="auto">That's it, happy networking!</p>
<p dir="auto"><h3 tabindex="-1" dir="auto">Advanced settings</h3><a id="user-content-advanced-settings" aria-label="Permalink: Advanced settings" href="#advanced-settings"></a></p>
<p dir="auto">Let's imagine you have a WireGuard server running on 10.1.0.1 that is able to
accept any routes, and its local LAN network is 192.168.8.0/24. You have already
downloaded the WireGuard client config for this tunnel and saved it.  Make sure
that the subnet 192.168.8.0/24 is explicitly mentioned in the AllowedIPs section
in addition to 0.0.0.0/0, for TailGuard to pick it up. It should look something
like this:</p>
<div data-snippet-clipboard-copy-content="[Interface]
PrivateKey = <REDACTED>
Address = 10.1.0.2/24,fd00:ed7c:a960:6e9b::2/64
DNS = 10.1.0.1,fd00:ed7c:a960:6e9b::1
MTU = 1420

[Peer]
PublicKey = <REDACTED>
PresharedKey = <REDACTED>
AllowedIPs = 0.0.0.0/0, ::/0, 192.168.8.0/24
Endpoint = <REDACTED>:51820
PersistentKeepalive = 25"><pre><code>[Interface]
PrivateKey = &lt;REDACTED&gt;
Address = 10.1.0.2/24,fd00:ed7c:a960:6e9b::2/64
DNS = 10.1.0.1,fd00:ed7c:a960:6e9b::1
MTU = 1420

[Peer]
PublicKey = &lt;REDACTED&gt;
PresharedKey = &lt;REDACTED&gt;
AllowedIPs = 0.0.0.0/0, ::/0, 192.168.8.0/24
Endpoint = &lt;REDACTED&gt;:51820
PersistentKeepalive = 25
</code></pre></div>
<p dir="auto">Next you can either add <code>-e TS_DEST_IP=10.1.0.1</code> if running directly, or open
the docker-compose.yml and modify it as follows:</p>
<div data-snippet-clipboard-copy-content="    environment:
      - TS_DEST_IP=10.1.0.1"><pre><code>    environment:
      - TS_DEST_IP=10.1.0.1
</code></pre></div>
<p dir="auto">This will use the device wg0 and therefore the wg0.conf file for WireGuard. It
will connect to the tailnet, forward all connections targeting itself to the
router behind the tunnel, advertise the "192.168.8.0/24" route to other tailnet
hosts, advertise itself as an exit node, and authenticate with the given
authkey.</p>
<p dir="auto">Supported configuration parameters through environment:</p>
<ul dir="auto">
<li><code>WG_DEVICE</code> - WireGuard device name, must be valid and match config file name (<strong>default:</strong> wg0)</li>
<li><code>TS_DEVICE</code> - Tailscale device name, must be a valid device name (<strong>default:</strong> tailscale0)</li>
<li><code>TS_PORT</code> - Tailscale port number, should be exposed by Docker (<strong>default:</strong> 41641)</li>
<li><code>TS_AUTHKEY</code> - Tailscale auth key for authentication if used</li>
<li><code>TS_DEST_IP</code> - Destination IP to route Tailscale traffic to</li>
<li><code>TS_HOSTNAME</code> - Tailscale hostname for this device if used</li>
</ul>
<p dir="auto"><h3 tabindex="-1" dir="auto">Two-way routing between the networks</h3><a id="user-content-two-way-routing-between-the-networks" aria-label="Permalink: Two-way routing between the networks" href="#two-way-routing-between-the-networks"></a></p>
<p dir="auto">Unlike Tailscale, WireGuard itself does not handle any routing. Therefore, the
WireGuard subnets and routes are automatically advertised on the Tailscale
network, but it doesn't work the other way around.</p>
<p dir="auto">Let's say your TailGuard node has IP addresses <code>10.1.0.2</code> and
<code>fd00:ed7c:a960:6e9b::2</code> for the WireGuard tunnel, like in the above config. You
likely want to add at least routes <code>100.64.0.0/10</code> and <code>fd7a:115c:a1e0::/48</code>
(Tailscale private address spaces) to be routed through <code>10.1.0.2</code>. You can do
this with something along the lines of:</p>
<div data-snippet-clipboard-copy-content="ip route add 100.64.0.0/10 via 10.1.0.2 dev wgserver
ip route add fd7a:115c:a1e0::/48 via fd00:ed7c:a960:6e9b::2 dev wgserver"><pre><code>ip route add 100.64.0.0/10 via 10.1.0.2 dev wgserver
ip route add fd7a:115c:a1e0::/48 via fd00:ed7c:a960:6e9b::2 dev wgserver
</code></pre></div>
<p dir="auto">If you have additional subnets in your tailnet (e.g. <code>192.168.1.0/24</code>) that
you'd like to access, just add similar routing rules for those. TailGuard should
take care of forwarding all the published subnets to the tailnet, as long as it
is able to receive packets through the WireGuard tunnel first.</p>
<p dir="auto"><h2 tabindex="-1" dir="auto">License</h2><a id="user-content-license" aria-label="Permalink: License" href="#license"></a></p>
<p dir="auto">The MIT License (MIT)</p>
<p dir="auto">Copyright (c) 2025 Juho Vähä-Herttua</p>
<p dir="auto">Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p dir="auto">The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p dir="auto">THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
</article></div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[I replaced Animal Crossing's dialogue with a live LLM by hacking GameCube memory (805 pts)]]></title>
            <link>https://joshfonseca.com/blogs/animal-crossing-llm</link>
            <guid>45192655</guid>
            <pubDate>Wed, 10 Sep 2025 02:59:48 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://joshfonseca.com/blogs/animal-crossing-llm">https://joshfonseca.com/blogs/animal-crossing-llm</a>, See on <a href="https://news.ycombinator.com/item?id=45192655">Hacker News</a></p>
<div id="readability-page-1" class="page"><div>
		<div>
			
			<p>A bridge from 2001 to today, with no game code changes required.</p>
		</div>

		<figure>
			<img src="https://joshfonseca.com/assets/images/ac/Modern%20AI%20in%2024%20Year%20Old%20Game%20Screenshot%20(3).png" alt="Cookie says: 'Oh my gosh, Josh :)! I just had the weirdest dream, like, everything we do is a game! Arfer!'" loading="lazy">
			<figcaption>Cookie: "Oh my gosh, Josh :)! I just had the weirdest dream, like, everything we do is a game! Arfer!"</figcaption>
		</figure>

		<p>
			Animal Crossing. Infamous for its charming but ultimately repetitive dialogue. Having picked up the GameCube classic again, I was shocked (/s) to discover that the villagers still say the same things they did 23 years ago. Let's change that.
		</p>
		<p>
			The problem? The game runs on a Nintendo GameCube, a 24-year-old console with a 485 MHz PowerPC processor, 24MB of RAM, and absolutely no internet connectivity. It was fundamentally, physically, and philosophically designed to be an offline island.
		</p>
		<p>
			This is the story of how I built a bridge from 2001 to today, making a vintage game console talk to a cloud-based AI without modifying a single line of the original game's code.
		</p>

		<h2>The First Hurdle: Speaking to the Game 🗣️</h2>
		<p>
			My first stroke of luck was immense. The week I started this project, a massive effort by the Animal Crossing decompilation community reached completion. Instead of staring at PowerPC assembly, I had access to readable C code.
		</p>
		<p>
			Digging through the source, I quickly found the relevant functions under a file named <code>m_message.c</code>. This was it, the heart of the dialogue system. A simple test confirmed I could hijack the function call and replace the in-game text with my own string.
		</p>

		<p>C: A glimpse into the decompiled dialogue system</p>
		<pre><code>// A glimpse into the decompiled Animal Crossing source code
// The function that changes message data in the dialogue system.
// My initial entry point for hijacking the text.

extern int mMsg_ChangeMsgData(mMsg_Window_c* msg_p, int index) {
    if (index &gt;= 0 &amp;&amp; index &lt; MSG_MAX &amp;&amp; mMsg_LoadMsgData(msg_p-&gt;msg_data, index, FALSE)) {
        msg_p-&gt;end_text_cursor_idx = 0;
        mMsg_Clear_CursolIndex(msg_p);
        mMsg_SetTimer(msg_p, 20.0f);
        return TRUE;
    }
    
    return FALSE;
}
</code></pre>

		<p>
			Easy win, right? But changing static text is one thing. How could I get data from an external AI into the game in real time?
		</p>
		<p>
			My first thought was to just add a network call. But that would mean writing an entire network stack for the GameCube from scratch (TCP/IP, sockets, HTTP) and integrating it into a game engine that was never designed for it. That was a non-starter.
		</p>
		<p>
			My second thought was to use the Dolphin emulator's features to write to a file on my host machine. The game would write a "request" file with context, and my Python script would see it, call the LLM, and write back a "response" file. Unfortunately, I couldn't get the sandboxed GameCube environment to access the host filesystem. Another dead end.
		</p>

		<h2>The Breakthrough: The Memory Mailbox 📬</h2>
		<p>
			The solution came from a classic technique in game modding: Inter-Process Communication (IPC) via shared memory. The idea is to allocate a specific chunk of the GameCube's RAM to act as a "mailbox." My external Python script can write data directly into that memory address, and the game can read from it.
		</p>

		<div>
			<p>
				graph TD
					A[Python Script] -- "Writes LLM response" --&gt; B{Memory Mailbox @ 0x81298360}
					B -- "Game reads new dialogue" --&gt; C[Animal Crossing on Dolphin Emulator]
					C -- "Writes current speaker &amp; context" --&gt; B
			</p>
		</div>

		<p>Python: The core of the "Memory Mailbox" interface</p>
		<pre><code># This is the bridge. These functions read from and write to GameCube RAM via Dolphin.
GAMECUBE_MEMORY_BASE = 0x80000000

def read_from_game(gc_address: int, size: int) -&gt; bytes:
    """Reads a block of memory from a GameCube virtual address."""
    real_address = GAMECUBE_MEMORY_BASE + (gc_address - 0x80000000)
    return dolphin_process.read(real_address, size)

def write_to_game(gc_address: int, data: bytes) -&gt; bool:
    """Writes a block of data to a GameCube virtual address."""
    real_address = GAMECUBE_MEMORY_BASE + (gc_address - 0x80000000)
    return dolphin_process.write(real_address, data)
</code></pre>

		<p>
			This was the path forward. But it created a new, painstaking task: I had to become a memory archaeologist. I needed to find the exact stable memory addresses for the active dialogue text and the current speaker's name.
		</p>
		<p>
			To do this, I wrote my own memory scanner in Python. The process was a tedious loop:
		</p>
		<ul>
			<li><b>Talk to a villager.</b> The moment their dialogue box appeared, I'd freeze the emulator.</li>
			<li><b>Scan.</b> I'd run my script to scan all 24 million bytes of the GameCube's RAM for the string of text on screen (e.g., "Hey, how's it going?").</li>
			<li><b>Cross-Reference.</b> This often returned multiple addresses. So, I'd unfreeze, talk to a different villager, and scan for their name to figure out which memory block belonged to the active speaker.</li>
		</ul>
		<p>
			After hours of talking, freezing, and scanning, I finally nailed down the key addresses: <code>0x8129A3EA</code> for the speaker's name and <code>0x81298360</code> for the dialogue buffer. I could now reliably read who was talking and, more importantly, write data back to the dialogue box.
		</p>

		<h2>What About the GameCube Broadband Adapter? 🌐</h2>
		<p>
			Yes, the GameCube had an official Broadband Adapter (BBA). But <i>Animal Crossing</i> shipped without networking primitives, sockets, or any game-layer protocol to use it. Using the BBA here would have required building a tiny networking stack and patching the game to call it. That means: hooking engine callsites, scheduling async I/O, and handling retries/timeouts, all inside a codebase that never expected the network to exist.
		</p>
		<ul>
			<li><b>Engine hooks:</b> Hijack safe points in the message loop to send/receive packets.</li>
			<li><b>Driver/protocol:</b> Provide a minimal UDP/RPC interface over BBA.</li>
			<li><b>Robustness:</b> Handle timeouts, retries, and partial reads without stalling animations/UI.</li>
		</ul>
		<div>
			<p>
				graph LR
					subgraph Option A: BBA Network Shim
						AC[Animal Crossing] --&gt; Hooks[Net Shim Hooks]
						Hooks --&gt; BBA[BBA Driver]
						BBA --&gt; LAN[(LAN)]
						LAN --&gt; Host[Host Bridge Server]
					end
					subgraph Option B: RAM Mailbox
						AC2[Animal Crossing] --&gt; Mailbox[RAM Mailbox]
						Mailbox --&gt; Py[Python Watcher]
						Py --&gt; LLM[LLM]
					end
			</p>
		</div>
		<p>
			I chose the RAM mailbox because it's deterministic, requires zero kernel/driver work, and stays entirely within the emulator boundary, with no binary network stack needed. That said, a BBA shim is absolutely possible (and a fun future project for real hardware via Swiss + homebrew).
		</p>

		<p>C: Minimal RPC envelope for a hypothetical BBA shim</p>
		<pre><code>#include &lt;stdint.h&gt;

/* Minimal RPC envelope for a hypothetical BBA shim */
typedef struct {
    uint32_t magic;    // 'ACRP'
    uint16_t type;     // 1=Request, 2=Response
    uint16_t length;   // payload length
    uint8_t  payload[512];
} RpcMsg;

int ac_net_send(const RpcMsg* msg);         // sends via BBA
int ac_net_recv(RpcMsg* out, int timeoutMs); // polls with timeout
</code></pre>

		<p>Python: Host-side UDP bridge (very simplified)</p>
		<pre><code>import socket, json
sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
sock.bind(("0.0.0.0", 19135))
while True:
    data, addr = sock.recvfrom(2048)
    msg = json.loads(data.decode("utf-8", "ignore"))
    # ... call Writer/Director LLMs ...
    reply = json.dumps({"ok": True, "text": "Hi from the cloud!"}).encode()
    sock.sendto(reply, addr)
</code></pre>

		<h2>Speaking the Game's Secret Language 🤫</h2>
		<p>
			I eagerly tried writing "Hello World" to the dialogue address and... the game froze. The character animations kept playing, but the dialogue wouldn't advance. I was so close, yet so far.
		</p>
		<p>
			The problem was that I was sending plain text. Animal Crossing doesn't speak plain text. It speaks its own encoded language filled with control codes.
		</p>
		<p>
			Think of it like HTML. Your browser doesn't just display words; it interprets tags like <code>&lt;b&gt;</code> to make text bold. Animal Crossing does the same. A special prefix byte, <code>CHAR_CONTROL_CODE</code>, tells the game engine, "The next byte isn't a character, it's a command!"
		</p>
		<p>
			These commands control everything: text color, pauses, sound effects, character emotions, and even the end of a conversation. If you don't send the <code>&lt;End Conversation&gt;</code> control code, the game simply waits forever for a command that never comes. That's why it was freezing.
		</p>
		<p>
			Once again, the decompilation community saved me. They had already documented most of these codes. I just needed to build the tools to use them.
		</p>
		<p>
			I wrote an encoder and a decoder in Python. The decoder could read raw game memory and translate it into a human-readable format, and the encoder could take my text with custom tags and convert it back into the exact sequence of bytes the GameCube understood.
		</p>
		<p>Python: A small sample of the control codes I had to encode/decode</p>
		<pre><code># A small sample of the control codes I had to encode/decode
CONTROL_CODES = {
    0x00: "&lt;End Conversation&gt;",
    0x03: "&lt;Pause [{:02X}]&gt;",        # e.g., &lt;Pause [0A]&gt; for a short pause
    0x05: "&lt;Color Line [{:06X}]&gt;",  # e.g., &lt;Color Line [FF0000]&gt; for red
    0x09: "&lt;NPC Expression [Cat:{:02X}] [{}]&gt;", # Trigger an emotion
    0x59: "&lt;Play Sound Effect [{}]&gt;",  # e.g., &lt;Play Sound Effect [Happy]&gt;
    0x1A: "&lt;Player Name&gt;",
    0x1C: "&lt;Catchphrase&gt;",
}

# The magic byte that signals a command is coming
PREFIX_BYTE = 0x7F
</code></pre>

		<p>
			With my new encoder, I tried again. This time, I wasn't just sending text. I was speaking the game's language. And it worked. The hardest part of the hack was done.
		</p>

		<h2>Building the AI Brain 🧠</h2>
		<p>
			With the communication channel established, it was time for the fun part: building the AI.
		</p>
		<p>
			My initial approach was to have a single LLM do everything: write dialogue, stay in character, and insert the technical control codes. The results were a mess. The AI was trying to be a creative writer and a technical programmer simultaneously and was bad at both.
		</p>
		<p>
			The solution was to split the task into a two-model pipeline: a <b>Writer</b> and a <b>Director</b>.
		</p>
		<ul>
			<li><b>The Writer AI:</b> This model's only job is to be creative. It receives a detailed character sheet (which I generated by scraping the Animal Crossing Fan Wiki) and focuses on writing dialogue that is funny, in-character, and relevant to the context.</li>
			<li><b>The Director AI:</b> This model receives the pure text from the Writer. Its job is purely technical. It reads the dialogue and decides how to "shoot the scene." It adds pauses for dramatic effect, emphasizes words with color, and chooses the perfect facial expression or sound effect to match the mood.</li>
		</ul>
		<p>
			This separation of concerns worked perfectly.
		</p>

		<div>
			<p>
				graph LR
					subgraph Game World
						Dolphin(Dolphin Emulator)
					end

					subgraph Python Bridge
						Watcher(watch_dialogue.py)
						Encoder(Encoder/Decoder)
					end

					subgraph AI Core
						Writer(Writer LLM)
						Director(Director LLM)
					end

					subgraph External Data
						Wiki(Fan Wiki)
						News(RSS Feeds)
					end

					Dolphin &lt;--&gt; |IPC via RAM| Watcher
					Watcher --&gt; |Context| Writer
					Wiki --&gt; |Character Sheets| Writer
					News --&gt; |Current Events| Writer

					Writer --&gt; |Raw Dialogue| Director
					Director --&gt; |Decorated Dialogue| Encoder
					Encoder --&gt; |Encoded Bytes| Watcher
			</p>
		</div>

		<h2>Emergent Behavior 🤪</h2>
		<p>
			First I piped in a lightweight news feed. Within minutes, villagers began weaving headlines into small talk, no prompts, just context.
		</p>

		<figure>
			<img src="https://joshfonseca.com/assets/images/ac/Modern%20AI%20in%2024%20Year%20Old%20Game%20Screenshot%20(2).png" alt="Mitzi mentions European leaders meeting Trump and Zelenskyy" loading="lazy">
			<figcaption>Mitzi: "About the news? European leaders are planning to meet with Trump and Zelenskyy!"</figcaption>
		</figure>

		<p>
			Then I gave them a tiny shared memory for gossip, who said what, to whom, and how they felt. Predictably, it escalated into an anti-Tom Nook movement.
		</p>

		<figure>
			<img src="https://joshfonseca.com/assets/images/ac/Modern%20AI%20in%2024%20Year%20Old%20Game%20Screenshot%20(1).png" alt="Cookie says Tom Nook is taking all the bells" loading="lazy">
			<figcaption>Cookie: "Everything's going great in town, but sometimes I feel like Tom Nook is, like, taking all the bells!"</figcaption>
		</figure>

		<p>
			And I was reminded that I used Fox News as the news feed.
		</p>

		<figure>
			<img src="https://joshfonseca.com/assets/images/ac/Modern%20AI%20in%2024%20Year%20Old%20Game%20Screenshot.png" alt="Cookie says a woman was killed in a robbery in a blue city" loading="lazy">
			<figcaption>Cookie: "A woman was killed in a robbery in a blue city!"</figcaption>
		</figure>

		<p>
			Now the game is a strange, hilarious, and slightly unsettling :)
		</p>
		<div><p>
			All the code for this project, including the memory interface, dialogue encoder, and AI prompting logic, is available on GitHub. It was one of the most challenging and rewarding projects I've ever tackled, blending reverse engineering, AI, and a deep love for a classic game.</p><p>
			<i>Watch the full video:</i> <a href="https://youtu.be/7AyEzA5ziE0?si=_SADxbdz650nyCnP" target="_blank" rel="noopener">Modern AI in a 24-Year-Old Game</a></p></div>
	</div></div>]]></description>
        </item>
        <item>
            <title><![CDATA[R-Zero: Self-Evolving Reasoning LLM from Zero Data (107 pts)]]></title>
            <link>https://arxiv.org/abs/2508.05004</link>
            <guid>45192194</guid>
            <pubDate>Wed, 10 Sep 2025 02:02:17 GMT</pubDate>
            <description><![CDATA[<p>URL: <a href="https://arxiv.org/abs/2508.05004">https://arxiv.org/abs/2508.05004</a>, See on <a href="https://news.ycombinator.com/item?id=45192194">Hacker News</a></p>
<div id="readability-page-1" class="page"><div id="content-inner">
    
    
                
    <p><a href="https://arxiv.org/pdf/2508.05004">View PDF</a>
    <a href="https://arxiv.org/html/2508.05004v2">HTML (experimental)</a></p><blockquote>
            <span>Abstract:</span>Self-evolving Large Language Models (LLMs) offer a scalable path toward super-intelligence by autonomously generating, refining, and learning from their own experiences. However, existing methods for training such models still rely heavily on vast human-curated tasks and labels, typically via fine-tuning or reinforcement learning, which poses a fundamental bottleneck to advancing AI systems toward capabilities beyond human intelligence. To overcome this limitation, we introduce R-Zero, a fully autonomous framework that generates its own training data from scratch. Starting from a single base LLM, R-Zero initializes two independent models with distinct roles, a Challenger and a Solver. These models are optimized separately and co-evolve through interaction: the Challenger is rewarded for proposing tasks near the edge of the Solver capability, and the Solver is rewarded for solving increasingly challenging tasks posed by the Challenger. This process yields a targeted, self-improving curriculum without any pre-existing tasks and labels. Empirically, R-Zero substantially improves reasoning capability across different backbone LLMs, e.g., boosting the Qwen3-4B-Base by +6.49 on math-reasoning benchmarks and +7.54 on general-domain reasoning benchmarks.
    </blockquote>

    <!--CONTEXT-->
    
  </div><div>
      <h2>Submission history</h2><p> From: Chengsong Huang [<a href="https://arxiv.org/show-email/fa943792/2508.05004" rel="nofollow">view email</a>]      <br>            <strong><a href="https://arxiv.org/abs/2508.05004v1" rel="nofollow">[v1]</a></strong>
        Thu, 7 Aug 2025 03:38:16 UTC (665 KB)<br>
    <strong>[v2]</strong>
        Wed, 27 Aug 2025 02:33:55 UTC (10,672 KB)<br>
</p></div></div>]]></description>
        </item>
    </channel>
</rss>